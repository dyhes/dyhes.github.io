<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Callable & Runnable åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼ŒRunnableå’ŒCallableæ˜¯å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„ä¸¤ç§æ ¸å¿ƒæ¥å£ï¼Œå®ƒä»¬çš„è®¾è®¡ç›®çš„å’ŒåŠŸèƒ½æœ‰æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ï¼š\nâš™ï¸ æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼ Runnable å®šä¹‰å•ä¸€æ–¹æ³• run()ï¼Œè¿”å›ç±»å‹ä¸º voidï¼Œä¸è¿”å›ä»»ä½•ç»“æœã€‚ ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•ã€å¼‚æ­¥é€šçŸ¥ç­‰æ— éœ€è¿”å›å€¼çš„ä»»åŠ¡ã€‚ Runnable task = () -> System.out.println("Task executed"); Callable å®šä¹‰æ–¹æ³• call()ï¼Œæ”¯æŒæ³›å‹è¿”å›å€¼ï¼ˆå¦‚ Callable<Integer> è¿”å›æ•´æ•°ï¼‰ã€‚ ç¤ºä¾‹ï¼šè®¡ç®—é˜¶ä¹˜ã€æ•°æ®åº“æŸ¥è¯¢ç­‰éœ€è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚ Callable<Integer> task = () -> { return 42; }; âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶ Runnable run() ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆchecked exceptionï¼‰ï¼Œåªèƒ½åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ try-catch å¤„ç†ã€‚ Runnable task = () -> { try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } }; Callable call() å¯æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆå¦‚ throws Exceptionï¼‰ï¼Œå¼‚å¸¸ä¼šå°è£…åœ¨ Future.get() æŠ›å‡ºçš„ ExecutionException ä¸­ï¼Œå¯é€šè¿‡ getCause() è·å–åŸå§‹å¼‚å¸¸ã€‚ Callable<Integer> task = () -> { if (invalid) throw new Exception("Error"); return result; }; ğŸ”Œ æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§ Runnable å¯é€šè¿‡ Thread ç±»ç›´æ¥å¯åŠ¨ï¼ˆnew Thread(runnable).start()ï¼‰æˆ–æäº¤ç»™ ExecutorServiceã€‚ æäº¤åè¿”å› Future<?>ï¼Œä½† get() å§‹ç»ˆè¿”å› nullã€‚ Callable å¿…é¡»é€šè¿‡ ExecutorService.submit() æäº¤ï¼Œè¿”å› Future<V> å¯¹è±¡ï¼Œç”¨äºè·å–ç»“æœæˆ–å¼‚å¸¸ã€‚ æ— æ³•ç›´æ¥é€šè¿‡ Thread ç±»å¯åŠ¨ï¼Œéœ€å€ŸåŠ© FutureTask åŒ…è£…ï¼ˆnew Thread(new FutureTask<>(callable)).start()ï¼‰ã€‚ ğŸ“Š ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨ ç‰¹æ€§ Runnable Callable è¿”å›å€¼ âŒ æ—  âœ… æ”¯æŒæ³›å‹è¿”å›å€¼ å¼‚å¸¸å¤„ç† âŒ ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ âœ… å¯æŠ›å‡ºå—æ£€å¼‚å¸¸ æ‰§è¡Œæ–¹å¼ âœ… æ”¯æŒThreadæˆ–çº¿ç¨‹æ±  âŒ ä»…æ”¯æŒçº¿ç¨‹æ± æäº¤ ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª âš ï¸ ä»…èƒ½åˆ¤æ–­æ˜¯å¦å®Œæˆï¼ˆFuture.isDone()ï¼‰ âœ… å¯è·å–ç»“æœã€å¼‚å¸¸åŠå–æ¶ˆä»»åŠ¡ å¼•å…¥ç‰ˆæœ¬ Java 1.0 Java 5ï¼ˆjava.util.concurrentåŒ…ï¼‰ ğŸ§© çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å– Runnable é€šè¿‡ Future.isDone() åˆ¤æ–­ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œä½†æ— æ³•è·å–ç»“æœæˆ–å¼‚å¸¸è¯¦æƒ…ã€‚ Callable é€šè¿‡ Future.get() é˜»å¡è·å–ç»“æœï¼Œæ”¯æŒè¶…æ—¶è®¾ç½®ï¼ˆget(long timeout, TimeUnit unit)ï¼‰ã€‚ å¯æ•è· ExecutionException å¤„ç†ä»»åŠ¡å†…éƒ¨å¼‚å¸¸ï¼Œæˆ–é€šè¿‡ Future.cancel() å–æ¶ˆä»»åŠ¡ã€‚ ğŸ’¡ é€‚ç”¨åœºæ™¯ Runnableï¼š ç®€å•å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚äº‹ä»¶æ—¥å¿—ã€çº¿ç¨‹æ± åŸºç¡€ä»»åŠ¡ï¼‰ã€‚ Callableï¼š éœ€è¿”å›ç»“æœæˆ–ä¸¥æ ¼å¼‚å¸¸å¤„ç†çš„ä»»åŠ¡ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—ã€IOæ“ä½œï¼‰ã€‚ ğŸ“ ä»£ç ç¤ºä¾‹å¯¹æ¯” // Runnableç¤ºä¾‹ ExecutorService executor = Executors.newSingleThreadExecutor(); Future<?> futureRunnable = executor.submit(() -> System.out.println("Runnable")); futureRunnable.get(); // è¿”å›null // Callableç¤ºä¾‹ Future<Integer> futureCallable = executor.submit(() -> { return 100; }); Integer result = futureCallable.get(); // è¿”å›100 ğŸ’ æ€»ç»“ Runnableæ˜¯è½»é‡çº§å¼‚æ­¥ä»»åŠ¡çš„åŸºç¡€æ¥å£ï¼Œè€ŒCallableé€šè¿‡è¿”å›å€¼ã€å¼‚å¸¸ä¼ é€’å’ŒFutureäº¤äº’æœºåˆ¶ï¼Œæ‰©å±•äº†å¤æ‚ä»»åŠ¡çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚é€‰æ‹©ä¾æ®ï¼š\n'><title>ã€Javaã€‘Runnable</title><link rel=canonical href=https://dyhes.github.io/p/javarunnable/><link rel=stylesheet href=/scss/style.min.f7091bff8043bd3e53b22be6c05dd86b506e8dec4d0d75d249d2dfb0fe074a46.css><meta property='og:title' content="ã€Javaã€‘Runnable"><meta property='og:description' content='Callable & Runnable åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼ŒRunnableå’ŒCallableæ˜¯å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„ä¸¤ç§æ ¸å¿ƒæ¥å£ï¼Œå®ƒä»¬çš„è®¾è®¡ç›®çš„å’ŒåŠŸèƒ½æœ‰æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ï¼š\nâš™ï¸ æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼ Runnable å®šä¹‰å•ä¸€æ–¹æ³• run()ï¼Œè¿”å›ç±»å‹ä¸º voidï¼Œä¸è¿”å›ä»»ä½•ç»“æœã€‚ ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•ã€å¼‚æ­¥é€šçŸ¥ç­‰æ— éœ€è¿”å›å€¼çš„ä»»åŠ¡ã€‚ Runnable task = () -> System.out.println("Task executed"); Callable å®šä¹‰æ–¹æ³• call()ï¼Œæ”¯æŒæ³›å‹è¿”å›å€¼ï¼ˆå¦‚ Callable<Integer> è¿”å›æ•´æ•°ï¼‰ã€‚ ç¤ºä¾‹ï¼šè®¡ç®—é˜¶ä¹˜ã€æ•°æ®åº“æŸ¥è¯¢ç­‰éœ€è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚ Callable<Integer> task = () -> { return 42; }; âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶ Runnable run() ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆchecked exceptionï¼‰ï¼Œåªèƒ½åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ try-catch å¤„ç†ã€‚ Runnable task = () -> { try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } }; Callable call() å¯æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆå¦‚ throws Exceptionï¼‰ï¼Œå¼‚å¸¸ä¼šå°è£…åœ¨ Future.get() æŠ›å‡ºçš„ ExecutionException ä¸­ï¼Œå¯é€šè¿‡ getCause() è·å–åŸå§‹å¼‚å¸¸ã€‚ Callable<Integer> task = () -> { if (invalid) throw new Exception("Error"); return result; }; ğŸ”Œ æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§ Runnable å¯é€šè¿‡ Thread ç±»ç›´æ¥å¯åŠ¨ï¼ˆnew Thread(runnable).start()ï¼‰æˆ–æäº¤ç»™ ExecutorServiceã€‚ æäº¤åè¿”å› Future<?>ï¼Œä½† get() å§‹ç»ˆè¿”å› nullã€‚ Callable å¿…é¡»é€šè¿‡ ExecutorService.submit() æäº¤ï¼Œè¿”å› Future<V> å¯¹è±¡ï¼Œç”¨äºè·å–ç»“æœæˆ–å¼‚å¸¸ã€‚ æ— æ³•ç›´æ¥é€šè¿‡ Thread ç±»å¯åŠ¨ï¼Œéœ€å€ŸåŠ© FutureTask åŒ…è£…ï¼ˆnew Thread(new FutureTask<>(callable)).start()ï¼‰ã€‚ ğŸ“Š ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨ ç‰¹æ€§ Runnable Callable è¿”å›å€¼ âŒ æ—  âœ… æ”¯æŒæ³›å‹è¿”å›å€¼ å¼‚å¸¸å¤„ç† âŒ ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ âœ… å¯æŠ›å‡ºå—æ£€å¼‚å¸¸ æ‰§è¡Œæ–¹å¼ âœ… æ”¯æŒThreadæˆ–çº¿ç¨‹æ±  âŒ ä»…æ”¯æŒçº¿ç¨‹æ± æäº¤ ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª âš ï¸ ä»…èƒ½åˆ¤æ–­æ˜¯å¦å®Œæˆï¼ˆFuture.isDone()ï¼‰ âœ… å¯è·å–ç»“æœã€å¼‚å¸¸åŠå–æ¶ˆä»»åŠ¡ å¼•å…¥ç‰ˆæœ¬ Java 1.0 Java 5ï¼ˆjava.util.concurrentåŒ…ï¼‰ ğŸ§© çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å– Runnable é€šè¿‡ Future.isDone() åˆ¤æ–­ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œä½†æ— æ³•è·å–ç»“æœæˆ–å¼‚å¸¸è¯¦æƒ…ã€‚ Callable é€šè¿‡ Future.get() é˜»å¡è·å–ç»“æœï¼Œæ”¯æŒè¶…æ—¶è®¾ç½®ï¼ˆget(long timeout, TimeUnit unit)ï¼‰ã€‚ å¯æ•è· ExecutionException å¤„ç†ä»»åŠ¡å†…éƒ¨å¼‚å¸¸ï¼Œæˆ–é€šè¿‡ Future.cancel() å–æ¶ˆä»»åŠ¡ã€‚ ğŸ’¡ é€‚ç”¨åœºæ™¯ Runnableï¼š ç®€å•å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚äº‹ä»¶æ—¥å¿—ã€çº¿ç¨‹æ± åŸºç¡€ä»»åŠ¡ï¼‰ã€‚ Callableï¼š éœ€è¿”å›ç»“æœæˆ–ä¸¥æ ¼å¼‚å¸¸å¤„ç†çš„ä»»åŠ¡ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—ã€IOæ“ä½œï¼‰ã€‚ ğŸ“ ä»£ç ç¤ºä¾‹å¯¹æ¯” // Runnableç¤ºä¾‹ ExecutorService executor = Executors.newSingleThreadExecutor(); Future<?> futureRunnable = executor.submit(() -> System.out.println("Runnable")); futureRunnable.get(); // è¿”å›null // Callableç¤ºä¾‹ Future<Integer> futureCallable = executor.submit(() -> { return 100; }); Integer result = futureCallable.get(); // è¿”å›100 ğŸ’ æ€»ç»“ Runnableæ˜¯è½»é‡çº§å¼‚æ­¥ä»»åŠ¡çš„åŸºç¡€æ¥å£ï¼Œè€ŒCallableé€šè¿‡è¿”å›å€¼ã€å¼‚å¸¸ä¼ é€’å’ŒFutureäº¤äº’æœºåˆ¶ï¼Œæ‰©å±•äº†å¤æ‚ä»»åŠ¡çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚é€‰æ‹©ä¾æ®ï¼š\n'><meta property='og:url' content='https://dyhes.github.io/p/javarunnable/'><meta property='og:site_name' content='é£é¸¿è¸é›ªæ³¥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Java'><meta property='article:published_time' content='2025-06-19T00:00:00+00:00'><meta property='article:modified_time' content='2025-10-22T16:26:59+08:00'><meta name=twitter:title content="ã€Javaã€‘Runnable"><meta name=twitter:description content='Callable & Runnable åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼ŒRunnableå’ŒCallableæ˜¯å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„ä¸¤ç§æ ¸å¿ƒæ¥å£ï¼Œå®ƒä»¬çš„è®¾è®¡ç›®çš„å’ŒåŠŸèƒ½æœ‰æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ï¼š\nâš™ï¸ æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼ Runnable å®šä¹‰å•ä¸€æ–¹æ³• run()ï¼Œè¿”å›ç±»å‹ä¸º voidï¼Œä¸è¿”å›ä»»ä½•ç»“æœã€‚ ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•ã€å¼‚æ­¥é€šçŸ¥ç­‰æ— éœ€è¿”å›å€¼çš„ä»»åŠ¡ã€‚ Runnable task = () -> System.out.println("Task executed"); Callable å®šä¹‰æ–¹æ³• call()ï¼Œæ”¯æŒæ³›å‹è¿”å›å€¼ï¼ˆå¦‚ Callable<Integer> è¿”å›æ•´æ•°ï¼‰ã€‚ ç¤ºä¾‹ï¼šè®¡ç®—é˜¶ä¹˜ã€æ•°æ®åº“æŸ¥è¯¢ç­‰éœ€è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚ Callable<Integer> task = () -> { return 42; }; âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶ Runnable run() ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆchecked exceptionï¼‰ï¼Œåªèƒ½åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ try-catch å¤„ç†ã€‚ Runnable task = () -> { try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } }; Callable call() å¯æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆå¦‚ throws Exceptionï¼‰ï¼Œå¼‚å¸¸ä¼šå°è£…åœ¨ Future.get() æŠ›å‡ºçš„ ExecutionException ä¸­ï¼Œå¯é€šè¿‡ getCause() è·å–åŸå§‹å¼‚å¸¸ã€‚ Callable<Integer> task = () -> { if (invalid) throw new Exception("Error"); return result; }; ğŸ”Œ æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§ Runnable å¯é€šè¿‡ Thread ç±»ç›´æ¥å¯åŠ¨ï¼ˆnew Thread(runnable).start()ï¼‰æˆ–æäº¤ç»™ ExecutorServiceã€‚ æäº¤åè¿”å› Future<?>ï¼Œä½† get() å§‹ç»ˆè¿”å› nullã€‚ Callable å¿…é¡»é€šè¿‡ ExecutorService.submit() æäº¤ï¼Œè¿”å› Future<V> å¯¹è±¡ï¼Œç”¨äºè·å–ç»“æœæˆ–å¼‚å¸¸ã€‚ æ— æ³•ç›´æ¥é€šè¿‡ Thread ç±»å¯åŠ¨ï¼Œéœ€å€ŸåŠ© FutureTask åŒ…è£…ï¼ˆnew Thread(new FutureTask<>(callable)).start()ï¼‰ã€‚ ğŸ“Š ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨ ç‰¹æ€§ Runnable Callable è¿”å›å€¼ âŒ æ—  âœ… æ”¯æŒæ³›å‹è¿”å›å€¼ å¼‚å¸¸å¤„ç† âŒ ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ âœ… å¯æŠ›å‡ºå—æ£€å¼‚å¸¸ æ‰§è¡Œæ–¹å¼ âœ… æ”¯æŒThreadæˆ–çº¿ç¨‹æ±  âŒ ä»…æ”¯æŒçº¿ç¨‹æ± æäº¤ ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª âš ï¸ ä»…èƒ½åˆ¤æ–­æ˜¯å¦å®Œæˆï¼ˆFuture.isDone()ï¼‰ âœ… å¯è·å–ç»“æœã€å¼‚å¸¸åŠå–æ¶ˆä»»åŠ¡ å¼•å…¥ç‰ˆæœ¬ Java 1.0 Java 5ï¼ˆjava.util.concurrentåŒ…ï¼‰ ğŸ§© çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å– Runnable é€šè¿‡ Future.isDone() åˆ¤æ–­ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œä½†æ— æ³•è·å–ç»“æœæˆ–å¼‚å¸¸è¯¦æƒ…ã€‚ Callable é€šè¿‡ Future.get() é˜»å¡è·å–ç»“æœï¼Œæ”¯æŒè¶…æ—¶è®¾ç½®ï¼ˆget(long timeout, TimeUnit unit)ï¼‰ã€‚ å¯æ•è· ExecutionException å¤„ç†ä»»åŠ¡å†…éƒ¨å¼‚å¸¸ï¼Œæˆ–é€šè¿‡ Future.cancel() å–æ¶ˆä»»åŠ¡ã€‚ ğŸ’¡ é€‚ç”¨åœºæ™¯ Runnableï¼š ç®€å•å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚äº‹ä»¶æ—¥å¿—ã€çº¿ç¨‹æ± åŸºç¡€ä»»åŠ¡ï¼‰ã€‚ Callableï¼š éœ€è¿”å›ç»“æœæˆ–ä¸¥æ ¼å¼‚å¸¸å¤„ç†çš„ä»»åŠ¡ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—ã€IOæ“ä½œï¼‰ã€‚ ğŸ“ ä»£ç ç¤ºä¾‹å¯¹æ¯” // Runnableç¤ºä¾‹ ExecutorService executor = Executors.newSingleThreadExecutor(); Future<?> futureRunnable = executor.submit(() -> System.out.println("Runnable")); futureRunnable.get(); // è¿”å›null // Callableç¤ºä¾‹ Future<Integer> futureCallable = executor.submit(() -> { return 100; }); Integer result = futureCallable.get(); // è¿”å›100 ğŸ’ æ€»ç»“ Runnableæ˜¯è½»é‡çº§å¼‚æ­¥ä»»åŠ¡çš„åŸºç¡€æ¥å£ï¼Œè€ŒCallableé€šè¿‡è¿”å›å€¼ã€å¼‚å¸¸ä¼ é€’å’ŒFutureäº¤äº’æœºåˆ¶ï¼Œæ‰©å±•äº†å¤æ‚ä»»åŠ¡çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚é€‰æ‹©ä¾æ®ï¼š\n'><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b567f26f71c49c33.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>é£é¸¿è¸é›ªæ³¥</a></h1><h2 class=site-description>æ²¡æœ‰è®°å½•ï¼Œå°±æ²¡æœ‰å‘ç”Ÿ</h2></div></header><ol class=menu-social><li><a href=https://leetcode.cn/u/dyhes/ target=_blank title=LeetCode rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 13h7.5"/><path d="M9.424 7.268l4.999-4.999"/><path d="M16.633 16.644l-2.402 2.415a3.189 3.189.0 01-4.524.0l-3.77-3.787a3.223 3.223.0 010-4.544l3.77-3.787a3.189 3.189.0 014.524.0l2.302 2.313"/></svg></a></li><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=mailto:1325574784@qq.com target=_blank title=Mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 19H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v5.5"/><path d="M3 7l9 6 9-6"/><path d="M19 16l-2 3h4l-2 3"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/tags/><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#callable--runnable>Callable & Runnable</a><ol><li><a href=#-æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼>âš™ï¸ <strong>æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼</strong></a></li><li><a href=#-å¼‚å¸¸å¤„ç†æœºåˆ¶>âš ï¸ <strong>å¼‚å¸¸å¤„ç†æœºåˆ¶</strong></a></li><li><a href=#-æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§>ğŸ”Œ <strong>æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§</strong></a></li><li><a href=#-ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨>ğŸ“Š <strong>ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨</strong></a></li><li><a href=#-çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å–>ğŸ§© <strong>çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å–</strong></a></li><li><a href=#-é€‚ç”¨åœºæ™¯>ğŸ’¡ <strong>é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#-ä»£ç ç¤ºä¾‹å¯¹æ¯”>ğŸ“ <strong>ä»£ç ç¤ºä¾‹å¯¹æ¯”</strong></a></li><li><a href=#-æ€»ç»“>ğŸ’ <strong>æ€»ç»“</strong></a></li></ol></li><li><a href=#future>Future</a><ol><li><a href=#-future-çš„æ ¸å¿ƒå®šä½ä¸ä½œç”¨>âš™ï¸ <strong>Future çš„æ ¸å¿ƒå®šä½ä¸ä½œç”¨</strong></a></li><li><a href=#-æ ¸å¿ƒæ–¹æ³•è§£æ>ğŸ”§ <strong>æ ¸å¿ƒæ–¹æ³•è§£æ</strong></a></li><li><a href=#-å…¸å‹ä½¿ç”¨åœºæ™¯>âš¡ <strong>å…¸å‹ä½¿ç”¨åœºæ™¯</strong></a></li><li><a href=#-å®ç°åŸç†ä¸æ ¸å¿ƒç±»>ğŸ§© <strong>å®ç°åŸç†ä¸æ ¸å¿ƒç±»</strong></a><ol><li><a href=#çŠ¶æ€ç®¡ç†æœºåˆ¶><strong>çŠ¶æ€ç®¡ç†æœºåˆ¶</strong></a></li><li><a href=#æ ¸å¿ƒå®ç°ç±»å¯¹æ¯”><strong>æ ¸å¿ƒå®ç°ç±»å¯¹æ¯”</strong></a></li></ol></li><li><a href=#-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ>âš ï¸ <strong>æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></a></li><li><a href=#-æ¼”è¿›ä¸æ›¿ä»£æ–¹æ¡ˆ>ğŸ”„ <strong>æ¼”è¿›ä¸æ›¿ä»£æ–¹æ¡ˆ</strong></a><ol><li><a href=#future-çš„å±€é™æ€§><code>Future</code> çš„å±€é™æ€§ï¼š</a></li><li><a href=#å‡çº§æ–¹æ¡ˆ><strong>å‡çº§æ–¹æ¡ˆï¼š<code>CompletableFuture</code></strong></a></li></ol></li><li><a href=#-æ€»ç»“-1>ğŸ’ <strong>æ€»ç»“</strong></a></li></ol></li><li><a href=#futuretask>FutureTask</a><ol><li><a href=#-å®ç°>ğŸ”§ <strong>å®ç° <code>Runnable</code> æ¥å£</strong></a></li><li><a href=#-å†…éƒ¨æŒæœ‰>ğŸ“¦ <strong>å†…éƒ¨æŒæœ‰ <code>Callable</code> å­—æ®µ</strong></a></li><li><a href=#-ä»»åŠ¡æ‰§è¡Œæµç¨‹>ğŸ”„ <strong>ä»»åŠ¡æ‰§è¡Œæµç¨‹</strong></a></li><li><a href=#-æ€»ç»“-2>ğŸ’ <strong>æ€»ç»“</strong></a></li></ol></li><li><a href=#completionstage>CompletionStage</a><ol><li><a href=#-æ ¸å¿ƒå®šä½ä¸è®¾è®¡æ€æƒ³>âš™ï¸ <strong>æ ¸å¿ƒå®šä½ä¸è®¾è®¡æ€æƒ³</strong></a></li><li><a href=#-æ ¸å¿ƒä»»åŠ¡æ¨¡å‹ä¸å‡½æ•°å¼æ¥å£>ğŸ§© <strong>æ ¸å¿ƒä»»åŠ¡æ¨¡å‹ä¸å‡½æ•°å¼æ¥å£</strong></a></li><li><a href=#-ä»»åŠ¡ç¼–æ’èƒ½åŠ›è¯¦è§£>â›“ï¸ <strong>ä»»åŠ¡ç¼–æ’èƒ½åŠ›è¯¦è§£</strong></a><ol><li><a href=#ä¸²è¡Œå…³ç³»sequential><strong>ä¸²è¡Œå…³ç³»ï¼ˆSequentialï¼‰</strong></a></li><li><a href=#å¹¶è¡Œç»„åˆcombination><strong>å¹¶è¡Œç»„åˆï¼ˆCombinationï¼‰</strong></a></li><li><a href=#èšåˆå…³ç³»andor><strong>èšåˆå…³ç³»ï¼ˆAND/ORï¼‰</strong></a></li><li><a href=#å¼‚å¸¸å¤„ç†><strong>å¼‚å¸¸å¤„ç†</strong></a></li></ol></li><li><a href=#-åº•å±‚å®ç°æœºåˆ¶>âš™ï¸ <strong>åº•å±‚å®ç°æœºåˆ¶</strong></a></li><li><a href=#-å…¸å‹åº”ç”¨åœºæ™¯>ğŸš€ <strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></a></li><li><a href=#-æ³¨æ„äº‹é¡¹>âš ï¸ <strong>æ³¨æ„äº‹é¡¹</strong></a></li><li><a href=#-æ€»ç»“-3>ğŸ’ <strong>æ€»ç»“</strong></a></li></ol></li><li><a href=#completablefuture>CompletableFuture</a><ol><li><a href=#-æ ¸å¿ƒç‰¹æ€§ä¸è®¾è®¡å®šä½>ğŸ”§ <strong>æ ¸å¿ƒç‰¹æ€§ä¸è®¾è®¡å®šä½</strong></a></li><li><a href=#-æ ¸å¿ƒ-api-è¯¦è§£>âš™ï¸ <strong>æ ¸å¿ƒ API è¯¦è§£</strong></a><ol><li><a href=#åˆ›å»ºå¼‚æ­¥ä»»åŠ¡><strong>åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</strong></a></li><li><a href=#é“¾å¼å›è°ƒæ–¹æ³•><strong>é“¾å¼å›è°ƒæ–¹æ³•</strong></a></li><li><a href=#å¤šä»»åŠ¡ç»„åˆ><strong>å¤šä»»åŠ¡ç»„åˆ</strong></a></li><li><a href=#å¼‚å¸¸å¤„ç†-1><strong>å¼‚å¸¸å¤„ç†</strong></a></li></ol></li><li><a href=#-å…¸å‹åº”ç”¨åœºæ™¯-1>âš¡ <strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></a></li><li><a href=#-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ-1>âš ï¸ <strong>æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></a></li><li><a href=#-ä¸ä¼ ç»Ÿ-future-çš„æ ¸å¿ƒå·®å¼‚>ğŸ’ <strong>ä¸ä¼ ç»Ÿ Future çš„æ ¸å¿ƒå·®å¼‚</strong></a></li><li><a href=#-ç»¼åˆåº”ç”¨ç¤ºä¾‹>ğŸš€ <strong>ç»¼åˆåº”ç”¨ç¤ºä¾‹</strong></a></li><li><a href=#-æ€»ç»“-4>ğŸ’¡ <strong>æ€»ç»“</strong></a></li></ol></li><li><a href=#executor-vs-executorservice>Executor vs. ExecutorService</a><ol><li><a href=#-æ¥å£å±‚çº§ä¸è®¾è®¡å®šä½>ğŸ”§ <strong>æ¥å£å±‚çº§ä¸è®¾è®¡å®šä½</strong></a></li><li><a href=#-æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”>âš™ï¸ <strong>æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”</strong></a><ol><li><a href=#ä»»åŠ¡æäº¤æ–¹å¼><strong>ä»»åŠ¡æäº¤æ–¹å¼</strong></a></li><li><a href=#ç”Ÿå‘½å‘¨æœŸç®¡ç†><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></a></li><li><a href=#æ‰¹é‡ä»»åŠ¡ä¸é«˜çº§æ§åˆ¶><strong>æ‰¹é‡ä»»åŠ¡ä¸é«˜çº§æ§åˆ¶</strong></a></li></ol></li><li><a href=#-é€‚ç”¨åœºæ™¯åˆ†æ>ğŸ§© <strong>é€‚ç”¨åœºæ™¯åˆ†æ</strong></a></li><li><a href=#-ç”Ÿäº§å®è·µæ³¨æ„äº‹é¡¹>âš ï¸ <strong>ç”Ÿäº§å®è·µæ³¨æ„äº‹é¡¹</strong></a></li><li><a href=#-æ€»ç»“æ ¸å¿ƒå·®å¼‚å…¨æ™¯å›¾>ğŸ’ <strong>æ€»ç»“ï¼šæ ¸å¿ƒå·®å¼‚å…¨æ™¯å›¾</strong></a></li></ol></li><li><a href=#executors>Executors</a><ol><li><a href=#-executors-çš„æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„å®šä½>ğŸ”§ <strong>Executors çš„æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„å®šä½</strong></a></li><li><a href=#-executors-æä¾›çš„çº¿ç¨‹æ± ç±»å‹åŠç‰¹ç‚¹>ğŸ§© <strong>Executors æä¾›çš„çº¿ç¨‹æ± ç±»å‹åŠç‰¹ç‚¹</strong></a></li><li><a href=#-é€‚ç”¨åœºæ™¯åˆ†æ-1>âš¡ <strong>é€‚ç”¨åœºæ™¯åˆ†æ</strong></a></li><li><a href=#-åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹>ğŸ’» <strong>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</strong></a><ol><li><a href=#å›ºå®šçº¿ç¨‹æ± å¤„ç†å¹¶å‘ä»»åŠ¡><strong>å›ºå®šçº¿ç¨‹æ± å¤„ç†å¹¶å‘ä»»åŠ¡</strong></a></li><li><a href=#å®šæ—¶ä»»åŠ¡è°ƒåº¦><strong>å®šæ—¶ä»»åŠ¡è°ƒåº¦</strong></a></li><li><a href=#è·å–å¼‚æ­¥ç»“æœfuture><strong>è·å–å¼‚æ­¥ç»“æœï¼ˆFutureï¼‰</strong></a></li></ol></li><li><a href=#-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ-2>âš ï¸ <strong>æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></a></li><li><a href=#-æ€»ç»“-5>ğŸ’ <strong>æ€»ç»“</strong></a></li></ol></li><li><a href=#è‡ªå®šä¹‰-threadpool>è‡ªå®šä¹‰ ThreadPool</a><ol><li><a href=#-æ ¸å¿ƒå‚æ•°é…ç½®7å¤§æ ¸å¿ƒå‚æ•°>ğŸ”§ æ ¸å¿ƒå‚æ•°é…ç½®ï¼ˆ7å¤§æ ¸å¿ƒå‚æ•°ï¼‰</a></li><li><a href=#-å®Œæ•´é…ç½®ç¤ºä¾‹>âš™ï¸ å®Œæ•´é…ç½®ç¤ºä¾‹</a></li><li><a href=#-é«˜çº§ä¼˜åŒ–æŠ€å·§>ğŸ› ï¸ é«˜çº§ä¼˜åŒ–æŠ€å·§</a></li><li><a href=#-ç”Ÿäº§ç¯å¢ƒå»ºè®®>âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/temple/ style=background-color:#69a794;color:>ç™½ç‰äº¬</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/javarunnable/>ã€Javaã€‘Runnable</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 19, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><h2 id=callable--runnable>Callable & Runnable</h2><p>åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œ<code>Runnable</code>å’Œ<code>Callable</code>æ˜¯å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„ä¸¤ç§æ ¸å¿ƒæ¥å£ï¼Œå®ƒä»¬çš„è®¾è®¡ç›®çš„å’ŒåŠŸèƒ½æœ‰æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ï¼š</p><hr><h3 id=-æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼>âš™ï¸ <strong>æ–¹æ³•å®šä¹‰ä¸è¿”å›å€¼</strong></h3><ul><li><strong><code>Runnable</code></strong><ul><li>å®šä¹‰å•ä¸€æ–¹æ³• <code>run()</code>ï¼Œè¿”å›ç±»å‹ä¸º <code>void</code>ï¼Œ<strong>ä¸è¿”å›ä»»ä½•ç»“æœ</strong>ã€‚</li><li>ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•ã€å¼‚æ­¥é€šçŸ¥ç­‰æ— éœ€è¿”å›å€¼çš„ä»»åŠ¡ã€‚</li></ul><pre tabindex=0><code>Runnable task = () -&gt; System.out.println(&#34;Task executed&#34;);
</code></pre></li><li><strong><code>Callable</code></strong><ul><li>å®šä¹‰æ–¹æ³• <code>call()</code>ï¼Œ<strong>æ”¯æŒæ³›å‹è¿”å›å€¼</strong>ï¼ˆå¦‚ <code>Callable&lt;Integer></code> è¿”å›æ•´æ•°ï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼šè®¡ç®—é˜¶ä¹˜ã€æ•°æ®åº“æŸ¥è¯¢ç­‰éœ€è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li></ul><pre tabindex=0><code>Callable&lt;Integer&gt; task = () -&gt; { return 42; };
</code></pre></li></ul><hr><h3 id=-å¼‚å¸¸å¤„ç†æœºåˆ¶>âš ï¸ <strong>å¼‚å¸¸å¤„ç†æœºåˆ¶</strong></h3><ul><li><strong><code>Runnable</code></strong><ul><li><code>run()</code> <strong>ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆchecked exceptionï¼‰</strong>ï¼Œåªèƒ½åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ <code>try-catch</code> å¤„ç†ã€‚</li></ul><pre tabindex=0><code>Runnable task = () -&gt; {
    try { Thread.sleep(1000); } 
    catch (InterruptedException e) { e.printStackTrace(); }
};
</code></pre></li><li><strong><code>Callable</code></strong><ul><li><code>call()</code> <strong>å¯æŠ›å‡ºå—æ£€å¼‚å¸¸</strong>ï¼ˆå¦‚ <code>throws Exception</code>ï¼‰ï¼Œå¼‚å¸¸ä¼šå°è£…åœ¨ <code>Future.get()</code> æŠ›å‡ºçš„ <code>ExecutionException</code> ä¸­ï¼Œå¯é€šè¿‡ <code>getCause()</code> è·å–åŸå§‹å¼‚å¸¸ã€‚</li></ul><pre tabindex=0><code>Callable&lt;Integer&gt; task = () -&gt; { 
    if (invalid) throw new Exception(&#34;Error&#34;);
    return result;
};
</code></pre></li></ul><hr><h3 id=-æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§>ğŸ”Œ <strong>æ‰§è¡Œæ–¹å¼ä¸çº¿ç¨‹æ± å…¼å®¹æ€§</strong></h3><ul><li><strong><code>Runnable</code></strong><ul><li>å¯é€šè¿‡ <code>Thread</code> ç±»ç›´æ¥å¯åŠ¨ï¼ˆ<code>new Thread(runnable).start()</code>ï¼‰æˆ–æäº¤ç»™ <code>ExecutorService</code>ã€‚</li><li>æäº¤åè¿”å› <code>Future&lt;?></code>ï¼Œä½† <code>get()</code> å§‹ç»ˆè¿”å› <code>null</code>ã€‚</li></ul></li><li><strong><code>Callable</code></strong><ul><li><strong>å¿…é¡»é€šè¿‡ <code>ExecutorService.submit()</code> æäº¤</strong>ï¼Œè¿”å› <code>Future&lt;V></code> å¯¹è±¡ï¼Œç”¨äºè·å–ç»“æœæˆ–å¼‚å¸¸ã€‚</li><li>æ— æ³•ç›´æ¥é€šè¿‡ <code>Thread</code> ç±»å¯åŠ¨ï¼Œéœ€å€ŸåŠ© <code>FutureTask</code> åŒ…è£…ï¼ˆ<code>new Thread(new FutureTask&lt;>(callable)).start()</code>ï¼‰ã€‚</li></ul></li></ul><hr><h3 id=-ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨>ğŸ“Š <strong>ä¸»è¦åŒºåˆ«å¯¹æ¯”è¡¨</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Runnable</strong></th><th><strong>Callable</strong></th></tr></thead><tbody><tr><td><strong>è¿”å›å€¼</strong></td><td>âŒ æ— </td><td>âœ… æ”¯æŒæ³›å‹è¿”å›å€¼</td></tr><tr><td><strong>å¼‚å¸¸å¤„ç†</strong></td><td>âŒ ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸</td><td>âœ… å¯æŠ›å‡ºå—æ£€å¼‚å¸¸</td></tr><tr><td><strong>æ‰§è¡Œæ–¹å¼</strong></td><td>âœ… æ”¯æŒ<code>Thread</code>æˆ–çº¿ç¨‹æ± </td><td>âŒ ä»…æ”¯æŒçº¿ç¨‹æ± æäº¤</td></tr><tr><td><strong>ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª</strong></td><td>âš ï¸ ä»…èƒ½åˆ¤æ–­æ˜¯å¦å®Œæˆï¼ˆ<code>Future.isDone()</code>ï¼‰</td><td>âœ… å¯è·å–ç»“æœã€å¼‚å¸¸åŠå–æ¶ˆä»»åŠ¡</td></tr><tr><td><strong>å¼•å…¥ç‰ˆæœ¬</strong></td><td>Java 1.0</td><td>Java 5ï¼ˆ<code>java.util.concurrent</code>åŒ…ï¼‰</td></tr></tbody></table></div><hr><h3 id=-çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å–>ğŸ§© <strong>çº¿ç¨‹çŠ¶æ€ç›‘æ§ä¸ç»“æœè·å–</strong></h3><ul><li><strong><code>Runnable</code></strong><ul><li>é€šè¿‡ <code>Future.isDone()</code> åˆ¤æ–­ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œä½†æ— æ³•è·å–ç»“æœæˆ–å¼‚å¸¸è¯¦æƒ…ã€‚</li></ul></li><li><strong><code>Callable</code></strong><ul><li>é€šè¿‡ <code>Future.get()</code> <strong>é˜»å¡è·å–ç»“æœ</strong>ï¼Œæ”¯æŒè¶…æ—¶è®¾ç½®ï¼ˆ<code>get(long timeout, TimeUnit unit)</code>ï¼‰ã€‚</li><li>å¯æ•è· <code>ExecutionException</code> å¤„ç†ä»»åŠ¡å†…éƒ¨å¼‚å¸¸ï¼Œæˆ–é€šè¿‡ <code>Future.cancel()</code> å–æ¶ˆä»»åŠ¡ã€‚</li></ul></li></ul><hr><h3 id=-é€‚ç”¨åœºæ™¯>ğŸ’¡ <strong>é€‚ç”¨åœºæ™¯</strong></h3><ul><li><strong><code>Runnable</code></strong>ï¼š
ç®€å•å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚äº‹ä»¶æ—¥å¿—ã€çº¿ç¨‹æ± åŸºç¡€ä»»åŠ¡ï¼‰ã€‚</li><li><strong><code>Callable</code></strong>ï¼š
éœ€è¿”å›ç»“æœæˆ–ä¸¥æ ¼å¼‚å¸¸å¤„ç†çš„ä»»åŠ¡ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—ã€IOæ“ä½œï¼‰ã€‚</li></ul><hr><h3 id=-ä»£ç ç¤ºä¾‹å¯¹æ¯”>ğŸ“ <strong>ä»£ç ç¤ºä¾‹å¯¹æ¯”</strong></h3><pre tabindex=0><code>// Runnableç¤ºä¾‹
ExecutorService executor = Executors.newSingleThreadExecutor();
Future&lt;?&gt; futureRunnable = executor.submit(() -&gt; System.out.println(&#34;Runnable&#34;));
futureRunnable.get(); // è¿”å›null

// Callableç¤ºä¾‹
Future&lt;Integer&gt; futureCallable = executor.submit(() -&gt; { 
    return 100; 
});
Integer result = futureCallable.get(); // è¿”å›100
</code></pre><hr><h3 id=-æ€»ç»“>ğŸ’ <strong>æ€»ç»“</strong></h3><p><code>Runnable</code>æ˜¯è½»é‡çº§å¼‚æ­¥ä»»åŠ¡çš„åŸºç¡€æ¥å£ï¼Œè€Œ<code>Callable</code>é€šè¿‡è¿”å›å€¼ã€å¼‚å¸¸ä¼ é€’å’Œ<code>Future</code>äº¤äº’æœºåˆ¶ï¼Œæ‰©å±•äº†å¤æ‚ä»»åŠ¡çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚é€‰æ‹©ä¾æ®ï¼š</p><ul><li>æ— éœ€ç»“æœ â†’ <code>Runnable</code>ï¼›</li><li>éœ€ç»“æœ/å¼‚å¸¸æ§åˆ¶ â†’ <code>Callable</code>ã€‚</li></ul><h2 id=future>Future</h2><p>ä»¥ä¸‹æ˜¯å…³äº Java ä¸­ <code>Future</code> æ¥å£çš„è¯¦ç»†è§£æï¼Œç»“åˆå…¶æ ¸å¿ƒç‰¹æ€§ã€å®ç°åŸç†ã€ä½¿ç”¨åœºæ™¯åŠæ³¨æ„äº‹é¡¹è¿›è¡Œç³»ç»Ÿæ€§è¯´æ˜ï¼š</p><hr><h3 id=-future-çš„æ ¸å¿ƒå®šä½ä¸ä½œç”¨>âš™ï¸ <strong>Future çš„æ ¸å¿ƒå®šä½ä¸ä½œç”¨</strong></h3><p><code>Future</code> æ˜¯ Java å¹¶å‘ç¼–ç¨‹ä¸­<strong>å¼‚æ­¥è®¡ç®—ç»“æœçš„å®¹å™¨</strong>ï¼ˆä½äº <code>java.util.concurrent</code> åŒ…ï¼‰ï¼Œä»£è¡¨ä¸€ä¸ªå°šæœªå®Œæˆçš„å¼‚æ­¥ä»»åŠ¡çš„ç»“æœã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</p><ul><li><strong>è§£è€¦ä»»åŠ¡æäº¤ä¸ç»“æœè·å–</strong>ï¼šä¸»çº¿ç¨‹æäº¤ä»»åŠ¡åç»§ç»­æ‰§è¡Œå…¶ä»–é€»è¾‘ï¼Œé€šè¿‡ <code>Future</code> åœ¨éœ€è¦æ—¶è·å–ç»“æœã€‚</li><li><strong>ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong>ï¼šæ”¯æŒå–æ¶ˆä»»åŠ¡ã€æ£€æŸ¥å®ŒæˆçŠ¶æ€åŠè¶…æ—¶æœºåˆ¶ã€‚</li></ul><blockquote><p>ğŸ’¡ <strong>åŒæ­¥ vs. å¼‚æ­¥çš„ç›´è§‚å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>åŒæ­¥</strong>ï¼šç±»ä¼¼æ‰“ç”µè¯ï¼Œå¿…é¡»ç­‰å¾…å¯¹æ–¹æ¥é€šæ‰èƒ½é€šä¿¡ï¼ˆä¸»çº¿ç¨‹é˜»å¡ï¼‰ã€‚</li><li><strong>å¼‚æ­¥</strong>ï¼šç±»ä¼¼å¹¿æ’­ï¼Œå‘é€åæ— éœ€ç­‰å¾…å›å¤ï¼ˆä¸»çº¿ç¨‹éé˜»å¡ï¼‰ã€‚</li></ul></blockquote><hr><h3 id=-æ ¸å¿ƒæ–¹æ³•è§£æ>ğŸ”§ <strong>æ ¸å¿ƒæ–¹æ³•è§£æ</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>åŠŸèƒ½è¯´æ˜</strong></th></tr></thead><tbody><tr><td><code>boolean cancel(boolean mayInterruptIfRunning)</code></td><td>å°è¯•å–æ¶ˆä»»åŠ¡ã€‚<code>mayInterruptIfRunning=true</code> æ—¶ï¼Œå¯ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚</td></tr><tr><td><code>boolean isCancelled()</code></td><td>æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆï¼ˆæ­£å¸¸å®Œæˆå‰å–æ¶ˆè¿”å› <code>true</code>ï¼‰ã€‚</td></tr><tr><td><code>boolean isDone()</code></td><td>æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆï¼ˆå«æ­£å¸¸ç»“æŸã€å¼‚å¸¸ç»ˆæ­¢æˆ–å–æ¶ˆï¼‰ã€‚</td></tr><tr><td><code>V get()</code></td><td><strong>é˜»å¡</strong>ç›´åˆ°ä»»åŠ¡å®Œæˆå¹¶è¿”å›ç»“æœï¼Œè‹¥ä»»åŠ¡æŠ›å‡ºå¼‚å¸¸åˆ™å°è£…ä¸º <code>ExecutionException</code>ã€‚</td></tr><tr><td><code>V get(long timeout, TimeUnit unit)</code></td><td>å¸¦è¶…æ—¶çš„ç»“æœè·å–ï¼Œè¶…æ—¶æŠ›å‡º <code>TimeoutException</code>ã€‚</td></tr></tbody></table></div><blockquote><p>âš ï¸ <strong>å…³é”®è¡Œä¸ºè¯´æ˜</strong>ï¼š</p><ul><li><strong>é˜»å¡æ€§</strong>ï¼š<code>get()</code> æ–¹æ³•ä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œç›´è‡³ä»»åŠ¡å®Œæˆæˆ–è¶…æ—¶ã€‚</li><li><strong>å¼‚å¸¸ä¼ é€’</strong>ï¼šä»»åŠ¡ä¸­çš„å¼‚å¸¸é€šè¿‡ <code>ExecutionException</code> æŠ›å‡ºï¼Œéœ€è°ƒç”¨ <code>e.getCause()</code> è·å–åŸå§‹å¼‚å¸¸ã€‚</li></ul></blockquote><hr><h3 id=-å…¸å‹ä½¿ç”¨åœºæ™¯>âš¡ <strong>å…¸å‹ä½¿ç”¨åœºæ™¯</strong></h3><ol><li><strong>å¹¶è¡Œè®¡ç®—</strong>
å°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œé€šè¿‡ <code>Future</code> åˆ—è¡¨ç»Ÿä¸€æ”¶é›†ç»“æœï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ExecutorService</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Executors</span><span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=n>4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Future</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>futures</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>futures</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>compute</span><span class=p>(</span><span class=n>i</span><span class=p>)));</span><span class=w> </span><span class=c1>// æäº¤ä»»åŠ¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Future</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>futures</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Integer</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w> </span><span class=c1>// æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>executor</span><span class=p>.</span><span class=na>shutdown</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><strong>ä¼˜åŠ¿</strong>ï¼šæ€»è€—æ—¶ â‰ˆ æœ€æ…¢å­ä»»åŠ¡çš„è€—æ—¶ï¼Œæ˜¾è‘—æå‡æ•ˆç‡ã€‚</li><li><strong>å¼‚æ­¥ I/O æ“ä½œ</strong>
å¦‚ç½‘ç»œè¯·æ±‚æˆ–æ–‡ä»¶è¯»å†™ï¼Œä¸»çº¿ç¨‹æäº¤ä»»åŠ¡åç«‹å³è¿”å›ï¼Œé€šè¿‡ <code>Future</code> åç»­è·å–å“åº”ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>responseFuture</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>httpClient</span><span class=p>.</span><span class=na>fetchData</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ... ä¸»çº¿ç¨‹æ‰§è¡Œå…¶ä»–é€»è¾‘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>responseFuture</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>);</span><span class=w> </span><span class=c1>// è¶…æ—¶æ§åˆ¶</span><span class=w>
</span></span></span></code></pre></div></li><li><strong>ä»»åŠ¡å–æ¶ˆä¸è¶…æ—¶æ§åˆ¶</strong><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>longRunningOperation</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>task</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>500</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>);</span><span class=w> </span><span class=c1>// è¶…æ—¶è®¾ç½®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>TimeoutException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>task</span><span class=p>.</span><span class=na>cancel</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w> </span><span class=c1>// ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li></ol><hr><h3 id=-å®ç°åŸç†ä¸æ ¸å¿ƒç±»>ğŸ§© <strong>å®ç°åŸç†ä¸æ ¸å¿ƒç±»</strong></h3><h4 id=çŠ¶æ€ç®¡ç†æœºåˆ¶><strong>çŠ¶æ€ç®¡ç†æœºåˆ¶</strong></h4><p><code>FutureTask</code>ï¼ˆ<code>Future</code> çš„æ ¸å¿ƒå®ç°ç±»ï¼‰é€šè¿‡ 7 ç§çŠ¶æ€ç®¡ç†ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼š</p><pre tabindex=0><code>private static final int NEW = 0;          // æ–°å»º
private static final int COMPLETING = 1;    // å®Œæˆä¸­ï¼ˆç»“æœå³å°†è®¾ç½®ï¼‰
private static final int NORMAL = 2;       // æ­£å¸¸å®Œæˆ
private static final int EXCEPTIONAL = 3;  // å¼‚å¸¸ç»“æŸ
private static final int CANCELLED = 4;    // å·²å–æ¶ˆ
private static final int INTERRUPTING = 5; // ä¸­æ–­ä¸­
private static final int INTERRUPTED = 6;  // å·²ä¸­æ–­
</code></pre><p>çŠ¶æ€è½¬æ¢é€šè¿‡ <strong>CASï¼ˆCompare-And-Swapï¼‰</strong> ä¿è¯åŸå­æ€§ã€‚</p><h4 id=æ ¸å¿ƒå®ç°ç±»å¯¹æ¯”><strong>æ ¸å¿ƒå®ç°ç±»å¯¹æ¯”</strong></h4><div class=table-wrapper><table><thead><tr><th><strong>ç±»å</strong></th><th><strong>ç‰¹ç‚¹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong><code>FutureTask</code></strong></td><td>åŒæ—¶å®ç° <code>Runnable</code> å’Œ <code>Future</code>ï¼Œå¯ç›´æ¥æäº¤ç»™ <code>Thread</code> æˆ–çº¿ç¨‹æ± æ‰§è¡Œã€‚</td><td>éœ€æ‰‹åŠ¨ç®¡ç†ä»»åŠ¡æ‰§è¡Œä¸ç»“æœè·å–çš„ç®€å•åœºæ™¯ã€‚</td></tr><tr><td><strong><code>CompletableFuture</code></strong></td><td>Java 8+ å¼•å…¥ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ã€ç»„åˆä»»åŠ¡ã€å¼‚å¸¸å›è°ƒï¼ˆéé˜»å¡ï¼‰ã€‚</td><td>å¤æ‚å¼‚æ­¥æµç¨‹ï¼ˆå¦‚å¤šä¸ªä»»åŠ¡ä¾èµ–ã€ç»“æœè½¬æ¢ï¼‰ã€‚</td></tr><tr><td><strong><code>ScheduledFuture</code></strong></td><td>æ‰©å±•å»¶è¿Ÿ/å‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦èƒ½åŠ›ï¼ˆéœ€é…åˆ <code>ScheduledExecutorService</code>ï¼‰ã€‚</td><td>å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚å¿ƒè·³æ£€æµ‹ã€å‘¨æœŸæ•°æ®åŒæ­¥ï¼‰ã€‚</td></tr></tbody></table></div><blockquote><p>ğŸŒ° <strong><code>FutureTask</code> ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>FutureTask</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>futureTask</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FutureTask</span><span class=o>&lt;&gt;</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>42</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>futureTask</span><span class=p>).</span><span class=na>start</span><span class=p>();</span><span class=w> </span><span class=c1>// ç›´æ¥å¯åŠ¨çº¿ç¨‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æˆ–æäº¤è‡³çº¿ç¨‹æ± ï¼šexecutor.submit(futureTask);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Integer</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>futureTask</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w> </span><span class=c1>// é˜»å¡è·å–ç»“æœ</span><span class=w>
</span></span></span></code></pre></div></blockquote><hr><h3 id=-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ>âš ï¸ <strong>æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></h3><ol><li><strong>çº¿ç¨‹æ± å…³é—­</strong>
åŠ¡å¿…è°ƒç”¨ <code>executor.shutdown()</code>ï¼Œé¿å…çº¿ç¨‹æ³„æ¼ã€‚</li><li>å¼‚å¸¸å¤„ç†</li><li>ä»»åŠ¡å†…éƒ¨å¼‚å¸¸ä¸ä¼šè‡ªåŠ¨ä¼ æ’­ï¼Œå¿…é¡»é€šè¿‡<pre tabindex=0><code>Future.get() 
</code></pre>æ•è·<pre tabindex=0><code>ExecutionException 
</code></pre>å¹¶è§£æï¼š<pre tabindex=0><code>try {
    future.get();
} catch (ExecutionException e) {
    Throwable realCause = e.getCause(); // è·å–åŸå§‹å¼‚å¸¸
}
</code></pre></li><li>é¿å…æ°¸ä¹…é˜»å¡<ul><li>å§‹ç»ˆä½¿ç”¨å¸¦è¶…æ—¶çš„ <code>get(long timeout, TimeUnit unit)</code>ã€‚</li><li>ç»“åˆ <code>isDone()</code> è½®è¯¢æ£€æŸ¥çŠ¶æ€ï¼ˆéå®æ—¶ï¼Œéœ€æƒè¡¡æ€§èƒ½ï¼‰ã€‚</li></ul></li><li>èµ„æºç«äº‰ä¼˜åŒ–<ul><li>CPU å¯†é›†å‹ä»»åŠ¡ â†’ å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼ˆ<code>newFixedThreadPool</code>ï¼‰ã€‚</li><li>I/O å¯†é›†å‹ä»»åŠ¡ â†’ ç¼“å­˜çº¿ç¨‹æ± ï¼ˆ<code>newCachedThreadPool</code>ï¼‰ã€‚</li></ul></li></ol><hr><h3 id=-æ¼”è¿›ä¸æ›¿ä»£æ–¹æ¡ˆ>ğŸ”„ <strong>æ¼”è¿›ä¸æ›¿ä»£æ–¹æ¡ˆ</strong></h3><h4 id=future-çš„å±€é™æ€§><code>Future</code> çš„å±€é™æ€§ï¼š</h4><ul><li><strong>é˜»å¡å¼è·å–ç»“æœ</strong>ï¼š<code>get()</code> å¯¼è‡´çº¿ç¨‹èµ„æºæµªè´¹ã€‚</li><li><strong>ç»„åˆèƒ½åŠ›å¼±</strong>ï¼šå¤šä»»åŠ¡ä¾èµ–éœ€æ‰‹åŠ¨åè°ƒï¼ˆåµŒå¥— <code>get()</code> ä»£ç è‡ƒè‚¿ï¼‰ã€‚</li></ul><h4 id=å‡çº§æ–¹æ¡ˆ><strong>å‡çº§æ–¹æ¡ˆï¼š<code>CompletableFuture</code></strong></h4><p>æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ï¼Œå®ç°éé˜»å¡é“¾å¼è°ƒç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>CompletableFuture</span><span class=p>.</span><span class=na>supplyAsync</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;Hello&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>thenApplyAsync</span><span class=p>(</span><span class=n>s</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; World&#34;</span><span class=p>)</span><span class=w>    </span><span class=c1>// å¼‚æ­¥ç»“æœè½¬æ¢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>exceptionally</span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;Fallback&#34;</span><span class=p>)</span><span class=w>       </span><span class=c1>// å¼‚å¸¸å¤„ç†</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>thenAccept</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>     </span><span class=c1>// æ¶ˆè´¹ç»“æœ</span><span class=w>
</span></span></span></code></pre></div><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li><strong>ä»»åŠ¡ç»„åˆ</strong>ï¼š<code>thenCombine()</code>ã€<code>allOf()</code> ç­‰åè°ƒå¤šä»»åŠ¡ã€‚</li><li><strong>å›è°ƒæœºåˆ¶</strong>ï¼šå®Œæˆæ—¶è‡ªåŠ¨è§¦å‘åç»­æ“ä½œï¼ˆæ— éœ€é˜»å¡ç­‰å¾…ï¼‰ã€‚</li></ul><hr><h3 id=-æ€»ç»“-1>ğŸ’ <strong>æ€»ç»“</strong></h3><p><code>Future</code> æ˜¯ Java å¹¶å‘ç¼–ç¨‹çš„<strong>åŸºç¡€å¼‚æ­¥æ§åˆ¶å•å…ƒ</strong>ï¼Œé€‚ç”¨äºç®€å•å¼‚æ­¥åœºæ™¯ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š
âœ… â€‹<strong>ç»“æœå®¹å™¨</strong>â€‹ï¼šå°è£…å¼‚æ­¥è®¡ç®—ç»“æœæˆ–å¼‚å¸¸ã€‚
âœ… â€‹<strong>ä»»åŠ¡æ§åˆ¶</strong>â€‹ï¼šå–æ¶ˆã€çŠ¶æ€æŸ¥è¯¢ä¸è¶…æ—¶ç®¡ç†ã€‚
âœ… â€‹<strong>çº¿ç¨‹æ± é›†æˆ</strong>â€‹ï¼šä¸ <code>ExecutorService</code> æ— ç¼åä½œã€‚
<strong>æ¼”è¿›æ–¹å‘</strong>ï¼š</p><ul><li>ç®€å•ä»»åŠ¡ â†’ <code>Future</code> + çº¿ç¨‹æ± ã€‚</li><li>å¤æ‚å¼‚æ­¥æµ â†’ <code>CompletableFuture</code> æˆ–å“åº”å¼æ¡†æ¶ï¼ˆå¦‚ RxJavaï¼‰ã€‚
â€‹<strong>ç”Ÿäº§å»ºè®®</strong>â€‹ï¼š
âš ï¸ é¿å…æ— ç•Œé˜Ÿåˆ—å¯¼è‡´çš„ OOMï¼ˆä¼˜å…ˆè‡ªå®šä¹‰ <code>ThreadPoolExecutor</code>ï¼‰ã€‚
âš ï¸ è¶…æ—¶è®¾ç½®ä¸å¼‚å¸¸å¤„ç†æ˜¯ä¿éšœç³»ç»Ÿå¥å£®æ€§çš„å…³é”®ã€‚</li></ul><h2 id=futuretask>FutureTask</h2><p>æ˜¯çš„ï¼Œ<code>FutureTask</code> ç¡®å®<strong>å®ç°äº† <code>Runnable</code> æ¥å£</strong>ï¼Œå¹¶ä¸”<strong>å†…éƒ¨æŒæœ‰ä¸€ä¸ª <code>Callable</code> ç±»å‹çš„å­—æ®µ</strong>ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š</p><hr><h3 id=-å®ç°>ğŸ”§ <strong>å®ç° <code>Runnable</code> æ¥å£</strong></h3><p><code>FutureTask</code> å®ç°äº† <code>RunnableFuture</code> æ¥å£ï¼Œè€Œ <code>RunnableFuture</code> åŒæ—¶ç»§æ‰¿äº† <code>Runnable</code> å’Œ <code>Future</code> æ¥å£ã€‚å› æ­¤ï¼š</p><ul><li>âœ… <strong>å¯ä½œä¸º <code>Runnable</code> ä½¿ç”¨</strong>ï¼š<code>FutureTask</code> å¯ä»¥ç›´æ¥ä¼ é€’ç»™ <code>Thread</code> æ„é€ å‡½æ•°æˆ–æäº¤ç»™çº¿ç¨‹æ± ï¼ˆ<code>ExecutorService</code>ï¼‰æ‰§è¡Œã€‚</li><li>âœ… <strong>æ‰§è¡Œé€»è¾‘</strong>ï¼šå…¶ <code>run()</code> æ–¹æ³•ä¼šè°ƒç”¨å†…éƒ¨ä»»åŠ¡çš„é€»è¾‘ï¼ˆå¦‚ <code>Callable.call()</code> æˆ– <code>Runnable.run()</code>ï¼‰å¹¶å°†ç»“æœå­˜å‚¨åˆ° <code>outcome</code> å­—æ®µä¸­ã€‚</li></ul><pre tabindex=0><code>// ç¤ºä¾‹ï¼šFutureTask ä½œä¸º Runnable ä½¿ç”¨
Callable&lt;Integer&gt; task = () -&gt; 123;
FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(task);
Thread thread = new Thread(futureTask);  // ç›´æ¥ä¼ é€’ç»™ Thread
thread.start();
</code></pre><hr><h3 id=-å†…éƒ¨æŒæœ‰>ğŸ“¦ <strong>å†…éƒ¨æŒæœ‰ <code>Callable</code> å­—æ®µ</strong></h3><p><code>FutureTask</code> çš„æ ¸å¿ƒè®¾è®¡æ˜¯<strong>ç»Ÿä¸€å°è£…ä»»åŠ¡</strong>ï¼š</p><ul><li>âœ… <strong><code>Callable</code> å­—æ®µ</strong>ï¼šæºç ä¸­å£°æ˜äº† <code>private Callable&lt;V> callable</code> å­—æ®µï¼Œç”¨äºå­˜å‚¨ä¼ å…¥çš„ä»»åŠ¡ã€‚</li><li>âœ… æ”¯æŒä¸¤ç§ä»»åŠ¡ç±»å‹ï¼š<ul><li>è‹¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ <code>Callable</code> å¯¹è±¡ï¼Œåˆ™ç›´æ¥èµ‹å€¼ç»™ <code>callable</code> å­—æ®µã€‚</li><li>è‹¥ä¼ å…¥<pre tabindex=0><code>Runnable
</code></pre>å¯¹è±¡ï¼Œä¼šé€šè¿‡<pre tabindex=0><code>Executors.callable()
</code></pre>å°†å…¶é€‚é…ä¸º<pre tabindex=0><code>Callable
</code></pre>ç±»å‹å†å­˜å‚¨ã€‚<pre tabindex=0><code>// Runnable é€‚é…ä¸º Callable çš„æºç é€»è¾‘
public FutureTask(Runnable runnable, V result) {
    this.callable = Executors.callable(runnable, result);
}
</code></pre></li></ul></li></ul><hr><h3 id=-ä»»åŠ¡æ‰§è¡Œæµç¨‹>ğŸ”„ <strong>ä»»åŠ¡æ‰§è¡Œæµç¨‹</strong></h3><p>å½“è°ƒç”¨ <code>FutureTask.run()</code> æ—¶ï¼š</p><ol><li><strong>æ‰§è¡Œ <code>callable.call()</code></strong>ï¼šè¿è¡Œä»»åŠ¡é€»è¾‘ã€‚</li><li><strong>å­˜å‚¨ç»“æœæˆ–å¼‚å¸¸</strong>ï¼šç»“æœå­˜å…¥ <code>outcome</code> å­—æ®µï¼ŒçŠ¶æ€æ›´æ–°ä¸º <code>NORMAL</code>ï¼ˆæˆåŠŸï¼‰æˆ– <code>EXCEPTIONAL</code>ï¼ˆå¼‚å¸¸ï¼‰ã€‚</li><li><strong>å”¤é†’é˜»å¡çº¿ç¨‹</strong>ï¼šé€šè¿‡ <code>get()</code> ç­‰å¾…ç»“æœçš„çº¿ç¨‹ä¼šè¢«å”¤é†’å¹¶è·å–ç»“æœã€‚</li></ol><hr><h3 id=-æ€»ç»“-2>ğŸ’ <strong>æ€»ç»“</strong></h3><ul><li>âœ… <strong>åŒé‡èº«ä»½</strong>ï¼š<code>FutureTask</code> æ—¢æ˜¯ <code>Runnable</code>ï¼ˆå¯è¢«çº¿ç¨‹æ‰§è¡Œï¼‰ï¼Œåˆæ˜¯ <code>Future</code>ï¼ˆå¯ç®¡ç†ä»»åŠ¡çŠ¶æ€å’Œç»“æœï¼‰ã€‚</li><li>âœ… <strong>ç»Ÿä¸€å°è£…</strong>ï¼šé€šè¿‡å†…éƒ¨ <code>Callable</code> å­—æ®µç»Ÿä¸€å¤„ç† <code>Callable</code> å’Œ <code>Runnable</code> ä»»åŠ¡ï¼Œç¡®ä¿æ‰§è¡Œé€»è¾‘çš„ä¸€è‡´æ€§ã€‚</li><li>âœ… <strong>å…¸å‹åº”ç”¨åœºæ™¯</strong>ï¼šéœ€å¼‚æ­¥æ‰§è¡Œä¸”è·å–ç»“æœçš„ä»»åŠ¡ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—ã€IO æ“ä½œï¼‰ï¼Œæˆ–éœ€å–æ¶ˆä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯ã€‚</li></ul><h2 id=completionstage>CompletionStage</h2><p>CompletionStage æ˜¯ Java 8 å¼•å…¥çš„æ ¸å¿ƒå¼‚æ­¥ç¼–ç¨‹æ¥å£ï¼ˆä½äº <code>java.util.concurrent</code> åŒ…ï¼‰ï¼Œç”¨äºæè¿°å¼‚æ­¥è®¡ç®—ä¸­çš„ä¸€ä¸ª<strong>é˜¶æ®µæ€§ä»»åŠ¡</strong>ï¼Œæ”¯æŒä»»åŠ¡ä¹‹é—´çš„é“¾å¼ç»„åˆå’Œç»“æœä¼ é€’ã€‚å®ƒé€šè¿‡å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹è§£å†³äº†ä¼ ç»Ÿ <code>Future</code> çš„é˜»å¡è°ƒç”¨å’Œä»»åŠ¡ç¼–æ’éš¾é¢˜ï¼Œæ˜¯ <code>CompletableFuture</code> çš„åº•å±‚è®¾è®¡åŸºç¡€ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§åˆ°å®è·µåº”ç”¨å±•å¼€è¯¦è§£ï¼š</p><hr><h3 id=-æ ¸å¿ƒå®šä½ä¸è®¾è®¡æ€æƒ³>âš™ï¸ <strong>æ ¸å¿ƒå®šä½ä¸è®¾è®¡æ€æƒ³</strong></h3><ol><li>é˜¶æ®µåŒ–ä»»åŠ¡æŠ½è±¡<ul><li>ä¸€ä¸ªå¼‚æ­¥è®¡ç®—æµç¨‹å¯æ‹†åˆ†ä¸ºå¤šä¸ªç›¸äº’ä¾èµ–çš„ <code>CompletionStage</code> å­ä»»åŠ¡ï¼Œå½¢æˆ<strong>ä»»åŠ¡æµæ°´çº¿</strong>ã€‚</li><li>æ¯ä¸ªé˜¶æ®µå°è£…ä¸€ä¸ªæ“ä½œï¼ˆå¦‚ <code>Function</code>ã€<code>Consumer</code>ï¼‰ï¼Œå¹¶å®šä¹‰å…¶è¾“å…¥/è¾“å‡ºè¡Œä¸ºã€‚</li></ul></li><li>éé˜»å¡å›è°ƒæœºåˆ¶<ul><li>é€šè¿‡ <code>thenApply</code>ã€<code>thenAccept</code> ç­‰æ–¹æ³•æ³¨å†Œå›è°ƒï¼Œä»»åŠ¡å®Œæˆåè‡ªåŠ¨è§¦å‘åç»­æ“ä½œï¼Œ<strong>æ— éœ€é˜»å¡ç­‰å¾…</strong>ã€‚</li></ul></li><li>æ—¶åºå…³ç³»æè¿°<ul><li>æ˜ç¡®è¡¨è¾¾ä»»åŠ¡é—´çš„<strong>ä¸²è¡Œã€å¹¶è¡Œã€èšåˆï¼ˆAND/ORï¼‰</strong> å…³ç³»ï¼Œå®ç°å£°æ˜å¼ç¼–æ’ã€‚</li></ul></li></ol><hr><h3 id=-æ ¸å¿ƒä»»åŠ¡æ¨¡å‹ä¸å‡½æ•°å¼æ¥å£>ğŸ§© <strong>æ ¸å¿ƒä»»åŠ¡æ¨¡å‹ä¸å‡½æ•°å¼æ¥å£</strong></h3><p><code>CompletionStage</code> å­ä»»åŠ¡çš„æ“ä½œç±»å‹ç”±å‡½æ•°å¼æ¥å£å†³å®šï¼Œåˆ†ä¸ºä¸‰ç±»ï¼š</p><div class=table-wrapper><table><thead><tr><th><strong>å‡½æ•°å¼æ¥å£</strong></th><th><strong>ç‰¹ç‚¹</strong></th><th><strong>å›è°ƒæ–¹æ³•ç¤ºä¾‹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong><code>Function&lt;T,R></code></strong></td><td>æœ‰è¾“å…¥ã€æœ‰è¾“å‡º</td><td><code>thenApply(fn)</code></td><td>æ•°æ®è½¬æ¢ï¼ˆå¦‚å­—ç¬¦ä¸²å¤„ç†ï¼‰</td></tr><tr><td><strong><code>Consumer&lt;T></code></strong></td><td>æœ‰è¾“å…¥ã€æ— è¾“å‡º</td><td><code>thenAccept(consumer)</code></td><td>ç»“æœæ¶ˆè´¹ï¼ˆå¦‚æ—¥å¿—æ‰“å°ï¼‰</td></tr><tr><td><strong><code>Runnable</code></strong></td><td>æ— è¾“å…¥ã€æ— è¾“å‡º</td><td><code>thenRun(action)</code></td><td>æ¸…ç†èµ„æºæˆ–å‘é€é€šçŸ¥</td></tr><tr><td><strong>ç¤ºä¾‹</strong>ï¼š</td><td></td><td></td><td></td></tr></tbody></table></div><pre tabindex=0><code>stage.thenApply(x -&gt; x * 2)      // è¾“å…¥æ•´æ•°xï¼Œè¾“å‡º2x  
     .thenAccept(System.out::println) // æ¶ˆè´¹ç»“æœå¹¶æ‰“å°  
     .thenRun(() -&gt; cleanUp());     // æ— å‚æ•°æ¸…ç†æ“ä½œ
</code></pre><hr><h3 id=-ä»»åŠ¡ç¼–æ’èƒ½åŠ›è¯¦è§£>â›“ï¸ <strong>ä»»åŠ¡ç¼–æ’èƒ½åŠ›è¯¦è§£</strong></h3><h4 id=ä¸²è¡Œå…³ç³»sequential><strong>ä¸²è¡Œå…³ç³»ï¼ˆSequentialï¼‰</strong></h4><p>é€šè¿‡ <code>then*</code> ç³»åˆ—æ–¹æ³•å®ç°é˜¶æ®µé¡ºåºæ‰§è¡Œï¼š</p><ul><li><strong><code>thenApply()</code></strong>ï¼šæ¥æ”¶ä¸Šé˜¶æ®µç»“æœï¼Œè½¬æ¢åè¾“å‡ºæ–°å€¼ã€‚</li><li><strong><code>thenCompose()</code></strong>ï¼šæ‰å¹³åŒ–åµŒå¥—ä»»åŠ¡ï¼ˆå¦‚å°† <code>CompletionStage&lt;String></code> è½¬æ¢ä¸º <code>CompletionStage&lt;Integer></code>ï¼‰ã€‚</li></ul><pre tabindex=0><code>// æŸ¥è¯¢ç”¨æˆ·â†’æŸ¥è¯¢è®¢å•ï¼ˆä¾èµ–å‰åºç»“æœï¼‰
userStage.thenCompose(user -&gt; orderService.getOrders(user.getId()));
</code></pre><h4 id=å¹¶è¡Œç»„åˆcombination><strong>å¹¶è¡Œç»„åˆï¼ˆCombinationï¼‰</strong></h4><p>åˆå¹¶å¤šä¸ªç‹¬ç«‹ä»»åŠ¡çš„ç»“æœï¼š</p><ul><li><strong><code>thenCombine(stage2, fn)</code></strong>ï¼šåˆå¹¶ä¸¤ä¸ªé˜¶æ®µç»“æœï¼ˆå¦‚è®¡ç®— BMIï¼šä½“é‡+èº«é«˜â†’æŒ‡æ•°ï¼‰ã€‚</li><li><strong><code>thenAcceptBoth(stage2, consumer)</code></strong>ï¼šæ¶ˆè´¹ä¸¤ä¸ªç»“æœä½†æ— è¾“å‡ºã€‚</li></ul><pre tabindex=0><code>weightStage.thenCombine(heightStage, (w, h) -&gt; w / (h * h));
</code></pre><h4 id=èšåˆå…³ç³»andor><strong>èšåˆå…³ç³»ï¼ˆAND/ORï¼‰</strong></h4><p>æ§åˆ¶å¤šä¸ªä»»åŠ¡çš„å®Œæˆè§¦å‘æ¡ä»¶ï¼š</p><div class=table-wrapper><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>è§¦å‘æ¡ä»¶</strong></th><th><strong>è¿”å›ç±»å‹</strong></th></tr></thead><tbody><tr><td><strong><code>allOf(stages...)</code></strong></td><td>æ‰€æœ‰ä»»åŠ¡å®Œæˆ</td><td><code>CompletableFuture&lt;Void></code></td></tr><tr><td><strong><code>anyOf(stages...)</code></strong></td><td>ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆ</td><td><code>CompletableFuture&lt;Object></code></td></tr></tbody></table></div><pre tabindex=0><code>// æ‰¹é‡ä¸‹è½½ç½‘é¡µï¼Œç»Ÿè®¡åŒ…å«å…³é”®è¯çš„é¡µé¢æ•°  
CompletableFuture.allOf(urlFutures)  
    .thenApply(v -&gt; urlFutures.stream()  
        .filter(f -&gt; f.join().contains(&#34;Java&#34;))  
        .count());
</code></pre><h4 id=å¼‚å¸¸å¤„ç†><strong>å¼‚å¸¸å¤„ç†</strong></h4><p>æ”¯æŒé“¾å¼æ•è·å¼‚å¸¸ï¼Œé¿å…ä¸­æ–­æµæ°´çº¿ï¼š</p><ul><li><strong><code>exceptionally(fallbackFn)</code></strong>ï¼šæ•è·å¼‚å¸¸å¹¶è¿”å›é»˜è®¤å€¼ã€‚</li><li><strong><code>handle(biFn)</code></strong>ï¼šç»Ÿä¸€å¤„ç†ç»“æœå’Œå¼‚å¸¸ï¼ˆç±»ä¼¼ <code>try-catch-finally</code>ï¼‰ã€‚</li></ul><pre tabindex=0><code>stage.exceptionally(ex -&gt; &#34;Fallback&#34;)  
     .handle((res, ex) -&gt; ex != null ? &#34;Error&#34; : res);
</code></pre><hr><h3 id=-åº•å±‚å®ç°æœºåˆ¶>âš™ï¸ <strong>åº•å±‚å®ç°æœºåˆ¶</strong></h3><ol><li>çŠ¶æ€é©±åŠ¨<ul><li>æ¯ä¸ª <code>CompletionStage</code> ç»´æŠ¤ä»»åŠ¡çŠ¶æ€ï¼ˆæœªå®Œæˆã€å®Œæˆã€å¼‚å¸¸ï¼‰ï¼Œé€šè¿‡ <strong>CAS åŸå­æ“ä½œ</strong>æ›´æ–°ã€‚</li></ul></li><li>ä¾èµ–æ ˆç®¡ç†<ul><li>å›è°ƒæ–¹æ³•æ³¨å†Œä¸º <strong>LIFO æ ˆç»“æ„</strong>ï¼Œä»»åŠ¡å®Œæˆæ—¶æŒ‰æ³¨å†Œé¡ºåºçš„<strong>é€†åºè§¦å‘å›è°ƒ</strong>ï¼ˆåŒæ­¥æ¨¡å¼ï¼‰ã€‚</li></ul></li><li>çº¿ç¨‹æ± æ§åˆ¶<ul><li>é»˜è®¤ä½¿ç”¨ <code>ForkJoinPool.commonPool()</code>ï¼Œå¯é€šè¿‡ <code>*Async</code> æ–¹æ³•åç¼€ï¼ˆå¦‚ <code>thenApplyAsync</code>ï¼‰æŒ‡å®šè‡ªå®šä¹‰ <code>Executor</code>ã€‚</li></ul></li></ol><hr><h3 id=-å…¸å‹åº”ç”¨åœºæ™¯>ğŸš€ <strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></h3><ol><li><p>å¾®æœåŠ¡è°ƒç”¨é“¾
å¼‚æ­¥ä¸²è¡Œè°ƒç”¨é‰´æƒâ†’æŸ¥è¯¢â†’ç»“æœç»„è£…ï¼Œé¿å…çº¿ç¨‹é˜»å¡ï¼š</p><pre tabindex=0><code>authStage.thenCompose(token -&gt; userService.query(token))  
         .thenApply(user -&gt; buildResponse(user));
</code></pre></li><li><p><strong>æ‰¹é‡å¹¶è¡Œè®¡ç®—</strong>
åˆ†æ²»ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼ˆå¦‚ MapReduce æ¨¡å‹ï¼‰ï¼Œé€šè¿‡ <code>allOf</code> èšåˆç»“æœã€‚</p></li><li><p>ç«é€ŸæŸ¥è¯¢ä¼˜åŒ–
åŒæ—¶è¯·æ±‚å¤šä¸ªæ•°æ®æºï¼Œå–é¦–ä¸ªè¿”å›ç»“æœï¼ˆ</p><pre tabindex=0><code>anyOf 
</code></pre><p>+ è¶…æ—¶æ§åˆ¶ï¼‰ï¼š</p><pre tabindex=0><code>CompletableFuture.anyOf(dbQuery, cacheQuery)  
    .orTimeout(500, TimeUnit.MILLISECONDS);
</code></pre></li><li><p><strong>æµæ°´çº¿æ•°æ®å¤„ç†</strong>
é€é˜¶æ®µè½¬æ¢æ•°æ®æµï¼ˆå¦‚è¯»å–â†’è¿‡æ»¤â†’èšåˆâ†’å­˜å‚¨ï¼‰ã€‚</p></li></ol><hr><h3 id=-æ³¨æ„äº‹é¡¹>âš ï¸ <strong>æ³¨æ„äº‹é¡¹</strong></h3><ol><li><strong>é¿å…é˜»å¡å›è°ƒ</strong>
å›è°ƒä¸­æ‰§è¡Œé˜»å¡æ“ä½œï¼ˆå¦‚åŒæ­¥ I/Oï¼‰ä¼šæ‹–æ…¢æ•´ä¸ªæµæ°´çº¿ï¼Œéœ€æ”¹ç”¨å¼‚æ­¥ I/O æˆ–æŒ‡å®šä¸“ç”¨çº¿ç¨‹æ± ã€‚</li><li><strong>çº¿ç¨‹æ± éš”ç¦»</strong>
CPU å¯†é›†å‹ä¸ I/O å¯†é›†å‹ä»»åŠ¡ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œé˜²æ­¢èµ„æºç«äº‰ã€‚</li><li><strong>å¼‚å¸¸ä¼ æ’­</strong>
æœªæ•è·çš„è¿è¡Œæ—¶å¼‚å¸¸ä¼šå¯¼è‡´é˜¶æ®µä¸­æ–­ï¼ŒåŠ¡å¿…é€šè¿‡ <code>handle()</code> æˆ– <code>exceptionally()</code> å¤„ç†ã€‚</li></ol><hr><h3 id=-æ€»ç»“-3>ğŸ’ <strong>æ€»ç»“</strong></h3><p><code>CompletionStage</code> æ˜¯ Java å¼‚æ­¥ç¼–ç¨‹çš„<strong>èŒƒå¼é©æ–°</strong>ï¼Œæ ¸å¿ƒä»·å€¼åœ¨äºï¼š
âœ… â€‹<strong>å£°æ˜å¼ç¼–æ’</strong>â€‹ï¼šé€šè¿‡é“¾å¼è°ƒç”¨æè¿°ä»»åŠ¡æ—¶åºï¼Œæ›¿ä»£ <code>Future</code> çš„é˜»å¡è½®è¯¢ã€‚
âœ… â€‹<strong>å‡½æ•°å¼é›†æˆ</strong>â€‹ï¼šæ— ç¼ç»“åˆ Lambda è¡¨è¾¾å¼ï¼Œç®€åŒ–å›è°ƒé€»è¾‘ã€‚
âœ… â€‹<strong>çµæ´»ç»„åˆ</strong>â€‹ï¼šæ”¯æŒ AND/OR èšåˆã€å¼‚å¸¸æ¢å¤ç­‰å¤æ‚æ¨¡å¼ã€‚
<strong>é€‚ç”¨åœºæ™¯ä¼˜å…ˆçº§</strong>ï¼š</p><ul><li>é«˜å¹¶å‘æœåŠ¡ç¼–æ’ â†’ å¾®æœåŠ¡è°ƒç”¨é“¾</li><li>æ‰¹å¤„ç†åŠ é€Ÿ â†’ å¹¶è¡Œè®¡ç®—ä¸èšåˆ</li><li>å“åº”å¼ç³»ç»Ÿ â†’ éé˜»å¡æµæ°´çº¿</li></ul><blockquote><p><strong>ç”Ÿäº§å»ºè®®</strong>ï¼šä¼˜å…ˆä½¿ç”¨ <code>CompletableFuture</code>ï¼ˆ<code>CompletionStage</code> çš„å”¯ä¸€å®ç°ï¼‰ï¼Œç»“åˆè‡ªå®šä¹‰çº¿ç¨‹æ± ä¸è¶…æ—¶æœºåˆ¶ï¼Œæ„å»ºå¥å£®å¼‚æ­¥é“¾è·¯ã€‚</p></blockquote><h2 id=completablefuture>CompletableFuture</h2><p>CompletableFuture æ˜¯ Java 8 å¼•å…¥çš„å¼‚æ­¥ç¼–ç¨‹å·¥å…·ï¼Œå®ç°äº† <code>Future</code> å’Œ <code>CompletionStage</code> æ¥å£ï¼Œæä¾›äº†æ¯”ä¼ ç»Ÿ <code>Future</code> æ›´å¼ºå¤§çš„ä»»åŠ¡ç¼–æ’ã€é“¾å¼è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†èƒ½åŠ›ï¼Œæå¤§ç®€åŒ–äº†å¤æ‚å¼‚æ­¥æµç¨‹çš„å¼€å‘ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§ã€å·¥ä½œåŸç†åˆ°å®è·µåº”ç”¨å±•å¼€è¯¦è§£ï¼š</p><hr><h3 id=-æ ¸å¿ƒç‰¹æ€§ä¸è®¾è®¡å®šä½>ğŸ”§ <strong>æ ¸å¿ƒç‰¹æ€§ä¸è®¾è®¡å®šä½</strong></h3><ol><li><strong>å¼‚æ­¥ç»“æœå®¹å™¨</strong><ul><li>è¡¨ç¤ºä¸€ä¸ªå¯èƒ½æœªå®Œæˆçš„å¼‚æ­¥è®¡ç®—ç»“æœï¼Œæ”¯æŒæ‰‹åŠ¨è®¾ç½®ç»“æœï¼ˆ<code>complete(T)</code>ï¼‰æˆ–å¼‚å¸¸ç»ˆæ­¢ï¼ˆ<code>completeExceptionally(Throwable)</code>ï¼‰ã€‚</li><li>ä¸ <code>Future</code> çš„é˜»å¡å¼ <code>get()</code> ä¸åŒï¼Œæ”¯æŒéé˜»å¡å›è°ƒæœºåˆ¶ï¼ˆå¦‚ <code>thenApply</code>ã€<code>thenAccept</code>ï¼‰ã€‚</li></ul></li><li><strong>ä»»åŠ¡ç¼–æ’èƒ½åŠ›</strong><ul><li><strong>ä¸²è¡Œ/å¹¶è¡Œç»„åˆ</strong>ï¼šé€šè¿‡ <code>thenCompose</code>ï¼ˆä¸²è¡Œä¾èµ–ï¼‰ã€<code>thenCombine</code>ï¼ˆå¹¶è¡Œåˆå¹¶ï¼‰ã€<code>allOf</code>/<code>anyOf</code>ï¼ˆå¤šä»»åŠ¡èšåˆï¼‰ç­‰æ–¹æ³•æ„å»ºå¤æ‚æµæ°´çº¿ã€‚</li><li><strong>çµæ´»çº¿ç¨‹æ§åˆ¶</strong>ï¼šé»˜è®¤ä½¿ç”¨ <code>ForkJoinPool.commonPool()</code>ï¼Œæ”¯æŒè‡ªå®šä¹‰ <code>Executor</code> æŒ‡å®šçº¿ç¨‹æ± ã€‚</li></ul></li><li><strong>å¼‚å¸¸å¤„ç†æœºåˆ¶</strong><ul><li><code>exceptionally()</code>ï¼šæ•è·å¼‚å¸¸å¹¶è¿”å›é»˜è®¤å€¼ã€‚</li><li><code>handle()</code>ï¼šåŒæ—¶å¤„ç†æ­£å¸¸ç»“æœå’Œå¼‚å¸¸ï¼Œå¯è½¬æ¢ç»“æœç±»å‹ã€‚</li></ul></li></ol><hr><h3 id=-æ ¸å¿ƒ-api-è¯¦è§£>âš™ï¸ <strong>æ ¸å¿ƒ API è¯¦è§£</strong></h3><h4 id=åˆ›å»ºå¼‚æ­¥ä»»åŠ¡><strong>åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</strong></h4><div class=table-wrapper><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>åŠŸèƒ½</strong></th></tr></thead><tbody><tr><td><code>supplyAsync(Supplier&lt;T>)</code></td><td>æ‰§è¡Œæœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ï¼‰ã€‚</td></tr><tr><td><code>runAsync(Runnable)</code></td><td>æ‰§è¡Œæ— è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚æ—¥å¿—å†™å…¥ï¼‰ã€‚</td></tr><tr><td><code>completedFuture(T)</code></td><td>åˆ›å»ºå·²å®Œæˆçš„å®ä¾‹ï¼Œç›´æ¥æºå¸¦ç»“æœã€‚</td></tr><tr><td><strong>ç¤ºä¾‹</strong>ï¼š</td><td></td></tr></tbody></table></div><pre tabindex=0><code>CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#34;Hello&#34;);
</code></pre><h4 id=é“¾å¼å›è°ƒæ–¹æ³•><strong>é“¾å¼å›è°ƒæ–¹æ³•</strong></h4><div class=table-wrapper><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>ç”¨é€”</strong></th></tr></thead><tbody><tr><td><code>thenApply(Function&lt;T,U>)</code></td><td>è½¬æ¢ç»“æœï¼ˆå¦‚å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰ã€‚</td></tr><tr><td><code>thenAccept(Consumer&lt;T>)</code></td><td>æ¶ˆè´¹ç»“æœï¼ˆå¦‚æ‰“å°è¾“å‡ºï¼‰ï¼Œæ— è¿”å›å€¼ã€‚</td></tr><tr><td><code>thenRun(Runnable)</code></td><td>ä»»åŠ¡å®Œæˆåæ‰§è¡ŒåŠ¨ä½œï¼Œä¸è®¿é—®ç»“æœã€‚</td></tr><tr><td><code>thenCompose(Function&lt;T, CompletableFuture&lt;U>>)</code></td><td>å°†å½“å‰ç»“æœä½œä¸ºè¾“å…¥å¯åŠ¨æ–°å¼‚æ­¥ä»»åŠ¡ï¼ˆé“¾å¼ä¾èµ–ï¼‰ã€‚</td></tr><tr><td><strong>ç¤ºä¾‹</strong>ï¼š</td><td></td></tr></tbody></table></div><pre tabindex=0><code>future.thenApply(s -&gt; s + &#34; World&#34;)
      .thenAccept(System.out::println); // è¾“å‡º &#34;Hello World&#34;
</code></pre><h4 id=å¤šä»»åŠ¡ç»„åˆ><strong>å¤šä»»åŠ¡ç»„åˆ</strong></h4><div class=table-wrapper><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>åœºæ™¯</strong></th></tr></thead><tbody><tr><td><code>thenCombine(CompletionStage, BiFunction)</code></td><td>åˆå¹¶ä¸¤ä¸ªç‹¬ç«‹ä»»åŠ¡çš„ç»“æœï¼ˆå¦‚è®¡ç®— A+Bï¼‰ã€‚</td></tr><tr><td><code>allOf(CompletableFuture...)</code></td><td>ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼ˆå¦‚æ‰¹é‡è°ƒç”¨ APIï¼‰ã€‚</td></tr><tr><td><code>anyOf(CompletableFuture...)</code></td><td>ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆå³è§¦å‘ï¼ˆå¦‚ç«é€ŸæŸ¥è¯¢ï¼‰ã€‚</td></tr><tr><td><strong>ç¤ºä¾‹</strong>ï¼š</td><td></td></tr></tbody></table></div><pre tabindex=0><code>CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; 2);
CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; 3);
future1.thenCombine(future2, (a, b) -&gt; a + b)
       .thenAccept(sum -&gt; System.out.println(&#34;Sum: &#34; + sum)); // è¾“å‡º 5
</code></pre><h4 id=å¼‚å¸¸å¤„ç†-1><strong>å¼‚å¸¸å¤„ç†</strong></h4><pre tabindex=0><code>CompletableFuture.supplyAsync(() -&gt; {
    if (error) throw new RuntimeException(&#34;Error&#34;);
    return &#34;Success&#34;;
}).exceptionally(ex -&gt; &#34;Fallback&#34;)  // å¼‚å¸¸æ—¶è¿”å›é»˜è®¤å€¼
  .handle((res, ex) -&gt; ex != null ? &#34;Recovered&#34; : res); // ç»Ÿä¸€å¤„ç†ç»“æœå’Œå¼‚å¸¸
</code></pre><hr><h3 id=-å…¸å‹åº”ç”¨åœºæ™¯-1>âš¡ <strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></h3><ol><li><strong>å¹¶è¡Œè®¡ç®—ä¼˜åŒ–</strong>
å°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œé€šè¿‡ <code>allOf</code> èšåˆç»“æœï¼Œæå‡ååé‡ï¼š<pre tabindex=0><code>List&lt;CompletableFuture&lt;Integer&gt;&gt; futures = tasks.stream()
    .map(task -&gt; CompletableFuture.supplyAsync(task::compute, executor))
    .toList();
CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
    .thenApply(v -&gt; futures.stream().map(CompletableFuture::join).sum());
</code></pre></li><li><strong>å¾®æœåŠ¡å¼‚æ­¥è°ƒç”¨é“¾</strong>
ä¸²è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡ï¼ˆå¦‚å…ˆé‰´æƒåæŸ¥è¯¢ï¼‰ï¼Œé¿å…é˜»å¡çº¿ç¨‹ï¼š<pre tabindex=0><code>CompletableFuture&lt;String&gt; authFuture = authService.authAsync(token);
authFuture.thenCompose(auth -&gt; userService.queryAsync(auth.getUserId()))
          .thenAccept(user -&gt; System.out.println(user.getName()));
</code></pre></li><li><strong>ç«é€Ÿè¯·æ±‚ä¸è¶…æ—¶æ§åˆ¶</strong>
åŒæ—¶å‘èµ·å¤šä¸ªæ•°æ®æºæŸ¥è¯¢ï¼Œå–é¦–ä¸ªå“åº”ç»“æœï¼š<pre tabindex=0><code>CompletableFuture&lt;Data&gt; source1 = fetchFromSource1();
CompletableFuture&lt;Data&gt; source2 = fetchFromSource2();
CompletableFuture.anyOf(source1, source2)
    .orTimeout(500, TimeUnit.MILLISECONDS) // è¶…æ—¶ä¸­æ–­
    .thenAccept(data -&gt; System.out.println(&#34;First result: &#34; + data));
</code></pre></li></ol><hr><h3 id=-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ-1>âš ï¸ <strong>æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></h3><ol><li><strong>çº¿ç¨‹æ± é€‰æ‹©</strong><ul><li><strong>CPU å¯†é›†å‹</strong>ï¼šå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼ˆ<code>Executors.newFixedThreadPool</code>ï¼‰é¿å…è¿‡åº¦åˆ‡æ¢ã€‚</li><li><strong>I/O å¯†é›†å‹</strong>ï¼šç¼“å­˜çº¿ç¨‹æ± ï¼ˆ<code>Executors.newCachedThreadPool</code>ï¼‰æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚</li></ul></li><li><strong>é¿å…å›è°ƒåœ°ç‹±</strong>
é“¾å¼è°ƒç”¨ä¸å®œè¿‡é•¿ï¼Œå¤æ‚é€»è¾‘å¯æ‹†åˆ†ä¸ºç‹¬ç«‹æ–¹æ³•ï¼Œæˆ–ç”¨ <code>CompletableFuture</code> ç»„åˆå™¨ç®€åŒ–ã€‚</li><li><strong>èµ„æºæ³„æ¼é¢„é˜²</strong><ul><li>è‡ªå®šä¹‰çº¿ç¨‹æ± éœ€æ˜¾å¼å…³é—­ï¼ˆ<code>shutdown()</code>ï¼‰ã€‚</li><li>ä»»åŠ¡å†…éƒ¨æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢æœªå¤„ç†å¼‚å¸¸ä¸­æ–­çº¿ç¨‹ã€‚</li></ul></li><li><strong>æ€§èƒ½ç›‘æ§</strong>
å¼‚æ­¥é“¾è·¯è¾ƒé•¿æ—¶ï¼Œç»“åˆ Micrometer ç­‰å·¥å…·è¿½è¸ªä»»åŠ¡è€—æ—¶å’Œçº¿ç¨‹æ± è´Ÿè½½ã€‚</li></ol><hr><h3 id=-ä¸ä¼ ç»Ÿ-future-çš„æ ¸å¿ƒå·®å¼‚>ğŸ’ <strong>ä¸ä¼ ç»Ÿ Future çš„æ ¸å¿ƒå·®å¼‚</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Future</strong></th><th><strong>CompletableFuture</strong></th></tr></thead><tbody><tr><td><strong>ç»“æœè·å–</strong></td><td>é˜»å¡å¼ <code>get()</code></td><td>éé˜»å¡å›è°ƒï¼ˆ<code>thenAccept</code> ç­‰ï¼‰</td></tr><tr><td><strong>ä»»åŠ¡ç»„åˆ</strong></td><td>éœ€æ‰‹åŠ¨åè°ƒï¼ˆåµŒå¥—é˜»å¡ï¼‰</td><td>å£°æ˜å¼ç»„åˆï¼ˆ<code>thenCombine</code>/<code>allOf</code>ï¼‰</td></tr><tr><td><strong>å¼‚å¸¸å¤„ç†</strong></td><td>éœ€åœ¨ <code>get()</code> ä¸­æ•è·</td><td>é“¾å¼å¤„ç†ï¼ˆ<code>exceptionally</code>/<code>handle</code>ï¼‰</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>åŠŸèƒ½åŸºç¡€</td><td>æ”¯æŒæ‰‹åŠ¨å®Œæˆã€è¶…æ—¶æ§åˆ¶ã€å›è°ƒé“¾</td></tr></tbody></table></div><hr><h3 id=-ç»¼åˆåº”ç”¨ç¤ºä¾‹>ğŸš€ <strong>ç»¼åˆåº”ç”¨ç¤ºä¾‹</strong></h3><pre tabindex=0><code>ExecutorService executor = Executors.newFixedThreadPool(4);

// å¼‚æ­¥æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ + è®¢å•å†å²
CompletableFuture&lt;User&gt; userFuture = CompletableFuture.supplyAsync(UserService::fetchUser, executor);
CompletableFuture&lt;List&lt;Order&gt;&gt; ordersFuture = userFuture.thenComposeAsync(
    user -&gt; OrderService.fetchOrders(user.getId()), executor
);

// åˆå¹¶ç»“æœå¹¶å¤„ç†å¼‚å¸¸
CompletableFuture&lt;Void&gt; result = userFuture.thenCombine(ordersFuture, (user, orders) -&gt; {
    return String.format(&#34;User: %s, Orders: %d&#34;, user.getName(), orders.size());
}).handle((res, ex) -&gt; {
    if (ex != null) return &#34;Error: &#34; + ex.getCause().getMessage();
    return res;
}).thenAcceptAsync(System.out::println, executor);

result.join(); // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
executor.shutdown();
</code></pre><hr><h3 id=-æ€»ç»“-4>ğŸ’¡ <strong>æ€»ç»“</strong></h3><p>CompletableFuture æ˜¯ Java å¼‚æ­¥ç¼–ç¨‹çš„<strong>æ ¸å¿ƒè¿›åŒ–</strong>ï¼Œé€šè¿‡é“¾å¼è°ƒç”¨å’Œç»„åˆæ“ä½œè§£å†³äº†ä¼ ç»Ÿ Future çš„é˜»å¡ä¸åä½œéš¾é¢˜ã€‚<strong>é€‚ç”¨åœºæ™¯</strong>åŒ…æ‹¬ï¼šé«˜å¹¶å‘æœåŠ¡ç¼–æ’ã€æ‰¹é‡ä»»åŠ¡å¹¶è¡ŒåŒ–ã€å“åº”å¼å¾®æœåŠ¡è°ƒç”¨ç­‰ã€‚<strong>ç”Ÿäº§å»ºè®®</strong>ï¼š</p><ul><li>ä¼˜å…ˆä½¿ç”¨ <code>supplyAsync</code>/<code>thenApply</code> ç­‰é“¾å¼æ–¹æ³•æ›¿ä»£é˜»å¡è°ƒç”¨ï¼›</li><li>è‡ªå®šä¹‰çº¿ç¨‹æ± æ§åˆ¶èµ„æºï¼Œé¿å…æ— ç•Œé˜Ÿåˆ—å¯¼è‡´ OOMï¼›</li><li>å¤æ‚é“¾è·¯ç»“åˆ <code>allOf</code>/<code>anyOf</code> å’Œè¶…æ—¶æœºåˆ¶æå‡å¥å£®æ€§ã€‚</li></ul><h2 id=executor-vs-executorservice>Executor vs. ExecutorService</h2><p>åœ¨ Java å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>Executor</code> å’Œ <code>ExecutorService</code> æ˜¯çº¿ç¨‹æ± ç®¡ç†çš„æ ¸å¿ƒæ¥å£ï¼ŒäºŒè€…è™½æœ‰å…³è”ä½†èŒè´£å’ŒåŠŸèƒ½å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«åŠé€‚ç”¨åœºæ™¯åˆ†æï¼š</p><hr><h3 id=-æ¥å£å±‚çº§ä¸è®¾è®¡å®šä½>ğŸ”§ <strong>æ¥å£å±‚çº§ä¸è®¾è®¡å®šä½</strong></h3><ol><li><strong><code>Executor</code></strong><ul><li><strong>åŸºç¡€æ¥å£</strong>ï¼šä»…å®šä¹‰å•ä¸€æ–¹æ³• <code>void execute(Runnable command)</code>ï¼Œç”¨äºæäº¤ <code>Runnable</code> ä»»åŠ¡ã€‚</li><li><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼šè§£è€¦ä»»åŠ¡æäº¤ä¸æ‰§è¡Œç­–ç•¥ï¼ˆå¦‚çº¿ç¨‹åˆ›å»ºã€è°ƒåº¦ï¼‰ï¼Œä½†ä¸æ¶‰åŠä»»åŠ¡ç»“æœæˆ–ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</li><li>ç¤ºä¾‹ä»£ç ï¼š<pre tabindex=0><code>Executor executor = command -&gt; new Thread(command).start(); // è‡ªå®šä¹‰æ‰§è¡Œç­–ç•¥
executor.execute(() -&gt; System.out.println(&#34;Task running&#34;));
</code></pre></li></ul></li><li><strong><code>ExecutorService</code></strong><ul><li><strong>å­æ¥å£æ‰©å±•</strong>ï¼šç»§æ‰¿ <code>Executor</code>ï¼Œæ–°å¢ä»»åŠ¡ç®¡ç†ã€ç»“æœè·å–å’Œçº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸæ§åˆ¶æ–¹æ³•ã€‚</li><li><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼šæä¾›å®Œæ•´çš„å¼‚æ­¥ä»»åŠ¡æ¡†æ¶ï¼Œæ”¯æŒä»»åŠ¡å–æ¶ˆã€ç»“æœè·Ÿè¸ªåŠä¼˜é›…å…³é—­ã€‚</li></ul></li></ol><hr><h3 id=-æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”>âš™ï¸ <strong>æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”</strong></h3><h4 id=ä»»åŠ¡æäº¤æ–¹å¼><strong>ä»»åŠ¡æäº¤æ–¹å¼</strong></h4><div class=table-wrapper><table><thead><tr><th><strong>åŠŸèƒ½</strong></th><th><strong>Executor</strong></th><th><strong>ExecutorService</strong></th></tr></thead><tbody><tr><td><strong>ä»»åŠ¡ç±»å‹æ”¯æŒ</strong></td><td>ä»… <code>Runnable</code></td><td><code>Runnable</code> å’Œ <code>Callable</code></td></tr><tr><td><strong>æäº¤æ–¹æ³•</strong></td><td><code>execute(Runnable)</code></td><td><code>submit(Runnable)</code> / <code>submit(Callable)</code></td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>æ— </td><td>è¿”å› <code>Future</code> å¯¹è±¡è·Ÿè¸ªç»“æœæˆ–å¼‚å¸¸</td></tr><tr><td><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</td><td></td><td></td></tr></tbody></table></div><pre tabindex=0><code>// ExecutorService æäº¤ Callable ä»»åŠ¡
ExecutorService executorService = Executors.newFixedThreadPool(2);
Future&lt;Integer&gt; future = executorService.submit(() -&gt; 42);
Integer result = future.get(); // é˜»å¡è·å–ç»“æœ
</code></pre><h4 id=ç”Ÿå‘½å‘¨æœŸç®¡ç†><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></h4><div class=table-wrapper><table><thead><tr><th><strong>èƒ½åŠ›</strong></th><th><strong>Executor</strong></th><th><strong>ExecutorService</strong></th></tr></thead><tbody><tr><td><strong>å…³é—­çº¿ç¨‹æ± </strong></td><td>éœ€æ‰‹åŠ¨å®ç°</td><td>æä¾› <code>shutdown()</code> å’Œ <code>shutdownNow()</code></td></tr><tr><td><strong>çŠ¶æ€æ£€æŸ¥</strong></td><td>ä¸æ”¯æŒ</td><td><code>isShutdown()</code> / <code>isTerminated()</code></td></tr><tr><td><strong>ç­‰å¾…ç»ˆæ­¢</strong></td><td>ä¸æ”¯æŒ</td><td><code>awaitTermination(timeout, unit)</code></td></tr><tr><td><strong>å…³é—­æµç¨‹ç¤ºä¾‹</strong>ï¼š</td><td></td><td></td></tr></tbody></table></div><pre tabindex=0><code>executorService.shutdown(); // åœæ­¢æ¥æ”¶æ–°ä»»åŠ¡
if (!executorService.awaitTermination(60, TimeUnit.SECONDS)) {
    executorService.shutdownNow(); // å¼ºåˆ¶ç»ˆæ­¢å‰©ä½™ä»»åŠ¡
}
</code></pre><h4 id=æ‰¹é‡ä»»åŠ¡ä¸é«˜çº§æ§åˆ¶><strong>æ‰¹é‡ä»»åŠ¡ä¸é«˜çº§æ§åˆ¶</strong></h4><ul><li><strong>æ‰¹é‡æäº¤</strong>ï¼š
<code>ExecutorService</code> æ”¯æŒ <code>invokeAll()</code>ï¼ˆç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼‰å’Œ <code>invokeAny()</code>ï¼ˆä»»ä¸€ä»»åŠ¡å®Œæˆå³è¿”å›ï¼‰ã€‚</li><li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼š
å¯é€šè¿‡ <code>Future.get(timeout, unit)</code> å®ç°ç»“æœè·å–çš„è¶…æ—¶æœºåˆ¶ã€‚</li></ul><hr><h3 id=-é€‚ç”¨åœºæ™¯åˆ†æ>ğŸ§© <strong>é€‚ç”¨åœºæ™¯åˆ†æ</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>åœºæ™¯</strong></th><th><strong>æ¨èæ¥å£</strong></th><th><strong>åŸå› </strong></th></tr></thead><tbody><tr><td>ç®€å•å¼‚æ­¥ä»»åŠ¡ï¼ˆæ— éœ€ç»“æœï¼‰</td><td><code>Executor</code></td><td>è½»é‡çº§æäº¤ï¼Œæ— éœ€ç®¡ç†çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td>éœ€è·å–ç»“æœçš„ä»»åŠ¡</td><td><code>ExecutorService</code></td><td>é€šè¿‡ <code>Future</code> è·å–è¿”å›å€¼æˆ–å¼‚å¸¸</td></tr><tr><td>å®šæ—¶/å‘¨æœŸæ€§ä»»åŠ¡</td><td><code>ExecutorService</code></td><td>éœ€é…åˆ <code>ScheduledExecutorService</code>ï¼ˆå­æ¥å£ï¼‰å®ç°è°ƒåº¦</td></tr><tr><td>é«˜å¹¶å‘æœåŠ¡ï¼ˆå¦‚WebæœåŠ¡å™¨ï¼‰</td><td><code>ExecutorService</code></td><td>è¦æ±‚çº¿ç¨‹æ± åŠ¨æ€ç®¡ç†ã€ä¼˜é›…å…³é—­å’Œèµ„æºå›æ”¶</td></tr></tbody></table></div><hr><h3 id=-ç”Ÿäº§å®è·µæ³¨æ„äº‹é¡¹>âš ï¸ <strong>ç”Ÿäº§å®è·µæ³¨æ„äº‹é¡¹</strong></h3><ol><li>é¿å…æ— ç•Œé˜Ÿåˆ—<pre tabindex=0><code>Executors.newFixedThreadPool() 
</code></pre>ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—å¯èƒ½å¯¼è‡´<pre tabindex=0><code>OOM
</code></pre>ï¼Œå»ºè®®è‡ªå®šä¹‰<pre tabindex=0><code>ThreadPoolExecutor
```ï¼š
</code></pre>new ThreadPoolExecutor(corePoolSize, maxPoolSize, keepAliveTime, unit, new ArrayBlockingQueue&lt;>(capacity));<pre tabindex=0><code></code></pre></li><li><strong>å¼‚å¸¸å¤„ç†</strong>
<code>Executor</code> ä¸­æœªæ•è·çš„å¼‚å¸¸ä¼šä¼ é€’è‡³ <code>UncaughtExceptionHandler</code>ï¼Œè€Œ <code>ExecutorService</code> å¯é€šè¿‡ <code>Future.get()</code>æ•è· <code>ExecutionException</code>ã€‚</li><li><strong>èµ„æºæ³„æ¼é¢„é˜²</strong>
åŠ¡å¿…è°ƒç”¨ <code>shutdown()</code> å…³é—­çº¿ç¨‹æ± ï¼Œå¦åˆ™ JVM æ— æ³•é€€å‡ºã€‚</li></ol><hr><h3 id=-æ€»ç»“æ ¸å¿ƒå·®å¼‚å…¨æ™¯å›¾>ğŸ’ <strong>æ€»ç»“ï¼šæ ¸å¿ƒå·®å¼‚å…¨æ™¯å›¾</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Executor</strong></th><th><strong>ExecutorService</strong></th></tr></thead><tbody><tr><td><strong>æ¥å£å…³ç³»</strong></td><td>çˆ¶æ¥å£</td><td>å­æ¥å£ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰</td></tr><tr><td><strong>ä»»åŠ¡æäº¤</strong></td><td>ä»…æ”¯æŒ <code>Runnable</code></td><td>æ”¯æŒ <code>Runnable</code> å’Œ <code>Callable</code></td></tr><tr><td><strong>ç»“æœè·å–</strong></td><td>ä¸æ”¯æŒ</td><td>é€šè¿‡ <code>Future</code> è·Ÿè¸ªç»“æœ</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></td><td>æ— å†…ç½®æ–¹æ³•</td><td>æä¾›å…³é—­ã€çŠ¶æ€æ£€æŸ¥ç­‰æ–¹æ³•</td></tr><tr><td><strong>é€‚ç”¨å¤æ‚åº¦</strong></td><td>ç®€å•å¼‚æ­¥åœºæ™¯</td><td>ç”Ÿäº§çº§é«˜å¹¶å‘ç®¡ç†</td></tr></tbody></table></div><blockquote><p>ğŸ’¡ <strong>å®é™…å»ºè®®</strong>ï¼š
é™¤éæç®€åœºæ™¯ï¼ˆå¦‚å•æ¬¡å¼‚æ­¥æ—¥å¿—ï¼‰ï¼Œâ€‹<strong>ä¼˜å…ˆä½¿ç”¨ <code>ExecutorService</code></strong>ã€‚å…¶å®Œå¤‡çš„ä»»åŠ¡ç®¡ç†ã€ç»“æœè·Ÿè¸ªå’Œèµ„æºæ§åˆ¶èƒ½åŠ›ï¼Œæ›´ç¬¦åˆç”Ÿäº§ç¯å¢ƒéœ€æ±‚ã€‚å¯¹äºå®šæ—¶ä»»åŠ¡ï¼Œå¯è¿›ä¸€æ­¥ä½¿ç”¨å…¶å­æ¥å£ <code>ScheduledExecutorService</code>ã€‚</p></blockquote><h2 id=executors>Executors</h2><p>Executors æ˜¯ Java å¹¶å‘ç¼–ç¨‹ä¸­ç”¨äº<strong>ç®€åŒ–çº¿ç¨‹æ± åˆ›å»ºå’Œç®¡ç†</strong>çš„æ ¸å¿ƒå·¥å…·ç±»ï¼ˆä½äº <code>java.util.concurrent</code> åŒ…ï¼‰ã€‚å®ƒé€šè¿‡é™æ€å·¥å‚æ–¹æ³•æä¾›é¢„é…ç½®çš„çº¿ç¨‹æ± ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºåˆ†é…ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨è¯¦è§£ï¼š</p><hr><h3 id=-executors-çš„æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„å®šä½>ğŸ”§ <strong>Executors çš„æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„å®šä½</strong></h3><ol><li><strong>çº¿ç¨‹æ± å°è£…</strong>
Executors å°è£…äº† <code>ThreadPoolExecutor</code> å’Œ <code>ScheduledThreadPoolExecutor</code> çš„å¤æ‚é…ç½®ï¼Œæä¾›å¼€ç®±å³ç”¨çš„çº¿ç¨‹æ± å®ä¾‹ã€‚</li><li>ä»»åŠ¡ä¸æ‰§è¡Œè§£è€¦
åŸºäº Executor æ¡†æ¶çš„ä¸‰å±‚æ¨¡å‹ï¼š<ul><li><strong>ä»»åŠ¡</strong>ï¼š<code>Runnable</code> æˆ– <code>Callable</code> æ¥å£å®šä¹‰å·¥ä½œå•å…ƒã€‚</li><li><strong>æ‰§è¡Œæœºåˆ¶</strong>ï¼šé€šè¿‡ <code>ExecutorService</code> ç®¡ç†ä»»åŠ¡è°ƒåº¦å’Œçº¿ç¨‹èµ„æºã€‚</li><li><strong>ç»“æœå¤„ç†</strong>ï¼š<code>Future</code> æˆ– <code>FutureTask</code> è·å–å¼‚æ­¥è®¡ç®—ç»“æœã€‚</li></ul></li><li><strong>èµ„æºä¼˜åŒ–</strong>
å¤ç”¨çº¿ç¨‹å‡å°‘åˆ›å»º/é”€æ¯å¼€é”€ï¼Œæå‡ç³»ç»Ÿååé‡ï¼ˆå°¤å…¶åœ¨ I/O å¯†é›†å‹åœºæ™¯ï¼‰ã€‚</li></ol><hr><h3 id=-executors-æä¾›çš„çº¿ç¨‹æ± ç±»å‹åŠç‰¹ç‚¹>ğŸ§© <strong>Executors æä¾›çš„çº¿ç¨‹æ± ç±»å‹åŠç‰¹ç‚¹</strong></h3><p>ä»¥ä¸‹æ˜¯å…­ç§å¸¸ç”¨çº¿ç¨‹æ± çš„å¯¹æ¯”ï¼š</p><div class=table-wrapper><table><thead><tr><th><strong>å·¥å‚æ–¹æ³•</strong></th><th><strong>çº¿ç¨‹æ± ç±»å‹</strong></th><th><strong>æ ¸å¿ƒæœºåˆ¶</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><code>newFixedThreadPool(int n)</code></td><td>å›ºå®šå¤§å°çº¿ç¨‹æ± </td><td>æ ¸å¿ƒçº¿ç¨‹æ•° = æœ€å¤§çº¿ç¨‹æ•°ï¼›æ— ç•Œé˜Ÿåˆ—ï¼ˆ<code>LinkedBlockingQueue</code>ï¼‰</td><td>CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚è®¡ç®—ã€å›¾åƒå¤„ç†ï¼‰</td></tr><tr><td><code>newCachedThreadPool()</code></td><td>å¯ç¼“å­˜çº¿ç¨‹æ± </td><td>çº¿ç¨‹æ•°æ— ä¸Šé™ï¼ˆå¯å›æ”¶é—²ç½®çº¿ç¨‹ï¼‰ï¼›åŒæ­¥é˜Ÿåˆ—ï¼ˆ<code>SynchronousQueue</code>ï¼‰</td><td>çŸ­æœŸå¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰</td></tr><tr><td><code>newSingleThreadExecutor()</code></td><td>å•çº¿ç¨‹æ± </td><td>ä»…ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼›æ— ç•Œé˜Ÿåˆ—</td><td>éœ€é¡ºåºæ‰§è¡Œçš„ä»»åŠ¡ï¼ˆå¦‚æ—¥å¿—å†™å…¥ï¼‰</td></tr><tr><td><code>newScheduledThreadPool(int n)</code></td><td>å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </td><td>å›ºå®šæ ¸å¿ƒçº¿ç¨‹ï¼›æ”¯æŒå»¶è¿Ÿ/å‘¨æœŸæ€§ä»»åŠ¡ï¼ˆ<code>DelayedWorkQueue</code>ï¼‰</td><td>å¿ƒè·³æ£€æµ‹ã€å®šæ—¶æ•°æ®åŒæ­¥</td></tr><tr><td><code>newSingleThreadScheduledExecutor()</code></td><td>å•çº¿ç¨‹å®šæ—¶ä»»åŠ¡æ± </td><td>å•çº¿ç¨‹ç‰ˆ <code>ScheduledThreadPool</code></td><td>éœ€é¡ºåºæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡</td></tr><tr><td><code>newWorkStealingPool(int n)</code></td><td>å·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼ˆJava 8+ï¼‰</td><td>åŸºäº <code>ForkJoinPool</code>ï¼›å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼›é»˜è®¤ä½¿ç”¨ CPU æ ¸å¿ƒæ•°</td><td>åˆ†æ²»ä»»åŠ¡æˆ–å¹¶è¡Œè®¡ç®—</td></tr></tbody></table></div><blockquote><p>âš ï¸ <strong>æ³¨æ„</strong>ï¼š<code>FixedThreadPool</code> å’Œ <code>SingleThreadExecutor</code> ä½¿ç”¨<strong>æ— ç•Œé˜Ÿåˆ—</strong>ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è‡ªå®šä¹‰ <code>ThreadPoolExecutor</code>ã€‚</p></blockquote><hr><h3 id=-é€‚ç”¨åœºæ™¯åˆ†æ-1>âš¡ <strong>é€‚ç”¨åœºæ™¯åˆ†æ</strong></h3><ul><li><strong>CPU å¯†é›†å‹</strong>ï¼ˆè®¡ç®—é€»è¾‘ä¸ºä¸»ï¼‰â†’ <code>FixedThreadPool</code>ï¼ˆé™åˆ¶å¹¶å‘çº¿ç¨‹æ•°ï¼‰ã€‚</li><li><strong>I/O å¯†é›†å‹</strong>ï¼ˆç­‰å¾…èµ„æºä¸ºä¸»ï¼‰â†’ <code>CachedThreadPool</code>ï¼ˆå¼¹æ€§æ‰©ç¼©å®¹ï¼‰ã€‚</li><li><strong>é¡ºåºæ‰§è¡Œéœ€æ±‚</strong> â†’ <code>SingleThreadExecutor</code>ï¼ˆé¿å…å¹¶å‘é—®é¢˜ï¼‰ã€‚</li><li><strong>å®šæ—¶/å‘¨æœŸä»»åŠ¡</strong> â†’ <code>ScheduledThreadPool</code>ï¼ˆæ›¿ä»£ <code>Timer</code>ï¼‰ã€‚</li><li><strong>å¹¶è¡Œåˆ†æ²»ä»»åŠ¡</strong> â†’ <code>WorkStealingPool</code>ï¼ˆé«˜æ•ˆåˆ©ç”¨å¤šæ ¸ï¼‰ã€‚</li></ul><hr><h3 id=-åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹>ğŸ’» <strong>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</strong></h3><h4 id=å›ºå®šçº¿ç¨‹æ± å¤„ç†å¹¶å‘ä»»åŠ¡><strong>å›ºå®šçº¿ç¨‹æ± å¤„ç†å¹¶å‘ä»»åŠ¡</strong></h4><pre tabindex=0><code>ExecutorService executor = Executors.newFixedThreadPool(4);
for (int i = 0; i &lt; 10; i++) {
    executor.submit(() -&gt; {
        System.out.println(&#34;Task executed by &#34; + Thread.currentThread().getName());
    });
}
executor.shutdown();  // åœæ­¢æ¥æ”¶æ–°ä»»åŠ¡
executor.awaitTermination(60, TimeUnit.SECONDS);  // ç­‰å¾…å‰©ä½™ä»»åŠ¡å®Œæˆ
</code></pre><h4 id=å®šæ—¶ä»»åŠ¡è°ƒåº¦><strong>å®šæ—¶ä»»åŠ¡è°ƒåº¦</strong></h4><pre tabindex=0><code>ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(2);
// å»¶è¿Ÿ 3 ç§’æ‰§è¡Œ
scheduler.schedule(() -&gt; System.out.println(&#34;Delayed Task&#34;), 3, TimeUnit.SECONDS);
// å‘¨æœŸä»»åŠ¡ï¼šåˆå§‹å»¶è¿Ÿ 1 ç§’ï¼Œæ¯ 2 ç§’æ‰§è¡Œä¸€æ¬¡
scheduler.scheduleAtFixedRate(() -&gt; System.out.println(&#34;Periodic Task&#34;), 1, 2, TimeUnit.SECONDS);
</code></pre><h4 id=è·å–å¼‚æ­¥ç»“æœfuture><strong>è·å–å¼‚æ­¥ç»“æœï¼ˆFutureï¼‰</strong></h4><pre tabindex=0><code>ExecutorService executor = Executors.newCachedThreadPool();
Future&lt;Integer&gt; future = executor.submit(() -&gt; {
    TimeUnit.SECONDS.sleep(1);
    return 42;
});
Integer result = future.get();  // é˜»å¡ç›´åˆ°ç»“æœå°±ç»ª
System.out.println(&#34;Result: &#34; + result);  // è¾“å‡º: 42
</code></pre><hr><h3 id=-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ-2>âš ï¸ <strong>æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></h3><ol><li><p><strong>å…³é—­çº¿ç¨‹æ± </strong>
å¿…é¡»è°ƒç”¨ <code>shutdown()</code> æˆ– <code>shutdownNow()</code> é¿å…èµ„æºæ³„æ¼ï¼Œæ¨èç»“åˆ <code>awaitTermination</code> ç­‰å¾…ä»»åŠ¡ç»“æŸã€‚</p></li><li><p><strong>å¼‚å¸¸å¤„ç†</strong>
ä»»åŠ¡å†…éƒ¨éœ€æ•è·å¼‚å¸¸ï¼Œå¦åˆ™çº¿ç¨‹å¯èƒ½å› æœªå¤„ç†å¼‚å¸¸è€Œç»ˆæ­¢ï¼š</p><pre tabindex=0><code>executor.submit(() -&gt; {
    try { /* ä¸šåŠ¡ä»£ç  */ } 
    catch (Exception e) { e.printStackTrace(); }
});
</code></pre></li><li><p><strong>é¿å…æ— ç•Œé˜Ÿåˆ—</strong>
ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ <code>ThreadPoolExecutor</code> è‡ªå®šä¹‰é˜Ÿåˆ—å¤§å°ï¼ˆå¦‚ <code>ArrayBlockingQueue</code>ï¼‰ã€‚</p></li><li><p><strong>è°¨æ…ä½¿ç”¨ <code>CachedThreadPool</code></strong>
å¯èƒ½å› ä»»åŠ¡æ¿€å¢åˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå¯¼è‡´èµ„æºè€—å°½ã€‚</p></li></ol><hr><h3 id=-æ€»ç»“-5>ğŸ’ <strong>æ€»ç»“</strong></h3><p>Executors çš„æ ¸å¿ƒä»·å€¼åœ¨äº<strong>é™ä½å¹¶å‘ç¼–ç¨‹å¤æ‚åº¦</strong>ï¼Œé€šè¿‡é¢„ç½®çº¿ç¨‹æ± æ»¡è¶³å¸¸è§åœºæ™¯éœ€æ±‚ã€‚ä½†éœ€æ³¨æ„ï¼š</p><ul><li>âœ… <strong>ç®€å•åœºæ™¯</strong>ï¼šç›´æ¥ä½¿ç”¨ <code>Executors</code> å·¥å‚æ–¹æ³•å¿«é€Ÿå¼€å‘ã€‚</li><li>âš ï¸ <strong>å¤æ‚/ç”Ÿäº§ç¯å¢ƒ</strong>ï¼šæ”¹ç”¨ <code>ThreadPoolExecutor</code> è‡ªå®šä¹‰å‚æ•°ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ã€é˜Ÿåˆ—ç±»å‹ã€æ‹’ç»ç­–ç•¥ï¼‰ã€‚</li><li>ğŸ”§ <strong>çº¿ç¨‹èµ„æºç®¡ç†</strong>ï¼šåŠ¡å¿…å…³é—­çº¿ç¨‹æ± å¹¶å¤„ç†ä»»åŠ¡å¼‚å¸¸ï¼Œä¿éšœç³»ç»Ÿç¨³å®šæ€§ã€‚</li></ul><h2 id=è‡ªå®šä¹‰-threadpool>è‡ªå®šä¹‰ ThreadPool</h2><p>åœ¨ Java ä¸­è‡ªå®šä¹‰çº¿ç¨‹æ± ä¸»è¦é€šè¿‡ <code>ThreadPoolExecutor</code> ç±»å®ç°ï¼Œç›¸æ¯” <code>Executors</code> æä¾›çš„é¢„è®¾çº¿ç¨‹æ± ï¼Œè‡ªå®šä¹‰æ–¹æ¡ˆèƒ½è§„é¿èµ„æºè€—å°½é£é™©ï¼ˆå¦‚æ— ç•Œé˜Ÿåˆ—å¯¼è‡´å†…å­˜æº¢å‡ºï¼‰ï¼Œå¹¶é’ˆå¯¹ä¸šåŠ¡åœºæ™¯ä¼˜åŒ–æ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤å’Œå…³é”®é…ç½®ï¼š</p><hr><h3 id=-æ ¸å¿ƒå‚æ•°é…ç½®7å¤§æ ¸å¿ƒå‚æ•°>ğŸ”§ æ ¸å¿ƒå‚æ•°é…ç½®ï¼ˆ7å¤§æ ¸å¿ƒå‚æ•°ï¼‰</h3><p><code>ThreadPoolExecutor</code> çš„æ„é€ å‡½æ•°åŒ…å«ä»¥ä¸‹å‚æ•°ï¼Œéœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼š</p><ol><li><strong><code>corePoolSize</code>ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰</strong><ul><li>çº¿ç¨‹æ± å¸¸é©»çš„æœ€å°çº¿ç¨‹æ•°ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šé”€æ¯ï¼ˆé™¤éè®¾ç½® <code>allowCoreThreadTimeOut=true</code>ï¼‰ã€‚</li><li><strong>å»ºè®®</strong>ï¼šCPU å¯†é›†å‹ä»»åŠ¡è®¾ä¸º <code>CPU æ ¸æ•°</code>ï¼ˆ<code>Runtime.getRuntime().availableProcessors()</code>ï¼‰ï¼ŒIO å¯†é›†å‹ä»»åŠ¡å‚è€ƒå…¬å¼ï¼š<code>çº¿ç¨‹æ•° = CPUæ ¸æ•° / (1 - é˜»å¡ç³»æ•°)</code>ï¼ˆé˜»å¡ç³»æ•°å– 0.8~0.9ï¼‰ã€‚</li></ul></li><li><strong><code>maximumPoolSize</code>ï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰</strong><ul><li>çº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ï¼ˆåŒ…å«æ ¸å¿ƒçº¿ç¨‹ï¼‰ã€‚</li><li><strong>å»ºè®®</strong>ï¼šIO å¯†é›†å‹ä»»åŠ¡å¯è®¾ä¸º <code>corePoolSize * 2</code>ï¼Œé¿å…çªå‘æµé‡å¯¼è‡´ä»»åŠ¡å †ç§¯ã€‚</li></ul></li><li><strong><code>keepAliveTime</code> + <code>unit</code>ï¼ˆçº¿ç¨‹ç©ºé—²è¶…æ—¶ï¼‰</strong><ul><li>éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²è¶…è¿‡æ­¤æ—¶é—´ä¼šè¢«å›æ”¶ã€‚</li><li><strong>å»ºè®®</strong>ï¼šè®¾ä¸º 30~60 ç§’ï¼ˆå¦‚ <code>TimeUnit.SECONDS</code>ï¼‰ï¼Œå¹³è¡¡èµ„æºå¤ç”¨ä¸é‡Šæ”¾ã€‚</li></ul></li><li><strong><code>workQueue</code>ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰</strong><ul><li>å­˜å‚¨å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œ<strong>å¿…é¡»ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</strong>ï¼ˆå¦‚ <code>LinkedBlockingQueue(capacity)</code>ï¼‰é˜²æ­¢ OOMã€‚</li><li>é˜Ÿåˆ—ç±»å‹é€‰æ‹©ï¼š<ul><li><code>ArrayBlockingQueue</code>ï¼šå›ºå®šå®¹é‡ï¼Œå…¬å¹³é”ã€‚</li><li><code>LinkedBlockingQueue</code>ï¼šé»˜è®¤æ— ç•Œï¼Œéœ€æ˜¾å¼æŒ‡å®šå®¹é‡ï¼ˆå¦‚ <code>new LinkedBlockingQueue&lt;>(100)</code>ï¼‰ã€‚</li><li><code>SynchronousQueue</code>ï¼šç›´æ¥ç§»äº¤ä»»åŠ¡ï¼Œé…åˆ <code>maximumPoolSize</code> ä½¿ç”¨ï¼ˆé€‚åˆçŸ­ä»»åŠ¡ï¼‰ã€‚</li></ul></li></ul></li><li><strong><code>threadFactory</code>ï¼ˆçº¿ç¨‹å·¥å‚ï¼‰</strong><ul><li>è‡ªå®šä¹‰çº¿ç¨‹åç§°ã€ä¼˜å…ˆçº§ã€å®ˆæŠ¤çŠ¶æ€ç­‰ï¼Œä¾¿äºç›‘æ§å’Œæ’æŸ¥é—®é¢˜ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>NamedThreadFactory</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ThreadFactory</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>AtomicInteger</span><span class=w> </span><span class=n>counter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AtomicInteger</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>prefix</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>NamedThreadFactory</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>prefix</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>prefix</span><span class=p>;</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=nf>newThread</span><span class=p>(</span><span class=n>Runnable</span><span class=w> </span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>prefix</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;-&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>counter</span><span class=p>.</span><span class=na>getAndIncrement</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>t</span><span class=p>.</span><span class=na>setDaemon</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span><span class=w> </span><span class=c1>// éå®ˆæŠ¤çº¿ç¨‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>t</span><span class=p>.</span><span class=na>setPriority</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>NORM_PRIORITY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li></ul></li><li><strong><code>handler</code>ï¼ˆæ‹’ç»ç­–ç•¥ï¼‰</strong><ul><li>å½“ä»»åŠ¡é˜Ÿåˆ—æ»¡ä¸”çº¿ç¨‹æ•°è¾¾ä¸Šé™æ—¶è§¦å‘ï¼Œå†…ç½®ç­–ç•¥æœ‰ï¼š<ul><li><code>AbortPolicy</code>ï¼ˆé»˜è®¤ï¼‰ï¼šæŠ›å‡º <code>RejectedExecutionException</code>ã€‚</li><li><code>CallerRunsPolicy</code>ï¼šç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹ç›´æ¥æ‰§è¡Œã€‚</li><li><code>DiscardPolicy</code>ï¼šé™é»˜ä¸¢å¼ƒä»»åŠ¡ã€‚</li><li><code>DiscardOldestPolicy</code>ï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€æ—§çš„ä»»åŠ¡ï¼Œé‡è¯•æäº¤ã€‚</li></ul></li><li>è‡ªå®šä¹‰ç­–ç•¥ï¼ˆå¦‚è®°å½•æ—¥å¿—æˆ–é™çº§å¤„ç†ï¼‰ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LogRejectedHandler</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>RejectedExecutionHandler</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>rejectedExecution</span><span class=p>(</span><span class=n>Runnable</span><span class=w> </span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>ThreadPoolExecutor</span><span class=w> </span><span class=n>executor</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Task rejected: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// å¯é€‰ï¼šé‡è¯•æˆ–æŒä¹…åŒ–ä»»åŠ¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li></ul></li></ol><hr><h3 id=-å®Œæ•´é…ç½®ç¤ºä¾‹>âš™ï¸ å®Œæ•´é…ç½®ç¤ºä¾‹</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.util.concurrent.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CustomThreadPool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>ThreadPoolExecutor</span><span class=w> </span><span class=nf>createPool</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>corePoolSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Runtime</span><span class=p>.</span><span class=na>getRuntime</span><span class=p>().</span><span class=na>availableProcessors</span><span class=p>();</span><span class=w> </span><span class=c1>// CPUæ ¸æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>maxPoolSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>corePoolSize</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span><span class=w> </span><span class=n>queue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LinkedBlockingQueue</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>100</span><span class=p>);</span><span class=w> </span><span class=c1>// æœ‰ç•Œé˜Ÿåˆ—</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ThreadFactory</span><span class=w> </span><span class=n>factory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NamedThreadFactory</span><span class=p>(</span><span class=s>&#34;business-pool&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RejectedExecutionHandler</span><span class=w> </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThreadPoolExecutor</span><span class=p>.</span><span class=na>CallerRunsPolicy</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>corePoolSize</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>maxPoolSize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>60</span><span class=p>,</span><span class=w> </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>queue</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>factory</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ä½¿ç”¨ç¤ºä¾‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ThreadPoolExecutor</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createPool</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Task executed by: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>shutdown</span><span class=p>();</span><span class=w> </span><span class=c1>// ç¨‹åºç»“æŸå‰å…³é—­çº¿ç¨‹æ± </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=-é«˜çº§ä¼˜åŒ–æŠ€å·§>ğŸ› ï¸ é«˜çº§ä¼˜åŒ–æŠ€å·§</h3><ol><li><strong>åŠ¨æ€å‚æ•°è°ƒæ•´</strong>
é€šè¿‡ <code>setCorePoolSize()</code> å’Œ <code>setMaximumPoolSize()</code> è¿è¡Œæ—¶è°ƒæ•´çº¿ç¨‹æ•°ï¼Œé€‚åº”æµé‡æ³¢åŠ¨ã€‚</li><li><strong>ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€</strong>
å®šæœŸé‡‡é›†æŒ‡æ ‡ï¼ˆå¦‚ä»»åŠ¡æ•°ã€æ´»è·ƒçº¿ç¨‹æ•°ã€é˜Ÿåˆ—å¤§å°ï¼‰ï¼š<pre tabindex=0><code>executor.getTaskCount();     // æ€»ä»»åŠ¡æ•°
executor.getCompletedTaskCount(); // å·²å®Œæˆä»»åŠ¡æ•°
executor.getQueue().size(); // é˜Ÿåˆ—ç§¯å‹é‡
</code></pre></li><li><strong>ä¼˜é›…å…³é—­</strong>
ç¡®ä¿ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†é€€å‡ºç¨‹åºï¼š<pre tabindex=0><code>executor.shutdown(); // åœæ­¢æ¥æ”¶æ–°ä»»åŠ¡
if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {
    executor.shutdownNow(); // å¼ºåˆ¶ç»ˆæ­¢å‰©ä½™ä»»åŠ¡
}
</code></pre></li></ol><hr><h3 id=-ç”Ÿäº§ç¯å¢ƒå»ºè®®>âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®</h3><ul><li><strong>é¿å…ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—</strong>ï¼šé˜²æ­¢ä»»åŠ¡å †ç§¯å¯¼è‡´ OOMã€‚</li><li><strong>çº¿ç¨‹å‘½åè§„èŒƒ</strong>ï¼šé€šè¿‡è‡ªå®šä¹‰ <code>ThreadFactory</code> æ˜ç¡®çº¿ç¨‹ç”¨é€”ï¼ˆå¦‚ <code>order-thread-1</code>ï¼‰ï¼Œç®€åŒ–æ—¥å¿—æ’æŸ¥ã€‚</li><li>æ‹’ç»ç­–ç•¥é€‰æ‹©ï¼š<ul><li>æ ¸å¿ƒä¸šåŠ¡ç”¨ <code>CallerRunsPolicy</code> ä¿è¯å¯ç”¨æ€§ã€‚</li><li>éå…³é”®ä»»åŠ¡ç”¨ <code>DiscardPolicy</code> å‡è½»è´Ÿè½½ã€‚</li></ul></li><li><strong>èµ„æºéš”ç¦»</strong>ï¼šä¸åŒä¸šåŠ¡çº¿ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œé¿å…äº’ç›¸å½±å“ã€‚</li></ul><hr><blockquote><p>é€šè¿‡è‡ªå®šä¹‰ <code>ThreadPoolExecutor</code>ï¼Œå¼€å‘è€…å¯ç²¾å‡†æ§åˆ¶çº¿ç¨‹èµ„æºï¼Œåœ¨<strong>é«˜å¹¶å‘</strong>ã€<strong>å¼‚æ­¥ä»»åŠ¡è°ƒåº¦</strong>åŠ<strong>èµ„æºæ•æ„Ÿå‹åº”ç”¨</strong>ä¸­å®ç°æ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡ã€‚ç›¸æ¯” <code>Executors</code> çš„é¢„è®¾æ–¹æ¡ˆï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± æ˜¯ç”Ÿäº§ç¯å¢ƒçš„å¿…é€‰é¡¹ã€‚</p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/java/>Java</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Oct 22, 2025 16:26 CST</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/nowcoderjava-2/><div class=article-details><h2 class=article-title>ã€NowCoderã€‘JAVA 2</h2></div></a></article><article><a href=/p/nowcoderjava/><div class=article-details><h2 class=article-title>ã€NowCoderã€‘JAVA</h2></div></a></article><article><a href=/p/templejava-c/><div class=article-details><h2 class=article-title>ã€Templeã€‘Java & C</h2></div></a></article><article><a href=/p/javamodule/><div class=article-details><h2 class=article-title>ã€Javaã€‘Module</h2></div></a></article><article><a href=/p/javaexception/><div class=article-details><h2 class=article-title>ã€Javaã€‘Exception</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 é£é¸¿è¸é›ªæ³¥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>