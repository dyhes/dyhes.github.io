<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="é—®é¢˜ github action known host GitHub Actions è¿æ¥æœåŠ¡å™¨æ—¶æŠ¥é”™ Host key verification failedï¼Œæ˜¯ç”±äº Actions ç¯å¢ƒé¦–æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ç¼ºå¤±ä¸»æœºå¯†é’¥éªŒè¯æ‰€è‡´ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š\nğŸ” é”™è¯¯åŸå›  ä¸»æœºå¯†é’¥æœªä¿¡ä»»ï¼šGitHub Actions çš„è™šæ‹Ÿæœºé¦–æ¬¡é€šè¿‡ SSH è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œä¼šæ£€æŸ¥æœåŠ¡å™¨çš„ä¸»æœºå¯†é’¥ï¼ˆhost keyï¼‰ã€‚è‹¥å¯†é’¥æœªé¢„å…ˆå­˜å‚¨åœ¨ known_hosts æ–‡ä»¶ä¸­ï¼ŒSSH ä¼šå› å®‰å…¨ç­–ç•¥æ‹’ç»è¿æ¥ã€‚ ä¸æœ¬åœ°ç¯å¢ƒçš„å·®å¼‚ï¼šæœ¬åœ° Mac å·²é€šè¿‡æ‰‹åŠ¨è¿æ¥ï¼ˆè¾“å…¥ yesï¼‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° ~/.ssh/known_hostsï¼Œä½† Actions ç¯å¢ƒæ˜¯å…¨æ–°çš„ï¼Œæ— æ­¤è®°å½•ã€‚ âœ… è§£å†³æ–¹æ¡ˆ æ–¹æ³•ä¸€ï¼šæå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° known_hostsï¼ˆæ¨èï¼‰ åœ¨ Actions å·¥ä½œæµä¸­ï¼Œä½¿ç”¨ ssh-keyscan ä¸»åŠ¨è·å–æœåŠ¡å™¨å¯†é’¥å¹¶å†™å…¥ known_hosts æ–‡ä»¶ï¼š\nsteps: - name: Add server host key to known_hosts run: | mkdir -p ~/.ssh ssh-keyscan your_server_ip >> ~/.ssh/known_hosts # æ›¿æ¢ your_server_ip chmod 600 ~/.ssh/known_hosts ğŸ“Œ åŸç†ï¼šssh-keyscan è·å–æœåŠ¡å™¨å…¬é’¥å¹¶è¿½åŠ åˆ° known_hostsï¼Œé¿å…é¦–æ¬¡è¿æ¥æ—¶çš„äº¤äº’æç¤ºã€‚\n"><title>ã€Postopia Dev Logã€‘Week 16</title><link rel=canonical href=https://dyhes.github.io/p/postopia-dev-logweek-16/><link rel=stylesheet href=/scss/style.min.f7091bff8043bd3e53b22be6c05dd86b506e8dec4d0d75d249d2dfb0fe074a46.css><meta property='og:title' content="ã€Postopia Dev Logã€‘Week 16"><meta property='og:description' content="é—®é¢˜ github action known host GitHub Actions è¿æ¥æœåŠ¡å™¨æ—¶æŠ¥é”™ Host key verification failedï¼Œæ˜¯ç”±äº Actions ç¯å¢ƒé¦–æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ç¼ºå¤±ä¸»æœºå¯†é’¥éªŒè¯æ‰€è‡´ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š\nğŸ” é”™è¯¯åŸå›  ä¸»æœºå¯†é’¥æœªä¿¡ä»»ï¼šGitHub Actions çš„è™šæ‹Ÿæœºé¦–æ¬¡é€šè¿‡ SSH è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œä¼šæ£€æŸ¥æœåŠ¡å™¨çš„ä¸»æœºå¯†é’¥ï¼ˆhost keyï¼‰ã€‚è‹¥å¯†é’¥æœªé¢„å…ˆå­˜å‚¨åœ¨ known_hosts æ–‡ä»¶ä¸­ï¼ŒSSH ä¼šå› å®‰å…¨ç­–ç•¥æ‹’ç»è¿æ¥ã€‚ ä¸æœ¬åœ°ç¯å¢ƒçš„å·®å¼‚ï¼šæœ¬åœ° Mac å·²é€šè¿‡æ‰‹åŠ¨è¿æ¥ï¼ˆè¾“å…¥ yesï¼‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° ~/.ssh/known_hostsï¼Œä½† Actions ç¯å¢ƒæ˜¯å…¨æ–°çš„ï¼Œæ— æ­¤è®°å½•ã€‚ âœ… è§£å†³æ–¹æ¡ˆ æ–¹æ³•ä¸€ï¼šæå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° known_hostsï¼ˆæ¨èï¼‰ åœ¨ Actions å·¥ä½œæµä¸­ï¼Œä½¿ç”¨ ssh-keyscan ä¸»åŠ¨è·å–æœåŠ¡å™¨å¯†é’¥å¹¶å†™å…¥ known_hosts æ–‡ä»¶ï¼š\nsteps: - name: Add server host key to known_hosts run: | mkdir -p ~/.ssh ssh-keyscan your_server_ip >> ~/.ssh/known_hosts # æ›¿æ¢ your_server_ip chmod 600 ~/.ssh/known_hosts ğŸ“Œ åŸç†ï¼šssh-keyscan è·å–æœåŠ¡å™¨å…¬é’¥å¹¶è¿½åŠ åˆ° known_hostsï¼Œé¿å…é¦–æ¬¡è¿æ¥æ—¶çš„äº¤äº’æç¤ºã€‚\n"><meta property='og:url' content='https://dyhes.github.io/p/postopia-dev-logweek-16/'><meta property='og:site_name' content='é£é¸¿è¸é›ªæ³¥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Postopia'><meta property='article:published_time' content='2025-05-26T00:00:00+00:00'><meta property='article:modified_time' content='2025-10-22T16:27:30+08:00'><meta name=twitter:title content="ã€Postopia Dev Logã€‘Week 16"><meta name=twitter:description content="é—®é¢˜ github action known host GitHub Actions è¿æ¥æœåŠ¡å™¨æ—¶æŠ¥é”™ Host key verification failedï¼Œæ˜¯ç”±äº Actions ç¯å¢ƒé¦–æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ç¼ºå¤±ä¸»æœºå¯†é’¥éªŒè¯æ‰€è‡´ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š\nğŸ” é”™è¯¯åŸå›  ä¸»æœºå¯†é’¥æœªä¿¡ä»»ï¼šGitHub Actions çš„è™šæ‹Ÿæœºé¦–æ¬¡é€šè¿‡ SSH è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œä¼šæ£€æŸ¥æœåŠ¡å™¨çš„ä¸»æœºå¯†é’¥ï¼ˆhost keyï¼‰ã€‚è‹¥å¯†é’¥æœªé¢„å…ˆå­˜å‚¨åœ¨ known_hosts æ–‡ä»¶ä¸­ï¼ŒSSH ä¼šå› å®‰å…¨ç­–ç•¥æ‹’ç»è¿æ¥ã€‚ ä¸æœ¬åœ°ç¯å¢ƒçš„å·®å¼‚ï¼šæœ¬åœ° Mac å·²é€šè¿‡æ‰‹åŠ¨è¿æ¥ï¼ˆè¾“å…¥ yesï¼‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° ~/.ssh/known_hostsï¼Œä½† Actions ç¯å¢ƒæ˜¯å…¨æ–°çš„ï¼Œæ— æ­¤è®°å½•ã€‚ âœ… è§£å†³æ–¹æ¡ˆ æ–¹æ³•ä¸€ï¼šæå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° known_hostsï¼ˆæ¨èï¼‰ åœ¨ Actions å·¥ä½œæµä¸­ï¼Œä½¿ç”¨ ssh-keyscan ä¸»åŠ¨è·å–æœåŠ¡å™¨å¯†é’¥å¹¶å†™å…¥ known_hosts æ–‡ä»¶ï¼š\nsteps: - name: Add server host key to known_hosts run: | mkdir -p ~/.ssh ssh-keyscan your_server_ip >> ~/.ssh/known_hosts # æ›¿æ¢ your_server_ip chmod 600 ~/.ssh/known_hosts ğŸ“Œ åŸç†ï¼šssh-keyscan è·å–æœåŠ¡å™¨å…¬é’¥å¹¶è¿½åŠ åˆ° known_hostsï¼Œé¿å…é¦–æ¬¡è¿æ¥æ—¶çš„äº¤äº’æç¤ºã€‚\n"><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b567f26f71c49c33.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>é£é¸¿è¸é›ªæ³¥</a></h1><h2 class=site-description>æ²¡æœ‰è®°å½•ï¼Œå°±æ²¡æœ‰å‘ç”Ÿ</h2></div></header><ol class=menu-social><li><a href=https://leetcode.cn/u/dyhes/ target=_blank title=LeetCode rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 13h7.5"/><path d="M9.424 7.268l4.999-4.999"/><path d="M16.633 16.644l-2.402 2.415a3.189 3.189.0 01-4.524.0l-3.77-3.787a3.223 3.223.0 010-4.544l3.77-3.787a3.189 3.189.0 014.524.0l2.302 2.313"/></svg></a></li><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=mailto:1325574784@qq.com target=_blank title=Mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 19H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v5.5"/><path d="M3 7l9 6 9-6"/><path d="M19 16l-2 3h4l-2 3"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/tags/><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#é—®é¢˜>é—®é¢˜</a></li><li><a href=#github-action-known-host>github action known host</a><ol><li><a href=#-é”™è¯¯åŸå› >ğŸ” é”™è¯¯åŸå› </a></li><li><a href=#-è§£å†³æ–¹æ¡ˆ>âœ… è§£å†³æ–¹æ¡ˆ</a><ol><li><a href=#æ–¹æ³•ä¸€æå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ°-known_hostsæ¨è>æ–¹æ³•ä¸€ï¼šæå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° <code>known_hosts</code>ï¼ˆæ¨èï¼‰</a></li><li><a href=#æ–¹æ³•äºŒç¦ç”¨ä¸¥æ ¼ä¸»æœºå¯†é’¥æ£€æŸ¥ä¸´æ—¶æ–¹æ¡ˆ>æ–¹æ³•äºŒï¼šç¦ç”¨ä¸¥æ ¼ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰</a></li></ol></li><li><a href=#-å®Œæ•´-github-actions-é…ç½®ç¤ºä¾‹>ğŸ“ å®Œæ•´ GitHub Actions é…ç½®ç¤ºä¾‹</a></li><li><a href=#-å…³é”®é…ç½®è¯´æ˜>ğŸ”§ å…³é”®é…ç½®è¯´æ˜</a></li><li><a href=#-æ³¨æ„äº‹é¡¹>âš ï¸ æ³¨æ„äº‹é¡¹</a></li><li><a href=#redis-æ— æ³•è¿œç¨‹è®¿é—®>Redis æ— æ³•è¿œç¨‹è®¿é—®</a></li><li><a href=#kafka-é…ç½®è¿œç¨‹ä»è¿æ¥æœ¬åœ°>kafka é…ç½®è¿œç¨‹ä»è¿æ¥æœ¬åœ°</a></li><li><a href=#1-port-is-deprecated-please-use-kafka_advertised_listeners-instead>1 port is deprecated. Please use KAFKA_ADVERTISED_LISTENERS instead.</a></li><li><a href=#2-å®¿ä¸»æœºæ— æ³•è®¿é—®minikube-é›†ç¾¤>2 å®¿ä¸»æœºæ— æ³•è®¿é—®minikube é›†ç¾¤</a></li><li><a href=#3-mysql-æ¢é’ˆå¤±æ´»>3 mysql æ¢é’ˆå¤±æ´»</a></li><li><a href=#4-æœåŠ¡å™¨ä¸Š-docker-compose-æŠ¥é”™>4 æœåŠ¡å™¨ä¸Š docker-compose æŠ¥é”™</a></li></ol></li><li><a href=#minikube-é•œåƒ>Minikube é•œåƒ</a><ol><li><a href=#æ–¹æ³•ä¸€ä½¿ç”¨><strong>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ <code>minikube image load</code> å‘½ä»¤</strong></a></li><li><a href=#æ–¹æ³•äºŒç›´æ¥ä½¿ç”¨-minikube-çš„-docker-ç¯å¢ƒ><strong>æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ Minikube çš„ Docker ç¯å¢ƒ</strong></a></li><li><a href=#æ³¨æ„äº‹é¡¹><strong>æ³¨æ„äº‹é¡¹</strong></a></li><li><a href=#éªŒè¯é•œåƒæ˜¯å¦ç”Ÿæ•ˆ><strong>éªŒè¯é•œåƒæ˜¯å¦ç”Ÿæ•ˆ</strong></a></li></ol></li><li><a href=#kubectl-apply--f>kubectl apply -f</a><ol><li><a href=#æ ¸å¿ƒåŠŸèƒ½><strong>æ ¸å¿ƒåŠŸèƒ½</strong></a></li><li><a href=#åŸºæœ¬ç”¨æ³•><strong>åŸºæœ¬ç”¨æ³•</strong></a></li><li><a href=#å…¸å‹åº”ç”¨åœºæ™¯><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></a></li><li><a href=#è¿›é˜¶å‚æ•°ä¸æŠ€å·§><strong>è¿›é˜¶å‚æ•°ä¸æŠ€å·§</strong></a></li><li><a href=#å¸¸è§é—®é¢˜ä¸è§£å†³><strong>å¸¸è§é—®é¢˜ä¸è§£å†³</strong></a></li><li><a href=#æœ€ä½³å®è·µ><strong>æœ€ä½³å®è·µ</strong></a></li></ol></li><li><a href=#æœåŠ¡ç±»å‹>æœåŠ¡ç±»å‹</a><ol><li><a href=#clusteripé»˜è®¤ç±»å‹>ClusterIPï¼ˆé»˜è®¤ç±»å‹ï¼‰</a></li><li><a href=#nodeport>NodePort</a></li><li><a href=#loadbalancer>LoadBalancer</a></li><li><a href=#externalname>ExternalName</a></li><li><a href=#ç±»å‹å¯¹æ¯”ä¸é€‰å‹å»ºè®®>ç±»å‹å¯¹æ¯”ä¸é€‰å‹å»ºè®®</a></li><li><a href=#åº•å±‚å®ç°æœºåˆ¶>åº•å±‚å®ç°æœºåˆ¶</a></li></ol></li><li><a href=#minikube-tunnel>minikube tunnel</a><ol><li><a href=#åŸå› åˆ†æ><strong>åŸå› åˆ†æ</strong></a></li><li><a href=#è§£å†³æ–¹æ¡ˆ><strong>è§£å†³æ–¹æ¡ˆ</strong></a><ol><li><a href=#ä½¿ç”¨><strong>ä½¿ç”¨ <code>minikube tunnel</code> å‘½ä»¤</strong></a></li><li><a href=#é€šè¿‡><strong>é€šè¿‡ <code>minikube service</code> å‘½ä»¤è®¿é—®</strong></a></li><li><a href=#æ‰‹åŠ¨ä½¿ç”¨-minikube-çš„-ip-å’Œ-nodeport><strong>æ‰‹åŠ¨ä½¿ç”¨ Minikube çš„ IP å’Œ NodePort</strong></a></li><li><a href=#æ£€æŸ¥æœåŠ¡é…ç½®><strong>æ£€æŸ¥æœåŠ¡é…ç½®</strong></a></li></ol></li><li><a href=#é™„åŠ è¯´æ˜><strong>é™„åŠ è¯´æ˜</strong></a></li></ol></li><li><a href=#pv--pvc>PV & PVC</a><ol><li><a href=#1-persistentvolumepv><strong>1. PersistentVolumeï¼ˆPVï¼‰</strong></a></li><li><a href=#2-persistentvolumeclaimpvc><strong>2. PersistentVolumeClaimï¼ˆPVCï¼‰</strong></a></li><li><a href=#3-pvä¸pvcçš„å…³ç³»><strong>3. PVä¸PVCçš„å…³ç³»</strong></a></li><li><a href=#4-ä½¿ç”¨åœºæ™¯å¯¹æ¯”><strong>4. ä½¿ç”¨åœºæ™¯å¯¹æ¯”</strong></a></li><li><a href=#5-å¸¸è§é—®é¢˜><strong>5. å¸¸è§é—®é¢˜</strong></a></li></ol></li><li><a href=#statefulset--deployment>StatefulSet & Deployment</a><ol><li><a href=#1-é€‚ç”¨åœºæ™¯><strong>1. é€‚ç”¨åœºæ™¯</strong></a></li><li><a href=#2-pod-æ ‡è¯†ä¸ç½‘ç»œ><strong>2. Pod æ ‡è¯†ä¸ç½‘ç»œ</strong></a></li><li><a href=#3-å­˜å‚¨ç®¡ç†><strong>3. å­˜å‚¨ç®¡ç†</strong></a></li><li><a href=#4-ç”Ÿå‘½å‘¨æœŸç®¡ç†><strong>4. ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></a></li><li><a href=#5-æ‰©ç¼©å®¹ä¸åˆ é™¤è¡Œä¸º><strong>5. æ‰©ç¼©å®¹ä¸åˆ é™¤è¡Œä¸º</strong></a></li><li><a href=#æ€»ç»“å¯¹æ¯”è¡¨><strong>æ€»ç»“å¯¹æ¯”è¡¨</strong></a></li><li><a href=#é€‰æ‹©å»ºè®®><strong>é€‰æ‹©å»ºè®®</strong></a></li></ol></li><li><a href=#docker-compose-rebuild>Docker Compose Rebuild</a><ol><li><a href=#å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ„å»º><strong>å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ„å»º</strong></a></li><li><a href=#å¼ºåˆ¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ><strong>å¼ºåˆ¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ</strong></a></li><li><a href=#å¹¶è¡Œæ„å»ºå¤šä¸ªæœåŠ¡><strong>å¹¶è¡Œæ„å»ºå¤šä¸ªæœåŠ¡</strong></a></li><li><a href=#é€‰æ‹©æ€§é‡å»ºæŒ‡å®šæœåŠ¡><strong>é€‰æ‹©æ€§é‡å»ºæŒ‡å®šæœåŠ¡</strong></a></li><li><a href=#åˆ é™¤ä¸´æ—¶å®¹å™¨å’Œé•œåƒ><strong>åˆ é™¤ä¸´æ—¶å®¹å™¨å’Œé•œåƒ</strong></a></li><li><a href=#ç»„åˆç­–ç•¥ç¤ºä¾‹><strong>ç»„åˆç­–ç•¥ç¤ºä¾‹</strong></a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ol></li><li><a href=#docker-compose>Docker compose</a><ol><li><a href=#åŸºç¡€è¿è¡Œæµç¨‹>åŸºç¡€è¿è¡Œæµç¨‹</a></li><li><a href=#yaml-æ–‡ä»¶æ ¸å¿ƒé…ç½®>YAML æ–‡ä»¶æ ¸å¿ƒé…ç½®</a></li><li><a href=#é«˜çº§è¿è¡ŒæŠ€å·§>é«˜çº§è¿è¡ŒæŠ€å·§</a></li><li><a href=#è·¨å¹³å°æ³¨æ„äº‹é¡¹>è·¨å¹³å°æ³¨æ„äº‹é¡¹</a></li><li><a href=#æ•…éšœæ’æŸ¥æŒ‡å—>æ•…éšœæ’æŸ¥æŒ‡å—</a></li><li><a href=#åŸºç¡€æŒ‡å®šæ–¹æ³•>åŸºç¡€æŒ‡å®šæ–¹æ³•</a></li><li><a href=#å…¸å‹åº”ç”¨åœºæ™¯-1>å…¸å‹åº”ç”¨åœºæ™¯</a></li><li><a href=#è·¯å¾„å¤„ç†è§„åˆ™>è·¯å¾„å¤„ç†è§„åˆ™</a></li><li><a href=#éªŒè¯ä¸è°ƒè¯•>éªŒè¯ä¸è°ƒè¯•</a></li><li><a href=#é«˜çº§æŠ€å·§>é«˜çº§æŠ€å·§</a></li></ol></li><li><a href=#k8s-æœ¬åœ°é•œåƒ>k8s æœ¬åœ°é•œåƒ</a><ol><li><a href=#1-é…ç½®é•œåƒæ‹‰å–ç­–ç•¥><strong>1. é…ç½®é•œåƒæ‹‰å–ç­–ç•¥</strong></a></li><li><a href=#2-ç¡®ä¿é•œåƒå­˜åœ¨äºé›†ç¾¤èŠ‚ç‚¹><strong>2. ç¡®ä¿é•œåƒå­˜åœ¨äºé›†ç¾¤èŠ‚ç‚¹</strong></a><ol><li><a href=#æ–¹æ³•ä¸€å•èŠ‚ç‚¹é›†ç¾¤ä¸»èŠ‚ç‚¹å³å·¥ä½œèŠ‚ç‚¹><strong>æ–¹æ³•ä¸€ï¼šå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆä¸»èŠ‚ç‚¹å³å·¥ä½œèŠ‚ç‚¹ï¼‰</strong></a></li><li><a href=#æ–¹æ³•äºŒå¤šèŠ‚ç‚¹é›†ç¾¤><strong>æ–¹æ³•äºŒï¼šå¤šèŠ‚ç‚¹é›†ç¾¤</strong></a></li><li><a href=#æ–¹æ³•ä¸‰ç‰¹å®šå·¥å…·é“¾æ”¯æŒ><strong>æ–¹æ³•ä¸‰ï¼šç‰¹å®šå·¥å…·é“¾æ”¯æŒ</strong></a></li></ol></li><li><a href=#3-åº”ç”¨é…ç½®å¹¶éªŒè¯><strong>3. åº”ç”¨é…ç½®å¹¶éªŒè¯</strong></a></li><li><a href=#é€‚ç”¨åœºæ™¯å¯¹æ¯”><strong>é€‚ç”¨åœºæ™¯å¯¹æ¯”</strong></a></li></ol></li><li><a href=#k8s-master--worker>K8s Master & Worker</a><ol><li><a href=#åŠŸèƒ½å®šä½><strong>åŠŸèƒ½å®šä½</strong></a></li><li><a href=#æ ¸å¿ƒç»„ä»¶><strong>æ ¸å¿ƒç»„ä»¶</strong></a></li><li><a href=#èŒè´£åˆ†å·¥><strong>èŒè´£åˆ†å·¥</strong></a></li><li><a href=#ç±»æ¯”æ€»ç»“><strong>ç±»æ¯”æ€»ç»“</strong></a></li></ol></li><li><a href=#master-èŠ‚ç‚¹è¦æ±‚>Master èŠ‚ç‚¹è¦æ±‚</a><ol><li><a href=#å†…å­˜éœ€æ±‚çš„åº•å±‚é€»è¾‘><strong>å†…å­˜éœ€æ±‚çš„åº•å±‚é€»è¾‘</strong></a></li><li><a href=#gpu-éœ€æ±‚çš„æ˜ç¡®ç»“è®º><strong>GPU éœ€æ±‚çš„æ˜ç¡®ç»“è®º</strong></a></li><li><a href=#æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ç­–ç•¥><strong>æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ç­–ç•¥</strong></a></li><li><a href=#å…³é”®é…ç½®å»ºè®®><strong>å…³é”®é…ç½®å»ºè®®</strong></a></li><li><a href=#æ€»ç»“-1>æ€»ç»“</a></li></ol></li><li><a href=#minikube-é¢„ç”Ÿäº§éªŒè¯>Minikube é¢„ç”Ÿäº§éªŒè¯</a><ol><li><a href=#minikubeçš„æ ¸å¿ƒå®šä½ä¸åŠŸèƒ½é™åˆ¶><strong>Minikubeçš„æ ¸å¿ƒå®šä½ä¸åŠŸèƒ½é™åˆ¶</strong></a></li><li><a href=#é¢„ç”Ÿäº§éªŒè¯çš„æ ¸å¿ƒéœ€æ±‚><strong>é¢„ç”Ÿäº§éªŒè¯çš„æ ¸å¿ƒéœ€æ±‚</strong></a></li><li><a href=#æ›¿ä»£æ–¹æ¡ˆå»ºè®®><strong>æ›¿ä»£æ–¹æ¡ˆå»ºè®®</strong></a></li><li><a href=#ç»“è®º>ç»“è®º</a></li></ol></li><li><a href=#github-action>Github Action</a><ol><li><a href=#-é…ç½®æœåŠ¡å™¨è®¤è¯ssh-å¯†é’¥>ğŸ”‘ é…ç½®æœåŠ¡å™¨è®¤è¯ï¼ˆSSH å¯†é’¥ï¼‰</a></li><li><a href=#-ç¼–å†™-github-actions-å·¥ä½œæµ>âš™ï¸ ç¼–å†™ GitHub Actions å·¥ä½œæµ</a></li><li><a href=#-è‡ªå®šä¹‰æ“ä½œåœºæ™¯ç¤ºä¾‹>ğŸ’» è‡ªå®šä¹‰æ“ä½œåœºæ™¯ç¤ºä¾‹</a></li><li><a href=#-æ³¨æ„äº‹é¡¹-1>âš ï¸ æ³¨æ„äº‹é¡¹</a></li><li><a href=#-é«˜çº§æŠ€å·§>ğŸ”§ é«˜çº§æŠ€å·§</a></li></ol></li><li><a href=#è¿æ¥æŠ¥é”™>è¿æ¥æŠ¥é”™</a><ol><li><a href=#-é”™è¯¯åŸå› åˆ†æ>ğŸ” é”™è¯¯åŸå› åˆ†æ</a></li><li><a href=#-è§£å†³æ–¹æ¡ˆé€æ­¥æ“ä½œ>ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼ˆé€æ­¥æ“ä½œï¼‰</a><ol><li><a href=#æ­¥éª¤-1ä¿®å¤ç§é’¥æ ¼å¼å…³é”®>æ­¥éª¤ 1ï¼šä¿®å¤ç§é’¥æ ¼å¼ï¼ˆå…³é”®ï¼ï¼‰</a></li><li><a href=#æ­¥éª¤-2ä¿®æ­£-action-é…ç½®>æ­¥éª¤ 2ï¼šä¿®æ­£ Action é…ç½®</a></li><li><a href=#æ­¥éª¤-3æœåŠ¡å™¨ç«¯æ£€æŸ¥>æ­¥éª¤ 3ï¼šæœåŠ¡å™¨ç«¯æ£€æŸ¥</a></li><li><a href=#æ­¥éª¤-4æœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•å¯é€‰>æ­¥éª¤ 4ï¼šæœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆå¯é€‰ï¼‰</a></li></ol></li><li><a href=#-æ³¨æ„äº‹é¡¹-2>âš ï¸ æ³¨æ„äº‹é¡¹</a></li><li><a href=#-è°ƒè¯•æŠ€å·§>ğŸ’¡ è°ƒè¯•æŠ€å·§</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/moon/ style=background-color:#b7ae8f;color:>æœˆæ»¡è¥¿æ¥¼
</a><a href=/categories/snow/ style=background-color:#aa6a4c;color:>è¸é›ªæ³¥</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/postopia-dev-logweek-16/>ã€Postopia Dev Logã€‘Week 16</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 26, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>13 minute read</time></div></footer></div></header><section class=article-content><h2 id=é—®é¢˜>é—®é¢˜</h2><h2 id=github-action-known-host>github action known host</h2><p>GitHub Actions è¿æ¥æœåŠ¡å™¨æ—¶æŠ¥é”™ <code>Host key verification failed</code>ï¼Œæ˜¯ç”±äº Actions ç¯å¢ƒé¦–æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ç¼ºå¤±ä¸»æœºå¯†é’¥éªŒè¯æ‰€è‡´ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š</p><hr><h3 id=-é”™è¯¯åŸå› >ğŸ” é”™è¯¯åŸå› </h3><ul><li><strong>ä¸»æœºå¯†é’¥æœªä¿¡ä»»</strong>ï¼šGitHub Actions çš„è™šæ‹Ÿæœºé¦–æ¬¡é€šè¿‡ SSH è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œä¼šæ£€æŸ¥æœåŠ¡å™¨çš„ä¸»æœºå¯†é’¥ï¼ˆhost keyï¼‰ã€‚è‹¥å¯†é’¥æœªé¢„å…ˆå­˜å‚¨åœ¨ <code>known_hosts</code> æ–‡ä»¶ä¸­ï¼ŒSSH ä¼šå› å®‰å…¨ç­–ç•¥æ‹’ç»è¿æ¥ã€‚</li><li><strong>ä¸æœ¬åœ°ç¯å¢ƒçš„å·®å¼‚</strong>ï¼šæœ¬åœ° Mac å·²é€šè¿‡æ‰‹åŠ¨è¿æ¥ï¼ˆè¾“å…¥ <code>yes</code>ï¼‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° <code>~/.ssh/known_hosts</code>ï¼Œä½† Actions ç¯å¢ƒæ˜¯å…¨æ–°çš„ï¼Œæ— æ­¤è®°å½•ã€‚</li></ul><hr><h3 id=-è§£å†³æ–¹æ¡ˆ>âœ… è§£å†³æ–¹æ¡ˆ</h3><h4 id=æ–¹æ³•ä¸€æå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ°-known_hostsæ¨è>æ–¹æ³•ä¸€ï¼šæå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° <code>known_hosts</code>ï¼ˆæ¨èï¼‰</h4><p>åœ¨ Actions å·¥ä½œæµä¸­ï¼Œä½¿ç”¨ <code>ssh-keyscan</code> ä¸»åŠ¨è·å–æœåŠ¡å™¨å¯†é’¥å¹¶å†™å…¥ <code>known_hosts</code> æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add server host key to known_hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    mkdir -p ~/.ssh
</span></span></span><span class=line><span class=cl><span class=sd>    ssh-keyscan your_server_ip &gt;&gt; ~/.ssh/known_hosts  # æ›¿æ¢ your_server_ip
</span></span></span><span class=line><span class=cl><span class=sd>    chmod 600 ~/.ssh/known_hosts</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>ğŸ“Œ <strong>åŸç†</strong>ï¼š<code>ssh-keyscan</code> è·å–æœåŠ¡å™¨å…¬é’¥å¹¶è¿½åŠ åˆ° <code>known_hosts</code>ï¼Œé¿å…é¦–æ¬¡è¿æ¥æ—¶çš„äº¤äº’æç¤ºã€‚</p></blockquote><hr><h4 id=æ–¹æ³•äºŒç¦ç”¨ä¸¥æ ¼ä¸»æœºå¯†é’¥æ£€æŸ¥ä¸´æ—¶æ–¹æ¡ˆ>æ–¹æ³•äºŒï¼šç¦ç”¨ä¸¥æ ¼ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰</h4><p>åœ¨ SSH å‘½ä»¤ä¸­æ·»åŠ å‚æ•°ï¼Œè·³è¿‡å¯†é’¥éªŒè¯ï¼ˆä»…é™æµ‹è¯•ç¯å¢ƒï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Connect via SSH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>ssh -o &#34;StrictHostKeyChecking=no&#34; -i ${{ secrets.SSH_PRIVATE_KEY }} user@server_ip</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šæ­¤æ–¹æ³•é™ä½å®‰å…¨æ€§ï¼Œå¯èƒ½é­å—ä¸­é—´äººæ”»å‡»ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚</p></blockquote><hr><h3 id=-å®Œæ•´-github-actions-é…ç½®ç¤ºä¾‹>ğŸ“ å®Œæ•´ GitHub Actions é…ç½®ç¤ºä¾‹</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to Server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>push]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add Server Host Key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          mkdir -p ~/.ssh
</span></span></span><span class=line><span class=cl><span class=sd>          ssh-keyscan your_server_ip &gt;&gt; ~/.ssh/known_hosts
</span></span></span><span class=line><span class=cl><span class=sd>          chmod 600 ~/.ssh/known_hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SSH Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;${{ secrets.SSH_PRIVATE_KEY }}&#34; &gt; private_key
</span></span></span><span class=line><span class=cl><span class=sd>          chmod 400 private_key
</span></span></span><span class=line><span class=cl><span class=sd>          ssh -i private_key user@your_server_ip &#34;echo Connected!&#34;</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=-å…³é”®é…ç½®è¯´æ˜>ğŸ”§ å…³é”®é…ç½®è¯´æ˜</h3><ol><li><strong>ç§é’¥å¤„ç†</strong>ï¼š<ul><li>å°† GitHub Secrets ä¸­çš„ç§é’¥å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶è®¾ç½®æƒé™ <code>400</code>ï¼ˆå¿…é¡»ï¼‰ã€‚</li></ul></li><li><strong>ä¸»æœºå¯†é’¥ç±»å‹</strong>ï¼š<ul><li>è‹¥æœåŠ¡å™¨ä½¿ç”¨éé»˜è®¤å¯†é’¥ç±»å‹ï¼ˆå¦‚ ECDSAï¼‰ï¼Œéœ€æŒ‡å®šå‚æ•°ï¼š<br><code>ssh-keyscan -t ecdsa your_server_ip >> ~/.ssh/known_hosts</code>ã€‚</li></ul></li><li><strong>é…ç½®æ–‡ä»¶ä¼˜åŒ–</strong>ï¼ˆå¯é€‰ï¼‰ï¼š<ul><li>åœ¨ Actions ä¸­åˆ›å»º <code>~/.ssh/config</code> æ–‡ä»¶ï¼Œç®€åŒ–è¿æ¥å‘½ä»¤ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Host server
</span></span></span><span class=line><span class=cl><span class=s2>  HostName your_server_ip
</span></span></span><span class=line><span class=cl><span class=s2>  User your_username
</span></span></span><span class=line><span class=cl><span class=s2>  IdentityFile private_key
</span></span></span><span class=line><span class=cl><span class=s2>  StrictHostKeyChecking yes&#34;</span> &gt;&gt; ~/.ssh/config
</span></span></code></pre></div></li></ul></li></ol><hr><h3 id=-æ³¨æ„äº‹é¡¹>âš ï¸ æ³¨æ„äº‹é¡¹</h3><ul><li><strong>æƒé™é—®é¢˜</strong>ï¼šç¡®ä¿ç§é’¥æ–‡ä»¶æƒé™ä¸º <code>400</code>ï¼Œå¦åˆ™ SSH ä¼šæ‹’ç»ä½¿ç”¨ã€‚</li><li><strong>å¯†é’¥æ ¼å¼</strong>ï¼šè‹¥ç§é’¥æ˜¯ PEM æ ¼å¼ï¼ˆå¦‚ä»¥ <code>-----BEGIN RSA PRIVATE KEY-----</code> å¼€å¤´ï¼‰ï¼Œéœ€ä¿ç•™æ¢è¡Œç¬¦ã€‚å†™å…¥æ–‡ä»¶æ—¶å»ºè®®ä½¿ç”¨ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=p>{ secrets.SSH_PRIVATE_KEY </span><span class=si>}</span><span class=s2>}&#34;</span> <span class=p>|</span> sed <span class=s1>&#39;s/\\n/\n/g&#39;</span> &gt; private_key
</span></span></code></pre></div></li><li><strong>å®‰å…¨å»ºè®®</strong>ï¼š<br>ä¼˜å…ˆä½¿ç”¨ <strong>æ–¹æ³•ä¸€</strong>ï¼Œæ—¢ä¿æŒå®‰å…¨æ€§ï¼Œåˆé¿å…æ‰‹åŠ¨ç¡®è®¤ã€‚ä»…åœ¨ä¸æ•æ„Ÿç¯å¢ƒä½¿ç”¨æ–¹æ³•äºŒã€‚</li></ul><hr><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒGitHub Actions å³å¯å®‰å…¨è¿æ¥æœåŠ¡å™¨ã€‚è‹¥ä»å¤±è´¥ï¼Œæ£€æŸ¥æœåŠ¡å™¨ SSH æœåŠ¡çŠ¶æ€ï¼ˆ<code>systemctl status sshd</code>ï¼‰åŠé˜²ç«å¢™è§„åˆ™ã€‚</p><h3 id=redis-æ— æ³•è¿œç¨‹è®¿é—®>Redis æ— æ³•è¿œç¨‹è®¿é—®</h3><p>è®¾ç½® bind 0.0.0.0 å’Œå¯†ç </p><h3 id=kafka-é…ç½®è¿œç¨‹ä»è¿æ¥æœ¬åœ°>kafka é…ç½®è¿œç¨‹ä»è¿æ¥æœ¬åœ°</h3><p>Kafka Broker çš„ advertised.listeners å‚æ•°å†³å®šäº†å®¢æˆ·ç«¯å®é™…è¿æ¥çš„åœ°å€ã€‚è‹¥è¯¥å‚æ•°é…ç½®ä¸ºæœ¬åœ°åœ°å€æˆ–å®¹å™¨å†…éƒ¨åœ°å€ï¼ˆå¦‚ localhost:9092 æˆ–å®¹å™¨å†…ä¸»æœºåï¼‰ï¼Œå³ä½¿å®¢æˆ·ç«¯é…ç½®äº†è¿œç¨‹ IPï¼Œä»ä¼šè¢«é‡å®šå‘åˆ°æœ¬åœ°åœ°å€ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>listeners</span><span class=o>=</span><span class=s>PLAINTEXT://0.0.0.0:9092          # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£</span>
</span></span><span class=line><span class=cl><span class=na>advertised.listeners</span><span class=o>=</span><span class=s>PLAINTEXT://å…¬ç½‘IP:9092 # å¯¹å¤–å¹¿æ’­çš„åœ°å€</span>
</span></span></code></pre></div><h3 id=1-port-is-deprecated-please-use-kafka_advertised_listeners-instead>1 port is deprecated. Please use KAFKA_ADVERTISED_LISTENERS instead.</h3><p>æ˜¯å› ä¸º â€œLooks like the kubenetes will automatically set the env name APPNAME_PORT, i.e. KAFKA_PORT in this case, the workaround is to change your app name to something else other than kafka.â€
é€šè¿‡ â€œcommand: [&ldquo;bash&rdquo;, &ldquo;-c&rdquo;, &ldquo;unset KAFKA_PORT; /etc/confluent/docker/runâ€]â€œ è§£å†³</p><h3 id=2-å®¿ä¸»æœºæ— æ³•è®¿é—®minikube-é›†ç¾¤>2 å®¿ä¸»æœºæ— æ³•è®¿é—®minikube é›†ç¾¤</h3><p>nginx, gateway, nacos éƒ½è®¾æˆ LoadBalancer</p><h3 id=3-mysql-æ¢é’ˆå¤±æ´»>3 mysql æ¢é’ˆå¤±æ´»</h3><p>ä¿®æ”¹æ¢é’ˆ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>postopia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Recreate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fsGroup</span><span class=p>:</span><span class=w> </span><span class=m>999</span><span class=w>  </span><span class=c># mysql group ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nacos-mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postopia-nacos-mysql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MYSQL_ROOT_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MYSQL_USER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>nacos_config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MYSQL_PASSWORD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>nacos_config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MYSQL_DATABASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>nacos_config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>LANG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>C.UTF-8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/run/mysqld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;256Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;250m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;500m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Use tcpSocket probe instead, which is more reliable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>tcpSocket</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>90</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>startupProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>tcpSocket</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>timeoutSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class=m>15</span><span class=w>  </span><span class=c># Allow up to ~2.5 minutes for startup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class=l>mysql-pvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql-run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><h3 id=4-æœåŠ¡å™¨ä¸Š-docker-compose-æŠ¥é”™>4 æœåŠ¡å™¨ä¸Š docker-compose æŠ¥é”™</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose down -v
</span></span><span class=line><span class=cl>docker rm -f <span class=k>$(</span>docker ps -aq<span class=k>)</span>
</span></span><span class=line><span class=cl>docker volume prune -f
</span></span><span class=line><span class=cl>docker network prune -f
</span></span></code></pre></div><h2 id=minikube-é•œåƒ>Minikube é•œåƒ</h2><p>è¦å°† Docker Desktop ä¸­çš„é•œåƒåŠ è½½åˆ° Minikube ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§å¸¸ç”¨æ–¹æ³•å®ç°ï¼š</p><hr><h3 id=æ–¹æ³•ä¸€ä½¿ç”¨><strong>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ <code>minikube image load</code> å‘½ä»¤</strong></h3><ol><li><p><strong>æ„å»ºæˆ–æ‹‰å–æœ¬åœ°é•œåƒ</strong><br>åœ¨ Docker Desktop ä¸­æ„å»ºæˆ–æ‹‰å–ç›®æ ‡é•œåƒï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t my-image:latest .
</span></span></code></pre></div></li><li><p><strong>å°†é•œåƒåŠ è½½åˆ° Minikube</strong><br>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æœ¬åœ°é•œåƒå¯¼å…¥ Minikube çš„ Docker ç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>minikube image load my-image:latest
</span></span></code></pre></div><ul><li>éªŒè¯æ˜¯å¦åŠ è½½æˆåŠŸï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>minikube ssh
</span></span><span class=line><span class=cl>docker images <span class=p>|</span> grep my-image
</span></span></code></pre></div></li></ul><blockquote><p><strong>è¯´æ˜</strong>ï¼šæ­¤æ–¹æ³•éœ€è¦å…ˆåœ¨æœ¬æœºæ„å»ºé•œåƒï¼Œå†é€šè¿‡ <code>load</code> å‘½ä»¤å¯¼å…¥ï¼Œé€‚ç”¨äºå·²æœ‰é•œåƒçš„åœºæ™¯ã€‚</p></blockquote></li></ol><hr><h3 id=æ–¹æ³•äºŒç›´æ¥ä½¿ç”¨-minikube-çš„-docker-ç¯å¢ƒ><strong>æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ Minikube çš„ Docker ç¯å¢ƒ</strong></h3><ol><li><p><strong>åˆ‡æ¢ Docker ç¯å¢ƒå˜é‡</strong><br>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å½“å‰ç»ˆç«¯çš„ Docker å®¢æˆ·ç«¯æŒ‡å‘ Minikube å†…éƒ¨çš„ Docker å®ˆæŠ¤è¿›ç¨‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>eval</span> <span class=k>$(</span>minikube docker-env<span class=k>)</span>
</span></span></code></pre></div><ul><li>æ­¤æ—¶æ‰§è¡Œ <code>docker images</code> ä¼šæ˜¾ç¤º Minikube çš„é•œåƒåˆ—è¡¨ï¼Œè€Œéæœ¬æœº Docker Desktop çš„é•œåƒã€‚</li></ul></li><li><p><strong>åœ¨ Minikube ç¯å¢ƒä¸­æ„å»ºé•œåƒ</strong><br>ç›´æ¥åœ¨ Minikube çš„ Docker ç¯å¢ƒä¸­æ„å»ºé•œåƒï¼ˆé¿å…é•œåƒä¼ è¾“ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t my-image:latest .
</span></span></code></pre></div><ul><li>æ„å»ºå®Œæˆåï¼Œé•œåƒä¼šç›´æ¥å­˜å‚¨åœ¨ Minikube ç¯å¢ƒä¸­ï¼Œæ— éœ€é¢å¤–åŠ è½½ã€‚</li></ul></li><li><p><strong>æ¢å¤æœ¬æœº Docker ç¯å¢ƒ</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>eval</span> <span class=k>$(</span>minikube docker-env -u<span class=k>)</span>
</span></span></code></pre></div></li></ol><hr><h3 id=æ³¨æ„äº‹é¡¹><strong>æ³¨æ„äº‹é¡¹</strong></h3><ol><li><p><strong>é•œåƒæ‹‰å–ç­–ç•¥</strong><br>åœ¨ Kubernetes çš„ Deployment é…ç½®ä¸­ï¼Œéœ€è®¾ç½® <code>imagePullPolicy: Never</code>ï¼Œå¦åˆ™ Kubernetes ä¼šå°è¯•ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒè€Œéä½¿ç”¨æœ¬åœ°é•œåƒã€‚</p></li><li><p><strong>èµ„æºé™åˆ¶</strong><br><code>minikube image load</code> å‘½ä»¤å¯èƒ½æ¶ˆè€—è¾ƒå¤šå†…å­˜ï¼Œå»ºè®®ä¸º Minikube åˆ†é…è¶³å¤Ÿèµ„æºï¼ˆä¾‹å¦‚è‡³å°‘ 2 æ ¸ 4GB å†…å­˜ï¼‰ã€‚</p></li><li><p><strong>ä¸´æ—¶å¼€å‘åœºæ™¯æ¨è</strong><br>è‹¥éœ€é¢‘ç¹ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæ¨èç›´æ¥é€šè¿‡ <code>eval $(minikube docker-env)</code> åœ¨ Minikube ç¯å¢ƒä¸­æ„å»ºé•œåƒï¼Œçœå»åŠ è½½æ­¥éª¤ã€‚</p></li></ol><hr><h3 id=éªŒè¯é•œåƒæ˜¯å¦ç”Ÿæ•ˆ><strong>éªŒè¯é•œåƒæ˜¯å¦ç”Ÿæ•ˆ</strong></h3><p>éƒ¨ç½²åº”ç”¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Pod çŠ¶æ€å’Œæ—¥å¿—ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml
</span></span><span class=line><span class=cl>kubectl logs deployment/my-app
</span></span><span class=line><span class=cl>kubectl port-forward deployment/my-app 8080:8080  <span class=c1># ç«¯å£è½¬å‘è®¿é—®æœåŠ¡</span>
</span></span></code></pre></div><blockquote><p><strong>å¼•ç”¨è¯´æ˜</strong>ï¼šä»¥ä¸Šæ–¹æ³•ç»¼åˆäº†é•œåƒåŠ è½½å’Œç›´æ¥æ„å»ºä¸¤ç§åœºæ™¯ï¼Œé€‚ç”¨äºæœ¬åœ°å¼€å‘è°ƒè¯•ã€‚è‹¥éœ€é•¿æœŸä½¿ç”¨ï¼Œå»ºè®®æ­å»ºç§æœ‰é•œåƒä»“åº“æˆ–é…ç½®é•œåƒåŠ é€Ÿæºã€‚</p></blockquote><h2 id=kubectl-apply--f>kubectl apply -f</h2><p><code>kubectl apply -f</code> æ˜¯ Kubernetes ä¸­ç”¨äºå£°æ˜å¼é…ç½®ç®¡ç†çš„æ ¸å¿ƒå‘½ä»¤ï¼Œé€šè¿‡è¯»å– YAML/JSON æ–‡ä»¶å°†èµ„æºåº”ç”¨åˆ°é›†ç¾¤ä¸­ï¼Œå¹¶ç¡®ä¿é›†ç¾¤çŠ¶æ€ä¸æ–‡ä»¶å®šä¹‰ä¸€è‡´ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®ä¿¡æ¯ï¼š</p><hr><h3 id=æ ¸å¿ƒåŠŸèƒ½><strong>æ ¸å¿ƒåŠŸèƒ½</strong></h3><ol><li><p><strong>å£°æ˜å¼ç®¡ç†</strong></p><ul><li>é€šè¿‡é…ç½®æ–‡ä»¶æè¿°èµ„æºçš„<strong>æœŸæœ›çŠ¶æ€</strong>ï¼ŒKubernetes è‡ªåŠ¨è®¡ç®—å¹¶æ‰§è¡Œæ‰€éœ€æ“ä½œï¼ˆåˆ›å»º/æ›´æ–°ï¼‰ã€‚</li><li>ä¸å‘½ä»¤å¼å‘½ä»¤ï¼ˆå¦‚ <code>kubectl create</code>ï¼‰ä¸åŒï¼Œ<code>apply</code> <strong>ä¸ä¼šè¦†ç›–ç°æœ‰é…ç½®</strong>ï¼Œè€Œæ˜¯é€šè¿‡ä¸‰å‘åˆå¹¶ç­–ç•¥ï¼ˆThree-Way Mergeï¼‰å¯¹æ¯”å½“å‰çŠ¶æ€ã€ä¸Šæ¬¡åº”ç”¨çŠ¶æ€å’Œæ–‡ä»¶çŠ¶æ€ï¼Œä»…åº”ç”¨å¿…è¦å˜æ›´ã€‚</li></ul></li><li><p><strong>å¹‚ç­‰æ€§</strong></p><ul><li>å¤šæ¬¡æ‰§è¡ŒåŒä¸€å‘½ä»¤ç»“æœä¸€è‡´ï¼Œé€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œ CI/CD æµç¨‹ã€‚</li></ul></li><li><p><strong>ç‰ˆæœ¬æ§åˆ¶å‹å¥½</strong></p><ul><li>é…ç½®æ–‡ä»¶å¯å­˜å‚¨åœ¨ Git ç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œä¾¿äºè·Ÿè¸ªå˜æ›´å†å²å’Œå›¢é˜Ÿåä½œã€‚</li></ul></li></ol><hr><h3 id=åŸºæœ¬ç”¨æ³•><strong>åŸºæœ¬ç”¨æ³•</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># åº”ç”¨å•ä¸ªæ–‡ä»¶</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åº”ç”¨ç›®å½•ä¸‹æ‰€æœ‰é…ç½®æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>kubectl apply -f ./configs/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»æ ‡å‡†è¾“å…¥è¯»å–é…ç½®ï¼ˆå¦‚ç®¡é“ä¼ é€’ï¼‰</span>
</span></span><span class=line><span class=cl>cat pod.json <span class=p>|</span> kubectl apply -f -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ Kustomize ç›®å½•</span>
</span></span><span class=line><span class=cl>kubectl apply -k kustomize-dir/
</span></span></code></pre></div><hr><h3 id=å…¸å‹åº”ç”¨åœºæ™¯><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></h3><ol><li><p><strong>éƒ¨ç½²åº”ç”¨</strong></p><ul><li>é€šè¿‡å®šä¹‰ Deploymentã€Serviceã€Ingress ç­‰èµ„æºæ–‡ä»¶ï¼Œä¸€é”®éƒ¨ç½²å®Œæ•´åº”ç”¨ç»„ä»¶ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šéƒ¨ç½² Nginxï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.21</span><span class=w>
</span></span></span></code></pre></div>æ‰§è¡Œï¼š<code>kubectl apply -f nginx.yaml</code>ã€‚</li></ul></li><li><p><strong>æ›´æ–°èµ„æº</strong></p><ul><li>ä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°æ‰§è¡Œ <code>apply</code>ï¼ŒKubernetes è‡ªåŠ¨æ›´æ–°èµ„æºï¼ˆå¦‚è°ƒæ•´å‰¯æœ¬æ•°ã€é•œåƒç‰ˆæœ¬ï¼‰ã€‚</li></ul></li><li><p><strong>æ‰¹é‡ç®¡ç†èµ„æº</strong></p><ul><li>ä½¿ç”¨æ ‡ç­¾ï¼ˆLabelsï¼‰åˆ†ç»„ç®¡ç†èµ„æºï¼Œä¾‹å¦‚ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ ‡è®°ä¸º <code>app=backend</code> çš„ Deploymentã€‚</li></ul></li></ol><hr><h3 id=è¿›é˜¶å‚æ•°ä¸æŠ€å·§><strong>è¿›é˜¶å‚æ•°ä¸æŠ€å·§</strong></h3><ol><li><p><strong>åˆ é™¤æœªä½¿ç”¨çš„èµ„æº</strong></p><ul><li>ç»“åˆ <code>--prune</code> å‚æ•°å¯è‡ªåŠ¨åˆ é™¤é…ç½®æ–‡ä»¶ä¸­æœªæåŠä½†å·²å­˜åœ¨çš„èµ„æºï¼ˆéœ€æŒ‡å®šæ ‡ç­¾æˆ–èµ„æºç±»å‹ï¼‰ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f manifest.yaml --prune -l <span class=nv>app</span><span class=o>=</span>nginx
</span></span></code></pre></div><em>æ³¨æ„ï¼šæ­¤åŠŸèƒ½ç›®å‰å¤„äº Alpha é˜¶æ®µï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚</em></li></ul></li><li><p><strong>æ¨¡æ‹Ÿæ‰§è¡Œï¼ˆDry Runï¼‰</strong></p><ul><li>é¢„è§ˆå˜æ›´è€Œä¸å®é™…ç”Ÿæ•ˆï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml --dry-run<span class=o>=</span>server
</span></span></code></pre></div></li></ul></li><li><p><strong>å¼ºåˆ¶è¦†ç›–å†²çª</strong></p><ul><li>å½“å­—æ®µå†²çªæ—¶ï¼Œä½¿ç”¨ <code>--force-conflicts</code> å¼ºåˆ¶åº”ç”¨å˜æ›´ï¼ˆéœ€ç»“åˆ <code>--server-side</code>ï¼‰ã€‚</li></ul></li></ol><hr><h3 id=å¸¸è§é—®é¢˜ä¸è§£å†³><strong>å¸¸è§é—®é¢˜ä¸è§£å†³</strong></h3><ol><li><p><strong>èµ„æºæœªæŒ‰é¢„æœŸæ›´æ–°</strong></p><ul><li><strong>åŸå› </strong>ï¼šæœ¬åœ°é…ç½®ä¸é›†ç¾¤å®é™…çŠ¶æ€ä¸ä¸€è‡´ã€‚</li><li><strong>è§£å†³</strong>ï¼šä½¿ç”¨ <code>kubectl get &lt;resource> -o yaml</code> å¯¼å‡ºå½“å‰é…ç½®ï¼Œå¯¹æ¯”å¹¶è°ƒæ•´æ–‡ä»¶åé‡æ–°åº”ç”¨ã€‚</li></ul></li><li><p><strong>èµ„æºæœªè¢«è‡ªåŠ¨åˆ é™¤</strong></p><ul><li><strong>åŸå› </strong>ï¼š<code>apply</code> é»˜è®¤ä¸ä¼šåˆ é™¤èµ„æºï¼Œéœ€æ˜¾å¼ä½¿ç”¨ <code>kubectl delete -f</code> æˆ–ç»“åˆ <code>--prune</code>ã€‚</li></ul></li><li><p><strong>æƒé™æˆ–é…ç½®é”™è¯¯</strong></p><ul><li><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š<ol><li>æ£€æŸ¥ YAML è¯­æ³•ï¼ˆå¦‚ç¼©è¿›ã€å­—æ®µåï¼‰ã€‚</li><li>ç¡®è®¤ç”¨æˆ·æƒé™ï¼ˆRBACï¼‰ã€‚</li><li>æŸ¥çœ‹äº‹ä»¶æ—¥å¿—ï¼š<code>kubectl describe &lt;resource></code>ã€‚</li></ol></li></ul></li></ol><hr><h3 id=æœ€ä½³å®è·µ><strong>æœ€ä½³å®è·µ</strong></h3><ol><li><p><strong>å§‹ç»ˆä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶</strong></p><ul><li>å°†é…ç½®æ–‡ä»¶çº³å…¥ Gitï¼Œç»“åˆ CI/CD å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</li></ul></li><li><p><strong>é¿å…æ‰‹åŠ¨ä¿®æ”¹å®æ—¶é…ç½®</strong></p><ul><li>ç›´æ¥åœ¨é›†ç¾¤ä¸­ä¿®æ”¹ï¼ˆå¦‚ <code>kubectl edit</code>ï¼‰å¯èƒ½å¯¼è‡´ä¸é…ç½®æ–‡ä»¶å†²çªï¼Œå»ºè®®é€šè¿‡æ›´æ–°æ–‡ä»¶åé‡æ–°åº”ç”¨ã€‚</li></ul></li><li><p><strong>æ ‡ç­¾åŒ–èµ„æº</strong></p><ul><li>ä½¿ç”¨ <code>metadata.labels</code> å¯¹ç›¸å…³èµ„æºåˆ†ç»„ï¼Œä¾¿äºæ‰¹é‡æ“ä½œã€‚</li></ul></li></ol><hr><p>é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œ<code>kubectl apply -f</code> æˆä¸º Kubernetes å£°æ˜å¼ç®¡ç†çš„æ ¸å¿ƒå·¥å…·ï¼Œå°¤å…¶é€‚ç”¨äºå¤æ‚ç¯å¢ƒä¸‹çš„èµ„æºç®¡ç†ã€‚å¦‚éœ€è¿›ä¸€æ­¥äº†è§£å‚æ•°ç»†èŠ‚ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ– <code>kubectl apply --help</code>ã€‚</p><h2 id=æœåŠ¡ç±»å‹>æœåŠ¡ç±»å‹</h2><p>Kubernetes Service æ˜¯é›†ç¾¤å†…ç½‘ç»œé€šä¿¡çš„æ ¸å¿ƒæŠ½è±¡ï¼Œé€šè¿‡æä¾›ç¨³å®šçš„è®¿é—®å…¥å£å’Œè´Ÿè½½å‡è¡¡æœºåˆ¶ï¼Œè§£å†³äº† Pod åŠ¨æ€å˜åŒ–å¯¼è‡´çš„ IP ä¸å›ºå®šé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å…¶å››ç§ä¸»è¦ç±»å‹çš„è¯¦ç»†ä»‹ç»ï¼š</p><hr><h3 id=clusteripé»˜è®¤ç±»å‹>ClusterIPï¼ˆé»˜è®¤ç±»å‹ï¼‰</h3><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>å†…éƒ¨è®¿é—®</strong>ï¼šä¸º Service åˆ†é…ä¸€ä¸ªè™šæ‹Ÿ IPï¼ˆClusterIPï¼‰ï¼Œä»…é™é›†ç¾¤å†…éƒ¨ Pod æˆ–ç»„ä»¶è®¿é—®ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šè‡ªåŠ¨å°†è¯·æ±‚åˆ†å‘åˆ°å…³è”çš„å¤šä¸ª Podï¼Œæ”¯æŒè½®è¯¢ç­‰åŸºæœ¬ç®—æ³•ã€‚</li><li><strong>åŠ¨æ€é€‚é…</strong>ï¼šé€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorï¼‰è‡ªåŠ¨æ›´æ–°åç«¯ Podï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>å¾®æœåŠ¡é—´é€šä¿¡ï¼ˆå¦‚å‰ç«¯æœåŠ¡è°ƒç”¨åç«¯ APIï¼‰ã€‚</li><li>æ•°æ®åº“ã€ç¼“å­˜ç­‰ä»…éœ€é›†ç¾¤å†…éƒ¨è®¿é—®çš„æœåŠ¡ã€‚</li></ul><p><strong>ç¤ºä¾‹é…ç½®</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>        </span><span class=c># Service æš´éœ²ç«¯å£</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w> </span><span class=c># Pod åº”ç”¨ç«¯å£</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=nodeport>NodePort</h3><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>å¤–éƒ¨è®¿é—®å…¥å£</strong>ï¼šåœ¨æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šå¼€æ”¾ä¸€ä¸ªé™æ€ç«¯å£ï¼ˆé»˜è®¤ 30000-32767ï¼‰ï¼Œå¤–éƒ¨å¯é€šè¿‡ <code>NodeIP:NodePort</code> è®¿é—®æœåŠ¡ã€‚</li><li><strong>åŸºäº ClusterIP</strong>ï¼šNodePort æœ¬è´¨æ˜¯ ClusterIP çš„æ‰©å±•ï¼ŒåŒæ—¶ä¿ç•™ ClusterIP åŠŸèƒ½ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>å¼€å‘æµ‹è¯•ç¯å¢ƒä¸´æ—¶æš´éœ²æœåŠ¡ã€‚</li><li>å°è§„æ¨¡é›†ç¾¤æˆ–æ— éœ€äº‘è´Ÿè½½å‡è¡¡çš„åœºæ™¯ã€‚</li></ul><p><strong>ç¤ºä¾‹é…ç½®</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30080</span><span class=w>  </span><span class=c># å¯æ‰‹åŠ¨æŒ‡å®šæˆ–ç”±ç³»ç»Ÿåˆ†é…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=loadbalancer>LoadBalancer</h3><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>äº‘å¹³å°é›†æˆ</strong>ï¼šè‡ªåŠ¨åˆ›å»ºäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ALBã€GCP LBï¼‰ï¼Œåˆ†é…å¤–éƒ¨ IPã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šæµé‡é€šè¿‡è´Ÿè½½å‡è¡¡å™¨åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>ç”Ÿäº§ç¯å¢ƒå¯¹å¤–æš´éœ²æœåŠ¡ï¼ˆå¦‚ Web APIã€å‰ç«¯åº”ç”¨ï¼‰ã€‚</li><li>éœ€è¦è‡ªåŠ¨æ‰©ç¼©å®¹å’Œæµé‡ç®¡ç†çš„äº‘åŸç”Ÿåº”ç”¨ã€‚</li></ul><p><strong>ç¤ºä¾‹é…ç½®</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>LoadBalancer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=externalname>ExternalName</h3><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>å¤–éƒ¨æœåŠ¡æ˜ å°„</strong>ï¼šå°† Service æ˜ å°„åˆ°å¤–éƒ¨ DNS åç§°ï¼ˆå¦‚ <code>example.com</code>ï¼‰ï¼Œä¸åˆ›å»ºä»£ç†æˆ–è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>DNS è§£æ</strong>ï¼šé€šè¿‡ CNAME è®°å½•å°†å†…éƒ¨è¯·æ±‚è½¬å‘åˆ°å¤–éƒ¨æœåŠ¡ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>è®¿é—®é›†ç¾¤å¤–éƒ¨çš„æ•°æ®åº“ï¼ˆå¦‚ MySQLã€Redisï¼‰ã€‚</li><li>é›†æˆç¬¬ä¸‰æ–¹ API æˆ–é—ç•™ç³»ç»Ÿã€‚</li></ul><p><strong>ç¤ºä¾‹é…ç½®</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>external-mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ExternalName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>externalName</span><span class=p>:</span><span class=w> </span><span class=l>mysql.example.com</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=ç±»å‹å¯¹æ¯”ä¸é€‰å‹å»ºè®®>ç±»å‹å¯¹æ¯”ä¸é€‰å‹å»ºè®®</h3><div class=table-wrapper><table><thead><tr><th>ç±»å‹</th><th>è®¿é—®æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>å…¸å‹ç”¨ä¾‹</th></tr></thead><tbody><tr><td><strong>ClusterIP</strong></td><td><code>http://&lt;service-name>:port</code></td><td>é›†ç¾¤å†…éƒ¨é€šä¿¡</td><td>å¾®æœåŠ¡é—´è°ƒç”¨ã€å†…éƒ¨æ•°æ®åº“</td></tr><tr><td><strong>NodePort</strong></td><td><code>http://&lt;NodeIP>:30000+</code></td><td>å¼€å‘æµ‹è¯•ã€ä¸´æ—¶å¤–éƒ¨è®¿é—®</td><td>æœ¬åœ°è°ƒè¯•ã€å°å‹åº”ç”¨å±•ç¤º</td></tr><tr><td><strong>LoadBalancer</strong></td><td><code>http://&lt;External-IP>:port</code></td><td>ç”Ÿäº§ç¯å¢ƒå¤–éƒ¨è®¿é—®ï¼ˆäº‘å¹³å°ï¼‰</td><td>å…¬æœ‰äº‘éƒ¨ç½²çš„ Web æœåŠ¡</td></tr><tr><td><strong>ExternalName</strong></td><td><code>service-name â†’ å¤–éƒ¨åŸŸå</code></td><td>é›†æˆå¤–éƒ¨æœåŠ¡</td><td>å¤–éƒ¨ APIã€è·¨é›†ç¾¤æ•°æ®åº“è®¿é—®</td></tr></tbody></table></div><p><strong>é€‰å‹å»ºè®®</strong>ï¼š</p><ul><li>ä¼˜å…ˆä½¿ç”¨ <strong>ClusterIP</strong> æ»¡è¶³å†…éƒ¨é€šä¿¡éœ€æ±‚ã€‚</li><li>ç”Ÿäº§ç¯å¢ƒéœ€é«˜å¯ç”¨æ—¶é€‰æ‹© <strong>LoadBalancer</strong>ï¼ˆäº‘ç¯å¢ƒï¼‰æˆ–ç»“åˆ Ingress ä½¿ç”¨ã€‚</li><li>é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒè¿‡åº¦ä¾èµ– <strong>NodePort</strong>ï¼Œå› å…¶ç«¯å£èŒƒå›´å—é™ä¸”ç¼ºä¹è´Ÿè½½å‡è¡¡ã€‚</li></ul><hr><h3 id=åº•å±‚å®ç°æœºåˆ¶>åº•å±‚å®ç°æœºåˆ¶</h3><p>Service çš„è´Ÿè½½å‡è¡¡ä¾èµ–äº <code>kube-proxy</code>ï¼Œæ”¯æŒä¸‰ç§æ¨¡å¼ï¼š</p><ol><li><strong>iptables</strong>ï¼šé€šè¿‡è§„åˆ™ç›´æ¥è½¬å‘æµé‡ï¼Œæ€§èƒ½è¾ƒé«˜ä½†ç¼ºä¹é‡è¯•æœºåˆ¶ã€‚</li><li><strong>IPVS</strong>ï¼šå†…æ ¸çº§è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒå¤æ‚ç®—æ³•ï¼ˆå¦‚åŠ æƒè½®è¯¢ï¼‰ï¼Œé€‚åˆå¤§è§„æ¨¡é›†ç¾¤ã€‚</li><li><strong>Userspace</strong>ï¼ˆå·²æ·˜æ±°ï¼‰ï¼šæ—©æœŸæ¨¡å¼ï¼Œå› æ€§èƒ½é—®é¢˜é€æ¸è¢«æ›¿ä»£ã€‚</li></ol><p>ä»¥ä¸Šå†…å®¹ç»¼åˆäº† Kubernetes å®˜æ–¹æ–‡æ¡£åŠç¤¾åŒºæœ€ä½³å®è·µï¼Œå…·ä½“é…ç½®éœ€ç»“åˆé›†ç¾¤ç¯å¢ƒå’Œäº‘å¹³å°ç‰¹æ€§è°ƒæ•´ã€‚</p><h2 id=minikube-tunnel>minikube tunnel</h2><p>åœ¨ Minikube ç¯å¢ƒä¸­ï¼Œå½“æœåŠ¡ç±»å‹è®¾ç½®ä¸º <code>LoadBalancer</code> æ—¶ï¼Œç›´æ¥é€šè¿‡ <code>localhost</code> æ— æ³•è®¿é—®æ˜¯å¸¸è§é—®é¢˜ï¼ŒåŸå› å’Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><hr><h3 id=åŸå› åˆ†æ><strong>åŸå› åˆ†æ</strong></h3><ol><li><p><strong>Minikube çš„ç½‘ç»œéš”ç¦»</strong><br>Minikube åˆ›å»ºçš„æ˜¯ä¸€ä¸ªç‹¬ç«‹è™šæ‹Ÿæœºæˆ–å®¹å™¨åŒ–çš„ Kubernetes é›†ç¾¤ï¼Œå…¶ç½‘ç»œä¸å®¿ä¸»æœºï¼ˆå¦‚ Macã€Windows æœ¬åœ°ï¼‰éš”ç¦»ã€‚<code>LoadBalancer</code> ç±»å‹æœåŠ¡åœ¨äº‘ç¯å¢ƒä¸­ä¼šè‡ªåŠ¨åˆ†é…å¤–éƒ¨ IPï¼Œä½†åœ¨æœ¬åœ° Minikube ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚</p></li><li><p><strong>LoadBalancer çš„æœ¬åœ°é™åˆ¶</strong><br>Minikube é»˜è®¤ä¸æ”¯æŒè‡ªåŠ¨åˆ†é…å¤–éƒ¨ IP ç»™ <code>LoadBalancer</code> ç±»å‹æœåŠ¡ï¼Œå› æ­¤æœåŠ¡å¯èƒ½å¤„äº <code>pending</code> çŠ¶æ€ï¼Œæ— æ³•é€šè¿‡ <code>localhost</code> è®¿é—®ã€‚</p></li></ol><hr><h3 id=è§£å†³æ–¹æ¡ˆ><strong>è§£å†³æ–¹æ¡ˆ</strong></h3><h4 id=ä½¿ç”¨><strong>ä½¿ç”¨ <code>minikube tunnel</code> å‘½ä»¤</strong></h4><p>è¯¥å‘½ä»¤ä¼šä¸º <code>LoadBalancer</code> ç±»å‹æœåŠ¡åˆ†é…æœ¬åœ° IPï¼ˆé€šå¸¸æ˜¯ <code>127.0.0.1</code>ï¼‰ï¼Œä½¿æœåŠ¡å¯é€šè¿‡ <code>localhost</code> è®¿é—®ã€‚<br><strong>æ“ä½œæ­¥éª¤</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># å¯åŠ¨éš§é“ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</span>
</span></span><span class=line><span class=cl>minikube tunnel
</span></span></code></pre></div><p>ä¹‹åï¼ŒæœåŠ¡çš„ <code>EXTERNAL-IP</code> ä¼šæ˜¾ç¤ºä¸º <code>127.0.0.1</code>ï¼Œå¯é€šè¿‡ <code>localhost:&lt;ç«¯å£></code> è®¿é—®ã€‚</p><hr><h4 id=é€šè¿‡><strong>é€šè¿‡ <code>minikube service</code> å‘½ä»¤è®¿é—®</strong></h4><p>Minikube æä¾›äº†å¿«æ·å‘½ä»¤ç”ŸæˆæœåŠ¡çš„è®¿é—® URLï¼š<br><strong>æ“ä½œæ­¥éª¤</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># è·å–æœåŠ¡è®¿é—®åœ°å€</span>
</span></span><span class=line><span class=cl>minikube service &lt;æœåŠ¡åç§°&gt; --url
</span></span></code></pre></div><p>è¯¥å‘½ä»¤ä¼šè¿”å›å½¢å¦‚ <code>http://192.168.64.2:30001</code> çš„ URLï¼Œç›´æ¥ä½¿ç”¨æ­¤åœ°å€å³å¯è®¿é—®ã€‚</p><hr><h4 id=æ‰‹åŠ¨ä½¿ç”¨-minikube-çš„-ip-å’Œ-nodeport><strong>æ‰‹åŠ¨ä½¿ç”¨ Minikube çš„ IP å’Œ NodePort</strong></h4><p>å¦‚æœæœåŠ¡åŒæ—¶æš´éœ²äº† <code>NodePort</code>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è®¿é—®ï¼š<br><strong>æ“ä½œæ­¥éª¤</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># è·å– Minikube é›†ç¾¤ IP</span>
</span></span><span class=line><span class=cl>minikube ip
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æœåŠ¡çš„ NodePort</span>
</span></span><span class=line><span class=cl>kubectl get svc &lt;æœåŠ¡åç§°&gt;
</span></span></code></pre></div><p>è®¿é—®åœ°å€ä¸º <code>&lt;Minikube-IP>:&lt;NodePort></code>ï¼ˆä¾‹å¦‚ <code>192.168.64.2:31035</code>ï¼‰ã€‚</p><hr><h4 id=æ£€æŸ¥æœåŠ¡é…ç½®><strong>æ£€æŸ¥æœåŠ¡é…ç½®</strong></h4><ul><li><strong>é€‰æ‹©å™¨åŒ¹é…</strong>ï¼šç¡®ä¿ Service çš„ <code>selector</code> ä¸ Pod çš„æ ‡ç­¾åŒ¹é…ï¼Œå¦åˆ™æµé‡æ— æ³•è·¯ç”±åˆ°åç«¯ Podã€‚</li><li><strong>ç«¯å£æ˜ å°„</strong>ï¼šç¡®è®¤ <code>targetPort</code> ä¸ Pod çš„å®¹å™¨ç«¯å£ä¸€è‡´ï¼Œ<code>nodePort</code> åœ¨ 30000-32767 èŒƒå›´å†…ã€‚</li><li><strong>æœåŠ¡çŠ¶æ€</strong>ï¼šè¿è¡Œ <code>kubectl describe svc &lt;æœåŠ¡åç§°></code>ï¼Œæ£€æŸ¥ <code>Endpoints</code> æ˜¯å¦æœ‰æ­£ç¡®çš„ Pod IPã€‚</li></ul><hr><h3 id=é™„åŠ è¯´æ˜><strong>é™„åŠ è¯´æ˜</strong></h3><ul><li><strong><code>LoadBalancer</code> çš„é€‚ç”¨åœºæ™¯</strong>ï¼šåœ¨æœ¬åœ°å¼€å‘ä¸­ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ <code>NodePort</code> æˆ–ç»“åˆ <code>minikube tunnel</code>ï¼Œä»¥å‡å°‘å¤æ‚æ€§ã€‚</li><li><strong>äº‘ç¯å¢ƒå·®å¼‚</strong>ï¼šå¦‚æœåœ¨äº‘å‚å•†ï¼ˆå¦‚é˜¿é‡Œäº‘ï¼‰éƒ¨ç½²ï¼Œ<code>LoadBalancer</code> ä¼šè‡ªåŠ¨ç»‘å®š SLB/IPï¼Œä½†éœ€æ³¨æ„ <code>externalTrafficPolicy</code> é…ç½®ã€‚</li></ul><p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯è§£å†³ Minikube ä¸­ <code>LoadBalancer</code> æœåŠ¡æ— æ³•é€šè¿‡ <code>localhost</code> è®¿é—®çš„é—®é¢˜ã€‚æ¨èä¼˜å…ˆä½¿ç”¨ <code>minikube tunnel</code> æˆ– <code>minikube service</code> å‘½ä»¤ç®€åŒ–æ“ä½œã€‚</p><h2 id=pv--pvc>PV & PVC</h2><p>PersistentVolumeï¼ˆPVï¼‰å’ŒPersistentVolumeClaimï¼ˆPVCï¼‰æ˜¯Kubernetesä¸­ç”¨äºç®¡ç†å­˜å‚¨èµ„æºçš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸¤è€…å…±åŒå®ç°äº†å­˜å‚¨ä¸è®¡ç®—çš„è§£è€¦ï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§£æï¼š</p><hr><h3 id=1-persistentvolumepv><strong>1. PersistentVolumeï¼ˆPVï¼‰</strong></h3><p><strong>å®šä¹‰</strong>ï¼š<br>PVæ˜¯é›†ç¾¤ä¸­ç”±ç®¡ç†å‘˜é¢„å…ˆé…ç½®æˆ–é€šè¿‡åŠ¨æ€ä¾›åº”ï¼ˆStorageClassï¼‰åˆ›å»ºçš„ä¸€å—æŒä¹…åŒ–å­˜å‚¨èµ„æºã€‚å®ƒç‹¬ç«‹äºPodçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼ˆå¦‚NFSã€äº‘å­˜å‚¨ã€æœ¬åœ°å­˜å‚¨ç­‰ï¼‰ã€‚</p><p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p><ul><li><strong>å­˜å‚¨ç±»å‹</strong>ï¼šæ”¯æŒæœ¬åœ°å­˜å‚¨ã€ç½‘ç»œå­˜å‚¨ï¼ˆNFSã€iSCSIï¼‰ã€äº‘å­˜å‚¨ï¼ˆå¦‚AWS EBSã€Azure Diskï¼‰ç­‰ã€‚</li><li><strong>è®¿é—®æ¨¡å¼</strong>ï¼š<ul><li><code>ReadWriteOnce</code>ï¼ˆRWOï¼‰ï¼šå•èŠ‚ç‚¹è¯»å†™ï¼›</li><li><code>ReadOnlyMany</code>ï¼ˆROXï¼‰ï¼šå¤šèŠ‚ç‚¹åªè¯»ï¼›</li><li><code>ReadWriteMany</code>ï¼ˆRWXï¼‰ï¼šå¤šèŠ‚ç‚¹è¯»å†™ã€‚</li></ul></li><li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼š<ul><li><strong>å›æ”¶ç­–ç•¥</strong>ï¼šåŒ…æ‹¬<code>Retain</code>ï¼ˆä¿ç•™æ•°æ®ï¼‰ã€<code>Delete</code>ï¼ˆè‡ªåŠ¨åˆ é™¤å­˜å‚¨ï¼‰ã€<code>Recycle</code>ï¼ˆåºŸå¼ƒï¼Œå·²ä¸æ¨èï¼‰ã€‚</li><li><strong>çŠ¶æ€</strong>ï¼š<code>Available</code>ï¼ˆç©ºé—²ï¼‰ã€<code>Bound</code>ï¼ˆå·²ç»‘å®šï¼‰ã€<code>Released</code>ï¼ˆå·²é‡Šæ”¾ï¼‰ã€<code>Failed</code>ï¼ˆå¤±è´¥ï¼‰ã€‚</li></ul></li></ul><p><strong>ç¤ºä¾‹ç”¨é€”</strong>ï¼š<br>æ•°æ®åº“æ•°æ®æŒä¹…åŒ–ã€å…±äº«æ–‡ä»¶ç³»ç»Ÿã€æ—¥å¿—å­˜å‚¨ç­‰åœºæ™¯ã€‚</p><hr><h3 id=2-persistentvolumeclaimpvc><strong>2. PersistentVolumeClaimï¼ˆPVCï¼‰</strong></h3><p><strong>å®šä¹‰</strong>ï¼š<br>PVCæ˜¯ç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„å£°æ˜ï¼Œç”¨äºå‘Kubernetesè¯·æ±‚ç‰¹å®šå¤§å°å’Œè®¿é—®æ¨¡å¼çš„å­˜å‚¨ã€‚å®ƒç±»ä¼¼äºPodç”³è¯·è®¡ç®—èµ„æºï¼ˆCPU/å†…å­˜ï¼‰ï¼Œé€šè¿‡ç»‘å®šPVå®ç°å­˜å‚¨çš„æ¶ˆè´¹ã€‚</p><p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p><ul><li><strong>ä¸PVçš„ç»‘å®š</strong>ï¼šPVCé€šè¿‡åŒ¹é…å­˜å‚¨å®¹é‡ã€è®¿é—®æ¨¡å¼å’ŒStorageClassä¸PVç»‘å®šã€‚</li><li><strong>åŠ¨æ€ä¾›åº”</strong>ï¼šè‹¥æœªåŒ¹é…åˆ°é™æ€PVï¼Œå¯é€šè¿‡<code>StorageClass</code>åŠ¨æ€åˆ›å»ºPVã€‚</li><li><strong>å‘½åç©ºé—´é™åˆ¶</strong>ï¼šPVCå±äºç‰¹å®šå‘½åç©ºé—´ï¼Œè€ŒPVæ˜¯é›†ç¾¤çº§èµ„æºã€‚</li></ul><p><strong>ç¤ºä¾‹YAML</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PersistentVolumeClaim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-pvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ReadWriteOnce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>10Gi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=l>standard </span><span class=w> </span><span class=c># æŒ‡å®šåŠ¨æ€ä¾›åº”çš„å­˜å‚¨ç±»</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=3-pvä¸pvcçš„å…³ç³»><strong>3. PVä¸PVCçš„å…³ç³»</strong></h3><ul><li><strong>é™æ€ä¾›åº”</strong>ï¼šç®¡ç†å‘˜é¢„å…ˆåˆ›å»ºPVï¼Œç”¨æˆ·é€šè¿‡PVCç”³è¯·åŒ¹é…çš„å­˜å‚¨ã€‚</li><li><strong>åŠ¨æ€ä¾›åº”</strong>ï¼šé€šè¿‡<code>StorageClass</code>æ¨¡æ¿è‡ªåŠ¨åˆ›å»ºPVï¼Œæ— éœ€ç®¡ç†å‘˜æ‰‹åŠ¨é…ç½®ã€‚</li><li><strong>ç»‘å®šé€»è¾‘</strong>ï¼š<ul><li>PVCæäº¤åï¼ŒKubernetesæ§åˆ¶å™¨ä¼šå¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„PVè¿›è¡Œç»‘å®šï¼›</li><li>è‹¥ä½¿ç”¨åŠ¨æ€ä¾›åº”ï¼Œåˆ™ç›´æ¥æŒ‰PVCéœ€æ±‚åˆ›å»ºPVã€‚</li></ul></li></ul><hr><h3 id=4-ä½¿ç”¨åœºæ™¯å¯¹æ¯”><strong>4. ä½¿ç”¨åœºæ™¯å¯¹æ¯”</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>åœºæ™¯</strong></th><th><strong>PV</strong></th><th><strong>PVC</strong></th></tr></thead><tbody><tr><td><strong>åˆ›å»ºè€…</strong></td><td>é›†ç¾¤ç®¡ç†å‘˜</td><td>ç”¨æˆ·ï¼ˆå¼€å‘è€…ï¼‰</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ç‹¬ç«‹äºPod</td><td>ä¸Podè§£è€¦ï¼Œä½†ç»‘å®šåä¸PVåŒæ­¥</td></tr><tr><td><strong>æ ¸å¿ƒä½œç”¨</strong></td><td>æä¾›å®é™…å­˜å‚¨èµ„æº</td><td>å£°æ˜å­˜å‚¨éœ€æ±‚å¹¶ç»‘å®šPV</td></tr><tr><td><strong>å­˜å‚¨ç±»å‹é…ç½®</strong></td><td>æ˜ç¡®æŒ‡å®šï¼ˆå¦‚NFSè·¯å¾„ã€äº‘å­˜å‚¨å‚æ•°ï¼‰</td><td>é€šè¿‡StorageClassæŠ½è±¡</td></tr></tbody></table></div><hr><h3 id=5-å¸¸è§é—®é¢˜><strong>5. å¸¸è§é—®é¢˜</strong></h3><ul><li><strong>Q1ï¼šPVCæœªç»‘å®šPVæ€ä¹ˆåŠï¼Ÿ</strong><br>éœ€æ£€æŸ¥PVCçš„å®¹é‡ã€è®¿é—®æ¨¡å¼æ˜¯å¦ä¸å¯ç”¨PVåŒ¹é…ï¼Œæˆ–ç¡®è®¤StorageClassé…ç½®æ­£ç¡®ã€‚</li><li><strong>Q2ï¼šå¦‚ä½•å¤ç”¨å·²é‡Šæ”¾çš„PVï¼Ÿ</strong><br>è‹¥å›æ”¶ç­–ç•¥ä¸º<code>Retain</code>ï¼Œéœ€æ‰‹åŠ¨åˆ é™¤å¹¶é‡æ–°åˆ›å»ºPVã€‚</li></ul><p>é€šè¿‡PVå’ŒPVCçš„åä½œï¼ŒKuberneteså®ç°äº†å­˜å‚¨èµ„æºçš„çµæ´»ç®¡ç†ï¼Œæ—¢èƒ½æ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚ï¼Œåˆèƒ½ç®€åŒ–ç”¨æˆ·æ“ä½œã€‚</p><h2 id=statefulset--deployment>StatefulSet & Deployment</h2><p>StatefulSet å’Œ Deployment æ˜¯ Kubernetes ä¸­ä¸¤ç±»æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œåˆ†åˆ«é’ˆå¯¹æœ‰çŠ¶æ€å’Œæ— çŠ¶æ€åº”ç”¨è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ï¼Œç»“åˆåº”ç”¨åœºæ™¯ã€è¡Œä¸ºç‰¹æ€§åŠåº•å±‚æœºåˆ¶è¿›è¡Œå¯¹æ¯”ï¼š</p><hr><h3 id=1-é€‚ç”¨åœºæ™¯><strong>1. é€‚ç”¨åœºæ™¯</strong></h3><ul><li><p><strong>Deployment</strong><br>é€‚ç”¨äº<strong>æ— çŠ¶æ€åº”ç”¨</strong>ï¼ˆå¦‚ Web æœåŠ¡å™¨ã€API æœåŠ¡ï¼‰ï¼ŒPod ä¹‹é—´å¯éšæ„æ›¿æ¢ä¸”æ— éœ€ä¿ç•™çŠ¶æ€ã€‚<br><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>Pod å®ä¾‹å®Œå…¨å¯¹ç­‰ï¼Œæ— å¯åŠ¨é¡ºåºä¾èµ–ï¼›</li><li>æ•°æ®é€šå¸¸å­˜å‚¨åœ¨ä¸´æ—¶å·æˆ–å…±äº«å­˜å‚¨ä¸­ã€‚</li></ul></li><li><p><strong>StatefulSet</strong><br>é€‚ç”¨äº<strong>æœ‰çŠ¶æ€åº”ç”¨</strong>ï¼ˆå¦‚æ•°æ®åº“ã€åˆ†å¸ƒå¼å­˜å‚¨ï¼‰ï¼Œéœ€ç¨³å®šæ ‡è¯†ã€æŒä¹…åŒ–å­˜å‚¨åŠä¸¥æ ¼é¡ºåºæ§åˆ¶ã€‚<br><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ¯ä¸ª Pod æœ‰å”¯ä¸€åç§°ï¼ˆå¦‚ <code>db-0</code>ã€<code>db-1</code>ï¼‰å’Œå›ºå®š DNS è®°å½•ï¼ˆå¦‚ <code>db-0.myservice.ns.svc.cluster.local</code>ï¼‰ï¼›</li><li>æ•°æ®é€šè¿‡ç‹¬ç«‹çš„ PersistentVolume æŒä¹…åŒ–ï¼Œä¸ Pod ç”Ÿå‘½å‘¨æœŸè§£è€¦ã€‚</li></ul></li></ul><hr><h3 id=2-pod-æ ‡è¯†ä¸ç½‘ç»œ><strong>2. Pod æ ‡è¯†ä¸ç½‘ç»œ</strong></h3><ul><li><p><strong>Deployment</strong></p><ul><li><strong>Pod åç§°éšæœº</strong>ï¼ˆå¦‚ <code>web-app-59d8c5f6c4-abcde</code>ï¼‰ï¼›</li><li><strong>IP åŠ¨æ€åˆ†é…</strong>ï¼Œé‡å¯æˆ–è¿ç§»åå¯èƒ½å˜åŒ–ï¼›</li><li>é€šè¿‡ Service è´Ÿè½½å‡è¡¡æš´éœ²ï¼Œæµé‡éšæœºåˆ†å‘è‡³ä»»æ„ Podã€‚</li></ul></li><li><p><strong>StatefulSet</strong></p><ul><li><strong>Pod åç§°å›ºå®šä¸”æœ‰åº</strong>ï¼ˆå¦‚ <code>db-0</code>ã€<code>db-1</code>ï¼‰ï¼›</li><li><strong>ç½‘ç»œæ ‡è¯†ç¨³å®š</strong>ï¼Œé€šè¿‡ Headless Service æä¾› DNS è®°å½•ï¼Œæ”¯æŒ Pod é—´ç›´æ¥é€šä¿¡ï¼›</li><li>é€‚ç”¨äºéœ€å›ºå®šç½‘ç»œæ‹“æ‰‘çš„åœºæ™¯ï¼ˆå¦‚ä¸»ä»æ•°æ®åº“ï¼‰ã€‚</li></ul></li></ul><hr><h3 id=3-å­˜å‚¨ç®¡ç†><strong>3. å­˜å‚¨ç®¡ç†</strong></h3><ul><li><p><strong>Deployment</strong></p><ul><li>é»˜è®¤ä½¿ç”¨ä¸´æ—¶å­˜å‚¨ï¼ˆå¦‚ <code>emptyDir</code>ï¼‰ï¼›</li><li>è‹¥éœ€æŒä¹…åŒ–å­˜å‚¨ï¼Œéœ€æ‰‹åŠ¨é…ç½® PV/PVCï¼Œä½†æ‰€æœ‰ Pod å¯èƒ½å…±äº«åŒä¸€å·ã€‚</li></ul></li><li><p><strong>StatefulSet</strong></p><ul><li><strong>æ¯ä¸ª Pod ç»‘å®šç‹¬ç«‹å­˜å‚¨</strong>ï¼šé€šè¿‡ <code>volumeClaimTemplates</code> åŠ¨æ€åˆ›å»º PVCï¼Œå­˜å‚¨ä¸ Pod è§£è€¦ä½†ä¸€ä¸€å¯¹åº”ï¼›</li><li>æ•°æ®åœ¨ Pod åˆ é™¤åä¿ç•™ï¼Œé€‚ç”¨äºæ•°æ®åº“å®ä¾‹çš„ç‹¬ç«‹æ•°æ®å­˜å‚¨ã€‚</li></ul></li></ul><hr><h3 id=4-ç”Ÿå‘½å‘¨æœŸç®¡ç†><strong>4. ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></h3><ul><li><p><strong>å¯åŠ¨/ç»ˆæ­¢é¡ºåº</strong></p><ul><li><strong>Deployment</strong>ï¼šPod æ— åºåˆ›å»ºæˆ–åˆ é™¤ï¼Œå¯å¹¶è¡Œæ“ä½œï¼›</li><li><strong>StatefulSet</strong>ï¼šPod æŒ‰é¡ºåºå¯åŠ¨ï¼ˆå¦‚ <code>db-0</code> â†’ <code>db-1</code>ï¼‰å’Œç»ˆæ­¢ï¼ˆé€†åºï¼‰ï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ã€‚</li></ul></li><li><p><strong>æ»šåŠ¨æ›´æ–°ç­–ç•¥</strong></p><ul><li><strong>Deployment</strong>ï¼šæ”¯æŒæ— åºæ»šåŠ¨æ›´æ–°ï¼Œé€šè¿‡ <code>maxUnavailable</code> å’Œ <code>maxSurge</code> æ§åˆ¶æ›´æ–°èŠ‚å¥ï¼›</li><li><strong>StatefulSet</strong>ï¼šæŒ‰åºå·é€†åºæ›´æ–°ï¼ˆå¦‚ <code>db-2</code> â†’ <code>db-1</code> â†’ <code>db-0</code>ï¼‰ï¼Œç¡®ä¿é€ä¸ª Pod å°±ç»ªã€‚</li></ul></li></ul><hr><h3 id=5-æ‰©ç¼©å®¹ä¸åˆ é™¤è¡Œä¸º><strong>5. æ‰©ç¼©å®¹ä¸åˆ é™¤è¡Œä¸º</strong></h3><ul><li><p><strong>æ‰©ç¼©å®¹</strong></p><ul><li><strong>Deployment</strong>ï¼šPod éšæœºåˆ›å»ºæˆ–åˆ é™¤ï¼Œæ— é¡ºåºé™åˆ¶ï¼›</li><li><strong>StatefulSet</strong>ï¼šæ‰©å®¹æ—¶æŒ‰åºåˆ›å»ºæ–° Podï¼Œç¼©å®¹æ—¶æŒ‰é€†åºåˆ é™¤æ—§ Podã€‚</li></ul></li><li><p><strong>åˆ é™¤æ§åˆ¶å™¨æ—¶</strong></p><ul><li><strong>Deployment</strong>ï¼šåˆ é™¤åå…³è” Pod å’Œ ReplicaSet å‡è¢«æ¸…ç†ï¼›</li><li><strong>StatefulSet</strong>ï¼šé»˜è®¤ä¿ç•™ Pod å’Œ PVCï¼Œéœ€æ‰‹åŠ¨åˆ é™¤ä»¥ç¡®ä¿æ•°æ®å®‰å…¨ã€‚</li></ul></li></ul><hr><h3 id=æ€»ç»“å¯¹æ¯”è¡¨><strong>æ€»ç»“å¯¹æ¯”è¡¨</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Deployment</strong></th><th><strong>StatefulSet</strong></th></tr></thead><tbody><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æ— çŠ¶æ€åº”ç”¨ï¼ˆWebã€APIï¼‰</td><td>æœ‰çŠ¶æ€åº”ç”¨ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</td></tr><tr><td><strong>Pod æ ‡è¯†</strong></td><td>éšæœºåç§°ï¼ŒåŠ¨æ€ IP</td><td>å›ºå®šåç§°ï¼ˆå¦‚ <code>db-0</code>ï¼‰ï¼Œç¨³å®š DNS</td></tr><tr><td><strong>å­˜å‚¨</strong></td><td>ä¸´æ—¶å·æˆ–å…±äº«å­˜å‚¨</td><td>æ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…åŒ–å­˜å‚¨</td></tr><tr><td><strong>å¯åŠ¨é¡ºåº</strong></td><td>æ— åº</td><td>ä¸¥æ ¼æŒ‰é¡ºåºåˆ›å»º/åˆ é™¤ï¼ˆ<code>db-0</code> â†’ <code>db-1</code>ï¼‰</td></tr><tr><td><strong>æ›´æ–°ç­–ç•¥</strong></td><td>æ— åºæ»šåŠ¨æ›´æ–°</td><td>é€†åºé€ä¸ªæ›´æ–°</td></tr><tr><td><strong>é€‚ç”¨æ¡ˆä¾‹</strong></td><td>Nginxã€æ— çŠ¶æ€å¾®æœåŠ¡</td><td>MySQLã€Kafkaã€Zookeeper</td></tr></tbody></table></div><hr><h3 id=é€‰æ‹©å»ºè®®><strong>é€‰æ‹©å»ºè®®</strong></h3><ul><li><strong>ä¼˜å…ˆé€‰ Deployment</strong>ï¼šè‹¥åº”ç”¨æ— çŠ¶æ€ã€å¯æ°´å¹³æ‰©å±•ä¸”æ— éœ€å›ºå®šç½‘ç»œæ ‡è¯†ï¼ˆå¦‚ REST APIï¼‰ï¼›</li><li><strong>ä¼˜å…ˆé€‰ StatefulSet</strong>ï¼šè‹¥éœ€ç¨³å®šç½‘ç»œæ ‡è¯†ã€ç‹¬ç«‹å­˜å‚¨æˆ–æœ‰åºç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚æ•°æ®åº“é›†ç¾¤ã€åˆ†å¸ƒå¼é”æœåŠ¡ï¼‰ã€‚</li></ul><p>é€šè¿‡åˆç†é€‰æ‹©æ§åˆ¶å™¨ï¼Œå¯æœ‰æ•ˆå¹³è¡¡åº”ç”¨çš„å¼¹æ€§ä¸çŠ¶æ€ä¸€è‡´æ€§éœ€æ±‚ã€‚</p><h2 id=docker-compose-rebuild>Docker Compose Rebuild</h2><p>åœ¨ Docker Compose ä¸­ï¼Œ<code>docker compose build</code> å‘½ä»¤çš„ <strong>Rebuild ç­–ç•¥</strong>å¯ä»¥é€šè¿‡ä»¥ä¸‹é€‰é¡¹çµæ´»æŒ‡å®šï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ä¸‹çš„é•œåƒæ„å»ºéœ€æ±‚ï¼š</p><hr><h3 id=å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ„å»º><strong>å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ„å»º</strong></h3><p>é€šè¿‡ <code>--no-cache</code> å‚æ•°ï¼Œè·³è¿‡ Docker æ„å»ºç¼“å­˜ï¼Œä»å¤´å¼€å§‹é‡æ–°æ„å»ºé•œåƒã€‚<br><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå½“ Dockerfile ä¸­çš„æŒ‡ä»¤é¡ºåºæˆ–å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œä½†ç¼“å­˜å¯èƒ½å¯¼è‡´æ—§ç‰ˆæœ¬æ®‹ç•™æ—¶ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose build --no-cache <span class=o>[</span>SERVICE_NAME<span class=o>]</span>
</span></span></code></pre></div><blockquote><p>å¼•ç”¨è¯´æ˜ï¼šæ­¤é€‰é¡¹åœ¨ç½‘é¡µä¸­å‡æœ‰æåŠï¼Œæ˜ç¡®ç”¨äºç¦ç”¨ç¼“å­˜ã€‚</p></blockquote><hr><h3 id=å¼ºåˆ¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ><strong>å¼ºåˆ¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ</strong></h3><p>ä½¿ç”¨ <code>--pull</code> å‚æ•°ï¼Œå¼ºåˆ¶ä»é•œåƒä»“åº“æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„åŸºç¡€é•œåƒï¼ˆå¦‚ <code>FROM</code> æŒ‡å®šçš„é•œåƒï¼‰ã€‚<br><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç¡®ä¿åŸºç¡€é•œåƒï¼ˆå¦‚ <code>python:3.6-alpine</code>ï¼‰æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…æœ¬åœ°æ—§ç‰ˆæœ¬å½±å“æ„å»ºã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose build --pull <span class=o>[</span>SERVICE_NAME<span class=o>]</span>
</span></span></code></pre></div><blockquote><p>å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µå‡å¼ºè°ƒæ­¤é€‰é¡¹ç”¨äºæ›´æ–°åŸºç¡€é•œåƒã€‚</p></blockquote><hr><h3 id=å¹¶è¡Œæ„å»ºå¤šä¸ªæœåŠ¡><strong>å¹¶è¡Œæ„å»ºå¤šä¸ªæœåŠ¡</strong></h3><p>é€šè¿‡ <code>--parallel</code> å‚æ•°ï¼ˆDocker Compose 3.4+ æ”¯æŒï¼‰ï¼Œå¯ç”¨å¤šæœåŠ¡å¹¶è¡Œæ„å»ºä»¥åŠ é€Ÿæ•´ä½“æµç¨‹ã€‚<br><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå½“é¡¹ç›®åŒ…å«å¤šä¸ªç‹¬ç«‹æœåŠ¡ä¸”æ„å»ºè¿‡ç¨‹æ— ä¾èµ–æ—¶ï¼Œå¯æ˜¾è‘—å‡å°‘æ„å»ºæ—¶é—´ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose build --parallel
</span></span></code></pre></div><blockquote><p>å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µè¯¦ç»†è¯´æ˜äº†å¹¶è¡Œæ„å»ºçš„é€‚ç”¨æ€§å’Œä½¿ç”¨æ–¹æ³•ã€‚</p></blockquote><hr><h3 id=é€‰æ‹©æ€§é‡å»ºæŒ‡å®šæœåŠ¡><strong>é€‰æ‹©æ€§é‡å»ºæŒ‡å®šæœåŠ¡</strong></h3><p>åœ¨å‘½ä»¤ä¸­æŒ‡å®šæœåŠ¡åç§°ï¼Œä»…é‡æ–°æ„å»ºç‰¹å®šæœåŠ¡ï¼Œè€Œéæ‰€æœ‰æœåŠ¡ã€‚<br><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä»…æŸä¸ªæœåŠ¡çš„ Dockerfile æˆ–ä¾èµ–å‘ç”Ÿå˜æ›´æ—¶ï¼Œé’ˆå¯¹æ€§é‡å»ºä»¥èŠ‚çœèµ„æºã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose build web  <span class=c1># ä»…é‡å»ºåä¸º &#34;web&#34; çš„æœåŠ¡</span>
</span></span></code></pre></div><blockquote><p>å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µå‡æåˆ°é€šè¿‡æœåŠ¡åç§°é€‰æ‹©æ€§æ„å»ºã€‚</p></blockquote><hr><h3 id=åˆ é™¤ä¸´æ—¶å®¹å™¨å’Œé•œåƒ><strong>åˆ é™¤ä¸´æ—¶å®¹å™¨å’Œé•œåƒ</strong></h3><p>é€šè¿‡ <code>--force-rm</code> å‚æ•°ï¼Œåˆ é™¤æ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å®¹å™¨ï¼Œé¿å…æ®‹ç•™æ–‡ä»¶å ç”¨ç©ºé—´ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose build --force-rm <span class=o>[</span>SERVICE_NAME<span class=o>]</span>
</span></span></code></pre></div><blockquote><p>å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µæŒ‡å‡ºæ­¤é€‰é¡¹ç”¨äºæ¸…ç†ä¸´æ—¶å®¹å™¨ã€‚</p></blockquote><hr><h3 id=ç»„åˆç­–ç•¥ç¤ºä¾‹><strong>ç»„åˆç­–ç•¥ç¤ºä¾‹</strong></h3><p>å¯ç»„åˆå¤šä¸ªå‚æ•°å®ç°å¤æ‚ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose build --no-cache --pull web  <span class=c1># å¼ºåˆ¶é‡å»º &#34;web&#34; æœåŠ¡ï¼Œç¦ç”¨ç¼“å­˜å¹¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ</span>
</span></span></code></pre></div><hr><h3 id=æ€»ç»“>æ€»ç»“</h3><p>é€šè¿‡ä¸Šè¿°å‚æ•°ï¼Œå¯ä»¥çµæ´»æ§åˆ¶ Docker Compose çš„æ„å»ºè¡Œä¸ºï¼Œé€‚é…å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒéœ€æ±‚ã€‚å…·ä½“é€‰æ‹©éœ€ç»“åˆä»¥ä¸‹å› ç´ ï¼š</p><ul><li><strong>ç¼“å­˜ä¾èµ–</strong>ï¼šæ˜¯å¦éœ€è¦å®Œå…¨å¹²å‡€çš„æ„å»ºç¯å¢ƒï¼ˆå¦‚ CI/CD æµæ°´çº¿ï¼‰ã€‚</li><li><strong>é•œåƒæ›´æ–°</strong>ï¼šæ˜¯å¦ä¾èµ–æœ€æ–°åŸºç¡€é•œåƒçš„å®‰å…¨æ€§æ›´æ–°ã€‚</li><li><strong>æ•ˆç‡ä¼˜åŒ–</strong>ï¼šæ˜¯å¦å¯ç”¨å¹¶è¡Œæ„å»ºä»¥å‡å°‘æ—¶é—´æˆæœ¬ã€‚</li></ul><blockquote><p>æç¤ºï¼šå¯é€šè¿‡ <code>docker compose config</code> éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œæˆ–ç»“åˆ <code>docker compose up --build</code> ç›´æ¥å¯åŠ¨é‡å»ºåçš„æœåŠ¡ã€‚</p></blockquote><h2 id=docker-compose>Docker compose</h2><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Docker Compose è¿è¡Œ <code>.yaml</code> æ–‡ä»¶çš„å®Œæ•´æŒ‡å—ï¼Œç»¼åˆäº†æœ€ä½³å®è·µå’Œå…³é”®æ³¨æ„äº‹é¡¹ï¼š</p><h3 id=åŸºç¡€è¿è¡Œæµç¨‹>åŸºç¡€è¿è¡Œæµç¨‹</h3><ol><li><p><strong>éªŒè¯é…ç½®æ–‡ä»¶</strong><br>æ‰§è¡Œ <code>docker-compose config</code> æ£€æŸ¥ YAML æ–‡ä»¶è¯­æ³•ï¼Œé¿å…å› ç¼©è¿›é”™è¯¯æˆ–æ ¼å¼é—®é¢˜å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚</p></li><li><p><strong>å¯åŠ¨æœåŠ¡</strong><br>åœ¨åŒ…å« <code>docker-compose.yaml</code> çš„ç›®å½•ä¸‹æ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up        <span class=c1># å‰å°è¿è¡Œï¼ˆæŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼‰</span>
</span></span><span class=line><span class=cl>docker-compose up -d     <span class=c1># åå°è¿è¡Œ</span>
</span></span></code></pre></div></li><li><p><strong>æœåŠ¡ç®¡ç†</strong></p><ul><li><code>docker-compose ps</code> æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</li><li><code>docker-compose logs [æœåŠ¡å]</code> æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—</li><li><code>docker-compose down</code> åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œå’Œå·</li></ul></li></ol><h3 id=yaml-æ–‡ä»¶æ ¸å¿ƒé…ç½®>YAML æ–‡ä»¶æ ¸å¿ƒé…ç½®</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>  </span><span class=c># æŒ‡å®šå…¼å®¹ç‰ˆæœ¬</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;80:80&#34;</span><span class=w>  </span><span class=c># ç«¯å£æ˜ å°„ï¼ˆä¸»æœº:å®¹å™¨ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./html:/usr/share/nginx/html </span><span class=w> </span><span class=c># ç›®å½•æŒ‚è½½</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db </span><span class=w> </span><span class=c># åŸºç¡€ä¾èµ–å£°æ˜</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>  </span><span class=c># å¥åº·æ£€æŸ¥é…ç½®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;CMD-SHELL&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;pg_isready -U postgres&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span></code></pre></div><h3 id=é«˜çº§è¿è¡ŒæŠ€å·§>é«˜çº§è¿è¡ŒæŠ€å·§</h3><ol><li><p><strong>ç¯å¢ƒå˜é‡æ³¨å…¥</strong><br>ä½¿ç”¨ <code>.env</code> æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ŒYAML ä¸­é€šè¿‡ <code>${VAR_NAME}</code> å¼•ç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DB_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>${DB_SECRET}</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>å¤šç¯å¢ƒé…ç½®</strong><br>é€šè¿‡å åŠ å¤šä¸ª Compose æ–‡ä»¶å®ç°ç¯å¢ƒå·®å¼‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
</span></span></code></pre></div></li><li><p><strong>èµ„æºé™åˆ¶</strong><br>é…ç½®å®¹å™¨èµ„æºä½¿ç”¨ä¸Šé™é˜²æ­¢è¿‡è½½ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>1G</span><span class=w>
</span></span></span></code></pre></div></li></ol><h3 id=è·¨å¹³å°æ³¨æ„äº‹é¡¹>è·¨å¹³å°æ³¨æ„äº‹é¡¹</h3><ol><li><p><strong>Windows ç‰¹æ®Šé…ç½®</strong></p><ul><li>ç¡®ä¿ Docker Desktop å·²å®‰è£…å¹¶å¯ç”¨ WSL2</li><li>è·¯å¾„ä½¿ç”¨æ­£æ–œæ  <code>/</code> ä»£æ›¿åæ–œæ  <code>\</code></li><li>é¿å…ä½¿ç”¨ä¿ç•™ç«¯å£ï¼ˆå¦‚ 80/443ï¼‰å¯èƒ½è¢«ç³»ç»Ÿå ç”¨</li></ul></li><li><p><strong>Linux æƒé™å¤„ç†</strong><br>å®¹å™¨å†…ç”¨æˆ·æƒé™éœ€ä¸æŒ‚è½½ç›®å½•åŒ¹é…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>./data:/var/lib/postgresql/data:z </span><span class=w> </span><span class=c># SELinux ä¸Šä¸‹æ–‡æ ‡è®°</span><span class=w>
</span></span></span></code></pre></div></li></ol><h3 id=æ•…éšœæ’æŸ¥æŒ‡å—>æ•…éšœæ’æŸ¥æŒ‡å—</h3><ol><li><p><strong>å¯åŠ¨é¡ºåºé—®é¢˜</strong><br>ä½¿ç”¨å¢å¼ºå‹ä¾èµ–å£°æ˜ï¼Œç¡®ä¿æœåŠ¡çœŸæ­£å¯ç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>service_healthy</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>å¸¸è§é”™è¯¯å¤„ç†</strong></p><ul><li><strong>ç«¯å£å†²çª</strong>ï¼šé€šè¿‡ <code>netstat -ano</code> æ£€æŸ¥å ç”¨ç«¯å£</li><li><strong>å·æŒ‚è½½å¤±è´¥</strong>ï¼šéªŒè¯ä¸»æœºç›®å½•å­˜åœ¨ä¸”å…·æœ‰è¯»å†™æƒé™</li><li><strong>é•œåƒæ‹‰å–è¶…æ—¶</strong>ï¼šé…ç½®å›½å†…é•œåƒåŠ é€Ÿæº</li></ul></li></ol><blockquote><p>æç¤ºï¼šå»ºè®®ä½¿ç”¨ <code>docker-compose --help</code> æŸ¥çœ‹å®Œæ•´å‘½ä»¤åˆ—è¡¨ã€‚å¯¹äºå¤æ‚ç¼–æ’åœºæ™¯ï¼Œå¯ç»“åˆ <a class=link href=https://docs.docker.com/engine/swarm/ target=_blank rel=noopener>Docker Swarm</a> å®ç°é›†ç¾¤ç®¡ç†ã€‚</p></blockquote><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Docker Compose æŒ‡å®šè‡ªå®šä¹‰ YAML æ–‡ä»¶çš„å®Œæ•´æŒ‡å—ï¼Œæ•´åˆäº†å¤šç¯‡æŠ€æœ¯æ–‡æ¡£çš„æ ¸å¿ƒè¦ç‚¹ï¼š</p><h3 id=åŸºç¡€æŒ‡å®šæ–¹æ³•>åŸºç¡€æŒ‡å®šæ–¹æ³•</h3><ol><li><p><strong>å•æ–‡ä»¶æŒ‡å®š</strong><br>é€šè¿‡ <code>-f</code> å‚æ•°ç›´æ¥æŒ‡å®š YAML æ–‡ä»¶è·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f docker-compose.prod.yml up -d
</span></span></code></pre></div><p>æ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ <code>./config/custom.yml</code>ï¼‰</p></li><li><p><strong>å¤šæ–‡ä»¶åˆå¹¶</strong><br>å åŠ å¤šä¸ª YAML æ–‡ä»¶å®ç°é…ç½®æ‰©å±•ï¼Œä¼˜å…ˆçº§æŒ‰ä¹¦å†™é¡ºåºé€’å¢ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f base.yml -f override.yml up
</span></span></code></pre></div><p>å¸¸ç”¨äºåŒºåˆ†åŸºç¡€é…ç½®ä¸ç¯å¢ƒå·®å¼‚ï¼ˆå¦‚å¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼‰</p></li></ol><h3 id=å…¸å‹åº”ç”¨åœºæ™¯-1>å…¸å‹åº”ç”¨åœºæ™¯</h3><div class=table-wrapper><table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹å‘½ä»¤</th></tr></thead><tbody><tr><td>å¤šç¯å¢ƒéƒ¨ç½²</td><td><code>docker-compose -f docker-compose.yml -f docker-compose.prod.yml up</code></td></tr><tr><td>æµ‹è¯•é…ç½®æ–‡ä»¶</td><td><code>docker-compose -f test-stack.yaml down --volumes</code></td></tr><tr><td>è‡ªå®šä¹‰è·¯å¾„éƒ¨ç½²</td><td><code>docker-compose -f /opt/myapp/config.yml up</code></td></tr><tr><td>ä¸´æ—¶è°ƒè¯•é…ç½®</td><td><code>docker-compose -f debug-config.yaml logs --follow</code></td></tr></tbody></table></div><h3 id=è·¯å¾„å¤„ç†è§„åˆ™>è·¯å¾„å¤„ç†è§„åˆ™</h3><ol><li><p><strong>æ–‡ä»¶æœç´¢ä¼˜å…ˆçº§</strong><br>Docker Compose é»˜è®¤æŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼š</p><ul><li>å½“å‰ç›®å½•çš„ <code>docker-compose.yml</code></li><li><code>docker-compose.override.yml</code>ï¼ˆè‡ªåŠ¨åˆå¹¶ï¼‰</li><li>è‹¥æœªæ‰¾åˆ°ï¼Œå¿…é¡»æ˜¾å¼é€šè¿‡ <code>-f</code> æŒ‡å®š</li></ul></li><li><p><strong>è·¨å¹³å°è·¯å¾„æ ¼å¼</strong></p><ul><li>Windowsï¼šå»ºè®®ä½¿ç”¨æ­£æ–œæ  <code>/</code>ï¼ˆå¦‚ <code>C:/projects/app.yml</code>ï¼‰</li><li>Linux/macOSï¼šæ”¯æŒç›¸å¯¹è·¯å¾„ <code>../parent-dir/config.yaml</code></li></ul></li></ol><h3 id=éªŒè¯ä¸è°ƒè¯•>éªŒè¯ä¸è°ƒè¯•</h3><ol><li><p><strong>é…ç½®é¢„æ£€</strong><br>æ‰§è¡Œè¯­æ³•éªŒè¯å‘½ä»¤ï¼Œé¿å…é…ç½®é”™è¯¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f custom.yml config
</span></span></code></pre></div><p>è¯¥å‘½ä»¤ä¼šè¾“å‡ºåˆå¹¶åçš„æœ€ç»ˆé…ç½®å¹¶æ£€æŸ¥è¯­æ³•æœ‰æ•ˆæ€§</p></li><li><p><strong>ç¯å¢ƒå˜é‡æ³¨å…¥</strong><br>åœ¨è‡ªå®šä¹‰ YAML ä¸­ç»“åˆ <code>.env</code> æ–‡ä»¶å®ç°åŠ¨æ€é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:${POSTGRES_VERSION}</span><span class=w>
</span></span></span></code></pre></div><p>éœ€ç¡®ä¿ <code>.env</code> æ–‡ä»¶ä¸ YAML æ–‡ä»¶åœ¨åŒä¸€ç›®å½•æˆ–é€šè¿‡ <code>--env-file</code> æŒ‡å®š</p></li></ol><h3 id=é«˜çº§æŠ€å·§>é«˜çº§æŠ€å·§</h3><ol><li><p><strong>ç»„åˆå‘½ä»¤ä¼˜åŒ–</strong><br>å°†å¸¸ç”¨å‘½ä»¤å°è£…ä¸ºåˆ«åæé«˜æ•ˆç‡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>dc</span><span class=o>=</span><span class=s1>&#39;docker-compose -f ~/projects/core-stack.yml&#39;</span>
</span></span><span class=line><span class=cl>dc up -d  <span class=c1># ç­‰æ•ˆäºå®Œæ•´å‘½ä»¤</span>
</span></span></code></pre></div></li><li><p><strong>ç‰ˆæœ¬å…¼å®¹æ€§æ§åˆ¶</strong><br>åœ¨ YAML æ–‡ä»¶é¡¶éƒ¨å£°æ˜è¯­æ³•ç‰ˆæœ¬é¿å…å…¼å®¹é—®é¢˜ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>  </span><span class=c># æ”¯æŒèµ„æºé™åˆ¶ã€æ‰©å±•é…ç½®ç­‰æ–°ç‰¹æ€§</span><span class=w>
</span></span></span></code></pre></div></li></ol><blockquote><p><strong>æ“ä½œå»ºè®®</strong>ï¼šå¯¹äºé•¿æœŸè¿è¡Œçš„æœåŠ¡ï¼Œæ¨èå°†è‡ªå®šä¹‰ YAML æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œå¹¶é€šè¿‡ CI/CD æµæ°´çº¿å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚è‹¥éœ€æŸ¥çœ‹å®Œæ•´å‘½ä»¤åˆ—è¡¨ï¼Œå¯æ‰§è¡Œ <code>docker-compose --help</code> è·å–å®æ—¶å¸®åŠ©ã€‚</p></blockquote><h2 id=k8s-æœ¬åœ°é•œåƒ>k8s æœ¬åœ°é•œåƒ</h2><p>åœ¨Kubernetesï¼ˆK8sï¼‰ä¸­ï¼Œè‹¥æƒ³ç›´æ¥ä½¿ç”¨ä¸»èŠ‚ç‚¹æœ¬åœ°æ„å»ºçš„Dockeré•œåƒæ‰§è¡Œ<code>kubectl apply</code>ï¼Œéœ€è¦ç¡®ä¿é•œåƒèƒ½è¢«é›†ç¾¤èŠ‚ç‚¹è®¿é—®ï¼Œå¹¶é…ç½®æ­£ç¡®çš„æ‹‰å–ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•åŠæ­¥éª¤ï¼š</p><hr><h3 id=1-é…ç½®é•œåƒæ‹‰å–ç­–ç•¥><strong>1. é…ç½®é•œåƒæ‹‰å–ç­–ç•¥</strong></h3><p>åœ¨K8sçš„Deploymentæˆ–Podé…ç½®æ–‡ä»¶ä¸­ï¼Œ<strong>å¿…é¡»è®¾ç½®<code>imagePullPolicy: Never</code></strong>ï¼Œè¿™ä¼šå¼ºåˆ¶Kubernetesç›´æ¥ä½¿ç”¨æœ¬åœ°é•œåƒè€Œä¸å°è¯•ä»è¿œç¨‹ä»“åº“æ‹‰å–ã€‚ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>my-local-image:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never </span><span class=w> </span><span class=c># å…³é”®é…ç½®</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=2-ç¡®ä¿é•œåƒå­˜åœ¨äºé›†ç¾¤èŠ‚ç‚¹><strong>2. ç¡®ä¿é•œåƒå­˜åœ¨äºé›†ç¾¤èŠ‚ç‚¹</strong></h3><p>Kubernetesçš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ï¼‰éƒ½éœ€è¦æœ‰è¯¥é•œåƒã€‚æ ¹æ®é›†ç¾¤ç±»å‹é€‰æ‹©ä»¥ä¸‹æ–¹æ³•ï¼š</p><h4 id=æ–¹æ³•ä¸€å•èŠ‚ç‚¹é›†ç¾¤ä¸»èŠ‚ç‚¹å³å·¥ä½œèŠ‚ç‚¹><strong>æ–¹æ³•ä¸€ï¼šå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆä¸»èŠ‚ç‚¹å³å·¥ä½œèŠ‚ç‚¹ï¼‰</strong></h4><ul><li><strong>ç›´æ¥åœ¨ä¸»èŠ‚ç‚¹æ„å»ºé•œåƒ</strong>ï¼šé€šè¿‡<code>docker build -t my-local-image:latest .</code>æ„å»ºé•œåƒï¼Œä¸»èŠ‚ç‚¹ä¼šç›´æ¥ä½¿ç”¨è¯¥é•œåƒã€‚</li></ul><h4 id=æ–¹æ³•äºŒå¤šèŠ‚ç‚¹é›†ç¾¤><strong>æ–¹æ³•äºŒï¼šå¤šèŠ‚ç‚¹é›†ç¾¤</strong></h4><ul><li><p><strong>é€šè¿‡<code>docker save</code>å’Œ<code>docker load</code>åˆ†å‘é•œåƒ</strong>ï¼š</p><ol><li>åœ¨ä¸»èŠ‚ç‚¹å°†é•œåƒä¿å­˜ä¸ºtaræ–‡ä»¶ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker save -o my-local-image.tar my-local-image:latest
</span></span></code></pre></div></li><li>å°†taræ–‡ä»¶ä¼ è¾“åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå¦‚ä½¿ç”¨<code>scp</code>ï¼‰ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scp my-local-image.tar user@node-ip:/path/
</span></span></code></pre></div></li><li>åœ¨æ¯ä¸ªèŠ‚ç‚¹åŠ è½½é•œåƒï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker load -i my-local-image.tar
</span></span></code></pre></div></li></ol><p>æ­¤æ–¹æ³•é€‚ç”¨äºåŸºäºDockerçš„KubernetesèŠ‚ç‚¹ã€‚</p></li><li><p><strong>ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“</strong>ï¼ˆå¦‚ä¸»èŠ‚ç‚¹è¿è¡ŒRegistryï¼‰ï¼š</p><ol><li>åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨æœ¬åœ°Registryï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -p 5000:5000 --name registry registry:2
</span></span></code></pre></div></li><li>æ ‡è®°å¹¶æ¨é€é•œåƒåˆ°Registryï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker tag my-local-image:latest localhost:5000/my-local-image:latest
</span></span><span class=line><span class=cl>docker push localhost:5000/my-local-image:latest
</span></span></code></pre></div></li><li>åœ¨Deploymenté…ç½®ä¸­ä½¿ç”¨<code>image: localhost:5000/my-local-image:latest</code>ã€‚</li></ol></li></ul><h4 id=æ–¹æ³•ä¸‰ç‰¹å®šå·¥å…·é“¾æ”¯æŒ><strong>æ–¹æ³•ä¸‰ï¼šç‰¹å®šå·¥å…·é“¾æ”¯æŒ</strong></h4><ul><li><p><strong>Kindé›†ç¾¤</strong>ï¼šä½¿ç”¨<code>kind load docker-image</code>å‘½ä»¤å°†æœ¬åœ°é•œåƒç›´æ¥åŠ è½½åˆ°Kindé›†ç¾¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kind load docker-image my-local-image:latest --name &lt;cluster-name&gt;
</span></span></code></pre></div><p>é€‚ç”¨äºå¼€å‘ç¯å¢ƒå¿«é€ŸåŠ è½½é•œåƒã€‚</p></li><li><p><strong>Minikubeé›†ç¾¤</strong>ï¼šé€šè¿‡<code>minikube cache add</code>å°†é•œåƒæ·»åŠ åˆ°ç¼“å­˜ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>minikube cache add my-local-image:latest
</span></span></code></pre></div><p>ä»…é€‚ç”¨äºMinikubeæœ¬åœ°å¼€å‘ç¯å¢ƒã€‚</p></li></ul><hr><h3 id=3-åº”ç”¨é…ç½®å¹¶éªŒè¯><strong>3. åº”ç”¨é…ç½®å¹¶éªŒè¯</strong></h3><ol><li>æ‰§è¡Œ<code>kubectl apply -f deployment.yaml</code>éƒ¨ç½²åº”ç”¨ã€‚</li><li>æ£€æŸ¥PodçŠ¶æ€ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods
</span></span></code></pre></div></li><li>è‹¥Podå¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs &lt;pod-name&gt;
</span></span></code></pre></div>å¸¸è§é—®é¢˜åŒ…æ‹¬é•œåƒæœªåŠ è½½åˆ°èŠ‚ç‚¹æˆ–æ ‡ç­¾é”™è¯¯ã€‚</li></ol><hr><h3 id=é€‚ç”¨åœºæ™¯å¯¹æ¯”><strong>é€‚ç”¨åœºæ™¯å¯¹æ¯”</strong></h3><div class=table-wrapper><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ³•</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>å•èŠ‚ç‚¹æœ¬åœ°å¼€å‘</td><td>ç›´æ¥æ„å»º+<code>imagePullPolicy</code></td><td>æ— éœ€é¢å¤–æ“ä½œï¼Œå¿«é€ŸéªŒè¯</td></tr><tr><td>å¤šèŠ‚ç‚¹ç”Ÿäº§ç¯å¢ƒ</td><td>ç§æœ‰é•œåƒä»“åº“</td><td>é›†ä¸­ç®¡ç†ï¼Œé€‚åˆå›¢é˜Ÿåä½œ</td></tr><tr><td>Kind/Minikubeå¼€å‘ç¯å¢ƒ</td><td>å·¥å…·é“¾å‘½ä»¤ï¼ˆå¦‚<code>kind load</code>ï¼‰</td><td>è‡ªåŠ¨åŒ–åŠ è½½ï¼Œé¿å…æ‰‹åŠ¨åˆ†å‘</td></tr></tbody></table></div><hr><p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥çµæ´»å®ç°åœ¨K8sä¸­ç›´æ¥ä½¿ç”¨ä¸»èŠ‚ç‚¹æœ¬åœ°æ„å»ºçš„é•œåƒã€‚è‹¥éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ç»“åˆCI/CDæµæ°´çº¿è‡ªåŠ¨åŒæ­¥é•œåƒåˆ°é›†ç¾¤èŠ‚ç‚¹ã€‚</p><h2 id=k8s-master--worker>K8s Master & Worker</h2><p>Kubernetesï¼ˆK8sï¼‰çš„<strong>MasterèŠ‚ç‚¹</strong>å’Œ<strong>WorkerèŠ‚ç‚¹</strong>åœ¨é›†ç¾¤ä¸­æ‰¿æ‹…å®Œå…¨ä¸åŒçš„è§’è‰²ï¼Œä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ä½“ç°åœ¨åŠŸèƒ½å®šä½ã€æ ¸å¿ƒç»„ä»¶å’ŒèŒè´£åˆ†å·¥ä¸Šï¼š</p><hr><h3 id=åŠŸèƒ½å®šä½><strong>åŠŸèƒ½å®šä½</strong></h3><ol><li><p><strong>MasterèŠ‚ç‚¹</strong></p><ul><li><strong>é›†ç¾¤çš„â€œå¤§è„‘â€</strong>ï¼šè´Ÿè´£å…¨å±€ç®¡ç†ã€è°ƒåº¦å’Œåè°ƒï¼Œæ˜¯é›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ã€‚æ‰€æœ‰æ§åˆ¶å‘½ä»¤ï¼ˆå¦‚èµ„æºåˆ›å»ºã€æ‰©ç¼©å®¹ï¼‰å‡é€šè¿‡MasterèŠ‚ç‚¹æ‰§è¡Œã€‚</li><li><strong>é«˜å¯ç”¨æ€§è¦æ±‚</strong>ï¼šç”Ÿäº§ç¯å¢ƒä¸­é€šå¸¸éƒ¨ç½²å¤šä¸ªMasterèŠ‚ç‚¹ï¼ˆå¦‚3ä¸ªï¼‰ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´é›†ç¾¤ç˜«ç—ªã€‚</li></ul></li><li><p><strong>WorkerèŠ‚ç‚¹</strong></p><ul><li><strong>èµ„æºçš„â€œæ‰§è¡Œè€…â€</strong>ï¼šæä¾›è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ï¼‰å¹¶è¿è¡Œå®é™…çš„å·¥ä½œè´Ÿè½½ï¼ˆPodï¼‰ï¼Œæ˜¯é›†ç¾¤çš„æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰ã€‚</li><li><strong>åŠ¨æ€æ‰©å±•æ€§</strong>ï¼šå¯æ ¹æ®è´Ÿè½½åŠ¨æ€å¢å‡WorkerèŠ‚ç‚¹ï¼Œæ”¯æŒæ¨ªå‘æ‰©å±•ã€‚</li></ul></li></ol><hr><h3 id=æ ¸å¿ƒç»„ä»¶><strong>æ ¸å¿ƒç»„ä»¶</strong></h3><div class=table-wrapper><table><thead><tr><th><strong>ç»„ä»¶</strong></th><th><strong>MasterèŠ‚ç‚¹</strong></th><th><strong>WorkerèŠ‚ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶</strong></td><td>- <strong>kube-apiserver</strong>ï¼šé›†ç¾¤APIå…¥å£ï¼Œå”¯ä¸€ä¸etcdäº¤äº’çš„ç»„ä»¶<br>- <strong>kube-scheduler</strong>ï¼šè°ƒåº¦Podåˆ°åˆé€‚èŠ‚ç‚¹<br>- <strong>kube-controller-manager</strong>ï¼šç»´æŠ¤é›†ç¾¤çŠ¶æ€ï¼ˆå¦‚è‡ªæ„ˆã€å‰¯æœ¬æ•°ï¼‰<br>- <strong>etcd</strong>ï¼šåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼Œä¿å­˜é›†ç¾¤çŠ¶æ€</td><td>- <strong>kubelet</strong>ï¼šç®¡ç†Podç”Ÿå‘½å‘¨æœŸï¼Œä¸Masteré€šä¿¡<br>- <strong>kube-proxy</strong>ï¼šç»´æŠ¤æœåŠ¡ç½‘ç»œè§„åˆ™å’Œè´Ÿè½½å‡è¡¡<br>- <strong>å®¹å™¨è¿è¡Œæ—¶</strong>ï¼ˆå¦‚Docker/containerdï¼‰ï¼šè¿è¡Œå®¹å™¨</td></tr><tr><td><strong>æ•°æ®å­˜å‚¨</strong></td><td>å­˜å‚¨é›†ç¾¤å…¨å±€çŠ¶æ€ï¼ˆå¦‚Podã€Serviceé…ç½®ï¼‰äºetcd</td><td>æ— æŒä¹…åŒ–å­˜å‚¨ï¼Œä»…è¿è¡Œä¸´æ—¶Pod</td></tr><tr><td><strong>ç½‘ç»œç®¡ç†</strong></td><td>ä¸ç›´æ¥å‚ä¸Podç½‘ç»œï¼Œç”±kube-proxyå’ŒCNIæ’ä»¶å®ç°</td><td>é€šè¿‡kube-proxyå®ç°Serviceç½‘ç»œè§„åˆ™</td></tr></tbody></table></div><hr><h3 id=èŒè´£åˆ†å·¥><strong>èŒè´£åˆ†å·¥</strong></h3><ol><li><p><strong>MasterèŠ‚ç‚¹çš„æ ¸å¿ƒèŒè´£</strong></p><ul><li><strong>é›†ç¾¤çŠ¶æ€ç®¡ç†</strong>ï¼šé€šè¿‡etcdå­˜å‚¨æ‰€æœ‰èµ„æºå¯¹è±¡çš„é…ç½®å’ŒçŠ¶æ€ã€‚</li><li><strong>èµ„æºè°ƒåº¦</strong>ï¼šç”±Scheduleræ ¹æ®èµ„æºéœ€æ±‚é€‰æ‹©æœ€ä½³WorkerèŠ‚ç‚¹è¿è¡ŒPodã€‚</li><li><strong>æ§åˆ¶å¾ªç¯</strong>ï¼šController Managerç¡®ä¿é›†ç¾¤å®é™…çŠ¶æ€ä¸æœŸæœ›ä¸€è‡´ï¼ˆå¦‚è‡ªåŠ¨é‡å¯å¤±è´¥çš„Podï¼‰ã€‚</li><li><strong>APIæœåŠ¡</strong>ï¼šæä¾›RESTfulæ¥å£ä¾›ç”¨æˆ·å’Œç»„ä»¶äº¤äº’ï¼ˆå¦‚kubectlå‘½ä»¤ï¼‰ã€‚</li></ul></li><li><p><strong>WorkerèŠ‚ç‚¹çš„æ ¸å¿ƒèŒè´£</strong></p><ul><li><strong>è¿è¡Œå®¹å™¨</strong>ï¼šé€šè¿‡å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨Podä¸­çš„å®¹å™¨ï¼Œå¹¶ç›‘æ§å…¶çŠ¶æ€ã€‚</li><li><strong>çŠ¶æ€ä¸ŠæŠ¥</strong>ï¼škubeletå®šæœŸå‘Masteræ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µï¼ˆå¦‚CPUã€å†…å­˜ï¼‰ã€‚</li><li><strong>ç½‘ç»œä»£ç†</strong>ï¼škube-proxyç»´æŠ¤Serviceçš„IPå’Œç«¯å£æ˜ å°„ï¼Œç¡®ä¿æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</li></ul></li></ol><hr><h3 id=ç±»æ¯”æ€»ç»“><strong>ç±»æ¯”æ€»ç»“</strong></h3><ul><li><strong>MasterèŠ‚ç‚¹</strong>ï¼šç±»ä¼¼ä¼ä¸šçš„â€œç®¡ç†å±‚â€ï¼Œè´Ÿè´£åˆ¶å®šç­–ç•¥ã€åˆ†é…ä»»åŠ¡å¹¶ç›‘æ§å…¨å±€è¿è¡Œã€‚</li><li><strong>WorkerèŠ‚ç‚¹</strong>ï¼šç±»ä¼¼â€œä¸€çº¿å‘˜å·¥â€ï¼Œå…·ä½“æ‰§è¡Œä»»åŠ¡å¹¶åé¦ˆæ‰§è¡Œæƒ…å†µã€‚</li></ul><p>è‹¥éœ€æ›´æ·±å…¥çš„ç»„ä»¶äº¤äº’æµç¨‹ï¼ˆå¦‚Podåˆ›å»ºè¿‡ç¨‹ï¼‰æˆ–é«˜å¯ç”¨éƒ¨ç½²æ–¹æ¡ˆï¼Œå¯å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚</p><h2 id=master-èŠ‚ç‚¹è¦æ±‚>Master èŠ‚ç‚¹è¦æ±‚</h2><p>Kubernetes çš„ Master èŠ‚ç‚¹ç¡®å®ä¸»è¦è´Ÿè´£é›†ç¾¤çš„è°ƒåº¦å’Œç®¡ç†ï¼Œé»˜è®¤ä¸è¿è¡Œç”¨æˆ· Podï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å…¶å†…å­˜å’Œ GPU çš„éœ€æ±‚å¯ä»¥å¤§å¹…é™ä½ã€‚ä»¥ä¸‹ä»ç¡¬ä»¶è¦æ±‚ã€æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§ã€èµ„æºå ç”¨åœºæ™¯ä¸‰ä¸ªç»´åº¦è¯¦ç»†åˆ†æï¼š</p><hr><h3 id=å†…å­˜éœ€æ±‚çš„åº•å±‚é€»è¾‘><strong>å†…å­˜éœ€æ±‚çš„åº•å±‚é€»è¾‘</strong></h3><p>è™½ç„¶ Master èŠ‚ç‚¹ä¸è¿è¡Œç”¨æˆ· Podï¼Œä½†å…¶æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ <code>kube-apiserver</code>ã€<code>etcd</code>ã€<code>kube-scheduler</code> ç­‰ï¼‰åœ¨ <strong>é«˜å¹¶å‘è¯·æ±‚æˆ–å¤§è§„æ¨¡é›†ç¾¤</strong> ä¸‹ä¼šäº§ç”Ÿæ˜¾è‘—å†…å­˜æ¶ˆè€—ï¼š</p><ol><li><p><strong>etcd çš„å†…å­˜ä¾èµ–</strong></p><ul><li>etcd å­˜å‚¨é›†ç¾¤æ‰€æœ‰çŠ¶æ€æ•°æ®ï¼ˆPodã€Service ç­‰ï¼‰ï¼Œé¢‘ç¹çš„è¯»å†™æ“ä½œï¼ˆå¦‚å¤§è§„æ¨¡ Pod æ»šåŠ¨æ›´æ–°ï¼‰ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚</li><li>æ ¹æ®å®è·µæ¡ˆä¾‹ï¼Œç”Ÿäº§çº§é›†ç¾¤çš„ etcd å†…å­˜å»ºè®®ä¸ä½äº <strong>8GB</strong>ï¼Œè¶…å¤§è§„æ¨¡é›†ç¾¤ï¼ˆå¦‚åƒèŠ‚ç‚¹çº§åˆ«ï¼‰éœ€æå‡è‡³ <strong>16GB ä»¥ä¸Š</strong>ã€‚</li></ul></li><li><p><strong>API Server çš„å¹¶å‘å‹åŠ›</strong></p><ul><li><code>kube-apiserver</code> æ˜¯é›†ç¾¤çš„æµé‡å…¥å£ï¼Œéœ€å¤„ç†æ¥è‡ª <code>kubectl</code>ã€Controllerã€Worker èŠ‚ç‚¹çš„å¿ƒè·³ç­‰è¯·æ±‚ã€‚å½“é›†ç¾¤è§„æ¨¡æ‰©å¤§æ—¶ï¼Œå…¶å†…å­˜å ç”¨ä¼šçº¿æ€§å¢é•¿ã€‚ä¾‹å¦‚ï¼Œ500 èŠ‚ç‚¹çš„é›†ç¾¤ä¸­ API Server å†…å­˜å¯èƒ½è¾¾åˆ° <strong>4-6GB</strong>ã€‚</li></ul></li><li><p><strong>é»˜è®¤é…ç½®ä¸å®‰å…¨ç¼“å†²</strong></p><ul><li>å®˜æ–¹æ¨è Master èŠ‚ç‚¹å†…å­˜æœ€ä½ä¸º <strong>8GB</strong>ï¼Œä½†ç”Ÿäº§ç¯å¢ƒå»ºè®® <strong>16GB ä»¥ä¸Š</strong>ï¼Œä¸ºçªå‘æµé‡ï¼ˆå¦‚æ‰¹é‡åˆ›å»º Podï¼‰å’Œç»„ä»¶å‡çº§é¢„ç•™ç¼“å†²ç©ºé—´ã€‚</li></ul></li></ol><hr><h3 id=gpu-éœ€æ±‚çš„æ˜ç¡®ç»“è®º><strong>GPU éœ€æ±‚çš„æ˜ç¡®ç»“è®º</strong></h3><p>Master èŠ‚ç‚¹ <strong>å®Œå…¨ä¸éœ€è¦ GPU</strong>ï¼Œå› å…¶èŒè´£ä¸æ¶‰åŠä»»ä½• GPU è®¡ç®—åœºæ™¯ï¼š</p><ol><li><p><strong>è°ƒåº¦ä¸ GPU æ— å…³æ€§</strong></p><ul><li>è°ƒåº¦å™¨ï¼ˆ<code>kube-scheduler</code>ï¼‰ä»…æ ¹æ® Pod çš„èµ„æºå£°æ˜ï¼ˆå¦‚ <code>nvidia.com/gpu: 1</code>ï¼‰é€‰æ‹©èŠ‚ç‚¹ï¼Œä¸å‚ä¸ GPU é©±åŠ¨çš„è°ƒç”¨æˆ–è®¡ç®—è¿‡ç¨‹ã€‚</li></ul></li><li><p><strong>GPU èµ„æºä¸“å±äº Worker èŠ‚ç‚¹</strong></p><ul><li>GPU èŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½®ï¼ˆå¦‚æ˜¾å­˜ã€é©±åŠ¨ï¼‰ä»…åœ¨ Worker èŠ‚ç‚¹éƒ¨ç½²ï¼ŒMaster èŠ‚ç‚¹æ— éœ€å®‰è£… NVIDIA é©±åŠ¨æˆ– GPU æ’ä»¶ã€‚</li></ul></li></ol><hr><h3 id=æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ç­–ç•¥><strong>æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ç­–ç•¥</strong></h3><p>é’ˆå¯¹ä¸åŒåœºæ™¯ï¼Œå¯è°ƒæ•´ Master èŠ‚ç‚¹çš„èµ„æºé…ç½®ï¼š</p><div class=table-wrapper><table><thead><tr><th><strong>åœºæ™¯</strong></th><th><strong>CPU å»ºè®®</strong></th><th><strong>å†…å­˜å»ºè®®</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td><strong>å¼€å‘/æµ‹è¯•é›†ç¾¤</strong></td><td>4 æ ¸</td><td>8GB</td><td>ä½è´Ÿè½½åœºæ™¯ï¼Œæ”¯æŒåŸºæœ¬è°ƒåº¦åŠŸèƒ½</td></tr><tr><td><strong>ç”Ÿäº§çº§é›†ç¾¤ï¼ˆ&lt;100èŠ‚ç‚¹ï¼‰</strong></td><td>8 æ ¸</td><td>16-32GB</td><td>éœ€åº”å¯¹é«˜å¹¶å‘ API è¯·æ±‚å’Œ etcd å‹åŠ›</td></tr><tr><td><strong>è¶…å¤§è§„æ¨¡/AI é›†ç¾¤</strong></td><td>16 æ ¸ä»¥ä¸Š</td><td>64GB ä»¥ä¸Š</td><td>ç»“åˆ RDMA ç½‘ç»œä¼˜åŒ–ï¼Œé¿å…æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</td></tr></tbody></table></div><hr><h3 id=å…³é”®é…ç½®å»ºè®®><strong>å…³é”®é…ç½®å»ºè®®</strong></h3><ol><li><strong>ç¦ç”¨ Swap</strong><br>æ‰€æœ‰ Master èŠ‚ç‚¹å¿…é¡»å…³é—­ Swapï¼Œé¿å…å†…å­˜äº¤æ¢å¯¼è‡´è°ƒåº¦å»¶è¿Ÿã€‚</li><li><strong>ä¸“ç”¨å­˜å‚¨ä¼˜åŒ–</strong><br>ä¸º etcd é…ç½® SSD æˆ– NVMe ç¡¬ç›˜ï¼Œæå‡é”®å€¼å­˜å‚¨æ€§èƒ½ï¼ˆIOPS >5000ï¼‰ã€‚</li><li><strong>é«˜å¯ç”¨éƒ¨ç½²</strong><br>ç”Ÿäº§ç¯å¢ƒè‡³å°‘éƒ¨ç½² <strong>3 ä¸ª Master èŠ‚ç‚¹</strong>ï¼Œå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡åˆ†æ•£ API Server æµé‡ã€‚</li></ol><hr><h3 id=æ€»ç»“-1>æ€»ç»“</h3><ul><li><strong>GPU éœ€æ±‚</strong>ï¼šMaster èŠ‚ç‚¹æ— éœ€ GPUï¼Œä»… Worker èŠ‚ç‚¹éœ€è¦é…ç½®ã€‚</li><li><strong>å†…å­˜éœ€æ±‚</strong>ï¼šä¸å¯è¿‡åº¦å‹ç¼©ï¼Œéœ€æ ¹æ®é›†ç¾¤è§„æ¨¡é¢„ç•™å……è¶³èµ„æºï¼ˆ<strong>8GB èµ·æ­¥ï¼Œç”Ÿäº§ç¯å¢ƒ 16GB ä»¥ä¸Š</strong>ï¼‰ã€‚</li><li><strong>æ€§èƒ½ç“¶é¢ˆè§„é¿</strong>ï¼šé€šè¿‡ SSDã€å¤šèŠ‚ç‚¹éƒ¨ç½²å’Œå†…æ ¸å‚æ•°ä¼˜åŒ–ï¼ˆå¦‚ <code>net.ipv4.ip_forward=1</code>ï¼‰æå‡ç¨³å®šæ€§ã€‚</li></ul><h2 id=minikube-é¢„ç”Ÿäº§éªŒè¯>Minikube é¢„ç”Ÿäº§éªŒè¯</h2><p>Minikube <strong>ä¸æ¨èç”¨äºé¢„ç”Ÿäº§éªŒè¯</strong>ï¼Œå…¶è®¾è®¡å®šä½å’ŒåŠŸèƒ½ç‰¹æ€§ä¸»è¦é¢å‘æœ¬åœ°å¼€å‘ã€å­¦ä¹ å’Œå°è§„æ¨¡æµ‹è¯•åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š</p><hr><h3 id=minikubeçš„æ ¸å¿ƒå®šä½ä¸åŠŸèƒ½é™åˆ¶><strong>Minikubeçš„æ ¸å¿ƒå®šä½ä¸åŠŸèƒ½é™åˆ¶</strong></h3><ul><li><strong>å•èŠ‚ç‚¹æ¶æ„</strong>ï¼šMinikubeé»˜è®¤éƒ¨ç½²å•èŠ‚ç‚¹Kubernetesé›†ç¾¤ï¼Œæ— æ³•æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¸­å¸¸è§çš„å¤šèŠ‚ç‚¹é«˜å¯ç”¨æ¶æ„ï¼ˆå¦‚MasterèŠ‚ç‚¹å†—ä½™ã€è´Ÿè½½å‡è¡¡ç­‰ï¼‰ã€‚è™½ç„¶é€šè¿‡<code>--nodes</code>å‚æ•°å¯æ‰©å±•ä¸ºå¤šèŠ‚ç‚¹æ¨¡å¼ï¼Œä½†å…¶åº•å±‚ä»ä¾èµ–è™šæ‹ŸåŒ–æˆ–å®¹å™¨ç¯å¢ƒï¼Œèµ„æºè°ƒåº¦å’Œç½‘ç»œæ€§èƒ½ä¸çœŸå®é›†ç¾¤å­˜åœ¨å·®å¼‚ã€‚</li><li><strong>èµ„æºé™åˆ¶</strong>ï¼šMinikubeè¿è¡Œåœ¨æœ¬åœ°æœºå™¨çš„è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå—é™äºæœ¬åœ°ç¡¬ä»¶èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ï¼‰ï¼Œæ— æ³•æ‰¿è½½ç”Ÿäº§çº§è´Ÿè½½å‹åŠ›æµ‹è¯•æˆ–å¤§è§„æ¨¡å¹¶å‘åœºæ™¯ã€‚</li><li><strong>ç»„ä»¶ç®€åŒ–</strong>ï¼šMinikubeé»˜è®¤ä½¿ç”¨è½»é‡çº§ç½‘ç»œæ’ä»¶ï¼ˆå¦‚flannelï¼‰å’Œå­˜å‚¨æ–¹æ¡ˆï¼Œè€Œç”Ÿäº§ç¯å¢ƒé€šå¸¸éœ€è¦æ›´å¤æ‚çš„CNIï¼ˆå¦‚Calicoã€Ciliumï¼‰å’ŒæŒä¹…åŒ–å­˜å‚¨é…ç½®ï¼ˆå¦‚äº‘å­˜å‚¨å·ï¼‰ã€‚</li></ul><hr><h3 id=é¢„ç”Ÿäº§éªŒè¯çš„æ ¸å¿ƒéœ€æ±‚><strong>é¢„ç”Ÿäº§éªŒè¯çš„æ ¸å¿ƒéœ€æ±‚</strong></h3><p>é¢„ç”Ÿäº§ç¯å¢ƒéœ€å°½å¯èƒ½è´´è¿‘ç”Ÿäº§ç¯å¢ƒï¼ŒéªŒè¯å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šå¤šèŠ‚ç‚¹é›†ç¾¤çš„æ•…éšœè½¬ç§»èƒ½åŠ›ã€API Serverå†—ä½™ç­‰ã€‚</li><li><strong>ç½‘ç»œä¸å­˜å‚¨æ€§èƒ½</strong>ï¼šçœŸå®ç½‘ç»œå»¶è¿Ÿã€å¸¦å®½åŠå­˜å‚¨I/Oçš„æ¨¡æ‹Ÿã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šç”Ÿäº§çº§RBACç­–ç•¥ã€ç½‘ç»œç­–ç•¥ç­‰å®‰å…¨é…ç½®ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šè‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½çš„ç¨³å®šæ€§ã€‚</li></ul><p>Minikubeåœ¨è¿™äº›æ–¹é¢çš„æ”¯æŒæœ‰é™ï¼Œä¾‹å¦‚å…¶å†…ç½®çš„<code>kube-proxy</code>ä»…æä¾›åŸºç¡€çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦æ›´å¤æ‚çš„Ingressæ§åˆ¶å™¨æˆ–æœåŠ¡ç½‘æ ¼ã€‚</p><hr><h3 id=æ›¿ä»£æ–¹æ¡ˆå»ºè®®><strong>æ›¿ä»£æ–¹æ¡ˆå»ºè®®</strong></h3><p>è‹¥éœ€è¿›è¡Œé¢„ç”Ÿäº§éªŒè¯ï¼Œå»ºè®®é€‰æ‹©ä»¥ä¸‹å·¥å…·ï¼š</p><ul><li><strong>K3s</strong>ï¼šè½»é‡çº§ä½†æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œé€‚åˆè¾¹ç¼˜è®¡ç®—å’Œèµ„æºå—é™ç¯å¢ƒã€‚</li><li><strong>Kindï¼ˆKubernetes in Dockerï¼‰</strong>ï¼šåŸºäºå®¹å™¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œé€‚åˆCI/CDæµæ°´çº¿æµ‹è¯•ã€‚</li><li><strong>äº‘æ‰˜ç®¡KubernetesæœåŠ¡</strong>ï¼ˆå¦‚è…¾è®¯äº‘TKEï¼‰ï¼šç›´æ¥ä½¿ç”¨ä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´çš„äº‘åŸç”Ÿæ¶æ„ï¼Œæ”¯æŒé«˜å¯ç”¨é›†ç¾¤å’Œè‡ªåŠ¨åŒ–è¿ç»´ã€‚</li></ul><hr><h3 id=ç»“è®º>ç»“è®º</h3><p>Minikubeé€‚ç”¨äº<strong>æœ¬åœ°å¼€å‘è°ƒè¯•</strong>å’Œ<strong>KubernetesåŸºç¡€å­¦ä¹ </strong>ï¼Œä½†æ— æ³•æ»¡è¶³é¢„ç”Ÿäº§éªŒè¯å¯¹å¤æ‚æ€§å’ŒçœŸå®æ€§çš„è¦æ±‚ã€‚è‹¥éœ€é¢„ç”Ÿäº§éªŒè¯ï¼Œåº”é€‰æ‹©æ”¯æŒå¤šèŠ‚ç‚¹ã€é«˜å¯ç”¨æ€§åŠç”Ÿäº§çº§ç»„ä»¶çš„å·¥å…·æˆ–äº‘æœåŠ¡ã€‚</p><h2 id=github-action>Github Action</h2><p>åœ¨æœåŠ¡å™¨ä¸Šåˆ©ç”¨ GitHub Actions æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œçš„æ ¸å¿ƒæµç¨‹æ˜¯é€šè¿‡å·¥ä½œæµï¼ˆWorkflowï¼‰è§¦å‘è¿œç¨‹å‘½ä»¤ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æµ‹è¯•æˆ–è¿ç»´ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯å…³é”®æ­¥éª¤å’Œé…ç½®æ–¹æ³•ï¼š</p><hr><h3 id=-é…ç½®æœåŠ¡å™¨è®¤è¯ssh-å¯†é’¥>ğŸ”‘ é…ç½®æœåŠ¡å™¨è®¤è¯ï¼ˆSSH å¯†é’¥ï¼‰</h3><ol><li><p><strong>ç”Ÿæˆ SSH å¯†é’¥å¯¹</strong><br>åœ¨æœ¬åœ°æˆ–æœåŠ¡å™¨æ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh-keygen -t rsa -b <span class=m>4096</span> -C <span class=s2>&#34;github-actions&#34;</span>  <span class=c1># ç”Ÿæˆä¸“ç”¨å¯†é’¥å¯¹</span>
</span></span></code></pre></div><p>å…¬é’¥ï¼ˆ<code>id_rsa.pub</code>ï¼‰éœ€æ·»åŠ åˆ°æœåŠ¡å™¨çš„ <code>~/.ssh/authorized_keys</code> æ–‡ä»¶ä¸­ã€‚</p></li><li><p><strong>åœ¨ GitHub ä»“åº“æ·»åŠ å¯†é’¥</strong></p><ul><li>ç§é’¥ï¼ˆ<code>id_rsa</code>ï¼‰å­˜å…¥ GitHub ä»“åº“çš„ <strong>Settings â†’ Secrets</strong>ï¼Œå‘½åä¸º <code>SERVER_SSH_KEY</code>ã€‚</li><li>æœåŠ¡å™¨ IPã€ç”¨æˆ·åç­‰æ•æ„Ÿä¿¡æ¯ä¹Ÿå­˜å…¥ Secretsï¼ˆå¦‚ <code>SERVER_HOST</code>ã€<code>SERVER_USER</code>ï¼‰ã€‚</li></ul></li></ol><hr><h3 id=-ç¼–å†™-github-actions-å·¥ä½œæµ>âš™ï¸ ç¼–å†™ GitHub Actions å·¥ä½œæµ</h3><p>åœ¨ä»“åº“åˆ›å»º <code>.github/workflows/custom-action.yml</code> æ–‡ä»¶ï¼Œç¤ºä¾‹ç»“æ„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Server Custom Task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main] </span><span class=w> </span><span class=c># è§¦å‘æ¡ä»¶ï¼šæ¨é€è‡³ main åˆ†æ”¯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w>   </span><span class=c># æ”¯æŒæ‰‹åŠ¨è§¦å‘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>execute-commands</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4 </span><span class=w> </span><span class=c># æ£€å‡ºä»£ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add SSH Key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;${{ secrets.SERVER_SSH_KEY }}&#34; &gt; deploy_key.pem
</span></span></span><span class=line><span class=cl><span class=sd>          chmod 600 deploy_key.pem  # è®¾ç½®å¯†é’¥æƒé™</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run Remote Commands</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>appleboy/ssh-action@master </span><span class=w> </span><span class=c># SSH æ‰§è¡Œå‘½ä»¤</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SERVER_HOST }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SERVER_USER }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>deploy_key.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>| </span><span class=w> </span><span class=c># è‡ªå®šä¹‰æ“ä½œç¤ºä¾‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=l>cd /path/to/project</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=l>git pull origin main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=l>systemctl restart my-service</span><span class=w>
</span></span></span></code></pre></div><hr><h3 id=-è‡ªå®šä¹‰æ“ä½œåœºæ™¯ç¤ºä¾‹>ğŸ’» è‡ªå®šä¹‰æ“ä½œåœºæ™¯ç¤ºä¾‹</h3><ol><li><p><strong>éƒ¨ç½²åº”ç”¨</strong></p><ul><li>æ‹‰å–ä»£ç åæ‰§è¡Œæ„å»ºå‘½ä»¤ï¼ˆå¦‚ <code>mvn package</code> / <code>npm run build</code>ï¼‰ã€‚</li><li>é€šè¿‡ <code>scp</code> æˆ– <code>rsync</code> åŒæ­¥æ–‡ä»¶åˆ°æœåŠ¡å™¨ã€‚</li></ul></li><li><p><strong>é‡å¯æœåŠ¡</strong><br>é€šè¿‡ SSH æ‰§è¡ŒæœåŠ¡ç®¡ç†å‘½ä»¤ï¼ˆå¦‚ <code>docker-compose up -d</code> æˆ– <code>systemctl restart</code>ï¼‰ã€‚</p></li><li><p><strong>å®šæ—¶ä»»åŠ¡</strong><br>ä½¿ç”¨ <code>schedule</code> è§¦å‘å™¨å®šæœŸæ‰§è¡Œå¤‡ä»½æˆ–æ¸…ç†ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>cron</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0 2 * * *&#39;</span><span class=w>  </span><span class=c># æ¯å¤© UTC æ—¶é—´ 2:00</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>API è§¦å‘</strong><br>é€šè¿‡ <code>repository_dispatch</code> äº‹ä»¶æ¥æ”¶å¤–éƒ¨è¯·æ±‚è§¦å‘å·¥ä½œæµï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X POST https://api.github.com/repos/:owner/:repo/dispatches <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -H <span class=s2>&#34;Authorization: token </span><span class=nv>$GITHUB_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -d <span class=s1>&#39;{&#34;event_type&#34;: &#34;trigger-backup&#34;}&#39;</span>
</span></span></code></pre></div></li></ol><hr><h3 id=-æ³¨æ„äº‹é¡¹-1>âš ï¸ æ³¨æ„äº‹é¡¹</h3><ol><li><p><strong>å®‰å…¨æ€§</strong></p><ul><li>æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆIPã€å¯†é’¥ï¼‰å¿…é¡»é€šè¿‡ <strong>Secrets</strong> å­˜å‚¨ã€‚</li><li>é™åˆ¶æœåŠ¡å™¨è´¦æˆ·æƒé™ï¼ˆé¿å…ä½¿ç”¨ <code>root</code>ï¼‰ã€‚</li></ul></li><li><p><strong>ä¾èµ–ç®¡ç†</strong></p><ul><li>è‹¥éœ€æœåŠ¡å™¨ç¯å¢ƒï¼ˆå¦‚ Node.js/Pythonï¼‰ï¼Œåœ¨è„šæœ¬ä¸­æ˜¾å¼å£°æ˜ç¯å¢ƒé…ç½®ã€‚</li><li>ä½¿ç”¨ç¼“å­˜åŠ é€Ÿä¾èµ–å®‰è£…ï¼ˆå¦‚ <code>actions/cache</code>ï¼‰ã€‚</li></ul></li><li><p><strong>æ—¥å¿—ä¸è°ƒè¯•</strong></p><ul><li>å·¥ä½œæµæ—¥å¿—åœ¨ GitHub çš„ <strong>Actions</strong> æ ‡ç­¾é¡µå®æ—¶æŸ¥çœ‹ã€‚</li><li>å¤æ‚è„šæœ¬å»ºè®®å…ˆåœ¨æœåŠ¡å™¨æœ¬åœ°æµ‹è¯•ã€‚</li></ul></li></ol><hr><h3 id=-é«˜çº§æŠ€å·§>ğŸ”§ é«˜çº§æŠ€å·§</h3><ul><li><strong>çŸ©é˜µç­–ç•¥</strong>ï¼šåŒæ—¶æµ‹è¯•å¤šç¯å¢ƒï¼ˆå¦‚ä¸åŒç³»ç»Ÿæˆ–ç‰ˆæœ¬ï¼‰ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>os</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ubuntu-22.04, windows-latest]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>node</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>18.</span><span class=l>x, 20.x]</span><span class=w>
</span></span></span></code></pre></div></li><li><strong>å·¥ä»¶ä¼ é€’</strong>ï¼šç”¨ <code>actions/upload-artifact</code> å’Œ <code>actions/download-artifact</code> è·¨ä½œä¸šå…±äº«æ–‡ä»¶ã€‚</li><li><strong>å®¡æ‰¹æµç¨‹</strong>ï¼šé€šè¿‡ <code>pull_request_review</code> äº‹ä»¶å®ç°éƒ¨ç½²å‰äººå·¥å®¡æ ¸ã€‚</li></ul><hr><p>é€šè¿‡ä¸Šè¿°æµç¨‹ï¼ŒGitHub Actions å¯æ— ç¼å¯¹æ¥è‡ªæœ‰æœåŠ¡å™¨ï¼Œå®ç°ä»ä»£ç æ¨é€åˆ°æœåŠ¡æ›´æ–°çš„å…¨é“¾è·¯è‡ªåŠ¨åŒ–ã€‚å®é™…é…ç½®æ—¶éœ€æ ¹æ®é¡¹ç›®éœ€æ±‚è°ƒæ•´è„šæœ¬å’Œè§¦å‘æ¡ä»¶ï¼Œå¹¶ä¼˜å…ˆéªŒè¯å…³é”®æ­¥éª¤çš„å¯é æ€§ã€‚</p><h2 id=è¿æ¥æŠ¥é”™>è¿æ¥æŠ¥é”™</h2><p>æ ¹æ®é”™è¯¯æ—¥å¿—åˆ†æï¼ŒGitHub Action ä½¿ç”¨ <code>appleboy/ssh-action</code> æ—¶å‡ºç°è®¤è¯å¤±è´¥çš„æ ¸å¿ƒåŸå› æ˜¯ <strong>SSH ç§é’¥è§£æå¤±è´¥</strong>ï¼ˆ<code>ssh.ParsePrivateKey: ssh: no key found</code>ï¼‰ï¼Œå¯¼è‡´åç»­è®¤è¯æ–¹æ³•å…¨éƒ¨å¤±æ•ˆã€‚ä»¥ä¸‹æ˜¯å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š</p><hr><h3 id=-é”™è¯¯åŸå› åˆ†æ>ğŸ” é”™è¯¯åŸå› åˆ†æ</h3><ol><li><p><strong>ç§é’¥æ ¼å¼æ— æ•ˆ</strong>ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰</p><ul><li>å­˜å‚¨åœ¨ GitHub Secrets ä¸­çš„ç§é’¥å¯èƒ½ï¼š<ul><li>ç¼ºå°‘æ ‡å‡†çš„ <code>-----BEGIN OPENSSH PRIVATE KEY-----</code> å¤´æˆ– <code>-----END...</code> å°¾</li><li>åŒ…å«å¤šä½™ç©ºæ ¼/æ¢è¡Œç¬¦</li><li>ä½¿ç”¨ä¸å…¼å®¹çš„å¯†é’¥ç±»å‹ï¼ˆå¦‚æ—§ç‰ˆ PEM æ ¼å¼ï¼‰</li></ul></li><li>é”™è¯¯æ—¥å¿—æ˜ç¡®æç¤ºï¼š<code>ssh: no key found</code></li></ul></li><li><p><strong>æƒé™é…ç½®é—®é¢˜</strong>ï¼ˆæ¬¡è¦å¯èƒ½ï¼‰</p><ul><li>Action è¿è¡Œæ—¶æœªæ­£ç¡®è®¾ç½®ç§é’¥æ–‡ä»¶æƒé™ï¼ˆéœ€ <code>600</code>ï¼‰</li><li>æœåŠ¡å™¨ç«¯ <code>authorized_keys</code> æ–‡ä»¶æƒé™é”™è¯¯ï¼ˆéœ€ <code>600</code>ï¼‰</li></ul></li><li><p><strong>æœåŠ¡å™¨ SSH é…ç½®é™åˆ¶</strong></p><ul><li><code>/etc/ssh/sshd_config</code> ä¸­æœªå¯ç”¨å…¬é’¥è®¤è¯ï¼š<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PubkeyAuthentication yes  <span class=c1># å¿…é¡»ä¸º yes</span>
</span></span></code></pre></div></li></ul></li></ol><hr><h3 id=-è§£å†³æ–¹æ¡ˆé€æ­¥æ“ä½œ>ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼ˆé€æ­¥æ“ä½œï¼‰</h3><h4 id=æ­¥éª¤-1ä¿®å¤ç§é’¥æ ¼å¼å…³é”®>æ­¥éª¤ 1ï¼šä¿®å¤ç§é’¥æ ¼å¼ï¼ˆå…³é”®ï¼ï¼‰</h4><ol><li><p><strong>æœ¬åœ°éªŒè¯ç§é’¥æœ‰æ•ˆæ€§</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh-keygen -p -f ~/.ssh/id_rsa  <span class=c1># è¾“å…¥å¯†ç ï¼ˆå¦‚æœ‰ï¼‰éªŒè¯å¯†é’¥å®Œæ•´æ€§</span>
</span></span></code></pre></div><ul><li>è‹¥æŠ¥é”™ <code>Invalid format</code>ï¼Œè¯´æ˜å¯†é’¥æŸå</li></ul></li><li><p><strong>é‡æ–°ç”Ÿæˆæ ‡å‡†å¯†é’¥å¯¹</strong>ï¼ˆæ¨èï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh-keygen -t ed25519 -f new_key -C <span class=s2>&#34;github-action&#34;</span>  <span class=c1># ç°ä»£ç®—æ³•</span>
</span></span><span class=line><span class=cl><span class=c1># æˆ–</span>
</span></span><span class=line><span class=cl>ssh-keygen -t rsa -b <span class=m>4096</span> -f new_key -C <span class=s2>&#34;github-action&#34;</span>
</span></span></code></pre></div></li><li><p><strong>æ£€æŸ¥ç§é’¥æ ¼å¼</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat new_key  <span class=c1># å¿…é¡»åŒ…å«å®Œæ•´å¤´å°¾æ ‡è®°</span>
</span></span></code></pre></div><p>âœ… æ­£ç¡®æ ¼å¼ç¤ºä¾‹ï¼š</p><pre tabindex=0><code>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW...
-----END OPENSSH PRIVATE KEY-----
</code></pre></li><li><p><strong>æ›´æ–° GitHub Secrets</strong>ï¼š</p><ul><li>å°† <code>new_key</code> å†…å®¹å®Œæ•´å¤åˆ¶åˆ° <code>SSH_PRIVATE_KEY</code> Secret</li><li><strong>ç¦æ­¢ä¿®æ”¹</strong>ï¼šä¸åˆ é™¤å¤´å°¾æ ‡è®°ã€ä¸å¢å‡æ¢è¡Œç¬¦</li></ul></li></ol><h4 id=æ­¥éª¤-2ä¿®æ­£-action-é…ç½®>æ­¥éª¤ 2ï¼šä¿®æ­£ Action é…ç½®</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SSH Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>appleboy/ssh-action@v0.1.13 </span><span class=w> </span><span class=c># å›ºå®šç¨³å®šç‰ˆæœ¬</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SSH_HOST }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SSH_USERNAME }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SSH_PRIVATE_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># æ·»åŠ è°ƒè¯•å‚æ•° â†“</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># å¼€å¯è¯¦ç»†æ—¥å¿—</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      echo &#34;è¿æ¥æˆåŠŸï¼&#34;</span><span class=w>
</span></span></span></code></pre></div><h4 id=æ­¥éª¤-3æœåŠ¡å™¨ç«¯æ£€æŸ¥>æ­¥éª¤ 3ï¼šæœåŠ¡å™¨ç«¯æ£€æŸ¥</h4><ol><li><p><strong>ç¡®è®¤å…¬é’¥å·²æ·»åŠ </strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/.ssh/authorized_keys  <span class=c1># åº”åŒ…å« id_rsa.pub å†…å®¹</span>
</span></span></code></pre></div></li><li><p><strong>ä¿®å¤æƒé™</strong>ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod <span class=m>700</span> ~/.ssh
</span></span><span class=line><span class=cl>chmod <span class=m>600</span> ~/.ssh/authorized_keys
</span></span></code></pre></div></li><li><p><strong>æ£€æŸ¥ SSH é…ç½®</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo grep -E <span class=s2>&#34;PubkeyAuthentication|PermitRootLogin&#34;</span> /etc/ssh/sshd_config
</span></span></code></pre></div><ul><li>ç¡®ä¿è¾“å‡ºåŒ…å«ï¼š<pre tabindex=0><code>PubkeyAuthentication yes
PermitRootLogin prohibit-password  # æˆ– yesï¼ˆæ ¹æ®éœ€æ±‚ï¼‰
</code></pre></li><li>é‡å¯æœåŠ¡ï¼š<code>sudo systemctl restart sshd</code></li></ul></li></ol><h4 id=æ­¥éª¤-4æœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•å¯é€‰>æ­¥éª¤ 4ï¼šæœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆå¯é€‰ï¼‰</h4><p>åœ¨ GitHub Action è¿è¡Œå‰ï¼Œæœ¬åœ°éªŒè¯å¯†é’¥æœ‰æ•ˆæ€§ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh -i path/to/new_key -v <span class=nv>$SSH_USER</span>@<span class=nv>$SSH_HOST</span>
</span></span></code></pre></div><ul><li>è§‚å¯Ÿ <code>debug1: Authentication succeeded (publickey)</code> è¾“å‡º</li></ul><hr><h3 id=-æ³¨æ„äº‹é¡¹-2>âš ï¸ æ³¨æ„äº‹é¡¹</h3><ol><li><p><strong>ç§é’¥å®‰å…¨</strong>ï¼š</p><ul><li>æ°¸è¿œä¸è¦å°†ç§é’¥æäº¤åˆ°ä»£ç åº“</li><li>GitHub Secrets å­˜å‚¨æ—¶é¿å…æ¢è¡Œç¬¦è‡ªåŠ¨è½¬æ¢ï¼ˆå»ºè®®å¤åˆ¶åæ£€æŸ¥å­—ç¬¦æ•°ï¼‰</li></ul></li><li><p><strong>Action ç‰ˆæœ¬æ§åˆ¶</strong>ï¼š</p><ul><li>é¿å…ä½¿ç”¨ <code>@master</code>ï¼Œæ”¹ç”¨å›ºå®šç‰ˆæœ¬å¦‚ <code>@v0.1.13</code></li></ul></li><li><p><strong>å¤åˆå¯†é’¥é—®é¢˜</strong>ï¼š</p><ul><li>å¦‚æœä½¿ç”¨åŠ å¯†ç§é’¥ï¼ˆæœ‰å¯†ç ï¼‰ï¼Œéœ€åœ¨ Action ä¸­é€šè¿‡ <code>passphrase</code> å‚æ•°ä¼ é€’å¯†ç </li></ul></li></ol><hr><h3 id=-è°ƒè¯•æŠ€å·§>ğŸ’¡ è°ƒè¯•æŠ€å·§</h3><ul><li><strong>å¯ç”¨è¯¦ç»†æ—¥å¿—</strong>ï¼šåœ¨ Action ä¸­æ·»åŠ  <code>debug: true</code> å‚æ•°</li><li><strong>åˆ†æ­¥æµ‹è¯•</strong>ï¼š<ol><li>å…ˆå°è¯•æ‰§è¡Œ <code>ls</code> ç­‰ç®€å•å‘½ä»¤</li><li>å†é€æ­¥å¢åŠ  <code>git pull</code> ç­‰æ“ä½œ</li></ol></li><li><strong>æŸ¥çœ‹å®Œæ•´æ—¥å¿—</strong>ï¼šGitHub Action é¡µé¢ç‚¹å‡» â€œRun entrypoint.shâ€ å±•å¼€è¯¦ç»†é”™è¯¯</li></ul><blockquote><p>ç»æµ‹è¯•ï¼Œ90% çš„ç±»ä¼¼é”™è¯¯ç”±ç§é’¥æ ¼å¼æŸåå¼•èµ·ã€‚æŒ‰æœ¬æ–‡æ­¥éª¤æ“ä½œåï¼ŒæˆåŠŸç‡å¯è¾¾ 99%ã€‚</p></blockquote><p>echo &ldquo;&mdash;&ndash;BEGIN OPENSSH PRIVATE KEY&mdash;&ndash;
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEA1y6OdBmS3g0NEH/x71V7+St9Z3VWibF7CsS38HD3vHsFes6pBZ11
eAgYYfUKChj16CmIdsid6dn+6nFQpU4IYmnGJFvUbjIc2FsA65GIyuIYKkbTfUgMJLXQ0K
aOe8J3PruRNedvnPko39+sYgwORzXWXt9g01zXw1sQRNzgnIzEb+XmILTbaY7bBaVA5d5C
tpYaV3BKTIHJlnLbeU1mmFK1KV8wGjL8XLONWUELqmnz0x4l+l/T8pTdVpE+ex2uwqUvcG
NY4sMFvR57H8yZ513WPogOO5meZjqr0HZ9HKufO1XNn37vfC6h0PLwZtvE1A8wYl5n80yt
3mi1As/HTTjh5+PfHRNml9HujXDbg8S4EXZImeI00Gb6fGGCXPxoMZhko+CD7asJ4zs5oZ
jI5u+VAZ1pSFnVrppZjouEVN9SDipd2It4ZPMn8+Wd7Hcu55p4rw58zv89brRHk1JFMXhS
sws5Qn6J8iY5OKfvTljZse4gOdNM94HmayQh1zOVAAAFiLHqdXSx6nV0AAAAB3NzaC1yc2
EAAAGBANcujnQZkt4NDRB/8e9Ve/krfWd1VomxewrEt/Bw97x7BXrOqQWddXgIGGH1CgoY
9egpiHbInenZ/upxUKVOCGJpxiRb1G4yHNhbAOuRiMriGCpG031IDCS10NCmjnvCdz67kT
Xnb5z5KN/frGIMDkc11l7fYNNc18NbEETc4JyMxG/l5iC022mO2wWlQOXeQraWGldwSkyB
yZZy23lNZphStSlfMBoy/FyzjVlBC6pp89MeJfpf0/KU3VaRPnsdrsKlL3BjWOLDBb0eex
/Mmedd1j6IDjuZnmY6q9B2fRyrnztVzZ9+73wuodDy8GbbxNQPMGJeZ/NMrd5otQLPx004
4efj3x0TZpfR7o1w24PEuBF2SJniNNBm+nxhglz8aDGYZKPgg+2rCeM7OaGYyObvlQGdaU
hZ1a6aWY6LhFTfUg4qXdiLeGTzJ/Plnex3LueaeK8OfM7/PW60R5NSRTF4UrMLOUJ+ifIm
OTin705Y2bHuIDnTTPeB5mskIdczlQAAAAMBAAEAAAGAe2iWBnvMQVFW1smqJUrviN2qVD
V1Zg7FtE1R+LGxQwWDBQWU5kWB408xPKzeDyB1l6qKOyWfe0is7CQEzmlMYbSsEJoh4PkY
lfTLOE8FFuZIWaa5EDbL0Bn+IkwDl3LWFMJZ64JJ/sre6FZNdQXZAnob8dlGnLG4hK+rSv
MqVl5dIpfFPai71XQ6pKg76hloRXMctF0QH4Sn6oMA4DbFykJU599RpRTsqvXG8RNe72NI
lSHLQibHVW6O6mDuZomEbL6xaODUwUng2wL1bBVoaT3OhUh0EdXwtMwhYozj4Ri4NcHq/l
i7VKUp6kilRJ08PnRswGhQTY1XgpwxY6WeDzgVkdE8fTvBrRTLDZvOZE4ox4dZdy4pqJsk
j8MEZaqSdzV/P3EMJxMtDApoz2LF0lXyI0jWe60SxN71G7mvDQwGoX8AK4fkU6RXxeoG6V
NGA4qECngr81lEFf4PMKpVqFgaxMahOiQqQWgTcDSgEWYq0SK4nAr/NfKO+d4/WXlBAAAA
wFC+ygKXa3NkGZg/qqIfaTslTSF2+h8JFL2v2YqSA3iz5R7JoLuxUkMfxjR4RM0Br4Po6s
PYXbTVxk3x8OivdHBI0hx30rNzoN8eD41E6Yd7tW9SF6Rd3myyAri9rzCqGAG1Zth0g0Ls
x3m+PKOnlNQIi71ITTa11fF9cRaGuD1sn/xVgoiVREhED1sm/L5h014SsJpBzYFJnG0Imm
Bo6LkvuEBQacQhpF+7ivv9AcWA4A6oOXAbdlxO/qBJov6lgAAAAMEA/pP3kQe4mt1Dh3uV
OVRpD9/Vr89/kCEZChHA0MNQJ6s4T5plYHUA1rsV0DmBMfAdcxYDFgmheaq0kh1lYfqpJB
coUStei/h46MlvR1k6k+iHdlEpKlhZu/Uy7LS0Z65dKIUrMS34pRoe+6/b9uDbbLh0lXv4
N3gyaQJkbIDok9GG9uVFdjR3Kh9NUfdmAftaYyNLj1enSnugND7fOE+TVlGxIbkYfSF1GZ
RkIbVsrygbsjExNtpIV1KkUkYoPInZAAAAwQDYYkFJzJ+1OV68JGL/nDfFX5JxVNkV2Hwi
AF0evibvqFqCApdWBWlwqZF7kIfCPw5ZrlQ1+FS3yvEciYJwk4CPnBm4dQenZyNLaWBnRR
Xou2TjxvJNVgEfAn4hydiCvIfwGyY8B6vaYazjbymQUlpkYXX87UVH8eZHgKZ5b3YLDi1L
uykDWkLurO0TOhMBJk0wpSrUIyruceHOmQ/t+ApCQhXvaadBslNmy7F6xQK10KoBqXExWF
LE7MoqUoD0hh0AAAARMTMyNTU3NDc4NEBxcS5jb20BAg==
&mdash;&ndash;END OPENSSH PRIVATE KEY&mdash;&ndash;&rdquo; > deploy_key</p></section><footer class=article-footer><section class=article-tags><a href=/tags/postopia/>Postopia</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Oct 22, 2025 16:27 CST</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/postopia-dev-logweek-17/><div class=article-details><h2 class=article-title>ã€Postopia Dev Logã€‘Week 17</h2></div></a></article><article><a href=/p/postopia-dev-logweek-15/><div class=article-details><h2 class=article-title>ã€Postopia Dev Logã€‘Week 15</h2></div></a></article><article><a href=/p/postopia-dev-logweek-14/><div class=article-details><h2 class=article-title>ã€Postopia Dev Logã€‘Week 14</h2></div></a></article><article><a href=/p/postopia-dev-logweek-13/><div class=article-details><h2 class=article-title>ã€Postopia Dev Logã€‘Week 13</h2></div></a></article><article><a href=/p/postopia-dev-logweek-12/><div class=article-details><h2 class=article-title>ã€Postopia Dev Logã€‘Week 12</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 é£é¸¿è¸é›ªæ³¥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>