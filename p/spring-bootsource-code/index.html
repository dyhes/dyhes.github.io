<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="BootstrapRegistryInitializer BootstrapRegistryInitializeræ˜¯ Spring Boot åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¸€ä¸ªæ—©æœŸä¸”å…³é”®çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸ä½ åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰æ­£å¼åˆ›å»ºä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘å¹¶æ³¨å†Œä¸€äº›éœ€è¦åœ¨å¯åŠ¨æ—©æœŸé˜¶æ®µä½¿ç”¨çš„å¯¹è±¡ã€‚\nä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹èµ·æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº† BootstrapRegistryInitializerçš„æ ¸å¿ƒç‰¹æ€§ï¼š\nç‰¹æ€§ç»´åº¦ æ ¸å¿ƒè¯´æ˜ ä¸»è¦ä½œç”¨ åœ¨ ApplicationContextåˆ›å»ºä¹‹å‰ï¼Œè¿›è¡Œæ—©æœŸå¯¹è±¡æ³¨å†Œå’Œåˆå§‹åŒ–ã€‚ æ‰§è¡Œæ—¶æœº SpringApplication.run()æ–¹æ³•çš„æ—©æœŸé˜¶æ®µï¼Œåœ¨åˆ›å»º ApplicationContextä¹‹å‰ã€‚ æ ¸å¿ƒæ“ä½œ é€šè¿‡ BootstrapRegistryæ³¨å†Œå¯¹è±¡ã€æ·»åŠ å…³é—­äº‹ä»¶ç›‘å¬å™¨ã€‚ é…ç½®æ–¹å¼ åœ¨ META-INF/spring.factoriesæ–‡ä»¶ä¸­å£°æ˜ï¼Œæˆ–é€šè¿‡ SpringApplication.addBootstrapRegistryInitializer()æ–¹æ³•æ·»åŠ ã€‚ ç”Ÿå‘½å‘¨æœŸ æ³¨å†Œçš„å¯¹è±¡åœ¨ ApplicationContextå‡†å¤‡å°±ç»ªåï¼Œé»˜è®¤ä¸å†å¯ç”¨ã€‚ ğŸ’¡ è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯ Spring Boot è®¾è®¡ BootstrapRegistryInitializerä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€äº›éœ€è¦åœ¨ IoC å®¹å™¨å®Œå…¨å¯åŠ¨ä¹‹å‰ å°±å®Œæˆçš„åˆå§‹åŒ–éœ€æ±‚ï¼Œå®ç°ç¯å¢ƒéš”ç¦»ï¼Œå¹¶ä¼˜åŒ–å¯åŠ¨æ€§èƒ½ã€‚\nå®ƒçš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š\nå¤–éƒ¨é…ç½®é¢„åŠ è½½ï¼šåœ¨åŠ è½½æœ¬åœ° application.propertiesä¹‹å‰ï¼Œä¼˜å…ˆä»è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Spring Cloud Configã€Nacosï¼‰æ‹‰å–é…ç½®ä¿¡æ¯ã€‚ åŸºç¡€è®¾æ–½åˆå§‹åŒ–ï¼šæå‰åˆå§‹åŒ–ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€ç›‘æ§ä»£ç†ï¼ˆPrometheus Clientï¼‰ã€åˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼ˆZipkinï¼‰ç­‰ã€‚ æ˜‚è´µèµ„æºé¢„æ³¨å†Œï¼šæ³¨å†Œé‚£äº›åˆ›å»ºæˆæœ¬è¾ƒé«˜çš„å¯¹è±¡åŸå‹ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜å®¢æˆ·ç«¯ç­‰ï¼Œä»¥ä¾¿åœ¨åç»­çš„è‡ªåŠ¨é…ç½®ä¸­å¤ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚ ğŸ” æ ¸å¿ƒåŸç†ï¼šå¯åŠ¨æµç¨‹ä¸­çš„è§’è‰² BootstrapRegistryInitializerçš„è°ƒç”¨æ˜¯ Spring Boot å¯åŠ¨æµç¨‹ä¸­çš„ä¸€ä¸ªç²¾ç¡®æ­¥éª¤ï¼š\nåŠ è½½å®ç°ç±»ï¼šåœ¨ SpringApplicationçš„æ„é€ é˜¶æ®µï¼Œé€šè¿‡ SpringFactoriesLoaderä» META-INF/spring.factoriesæ–‡ä»¶ä¸­åŠ è½½æ‰€æœ‰å£°æ˜çš„ BootstrapRegistryInitializerå®ç°ç±»ã€‚ æ‰§è¡Œ createBootstrapContext æ–¹æ³•ï¼šåœ¨ run()æ–¹æ³•ä¸­ï¼Œç´§éšå…¶åçš„æ˜¯åˆ›å»º BootstrapContextï¼ˆBootstrapRegistryçš„é»˜è®¤å®ç°ï¼‰å¹¶éå†è°ƒç”¨æ‰€æœ‰ BootstrapRegistryInitializerå®ç°ç±»çš„ initializeæ–¹æ³•ã€‚ âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šç¼–ç ä¸é…ç½®å®è·µ 1. å®ç°æ¥å£ ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥å®ç° BootstrapRegistryInitializeræ¥å£ï¼Œå¹¶é‡å†™å…¶ initializeæ–¹æ³•ã€‚\n"><title>ã€Spring Bootã€‘Source Code</title><link rel=canonical href=https://dyhes.github.io/p/spring-bootsource-code/><link rel=stylesheet href=/scss/style.min.f7091bff8043bd3e53b22be6c05dd86b506e8dec4d0d75d249d2dfb0fe074a46.css><meta property='og:title' content="ã€Spring Bootã€‘Source Code"><meta property='og:description' content="BootstrapRegistryInitializer BootstrapRegistryInitializeræ˜¯ Spring Boot åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¸€ä¸ªæ—©æœŸä¸”å…³é”®çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸ä½ åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰æ­£å¼åˆ›å»ºä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘å¹¶æ³¨å†Œä¸€äº›éœ€è¦åœ¨å¯åŠ¨æ—©æœŸé˜¶æ®µä½¿ç”¨çš„å¯¹è±¡ã€‚\nä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹èµ·æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº† BootstrapRegistryInitializerçš„æ ¸å¿ƒç‰¹æ€§ï¼š\nç‰¹æ€§ç»´åº¦ æ ¸å¿ƒè¯´æ˜ ä¸»è¦ä½œç”¨ åœ¨ ApplicationContextåˆ›å»ºä¹‹å‰ï¼Œè¿›è¡Œæ—©æœŸå¯¹è±¡æ³¨å†Œå’Œåˆå§‹åŒ–ã€‚ æ‰§è¡Œæ—¶æœº SpringApplication.run()æ–¹æ³•çš„æ—©æœŸé˜¶æ®µï¼Œåœ¨åˆ›å»º ApplicationContextä¹‹å‰ã€‚ æ ¸å¿ƒæ“ä½œ é€šè¿‡ BootstrapRegistryæ³¨å†Œå¯¹è±¡ã€æ·»åŠ å…³é—­äº‹ä»¶ç›‘å¬å™¨ã€‚ é…ç½®æ–¹å¼ åœ¨ META-INF/spring.factoriesæ–‡ä»¶ä¸­å£°æ˜ï¼Œæˆ–é€šè¿‡ SpringApplication.addBootstrapRegistryInitializer()æ–¹æ³•æ·»åŠ ã€‚ ç”Ÿå‘½å‘¨æœŸ æ³¨å†Œçš„å¯¹è±¡åœ¨ ApplicationContextå‡†å¤‡å°±ç»ªåï¼Œé»˜è®¤ä¸å†å¯ç”¨ã€‚ ğŸ’¡ è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯ Spring Boot è®¾è®¡ BootstrapRegistryInitializerä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€äº›éœ€è¦åœ¨ IoC å®¹å™¨å®Œå…¨å¯åŠ¨ä¹‹å‰ å°±å®Œæˆçš„åˆå§‹åŒ–éœ€æ±‚ï¼Œå®ç°ç¯å¢ƒéš”ç¦»ï¼Œå¹¶ä¼˜åŒ–å¯åŠ¨æ€§èƒ½ã€‚\nå®ƒçš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š\nå¤–éƒ¨é…ç½®é¢„åŠ è½½ï¼šåœ¨åŠ è½½æœ¬åœ° application.propertiesä¹‹å‰ï¼Œä¼˜å…ˆä»è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Spring Cloud Configã€Nacosï¼‰æ‹‰å–é…ç½®ä¿¡æ¯ã€‚ åŸºç¡€è®¾æ–½åˆå§‹åŒ–ï¼šæå‰åˆå§‹åŒ–ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€ç›‘æ§ä»£ç†ï¼ˆPrometheus Clientï¼‰ã€åˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼ˆZipkinï¼‰ç­‰ã€‚ æ˜‚è´µèµ„æºé¢„æ³¨å†Œï¼šæ³¨å†Œé‚£äº›åˆ›å»ºæˆæœ¬è¾ƒé«˜çš„å¯¹è±¡åŸå‹ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜å®¢æˆ·ç«¯ç­‰ï¼Œä»¥ä¾¿åœ¨åç»­çš„è‡ªåŠ¨é…ç½®ä¸­å¤ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚ ğŸ” æ ¸å¿ƒåŸç†ï¼šå¯åŠ¨æµç¨‹ä¸­çš„è§’è‰² BootstrapRegistryInitializerçš„è°ƒç”¨æ˜¯ Spring Boot å¯åŠ¨æµç¨‹ä¸­çš„ä¸€ä¸ªç²¾ç¡®æ­¥éª¤ï¼š\nåŠ è½½å®ç°ç±»ï¼šåœ¨ SpringApplicationçš„æ„é€ é˜¶æ®µï¼Œé€šè¿‡ SpringFactoriesLoaderä» META-INF/spring.factoriesæ–‡ä»¶ä¸­åŠ è½½æ‰€æœ‰å£°æ˜çš„ BootstrapRegistryInitializerå®ç°ç±»ã€‚ æ‰§è¡Œ createBootstrapContext æ–¹æ³•ï¼šåœ¨ run()æ–¹æ³•ä¸­ï¼Œç´§éšå…¶åçš„æ˜¯åˆ›å»º BootstrapContextï¼ˆBootstrapRegistryçš„é»˜è®¤å®ç°ï¼‰å¹¶éå†è°ƒç”¨æ‰€æœ‰ BootstrapRegistryInitializerå®ç°ç±»çš„ initializeæ–¹æ³•ã€‚ âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šç¼–ç ä¸é…ç½®å®è·µ 1. å®ç°æ¥å£ ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥å®ç° BootstrapRegistryInitializeræ¥å£ï¼Œå¹¶é‡å†™å…¶ initializeæ–¹æ³•ã€‚\n"><meta property='og:url' content='https://dyhes.github.io/p/spring-bootsource-code/'><meta property='og:site_name' content='é£é¸¿è¸é›ªæ³¥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Spring Boot'><meta property='article:published_time' content='2025-09-25T00:00:00+00:00'><meta property='article:modified_time' content='2025-09-30T19:46:00+08:00'><meta name=twitter:title content="ã€Spring Bootã€‘Source Code"><meta name=twitter:description content="BootstrapRegistryInitializer BootstrapRegistryInitializeræ˜¯ Spring Boot åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¸€ä¸ªæ—©æœŸä¸”å…³é”®çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸ä½ åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰æ­£å¼åˆ›å»ºä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘å¹¶æ³¨å†Œä¸€äº›éœ€è¦åœ¨å¯åŠ¨æ—©æœŸé˜¶æ®µä½¿ç”¨çš„å¯¹è±¡ã€‚\nä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹èµ·æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº† BootstrapRegistryInitializerçš„æ ¸å¿ƒç‰¹æ€§ï¼š\nç‰¹æ€§ç»´åº¦ æ ¸å¿ƒè¯´æ˜ ä¸»è¦ä½œç”¨ åœ¨ ApplicationContextåˆ›å»ºä¹‹å‰ï¼Œè¿›è¡Œæ—©æœŸå¯¹è±¡æ³¨å†Œå’Œåˆå§‹åŒ–ã€‚ æ‰§è¡Œæ—¶æœº SpringApplication.run()æ–¹æ³•çš„æ—©æœŸé˜¶æ®µï¼Œåœ¨åˆ›å»º ApplicationContextä¹‹å‰ã€‚ æ ¸å¿ƒæ“ä½œ é€šè¿‡ BootstrapRegistryæ³¨å†Œå¯¹è±¡ã€æ·»åŠ å…³é—­äº‹ä»¶ç›‘å¬å™¨ã€‚ é…ç½®æ–¹å¼ åœ¨ META-INF/spring.factoriesæ–‡ä»¶ä¸­å£°æ˜ï¼Œæˆ–é€šè¿‡ SpringApplication.addBootstrapRegistryInitializer()æ–¹æ³•æ·»åŠ ã€‚ ç”Ÿå‘½å‘¨æœŸ æ³¨å†Œçš„å¯¹è±¡åœ¨ ApplicationContextå‡†å¤‡å°±ç»ªåï¼Œé»˜è®¤ä¸å†å¯ç”¨ã€‚ ğŸ’¡ è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯ Spring Boot è®¾è®¡ BootstrapRegistryInitializerä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€äº›éœ€è¦åœ¨ IoC å®¹å™¨å®Œå…¨å¯åŠ¨ä¹‹å‰ å°±å®Œæˆçš„åˆå§‹åŒ–éœ€æ±‚ï¼Œå®ç°ç¯å¢ƒéš”ç¦»ï¼Œå¹¶ä¼˜åŒ–å¯åŠ¨æ€§èƒ½ã€‚\nå®ƒçš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š\nå¤–éƒ¨é…ç½®é¢„åŠ è½½ï¼šåœ¨åŠ è½½æœ¬åœ° application.propertiesä¹‹å‰ï¼Œä¼˜å…ˆä»è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Spring Cloud Configã€Nacosï¼‰æ‹‰å–é…ç½®ä¿¡æ¯ã€‚ åŸºç¡€è®¾æ–½åˆå§‹åŒ–ï¼šæå‰åˆå§‹åŒ–ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€ç›‘æ§ä»£ç†ï¼ˆPrometheus Clientï¼‰ã€åˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼ˆZipkinï¼‰ç­‰ã€‚ æ˜‚è´µèµ„æºé¢„æ³¨å†Œï¼šæ³¨å†Œé‚£äº›åˆ›å»ºæˆæœ¬è¾ƒé«˜çš„å¯¹è±¡åŸå‹ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜å®¢æˆ·ç«¯ç­‰ï¼Œä»¥ä¾¿åœ¨åç»­çš„è‡ªåŠ¨é…ç½®ä¸­å¤ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚ ğŸ” æ ¸å¿ƒåŸç†ï¼šå¯åŠ¨æµç¨‹ä¸­çš„è§’è‰² BootstrapRegistryInitializerçš„è°ƒç”¨æ˜¯ Spring Boot å¯åŠ¨æµç¨‹ä¸­çš„ä¸€ä¸ªç²¾ç¡®æ­¥éª¤ï¼š\nåŠ è½½å®ç°ç±»ï¼šåœ¨ SpringApplicationçš„æ„é€ é˜¶æ®µï¼Œé€šè¿‡ SpringFactoriesLoaderä» META-INF/spring.factoriesæ–‡ä»¶ä¸­åŠ è½½æ‰€æœ‰å£°æ˜çš„ BootstrapRegistryInitializerå®ç°ç±»ã€‚ æ‰§è¡Œ createBootstrapContext æ–¹æ³•ï¼šåœ¨ run()æ–¹æ³•ä¸­ï¼Œç´§éšå…¶åçš„æ˜¯åˆ›å»º BootstrapContextï¼ˆBootstrapRegistryçš„é»˜è®¤å®ç°ï¼‰å¹¶éå†è°ƒç”¨æ‰€æœ‰ BootstrapRegistryInitializerå®ç°ç±»çš„ initializeæ–¹æ³•ã€‚ âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šç¼–ç ä¸é…ç½®å®è·µ 1. å®ç°æ¥å£ ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥å®ç° BootstrapRegistryInitializeræ¥å£ï¼Œå¹¶é‡å†™å…¶ initializeæ–¹æ³•ã€‚\n"><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b567f26f71c49c33.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>é£é¸¿è¸é›ªæ³¥</a></h1><h2 class=site-description>æ²¡æœ‰è®°å½•ï¼Œå°±æ²¡æœ‰å‘ç”Ÿ</h2></div></header><ol class=menu-social><li><a href=https://leetcode.cn/u/dyhes/ target=_blank title=LeetCode rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 13h7.5"/><path d="M9.424 7.268l4.999-4.999"/><path d="M16.633 16.644l-2.402 2.415a3.189 3.189.0 01-4.524.0l-3.77-3.787a3.223 3.223.0 010-4.544l3.77-3.787a3.189 3.189.0 014.524.0l2.302 2.313"/></svg></a></li><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=mailto:1325574784@qq.com target=_blank title=Mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 19H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v5.5"/><path d="M3 7l9 6 9-6"/><path d="M19 16l-2 3h4l-2 3"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/tags/><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#bootstrapregistryinitializer>BootstrapRegistryInitializer</a><ol><li><a href=#-è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯>ğŸ’¡ è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯</a></li><li><a href=#-æ ¸å¿ƒåŸç†å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²>ğŸ” æ ¸å¿ƒåŸç†ï¼šå¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²</a></li><li><a href=#-å¦‚ä½•ä½¿ç”¨ç¼–ç ä¸é…ç½®å®è·µ>âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šç¼–ç ä¸é…ç½®å®è·µ</a><ol><li><a href=#1-å®ç°æ¥å£>1. å®ç°æ¥å£</a></li><li><a href=#2-æ³¨å†Œå®ç°ç±»>2. æ³¨å†Œå®ç°ç±»</a></li></ol></li><li><a href=#-å…³é”®æ³¨æ„äº‹é¡¹>âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹</a></li><li><a href=#-æ€»ç»“>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#meta-infspringfactories>META-INF/spring.factories</a><ol><li><a href=#-è¿è¡Œæ—¶åˆå¹¶çš„ç»†èŠ‚>ğŸ”§ è¿è¡Œæ—¶åˆå¹¶çš„ç»†èŠ‚</a></li><li><a href=#-ç¼–è¯‘æ—¶éœ€æ³¨æ„çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ>âš ï¸ ç¼–è¯‘æ—¶éœ€æ³¨æ„çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</a></li><li><a href=#-æœ€ä½³å®è·µå»ºè®®>ğŸ’¡ æœ€ä½³å®è·µå»ºè®®</a></li><li><a href=#-æ€»ç»“-1>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#applicationcontextinitializer>ApplicationContextInitializer</a><ol><li><a href=#-æ ¸å¿ƒä½œç”¨ä¸é€‚ç”¨åœºæ™¯>ğŸ’¡ æ ¸å¿ƒä½œç”¨ä¸é€‚ç”¨åœºæ™¯</a></li><li><a href=#-å¦‚ä½•ä½¿ç”¨å®ç°ä¸æ³¨å†Œ>âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šå®ç°ä¸æ³¨å†Œ</a><ol><li><a href=#1-å®ç°æ¥å£-1>1. å®ç°æ¥å£</a></li><li><a href=#2-æ³¨å†Œå®ç°ç±»-1>2. æ³¨å†Œå®ç°ç±»</a></li><li><a href=#3-æ§åˆ¶æ‰§è¡Œé¡ºåº>3. æ§åˆ¶æ‰§è¡Œé¡ºåº</a></li></ol></li><li><a href=#-æ‰§è¡Œæ—¶æœºä¸æºç ç®€æ>ğŸ” æ‰§è¡Œæ—¶æœºä¸æºç ç®€æ</a></li><li><a href=#-ä½¿ç”¨æ³¨æ„äº‹é¡¹>âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹</a></li><li><a href=#-æ€»ç»“-2>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#configurableapplicationcontext>ConfigurableApplicationContext</a><ol><li><a href=#-æ·±å…¥ç†è§£è§’è‰²ä¸è®¾è®¡>ğŸ’¡ æ·±å…¥ç†è§£è§’è‰²ä¸è®¾è®¡</a></li><li><a href=#-å¦‚ä½•ä½¿ç”¨-configurableapplicationcontext>ğŸ”§ å¦‚ä½•ä½¿ç”¨ ConfigurableApplicationContext</a></li><li><a href=#-æ€»ç»“-3>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#application-listener>Application Listener</a><ol><li><a href=#-æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼</a></li><li><a href=#-å¦‚ä½•å®ç°ä¸€ä¸ªç›‘å¬å™¨>ğŸ› ï¸ å¦‚ä½•å®ç°ä¸€ä¸ªç›‘å¬å™¨</a><ol><li><a href=#æ–¹å¼ä¸€å®ç°-applicationlisteneræ¥å£ç»å…¸æ–¹å¼>æ–¹å¼ä¸€ï¼šå®ç° <code>ApplicationListener</code>æ¥å£ï¼ˆç»å…¸æ–¹å¼ï¼‰</a></li><li><a href=#æ–¹å¼äºŒä½¿ç”¨-eventlisteneræ³¨è§£æ¨èæ–¹å¼>æ–¹å¼äºŒï¼šä½¿ç”¨ <code>@EventListener</code>æ³¨è§£ï¼ˆæ¨èæ–¹å¼ï¼‰</a></li></ol></li><li><a href=#-äº‹ä»¶ç±»å‹å†…ç½®ä¸è‡ªå®šä¹‰>ğŸ“š äº‹ä»¶ç±»å‹ï¼šå†…ç½®ä¸è‡ªå®šä¹‰</a><ol><li><a href=#spring-å†…ç½®äº‹ä»¶>Spring å†…ç½®äº‹ä»¶</a></li><li><a href=#åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶>åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶</a></li></ol></li><li><a href=#-å¦‚ä½•å‘å¸ƒäº‹ä»¶>ğŸš€ å¦‚ä½•å‘å¸ƒäº‹ä»¶</a></li><li><a href=#-é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ>âš™ï¸ é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ</a></li><li><a href=#-å¸¸è§é—®é¢˜æ’æŸ¥>âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥</a></li><li><a href=#-æ€»ç»“-4>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#configurableenvironment>ConfigurableEnvironment</a><ol><li><a href=#-æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼>ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼</a></li><li><a href=#-æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•>âš™ï¸ æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•</a><ol><li><a href=#1-ç®¡ç†é…ç½®æ–‡ä»¶profiles>1. ç®¡ç†é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</a></li><li><a href=#2-ç®¡ç†å±æ€§æºpropertysources>2. ç®¡ç†å±æ€§æºï¼ˆPropertySourcesï¼‰</a></li><li><a href=#3-å±æ€§è§£æä¸è·å–>3. å±æ€§è§£æä¸è·å–</a></li></ol></li><li><a href=#-ä¸»è¦å®ç°ç±»>ğŸ” ä¸»è¦å®ç°ç±»</a></li><li><a href=#-å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ>ğŸ’» å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ</a><ol><li><a href=#1-å¤šç¯å¢ƒé…ç½®>1. å¤šç¯å¢ƒé…ç½®</a></li><li><a href=#2-åŠ¨æ€é…ç½®æ›´æ–°>2. åŠ¨æ€é…ç½®æ›´æ–°</a></li><li><a href=#3-è‡ªå®šä¹‰å±æ€§æº>3. è‡ªå®šä¹‰å±æ€§æº</a></li></ol></li><li><a href=#-å¸¸è§é—®é¢˜ä¸æŠ€å·§>âš ï¸ å¸¸è§é—®é¢˜ä¸æŠ€å·§</a></li><li><a href=#-æ€»ç»“-5>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#startup>StartUp</a><ol><li><a href=#-æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼-1>ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼</a></li><li><a href=#-æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•-1>âš™ï¸ æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•</a><ol><li><a href=#1-ç®¡ç†é…ç½®æ–‡ä»¶profiles-1>1. ç®¡ç†é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</a></li><li><a href=#2-ç®¡ç†å±æ€§æºpropertysources-1>2. ç®¡ç†å±æ€§æºï¼ˆPropertySourcesï¼‰</a></li><li><a href=#3-å±æ€§è§£æä¸è·å–-1>3. å±æ€§è§£æä¸è·å–</a></li></ol></li><li><a href=#-ä¸»è¦å®ç°ç±»-1>ğŸ” ä¸»è¦å®ç°ç±»</a></li><li><a href=#-å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ-1>ğŸ’» å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ</a><ol><li><a href=#1-å¤šç¯å¢ƒé…ç½®-1>1. å¤šç¯å¢ƒé…ç½®</a></li><li><a href=#2-åŠ¨æ€é…ç½®æ›´æ–°-1>2. åŠ¨æ€é…ç½®æ›´æ–°</a></li><li><a href=#3-è‡ªå®šä¹‰å±æ€§æº-1>3. è‡ªå®šä¹‰å±æ€§æº</a></li></ol></li><li><a href=#-å¸¸è§é—®é¢˜ä¸æŠ€å·§-1>âš ï¸ å¸¸è§é—®é¢˜ä¸æŠ€å·§</a></li><li><a href=#-æ€»ç»“-6>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#applicationcontextfactory>ApplicationContextFactory</a><ol><li><a href=#-æ ¸å¿ƒåŠŸèƒ½ä¸æ¥å£è®¾è®¡>ğŸ”§ æ ¸å¿ƒåŠŸèƒ½ä¸æ¥å£è®¾è®¡</a></li><li><a href=#-é»˜è®¤å®ç°ä¸åˆ›å»ºæµç¨‹>ğŸ“œ é»˜è®¤å®ç°ä¸åˆ›å»ºæµç¨‹</a></li><li><a href=#-å†…ç½®çš„-applicationcontext-ç±»å‹>ğŸŒ å†…ç½®çš„ ApplicationContext ç±»å‹</a></li><li><a href=#-å¦‚ä½•è‡ªå®šä¹‰ä¸æ‰©å±•>ğŸ› ï¸ å¦‚ä½•è‡ªå®šä¹‰ä¸æ‰©å±•</a></li><li><a href=#-åœ¨å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²>âš™ï¸ åœ¨å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²</a></li><li><a href=#-æ€»ç»“-7>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#servlet--reactive>SERVLET & REACTIVE</a><ol><li><a href=#-æ ¸å¿ƒåŒºåˆ«è¯¦è§£>ğŸ’¡ æ ¸å¿ƒåŒºåˆ«è¯¦è§£</a><ol><li><a href=#1-å·¥ä½œåŸç†ä¸çº¿ç¨‹æ¨¡å‹>1. å·¥ä½œåŸç†ä¸çº¿ç¨‹æ¨¡å‹</a></li><li><a href=#2-æŠ€æœ¯æ ˆä¸ä¾èµ–>2. æŠ€æœ¯æ ˆä¸ä¾èµ–</a></li><li><a href=#3-èƒŒå‹backpressureæœºåˆ¶>3. èƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶</a></li></ol></li><li><a href=#-å¦‚ä½•é€‰æ‹©>ğŸ¯ å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li><li><a href=#-éœ€è¦æ³¨æ„çš„è¯¯åŒº>âš ï¸ éœ€è¦æ³¨æ„çš„è¯¯åŒº</a></li><li><a href=#-æ€»ç»“-8>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#preparecontext>prepareContext</a><ol><li><a href=#-å…³é”®æ­¥éª¤è¯¦è§£>ğŸ’¡ å…³é”®æ­¥éª¤è¯¦è§£</a><ol><li><a href=#1-ç¯å¢ƒè®¾ç½®ä¸ç¯å¢ƒç»Ÿä¸€>1. ç¯å¢ƒè®¾ç½®ä¸ç¯å¢ƒç»Ÿä¸€</a></li><li><a href=#2-æ‰§è¡Œåˆå§‹åŒ–å™¨initializers>2. æ‰§è¡Œåˆå§‹åŒ–å™¨ï¼ˆInitializersï¼‰</a></li><li><a href=#3-å¼•å¯¼ä¸Šä¸‹æ–‡çš„å…³é—­ä¸èµ„æºè½¬ç§»>3. å¼•å¯¼ä¸Šä¸‹æ–‡çš„å…³é—­ä¸èµ„æºè½¬ç§»</a></li><li><a href=#4-åŠ è½½æºæ•°æ®sourceä¸beanå®šä¹‰æ³¨å†Œ>4. åŠ è½½æºæ•°æ®ï¼ˆSourceï¼‰ä¸Beanå®šä¹‰æ³¨å†Œ</a></li><li><a href=#5-äº‹ä»¶é©±åŠ¨çš„å¯åŠ¨æµç¨‹>5. äº‹ä»¶é©±åŠ¨çš„å¯åŠ¨æµç¨‹</a></li></ol></li><li><a href=#-ç‰ˆæœ¬å·®å¼‚è¯´æ˜>âš ï¸ ç‰ˆæœ¬å·®å¼‚è¯´æ˜</a></li><li><a href=#-æ€»ç»“-9>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#beanfactory>BeanFactory</a><ol><li><a href=#-æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼-2>ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼</a></li><li><a href=#-æ ¸å¿ƒæ¥å£ä¸æ–¹æ³•>ğŸ“š æ ¸å¿ƒæ¥å£ä¸æ–¹æ³•</a></li><li><a href=#-æ ¸å¿ƒå®ç°defaultlistablebeanfactory>âš™ï¸ æ ¸å¿ƒå®ç°ï¼šDefaultListableBeanFactory</a></li><li><a href=#-bean-çš„åŠ è½½æµç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ>ğŸ”„ Bean çš„åŠ è½½æµç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#-beanfactory-ä¸-applicationcontext-çš„å…³ç³»>ğŸ”„ BeanFactory ä¸ ApplicationContext çš„å…³ç³»</a></li><li><a href=#-æ³¨æ„beanfactory-ä¸-factorybean-çš„åŒºåˆ«>âš ï¸ æ³¨æ„ï¼šBeanFactory ä¸ FactoryBean çš„åŒºåˆ«</a></li><li><a href=#-æ€»ç»“-10>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#å­ç±»>å­ç±»</a><ol><li><a href=#-å„æ¥å£çš„è¯¦ç»†ä½œç”¨>ğŸ’¡ å„æ¥å£çš„è¯¦ç»†ä½œç”¨</a><ol><li><a href=#1-configurablebeanfactoryåŸºç¡€é…ç½®çš„åŸºçŸ³>1. ConfigurableBeanFactoryï¼šåŸºç¡€é…ç½®çš„åŸºçŸ³</a></li><li><a href=#2-listablebeanfactoryå¼ºå¤§çš„æŸ¥è¯¢ä¸åˆ—ä¸¾å·¥å…·>2. ListableBeanFactoryï¼šå¼ºå¤§çš„æŸ¥è¯¢ä¸åˆ—ä¸¾å·¥å…·</a></li><li><a href=#3-autowirecapablebeanfactoryå®¹å™¨å¤–çš„è£…é…å·¥>3. AutowireCapableBeanFactoryï¼šå®¹å™¨å¤–çš„è£…é…å·¥</a></li><li><a href=#4-configurablelistablebeanfactoryåŠŸèƒ½å…¨é›†æˆçš„ç»ˆæå½¢æ€>4. ConfigurableListableBeanFactoryï¼šåŠŸèƒ½å…¨é›†æˆçš„ç»ˆæå½¢æ€</a></li></ol></li><li><a href=#-ä¸»è¦å®ç°defaultlistablebeanfactory>ğŸ› ï¸ ä¸»è¦å®ç°ï¼šDefaultListableBeanFactory</a></li><li><a href=#-åœ¨-spring-å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²>ğŸ”„ åœ¨ Spring å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²</a></li><li><a href=#-æ€»ç»“-11>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#beandefinitionregistry>BeanDefinitionRegistry</a><ol><li><a href=#-æ ¸å¿ƒæ¥å£æ–¹æ³•>ğŸ’¡ æ ¸å¿ƒæ¥å£æ–¹æ³•</a></li><li><a href=#-ä¸»è¦å®ç°ç±»-2>ğŸ› ï¸ ä¸»è¦å®ç°ç±»</a></li><li><a href=#-å·¥ä½œåŸç†ä¸å†…éƒ¨ç»“æ„>âš™ï¸ å·¥ä½œåŸç†ä¸å†…éƒ¨ç»“æ„</a></li><li><a href=#-ä¸»è¦ä½œç”¨ä¸ä»·å€¼>ğŸ¯ ä¸»è¦ä½œç”¨ä¸ä»·å€¼</a></li><li><a href=#-å¦‚ä½•ä½¿ç”¨>ğŸ’» å¦‚ä½•ä½¿ç”¨</a></li><li><a href=#-æ€»ç»“-12>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#beanpostprocessor>BeanPostProcessor</a><ol><li><a href=#-æ ¸å¿ƒæ–¹æ³•ä¸æ‰§è¡Œæ—¶æœº>ğŸ’¡ æ ¸å¿ƒæ–¹æ³•ä¸æ‰§è¡Œæ—¶æœº</a></li><li><a href=#-spring-å†…ç½®çš„å…³é”®å®ç°>ğŸ› ï¸ Spring å†…ç½®çš„å…³é”®å®ç°</a></li><li><a href=#-å¦‚ä½•è‡ªå®šä¹‰-beanpostprocessor>ğŸ’» å¦‚ä½•è‡ªå®šä¹‰ BeanPostProcessor</a><ol><li><a href=#1-å®ç°æ¥å£-2>1. å®ç°æ¥å£</a></li><li><a href=#2-æ³¨å†Œåˆ°å®¹å™¨>2. æ³¨å†Œåˆ°å®¹å™¨</a></li></ol></li><li><a href=#-å…¸å‹åº”ç”¨åœºæ™¯>ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯</a></li><li><a href=#-é‡è¦ä½¿ç”¨é¡»çŸ¥>âš ï¸ é‡è¦ä½¿ç”¨é¡»çŸ¥</a></li><li><a href=#-æ€»ç»“-13>ğŸ’ æ€»ç»“</a></li></ol></li><li><a href=#åˆå§‹åŒ–é¡ºåº>åˆå§‹åŒ–é¡ºåº</a><ol><li><a href=#-spring-å®¹å™¨åˆå§‹åŒ–-bean-çš„æµç¨‹>ğŸ” Spring å®¹å™¨åˆå§‹åŒ– Bean çš„æµç¨‹</a></li><li><a href=#-ä¸ºä½•æ˜¯è¿™ä¸ªé¡ºåº>ğŸ’¡ ä¸ºä½•æ˜¯è¿™ä¸ªé¡ºåºï¼Ÿ</a></li><li><a href=#-å¦‚ä½•é€‰æ‹©-1>ğŸ› ï¸ å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li><li><a href=#-æ³¨æ„äº‹é¡¹>âš ï¸ æ³¨æ„äº‹é¡¹</a></li></ol></li><li><a href=#refresh>refresh()</a><ol><li><a href=#-ç¬¬ä¸€é˜¶æ®µç¯å¢ƒå‡†å¤‡ä¸-beanfactory-åˆå§‹åŒ–>ğŸ’¡ ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒå‡†å¤‡ä¸ BeanFactory åˆå§‹åŒ–</a></li><li><a href=#-ç¬¬äºŒé˜¶æ®µæ‰©å±•ç‚¹è°ƒç”¨ä¸åŠŸèƒ½ç»„ä»¶åˆå§‹åŒ–>ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•ç‚¹è°ƒç”¨ä¸åŠŸèƒ½ç»„ä»¶åˆå§‹åŒ–</a></li><li><a href=#-ç¬¬ä¸‰é˜¶æ®µå®¹å™¨åˆ·æ–°ä¸-bean-å®ä¾‹åŒ–>ğŸš€ ç¬¬ä¸‰é˜¶æ®µï¼šå®¹å™¨åˆ·æ–°ä¸ Bean å®ä¾‹åŒ–</a></li><li><a href=#-æ€»ç»“-14>ğŸ’ æ€»ç»“</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/arts/ style=background-color:#a7535a;color:>æ–‡æ­¦è‰º
</a><a href=/categories/temple/ style=background-color:#69a794;color:>ç™½ç‰äº¬</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/spring-bootsource-code/>ã€Spring Bootã€‘Source Code</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 25, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>18 minute read</time></div></footer></div></header><section class=article-content><h2 id=bootstrapregistryinitializer>BootstrapRegistryInitializer</h2><p><code>BootstrapRegistryInitializer</code>æ˜¯ Spring Boot åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¸€ä¸ª<strong>æ—©æœŸä¸”å…³é”®</strong>çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸ä½ åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆ<code>ApplicationContext</code>ï¼‰æ­£å¼åˆ›å»ºä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘å¹¶æ³¨å†Œä¸€äº›éœ€è¦åœ¨å¯åŠ¨æ—©æœŸé˜¶æ®µä½¿ç”¨çš„å¯¹è±¡ã€‚</p><p>ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹èµ·æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº† <code>BootstrapRegistryInitializer</code>çš„æ ¸å¿ƒç‰¹æ€§ï¼š</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>æ ¸å¿ƒè¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¸»è¦ä½œç”¨</strong></td><td>åœ¨ <code>ApplicationContext</code>åˆ›å»ºä¹‹å‰ï¼Œè¿›è¡Œæ—©æœŸå¯¹è±¡æ³¨å†Œå’Œåˆå§‹åŒ–ã€‚</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td><code>SpringApplication.run()</code>æ–¹æ³•çš„æ—©æœŸé˜¶æ®µï¼Œåœ¨åˆ›å»º <code>ApplicationContext</code>ä¹‹å‰ã€‚</td></tr><tr><td><strong>æ ¸å¿ƒæ“ä½œ</strong></td><td>é€šè¿‡ <code>BootstrapRegistry</code>æ³¨å†Œå¯¹è±¡ã€æ·»åŠ å…³é—­äº‹ä»¶ç›‘å¬å™¨ã€‚</td></tr><tr><td><strong>é…ç½®æ–¹å¼</strong></td><td>åœ¨ <code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­å£°æ˜ï¼Œæˆ–é€šè¿‡ <code>SpringApplication.addBootstrapRegistryInitializer()</code>æ–¹æ³•æ·»åŠ ã€‚</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>æ³¨å†Œçš„å¯¹è±¡åœ¨ <code>ApplicationContext</code>å‡†å¤‡å°±ç»ªåï¼Œé»˜è®¤ä¸å†å¯ç”¨ã€‚</td></tr></tbody></table></div><h3 id=-è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯>ğŸ’¡ è®¾è®¡ç›®æ ‡ä¸é€‚ç”¨åœºæ™¯</h3><p>Spring Boot è®¾è®¡ <code>BootstrapRegistryInitializer</code>ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€äº›éœ€è¦åœ¨ <strong>IoC å®¹å™¨å®Œå…¨å¯åŠ¨ä¹‹å‰</strong> å°±å®Œæˆçš„åˆå§‹åŒ–éœ€æ±‚ï¼Œå®ç°ç¯å¢ƒéš”ç¦»ï¼Œå¹¶ä¼˜åŒ–å¯åŠ¨æ€§èƒ½ã€‚</p><p>å®ƒçš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li><strong>å¤–éƒ¨é…ç½®é¢„åŠ è½½</strong>ï¼šåœ¨åŠ è½½æœ¬åœ° <code>application.properties</code>ä¹‹å‰ï¼Œä¼˜å…ˆä»è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Spring Cloud Configã€Nacosï¼‰æ‹‰å–é…ç½®ä¿¡æ¯ã€‚</li><li><strong>åŸºç¡€è®¾æ–½åˆå§‹åŒ–</strong>ï¼šæå‰åˆå§‹åŒ–ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€ç›‘æ§ä»£ç†ï¼ˆPrometheus Clientï¼‰ã€åˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼ˆZipkinï¼‰ç­‰ã€‚</li><li><strong>æ˜‚è´µèµ„æºé¢„æ³¨å†Œ</strong>ï¼šæ³¨å†Œé‚£äº›åˆ›å»ºæˆæœ¬è¾ƒé«˜çš„å¯¹è±¡åŸå‹ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜å®¢æˆ·ç«¯ç­‰ï¼Œä»¥ä¾¿åœ¨åç»­çš„è‡ªåŠ¨é…ç½®ä¸­å¤ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚</li></ul><h3 id=-æ ¸å¿ƒåŸç†å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²>ğŸ” æ ¸å¿ƒåŸç†ï¼šå¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²</h3><p><code>BootstrapRegistryInitializer</code>çš„è°ƒç”¨æ˜¯ Spring Boot å¯åŠ¨æµç¨‹ä¸­çš„ä¸€ä¸ªç²¾ç¡®æ­¥éª¤ï¼š</p><ol><li><strong>åŠ è½½å®ç°ç±»</strong>ï¼šåœ¨ <code>SpringApplication</code>çš„æ„é€ é˜¶æ®µï¼Œé€šè¿‡ <code>SpringFactoriesLoader</code>ä» <code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­åŠ è½½æ‰€æœ‰å£°æ˜çš„ <code>BootstrapRegistryInitializer</code>å®ç°ç±»ã€‚</li><li>æ‰§è¡Œ <strong><code>createBootstrapContext</code></strong> æ–¹æ³•ï¼šåœ¨ <code>run()</code>æ–¹æ³•ä¸­ï¼Œç´§éšå…¶åçš„æ˜¯åˆ›å»º <code>BootstrapContext</code>ï¼ˆ<code>BootstrapRegistry</code>çš„é»˜è®¤å®ç°ï¼‰å¹¶éå†è°ƒç”¨æ‰€æœ‰ <code>BootstrapRegistryInitializer</code>å®ç°ç±»çš„ <code>initialize</code>æ–¹æ³•ã€‚</li></ol><h3 id=-å¦‚ä½•ä½¿ç”¨ç¼–ç ä¸é…ç½®å®è·µ>âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šç¼–ç ä¸é…ç½®å®è·µ</h3><h4 id=1-å®ç°æ¥å£>1. å®ç°æ¥å£</h4><p>ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥å®ç° <code>BootstrapRegistryInitializer</code>æ¥å£ï¼Œå¹¶é‡å†™å…¶ <code>initialize</code>æ–¹æ³•ã€‚</p><pre tabindex=0><code>// ç¤ºä¾‹ï¼šæ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„é…ç½®å®¢æˆ·ç«¯
public class MyConfigClientInitializer implements BootstrapRegistryInitializer {
    @Override
    public void initialize(BootstrapRegistry registry) {
        // 1. æ³¨å†Œå¯¹è±¡ï¼ˆä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ä¼˜åŒ–æ€§èƒ½ï¼‰
        registry.register(ConfigClient.class, context -&gt; {
            // ä»æ—©æœŸç¯å¢ƒä¸­è·å–é…ç½®æœåŠ¡å™¨åœ°å€
            String serverUrl = context.get(Environment.class).getProperty(&#34;config.server.url&#34;);
            return new ConfigClient(serverUrl); // InstanceSupplier å…è®¸å»¶è¿Ÿåˆ›å»º
        });

        // 2. æ·»åŠ å…³é—­ç›‘å¬å™¨ï¼Œç”¨äºèµ„æºæ¸…ç†æˆ–å¯¹è±¡è½¬ç§»
        registry.addCloseListener(event -&gt; {
            // ä»äº‹ä»¶ä¸­è·å–BootstrapContextå’ŒApplicationContext
            ConfigClient client = event.getBootstrapContext().get(ConfigClient.class);
            // åœ¨BootstrapContextå…³é—­å‰æ‰§è¡Œæ¸…ç†æ“ä½œ
            client.shutdown();
            
            // å¯é€‰ï¼šå°†å¯¹è±¡æ³¨å†Œä¸ºSpring Beanï¼Œä»¥ä¾¿åº”ç”¨åç»­ä½¿ç”¨
            // event.getApplicationContext().getBeanFactory().registerSingleton(&#34;configClient&#34;, client);
        });
    }
}
</code></pre><h4 id=2-æ³¨å†Œå®ç°ç±»>2. æ³¨å†Œå®ç°ç±»</h4><p>è®© Spring Boot å‘ç°ä½ çš„å®ç°ç±»ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p><strong>é€šè¿‡ <code>spring.factories</code>æ–‡ä»¶ï¼ˆæ¨èï¼‰</strong>ï¼šåœ¨é¡¹ç›®çš„ <code>src/main/resources/META-INF/</code>ç›®å½•ä¸‹åˆ›å»º <code>spring.factories</code>æ–‡ä»¶ã€‚</p><pre tabindex=0><code>org.springframework.boot.BootstrapRegistryInitializer=com.example.MyConfigClientInitializer
</code></pre></li><li><p><strong>é€šè¿‡ <code>SpringApplication</code>API</strong>ï¼šåœ¨å¯åŠ¨ç±»ä¸­ç›´æ¥æ·»åŠ ã€‚</p><pre tabindex=0><code>@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(MyApplication.class);
        app.addBootstrapRegistryInitializer(new MyConfigClientInitializer());
        app.run(args);
    }
}
</code></pre></li></ul><h3 id=-å…³é”®æ³¨æ„äº‹é¡¹>âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹</h3><p>ä½¿ç”¨ <code>BootstrapRegistryInitializer</code>æ—¶ï¼Œè¯·åŠ¡å¿…ç•™æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><strong>é¿å…ä¾èµ–æ³¨å…¥</strong>ï¼š<code>initialize</code>æ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒSpring IoC å®¹å™¨å°šæœªåˆ›å»ºï¼Œå› æ­¤ <strong><code>@Autowired</code>ã€<code>@Value</code>ç­‰ä¾èµ–æ³¨å…¥æ³¨è§£åœ¨æ­¤å¤„æ— æ•ˆ</strong>ã€‚æ‰€æœ‰éœ€è¦çš„å‚æ•°éƒ½åº”é€šè¿‡ <code>BootstrapRegistry</code>æˆ– <code>BootstrapContext</code>è·å–ã€‚</li><li><strong>å–„ç”¨å»¶è¿Ÿåˆå§‹åŒ–</strong>ï¼šå¯¹äºåˆ›å»ºæˆæœ¬è¾ƒé«˜çš„å¯¹è±¡ï¼Œå»ºè®®ä½¿ç”¨ <code>InstanceSupplier</code>è¿›è¡Œå»¶è¿Ÿåˆå§‹åŒ–ï¼ˆå¦‚ä¸Šé¢ä»£ç ç¤ºä¾‹æ‰€ç¤ºï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ <code>new</code>ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æœ‰åŠ©äºæå‡åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚</li><li><strong>ç†è§£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ³¨å†Œåˆ° <code>BootstrapRegistry</code>çš„å¯¹è±¡åªåœ¨ <strong>ä»å¯åŠ¨å¼€å§‹åˆ° <code>ApplicationContext</code>å‡†å¤‡å¥½ä¹‹å‰</strong> è¿™æ®µæ—¶é—´å†…å¯ç”¨ã€‚å¦‚æœéœ€è¦åœ¨å®¹å™¨å®Œå…¨å¯åŠ¨åç»§ç»­ä½¿ç”¨è¿™äº›å¯¹è±¡ï¼Œå¿…é¡»åœ¨ <code>BootstrapContextClosedEvent</code>ç›‘å¬å™¨ä¸­æ‰‹åŠ¨å°†å…¶æ³¨å†Œä¸ºå•ä¾‹ Beanã€‚</li></ul><h3 id=-æ€»ç»“>ğŸ’ æ€»ç»“</h3><p><code>BootstrapRegistryInitializer</code>æ˜¯ Spring Boot æä¾›çš„ä¸€ä¸ªå¼ºå¤§ä¸”ç²¾å‡†çš„æ‰©å±•ç‚¹ï¼Œå®ƒå°†ä¸€äº›å…³é”®åˆå§‹åŒ–ä»»åŠ¡å‰ç½®ï¼Œç¡®ä¿äº†åº”ç”¨çš„ç¨³å¥å¯åŠ¨å’Œæ¨¡å—é—´çš„æ¸…æ™°éš”ç¦»ã€‚ç†è§£å¹¶æ°å½“åœ°ä½¿ç”¨å®ƒï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ è§£å†³ä¸€äº›åœ¨ä¼ ç»Ÿ Spring Bean ç”Ÿå‘½å‘¨æœŸä¸­éš¾ä»¥å¤„ç†çš„å¤æ‚åˆå§‹åŒ–éœ€æ±‚ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œè¿ç”¨ <code>BootstrapRegistryInitializer</code>ã€‚å¦‚æœä½ å¯¹å…·ä½“çš„å®ç°ç»†èŠ‚æˆ–ä¸å…¶ä»–æ‰©å±•ç‚¹çš„é…åˆæœ‰æ›´å¤šç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚</p><h2 id=meta-infspringfactories>META-INF/spring.factories</h2><p>å½“ä½ å‘ Spring Boot é¡¹ç›®å¼•å…¥ä¸€ä¸ª JAR åŒ…æ—¶ï¼Œå…¶ <code>META-INF/spring.factories</code>æ–‡ä»¶<strong>ä¸ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨åˆå¹¶</strong>ã€‚è¿™äº›æ–‡ä»¶çš„å†…å®¹æ˜¯åœ¨<strong>åº”ç”¨å¯åŠ¨æ—¶ï¼ˆè¿è¡Œæ—¶ï¼‰</strong> ç”± Spring Boot æ¡†æ¶åŠ¨æ€æ‰«æå’Œåˆå¹¶çš„ã€‚</p><p>ä¸ºäº†è®©ä½ å¿«é€Ÿäº†è§£å¤„ç†æ—¶æœºå’Œæ–¹å¼ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬ï¼š</p><div class=table-wrapper><table><thead><tr><th>é˜¶æ®µ</th><th>å¤„ç†æ–¹å¼</th><th>å…³é”®ç‚¹/å·¥å…·</th></tr></thead><tbody><tr><td><strong>ç¼–è¯‘æ—¶</strong></td><td>é»˜è®¤ä¸è‡ªåŠ¨åˆå¹¶ã€‚åŒåçš„ <code>spring.factories</code>æ–‡ä»¶å¯èƒ½ç›¸äº’è¦†ç›–ã€‚</td><td>éœ€è¦ Maven Shade Plugin ç­‰å·¥å…·æ‰‹åŠ¨é…ç½®åˆå¹¶ã€‚</td></tr><tr><td><strong>è¿è¡Œæ—¶</strong></td><td>Spring Boot è‡ªåŠ¨æ‰«ææ‰€æœ‰ä¾èµ– JAR åŒ…ä¸­çš„ <code>META-INF/spring.factories</code>æ–‡ä»¶å¹¶åˆå¹¶ã€‚</td><td>é€šè¿‡ <code>SpringFactoriesLoader</code>ç±»åŠ è½½å’Œè§£æã€‚</td></tr></tbody></table></div><h3 id=-è¿è¡Œæ—¶åˆå¹¶çš„ç»†èŠ‚>ğŸ”§ è¿è¡Œæ—¶åˆå¹¶çš„ç»†èŠ‚</h3><p>Spring Boot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶æ ¸å¿ƒä¾èµ–äºè¯»å– <code>META-INF/spring.factories</code>æ–‡ä»¶ã€‚åœ¨åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼š</p><ol><li><strong>æ‰«ææ‰€æœ‰ JAR</strong>ï¼šSpring Boot ä¼šæ‰«æç±»è·¯å¾„ä¸‹æ‰€æœ‰ JAR åŒ…ä¸­çš„ <code>META-INF/spring.factories</code>æ–‡ä»¶ã€‚</li><li><strong>åˆå¹¶å†…å®¹</strong>ï¼š<code>SpringFactoriesLoader</code>ä¼šå°†è¿™äº›æ–‡ä»¶ä¸­ç›¸åŒé”®ï¼ˆKeyï¼‰å¯¹åº”çš„å€¼ï¼ˆValueï¼‰åˆå¹¶åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰ JAR ä¸­ <code>EnableAutoConfiguration</code>é”®å¯¹åº”çš„é…ç½®ç±»éƒ½ä¼šè¢«æ”¶é›†èµ·æ¥ã€‚</li><li><strong>å¤„ç†å†²çª</strong>ï¼šå¦‚æœå¤šä¸ªé…ç½®ç±»å®šä¹‰äº†ç›¸åŒçš„ Beanï¼Œå¯ä»¥é€šè¿‡ <code>@ConditionalOnMissingBean</code>ç­‰æ¡ä»¶æ³¨è§£æ¥é¿å…å†²çªï¼Œç¡®ä¿åªæœ‰ä¸€ä»½ç”Ÿæ•ˆã€‚</li></ol><h3 id=-ç¼–è¯‘æ—¶éœ€æ³¨æ„çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ>âš ï¸ ç¼–è¯‘æ—¶éœ€æ³¨æ„çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3><p>è™½ç„¶åœ¨è¿è¡Œæ—¶ Spring Boot ä¼šå¤„ç†åˆå¹¶ï¼Œä½†åœ¨<strong>æ‰“åŒ…é˜¶æ®µ</strong>ï¼ˆç¼–è¯‘æ—¶ï¼‰ï¼Œå¦‚æœä½ éœ€è¦å°†å¤šä¸ªæ¨¡å—æˆ–ä¾èµ–æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ &ldquo;uber-jar&rdquo;ï¼ˆæ¯”å¦‚ä½¿ç”¨ <code>maven-assembly-plugin</code>æˆ– <code>maven-shade-plugin</code>ï¼‰ï¼Œå°±å¯èƒ½å‡ºç°åŒå <code>spring.factories</code>æ–‡ä»¶ç›¸äº’è¦†ç›–çš„é—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <strong><code>maven-shade-plugin</code></strong> æ’ä»¶ï¼Œå¹¶é…ç½® <code>AppendingTransformer</code>æ¥æŒ‡å®šéœ€è¦åˆå¹¶çš„æ–‡ä»¶ã€‚</p><pre tabindex=0><code>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.5.0&lt;/version&gt; &lt;!-- è¯·ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ --&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;phase&gt;package&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;shade&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;transformers&gt;
                            &lt;!-- å¤„ç† META-INF/spring.factories æ–‡ä»¶çš„åˆå¹¶ --&gt;
                            &lt;transformer implementation=&#34;org.apache.maven.plugins.shade.resource.AppendingTransformer&#34;&gt;
                                &lt;resource&gt;META-INF/spring.factories&lt;/resource&gt;
                            &lt;/transformer&gt;
                            &lt;!-- å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥å¤„ç†å…¶ä»–Springé…ç½®æ–‡ä»¶ --&gt;
                            &lt;transformer implementation=&#34;org.apache.maven.plugins.shade.resource.AppendingTransformer&#34;&gt;
                                &lt;resource&gt;META-INF/spring.handlers&lt;/resource&gt;
                            &lt;/transformer&gt;
                            &lt;transformer implementation=&#34;org.apache.maven.plugins.shade.resource.AppendingTransformer&#34;&gt;
                                &lt;resource&gt;META-INF/spring.schemas&lt;/resource&gt;
                            &lt;/transformer&gt;
                        &lt;/transformers&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><h3 id=-æœ€ä½³å®è·µå»ºè®®>ğŸ’¡ æœ€ä½³å®è·µå»ºè®®</h3><ol><li><strong>é¿å… Key å†²çª</strong>ï¼šåœ¨è‡ªå®šä¹‰ Starter æ—¶ï¼Œå°½é‡ç¡®ä¿è‡ªåŠ¨é…ç½®ç±»çš„ Bean å®šä¹‰ä½¿ç”¨ <code>@ConditionalOnMissingBean</code>æ³¨è§£ï¼Œè¿™æ ·å³ä½¿å¤šä¸ªé…ç½®ç±»è¢«åŠ è½½ï¼Œä¹Ÿèƒ½é¿å… Bean é‡å¤å®šä¹‰çš„å†²çªã€‚</li><li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šéµå¾ª Spring Boot å®˜æ–¹å»ºè®®ï¼Œå°† Starter çš„æ ¸å¿ƒä¾èµ–ä¸è‡ªåŠ¨é…ç½®æ¨¡å—ï¼ˆautoconfigureï¼‰åˆ†ç¦»ï¼Œè¿™æ ·å¯ä»¥æ›´çµæ´»åœ°ç®¡ç†ä¾èµ–å’Œé…ç½®ã€‚</li><li><strong>äº†è§£æ–°ç‰¹æ€§</strong>ï¼šä» Spring Boot 2.7 å¼€å§‹ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>æ–‡ä»¶æ¥æ›¿ä»£ <code>spring.factories</code>ä¸­è‡ªåŠ¨é…ç½®çš„æ³¨å†Œæ–¹å¼ï¼Œè¿™ç§æ–¹å¼èƒ½æ›´æ¸…æ™°åœ°ç®¡ç†è‡ªåŠ¨é…ç½®ç±»ä¸”é¿å…ä¸€äº›åˆå¹¶é—®é¢˜ã€‚ä½†è¯·æ³¨æ„ï¼ŒåŸæœ‰çš„ <code>spring.factories</code>æ–¹å¼ä»ç„¶æ”¯æŒã€‚</li></ol><h3 id=-æ€»ç»“-1>ğŸ’ æ€»ç»“</h3><p>ç®€å•æ¥è¯´ï¼Œä½ ä¸éœ€è¦åœ¨ç¼–è¯‘æ—¶æ‹…å¿ƒ <code>META-INF/spring.factories</code>çš„åˆå¹¶é—®é¢˜ï¼ŒSpring Boot åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¼šå¦¥å–„å¤„ç†ã€‚åªæœ‰åœ¨éœ€è¦åˆ¶ä½œä¸€ä¸ªå¤§è€Œå…¨çš„ &ldquo;uber-jar&rdquo; æ—¶ï¼Œæ‰éœ€é€šè¿‡ <code>maven-shade-plugin</code>ç­‰å·¥å…·åœ¨æ‰“åŒ…é˜¶æ®µæ‰‹åŠ¨é…ç½®åˆå¹¶ã€‚</p><p>å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œå¤„ç† Spring Boot ä¸­çš„é…ç½®åˆå¹¶é—®é¢˜ã€‚</p><h2 id=applicationcontextinitializer>ApplicationContextInitializer</h2><p><code>ApplicationContextInitializer</code>æ˜¯ Spring Boot æä¾›çš„ä¸€ä¸ªå…³é”®æ‰©å±•ç‚¹ï¼Œå…è®¸ä½ åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆ<code>ApplicationContext</code>ï¼‰æ­£å¼åˆ·æ–°ä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒçš„æ ¸å¿ƒç‰¹æ€§ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤è¯†ã€‚</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>æ ¸å¿ƒè¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¸»è¦ä½œç”¨</strong></td><td>åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡åˆ·æ–°å‰ï¼Œå¯¹å…¶è¿›è¡Œç¼–ç¨‹æ–¹å¼çš„åˆå§‹åŒ–å’Œå®šåˆ¶ã€‚</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td><code>ApplicationContext</code>åˆ›å»ºä¹‹åã€<code>refresh()</code>æ–¹æ³•è°ƒç”¨ä¹‹å‰ã€‚</td></tr><tr><td><strong>æ ¸å¿ƒæ“ä½œ</strong></td><td>é…ç½®ç¯å¢ƒå±æ€§ã€æ³¨å†Œ Bean å®šä¹‰ã€æ·»åŠ åç½®å¤„ç†å™¨ç­‰ã€‚</td></tr><tr><td><strong>é…ç½®æ–¹å¼</strong></td><td>é€šè¿‡ <code>spring.factories</code>æ–‡ä»¶ã€<code>application.properties</code>æˆ–ç¼–ç¨‹æ–¹å¼æ·»åŠ ã€‚</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒä½œç”¨ä¸é€‚ç”¨åœºæ™¯>ğŸ’¡ æ ¸å¿ƒä½œç”¨ä¸é€‚ç”¨åœºæ™¯</h3><p><code>ApplicationContextInitializer</code>çš„æ ¸å¿ƒä»·å€¼åœ¨äºå…¶ <strong>ç²¾å‡†çš„æ‰§è¡Œæ—¶æœº</strong>ã€‚å®ƒè®©ä½ èƒ½å¤Ÿåœ¨ Spring å®¹å™¨åŠ è½½ Bean å®šä¹‰ã€åˆ›å»º Bean å®ä¾‹ä¹‹å‰ï¼Œå°±å¯¹å®¹å™¨æœ¬èº«è¿›è¡Œé…ç½® ã€‚</p><p>å®ƒçš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li><strong>åŠ¨æ€ç¯å¢ƒé…ç½®</strong>ï¼šæ ¹æ®è¿è¡Œç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰åŠ¨æ€è®¾ç½®æˆ–è¦†ç›–ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ ã€‚</li><li><strong>æ—©æœŸ Bean æ³¨å†Œ</strong>ï¼šåœ¨å®¹å™¨åˆ·æ–°å‰ï¼Œé€šè¿‡ <code>BeanDefinitionRegistry</code>åŠ¨æ€æ³¨å†Œè‡ªå®šä¹‰çš„ Bean å®šä¹‰ ã€‚</li><li><strong>æ³¨å†Œåç½®å¤„ç†å™¨</strong>ï¼šæå‰æ³¨å†Œè‡ªå®šä¹‰çš„ <code>BeanFactoryPostProcessor</code>æˆ– <code>BeanPostProcessor</code>ï¼Œä»¥å½±å“åç»­çš„ Bean åˆ›å»ºè¿‡ç¨‹ ã€‚</li><li><strong>æ¡ä»¶æ£€æŸ¥å’ŒåŸºç¡€è®¾æ–½åˆå§‹åŒ–</strong>ï¼šåœ¨å®¹å™¨å¯åŠ¨å‰è¿›è¡Œå¿…è¦çš„ç³»ç»Ÿèµ„æºæ£€æŸ¥ï¼Œæˆ–åˆå§‹åŒ–ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œå¦‚æ—¥å¿—æ¡†æ¶ ã€‚</li></ul><h3 id=-å¦‚ä½•ä½¿ç”¨å®ç°ä¸æ³¨å†Œ>âš™ï¸ å¦‚ä½•ä½¿ç”¨ï¼šå®ç°ä¸æ³¨å†Œ</h3><h4 id=1-å®ç°æ¥å£-1>1. å®ç°æ¥å£</h4><p>åˆ›å»ºä¸€ä¸ªç±»å®ç° <code>ApplicationContextInitializer&lt;ConfigurableApplicationContext></code>æ¥å£ï¼Œå¹¶é‡å†™ <code>initialize</code>æ–¹æ³•ã€‚</p><pre tabindex=0><code>import org.springframework.context.ApplicationContextInitializer;
import org.springframework.context.ConfigurableApplicationContext;
import org.springframework.core.env.ConfigurableEnvironment;
import org.springframework.core.env.MapPropertySource;
import java.util.HashMap;
import java.util.Map;

public class CustomApplicationContextInitializer implements ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt; {
    @Override
    public void initialize(ConfigurableApplicationContext applicationContext) {
        // è·å–ç¯å¢ƒé…ç½®
        ConfigurableEnvironment environment = applicationContext.getEnvironment();
        
        // å‡†å¤‡è‡ªå®šä¹‰é…ç½®
        Map&lt;String, Object&gt; customProperties = new HashMap&lt;&gt;();
        customProperties.put(&#34;server.port&#34;, &#34;8081&#34;);
        customProperties.put(&#34;app.custom.setting&#34;, &#34;initialized&#34;);
        
        // å°†è‡ªå®šä¹‰é…ç½®æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶è®¾ç½®ä¼˜å…ˆçº§
        MapPropertySource propertySource = new MapPropertySource(&#34;customInitializer&#34;, customProperties);
        environment.getPropertySources().addFirst(propertySource);
        
        System.out.println(&#34;CustomApplicationContextInitializer has been executed.&#34;);
    }
}
</code></pre><h4 id=2-æ³¨å†Œå®ç°ç±»-1>2. æ³¨å†Œå®ç°ç±»</h4><p>è®© Spring Boot è¯†åˆ«åˆ°ä½ çš„ <code>ApplicationContextInitializer</code>æœ‰ä¸‰ç§ä¸»è¦æ–¹å¼ï¼Œå®ƒä»¬çš„<strong>åŠ è½½ä¼˜å…ˆçº§</strong>ä»é«˜åˆ°ä½å¦‚ä¸‹ ï¼š</p><ol><li><p><strong>é…ç½®æ–‡ä»¶æ³¨å†Œï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰</strong></p><p>åœ¨ <code>application.properties</code>æˆ– <code>application.yml</code>ä¸­é…ç½®ï¼š</p><pre tabindex=0><code># application.properties
context.initializer.classes=com.yourpackage.CustomApplicationContextInitializer
</code></pre><pre tabindex=0><code># application.yml
context:
  initializer:
    classes: com.yourpackage.CustomApplicationContextInitializer
</code></pre></li><li><p><strong>Spring Factories æœºåˆ¶æ³¨å†Œ</strong></p><p>åœ¨é¡¹ç›®çš„ <code>src/main/resources/META-INF/</code>ç›®å½•ä¸‹åˆ›å»º <code>spring.factories</code>æ–‡ä»¶ï¼š</p><pre tabindex=0><code>org.springframework.context.ApplicationContextInitializer=com.yourpackage.CustomApplicationContextInitializer
</code></pre></li><li><p><strong>ç¼–ç¨‹æ–¹å¼æ³¨å†Œï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰</strong></p><p>åœ¨å¯åŠ¨ç±»çš„ <code>main</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡ <code>SpringApplication</code>å®ä¾‹æ·»åŠ ï¼š</p><pre tabindex=0><code>@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication application = new SpringApplication(MyApplication.class);
        application.addInitializers(new CustomApplicationContextInitializer());
        application.run(args);
    }
}
</code></pre></li></ol><h4 id=3-æ§åˆ¶æ‰§è¡Œé¡ºåº>3. æ§åˆ¶æ‰§è¡Œé¡ºåº</h4><p>å¦‚æœå®šä¹‰äº†å¤šä¸ª <code>ApplicationContextInitializer</code>ï¼Œå¯ä»¥é€šè¿‡ <code>@Order</code>æ³¨è§£æˆ–å®ç° <code>Ordered</code>æ¥å£æ¥æ§åˆ¶å®ƒä»¬çš„æ‰§è¡Œé¡ºåºã€‚<strong>æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</strong> ã€‚</p><pre tabindex=0><code>@Order(1) // æ­¤åˆå§‹åŒ–å™¨å°†ä¼˜å…ˆæ‰§è¡Œ
public class FirstInitializer implements ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt; {
    // ... initialize æ–¹æ³•å®ç°
}
</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>@Order</code>æ³¨è§£å¯¹é€šè¿‡ <code>context.initializer.classes</code>é…ç½®çš„åˆå§‹åŒ–å™¨ä¸ç”Ÿæ•ˆï¼Œè¿™ç±»åˆå§‹åŒ–å™¨æ€»æ˜¯æœ€å…ˆæ‰§è¡Œ ã€‚</p><h3 id=-æ‰§è¡Œæ—¶æœºä¸æºç ç®€æ>ğŸ” æ‰§è¡Œæ—¶æœºä¸æºç ç®€æ</h3><p><code>ApplicationContextInitializer</code>çš„è°ƒç”¨å‘ç”Ÿåœ¨ Spring Boot å¯åŠ¨æµç¨‹çš„ <code>run()</code>æ–¹æ³•ä¸­ï¼Œå…·ä½“æ˜¯åœ¨ <code>prepareContext</code>é˜¶æ®µ ã€‚</p><p>å…¶æ ¸å¿ƒé€»è¾‘å¯ä»¥ç®€åŒ–ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>åŠ è½½</strong>ï¼šåœ¨ <code>SpringApplication</code>æ„é€ æ—¶ï¼Œé€šè¿‡ <code>SpringFactoriesLoader</code>ä» <code>META-INF/spring.factories</code>ç­‰ä½ç½®åŠ è½½æ‰€æœ‰å®ç°ç±»çš„å®ä¾‹ ã€‚</li><li><strong>æ’åº</strong>ï¼šä½¿ç”¨ <code>AnnotationAwareOrderComparator</code>å¯¹æ”¶é›†åˆ°çš„åˆå§‹åŒ–å™¨è¿›è¡Œæ’åº ã€‚</li><li><strong>æ‰§è¡Œ</strong>ï¼šåœ¨ <code>prepareContext</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ <code>applyInitializers(context)</code>æ–¹æ³•ï¼Œéå†å¹¶æ‰§è¡Œæ‰€æœ‰åˆå§‹åŒ–å™¨çš„ <code>initialize</code>æ–¹æ³• ã€‚æ­¤æ—¶ï¼Œ<code>ApplicationContext</code>å·²åˆ›å»ºä½†æœªåˆ·æ–°ï¼ˆ<code>refresh</code>ï¼‰ï¼Œæ˜¯è¿›è¡Œè‡ªå®šä¹‰æ“ä½œçš„ç†æƒ³æ—¶æœº ã€‚</li></ol><h3 id=-ä½¿ç”¨æ³¨æ„äº‹é¡¹>âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3><ul><li><strong>é¿å…è€—æ—¶æ“ä½œ</strong>ï¼šåœ¨æ­¤é˜¶æ®µåº”é¿å…æ‰§è¡Œå¤æ‚çš„æˆ–è€—æ—¶çš„æ“ä½œï¼Œå› ä¸ºè¿™ä¼šå½±å“åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ ã€‚</li><li><strong>è°¨æ…è¿›è¡Œ Bean æ“ä½œ</strong>ï¼šæ­¤æ—¶ Spring å®¹å™¨å°šæœªåˆ·æ–°ï¼Œæ— æ³•ç›´æ¥è·å–æˆ–æ“ä½œ Beanã€‚å¦‚éœ€æ³¨å†Œ Beanï¼Œåº”é€šè¿‡ <code>BeanDefinitionRegistry</code>è¿›è¡Œ ã€‚</li><li><strong>ç†è§£ç¯å¢ƒå°±ç»ªç¨‹åº¦</strong>ï¼šè™½ç„¶å¯ä»¥è®¿é—® <code>Environment</code>ï¼Œä½†è¦æ„è¯†åˆ°æŸäº›å±æ€§å¯èƒ½è¿˜æœªå®Œå…¨åŠ è½½æˆ–è§£æã€‚</li></ul><h3 id=-æ€»ç»“-2>ğŸ’ æ€»ç»“</h3><p><code>ApplicationContextInitializer</code>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Spring Boot æ‰©å±•ç‚¹ï¼Œå®ƒé€šè¿‡åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸçš„ç²¾ç¡®æ—¶åˆ»ä»‹å…¥ï¼Œä¸ºä½ æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚æ— è®ºæ˜¯è¿›è¡Œç¯å¢ƒå®šåˆ¶ã€æ—©æœŸé…ç½®è¿˜æ˜¯æ¡ä»¶æ£€æŸ¥ï¼Œç†è§£å’Œæ­£ç¡®ä½¿ç”¨å®ƒéƒ½èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ Spring Boot åº”ç”¨çš„å¯åŠ¨è¿‡ç¨‹ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£é‡Šèƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£å’Œæœ‰æ•ˆè¿ç”¨ <code>ApplicationContextInitializer</code>ã€‚</p><h2 id=configurableapplicationcontext>ConfigurableApplicationContext</h2><p><code>ConfigurableApplicationContext</code>å’Œ <code>ApplicationContext</code>æ˜¯ Spring æ¡†æ¶ä¸­å…³ç³»ç´§å¯†çš„ä¸¤ä¸ªæ ¸å¿ƒæ¥å£ã€‚ç®€å•æ¥è¯´ï¼Œ<strong><code>ConfigurableApplicationContext</code>æ˜¯ <code>ApplicationContext</code>çš„æ‰©å±•</strong>ï¼Œå®ƒæä¾›äº†é…ç½®å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†çš„èƒ½åŠ›ï¼Œè€Œ <code>ApplicationContext</code>ä¸»è¦å®šä¹‰äº†ä½œä¸ºä¸€ä¸ªé«˜çº§å®¹å™¨å¯¹å¤–æä¾›çš„åŸºæœ¬åªè¯»æ“ä½œã€‚</p><p>ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨å±€ï¼Œä¸‹è¡¨æ¸…æ™°åœ°å±•ç¤ºäº†å®ƒä»¬ä¹‹é—´çš„æ ¸å¿ƒåŒºåˆ«ï¼š</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>ApplicationContext</th><th>ConfigurableApplicationContext</th></tr></thead><tbody><tr><td><strong>æ¥å£å…³ç³»</strong></td><td>é¡¶çº§æ¥å£ï¼Œå®šä¹‰äº†å®¹å™¨çš„åŸºç¡€åªè¯»æ“ä½œã€‚</td><td><strong>ç»§æ‰¿è‡ª <code>ApplicationContext</code></strong>ï¼Œæ˜¯å…¶å­æ¥å£ï¼Œå¢åŠ äº†é…ç½®å’Œç®¡ç†æ–¹æ³•ã€‚</td></tr><tr><td><strong>æ ¸å¿ƒèƒ½åŠ›</strong></td><td>æä¾›<strong>åªè¯»</strong>è®¿é—®ï¼Œå¦‚è·å–Beanã€å›½é™…åŒ–æ¶ˆæ¯ã€äº‹ä»¶å‘å¸ƒã€èµ„æºåŠ è½½ç­‰ã€‚</td><td>æä¾›<strong>å¯é…ç½®</strong>å’Œ<strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>èƒ½åŠ›ï¼Œå¦‚è®¾ç½®ç¯å¢ƒã€åˆ·æ–°å®¹å™¨ã€å…³é—­å®¹å™¨ç­‰ã€‚</td></tr><tr><td><strong>è®¾è®¡ç›®çš„</strong></td><td>ä½œä¸ºåº”ç”¨ç¨‹åºä¸Springå®¹å™¨äº¤äº’çš„<strong>ç¨³å®šå®¢æˆ·ç«¯è§†å›¾</strong>ï¼Œç¡®ä¿æ“ä½œçš„å®‰å…¨æ€§ã€‚</td><td>ä¸»è¦ä¸ºSpringæ¡†æ¶å†…éƒ¨æˆ–éœ€è¦æ·±åº¦å®šåˆ¶çš„åœºæ™¯æä¾›<strong>é…ç½®å’Œç®¡ç†çš„å…¥å£</strong>ã€‚</td></tr><tr><td><strong>å…¸å‹æ–¹æ³•</strong></td><td><code>getBean()</code>, <code>getMessage()</code>, <code>publishEvent()</code>ã€‚</td><td><code>refresh()</code>, <code>close()</code>, <code>addBeanFactoryPostProcessor()</code>, <code>setEnvironment()</code>ã€‚</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸ç›´æ¥æä¾›ç”Ÿå‘½å‘¨æœŸçš„å¯åŠ¨/åœæ­¢æ§åˆ¶ã€‚</td><td>ç»§æ‰¿äº† <code>Lifecycle</code>æ¥å£ï¼Œå¯ä»¥æ˜¾å¼åœ°<strong>å¯åŠ¨</strong>ã€<strong>åˆ·æ–°</strong>å’Œ<strong>å…³é—­</strong>åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</td></tr></tbody></table></div><h3 id=-æ·±å…¥ç†è§£è§’è‰²ä¸è®¾è®¡>ğŸ’¡ æ·±å…¥ç†è§£è§’è‰²ä¸è®¾è®¡</h3><ul><li><p><strong><code>ApplicationContext</code>ï¼šç¨³å®šçš„â€œæœåŠ¡çª—å£â€</strong></p><p>ä½ å¯ä»¥æŠŠ <code>ApplicationContext</code>æƒ³è±¡æˆä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„æœåŠ¡çª—å£ã€‚åº”ç”¨ç¨‹åºé€šè¿‡å®ƒæ¥è·å–Beanã€è¯»å–å›½é™…åŒ–æ¶ˆæ¯ã€å‘å¸ƒåº”ç”¨äº‹ä»¶æˆ–åŠ è½½èµ„æºã€‚å®ƒæ‰¿è¯ºæä¾›è¿™äº›æœåŠ¡ï¼Œä½†éšè—äº†å†…éƒ¨å¦‚ä½•å®ç°å’Œé…ç½®çš„ç»†èŠ‚ã€‚è¿™ç§â€œåªè¯»â€ç‰¹æ€§ä½¿å¾—å®ƒæˆä¸ºåº”ç”¨ç¨‹åºä»£ç ä¸Springå®¹å™¨äº¤äº’çš„ç†æƒ³æ¥å£ï¼Œå› ä¸ºå®ƒå®‰å…¨ã€ç¨³å®šã€‚</p></li><li><p><strong><code>ConfigurableApplicationContext</code>ï¼šå†…éƒ¨çš„â€œæ§åˆ¶ä¸­å¿ƒâ€</strong></p><p>è€Œ <code>ConfigurableApplicationContext</code>åˆ™åƒæ˜¯åå°çš„æ§åˆ¶ä¸­å¿ƒã€‚å®ƒç»§æ‰¿äº†é‚£ä¸ªâ€œæœåŠ¡çª—å£â€çš„æ‰€æœ‰åŠŸèƒ½ï¼Œä½†æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæä¾›äº†å„ç§â€œæŒ‰é’®â€å’Œâ€œå¼€å…³â€æ¥é…ç½®å’Œæ“çºµå®¹å™¨æœ¬èº«ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®¾ç½®å…¶çˆ¶ä¸Šä¸‹æ–‡ã€æ·»åŠ åç½®å¤„ç†å™¨ã€è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ–è€…ç›´æ¥å‘½ä»¤å®¹å™¨åˆ·æ–°ï¼ˆé‡æ–°åŠ è½½é…ç½®ï¼‰æˆ–å…³é—­ã€‚è¿™ä¸ªæ¥å£çš„è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†æ¡†æ¶å†…éƒ¨ä½¿ç”¨ï¼Œæˆ–è€…åœ¨åº”ç”¨å¯åŠ¨æ—¶éœ€è¦é«˜åº¦å®šåˆ¶åŒ–å®¹å™¨çš„åœºæ™¯ã€‚</p><p>Spring æ¡†æ¶é‡‡ç”¨è¿™ç§å°†â€œè¯»â€å’Œâ€œå†™â€èŒè´£åˆ†ç¦»åˆ°ä¸¤ä¸ªæ¥å£çš„è®¾è®¡ï¼Œæå¤§åœ°æé«˜äº†ä»£ç çš„æ¸…æ™°åº¦å’Œçµæ´»æ€§ï¼Œæ˜¯ä¸€ç§éå¸¸ä¼˜ç§€çš„è®¾è®¡æ¨¡å¼å®è·µã€‚</p></li></ul><h3 id=-å¦‚ä½•ä½¿ç”¨-configurableapplicationcontext>ğŸ”§ å¦‚ä½•ä½¿ç”¨ ConfigurableApplicationContext</h3><p>åœ¨å…¸å‹çš„Spring Bootåº”ç”¨ä¸­ï¼Œä½ é€šå¸¸ä¸ä¼šç›´æ¥å®ä¾‹åŒ– <code>ConfigurableApplicationContext</code>ï¼Œä½†ä½ çš„ç¡®åœ¨ä½¿ç”¨å®ƒã€‚<code>SpringApplication.run()</code>æ–¹æ³•è¿”å›çš„å°±æ˜¯ä¸€ä¸ª <code>ConfigurableApplicationContext</code>å®ä¾‹ã€‚</p><pre tabindex=0><code>@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        // è¿”å›çš„å®é™…æ˜¯ ConfigurableApplicationContext ç±»å‹
        ConfigurableApplicationContext context = SpringApplication.run(MyApplication.class, args);
        
        // ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦æ³¨å†Œæ–°çš„å•ä¾‹Bean
        // context.getBeanFactory().registerSingleton(&#34;myNewBean&#34;, new MyNewBean());
        
        // åº”ç”¨ç»“æŸæ—¶ï¼Œå¯ä»¥è°ƒç”¨closeæ–¹æ³•ï¼Œä¸è¿‡Spring Booté€šå¸¸ä¼šè‡ªåŠ¨å¤„ç†
        // context.close();
    }
}
</code></pre><h3 id=-æ€»ç»“-3>ğŸ’ æ€»ç»“</h3><p>ç®€å•æ¥è¯´ï¼Œ<code>ApplicationContext</code>æ˜¯é¢å‘åº”ç”¨çš„<strong>ä½¿ç”¨æ¥å£</strong>ï¼Œè€Œ <code>ConfigurableApplicationContext</code>æ˜¯é¢å‘æ¡†æ¶çš„<strong>é…ç½®å’Œç®¡ç†æ¥å£</strong>ã€‚åè€…åœ¨å‰è€…çš„åŸºç¡€ä¸Šï¼Œèµ‹äºˆäº†å®¹å™¨åŠ¨æ€é…ç½®å’Œå®Œæ•´ç”Ÿå‘½å‘¨æœŸæ§åˆ¶çš„èƒ½åŠ›ï¼Œæ˜¯Spring IOCå®¹å™¨æ›´åŠ å¼ºå¤§å’Œçµæ´»çš„ä¸€é¢ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ¸…æ™°åœ°ç†è§£ä¸¤è€…çš„åŒºåˆ«å’Œè”ç³»ï¼</p><h2 id=application-listener>Application Listener</h2><p>ApplicationListener æ˜¯ Spring æ¡†æ¶<strong>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å‹</strong>çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒå®ç°äº†ç»å…¸çš„<strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼Œå…è®¸ä½ çš„åº”ç”¨ç»„ä»¶å¯¹ Spring å®¹å™¨ä¸­å‘ç”Ÿçš„ç‰¹å®šäº‹ä»¶åšå‡ºååº”ï¼Œä»è€Œå®ç°ä¸šåŠ¡è§£è€¦ã€æé«˜å¯æ‰©å±•æ€§ã€‚</p><p>ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº†å…¶æ ¸å¿ƒä¿¡æ¯ï¼š</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>æ ¸å¿ƒè¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒè§’è‰²</strong></td><td>ç›‘å¬å™¨ (<code>ApplicationListener</code>)</td></tr><tr><td><strong>ç›‘å¬ç›®æ ‡</strong></td><td>äº‹ä»¶ (<code>ApplicationEvent</code>åŠå…¶å­ç±»)</td></tr><tr><td><strong>æ ¸å¿ƒæ“ä½œ</strong></td><td>å®ç° <code>onApplicationEvent(E event)</code>æ–¹æ³•</td></tr><tr><td><strong>å…³é”®ç‰¹æ€§</strong></td><td>ç±»å‹å®‰å…¨ (é€šè¿‡æ³›å‹æŒ‡å®šäº‹ä»¶ç±»å‹)ã€å¼‚æ­¥æ”¯æŒã€æ‰§è¡Œé¡ºåºæ§åˆ¶</td></tr><tr><td><strong>è®¾è®¡ç›®æ ‡</strong></td><td>å®ç°ç»„ä»¶é—´çš„æ¾è€¦åˆé€šä¿¡</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼</h3><p>Spring çš„äº‹ä»¶æœºåˆ¶ç”±ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†æ„æˆï¼š</p><ul><li><strong>äº‹ä»¶ (<code>ApplicationEvent</code>)</strong>ï¼šä¼ é€’æ¶ˆæ¯çš„è½½ä½“ï¼Œæ‰€æœ‰äº‹ä»¶çš„æ ¹ç±»ã€‚å¯ä»¥æ˜¯ Spring å†…ç½®çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½ çš„è‡ªå®šä¹‰ä¸šåŠ¡äº‹ä»¶ã€‚</li><li><strong>ç›‘å¬å™¨ (<code>ApplicationListener</code>)</strong>ï¼šè´Ÿè´£æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶çš„æ ¸å¿ƒæ¥å£ã€‚</li><li><strong>äº‹ä»¶å‘å¸ƒè€… (<code>ApplicationEventPublisher</code>)</strong>ï¼šç”¨äºå‘å¸ƒäº‹ä»¶çš„æ¥å£ï¼ŒSpring çš„ <code>ApplicationContext</code>æœ¬èº«å°±å®ç°äº†æ­¤æ¥å£ã€‚</li></ul><p>è¿™ç§è®¾è®¡çš„ä¸»è¦ä»·å€¼åœ¨äº<strong>è§£è€¦</strong>ã€‚äº‹ä»¶å‘å¸ƒè€…æ— éœ€çŸ¥é“æœ‰å“ªäº›ç›‘å¬å™¨å­˜åœ¨ï¼Œåªéœ€å‘å¸ƒäº‹ä»¶ï¼›ç›‘å¬å™¨ä¹Ÿåªå…³å¿ƒè‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚è¿™ä½¿å¾—æ·»åŠ æ–°çš„ä¸šåŠ¡å¤„ç†é€»è¾‘å˜å¾—éå¸¸ç®€å•ï¼Œåªéœ€å¢åŠ æ–°çš„ç›‘å¬å™¨å³å¯ï¼Œæ— éœ€ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œæå¤§åœ°æå‡äº†ä»£ç çš„å†…èšæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id=-å¦‚ä½•å®ç°ä¸€ä¸ªç›‘å¬å™¨>ğŸ› ï¸ å¦‚ä½•å®ç°ä¸€ä¸ªç›‘å¬å™¨</h3><p>ä½ æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼æ¥åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨ï¼Œç°ä»£ Springï¼ˆ4.2+ï¼‰æ›´æ¨èä½¿ç”¨æ³¨è§£æ–¹å¼ã€‚</p><h4 id=æ–¹å¼ä¸€å®ç°-applicationlisteneræ¥å£ç»å…¸æ–¹å¼>æ–¹å¼ä¸€ï¼šå®ç° <code>ApplicationListener</code>æ¥å£ï¼ˆç»å…¸æ–¹å¼ï¼‰</h4><p>è¿™æ˜¯ä¸€ç§ç›´æ¥çš„æ–¹å¼ï¼Œéœ€è¦å®ç°æ¥å£å¹¶æŒ‡å®šæ³›å‹äº‹ä»¶ç±»å‹ã€‚</p><pre tabindex=0><code>import org.springframework.context.ApplicationListener;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.stereotype.Component;

@Component
public class ContextRefreshListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        // å®¹å™¨åˆ·æ–°å®Œæˆåæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
        System.out.println(&#34;å®¹å™¨åˆ·æ–°å®Œæˆï¼ŒåŠ è½½çš„Beanæ•°é‡: &#34; + event.getApplicationContext().getBeanDefinitionCount());
        initCache();
        preloadData();
    }
    // ... å…¶ä»–è‡ªå®šä¹‰æ–¹æ³•
}
</code></pre><h4 id=æ–¹å¼äºŒä½¿ç”¨-eventlisteneræ³¨è§£æ¨èæ–¹å¼>æ–¹å¼äºŒï¼šä½¿ç”¨ <code>@EventListener</code>æ³¨è§£ï¼ˆæ¨èæ–¹å¼ï¼‰</h4><p>è¿™æ˜¯æ›´ç®€æ´ã€çµæ´»çš„æ–¹å¼ã€‚ä½ å¯ä»¥åœ¨ä»»ä½• Spring ç®¡ç†çš„ Bean çš„æ–¹æ³•ä¸Šä½¿ç”¨æ­¤æ³¨è§£ï¼Œæ–¹æ³•å‚æ•°å®šä¹‰äº†è¦ç›‘å¬çš„äº‹ä»¶ç±»å‹ã€‚</p><pre tabindex=0><code>import org.springframework.context.event.EventListener;
import org.springframework.scheduling.annotation.Async;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
public class AnnotationBasedListeners {
    
    // ç›‘å¬å®¹å™¨åˆ·æ–°äº‹ä»¶
    @EventListener
    public void handleContextRefreshed(ContextRefreshedEvent event) {
        System.out.println(&#34;æ”¶åˆ°å®¹å™¨åˆ·æ–°äº‹ä»¶&#34;);
    }

    // å¼‚æ­¥å¤„ç†è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶æŒ‡å®šé¡ºåº
    @EventListener
    @Async
    @Order(1)
    public void handleOrderCreated(OrderCreatedEvent event) {
        System.out.println(&#34;å¼‚æ­¥å¤„ç†è®¢å•äº‹ä»¶: &#34; + event.getOrderId());
    }

    // æ¡ä»¶åŒ–ç›‘å¬ï¼ˆä»…å½“è®¢å•é‡‘é¢å¤§äº1000æ—¶è§¦å‘ï¼‰
    @EventListener(condition = &#34;#event.order.amount &gt; 1000&#34;)
    public void handleLargeOrder(OrderCreatedEvent event) {
        System.out.println(&#34;å¤„ç†å¤§é¢è®¢å•: &#34; + event.getOrderId());
    }
}
</code></pre><p>è¦ä½¿å¼‚æ­¥ç›‘å¬ç”Ÿæ•ˆï¼Œåˆ«å¿˜äº†åœ¨é…ç½®ç±»ä¸Šæ·»åŠ  <code>@EnableAsync</code>æ³¨è§£ã€‚</p><h3 id=-äº‹ä»¶ç±»å‹å†…ç½®ä¸è‡ªå®šä¹‰>ğŸ“š äº‹ä»¶ç±»å‹ï¼šå†…ç½®ä¸è‡ªå®šä¹‰</h3><h4 id=spring-å†…ç½®äº‹ä»¶>Spring å†…ç½®äº‹ä»¶</h4><p>Spring å®¹å™¨ä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒèŠ‚ç‚¹è‡ªåŠ¨å‘å¸ƒä»¥ä¸‹æ ¸å¿ƒäº‹ä»¶ï¼š</p><ul><li><strong><code>ContextRefreshedEvent</code></strong>ï¼šå½“ <code>ApplicationContext</code>è¢«åˆå§‹åŒ–æˆ–åˆ·æ–°ï¼ˆè°ƒç”¨ <code>refresh()</code>æ–¹æ³•ï¼‰æ—¶å‘å¸ƒã€‚æ­¤æ—¶æ‰€æœ‰å•ä¾‹ Bean å·²å®ä¾‹åŒ–å®Œæˆï¼Œæ˜¯è¿›è¡Œç¼“å­˜é¢„çƒ­æˆ–æ•°æ®é¢„åŠ è½½çš„ç†æƒ³æ—¶æœºã€‚</li><li><strong><code>ContextStartedEvent</code></strong>ï¼šå½“å®¹å™¨è°ƒç”¨ <code>start()</code>æ–¹æ³•æ—¶å‘å¸ƒï¼Œé€šå¸¸ç”¨äºé‡å¯å·²åœæ­¢çš„ Beanã€‚</li><li><strong><code>ContextStoppedEvent</code></strong>ï¼šå½“å®¹å™¨è°ƒç”¨ <code>stop()</code>æ–¹æ³•æ—¶å‘å¸ƒï¼Œç”¨äºåœæ­¢æ‰€æœ‰ Beanã€‚</li><li><strong><code>ContextClosedEvent</code></strong>ï¼šå½“ <code>ApplicationContext</code>è¢«å…³é—­æ—¶å‘å¸ƒã€‚å®¹å™¨å…³é—­åï¼Œå•ä¾‹ Bean ä¼šè¢«é”€æ¯ï¼Œè¿™æ˜¯è¿›è¡Œèµ„æºæ¸…ç†çš„ä¿¡å·ã€‚</li></ul><h4 id=åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶>åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶</h4><p>ä½ å¯ä»¥è½»æ¾å®šä¹‰è‡ªå·±çš„ä¸šåŠ¡äº‹ä»¶ã€‚ä» Spring 4.2 å¼€å§‹ï¼Œäº‹ä»¶ç±»ä¸å†éœ€è¦å¼ºåˆ¶ç»§æ‰¿ <code>ApplicationEvent</code>ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•æ™®é€š Java å¯¹è±¡ã€‚</p><pre tabindex=0><code>// è‡ªå®šä¹‰è®¢å•åˆ›å»ºäº‹ä»¶
public class OrderCreatedEvent {
    private String orderId;
    private BigDecimal amount;
    // æ„é€ æ–¹æ³•ã€getterã€setter...
}
</code></pre><h3 id=-å¦‚ä½•å‘å¸ƒäº‹ä»¶>ğŸš€ å¦‚ä½•å‘å¸ƒäº‹ä»¶</h3><p>åœ¨éœ€è¦è§¦å‘ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œä½ å¯ä»¥é€šè¿‡ <code>ApplicationEventPublisher</code>æ¥å‘å¸ƒäº‹ä»¶ã€‚ç”±äº <code>ApplicationContext</code>ä¹Ÿå®ç°äº†è¯¥æ¥å£ï¼Œä½ é€šå¸¸å¯ä»¥æ³¨å…¥å®ƒæ¥ä½¿ç”¨ã€‚</p><pre tabindex=0><code>import org.springframework.context.ApplicationEventPublisher;
import org.springframework.stereotype.Service;

@Service
public class OrderService {
    private final ApplicationEventPublisher eventPublisher;
    
    // é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥
    public OrderService(ApplicationEventPublisher eventPublisher) {
        this.eventPublisher = eventPublisher;
    }
    
    public Order createOrder(OrderRequest request) {
        // åˆ›å»ºè®¢å•çš„ä¸šåŠ¡é€»è¾‘...
        Order order = new Order(request);
        
        // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
        eventPublisher.publishEvent(new OrderCreatedEvent(order));
        
        return order;
    }
}
</code></pre><h3 id=-é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ>âš™ï¸ é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ</h3><ol><li><p><strong>å¼‚æ­¥äº‹ä»¶å¤„ç†</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶ç›‘å¬æ˜¯åŒæ­¥çš„ã€‚å¦‚æœä¸€ä¸ªç›‘å¬å™¨æ‰§è¡Œç¼“æ…¢ï¼Œä¼šé˜»å¡å‘å¸ƒçº¿ç¨‹å’Œåç»­ç›‘å¬å™¨ã€‚ä½¿ç”¨ <code>@Async</code>æ³¨è§£å¯ä»¥å®ç°å¼‚æ­¥å¤„ç†ï¼Œè¿™å¯¹äºå‘é€é‚®ä»¶ã€è®°å½•æ—¥å¿—ç­‰éæ ¸å¿ƒæˆ–è€—æ—¶æ“ä½œéå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>ç›‘å¬å™¨æ‰§è¡Œé¡ºåºæ§åˆ¶</strong></p><p>å½“å¤šä¸ªç›‘å¬å™¨ç›‘å¬åŒä¸€äº‹ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>@Order</code>æ³¨è§£æ¥æ§åˆ¶å®ƒä»¬çš„æ‰§è¡Œé¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚</p></li><li><p><strong>äº‹åŠ¡ç»‘å®šäº‹ä»¶</strong></p><p>Spring æä¾›äº† <code>@TransactionalEventListener</code>æ³¨è§£ï¼Œå®ƒå…è®¸ä½ å°†ç›‘å¬å™¨çš„æ‰§è¡Œä¸äº‹åŠ¡çš„ç‰¹å®šé˜¶æ®µï¼ˆå¦‚ AFTER_COMMITï¼‰ç»‘å®šï¼Œç¡®ä¿äº‹ä»¶å¤„ç†åªåœ¨äº‹åŠ¡æˆåŠŸæäº¤åå‘ç”Ÿã€‚</p></li><li><p><strong>æœ€ä½³å®è·µå»ºè®®</strong></p><ul><li><strong>ä¿æŒç›‘å¬å™¨è½»é‡çº§</strong>ï¼šé¿å…åœ¨ç›‘å¬å™¨ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œè‹¥æ— æ³•é¿å…ï¼ŒåŠ¡å¿…ä½¿ç”¨å¼‚æ­¥å¤„ç†ã€‚</li><li><strong>ä¿æŒæ— çŠ¶æ€</strong>ï¼šç›‘å¬å™¨åº”æ˜¯å•ä¾‹ä¸”æ— çŠ¶æ€çš„ï¼Œé¿å…åœ¨ç›‘å¬å™¨å†…éƒ¨ç»´æŠ¤æ˜“å˜çš„çŠ¶æ€ã€‚</li><li><strong>åšå¥½å¼‚å¸¸å¤„ç†</strong>ï¼šåœ¨ç›‘å¬å™¨å†…éƒ¨å¦¥å–„å¤„ç†å¼‚å¸¸ï¼Œé˜²æ­¢å¼‚å¸¸æ‰©æ•£å½±å“äº‹ä»¶å‘å¸ƒè€…æˆ–å…¶ä»–ç›‘å¬å™¨ã€‚</li><li><strong>äº‹ä»¶å‘½å</strong>ï¼šæ¨èä½¿ç”¨è¿‡å»æ—¶æ€å‘½åäº‹ä»¶ï¼ˆå¦‚ <code>OrderCreated</code>ï¼‰ï¼Œè¡¨æ˜å®ƒæ˜¯å·²å‘ç”Ÿçš„äº‹å®ã€‚</li></ul></li></ol><h3 id=-å¸¸è§é—®é¢˜æ’æŸ¥>âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥</h3><ul><li><strong>ç›‘å¬å™¨æœªè§¦å‘</strong>ï¼šæ£€æŸ¥ç›‘å¬å™¨æ˜¯å¦å·²æ˜¯ Spring Beanï¼ˆå¦‚æ·»åŠ äº† <code>@Component</code>ï¼‰ï¼›ç¡®è®¤äº‹ä»¶æ˜¯å¦æ­£ç¡®å‘å¸ƒï¼›æ£€æŸ¥äº‹ä»¶ç±»å‹æ˜¯å¦ä¸ç›‘å¬å™¨æ³›å‹æˆ–æ–¹æ³•å‚æ•°ç±»å‹åŒ¹é…ã€‚</li><li><strong>å¼‚æ­¥ç›‘å¬å™¨ä¸ç”Ÿæ•ˆ</strong>ï¼šæ£€æŸ¥æ˜¯å¦åœ¨é…ç½®ç±»ä¸Šæ·»åŠ äº† <code>@EnableAsync</code>æ³¨è§£ï¼Œå¹¶é…ç½®äº†åˆé€‚çš„çº¿ç¨‹æ± ã€‚</li><li><strong>äº‹åŠ¡äº‹ä»¶ç›‘å¬å™¨ä¸è§¦å‘</strong>ï¼šç¡®è®¤ä½¿ç”¨çš„æ˜¯ <code>@TransactionalEventListener</code>ï¼Œå¹¶æ£€æŸ¥ç›¸å…³äº‹åŠ¡æ˜¯å¦æˆåŠŸæäº¤æˆ–å›æ»šã€‚</li></ul><h3 id=-æ€»ç»“-4>ğŸ’ æ€»ç»“</h3><p><code>ApplicationListener</code>æ˜¯ Spring æ¡†æ¶ä¸­å®ç°æ¾è€¦åˆé€šä¿¡çš„å¼ºå¤§å·¥å…·ã€‚é€šè¿‡äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä½ å¯ä»¥å°†åº”ç”¨çš„ä¸åŒæ¨¡å—è§£è€¦ï¼Œä½¿ä»£ç æ›´åŠ çµæ´»ã€å¯æ‰©å±•å’Œæ˜“äºç»´æŠ¤ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ ç†è§£å’Œè¿ç”¨ <code>ApplicationListener</code>ã€‚å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“ç‰¹æ€§æˆ–ä½¿ç”¨åœºæ™¯æœ‰æ›´æ·±å…¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚</p><h2 id=configurableenvironment>ConfigurableEnvironment</h2><p>ConfigurableEnvironment æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºç¯å¢ƒé…ç½®çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒæä¾›äº†ç»Ÿä¸€çš„æœºåˆ¶æ¥ç®¡ç†å’Œè®¿é—®åº”ç”¨ç¨‹åºçš„å„ç§é…ç½®æ•°æ®ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†å’Œä¸»è¦èŒè´£ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ã€‚</p><div class=table-wrapper><table><thead><tr><th>æ¨¡å—/æ¥å£</th><th>æ ¸å¿ƒèŒè´£</th></tr></thead><tbody><tr><td><strong>Environment (çˆ¶æ¥å£)</strong></td><td>æä¾›å¯¹ç¯å¢ƒ<strong>åªè¯»è®¿é—®</strong>çš„åŸºæœ¬èƒ½åŠ›ï¼Œå¦‚è·å–å±æ€§ã€æ£€æŸ¥æ¿€æ´»çš„é…ç½®æ–‡ä»¶ï¼ˆProfileï¼‰ã€‚</td></tr><tr><td><strong>ConfigurablePropertyResolver (çˆ¶æ¥å£)</strong></td><td>æä¾›<strong>å±æ€§è§£æ</strong>çš„é«˜çº§é…ç½®èƒ½åŠ›ï¼ŒåŒ…æ‹¬ç±»å‹è½¬æ¢ã€å ä½ç¬¦å¤„ç†ã€å¿…éœ€å±æ€§éªŒè¯ç­‰ã€‚</td></tr><tr><td><strong>ConfigurableEnvironment (æœ¬ä½“)</strong></td><td><strong>ç»§æ‰¿å¹¶èåˆ</strong>ä¸Šè¿°ä¸¤è€…ï¼Œå¹¶å¢åŠ <strong>åŠ¨æ€é…ç½®</strong>èƒ½åŠ›ï¼Œå¦‚ç®¡ç†å±æ€§æºï¼ˆPropertySourcesï¼‰ã€è®¾ç½®æ´»åŠ¨/é»˜è®¤é…ç½®æ–‡ä»¶ç­‰ã€‚</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼>ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼</h3><p>ConfigurableEnvironment çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒå°†åº”ç”¨ç¨‹åºä¸å…·ä½“çš„è¿è¡Œç¯å¢ƒè§£è€¦ï¼Œä¸ºä½ æä¾›äº†ä¸€ä¸ªç»Ÿä¸€ä¸”å¼ºå¤§çš„é…ç½®ç®¡ç†å…¥å£ã€‚å®ƒçš„è®¾è®¡ä¸»è¦æœåŠ¡äºä¸¤ä¸ªå…³é”®æ–¹é¢ï¼š</p><ol><li><strong>é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</strong>ï¼šå®ç°<strong>ç¯å¢ƒéš”ç¦»</strong>ã€‚é€šè¿‡é¢„è®¾çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>dev</code>, <code>test</code>, <code>prod</code>ï¼‰ï¼Œä½ å¯ä»¥æ§åˆ¶ä¸åŒç¯å¢ƒä¸‹å“ªäº› Bean åº”è¯¥è¢«æ³¨å†Œï¼Œå“ªäº›é…ç½®åº”è¯¥ç”Ÿæ•ˆã€‚è¿™åœ¨ Spring ä¸­é€šå¸¸é€šè¿‡ <code>@Profile</code>æ³¨è§£æ¥å®ç°ã€‚</li><li><strong>å±æ€§ï¼ˆPropertiesï¼‰</strong>ï¼šå®ç°<strong>é…ç½®é›†ä¸­åŒ–ä¸å¤–éƒ¨åŒ–</strong>ã€‚å±æ€§å¯ä»¥æ¥æºäºå¤šç§æ¸ é“ï¼Œå¦‚ <code>.properties</code>/<code>.yml</code>æ–‡ä»¶ã€JVM ç³»ç»Ÿå±æ€§ã€æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ã€Servlet ä¸Šä¸‹æ–‡å‚æ•°ç­‰ã€‚ConfigurableEnvironment çš„ä½œç”¨å°±æ˜¯å°†è¿™äº›åˆ†æ•£çš„æ¥æºç»Ÿä¸€ç®¡ç†ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£æ¥è·å–å’Œè§£æè¿™äº›å±æ€§ã€‚</li></ol><h3 id=-æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•>âš™ï¸ æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•</h3><h4 id=1-ç®¡ç†é…ç½®æ–‡ä»¶profiles>1. ç®¡ç†é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</h4><p>é…ç½®æ–‡ä»¶å…è®¸ä½ æ ¹æ®ç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰æ¿€æ´»ä¸åŒçš„é…ç½®æˆ– Bean å®šä¹‰ã€‚</p><pre tabindex=0><code>// åˆ›å»ºç¯å¢ƒå®ä¾‹ï¼ˆåœ¨Spring Bootåº”ç”¨ä¸­ï¼Œé€šå¸¸é€šè¿‡æ³¨å…¥è·å–ï¼‰
ConfigurableEnvironment environment = new StandardEnvironment();

// 1. è®¾ç½®æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼ˆå°†æ›¿æ¢æ‰€æœ‰ç°æœ‰æ´»åŠ¨é…ç½®ï¼‰
environment.setActiveProfiles(&#34;dev&#34;, &#34;test&#34;);
// 2. æ·»åŠ æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼ˆåœ¨ç°æœ‰é…ç½®åŸºç¡€ä¸Šè¿½åŠ ï¼‰
environment.addActiveProfile(&#34;integration&#34;);
// 3. è®¾ç½®é»˜è®¤é…ç½®æ–‡ä»¶ï¼ˆå½“æ²¡æœ‰æ´»åŠ¨é…ç½®æ—¶ç”Ÿæ•ˆï¼‰
environment.setDefaultProfiles(&#34;default&#34;);

// æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
String[] activeProfiles = environment.getActiveProfiles(); // è·å–æ‰€æœ‰æ´»åŠ¨é…ç½®
boolean isTestActive = environment.acceptsProfiles(&#34;test&#34;); // æ£€æŸ¥ç‰¹å®šé…ç½®æ˜¯å¦æ¿€æ´»
</code></pre><p><strong>å…³é”®ç‚¹</strong>ï¼šè®¾ç½®æ´»åŠ¨æˆ–é»˜è®¤é…ç½®æ–‡ä»¶çš„æ“ä½œ<strong>å¿…é¡»åœ¨ Spring å®¹å™¨åˆ·æ–°ï¼ˆrefreshï¼‰ä¹‹å‰å®Œæˆ</strong>ï¼Œé€šå¸¸å¯ä»¥åœ¨ <code>ApplicationContextInitializer</code>ä¸­å®ç°ã€‚</p><h4 id=2-ç®¡ç†å±æ€§æºpropertysources>2. ç®¡ç†å±æ€§æºï¼ˆPropertySourcesï¼‰</h4><p>å±æ€§æºæ˜¯å®é™…å­˜å‚¨é…ç½®é”®å€¼å¯¹çš„è½½ä½“ã€‚ConfigurableEnvironment é€šè¿‡ <code>MutablePropertySources</code>å¯¹è±¡ç®¡ç†ä¸€ä¸ªå±æ€§æºåˆ—è¡¨ï¼Œæ­¤åˆ—è¡¨çš„<strong>é¡ºåºå†³å®šäº†å±æ€§æŸ¥æ‰¾çš„ä¼˜å…ˆçº§</strong>ï¼ˆè¶Šé å‰çš„æºä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚</p><pre tabindex=0><code>// è·å–å¯å˜çš„å±æ€§æºé›†åˆ
MutablePropertySources propertySources = environment.getPropertySources();

// ç¤ºä¾‹1ï¼šæ·»åŠ ä¸€ä¸ªæœ€é«˜ä¼˜å…ˆçº§çš„è‡ªå®šä¹‰å±æ€§æºï¼ˆé¦–å…ˆè¢«æŸ¥æ‰¾ï¼‰
Map&lt;String, Object&gt; customMap = new HashMap&lt;&gt;();
customMap.put(&#34;app.name&#34;, &#34;MyApp&#34;);
propertySources.addFirst(new MapPropertySource(&#34;myHighPrioritySource&#34;, customMap));

// ç¤ºä¾‹2ï¼šæ·»åŠ ä¸€ä¸ªæœ€ä½ä¼˜å…ˆçº§çš„å±æ€§æºï¼ˆæœ€åè¢«æŸ¥æ‰¾ï¼‰
propertySources.addLast(new MapPropertySource(&#34;myLowPrioritySource&#34;, anotherMap));

// ç¤ºä¾‹3ï¼šç§»é™¤ç³»ç»Ÿå±æ€§æºï¼ˆå¦‚ä¸å¸Œæœ›åº”ç”¨ç¨‹åºè®¿é—®JVMç³»ç»Ÿå±æ€§ï¼‰
propertySources.remove(StandardEnvironment.SYSTEM_PROPERTIES_PROPERTY_SOURCE_NAME);

// ç¤ºä¾‹4ï¼šåœ¨æŒ‡å®šå±æ€§æºä¹‹å‰æ’å…¥
propertySources.addBefore(&#34;systemEnvironmentSource&#34;, new MapPropertySource(&#34;mySource&#34;, myMap));
</code></pre><h4 id=3-å±æ€§è§£æä¸è·å–>3. å±æ€§è§£æä¸è·å–</h4><p>è¿™æ˜¯æœ€ç»ˆç›®çš„â€”â€”ä»ç¯å¢ƒä¸­è·å–ä½ éœ€è¦çš„é…ç½®å€¼ã€‚</p><pre tabindex=0><code>// 1. è·å–ç³»ç»Ÿå±æ€§ï¼ˆJVMçš„-Då‚æ•°ï¼‰å’Œç¯å¢ƒå˜é‡
Map&lt;String, Object&gt; systemProperties = environment.getSystemProperties();
Map&lt;String, Object&gt; systemEnvironment = environment.getSystemEnvironment();

// 2. è·å–ä»»æ„å±æ€§çš„å€¼ï¼ˆæœ€å¸¸ç”¨æ–¹æ³•ï¼‰
// ç®€å•è·å–ï¼Œä¸å­˜åœ¨åˆ™è¿”å›null
String appName = environment.getProperty(&#34;app.name&#34;);
// å¸¦é»˜è®¤å€¼çš„è·å–
String appNameWithDefault = environment.getProperty(&#34;app.name&#34;, &#34;DefaultApp&#34;);
// è·å–å¹¶è‡ªåŠ¨è½¬æ¢ä¸ºæŒ‡å®šç±»å‹
Integer serverPort = environment.getProperty(&#34;server.port&#34;, Integer.class, 8080);
// è·å–å¿…é¡»å­˜åœ¨çš„å±æ€§ï¼Œä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸
String requiredKey = environment.getRequiredProperty(&#34;required.key&#34;);

// 3. è§£æå ä½ç¬¦ ï¼ˆä¾‹å¦‚ï¼Œå±æ€§å€¼å¯èƒ½æ˜¯ &#34;${app.host:localhost}&#34; ï¼‰
String resolvedValue = environment.resolvePlaceholders(&#34;Base URL: ${app.url:http://default}&#34;);
</code></pre><h3 id=-ä¸»è¦å®ç°ç±»>ğŸ” ä¸»è¦å®ç°ç±»</h3><p>Spring ä¸ºä¸åŒçš„åº”ç”¨åœºæ™¯æä¾›äº†å…·ä½“çš„å®ç°ï¼š</p><div class=table-wrapper><table><thead><tr><th>å®ç°ç±»</th><th>é€‚ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong><code>StandardEnvironment</code></strong></td><td>æ ‡å‡†çš„ç‹¬ç«‹Javaåº”ç”¨ç¨‹åº</td><td>é»˜è®¤åŒ…å«<strong>ç³»ç»Ÿå±æ€§</strong>ï¼ˆ<code>systemProperties</code>ï¼‰å’Œ<strong>ç³»ç»Ÿç¯å¢ƒå˜é‡</strong>ï¼ˆ<code>systemEnvironment</code>ï¼‰ä¸¤ä¸ªå±æ€§æºã€‚</td></tr><tr><td><strong><code>StandardServletEnvironment</code></strong></td><td>Webåº”ç”¨ç¨‹åºï¼ˆåŸºäºServletï¼‰</td><td>ç»§æ‰¿è‡ª <code>StandardEnvironment</code>ï¼Œå¹¶é¢å¤–å¢åŠ äº† <strong><code>servletConfigInitParams</code></strong>ï¼ˆServleté…ç½®å‚æ•°ï¼‰å’Œ <strong><code>servletContextInitParams</code></strong>ï¼ˆServletä¸Šä¸‹æ–‡å‚æ•°ï¼‰ç­‰å±æ€§æºã€‚</td></tr><tr><td><strong><code>MockEnvironment</code></strong></td><td>å•å…ƒæµ‹è¯•</td><td>ç”¨äºæ¨¡æ‹Ÿç¯å¢ƒï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®¾ç½®å’Œæ“æ§å±æ€§ï¼Œè€Œä¸ä¾èµ–äºçœŸå®çš„ç³»ç»Ÿç¯å¢ƒã€‚</td></tr></tbody></table></div><h3 id=-å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ>ğŸ’» å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ</h3><h4 id=1-å¤šç¯å¢ƒé…ç½®>1. å¤šç¯å¢ƒé…ç½®</h4><p>è¿™æ˜¯ ConfigurableEnvironment æœ€ç»å…¸çš„åº”ç”¨ã€‚é€šè¿‡åœ¨ä»£ç ä¸­è®¾ç½®ä¸åŒçš„æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼Œæ¥åŠ è½½å¯¹åº”ç¯å¢ƒçš„é…ç½®ã€‚</p><pre tabindex=0><code>@Configuration
public class AppConfig {
    @Autowired
    private ConfigurableEnvironment environment;

    @Bean
    @Profile(&#34;dev&#34;) // æ­¤Beanä»…åœ¨ &#34;dev&#34; é…ç½®æ–‡ä»¶æ¿€æ´»æ—¶åˆ›å»º
    public DataSource devDataSource() {
        return new EmbeddedDatabaseBuilder().setType(EmbeddedDatabaseType.H2).build();
    }

    @Bean
    @Profile(&#34;prod&#34;) // æ­¤Beanä»…åœ¨ &#34;prod&#34; é…ç½®æ–‡ä»¶æ¿€æ´»æ—¶åˆ›å»º
    public DataSource prodDataSource() {
        // ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æºé…ç½®
        // å¯ä»¥ä»ç¯å¢ƒä¸­è¯»å–JDBC URLç­‰å‚æ•°
        String url = environment.getProperty(&#34;spring.datasource.url&#34;);
        // ... åˆ›å»ºå¹¶è¿”å›ç”Ÿäº§æ•°æ®æº
    }
}
</code></pre><h4 id=2-åŠ¨æ€é…ç½®æ›´æ–°>2. åŠ¨æ€é…ç½®æ›´æ–°</h4><p>åˆ©ç”¨å…¶å¯å˜çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œè¿™åœ¨å®ç°é…ç½®çƒ­åŠ è½½ç­‰é«˜çº§åŠŸèƒ½æ—¶éå¸¸æœ‰ç”¨ã€‚</p><pre tabindex=0><code>@Service
public class DynamicConfigService {
    @Autowired
    private ConfigurableEnvironment environment;

    public void updateProperty(String key, String value) {
        MutablePropertySources sources = environment.getPropertySources();
        // æŸ¥æ‰¾æˆ–åˆ›å»ºä¸€ä¸ªåä¸º&#34;dynamicSource&#34;çš„å¯å†™å±æ€§æº
        MapPropertySource dynamicSource = (MapPropertySource) sources.get(&#34;dynamicSource&#34;);
        if (dynamicSource == null) {
            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
            dynamicSource = new MapPropertySource(&#34;dynamicSource&#34;, map);
            sources.addFirst(dynamicSource); // æ·»åŠ åˆ°æœ€å‰ä»¥æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§
        }
        // æ›´æ–°å±æ€§
        dynamicSource.getSource().put(key, value);
        // æ³¨æ„ï¼šæ­¤æ“ä½œä¸ä¼šè‡ªåŠ¨æ›´æ–°å·²åˆå§‹åŒ–çš„å•ä¾‹Beanä¸­é€šè¿‡@Valueæ³¨å…¥çš„å€¼ï¼Œé€šå¸¸éœ€è¦é…åˆ@RefreshScopeç­‰æœºåˆ¶ã€‚
    }
}
</code></pre><h4 id=3-è‡ªå®šä¹‰å±æ€§æº>3. è‡ªå®šä¹‰å±æ€§æº</h4><p>ä½ å¯ä»¥é›†æˆä»»ä½•ä½ æƒ³è¦çš„é…ç½®æ¥æºï¼Œæ¯”å¦‚ä»æ•°æ®åº“ã€è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚Apolloã€Nacosï¼‰è¯»å–é…ç½®ã€‚</p><pre tabindex=0><code>// ä¸€ä¸ªç®€å•çš„ä»æ•°æ®åº“è¯»å–é…ç½®çš„å±æ€§æºç¤ºä¾‹
public class DatabasePropertySource extends PropertySource&lt;DataSource&gt; {
    public DatabasePropertySource(String name, DataSource dataSource) {
        super(name, dataSource);
    }
    @Override
    public Object getProperty(String key) {
        // å®ç°ä»æ•°æ®åº“æŸ¥è¯¢é…ç½®çš„é€»è¾‘
        try (Connection conn = getSource().getConnection();
             PreparedStatement stmt = conn.prepareStatement(&#34;SELECT value FROM config_table WHERE key = ?&#34;)) {
            stmt.setString(1, key);
            ResultSet rs = stmt.executeQuery();
            return rs.next() ? rs.getString(&#34;value&#34;) : null;
        } catch (SQLException e) {
            throw new RuntimeException(&#34;Failed to read property from database&#34;, e);
        }
    }
}
// æ³¨å†Œè‡ªå®šä¹‰å±æ€§æºï¼ˆé€šå¸¸åœ¨ApplicationContextInitializeræˆ–EnvironmentPostProcessorä¸­ï¼‰
environment.getPropertySources().addLast(new DatabasePropertySource(&#34;dbPropertySource&#34;, dataSource));
</code></pre><h3 id=-å¸¸è§é—®é¢˜ä¸æŠ€å·§>âš ï¸ å¸¸è§é—®é¢˜ä¸æŠ€å·§</h3><ul><li><strong>å±æ€§è¦†ç›–ä¸ä¼˜å…ˆçº§</strong>ï¼šç‰¢è®°å±æ€§æºçš„é¡ºåºå°±æ˜¯ä¼˜å…ˆçº§ã€‚å½“ä½ å‘ç°è·å–çš„å±æ€§å€¼ä¸æ˜¯é¢„æœŸå€¼æ—¶ï¼Œæ£€æŸ¥ä¸€ä¸‹å±æ€§æºçš„é¡ºåºï¼Œå¯èƒ½æ˜¯é«˜ä¼˜å…ˆçº§çš„æºè¦†ç›–äº†ä½ä¼˜å…ˆçº§æºçš„å€¼ã€‚</li><li><strong>é…ç½®ç”Ÿæ•ˆæ—¶æœº</strong>ï¼šåœ¨Spring Bootåº”ç”¨ä¸­ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ä»£ç ï¼ˆå¦‚<code>setActiveProfiles</code>ï¼‰è®¾ç½®é…ç½®æ–‡ä»¶ï¼ŒåŠ¡å¿…ç¡®ä¿è¯¥æ“ä½œåœ¨<code>ApplicationContext</code>çš„<code>refresh()</code>æ–¹æ³•è°ƒç”¨ä¹‹å‰å®Œæˆã€‚ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯å®ç°<code>ApplicationContextInitializer</code>ã€‚</li><li><strong>ä¸å ä½ç¬¦è§£æå™¨é…åˆ</strong>ï¼šè¦è®©<code>@Value("${property.name}")</code>è¿™æ ·çš„æ³¨è§£ç”Ÿæ•ˆï¼Œä½ éœ€è¦é…ç½®ä¸€ä¸ª<code>PropertySourcesPlaceholderConfigurer</code>ï¼Œå®ƒä¼šåˆ©ç”¨ConfigurableEnvironmentæ¥è§£æå ä½ç¬¦ã€‚</li></ul><h3 id=-æ€»ç»“-5>ğŸ’ æ€»ç»“</h3><p>ConfigurableEnvironment æ˜¯ Spring æ¡†æ¶ç¯å¢ƒæŠ½è±¡çš„æ ¸å¿ƒã€‚å®ƒé€šè¿‡<strong>å±æ€§æºï¼ˆPropertySourcesï¼‰<strong>å’Œ</strong>é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</strong> è¿™ä¸¤å¤§æ”¯æŸ±ï¼Œä¸ºä½ æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„é…ç½®ç®¡ç†èƒ½åŠ›ã€‚æ— è®ºæ˜¯å¤„ç†ç®€å•çš„å¤šç¯å¢ƒé…ç½®ï¼Œè¿˜æ˜¯å®ç°å¤æ‚çš„åŠ¨æ€é…ç½®æ›´æ–°å’Œè‡ªå®šä¹‰é…ç½®æºï¼Œç†è§£å¹¶å–„ç”¨ ConfigurableEnvironment éƒ½æ˜¯å…³é”®ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£å¹¶åœ¨å®é™…é¡¹ç›®ä¸­æœ‰æ•ˆè¿ç”¨ ConfigurableEnvironmentã€‚</p><h2 id=startup>StartUp</h2><p>ConfigurableEnvironment æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºç¯å¢ƒé…ç½®çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒæä¾›äº†ç»Ÿä¸€çš„æœºåˆ¶æ¥ç®¡ç†å’Œè®¿é—®åº”ç”¨ç¨‹åºçš„å„ç§é…ç½®æ•°æ®ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†å’Œä¸»è¦èŒè´£ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ã€‚</p><div class=table-wrapper><table><thead><tr><th>æ¨¡å—/æ¥å£</th><th>æ ¸å¿ƒèŒè´£</th></tr></thead><tbody><tr><td><strong>Environment (çˆ¶æ¥å£)</strong></td><td>æä¾›å¯¹ç¯å¢ƒ<strong>åªè¯»è®¿é—®</strong>çš„åŸºæœ¬èƒ½åŠ›ï¼Œå¦‚è·å–å±æ€§ã€æ£€æŸ¥æ¿€æ´»çš„é…ç½®æ–‡ä»¶ï¼ˆProfileï¼‰ã€‚</td></tr><tr><td><strong>ConfigurablePropertyResolver (çˆ¶æ¥å£)</strong></td><td>æä¾›<strong>å±æ€§è§£æ</strong>çš„é«˜çº§é…ç½®èƒ½åŠ›ï¼ŒåŒ…æ‹¬ç±»å‹è½¬æ¢ã€å ä½ç¬¦å¤„ç†ã€å¿…éœ€å±æ€§éªŒè¯ç­‰ã€‚</td></tr><tr><td><strong>ConfigurableEnvironment (æœ¬ä½“)</strong></td><td><strong>ç»§æ‰¿å¹¶èåˆ</strong>ä¸Šè¿°ä¸¤è€…ï¼Œå¹¶å¢åŠ <strong>åŠ¨æ€é…ç½®</strong>èƒ½åŠ›ï¼Œå¦‚ç®¡ç†å±æ€§æºï¼ˆPropertySourcesï¼‰ã€è®¾ç½®æ´»åŠ¨/é»˜è®¤é…ç½®æ–‡ä»¶ç­‰ã€‚</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼-1>ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼</h3><p>ConfigurableEnvironment çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒå°†åº”ç”¨ç¨‹åºä¸å…·ä½“çš„è¿è¡Œç¯å¢ƒè§£è€¦ï¼Œä¸ºä½ æä¾›äº†ä¸€ä¸ªç»Ÿä¸€ä¸”å¼ºå¤§çš„é…ç½®ç®¡ç†å…¥å£ã€‚å®ƒçš„è®¾è®¡ä¸»è¦æœåŠ¡äºä¸¤ä¸ªå…³é”®æ–¹é¢ï¼š</p><ol><li><strong>é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</strong>ï¼šå®ç°<strong>ç¯å¢ƒéš”ç¦»</strong>ã€‚é€šè¿‡é¢„è®¾çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>dev</code>, <code>test</code>, <code>prod</code>ï¼‰ï¼Œä½ å¯ä»¥æ§åˆ¶ä¸åŒç¯å¢ƒä¸‹å“ªäº› Bean åº”è¯¥è¢«æ³¨å†Œï¼Œå“ªäº›é…ç½®åº”è¯¥ç”Ÿæ•ˆã€‚è¿™åœ¨ Spring ä¸­é€šå¸¸é€šè¿‡ <code>@Profile</code>æ³¨è§£æ¥å®ç°ã€‚</li><li><strong>å±æ€§ï¼ˆPropertiesï¼‰</strong>ï¼šå®ç°<strong>é…ç½®é›†ä¸­åŒ–ä¸å¤–éƒ¨åŒ–</strong>ã€‚å±æ€§å¯ä»¥æ¥æºäºå¤šç§æ¸ é“ï¼Œå¦‚ <code>.properties</code>/<code>.yml</code>æ–‡ä»¶ã€JVM ç³»ç»Ÿå±æ€§ã€æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ã€Servlet ä¸Šä¸‹æ–‡å‚æ•°ç­‰ã€‚ConfigurableEnvironment çš„ä½œç”¨å°±æ˜¯å°†è¿™äº›åˆ†æ•£çš„æ¥æºç»Ÿä¸€ç®¡ç†ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£æ¥è·å–å’Œè§£æè¿™äº›å±æ€§ã€‚</li></ol><h3 id=-æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•-1>âš™ï¸ æ ¸å¿ƒæ“ä½œä¸ä½¿ç”¨æ–¹æ³•</h3><h4 id=1-ç®¡ç†é…ç½®æ–‡ä»¶profiles-1>1. ç®¡ç†é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</h4><p>é…ç½®æ–‡ä»¶å…è®¸ä½ æ ¹æ®ç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰æ¿€æ´»ä¸åŒçš„é…ç½®æˆ– Bean å®šä¹‰ã€‚</p><pre tabindex=0><code>// åˆ›å»ºç¯å¢ƒå®ä¾‹ï¼ˆåœ¨Spring Bootåº”ç”¨ä¸­ï¼Œé€šå¸¸é€šè¿‡æ³¨å…¥è·å–ï¼‰
ConfigurableEnvironment environment = new StandardEnvironment();

// 1. è®¾ç½®æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼ˆå°†æ›¿æ¢æ‰€æœ‰ç°æœ‰æ´»åŠ¨é…ç½®ï¼‰
environment.setActiveProfiles(&#34;dev&#34;, &#34;test&#34;);
// 2. æ·»åŠ æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼ˆåœ¨ç°æœ‰é…ç½®åŸºç¡€ä¸Šè¿½åŠ ï¼‰
environment.addActiveProfile(&#34;integration&#34;);
// 3. è®¾ç½®é»˜è®¤é…ç½®æ–‡ä»¶ï¼ˆå½“æ²¡æœ‰æ´»åŠ¨é…ç½®æ—¶ç”Ÿæ•ˆï¼‰
environment.setDefaultProfiles(&#34;default&#34;);

// æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
String[] activeProfiles = environment.getActiveProfiles(); // è·å–æ‰€æœ‰æ´»åŠ¨é…ç½®
boolean isTestActive = environment.acceptsProfiles(&#34;test&#34;); // æ£€æŸ¥ç‰¹å®šé…ç½®æ˜¯å¦æ¿€æ´»
</code></pre><p><strong>å…³é”®ç‚¹</strong>ï¼šè®¾ç½®æ´»åŠ¨æˆ–é»˜è®¤é…ç½®æ–‡ä»¶çš„æ“ä½œ<strong>å¿…é¡»åœ¨ Spring å®¹å™¨åˆ·æ–°ï¼ˆrefreshï¼‰ä¹‹å‰å®Œæˆ</strong>ï¼Œé€šå¸¸å¯ä»¥åœ¨ <code>ApplicationContextInitializer</code>ä¸­å®ç°ã€‚</p><h4 id=2-ç®¡ç†å±æ€§æºpropertysources-1>2. ç®¡ç†å±æ€§æºï¼ˆPropertySourcesï¼‰</h4><p>å±æ€§æºæ˜¯å®é™…å­˜å‚¨é…ç½®é”®å€¼å¯¹çš„è½½ä½“ã€‚ConfigurableEnvironment é€šè¿‡ <code>MutablePropertySources</code>å¯¹è±¡ç®¡ç†ä¸€ä¸ªå±æ€§æºåˆ—è¡¨ï¼Œæ­¤åˆ—è¡¨çš„<strong>é¡ºåºå†³å®šäº†å±æ€§æŸ¥æ‰¾çš„ä¼˜å…ˆçº§</strong>ï¼ˆè¶Šé å‰çš„æºä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚</p><pre tabindex=0><code>// è·å–å¯å˜çš„å±æ€§æºé›†åˆ
MutablePropertySources propertySources = environment.getPropertySources();

// ç¤ºä¾‹1ï¼šæ·»åŠ ä¸€ä¸ªæœ€é«˜ä¼˜å…ˆçº§çš„è‡ªå®šä¹‰å±æ€§æºï¼ˆé¦–å…ˆè¢«æŸ¥æ‰¾ï¼‰
Map&lt;String, Object&gt; customMap = new HashMap&lt;&gt;();
customMap.put(&#34;app.name&#34;, &#34;MyApp&#34;);
propertySources.addFirst(new MapPropertySource(&#34;myHighPrioritySource&#34;, customMap));

// ç¤ºä¾‹2ï¼šæ·»åŠ ä¸€ä¸ªæœ€ä½ä¼˜å…ˆçº§çš„å±æ€§æºï¼ˆæœ€åè¢«æŸ¥æ‰¾ï¼‰
propertySources.addLast(new MapPropertySource(&#34;myLowPrioritySource&#34;, anotherMap));

// ç¤ºä¾‹3ï¼šç§»é™¤ç³»ç»Ÿå±æ€§æºï¼ˆå¦‚ä¸å¸Œæœ›åº”ç”¨ç¨‹åºè®¿é—®JVMç³»ç»Ÿå±æ€§ï¼‰
propertySources.remove(StandardEnvironment.SYSTEM_PROPERTIES_PROPERTY_SOURCE_NAME);

// ç¤ºä¾‹4ï¼šåœ¨æŒ‡å®šå±æ€§æºä¹‹å‰æ’å…¥
propertySources.addBefore(&#34;systemEnvironmentSource&#34;, new MapPropertySource(&#34;mySource&#34;, myMap));
</code></pre><h4 id=3-å±æ€§è§£æä¸è·å–-1>3. å±æ€§è§£æä¸è·å–</h4><p>è¿™æ˜¯æœ€ç»ˆç›®çš„â€”â€”ä»ç¯å¢ƒä¸­è·å–ä½ éœ€è¦çš„é…ç½®å€¼ã€‚</p><pre tabindex=0><code>// 1. è·å–ç³»ç»Ÿå±æ€§ï¼ˆJVMçš„-Då‚æ•°ï¼‰å’Œç¯å¢ƒå˜é‡
Map&lt;String, Object&gt; systemProperties = environment.getSystemProperties();
Map&lt;String, Object&gt; systemEnvironment = environment.getSystemEnvironment();

// 2. è·å–ä»»æ„å±æ€§çš„å€¼ï¼ˆæœ€å¸¸ç”¨æ–¹æ³•ï¼‰
// ç®€å•è·å–ï¼Œä¸å­˜åœ¨åˆ™è¿”å›null
String appName = environment.getProperty(&#34;app.name&#34;);
// å¸¦é»˜è®¤å€¼çš„è·å–
String appNameWithDefault = environment.getProperty(&#34;app.name&#34;, &#34;DefaultApp&#34;);
// è·å–å¹¶è‡ªåŠ¨è½¬æ¢ä¸ºæŒ‡å®šç±»å‹
Integer serverPort = environment.getProperty(&#34;server.port&#34;, Integer.class, 8080);
// è·å–å¿…é¡»å­˜åœ¨çš„å±æ€§ï¼Œä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸
String requiredKey = environment.getRequiredProperty(&#34;required.key&#34;);

// 3. è§£æå ä½ç¬¦ ï¼ˆä¾‹å¦‚ï¼Œå±æ€§å€¼å¯èƒ½æ˜¯ &#34;${app.host:localhost}&#34; ï¼‰
String resolvedValue = environment.resolvePlaceholders(&#34;Base URL: ${app.url:http://default}&#34;);
</code></pre><h3 id=-ä¸»è¦å®ç°ç±»-1>ğŸ” ä¸»è¦å®ç°ç±»</h3><p>Spring ä¸ºä¸åŒçš„åº”ç”¨åœºæ™¯æä¾›äº†å…·ä½“çš„å®ç°ï¼š</p><div class=table-wrapper><table><thead><tr><th>å®ç°ç±»</th><th>é€‚ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong><code>StandardEnvironment</code></strong></td><td>æ ‡å‡†çš„ç‹¬ç«‹Javaåº”ç”¨ç¨‹åº</td><td>é»˜è®¤åŒ…å«<strong>ç³»ç»Ÿå±æ€§</strong>ï¼ˆ<code>systemProperties</code>ï¼‰å’Œ<strong>ç³»ç»Ÿç¯å¢ƒå˜é‡</strong>ï¼ˆ<code>systemEnvironment</code>ï¼‰ä¸¤ä¸ªå±æ€§æºã€‚</td></tr><tr><td><strong><code>StandardServletEnvironment</code></strong></td><td>Webåº”ç”¨ç¨‹åºï¼ˆåŸºäºServletï¼‰</td><td>ç»§æ‰¿è‡ª <code>StandardEnvironment</code>ï¼Œå¹¶é¢å¤–å¢åŠ äº† <strong><code>servletConfigInitParams</code></strong>ï¼ˆServleté…ç½®å‚æ•°ï¼‰å’Œ <strong><code>servletContextInitParams</code></strong>ï¼ˆServletä¸Šä¸‹æ–‡å‚æ•°ï¼‰ç­‰å±æ€§æºã€‚</td></tr><tr><td><strong><code>MockEnvironment</code></strong></td><td>å•å…ƒæµ‹è¯•</td><td>ç”¨äºæ¨¡æ‹Ÿç¯å¢ƒï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®¾ç½®å’Œæ“æ§å±æ€§ï¼Œè€Œä¸ä¾èµ–äºçœŸå®çš„ç³»ç»Ÿç¯å¢ƒã€‚</td></tr></tbody></table></div><h3 id=-å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ-1>ğŸ’» å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ</h3><h4 id=1-å¤šç¯å¢ƒé…ç½®-1>1. å¤šç¯å¢ƒé…ç½®</h4><p>è¿™æ˜¯ ConfigurableEnvironment æœ€ç»å…¸çš„åº”ç”¨ã€‚é€šè¿‡åœ¨ä»£ç ä¸­è®¾ç½®ä¸åŒçš„æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼Œæ¥åŠ è½½å¯¹åº”ç¯å¢ƒçš„é…ç½®ã€‚</p><pre tabindex=0><code>@Configuration
public class AppConfig {
    @Autowired
    private ConfigurableEnvironment environment;

    @Bean
    @Profile(&#34;dev&#34;) // æ­¤Beanä»…åœ¨ &#34;dev&#34; é…ç½®æ–‡ä»¶æ¿€æ´»æ—¶åˆ›å»º
    public DataSource devDataSource() {
        return new EmbeddedDatabaseBuilder().setType(EmbeddedDatabaseType.H2).build();
    }

    @Bean
    @Profile(&#34;prod&#34;) // æ­¤Beanä»…åœ¨ &#34;prod&#34; é…ç½®æ–‡ä»¶æ¿€æ´»æ—¶åˆ›å»º
    public DataSource prodDataSource() {
        // ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æºé…ç½®
        // å¯ä»¥ä»ç¯å¢ƒä¸­è¯»å–JDBC URLç­‰å‚æ•°
        String url = environment.getProperty(&#34;spring.datasource.url&#34;);
        // ... åˆ›å»ºå¹¶è¿”å›ç”Ÿäº§æ•°æ®æº
    }
}
</code></pre><h4 id=2-åŠ¨æ€é…ç½®æ›´æ–°-1>2. åŠ¨æ€é…ç½®æ›´æ–°</h4><p>åˆ©ç”¨å…¶å¯å˜çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œè¿™åœ¨å®ç°é…ç½®çƒ­åŠ è½½ç­‰é«˜çº§åŠŸèƒ½æ—¶éå¸¸æœ‰ç”¨ã€‚</p><pre tabindex=0><code>@Service
public class DynamicConfigService {
    @Autowired
    private ConfigurableEnvironment environment;

    public void updateProperty(String key, String value) {
        MutablePropertySources sources = environment.getPropertySources();
        // æŸ¥æ‰¾æˆ–åˆ›å»ºä¸€ä¸ªåä¸º&#34;dynamicSource&#34;çš„å¯å†™å±æ€§æº
        MapPropertySource dynamicSource = (MapPropertySource) sources.get(&#34;dynamicSource&#34;);
        if (dynamicSource == null) {
            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
            dynamicSource = new MapPropertySource(&#34;dynamicSource&#34;, map);
            sources.addFirst(dynamicSource); // æ·»åŠ åˆ°æœ€å‰ä»¥æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§
        }
        // æ›´æ–°å±æ€§
        dynamicSource.getSource().put(key, value);
        // æ³¨æ„ï¼šæ­¤æ“ä½œä¸ä¼šè‡ªåŠ¨æ›´æ–°å·²åˆå§‹åŒ–çš„å•ä¾‹Beanä¸­é€šè¿‡@Valueæ³¨å…¥çš„å€¼ï¼Œé€šå¸¸éœ€è¦é…åˆ@RefreshScopeç­‰æœºåˆ¶ã€‚
    }
}
</code></pre><h4 id=3-è‡ªå®šä¹‰å±æ€§æº-1>3. è‡ªå®šä¹‰å±æ€§æº</h4><p>ä½ å¯ä»¥é›†æˆä»»ä½•ä½ æƒ³è¦çš„é…ç½®æ¥æºï¼Œæ¯”å¦‚ä»æ•°æ®åº“ã€è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚Apolloã€Nacosï¼‰è¯»å–é…ç½®ã€‚</p><pre tabindex=0><code>// ä¸€ä¸ªç®€å•çš„ä»æ•°æ®åº“è¯»å–é…ç½®çš„å±æ€§æºç¤ºä¾‹
public class DatabasePropertySource extends PropertySource&lt;DataSource&gt; {
    public DatabasePropertySource(String name, DataSource dataSource) {
        super(name, dataSource);
    }
    @Override
    public Object getProperty(String key) {
        // å®ç°ä»æ•°æ®åº“æŸ¥è¯¢é…ç½®çš„é€»è¾‘
        try (Connection conn = getSource().getConnection();
             PreparedStatement stmt = conn.prepareStatement(&#34;SELECT value FROM config_table WHERE key = ?&#34;)) {
            stmt.setString(1, key);
            ResultSet rs = stmt.executeQuery();
            return rs.next() ? rs.getString(&#34;value&#34;) : null;
        } catch (SQLException e) {
            throw new RuntimeException(&#34;Failed to read property from database&#34;, e);
        }
    }
}
// æ³¨å†Œè‡ªå®šä¹‰å±æ€§æºï¼ˆé€šå¸¸åœ¨ApplicationContextInitializeræˆ–EnvironmentPostProcessorä¸­ï¼‰
environment.getPropertySources().addLast(new DatabasePropertySource(&#34;dbPropertySource&#34;, dataSource));
</code></pre><h3 id=-å¸¸è§é—®é¢˜ä¸æŠ€å·§-1>âš ï¸ å¸¸è§é—®é¢˜ä¸æŠ€å·§</h3><ul><li><strong>å±æ€§è¦†ç›–ä¸ä¼˜å…ˆçº§</strong>ï¼šç‰¢è®°å±æ€§æºçš„é¡ºåºå°±æ˜¯ä¼˜å…ˆçº§ã€‚å½“ä½ å‘ç°è·å–çš„å±æ€§å€¼ä¸æ˜¯é¢„æœŸå€¼æ—¶ï¼Œæ£€æŸ¥ä¸€ä¸‹å±æ€§æºçš„é¡ºåºï¼Œå¯èƒ½æ˜¯é«˜ä¼˜å…ˆçº§çš„æºè¦†ç›–äº†ä½ä¼˜å…ˆçº§æºçš„å€¼ã€‚</li><li><strong>é…ç½®ç”Ÿæ•ˆæ—¶æœº</strong>ï¼šåœ¨Spring Bootåº”ç”¨ä¸­ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ä»£ç ï¼ˆå¦‚<code>setActiveProfiles</code>ï¼‰è®¾ç½®é…ç½®æ–‡ä»¶ï¼ŒåŠ¡å¿…ç¡®ä¿è¯¥æ“ä½œåœ¨<code>ApplicationContext</code>çš„<code>refresh()</code>æ–¹æ³•è°ƒç”¨ä¹‹å‰å®Œæˆã€‚ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯å®ç°<code>ApplicationContextInitializer</code>ã€‚</li><li><strong>ä¸å ä½ç¬¦è§£æå™¨é…åˆ</strong>ï¼šè¦è®©<code>@Value("${property.name}")</code>è¿™æ ·çš„æ³¨è§£ç”Ÿæ•ˆï¼Œä½ éœ€è¦é…ç½®ä¸€ä¸ª<code>PropertySourcesPlaceholderConfigurer</code>ï¼Œå®ƒä¼šåˆ©ç”¨ConfigurableEnvironmentæ¥è§£æå ä½ç¬¦ã€‚</li></ul><h3 id=-æ€»ç»“-6>ğŸ’ æ€»ç»“</h3><p>ConfigurableEnvironment æ˜¯ Spring æ¡†æ¶ç¯å¢ƒæŠ½è±¡çš„æ ¸å¿ƒã€‚å®ƒé€šè¿‡<strong>å±æ€§æºï¼ˆPropertySourcesï¼‰<strong>å’Œ</strong>é…ç½®æ–‡ä»¶ï¼ˆProfilesï¼‰</strong> è¿™ä¸¤å¤§æ”¯æŸ±ï¼Œä¸ºä½ æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„é…ç½®ç®¡ç†èƒ½åŠ›ã€‚æ— è®ºæ˜¯å¤„ç†ç®€å•çš„å¤šç¯å¢ƒé…ç½®ï¼Œè¿˜æ˜¯å®ç°å¤æ‚çš„åŠ¨æ€é…ç½®æ›´æ–°å’Œè‡ªå®šä¹‰é…ç½®æºï¼Œç†è§£å¹¶å–„ç”¨ ConfigurableEnvironment éƒ½æ˜¯å…³é”®ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£å¹¶åœ¨å®é™…é¡¹ç›®ä¸­æœ‰æ•ˆè¿ç”¨ ConfigurableEnvironmentã€‚</p><h2 id=applicationcontextfactory>ApplicationContextFactory</h2><p><code>ApplicationContextFactory</code>æ˜¯ Spring Boot ä¸­ä¸€ä¸ªè´Ÿè´£<strong>æ ¹æ®åº”ç”¨ç±»å‹åˆ›å»ºç›¸åº”åº”ç”¨ä¸Šä¸‹æ–‡</strong>çš„æ ¸å¿ƒå·¥å‚æ¥å£ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº†å®ƒçš„æ ¸å¿ƒä¿¡æ¯ï¼š</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>ç‰¹æ€§ç»´åº¦</th><th style=text-align:left>æ ¸å¿ƒè¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:left><strong>è®¾è®¡ç›®æ ‡</strong></td><td style=text-align:left>æ ¹æ® <code>WebApplicationType</code> åˆ›å»ºé€‚åˆçš„ <code>ConfigurableApplicationContext</code>ï¼Œå®ç°åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºçš„<strong>è§£è€¦</strong>ä¸<strong>å¯æ‰©å±•</strong></td></tr><tr><td style=text-align:left><strong>æ ¸å¿ƒæ–¹æ³•</strong></td><td style=text-align:left><code>ConfigurableApplicationContext create(WebApplicationType webApplicationType)</code></td></tr><tr><td style=text-align:left><strong>é»˜è®¤å®ç°</strong></td><td style=text-align:left><code>DefaultApplicationContextFactory</code>ï¼Œé€šè¿‡ SPI æœºåˆ¶ä» <code>spring.factories</code> åŠ è½½å€™é€‰å·¥å‚</td></tr><tr><td style=text-align:left><strong>å†…ç½®å·¥å‚</strong></td><td style=text-align:left><code>AnnotationConfigServletWebServerApplicationContext.Factory</code>ï¼ˆServlet Webåº”ç”¨ï¼‰ã€<code>AnnotationConfigReactiveWebServerApplicationContext.Factory</code>ï¼ˆReactive Webåº”ç”¨ï¼‰ç­‰</td></tr><tr><td style=text-align:left><strong>æ‰©å±•æ–¹å¼</strong></td><td style=text-align:left>å®ç° <code>ApplicationContextFactory</code> æ¥å£ï¼Œå¹¶åœ¨ <code>META-INF/spring.factories</code> ä¸­æ³¨å†Œ</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒåŠŸèƒ½ä¸æ¥å£è®¾è®¡>ğŸ”§ æ ¸å¿ƒåŠŸèƒ½ä¸æ¥å£è®¾è®¡</h3><p><code>ApplicationContextFactory</code>æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå…¶æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>create</code>ï¼Œå®ƒæ ¹æ®ä¼ å…¥çš„ <code>WebApplicationType</code>ï¼ˆå¦‚ <code>SERVLET</code>ã€<code>REACTIVE</code>æˆ– <code>NONE</code>ï¼‰æ¥åˆ›å»ºå¯¹åº”çš„ <code>ConfigurableApplicationContext</code>å®ä¾‹ã€‚</p><p>é™¤äº†åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œè¯¥æ¥å£è¿˜æä¾›äº†è·å–å’Œåˆ›å»º <code>ConfigurableEnvironment</code>ï¼ˆç¯å¢ƒï¼‰çš„é»˜è®¤æ–¹æ³•ï¼Œä½“ç°äº†ç¯å¢ƒä¸ä¸Šä¸‹æ–‡ç±»å‹çš„å…³è”æ€§ã€‚</p><h3 id=-é»˜è®¤å®ç°ä¸åˆ›å»ºæµç¨‹>ğŸ“œ é»˜è®¤å®ç°ä¸åˆ›å»ºæµç¨‹</h3><p>Spring Boot çš„é»˜è®¤åˆ›å»ºé€»è¾‘ä¸»è¦ç”± <code>DefaultApplicationContextFactory</code>æ‰¿æ‹…ã€‚</p><ol><li><strong>SPIæœºåˆ¶åŠ è½½</strong>ï¼š<code>DefaultApplicationContextFactory</code>ä¼šé€šè¿‡ <code>SpringFactoriesLoader</code>ä»ç±»è·¯å¾„ä¸‹æ‰€æœ‰ <code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­åŠ è½½ <code>ApplicationContextFactory</code>çš„å®ç°ç±»ã€‚ åœ¨ Spring Boot ä¸­ï¼Œé»˜è®¤ä¼šåŠ è½½ <code>AnnotationConfigServletWebServerApplicationContext.Factory</code>å’Œ <code>AnnotationConfigReactiveWebServerApplicationContext.Factory</code>ç­‰å€™é€‰å·¥å‚ã€‚</li><li><strong>éå†å€™é€‰å·¥å‚</strong>ï¼šæ ¹æ® <code>WebApplicationType</code>ï¼ŒæŒ‰é¡ºåºè°ƒç”¨æ¯ä¸ªå€™é€‰å·¥å‚çš„ <code>create</code>æ–¹æ³•ã€‚ä¸€æ—¦æŸä¸ªå·¥å‚è¿”å›äº†éç©ºçš„ <code>ConfigurableApplicationContext</code>ï¼Œå°±å°†å…¶ä½œä¸ºç»“æœè¿”å›ã€‚</li><li><strong>é»˜è®¤é™çº§ç­–ç•¥</strong>ï¼šå¦‚æœæ‰€æœ‰å€™é€‰å·¥å‚éƒ½æ— æ³•åˆ›å»ºåˆé€‚çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ <code>AnnotationConfigApplicationContext::new</code>ä½œä¸ºé™çº§æ–¹æ¡ˆã€‚</li></ol><p>ä¾‹å¦‚ï¼Œå¯¹äº <code>WebApplicationType.SERVLET</code>ç±»å‹ï¼Œæœ€ç»ˆä¼šç”± <code>ServletWebServerApplicationContextFactory</code>åˆ›å»º <code>AnnotationConfigServletWebServerApplicationContext</code>å®ä¾‹ã€‚ åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œä¼šåŒæ—¶åˆå§‹åŒ– IoC å®¹å™¨ï¼ˆå¦‚ <code>DefaultListableBeanFactory</code>ï¼‰å’Œå¿…è¦çš„ Bean åç½®å¤„ç†å™¨ï¼ˆå¦‚ <code>ConfigurationClassPostProcessor</code>ï¼‰ã€‚</p><h3 id=-å†…ç½®çš„-applicationcontext-ç±»å‹>ğŸŒ å†…ç½®çš„ ApplicationContext ç±»å‹</h3><p>Spring Boot ä¸ºä¸åŒçš„åº”ç”¨æ¨¡å¼æä¾›äº†ç›¸åº”çš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§ç±»å‹åŠå…¶å¯¹åº”çš„å·¥å‚ï¼š</p><div class=table-wrapper><table><thead><tr><th>åº”ç”¨ç±»å‹</th><th>åº”ç”¨ä¸Šä¸‹æ–‡å®ç°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Servlet Web åº”ç”¨</strong></td><td><code>AnnotationConfigServletWebServerApplicationContext</code></td><td>æ”¯æŒæ³¨è§£é…ç½®ï¼Œå†…åµŒ Servlet Web æœåŠ¡å™¨ã€‚</td></tr><tr><td><strong>Reactive Web åº”ç”¨</strong></td><td><code>AnnotationConfigReactiveWebServerApplicationContext</code></td><td>æ”¯æŒæ³¨è§£é…ç½®ï¼Œç”¨äºå“åº”å¼ Web åº”ç”¨ã€‚</td></tr><tr><td><strong>é Web åº”ç”¨</strong></td><td><code>AnnotationConfigApplicationContext</code></td><td>æ ‡å‡†çš„æ³¨è§£é…ç½®åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œé€‚ç”¨äºæ§åˆ¶å°åº”ç”¨ç­‰ã€‚</td></tr></tbody></table></div><h3 id=-å¦‚ä½•è‡ªå®šä¹‰ä¸æ‰©å±•>ğŸ› ï¸ å¦‚ä½•è‡ªå®šä¹‰ä¸æ‰©å±•</h3><p>ä½ å¯ä»¥é€šè¿‡å®ç°è‡ªå·±çš„ <code>ApplicationContextFactory</code>æ¥å®Œå…¨æ§åˆ¶åº”ç”¨ä¸Šä¸‹æ–‡çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><ol><li><strong>å®ç°æ¥å£</strong>ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç° <code>ApplicationContextFactory</code>æ¥å£ã€‚</li><li><strong>æ³¨å†Œå®ç°</strong>ï¼šåœ¨ <code>src/main/resources/META-INF/spring.factories</code>æ–‡ä»¶ä¸­å£°æ˜ä½ çš„å®ç°ç±»ã€‚</li></ol><pre tabindex=0><code>org.springframework.boot.ApplicationContextFactory=com.example.MyCustomApplicationContextFactory
</code></pre><p>Spring Boot çš„ <code>ApplicationContextFactory</code>ä¹Ÿæä¾›äº†ä¾¿æ·çš„é™æ€å·¥å‚æ–¹æ³•ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºåŸºäºç‰¹å®šç±»æˆ–ä¾›åº”å•†çš„å·¥å‚ï¼š</p><ul><li><code>ApplicationContextFactory ofContextClass(Class&lt;? extends ConfigurableApplicationContext> contextClass)</code></li><li><code>ApplicationContextFactory of(Supplier&lt;ConfigurableApplicationContext> supplier)</code></li></ul><h3 id=-åœ¨å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²>âš™ï¸ åœ¨å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²</h3><p>åœ¨ <code>SpringApplication.run()</code>æ–¹æ³•ä¸­ï¼Œ<code>ApplicationContextFactory</code>çš„è°ƒç”¨æ˜¯åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡çš„å…³é”®ä¸€æ­¥ï¼š</p><pre tabindex=0><code>public class SpringApplication {
    protected ConfigurableApplicationContext createApplicationContext() {
        // å§”æ‰˜ç»™ applicationContextFactory æ ¹æ®åº”ç”¨ç±»å‹åˆ›å»ºä¸Šä¸‹æ–‡
        return this.applicationContextFactory.create(this.webApplicationType);
    }
}
</code></pre><p>è¿™ä¸ªæ–¹æ³•åœ¨å‡†å¤‡å¥½ç¯å¢ƒï¼ˆ<code>Environment</code>ï¼‰ä¹‹åã€åˆ·æ–°ä¸Šä¸‹æ–‡ï¼ˆ<code>refreshContext</code>ï¼‰ä¹‹å‰è¢«è°ƒç”¨ï¼Œç¡®ä¿äº†åº”ç”¨ä¸Šä¸‹æ–‡èƒ½å¤Ÿæ ¹æ®å·²ç¡®å®šçš„åº”ç”¨ç±»å‹å’Œç¯å¢ƒè¿›è¡Œåˆ›å»ºå’Œåç»­é…ç½®ã€‚</p><h3 id=-æ€»ç»“-7>ğŸ’ æ€»ç»“</h3><p><code>ApplicationContextFactory</code>æ˜¯ Spring Boot å¯åŠ¨æµç¨‹ä¸­ä¸€ä¸ªç²¾å·§çš„æŠ½è±¡ï¼Œå®ƒå°†<strong>åº”ç”¨ç±»å‹çš„åˆ¤æ–­</strong>ä¸<strong>å…·ä½“åº”ç”¨ä¸Šä¸‹æ–‡çš„å®ä¾‹åŒ–</strong>è§£è€¦ã€‚é€šè¿‡ SPI æœºåˆ¶å’Œé»˜è®¤å®ç°ï¼ŒSpring Boot æä¾›äº†å¼€ç®±å³ç”¨çš„å¼ºå¤§åŠŸèƒ½ï¼ŒåŒæ—¶ä¿ç•™äº†é«˜åº¦çš„å¯æ‰©å±•æ€§ï¼Œå…è®¸å¼€å‘è€…æ ¹æ®ç‰¹æ®Šéœ€æ±‚å®šåˆ¶åº”ç”¨ä¸Šä¸‹æ–‡çš„åˆ›å»ºé€»è¾‘ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>ApplicationContextFactory</code>åœ¨ Spring Boot ç”Ÿæ€ç³»ç»Ÿä¸­çš„é‡è¦ä½œç”¨ã€‚</p><h2 id=servlet--reactive>SERVLET & REACTIVE</h2><p>SERVLET å’Œ REACTIVE æ˜¯ Spring Boot ä¸­æ„å»º Web åº”ç”¨çš„ä¸¤ç§æ ¸å¿ƒæ¨¡å‹ï¼Œå®ƒä»¬åœ¨è®¾è®¡å“²å­¦ã€æ€§èƒ½ç‰¹æ€§å’Œé€‚ç”¨åœºæ™¯ä¸Šæœ‰ç€æ ¹æœ¬çš„ä¸åŒã€‚ä¸ºäº†å¸®ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°å¯¹æ¯”äº†å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>SERVLET (Spring MVC)</th><th>REACTIVE (Spring WebFlux)</th></tr></thead><tbody><tr><td><strong>ç¼–ç¨‹æ¨¡å‹</strong></td><td><strong>åŒæ­¥é˜»å¡ I/O</strong></td><td><strong>å¼‚æ­¥éé˜»å¡ I/O</strong></td></tr><tr><td><strong>çº¿ç¨‹æ¨¡å‹</strong></td><td>æ¯ä¸ªè¯·æ±‚å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹æ± ï¼‰</td><td>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ï¼Œå°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¯·æ±‚</td></tr><tr><td><strong>æ ¸å¿ƒä¾èµ–</strong></td><td><code>spring-boot-starter-web</code></td><td><code>spring-boot-starter-webflux</code></td></tr><tr><td><strong>é»˜è®¤æœåŠ¡å™¨</strong></td><td>Tomcat</td><td>Netty</td></tr><tr><td><strong>èµ„æºæ¶ˆè€—</strong></td><td>è¾ƒé«˜ï¼ˆä¸å¹¶å‘çº¿ç¨‹æ•°æ­£ç›¸å…³ï¼‰</td><td>è¾ƒä½ï¼ˆçº¿ç¨‹å¤ç”¨ç‡æé«˜ï¼‰</td></tr><tr><td><strong>ååé‡</strong></td><td>å—é™äºçº¿ç¨‹æ± å¤§å°</td><td>é«˜å¹¶å‘ä¸‹æ›´å…·ä¼˜åŠ¿ï¼Œæ”¯æŒä¸‡çº§è¿æ¥</td></tr><tr><td><strong>ç¼–ç¨‹å¤æ‚åº¦</strong></td><td>ç›¸å¯¹ç®€å•ç›´è§‚ï¼Œæ˜“äºè°ƒè¯•</td><td>ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç†è§£å“åº”å¼ç¼–ç¨‹èŒƒå¼</td></tr><tr><td><strong>èƒŒå‹æ”¯æŒ</strong></td><td>ä¸æ”¯æŒ</td><td><strong>åŸç”Ÿæ”¯æŒ</strong>ï¼Œæ˜¯æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒåŒºåˆ«è¯¦è§£>ğŸ’¡ æ ¸å¿ƒåŒºåˆ«è¯¦è§£</h3><h4 id=1-å·¥ä½œåŸç†ä¸çº¿ç¨‹æ¨¡å‹>1. å·¥ä½œåŸç†ä¸çº¿ç¨‹æ¨¡å‹</h4><p>è¿™æ˜¯ä¸¤è€…æœ€æ ¹æœ¬çš„åŒºåˆ«ï¼Œç›´æ¥å†³å®šäº†å…¶æ€§èƒ½å’Œèµ„æºä½¿ç”¨æ¨¡å¼ã€‚</p><ul><li><strong>SERVLETï¼ˆåŒæ­¥é˜»å¡ï¼‰</strong>ï¼šåŸºäºç»å…¸çš„ <strong>â€œä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹â€</strong> æ¨¡å‹ã€‚å½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®¹å™¨ï¼ˆå¦‚Tomcatï¼‰ä¼šä»çº¿ç¨‹æ± ä¸­åˆ†é…ä¸€ä¸ªä¸“ç”¨çº¿ç¨‹æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°I/Oæ“ä½œï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€è°ƒç”¨å…¶ä»–æœåŠ¡ï¼‰ï¼Œçº¿ç¨‹ä¼š<strong>è¢«é˜»å¡</strong>ï¼Œç›´åˆ°æ”¶åˆ°å“åº”åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚è¿™æ„å‘³ç€åœ¨I/Oç­‰å¾…æœŸé—´ï¼Œå®è´µçš„çº¿ç¨‹èµ„æºå¤„äºé—²ç½®çŠ¶æ€ï¼Œæ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚ã€‚ä¸ºäº†åº”å¯¹é«˜å¹¶å‘ï¼Œå°±éœ€è¦æ‰©å¤§çº¿ç¨‹æ± ï¼Œä½†çº¿ç¨‹æœ¬èº«æ˜¯æ˜‚è´µçš„èµ„æºï¼Œå¤§é‡çº¿ç¨‹ä¼šå¯¼è‡´å·¨å¤§çš„å†…å­˜å¼€é”€å’Œé¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li><strong>REACTIVEï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰</strong>ï¼šåŸºäº<strong>äº‹ä»¶é©±åŠ¨</strong>å’Œ<strong>å‡½æ•°å¼ç¼–ç¨‹</strong>æ€æƒ³ã€‚å®ƒé‡‡ç”¨<strong>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</strong> æœºåˆ¶ï¼Œä½¿ç”¨å°‘é‡ï¼ˆé€šå¸¸ä¸ºCPUæ ¸å¿ƒæ•°ï¼‰çº¿ç¨‹æ¥å¤„ç†å¤§é‡çš„ç½‘ç»œè¿æ¥ã€‚å½“I/Oæ“ä½œå‘ç”Ÿæ—¶ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œè€Œæ˜¯æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°åç«‹å³è¿”å›ã€‚å½“æ•°æ®å°±ç»ªæ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šè§¦å‘å›è°ƒå‡½æ•°è¿›è¡Œåç»­å¤„ç†ã€‚è¿™æ ·ï¼Œæœ‰é™çš„çº¿ç¨‹èµ„æºå§‹ç»ˆåœ¨å¿™ç¢ŒçŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨ç­‰å¾…ï¼Œä»è€Œæå¤§åœ°æå‡äº†èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li></ul><h4 id=2-æŠ€æœ¯æ ˆä¸ä¾èµ–>2. æŠ€æœ¯æ ˆä¸ä¾èµ–</h4><p>ä½ çš„é€‰æ‹©ä¼šç›´æ¥å†³å®šé¡¹ç›®çš„åŸºç¡€æŠ€æœ¯æ ˆã€‚</p><ul><li><strong>SERVLET</strong>ï¼šå¼•å…¥ <code>spring-boot-starter-web</code>ä¾èµ–ï¼Œé»˜è®¤ä¼šåµŒå…¥ <strong>Tomcat</strong> ä½œä¸ºServletå®¹å™¨ã€‚ä½ ä¹Ÿå¯ä»¥è½»æ¾åœ°æ›¿æ¢ä¸ºJettyæˆ–Undertowã€‚å…¶ç¼–ç¨‹æ¨¡å‹å»ºç«‹åœ¨å¤§å®¶éå¸¸ç†Ÿæ‚‰çš„ <code>@Controller</code>, <code>@RequestMapping</code>ç­‰æ³¨è§£ä¹‹ä¸Šï¼Œå¼€å‘æ¨¡å¼å›ºå®šä¸”æˆç†Ÿã€‚</li><li><strong>REACTIVE</strong>ï¼šéœ€è¦å¼•å…¥ <code>spring-boot-starter-webflux</code>ä¾èµ–ï¼Œé»˜è®¤ä½¿ç”¨ <strong>Netty</strong> ä½œä¸ºæœåŠ¡å™¨ã€‚å…¶æ ¸å¿ƒæ˜¯ <strong>Reactor</strong> åº“ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>Mono</code>å’Œ <code>Flux</code>è¿™ä¸¤ç§ä»£è¡¨0-1ä¸ªå’Œ0-Nä¸ªå…ƒç´ çš„å¼‚æ­¥æ•°æ®æµç±»å‹æ¥æ„å»ºä½ çš„ä»£ç ã€‚å®ƒæ”¯æŒä¸¤ç§ç¼–ç¨‹æ¨¡å‹ï¼šç±»MVCçš„æ³¨è§£æ¨¡å‹å’Œæ›´çµæ´»çš„å‡½æ•°å¼è·¯ç”±æ¨¡å‹ã€‚</li></ul><h4 id=3-èƒŒå‹backpressureæœºåˆ¶>3. èƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶</h4><p>è¿™æ˜¯å“åº”å¼ç¼–ç¨‹ç‹¬æœ‰çš„é‡è¦ç‰¹æ€§ã€‚</p><ul><li><strong>REACTIVE æ”¯æŒèƒŒå‹</strong>ï¼šåœ¨æ•°æ®æµå¤„ç†ä¸­ï¼Œå½“ç”Ÿäº§è€…çš„æ•°æ®äº§ç”Ÿé€Ÿåº¦è¿œå¿«äºæ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦æ—¶ï¼ŒèƒŒå‹æœºåˆ¶å…è®¸æ¶ˆè´¹è€…<strong>å‘ä¸Šæ¸¸å‘å‡ºä¿¡å·ï¼Œå‘ŠçŸ¥â€œæˆ‘å¤„ç†ä¸è¿‡æ¥äº†ï¼Œè¯·æ…¢ä¸€ç‚¹â€</strong>ã€‚è¿™èƒ½æœ‰æ•ˆåœ°é˜²æ­¢å¿«é€Ÿæ•°æ®æºæ·¹æ²¡æ¶ˆè´¹è€…ï¼Œä»è€Œæå‡ç³»ç»Ÿçš„å¼¹æ€§å’Œç¨³å®šæ€§ã€‚SERVLETæ¨¡å‹ä¸å…·å¤‡è¿™ç§èƒ½åŠ›ã€‚</li></ul><h3 id=-å¦‚ä½•é€‰æ‹©>ğŸ¯ å¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><p>äº†è§£äº†åŒºåˆ«åï¼Œå…³é”®åœ¨äºå¦‚ä½•ä¸ºä½ çš„é¡¹ç›®åšå‡ºæ­£ç¡®é€‰æ‹©ã€‚</p><ul><li><strong>é€‰æ‹© SERVLET (Spring MVC) çš„æƒ…å†µ</strong>ï¼š<ul><li><strong>å›¢é˜Ÿç†Ÿæ‚‰åº¦</strong>ï¼šå›¢é˜Ÿå¯¹Servletæ¨¡å‹å’ŒåŒæ­¥ç¼–ç¨‹éå¸¸ç†Ÿæ‚‰ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚</li><li><strong>é¡¹ç›®éœ€æ±‚</strong>ï¼šå¼€å‘çš„æ˜¯ä¼ ç»Ÿçš„CRUDåº”ç”¨ã€å†…éƒ¨ç®¡ç†ç³»ç»Ÿæˆ–å¹¶å‘è¦æ±‚ä¸é«˜çš„RESTful APIã€‚</li><li><strong>ç”Ÿæ€ä¾èµ–</strong>ï¼šé¡¹ç›®ä¸¥é‡ä¾èµ–ä¸é˜»å¡å¼I/Oç´§å¯†é›†æˆçš„ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚æŸäº›ä¼ ç»Ÿçš„JPAå®ç°æˆ–SDKï¼‰ã€‚</li><li><strong>ç®€å•æ€§ä¼˜å…ˆ</strong>ï¼šé¡¹ç›®å‘¨æœŸç´§ï¼Œè¿½æ±‚å¼€å‘æ•ˆç‡ã€å¯ç»´æŠ¤æ€§å’Œæ˜“äºè°ƒè¯•ï¼Œæ­¤æ—¶SERVLETçš„ç®€å•ç›´è§‚æ˜¯å·¨å¤§ä¼˜åŠ¿ã€‚</li></ul></li><li><strong>é€‰æ‹© REACTIVE (Spring WebFlux) çš„æƒ…å†µ</strong>ï¼š<ul><li><strong>é«˜å¹¶å‘ä¸ä½å»¶è¿Ÿ</strong>ï¼šåº”ç”¨éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼ˆå¦‚æ¶ˆæ¯æ¨é€ã€èŠå¤©å®¤ã€å®æ—¶æ•°æ®æµå¤„ç†ï¼‰ï¼Œå¹¶ä¸”å¯¹å“åº”å»¶è¿Ÿæœ‰æé«˜è¦æ±‚ã€‚</li><li><strong>I/Oå¯†é›†å‹åœºæ™¯</strong>ï¼šç³»ç»Ÿéœ€è¦é¢‘ç¹åœ°è¿›è¡Œé«˜å»¶è¿Ÿçš„I/Oæ“ä½œï¼ˆå¦‚è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ï¼‰ï¼Œå¹¶ä¸”å¸Œæœ›ç”¨æœ€å°‘çš„èµ„æºæ¥æ”¯æ’‘ã€‚</li><li><strong>æµå¼æ•°æ®å¤„ç†</strong>ï¼šéœ€è¦å¤„ç†å¦‚SSEï¼ˆServer-Sent Eventsï¼‰æˆ–WebSocketç­‰æŒç»­çš„æ•°æ®æµã€‚</li><li><strong>æŠ€æœ¯å‰ç»æ€§</strong>ï¼šå›¢é˜Ÿå¸Œæœ›å­¦ä¹ å’Œä½¿ç”¨æ›´å‰æ²¿çš„æŠ€æœ¯ï¼Œä¸ºæœªæ¥åšå‡†å¤‡ã€‚</li></ul></li></ul><h3 id=-éœ€è¦æ³¨æ„çš„è¯¯åŒº>âš ï¸ éœ€è¦æ³¨æ„çš„è¯¯åŒº</h3><ul><li><strong>REACTIVE å¹¶éæ€»æ˜¯æ›´å¿«</strong>ï¼šåœ¨ä½å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸¤è€…çš„æ€§èƒ½å·®å¼‚å¯èƒ½ä¸æ˜æ˜¾ã€‚REACTIVEçš„ä¼˜åŠ¿åªæœ‰åœ¨é«˜å¹¶å‘ã€é«˜I/Oç­‰å¾…çš„åœºæ™¯ä¸‹æ‰èƒ½å……åˆ†å‘æŒ¥ã€‚å¯¹äºCPUå¯†é›†å‹ä»»åŠ¡ï¼ŒREACTIVEå¹¶æ— ä¼˜åŠ¿ã€‚</li><li><strong>â€œå…¨æ ˆå“åº”å¼â€æ‰æœ‰æ„ä¹‰</strong>ï¼šä»…ä»…åœ¨Webå±‚ä½¿ç”¨REACTIVEï¼Œè€Œæ•°æ®è®¿é—®å±‚ï¼ˆå¦‚JDBCï¼‰ä»ç„¶æ˜¯é˜»å¡çš„ï¼Œé‚£ä¹ˆæ•´ä¸ªé“¾æ¡æœ€ç»ˆè¿˜æ˜¯ä¼šè¢«é˜»å¡æ“ä½œæ‹–ç´¯ï¼Œæ— æ³•å‘æŒ¥éé˜»å¡çš„å¨åŠ›ã€‚çœŸæ­£çš„æ”¶ç›Šæ¥è‡ªäºä»æ§åˆ¶å™¨åˆ°æ•°æ®åº“é©±åŠ¨ç¨‹åºçš„<strong>å…¨é“¾è·¯éé˜»å¡</strong>ã€‚</li></ul><h3 id=-æ€»ç»“-8>ğŸ’ æ€»ç»“</h3><p>ç®€å•æ¥è¯´ï¼Œ<strong>SERVLETåƒæ˜¯ä¸€ä¸ªæ¥å¾…èƒ½åŠ›å›ºå®šã€æ¯ä¸ªå®¢æˆ·é…ä¸€ä¸ªä¸“å±ç®¡å®¶çš„é¤å…ï¼›è€ŒREACTIVEåˆ™åƒæ˜¯ä¸€ä¸ªç”±å°‘æ•°å‡ ä¸ªé«˜æ•ˆæœåŠ¡å‘˜é€šè¿‡æ™ºèƒ½å¯¹è®²æœºåŒæ—¶åè°ƒæœåŠ¡å¤§é‡æ¡Œå°çš„é¤å…</strong>ã€‚å‰è€…ç¨³å®šå¯é ï¼Œé€‚åˆå¸¸è§„å®¢æµï¼›åè€…æ•ˆç‡æé«˜ï¼Œæ“…é•¿åº”å¯¹å®¢æµé«˜å³°ã€‚</p><p>é€‰æ‹©å“ªç§æ¨¡å‹ï¼Œæœ€ç»ˆå–å†³äºä½ çš„å…·ä½“ä¸šåŠ¡éœ€æ±‚ã€å›¢é˜Ÿçš„æŠ€æœ¯å‚¨å¤‡å’Œå¯¹ç³»ç»Ÿæ‰©å±•æ€§çš„æœŸæœ›ã€‚å¯¹äºå¤§å¤šæ•°ä¼ ç»Ÿä¸šåŠ¡åº”ç”¨ï¼ŒSERVLETä¾ç„¶æ˜¯éå¸¸ç¨³å¥å’Œé«˜æ•ˆçš„é€‰æ‹©ã€‚è€Œå½“ä½ é¢ä¸´çœŸæ­£çš„é«˜å¹¶å‘ã€æµå¼æ•°æ®å¤„ç†æŒ‘æˆ˜æ—¶ï¼ŒREACTIVEå°†ä¸ºä½ æä¾›å¼ºå¤§çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„å¯¹æ¯”èƒ½å¸®åŠ©ä½ åšå‡ºæ¸…æ™°çš„æŠ€æœ¯å†³ç­–ï¼</p><h2 id=preparecontext>prepareContext</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareContext</span><span class=p>(</span><span class=n>DefaultBootstrapContext</span><span class=w> </span><span class=n>bootstrapContext</span><span class=p>,</span><span class=w> </span><span class=n>ConfigurableApplicationContext</span><span class=w> </span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>ConfigurableEnvironment</span><span class=w> </span><span class=n>environment</span><span class=p>,</span><span class=w> </span><span class=n>SpringApplicationRunListeners</span><span class=w> </span><span class=n>listeners</span><span class=p>,</span><span class=w> </span><span class=n>ApplicationArguments</span><span class=w> </span><span class=n>applicationArguments</span><span class=p>,</span><span class=w> </span><span class=n>Banner</span><span class=w> </span><span class=n>printedBanner</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>context</span><span class=p>.</span><span class=na>setEnvironment</span><span class=p>(</span><span class=n>environment</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>this</span><span class=p>.</span><span class=na>postProcessApplicationContext</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>this</span><span class=p>.</span><span class=na>addAotGeneratedInitializerIfNecessary</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>initializers</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>this</span><span class=p>.</span><span class=na>applyInitializers</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>listeners</span><span class=p>.</span><span class=na>contextPrepared</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>bootstrapContext</span><span class=p>.</span><span class=na>close</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>properties</span><span class=p>.</span><span class=na>isLogStartupInfo</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>this</span><span class=p>.</span><span class=na>logStartupInfo</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getParent</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>this</span><span class=p>.</span><span class=na>logStartupInfo</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>this</span><span class=p>.</span><span class=na>logStartupProfileInfo</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>ConfigurableListableBeanFactory</span><span class=w> </span><span class=n>beanFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>context</span><span class=p>.</span><span class=na>getBeanFactory</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>beanFactory</span><span class=p>.</span><span class=na>registerSingleton</span><span class=p>(</span><span class=s>&#34;springApplicationArguments&#34;</span><span class=p>,</span><span class=w> </span><span class=n>applicationArguments</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>printedBanner</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>beanFactory</span><span class=p>.</span><span class=na>registerSingleton</span><span class=p>(</span><span class=s>&#34;springBootBanner&#34;</span><span class=p>,</span><span class=w> </span><span class=n>printedBanner</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>beanFactory</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>AbstractAutowireCapableBeanFactory</span><span class=w> </span><span class=n>autowireCapableBeanFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>autowireCapableBeanFactory</span><span class=p>.</span><span class=na>setAllowCircularReferences</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>properties</span><span class=p>.</span><span class=na>isAllowCircularReferences</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>beanFactory</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>DefaultListableBeanFactory</span><span class=w> </span><span class=n>listableBeanFactory</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>listableBeanFactory</span><span class=p>.</span><span class=na>setAllowBeanDefinitionOverriding</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>properties</span><span class=p>.</span><span class=na>isAllowBeanDefinitionOverriding</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>properties</span><span class=p>.</span><span class=na>isLazyInitialization</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>context</span><span class=p>.</span><span class=na>addBeanFactoryPostProcessor</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>LazyInitializationBeanFactoryPostProcessor</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>properties</span><span class=p>.</span><span class=na>isKeepAlive</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>context</span><span class=p>.</span><span class=na>addApplicationListener</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>KeepAlive</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>context</span><span class=p>.</span><span class=na>addBeanFactoryPostProcessor</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PropertySourceOrderingBeanFactoryPostProcessor</span><span class=p>(</span><span class=n>context</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>AotDetector</span><span class=p>.</span><span class=na>useGeneratedArtifacts</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>sources</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getAllSources</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>Assert</span><span class=p>.</span><span class=na>notEmpty</span><span class=p>(</span><span class=n>sources</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Sources must not be empty&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>this</span><span class=p>.</span><span class=na>load</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>sources</span><span class=p>.</span><span class=na>toArray</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>listeners</span><span class=p>.</span><span class=na>contextLoaded</span><span class=p>(</span><span class=n>context</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ä½ æä¾›çš„è¿™æ®µä»£ç æ˜¯ Spring Boot åº”ç”¨ä¸­å‡†å¤‡åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆ<code>ApplicationContext</code>ï¼‰çš„æ ¸å¿ƒç¯èŠ‚ã€‚ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨å±€ï¼Œä¸‹è¡¨è¯¦ç»†è§£æäº† <code>prepareContext</code>æ–¹æ³•çš„å…³é”®æ­¥éª¤åŠå…¶ä½œç”¨ã€‚</p><div class=table-wrapper><table><thead><tr><th>æ­¥éª¤</th><th>å…³é”®æ–¹æ³•/æ“ä½œ</th><th>ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td><strong>1. ç¯å¢ƒè®¾ç½®</strong></td><td><code>context.setEnvironment(environment)</code></td><td>å°†å·²é…ç½®å¥½çš„ <code>Environment</code>ï¼ˆåŒ…å«å±æ€§æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰è®¾ç½®åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç»Ÿä¸€ç¯å¢ƒé…ç½®ã€‚</td></tr><tr><td><strong>2. ä¸Šä¸‹æ–‡åç½®å¤„ç†</strong></td><td><code>postProcessApplicationContext(context)</code></td><td>å¯¹åº”ç”¨ä¸Šä¸‹æ–‡è¿›è¡Œåç½®å¤„ç†ï¼Œä¾‹å¦‚æ³¨å†Œ <code>BeanNameGenerator</code>ã€è®¾ç½® <code>ResourceLoader</code>å’Œ <code>ConversionService</code>ç­‰ã€‚</td></tr><tr><td><strong>3. æ‰§è¡Œåˆå§‹åŒ–å™¨</strong></td><td><code>applyInitializers(context)</code></td><td>æ‰§è¡Œæ‰€æœ‰ <code>ApplicationContextInitializer</code>å®ç°ç±»çš„ <code>initialize</code>æ–¹æ³•ï¼Œç”¨äºåœ¨å®¹å™¨åˆ·æ–°å‰å¯¹ä¸Šä¸‹æ–‡è¿›è¡Œè‡ªå®šä¹‰åˆå§‹åŒ–ã€‚</td></tr><tr><td><strong>4. å‘å¸ƒä¸Šä¸‹æ–‡å‡†å¤‡äº‹ä»¶</strong></td><td><code>listeners.contextPrepared(context)</code></td><td>å‘å¸ƒ <code>ApplicationContextInitializedEvent</code>äº‹ä»¶ï¼Œé€šçŸ¥ç›‘å¬å™¨åº”ç”¨ä¸Šä¸‹æ–‡å·²å‡†å¤‡å°±ç»ªï¼ˆä½†æ­¤æ—¶å°šæ— Beanå®šä¹‰åŠ è½½ï¼‰ã€‚</td></tr><tr><td><strong>5. å…³é—­å¼•å¯¼ä¸Šä¸‹æ–‡</strong></td><td><code>bootstrapContext.close(context)</code></td><td>å…³é—­ <code>BootstrapContext</code>ï¼Œå¹¶å°†å…¶ä¸­çš„å†…å®¹è½¬ç§»åˆ°å½“å‰çš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼ˆè¿™æ˜¯æ–°ç‰ˆæœ¬ä»£ç ç›¸è¾ƒäºæ—§ç‰ˆæœ¬çš„ä¸€ä¸ªæ˜¾è‘—å˜åŒ–ï¼‰ã€‚</td></tr><tr><td><strong>6. æ‰“å°å¯åŠ¨ä¿¡æ¯</strong></td><td><code>logStartupInfo</code>, <code>logStartupProfileInfo</code></td><td>åœ¨æ—¥å¿—ä¸­è¾“å‡ºåº”ç”¨å¯åŠ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯åŠ¨ç±»ã€PIDã€è·¯å¾„ä»¥åŠæ¿€æ´»çš„é…ç½®æ–‡ä»¶ï¼ˆprofilesï¼‰ã€‚</td></tr><tr><td><strong>7. æ³¨å†Œå…³é”®å•ä¾‹Bean</strong></td><td><code>registerSingleton("springApplicationArguments", ...)</code></td><td>å°†åº”ç”¨å‚æ•°ï¼ˆ<code>ApplicationArguments</code>ï¼‰å’ŒBannerå¯¹è±¡ä½œä¸ºå•ä¾‹Beanæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œä¾¿äºåç»­ä¾èµ–æ³¨å…¥ã€‚</td></tr><tr><td><strong>8. é…ç½®BeanFactory</strong></td><td>è®¾ç½®å¾ªç¯å¼•ç”¨ã€Beanå®šä¹‰è¦†ç›–ç­‰å±æ€§</td><td>æ ¹æ®é…ç½®å†³å®šæ˜¯å¦å…è®¸å¾ªç¯å¼•ç”¨å’ŒBeanå®šä¹‰è¦†ç›–ï¼Œå¹¶å¯èƒ½æ·»åŠ å»¶è¿Ÿåˆå§‹åŒ–ç­‰åç½®å¤„ç†å™¨ã€‚</td></tr><tr><td><strong>9. åŠ è½½æºæ•°æ®</strong></td><td><code>load(context, sources.toArray(...))</code></td><td>å°†ä¸»å¯åŠ¨ç±»ï¼ˆå³<code>sources</code>ï¼‰åŠ è½½åˆ°å®¹å™¨ä¸­ï¼Œè§£æå…¶ä¸Šçš„æ³¨è§£ï¼ˆå¦‚<code>@SpringBootApplication</code>ï¼‰ï¼Œå¹¶æ³¨å†Œç›¸åº”çš„Beanå®šä¹‰ã€‚</td></tr><tr><td><strong>10. å‘å¸ƒä¸Šä¸‹æ–‡åŠ è½½äº‹ä»¶</strong></td><td><code>listeners.contextLoaded(context)</code></td><td>å‘å¸ƒ <code>ApplicationPreparedEvent</code>äº‹ä»¶ï¼Œé€šçŸ¥ç›‘å¬å™¨Beanå®šä¹‰å·²åŠ è½½å®Œæˆï¼ˆä½†æ­¤æ—¶Beanå°šæœªå®ä¾‹åŒ–ï¼‰ã€‚</td></tr></tbody></table></div><h3 id=-å…³é”®æ­¥éª¤è¯¦è§£>ğŸ’¡ å…³é”®æ­¥éª¤è¯¦è§£</h3><h4 id=1-ç¯å¢ƒè®¾ç½®ä¸ç¯å¢ƒç»Ÿä¸€>1. ç¯å¢ƒè®¾ç½®ä¸ç¯å¢ƒç»Ÿä¸€</h4><p>è¿™ä¸€æ­¥è‡³å…³é‡è¦ï¼Œå®ƒç¡®ä¿äº†åº”ç”¨ä¸Šä¸‹æ–‡ä½¿ç”¨çš„æ˜¯åœ¨SpringApplicationè¿è¡Œé˜¶æ®µå·²ç»åˆ›å»ºå¹¶é…ç½®å¥½çš„<code>Environment</code>å¯¹è±¡ã€‚è¿™ä¸ª<code>Environment</code>å¯¹è±¡å·²ç»åŒ…å«äº†ä»<code>application.properties</code>ã€<code>application.yml</code>ã€ç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡ç­‰æ‰€æœ‰æ¸ é“è§£æå¾—åˆ°çš„å±æ€§æºï¼ˆPropertySourcesï¼‰ã€‚é€šè¿‡<code>context.setEnvironment(environment)</code>ï¼Œåº”ç”¨ä¸Šä¸‹æ–‡ä¸SpringApplicationä½¿ç”¨äº†å®Œå…¨ç›¸åŒçš„ç¯å¢ƒé…ç½®ï¼Œä¸ºåç»­çš„Beanåˆ›å»ºå’Œå±æ€§æ³¨å…¥å¥ å®šäº†åŸºç¡€ã€‚</p><h4 id=2-æ‰§è¡Œåˆå§‹åŒ–å™¨initializers>2. æ‰§è¡Œåˆå§‹åŒ–å™¨ï¼ˆInitializersï¼‰</h4><p><code>applyInitializers(context)</code>æ–¹æ³•ä¼šéå†å¹¶æ‰§è¡Œæ‰€æœ‰é€šè¿‡<code>spring.factories</code>æœºåˆ¶åŠ è½½åˆ°çš„<code>ApplicationContextInitializer</code>å®ç°ã€‚è¿™äº›åˆå§‹åŒ–å™¨æ˜¯Spring Bootæä¾›çš„ä¸€ä¸ª<strong>é‡è¦æ‰©å±•ç‚¹</strong>ï¼Œå…è®¸ä½ åœ¨IoCå®¹å™¨åˆ·æ–°ä¹‹å‰ï¼Œå¯¹<code>ConfigurableApplicationContext</code>è¿›è¡Œç¼–ç¨‹å¼çš„å®šåˆ¶ã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„<code>ContextIdApplicationContextInitializer</code>ä¼šä¸ºåº”ç”¨ä¸Šä¸‹æ–‡è®¾ç½®ä¸€ä¸ªIDï¼Œè€Œ<code>ServerPortInfoApplicationContextInitializer</code>åˆ™ä¼šæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨æ¥è·å–å†…åµŒWebæœåŠ¡å™¨çš„å®é™…ç«¯å£ã€‚</p><h4 id=3-å¼•å¯¼ä¸Šä¸‹æ–‡çš„å…³é—­ä¸èµ„æºè½¬ç§»>3. å¼•å¯¼ä¸Šä¸‹æ–‡çš„å…³é—­ä¸èµ„æºè½¬ç§»</h4><p>ä½ æä¾›çš„ä»£ç ä¸­<code>bootstrapContext.close(context)</code>æ˜¯ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç»†èŠ‚ã€‚<code>BootstrapContext</code>ä¸»è¦ç”¨äºåº”ç”¨çš„<strong>æ—©æœŸå¯åŠ¨é˜¶æ®µ</strong>ï¼Œä¾‹å¦‚åœ¨Spring Cloudç¯å¢ƒä¸­åŠ è½½è¿œç¨‹é…ç½®ã€‚å½“ä¸»åº”ç”¨ä¸Šä¸‹æ–‡å‡†å¤‡å°±ç»ªæ—¶ï¼Œ<code>BootstrapContext</code>çš„ä½¿å‘½å°±å®Œæˆäº†ã€‚è°ƒç”¨<code>close</code>æ–¹æ³•ä¼šè§¦å‘å…¶å…³é—­äº‹ä»¶ï¼Œå¹¶é€šå¸¸å°†å…¶æŒæœ‰çš„èµ„æºï¼ˆå¦‚ä¸€äº›æ—©æœŸçš„å•ä¾‹Beanï¼‰è½¬ç§»åˆ°ä¸»åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç¡®ä¿å®ƒä»¬åœ¨ä¸»åº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…å¯ç”¨ã€‚</p><h4 id=4-åŠ è½½æºæ•°æ®sourceä¸beanå®šä¹‰æ³¨å†Œ>4. åŠ è½½æºæ•°æ®ï¼ˆSourceï¼‰ä¸Beanå®šä¹‰æ³¨å†Œ</h4><p><code>load(context, sources...)</code>æ˜¯æ•´ä¸ªæµç¨‹ä¸­çš„<strong>æ ¸å¿ƒæ­¥éª¤ä¹‹ä¸€</strong>ã€‚è¿™é‡Œçš„<code>sources</code>é€šå¸¸å°±æ˜¯ä½ çš„ä¸»å¯åŠ¨ç±»ï¼ˆä¾‹å¦‚<code>Application.class</code>ï¼‰ã€‚è¯¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª<code>BeanDefinitionLoader</code>ï¼Œå®ƒä¼šè§£æä½ çš„å¯åŠ¨ç±»ä¸Šçš„æ³¨è§£ï¼ˆå¦‚<code>@SpringBootApplication</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£ï¼ŒåŒ…å«äº†<code>@Configuration</code>ï¼‰ã€‚è§£æçš„ç»“æœæ˜¯ï¼Œä½ çš„å¯åŠ¨ç±»æœ¬èº«ä¼šè¢«æ³¨å†Œä¸ºä¸€ä¸ªBeanå®šä¹‰ï¼ˆBeanDefinitionï¼‰åˆ°å®¹å™¨çš„<code>BeanDefinitionMap</code>ä¸­ã€‚è¿™æ˜¯åç»­ç»„ä»¶æ‰«æï¼ˆ<code>@ComponentScan</code>ï¼‰å’Œè‡ªåŠ¨é…ç½®ï¼ˆ<code>@EnableAutoConfiguration</code>ï¼‰å¾—ä»¥æ‰§è¡Œçš„èµ·ç‚¹ã€‚</p><h4 id=5-äº‹ä»¶é©±åŠ¨çš„å¯åŠ¨æµç¨‹>5. äº‹ä»¶é©±åŠ¨çš„å¯åŠ¨æµç¨‹</h4><p>åœ¨æ•´ä¸ª<code>prepareContext</code>è¿‡ç¨‹ä¸­ï¼ŒSpring Booté€šè¿‡<code>SpringApplicationRunListeners</code>å‘å¸ƒäº†å¤šä¸ªäº‹ä»¶ï¼ˆå¦‚<code>contextPrepared</code>å’Œ<code>contextLoaded</code>ï¼‰ã€‚è¿™ç§<strong>äº‹ä»¶é©±åŠ¨æœºåˆ¶</strong>æ˜¯Spring Bootæ¡†æ¶é«˜åº¦å¯æ‰©å±•æ€§çš„ä½“ç°ã€‚å„ç§ç›‘å¬å™¨ï¼ˆå¦‚<code>ConfigFileApplicationListener</code>, <code>LoggingApplicationListener</code>ï¼‰é€šè¿‡ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šèŠ‚ç‚¹æ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œä»è€Œå®ç°äº†åŠŸèƒ½çš„æ¨¡å—åŒ–å’Œè§£è€¦ã€‚</p><h3 id=-ç‰ˆæœ¬å·®å¼‚è¯´æ˜>âš ï¸ ç‰ˆæœ¬å·®å¼‚è¯´æ˜</h3><p>ä½ æä¾›çš„ä»£ç ç‰‡æ®µä¸ä¸€äº›æœç´¢ç»“æœï¼ˆåŸºäºSpring Boot 2.xï¼‰å±•ç¤ºçš„ç»å…¸<code>prepareContext</code>æ–¹æ³•å­˜åœ¨ä¸€äº›å·®å¼‚ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š</p><ul><li><strong>å‚æ•°åˆ—è¡¨</strong>ï¼šä½ çš„ä»£ç å¤šäº†ä¸€ä¸ª<code>DefaultBootstrapContext bootstrapContext</code>å‚æ•°ï¼Œè¿™åæ˜ äº†æ–°ç‰ˆæœ¬å¯¹å¼•å¯¼æµç¨‹çš„å¢å¼ºã€‚</li><li><strong>AOTæ”¯æŒ</strong>ï¼šä½ çš„ä»£ç ä¸­å‡ºç°äº†<code>this.addAotGeneratedInitializerIfNecessary(this.initializers)</code>å’Œ<code>if (!AotDetector.useGeneratedArtifacts())</code>ç­‰é€»è¾‘ï¼Œè¿™äº›æ˜¯Spring Bootä¸ºæ”¯æŒ<strong>AOTï¼ˆAhead-Of-Timeï¼‰ç¼–è¯‘</strong>ï¼ˆå¸¸ç”¨äºGraalVM Native Imageï¼‰è€Œå¼•å…¥çš„æ–°ç‰¹æ€§ã€‚åœ¨AOTæ¨¡å¼ä¸‹ï¼Œéƒ¨åˆ†ä¼ ç»Ÿçš„åå°„å’ŒåŠ¨æ€å¤„ç†ä¼šè¢«é¢„å…ˆç”Ÿæˆçš„ä»£ç æ›¿ä»£ï¼Œå› æ­¤åŠ è½½æºæ•°æ®çš„é€»è¾‘ï¼ˆ<code>this.load</code>ï¼‰åœ¨AOTæ¨¡å¼ä¸‹å¯èƒ½è¢«è·³è¿‡ã€‚</li></ul><h3 id=-æ€»ç»“-9>ğŸ’ æ€»ç»“</h3><p><code>prepareContext</code>æ–¹æ³•æ˜¯Spring Bootåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­æ‰¿ä¸Šå¯ä¸‹çš„å…³é”®é˜¶æ®µã€‚å®ƒæ­å»ºäº†IoCå®¹å™¨çš„åŸºæœ¬éª¨æ¶ï¼š<strong>ç»Ÿä¸€äº†ç¯å¢ƒé…ç½®ã€æ‰§è¡Œäº†è‡ªå®šä¹‰åˆå§‹åŒ–ã€æ³¨å†Œäº†æ ¸å¿ƒçš„å•ä¾‹å¯¹è±¡ã€åŠ è½½äº†å¯åŠ¨ç±»å¹¶å‘å¸ƒäº†å…³é”®äº‹ä»¶</strong>ï¼Œä¸ºç´§éšå…¶åçš„å®¹å™¨åˆ·æ–°ï¼ˆ<code>refreshContext</code>ï¼‰â€”â€”å³Beançš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ç­‰æ ¸å¿ƒæµç¨‹â€”â€”åšå¥½äº†å…¨éƒ¨å‡†å¤‡å·¥ä½œã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£é‡Šèƒ½å¸®åŠ©ä½ é€å½»ç†è§£Spring Bootåº”ç”¨ä¸Šä¸‹æ–‡çš„å‡†å¤‡è¿‡ç¨‹ã€‚å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“æ­¥éª¤æˆ–æ‰©å±•ç‚¹è¿˜æœ‰æ›´æ·±å…¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚</p><h2 id=beanfactory>BeanFactory</h2><p>BeanFactory æ˜¯ Spring æ¡†æ¶çš„<strong>å¿ƒè„</strong>ï¼Œå®ƒæ˜¯ Spring IoCï¼ˆæ§åˆ¶åè½¬ï¼‰å®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œè´Ÿè´£ç®¡ç†åº”ç”¨ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼ˆå³ Beanï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ±‡æ€»äº†å®ƒçš„æ ¸å¿ƒä¿¡æ¯ã€‚</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>æ ¸å¿ƒè¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒè§’è‰²</strong></td><td>Spring IoC å®¹å™¨çš„é¡¶å±‚æ¥å£ï¼Œæ˜¯å¯¹è±¡çš„â€œè¶…çº§å·¥å‚â€å’Œç®¡ç†ä¸­å¿ƒã€‚</td></tr><tr><td><strong>ä¸»è¦èŒè´£</strong></td><td>Bean çš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ (DI)ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä½œç”¨åŸŸæ§åˆ¶ã€‚</td></tr><tr><td><strong>è®¾è®¡ç›®æ ‡</strong></td><td>å®ç°æ§åˆ¶åè½¬ (IoC) å’Œä¾èµ–æ³¨å…¥ (DI)ï¼Œå°†å¯¹è±¡åˆ›å»ºä¸ä½¿ç”¨çš„èŒè´£ä»åº”ç”¨ä»£ç åè½¬ç»™å®¹å™¨ã€‚</td></tr><tr><td><strong>å…³é”®ç‰¹æ€§</strong></td><td>æ”¯æŒå¤šç§ä½œç”¨åŸŸï¼ˆå•ä¾‹ã€åŸå‹ç­‰ï¼‰ã€å»¶è¿ŸåŠ è½½ã€ä¸ BeanDefinition æœºåˆ¶è§£è€¦ã€‚</td></tr><tr><td><strong>æ ¸å¿ƒå®ç°</strong></td><td><code>DefaultListableBeanFactory</code>ï¼ˆæœ€å¸¸ç”¨ã€åŠŸèƒ½æœ€å®Œæ•´çš„å®ç°ï¼‰ã€‚</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼-2>ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½ä¸ä»·å€¼</h3><p>BeanFactory çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒå®ç°äº† <strong>â€œæ§åˆ¶åè½¬â€</strong> è¿™ä¸€æ ¸å¿ƒç¼–ç¨‹æ€æƒ³ã€‚åº”ç”¨ç¨‹åºä¸å†è‡ªå·±ç”¨ <code>new</code>å…³é”®å­—æ¥åˆ›å»ºå’Œç®¡ç†å¯¹è±¡ï¼Œè€Œæ˜¯ç”± BeanFactory è¿™ä¸ªå®¹å™¨æ¥ç»Ÿä¸€è´Ÿè´£ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p><ul><li><strong>è§£è€¦</strong>ï¼šå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”±å®¹å™¨æ³¨å…¥ï¼Œé™ä½äº†ä»£ç çš„è€¦åˆåº¦ã€‚</li><li><strong>èµ„æºç»Ÿä¸€ç®¡ç†</strong>ï¼šå®¹å™¨å¯ä»¥é«˜æ•ˆåœ°ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ï¼‰ã€‚</li><li><strong>çµæ´»é…ç½®</strong>ï¼šé€šè¿‡é…ç½®ï¼ˆXMLã€æ³¨è§£ã€Java Configï¼‰ï¼Œå¯ä»¥è½»æ¾æ”¹å˜ Bean çš„è¡Œä¸ºå’Œä½œç”¨åŸŸï¼Œè€Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚</li></ul><h3 id=-æ ¸å¿ƒæ¥å£ä¸æ–¹æ³•>ğŸ“š æ ¸å¿ƒæ¥å£ä¸æ–¹æ³•</h3><p>BeanFactory æ¥å£å®šä¹‰äº†ä¸€ç³»åˆ—ç®¡ç† Bean çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå¯ä»¥å½’çº³ä¸ºä»¥ä¸‹å‡ ç±» ï¼š</p><ul><li><p><strong>è·å– Bean å®ä¾‹</strong>ï¼šè¿™æ˜¯æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚</p><pre tabindex=0><code>Object getBean(String name) throws BeansException;
&lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType) throws BeansException;
&lt;T&gt; T getBean(Class&lt;T&gt; requiredType) throws BeansException;
</code></pre></li><li><p><strong>æ£€æŸ¥ Bean ç‰¹æ€§</strong>ï¼šç”¨äºæŸ¥è¯¢ Bean çš„ä¿¡æ¯ã€‚</p><pre tabindex=0><code>boolean containsBean(String name); // æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‡å®šåç§°çš„Bean
boolean isSingleton(String name) throws NoSuchBeanDefinitionException; // æ˜¯å¦ä¸ºå•ä¾‹
boolean isPrototype(String name) throws NoSuchBeanDefinitionException; // æ˜¯å¦ä¸ºåŸå‹ï¼ˆæ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ï¼‰
Class&lt;?&gt; getType(String name) throws NoSuchBeanDefinitionException; // è·å–Beançš„ç±»å‹
</code></pre></li><li><p><strong>è·å–åˆ«åç­‰å…¶ä»–ä¿¡æ¯</strong>ï¼š</p><pre tabindex=0><code>String[] getAliases(String name); // è·å–Beançš„æ‰€æœ‰åˆ«å
</code></pre></li></ul><h3 id=-æ ¸å¿ƒå®ç°defaultlistablebeanfactory>âš™ï¸ æ ¸å¿ƒå®ç°ï¼šDefaultListableBeanFactory</h3><p><code>DefaultListableBeanFactory</code>æ˜¯ Spring ä¸­<strong>åŠŸèƒ½æœ€å®Œæ•´ã€æœ€å¸¸ç”¨</strong>çš„ BeanFactory å®ç° ã€‚å®ƒä¸ä»…å®ç°äº† <code>BeanFactory</code>æ¥å£ï¼Œè¿˜å®ç°äº† <code>BeanDefinitionRegistry</code>æ¥å£ï¼Œè¿™æ„å‘³ç€å®ƒå…·å¤‡æ³¨å†Œå’Œç®¡ç† Bean å®šä¹‰ï¼ˆ<code>BeanDefinition</code>ï¼‰çš„èƒ½åŠ›ã€‚</p><p>å®ƒçš„å†…éƒ¨é€šè¿‡ä¸¤ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„æ¥ç®¡ç† Bean çš„å®šä¹‰ä¿¡æ¯ ï¼š</p><ul><li><code>beanDefinitionMap</code>ï¼šä¸€ä¸ª <code>ConcurrentHashMap</code>ï¼Œç”¨äºå­˜å‚¨ Bean åç§°ä¸ <code>BeanDefinition</code>çš„æ˜ å°„å…³ç³»ã€‚</li><li><code>beanDefinitionNames</code>ï¼šä¸€ä¸ª <code>ArrayList</code>ï¼Œå­˜å‚¨æ‰€æœ‰å·²æ³¨å†Œçš„ Bean åç§°ã€‚</li></ul><p>æ³¨å†Œ Bean å®šä¹‰çš„æ–¹æ³•å¦‚ä¸‹ ï¼š</p><pre tabindex=0><code>public void registerBeanDefinition(String beanName, BeanDefinition beanDefinition) {
    this.beanDefinitionMap.put(beanName, beanDefinition);
    this.beanDefinitionNames.add(beanName);
}
</code></pre><h3 id=-bean-çš„åŠ è½½æµç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ>ğŸ”„ Bean çš„åŠ è½½æµç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ</h3><p>å½“ä½ è°ƒç”¨ <code>getBean()</code>æ–¹æ³•æ—¶ï¼ŒSpring ä¼šè§¦å‘ä¸€ç³»åˆ—å¤æ‚çš„å†…éƒ¨æµç¨‹æ¥åˆ›å»ºæˆ–è·å– Bean å®ä¾‹ã€‚å…¶ç®€åŒ–åçš„æ ¸å¿ƒè°ƒç”¨é“¾å¦‚ä¸‹ ï¼š</p><p><code>getBean()</code>â†’ <code>doGetBean()</code>â†’ <code>getSingleton()</code>ï¼ˆå°è¯•ä»ç¼“å­˜è·å–ï¼‰â†’ <code>createBean()</code>â†’ <code>doCreateBean()</code>â†’ <code>populateBean()</code>ï¼ˆå±æ€§æ³¨å…¥ï¼‰â†’ <code>initializeBean()</code>ï¼ˆåˆå§‹åŒ–ï¼‰</p><p>ä¸€ä¸ª Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ ï¼š</p><ol><li><strong>å®ä¾‹åŒ–</strong>ï¼šé€šè¿‡æ„é€ æ–¹æ³•æˆ–å·¥å‚æ–¹æ³•åˆ›å»º Bean çš„å®ä¾‹ã€‚</li><li><strong>å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</strong>ï¼šå°† Bean æ‰€ä¾èµ–çš„å…¶ä»– Bean æˆ–å€¼æ³¨å…¥åˆ°å¯¹åº”å±æ€§ä¸­ã€‚</li><li><strong>Aware æ¥å£å›è°ƒ</strong>ï¼šå¦‚æœ Bean å®ç°äº†è¯¸å¦‚ <code>BeanNameAware</code>ã€<code>BeanFactoryAware</code>ç­‰æ¥å£ï¼Œå®¹å™¨ä¼šå›è°ƒç›¸åº”æ–¹æ³•ã€‚</li><li><strong>BeanPostProcessor å‰ç½®å¤„ç†</strong>ï¼šè°ƒç”¨æ‰€æœ‰ <code>BeanPostProcessor</code>çš„ <code>postProcessBeforeInitialization</code>æ–¹æ³•ã€‚</li><li><strong>åˆå§‹åŒ–</strong>ï¼šæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚ <code>@PostConstruct</code>æ³¨è§£çš„æ–¹æ³•ã€<code>InitializingBean</code>æ¥å£çš„ <code>afterPropertiesSet</code>æ–¹æ³•æˆ–è‡ªå®šä¹‰çš„ <code>init-method</code>ã€‚</li><li><strong>BeanPostProcessor åç½®å¤„ç†</strong>ï¼šè°ƒç”¨æ‰€æœ‰ <code>BeanPostProcessor</code>çš„ <code>postProcessAfterInitialization</code>æ–¹æ³•ã€‚<strong>AOP ä»£ç†é€šå¸¸åœ¨æ­¤é˜¶æ®µç”Ÿæˆ</strong>ã€‚</li><li><strong>ä½¿ç”¨</strong>ï¼šBean å®Œå…¨å°±ç»ªï¼Œå¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚</li><li><strong>é”€æ¯</strong>ï¼šå®¹å™¨å…³é—­æ—¶ï¼Œæ‰§è¡Œé”€æ¯æ–¹æ³•ï¼Œå¦‚ <code>@PreDestroy</code>æ³¨è§£çš„æ–¹æ³•ã€<code>DisposableBean</code>æ¥å£çš„ <code>destroy</code>æ–¹æ³•æˆ–è‡ªå®šä¹‰çš„ <code>destroy-method</code>ã€‚</li></ol><h3 id=-beanfactory-ä¸-applicationcontext-çš„å…³ç³»>ğŸ”„ BeanFactory ä¸ ApplicationContext çš„å…³ç³»</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦ä¸”å¸¸è§çš„æ¦‚å¿µåŒºåˆ† ã€‚</p><ul><li><strong>BeanFactory</strong> æ˜¯ <strong>åŸºç¡€æ¥å£</strong>ï¼Œæä¾›äº† IoC å®¹å™¨æœ€æ ¸å¿ƒã€æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼ˆå¦‚ <code>getBean</code>ã€ä¾èµ–æ³¨å…¥ï¼‰ã€‚</li><li><strong>ApplicationContext</strong> æ˜¯ <strong>BeanFactory çš„å­æ¥å£</strong>ï¼Œåœ¨ç»§æ‰¿æ‰€æœ‰åŸºç¡€åŠŸèƒ½çš„åŒæ—¶ï¼Œå¢åŠ äº†å¤§é‡ä¼ä¸šçº§ç‰¹æ€§ï¼Œä½¿å…¶æˆä¸ºæ›´å¼ºå¤§çš„â€œåº”ç”¨ä¸Šä¸‹æ–‡â€ã€‚</li></ul><p><strong>ä¸»è¦åŒºåˆ«</strong> ï¼š</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§</th><th>BeanFactory</th><th>ApplicationContext</th></tr></thead><tbody><tr><td><strong>å®¹å™¨ç‰¹æ€§</strong></td><td>åŸºç¡€ IoC åŠŸèƒ½</td><td>BeanFactory çš„è¶…é›†ï¼Œå¢åŠ å›½é™…åŒ–ã€äº‹ä»¶å‘å¸ƒã€èµ„æºåŠ è½½ç­‰</td></tr><tr><td><strong>åŠ è½½ç­–ç•¥</strong></td><td><strong>æŒ‰éœ€åŠ è½½ (Lazy)</strong>ï¼Œåªæœ‰åœ¨è°ƒç”¨ <code>getBean()</code>æ—¶æ‰å®ä¾‹åŒ– Bean</td><td><strong>é¢„åŠ è½½ (Eager)</strong>ï¼Œå®¹å™¨å¯åŠ¨æ—¶å³åˆ›å»ºæ‰€æœ‰å•ä¾‹ Beanï¼ˆå¯é…ç½®ï¼‰</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>èµ„æºæåº¦å—é™çš„åµŒå…¥å¼ç³»ç»Ÿç­‰</td><td>ç»å¤§å¤šæ•°æ ‡å‡†ä¼ä¸šçº§åº”ç”¨ï¼Œæ˜¯ Spring Boot çš„é»˜è®¤é€‰æ‹©</td></tr></tbody></table></div><p>ç®€å•æ¥è¯´ï¼Œ<strong>ApplicationContext æ˜¯åŠŸèƒ½æ›´å…¨é¢çš„ BeanFactory</strong>ã€‚åœ¨ç°ä»£ Spring åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯ç›´æ¥ä½¿ç”¨ <code>ApplicationContext</code>ï¼ˆå¦‚ <code>AnnotationConfigApplicationContext</code>ï¼‰ï¼Œä½†å®ƒçš„åº•å±‚æ ¸å¿ƒä¾ç„¶æ˜¯ <code>BeanFactory</code>ã€‚</p><h3 id=-æ³¨æ„beanfactory-ä¸-factorybean-çš„åŒºåˆ«>âš ï¸ æ³¨æ„ï¼šBeanFactory ä¸ FactoryBean çš„åŒºåˆ«</h3><p>è¿™ä¸¤ä¸ªåç§°ç›¸ä¼¼ä½†<strong>å®Œå…¨ä¸åŒ</strong>ï¼Œææ˜“æ··æ·† ã€‚</p><ul><li><strong>BeanFactory</strong>ï¼šæ˜¯ <strong>IoC å®¹å™¨æœ¬èº«</strong>ï¼Œæ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥å‚ï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç†<strong>æ‰€æœ‰</strong> Beanã€‚</li><li><strong>FactoryBean</strong>ï¼šæ˜¯ä¸€ä¸ª<strong>ç‰¹æ®Šçš„ Bean</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªèƒ½ç”Ÿäº§å…¶ä»– Bean çš„å·¥å‚ã€‚å½“ä½ å‘å®¹å™¨è·å–ä¸€ä¸ª <code>FactoryBean</code>æ—¶ï¼Œé»˜è®¤å¾—åˆ°çš„æ˜¯å®ƒ <code>getObject()</code>æ–¹æ³•è¿”å›çš„äº§å“å¯¹è±¡ã€‚å¦‚æœä½ æƒ³è·å– <code>FactoryBean</code>æœ¬èº«ï¼Œéœ€è¦åœ¨ Bean åç§°å‰åŠ  <code>&</code>ç¬¦å·ï¼ˆä¾‹å¦‚ <code>getBean("&amp;myFactoryBean")</code>ï¼‰ã€‚</li></ul><p><strong>æ¯”å–»ç†è§£</strong>ï¼š</p><ul><li><strong>BeanFactory</strong> å°±åƒæ˜¯ä¸€å®¶<strong>æ±½è½¦åˆ¶é€ å‚</strong>ï¼Œå®ƒèƒ½ç”Ÿäº§å„ç§æ±½è½¦ï¼ˆBeanï¼‰ã€‚</li><li><strong>FactoryBean</strong> å°±åƒæ˜¯è¿™å®¶å·¥å‚é‡Œä¸€æ¡<strong>ç‰¹æ®Šçš„ç”Ÿäº§çº¿</strong>ï¼Œè¿™æ¡ç”Ÿäº§çº¿æœ¬èº«ä¹Ÿéœ€è¦åœ¨å·¥å‚é‡Œæ³¨å†Œï¼ˆå®ƒæ˜¯ä¸€ä¸ª Beanï¼‰ï¼Œä½†å®ƒä¸“é—¨è´Ÿè´£ç”Ÿäº§æŸç§ç‰¹å®šå‹å·çš„å‘åŠ¨æœºï¼ˆå¦ä¸€ä¸ª Beanï¼‰ã€‚</li></ul><h3 id=-æ€»ç»“-10>ğŸ’ æ€»ç»“</h3><p>BeanFactory æ˜¯ Spring æ¡†æ¶çš„åŸºçŸ³ï¼Œç†è§£äº†å®ƒå°±æŠ“ä½äº† Spring IoC çš„æ ¸å¿ƒã€‚å®ƒé€šè¿‡å°†å¯¹è±¡çš„åˆ›å»ºã€ç»„è£…å’Œç®¡ç†æƒä»ä»£ç ä¸­å‰¥ç¦»ï¼Œäº¤ç”±å®¹å™¨ç»Ÿä¸€å¤„ç†ï¼Œæå¤§åœ°æé«˜äº†ç¨‹åºçš„çµæ´»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚è™½ç„¶åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬æ›´å¤šåœ°ä½¿ç”¨å…¶å­æ¥å£ ApplicationContextï¼Œä½†å®ƒçš„è®¾è®¡æ€æƒ³å’Œè¿ä½œæœºåˆ¶æ˜¯æ·±å…¥æŒæ¡ Spring çš„å…³é”®ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ é€å½»ç†è§£ BeanFactoryã€‚å¦‚æœä½ å¯¹ Bean çš„ç”Ÿå‘½å‘¨æœŸç»†èŠ‚ã€æ‰©å±•ç‚¹ï¼ˆå¦‚ BeanPostProcessorï¼‰æˆ–å…¶ä»–ç›¸å…³ä¸»é¢˜æœ‰è¿›ä¸€æ­¥çš„å…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚</p><h2 id=å­ç±»>å­ç±»</h2><p><code>ConfigurableListableBeanFactory</code>åŠå…¶ç›¸å…³çš„å­æ¥å£æ˜¯ Spring IoC å®¹å™¨çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬é€šè¿‡<strong>èŒè´£åˆ†ç¦»å’ŒåŠŸèƒ½ç»„åˆ</strong>çš„æ–¹å¼ï¼Œä¸º Spring å®¹å™¨æä¾›äº†é«˜åº¦å¯é…ç½®å’Œå¯æ‰©å±•çš„èƒ½åŠ›ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¸…æ™°åœ°å±•ç¤ºäº†è¿™äº›å…³é”®æ¥å£çš„æ ¸å¿ƒèŒè´£ã€‚</p><div class=table-wrapper><table><thead><tr><th>æ¥å£åç§°</th><th>æ ¸å¿ƒèŒè´£</th><th>å…³é”®ç‰¹æ€§</th></tr></thead><tbody><tr><td><strong><code>ConfigurableBeanFactory</code></strong></td><td>æä¾› Bean å·¥å‚çš„<strong>åŸºç¡€é…ç½®èƒ½åŠ›</strong></td><td>è®¾ç½®ç±»åŠ è½½å™¨ã€ç±»å‹è½¬æ¢æœåŠ¡ã€å±æ€§ç¼–è¾‘å™¨ã€ä½œç”¨åŸŸï¼ˆå•ä¾‹/åŸå‹ï¼‰ç®¡ç†ç­‰ã€‚</td></tr><tr><td><strong><code>ListableBeanFactory</code></strong></td><td>æä¾› Bean çš„<strong>åˆ—ä¸¾å’ŒæŸ¥è¯¢èƒ½åŠ›</strong></td><td>æ‰¹é‡è·å– Bean åç§°ã€æ ¹æ®ç±»å‹è·å–æ‰€æœ‰ Bean å®ä¾‹ã€æ£€æŸ¥ Bean å®šä¹‰ç­‰ã€‚</td></tr><tr><td><strong><code>AutowireCapableBeanFactory</code></strong></td><td>æä¾› Bean çš„<strong>è‡ªåŠ¨è£…é…å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>èƒ½åŠ›</td><td>åœ¨å®¹å™¨å¤–åˆ›å»ºã€é…ç½®å’Œè£…é… Bean å®ä¾‹ï¼Œå¤„ç†ä¾èµ–æ³¨å…¥ã€‚</td></tr><tr><td><strong><code>ConfigurableListableBeanFactory</code></strong></td><td><strong>ä¸Šè¿°æ‰€æœ‰æ¥å£åŠŸèƒ½çš„é›†å¤§æˆè€…</strong>ï¼Œæ˜¯åŠŸèƒ½æœ€å®Œæ•´çš„ Bean å·¥å‚</td><td>ç»§æ‰¿ä»¥ä¸Šæ‰€æœ‰æ¥å£ï¼Œæ”¯æŒ Bean å®šä¹‰çš„æ³¨å†Œã€å†»ç»“ã€é¢„å®ä¾‹åŒ–ç­‰é«˜çº§æ“ä½œã€‚</td></tr></tbody></table></div><h3 id=-å„æ¥å£çš„è¯¦ç»†ä½œç”¨>ğŸ’¡ å„æ¥å£çš„è¯¦ç»†ä½œç”¨</h3><h4 id=1-configurablebeanfactoryåŸºç¡€é…ç½®çš„åŸºçŸ³>1. ConfigurableBeanFactoryï¼šåŸºç¡€é…ç½®çš„åŸºçŸ³</h4><p><code>ConfigurableBeanFactory</code>ä¸º Bean å·¥å‚æä¾›äº†åº•å±‚çš„é…ç½®èƒ½åŠ›ï¼Œæ˜¯è¿›è¡Œç²¾ç»†åŒ–ç®¡ç†çš„åŸºç¡€ã€‚å®ƒçš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š</p><ul><li><strong>ç®¡ç†ä½œç”¨åŸŸ</strong>ï¼šå…è®¸è®¾ç½® Bean æ˜¯å•ä¾‹ï¼ˆSingletonï¼‰è¿˜æ˜¯åŸå‹ï¼ˆPrototypeï¼‰ã€‚</li><li><strong>å¤„ç†ä¾èµ–</strong>ï¼šå¯é…ç½®æ˜¯å¦å…è®¸ Bean ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ã€‚</li><li><strong>ç±»å‹è½¬æ¢</strong>ï¼šè®¾ç½® <code>TypeConverter</code>å’Œ <code>PropertyEditorRegistrar</code>ï¼Œç”¨äºå¤„ç†å±æ€§å€¼çš„ç±»å‹è½¬æ¢ã€‚</li><li><strong>ç®¡ç†åç½®å¤„ç†å™¨</strong>ï¼šæ³¨å†Œ <code>BeanPostProcessor</code>ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ Bean åˆå§‹åŒ–å‰åä»‹å…¥å¤„ç†ã€‚</li><li><strong>æ³¨å†Œå•ä¾‹å¯¹è±¡</strong>ï¼šæä¾›æ–¹æ³•ç›´æ¥æ³¨å†Œå·²æœ‰çš„å•ä¾‹å¯¹è±¡åˆ°å®¹å™¨ä¸­ã€‚</li></ul><h4 id=2-listablebeanfactoryå¼ºå¤§çš„æŸ¥è¯¢ä¸åˆ—ä¸¾å·¥å…·>2. ListableBeanFactoryï¼šå¼ºå¤§çš„æŸ¥è¯¢ä¸åˆ—ä¸¾å·¥å…·</h4><p><code>ListableBeanFactory</code>çš„æ ¸å¿ƒä»·å€¼åœ¨äºå…¶<strong>æ‰¹é‡æ“ä½œå’ŒæŸ¥è¯¢èƒ½åŠ›</strong>ï¼Œè¿™æ˜¯åŸºç¡€çš„ <code>BeanFactory</code>æ¥å£æ‰€ä¸å…·å¤‡çš„ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥ï¼š</p><ul><li><strong>è·å–æ‰€æœ‰ Bean çš„åç§°</strong>ï¼š<code>String[] getBeanDefinitionNames()</code>æ–¹æ³•å¯ä»¥æ‹¿åˆ°å®¹å™¨ä¸­æ‰€æœ‰ Bean å®šä¹‰çš„åç§°ã€‚</li><li><strong>æŒ‰ç±»å‹æŸ¥æ‰¾ Bean</strong>ï¼š<code>&lt;T> Map&lt;String, T> getBeansOfType(@Nullable Class&lt;T> type)</code>æ–¹æ³•èƒ½è·å–æ‰€æœ‰åŒ¹é…æŒ‡å®šç±»å‹çš„ Bean å®ä¾‹åŠå…¶åç§°ã€‚</li><li><strong>æ£€æŸ¥æ³¨è§£</strong>ï¼š<code>String[] getBeanNamesForAnnotation(Class&lt;? extends Annotation> annotationType)</code>æ–¹æ³•å¯ä»¥æ‰¾åˆ°æ‰€æœ‰å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„ Bean åç§°ã€‚</li></ul><h4 id=3-autowirecapablebeanfactoryå®¹å™¨å¤–çš„è£…é…å·¥>3. AutowireCapableBeanFactoryï¼šå®¹å™¨å¤–çš„è£…é…å·¥</h4><p><code>AutowireCapableBeanFactory</code>æ‰©å±•äº† Bean çš„åˆ›å»ºå’Œè£…é…æ–¹å¼ï¼Œä½¿å…¶ä¸ä»…èƒ½åœ¨å®¹å™¨å†…éƒ¨å·¥ä½œï¼Œè¿˜èƒ½<strong>åœ¨å®¹å™¨å¤–éƒ¨ç‹¬ç«‹å®Œæˆ Bean çš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–è¿‡ç¨‹</strong>ã€‚è¿™åœ¨é›†æˆç¬¬ä¸‰æ–¹æ¡†æ¶æˆ–éœ€è¦åœ¨é Spring ç®¡ç†ç¯å¢ƒä¸­åˆ›å»º Bean æ—¶éå¸¸æœ‰ç”¨ã€‚å…¶ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><code>createBean(Class&lt;T> beanClass)</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹å¹¶å®Œæˆå…¶ä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–ã€‚</li><li><code>autowireBean(Object existingBean)</code>ï¼šå¯¹ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚</li><li><code>configureBean(Object existingBean, String beanName)</code>ï¼šé…ç½®ä¸€ä¸ªå·²å­˜åœ¨çš„ Beanï¼ŒåŒ…æ‹¬ä¾èµ–æ³¨å…¥å’Œåº”ç”¨åç½®å¤„ç†å™¨ã€‚</li></ul><h4 id=4-configurablelistablebeanfactoryåŠŸèƒ½å…¨é›†æˆçš„ç»ˆæå½¢æ€>4. ConfigurableListableBeanFactoryï¼šåŠŸèƒ½å…¨é›†æˆçš„ç»ˆæå½¢æ€</h4><p><code>ConfigurableListableBeanFactory</code>æ˜¯ Spring å®¹å™¨ä¸­<strong>åŠŸèƒ½æœ€å¼ºå¤§ã€æœ€æ ¸å¿ƒçš„ Bean å·¥å‚æ¥å£</strong>ã€‚å®ƒç»§æ‰¿äº†ä¸Šè¿°æ‰€æœ‰æ¥å£ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†å…³é”®åŠŸèƒ½ï¼š</p><ul><li><p><strong>æ³¨å†Œå’Œå†»ç»“ Bean å®šä¹‰</strong>ï¼šå¯ä»¥ç¼–ç¨‹å¼åœ°æ³¨å†Œæ–°çš„ <code>BeanDefinition</code>ï¼Œå¹¶å¯ä»¥â€œå†»ç»“â€æ‰€æœ‰ Bean å®šä¹‰ï¼Œé˜²æ­¢åç»­ä¿®æ”¹ã€‚</p></li><li><p><strong>é¢„å®ä¾‹åŒ–å•ä¾‹ Bean</strong>ï¼šç¡®ä¿æ‰€æœ‰éå»¶è¿ŸåŠ è½½çš„å•ä¾‹ Bean åœ¨å®¹å™¨å¯åŠ¨æ—¶å°±è¢«åˆ›å»ºå¥½ã€‚</p></li><li><p><strong>è§£æä¾èµ–</strong>ï¼šå½“å­˜åœ¨æœªè§£æçš„ä¾èµ–æ—¶ï¼ˆå¦‚ <code>@Autowired</code>æ³¨å…¥çš„å€™é€‰ Bean æœ‰å¤šä¸ªï¼‰ï¼Œå®ƒå¯ä»¥ä½œä¸ºå†³ç­–è€…ä»‹å…¥ã€‚</p><p>åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆå¦‚ <code>AnnotationConfigApplicationContext</code>ï¼‰çš„å¯åŠ¨æµç¨‹ä¸­ï¼Œ<code>refresh()</code>æ–¹æ³•çš„æ ¸å¿ƒæ­¥éª¤ä¹‹ä¸€å°±æ˜¯è·å–ä¸€ä¸ª <code>ConfigurableListableBeanFactory</code>å®ä¾‹ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œ Bean å®šä¹‰çš„åŠ è½½ã€åç½®å¤„ç†å™¨çš„æ³¨å†Œä»¥åŠå•ä¾‹ Bean çš„é¢„å®ä¾‹åŒ–ã€‚</p></li></ul><h3 id=-ä¸»è¦å®ç°defaultlistablebeanfactory>ğŸ› ï¸ ä¸»è¦å®ç°ï¼šDefaultListableBeanFactory</h3><p><code>DefaultListableBeanFactory</code>æ˜¯ <code>ConfigurableListableBeanFactory</code>æ¥å£çš„<strong>é»˜è®¤ä¸”æœ€å¸¸ç”¨çš„å®ç°ç±»</strong>ã€‚å®ƒæ˜¯æ•´ä¸ª Spring IoC å®¹å™¨çš„åŸºç¡€ï¼Œæ— è®ºæ˜¯åŸºäº XML çš„ç»å…¸é…ç½®è¿˜æ˜¯ç°ä»£çš„æ³¨è§£é…ç½®ï¼Œå…¶åº•å±‚æœ€ç»ˆéƒ½ä¼šä½¿ç”¨ <code>DefaultListableBeanFactory</code>ã€‚</p><ul><li>å®ƒå†…éƒ¨ä½¿ç”¨ä¸€ä¸ª <code>ConcurrentHashMap</code>ï¼ˆé€šå¸¸æ˜¯ <code>beanDefinitionMap</code>ï¼‰æ¥å­˜å‚¨æ‰€æœ‰ Bean çš„å®šä¹‰ï¼ˆ<code>BeanDefinition</code>ï¼‰ã€‚</li><li>Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆ<code>ApplicationContext</code>ï¼‰å®é™…ä¸Š<strong>æŒæœ‰ä¸€ä¸ª <code>DefaultListableBeanFactory</code>å®ä¾‹ä½œä¸ºå…¶å§”æ‰˜çš„ Bean å·¥å‚</strong>ï¼Œè®¸å¤šå…·ä½“çš„ Bean ç®¡ç†æ“ä½œéƒ½å§”æ‰˜ç»™è¿™ä¸ªå®ä¾‹æ‰§è¡Œã€‚</li></ul><h3 id=-åœ¨-spring-å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²>ğŸ”„ åœ¨ Spring å¯åŠ¨æµç¨‹ä¸­çš„è§’è‰²</h3><p>è¿™äº›æ¥å£ï¼Œç‰¹åˆ«æ˜¯ <code>ConfigurableListableBeanFactory</code>ï¼Œåœ¨ Spring å®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚ä»¥ <code>AbstractApplicationContext.refresh()</code>æ–¹æ³•ä¸ºä¾‹ï¼š</p><ol><li><strong><code>obtainFreshBeanFactory()</code></strong>ï¼šæ­¤æ–¹æ³•ä¼šè§¦å‘ Bean å·¥å‚çš„åˆ›å»ºå’Œåˆ·æ–°ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ª <code>ConfigurableListableBeanFactory</code>ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼ˆå¦‚ XMLï¼‰ï¼Œè§£æå‡ºæ‰€æœ‰çš„ <code>BeanDefinition</code>å¹¶æ³¨å†Œåˆ°å·¥å‚ä¸­ã€‚</li><li><strong><code>prepareBeanFactory(beanFactory)</code></strong>ï¼šåœ¨æ­¤é˜¶æ®µï¼ŒSpring ä¼šå¯¹è·å–åˆ°çš„ <code>ConfigurableListableBeanFactory</code>è¿›è¡Œä¸€ç³»åˆ—é…ç½®ï¼Œä¾‹å¦‚è®¾ç½®ç±»åŠ è½½å™¨ã€æ³¨å†Œä¸€äº›å†…ç½®çš„ Beanï¼ˆå¦‚ <code>Environment</code>ï¼‰ä»¥åŠæ·»åŠ å…³é”®çš„ <code>BeanPostProcessor</code>ï¼ˆå¦‚å¤„ç† <code>@Autowired</code>çš„ <code>AutowiredAnnotationBeanPostProcessor</code>ï¼‰ã€‚</li><li><strong><code>invokeBeanFactoryPostProcessors(beanFactory)</code></strong>ï¼šè°ƒç”¨æ‰€æœ‰ <code>BeanFactoryPostProcessor</code>ï¼Œå®ƒä»¬å¯ä»¥æ‹¿åˆ° <code>ConfigurableListableBeanFactory</code>å¹¶å¯¹å…¶ä¸­çš„ <code>BeanDefinition</code>è¿›è¡Œä¿®æ”¹æˆ–å¢å¼ºã€‚è¿™æ˜¯ Spring æ‰©å±•æ€§çš„ä¸€å¤§ä½“ç°ã€‚</li><li><strong><code>finishBeanFactoryInitialization(beanFactory)</code></strong>ï¼šè¿™æ˜¯æœ€åä¸€æ­¥ï¼Œ<code>ConfigurableListableBeanFactory</code>ä¼šè´Ÿè´£å®ä¾‹åŒ–æ‰€æœ‰éå»¶è¿ŸåŠ è½½çš„å•ä¾‹ Beanï¼Œå®Œæˆä¾èµ–æ³¨å…¥ï¼Œå¹¶æ‰§è¡Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ã€‚</li></ol><h3 id=-æ€»ç»“-11>ğŸ’ æ€»ç»“</h3><p>ç®€å•æ¥è¯´ï¼ŒSpring é€šè¿‡å°† <code>BeanFactory</code>çš„åŠŸèƒ½åˆ†è§£ä¸ºå¤šä¸ªç‰¹å®šçš„å­æ¥å£ï¼Œå†é€šè¿‡ <code>ConfigurableListableBeanFactory</code>è¿›è¡Œæ•´åˆï¼Œå®ç°äº†<strong>é«˜å†…èšã€ä½è€¦åˆ</strong>çš„è®¾è®¡ã€‚è¿™ç§è®¾è®¡ä½¿å¾— Spring å®¹å™¨æ—¢å…·å¤‡äº†å¼ºå¤§çš„åŸºç¡€åŠŸèƒ½ï¼Œåˆä¿æŒäº†æé«˜çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ¸…æ™°åœ°ç†è§£è¿™äº› BeanFactory å­æ¥å£çš„ä¸åŒä½œç”¨ã€‚</p><h2 id=beandefinitionregistry>BeanDefinitionRegistry</h2><p><code>BeanDefinitionRegistry</code>æ˜¯ Spring IoC å®¹å™¨ä¸­<strong>ç®¡ç† Bean å®šä¹‰ï¼ˆ<code>BeanDefinition</code>ï¼‰çš„æ ¸å¿ƒæ³¨å†Œæ¥å£</strong>ï¼Œå®ƒè´Ÿè´£æ³¨å†Œã€ç§»é™¤ã€æŸ¥è¯¢å’Œç®¡ç†æ‰€æœ‰ Bean çš„é…ç½®å…ƒæ•°æ®ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¸…æ™°åœ°å±•ç¤ºäº†å®ƒçš„æ ¸å¿ƒèŒè´£å’Œä¸»è¦å®ç°ç±»ã€‚</p><p>| ç‰¹æ€§ç»´åº¦ | æ ¸å¿ƒè¯´æ˜ |</p><p>| :&mdash; | :&mdash; | :&mdash; |</p><p>| <strong>æ ¸å¿ƒè§’è‰²</strong> | Bean å®šä¹‰ï¼ˆ<code>BeanDefinition</code>ï¼‰çš„æ³¨å†Œä¸­å¿ƒï¼Œæ˜¯ Spring IoC å®¹å™¨çš„â€œåå†Œâ€æˆ–â€œèŠ±åå†Œâ€ã€‚ |</p><p>| <strong>ä¸»è¦èŒè´£</strong> | æä¾›å¯¹ <code>BeanDefinition</code>çš„<strong>å¢åˆ æ”¹æŸ¥</strong>ç­‰æ“ä½œï¼Œæ˜¯ Spring å®¹å™¨ç®¡ç† Bean å…ƒæ•°æ®çš„ç»Ÿä¸€å…¥å£ã€‚ |</p><p>| <strong>å…³é”®ç‰¹æ€§</strong> | æ”¯æŒåˆ«åç®¡ç†ã€Bean å®šä¹‰è¦†ç›–ç­–ç•¥ã€åˆå¹¶çˆ¶å­ Bean å®šä¹‰ã€çº¿ç¨‹å®‰å…¨çš„æ³¨å†Œè¡¨æ“ä½œã€‚ |</p><p>| <strong>æ ¸å¿ƒå®ç°</strong> | <code>DefaultListableBeanFactory</code>ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€<code>GenericApplicationContext</code>ã€<code>SimpleBeanDefinitionRegistry</code>ï¼ˆç”¨äºæµ‹è¯•ï¼‰ã€‚ |</p><h3 id=-æ ¸å¿ƒæ¥å£æ–¹æ³•>ğŸ’¡ æ ¸å¿ƒæ¥å£æ–¹æ³•</h3><p><code>BeanDefinitionRegistry</code>æ¥å£å®šä¹‰äº†ä¸€å¥—å®Œæ•´çš„æ–¹æ³•æ¥ç®¡ç† Bean å®šä¹‰ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š</p><ul><li><p><strong>æ³¨å†Œ Bean å®šä¹‰</strong>ï¼š</p><p><code>void registerBeanDefinition(String beanName, BeanDefinition beanDefinition) throws BeanDefinitionStoreException;</code></p></li><li><p><strong>ç§»é™¤ Bean å®šä¹‰</strong>ï¼š</p><p><code>void removeBeanDefinition(String beanName) throws NoSuchBeanDefinitionException;</code></p></li><li><p><strong>è·å– Bean å®šä¹‰</strong>ï¼š</p><p><code>BeanDefinition getBeanDefinition(String beanName) throws NoSuchBeanDefinitionException;</code></p></li><li><p><strong>æ£€æŸ¥æ˜¯å¦å­˜åœ¨</strong>ï¼š</p><p><code>boolean containsBeanDefinition(String beanName);</code></p></li><li><p><strong>è·å–æ‰€æœ‰ Bean åç§°</strong>ï¼š</p><p><code>String[] getBeanDefinitionNames();</code></p></li><li><p><strong>è·å– Bean å®šä¹‰æ•°é‡</strong>ï¼š</p><p><code>int getBeanDefinitionCount();</code></p></li><li><p><strong>æ£€æŸ¥åç§°æ˜¯å¦å·²ä½¿ç”¨</strong>ï¼š</p><p><code>boolean isBeanNameInUse(String beanName);</code></p></li></ul><h3 id=-ä¸»è¦å®ç°ç±»-2>ğŸ› ï¸ ä¸»è¦å®ç°ç±»</h3><p>Spring æä¾›äº†å‡ ä¸ªé‡è¦çš„ <code>BeanDefinitionRegistry</code>å®ç°ç±»ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š</p><ol><li><strong><code>DefaultListableBeanFactory</code></strong>ï¼šè¿™æ˜¯<strong>æœ€å¸¸ç”¨ã€åŠŸèƒ½æœ€å®Œæ•´</strong>çš„å®ç°ã€‚å®ƒä¸ä»…æ˜¯ <code>BeanDefinitionRegistry</code>ï¼Œè¿˜æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ <code>BeanFactory</code>ã€‚å®ƒå†…éƒ¨ä½¿ç”¨ <code>ConcurrentHashMap</code>æ¥å­˜å‚¨ Bean å®šä¹‰ï¼Œç¡®ä¿äº†çº¿ç¨‹å®‰å…¨ã€‚Spring çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆå¦‚ <code>AnnotationConfigApplicationContext</code>ï¼‰å†…éƒ¨é€šå¸¸ä¹Ÿå§”æ‰˜ç»™å®ƒæ¥å¤„ç† Bean å®šä¹‰çš„æ³¨å†Œã€‚</li><li><strong><code>GenericApplicationContext</code></strong>ï¼šä½œä¸ºé€šç”¨çš„ <code>ApplicationContext</code>ï¼Œå®ƒå®ç°äº† <code>BeanDefinitionRegistry</code>æ¥å£ï¼Œä½†å…¶å†…éƒ¨å…³äº Bean å®šä¹‰æ³¨å†Œçš„å…·ä½“å®ç°é€šå¸¸<strong>å§”æ‰˜ç»™ä¸€ä¸ª <code>DefaultListableBeanFactory</code></strong> å®ä¾‹æ¥å®Œæˆã€‚</li><li><strong><code>SimpleBeanDefinitionRegistry</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<strong>ç®€å•çš„å®ç°</strong>ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–å·¥å…·åœºæ™¯ã€‚å®ƒä»…æä¾›äº†åŸºæœ¬çš„æ³¨å†Œè¡¨åŠŸèƒ½ï¼Œä¸å…·å¤‡å®Œæ•´çš„ Bean å·¥å‚èƒ½åŠ›ï¼ˆå¦‚ä¾èµ–æ³¨å…¥ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰ã€‚</li></ol><h3 id=-å·¥ä½œåŸç†ä¸å†…éƒ¨ç»“æ„>âš™ï¸ å·¥ä½œåŸç†ä¸å†…éƒ¨ç»“æ„</h3><p>ä»¥æœ€å¸¸ç”¨çš„ <code>DefaultListableBeanFactory</code>ä¸ºä¾‹ï¼Œå…¶å†…éƒ¨é€šè¿‡ä¸¤ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„æ¥ç®¡ç† Bean å®šä¹‰ï¼š</p><ul><li><strong><code>beanDefinitionMap</code></strong>ï¼šä¸€ä¸ª <code>ConcurrentHashMap&lt;String, BeanDefinition></code>ï¼Œç”¨äºå­˜å‚¨ Bean åç§°ä¸ <code>BeanDefinition</code>å¯¹è±¡çš„æ˜ å°„å…³ç³»ã€‚è¿™æ˜¯çœŸæ­£çš„å®šä¹‰å­˜å‚¨å®¹å™¨ã€‚</li><li><strong><code>beanDefinitionNames</code></strong>ï¼šä¸€ä¸ª <code>ArrayList&lt;String></code>ï¼ŒæŒ‰æ³¨å†Œé¡ºåºä¿å­˜æ‰€æœ‰ Bean çš„åç§°ã€‚è¿™ç»´æŠ¤äº† Bean çš„æ³¨å†Œé¡ºåºã€‚</li></ul><p><strong>æ³¨å†Œæµç¨‹</strong>ï¼ˆæ‘˜è‡ª <code>DefaultListableBeanFactory.registerBeanDefinition</code>æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘ï¼‰ï¼š</p><ol><li><strong>å‚æ•°æ ¡éªŒ</strong>ï¼šæ£€æŸ¥ <code>beanName</code>å’Œ <code>beanDefinition</code>æ˜¯å¦ä¸ºç©ºã€‚</li><li><strong>å®šä¹‰éªŒè¯</strong>ï¼šå¦‚æœ <code>BeanDefinition</code>æ˜¯ <code>AbstractBeanDefinition</code>ç±»å‹ï¼Œä¼šè°ƒç”¨å…¶ <code>validate()</code>æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼Œä¾‹å¦‚æ£€æŸ¥æ–¹æ³•è¦†ç›–ï¼ˆ<code>lookup-method</code>, <code>replaced-method</code>ï¼‰å’Œå·¥å‚æ–¹æ³•æ˜¯å¦å†²çªã€‚</li><li><strong>å¤„ç†è¦†ç›–</strong>ï¼šæ£€æŸ¥è¯¥ <code>beanName</code>æ˜¯å¦å·²å­˜åœ¨å®šä¹‰ã€‚<ul><li>å¦‚æœå­˜åœ¨ï¼Œæ ¹æ® <code>isAllowBeanDefinitionOverriding()</code>çš„é…ç½®å†³å®šæ˜¯æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯è¦†ç›–åŸæœ‰å®šä¹‰ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†æ–°å®šä¹‰æ”¾å…¥ <code>beanDefinitionMap</code>ï¼Œå¹¶å°† <code>beanName</code>æ·»åŠ åˆ° <code>beanDefinitionNames</code>åˆ—è¡¨ä¸­ã€‚</li></ul></li><li><strong>çŠ¶æ€å¤„ç†</strong>ï¼šæ ¹æ®å®¹å™¨æ˜¯å¦å·²å¼€å§‹åˆ›å»º Beanï¼ˆ<code>hasBeanCreationStarted()</code>ï¼‰ï¼Œé‡‡ç”¨ä¸åŒçš„åŒæ­¥ç­–ç•¥æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li></ol><h3 id=-ä¸»è¦ä½œç”¨ä¸ä»·å€¼>ğŸ¯ ä¸»è¦ä½œç”¨ä¸ä»·å€¼</h3><p><code>BeanDefinitionRegistry</code>åœ¨ Spring æ¡†æ¶ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå…¶æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ï¼š</p><ol><li><strong>èµ„æºè§£æçš„ç»Ÿä¸€æ€§</strong>ï¼šæ— è®º Bean å®šä¹‰æ¥è‡ª XMLã€æ³¨è§£è¿˜æ˜¯ Java é…ç½®ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è§£æä¸ºç»Ÿä¸€çš„ <code>BeanDefinition</code>å¯¹è±¡å¹¶æ³¨å†Œåˆ° <code>BeanDefinitionRegistry</code>ä¸­ã€‚è¿™ä½¿å¾— Spring å®¹å™¨èƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†æ‰€æœ‰é…ç½®æºï¼Œé¿å…äº†ä¸ºæ¯ç§é…ç½®æ–¹å¼ç»´æŠ¤å•ç‹¬çš„æ•°æ®ç»“æ„ï¼Œé™ä½äº†å¤æ‚æ€§ã€‚</li><li><strong>ä¾èµ–æŸ¥æ‰¾å’Œæ³¨å…¥çš„ä¸­å¿ƒåŒ–</strong>ï¼šå®ƒä¸ºä¾èµ–æŸ¥æ‰¾å’Œæ³¨å…¥æä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å­˜å‚¨åº“ã€‚å½“ Spring éœ€è¦æ³¨å…¥ä¸€ä¸ªä¾èµ–æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»æ³¨å†Œè¡¨ä¸­å¿«é€ŸæŸ¥è¯¢å¯¹åº”çš„ <code>BeanDefinition</code>ï¼Œè€Œæ— éœ€é‡æ–°è§£æåŸå§‹é…ç½®èµ„æºï¼Œæå‡äº†æ€§èƒ½å¹¶ç¡®ä¿äº†å‡†ç¡®æ€§ã€‚</li><li><strong>æ”¯æŒ Bean å®šä¹‰çš„åˆå¹¶</strong>ï¼šåœ¨å¤„ç†çˆ¶å­ Bean å®šä¹‰ï¼ˆä¸»è¦åœ¨ XML é…ç½®ä¸­ï¼‰æ—¶ï¼Œ<code>BeanDefinitionRegistry</code>ï¼ˆå…·ä½“æ˜¯ <code>DefaultListableBeanFactory</code>ï¼‰è´Ÿè´£å°†å­å®šä¹‰å’Œçˆ¶å®šä¹‰åˆå¹¶ä¸ºä¸€ä¸ªå®Œæ•´çš„ <code>RootBeanDefinition</code>ï¼Œè¿™ä¸ªåˆå¹¶åçš„å®šä¹‰åŒ…å«äº†åˆ›å»º Bean å®ä¾‹æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚</li><li><strong>é…ç½®éªŒè¯</strong>ï¼šæ‰€æœ‰ Bean å®šä¹‰æ³¨å†Œå®Œæˆåï¼ŒSpring å¯ä»¥åˆ©ç”¨æ³¨å†Œè¡¨è¿›è¡Œå…¨å±€çš„é…ç½®éªŒè¯ï¼Œä¾‹å¦‚æ£€æŸ¥å¾ªç¯ä¾èµ–ã€ç¡®ä¿ Bean å®šä¹‰çš„å®Œæ•´æ€§ç­‰ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„åŸºç¡€</strong>ï¼šå®ƒå­˜å‚¨äº† Bean çš„åˆå§‹åŒ–æ–¹æ³•ã€é”€æ¯æ–¹æ³•ç­‰ç”Ÿå‘½å‘¨æœŸå…ƒæ•°æ®ï¼Œä¸º Spring å®¹å™¨ç®¡ç† Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæä¾›äº†åŸºç¡€ã€‚</li></ol><h3 id=-å¦‚ä½•ä½¿ç”¨>ğŸ’» å¦‚ä½•ä½¿ç”¨</h3><p>ä½ å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼ä½¿ç”¨ <code>BeanDefinitionRegistry</code>æ¥åŠ¨æ€æ³¨å†Œ Beanï¼Œè¿™åœ¨éœ€è¦æ ¹æ®æ¡ä»¶æˆ–è¿è¡Œæ—¶ä¿¡æ¯æ¥æ³¨å†Œ Bean æ—¶éå¸¸æœ‰ç”¨ã€‚</p><pre tabindex=0><code>import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.beans.factory.support.DefaultListableBeanFactory;
import org.springframework.beans.factory.support.RootBeanDefinition;

public class ManualRegistrationDemo {
    public static void main(String[] args) {
        // 1. åˆ›å»º BeanDefinitionRegistry (ä»¥ DefaultListableBeanFactory ä¸ºä¾‹)
        DefaultListableBeanFactory registry = new DefaultListableBeanFactory();
        
        // 2. åˆ›å»º BeanDefinitionï¼Œå¹¶è®¾ç½®å±æ€§ï¼ˆè¿™é‡Œä»¥ RootBeanDefinition ä¸ºä¾‹ï¼‰
        RootBeanDefinition beanDefinition = new RootBeanDefinition(MyService.class);
        beanDefinition.getPropertyValues().addPropertyValue(&#34;message&#34;, &#34;Hello, Dynamic Bean!&#34;);
        
        // 3. æ³¨å†Œåˆ° Registry ä¸­
        registry.registerBeanDefinition(&#34;myService&#34;, beanDefinition);
        
        // 4. ä»å®¹å™¨ä¸­è·å–å¹¶ä½¿ç”¨ Bean
        MyService myService = registry.getBean(&#34;myService&#34;, MyService.class);
        myService.sayMessage(); // è¾“å‡º: Hello, Dynamic Bean!
    }
}
</code></pre><p>åœ¨æ›´é«˜çº§çš„åœºæ™¯ä¸­ï¼Œä½ å¯ä»¥å®ç° <code>ImportBeanDefinitionRegistrar</code>æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶åŠ¨æ€æ³¨å†Œ Bean å®šä¹‰ï¼š</p><pre tabindex=0><code>import org.springframework.beans.factory.support.BeanDefinitionRegistry;
import org.springframework.context.annotation.ImportBeanDefinitionRegistrar;
import org.springframework.core.type.AnnotationMetadata;

public class MyCustomRegistrar implements ImportBeanDefinitionRegistrar {
    @Override
    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
        // åœ¨è¿™é‡Œå¯ä»¥æ ¹æ®æ³¨è§£å…ƒä¿¡æ¯åŠ¨æ€åˆ›å»ºå’Œæ³¨å†Œ BeanDefinition
        RootBeanDefinition beanDefinition = new RootBeanDefinition(MyDynamicBean.class);
        registry.registerBeanDefinition(&#34;myDynamicBean&#34;, beanDefinition);
    }
}
</code></pre><h3 id=-æ€»ç»“-12>ğŸ’ æ€»ç»“</h3><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>BeanDefinitionRegistry</code>æ˜¯ Spring IoC å®¹å™¨<strong>ä¸å¯æˆ–ç¼ºçš„åŸºçŸ³</strong>ã€‚å®ƒä½œä¸ºä¸€ä¸ªä¸­å¿ƒåŒ–çš„æ³¨å†Œè¡¨ï¼Œç»Ÿä¸€ç®¡ç†ç€æ‰€æœ‰ Bean çš„é…ç½®å…ƒæ•°æ®ï¼Œä¸ºåç»­çš„ Bean å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚ç†è§£ <code>BeanDefinitionRegistry</code>çš„å·¥ä½œåŸç†ï¼Œå¯¹äºæ·±å…¥æŒæ¡ Spring å®¹å™¨çš„å†…éƒ¨æœºåˆ¶è‡³å…³é‡è¦ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ é€å½»ç†è§£ <code>BeanDefinitionRegistry</code>ã€‚</p><h2 id=beanpostprocessor>BeanPostProcessor</h2><p>BeanPostProcessor æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ªæå…¶é‡è¦çš„æ‰©å±•æ¥å£ï¼Œå®ƒå°±åƒä¸€ä½åœ¨ Bean è¯ç”Ÿè¿‡ç¨‹ä¸­è¿›è¡Œç²¾åŠ å·¥çš„â€œé­”æ³•å¸ˆâ€ï¼Œå…è®¸ä½ åœ¨æ¯ä¸ª Bean å®ä¾‹åˆå§‹åŒ–å‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œæ˜¯ Spring IoC å®¹å™¨å¼ºå¤§æ‰©å±•èƒ½åŠ›çš„æ ¸å¿ƒæ”¯æŸ±ä¹‹ä¸€ã€‚</p><p>ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨å±€ï¼Œä¸‹è¡¨æ¸…æ™°åœ°å±•ç¤ºäº† Bean åˆ›å»ºè¿‡ç¨‹ä¸­çš„å…³é”®é˜¶æ®µåŠå…¶ä¸ <code>BeanPostProcessor</code>çš„å…³è”ã€‚</p><div class=table-wrapper><table><thead><tr><th>ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ</th><th>æ ¸å¿ƒæ“ä½œ</th><th>BeanPostProcessor çš„ä»‹å…¥ç‚¹</th></tr></thead><tbody><tr><td><strong>â‘  å®ä¾‹åŒ–</strong></td><td>è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º Bean å®ä¾‹</td><td>-</td></tr><tr><td><strong>â‘¡ å±æ€§å¡«å……</strong></td><td>ä¾èµ–æ³¨å…¥ï¼ˆå¦‚é€šè¿‡ <code>@Autowired</code>ï¼‰</td><td>-</td></tr><tr><td><strong>â‘¢ åˆå§‹åŒ–å‰å¤„ç†</strong></td><td><strong>Aware æ¥å£å›è°ƒ</strong>ï¼ˆå¦‚ <code>BeanNameAware</code>ï¼‰</td><td><strong><code>postProcessBeforeInitialization</code></strong></td></tr><tr><td><strong>â‘£ åˆå§‹åŒ–</strong></td><td>è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ <code>@PostConstruct</code>ã€<code>InitializingBean</code>ï¼‰</td><td>-</td></tr><tr><td><strong>â‘¤ åˆå§‹åŒ–åå¤„ç†</strong></td><td>-</td><td><strong><code>postProcessAfterInitialization</code></strong></td></tr><tr><td><strong>â‘¥ å°±ç»ª</strong></td><td>Bean å®Œå…¨åˆ›å»ºï¼Œå¯ä¾›ä½¿ç”¨</td><td>-</td></tr><tr><td><strong>â‘¦ é”€æ¯</strong></td><td>å®¹å™¨å…³é—­ï¼Œè°ƒç”¨é”€æ¯æ–¹æ³•ï¼ˆå¦‚ <code>@PreDestroy</code>ï¼‰</td><td>-</td></tr></tbody></table></div><h3 id=-æ ¸å¿ƒæ–¹æ³•ä¸æ‰§è¡Œæ—¶æœº>ğŸ’¡ æ ¸å¿ƒæ–¹æ³•ä¸æ‰§è¡Œæ—¶æœº</h3><p><code>BeanPostProcessor</code>æ¥å£ä¸»è¦å®šä¹‰äº†ä¸¤ä¸ªå›è°ƒæ–¹æ³•ï¼Œå®ƒä»¬å°±åƒä¸¤ä¸ªç²¾ç¡®çš„é’©å­ï¼ˆHookï¼‰ï¼ŒåµŒå…¥åœ¨ Bean çš„ç”Ÿå‘½å‘¨æœŸä¸­ã€‚</p><pre tabindex=0><code>public interface BeanPostProcessor {
    // åœ¨ Bean åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ @PostConstructï¼‰ä¹‹å‰è¢«è°ƒç”¨
    default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        return bean;
    }
    
    // åœ¨ Bean åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ @PostConstructï¼‰ä¹‹åè¢«è°ƒç”¨
    default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        return bean;
    }
}
</code></pre><ul><li><strong><code>postProcessBeforeInitialization</code></strong>ï¼šè¯¥æ–¹æ³•åœ¨ Bean çš„åˆå§‹åŒ–å›è°ƒï¼ˆä¾‹å¦‚ <code>@PostConstruct</code>æ³¨è§£çš„æ–¹æ³•ã€<code>InitializingBean</code>æ¥å£çš„ <code>afterPropertiesSet</code>æ–¹æ³•æˆ–è‡ªå®šä¹‰çš„ <code>init-method</code>ï¼‰<strong>ä¹‹å‰</strong>æ‰§è¡Œã€‚é€‚åˆè¿›è¡Œä¸€äº›å‰ç½®å¤„ç†ï¼Œå¦‚ä¿®æ”¹å±æ€§å€¼ã€è¿›è¡Œæ ¡éªŒç­‰ã€‚</li><li><strong><code>postProcessAfterInitialization</code></strong>ï¼šè¯¥æ–¹æ³•åœ¨ Bean å®Œæˆæ‰€æœ‰åˆå§‹åŒ–å›è°ƒ<strong>ä¹‹å</strong>æ‰§è¡Œã€‚è¿™æ˜¯å¯¹ Bean è¿›è¡Œæœ€ç»ˆåŠ å·¥çš„æœºä¼šï¼Œ<strong>Spring AOP åˆ›å»ºä»£ç†å¯¹è±¡å°±åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆ</strong>ã€‚</li></ul><h3 id=-spring-å†…ç½®çš„å…³é”®å®ç°>ğŸ› ï¸ Spring å†…ç½®çš„å…³é”®å®ç°</h3><p>Spring æ¡†æ¶è‡ªèº«çš„è®¸å¤šå¼ºå¤§åŠŸèƒ½æ­£æ˜¯é€šè¿‡å†…ç½®çš„ <code>BeanPostProcessor</code>å®ç°çš„ã€‚</p><div class=table-wrapper><table><thead><tr><th>å®ç°ç±»</th><th>æ ¸å¿ƒèŒè´£</th><th>æ”¯æŒçš„æ³¨è§£/åŠŸèƒ½</th></tr></thead><tbody><tr><td><strong><code>AutowiredAnnotationBeanPostProcessor</code></strong></td><td>å¤„ç†ä¾èµ–æ³¨å…¥</td><td><code>@Autowired</code>, <code>@Value</code>, <code>@Inject</code></td></tr><tr><td><strong><code>CommonAnnotationBeanPostProcessor</code></strong></td><td>å¤„ç† JSR-250 å¸¸è§æ³¨è§£</td><td><code>@PostConstruct</code>, <code>@PreDestroy</code>, <code>@Resource</code></td></tr><tr><td><strong><code>ApplicationContextAwareProcessor</code></strong></td><td>æ³¨å…¥ Spring ä¸Šä¸‹æ–‡ç›¸å…³å¯¹è±¡</td><td>å„ç§ <code>Aware</code>æ¥å£ï¼ˆå¦‚ <code>ApplicationContextAware</code>ï¼‰</td></tr><tr><td><strong><code>AbstractAutoProxyCreator</code></strong></td><td><strong>AOP ä»£ç†åˆ›å»º</strong></td><td>ä¸ºè¢« <code>@Aspect</code>ç­‰æ³¨è§£çš„ Bean ç”Ÿæˆä»£ç†å¯¹è±¡</td></tr></tbody></table></div><h3 id=-å¦‚ä½•è‡ªå®šä¹‰-beanpostprocessor>ğŸ’» å¦‚ä½•è‡ªå®šä¹‰ BeanPostProcessor</h3><p>åˆ›å»ºä½ è‡ªå·±çš„ <code>BeanPostProcessor</code>éå¸¸ç®€å•ï¼Œåªéœ€å®ç°æ¥å£å¹¶å°†å…¶æ³¨å†Œåˆ° Spring å®¹å™¨å³å¯ã€‚</p><h4 id=1-å®ç°æ¥å£-2>1. å®ç°æ¥å£</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®ƒåœ¨æ¯ä¸ª Bean åˆå§‹åŒ–å‰åæ‰“å°æ—¥å¿—ï¼š</p><pre tabindex=0><code>import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;
import org.springframework.stereotype.Component;

@Component
public class LoggingBeanPostProcessor implements BeanPostProcessor {

    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println(&#34;[Before Init] Bean Name: &#34; + beanName + &#34;, Type: &#34; + bean.getClass().getSimpleName());
        // ä½ å¯ä»¥åœ¨è¿™é‡Œå¯¹ bean è¿›è¡Œä¿®æ”¹æˆ–åŒ…è£…
        return bean; // å¿…é¡»è¿”å› bean å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯åŸå§‹å¯¹è±¡æˆ–åŒ…è£…åçš„å¯¹è±¡ï¼‰
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println(&#34;[After Init] Bean Name: &#34; + beanName + &#34;, Type: &#34; + bean.getClass().getSimpleName());
        return bean;
    }
}
</code></pre><h4 id=2-æ³¨å†Œåˆ°å®¹å™¨>2. æ³¨å†Œåˆ°å®¹å™¨</h4><p>è®© Spring è¯†åˆ«ä½ çš„ <code>BeanPostProcessor</code>ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><strong>ä½¿ç”¨ <code>@Component</code>ç­‰æ³¨è§£</strong>ï¼šå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼ŒSpring ä¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œã€‚</li><li><strong>é€šè¿‡ <code>@Bean</code>åœ¨é…ç½®ç±»ä¸­æ˜¾å¼æ³¨å†Œ</strong>ã€‚</li></ul><h3 id=-å…¸å‹åº”ç”¨åœºæ™¯>ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯</h3><p><code>BeanPostProcessor</code>çš„çµæ´»æ€§ä½¿å…¶èƒ½å¤Ÿåº”ç”¨äºå¤šç§åœºæ™¯ï¼š</p><ul><li><strong>å®ç° AOP åŠ¨æ€ä»£ç†</strong>ï¼šSpring AOP çš„æ ¸å¿ƒ <code>AbstractAutoProxyCreator</code>å°±æ˜¯ä¸€ä¸ª <code>BeanPostProcessor</code>ï¼Œå®ƒåœ¨ <code>postProcessAfterInitialization</code>æ–¹æ³•ä¸­ä¸ºåŒ¹é…åˆ‡ç‚¹çš„ Bean åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li><li><strong>å¤„ç†è‡ªå®šä¹‰æ³¨è§£</strong>ï¼šä½ å¯ä»¥åˆ©ç”¨å®ƒæ‰«æ Bean ä¸­çš„è‡ªå®šä¹‰æ³¨è§£ï¼ˆå¦‚ <code>@EncryptField</code>ï¼‰ï¼Œå¹¶åœ¨åˆå§‹åŒ–é˜¶æ®µå¯¹æ³¨è§£å­—æ®µè¿›è¡ŒåŠ å¯†ç­‰å¤„ç†ã€‚</li><li><strong>æ€§èƒ½ç›‘æ§ä¸æ—¥å¿—</strong>ï¼šå¯ä»¥åœ¨åˆå§‹åŒ–å‰åè®°å½•æ—¶é—´ç‚¹ï¼Œè®¡ç®— Bean çš„åˆ›å»ºè€—æ—¶ï¼Œç”¨äºæ€§èƒ½åˆ†æã€‚</li><li><strong>AB æµ‹è¯•è·¯ç”±</strong>ï¼šå¦‚æœç´¢ç»“æœä¸­æåˆ°çš„æ¡ˆä¾‹ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè·¯ç”±ä»£ç†ï¼Œæ ¹æ®é…ç½®åŠ¨æ€å†³å®šæ³¨å…¥å“ªä¸ªç‰ˆæœ¬çš„ Bean å®ç°ï¼Œä½¿ä¸šåŠ¡ä»£ç æ›´ç®€æ´ã€‚</li></ul><h3 id=-é‡è¦ä½¿ç”¨é¡»çŸ¥>âš ï¸ é‡è¦ä½¿ç”¨é¡»çŸ¥</h3><p>åœ¨ä½¿ç”¨ <code>BeanPostProcessor</code>æ—¶ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><ol><li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä½ å®ç°çš„ <code>BeanPostProcessor</code>ä¼š<strong>ä½œç”¨äºå®¹å™¨ä¸­çš„æ¯ä¸€ä¸ª Bean</strong>ã€‚å¦‚æœåªæƒ³å¤„ç†ç‰¹å®šç±»å‹çš„ Beanï¼Œéœ€è¦åœ¨æ–¹æ³•å†…éƒ¨è¿›è¡Œåˆ¤æ–­ï¼ˆä¾‹å¦‚ <code>if (bean instanceof MyService)</code>ï¼‰ã€‚</li><li><strong>æ‰§è¡Œé¡ºåº</strong>ï¼šå½“å­˜åœ¨å¤šä¸ª <code>BeanPostProcessor</code>æ—¶ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ã€‚ä½ å¯ä»¥é€šè¿‡å®ç° <code>PriorityOrdered</code>æˆ– <code>Ordered</code>æ¥å£ï¼Œæˆ–ä½¿ç”¨ <code>@Order</code>æ³¨è§£æ¥æ§åˆ¶é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</li><li><strong>æå‰åˆå§‹åŒ–</strong>ï¼šSpring å®¹å™¨ä¼š<strong>ä¼˜å…ˆåˆå§‹åŒ–æ‰€æœ‰çš„ <code>BeanPostProcessor</code></strong>ï¼Œç„¶åå†åˆå§‹åŒ–å…¶ä»–æ™®é€šçš„ Beanã€‚å› æ­¤ï¼Œåœ¨ <code>BeanPostProcessor</code>ä¸­ä¾èµ–å…¶ä»–æ™®é€š Bean æ—¶éœ€è¦å°å¿ƒå¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li><strong>è¿”å›å€¼</strong>ï¼šä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•éƒ½å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ä¼ å…¥çš„ <code>bean</code>æœ¬èº«ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶åŒ…è£…ç±»ï¼Œå¦‚ä»£ç†å¯¹è±¡ï¼‰ã€‚<strong>ä¸è¦è¿”å› <code>null</code></strong>ï¼Œå¦åˆ™ä¼šç ´ååç»­å¤„ç†æµç¨‹ã€‚</li></ol><h3 id=-æ€»ç»“-13>ğŸ’ æ€»ç»“</h3><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>BeanPostProcessor</code>æ˜¯ Spring æ¡†æ¶ä¸ºå¼€å‘è€…æä¾›çš„ä¸€æŠŠåˆ©å™¨ï¼Œå®ƒé€šè¿‡ä»‹å…¥ Bean ç”Ÿå‘½å‘¨æœŸçš„å…³é”®èŠ‚ç‚¹ï¼Œå®ç°äº†æ§åˆ¶åè½¬å®¹å™¨çš„é«˜åº¦å¯æ‰©å±•æ€§ã€‚æ— è®ºæ˜¯ Spring è‡ªèº«çš„ AOPã€äº‹åŠ¡ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½ï¼Œè¿˜æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­çš„å„ç§å®šåˆ¶åŒ–éœ€æ±‚ï¼Œéƒ½ç¦»ä¸å¼€å®ƒçš„æ”¯æŒã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£å¹¶æœ‰æ•ˆè¿ç”¨ <code>BeanPostProcessor</code>ã€‚</p><h2 id=åˆå§‹åŒ–é¡ºåº>åˆå§‹åŒ–é¡ºåº</h2><p>äº†è§£ Spring Bean åˆå§‹åŒ–æ–¹æ³•çš„æ‰§è¡Œé¡ºåºå’ŒèƒŒåçš„åŸå› ï¼Œå¯¹ç¼–å†™å¯é ä»£ç å¾ˆé‡è¦ã€‚é€šè¿‡ä¸‹é¢çš„è¡¨æ ¼å’Œè®²è§£ï¼Œä½ ä¼šæ˜ç™½ä¸ºä»€ä¹ˆå®ƒä»¬çš„é¡ºåºæ˜¯å›ºå®šçš„ã€‚</p><p>ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒä¿¡æ¯ï¼Œæˆ‘å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬è¿™ä¸‰ç§åˆå§‹åŒ–æœºåˆ¶çš„å…³é”®ç‚¹ï¼š</p><div class=table-wrapper><table><thead><tr><th>åˆå§‹åŒ–æœºåˆ¶</th><th>æ‰§è¡Œæ—¶æœºï¼ˆé¡ºåºï¼‰</th><th>å¤„ç†æ–¹å¼</th><th>ä¸»è¦ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong><code>@PostConstruct</code></strong></td><td>æœ€æ—©</td><td>ç”± <code>CommonAnnotationBeanPostProcessor</code>åœ¨ <code>postProcessBeforeInitialization</code>é˜¶æ®µé€šè¿‡<strong>åå°„</strong>è°ƒç”¨</td><td>åŸºäº JSR-250 æ ‡å‡†æ³¨è§£ï¼Œä¸ Spring æ¡†æ¶<strong>è§£è€¦</strong>ï¼Œæ¨èä½¿ç”¨</td></tr><tr><td><strong><code>InitializingBean</code></strong></td><td>å…¶æ¬¡</td><td>Spring å®¹å™¨ç›´æ¥è°ƒç”¨æ¥å£çš„ <code>afterPropertiesSet()</code><strong>æ–¹æ³•</strong></td><td>Spring åŸç”Ÿæ¥å£ï¼Œä¸æ¡†æ¶<strong>è€¦åˆ</strong>è¾ƒç´§</td></tr><tr><td><strong><code>init-method</code></strong></td><td>æœ€æ™š</td><td>Spring å®¹å™¨é€šè¿‡<strong>åå°„</strong>è°ƒç”¨é…ç½®ä¸­æŒ‡å®šçš„æ–¹æ³•</td><td>é€šè¿‡é…ç½®æŒ‡å®šï¼Œ<strong>æ— éœ€ä¿®æ”¹æºç </strong>ï¼Œçµæ´»æ€§é«˜ï¼Œå¸¸ç”¨äºé›†æˆç¬¬ä¸‰æ–¹åº“</td></tr></tbody></table></div><hr><h3 id=-spring-å®¹å™¨åˆå§‹åŒ–-bean-çš„æµç¨‹>ğŸ” Spring å®¹å™¨åˆå§‹åŒ– Bean çš„æµç¨‹</h3><p>è¦ç†è§£é¡ºåºï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Spring åœ¨åˆ›å»ºä¸€ä¸ª Bean å¹¶å®Œæˆä¾èµ–æ³¨å…¥åï¼Œå¦‚ä½•æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼š</p><ol><li><strong>å®ä¾‹åŒ– & å±æ€§æ³¨å…¥</strong>ï¼šå®¹å™¨é€šè¿‡æ„é€ å™¨åˆ›å»º Bean å®ä¾‹ï¼Œå¹¶é€šè¿‡åå°„å®Œæˆå±æ€§æ³¨å…¥ï¼ˆå¦‚ <code>@Autowired</code>ï¼‰ã€‚</li><li><strong>Aware æ¥å£å›è°ƒ</strong>ï¼šå¦‚æœ Bean å®ç°äº†å„ç§ <code>Aware</code>æ¥å£ï¼ˆå¦‚ <code>BeanNameAware</code>ï¼‰ï¼Œæ­¤æ—¶ä¼šå›è°ƒå…¶æ–¹æ³•ã€‚</li><li><strong>BeanPostProcessor å‰ç½®å¤„ç†</strong>ï¼šè¿™æ˜¯ <strong><code>@PostConstruct</code>æ‰§è¡Œçš„åœ°æ–¹</strong>ã€‚æ‰€æœ‰ <code>BeanPostProcessor</code>çš„ <code>postProcessBeforeInitialization</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚å…¶ä¸­ï¼Œ<code>CommonAnnotationBeanPostProcessor</code>ä¼šæ£€æŸ¥ Bean çš„æ–¹æ³•æ˜¯å¦è¢« <code>@PostConstruct</code>æ ‡æ³¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€šè¿‡<strong>åå°„</strong>è°ƒç”¨å®ƒä»¬ã€‚</li><li><strong>è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•</strong>ï¼š<ul><li>é¦–å…ˆï¼ŒSpring æ£€æŸ¥ Bean æ˜¯å¦å®ç°äº† <code>InitializingBean</code>æ¥å£ã€‚å¦‚æœæ˜¯ï¼Œåˆ™<strong>ç›´æ¥è°ƒç”¨</strong>å…¶ <code>afterPropertiesSet()</code>æ–¹æ³•ã€‚</li><li>æ¥ç€ï¼ŒSpring æ£€æŸ¥ Bean çš„å®šä¹‰ä¸­æ˜¯å¦é…ç½®äº†è‡ªå®šä¹‰çš„ <code>init-method</code>ã€‚å¦‚æœæœ‰ï¼Œåˆ™é€šè¿‡<strong>åå°„</strong>è°ƒç”¨è¯¥æ–¹æ³•ã€‚</li></ul></li><li><strong>BeanPostProcessor åç½®å¤„ç†</strong>ï¼šæ‰€æœ‰ <code>BeanPostProcessor</code>çš„ <code>postProcessAfterInitialization</code>æ–¹æ³•è¢«è°ƒç”¨ã€‚<strong>AOP ä»£ç†é€šå¸¸åœ¨æ­¤é˜¶æ®µç”Ÿæˆ</strong>ã€‚</li><li><strong>Bean å°±ç»ª</strong>ï¼šæ­¤æ—¶ Bean å·²å®Œå…¨åˆå§‹åŒ–ï¼Œå¯è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚</li></ol><p>å› æ­¤ï¼Œé¡ºåº <strong><code>@PostConstruct</code>â†’ <code>InitializingBean</code>â†’ <code>init-method</code></strong> æ˜¯ç”± Spring çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹<strong>ä¸¥æ ¼å®šä¹‰</strong>çš„ã€‚</p><hr><h3 id=-ä¸ºä½•æ˜¯è¿™ä¸ªé¡ºåº>ğŸ’¡ ä¸ºä½•æ˜¯è¿™ä¸ªé¡ºåºï¼Ÿ</h3><p>è¿™ä¸ªé¡ºåºä½“ç°äº† Spring çš„è®¾è®¡å“²å­¦å’Œæƒè¡¡ï¼š</p><ol><li><strong><code>@PostConstruct</code>æœ€å…ˆï¼ˆæœ€æ¨èï¼‰</strong>ï¼šå› ä¸ºå®ƒåŸºäº <strong>JSR-250 æ ‡å‡†</strong>ï¼Œè€Œé Spring ç‰¹æœ‰ã€‚è¿™å‡å°‘äº†ä»£ç ä¸ Spring æ¡†æ¶çš„è€¦åˆï¼Œæ„å‘³ç€ä½ çš„åˆå§‹åŒ–é€»è¾‘æ›´ä¾¿æºã€‚Spring é€šè¿‡ <code>BeanPostProcessor</code>è¿™ç§<strong>æ‰©å±•æœºåˆ¶</strong>æ¥æ”¯æŒå®ƒï¼Œè€Œ <code>BeanPostProcessor</code>æœ¬èº«çš„æ‰§è¡Œå°±åœ¨ç›´æ¥çš„åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹å‰ã€‚</li><li><strong><code>InitializingBean</code>å…¶æ¬¡</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª Spring çš„<strong>åŸç”Ÿæ¥å£</strong>ã€‚å®ç°å®ƒå°±æ„å‘³ç€ä½ çš„ä»£ç å’Œ Spring æ¡†æ¶ç»‘å®šäº†ã€‚å®ƒçš„è°ƒç”¨æ˜¯ Spring ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„ä¸€éƒ¨åˆ†ï¼Œç›´æ¥ä¸”é«˜æ•ˆï¼Œä½†ç‰ºç‰²äº†çµæ´»æ€§ã€‚</li><li><strong><code>init-method</code>æœ€åï¼ˆæœ€çµæ´»ï¼‰</strong>ï¼šå®ƒé€šè¿‡<strong>å¤–éƒ¨é…ç½®</strong>æŒ‡å®šæ–¹æ³•åï¼Œ<strong>å®Œå…¨ä¸éœ€è¦ä¿®æ”¹ Bean çš„æºä»£ç </strong>ã€‚è¿™ç§è§£è€¦ä½¿å¾—å®ƒä¸ºé›†æˆé‚£äº›ä½ æ— æ³•ä¿®æ”¹æºç çš„ç¬¬ä¸‰æ–¹åº“æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚</li></ol><hr><h3 id=-å¦‚ä½•é€‰æ‹©-1>ğŸ› ï¸ å¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><p>äº†è§£åŸç†åï¼Œåœ¨å®é™…å¼€å‘ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š</p><ul><li><strong>é¦–é€‰ <code>@PostConstruct</code></strong>ï¼šé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯ç°ä»£åŸºäºæ³¨è§£çš„ Spring Boot åº”ç”¨ã€‚å®ƒ<strong>ä»£ç ä¾µå…¥æ€§ä½</strong>ï¼Œç¬¦åˆ Java æ ‡å‡†ï¼Œæ¸…æ™°ç›´è§‚ã€‚</li><li><strong>æ…ç”¨ <code>InitializingBean</code></strong>ï¼šé™¤ééœ€è¦ä¸ Spring çš„æŸäº›ç”Ÿå‘½å‘¨æœŸ<strong>ç´§å¯†é›†æˆ</strong>ï¼Œé€šå¸¸æ›´æ¨èä½¿ç”¨ <code>@PostConstruct</code>ï¼Œå› ä¸ºå®ƒèƒ½é¿å…ä»£ç ä¸ Spring æ¡†æ¶çš„è€¦åˆã€‚</li><li><strong>é€‰ç”¨ <code>init-method</code></strong>ï¼šå½“éœ€è¦ä¸º<strong>ç¬¬ä¸‰æ–¹åº“</strong>çš„ç±»æ·»åŠ åˆå§‹åŒ–é€»è¾‘ï¼Œæˆ–è€…ä½ å¸Œæœ›åˆå§‹åŒ–æ–¹æ³•åèƒ½é€šè¿‡<strong>å¤–éƒ¨é…ç½®</strong>çµæ´»æŒ‡å®šæ—¶ï¼Œå®ƒéå¸¸æœ‰ç”¨ã€‚</li></ul><hr><h3 id=-æ³¨æ„äº‹é¡¹>âš ï¸ æ³¨æ„äº‹é¡¹</h3><ul><li><strong>é¿å…åœ¨åŒä¸€ä¸ª Bean ä¸­æ··åˆä½¿ç”¨å¤šç§æ–¹å¼</strong>ï¼šè¿™ä¼šä½¿åˆå§‹åŒ–é€»è¾‘åˆ†æ•£ï¼Œé™ä½å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚é€šå¸¸<strong>é€‰æ‹©ä¸€ç§</strong>å³å¯ã€‚</li><li><strong>åˆå§‹åŒ–ä¸­çš„å¼‚å¸¸</strong>ï¼šå¦‚æœåˆå§‹åŒ–æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œä¼šé˜»æ­¢ Bean çš„åˆ›å»ºï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨ä¸Šä¸‹æ–‡å¯åŠ¨å¤±è´¥ã€‚</li><li><strong>åŸå‹ Bean</strong>ï¼šå¯¹äºä½œç”¨åŸŸä¸º <code>prototype</code>çš„ Beanï¼Œå…¶åˆå§‹åŒ–æ–¹æ³•æ¯æ¬¡éƒ½ä¼šåœ¨è·å–æ–°å®ä¾‹æ—¶è°ƒç”¨ï¼Œä½† Spring ä¸ç®¡ç†å…¶é”€æ¯ç”Ÿå‘½å‘¨æœŸã€‚</li></ul><p>å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´æ·±å…¥åœ°ç†è§£ Spring Bean çš„åˆå§‹åŒ–æœºåˆ¶ã€‚</p><h2 id=refresh>refresh()</h2><p>ApplicationContext çš„ <code>refresh()</code>æ–¹æ³•æ˜¯ Spring IoC å®¹å™¨å¯åŠ¨çš„æ ¸å¿ƒæµç¨‹ï¼Œå®ƒå°±åƒ Spring åº”ç”¨çš„å¯åŠ¨å¼•æ“ï¼ŒæŒ‰æ­¥éª¤å®Œæˆä»é…ç½®åŠ è½½åˆ°åº”ç”¨å®Œå…¨å°±ç»ªçš„æ‰€æœ‰å…³é”®ä»»åŠ¡ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹å›¾æ¸…æ™°åœ°å±•ç¤ºäº†è¿™ä¸ªæµç¨‹çš„12ä¸ªæ ¸å¿ƒæ­¥éª¤åŠå…¶ä¸»è¦å·¥ä½œï¼š</p><pre tabindex=0><code>flowchart TD
    A[å¼€å§‹ refresh()] --&gt; B[prepareRefresh()&lt;br&gt;å‡†å¤‡åˆ·æ–°]
    B --&gt; C[obtainFreshBeanFactory()&lt;br&gt;è·å–BeanFactory]
    C --&gt; D[prepareBeanFactory()&lt;br&gt;é…ç½®BeanFactory]
    D --&gt; E[postProcessBeanFactory()&lt;br&gt;å­ç±»æ‰©å±•]
    E --&gt; F[invokeBeanFactoryPostProcessors()&lt;br&gt;æ‰§è¡ŒBeanå·¥å‚åå¤„ç†å™¨]
    F --&gt; G[registerBeanPostProcessors()&lt;br&gt;æ³¨å†ŒBeanåå¤„ç†å™¨]
    G --&gt; H[initMessageSource()&lt;br&gt;åˆå§‹åŒ–æ¶ˆæ¯æº]
    H --&gt; I[initApplicationEventMulticaster()&lt;br&gt;åˆå§‹åŒ–äº‹ä»¶å¹¿æ’­å™¨]
    I --&gt; J[onRefresh()&lt;br&gt;å­ç±»æ‰©å±•]
    J --&gt; K[registerListeners()&lt;br&gt;æ³¨å†Œç›‘å¬å™¨]
    K --&gt; L[finishBeanFactoryInitialization()&lt;br&gt;åˆå§‹åŒ–å•ä¾‹Bean]
    L --&gt; M[finishRefresh()&lt;br&gt;å®Œæˆåˆ·æ–°]
    M --&gt; N[å®¹å™¨å°±ç»ª]
</code></pre><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è§£ææ¯ä¸ªé˜¶æ®µçš„æ ¸å¿ƒå·¥ä½œã€‚</p><h3 id=-ç¬¬ä¸€é˜¶æ®µç¯å¢ƒå‡†å¤‡ä¸-beanfactory-åˆå§‹åŒ–>ğŸ’¡ ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒå‡†å¤‡ä¸ BeanFactory åˆå§‹åŒ–</h3><p>è¿™ä¸€é˜¶æ®µä¸»è¦å®Œæˆå®¹å™¨å¯åŠ¨å‰çš„â€œåŸºå»ºâ€å·¥ä½œï¼Œä¸ºåç»­çš„ Bean åŠ è½½å’Œå®ä¾‹åŒ–æ­å»ºèˆå°ã€‚</p><ol><li><p><strong><code>prepareRefresh()</code>- å‡†å¤‡åˆ·æ–°</strong></p><p>æ­¤æ–¹æ³•æ˜¯åˆ·æ–°è¿‡ç¨‹çš„èµ·ç‚¹ï¼Œä¸»è¦è´Ÿè´£åˆå§‹åŒ–ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å®ƒä¼šè®¾ç½®å®¹å™¨çš„å¯åŠ¨æ—¶é—´æˆ³å’Œæ´»è·ƒçŠ¶æ€ï¼Œåˆå§‹åŒ– <strong><code>Environment</code></strong> å¯¹è±¡ï¼ˆè¯¥å¯¹è±¡ç®¡ç†ç€ç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç­‰å±æ€§æºï¼‰ï¼Œå¹¶å¯¹å¿…è¦çš„å±æ€§è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿åç»­æµç¨‹èƒ½åœ¨ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„ç¯å¢ƒä¸‹è¿›è¡Œ ã€‚</p></li><li><p><strong><code>obtainFreshBeanFactory()</code>- è·å– BeanFactory</strong></p><p>åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œå®¹å™¨ä¼š<strong>åˆ›å»ºæˆ–åˆ·æ–°å…¶å†…éƒ¨çš„ <code>BeanFactory</code></strong>ï¼ˆé€šå¸¸æ˜¯ <code>DefaultListableBeanFactory</code>ï¼‰ã€‚è¿™ä¸ª <code>BeanFactory</code>æ˜¯ Spring å®¹å™¨çœŸæ­£ç®¡ç† Bean çš„â€œå·¥ä½œå°â€ã€‚æ ¸å¿ƒä»»åŠ¡æ˜¯åŠ è½½é…ç½®æºï¼ˆå¦‚ XML æ–‡ä»¶æˆ–æ³¨è§£é…ç½®ç±»ï¼‰ï¼Œå°†å…¶è§£æä¸ºä¸€ä¸ªä¸ª <strong><code>BeanDefinition</code></strong> å¯¹è±¡ï¼Œå¹¶å°†è¿™äº› Bean çš„â€œè“å›¾â€æ³¨å†Œåˆ° <code>BeanFactory</code>ä¸­ ã€‚ä½ å¯ä»¥å°†å…¶ç†è§£ä¸ºå°†æ‰€æœ‰é›¶ä»¶çš„è®¾è®¡å›¾çº¸å½•å…¥å·¥å‚çš„æ•°æ®åº“ã€‚</p></li><li><p><strong><code>prepareBeanFactory()</code>- é…ç½® BeanFactory</strong></p><p>è·å–åˆ°åŸºç¡€çš„ <code>BeanFactory</code>åï¼Œæ­¤æ­¥éª¤ä¼šå¯¹å…¶è¿›è¡Œâ€œç²¾è£…ä¿®â€ã€‚å®ƒé…ç½®äº†ç±»åŠ è½½å™¨ã€<strong>SPELè¡¨è¾¾å¼è§£æå™¨</strong>ã€å±æ€§ç¼–è¾‘å™¨ç­‰å¿…è¦ç»„ä»¶ã€‚åŒæ—¶ï¼Œå®ƒä¼šæ³¨å†Œä¸€äº›å…³é”®çš„<strong>å†…ç½® <code>BeanPostProcessor</code></strong>ï¼Œä¾‹å¦‚ç”¨äºå¤„ç† <code>Aware</code>æ¥å£çš„ <code>ApplicationContextAwareProcessor</code>ï¼Œä¸ºå®¹å™¨çš„é«˜çº§åŠŸèƒ½æ‰“ä¸‹åŸºç¡€ ã€‚</p></li><li><p><strong><code>postProcessBeanFactory()</code>- BeanFactory åç½®å¤„ç†</strong></p><p>è¿™æ˜¯ä¸€ä¸ª<strong>é¢„ç•™çš„æ¨¡æ¿æ–¹æ³•</strong>ï¼Œå…è®¸å…·ä½“çš„ <code>ApplicationContext</code>å­ç±»ï¼ˆå¦‚ç”¨äº Web ç¯å¢ƒçš„å®ç°ï¼‰æ ¹æ®è‡ªèº«éœ€æ±‚ï¼Œå¯¹ <code>BeanFactory</code>è¿›è¡Œè¿›ä¸€æ­¥çš„å®šåˆ¶ï¼Œä¾‹å¦‚æ³¨å†Œæ–°çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰å¦‚ <code>request</code>æˆ– <code>session</code>ã€‚</p></li></ol><h3 id=-ç¬¬äºŒé˜¶æ®µæ‰©å±•ç‚¹è°ƒç”¨ä¸åŠŸèƒ½ç»„ä»¶åˆå§‹åŒ–>ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•ç‚¹è°ƒç”¨ä¸åŠŸèƒ½ç»„ä»¶åˆå§‹åŒ–</h3><p>åœ¨ Bean å®ä¾‹åŒ–ä¹‹å‰ï¼ŒSpring æä¾›äº†å¼ºå¤§çš„æ‰©å±•æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…ä»‹å…¥å®¹å™¨çš„é…ç½®è¿‡ç¨‹ã€‚</p><ol><li><p><strong><code>invokeBeanFactoryPostProcessors()</code>- è°ƒç”¨ BeanFactory åå¤„ç†å™¨</strong></p><p>è¿™æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ª<strong>æå…¶é‡è¦çš„æ‰©å±•ç‚¹</strong>ã€‚æ­¤æ­¥éª¤ä¼šå®ä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰ <code>BeanFactoryPostProcessor</code>çš„å®ç°ã€‚è¿™äº›å¤„ç†å™¨æœ‰æƒåœ¨ Bean å®ä¾‹åŒ–<strong>ä¹‹å‰</strong>ï¼Œ<strong>ä¿®æ”¹</strong>å·²æ³¨å†Œçš„ <code>BeanDefinition</code>ã€‚æœ€å…¸å‹çš„ä¾‹å­æ˜¯ <code>ConfigurationClassPostProcessor</code>ï¼Œå®ƒè´Ÿè´£è§£æ <code>@Configuration</code>ã€<code>@Bean</code>ç­‰æ³¨è§£ï¼›ä»¥åŠ <code>PropertySourcesPlaceholderConfigurer</code>ï¼Œç”¨äºè§£æ <code>${...}</code>å ä½ç¬¦ ã€‚</p></li><li><p><strong><code>registerBeanPostProcessors()</code>- æ³¨å†Œ Bean åå¤„ç†å™¨</strong></p><p>æ­¤æ­¥éª¤è´Ÿè´£ä» <code>BeanFactory</code>ä¸­æŸ¥æ‰¾æ‰€æœ‰ <code>BeanPostProcessor</code>çš„å®ç°ï¼Œå¹¶å°†å®ƒä»¬æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåªæ˜¯<strong>æ³¨å†Œ</strong>ï¼ŒçœŸæ­£çš„è°ƒç”¨å‘ç”Ÿåœ¨åç»­ Bean çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ã€‚<code>BeanPostProcessor</code>æ˜¯å½±å“ Bean ç”Ÿå‘½å‘¨æœŸçš„å¦ä¸€ä¸ªå…³é”®æ‰©å±•ç‚¹ï¼Œå¸¸ç”¨äºå¤„ç†ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ <code>@Autowired</code>ï¼‰ã€AOP ä»£ç†åˆ›å»ºç­‰ ã€‚</p></li><li><p><strong><code>initMessageSource()</code>- åˆå§‹åŒ–å›½é™…åŒ–æ¶ˆæ¯æº</strong></p><p>æ­¤æ­¥éª¤ä¸ºå®¹å™¨æä¾›<strong>å›½é™…åŒ–ï¼ˆi18nï¼‰</strong> æ”¯æŒã€‚å®ƒä¼šæŸ¥æ‰¾åä¸º <code>messageSource</code>çš„ Beanï¼Œå¦‚æœå­˜åœ¨åˆ™ä½¿ç”¨å®ƒï¼Œå¦åˆ™ä¼šåˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤çš„å®ç°ï¼Œç”¨äºè§£æä¸åŒè¯­è¨€ç¯å¢ƒçš„æ¶ˆæ¯ ã€‚</p></li><li><p><strong><code>initApplicationEventMulticaster()</code>- åˆå§‹åŒ–åº”ç”¨äº‹ä»¶å¹¿æ’­å™¨</strong></p><p>æ­¤æ­¥éª¤åˆå§‹åŒ–äº† Spring <strong>äº‹ä»¶é©±åŠ¨æ¨¡å‹</strong>çš„æ ¸å¿ƒç»„ä»¶â€”â€”äº‹ä»¶å¹¿æ’­å™¨ã€‚åŒæ ·ï¼Œå®ƒä¼šå°è¯•æŸ¥æ‰¾åä¸º <code>applicationEventMulticaster</code>çš„ Beanï¼Œè‹¥æœªæ‰¾åˆ°åˆ™ä½¿ç”¨é»˜è®¤çš„ <code>SimpleApplicationEventMulticaster</code>ã€‚è¿™ä¸ªå¹¿æ’­å™¨è´Ÿè´£å°†å‘å¸ƒçš„äº‹ä»¶é€šçŸ¥ç»™æ‰€æœ‰ç›¸å…³çš„ç›‘å¬å™¨ ã€‚</p></li></ol><h3 id=-ç¬¬ä¸‰é˜¶æ®µå®¹å™¨åˆ·æ–°ä¸-bean-å®ä¾‹åŒ–>ğŸš€ ç¬¬ä¸‰é˜¶æ®µï¼šå®¹å™¨åˆ·æ–°ä¸ Bean å®ä¾‹åŒ–</h3><p>è¿™æ˜¯å¯åŠ¨æµç¨‹çš„å†²åˆºé˜¶æ®µï¼Œå®¹å™¨å°†å®Œæˆæ‰€æœ‰å‡†å¤‡å·¥ä½œå¹¶æ­£å¼å¯åŠ¨ã€‚</p><ol><li><p><strong><code>onRefresh()</code>- æ¨¡æ¿æ–¹æ³•ï¼šå­å®¹å™¨åˆ·æ–°</strong></p><p>è¿™æ˜¯å¦ä¸€ä¸ª<strong>æ¨¡æ¿æ–¹æ³•</strong>ï¼Œå…è®¸ç‰¹å®šçš„ <code>ApplicationContext</code>å­ç±»åœ¨æ­¤æ—¶æœºæ‰§è¡Œç‰¹æ®Šé€»è¾‘ã€‚ä¾‹å¦‚ï¼Œ<strong>Spring Boot çš„ <code>ServletWebServerApplicationContext</code>å°±åœ¨æ­¤æ–¹æ³•ä¸­åˆ›å»ºå¹¶å¯åŠ¨äº†å†…åµŒçš„ Web æœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰</strong> ã€‚</p></li><li><p><strong><code>registerListeners()</code>- æ³¨å†Œåº”ç”¨ç›‘å¬å™¨</strong></p><p>æ­¤æ­¥éª¤ä¼šæ³¨å†Œæ‰€æœ‰å®ç°äº† <code>ApplicationListener</code>æ¥å£çš„ç›‘å¬å™¨ Beanï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ä¹‹å‰åˆå§‹åŒ–çš„äº‹ä»¶å¹¿æ’­å™¨ä¸­ã€‚åŒæ—¶ï¼Œå®ƒä¼šå‘å¸ƒåœ¨åˆ·æ–°è¿‡ç¨‹ä¸­å¯èƒ½ç§¯å‹çš„â€œæ—©æœŸåº”ç”¨äº‹ä»¶â€ ã€‚</p></li><li><p><strong><code>finishBeanFactoryInitialization()</code>- å®Œæˆ BeanFactory çš„åˆå§‹åŒ–</strong></p><p>è¿™æ˜¯ <code>refresh()</code>æ–¹æ³•ä¸­<strong>æœ€é‡é‡çº§çš„ä¸€æ­¥</strong>ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼ŒSpring å®¹å™¨ä¼š<strong>å®ä¾‹åŒ–æ‰€æœ‰éå»¶è¿ŸåŠ è½½çš„å•ä¾‹ Bean</strong>ã€‚å®ƒéå†æ‰€æœ‰å·²æ³¨å†Œçš„ <code>BeanDefinition</code>ï¼Œè°ƒç”¨ <code>getBean()</code>æ–¹æ³•ï¼Œè§¦å‘ Bean çš„åˆ›å»ºã€ä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–ï¼ˆå¦‚è°ƒç”¨ <code>@PostConstruct</code>æ–¹æ³•ï¼‰ã€‚è‡³æ­¤ï¼Œæ‰€æœ‰å•ä¾‹ Bean éƒ½å·²åˆ›å»ºå®Œæ¯•å¹¶æ”¾å…¥å•ä¾‹æ± ä¸­ï¼Œåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒç»„ä»¶å°±ç»ª ã€‚</p></li><li><p><strong><code>finishRefresh()</code>- å®Œæˆåˆ·æ–°</strong></p><p>è¿™æ˜¯æ•´ä¸ªå¯åŠ¨æµç¨‹çš„æ”¶å®˜ä¹‹ä½œã€‚å®ƒä¼šæ¸…ç©ºèµ„æºç¼“å­˜ï¼Œåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ï¼Œå¹¶æœ€ç»ˆå‘å¸ƒ <strong><code>ContextRefreshedEvent</code></strong> äº‹ä»¶ï¼Œæ­£å¼å®£å‘Šå®¹å™¨åˆ·æ–°å®Œæˆã€‚æ­¤åï¼Œ<code>ApplicationContext</code>ä¾¿å¤„äºå®Œå…¨æ´»åŠ¨çŠ¶æ€ï¼Œå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡äº† ã€‚</p></li></ol><h3 id=-æ€»ç»“-14>ğŸ’ æ€»ç»“</h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>ApplicationContext</code>çš„ <code>refresh()</code>è¿‡ç¨‹æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾å¦™ã€æ­¥éª¤æ¸…æ™°çš„æµæ°´çº¿ã€‚å®ƒä»ç¯å¢ƒå‡†å¤‡å¼€å§‹ï¼Œé€æ­¥å®Œæˆé…ç½®åŠ è½½ã€æ‰©å±•ç‚¹è°ƒç”¨ã€åŠŸèƒ½ç»„ä»¶åˆå§‹åŒ–ï¼Œæœ€ç»ˆå®ä¾‹åŒ–æ‰€æœ‰å•ä¾‹ Bean å¹¶å¯åŠ¨å®¹å™¨ã€‚ç†è§£è¿™ä¸€è¿‡ç¨‹ï¼Œå¯¹äºæŒæ¡ Spring æ¡†æ¶çš„å†…éƒ¨æœºåˆ¶ã€è¿›è¡Œé«˜çº§å®šåˆ¶å’Œæ•…éšœæ’æŸ¥éƒ½è‡³å…³é‡è¦ã€‚</p><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£æå¯¹ä½ æœ‰å¸®åŠ©ï¼å¦‚æœä½ å¯¹å…¶ä¸­æŸä¸ªå…·ä½“æ­¥éª¤ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/spring-boot/>Spring Boot</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Sep 30, 2025 19:46 CST</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/cppreview/><div class=article-details><h2 class=article-title>ã€CPPã€‘Review</h2></div></a></article><article><a href=/p/nowcoderjava-2/><div class=article-details><h2 class=article-title>ã€NowCoderã€‘JAVA 2</h2></div></a></article><article><a href=/p/nowcodercpp/><div class=article-details><h2 class=article-title>ã€NowCoderã€‘CPP</h2></div></a></article><article><a href=/p/nowcoderjava/><div class=article-details><h2 class=article-title>ã€NowCoderã€‘JAVA</h2></div></a></article><article><a href=/p/bejava-basics/><div class=article-details><h2 class=article-title>ã€BEã€‘Java basics</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 é£é¸¿è¸é›ªæ³¥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>