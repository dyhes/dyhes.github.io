<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>OS on é£é¸¿è¸é›ªæ³¥</title><link>https://dyhes.github.io/tags/os/</link><description>Recent content in OS on é£é¸¿è¸é›ªæ³¥</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 15 Jul 2025 01:02:04 +0800</lastBuildDate><atom:link href="https://dyhes.github.io/tags/os/index.xml" rel="self" type="application/rss+xml"/><item><title>ã€OSã€‘IO</title><link>https://dyhes.github.io/p/osio/</link><pubDate>Sat, 28 Jun 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/osio/</guid><description>&lt;h2 id="select"&gt;select
&lt;/h2&gt;&lt;p&gt;I/Oå¤šè·¯å¤ç”¨ä¸­çš„&lt;code&gt;select&lt;/code&gt;æ˜¯ä¸€ç§&lt;strong&gt;åŒæ­¥I/Oäº‹ä»¶ç®¡ç†æœºåˆ¶&lt;/strong&gt;ï¼Œå…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚å¥—æ¥å­—ï¼‰çš„è¯»å†™æˆ–å¼‚å¸¸çŠ¶æ€ï¼Œä»è€Œå®ç°å¯¹é«˜å¹¶å‘è¿æ¥çš„è½»é‡åŒ–å¤„ç†ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒåŸç†ã€å®ç°æ–¹å¼ã€ä¼˜ç¼ºç‚¹åŠå¯¹æ¯”å±•å¼€è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†ä¸å·¥ä½œæµç¨‹"&gt;ğŸ” æ ¸å¿ƒåŸç†ä¸å·¥ä½œæµç¨‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡å¼äº‹ä»¶ç›‘å¬&lt;/strong&gt;
&lt;code&gt;select&lt;/code&gt;é€šè¿‡&lt;strong&gt;è½®è¯¢æœºåˆ¶&lt;/strong&gt;æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚è°ƒç”¨&lt;code&gt;select&lt;/code&gt;æ—¶ï¼Œå†…æ ¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°ä»¥ä¸‹ä»»ä¸€æƒ…å†µå‘ç”Ÿï¼š
&lt;ul&gt;
&lt;li&gt;è‡³å°‘ä¸€ä¸ªè¢«ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼ˆå¯è¯»/å¯å†™/å¼‚å¸¸ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è¶…æ—¶æ—¶é—´åˆ°è¾¾ï¼ˆç”±&lt;code&gt;timeval&lt;/code&gt;å‚æ•°æŒ‡å®šï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è¢«ä¿¡å·ä¸­æ–­&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦é›†åˆç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;fd_set&lt;/code&gt;ç»“æ„&lt;/strong&gt;ï¼šä½¿ç”¨ä½å›¾ï¼ˆbitmapï¼‰è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ¯ä¸ªæ¯”ç‰¹ä½å¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;fd=3&lt;/code&gt;å¯¹åº”ç¬¬3ä¸ªæ¯”ç‰¹ä½&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ“ä½œå®ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FD_ZERO(&amp;amp;set)&lt;/code&gt;ï¼šæ¸…ç©ºé›†åˆï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FD_SET(fd, &amp;amp;set)&lt;/code&gt;ï¼šæ·»åŠ æ–‡ä»¶æè¿°ç¬¦ï¼›
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FD_CLR(fd, &amp;amp;set)&lt;/code&gt;ï¼šç§»é™¤æ–‡ä»¶æè¿°ç¬¦ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FD_ISSET(fd, &amp;amp;set)&lt;/code&gt;ï¼šæ£€æŸ¥æ˜¯å¦å°±ç»ª&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡½æ•°åŸå‹ä¸å‚æ•°&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;nfds&lt;/code&gt;&lt;/strong&gt;ï¼šéœ€ç›‘æ§çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦å€¼+1ï¼ˆå¦‚æœ€å¤§&lt;code&gt;fd=5&lt;/code&gt;ï¼Œåˆ™&lt;code&gt;nfds=6&lt;/code&gt;ï¼‰ï¼Œé™å®šå†…æ ¸æ£€æŸ¥èŒƒå›´ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;readfds/writefds/exceptfds&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ†åˆ«ç›‘æ§å¯è¯»ã€å¯å†™ã€å¼‚å¸¸äº‹ä»¶çš„æè¿°ç¬¦é›†åˆï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;timeout&lt;/code&gt;&lt;/strong&gt;ï¼šè¶…æ—¶æ—¶é—´ï¼ˆ&lt;code&gt;NULL&lt;/code&gt;è¡¨ç¤ºæ— é™é˜»å¡ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å®ç°æ­¥éª¤ä»¥tcpæœåŠ¡å™¨ä¸ºä¾‹"&gt;âš™ï¸ å®ç°æ­¥éª¤ï¼ˆä»¥TCPæœåŠ¡å™¨ä¸ºä¾‹ï¼‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–ç›‘å¬&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºç›‘å¬å¥—æ¥å­—ï¼Œç»‘å®šç«¯å£å¹¶ç›‘å¬ï¼›&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–&lt;code&gt;fd_set&lt;/code&gt;é›†åˆï¼Œå°†ç›‘å¬å¥—æ¥å­—åŠ å…¥&lt;code&gt;readfds&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¾ªç¯ç›‘æ§ä¸äº‹ä»¶å¤„ç†&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;while (1) {
fd_set tmp_set = active_set; // å¤‡ä»½ç›‘æ§é›†åˆ
int ready = select(max_fd+1, &amp;amp;tmp_set, NULL, NULL, NULL);
// æ£€æŸ¥æ–°è¿æ¥
if (FD_ISSET(server_fd, &amp;amp;tmp_set)) {
int client_fd = accept(server_fd, ...);
FD_SET(client_fd, &amp;amp;active_set); // åŠ å…¥ç›‘æ§é›†åˆ
max_fd = (client_fd &amp;gt; max_fd) ? client_fd : max_fd;
}
// æ£€æŸ¥å®¢æˆ·ç«¯æ•°æ®
for (int fd = server_fd+1; fd &amp;lt;= max_fd; fd++) {
if (FD_ISSET(fd, &amp;amp;tmp_set)) {
recv(fd, ...); // å¤„ç†æ•°æ®
// è‹¥è¿æ¥å…³é—­ï¼Œåˆ™FD_CLRç§»é™¤
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šæ¯æ¬¡è°ƒç”¨&lt;code&gt;select&lt;/code&gt;å‰éœ€é‡ç½®ç›‘æ§é›†åˆï¼Œå› å…¶è¿”å›åä¼š&lt;strong&gt;ä¿®æ”¹é›†åˆå†…å®¹&lt;/strong&gt;ï¼Œä»…ä¿ç•™å°±ç»ªçš„æè¿°ç¬¦&lt;a class="link" href="@ref" &gt;1,4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¼˜ç¼ºç‚¹åˆ†æ"&gt;âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨å¹³å°æ”¯æŒ&lt;/strong&gt;ï¼šå‡ ä¹æ‰€æœ‰Unix/Linuxç³»ç»Ÿå‡å…¼å®¹&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶&lt;/strong&gt;ï¼šé»˜è®¤æœ€å¤§1024ï¼ˆå¯è°ƒæ•´ä½†æ•ˆç‡ä½ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¼–ç¨‹æ¨¡å‹ç®€å•&lt;/strong&gt;ï¼šé€‚åˆä½å¹¶å‘åœºæ™¯&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨éœ€å¤åˆ¶æ•´ä¸ª&lt;code&gt;fd_set&lt;/code&gt;ï¼ˆç”¨æˆ·æ€â†”å†…æ ¸æ€ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è½®è¯¢å¤æ‚åº¦O(n)ï¼Œä¸‡çº§è¿æ¥æ—¶æ•ˆç‡éª¤é™&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt; |
| â€‹&lt;strong&gt;å•çº¿ç¨‹å¤„ç†å¤šè¿æ¥&lt;/strong&gt;â€‹ï¼šå‡å°‘çº¿ç¨‹åˆ‡æ¢å¼€é”€&lt;a class="link" href="@ref" &gt;1&lt;/a&gt; | â€‹&lt;strong&gt;é‡å¤åˆå§‹åŒ–&lt;/strong&gt;â€‹ï¼šæ¯æ¬¡å¾ªç¯éœ€é‡æ–°è®¾ç½®ç›‘æ§é›†åˆ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt; |&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸pollepollçš„å¯¹æ¯”"&gt;ğŸ”„ ä¸poll/epollçš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;select&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;poll&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;epoll&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½å›¾ï¼ˆ&lt;code&gt;fd_set&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;é“¾è¡¨ï¼ˆ&lt;code&gt;pollfd&lt;/code&gt;æ•°ç»„ï¼‰&lt;/td&gt;
&lt;td&gt;çº¢é»‘æ ‘+å°±ç»ªé“¾è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœ€å¤§è¿æ¥æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1024ï¼ˆé»˜è®¤ï¼‰&lt;/td&gt;
&lt;td&gt;æ— é™åˆ¶&lt;/td&gt;
&lt;td&gt;10ä¸‡+ï¼ˆ1GBå†…å­˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;O(n)è½®è¯¢&lt;/td&gt;
&lt;td&gt;O(n)è½®è¯¢&lt;/td&gt;
&lt;td&gt;O(1)äº‹ä»¶å›è°ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ‹·è´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è°ƒç”¨å…¨é‡å¤åˆ¶&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è°ƒç”¨å…¨é‡å¤åˆ¶&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡æ³¨å†Œåä»…åŒæ­¥å°±ç»ªäº‹ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è§¦å‘æ¨¡å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/td&gt;
&lt;td&gt;æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/td&gt;
&lt;td&gt;æ”¯æŒLT/è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/strong&gt;ï¼šåªè¦ç¼“å†²åŒºæœ‰æ•°æ®ï¼ŒæŒç»­é€šçŸ¥ï¼›
â€‹&lt;strong&gt;è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰â€‹&lt;/strong&gt;â€‹ï¼šä»…çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ä¸€æ¬¡ï¼Œéœ€ä¸€æ¬¡è¯»å®Œæ•°æ®&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯"&gt;ğŸ’ é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½å¹¶å‘åœºæ™¯&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯è¿æ¥æ•°&amp;lt;1000ï¼Œä¸”éœ€è·¨å¹³å°å…¼å®¹æ—¶ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åµŒå…¥å¼ç³»ç»Ÿ&lt;/strong&gt;ï¼šèµ„æºå—é™ç¯å¢ƒï¼Œæ— éœ€é«˜å¹¶å‘æ”¯æŒï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•™å­¦åŸå‹&lt;/strong&gt;ï¼šå› å…¶æ¥å£ç®€å•ï¼Œé€‚åˆç†è§£å¤šè·¯å¤ç”¨åŸºç¡€åŸç†&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;é«˜å¹¶å‘æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šLinuxé¦–é€‰&lt;code&gt;epoll&lt;/code&gt;ï¼ˆå¦‚Nginxã€Redisï¼‰ï¼ŒFreeBSDç”¨&lt;code&gt;kqueue&lt;/code&gt;ï¼Œå¯çªç ´æ€§èƒ½ç“¶é¢ˆ&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;select&lt;/code&gt;ä½œä¸ºæœ€æ—©çš„I/Oå¤šè·¯å¤ç”¨å®ç°ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äº&lt;strong&gt;ç®€åŒ–å•çº¿ç¨‹å¤šè¿æ¥æ¨¡å‹&lt;/strong&gt;ï¼Œä½†æ€§èƒ½é™åˆ¶ä½¿å…¶éš¾ä»¥åº”å¯¹ä¸‡çº§å¹¶å‘ã€‚ç†è§£å…¶è½®è¯¢æœºåˆ¶ä¸&lt;code&gt;fd_set&lt;/code&gt;æ“ä½œæ˜¯æŒæ¡é«˜é˜¶æ¨¡å‹ï¼ˆå¦‚&lt;code&gt;epoll&lt;/code&gt;ï¼‰çš„åŸºç¡€ï¼Œå®é™…å¼€å‘ä¸­éœ€æ ¹æ®åœºæ™¯æƒè¡¡é€‰æ‹©&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="poll"&gt;poll
&lt;/h2&gt;&lt;p&gt;Poll æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äº &lt;strong&gt;I/O å¤šè·¯å¤ç”¨&lt;/strong&gt;çš„æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨ï¼Œé€šè¿‡å•çº¿ç¨‹åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚å¥—æ¥å­—ï¼‰çš„å¯è¯»ã€å¯å†™æˆ–å¼‚å¸¸äº‹ä»¶ï¼Œé€‚ç”¨äºç½‘ç»œæœåŠ¡å™¨ç­‰å¹¶å‘åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…¶è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†ä¸å·¥ä½œæµç¨‹-1"&gt;ğŸ” æ ¸å¿ƒåŸç†ä¸å·¥ä½œæµç¨‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;/strong&gt;
Poll é‡‡ç”¨&lt;strong&gt;è½®è¯¢æœºåˆ¶&lt;/strong&gt;ï¼Œç”¨æˆ·ç¨‹åºé€šè¿‡ &lt;code&gt;poll()&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨å‘å†…æ ¸æ³¨å†Œä¸€ç»„å¾…ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦åŠå…¶å…³æ³¨çš„äº‹ä»¶ï¼ˆå¦‚ &lt;code&gt;POLLIN&lt;/code&gt; å¯è¯»ï¼‰ã€‚å†…æ ¸ä¼šé˜»å¡è¿›ç¨‹ï¼Œç›´åˆ°ä»¥ä¸‹ä»»ä¸€æƒ…å†µå‘ç”Ÿï¼š
&lt;ul&gt;
&lt;li&gt;è‡³å°‘ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å°±ç»ªï¼›&lt;/li&gt;
&lt;li&gt;è¶…æ—¶æ—¶é—´åˆ°è¾¾ï¼ˆç”± &lt;code&gt;timeout&lt;/code&gt; å‚æ•°æŒ‡å®šï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è¢«ä¿¡å·ä¸­æ–­&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç»“æ„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;**
&lt;pre tabindex="0"&gt;&lt;code&gt;struct pollfd
&lt;/code&gt;&lt;/pre&gt;**ï¼šæ ¸å¿ƒç»“æ„ä½“ï¼ŒåŒ…å«ä¸‰ä¸ªå­—æ®µï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;struct pollfd {
int fd; // ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦
short events; // å…³æ³¨çš„äº‹ä»¶ï¼ˆç”¨æˆ·è®¾ç½®ï¼‰
short revents; // å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼ˆå†…æ ¸å¡«å……ï¼‰
};
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;events&lt;/code&gt; ç”±ç”¨æˆ·è®¾ç½®ï¼ˆå¦‚ &lt;code&gt;POLLIN | POLLOUT&lt;/code&gt;ï¼‰ï¼Œ&lt;code&gt;revents&lt;/code&gt; ç”±å†…æ ¸è¿”å›ï¼Œæ ‡è¯†å®é™…è§¦å‘çš„äº‹ä»¶&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹ä»¶ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;POLLIN&lt;/code&gt;ï¼šæ•°æ®å¯è¯»ï¼ˆç­‰æ•ˆäº &lt;code&gt;select&lt;/code&gt; çš„è¯»äº‹ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;POLLOUT&lt;/code&gt;ï¼šæ•°æ®å¯å†™ï¼ˆä¸é˜»å¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;POLLERR&lt;/code&gt;ï¼šé”™è¯¯å‘ç”Ÿï¼ˆå¦‚è¿æ¥é‡ç½®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;POLLHUP&lt;/code&gt;ï¼šè¿æ¥æŒ‚èµ·ï¼ˆå¯¹ç«¯å…³é—­ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡½æ•°åŸå‹&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#include &amp;lt;poll.h&amp;gt;
int poll(struct pollfd *fds, nfds_t nfds, int timeout);
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;fds&lt;/code&gt;&lt;/strong&gt;ï¼šæŒ‡å‘ &lt;code&gt;pollfd&lt;/code&gt; ç»“æ„ä½“æ•°ç»„çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;nfds&lt;/code&gt;&lt;/strong&gt;ï¼šæ•°ç»„é•¿åº¦ï¼ˆéœ€ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;timeout&lt;/code&gt;&lt;/strong&gt;ï¼šè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ&lt;code&gt;-1&lt;/code&gt; è¡¨ç¤ºæ°¸ä¹…é˜»å¡ï¼Œ&lt;code&gt;0&lt;/code&gt; è¡¨ç¤ºéé˜»å¡ç«‹å³è¿”å›&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨æ­¥éª¤ä»¥-tcp-æœåŠ¡å™¨ä¸ºä¾‹"&gt;âš™ï¸ ä½¿ç”¨æ­¥éª¤ï¼ˆä»¥ TCP æœåŠ¡å™¨ä¸ºä¾‹ï¼‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–ç›‘å¬&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºç›‘å¬å¥—æ¥å­—ï¼Œç»‘å®šç«¯å£å¹¶ç›‘å¬ã€‚&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– &lt;code&gt;pollfd&lt;/code&gt; æ•°ç»„ï¼Œå°†ç›‘å¬å¥—æ¥å­—åŠ å…¥æ•°ç»„ï¼Œå¹¶è®¾ç½® &lt;code&gt;events = POLLIN&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶å¾ªç¯ä¸å¤„ç†&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;struct pollfd fds[MAX_FD];
fds[0].fd = listen_fd; // ç›‘å¬å¥—æ¥å­—
fds[0].events = POLLIN;
while (1) {
int ready = poll(fds, nfds, -1); // é˜»å¡ç­‰å¾…äº‹ä»¶
if (ready &amp;lt; 0) { /* é”™è¯¯å¤„ç† */ }
for (int i = 0; i &amp;lt; nfds; i++) {
if (fds[i].revents &amp;amp; POLLIN) {
if (fds[i].fd == listen_fd) {
// æ¥å—æ–°è¿æ¥
int conn_fd = accept(listen_fd, ...);
fds[nfds].fd = conn_fd; // åŠ å…¥ç›‘æ§æ•°ç»„
fds[nfds].events = POLLIN;
nfds++;
} else {
// å¤„ç†å®¢æˆ·ç«¯æ•°æ®
recv(fds[i].fd, ...);
if (è¿æ¥å…³é—­) {
close(fds[i].fd);
fds[i].fd = -1; // æ ‡è®°ä¸ºæ— æ•ˆ
}
}
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨ &lt;code&gt;poll()&lt;/code&gt; åéœ€éå†æ•°ç»„ï¼Œé€šè¿‡ &lt;code&gt;revents&lt;/code&gt; åˆ¤æ–­å°±ç»ªäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;æ— æ•ˆæè¿°ç¬¦éœ€å°† &lt;code&gt;fd&lt;/code&gt; è®¾ä¸º &lt;code&gt;-1&lt;/code&gt;ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨è·³è¿‡&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¼˜ç¼ºç‚¹åˆ†æ-1"&gt;âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ— æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶&lt;/strong&gt;ï¼šä½¿ç”¨åŠ¨æ€æ•°ç»„ï¼Œçªç ´ &lt;code&gt;select&lt;/code&gt; çš„ 1024 é™åˆ¶ï¼ˆä»…å—ç³»ç»Ÿèµ„æºçº¦æŸï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è½®è¯¢æ•ˆç‡ä½&lt;/strong&gt;ï¼šæ¯æ¬¡è°ƒç”¨éœ€éå†æ•´ä¸ªæ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦ O(n)ï¼Œä¸‡çº§è¿æ¥æ—¶æ€§èƒ½éª¤é™&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹ä»¶åˆ†ç¦»è®¾è®¡&lt;/strong&gt;ï¼š&lt;code&gt;events&lt;/code&gt;ï¼ˆè¾“å…¥ï¼‰ä¸ &lt;code&gt;revents&lt;/code&gt;ï¼ˆè¾“å‡ºï¼‰åˆ†ç¦»ï¼Œæ— éœ€æ¯æ¬¡é‡ç½®ç›‘æ§é›†åˆ&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ‹·è´å¼€é”€å¤§&lt;/strong&gt;ï¼šæ¯æ¬¡è°ƒç”¨éœ€å°†æ•´ä¸ª &lt;code&gt;fds&lt;/code&gt; æ•°ç»„å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œé«˜å¹¶å‘æ—¶å ç”¨å¸¦å®½&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨å¹³å°æ”¯æŒ&lt;/strong&gt;ï¼šå¤šæ•° Unix-like ç³»ç»Ÿå…¼å®¹ï¼ˆå¦‚ Linux/FreeBSDï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒåŠ¨æ€äº‹ä»¶æ›´æ–°&lt;/strong&gt;ï¼šæ— æ³•å•ç‹¬ä¿®æ”¹æŸä¸ªæè¿°ç¬¦çš„äº‹ä»¶ï¼Œéœ€éå†æ•°ç»„&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸-selectepoll-çš„å¯¹æ¯”"&gt;ğŸ”„ ä¸ select/epoll çš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;select&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;poll&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;epoll&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šä½å›¾ï¼ˆ&lt;code&gt;fd_set&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€æ•°ç»„ï¼ˆ&lt;code&gt;pollfd&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;çº¢é»‘æ ‘ + å°±ç»ªé“¾è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœ€å¤§è¿æ¥æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1024ï¼ˆç¡¬ç¼–ç ï¼‰&lt;/td&gt;
&lt;td&gt;æ— é™åˆ¶ï¼ˆå—å†…å­˜é™åˆ¶ï¼‰&lt;/td&gt;
&lt;td&gt;10ä¸‡+ï¼ˆé«˜æ•ˆå†…å­˜ç®¡ç†ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹ä»¶é€šçŸ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡éœ€é‡ç½®ä½å›¾&lt;/td&gt;
&lt;td&gt;æ— éœ€é‡ç½®æ•°ç»„&lt;/td&gt;
&lt;td&gt;ä»…æ³¨å†Œä¸€æ¬¡ï¼Œäº‹ä»¶å›è°ƒè§¦å‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¶é—´å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;O(n) è½®è¯¢&lt;/td&gt;
&lt;td&gt;O(n) è½®è¯¢&lt;/td&gt;
&lt;td&gt;O(1) äº‹ä»¶å›è°ƒï¼ˆä»…æ´»è·ƒè¿æ¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½å¹¶å‘ã€è·¨å¹³å°éœ€æ±‚&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰å¹¶å‘ï¼ˆæ•°åƒè¿æ¥ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ï¼ˆå¦‚ Nginxã€Redisï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/strong&gt;ï¼šPoll å’Œ select å‡é‡‡ç”¨ LT æ¨¡å¼â€”â€”åªè¦ç¼“å†²åŒºæœ‰æ•°æ®ï¼ŒæŒç»­é€šçŸ¥ï¼›epoll æ”¯æŒ ET æ¨¡å¼ï¼ˆä»…çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ä¸€æ¬¡ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯-1"&gt;ğŸ’ é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸­ç­‰å¹¶å‘ç½‘ç»œæœåŠ¡&lt;/strong&gt;ï¼šè¿æ¥æ•°åœ¨æ•°åƒçº§åˆ«ï¼Œä¸”éœ€è·¨å¹³å°å…¼å®¹çš„åœºæ™¯&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åµŒå…¥å¼ç³»ç»Ÿ&lt;/strong&gt;ï¼šèµ„æºæœ‰é™ä½†éœ€åŒæ—¶å¤„ç†å¤šä¸ª I/O è®¾å¤‡ï¼ˆå¦‚ä¸²å£ã€ä¼ æ„Ÿå™¨ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£ select çš„è¿‡æ¸¡æ–¹æ¡ˆ&lt;/strong&gt;ï¼šè§£å†³ select çš„ 1024 é™åˆ¶ï¼Œä½†å°šæœªéœ€ epoll çš„æè‡´æ€§èƒ½æ—¶&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆæç¤º&lt;/strong&gt;ï¼šè‹¥è¿æ¥æ•°è¶… 5000ï¼Œå»ºè®®æ”¹ç”¨ &lt;code&gt;epoll&lt;/code&gt;ï¼ˆLinuxï¼‰æˆ– &lt;code&gt;kqueue&lt;/code&gt;ï¼ˆFreeBSDï¼‰ä»¥è§„é¿è½®è¯¢å¼€é”€&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ“ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Poll ä½œä¸º I/O å¤šè·¯å¤ç”¨çš„â€œä¸­åšåŠ›é‡â€ï¼Œ&lt;strong&gt;å¹³è¡¡äº†çµæ´»æ€§ä¸å¤æ‚åº¦&lt;/strong&gt;ï¼šçªç ´äº† select çš„ç¡¬æ€§é™åˆ¶ï¼Œç®€åŒ–äº†ç¼–ç¨‹æ¨¡å‹ï¼Œä½†æœªè§£å†³è½®è¯¢æ•ˆç‡ä¸å†…å­˜æ‹·è´çš„æœ¬è´¨é—®é¢˜ã€‚ç†è§£å…¶åŸºäºæ•°ç»„çš„äº‹ä»¶æ³¨å†Œ/å›è°ƒæœºåˆ¶ï¼ˆ&lt;code&gt;pollfd&lt;/code&gt; ç»“æ„ä½“ï¼‰æ˜¯æŒæ¡é«˜é˜¶æ¨¡å‹ï¼ˆå¦‚ epollï¼‰çš„åŸºç¡€ï¼Œå®é™…é€‰å‹éœ€æ ¹æ®å¹¶å‘è§„æ¨¡ä¸å¹³å°ç‰¹æ€§æƒè¡¡&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="selectpoll"&gt;select/poll
&lt;/h2&gt;&lt;p&gt;Selectå’ŒPollæ˜¯Linuxç³»ç»Ÿä¸­ä¼ ç»Ÿçš„I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œç”¨äºå®ç°å•çº¿ç¨‹/è¿›ç¨‹é«˜æ•ˆç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚å¥—æ¥å­—ï¼‰ã€‚å®ƒä»¬é€šè¿‡&lt;strong&gt;ç»Ÿä¸€ç›‘å¬å¤šä¸ªI/Oäº‹ä»¶&lt;/strong&gt;ï¼Œé¿å…ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºç‹¬ç«‹çº¿ç¨‹/è¿›ç¨‹çš„èµ„æºæ¶ˆè€—ï¼Œæ˜¯é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ç»„ä»¶ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-selectåŸºäºä½æ©ç çš„è½®è¯¢æ¨¡å‹"&gt;âš™ï¸ &lt;strong&gt;Selectï¼šåŸºäºä½æ©ç çš„è½®è¯¢æ¨¡å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåŸç†"&gt;&lt;strong&gt;æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç»“æ„&lt;/strong&gt;ï¼šä½¿ç”¨å›ºå®šå¤§å°çš„ä½æ©ç &lt;code&gt;fd_set&lt;/code&gt;ï¼ˆä½å›¾ï¼‰ï¼Œæ¯”ç‰¹ä½ä½ç½®ä»£è¡¨æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Œå€¼è¡¨ç¤ºæ˜¯å¦ç›‘æ§&lt;a class="link" href="@ref" &gt;1,3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;äº‹ä»¶ç±»å‹ï¼šç›‘æ§ä¸‰ç±»äº‹ä»¶é›†åˆï¼š
&lt;ul&gt;
&lt;li&gt;è¯»å°±ç»ªï¼ˆ&lt;code&gt;readfds&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å†™å°±ç»ªï¼ˆ&lt;code&gt;writefds&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸ï¼ˆ&lt;code&gt;exceptfds&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·¥ä½œæµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–&lt;code&gt;fd_set&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;FD_SET()&lt;/code&gt;æ·»åŠ å¾…ç›‘æ§çš„fdã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;select&lt;/code&gt;é˜»å¡ç­‰å¾…ï¼Œå†…æ ¸è½®è¯¢æ‰€æœ‰fdï¼Œæ£€æŸ¥å°±ç»ªçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›åï¼Œç”¨æˆ·éå†æ‰€æœ‰fdï¼Œç”¨&lt;code&gt;FD_ISSET()&lt;/code&gt;åˆ¤æ–­å“ªäº›fdå°±ç»ª&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¨å¹³å°æ”¯æŒ&lt;/strong&gt;ï¼šå‡ ä¹æ‰€æœ‰Unix-likeç³»ç»Ÿå‡æ”¯æŒ&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•æ˜“ç”¨&lt;/strong&gt;ï¼šé€‚åˆfdæ•°é‡å°‘ï¼ˆ&amp;lt;1000ï¼‰çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;fdæ•°é‡é™åˆ¶&lt;/strong&gt;ï¼šé»˜è®¤æœ€å¤§1024ï¼ˆç”±&lt;code&gt;FD_SETSIZE&lt;/code&gt;å†³å®šï¼‰ï¼Œéœ€ä¿®æ”¹å†…æ ¸æ‰èƒ½æ‰©å±•&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ç“¶é¢ˆï¼š
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨éœ€å°†æ•´ä¸ª&lt;code&gt;fd_set&lt;/code&gt;ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ã€‚&lt;/li&gt;
&lt;li&gt;å†…æ ¸éœ€éå†æ‰€æœ‰fdï¼ˆæ—¶é—´å¤æ‚åº¦O(n)ï¼‰ï¼Œé«˜å¹¶å‘æ—¶æ•ˆç‡éª¤é™&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›åç”¨æˆ·ä»éœ€éå†æ‰€æœ‰fdç¡®è®¤å°±ç»ªçŠ¶æ€&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å°è§„æ¨¡è¿æ¥ï¼ˆå¦‚åµŒå…¥å¼è®¾å¤‡ã€ä½å¹¶å‘æœ¬åœ°æœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-pollåŠ¨æ€æ•°ç»„çš„æ”¹è¿›æ¨¡å‹"&gt;ğŸ”„ &lt;strong&gt;Pollï¼šåŠ¨æ€æ•°ç»„çš„æ”¹è¿›æ¨¡å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåŸç†-1"&gt;&lt;strong&gt;æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ•°æ®ç»“æ„ï¼šä½¿ç”¨åŠ¨æ€æ•°ç»„
&lt;pre tabindex="0"&gt;&lt;code&gt;struct pollfd[]
&lt;/code&gt;&lt;/pre&gt;ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fd&lt;/code&gt;ï¼šç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;&lt;code&gt;events&lt;/code&gt;ï¼šç›‘æ§çš„äº‹ä»¶ï¼ˆå¦‚&lt;code&gt;POLLIN&lt;/code&gt;/&lt;code&gt;POLLOUT&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;revents&lt;/code&gt;ï¼šè¿”å›çš„å®é™…å‘ç”Ÿäº‹ä»¶&lt;a class="link" href="@ref" &gt;2,7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶ç±»å‹&lt;/strong&gt;ï¼šæ”¯æŒæ›´ä¸°å¯Œçš„äº‹ä»¶ï¼ˆå¦‚&lt;code&gt;POLLPRI&lt;/code&gt;ç´§æ€¥æ•°æ®ã€&lt;code&gt;POLLHUP&lt;/code&gt;æŒ‚æ–­ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å·¥ä½œæµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–&lt;code&gt;pollfd&lt;/code&gt;æ•°ç»„ï¼Œè®¾ç½®éœ€ç›‘æ§çš„fdåŠäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;poll&lt;/code&gt;é˜»å¡ç­‰å¾…ï¼Œå†…æ ¸è½®è¯¢fdæ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›åï¼Œç”¨æˆ·éå†æ•°ç»„ï¼Œæ£€æŸ¥&lt;code&gt;revents&lt;/code&gt;åˆ¤æ–­å°±ç»ªfd&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹-1"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— fdæ•°é‡é™åˆ¶&lt;/strong&gt;ï¼šåŠ¨æ€æ•°ç»„ç†è®ºä¸Šæ”¯æŒæ— é™fdï¼ˆå—ç³»ç»Ÿå…¨å±€é™åˆ¶ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶åˆ†ç¦»&lt;/strong&gt;ï¼š&lt;code&gt;events&lt;/code&gt;ï¼ˆç”¨æˆ·è®¾ç½®ï¼‰ä¸&lt;code&gt;revents&lt;/code&gt;ï¼ˆå†…æ ¸è¿”å›ï¼‰åˆ†ç¦»ï¼Œæ— éœ€æ¯æ¬¡é‡ç½®æ•°ç»„&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;æ€§èƒ½é—®é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨ä»éœ€å¤åˆ¶æ•´ä¸ª&lt;code&gt;pollfd&lt;/code&gt;æ•°ç»„åˆ°å†…æ ¸ã€‚&lt;/li&gt;
&lt;li&gt;å†…æ ¸ä»éœ€éå†æ‰€æœ‰fdï¼ˆO(n)å¤æ‚åº¦ï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/strong&gt;ï¼šæœªå¤„ç†çš„å°±ç»ªäº‹ä»¶ä¼šæŒç»­é€šçŸ¥ï¼Œå¯èƒ½é€ æˆæ— æ•ˆå”¤é†’&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¸­ç­‰è§„æ¨¡è¿æ¥ï¼ˆå¦‚ä¼ä¸šå†…éƒ¨æœåŠ¡ã€ä¸­å¹¶å‘ä»£ç†ï¼‰&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-select-vs-pollå…³é”®å·®å¼‚è¯¦è§£"&gt;âš–ï¸ &lt;strong&gt;Select vs Pollï¼šå…³é”®å·®å¼‚è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Select&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Poll&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šå¤§å°ä½å›¾ï¼ˆ&lt;code&gt;fd_set&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€ç»“æ„ä½“æ•°ç»„ï¼ˆ&lt;code&gt;pollfd[]&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœ€å¤§fdæ•°é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1024ï¼ˆç¡¬é™åˆ¶ï¼‰&lt;/td&gt;
&lt;td&gt;æ— é™åˆ¶ï¼ˆå—ç³»ç»Ÿå…¨å±€é™åˆ¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹ä»¶åˆ†ç¦»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ··åˆè¯»å†™å¼‚å¸¸äº‹ä»¶&lt;/td&gt;
&lt;td&gt;åˆ†ç¦»&lt;code&gt;events&lt;/code&gt;ï¼ˆè¾“å…¥ï¼‰å’Œ&lt;code&gt;revents&lt;/code&gt;ï¼ˆè¾“å‡ºï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¶é—´ç²¾åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¾®ç§’ï¼ˆ&lt;code&gt;struct timeval&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;æ¯«ç§’ï¼ˆ&lt;code&gt;int timeout&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹ä»¶ç±»å‹æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…åŸºç¡€è¯»å†™å¼‚å¸¸&lt;/td&gt;
&lt;td&gt;æ›´ä¸°å¯Œï¼ˆå¦‚&lt;code&gt;POLLRDHUP&lt;/code&gt;åŠå…³é—­ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å·®ï¼ˆO(n)éå†+æ‹·è´å¼€é”€ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆO(n)éå†ï¼Œæ— ç¡¬é™åˆ¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸ–¥ï¸ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;Selectï¼š
&lt;ul&gt;
&lt;li&gt;ç›‘æ§å°‘é‡fdï¼ˆå¦‚ä¸²å£é€šä¿¡ã€åµŒå…¥å¼è®¾å¤‡ï¼‰&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è·¨å¹³å°å…¼å®¹æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚Windows/LinuxåŒå¹³å°æœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pollï¼š
&lt;ul&gt;
&lt;li&gt;ä¸­ç­‰è§„æ¨¡æœåŠ¡å™¨ï¼ˆå¦‚æ¸¸æˆåç«¯ã€APIç½‘å…³ï¼‰ï¼Œè¿æ¥æ•°åœ¨æ•°åƒçº§åˆ«&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ç²¾ç»†äº‹ä»¶æ§åˆ¶çš„åœºæ™¯ï¼ˆå¦‚å¤„ç†å¸¦å¤–æ•°æ®&lt;code&gt;POLLPRI&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“æŠ€æœ¯é€‰å‹å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šæŠ€æœ¯é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©Selectå½“&lt;/strong&gt;ï¼š
âœ… è¿æ¥æ•°å°‘ï¼ˆ&amp;lt;500ï¼‰ä¸”éœ€è·¨å¹³å°å…¼å®¹&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©Pollå½“&lt;/strong&gt;ï¼š
âœ… è¿æ¥æ•°ä¸­ç­‰ï¼ˆ&amp;lt;1ä¸‡ï¼‰ï¼Œéœ€äº‹ä»¶åˆ†ç¦»æˆ–æ— fdé™åˆ¶&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ä¸¤è€…å½“&lt;/strong&gt;ï¼š
âŒ é«˜å¹¶å‘ï¼ˆ&amp;gt;1ä¸‡è¿æ¥ï¼‰åœºæ™¯â€”â€”æ”¹ç”¨&lt;strong&gt;Epoll&lt;/strong&gt;â€‹ï¼ˆäº‹ä»¶é©±åŠ¨+O(1)å¤æ‚åº¦ï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šç°ä»£é«˜å¹¶å‘ç³»ç»Ÿï¼ˆå¦‚Nginxã€Redisï¼‰å·²å…¨é¢è½¬å‘Epollã€‚ä½†åœ¨èµ„æºå—é™æˆ–å…¼å®¹æ€§ä¼˜å…ˆçš„åœºæ™¯ï¼ŒSelect/Pollä»æ˜¯å¯é é€‰æ‹©&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="epoll"&gt;epoll
&lt;/h2&gt;&lt;p&gt;epollï¼ˆevent pollï¼‰æ˜¯Linuxå†…æ ¸æä¾›çš„é«˜æ€§èƒ½I/Oå¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œä¸“ä¸ºå¤„ç†å¤§è§„æ¨¡å¹¶å‘è¿æ¥ï¼ˆå°¤å…¶æ´»è·ƒè¿æ¥å æ¯”ä½çš„åœºæ™¯ï¼‰è€Œè®¾è®¡ï¼Œæ˜¾è‘—ä¼˜äºä¼ ç»Ÿçš„&lt;code&gt;select&lt;/code&gt;å’Œ&lt;code&gt;poll&lt;/code&gt;ã€‚å…¶æ ¸å¿ƒåœ¨äº&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;å’Œ&lt;strong&gt;é«˜æ•ˆæ•°æ®ç»“æ„&lt;/strong&gt;çš„ç»“åˆï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†ä¸æ•°æ®ç»“æ„"&gt;ğŸ” æ ¸å¿ƒåŸç†ä¸æ•°æ®ç»“æ„
&lt;/h3&gt;&lt;h4 id="äº‹ä»¶é©±åŠ¨æ¨¡å‹"&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;epollé€šè¿‡å›è°ƒæœºåˆ¶å®ç°äº‹ä»¶é©±åŠ¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰å‘ç”ŸI/Oäº‹ä»¶ï¼ˆå¦‚æ•°æ®åˆ°è¾¾ï¼‰æ—¶ï¼Œå†…æ ¸è‡ªåŠ¨è§¦å‘å›è°ƒå‡½æ•°&lt;code&gt;ep_poll_callback&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¯¥å›è°ƒå°†äº‹ä»¶å¯¹åº”çš„&lt;code&gt;epitem&lt;/code&gt;ç»“æ„ä½“åŠ å…¥&lt;strong&gt;å°±ç»ªé“¾è¡¨&lt;/strong&gt;ï¼ˆ&lt;code&gt;rdllist&lt;/code&gt;ï¼‰ï¼Œæ— éœ€éå†æ‰€æœ‰fd&lt;a class="link" href="@ref" &gt;2,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ ¸å¿ƒæ•°æ®ç»“æ„"&gt;&lt;strong&gt;æ ¸å¿ƒæ•°æ®ç»“æ„&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;epollä¾èµ–ä¸¤ä¸ªå…³é”®ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¢é»‘æ ‘ï¼ˆrbrï¼‰&lt;/strong&gt;
å­˜å‚¨æ‰€æœ‰æ³¨å†Œçš„fdåŠå…¶å…³æ³¨çš„äº‹ä»¶ï¼ˆ&lt;code&gt;epitem&lt;/code&gt;ï¼‰ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º&lt;code&gt;O(log n)&lt;/code&gt;ï¼Œé¿å…é‡å¤æ·»åŠ &lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒå‘å°±ç»ªé“¾è¡¨ï¼ˆrdllistï¼‰&lt;/strong&gt;
å­˜æ”¾å·²å°±ç»ªçš„äº‹ä»¶ï¼Œ&lt;code&gt;epoll_wait&lt;/code&gt;ç›´æ¥ä»æ­¤é“¾è¡¨è·å–å°±ç»ªäº‹ä»¶ï¼Œæ—¶é—´å¤æ‚åº¦&lt;code&gt;O(1)&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;struct eventpoll {
struct rb_root rbr; // çº¢é»‘æ ‘æ ¹èŠ‚ç‚¹
struct list_head rdllist; // å°±ç»ªäº‹ä»¶é“¾è¡¨
};
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å·¥ä½œæµç¨‹"&gt;&lt;strong&gt;å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–&lt;/strong&gt;
&lt;code&gt;epoll_create()&lt;/code&gt;åˆ›å»º&lt;code&gt;eventpoll&lt;/code&gt;å¯¹è±¡ï¼Œåˆå§‹åŒ–çº¢é»‘æ ‘å’Œå°±ç»ªé“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶æ³¨å†Œ&lt;/strong&gt;
&lt;code&gt;epoll_ctl(EPOLL_CTL_ADD)&lt;/code&gt;å°†fdåŠ å…¥çº¢é»‘æ ‘ï¼Œå¹¶æ³¨å†Œå›è°ƒå‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;äº‹ä»¶ç­‰å¾…
&lt;pre tabindex="0"&gt;&lt;code&gt;epoll_wait()
&lt;/code&gt;&lt;/pre&gt;æ£€æŸ¥å°±ç»ªé“¾è¡¨ï¼š
&lt;ul&gt;
&lt;li&gt;é“¾è¡¨éç©ºï¼šå¤åˆ¶å°±ç»ªäº‹ä»¶åˆ°ç”¨æˆ·ç©ºé—´å¹¶è¿”å›æ•°é‡ï¼›&lt;/li&gt;
&lt;li&gt;é“¾è¡¨ä¸ºç©ºï¼šçº¿ç¨‹é˜»å¡ç›´åˆ°è¶…æ—¶æˆ–æ–°äº‹ä»¶åŠ å…¥&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®ç³»ç»Ÿè°ƒç”¨"&gt;âš™ï¸ å…³é”®ç³»ç»Ÿè°ƒç”¨
&lt;/h3&gt;&lt;h4 id="epoll_createint-size"&gt;&lt;strong&gt;&lt;code&gt;epoll_create(int size)&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åˆ›å»ºepollå®ä¾‹ï¼Œè¿”å›epollæ–‡ä»¶æè¿°ç¬¦ï¼ˆepfdï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;size&lt;/code&gt;å‚æ•°ä»…ä½œå†å²å…¼å®¹ï¼Œç°ä»£å†…æ ¸è‡ªåŠ¨åŠ¨æ€è°ƒæ•´&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="epoll_ctlint-epfd-int-op-int-fd-struct-epoll_event-event"&gt;&lt;strong&gt;&lt;code&gt;epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ“ä½œepollå®ä¾‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;op&lt;/code&gt;ï¼šæ“ä½œç±»å‹ï¼ˆ&lt;code&gt;EPOLL_CTL_ADD/MOD/DEL&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;event&lt;/code&gt;ï¼šæŒ‡å®šç›‘å¬çš„äº‹ä»¶ç±»å‹ï¼ˆå¦‚&lt;code&gt;EPOLLIN&lt;/code&gt;å¯è¯»ã€&lt;code&gt;EPOLLOUT&lt;/code&gt;å¯å†™ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šæ³¨å†Œfdçš„å¯è¯»äº‹ä»¶ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;struct epoll_event ev;
ev.events = EPOLLIN;
ev.data.fd = sockfd;
epoll_ctl(epfd, EPOLL_CTL_ADD, sockfd, &amp;amp;ev);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="epoll_waitint-epfd-struct-epoll_event-events-int-maxevents-int-timeout"&gt;&lt;strong&gt;&lt;code&gt;epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout)&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é˜»å¡ç­‰å¾…å°±ç»ªäº‹ä»¶ï¼Œè¿”å›å°±ç»ªäº‹ä»¶æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;events&lt;/code&gt;ï¼šç”¨æˆ·ç©ºé—´æ•°ç»„ï¼Œç”¨äºæ¥æ”¶å°±ç»ªäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maxevents&lt;/code&gt;ï¼šæ•°ç»„å¤§å°ï¼Œé˜²æ­¢æº¢å‡º&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å·¥ä½œæ¨¡å¼lt-vs-et"&gt;ğŸ”„ å·¥ä½œæ¨¡å¼ï¼šLT vs ET
&lt;/h3&gt;&lt;h4 id="æ°´å¹³è§¦å‘lté»˜è®¤æ¨¡å¼"&gt;&lt;strong&gt;æ°´å¹³è§¦å‘ï¼ˆLTï¼Œé»˜è®¤æ¨¡å¼ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;ï¼šåªè¦fdç¼“å†²åŒºæœ‰æœªè¯»æ•°æ®ï¼ŒæŒç»­é€šçŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç¼–ç¨‹ç®€å•ï¼Œå…¼å®¹é˜»å¡/éé˜»å¡I/Oã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¯èƒ½é¢‘ç¹å”¤é†’ï¼Œå¤„ç†æ•ˆç‡è¾ƒä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç›‘å¬å¥—æ¥å­—ï¼ˆå¦‚Nginxçš„&lt;code&gt;listen_fd&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¾¹ç¼˜è§¦å‘et"&gt;&lt;strong&gt;è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;ï¼šä»…åœ¨fdçŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ä¸€æ¬¡ï¼ˆå¦‚æ•°æ®é¦–æ¬¡åˆ°è¾¾ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¦æ±‚&lt;/strong&gt;ï¼šå¿…é¡»ä½¿ç”¨&lt;strong&gt;éé˜»å¡I/O&lt;/strong&gt;ï¼Œä¸”éœ€ä¸€æ¬¡æ€§è¯»å®Œæ•°æ®ï¼ˆå¾ªç¯è¯»è‡³&lt;code&gt;EAGAIN&lt;/code&gt;é”™è¯¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå‡å°‘æ— æ•ˆå”¤é†’ï¼Œæå‡æ€§èƒ½ï¼ˆNginxé»˜è®¤æ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;ï¼šæ•°æ®æœªè¯»å®Œå¯èƒ½å¯¼è‡´äº‹ä»¶ä¸¢å¤±&lt;a class="link" href="@ref" &gt;2,5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ¨¡å¼å¯¹æ¯”"&gt;æ¨¡å¼å¯¹æ¯”
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;LTæ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ETæ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¼“å†²åŒºæœ‰æ•°æ®å³è§¦å‘&lt;/td&gt;
&lt;td&gt;ä»…çŠ¶æ€å˜åŒ–æ—¶è§¦å‘ä¸€æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;I/Oè¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é˜»å¡/éé˜»å¡å‡å¯&lt;/td&gt;
&lt;td&gt;å¿…é¡»éé˜»å¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®è¯»å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯åˆ†æ‰¹è¯»å–&lt;/td&gt;
&lt;td&gt;éœ€ä¸€æ¬¡æ€§è¯»å®Œï¼ˆé¿å…äº‹ä»¶ä¸¢å¤±ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¾ƒä½ï¼ˆé¢‘ç¹é€šçŸ¥ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼ˆé€šçŸ¥æ¬¡æ•°å°‘ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›‘å¬å¥—æ¥å­—&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘æ•°æ®è¿æ¥ï¼ˆå¦‚Nginxï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€§èƒ½ä¼˜åŠ¿è¯¦è§£"&gt;ğŸš€ æ€§èƒ½ä¼˜åŠ¿è¯¦è§£
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ— FDæ•°é‡é™åˆ¶&lt;/strong&gt;
ä»…å—ç³»ç»Ÿæœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ï¼ˆé€šè¿‡&lt;code&gt;ulimit -n&lt;/code&gt;è°ƒæ•´ï¼‰ï¼Œå¯æ”¯æŒ10ä¸‡+è¿æ¥&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;O(1)äº‹ä»¶æ£€æµ‹&lt;/strong&gt;
é€šè¿‡å°±ç»ªé“¾è¡¨ç›´æ¥è·å–æ´»è·ƒäº‹ä»¶ï¼Œé¿å…&lt;code&gt;select/poll&lt;/code&gt;çš„&lt;code&gt;O(n)&lt;/code&gt;è½®è¯¢&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›¶æ‹·è´ä¼˜åŒ–&lt;/strong&gt;
å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´é€šè¿‡&lt;strong&gt;å…±äº«å†…å­˜&lt;/strong&gt;ä¼ é€’å°±ç»ªäº‹ä»¶ï¼ˆ&lt;code&gt;mmap&lt;/code&gt;æŠ€æœ¯ï¼‰ï¼Œå‡å°‘æ•°æ®æ‹·è´&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆå›è°ƒæœºåˆ¶&lt;/strong&gt;
ä»…æ´»è·ƒfdè§¦å‘å›è°ƒï¼Œç©ºé—²è¿æ¥ä¸å ç”¨CPUèµ„æº&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„äº‹é¡¹"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ETæ¨¡å¼å¿…é¡»æ­é…éé˜»å¡I/O&lt;/strong&gt;
é¿å…å› æœªè¯»å®Œæ•°æ®å¯¼è‡´çº¿ç¨‹é˜»å¡ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;fcntl(fd, F_SETFL, O_NONBLOCK); // è®¾ç½®éé˜»å¡
while (read(fd, buf, size) != -1 || errno != EAGAIN); // å¾ªç¯è¯»è‡³ç©º
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…äº‹ä»¶ä¸¢å¤±ï¼ˆETæ¨¡å¼ï¼‰&lt;/strong&gt;
éœ€åœ¨å•æ¬¡å›è°ƒä¸­å¤„ç†å®Œæ‰€æœ‰æ•°æ®ï¼Œå¦åˆ™éœ€é‡æ–°æ³¨å†Œäº‹ä»¶&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šçº¿ç¨‹å®‰å…¨&lt;/strong&gt;
epollå®ä¾‹æœ¬èº«çº¿ç¨‹å®‰å…¨ï¼Œä½†åŒä¸€fdçš„å¹¶å‘æ“ä½œéœ€åŠ é”&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯-2"&gt;ğŸ’ é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘ç½‘ç»œæœåŠ¡&lt;/strong&gt;
å¦‚WebæœåŠ¡å™¨ï¼ˆNginxï¼‰ã€å³æ—¶é€šè®¯ï¼ˆQQï¼‰ã€æ¸¸æˆæœåŠ¡å™¨ï¼Œè¿æ¥æ•°&amp;gt;1ä¸‡&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ•°æ®å¤„ç†&lt;/strong&gt;
ä½å»¶è¿Ÿè¦æ±‚çš„åœºæ™¯ï¼ˆè‚¡ç¥¨äº¤æ˜“ã€å®æ—¶ç›‘æ§ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£select/poll&lt;/strong&gt;
è¿æ¥æ•°è¶…1024æˆ–éœ€æè‡´æ€§èƒ½æ—¶&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸selectpollçš„å¯¹æ¯”"&gt;ğŸ“Š ä¸select/pollçš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;select/poll&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;epoll&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¶é—´å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;O(n) è½®è¯¢æ‰€æœ‰fd&lt;/td&gt;
&lt;td&gt;O(1) æ£€æµ‹å°±ç»ªäº‹ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;FDæ•°é‡é™åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1024ï¼ˆselectï¼‰ / æ— ç¡¬é™åˆ¶ï¼ˆpollï¼‰&lt;/td&gt;
&lt;td&gt;10ä¸‡+ï¼ˆä¸å†…å­˜ç›¸å…³ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ‹·è´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è°ƒç”¨å…¨é‡å¤åˆ¶fdé›†åˆ&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡æ³¨å†Œåä»…åŒæ­¥å°±ç»ªäº‹ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è§¦å‘æ¨¡å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…LT&lt;/td&gt;
&lt;td&gt;æ”¯æŒLT/ET&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨è§„æ¨¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&amp;lt;1000è¿æ¥&lt;/td&gt;
&lt;td&gt;&amp;gt;10000è¿æ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;epollé€šè¿‡&lt;strong&gt;çº¢é»‘æ ‘ç®¡ç†è¿æ¥&lt;/strong&gt;+&lt;strong&gt;å°±ç»ªé“¾è¡¨è·å–äº‹ä»¶&lt;/strong&gt;+&lt;strong&gt;å›è°ƒæœºåˆ¶&lt;/strong&gt;ï¼Œå®ç°äº†ç™¾ä¸‡çº§è¿æ¥çš„é«˜æ•ˆå¤„ç†ï¼Œå°¤å…¶é€‚åˆ&lt;strong&gt;é«˜å¹¶å‘ä½æ´»è·ƒ&lt;/strong&gt;åœºæ™¯ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºé«˜æ•ˆ&lt;/strong&gt;ï¼šä»…å…³æ³¨æ´»è·ƒè¿æ¥ï¼Œå‡å°‘CPUç©ºè½¬ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§å¼º&lt;/strong&gt;ï¼šçªç ´FDæ•°é‡é™åˆ¶ï¼Œæ”¯æŒC10Mï¼ˆåƒä¸‡å¹¶å‘ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§é«˜&lt;/strong&gt;ï¼šETæ¨¡å¼æœ€å¤§åŒ–æå‡æ€§èƒ½ï¼ŒLTæ¨¡å¼é™ä½å¼€å‘é—¨æ§›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å®é™…å¼€å‘ä¸­ï¼ŒNginxã€Redisç­‰çŸ¥åé¡¹ç›®å‡é»˜è®¤é‡‡ç”¨epollçš„ETæ¨¡å¼&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚æŒæ¡å…¶åŸç†åŠETæ¨¡å¼ä¸‹çš„éé˜»å¡I/Oç¼–ç¨‹ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½æœåŠ¡çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="çº¢é»‘æ ‘èŠ‚ç‚¹"&gt;çº¢é»‘æ ‘èŠ‚ç‚¹
&lt;/h2&gt;&lt;p&gt;åœ¨epollæœºåˆ¶ä¸­ï¼Œ&lt;strong&gt;å›è°ƒäº‹ä»¶è§¦å‘ï¼ˆå¦‚æ•°æ®åˆ°è¾¾ï¼‰åï¼ŒèŠ‚ç‚¹ï¼ˆepitemï¼‰é€šå¸¸ä¸ä¼šä»çº¢é»‘æ ‘ä¸­è‡ªåŠ¨åˆ é™¤&lt;/strong&gt;ï¼Œé™¤éæ»¡è¶³ç‰¹å®šæ¡ä»¶ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ­£å¸¸æƒ…å†µèŠ‚ç‚¹ä¿ç•™åœ¨çº¢é»‘æ ‘ä¸­"&gt;ğŸ” æ­£å¸¸æƒ…å†µï¼šèŠ‚ç‚¹ä¿ç•™åœ¨çº¢é»‘æ ‘ä¸­
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶è§¦å‘åçš„é»˜è®¤è¡Œä¸º&lt;/strong&gt;
å½“æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ä¸Šçš„äº‹ä»¶ï¼ˆå¦‚&lt;code&gt;EPOLLIN&lt;/code&gt;ï¼‰å°±ç»ªæ—¶ï¼Œå†…æ ¸é€šè¿‡å›è°ƒå‡½æ•°&lt;code&gt;ep_poll_callback&lt;/code&gt;å°†è¯¥äº‹ä»¶å¯¹åº”çš„&lt;code&gt;epitem&lt;/code&gt;èŠ‚ç‚¹&lt;strong&gt;åŠ å…¥å°±ç»ªé˜Ÿåˆ—ï¼ˆrdllistï¼‰â€‹&lt;/strong&gt;ï¼Œä½†&lt;strong&gt;ä¸ä¼šå°†å…¶ä»çº¢é»‘æ ‘ä¸­ç§»é™¤&lt;/strong&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šçº¢é»‘æ ‘çš„ä½œç”¨æ˜¯é•¿æœŸè®°å½•éœ€è¦ç›‘æ§çš„fdåŠå…¶äº‹ä»¶ã€‚äº‹ä»¶è§¦å‘ä»…è¡¨ç¤ºå½“å‰æœ‰æ•°æ®å¯è¯»/å†™ï¼Œåç»­å¯èƒ½ä»æœ‰æ–°äº‹ä»¶å‘ç”Ÿï¼ˆå¦‚æŒç»­æ¥æ”¶æ•°æ®ï¼‰ï¼Œå› æ­¤éœ€ä¿ç•™èŠ‚ç‚¹ä»¥ç»§ç»­ç›‘å¬&lt;a class="link" href="@ref" &gt;1,2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·æ€å¤„ç†æµç¨‹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·è°ƒç”¨&lt;code&gt;epoll_wait&lt;/code&gt;è·å–å°±ç»ªäº‹ä»¶åï¼Œéœ€è‡ªè¡Œå¤„ç†æ•°æ®ï¼ˆå¦‚&lt;code&gt;read&lt;/code&gt;/&lt;code&gt;write&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¤„ç†å®Œæ¯•åï¼Œ&lt;strong&gt;çº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹ä¾ç„¶å­˜åœ¨&lt;/strong&gt;ï¼Œä¸‹æ¬¡è¯¥fdäº‹ä»¶å°±ç»ªæ—¶ä¼šå†æ¬¡è§¦å‘å›è°ƒå¹¶åŠ å…¥å°±ç»ªé˜Ÿåˆ—&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç‰¹æ®Šæƒ…å†µèŠ‚ç‚¹è¢«åˆ é™¤çš„åœºæ™¯"&gt;âš ï¸ ç‰¹æ®Šæƒ…å†µï¼šèŠ‚ç‚¹è¢«åˆ é™¤çš„åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è®¾ç½®&lt;code&gt;EPOLLONESHOT&lt;/code&gt;é€‰é¡¹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æ³¨å†Œäº‹ä»¶æ—¶æŒ‡å®š&lt;code&gt;EPOLLONESHOT&lt;/code&gt;ï¼Œåˆ™äº‹ä»¶è§¦å‘å&lt;strong&gt;å†…æ ¸ä¼šè‡ªåŠ¨å°†è¯¥fdä»çº¢é»‘æ ‘ä¸­ç§»é™¤&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šç¡®ä¿äº‹ä»¶ä»…è¢«å¤„ç†ä¸€æ¬¡ï¼Œé¿å…å¤šçº¿ç¨‹åœºæ™¯ä¸‹åŒä¸€äº‹ä»¶è¢«é‡å¤è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åç»­æ“ä½œ&lt;/strong&gt;ï¼šç”¨æˆ·éœ€æ˜¾å¼è°ƒç”¨&lt;code&gt;epoll_ctl(EPOLL_CTL_MOD)&lt;/code&gt;é‡æ–°æ·»åŠ fdï¼Œæ‰èƒ½ç»§ç»­ç›‘å¬&lt;a class="link" href="@ref" &gt;1,4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;é€‚ç”¨åœºæ™¯&lt;/em&gt;ï¼šé«˜å¹¶å‘ä¸‹éœ€ç²¾ç¡®æ§åˆ¶äº‹ä»¶è§¦å‘çš„æ¬¡æ•°ï¼ˆå¦‚å®šæ—¶ä»»åŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·ä¸»åŠ¨åˆ é™¤&lt;/strong&gt;
è°ƒç”¨&lt;code&gt;epoll_ctl(EPOLL_CTL_DEL, fd)&lt;/code&gt;æ‰‹åŠ¨å°†fdä»çº¢é»‘æ ‘ä¸­åˆ é™¤&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;å¸¸è§åœºæ™¯&lt;/em&gt;ï¼šè¿æ¥å…³é—­ï¼ˆ&lt;code&gt;close(fd)&lt;/code&gt;ï¼‰æˆ–ä¸šåŠ¡é€»è¾‘ä¸å†éœ€è¦ç›‘å¬è¯¥fdæ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®ç»“æ„ä¸å†…æ ¸è¡Œä¸º"&gt;ğŸ”§ æ•°æ®ç»“æ„ä¸å†…æ ¸è¡Œä¸º
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çº¢é»‘æ ‘ä¸å°±ç»ªé˜Ÿåˆ—çš„å…³ç³»&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¢é»‘æ ‘ï¼ˆrbrï¼‰&lt;/strong&gt;ï¼šå­˜å‚¨æ‰€æœ‰æ³¨å†Œçš„&lt;code&gt;epitem&lt;/code&gt;èŠ‚ç‚¹ï¼Œé”®å€¼ç”±fdå’Œè®¾å¤‡æ ‡è¯†ç»„æˆï¼Œç¡®ä¿å”¯ä¸€æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°±ç»ªé˜Ÿåˆ—ï¼ˆrdllistï¼‰&lt;/strong&gt;ï¼šä¸´æ—¶å­˜æ”¾å·²è§¦å‘äº‹ä»¶çš„&lt;code&gt;epitem&lt;/code&gt;èŠ‚ç‚¹ï¼ˆé€šè¿‡å›è°ƒå‡½æ•°åŠ¨æ€æ’å…¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹åŒæ—¶å­˜åœ¨äºçº¢é»‘æ ‘å’Œå°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œä½†&lt;strong&gt;åˆ é™¤æ“ä½œä»…ç”±ç”¨æˆ·æˆ–&lt;code&gt;EPOLLONESHOT&lt;/code&gt;è§¦å‘&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›è°ƒå‡½æ•°çš„è§’è‰²&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å½“æ•°æ®åˆ°è¾¾æ—¶ï¼Œç½‘å¡ä¸­æ–­è§¦å‘å†…æ ¸å°†æ•°æ®å†™å…¥socketç¼“å†²åŒºã€‚&lt;/li&gt;
&lt;li&gt;å†…æ ¸è°ƒç”¨&lt;code&gt;ep_poll_callback&lt;/code&gt;ï¼Œå°†å¯¹åº”&lt;code&gt;epitem&lt;/code&gt;èŠ‚ç‚¹åŠ å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œ&lt;strong&gt;ä¸æ¶‰åŠçº¢é»‘æ ‘ä¿®æ”¹&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä½•æ—¶èŠ‚ç‚¹ä¼šè¢«åˆ é™¤"&gt;ğŸ’ æ€»ç»“ï¼šä½•æ—¶èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ï¼Ÿ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;èŠ‚ç‚¹æ˜¯å¦åˆ é™¤&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§¦å‘æ–¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åç»­æ“ä½œ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤æƒ…å†µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ å¦&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹ä¿ç•™ï¼ŒæŒç»­ç›‘å¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾ç½®&lt;code&gt;EPOLLONESHOT&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;å†…æ ¸è‡ªåŠ¨åˆ é™¤&lt;/td&gt;
&lt;td&gt;éœ€æ˜¾å¼è°ƒç”¨&lt;code&gt;EPOLL_CTL_MOD&lt;/code&gt;é‡æ–°æ·»åŠ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”¨æˆ·è°ƒç”¨&lt;code&gt;DEL&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ä¸»åŠ¨åˆ é™¤&lt;/td&gt;
&lt;td&gt;ä¸å†ç›‘å¬è¯¥fd&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš™ï¸ &lt;strong&gt;è®¾è®¡æ„å›¾&lt;/strong&gt;ï¼šepollé€šè¿‡ä¿ç•™çº¢é»‘æ ‘èŠ‚ç‚¹é¿å…é‡å¤æ³¨å†Œçš„å¼€é”€ï¼Œä»…å½“æ˜ç¡®è¦æ±‚ï¼ˆå¦‚&lt;code&gt;EPOLLONESHOT&lt;/code&gt;ï¼‰æˆ–è¿æ¥å…³é—­æ—¶æ‰åˆ é™¤èŠ‚ç‚¹ï¼Œä»¥æœ€å¤§åŒ–æ€§èƒ½&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚
ğŸ”§ â€‹&lt;strong&gt;å®è·µå»ºè®®&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºé•¿è¿æ¥é€šä¿¡ï¼ˆå¦‚WebæœåŠ¡å™¨ï¼‰ï¼Œæ— éœ€è®¾ç½®&lt;code&gt;EPOLLONESHOT&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹äºå•æ¬¡ä»»åŠ¡ï¼ˆå¦‚å®šæ—¶è§¦å‘ï¼‰ï¼Œä½¿ç”¨&lt;code&gt;EPOLLONESHOT&lt;/code&gt;é¿å…äº‹ä»¶é‡å¤å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;</description></item></channel></rss>