<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>K8s on é£é¸¿è¸é›ªæ³¥</title><link>https://dyhes.github.io/tags/k8s/</link><description>Recent content in K8s on é£é¸¿è¸é›ªæ³¥</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 22 Oct 2025 16:27:30 +0800</lastBuildDate><atom:link href="https://dyhes.github.io/tags/k8s/index.xml" rel="self" type="application/rss+xml"/><item><title>ã€k8sã€‘Concepts</title><link>https://dyhes.github.io/p/k8sconcepts/</link><pubDate>Mon, 30 Jun 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/k8sconcepts/</guid><description>&lt;h2 id="k8s-æ ¸å¿ƒç»„ä»¶"&gt;K8s æ ¸å¿ƒç»„ä»¶
&lt;/h2&gt;&lt;p&gt;Kubernetesï¼ˆK8sï¼‰çš„ç»„ä»¶ååŒå·¥ä½œï¼Œå®ç°å®¹å™¨åŒ–åº”ç”¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚å…¶æ¶æ„åˆ†ä¸º&lt;strong&gt;æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰&lt;/strong&gt; å’Œ&lt;strong&gt;å·¥ä½œèŠ‚ç‚¹ï¼ˆWorker Nodeï¼‰&lt;/strong&gt; ä¸¤éƒ¨åˆ†ï¼Œä»¥ä¸‹æ˜¯æ ¸å¿ƒç»„ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ§åˆ¶å¹³é¢ç»„ä»¶masterèŠ‚ç‚¹"&gt;&lt;strong&gt;æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆMasterèŠ‚ç‚¹ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ§åˆ¶å¹³é¢è´Ÿè´£é›†ç¾¤çš„å…¨å±€å†³ç­–å’ŒçŠ¶æ€ç®¡ç†ï¼Œé€šå¸¸éƒ¨ç½²åœ¨ç‹¬ç«‹çš„MasterèŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;API Serverï¼ˆkube-apiserverï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šé›†ç¾¤æ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæä¾›RESTful APIï¼Œå¤„ç†ç”¨æˆ·å‘½ä»¤ï¼ˆå¦‚&lt;code&gt;kubectl&lt;/code&gt;ï¼‰åŠå†…éƒ¨ç»„ä»¶é€šä¿¡&lt;a class="link" href="@ref" &gt;1,3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;è®¤è¯æˆæƒï¼ˆRBACï¼‰ã€APIæ³¨å†Œä¸å‘ç°ã€‚&lt;/li&gt;
&lt;li&gt;æ ¡éªŒèµ„æºå®šä¹‰å¹¶å†™å…¥&lt;code&gt;etcd&lt;/code&gt;å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;å……å½“å…¶ä»–ç»„ä»¶ï¼ˆå¦‚Schedulerã€Controller Managerï¼‰çš„é€šä¿¡æ¢çº½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;etcd&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼é”®å€¼æ•°æ®åº“ï¼Œå­˜å‚¨é›†ç¾¤æ‰€æœ‰çŠ¶æ€æ•°æ®ï¼ˆå¦‚Podã€Serviceé…ç½®ï¼‰&lt;a class="link" href="@ref" &gt;1,3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®ç‰¹æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;é«˜å¯ç”¨è®¾è®¡ï¼Œæ”¯æŒå¤šå‰¯æœ¬åŒæ­¥ã€‚&lt;/li&gt;
&lt;li&gt;ä»…é€šè¿‡API Serverä¿®æ”¹æ•°æ®ï¼Œç¡®ä¿ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Controller Managerï¼ˆkube-controller-managerï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šè¿è¡Œæ§åˆ¶å™¨å¾ªç¯ï¼Œç›‘æ§é›†ç¾¤çŠ¶æ€å¹¶é©±åŠ¨å…¶å‘ç›®æ ‡çŠ¶æ€æ”¶æ•›&lt;a class="link" href="@ref" &gt;1,4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»è¦æ§åˆ¶å™¨ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Node Controller&lt;/strong&gt;ï¼šæ£€æµ‹èŠ‚ç‚¹æ•…éšœå¹¶å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Deployment Controller&lt;/strong&gt;ï¼šç®¡ç†æ— çŠ¶æ€åº”ç”¨çš„æ»šåŠ¨æ›´æ–°ä¸å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service Controller&lt;/strong&gt;ï¼šç»´æŠ¤è´Ÿè½½å‡è¡¡è§„åˆ™å’ŒServiceé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ReplicaSet Controller&lt;/strong&gt;ï¼šç¡®ä¿Podå‰¯æœ¬æ•°ç¬¦åˆé¢„æœŸ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Schedulerï¼ˆkube-schedulerï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šä¸ºæ–°åˆ›å»ºçš„Podé€‰æ‹©åˆé€‚çš„å·¥ä½œèŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;1,3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒåº¦ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢„é€‰ï¼ˆPredicatesï¼‰&lt;/strong&gt;ï¼šè¿‡æ»¤æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼ˆå¦‚èµ„æºä½™é‡ã€ç«¯å£å†²çªï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜é€‰ï¼ˆPrioritiesï¼‰&lt;/strong&gt;ï¼šå¯¹èŠ‚ç‚¹æ‰“åˆ†ï¼ˆå¦‚è´Ÿè½½å‡è¡¡ã€æ•°æ®å±€éƒ¨æ€§ï¼‰ï¼Œé€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å·¥ä½œèŠ‚ç‚¹ç»„ä»¶nodeèŠ‚ç‚¹"&gt;&lt;strong&gt;å·¥ä½œèŠ‚ç‚¹ç»„ä»¶ï¼ˆNodeèŠ‚ç‚¹ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å·¥ä½œèŠ‚ç‚¹è´Ÿè´£è¿è¡Œå®¹å™¨åŒ–åº”ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éœ€éƒ¨ç½²ä»¥ä¸‹ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Kubelet&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šèŠ‚ç‚¹ä¸Šçš„â€œä»£ç†â€ï¼Œç®¡ç†Podç”Ÿå‘½å‘¨æœŸ&lt;a class="link" href="@ref" &gt;1,4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®åŠŸèƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;æ¥æ”¶æ¥è‡ªAPI Serverçš„Podé…ç½®ï¼Œè°ƒç”¨å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚Dockerï¼‰å¯åœå®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§å®¹å™¨çŠ¶æ€å¹¶ä¸ŠæŠ¥è‡³API Serverã€‚&lt;/li&gt;
&lt;li&gt;æŒ‚è½½å­˜å‚¨å·ã€æ‰§è¡Œå¥åº·æ£€æŸ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kube-proxy&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šç»´æŠ¤èŠ‚ç‚¹ç½‘ç»œè§„åˆ™ï¼Œå®ç°Serviceçš„è´Ÿè½½å‡è¡¡ä¸æœåŠ¡å‘ç°&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å·¥ä½œæ¨¡å¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;iptables/IPVS&lt;/strong&gt;ï¼šå°†è®¿é—®Service IPï¼ˆClusterIPï¼‰çš„è¯·æ±‚è½¬å‘è‡³åç«¯Podï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Userspace&lt;/strong&gt;ï¼ˆæ—§ç‰ˆï¼‰ï¼šé€šè¿‡ä»£ç†ç«¯å£è½¬å‘æµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Container Runtimeï¼ˆå®¹å™¨è¿è¡Œæ—¶ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼šæ‰§è¡Œå®¹å™¨çš„è¿è¡Œæ“ä½œï¼ˆå¦‚æ‹‰å–é•œåƒã€å¯åœå®¹å™¨ï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§å®ç°&lt;/strong&gt;ï¼šDockerã€containerdã€CRI-Oï¼ˆå‡éœ€æ”¯æŒCRIæ¥å£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®é™„åŠ ç»„ä»¶add-ons"&gt;&lt;strong&gt;å…³é”®é™„åŠ ç»„ä»¶ï¼ˆAdd-onsï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è¿™äº›ç»„ä»¶æ‰©å±•Kubernetesçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€šå¸¸ä»¥Podå½¢å¼éƒ¨ç½²ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CNIç½‘ç»œæ’ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°Podé—´ç½‘ç»œé€šä¿¡ä¸ç­–ç•¥æ§åˆ¶&lt;/td&gt;
&lt;td&gt;Flannel, Calico, Weave Net&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CoreDNS&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›é›†ç¾¤å†…DNSè§£æï¼Œæ”¯æŒServiceåŸŸåå‘ç°&lt;/td&gt;
&lt;td&gt;æ›¿ä»£kube-dns&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress Controller&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æš´éœ²HTTP/HTTPSæœåŠ¡åˆ°é›†ç¾¤å¤–ï¼Œæ”¯æŒè·¯ç”±è§„åˆ™&lt;/td&gt;
&lt;td&gt;Nginx Ingress, Traefik&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Dashboard&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›é›†ç¾¤ç®¡ç†çš„å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰&lt;/td&gt;
&lt;td&gt;Kuberneteså®˜æ–¹Dashboard&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Metrics Server&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¶é›†èµ„æºä½¿ç”¨æŒ‡æ ‡ï¼ˆå¦‚CPU/Memoryï¼‰ï¼Œæ”¯æŒHPAè‡ªåŠ¨æ‰©ç¼©å®¹&lt;/td&gt;
&lt;td&gt;æ›¿ä»£Heapster&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç»„ä»¶åä½œç¤ºä¾‹podåˆ›å»ºæµç¨‹"&gt;&lt;strong&gt;ç»„ä»¶åä½œç¤ºä¾‹ï¼šPodåˆ›å»ºæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡&lt;code&gt;kubectl&lt;/code&gt;å‘API Serveræäº¤Podåˆ›å»ºè¯·æ±‚&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;API Serveræ ¡éªŒè¯·æ±‚å¹¶å†™å…¥etcdã€‚&lt;/li&gt;
&lt;li&gt;Schedulerç›‘æµ‹åˆ°æœªè°ƒåº¦çš„Podï¼Œé€‰æ‹©èŠ‚ç‚¹å¹¶ç»‘å®šPodè‡³è¯¥èŠ‚ç‚¹ï¼ˆæ›´æ–°etcdï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç›®æ ‡èŠ‚ç‚¹çš„Kubeletç›‘å¬åˆ°ç»‘å®šäº‹ä»¶ï¼Œè°ƒç”¨å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;Kube-proxyæ ¹æ®Serviceé…ç½®æ›´æ–°æœ¬åœ°iptables/IPVSè§„åˆ™&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•æ¦‚å¿µ"&gt;&lt;strong&gt;æ‰©å±•æ¦‚å¿µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CRIï¼ˆå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼‰&lt;/strong&gt;ï¼šæ ‡å‡†åŒ–å®¹å™¨æ“ä½œï¼Œæ”¯æŒå¤šè¿è¡Œæ—¶ï¼ˆå¦‚Dockerã€containerdï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CNIï¼ˆå®¹å™¨ç½‘ç»œæ¥å£ï¼‰&lt;/strong&gt;ï¼šè§£è€¦ç½‘ç»œæ’ä»¶ï¼Œå®ç°çµæ´»ç»„ç½‘&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–å­˜å‚¨&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;PersistentVolume&lt;/code&gt;ï¼ˆPVï¼‰å’Œ&lt;code&gt;PersistentVolumeClaim&lt;/code&gt;ï¼ˆPVCï¼‰ç®¡ç†å­˜å‚¨å·ç”Ÿå‘½å‘¨æœŸ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚
é€šè¿‡ä¸Šè¿°ç»„ä»¶çš„ååŒï¼ŒKuberneteså®ç°äº†å£°æ˜å¼é…ç½®ã€æ•…éšœè‡ªæ„ˆã€å¼¹æ€§ä¼¸ç¼©ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œæˆä¸ºå®¹å™¨ç¼–æ’çš„äº‹å®æ ‡å‡†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="scheduler"&gt;Scheduler
&lt;/h2&gt;&lt;p&gt;Kubernetes Scheduler é€‰æ‹©èŠ‚ç‚¹çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ª&lt;strong&gt;åˆ†å±‚å†³ç­–æœºåˆ¶&lt;/strong&gt;ï¼Œåˆ†ä¸º&lt;strong&gt;è¿‡æ»¤ï¼ˆPredicatesï¼‰&lt;/strong&gt; å’Œ&lt;strong&gt;æ‰“åˆ†ï¼ˆPrioritiesï¼‰&lt;/strong&gt; ä¸¤ä¸ªæ ¸å¿ƒé˜¶æ®µï¼Œæœ€ç»ˆå°† Pod ç»‘å®šåˆ°æœ€ä¼˜èŠ‚ç‚¹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æµç¨‹åŠç­–ç•¥è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è¿‡æ»¤é˜¶æ®µpredicatesç­›é€‰å€™é€‰èŠ‚ç‚¹"&gt;ğŸ” &lt;strong&gt;è¿‡æ»¤é˜¶æ®µï¼ˆPredicatesï¼‰â€”â€”ç­›é€‰å€™é€‰èŠ‚ç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è¿‡æ»¤ç­–ç•¥é‡‡ç”¨&lt;strong&gt;ä¸€ç¥¨å¦å†³åˆ¶&lt;/strong&gt;ï¼ŒèŠ‚ç‚¹éœ€æ»¡è¶³æ‰€æœ‰æ¡ä»¶æ‰èƒ½è¿›å…¥æ‰“åˆ†é˜¶æ®µã€‚æ ¸å¿ƒç­–ç•¥åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºåŒ¹é…æ£€æŸ¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;PodFitsResources&lt;/code&gt;&lt;/strong&gt;ï¼šéªŒè¯èŠ‚ç‚¹å‰©ä½™èµ„æºï¼ˆCPUã€å†…å­˜ã€å­˜å‚¨ï¼‰æ˜¯å¦æ»¡è¶³ Pod è¯·æ±‚çš„éœ€æ±‚é‡ï¼Œä¸è¶³åˆ™æ·˜æ±°èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;1,2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CheckNodeResourcesPressure&lt;/code&gt;&lt;/strong&gt;ï¼šæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨èµ„æºå‹åŠ›ï¼ˆå¦‚å†…å­˜ã€ç£ç›˜ã€PID è€—å°½ï¼‰ï¼Œè‹¥å­˜åœ¨åˆ™æ’é™¤èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç«¯å£ä¸ä¸»æœºçº¦æŸ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;PodFitsHostPorts&lt;/code&gt;&lt;/strong&gt;ï¼šæ£€æŸ¥èŠ‚ç‚¹ä¸Š Pod ç”³è¯·çš„ç«¯å£æ˜¯å¦å·²è¢«å ç”¨&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;PodFitsHost&lt;/code&gt;&lt;/strong&gt;ï¼šè‹¥ Pod æŒ‡å®šäº† &lt;code&gt;nodeName&lt;/code&gt;ï¼Œåˆ™ä»…å…è®¸åç§°å®Œå…¨åŒ¹é…çš„èŠ‚ç‚¹é€šè¿‡&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾ä¸é€‰æ‹©å™¨åŒ¹é…&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MatchNodeSelector&lt;/code&gt;&lt;/strong&gt;ï¼šéªŒè¯èŠ‚ç‚¹æ ‡ç­¾æ˜¯å¦åŒ¹é… Pod çš„ &lt;code&gt;nodeSelector&lt;/code&gt; æˆ–äº²å’Œæ€§è§„åˆ™ï¼ˆå¦‚ &lt;code&gt;nodeAffinity&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;PodToleratesNodeTaints&lt;/code&gt;&lt;/strong&gt;ï¼šæ£€æŸ¥ Pod çš„å®¹å¿åº¦ï¼ˆTolerationsï¼‰æ˜¯å¦è¦†ç›–èŠ‚ç‚¹çš„æ±¡ç‚¹ï¼ˆTaintsï¼‰ï¼Œå¦åˆ™èŠ‚ç‚¹è¢«è¿‡æ»¤&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨ä¸æ‹“æ‰‘å†²çª&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;NoVolumeZoneConflict&lt;/code&gt;&lt;/strong&gt;ï¼šç¡®ä¿ Pod æŒ‚è½½çš„å­˜å‚¨å·ä¸èŠ‚ç‚¹æ‰€å±çš„å¯ç”¨åŒºå…¼å®¹&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MatchInterPodAffinity&lt;/code&gt;&lt;/strong&gt;ï¼šéªŒè¯ Pod æ˜¯å¦ç¬¦åˆä¸å…¶ä»– Pod çš„äº²å’Œæ€§ï¼ˆå¦‚å¿…é¡»åŒèŠ‚ç‚¹ï¼‰æˆ–åäº²å’Œæ€§ï¼ˆå¦‚ç¦æ­¢åŒèŠ‚ç‚¹ï¼‰è§„åˆ™&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹å¥åº·çŠ¶æ€&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CheckNodeCondition&lt;/code&gt;&lt;/strong&gt;ï¼šæ’é™¤ä¸å¥åº·èŠ‚ç‚¹ï¼ˆå¦‚ç½‘ç»œæ–­å¼€ã€ç£ç›˜æ•…éšœï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šè‹¥è¿‡æ»¤åæ— èŠ‚ç‚¹å¯ç”¨ï¼ŒPod å°†å¤„äº &lt;code&gt;Pending&lt;/code&gt; çŠ¶æ€ï¼ŒæŒç»­é‡è¯•ç›´åˆ°æ¡ä»¶æ»¡è¶³&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰“åˆ†é˜¶æ®µprioritiesè¯„ä¼°èŠ‚ç‚¹ä¼˜å…ˆçº§"&gt;ğŸ“Š &lt;strong&gt;æ‰“åˆ†é˜¶æ®µï¼ˆPrioritiesï¼‰â€”â€”è¯„ä¼°èŠ‚ç‚¹ä¼˜å…ˆçº§&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¯¹å€™é€‰èŠ‚ç‚¹æŒ‰æƒé‡æ‰“åˆ†ï¼ˆ0-100åˆ†ï¼‰ï¼Œ&lt;strong&gt;åˆ†æ•°æœ€é«˜è€…èƒœå‡º&lt;/strong&gt;ã€‚å¸¸ç”¨ç­–ç•¥åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æƒé‡é€»è¾‘&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç›®æ ‡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºä¼˜åŒ–ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;LeastRequestedPriority&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹èµ„æºä½¿ç”¨ç‡è¶Šä½ â†’ åˆ†æ•°è¶Šé«˜ ï¼ˆå…¬å¼ï¼š&lt;code&gt;(ç©ºé—² CPU æ¯”ç‡ + ç©ºé—²å†…å­˜æ¯”ç‡) / 2 Ã— 10&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ï¼Œé¿å…èŠ‚ç‚¹è¿‡è½½&lt;/td&gt;
&lt;td&gt;é€šç”¨èµ„æºè°ƒåº¦&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BalancedResourceAllocation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;CPU ä¸å†…å­˜ä½¿ç”¨ç‡è¶Šæ¥è¿‘ â†’ åˆ†æ•°è¶Šé«˜ ï¼ˆé¿å…å•ä¸€èµ„æºç“¶é¢ˆï¼‰&lt;/td&gt;
&lt;td&gt;èµ„æºåˆ©ç”¨ç‡å‡è¡¡&lt;/td&gt;
&lt;td&gt;éœ€ä¸ &lt;code&gt;LeastRequestedPriority&lt;/code&gt;ç»„åˆä½¿ç”¨&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½ç½®æ•æ„Ÿç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;SpreadConstraintsPriority&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆ†æ•£ç›¸åŒæœåŠ¡çš„ Pod åˆ°ä¸åŒèŠ‚ç‚¹/å¯ç”¨åŒº â†’ åˆ†æ•°è¶Šé«˜&lt;/td&gt;
&lt;td&gt;æå‡å®¹é”™æ€§ï¼Œå‡å°‘å•ç‚¹æ•…éšœ&lt;/td&gt;
&lt;td&gt;é«˜å¯ç”¨æœåŠ¡ï¼ˆå¦‚ StatefulSetï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ImageLocalityPriority&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹å·²å­˜åœ¨ Pod æ‰€éœ€é•œåƒ â†’ é•œåƒä½“ç§¯è¶Šå¤§åˆ†æ•°è¶Šé«˜&lt;/td&gt;
&lt;td&gt;å‡å°‘é•œåƒæ‹‰å–å»¶è¿Ÿ&lt;/td&gt;
&lt;td&gt;å¤§å‹é•œåƒæˆ–ä½å¸¦å®½ç¯å¢ƒ&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº²å’Œæ€§ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;NodeAffinityPriority&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹æ ‡ç­¾åŒ¹é… Pod çš„ &lt;code&gt;nodeAffinity&lt;/code&gt; è§„åˆ™ â†’ åŒ¹é…åº¦è¶Šé«˜åˆ†æ•°è¶Šé«˜&lt;/td&gt;
&lt;td&gt;æ»¡è¶³èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚&lt;/td&gt;
&lt;td&gt;å®šå‘è°ƒåº¦ï¼ˆå¦‚ GPU èŠ‚ç‚¹ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;InterPodAffinityPriority&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹ä¸Šå·²æœ‰ Pod çš„æ ‡ç­¾ç¬¦åˆäº²å’Œæ€§è§„åˆ™ â†’ ç¬¦åˆåº¦è¶Šé«˜åˆ†æ•°è¶Šé«˜&lt;/td&gt;
&lt;td&gt;å®ç° Pod é—´äº²å¯†æ€§&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡é›†ç¾¤ï¼ˆå¦‚æ•°æ®åº“ä¸ç¼“å­˜åŒèŠ‚ç‚¹ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ±¡ç‚¹å®¹å¿ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;TaintTolerationPriority&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Pod å®¹å¿çš„æ±¡ç‚¹ä¸èŠ‚ç‚¹æ±¡ç‚¹åŒ¹é… â†’ åŒ¹é…æ¡æ•°è¶Šå¤šåˆ†æ•°è¶Šä½&lt;/td&gt;
&lt;td&gt;ä¼˜å…ˆé€‰æ‹©æ±¡ç‚¹å°‘çš„èŠ‚ç‚¹&lt;/td&gt;
&lt;td&gt;è°ƒåº¦åˆ°å—é™èŠ‚ç‚¹ï¼ˆå¦‚è¿ç»´èŠ‚ç‚¹ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æƒé‡å åŠ &lt;/strong&gt;ï¼šæœ€ç»ˆåˆ†æ•° = å„ç­–ç•¥åˆ†æ•° Ã— æƒé‡ç³»æ•°çš„ç´¯åŠ å’Œã€‚æƒé‡å€¼ç”±é›†ç¾¤é…ç½®å®šä¹‰ï¼ˆé»˜è®¤å€¼å¯è°ƒæ•´ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§è°ƒåº¦ç­–ç•¥ç²¾ç»†åŒ–æ§åˆ¶"&gt;âš™ï¸ &lt;strong&gt;é«˜çº§è°ƒåº¦ç­–ç•¥â€”â€”ç²¾ç»†åŒ–æ§åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é™¤é»˜è®¤ç­–ç•¥å¤–ï¼Œç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®šåˆ¶è°ƒåº¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº²å’Œæ€§ï¼ˆAffinityï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹äº²å’Œæ€§ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬çº¦æŸï¼ˆ&lt;code&gt;requiredDuringScheduling&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šå¿…é¡»æ»¡è¶³æ ‡ç­¾åŒ¹é…ï¼ˆå¦‚ &lt;code&gt;zone=foo&lt;/code&gt;ï¼‰ï¼Œå¦åˆ™ Pod é˜»å¡&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½¯çº¦æŸï¼ˆ&lt;code&gt;preferredDuringScheduling&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šä¼˜å…ˆåŒ¹é…æ ‡ç­¾ï¼ˆå¦‚ &lt;code&gt;disk=ssd&lt;/code&gt;ï¼‰ï¼Œä½†å…è®¸è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pod é—´äº²å’Œæ€§ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;podAffinity&lt;/code&gt;&lt;/strong&gt;ï¼šå¼ºåˆ¶æˆ–å€¾å‘ä¸æŒ‡å®š Pod åŒèŠ‚ç‚¹ï¼ˆå¦‚ Web æœåŠ¡ä¸ Redis åŒèŠ‚ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;podAntiAffinity&lt;/code&gt;&lt;/strong&gt;ï¼šé¿å…ä¸æŒ‡å®š Pod åŒèŠ‚ç‚¹ï¼ˆå¦‚é¿å…åŒä¸€æœåŠ¡çš„å¤šä¸ªå‰¯æœ¬é›†ä¸­éƒ¨ç½²ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ±¡ç‚¹ä¸å®¹å¿ï¼ˆTaints &amp;amp; Tolerationsï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ±¡ç‚¹æ•ˆæœï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NoSchedule&lt;/code&gt;ï¼šç¦æ­¢æ–° Pod è°ƒåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NoExecute&lt;/code&gt;ï¼šé©±é€å·²æœ‰ Podï¼ˆè‹¥ä¸å®¹å¿ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PreferNoSchedule&lt;/code&gt;ï¼šå°½é‡é¿å…è°ƒåº¦&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®¹å¿é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;tolerations:
- key: &amp;#34;gpu&amp;#34;
operator: &amp;#34;Equal&amp;#34;
value: &amp;#34;nvidia&amp;#34;
effect: &amp;#34;NoSchedule&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰è°ƒåº¦å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;spec.schedulerName&lt;/code&gt; æŒ‡å®šè‡ªå®šä¹‰è°ƒåº¦å™¨ï¼ˆå¦‚ &lt;code&gt;my-scheduler&lt;/code&gt;ï¼‰ï¼Œè¦†ç›–é»˜è®¤é€»è¾‘&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§å®è·µå»ºè®®"&gt;ğŸ› ï¸ &lt;strong&gt;ç”Ÿäº§å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦çº¦æŸ&lt;/strong&gt;ï¼šç¡¬äº²å’Œæ€§æ˜“å¯¼è‡´è°ƒåº¦é˜»å¡ï¼Œä¼˜å…ˆä½¿ç”¨è½¯çº¦æŸ+åäº²å’Œæ€§å®ç°é«˜å¯ç”¨&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé‡åˆ†é…æŠ€å·§&lt;/strong&gt;ï¼šå…³é”®ç­–ç•¥ï¼ˆå¦‚è·¨å¯ç”¨åŒºåˆ†æ•£ï¼‰åˆ†é…é«˜æƒé‡ï¼ˆå¦‚ &lt;code&gt;weight: 100&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ±¡ç‚¹ç®¡ç†&lt;/strong&gt;ï¼šä¸ºä¸“ç”¨èŠ‚ç‚¹ï¼ˆå¦‚ GPU èŠ‚ç‚¹ï¼‰æ·»åŠ æ±¡ç‚¹ï¼Œå¹¶é€šè¿‡å®¹å¿åº¦é™åˆ¶è®¿é—®&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§è°ƒåº¦å¤±è´¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl describe pod &amp;lt;name&amp;gt; # æŸ¥çœ‹ Events å­—æ®µä¸­çš„ FailedScheduling åŸå› 
kubectl get events --field-selector reason=FailedScheduling
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Scheduler çš„èŠ‚ç‚¹é€‰æ‹©æ˜¯&lt;strong&gt;åˆ†å±‚è¿‡æ»¤ â†’ åŠ æƒæ‰“åˆ† â†’ æœ€ä¼˜ç»‘å®š&lt;/strong&gt;çš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ»¤å±‚&lt;/strong&gt;ï¼šå‰”é™¤èµ„æºä¸è¶³ã€ç«¯å£å†²çªã€æ±¡ç‚¹ä¸å®¹å¿çš„èŠ‚ç‚¹ï¼ˆ&lt;strong&gt;åˆšæ€§æ’é™¤&lt;/strong&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰“åˆ†å±‚&lt;/strong&gt;ï¼šæŒ‰èµ„æºå‡è¡¡ã€æ‹“æ‰‘åˆ†å¸ƒã€äº²å’Œæ€§ç­‰ç­–ç•¥æ’åºï¼ˆ&lt;strong&gt;æŸ”æ€§ä¼˜åŒ–&lt;/strong&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†³ç­–å±‚&lt;/strong&gt;ï¼šç»‘å®šæœ€é«˜åˆ†èŠ‚ç‚¹ï¼Œç”± kubelet æ¥ç®¡åç»­å®¹å™¨å¯åœ&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ç»„åˆå†…ç½®ç­–ç•¥ä¸é«˜çº§è§„åˆ™ï¼ˆäº²å’Œæ€§/æ±¡ç‚¹ï¼‰ï¼Œç”¨æˆ·å¯ç²¾å‡†æ§åˆ¶ Pod åˆ†å¸ƒï¼Œå®ç°&lt;strong&gt;èµ„æºé«˜æ•ˆã€æœåŠ¡ç¨³å®šã€æ•…éšœéš”ç¦»&lt;/strong&gt;çš„ç”Ÿäº§çº§è°ƒåº¦&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="etcd"&gt;Etcd
&lt;/h2&gt;&lt;p&gt;etcd æ˜¯ä¸€ä¸ª&lt;strong&gt;é«˜å¯ç”¨ã€å¼ºä¸€è‡´æ€§çš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿ&lt;/strong&gt;ï¼Œç”± CoreOS å›¢é˜Ÿå¼€å‘ï¼Œç°ä¸º CNCF æ ¸å¿ƒé¡¹ç›®ã€‚å®ƒåŸºäº Raft å…±è¯†ç®—æ³•å®ç°æ•°æ®ä¸€è‡´æ€§ï¼Œä¸“ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°å’Œåè°ƒä»»åŠ¡è®¾è®¡ï¼Œå°¤å…¶ä½œä¸º Kubernetes çš„é»˜è®¤æ•°æ®å­˜å‚¨ç»„ä»¶ï¼Œæ‰¿æ‹…é›†ç¾¤çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒè§’è‰²ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§ã€æ¶æ„åŸç†ã€åº”ç”¨åœºæ™¯åˆ°ç”Ÿäº§å®è·µå±•å¼€è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå®šä½ä¸ç‰¹æ€§"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒå®šä½ä¸ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è®¾è®¡ç›®æ ‡"&gt;&lt;strong&gt;è®¾è®¡ç›®æ ‡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ï¼šåŸºäº Raft ç®—æ³•ç¡®ä¿é›†ç¾¤å†…æ•°æ®ä¸€è‡´ï¼Œå³ä½¿éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœä¹Ÿèƒ½è‡ªåŠ¨é€‰ä¸¾æ–° Leaderï¼Œä¿è¯æœåŠ¡è¿ç»­æ€§&lt;a class="link" href="@ref" &gt;1,6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨æ€§&lt;/strong&gt;ï¼šé€šè¿‡å¤šèŠ‚ç‚¹é›†ç¾¤ï¼ˆæ¨è 3/5/7 å¥‡æ•°èŠ‚ç‚¹ï¼‰å®ç°å®¹é”™ï¼Œä¾‹å¦‚ 3 èŠ‚ç‚¹é›†ç¾¤å¯å®¹å¿ 1 èŠ‚ç‚¹æ•…éšœ&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡é«˜æ•ˆ&lt;/strong&gt;ï¼šGo è¯­è¨€å®ç°ï¼Œéƒ¨ç½²ç®€å•ï¼Œæ”¯æŒ HTTP/gRPC APIï¼Œè¯»å†™æ€§èƒ½è¾¾æ¯ç§’æ•°ä¸‡æ¬¡ï¼ˆSSD ç¯å¢ƒï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…³é”®èƒ½åŠ›"&gt;&lt;strong&gt;å…³é”®èƒ½åŠ›&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Watch ç›‘å¬&lt;/strong&gt;ï¼šå®æ—¶ç›‘æ§é”®å€¼å˜åŒ–ï¼Œæ¨é€æ›´æ–°ï¼ˆå¦‚é…ç½®çƒ­æ›´æ–°ã€æœåŠ¡çŠ¶æ€åŒæ­¥ï¼‰&lt;a class="link" href="@ref" &gt;1,5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§Ÿçº¦ï¼ˆLeaseï¼‰æœºåˆ¶&lt;/strong&gt;ï¼šä¸ºé”®ç»‘å®š TTLï¼Œåˆ°æœŸè‡ªåŠ¨åˆ é™¤ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼é”å’ŒæœåŠ¡æ³¨å†Œ&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ“ä½œï¼ˆTxnï¼‰&lt;/strong&gt;ï¼šæ”¯æŒåŸå­æ€§äº‹åŠ¡ï¼Œé¿å…å¹¶å‘å†²çª&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†å²ç‰ˆæœ¬ä¸å‹ç¼©&lt;/strong&gt;ï¼šè®°å½•é”®çš„ä¿®æ”¹å†å²ï¼Œæ”¯æŒç‰ˆæœ¬å›æ»šï¼Œå®šæœŸå‹ç¼©æ—§æ•°æ®æ§åˆ¶å­˜å‚¨è§„æ¨¡&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶æ„ä¸æ ¸å¿ƒåŸç†"&gt;âš™ï¸ &lt;strong&gt;æ¶æ„ä¸æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é›†ç¾¤æ¶æ„"&gt;&lt;strong&gt;é›†ç¾¤æ¶æ„&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹è§’è‰²ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Leader&lt;/strong&gt;ï¼šå”¯ä¸€å¤„ç†å†™è¯·æ±‚ï¼ŒåŒæ­¥æ—¥å¿—è‡³ Followerã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Follower&lt;/strong&gt;ï¼šå“åº”è¯»è¯·æ±‚ï¼Œå‚ä¸ Leader é€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶&lt;a class="link" href="@ref" &gt;1,6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ•°æ®å¤åˆ¶æµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å†™è¯·æ±‚å‘é€è‡³ä»»æ„èŠ‚ç‚¹ï¼Œè½¬å‘è‡³ Leaderã€‚&lt;/li&gt;
&lt;li&gt;Leader ç”Ÿæˆæ—¥å¿—æ¡ç›®ï¼Œé€šè¿‡ Raft åŒæ­¥è‡³å¤šæ•°èŠ‚ç‚¹ï¼ˆå¦‚ 3 èŠ‚ç‚¹éœ€ 2 èŠ‚ç‚¹ç¡®è®¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ—¥å¿—æäº¤åæ›´æ–°çŠ¶æ€æœºï¼Œè¿”å›å®¢æˆ·ç«¯æˆåŠŸ&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å­˜å‚¨å¼•æ“"&gt;&lt;strong&gt;å­˜å‚¨å¼•æ“&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;WALï¼ˆé¢„å†™æ—¥å¿—ï¼‰&lt;/strong&gt;ï¼šæ‰€æœ‰å†™æ“ä½œå…ˆè®°å½•åˆ° WALï¼Œç¡®ä¿å´©æºƒåå¯æ¢å¤&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿«ç…§ï¼ˆSnapshotï¼‰&lt;/strong&gt;ï¼šå®šæœŸï¼ˆå¦‚æ¯ 10000 æ¡æ—¥å¿—ï¼‰ç”Ÿæˆæ•°æ®å¿«ç…§ï¼Œå‡å°‘ WAL ä½“ç§¯&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šç‰ˆæœ¬æ§åˆ¶ï¼ˆMVCCï¼‰&lt;/strong&gt;ï¼šæ¯ä¸ªé”®å…³è”å¤šä¸ªç‰ˆæœ¬ï¼ˆRevisionï¼‰ï¼Œæ”¯æŒå†å²æŸ¥è¯¢å’Œå¹¶å‘æ§åˆ¶&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="raft-ç®—æ³•æ ¸å¿ƒæµç¨‹"&gt;&lt;strong&gt;Raft ç®—æ³•æ ¸å¿ƒæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰ä¸¾ï¼ˆElectionï¼‰&lt;/strong&gt;ï¼šFollower è¶…æ—¶æœªæ”¶åˆ° Leader å¿ƒè·³åˆ™å‘èµ·é€‰ä¸¾ï¼Œè·å¤šæ•°ç¥¨è€…æˆä¸ºæ–° Leader&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—åŒæ­¥ï¼ˆLog Replicationï¼‰&lt;/strong&gt;ï¼šLeader å¤åˆ¶æ—¥å¿—è‡³ Followerï¼Œå¤šæ•°ç¡®è®¤åæäº¤&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§ï¼ˆSafetyï¼‰&lt;/strong&gt;ï¼šç¡®ä¿æ–° Leader åŒ…å«æ‰€æœ‰å·²æäº¤æ—¥å¿—ï¼Œé¿å…æ•°æ®ä¸¢å¤±&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸŒ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="kubernetes-å…ƒæ•°æ®å­˜å‚¨"&gt;&lt;strong&gt;Kubernetes å…ƒæ•°æ®å­˜å‚¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å­˜å‚¨é›†ç¾¤çŠ¶æ€ï¼ˆPod è°ƒåº¦ã€èŠ‚ç‚¹ä¿¡æ¯ã€ConfigMap/Secret ç­‰ï¼‰ï¼Œæ˜¯ API Server çš„å”¯ä¸€æŒä¹…åŒ–åç«¯&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æœåŠ¡å‘ç°"&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æœåŠ¡å®ä¾‹æ³¨å†Œè‡ªèº«åœ°å€åˆ° etcdï¼ˆç»‘å®š Leaseï¼‰ï¼Œå®¢æˆ·ç«¯é€šè¿‡å‰ç¼€æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;/services/web/&lt;/code&gt;ï¼‰è·å–å®æ—¶æœåŠ¡åˆ—è¡¨&lt;a class="link" href="@ref" &gt;2,4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åˆ†å¸ƒå¼é”"&gt;&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬å é”&lt;/strong&gt;ï¼šé€šè¿‡åŸå­æ“ä½œ &lt;code&gt;CompareAndSwap&lt;/code&gt; åˆ›å»ºä¸´æ—¶é”®ï¼ˆç»‘å®š Leaseï¼‰ï¼Œç¡®ä¿å”¯ä¸€æ€§&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¹³é”&lt;/strong&gt;ï¼šåˆ›å»ºæœ‰åºé”®ï¼ŒæŒ‰åºå·è·å–é”ï¼Œé¿å…é¥¥é¥¿é—®é¢˜&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸­å¿ƒ"&gt;&lt;strong&gt;é…ç½®ä¸­å¿ƒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é›†ä¸­ç®¡ç†é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ä¸²ï¼‰ï¼Œåº”ç”¨å¯åŠ¨åŠ è½½é…ç½®å¹¶ç›‘å¬å˜æ›´ï¼Œå®ç°åŠ¨æ€æ›´æ–°æ— éœ€é‡å¯&lt;a class="link" href="@ref" &gt;1,3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§å®è·µè¦ç‚¹"&gt;ğŸ› ï¸ &lt;strong&gt;ç”Ÿäº§å®è·µè¦ç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é›†ç¾¤éƒ¨ç½²è§„èŒƒ"&gt;&lt;strong&gt;é›†ç¾¤éƒ¨ç½²è§„èŒƒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹æ•°é‡&lt;/strong&gt;ï¼šå¥‡æ•°èŠ‚ç‚¹ï¼ˆ3/5/7ï¼‰ï¼Œè·¨æœºæˆ¿éƒ¨ç½²éœ€æ§åˆ¶ç½‘ç»œå»¶è¿Ÿ &amp;lt; 50ms&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬ä»¶è¦æ±‚&lt;/strong&gt;ï¼šSSD ç£ç›˜ï¼ˆä¿éšœ WAL å†™å…¥æ€§èƒ½ï¼‰ï¼Œå†…å­˜ â‰¥8GBï¼ˆç™¾ä¸‡çº§é”®å€¼åœºæ™¯ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®‰å…¨åŠ å›º"&gt;&lt;strong&gt;å®‰å…¨åŠ å›º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;TLS åŠ å¯†&lt;/strong&gt;ï¼šå¯ç”¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åŒå‘è¯ä¹¦è®¤è¯&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RBAC æ§åˆ¶&lt;/strong&gt;ï¼šé™åˆ¶æ•æ„Ÿæ“ä½œï¼ˆå¦‚ &lt;code&gt;etcdctl role grant&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿«ç…§å¤‡ä»½&lt;/strong&gt;ï¼šå®šæœŸå¤‡ä»½ etcd æ•°æ®ï¼ˆ&lt;code&gt;etcdctl snapshot save&lt;/code&gt;ï¼‰ï¼Œç»“åˆ Velero å®ç°ç¾å¤‡&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ€§èƒ½è°ƒä¼˜"&gt;&lt;strong&gt;æ€§èƒ½è°ƒä¼˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;ï¼šFollower å¤„ç†è¯»è¯·æ±‚ï¼Œå‡è½» Leader è´Ÿè½½&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹ç¼©ä¼˜åŒ–&lt;/strong&gt;ï¼šå®šæœŸå‹ç¼©æ—§ç‰ˆæœ¬æ•°æ®ï¼ˆ&lt;code&gt;etcdctl compact&lt;/code&gt;ï¼‰ï¼Œé¿å…å­˜å‚¨è†¨èƒ€&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹"&gt;&lt;strong&gt;å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
etcdctl endpoint health --endpoints=10.0.0.1:2379,10.0.0.2:2379
# è®¾ç½®é”®å€¼å¹¶ç»‘å®šç§Ÿçº¦ï¼ˆ60ç§’è¿‡æœŸï¼‰
etcdctl put /config/db/host &amp;#34;db01:3306&amp;#34; --lease=`etcdctl lease grant 60 | awk &amp;#39;{print $2}&amp;#39;`
# ç›‘å¬é…ç½®å˜æ›´
etcdctl watch /config/ --prefix
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ä¸å…¶ä»–ç³»ç»Ÿå¯¹æ¯”"&gt;âš–ï¸ &lt;strong&gt;ä¸å…¶ä»–ç³»ç»Ÿå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;etcd&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ZooKeeper&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Redis&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…±è¯†ç®—æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Raftï¼ˆç®€å•æ˜“éƒ¨ç½²ï¼‰&lt;/td&gt;
&lt;td&gt;ZABï¼ˆå¤æ‚éš¾ç»´æŠ¤ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸»ä»å¼‚æ­¥å¤åˆ¶ï¼ˆå¼±ä¸€è‡´ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å±‚çº§é”®å€¼ï¼ˆé€‚åˆé…ç½®ï¼‰&lt;/td&gt;
&lt;td&gt;ZNode æ ‘ç»“æ„ï¼ˆé€‚åˆå…ƒæ•°æ®ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸°å¯Œæ•°æ®ç»“æ„ï¼ˆString/Hashç­‰ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœåŠ¡å‘ç°ã€K8s å­˜å‚¨&lt;/td&gt;
&lt;td&gt;åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¦‚HDFSï¼‰&lt;/td&gt;
&lt;td&gt;ç¼“å­˜ã€é«˜é€Ÿè¯»å†™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Watch æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é•¿è¿æ¥å®æ—¶æ¨é€ï¼ˆé«˜æ•ˆï¼‰&lt;/td&gt;
&lt;td&gt;å•æ¬¡è§¦å‘ï¼ˆæ˜“ä¸¢å¤±äº‹ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;Pub/Subï¼ˆæ— æŒä¹…åŒ–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šetcd åœ¨å¼ºä¸€è‡´æ€§ã€è½»é‡åŒ–å’Œäº‘åŸç”Ÿé›†æˆä¸Šä¼˜åŠ¿æ˜¾è‘—ï¼ŒZooKeeper é€‚åˆå¤æ‚åè°ƒåœºæ™¯ï¼ŒRedis ä¾§é‡é«˜æ€§èƒ½ç¼“å­˜&lt;a class="link" href="@ref" &gt;3,7,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜è§£ç­”"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜è§£ç­”&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸ºä½• etcd é‡‡ç”¨ Raft è€Œé Paxosï¼Ÿ&lt;/strong&gt;
Raft æ›´æ˜“ç†è§£ä¸å®ç°ï¼Œé€šè¿‡å•ä¸€ Leader å’Œå¤šæ•°æ´¾ç¡®è®¤ç®€åŒ–ä¸€è‡´æ€§ä¿éšœ&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;etcd çš„ CAP ç‰¹æ€§å¦‚ä½•ï¼Ÿ&lt;/strong&gt;
ä¼˜å…ˆä¿è¯ â€‹&lt;strong&gt;CP&lt;/strong&gt;â€‹ï¼ˆå¼ºä¸€è‡´ + åˆ†åŒºå®¹å¿ï¼‰ï¼Œç‰ºç‰²éƒ¨åˆ†å¯ç”¨æ€§ï¼ˆå¦‚é€‰ä¸¾æœŸé—´å†™è¯·æ±‚æ‹’ç»ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”®å€¼å¤§å°é™åˆ¶ï¼Ÿ&lt;/strong&gt;
å•é”®å€¼ â‰¤1.5MBï¼Œæ€»æ•°æ®åº“ â‰¤8GBï¼ˆæ¨èï¼‰ï¼Œè¶…é™éœ€åˆ†ç‰‡æˆ–å¤–éƒ¨å­˜å‚¨&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;etcd å‡­å€Ÿ &lt;strong&gt;Raft å¼ºä¸€è‡´æ€§&lt;/strong&gt;ã€&lt;strong&gt;Watch å®æ—¶ç›‘å¬&lt;/strong&gt;å’Œ&lt;strong&gt;ç§Ÿçº¦è‡ªåŠ¨æ¸…ç†&lt;/strong&gt;æœºåˆ¶ï¼Œæˆä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸äº‘åŸç”Ÿçš„åŸºç¡€è®¾æ–½æ ¸å¿ƒã€‚å…¶ä»·å€¼åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸º Kubernetes æä¾›â€œæ•°æ®å¤§è„‘â€&lt;/strong&gt;ï¼Œå­˜å‚¨é›†ç¾¤å…³é”®çŠ¶æ€&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–åˆ†å¸ƒå¼åè°ƒ&lt;/strong&gt;ï¼šé€šè¿‡åŸå­é”å’Œç§Ÿçº¦è§£å†³æœåŠ¡å‘ç°ã€é…ç½®åŒæ­¥é—®é¢˜&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡æ˜“ç”¨&lt;/strong&gt;ï¼šGo è¯­è¨€å®ç° + gRPC APIï¼Œé€‚åˆé›†æˆåˆ°ç°ä»£æ¶æ„ä¸­&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¿ç»´å£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;å¥‡æ•°èŠ‚ç‚¹ä¿é€‰ä¸¾ï¼ŒSSD ç›˜åŠ é€Ÿ WALï¼›
ç§Ÿçº¦é”é˜²åƒµæ­»ï¼ŒWatch ç›‘å¬åŠ¨æ€é…ï¼›
å¿«ç…§å¤‡ä»½å®šæœŸåšï¼ŒTLS åŠ å¯†é˜²æ³„éœ²ï¼â€‹&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="configmap"&gt;ConfigMap
&lt;/h2&gt;&lt;p&gt;ConfigMap æ˜¯ Kubernetes ä¸­ç”¨äº&lt;strong&gt;ç®¡ç†éæœºå¯†æ€§é…ç½®æ•°æ®&lt;/strong&gt;çš„æ ¸å¿ƒ API å¯¹è±¡ï¼Œå®ƒå°†é…ç½®ä¿¡æ¯ä¸å®¹å™¨é•œåƒè§£è€¦ï¼Œå®ç°é…ç½®çš„çµæ´»æ³¨å…¥å’ŒåŠ¨æ€æ›´æ–°ã€‚ä»¥ä¸‹ä»è®¾è®¡ç›®æ ‡ã€æ ¸å¿ƒç‰¹æ€§ã€ä½¿ç”¨æ–¹å¼åˆ°æœ€ä½³å®è·µè¿›è¡Œç³»ç»Ÿè§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-configmap-çš„æ ¸å¿ƒå®šä½ä¸ç‰¹æ€§"&gt;ğŸ” &lt;strong&gt;ConfigMap çš„æ ¸å¿ƒå®šä½ä¸ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è®¾è®¡ç›®æ ‡-1"&gt;&lt;strong&gt;è®¾è®¡ç›®æ ‡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ä¸ä»£ç åˆ†ç¦»&lt;/strong&gt;ï¼šå°†ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰ä»å®¹å™¨é•œåƒä¸­å‰¥ç¦»ï¼Œé¿å…å› ç¯å¢ƒå·®å¼‚ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰éœ€é‡å»ºé•œåƒ&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°æ”¯æŒ&lt;/strong&gt;ï¼šé€šè¿‡å·æŒ‚è½½æ–¹å¼å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯ Podï¼ˆç¯å¢ƒå˜é‡æ–¹å¼éœ€é‡å¯ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨æœåŠ¡å…±äº«&lt;/strong&gt;ï¼šåŒä¸€ ConfigMap å¯è¢«å¤šä¸ª Pod å¼•ç”¨ï¼Œæå‡é…ç½®å¤ç”¨æ€§&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…³é”®ç‰¹æ€§"&gt;&lt;strong&gt;å…³é”®ç‰¹æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æ ¼å¼&lt;/strong&gt;ï¼šé”®å€¼å¯¹å½¢å¼ï¼Œæ”¯æŒç®€å•å­—ç¬¦ä¸²ã€å®Œæ•´é…ç½®æ–‡ä»¶ï¼ˆå¦‚ JSONã€XMLï¼‰æˆ–äºŒè¿›åˆ¶æ•°æ®ï¼ˆéœ€ Base64 ç¼–ç ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨é™åˆ¶&lt;/strong&gt;ï¼šå• ConfigMap æ•°æ®é‡ â‰¤1 MiBï¼Œè¶…é™éœ€æ‹†åˆ†æˆ–æ”¹ç”¨å­˜å‚¨å·/æ•°æ®åº“&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘½åè§„èŒƒ&lt;/strong&gt;ï¼šåç§°éœ€ç¬¦åˆ DNS å­åŸŸåè§„åˆ™ï¼ˆå¦‚ &lt;code&gt;app-config&lt;/code&gt;ï¼‰ï¼Œé”®åä»…å…è®¸å­—æ¯æ•°å­—ã€&lt;code&gt;-&lt;/code&gt;ã€&lt;code&gt;_&lt;/code&gt;ã€&lt;code&gt;.&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜æ€§&lt;/strong&gt;ï¼ˆv1.19+ï¼‰ï¼šè®¾ç½® &lt;code&gt;immutable: true&lt;/code&gt; é˜²æ­¢è¯¯ä¿®æ”¹ï¼Œæå‡æ€§èƒ½å¹¶å‡å°‘ API è´Ÿè½½&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-configmap-çš„åˆ›å»ºæ–¹å¼"&gt;âš™ï¸ &lt;strong&gt;ConfigMap çš„åˆ›å»ºæ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å‘½ä»¤è¡Œåˆ›å»º"&gt;&lt;strong&gt;å‘½ä»¤è¡Œåˆ›å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å­—é¢é‡æ³¨å…¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create configmap app-config --from-literal=LOG_LEVEL=DEBUG --from-literal=API_URL=https://api.example.com
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶/ç›®å½•æ³¨å…¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create configmap file-config --from-file=./config.properties # å•æ–‡ä»¶
kubectl create configmap dir-config --from-file=./config-dir/ # ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="yaml-å£°æ˜å¼åˆ›å»º"&gt;&lt;strong&gt;YAML å£°æ˜å¼åˆ›å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: ConfigMap
metadata:
name: game-config
data:
player_initial_lives: &amp;#34;3&amp;#34; # ç®€å•é”®å€¼
ui.properties: | # å¤šè¡Œé…ç½®æ–‡ä»¶
color.good=purple
color.bad=yellow
binaryData: # äºŒè¿›åˆ¶æ•°æ®ï¼ˆBase64 ç¼–ç ï¼‰
icon: aGVsbG8=
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-åœ¨-pod-ä¸­ä½¿ç”¨-configmap-çš„ä¸‰ç§æ–¹å¼"&gt;ğŸ“¦ &lt;strong&gt;åœ¨ Pod ä¸­ä½¿ç”¨ ConfigMap çš„ä¸‰ç§æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ç¯å¢ƒå˜é‡æ³¨å…¥"&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡æ³¨å…¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å•é”®æ³¨å…¥ï¼šç›´æ¥å¼•ç”¨ç‰¹å®šé”®å€¼
&lt;pre tabindex="0"&gt;&lt;code&gt;env:
- name: LOG_LEVEL
valueFrom:
configMapKeyRef:
name: app-config
key: LOG_LEVEL
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å…¨é‡æ³¨å…¥ï¼šConfigMap æ‰€æœ‰é”®å€¼è½¬ä¸ºç¯å¢ƒå˜é‡
&lt;pre tabindex="0"&gt;&lt;code&gt;envFrom:
- configMapRef:
name: app-config
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å‘½ä»¤è¡Œå‚æ•°ä¼ é€’"&gt;&lt;strong&gt;å‘½ä»¤è¡Œå‚æ•°ä¼ é€’&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;command: [&amp;#34;/bin/sh&amp;#34;, &amp;#34;-c&amp;#34;, &amp;#34;echo $(LOG_LEVEL)&amp;#34;]
env:
- name: LOG_LEVEL
valueFrom:
configMapKeyRef:
name: app-config
key: LOG_LEVEL
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å·æŒ‚è½½æœ€å¸¸ç”¨"&gt;&lt;strong&gt;å·æŒ‚è½½ï¼ˆæœ€å¸¸ç”¨ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å®Œæ•´æŒ‚è½½ï¼šConfigMap æ¯ä¸ªé”®ç”Ÿæˆç‹¬ç«‹æ–‡ä»¶
&lt;pre tabindex="0"&gt;&lt;code&gt;volumes:
- name: config-volume
configMap:
name: app-config
volumeMounts:
- name: config-volume
mountPath: /etc/app-config
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å­è·¯å¾„æŒ‚è½½ï¼šä»…æŒ‚è½½ç‰¹å®šé”®åˆ°æŒ‡å®šè·¯å¾„
&lt;pre tabindex="0"&gt;&lt;code&gt;volumeMounts:
- name: config-volume
mountPath: /etc/app-config/ui.properties
subPath: ui.properties # ä»…æŒ‚è½½æ­¤é”®
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;çƒ­æ›´æ–°æœºåˆ¶&lt;/strong&gt;ï¼šå·æŒ‚è½½æ–¹å¼ä¸‹ï¼ŒConfigMap æ›´æ–°åï¼Œkubelet è‡ªåŠ¨åŒæ­¥æ–‡ä»¶è‡³å®¹å™¨ï¼ˆçº¦ 30-60 ç§’ï¼‰ï¼Œåº”ç”¨éœ€ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼ˆå¦‚ Nginx çš„ &lt;code&gt;nginx -s reload&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-configmap-ä¸-secret-çš„å¯¹æ¯”ä¸åä½œ"&gt;ğŸ”’ &lt;strong&gt;ConfigMap ä¸ Secret çš„å¯¹æ¯”ä¸åä½œ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Secret&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éæ•æ„Ÿé…ç½®ï¼ˆURLã€æ—¥å¿—çº§åˆ«ï¼‰&lt;/td&gt;
&lt;td&gt;æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ã€API å¯†é’¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨åŠ å¯†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜æ–‡å­˜å‚¨äº etcd&lt;/td&gt;
&lt;td&gt;Base64 ç¼–ç  + æ”¯æŒé™æ€åŠ å¯†ï¼ˆK8s 1.13+ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¿é—®æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;RBAC é™åˆ¶å‘½åç©ºé—´è®¿é—®æƒé™&lt;/td&gt;
&lt;td&gt;é¢å¤–å†…å­˜åŠ å¯†ä¼ è¾“ï¼Œä»…åˆ†å‘è‡³éœ€è®¿é—®èŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–‡ä»¶æƒé™&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤ 0644&lt;/td&gt;
&lt;td&gt;é»˜è®¤ 0644ï¼Œå¯é€šè¿‡ &lt;code&gt;defaultMode&lt;/code&gt; è°ƒæ•´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€é•œåƒæ‹‰å–å‡­è¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;åä½œå»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰å­˜äº Secretï¼Œéæ•æ„Ÿé…ç½®ï¼ˆå¦‚æœåŠ¡åœ°å€ï¼‰å­˜äº ConfigMap&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»„åˆä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;env:
- name: DB_HOST
valueFrom:
configMapKeyRef:
name: app-config
key: db_host
- name: DB_PASSWORD
valueFrom:
secretKeyRef:
name: db-secret
key: password
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ"&gt;ğŸ›¡ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨è§„èŒƒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¦æ­¢å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼ˆå³ä½¿ Base64 ç¼–ç ä¹Ÿä¸å®‰å…¨ï¼Œåº”æ”¹ç”¨ Secretï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ RBAC é™åˆ¶ ConfigMap è®¿é—®æƒé™ï¼ˆå¦‚ &lt;code&gt;kubectl create role&lt;/code&gt; ç»‘å®šæœ€å°æƒé™ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬ä¸æ›´æ–°ç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ Deployment è”åŠ¨ï¼šä¿®æ”¹ ConfigMap åï¼Œé€šè¿‡æ³¨è§£è§¦å‘ Deployment æ»šåŠ¨æ›´æ–°ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl patch deployment my-app --patch &amp;#39;{&amp;#34;spec&amp;#34;: {&amp;#34;template&amp;#34;: {&amp;#34;metadata&amp;#34;: {&amp;#34;annotations&amp;#34;: {&amp;#34;config/version&amp;#34;: &amp;#34;v2&amp;#34;}}}}&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;ä¸å¯å˜ ConfigMapï¼šç”Ÿäº§ç¯å¢ƒå¯ç”¨ &lt;code&gt;immutable: true&lt;/code&gt; é¿å…é…ç½®æ¼‚ç§»&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ä¸è°ƒè¯•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥çœ‹ ConfigMap å†…å®¹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl describe cm app-config # æŸ¥çœ‹é”®åˆ—è¡¨
kubectl get cm app-config -o jsonpath=&amp;#39;{.data.ui.properties}&amp;#39; # æå–ç‰¹å®šé”®å€¼
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æŒ‚è½½éªŒè¯ï¼šè¿›å…¥ Pod æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦åŒæ­¥æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ConfigMap æ˜¯ Kubernetes é…ç½®ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡ &lt;strong&gt;â€œé…ç½®ä¸é•œåƒè§£è€¦â€&lt;/strong&gt; + &lt;strong&gt;â€œåŠ¨æ€æ³¨å…¥â€&lt;/strong&gt; å®ç°ä»¥ä¸‹ä»·å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œã€æ–‡ä»¶æŒ‚è½½å¤šç§æ³¨å…¥æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç»´æŠ¤æ€§&lt;/strong&gt;ï¼šå·æŒ‚è½½æ”¯æŒçƒ­æ›´æ–°ï¼Œé™ä½æœåŠ¡ä¸­æ–­é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼šä¸ Secret åˆ†å·¥åä½œï¼Œæ•æ„Ÿæ•°æ®éš”ç¦»ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡å‡†åŒ–&lt;/strong&gt;ï¼šé€šè¿‡ YAML/RBAC å®ç°é…ç½®çš„ç‰ˆæœ¬æ§åˆ¶ä¸å®¡è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒå£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;éå¯†é…ç½® ConfigMapï¼Œé”®å€¼æ–‡ä»¶çš†å¯çº³ï¼›
ç¯å¢ƒå˜é‡å‘½ä»¤è¡Œï¼Œå·æŒ‚çƒ­æ›´æœ€å¼ºå¤§ï¼›
æ•æ„Ÿæ•°æ®äº¤ Secretï¼Œç»„åˆç®¡ç†æ•ˆæœ€ä½³ï¼â€‹&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="secret"&gt;Secret
&lt;/h2&gt;&lt;p&gt;Secret æ˜¯ Kubernetes ä¸­ç”¨äº&lt;strong&gt;å®‰å…¨å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿæ•°æ®&lt;/strong&gt;çš„æ ¸å¿ƒ API å¯¹è±¡ï¼ˆå¦‚å¯†ç ã€API å¯†é’¥ã€TLS è¯ä¹¦ï¼‰ï¼Œé€šè¿‡è§£è€¦æ•æ„Ÿä¿¡æ¯ä¸å®¹å™¨é•œåƒ/é…ç½®ï¼Œæå‡å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒæœºåˆ¶ã€ç±»å‹ã€ä½¿ç”¨æ–¹å¼åˆ°ç”Ÿäº§å®è·µè¿›è¡Œç³»ç»Ÿè§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-secret-çš„æ ¸å¿ƒå®šä½ä¸å®‰å…¨æœºåˆ¶"&gt;ğŸ”’ &lt;strong&gt;Secret çš„æ ¸å¿ƒå®šä½ä¸å®‰å…¨æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è®¾è®¡ç›®æ ‡-2"&gt;&lt;strong&gt;è®¾è®¡ç›®æ ‡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•æ„Ÿæ•°æ®éš”ç¦»&lt;/strong&gt;ï¼šé¿å…å°†å¯†ç ã€ä»¤ç‰Œç­‰ç¡¬ç¼–ç åœ¨é•œåƒæˆ– Pod å®šä¹‰ä¸­ï¼Œé™ä½æ³„éœ²é£é™©&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ³¨å…¥&lt;/strong&gt;ï¼šæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æˆ–æ–‡ä»¶æŒ‚è½½å°†æ•°æ®å®‰å…¨æ³¨å…¥å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;ï¼šä¸ RBACã€åŠ å¯†ç­–ç•¥é›†æˆï¼Œå®ç°ç»†ç²’åº¦æ§åˆ¶&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®‰å…¨é˜²æŠ¤åˆ†å±‚"&gt;&lt;strong&gt;å®‰å…¨é˜²æŠ¤åˆ†å±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å±‚çº§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æªæ–½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Base64 ç¼–ç ï¼ˆéåŠ å¯†ï¼Œä»…é¿å…æ˜æ–‡æš´éœ²ï¼‰&lt;/td&gt;
&lt;td&gt;é˜²æ­¢æ•°æ®åœ¨ YAML/JSON ä¸­ç›´æ¥è§£ææš´éœ²&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;etcd é™æ€åŠ å¯†ï¼ˆéœ€æ‰‹åŠ¨é…ç½®ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ å¯†å­˜å‚¨æ•°æ®ï¼Œé˜²æ­¢ etcd æ³„éœ²æ—¶æ•°æ®è¢«ç›—&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼ è¾“å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;TLS åŠ å¯†é€šä¿¡&lt;/td&gt;
&lt;td&gt;ä¿æŠ¤ API Server ä¸èŠ‚ç‚¹é—´çš„æ•°æ®ä¼ è¾“&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¿é—®å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;RBAC æ§åˆ¶ï¼ˆé™åˆ¶ get/list æƒé™ï¼‰&lt;/td&gt;
&lt;td&gt;éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œä¾‹å¦‚ä»…å…è®¸ç‰¹å®šå‘½åç©ºé—´è®¿é—®&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿è¡Œæ—¶å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶åªè¯»æŒ‚è½½ï¼ˆ&lt;code&gt;readOnly: true&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;é˜²æ­¢å®¹å™¨è¿›ç¨‹ç¯¡æ”¹ Secret æ–‡ä»¶&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-secret-çš„å››ç§æ ¸å¿ƒç±»å‹"&gt;ğŸ“¦ &lt;strong&gt;Secret çš„å››ç§æ ¸å¿ƒç±»å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="opaque"&gt;&lt;strong&gt;&lt;code&gt;Opaque&lt;/code&gt;ï¼ˆé»˜è®¤ç±»å‹ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šå­˜å‚¨ä»»æ„é”®å€¼å¯¹æ•°æ®ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæ–¹å¼ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create secret generic my-secret \
--from-literal=username=admin \
--from-literal=password=S3cr3t! # æ— éœ€æ‰‹åŠ¨ Base64 ç¼–ç [4,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="kubernetesiodockerconfigjson"&gt;&lt;strong&gt;&lt;code&gt;kubernetes.io/dockerconfigjson&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šå­˜å‚¨ç§æœ‰é•œåƒä»“åº“è®¤è¯ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºæ–¹å¼&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create secret docker-registry regcred \
--docker-server=registry.example.com \
--docker-username=user \
--docker-password=pass
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="kubernetesiotls"&gt;&lt;strong&gt;&lt;code&gt;kubernetes.io/tls&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šå­˜å‚¨ TLS è¯ä¹¦å’Œç§é’¥ï¼ˆHTTPS æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºæ–¹å¼&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create secret tls tls-cert \
--cert=./tls.crt \
--key=./tls.key[4,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="kubernetesioservice-account-token"&gt;&lt;strong&gt;&lt;code&gt;kubernetes.io/service-account-token&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åˆ›å»º&lt;/strong&gt;ï¼šä¸º ServiceAccount ç”Ÿæˆï¼Œç”¨äº Pod è®¿é—® Kubernetes API&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‚è½½è·¯å¾„&lt;/strong&gt;ï¼š&lt;code&gt;/var/run/secrets/kubernetes.io/serviceaccount&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-secret-çš„ä¸¤ç§ä½¿ç”¨æ–¹å¼"&gt;âš™ï¸ &lt;strong&gt;Secret çš„ä¸¤ç§ä½¿ç”¨æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ç¯å¢ƒå˜é‡æ³¨å…¥-1"&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡æ³¨å…¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šç®€å•ä½†&lt;strong&gt;ä¸æ”¯æŒçƒ­æ›´æ–°&lt;/strong&gt;ï¼ˆéœ€é‡å¯ Podï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;env:
- name: DB_PASSWORD
valueFrom:
secretKeyRef:
name: db-secret
key: password[2,4](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–‡ä»¶æŒ‚è½½æ¨è"&gt;&lt;strong&gt;æ–‡ä»¶æŒ‚è½½ï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ”¯æŒ&lt;strong&gt;çƒ­æ›´æ–°&lt;/strong&gt;ï¼ˆkubelet æ¯åˆ†é’ŸåŒæ­¥æ–‡ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;volumeMounts:
- name: secret-vol
mountPath: &amp;#34;/etc/secrets&amp;#34;
readOnly: true
volumes:
- name: secret-vol
secret:
secretName: db-secret[1,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;çƒ­æ›´æ–°æœºåˆ¶&lt;/strong&gt;ï¼šä¿®æ”¹ Secret åï¼ŒæŒ‚è½½çš„æ–‡ä»¶è‡ªåŠ¨æ›´æ–°ï¼Œåº”ç”¨éœ€ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼ˆå¦‚ Nginx &lt;code&gt;nginx -s reload&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ-1"&gt;ğŸ›¡ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®‰å…¨åŠ å›º-1"&gt;&lt;strong&gt;å®‰å…¨åŠ å›º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¯ç”¨ etcd åŠ å¯†ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# encryption-config.yaml
apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources: [&amp;#34;secrets&amp;#34;]
providers:
- aescbc: # AES-CBC åŠ å¯†
keys: [{name: key1, secret: &amp;lt;base64-encoded-key&amp;gt;}][3](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RBAC æœ€å°æƒé™&lt;/strong&gt;ï¼šç¦æ­¢å¼€å‘äººå‘˜è®¿é—®ç”Ÿäº§ç¯å¢ƒ Secret&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¯†é’¥åŠ¨æ€ç®¡ç†"&gt;&lt;strong&gt;å¯†é’¥åŠ¨æ€ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨é›†æˆ&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;strong&gt;HashiCorp Vault&lt;/strong&gt; æˆ– &lt;strong&gt;SealedSecret&lt;/strong&gt;ï¼ˆGitOps å®‰å…¨æ–¹æ¡ˆï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨è½®æ¢ï¼šé€šè¿‡ Cert-Manager è‡ªåŠ¨æ›´æ–° TLS è¯ä¹¦ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
name: https-cert
spec:
secretName: https-cert
renewBefore: 360h # æå‰ 15 å¤©ç»­æœŸ[7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸ç›‘æ§"&gt;&lt;strong&gt;é…ç½®ä¸ç›‘æ§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜ Secret&lt;/strong&gt;ï¼ˆv1.19+ï¼‰ï¼šè®¾ç½® &lt;code&gt;immutable: true&lt;/code&gt; é˜²æ­¢è¯¯ä¿®æ”¹&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®¡è®¡æ—¥å¿—ï¼šç›‘æ§å¼‚å¸¸ Secret è®¿é—®è¡Œä¸ºï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kube-apiserver --audit-log-path=/var/log/kubernetes/audit.log[3,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸é™åˆ¶"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸é™åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Base64 ä¸ç­‰äºåŠ å¯†&lt;/strong&gt;ï¼šä»…æ··æ·†æ•°æ®ï¼Œéœ€é…åˆ etcd åŠ å¯†ä½¿ç”¨&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§å°é™åˆ¶&lt;/strong&gt;ï¼šå• Secret â‰¤1 MiBï¼Œå¤§æ–‡ä»¶éœ€ç”¨å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚ AWS S3ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ–°ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡&lt;/strong&gt;ï¼šå¿…é¡»é‡å¯ Podã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶æŒ‚è½½&lt;/strong&gt;ï¼šè‡ªåŠ¨æ›´æ–°ï¼ˆéœ€åº”ç”¨æ”¯æŒåŠ¨æ€åŠ è½½ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“secret-çš„æ ¸å¿ƒä»·å€¼"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šSecret çš„æ ¸å¿ƒä»·å€¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Secret é€šè¿‡ &lt;strong&gt;â€œæ•æ„Ÿæ•°æ®ä¸ä»£ç è§£è€¦â€&lt;/strong&gt; + &lt;strong&gt;â€œåˆ†å±‚å®‰å…¨é˜²æŠ¤â€&lt;/strong&gt; å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æå‡&lt;/strong&gt;ï¼šBase64 ç¼–ç  + etcd åŠ å¯† + RBAC æ§åˆ¶ï¼Œé™ä½æ³„éœ²é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ³¨å…¥&lt;/strong&gt;ï¼šç¯å¢ƒå˜é‡ä¸æ–‡ä»¶æŒ‚è½½æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–é›†æˆ&lt;/strong&gt;ï¼šä¸ Cert-Managerã€Vault ç­‰å·¥å…·è”åŠ¨ï¼Œå®ç°å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿäº§å£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;æ•æ„Ÿæ•°æ®å­˜ Secretï¼ŒBase64 ç¼–ç é˜²æ˜æ–‡ï¼›
æ–‡ä»¶æŒ‚è½½çƒ­æ›´æ–°ï¼Œç¯å¢ƒå˜é‡éœ€é‡å¯ï¼›
RBAC åŠ å¯†åŠ å®¡è®¡ï¼Œå¯†é’¥è½®æ¢ä¿å®‰å…¨ï¼â€‹&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="secret-ä¸Šä¼ "&gt;Secret ä¸Šä¼ 
&lt;/h2&gt;&lt;p&gt;Secret åœ¨ Kubernetes ä¸­åˆ›å»ºåï¼Œç”± API Server è´Ÿè´£å°†å…¶å­˜å‚¨åˆ° etcd ä¸­ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠæ•°æ®ç¼–ç ã€ä¼ è¾“åŠ å¯†å’Œå­˜å‚¨æœºåˆ¶ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æµç¨‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-secret-åˆ›å»ºä¸ä¸Šä¼ æµç¨‹"&gt;ğŸ”’ &lt;strong&gt;Secret åˆ›å»ºä¸ä¸Šä¼ æµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ç”¨æˆ·åˆ›å»º-secret"&gt;&lt;strong&gt;ç”¨æˆ·åˆ›å»º Secret&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç”¨æˆ·é€šè¿‡ä»¥ä¸‹ä¸¤ç§ä¸»è¦æ–¹å¼å®šä¹‰ Secretï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘½ä»¤å¼åˆ›å»º
ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; kubectl create secret
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create secret generic mysecret \
--from-literal=username=admin \
--from-literal=password=123456
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;API Server æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè‡ªåŠ¨å¯¹æ•°æ®ï¼ˆå¦‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; admin
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ã€&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;123456
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰è¿›è¡Œ Base64 ç¼–ç ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å£°æ˜å¼åˆ›å»ºï¼ˆYAML æ–‡ä»¶ï¼‰
ç”¨æˆ·éœ€æ‰‹åŠ¨å¯¹æ•æ„Ÿæ•°æ® Base64 ç¼–ç ï¼Œå†å†™å…¥ YAMLï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: Secret
metadata:
name: mysecret
type: Opaque
data:
username: YWRtaW4= # &amp;#34;admin&amp;#34; çš„ Base64 ç¼–ç 
password: MTIzNDU2 # &amp;#34;123456&amp;#34; çš„ Base64 ç¼–ç 
&lt;/code&gt;&lt;/pre&gt;åº”ç”¨æ–‡ä»¶åï¼ŒAPI Server ç›´æ¥å­˜å‚¨ç¼–ç åçš„æ•°æ®
3,6
ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="api-server-å¤„ç†"&gt;&lt;strong&gt;API Server å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Base64 ç¼–ç &lt;/strong&gt;ï¼šæ— è®ºç”¨æˆ·æ˜¯å¦é¢„å…ˆç¼–ç ï¼ŒAPI Server æœ€ç»ˆç»Ÿä¸€ä»¥ Base64 æ ¼å¼å­˜å‚¨æ•°æ®ï¼ˆä»…ç¼–ç ï¼ŒéåŠ å¯†ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼ è¾“åŠ å¯†&lt;/strong&gt;ï¼šæ•°æ®é€šè¿‡ TLS åŠ å¯†é€šé“ä¼ è¾“åˆ° API Serverï¼Œé˜²æ­¢ä¸­é—´äººçªƒå¬&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å­˜å‚¨åˆ°-etcd"&gt;&lt;strong&gt;å­˜å‚¨åˆ° etcd&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨è·¯å¾„&lt;/strong&gt;ï¼šSecret æ•°æ®å†™å…¥ etcd çš„é”®å€¼è·¯å¾„ &lt;code&gt;/registry/secrets/&amp;lt;namespace&amp;gt;/&amp;lt;name&amp;gt;&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤æ˜æ–‡é£é™©&lt;/strong&gt;ï¼šetcd é»˜è®¤ä»¥ Base64 æ˜æ–‡å­˜å‚¨ Secretï¼Œè‹¥æœªå¯ç”¨åŠ å¯†ï¼Œæ”»å‡»è€…å¯ç›´æ¥è¯»å–æ•æ„Ÿæ•°æ®&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®‰å…¨åŠ å›ºetcd-é™æ€åŠ å¯†"&gt;ğŸ” &lt;strong&gt;å®‰å…¨åŠ å›ºï¼šetcd é™æ€åŠ å¯†&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸ºé¿å…æ˜æ–‡å­˜å‚¨é£é™©ï¼Œéœ€å¯ç”¨ etcd é™æ€åŠ å¯†ï¼š
1.
é…ç½®åŠ å¯†ç­–ç•¥
åˆ›å»º&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; EncryptionConfiguration
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ–‡ä»¶ï¼ŒæŒ‡å®š AES-CBC æˆ– AES-GCM åŠ å¯†ç®—æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources: [&amp;#34;secrets&amp;#34;]
providers:
- aescbc:
keys: [{name: key1, secret: &amp;lt;base64-encoded-key&amp;gt;}]
&lt;/code&gt;&lt;/pre&gt;&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;é‡å¯ API Server&lt;/strong&gt;
åŠ è½½åŠ å¯†é…ç½®åï¼Œæ‰€æœ‰æ–°å†™å…¥ etcd çš„ Secret è‡ªåŠ¨åŠ å¯†&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å¯†æ•ˆæœ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ–° Secretï¼šå†™å…¥æ—¶åŠ å¯†ï¼Œè¯»å–æ—¶è§£å¯†ã€‚
&lt;ul&gt;
&lt;li&gt;æ—§ Secretï¼šéœ€æ‰‹åŠ¨è¿ç§»ï¼ˆ&lt;code&gt;kubectl get secrets -o json | kubectl replace -f -&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Base64 â‰  åŠ å¯†&lt;/strong&gt;
Base64 ä»…ç”¨äºæ•°æ®ç¼–ç ï¼Œå¯è½»æ˜“åå‘è§£ç ï¼ˆ&lt;code&gt;echo 'MTIzNDU2' | base64 -d&lt;/code&gt;ï¼‰ï¼Œâ€‹&lt;strong&gt;ä¸èƒ½æ›¿ä»£åŠ å¯†&lt;/strong&gt;â€‹&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡æ³¨å…¥çš„é£é™©&lt;/strong&gt;
Secret é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥æ—¶ï¼Œå¯èƒ½è¢«æ—¥å¿—è®°å½•æˆ– &lt;code&gt;/proc&lt;/code&gt; æ–‡ä»¶ç³»ç»Ÿæš´éœ²ï¼Œâ€‹&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨å·æŒ‚è½½&lt;/strong&gt;â€‹&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;RBAC æœ€å°åŒ–æƒé™
é™åˆ¶ç”¨æˆ·è®¿é—® Secret çš„æƒé™ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create role secret-reader --verb=get --resource=secrets
kubectl create rolebinding dev-secret-access --role=secret-reader --user=dev-user
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-secret-æ›´æ–°ä¸åŒæ­¥"&gt;ğŸ”„ &lt;strong&gt;Secret æ›´æ–°ä¸åŒæ­¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ›´æ–°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹ Secret åï¼Œetcd ä¸­æ•°æ®å®æ—¶æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;æŒ‚è½½ Secret çš„ Pod ä¼š&lt;strong&gt;è‡ªåŠ¨åŒæ­¥&lt;/strong&gt;ï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰ï¼Œæ— éœ€é‡å¯&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡é™åˆ¶&lt;/strong&gt;ï¼š
é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥çš„ Secret â€‹&lt;strong&gt;æ— æ³•åŠ¨æ€æ›´æ–°&lt;/strong&gt;ï¼Œå¿…é¡»é‡å¯ Pod&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹ä¸Šä¼ æµç¨‹&lt;/strong&gt;ï¼šç”¨æˆ·åˆ›å»º Secret â†’ API Server Base64 ç¼–ç  â†’ TLS åŠ å¯†ä¼ è¾“ â†’ å­˜å‚¨åˆ° etcdï¼ˆé»˜è®¤æ˜æ–‡ï¼‰&lt;a class="link" href="@ref" &gt;2,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ ¸å¿ƒ&lt;/strong&gt;ï¼š&lt;strong&gt;å¿…é¡»å¯ç”¨ etcd é™æ€åŠ å¯†&lt;/strong&gt;ï¼Œç»“åˆ RBAC å’Œå·æŒ‚è½½ï¼Œå½¢æˆå®Œæ•´é˜²æŠ¤é“¾&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œå£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;åˆ›å»º Secret ä¸¤æ–¹å¼ï¼Œå‘½ä»¤å£°æ˜çš†å¯è¡Œï¼›
Base64 ç¼–ç éåŠ å¯†ï¼Œä¼ è¾“ä»…é  TLSï¼›
etcd å­˜å‚¨éœ€åŠ å¯†ï¼ŒRBAC æŒ‚è½½ä¿å®‰å…¨ï¼â€‹&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="configmap--secret"&gt;ConfigMap &amp;amp; Secret
&lt;/h2&gt;&lt;p&gt;ConfigMap å’Œ Secret æ˜¯ Kubernetes ä¸­ç”¨äºé…ç½®ç®¡ç†çš„æ ¸å¿ƒèµ„æºï¼Œä½†è®¾è®¡ç›®æ ‡ã€å®‰å…¨æœºåˆ¶å’Œä½¿ç”¨åœºæ™¯å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»äº”å¤§ç»´åº¦è¿›è¡Œè¯¦ç»†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå®šä½ä¸è®¾è®¡ç›®æ ‡"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒå®šä½ä¸è®¾è®¡ç›®æ ‡&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Secret&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­˜å‚¨&lt;strong&gt;éæ•æ„Ÿé…ç½®&lt;/strong&gt;ï¼ˆç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;å­˜å‚¨&lt;strong&gt;æ•æ„Ÿæ•°æ®&lt;/strong&gt;ï¼ˆå¯†ç ã€API å¯†é’¥ã€TLS è¯ä¹¦ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡åŸåˆ™&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°é…ç½®ä¸é•œåƒè§£è€¦ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°&lt;/td&gt;
&lt;td&gt;ä¿éšœæ•æ„Ÿæ•°æ®å®‰å…¨ï¼Œé˜²æ­¢æ˜æ–‡æ³„éœ²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‹¬ç«‹äº Podï¼Œåˆ é™¤ Pod ä¸å½±å“ ConfigMap&lt;/td&gt;
&lt;td&gt;åŒ ConfigMapï¼Œç‹¬ç«‹å­˜å‚¨äº etcd&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®åŒºåˆ«&lt;/strong&gt;ï¼šConfigMap é¢å‘é€šç”¨é…ç½®ï¼ŒSecret ä¸“æ³¨æ•æ„Ÿæ•°æ®å®‰å…¨ &lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®å­˜å‚¨ä¸å®‰å…¨æœºåˆ¶"&gt;ğŸ” &lt;strong&gt;æ•°æ®å­˜å‚¨ä¸å®‰å…¨æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Secret&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨æ ¼å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜æ–‡å­˜å‚¨&lt;/strong&gt;äº etcdï¼ŒAPI å“åº”å¯è§&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Base64 ç¼–ç å­˜å‚¨&lt;/strong&gt;ï¼ˆéåŠ å¯†ï¼‰ï¼ŒAPI å“åº”éšè—æ•°æ® &lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ å¯†æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— åŸç”ŸåŠ å¯†&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;strong&gt;etcd é™æ€åŠ å¯†&lt;/strong&gt;ï¼ˆK8s 1.13+ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¿é—®æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ– RBAC é™åˆ¶å‘½åç©ºé—´æƒé™&lt;/td&gt;
&lt;td&gt;æ›´ä¸¥æ ¼çš„ RBAC æ§åˆ¶ + ä»…åˆ†å‘åˆ°éœ€è®¿é—®çš„èŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿è¡Œæ—¶ä¿æŠ¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶æƒé™é»˜è®¤ &lt;code&gt;0644&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ ConfigMapï¼Œå¯è®¾ &lt;code&gt;readOnly: true&lt;/code&gt; é˜²ç¯¡æ”¹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨è­¦ç¤º&lt;/strong&gt;ï¼šBase64 ç¼–ç â‰ åŠ å¯†ï¼Secret éœ€é¢å¤–å¯ç”¨ etcd åŠ å¯† &lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®æ³¨å…¥ä¸æ›´æ–°æœºåˆ¶"&gt;âš™ï¸ &lt;strong&gt;æ•°æ®æ³¨å…¥ä¸æ›´æ–°æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ³¨å…¥æ–¹å¼å¯¹æ¯”"&gt;&lt;strong&gt;æ³¨å…¥æ–¹å¼å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Secret&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼Œä½†æ›´æ–°éœ€&lt;strong&gt;é‡å¯ Pod&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼Œä½†&lt;strong&gt;ä¸æ¨è&lt;/strong&gt;ï¼ˆç¯å¢ƒå˜é‡å¯èƒ½è¢«æ—¥å¿—è®°å½•ï¼‰&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å·æŒ‚è½½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‚è½½ä¸ºæ–‡ä»¶ï¼Œæ”¯æŒ&lt;strong&gt;çƒ­æ›´æ–°&lt;/strong&gt;ï¼ˆçº¦ 1 åˆ†é’ŸåŒæ­¥ï¼‰&lt;/td&gt;
&lt;td&gt;åŒ ConfigMapï¼Œè‡ªåŠ¨åŒæ­¥æ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‘½ä»¤è¡Œå‚æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="çƒ­æ›´æ–°ç¤ºä¾‹"&gt;&lt;strong&gt;çƒ­æ›´æ–°ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# ConfigMap å·æŒ‚è½½
volumes:
- name: app-config
configMap:
name: my-config # æ›´æ–°åå®¹å™¨å†…æ–‡ä»¶è‡ªåŠ¨åŒæ­¥
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šæ•æ„Ÿæ•°æ®ä¼˜å…ˆç”¨&lt;strong&gt;å·æŒ‚è½½&lt;/strong&gt;ï¼Œé¿å…ç¯å¢ƒå˜é‡æ³„éœ²é£é™© &lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-ç±»å‹ä¸ä½¿ç”¨åœºæ™¯"&gt;ğŸ—‚ï¸ &lt;strong&gt;ç±»å‹ä¸ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="configmap-å…¸å‹åœºæ™¯"&gt;&lt;strong&gt;ConfigMap å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éæ•æ„Ÿé…ç½®&lt;/strong&gt;ï¼šæ—¥å¿—çº§åˆ«ã€åŠŸèƒ½å¼€å…³ã€æ•°æ®åº“è¿æ¥åœ°å€ &lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼šNginx é…ç½®ã€Tomcat &lt;code&gt;server.xml&lt;/code&gt;ï¼ˆå¦‚æŒ‚è½½ &lt;code&gt;tomcat-users.xml&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨ç¯å¢ƒå…±äº«&lt;/strong&gt;ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒå·®å¼‚åŒ–é…ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="secret-ç±»å‹ä¸ç”¨é€”"&gt;&lt;strong&gt;Secret ç±»å‹ä¸ç”¨é€”&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Opaque&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰&lt;/td&gt;
&lt;td&gt;é€šç”¨æ•æ„Ÿæ•°æ®ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;kubernetes.io/tls&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å­˜å‚¨ HTTPS è¯ä¹¦ï¼ˆ&lt;code&gt;tls.crt&lt;/code&gt; + &lt;code&gt;tls.key&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;kubernetes.io/dockerconfigjson&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç§æœ‰é•œåƒä»“åº“è®¤è¯ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServiceAccount&lt;/code&gt; ä»¤ç‰Œ&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨åˆ›å»ºï¼Œç”¨äº Pod è®¿é—® API Server&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯å£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;ConfigMap ç®¡é…ç½®ï¼Œç¯å¢ƒã€æ–‡ä»¶ã€å‘½ä»¤è¡Œï¼›
Secret æŠ¤å¯†é’¥ï¼Œè¯ä¹¦ã€å¯†ç ã€é•œåƒä»“ï¼â€‹&lt;/strong&gt;â€‹ &lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ-2"&gt;ğŸ›¡ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="configmap-å®‰å…¨è§„èŒƒ"&gt;&lt;strong&gt;ConfigMap å®‰å…¨è§„èŒƒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨æ•æ„Ÿæ•°æ®&lt;/strong&gt;ï¼šç»ä¸å­˜å‚¨å¯†ç ã€ä»¤ç‰Œï¼Œæ”¹ç”¨ Secret &lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RBAC æœ€å°æƒé™&lt;/strong&gt;ï¼šé™åˆ¶å¼€å‘äººå‘˜è®¿é—®ç”Ÿäº§ç¯å¢ƒ ConfigMap&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜æ€§&lt;/strong&gt;ï¼šv1.19+ è®¾ç½® &lt;code&gt;immutable: true&lt;/code&gt; é˜²è¯¯æ”¹ &lt;a class="link" href="@ref" &gt;2&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="secret-å¢å¼ºæªæ–½"&gt;&lt;strong&gt;Secret å¢å¼ºæªæ–½&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€å¯†é’¥ç®¡ç†&lt;/strong&gt;ï¼šé›†æˆ &lt;strong&gt;HashiCorp Vault&lt;/strong&gt; æˆ– &lt;strong&gt;Cert-Manager&lt;/strong&gt;ï¼ˆè‡ªåŠ¨è½®æ¢è¯ä¹¦ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¡è®¡ä¸ç›‘æ§&lt;/strong&gt;ï¼šå¯ç”¨ API Server å®¡è®¡æ—¥å¿—ï¼Œè¿½è¸ªå¼‚å¸¸è®¿é—®&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•œåƒæ‹‰å–å®‰å…¨&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;imagePullSecrets&lt;/code&gt; é¿å…é•œåƒæ³„éœ² &lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ›´æ–°ç­–ç•¥ä¼˜åŒ–"&gt;&lt;strong&gt;æ›´æ–°ç­–ç•¥ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;èµ„æº&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ›´æ–°æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç”Ÿæ•ˆæ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åæ»šåŠ¨é‡å¯ Pod&lt;/td&gt;
&lt;td&gt;ç¯å¢ƒå˜é‡éœ€é‡å¯ï¼Œå·æŒ‚è½½è‡ªåŠ¨ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Secret&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…ç›´æ¥æ›´æ–°ï¼Œæ¨èé‡å»ºï¼ˆé˜²å†å²è®°å½•æ®‹ç•™ï¼‰&lt;/td&gt;
&lt;td&gt;å·æŒ‚è½½è‡ªåŠ¨åŒæ­¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ç»ˆæå¯¹æ¯”æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;ç»ˆæå¯¹æ¯”æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Secret&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ•æ„Ÿæ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éæ•æ„Ÿ&lt;/td&gt;
&lt;td&gt;æ•æ„Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨å®‰å…¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜æ–‡å­˜å‚¨ï¼Œæ— åŠ å¯†&lt;/td&gt;
&lt;td&gt;Base64 + æ”¯æŒ etcd åŠ å¯†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çƒ­æ›´æ–°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å·æŒ‚è½½æ”¯æŒ&lt;/td&gt;
&lt;td&gt;åŒ ConfigMap&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿäº§ä¼˜å…ˆçº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®åˆ†ç¦»ã€åŠ¨æ€æ›´æ–°&lt;/td&gt;
&lt;td&gt;åŠ å¯†å­˜å‚¨ã€æœ€å°æƒé™ã€å®¡è®¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å†³ç­–æ ‘&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;æ˜¯å¦éœ€è¦ä¿å¯†ï¼Ÿâ€‹&lt;/strong&gt;â€‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt; â†’ ç”¨ &lt;strong&gt;Secret&lt;/strong&gt;ï¼ˆå¯ç”¨åŠ å¯† + RBACï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦&lt;/strong&gt; â†’ ç”¨ &lt;strong&gt;ConfigMap&lt;/strong&gt;ï¼ˆæŒ‚è½½çƒ­æ›´æ–° + ç¯å¢ƒå˜é‡ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;
é€šè¿‡ç²¾å‡†åŒºåˆ†ä¸¤è€…ç‰¹æ€§ï¼Œå¯æ„å»º&lt;strong&gt;å®‰å…¨ã€çµæ´»ã€å¯ç»´æŠ¤&lt;/strong&gt;çš„ Kubernetes é…ç½®ä½“ç³»ï¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="controller-manager"&gt;Controller Manager
&lt;/h2&gt;&lt;p&gt;Controller Manager æ˜¯ Kubernetes æ§åˆ¶å¹³é¢çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£é€šè¿‡ &lt;strong&gt;æ§åˆ¶å¾ªç¯ï¼ˆControl Loopï¼‰&lt;/strong&gt; æŒç»­ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œå¹¶é©±åŠ¨å®é™…çŠ¶æ€å‘ç”¨æˆ·å®šä¹‰çš„æœŸæœ›çŠ¶æ€æ”¶æ•›ã€‚å…¶è®¾è®¡ç†å¿µåŸºäºâ€œå£°æ˜å¼ APIâ€ï¼Œç”¨æˆ·åªéœ€å®šä¹‰ç›®æ ‡çŠ¶æ€ï¼ŒController Manager è‡ªåŠ¨æ‰§è¡Œè°ƒè°ï¼ˆReconcileï¼‰æ“ä½œã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒåŸç†ã€åŠŸèƒ½ä¸å®è·µçš„å…¨é¢è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŸç†ä¸æ¶æ„"&gt;æ ¸å¿ƒåŸç†ä¸æ¶æ„
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶å¾ªç¯æœºåˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬çŠ¶æ€&lt;/strong&gt;ï¼šé€šè¿‡ API Server çš„ Watch æœºåˆ¶å®æ—¶ç›‘å¬èµ„æºï¼ˆå¦‚ Podã€Nodeã€Serviceï¼‰çš„å˜æ›´äº‹ä»¶ï¼ˆåˆ›å»º/æ›´æ–°/åˆ é™¤ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€å¯¹æ¯”&lt;/strong&gt;ï¼šå°†èµ„æºçš„&lt;strong&gt;å½“å‰çŠ¶æ€&lt;/strong&gt;ï¼ˆ&lt;code&gt;status&lt;/code&gt;ï¼‰ä¸&lt;strong&gt;æœŸæœ›çŠ¶æ€&lt;/strong&gt;ï¼ˆ&lt;code&gt;spec&lt;/code&gt;ï¼‰è¿›è¡Œå·®å¼‚åˆ†æ&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œè°ƒè°&lt;/strong&gt;ï¼šæ ¹æ®å·®å¼‚è§¦å‘æ“ä½œï¼ˆå¦‚åˆ›å»º/åˆ é™¤ Podã€æ›´æ–° Endpointï¼‰ï¼Œä½¿é›†ç¾¤çŠ¶æ€è¶‹è¿‘æœŸæœ›å€¼&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–ç»“æœ&lt;/strong&gt;ï¼šè°ƒè°ç»“æœé€šè¿‡ API Server å†™å…¥ etcdï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—åŒ–æ§åˆ¶å™¨è®¾è®¡&lt;/strong&gt;
Controller Manager ç”±å¤šä¸ªç‹¬ç«‹æ§åˆ¶å™¨ç»„æˆï¼Œæ¯ä¸ªæ§åˆ¶å™¨ä¸“æ³¨ç‰¹å®šèµ„æºç±»å‹ï¼š
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ§åˆ¶å™¨ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹æ§åˆ¶å™¨&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å·¥ä½œè´Ÿè½½ç®¡ç†&lt;/td&gt;
&lt;td&gt;ç¡®ä¿ Pod å‰¯æœ¬æ•°ç¬¦åˆé¢„æœŸï¼Œæ”¯æŒæ»šåŠ¨æ›´æ–°&lt;/td&gt;
&lt;td&gt;Deploymentã€StatefulSet&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èŠ‚ç‚¹ç®¡ç†&lt;/td&gt;
&lt;td&gt;ç›‘æ§èŠ‚ç‚¹å¥åº·ï¼Œå¤„ç†èŠ‚ç‚¹æ•…éšœï¼ˆå¦‚æ ‡è®° &lt;code&gt;NotReady&lt;/code&gt; å¹¶é©±é€ Podï¼‰&lt;/td&gt;
&lt;td&gt;NodeController&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡å‘ç°&lt;/td&gt;
&lt;td&gt;ç»´æŠ¤ Service ä¸åç«¯ Pod çš„æ˜ å°„å…³ç³»&lt;/td&gt;
&lt;td&gt;EndpointController&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­˜å‚¨ç®¡ç†&lt;/td&gt;
&lt;td&gt;ç»‘å®š PV/PVCï¼Œå¤„ç†å­˜å‚¨å·ç”Ÿå‘½å‘¨æœŸ&lt;/td&gt;
&lt;td&gt;PersistentVolumeController&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èµ„æºé…é¢&lt;/td&gt;
&lt;td&gt;é™åˆ¶ Namespace èµ„æºä½¿ç”¨é‡ï¼ˆå¦‚ CPUã€å†…å­˜ã€Pod æ•°é‡ï¼‰&lt;/td&gt;
&lt;td&gt;ResourceQuotaController&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ§åˆ¶å™¨è¯¦è§£"&gt;å…³é”®æ§åˆ¶å™¨è¯¦è§£
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Node Controller&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœå¤„ç†&lt;/strong&gt;ï¼šå®šæœŸæ£€æŸ¥èŠ‚ç‚¹å¿ƒè·³ï¼Œå¤±è”è¶…æ—¶ï¼ˆé»˜è®¤ 5 åˆ†é’Ÿï¼‰åæ ‡è®°ä¸º &lt;code&gt;NotReady&lt;/code&gt;ï¼Œå¹¶é©±é€å…¶ä¸Š Pod&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®å‚æ•°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--node-monitor-grace-period=40s&lt;/code&gt;ï¼ˆèŠ‚ç‚¹å¤±è”å®½é™æœŸï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--pod-eviction-timeout=5m&lt;/code&gt;ï¼ˆPod é©±é€è¶…æ—¶ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Deployment Controller&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ»šåŠ¨æ›´æ–°&lt;/strong&gt;ï¼šåˆ›å»ºæ–° ReplicaSet å¹¶é€æ­¥æ›¿æ¢æ—§ Podï¼Œæ”¯æŒå‚æ•° &lt;code&gt;maxSurge&lt;/code&gt;ï¼ˆæœ€å¤§æ–°å¢å‰¯æœ¬æ¯”ä¾‹ï¼‰å’Œ &lt;code&gt;maxUnavailable&lt;/code&gt;ï¼ˆæœ€å¤§ä¸å¯ç”¨æ¯”ä¾‹ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›æ»šæœºåˆ¶&lt;/strong&gt;ï¼šåˆ‡æ¢è‡³å†å² ReplicaSet ç‰ˆæœ¬æ¢å¤åº”ç”¨çŠ¶æ€&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Endpoint Controller&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ï¼šç›‘å¬ Service çš„ &lt;code&gt;selector&lt;/code&gt; å˜åŒ–ï¼ŒåŠ¨æ€æ›´æ–° Endpoint å¯¹è±¡ä¸­çš„ Pod IP åˆ—è¡¨ï¼Œä¸º kube-proxy æä¾›è´Ÿè½½å‡è¡¡ä¾æ®&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ResourceQuota Controller&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¤šçº§é™åˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;å®¹å™¨çº§ï¼šé™åˆ¶ CPU/å†…å­˜ï¼›&lt;/li&gt;
&lt;li&gt;Namespace çº§ï¼šé™åˆ¶ Pod æ•°é‡ã€Service æ•°é‡ç­‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é«˜å¯ç”¨ä¸æ€§èƒ½ä¼˜åŒ–"&gt;é«˜å¯ç”¨ä¸æ€§èƒ½ä¼˜åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨éƒ¨ç½²&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Leader Election æœºåˆ¶&lt;/strong&gt;ï¼šå¤šå®ä¾‹è¿è¡Œæ—¶ï¼Œé€šè¿‡ etcd åˆ†å¸ƒå¼é”é€‰ä¸¾ä¸»å®ä¾‹ï¼ˆLeaderï¼‰ï¼Œå¤‡å®ä¾‹ï¼ˆFollowerï¼‰çƒ­å¤‡ï¼Œä¸»æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®å‚æ•°ï¼š&lt;code&gt;--leader-elect=true&lt;/code&gt; å¯ç”¨é€‰ä¸¾&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è°ƒä¼˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¹¶å‘æ§åˆ¶ï¼šæ ¹æ®é›†ç¾¤è§„æ¨¡è°ƒæ•´æ§åˆ¶å™¨å¹¶å‘æ•°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--concurrent-deployment-syncs=10&lt;/code&gt;ï¼ˆå¢å¤§ Deployment å¤„ç†å¹¶å‘ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--concurrent-service-syncs=5&lt;/code&gt;ï¼ˆService åŒæ­¥å¹¶å‘ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;èµ„æºé™åˆ¶ï¼šé¿å…èµ„æºç«äº‰ï¼Œä¸ºå®¹å™¨è®¾ç½®åˆç†èµ„æºé…é¢ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;resources:
requests: { cpu: &amp;#34;100m&amp;#34;, memory: &amp;#34;256Mi&amp;#34; }
limits: { cpu: &amp;#34;2&amp;#34;, memory: &amp;#34;2Gi&amp;#34; }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;ç›‘æ§æŒ‡æ ‡ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kube_controller_manager_reconcile_duration_seconds&lt;/code&gt;ï¼ˆè°ƒè°å»¶è¿Ÿï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kube_controller_manager_event_queue_depth&lt;/code&gt;ï¼ˆäº‹ä»¶é˜Ÿåˆ—æ·±åº¦ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•ä¸å®šåˆ¶åŒ–"&gt;æ‰©å±•ä¸å®šåˆ¶åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼ˆCustom Controllerï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘æµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;å®šä¹‰ CRDï¼ˆCustom Resource Definitionï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;client-go&lt;/code&gt; åº“ç¼–å†™è°ƒè°é€»è¾‘ï¼›&lt;/li&gt;
&lt;li&gt;æ³¨å†Œæ§åˆ¶å™¨å¹¶ç›‘å¬äº‹ä»¶ï¼ˆç¤ºä¾‹ä»£ç è§&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè‡ªåŠ¨åŒ–ç®¡ç†æ•°æ®åº“é›†ç¾¤ã€ä¸­é—´ä»¶æ‰©ç¼©å®¹ç­‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘å‚å•†é›†æˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cloud Controller Manager (CCM)&lt;/strong&gt;ï¼šå¯¹æ¥äº‘å¹³å° APIï¼Œè‡ªåŠ¨åŒ–ç®¡ç†äº‘èµ„æºï¼ˆå¦‚ AWS ELB è´Ÿè½½å‡è¡¡å™¨ã€GCP å­˜å‚¨å·ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ•…éšœæ’æŸ¥ä¸å®‰å…¨å®è·µ"&gt;æ•…éšœæ’æŸ¥ä¸å®‰å…¨å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ’æŸ¥æµç¨‹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—åˆ†æ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;kubectl logs&lt;/code&gt; æŸ¥çœ‹æ§åˆ¶å™¨é”™è¯¯ï¼ˆå¦‚ &lt;code&gt;&amp;quot;reconcile error&amp;quot;&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶è¿½æº¯&lt;/strong&gt;ï¼š&lt;code&gt;kubectl get events&lt;/code&gt; å®šä½å¼‚å¸¸æ“ä½œï¼ˆå¦‚ Pod åˆ›å»ºå¤±è´¥ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨åŠ å›º&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ€å°æƒé™&lt;/strong&gt;ï¼šä¸º Controller Manager åˆ†é…ä¸“ç”¨ ServiceAccountï¼Œé™åˆ¶ RBAC æƒé™ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿¡åŠ å¯†&lt;/strong&gt;ï¼šå¯ç”¨ TLS è¯ä¹¦è®¤è¯ï¼ˆ&lt;code&gt;--etcd-cafile&lt;/code&gt;ã€&lt;code&gt;--client-ca-file&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–ç»„ä»¶çš„åä½œ"&gt;ä¸å…¶ä»–ç»„ä»¶çš„åä½œ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;API Server&lt;/strong&gt;ï¼šæ‰€æœ‰çŠ¶æ€å˜æ›´çš„å…¥å£ï¼Œæ§åˆ¶å™¨é€šè¿‡ Watch/List æœºåˆ¶ç›‘å¬èµ„æº&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;etcd&lt;/strong&gt;ï¼šå­˜å‚¨é›†ç¾¤çŠ¶æ€æ•°æ®ï¼Œæ§åˆ¶å™¨è¯»å–/æ›´æ–°çŠ¶æ€&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Scheduler&lt;/strong&gt;ï¼šController Manager åˆ›å»º Pod åï¼Œç”± Scheduler ç»‘å®šèŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Controller Manager æ˜¯ Kubernetes é›†ç¾¤çš„â€œè‡ªåŠ¨åŒ–å¼•æ“â€ï¼Œé€šè¿‡è§£è€¦çš„æ§åˆ¶å™¨å®ç°èµ„æºçŠ¶æ€çš„è‡ªæ„ˆä¸é—­ç¯ç®¡ç†ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼è¿ç»´&lt;/strong&gt;ï¼šç”¨æˆ·å®šä¹‰ç›®æ ‡çŠ¶æ€ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨ä¿éšœ&lt;/strong&gt;ï¼šå¤šå®ä¾‹ + Leader Election æœºåˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ‰©å±•&lt;/strong&gt;ï¼šæ”¯æŒè‡ªå®šä¹‰æ§åˆ¶å™¨ä¸äº‘å¹³å°é›†æˆã€‚
æ·±å…¥ç†è§£å…¶åŸç†åŠæœ€ä½³å®è·µï¼ˆå¦‚æ€§èƒ½è°ƒä¼˜ã€å®‰å…¨é…ç½®ï¼‰ï¼Œæ˜¯æ„å»ºç¨³å®šã€é«˜æ•ˆ Kubernetes é›†ç¾¤çš„å…³é”®&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="controller"&gt;Controller
&lt;/h2&gt;&lt;p&gt;Kubernetes æ§åˆ¶å™¨æ˜¯ç¡®ä¿é›†ç¾¤å®é™…çŠ¶æ€ä¸ç”¨æˆ·æœŸæœ›çŠ¶æ€ä¸€è‡´çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡æŒç»­ç›‘æ§å’Œè°ƒè°å®ç°åº”ç”¨çš„è‡ªåŠ¨åŒ–ç®¡ç†ã€‚ä»¥ä¸‹å¯¹ &lt;strong&gt;Deployment&lt;/strong&gt; åŠå…¶ä»–å…³é”®æ§åˆ¶å™¨çš„åŸç†ã€åŠŸèƒ½åŠå®è·µåœºæ™¯è¿›è¡Œç³»ç»Ÿè§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ§åˆ¶å™¨ç±»å‹åŠä½œç”¨æ¦‚è§ˆ"&gt;ğŸ”§ &lt;strong&gt;æ ¸å¿ƒæ§åˆ¶å™¨ç±»å‹åŠä½œç”¨æ¦‚è§ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ§åˆ¶å™¨ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒèƒ½åŠ›&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹åº”ç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— çŠ¶æ€åº”ç”¨ï¼ˆWebæœåŠ¡ç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;æ»šåŠ¨æ›´æ–°ã€å›æ»šã€æ‰©ç¼©å®¹ã€å¤šå‰¯æœ¬ç®¡ç†&lt;/td&gt;
&lt;td&gt;Nginxã€å¾®æœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ‰çŠ¶æ€åº”ç”¨ï¼ˆæ•°æ®åº“ç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;ç¨³å®šç½‘ç»œæ ‡è¯†ï¼ˆPodåç§°/IPï¼‰ã€æŒä¹…åŒ–å­˜å‚¨ã€æœ‰åºéƒ¨ç½²&lt;/td&gt;
&lt;td&gt;MySQLã€Redisã€Zookeeper&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;DaemonSet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹çº§å®ˆæŠ¤è¿›ç¨‹&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªPodå‰¯æœ¬ï¼ŒèŠ‚ç‚¹æ‰©ç¼©æ—¶è‡ªåŠ¨è°ƒæ•´&lt;/td&gt;
&lt;td&gt;æ—¥å¿—æ”¶é›†ï¼ˆFluentdï¼‰ã€ç›‘æ§ä»£ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Job&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€æ¬¡æ€§ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;ç¡®ä¿ä»»åŠ¡å®Œæˆå³ç»ˆæ­¢ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;æ•°æ®è¿ç§»ã€æ‰¹å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CronJob&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šæ—¶ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;åŸºäºCronè¡¨è¾¾å¼å‘¨æœŸæ€§è¿è¡ŒJob&lt;/td&gt;
&lt;td&gt;æ¯æ—¥å¤‡ä»½ã€å®šæ—¶æŠ¥å‘Š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-deployment-æ§åˆ¶å™¨è¯¦è§£"&gt;ğŸš€ &lt;strong&gt;Deployment æ§åˆ¶å™¨è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåŸç†"&gt;&lt;strong&gt;æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å±‚çº§ç®¡ç†&lt;/strong&gt;ï¼š
Deployment â†’ ReplicaSet â†’ Podï¼Œé€šè¿‡æ§åˆ¶ ReplicaSet é—´æ¥ç®¡ç† Pod å‰¯æœ¬&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼æ›´æ–°&lt;/strong&gt;ï¼š
ç”¨æˆ·å®šä¹‰ç›®æ ‡çŠ¶æ€ï¼ˆå¦‚é•œåƒç‰ˆæœ¬ã€å‰¯æœ¬æ•°ï¼‰ï¼Œæ§åˆ¶å™¨è‡ªåŠ¨é©±åŠ¨é›†ç¾¤å‘ç›®æ ‡çŠ¶æ€è¿ç§»&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ ¸å¿ƒåŠŸèƒ½"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ»šåŠ¨æ›´æ–°ï¼ˆRollingUpdateï¼‰ï¼š
é€æ­¥æ›¿æ¢æ—§ Podï¼Œé€šè¿‡å‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; maxSurge
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼ˆæœ€å¤§æ–°å¢å‰¯æœ¬æ¯”ä¾‹ï¼‰å’Œ&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; maxUnavailable
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼ˆæœ€å¤§ä¸å¯ç”¨æ¯”ä¾‹ï¼‰æ§åˆ¶æ›´æ–°èŠ‚å¥
1,8
ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;strategy:
type: RollingUpdate
rollingUpdate:
maxSurge: 25%
maxUnavailable: 25%
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ç‰ˆæœ¬å›æ»šï¼š
ä¿å­˜å†å² ReplicaSet è®°å½•ï¼Œæ”¯æŒä¸€é”®å›é€€åˆ°ä»»æ„ç‰ˆæœ¬ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl rollout undo deployment/nginx --to-revision=2 # å›æ»šåˆ°ç‰ˆæœ¬2[3,5](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å‰¯æœ¬æ‰©ç¼©å®¹ï¼š
åŠ¨æ€è°ƒæ•´ Pod æ•°é‡ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl scale deployment/nginx --replicas=5 # æ‰©å®¹åˆ°5å‰¯æœ¬[2,5](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼š
é›†æˆ &lt;code&gt;LivenessProbe&lt;/code&gt; å’Œ &lt;code&gt;ReadinessProbe&lt;/code&gt;ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨æ€§&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®æˆ˜æ“ä½œæµç¨‹"&gt;&lt;strong&gt;å®æˆ˜æ“ä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;åˆ›å»º Deploymentï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: apps/v1
kind: Deployment
metadata:
name: nginx-deploy
spec:
replicas: 3
selector:
matchLabels:
app: nginx
template:
metadata:
labels:
app: nginx
spec:
containers:
- name: nginx
image: nginx:1.19
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl apply -f deploy.yaml # éƒ¨ç½²[2,5](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æ›´æ–°é•œåƒï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl set image deployment/nginx-deploy nginx=nginx:1.20 # è§¦å‘æ»šåŠ¨æ›´æ–°[3,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;ç›‘æ§ä¸å›æ»šï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl rollout status deployment/nginx-deploy # æŸ¥çœ‹æ›´æ–°çŠ¶æ€
kubectl rollout history deployment/nginx-deploy # æŸ¥çœ‹å†å²ç‰ˆæœ¬
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¶ä»–æ§åˆ¶å™¨æ·±åº¦è§£æ"&gt;ğŸ“¦ &lt;strong&gt;å…¶ä»–æ§åˆ¶å™¨æ·±åº¦è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="statefulsetæœ‰çŠ¶æ€åº”ç”¨ç®¡ç†"&gt;&lt;strong&gt;StatefulSetï¼šæœ‰çŠ¶æ€åº”ç”¨ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒç‰¹æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¨³å®šç½‘ç»œæ ‡è¯†&lt;/strong&gt;ï¼šPod åç§°å›ºå®šï¼ˆå¦‚ &lt;code&gt;mysql-0&lt;/code&gt;ã€&lt;code&gt;mysql-1&lt;/code&gt;ï¼‰ï¼ŒDNS è§£æä¸å˜&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–å­˜å‚¨&lt;/strong&gt;ï¼šPod é‡å¯åä»æŒ‚è½½ç›¸åŒ PersistentVolumeï¼ˆPVC ç»‘å®šï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰åºæ“ä½œ&lt;/strong&gt;ï¼š
éƒ¨ç½²/æ‰©å±•æ—¶æŒ‰åºæ‰§è¡Œï¼ˆå¦‚å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œå†å¯åŠ¨ä»èŠ‚ç‚¹ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="daemonsetèŠ‚ç‚¹çº§å®ˆæŠ¤è¿›ç¨‹"&gt;&lt;strong&gt;DaemonSetï¼šèŠ‚ç‚¹çº§å®ˆæŠ¤è¿›ç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒåœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰èŠ‚ç‚¹è¿è¡Œæ—¥å¿—æ”¶é›†å™¨ï¼ˆFluentdï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ç›‘æ§ä»£ç†ï¼ˆPrometheus Node Exporterï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨æ‰©æ•£&lt;/strong&gt;ï¼š
æ–°å¢èŠ‚ç‚¹æ—¶è‡ªåŠ¨éƒ¨ç½² Podï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="jobcronjobä»»åŠ¡è°ƒåº¦"&gt;&lt;strong&gt;Job/CronJobï¼šä»»åŠ¡è°ƒåº¦&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Jobï¼š
ç¡®ä¿ä¸€æ¬¡æ€§ä»»åŠ¡å®Œæˆï¼ˆå¦‚æ•°æ®æ¸…æ´—ï¼‰ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;completions: 5 # éœ€æˆåŠŸè¿è¡Œ5ä¸ªPod
parallelism: 2 # åŒæ—¶è¿è¡Œ2ä¸ªPod[6,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;CronJobï¼š
å®šæ—¶è§¦å‘ Jobï¼ˆå¦‚æ¯æ—¥2:00å¤‡ä»½æ•°æ®åº“ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;schedule: &amp;#34;0 2 * * *&amp;#34; # Cronè¡¨è¾¾å¼[7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®å¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;âš–ï¸ &lt;strong&gt;å…³é”®å¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;DaemonSet&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Podèº«ä»½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éšæœºï¼ˆæ— çŠ¶æ€ï¼‰&lt;/td&gt;
&lt;td&gt;å›ºå®šï¼ˆæœ‰çŠ¶æ€ï¼‰&lt;/td&gt;
&lt;td&gt;æ¯èŠ‚ç‚¹1ä¸ª&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨å·&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸´æ—¶å·&lt;/td&gt;
&lt;td&gt;æŒä¹…åŒ–å·ï¼ˆPVCï¼‰&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹æœ¬åœ°å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ›´æ–°ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ»šåŠ¨æ›´æ–°ï¼ˆæ— åºï¼‰&lt;/td&gt;
&lt;td&gt;æœ‰åºæ»šåŠ¨æ›´æ–°&lt;/td&gt;
&lt;td&gt;æ»šåŠ¨æ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;WebæœåŠ¡ã€APIç½‘å…³&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹ä»£ç†ã€ç½‘ç»œæ’ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;é€‰å‹åŸåˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ— çŠ¶æ€æœåŠ¡ â†’ &lt;strong&gt;Deployment&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;éœ€æŒä¹…åŒ–æ•°æ®/å›ºå®šæ ‡è¯† â†’ &lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹çº§åå°ä»»åŠ¡ â†’ &lt;strong&gt;DaemonSet&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å®šæ—¶/æ‰¹é‡ä»»åŠ¡ â†’ &lt;strong&gt;Job/CronJob&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—"&gt;ğŸ›¡ï¸ &lt;strong&gt;æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;Deployment ä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;è®¾ç½® &lt;code&gt;revisionHistoryLimit&lt;/code&gt; é™åˆ¶å†å²ç‰ˆæœ¬æ•°é‡ï¼ˆé»˜è®¤10ï¼‰ï¼Œé¿å…etcdå­˜å‚¨å‹åŠ›&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;progressDeadlineSeconds&lt;/code&gt; å®šä¹‰éƒ¨ç½²è¶…æ—¶é˜ˆå€¼ï¼ˆé»˜è®¤600ç§’ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;StatefulSet å­˜å‚¨é…ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;volumeClaimTemplates&lt;/code&gt; åŠ¨æ€åˆ›å»ºPVCï¼Œç¡®ä¿æ¯ä¸ªPodç‹¬ç«‹å­˜å‚¨&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¢é’ˆç²¾ç»†åŒ–é…ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å… &lt;code&gt;LivenessProbe&lt;/code&gt; è¯¯æ€æ…¢å¯åŠ¨åº”ç”¨ï¼ˆå¦‚è®¾ç½® &lt;code&gt;initialDelaySeconds: 30&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ›´æ–°ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒé¿å…ä½¿ç”¨ &lt;code&gt;latest&lt;/code&gt; é•œåƒæ ‡ç­¾ï¼Œæ˜ç¡®æŒ‡å®šç‰ˆæœ¬å·&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Deployment ä½œä¸ºæ— çŠ¶æ€åº”ç”¨çš„&lt;strong&gt;æ ¸å¿ƒç¼–æ’å¼•æ“&lt;/strong&gt;ï¼Œé€šè¿‡æ»šåŠ¨æ›´æ–°ä¸å›æ»šæœºåˆ¶ä¿éšœæœåŠ¡è¿ç»­æ€§ï¼›StatefulSet è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„&lt;strong&gt;èº«ä»½ä¸å­˜å‚¨ç—›ç‚¹&lt;/strong&gt;ï¼›DaemonSet å’Œ Job/CronJob åˆ™å¡«è¡¥äº†&lt;strong&gt;èŠ‚ç‚¹çº§ä»»åŠ¡&lt;/strong&gt;å’Œ&lt;strong&gt;å®šæ—¶è°ƒåº¦&lt;/strong&gt;çš„ç©ºç™½ã€‚æŒæ¡å„æ§åˆ¶å™¨çš„è®¾è®¡å“²å­¦ä¸é€‚ç”¨è¾¹ç•Œï¼Œæ˜¯æ„å»ºé«˜å¯ç”¨ Kubernetes åº”ç”¨çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;h2 id="statefulset"&gt;StatefulSet
&lt;/h2&gt;&lt;p&gt;StatefulSet æ˜¯ Kubernetes ä¸­ä¸“é—¨ç”¨äºç®¡ç†**æœ‰çŠ¶æ€åº”ç”¨ï¼ˆStateful Applicationï¼‰**çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œé€šè¿‡æä¾›ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ã€æŒä¹…åŒ–å­˜å‚¨å’Œæœ‰åºè°ƒåº¦ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—çš„éƒ¨ç½²éš¾é¢˜ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§ã€å·¥ä½œåŸç†ã€å®è·µåœºæ™¯åŠé…ç½®ç¤ºä¾‹å±•å¼€åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒç‰¹æ€§"&gt;ğŸ”‘ &lt;strong&gt;æ ¸å¿ƒç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¨³å®šçš„ç½‘ç»œæ ‡è¯†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å”¯ä¸€ä¸»æœºå&lt;/strong&gt;ï¼šæ¯ä¸ª Pod æŒ‰å›ºå®šåºå·å‘½åï¼ˆå¦‚ &lt;code&gt;mysql-0&lt;/code&gt;ã€&lt;code&gt;mysql-1&lt;/code&gt;ï¼‰ï¼ŒPod é‡å»ºååç§°ä¸å˜&lt;a class="link" href="@ref" &gt;2,6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ– DNS è®°å½•&lt;/strong&gt;ï¼šé€šè¿‡ Headless Serviceï¼ˆ&lt;code&gt;clusterIP: None&lt;/code&gt;ï¼‰ä¸ºæ¯ä¸ª Pod æä¾›ç‹¬ç«‹ DNS åœ°å€ï¼Œæ ¼å¼ä¸ºï¼š
&lt;code&gt;&amp;lt;pod-name&amp;gt;.&amp;lt;svc-name&amp;gt;.&amp;lt;namespace&amp;gt;.svc.cluster.local&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;mysql-0.mysql.default.svc.cluster.local&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥è®¿é—®&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯å¯é€šè¿‡ DNS ç²¾ç¡®è®¿é—®ç‰¹å®š Podï¼Œæ— éœ€è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–å­˜å‚¨ç»‘å®š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹å­˜å‚¨å·ï¼šé€šè¿‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; volumeClaimTemplates
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºæ¯ä¸ª Pod è‡ªåŠ¨åˆ›å»ºä¸“å± PVCï¼Œç»‘å®šç‹¬ç«‹ PV
2,7,8
ã€‚
&lt;code&gt;volumeClaimTemplates: - metadata: name: data spec: accessModes: [ &amp;quot;ReadWriteOnce&amp;quot; ] storageClassName: &amp;quot;ssd&amp;quot; resources: requests: storage: 100Gi&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æŒä¹…åŒ–&lt;/strong&gt;ï¼šPod é‡å»ºåä»æŒ‚è½½åŸ PVï¼Œç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ï¼ˆå¦‚ MySQL çš„ &lt;code&gt;/var/lib/mysql&lt;/code&gt; ç›®å½•ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;æœ‰åºè°ƒåº¦ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¡ºåºåˆ›å»º&lt;/strong&gt;ï¼šæŒ‰ç´¢å¼•é€’å¢å¯åŠ¨ Podï¼ˆ&lt;code&gt;pod-0 â†’ pod-1&lt;/code&gt;ï¼‰ï¼Œå‰ä¸€ä¸ª Pod å°±ç»ªåæ‰è°ƒåº¦ä¸‹ä¸€ä¸ª&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€†åºåˆ é™¤&lt;/strong&gt;ï¼šç¼©å®¹æ—¶æŒ‰ç´¢å¼•é€’å‡ç»ˆæ­¢ï¼ˆ&lt;code&gt;pod-1 â†’ pod-0&lt;/code&gt;ï¼‰ï¼Œé¿å…ä¸»èŠ‚ç‚¹ä¼˜å…ˆè¢«åˆ &lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰åºæ»šåŠ¨æ›´æ–°&lt;/strong&gt;ï¼šé»˜è®¤ç­–ç•¥ &lt;code&gt;RollingUpdate&lt;/code&gt; æŒ‰åå‘é¡ºåºæ›´æ–° Pod&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å·¥ä½œåŸç†"&gt;âš™ï¸ &lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Pod æ ‡è¯†ç®¡ç†&lt;/strong&gt;
StatefulSet ä¸ºæ¯ä¸ª Pod åˆ†é…å”¯ä¸€åºå·ï¼ˆå¦‚ &lt;code&gt;redis-0&lt;/code&gt;ï¼‰ï¼Œé€šè¿‡ Controller ç»´æŠ¤ Pod åç§°ä¸çŠ¶æ€çš„æ˜ å°„å…³ç³»ã€‚Pod é‡å»ºåï¼ŒKubernetes åŸºäºç›¸åŒæ ‡è¯†ç¬¦é‡æ–°åˆ›å»ºå¹¶ç»‘å®šåŸæœ‰å­˜å‚¨&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨åŠ¨æ€ç»‘å®š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;volumeClaimTemplates&lt;/code&gt; ç”Ÿæˆ PVCï¼ˆå¦‚ &lt;code&gt;data-redis-0&lt;/code&gt;ï¼‰ï¼ŒPV ç”± StorageClass åŠ¨æ€ä¾›ç»™æˆ–ç®¡ç†å‘˜é¢„å…ˆåˆ›å»º&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åˆ é™¤ StatefulSet æ—¶ï¼Œå…³è”çš„ PVC/PV &lt;strong&gt;é»˜è®¤ä¸åˆ é™¤&lt;/strong&gt;ï¼Œéœ€æ‰‹åŠ¨æ¸…ç†ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ Headless Service åä½œ&lt;/strong&gt;
Headless Service æä¾› DNS è§£æèƒ½åŠ›ï¼Œä½¿ Pod å¯é€šè¿‡å›ºå®šåŸŸåç›´æ¥é€šä¿¡ã€‚è‹¥æœªåˆ›å»ºï¼ŒStatefulSet å°†æ— æ³•å·¥ä½œ&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;ğŸ§© &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“é›†ç¾¤&lt;/strong&gt;ï¼ˆå¦‚ MySQL ä¸»ä»ã€MongoDB åˆ†ç‰‡ï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸»èŠ‚ç‚¹å›ºå®š&lt;/strong&gt;ï¼šé€šè¿‡åºå· &lt;code&gt;pod-0&lt;/code&gt; ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹é…ç½®è¿æ¥åœ°å€ä¸º &lt;code&gt;redis-0.redis-svc&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®éš”ç¦»&lt;/strong&gt;ï¼šæ¯ä¸ª Pod ç‹¬ç«‹å­˜å‚¨ï¼Œé¿å…æ•°æ®å†²çª&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/strong&gt;ï¼ˆå¦‚ ZooKeeperã€Kafkaï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æˆå‘˜å‘ç°&lt;/strong&gt;ï¼šPod é€šè¿‡ DNS è®°å½•è¯†åˆ«é›†ç¾¤èŠ‚ç‚¹ï¼ˆå¦‚ &lt;code&gt;zk-0.zk-svc&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–å…ƒæ•°æ®&lt;/strong&gt;ï¼šç¡®ä¿èŠ‚ç‚¹é‡å¯åé›†ç¾¤çŠ¶æ€ä¸€è‡´&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/strong&gt;ï¼ˆå¦‚ RabbitMQï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é˜Ÿåˆ—æŒä¹…åŒ–&lt;/strong&gt;ï¼šæ¶ˆæ¯æ•°æ®å­˜å‚¨äºç‹¬ç«‹ PVï¼Œé¿å…å›  Pod é‡å»ºä¸¢å¤±&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®é…ç½®ä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å…³é”®é…ç½®ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°ç­–ç•¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;RollingUpdate&lt;/code&gt;ï¼šé»˜è®¤é¡ºåºæ»šåŠ¨æ›´æ–°ï¼ˆä»æœ€å¤§ç´¢å¼•å¼€å§‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;OnDelete&lt;/code&gt;ï¼šéœ€æ‰‹åŠ¨åˆ é™¤ Pod è§¦å‘æ›´æ–°ï¼Œé€‚ç”¨äºéœ€ä¸¥æ ¼æ§åˆ¶å˜æ›´çš„åœºæ™¯&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pod ç®¡ç†ç­–ç•¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;OrderedReady&lt;/code&gt;ï¼šé»˜è®¤é¡ºåºè°ƒåº¦ï¼ˆæ¨èæœ‰çŠ¶æ€åº”ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Parallel&lt;/code&gt;ï¼šå¹¶è¡Œåˆ›å»º/åˆ é™¤ï¼ˆç‰ºç‰²æœ‰åºæ€§ï¼Œæé«˜é€Ÿåº¦ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºé¢„ç•™&lt;/strong&gt;ï¼šä¸º Pod è®¾ç½®åˆç†çš„ CPU/å†…å­˜é™åˆ¶ï¼Œé¿å…è°ƒåº¦å¤±è´¥&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å¤‡ä»½&lt;/strong&gt;ï¼šå®šæœŸå¤‡ä»½ PV æ•°æ®ï¼ˆå¦‚ä½¿ç”¨ Veleroï¼‰ï¼Œé˜²æ­¢å­˜å‚¨æ•…éšœ&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜é›…ç»ˆæ­¢&lt;/strong&gt;ï¼šé…ç½® &lt;code&gt;terminationGracePeriodSeconds&lt;/code&gt; ç¡®ä¿æ…¢ç»ˆæ­¢åº”ç”¨å®Œæˆæ¸…ç†&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸-deployment-çš„æ ¸å¿ƒå·®å¼‚"&gt;ğŸ†š &lt;strong&gt;ä¸ Deployment çš„æ ¸å¿ƒå·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç½‘ç»œæ ‡è¯†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®š DNS åç§°ï¼ˆå¦‚ &lt;code&gt;web-0&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;éšæœºåç§°ï¼ˆå¦‚ &lt;code&gt;web-5f76b&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨ç»‘å®š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª Pod ç‹¬ç«‹ PV&lt;/td&gt;
&lt;td&gt;å…±äº«ä¸´æ—¶å·æˆ–æ— æŒä¹…å­˜å‚¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©ç¼©å®¹é¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¡ºåºåˆ›å»º/é€†åºåˆ é™¤&lt;/td&gt;
&lt;td&gt;å¹¶è¡Œæ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼å­˜å‚¨&lt;/td&gt;
&lt;td&gt;Web æœåŠ¡ã€API ç½‘å…³ç­‰æ— çŠ¶æ€åº”ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;é€‰å‹å…¬å¼&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;StatefulSet â‡” éœ€ç¨³å®šç½‘ç»œæ ‡è¯† + æŒä¹…åŒ–å­˜å‚¨ + æœ‰åºè°ƒåº¦&lt;/strong&gt;â€‹&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å®Œæ•´ç¤ºä¾‹mysql-ä¸»ä»é›†ç¾¤"&gt;ğŸ“ &lt;strong&gt;å®Œæ•´ç¤ºä¾‹ï¼šMySQL ä¸»ä»é›†ç¾¤&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# Headless Service
apiVersion: v1
kind: Service
metadata:
name: mysql
spec:
clusterIP: None
selector:
app: mysql
ports:
- port: 3306
---
# StatefulSet
apiVersion: apps/v1
kind: StatefulSet
metadata:
name: mysql
spec:
serviceName: &amp;#34;mysql&amp;#34;
replicas: 3
selector:
matchLabels:
app: mysql
template:
metadata:
labels:
app: mysql
spec:
containers:
- name: mysql
image: mysql:5.7
env:
- name: MYSQL_ROOT_PASSWORD
value: &amp;#34;password&amp;#34;
volumeMounts:
- name: data
mountPath: /var/lib/mysql
volumeClaimTemplates:
- metadata:
name: data
spec:
accessModes: [ &amp;#34;ReadWriteOnce&amp;#34; ]
storageClassName: &amp;#34;ssd&amp;#34;
resources:
requests:
storage: 50Gi
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ“ä½œéªŒè¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl exec mysql-0 -- mysql -uroot -ppassword -e &amp;#34;SHOW SLAVE HOSTS&amp;#34; # æŸ¥çœ‹ä»èŠ‚ç‚¹
kubectl delete pod mysql-1 # é‡å»ºåä»ç»‘å®šåŸæ•°æ®å·
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;StatefulSet æ˜¯ Kubernetes ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„&lt;strong&gt;åŸºçŸ³çº§æ§åˆ¶å™¨&lt;/strong&gt;ï¼Œé€šè¿‡ä¸‰ä½ä¸€ä½“çš„&lt;strong&gt;ç¨³å®šæ ‡è¯†&lt;/strong&gt;ï¼ˆç½‘ç»œï¼‰ã€&lt;strong&gt;æŒä¹…å­˜å‚¨&lt;/strong&gt;ï¼ˆPV/PVCï¼‰ä¸&lt;strong&gt;æœ‰åºè°ƒåº¦&lt;/strong&gt;ï¼ˆé¡ºåºå¯åœï¼‰è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚å…¶è®¾è®¡å°¤å…¶é€‚ç”¨äºæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰éœ€æ•°æ®æŒä¹…åŒ–ä¸æ‹“æ‰‘ç¨³å®šçš„åœºæ™¯ï¼Œä½†éœ€æ³¨æ„è¿ç»´å¤æ‚åº¦ä¸å­˜å‚¨æˆæœ¬&lt;a class="link" href="@ref" &gt;2,5,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="replicaset"&gt;ReplicaSet
&lt;/h2&gt;&lt;p&gt;ReplicaSet æ˜¯ Kubernetes ä¸­ç”¨äºä¿éšœæ— çŠ¶æ€åº”ç”¨é«˜å¯ç”¨çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œå…¶æ ¸å¿ƒä½¿å‘½æ˜¯&lt;strong&gt;ç¡®ä¿æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬æŒç»­è¿è¡Œ&lt;/strong&gt;ã€‚å°½ç®¡å®é™…ç”Ÿäº§ç¯å¢ƒä¸­é€šå¸¸ç”±æ›´é«˜å±‚çš„ Deployment ç®¡ç† ReplicaSetï¼Œä½†ç†è§£å…¶åŸç†å¯¹æŒæ¡ Kubernetes ç¼–æ’æœºåˆ¶è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯æ·±åº¦è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½ä¸å·¥ä½œåŸç†"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç²¾ç¡®å‰¯æœ¬ç»´æŠ¤&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡ &lt;code&gt;replicas&lt;/code&gt; å­—æ®µè®¾å®šæœŸæœ›çš„ Pod æ•°é‡ï¼ˆå¦‚ &lt;code&gt;replicas: 3&lt;/code&gt;ï¼‰ï¼ŒReplicaSet æŒç»­ç›‘æ§å®é™…è¿è¡ŒçŠ¶æ€ï¼Œé€šè¿‡&lt;strong&gt;åˆ›å»º/åˆ é™¤ Pod&lt;/strong&gt; ç¡®ä¿å®é™…æ•°é‡ä¸æœŸæœ›ä¸€è‡´&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœè‡ªæ„ˆ&lt;/strong&gt;ï¼šå½“ Pod å› èŠ‚ç‚¹æ•…éšœã€èµ„æºä¸è¶³æˆ–äººä¸ºåˆ é™¤ç»ˆæ­¢æ—¶ï¼ŒReplicaSet åœ¨çº¦ 30 ç§’å†…è‡ªåŠ¨é‡å»ºæ–° Podï¼ˆç”± &lt;code&gt;kube-controller-manager&lt;/code&gt; çš„è°ƒå’Œå¾ªç¯é©±åŠ¨ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆSelectorï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;matchLabels&lt;/code&gt; æˆ– &lt;code&gt;matchExpressions&lt;/code&gt; é€‰æ‹©ç®¡ç†çš„ Podã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;selector.matchLabels: app=nginx&lt;/code&gt;ä¼šç®¡ç†æ‰€æœ‰å¸¦ &lt;code&gt;app: nginx&lt;/code&gt; æ ‡ç­¾çš„ Pod&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€åŒ¹é…&lt;/strong&gt;ï¼šå³ä½¿ Pod åœ¨ ReplicaSet åˆ›å»ºåç”Ÿæˆï¼Œåªè¦æ ‡ç­¾åŒ¹é…å³çº³å…¥ç®¡ç†èŒƒå›´&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pod æ¨¡æ¿ï¼ˆTemplateï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰æ–° Pod çš„åˆ›å»ºè§„èŒƒï¼ˆå®¹å™¨é•œåƒã€èµ„æºé™åˆ¶ã€æ¢é’ˆç­‰ï¼‰ã€‚æ¨¡æ¿æ›´æ–°åï¼Œ&lt;strong&gt;ä¸ä¼šè‡ªåŠ¨è§¦å‘å·²æœ‰ Pod æ›´æ–°&lt;/strong&gt;ï¼Œéœ€æ‰‹åŠ¨é‡å»ºæˆ–ä¾èµ–ä¸Šå±‚æ§åˆ¶å™¨ï¼ˆå¦‚ Deploymentï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒç»„æˆéƒ¨åˆ†è¯¦è§£"&gt;ğŸ§© &lt;strong&gt;æ ¸å¿ƒç»„æˆéƒ¨åˆ†è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹ä¸º ReplicaSet èµ„æºæ¸…å•çš„æ ¸å¿ƒå­—æ®µåŠå…¶ä½œç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹/æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;spec.replicas&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰æœŸæœ›çš„ Pod å‰¯æœ¬æ•°é‡&lt;/td&gt;
&lt;td&gt;&lt;code&gt;replicas: 3&lt;/code&gt;ï¼›æœªæŒ‡å®šæ—¶é»˜è®¤ä¸º 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;spec.selector&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ‡ç­¾é€‰æ‹©å™¨ï¼ŒåŒ¹é…éœ€ç®¡ç†çš„ Pod&lt;/td&gt;
&lt;td&gt;&lt;code&gt;matchLabels: {app: nginx}&lt;/code&gt; éœ€ä¸ Pod æ ‡ç­¾ä¸€è‡´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;spec.template&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Pod æ¨¡æ¿ï¼Œå®šä¹‰æ–° Pod çš„é…ç½®&lt;/td&gt;
&lt;td&gt;åŒ…å« &lt;code&gt;metadata.labels&lt;/code&gt;ï¼ˆéœ€ä¸ &lt;code&gt;selector&lt;/code&gt; åŒ¹é…ï¼‰å’Œ &lt;code&gt;spec.containers&lt;/code&gt; ç­‰å­å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;spec.minReadySeconds&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Pod å°±ç»ªåéœ€ä¿æŒè¿è¡Œçš„æœ€çŸ­æ—¶é—´æ‰è§†ä¸ºå¯ç”¨&lt;/td&gt;
&lt;td&gt;é»˜è®¤ä¸º 0ï¼›è®¾ä¸º 30 å¯é¿å…çŸ­æš‚å°±ç»ªçš„ Pod è¢«è¯¯åˆ¤ä¸ºç¨³å®š&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®çº¦æŸ&lt;/strong&gt;ï¼š&lt;code&gt;selector&lt;/code&gt; ä¸ &lt;code&gt;template.metadata.labels&lt;/code&gt; &lt;strong&gt;å¿…é¡»åŒ¹é…&lt;/strong&gt;ï¼Œå¦åˆ™ ReplicaSet åˆ›å»ºå¤±è´¥&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-ç®¡ç†æ“ä½œä¸å®æˆ˜æŠ€å·§"&gt;âš–ï¸ &lt;strong&gt;ç®¡ç†æ“ä½œä¸å®æˆ˜æŠ€å·§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‰©ç¼©å®¹ï¼ˆScalingï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ‰‹åŠ¨è°ƒæ•´ï¼šä¿®æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; replicas
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å€¼åæ‰§è¡Œ&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; kubectl apply -f rs.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; ï¼Œæˆ–ç›´æ¥å‘½ä»¤æ“ä½œï¼š
```
kubectl scale rs/nginx-rs --replicas=5
```
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰ï¼šåŸºäº CPU/å†…å­˜ç­‰æŒ‡æ ‡åŠ¨æ€è°ƒæ•´å‰¯æœ¬æ•°
6ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
spec:
scaleTargetRef:
kind: ReplicaSet
name: nginx-rs
minReplicas: 2
maxReplicas: 10
metrics:
- type: Resource
resource:
name: cpu
target:
type: Utilization
averageUtilization: 80
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°ç­–ç•¥ä¸å±€é™&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸåœ°æ›´æ–°é™åˆ¶&lt;/strong&gt;ï¼šç›´æ¥ä¿®æ”¹ &lt;code&gt;spec.template&lt;/code&gt;ï¼ˆå¦‚é•œåƒç‰ˆæœ¬ï¼‰&lt;strong&gt;ä¸ä¼šè§¦å‘ Pod æ›´æ–°&lt;/strong&gt;ï¼Œéœ€æ‰‹åŠ¨åˆ é™¤æ—§ Pod è§¦å‘é‡å»º&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;ï¼šé€šè¿‡ Deployment ç®¡ç† ReplicaSetï¼Œåˆ©ç”¨å…¶æ»šåŠ¨æ›´æ–°ï¼ˆRollingUpdateï¼‰èƒ½åŠ›é€æ­¥æ›¿æ¢ Pod&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pod åˆ é™¤ä¼˜å…ˆçº§&lt;/strong&gt;
ç¼©å®¹æ—¶ï¼ŒReplicaSet æŒ‰ä»¥ä¸‹é¡ºåºé€‰æ‹©å¾…åˆ é™¤ Pod&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;æœªè°ƒåº¦ï¼ˆPendingï¼‰çš„ Pod&lt;/li&gt;
&lt;li&gt;æ³¨è§£ &lt;code&gt;pod-deletion-cost&lt;/code&gt; å€¼è¾ƒå°è€…ï¼ˆç”¨æˆ·å¯å¹²é¢„åˆ é™¤é¡ºåºï¼‰&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ä¸Šå‰¯æœ¬æ•°è¾ƒå¤šçš„ Pod&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæ—¶é—´è¾ƒæ–°çš„ Pod&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸-deployment-çš„å…³ç³»"&gt;ğŸ”„ &lt;strong&gt;ä¸ Deployment çš„å…³ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ReplicaSet å®šä½&lt;/strong&gt;ï¼šåŸºç¡€å‰¯æœ¬æ§åˆ¶å™¨ï¼Œä¸“æ³¨å‰¯æœ¬æ•°ç»´æŠ¤ï¼Œç¼ºä¹é«˜çº§å‘å¸ƒç­–ç•¥&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Deployment ä¼˜åŠ¿ï¼š
&lt;ul&gt;
&lt;li&gt;ç®¡ç† ReplicaSet ç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒ&lt;strong&gt;æ»šåŠ¨æ›´æ–°&lt;/strong&gt;ã€&lt;strong&gt;å›æ»š&lt;/strong&gt;ï¼ˆé€šè¿‡ &lt;code&gt;kubectl rollout undo&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ›´æ–°ç‰ˆæœ¬å¯¹åº”ä¸€ä¸ªæ–° ReplicaSetï¼Œæ—§ ReplicaSet ä¿ç•™ç”¨äºå›æ»šï¼ˆç”± &lt;code&gt;.spec.revisionHistoryLimit&lt;/code&gt;æ§åˆ¶ä¿ç•™æ•°é‡ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;ç”Ÿäº§å»ºè®®&lt;/strong&gt;ï¼š&lt;strong&gt;æ— çŠ¶æ€æœåŠ¡å¿…ç”¨ Deployment&lt;/strong&gt;ï¼Œé¿å…ç›´æ¥æ“ä½œ ReplicaSet&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§åŠŸèƒ½ä¸æœ€ä½³å®è·µ"&gt;âš ï¸ &lt;strong&gt;é«˜çº§åŠŸèƒ½ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;
åœ¨ Pod æ¨¡æ¿ä¸­é…ç½®æ¢é’ˆæå‡ç¨³å®šæ€§&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;livenessProbe&lt;/code&gt;ï¼šæ•…éšœæ—¶é‡å¯å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readinessProbe&lt;/code&gt;ï¼šæœªå°±ç»ª Pod ä» Service æµé‡æ± å‰”é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹äº²å’Œæ€§&lt;/strong&gt;ï¼ˆ&lt;code&gt;nodeAffinity&lt;/code&gt;ï¼‰ï¼šä¼˜å…ˆè°ƒåº¦åˆ° SSD èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ±¡ç‚¹å®¹å¿&lt;/strong&gt;ï¼ˆ&lt;code&gt;tolerations&lt;/code&gt;ï¼‰ï¼šå…è®¸è°ƒåº¦åˆ°æ ‡è®° &lt;code&gt;no-sched&lt;/code&gt; çš„èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºé™åˆ¶&lt;/strong&gt;
åœ¨ &lt;code&gt;spec.template.spec.containers.resources&lt;/code&gt; ä¸­è®¾ç½® &lt;code&gt;requests/limits&lt;/code&gt;ï¼Œé¿å…èµ„æºäº‰æŠ¢å¯¼è‡´é©±é€&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šReplicaSet æ˜¯ Kubernetes å‰¯æœ¬æ§åˆ¶çš„åŸºçŸ³ï¼Œé€šè¿‡&lt;strong&gt;å£°æ˜å¼å‰¯æœ¬æ•°ç»´æŠ¤&lt;/strong&gt;å’Œ&lt;strong&gt;æ•…éšœè‡ªæ„ˆ&lt;/strong&gt;ä¿éšœæœåŠ¡å¯ç”¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€ç²¾ç»†æ§åˆ¶ Pod å‰¯æœ¬æ•°çš„åœºæ™¯ï¼Œæˆ–ä½œä¸ºè‡ªå®šä¹‰æ§åˆ¶å™¨çš„åº•å±‚ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§å–èˆ&lt;/strong&gt;ï¼šä¼˜å…ˆé‡‡ç”¨ &lt;strong&gt;Deployment&lt;/strong&gt; ç®¡ç†æ— çŠ¶æ€åº”ç”¨ï¼Œç»“åˆ &lt;strong&gt;HPA è‡ªåŠ¨æ‰©ç¼©å®¹&lt;/strong&gt;å’Œ&lt;strong&gt;èµ„æºç›‘æ§&lt;/strong&gt;ï¼ˆå¦‚ Prometheusï¼‰æ„å»ºé«˜å¯ç”¨æ¶æ„&lt;a class="link" href="@ref" &gt;3,5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ç†è§£ ReplicaSet çš„è°ƒå’Œå¾ªç¯ï¼ˆReconcile Loopï¼‰å’Œæ ‡ç­¾é€‰æ‹©æœºåˆ¶ï¼Œå¯æ·±å…¥æŒæ¡ Kubernetes æ§åˆ¶å™¨çš„è®¾è®¡å“²å­¦ï¼Œä¸ºå¤æ‚åº”ç”¨ç¼–æ’å¥ å®šåŸºç¡€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="é¡ºåºè°ƒåº¦"&gt;é¡ºåºè°ƒåº¦
&lt;/h2&gt;&lt;p&gt;æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚åˆ†å¸ƒå¼æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€é›†ç¾¤åŒ–å­˜å‚¨ç³»ç»Ÿç­‰ï¼‰éœ€è¦é¡ºåºè°ƒåº¦ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ºäº†è§£å†³å…¶è¿è¡Œæ—¶çš„ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼š&lt;strong&gt;æ‹“æ‰‘çŠ¶æ€ç»´æŠ¤&lt;/strong&gt;å’Œ&lt;strong&gt;å­˜å‚¨çŠ¶æ€ä¸€è‡´æ€§&lt;/strong&gt;ã€‚ä»¥ä¸‹ä»å…·ä½“æœºåˆ¶å’Œå®é™…å½±å“è§’åº¦å±•å¼€è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ‹“æ‰‘çŠ¶æ€ç»´æŠ¤ç¡®ä¿èŠ‚ç‚¹é—´ä¾èµ–å…³ç³»ç¨³å®š"&gt;ğŸ”„ æ‹“æ‰‘çŠ¶æ€ç»´æŠ¤ï¼šç¡®ä¿èŠ‚ç‚¹é—´ä¾èµ–å…³ç³»ç¨³å®š
&lt;/h3&gt;&lt;p&gt;æœ‰çŠ¶æ€åº”ç”¨çš„å¤šä¸ªå®ä¾‹ï¼ˆå¦‚ZooKeeperçš„Leader/Followerã€MySQLçš„ä¸»ä»èŠ‚ç‚¹ï¼‰å­˜åœ¨ä¸¥æ ¼çš„å¯åŠ¨å’Œé€šä¿¡ä¾èµ–ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨é¡ºåºè¦æ±‚&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸»èŠ‚ç‚¹ï¼ˆå¦‚Pod-0ï¼‰å¿…é¡»å…ˆäºä»èŠ‚ç‚¹ï¼ˆPod-1ï¼‰å¯åŠ¨ï¼Œå¦åˆ™ä»èŠ‚ç‚¹å› æ— æ³•è¿æ¥ä¸»èŠ‚ç‚¹è€Œå¯åŠ¨å¤±è´¥&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é¡ºåºè°ƒåº¦ï¼ˆPod-0 â†’ Pod-1 â†’ Pod-2ï¼‰å¼ºåˆ¶æ»¡è¶³æ­¤ä¾èµ–ï¼Œé¿å…èŠ‚ç‚¹è§’è‰²æ··ä¹±&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œæ ‡è¯†ç¨³å®šæ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªPodæ‹¥æœ‰å›ºå®šDNSåç§°ï¼ˆå¦‚&lt;code&gt;mysql-0.mysql-svc.default.svc.cluster.local&lt;/code&gt;ï¼‰ï¼Œå³ä½¿Podé‡å»ºï¼ŒåŸŸåä¸å˜&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é¡ºåºè°ƒåº¦ç¡®ä¿æ–°Podç»§æ‰¿åŸPodçš„æ ‡è¯†ï¼ˆå¦‚&lt;code&gt;mysql-1&lt;/code&gt;å§‹ç»ˆæŒ‡å‘ä»èŠ‚ç‚¹ï¼‰ï¼Œå®¢æˆ·ç«¯æ— éœ€æ„ŸçŸ¥åº•å±‚IPå˜åŒ–&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ¡ˆä¾‹&lt;/strong&gt;ï¼š
åˆ é™¤Redisé›†ç¾¤æ‰€æœ‰Podåï¼ŒStatefulSetæŒ‰&lt;code&gt;redis-0&lt;/code&gt;ï¼ˆä¸»ï¼‰â†’ &lt;code&gt;redis-1&lt;/code&gt;ï¼ˆä»ï¼‰é¡ºåºé‡å»ºï¼Œå®¢æˆ·ç«¯é€šè¿‡&lt;code&gt;redis-0.redis-svc&lt;/code&gt;å§‹ç»ˆè®¿é—®ä¸»èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å­˜å‚¨çŠ¶æ€ä¸€è‡´æ€§é˜²æ­¢æ•°æ®é”™ä¹±ä¸ä¸¢å¤±"&gt;ğŸ’¾ å­˜å‚¨çŠ¶æ€ä¸€è‡´æ€§ï¼šé˜²æ­¢æ•°æ®é”™ä¹±ä¸ä¸¢å¤±
&lt;/h3&gt;&lt;p&gt;æœ‰çŠ¶æ€åº”ç”¨éœ€ç»‘å®šæŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚æ•°æ®åº“æ•°æ®ç›®å½•ï¼‰ï¼Œé¡ºåºè°ƒåº¦ä¿éšœæ•°æ®ä¸Podçš„ä¸¥æ ¼ç»‘å®šå…³ç³»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨å·ç»‘å®šé¡ºåº&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;volumeClaimTemplate&lt;/code&gt;ä¸ºæ¯ä¸ªPodåˆ›å»ºç‹¬ç«‹PVCï¼ˆå¦‚&lt;code&gt;data-mysql-0&lt;/code&gt;ã€&lt;code&gt;data-mysql-1&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é¡ºåºè°ƒåº¦ç¡®ä¿PVCæŒ‰ç¼–å·åˆ†é…ï¼Œé¿å…å­˜å‚¨å·è¢«é”™è¯¯å¤ç”¨ï¼ˆå¦‚Pod-1è¯¯æŒ‚Pod-0çš„å·ï¼‰&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®éš”ç¦»æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;Podé‡å»ºåä»æŒ‚è½½åŸPVCï¼Œç¡®ä¿æ•°æ®è¿ç»­æ€§ï¼ˆå¦‚Pod-1å§‹ç»ˆè®¿é—®è‡ªå·±çš„æ•°æ®åˆ†ç‰‡ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶è¡Œè°ƒåº¦å¯èƒ½å¯¼è‡´å¤šä¸ªPodç«äº‰åŒä¸€å­˜å‚¨å·ï¼Œå¼•å‘æ•°æ®æŸå&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åˆ†å¸ƒå¼ç³»ç»Ÿåè°ƒé¿å…è„‘è£‚ä¸ç«äº‰"&gt;âš–ï¸ åˆ†å¸ƒå¼ç³»ç»Ÿåè°ƒï¼šé¿å…è„‘è£‚ä¸ç«äº‰
&lt;/h3&gt;&lt;p&gt;é¡ºåºè°ƒåº¦é€šè¿‡æ§åˆ¶èŠ‚ç‚¹æ´»è·ƒçŠ¶æ€ï¼Œé™ä½åˆ†å¸ƒå¼ç³»ç»Ÿåè°ƒé£é™©ï¼š
1.
é¿å…è„‘è£‚ï¼ˆSplit-Brainï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»èŠ‚ç‚¹ï¼ˆPod-0ï¼‰ä¼˜å…ˆå¯åŠ¨å¹¶ç¡®ç«‹é¢†å¯¼æƒåï¼Œä»èŠ‚ç‚¹ï¼ˆPod-1ï¼‰å†å¯åŠ¨åŠ å…¥é›†ç¾¤ï¼Œé˜²æ­¢å¤šä¸»å†²çª&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;å‡å°‘ç«äº‰æ¡ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹æŒ‰åºå¯åŠ¨ï¼Œç¡®ä¿é›†ç¾¤æˆå‘˜å˜æ›´æœ‰åºï¼ˆå¦‚EtcdèŠ‚ç‚¹åŠ å…¥éœ€å·²çŸ¥èŠ‚ç‚¹æŠ•ç¥¨ï¼‰ï¼Œé¿å…å¹¶å‘åŠ å…¥å¯¼è‡´å…±è¯†å¤±è´¥&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æœ‰åºç¼©å®¹ä¿éšœæœåŠ¡é«˜å¯ç”¨"&gt;ğŸ” æœ‰åºç¼©å®¹ï¼šä¿éšœæœåŠ¡é«˜å¯ç”¨
&lt;/h3&gt;&lt;p&gt;ç¼©å®¹æ—¶é€†åºç»ˆæ­¢ï¼ˆå¦‚å…ˆç»ˆæ­¢Pod-2å†Pod-1ï¼‰ï¼Œç¡®ä¿æ ¸å¿ƒèŠ‚ç‚¹ä¸å—å½±å“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ä¸»èŠ‚ç‚¹ï¼ˆPod-0ï¼‰è¢«ä¼˜å…ˆåˆ é™¤ï¼Œé›†ç¾¤å¯èƒ½çŸ­æš‚æ— ä¸»ï¼Œå¼•å‘æœåŠ¡ä¸­æ–­&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€†åºåˆ é™¤ç¡®ä¿é«˜ä¼˜å…ˆçº§èŠ‚ç‚¹ï¼ˆå¦‚ä¸»èŠ‚ç‚¹ï¼‰æœ€åç»ˆæ­¢ï¼Œæœ€å¤§é™åº¦ç»´æŒé›†ç¾¤åŠŸèƒ½&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æœ‰åºè°ƒåº¦-vs-æ— åºè°ƒåº¦å¯¹æ¯”"&gt;âš™ï¸ æœ‰åºè°ƒåº¦ vs. æ— åºè°ƒåº¦å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è°ƒåº¦åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æœ‰åºè°ƒåº¦ï¼ˆStatefulSetï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ— åºè°ƒåº¦ï¼ˆDeploymentï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èŠ‚ç‚¹å¯åŠ¨é¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸¥æ ¼æŒ‰ç¼–å·é¡ºåºï¼ˆ0â†’1â†’2ï¼‰&lt;/td&gt;
&lt;td&gt;å¹¶è¡Œå¯åŠ¨ï¼Œæ— é¡ºåºä¾èµ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨ç»‘å®š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªPodç»‘å®šç‹¬ç«‹PVCï¼Œæ•°æ®éš”ç¦»&lt;/td&gt;
&lt;td&gt;å…±äº«ä¸´æ—¶å·æˆ–æ— æŒä¹…å­˜å‚¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç½‘ç»œæ ‡è¯†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šDNSåç§°ï¼ˆå¦‚&lt;code&gt;web-1.nginx-svc&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;éšæœºåç§°ï¼ˆå¦‚&lt;code&gt;web-59d88c466d-2xzj5&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åº”ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;MySQLä¸»ä»ã€KafkaèŠ‚ç‚¹ã€ZooKeeperé›†ç¾¤&lt;/td&gt;
&lt;td&gt;Nginxã€APIç½‘å…³ã€æ— çŠ¶æ€å¾®æœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é¡ºåºè°ƒåº¦æ˜¯StatefulSetè§£å†³æœ‰çŠ¶æ€åº”ç”¨æ ¸å¿ƒæŒ‘æˆ˜çš„å…³é”®è®¾è®¡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‹“æ‰‘çŠ¶æ€&lt;/strong&gt;ï¼šé€šè¿‡å›ºå®šç½‘ç»œæ ‡è¯†å’Œé¡ºåºå¯åœï¼Œç»´æŠ¤èŠ‚ç‚¹è§’è‰²ä¸ä¾èµ–å…³ç³»&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨çŠ¶æ€&lt;/strong&gt;ï¼šæŒ‰åºç»‘å®šç‹¬ç«‹å­˜å‚¨å·ï¼Œç¡®ä¿æ•°æ®ä¸Podçš„æ°¸ä¹…å…³è”&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼åè°ƒ&lt;/strong&gt;ï¼šé¿å…è„‘è£‚å’Œç«äº‰ï¼Œæå‡é›†ç¾¤ç¨³å®šæ€§&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šé¡ºåºè°ƒåº¦ä¼šå»¶é•¿éƒ¨ç½²æ—¶é—´ï¼Œè‹¥éå¼ºä¾èµ–åœºæ™¯ï¼ˆå¦‚Cassandraå„èŠ‚ç‚¹å¯¹ç­‰ï¼‰ï¼Œå¯è€ƒè™‘ä¼˜åŒ–ä¸ºå¹¶è¡Œå¯åŠ¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="kubelet"&gt;kubelet
&lt;/h2&gt;&lt;p&gt;Kubelet æ˜¯ Kubernetes é›†ç¾¤ä¸­æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸Šçš„æ ¸å¿ƒä»£ç†ç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†èŠ‚ç‚¹ä¸Šå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸æ§åˆ¶å¹³é¢ååŒç¡®ä¿é›†ç¾¤çŠ¶æ€ç¬¦åˆç”¨æˆ·æœŸæœ›ã€‚å…¶æ ¸å¿ƒåŠŸèƒ½å¯å½’çº³ä¸ºä»¥ä¸‹ä¸ƒå¤§ç±»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-pod-ç”Ÿå‘½å‘¨æœŸç®¡ç†"&gt;ğŸ”„ &lt;strong&gt;Pod ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubelet çš„æ ¸å¿ƒèŒè´£æ˜¯ç¡®ä¿èŠ‚ç‚¹ä¸Šçš„ Pod åŠå…¶å®¹å™¨æŒ‰é¢„æœŸè¿è¡Œï¼Œå…·ä½“åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Pod åˆ›å»ºä¸å¯åŠ¨&lt;/strong&gt;ï¼šç›‘å¬ API Server çš„æŒ‡ä»¤ï¼Œæ ¹æ® Pod å®šä¹‰ï¼ˆå¦‚é•œåƒã€èµ„æºé™åˆ¶ï¼‰è°ƒç”¨å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerdï¼‰å¯åŠ¨å®¹å™¨&lt;a class="link" href="@ref" &gt;1,2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€åŒæ­¥&lt;/strong&gt;ï¼šé€šè¿‡ &lt;strong&gt;SyncLoop æ§åˆ¶å¾ªç¯&lt;/strong&gt;æŒç»­å¯¹æ¯” API Server ä¸­çš„æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€ï¼Œé©±åŠ¨åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ“ä½œ&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»ˆæ­¢å¤„ç†&lt;/strong&gt;ï¼šåœ¨ Pod åˆ é™¤æ—¶åœæ­¢å®¹å™¨ã€æ¸…ç†èµ„æºï¼Œå¹¶æ”¯æŒé…ç½® &lt;code&gt;preStop&lt;/code&gt; é’©å­å®ç°ä¼˜é›…ç»ˆæ­¢ï¼ˆå¦‚ç­‰å¾… Nginx å®Œæˆè¯·æ±‚å¤„ç†ï¼‰&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-èŠ‚ç‚¹çŠ¶æ€ç›‘æ§ä¸ä¸ŠæŠ¥"&gt;ğŸ“¡ &lt;strong&gt;èŠ‚ç‚¹çŠ¶æ€ç›‘æ§ä¸ä¸ŠæŠ¥&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubelet ä½œä¸ºèŠ‚ç‚¹çš„â€œä¿¡æ¯é‡‡é›†å™¨â€ï¼Œå®šæœŸå‘ API Server æŠ¥å‘Šå…³é”®æ•°æ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæŒ‡æ ‡&lt;/strong&gt;ï¼šé€šè¿‡é›†æˆ &lt;strong&gt;cAdvisor&lt;/strong&gt; æ”¶é›† CPUã€å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œä½¿ç”¨æƒ…å†µï¼Œå¹¶ä¸ŠæŠ¥è‡³ API Serverï¼Œä¾›è°ƒåº¦å™¨å†³ç­–&lt;a class="link" href="@ref" &gt;2,3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹å¥åº·çŠ¶æ€&lt;/strong&gt;ï¼šæ£€æµ‹èŠ‚ç‚¹æ¡ä»¶ï¼ˆå¦‚ &lt;code&gt;Ready&lt;/code&gt;ã€&lt;code&gt;DiskPressure&lt;/code&gt;ï¼‰ï¼Œå¼‚å¸¸æ—¶æ ‡è®°èŠ‚ç‚¹çŠ¶æ€å¹¶è§¦å‘ Pod é©±é€ï¼ˆå¦‚èµ„æºä¸è¶³æ—¶æŒ‰ QoS ä¼˜å…ˆçº§é©±é€ä½ä¼˜å…ˆçº§ Podï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶ç”Ÿæˆ&lt;/strong&gt;ï¼šè®°å½•å®¹å™¨å¯åœã€å¥åº·æ£€æŸ¥å¤±è´¥ç­‰äº‹ä»¶ï¼Œæ”¯æŒ &lt;code&gt;kubectl describe pod&lt;/code&gt; æŸ¥çœ‹æ•…éšœåŸå› &lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®¹å™¨è¿è¡Œæ—¶äº¤äº’cri"&gt;ğŸ–¥ï¸ &lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶äº¤äº’ï¼ˆCRIï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubelet é€šè¿‡ &lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰&lt;/strong&gt; æŠ½è±¡åº•å±‚å®¹å™¨æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¹å™¨æ“ä½œ&lt;/strong&gt;ï¼šè°ƒç”¨ CRI æ¥å£æ‰§è¡Œæ‹‰å–é•œåƒã€åˆ›å»º/åˆ é™¤å®¹å™¨ã€æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚ &lt;code&gt;kubectl exec&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè¿è¡Œæ—¶æ”¯æŒ&lt;/strong&gt;ï¼šå…¼å®¹ Dockerã€containerdã€CRI-O ç­‰è¿è¡Œæ—¶ï¼Œç¡®ä¿çµæ´»æ€§&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¥åº·æ£€æŸ¥ä¸è‡ªæ„ˆæœºåˆ¶"&gt;ğŸ©º &lt;strong&gt;å¥åº·æ£€æŸ¥ä¸è‡ªæ„ˆæœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubelet é€šè¿‡æ¢é’ˆä¿éšœæœåŠ¡å¯ç”¨æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜æ´»æ¢é’ˆï¼ˆLivenessProbeï¼‰&lt;/strong&gt;ï¼šæ£€æµ‹å®¹å™¨å´©æºƒæˆ–æ— å“åº”æ—¶è‡ªåŠ¨é‡å¯&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°±ç»ªæ¢é’ˆï¼ˆReadinessProbeï¼‰&lt;/strong&gt;ï¼šç¡®ä¿å®¹å™¨å‡†å¤‡å¥½æ¥æ”¶æµé‡åå†åŠ å…¥ Service è´Ÿè½½å‡è¡¡æ± &lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªæ„ˆç­–ç•¥&lt;/strong&gt;ï¼šæ ¹æ®é‡å¯ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;Always&lt;/code&gt;ã€&lt;code&gt;OnFailure&lt;/code&gt;ï¼‰è‡ªåŠ¨æ¢å¤æ•…éšœå®¹å™¨&lt;a class="link" href="@ref" &gt;10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-èµ„æºä¸å­˜å‚¨ç®¡ç†"&gt;ğŸ’¾ &lt;strong&gt;èµ„æºä¸å­˜å‚¨ç®¡ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºéš”ç¦»&lt;/strong&gt;ï¼šé€šè¿‡ Cgroups é™åˆ¶å®¹å™¨çš„ CPU/å†…å­˜ä½¿ç”¨ï¼Œé˜²æ­¢èµ„æºäº‰æŠ¢&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·ç®¡ç†&lt;/strong&gt;ï¼šæŒ‚è½½ Pod å®šä¹‰çš„å­˜å‚¨å·ï¼ˆå¦‚ PersistentVolumeï¼‰ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨æˆ–äº‘å­˜å‚¨ï¼ˆå¦‚ AWS EBSï¼‰&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åƒåœ¾å›æ”¶&lt;/strong&gt;ï¼šè‡ªåŠ¨æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨ï¼ˆé€šè¿‡ &lt;strong&gt;ImageGC&lt;/strong&gt; å’Œ &lt;strong&gt;ContainerGC&lt;/strong&gt;ï¼‰ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®‰å…¨æœºåˆ¶"&gt;ğŸ” &lt;strong&gt;å®‰å…¨æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¤è¯ä¸æˆæƒ&lt;/strong&gt;ï¼šä½¿ç”¨ TLS è¯ä¹¦ä¸ API Server é€šä¿¡ï¼Œå¹¶é€šè¿‡ RBAC é™åˆ¶æ“ä½œæƒé™&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨é£é™©é˜²èŒƒ&lt;/strong&gt;ï¼šé»˜è®¤å…³é—­ 10250 ç«¯å£æœªæˆæƒè®¿é—®ï¼ˆé¿å…æ”»å‡»è€…é€šè¿‡ &lt;code&gt;/run&lt;/code&gt; æ¥å£æ‰§è¡Œä»»æ„å‘½ä»¤ï¼‰ï¼Œéœ€é…ç½® &lt;code&gt;anonymous: enabled: false&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•æ„Ÿæ•°æ®ç®¡ç†&lt;/strong&gt;ï¼šæ³¨å…¥ Secrets å’Œ ConfigMaps åˆ°å®¹å™¨ç¯å¢ƒï¼Œé¿å…ç¡¬ç¼–ç å‡­æ®&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç½‘ç»œä¸æ’ä»¶ååŒ"&gt;ğŸŒ &lt;strong&gt;ç½‘ç»œä¸æ’ä»¶ååŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CNI ç½‘ç»œæ’ä»¶é›†æˆ&lt;/strong&gt;ï¼šä¸ Calicoã€Flannel ç­‰åä½œï¼Œä¸º Pod åˆ†é… IPã€é…ç½®ç½‘å¡å’Œè·¯ç”±è§„åˆ™ï¼Œç¡®ä¿è·¨èŠ‚ç‚¹é€šä¿¡&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°æ”¯æŒ&lt;/strong&gt;ï¼šç»´æŠ¤ Pod IP ä¸ Service çš„æ˜ å°„å…³ç³»ï¼Œä¾› kube-proxy ç”Ÿæˆ iptables/IPVS è§„åˆ™&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¨¡å—åä½œæœºåˆ¶"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæ¨¡å—åä½œæœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubelet é€šè¿‡å†…éƒ¨æ¨¡å—åŒ–è®¾è®¡å®ç°é«˜æ•ˆç®¡ç†ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¨¡å—&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;PLEG&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›‘å¬å®¹å™¨çŠ¶æ€å˜åŒ–ï¼Œè§¦å‘ SyncLoop åŒæ­¥&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;EvictionManager&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;èµ„æºä¸è¶³æ—¶æŒ‰ QoS ç­‰çº§ï¼ˆBestEffort â†’ Burstable â†’ Guaranteedï¼‰é©±é€ Pod&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ProbeManager&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰§è¡Œå®¹å™¨å¥åº·æ£€æŸ¥å¹¶è§¦å‘é‡å¯&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;StatusManager&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å‘ API Server ä¸ŠæŠ¥ Pod çŠ¶æ€&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-8"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubelet æ˜¯ Kubernetes èŠ‚ç‚¹ä¸Šçš„â€œå…¨èƒ½ç®¡å®¶â€ï¼Œé€šè¿‡ &lt;strong&gt;çŠ¶æ€åŒæ­¥&lt;/strong&gt;ï¼ˆSyncLoopï¼‰ã€&lt;strong&gt;èµ„æºéš”ç¦»&lt;/strong&gt;ï¼ˆCRI/cGroupsï¼‰ã€&lt;strong&gt;è‡ªæ„ˆæœºåˆ¶&lt;/strong&gt;ï¼ˆæ¢é’ˆï¼‰å’Œ&lt;strong&gt;å®‰å…¨é€šä¿¡&lt;/strong&gt;ï¼ˆTLS/RBACï¼‰å››å¤§æ”¯æŸ±ï¼Œç¡®ä¿å®¹å™¨æŒ‰å£°æ˜å¼é…ç½®è¿è¡Œã€‚å…¶è®¾è®¡å…¼é¡¾æ‰©å±•æ€§ï¼ˆå¦‚ CRI/CNI æ’ä»¶åŒ–ï¼‰ä¸ç¨³å®šæ€§ï¼ˆå¦‚é«˜å¯ç”¨èŠ‚ç‚¹ä¸ŠæŠ¥ï¼‰ï¼Œæ˜¯é›†ç¾¤è‡ªåŠ¨åŒ–è¿ç»´çš„åŸºçŸ³&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚è¿ç»´æ—¶éœ€é‡ç‚¹å…³æ³¨ &lt;strong&gt;èµ„æºç›‘æ§&lt;/strong&gt;ï¼ˆcAdvisor æŒ‡æ ‡ï¼‰ã€&lt;strong&gt;å®‰å…¨é…ç½®&lt;/strong&gt;ï¼ˆ10250 ç«¯å£ï¼‰åŠ &lt;strong&gt;ä¼˜é›…ç»ˆæ­¢&lt;/strong&gt;ï¼ˆpreStop é’©å­ï¼‰ä»¥æå‡å¯é æ€§&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="hpahorizontal-pod-autoscaler"&gt;HPA(Horizontal Pod Autoscaler)
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Kubernetes &lt;strong&gt;HPAï¼ˆHorizontal Pod Autoscalerï¼‰&lt;/strong&gt; çš„å…¨é¢è§£æï¼Œæ¶µç›–æ ¸å¿ƒåŸç†ã€é…ç½®å®è·µã€ç”Ÿäº§è°ƒä¼˜åŠå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆï¼Œç»“åˆç¤¾åŒºæœ€ä½³å®è·µæ€»ç»“è€Œæˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-hpa-çš„æ ¸å¿ƒåŸç†ä¸å·¥ä½œæœºåˆ¶"&gt;ğŸ” &lt;strong&gt;HPA çš„æ ¸å¿ƒåŸç†ä¸å·¥ä½œæœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ°´å¹³æ‰©ç¼©-vs-å‚ç›´æ‰©ç¼©"&gt;&lt;strong&gt;æ°´å¹³æ‰©ç¼© vs å‚ç›´æ‰©ç¼©&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ°´å¹³æ‰©ç¼©ï¼ˆHPAï¼‰&lt;/strong&gt;ï¼šå¢å‡ Pod å‰¯æœ¬æ•°ï¼Œé€‚ç”¨äºæ— çŠ¶æ€æœåŠ¡ï¼Œæ˜¯äº‘åŸç”Ÿçš„ä¸»æµæ–¹æ¡ˆ&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚ç›´æ‰©ç¼©ï¼ˆVPAï¼‰&lt;/strong&gt;ï¼šè°ƒæ•´å•ä¸ª Pod çš„èµ„æºè¯·æ±‚ï¼ˆCPU/å†…å­˜ï¼‰ï¼Œé€‚ç”¨äºæœ‰çŠ¶æ€æœåŠ¡æˆ–èµ„æºä¼˜åŒ–åœºæ™¯&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="hpa-å·¥ä½œæµç¨‹"&gt;&lt;strong&gt;HPA å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[æŒ‡æ ‡é‡‡é›†] --&amp;gt; B[Metrics Server/Prometheus]
B --&amp;gt; C[HPA Controller]
C --&amp;gt; D[è®¡ç®—æœŸæœ›å‰¯æœ¬æ•°]
D --&amp;gt; E[è°ƒæ•´ Deployment/ReplicaSet]
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡æ ‡é‡‡é›†å±‚&lt;/strong&gt;ï¼šé€šè¿‡ Metrics Serverï¼ˆåŸºç¡€èµ„æºï¼‰æˆ– Prometheus Adapterï¼ˆè‡ªå®šä¹‰æŒ‡æ ‡ï¼‰å®æ—¶æ”¶é›†æ•°æ®&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†³ç­–è®¡ç®—ï¼š
æ ¸å¿ƒç®—æ³•ï¼š
æœŸæœ›å‰¯æœ¬æ•° = ceil(å½“å‰å‰¯æœ¬æ•° Ã— (å½“å‰æŒ‡æ ‡å€¼ / ç›®æ ‡æŒ‡æ ‡å€¼))
ä¼˜åŒ–æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¹å¿åº¦ï¼ˆé»˜è®¤ 0.1ï¼‰&lt;/strong&gt;ï¼šæ¯”ç‡åœ¨ 0.9~1.1 æ—¶ä¸è§¦å‘æ‰©ç¼©&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·å´çª—å£&lt;/strong&gt;ï¼šæ‰©å®¹å 3 åˆ†é’Ÿå†…ä¸ç¼©å®¹ï¼Œç¼©å®¹å 5 åˆ†é’Ÿå†…ä¸æ‰©å®¹ï¼Œé¿å…æŠ–åŠ¨&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰©ç¼©å®¹è¾¹ç•Œæ§åˆ¶"&gt;&lt;strong&gt;æ‰©ç¼©å®¹è¾¹ç•Œæ§åˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;minReplicas&lt;/code&gt;ï¼šä¿éšœæœåŠ¡é«˜å¯ç”¨çš„æœ€å° Pod æ•°ï¼ˆå»ºè®® â‰¥2ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maxReplicas&lt;/code&gt;ï¼šé˜²æ­¢èµ„æºè€—å°½æˆ–æˆæœ¬å¤±æ§çš„ç¡¬ä¸Šé™&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-hpa-æ”¯æŒçš„æŒ‡æ ‡ç±»å‹"&gt;âš™ï¸ &lt;strong&gt;HPA æ”¯æŒçš„æŒ‡æ ‡ç±»å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æŒ‡æ ‡ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºæŒ‡æ ‡ï¼ˆCPU/å†…å­˜ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Web æœåŠ¡ã€åŸºç¡€ä¸­é—´ä»¶&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: Resource&lt;/code&gt; + &lt;code&gt;target: Utilization&lt;/code&gt;ï¼ˆç›®æ ‡å€¼ 60~70%ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰æŒ‡æ ‡ï¼ˆPod çº§åˆ«ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ QPSã€è®¢å•é‡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: Pods&lt;/code&gt; + &lt;code&gt;metric.name: http_requests_per_second&lt;/code&gt;&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤–éƒ¨æŒ‡æ ‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯é˜Ÿåˆ—ç§¯å‹ã€æ•°æ®åº“è´Ÿè½½&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: External&lt;/code&gt; + &lt;code&gt;metric.name: kafka_lag&lt;/code&gt;ï¼ˆéœ€ Prometheus é€‚é…å™¨ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šæŒ‡æ ‡ç»„åˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤æ‚ä¸šåŠ¡åœºæ™¯&lt;/td&gt;
&lt;td&gt;åŒæ—¶å®šä¹‰ CPU + QPS æŒ‡æ ‡ï¼Œå–è®¡ç®—åå‰¯æœ¬æ•°çš„æœ€å¤§å€¼&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¤šæŒ‡æ ‡ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šHPA å¹¶è¡Œè®¡ç®—æ‰€æœ‰æŒ‡æ ‡ï¼Œé€‰æ‹©&lt;strong&gt;æœ€å¤§å‰¯æœ¬æ•°&lt;/strong&gt;ä½œä¸ºæœ€ç»ˆæ‰©ç¼©ç›®æ ‡&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒé«˜é˜¶é…ç½®"&gt;ğŸ› ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒé«˜é˜¶é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è¡Œä¸ºè°ƒä¼˜behavior-api"&gt;&lt;strong&gt;è¡Œä¸ºè°ƒä¼˜ï¼ˆBehavior APIï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;behavior:
scaleDown:
stabilizationWindowSeconds: 300 # ç¼©å®¹å†·å´çª—å£ï¼ˆé˜²æŠ–åŠ¨ï¼‰
policies:
- type: Percent
value: 10 # å•æ¬¡æœ€å¤šç¼©å®¹10%
scaleUp:
stabilizationWindowSeconds: 60 # æ‰©å®¹å†·å´çª—å£
policies:
- type: Pods
value: 4 # å•æ¬¡æœ€å¤šæ‰©å®¹4ä¸ªPod[4](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å®¹å™¨çº§èµ„æºæŒ‡æ ‡"&gt;&lt;strong&gt;å®¹å™¨çº§èµ„æºæŒ‡æ ‡&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é’ˆå¯¹å¤šå®¹å™¨ Podï¼Œå¯æŒ‡å®šç‰¹å®šå®¹å™¨çš„èµ„æºä½¿ç”¨ç‡ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;metrics:
- type: ContainerResource
containerResource:
name: cpu
container: app-server
target:
type: Utilization
averageUtilization: 70[1](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ä¸-cluster-autoscaler-è”åŠ¨"&gt;&lt;strong&gt;ä¸ Cluster Autoscaler è”åŠ¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“ Pod å› èµ„æºä¸è¶³æ— æ³•è°ƒåº¦æ—¶ï¼Œè‡ªåŠ¨è§¦å‘èŠ‚ç‚¹æ‰©å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®è¦ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹æ·»åŠ åå»¶è¿Ÿç¼©å®¹ï¼ˆ&lt;code&gt;scale-down-delay-after-add=10m&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹åˆ©ç”¨ç‡é˜ˆå€¼ï¼ˆ&lt;code&gt;scale-down-utilization-threshold=0.5&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è‡ªå®šä¹‰æŒ‡æ ‡å®æˆ˜æ–¹æ¡ˆ"&gt;âš¡ &lt;strong&gt;è‡ªå®šä¹‰æŒ‡æ ‡å®æˆ˜æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŸºäº-prometheus-çš„æŒ‡æ ‡é‡‡é›†"&gt;&lt;strong&gt;åŸºäº Prometheus çš„æŒ‡æ ‡é‡‡é›†&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# prometheus-adapter é…ç½®è§„åˆ™
rules:
- seriesQuery: &amp;#39;http_requests_total{namespace!=&amp;#34;&amp;#34;,pod!=&amp;#34;&amp;#34;}&amp;#39;
resources:
overrides:
namespace: {resource: &amp;#34;namespace&amp;#34;}
pod: {resource: &amp;#34;pod&amp;#34;}
name:
matches: &amp;#34;^(.*)_total&amp;#34;
as: &amp;#34;${1}_per_second&amp;#34;
metricsQuery: &amp;#39;sum(rate(&amp;lt;&amp;lt;.Series&amp;gt;&amp;gt;{&amp;lt;&amp;lt;.LabelMatchers&amp;gt;&amp;gt;}[2m])) by (&amp;lt;&amp;lt;.GroupBy&amp;gt;&amp;gt;)&amp;#39;[4](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="hpa-å¼•ç”¨è‡ªå®šä¹‰æŒ‡æ ‡"&gt;&lt;strong&gt;HPA å¼•ç”¨è‡ªå®šä¹‰æŒ‡æ ‡&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;metrics:
- type: Pods
pods:
metric:
name: orders_processed_per_minute
target:
type: AverageValue
averageValue: 500[4](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜ç°è±¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¹å› åˆ†æ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HPA ä¸è§¦å‘æ‰©å®¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡æ ‡é‡‡é›†å»¶è¿Ÿ &amp;gt;30 ç§’&lt;/td&gt;
&lt;td&gt;æ£€æŸ¥ Metrics Server/Prometheus å¯ç”¨æ€§&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‰¯æœ¬æ•°é¢‘ç¹æŠ–åŠ¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡å€¼è¿‡æ•æ„Ÿæˆ–å†·å´çª—å£è¿‡çŸ­&lt;/td&gt;
&lt;td&gt;è°ƒæ•´ &lt;code&gt;behavior.scaleDown.stabilizationWindowSeconds&lt;/code&gt; è‡³ 300 ç§’ä»¥ä¸Š&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å®¹å Pod ä¸å°±ç»ª&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–° Pod å¯åŠ¨æ…¢æˆ–æ¢é’ˆé…ç½®ä¸åˆç†&lt;/td&gt;
&lt;td&gt;ä¼˜åŒ– &lt;code&gt;readinessProbe&lt;/code&gt; åˆå§‹å»¶è¿Ÿï¼ˆ&lt;code&gt;initialDelaySeconds&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºåˆ©ç”¨ç‡ä½ä½†æ‰©å®¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡æ ‡å™ªå£°ï¼ˆå¦‚å¯åŠ¨å³°å€¼ï¼‰&lt;/td&gt;
&lt;td&gt;å¢åŠ æŒ‡æ ‡èšåˆçª—å£ï¼ˆå¦‚ Prometheus çš„ &lt;code&gt;[2m]&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-è¿›é˜¶åœºæ™¯ä¸å·¥å…·é“¾"&gt;ğŸš€ &lt;strong&gt;è¿›é˜¶åœºæ™¯ä¸å·¥å…·é“¾&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="kedaäº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹"&gt;&lt;strong&gt;KEDAï¼ˆäº‹ä»¶é©±åŠ¨æ‰©ç¼©å®¹ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒèƒ½åŠ›ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼©å®¹è‡³é›¶ï¼ˆ&lt;code&gt;minReplicaCount: 0&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºäº‹ä»¶æºï¼ˆKafkaã€RabbitMQ é˜Ÿåˆ—æ·±åº¦ï¼‰æ‰©ç¼©&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é…ç½®ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;triggers:
- type: rabbitmq
metadata:
queueName: task-queue
queueLength: &amp;#34;10&amp;#34; # æ¯ä¸ª Pod å¤„ç† 10 æ¡æ¶ˆæ¯[2](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®šæ—¶æ‰©ç¼©å®¹cronhpa"&gt;&lt;strong&gt;å®šæ—¶æ‰©ç¼©å®¹ï¼ˆCronHPAï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ KEDA å®ç°å›ºå®šæ—¶é—´æ®µçš„å‰¯æœ¬è°ƒæ•´ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;triggers:
- type: cron
metadata:
start: &amp;#34;0 9 * * *&amp;#34; # æ¯å¤© 9:00 å¼€å§‹
end: &amp;#34;0 18 * * *&amp;#34; # æ¯å¤© 18:00 ç»“æŸ
desiredReplicas: &amp;#34;10&amp;#34;[8](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä¸æœ€ä½³å®è·µ"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒåŸåˆ™&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºè¯·æ±‚å¿…å¡«&lt;/strong&gt;ï¼šHPA ä¾èµ– &lt;code&gt;resources.requests&lt;/code&gt; è®¡ç®—ä½¿ç”¨ç‡&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›®æ ‡å€¼è®¾ç½®&lt;/strong&gt;ï¼šCPU åˆ©ç”¨ç‡å»ºè®® 60~70%ï¼Œé¿å…é¢‘ç¹æ‰©ç¼©&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ä½“ç³»&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å…³é”®æŒ‡æ ‡ï¼š&lt;code&gt;kube_hpa_status_current_replicas&lt;/code&gt;ã€&lt;code&gt;container_cpu_usage_seconds_total&lt;/code&gt;&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å‘Šè­¦è§„åˆ™ï¼šå‰¯æœ¬æ•°æ¥è¿‘ &lt;code&gt;maxReplicas&lt;/code&gt; æˆ–é¢‘ç¹æ‰©ç¼©æ—¶è§¦å‘&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶æ„å»ºè®®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— çŠ¶æ€æœåŠ¡&lt;/strong&gt;ï¼šHPA + Deployment + Cluster Autoscaler&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€æœåŠ¡&lt;/strong&gt;ï¼šVPA + å›ºå®šå‰¯æœ¬æ•°ï¼ˆé¿å…å­˜å‚¨å·å†²çªï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹å¤„ç†ä»»åŠ¡&lt;/strong&gt;ï¼šKEDA + äº‹ä»¶é©±åŠ¨ï¼ˆç¼©å®¹è‡³é›¶èŠ‚çœèµ„æºï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½® HPA å¹¶è”åŠ¨ç›‘æ§ã€èŠ‚ç‚¹æ‰©ç¼©å®¹ç³»ç»Ÿï¼Œå¯æ„å»º&lt;strong&gt;é«˜å¼¹æ€§ã€ä½æˆæœ¬ã€è‡ªæ„ˆå¼&lt;/strong&gt;çš„äº‘åŸç”Ÿæ¶æ„ã€‚ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®æ¯æœˆæ‰§è¡Œä¸€æ¬¡æ‰©ç¼©å®¹æ¼”ç»ƒï¼ŒæŒç»­ä¼˜åŒ–é˜ˆå€¼å‚æ•°&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="åŠ å…¥é›†ç¾¤"&gt;åŠ å…¥é›†ç¾¤
&lt;/h2&gt;&lt;p&gt;è¦å°† Kubernetes Worker èŠ‚ç‚¹å®‰å…¨åŠ å…¥é›†ç¾¤ï¼Œéœ€éµå¾ªæ ‡å‡†åŒ–æµç¨‹å¹¶è§£å†³å¸¸è§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å…³é”®æ­¥éª¤åŠæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å‡†å¤‡å·¥ä½œæ–°èŠ‚ç‚¹"&gt;ğŸ”§ &lt;strong&gt;å‡†å¤‡å·¥ä½œï¼ˆæ–°èŠ‚ç‚¹ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿé…ç½®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­ Swap&lt;/strong&gt;ï¼š&lt;code&gt;swapoff -a&lt;/code&gt; å¹¶æ°¸ä¹…ç¦ç”¨ï¼ˆæ³¨é‡Š &lt;code&gt;/etc/fstab&lt;/code&gt; ä¸­çš„ swap è¡Œï¼‰&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶é—´åŒæ­¥&lt;/strong&gt;ï¼šç¡®ä¿ NTP æœåŠ¡è¿è¡Œï¼ˆ&lt;code&gt;timedatectl set-ntp true&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸»æœºåå”¯ä¸€æ€§&lt;/strong&gt;ï¼š&lt;code&gt;hostnamectl set-hostname worker-node1&lt;/code&gt;ï¼Œå¹¶åœ¨æ‰€æœ‰èŠ‚ç‚¹çš„ &lt;code&gt;/etc/hosts&lt;/code&gt; ä¸­ç»Ÿä¸€é…ç½® IP ä¸ä¸»æœºåæ˜ å°„&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰è£…ä¾èµ–ç»„ä»¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶&lt;/strong&gt;ï¼šå®‰è£… Docker æˆ– containerdï¼ˆéœ€æ¸…ç†é»˜è®¤é…ç½®ï¼š&lt;code&gt;rm /etc/containerd/config.toml &amp;amp;&amp;amp; systemctl restart containerd&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes å·¥å…·&lt;/strong&gt;ï¼šå®‰è£… &lt;code&gt;kubeadm&lt;/code&gt;ã€&lt;code&gt;kubelet&lt;/code&gt;ã€&lt;code&gt;kubectl&lt;/code&gt;ï¼ˆç‰ˆæœ¬éœ€ä¸ Master ä¸€è‡´ï¼‰&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œä¸å†…æ ¸ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨å†…æ ¸æ¨¡å—&lt;/strong&gt;ï¼šåŠ è½½ &lt;code&gt;br_netfilter&lt;/code&gt; å¹¶é…ç½® &lt;code&gt;sysctl&lt;/code&gt; å‚æ•°ï¼ˆIPv4 è½¬å‘ã€æ¡¥æ¥æµé‡ï¼‰&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²ç«å¢™å¼€æ”¾ç«¯å£&lt;/strong&gt;ï¼šç¡®ä¿ Master çš„ &lt;strong&gt;6443&lt;/strong&gt;ï¼ˆAPI Serverï¼‰å’Œ &lt;strong&gt;10250&lt;/strong&gt;ï¼ˆkubeletï¼‰ç«¯å£å¯è®¿é—®&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åŠ å…¥é›†ç¾¤æµç¨‹"&gt;âš™ï¸ &lt;strong&gt;åŠ å…¥é›†ç¾¤æµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ Master ç”ŸæˆåŠ å…¥å‘½ä»¤&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubeadm token create --print-join-command # è¾“å‡ºåŒ…å« token å’Œè¯ä¹¦å“ˆå¸Œ[1,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Token è¿‡æœŸå¤„ç†&lt;/strong&gt;ï¼šé»˜è®¤ 24 å°æ—¶å¤±æ•ˆï¼Œå¯åˆ›å»ºæ°¸ä¹… Tokenï¼š&lt;code&gt;kubeadm token create --ttl 0&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ Worker èŠ‚ç‚¹æ‰§è¡ŒåŠ å…¥å‘½ä»¤&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubeadm join &amp;lt;Master-IP&amp;gt;:6443 --token &amp;lt;token&amp;gt; \
--discovery-token-ca-cert-hash sha256:&amp;lt;hash&amp;gt; [1,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°è¯´æ˜&lt;/strong&gt;ï¼š&lt;code&gt;&amp;lt;Master-IP&amp;gt;&lt;/code&gt; éœ€æ›¿æ¢ä¸ºå®é™… IPï¼Œ&lt;code&gt;&amp;lt;hash&amp;gt;&lt;/code&gt; ä¸º Master è¯ä¹¦çš„ SHA256 å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯èŠ‚ç‚¹çŠ¶æ€&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Master æ‰§è¡Œï¼š&lt;code&gt;kubectl get nodes&lt;/code&gt;ï¼Œæ–°èŠ‚ç‚¹çŠ¶æ€åº”ä¸º &lt;code&gt;Ready&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥çŠ¶æ€ä¸º &lt;code&gt;NotReady&lt;/code&gt; â†’ é€šå¸¸å›  &lt;strong&gt;CNI ç½‘ç»œæ’ä»¶æœªå®‰è£…&lt;/strong&gt;ï¼ˆè§æ•…éšœæ’æŸ¥éƒ¨åˆ†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç½‘ç»œé…ç½®ä¸éªŒè¯"&gt;ğŸŒ &lt;strong&gt;ç½‘ç»œé…ç½®ä¸éªŒè¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®‰è£… CNI ç½‘ç»œæ’ä»¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Flannel&lt;/strong&gt;ï¼š&lt;code&gt;kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Calico&lt;/strong&gt;ï¼š&lt;code&gt;kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¯åŠ¨é¡ºåº&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥å‘½ä»¤&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;kubelet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;&lt;code&gt;systemctl status kubelet&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CNI&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ip route show&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;kube-proxy&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;&lt;code&gt;curl localhost:10249/healthz&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–"&gt;ğŸ›¡ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨åŠ å›º&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RBAC æƒé™æ§åˆ¶&lt;/strong&gt;ï¼šé™åˆ¶èŠ‚ç‚¹æ“ä½œæƒé™&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TLS åŠ å¯†é€šä¿¡&lt;/strong&gt;ï¼šç¡®ä¿ kubelet ä¸ API Server å¯ç”¨ HTTPS&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# æ–°èŠ‚ç‚¹åˆå§‹åŒ–è„šæœ¬ï¼ˆéƒ¨åˆ†ï¼‰
yum install -y kubelet-1.25.4 kubeadm-1.25.4
systemctl enable kubelet
kubeadm join &amp;lt;Master-IP&amp;gt;:6443 --token &amp;lt;token&amp;gt; --discovery-token-ca-cert-hash sha256:&amp;lt;hash&amp;gt; [3](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡ç­¾ç®¡ç†&lt;/strong&gt;
ä¸ºèŠ‚ç‚¹æ·»åŠ ç¡¬ä»¶æ ‡ç­¾ï¼Œä¾¿äºè°ƒåº¦ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl label nodes &amp;lt;node-name&amp;gt; disk-type=ssd gpu-model=a100 [3](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ•…éšœæ’æŸ¥"&gt;âš ï¸ &lt;strong&gt;æ•…éšœæ’æŸ¥&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜ç°è±¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;kubeadm join&lt;/code&gt; å¤±è´¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Token è¿‡æœŸ â†’ é‡æ–°ç”Ÿæˆ Token&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ï¼›ç½‘ç»œä¸é€š â†’ æ£€æŸ¥é˜²ç«å¢™/ç«¯å£&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èŠ‚ç‚¹çŠ¶æ€ &lt;code&gt;NotReady&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœªå®‰è£… CNI æ’ä»¶ â†’ éƒ¨ç½² Flannel/Calico&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ï¼›kubelet æœªå¯åŠ¨ â†’ &lt;code&gt;journalctl -u kubelet&lt;/code&gt; æŸ¥æ—¥å¿—&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯ä¹¦é”™è¯¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¯ä¹¦è¿‡æœŸ â†’ &lt;code&gt;kubeadm certs renew all&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é•œåƒæ‹‰å–å¤±è´¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®ç§æœ‰ä»“åº“ Secretï¼š&lt;code&gt;kubectl create secret docker-registry regcred --docker-server=&amp;lt;url&amp;gt;&lt;/code&gt;&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-9"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæµç¨‹&lt;/strong&gt;ï¼šå‡†å¤‡èŠ‚ç‚¹ â†’ ç”Ÿæˆ Token â†’ æ‰§è¡Œ &lt;code&gt;kubeadm join&lt;/code&gt; â†’ éªŒè¯çŠ¶æ€ â†’ å®‰è£… CNIã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®å£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;ä¸€å…³äºŒè£…ä¸‰åŒæ­¥ï¼ŒToken å“ˆå¸Œä¸èƒ½æ¼ï¼›
ç½‘ç»œæ’ä»¶å¿…é¡»è£…ï¼ŒèŠ‚ç‚¹ Ready æ‰ç®—æˆï¼â€‹&lt;/strong&gt;â€‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•å»ºè®®&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨ &lt;strong&gt;Terraform&lt;/strong&gt; æˆ– &lt;strong&gt;Cluster API&lt;/strong&gt; å®ç°èŠ‚ç‚¹è‡ªåŠ¨åŒ–ç®¡ç†&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼ŒWorker èŠ‚ç‚¹å¯å®‰å…¨åŠ å…¥é›†ç¾¤ã€‚è‹¥éœ€åˆ é™¤èŠ‚ç‚¹ï¼Œéœ€å…ˆæ‰§è¡Œ &lt;code&gt;kubectl drain&lt;/code&gt; é©±é€ Podï¼Œå† &lt;code&gt;kubectl delete node&lt;/code&gt; å¹¶æ¸…ç†èŠ‚ç‚¹é…ç½®&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="k8s--docker"&gt;k8s &amp;amp; Docker
&lt;/h2&gt;&lt;p&gt;Kubernetesï¼ˆK8sï¼‰ä¸ Docker çš„å…³ç³»æ˜¯å®¹å™¨æŠ€æœ¯ç”Ÿæ€ä¸­çš„æ ¸å¿ƒåä½œæ¨¡å¼ï¼ŒäºŒè€…åˆ†å·¥æ˜ç¡®ã€äº’è¡¥å…±å­˜ï¼Œå…±åŒæ„å»ºäº†ç°ä»£äº‘åŸç”Ÿåº”ç”¨çš„åŸºçŸ³ã€‚ä»¥ä¸‹ä»&lt;strong&gt;å®šä½å·®å¼‚&lt;/strong&gt;ã€&lt;strong&gt;åä½œé€»è¾‘&lt;/strong&gt;ã€&lt;strong&gt;æŠ€æœ¯æ¼”è¿›&lt;/strong&gt;å’Œ&lt;strong&gt;å®è·µåœºæ™¯&lt;/strong&gt;å››ä¸ªç»´åº¦å±•å¼€è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€å®šä½ä¸åŒå±‚çº§çš„æŠ€æœ¯è§’è‰²"&gt;ğŸ”§ åŸºç¡€å®šä½ï¼šä¸åŒå±‚çº§çš„æŠ€æœ¯è§’è‰²
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç±»æ¯”&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Docker&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨åŒ–å¼•æ“ï¼šåˆ›å»ºã€æ‰“åŒ…ã€è¿è¡Œ&lt;strong&gt;å•ä¸ªå®¹å™¨&lt;/strong&gt;ï¼Œå®ç°ç¯å¢ƒä¸€è‡´æ€§ä¸éš”ç¦»æ€§&lt;a class="link" href="@ref" &gt;1,2,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;â€œé›†è£…ç®±â€åˆ¶é€ å•†ï¼Œæ ‡å‡†åŒ–åº”ç”¨æ‰“åŒ…ä¸è¿è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨ç¼–æ’å¹³å°ï¼šç®¡ç†&lt;strong&gt;è·¨èŠ‚ç‚¹å®¹å™¨é›†ç¾¤&lt;/strong&gt;ï¼Œå®ç°è‡ªåŠ¨åŒ–è°ƒåº¦ã€æ‰©ç¼©å®¹ã€æ•…éšœæ¢å¤&lt;a class="link" href="@ref" &gt;3,5,7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;â€œå…¨çƒç‰©æµç³»ç»Ÿâ€ï¼Œæ™ºèƒ½è°ƒåº¦æˆåƒä¸Šä¸‡çš„é›†è£…ç®±&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®åŒºåˆ«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Docker èšç„¦&lt;strong&gt;å•æœºå®¹å™¨ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;docker run&lt;/code&gt; å¯åœå®¹å™¨ï¼‰ï¼Œè€Œ K8s è§£å†³&lt;strong&gt;é›†ç¾¤çº§åˆ†å¸ƒå¼ç®¡ç†&lt;/strong&gt;é—®é¢˜ï¼ˆå¦‚è·¨èŠ‚ç‚¹æœåŠ¡å‘ç°ã€æ»šåŠ¨æ›´æ–°ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-åä½œå…³ç³»åˆ†å±‚ååŒçš„å·¥ä½œæµ"&gt;ğŸ¤ åä½œå…³ç³»ï¼šåˆ†å±‚ååŒçš„å·¥ä½œæµ
&lt;/h3&gt;&lt;h4 id="æŠ€æœ¯æ ˆåˆ†å±‚"&gt;&lt;strong&gt;æŠ€æœ¯æ ˆåˆ†å±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[åº”ç”¨ä»£ç ] --&amp;gt; B(Dockeræ„å»ºé•œåƒ)
B --&amp;gt; C(é•œåƒä»“åº“)
C --&amp;gt; D(K8sæ‹‰å–é•œåƒ)
D --&amp;gt; E(Kubeletè°ƒç”¨å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨Pod)
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘é˜¶æ®µ&lt;/strong&gt;ï¼šDocker æ‰“åŒ…åº”ç”¨ä¸ºé•œåƒï¼ˆ&lt;code&gt;Dockerfile&lt;/code&gt; â†’ &lt;code&gt;docker build&lt;/code&gt;ï¼‰ï¼Œæ¨é€è‡³ä»“åº“ï¼ˆå¦‚ Harborï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œé˜¶æ®µ&lt;/strong&gt;ï¼šK8s çš„ &lt;code&gt;kubelet&lt;/code&gt; è°ƒç”¨ &lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶&lt;/strong&gt;ï¼ˆå¦‚ containerdï¼‰æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ï¼Œçº³å…¥ Pod ç®¡ç†å•å…ƒ&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¿è¡Œæ—¶è§£è€¦æŠ€æœ¯æ¼”è¿›"&gt;&lt;strong&gt;è¿è¡Œæ—¶è§£è€¦ï¼ˆæŠ€æœ¯æ¼”è¿›ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—§æ¨¡å¼&lt;/strong&gt;ï¼šK8s ç›´æ¥ä¾èµ– Docker Engineï¼ˆ2020 å¹´å‰ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–°æ¨¡å¼&lt;/strong&gt;ï¼šK8s é€šè¿‡ &lt;strong&gt;CRIï¼ˆContainer Runtime Interfaceï¼‰&lt;/strong&gt; æ ‡å‡†æ¥å£å¯¹æ¥è¿è¡Œæ—¶ï¼Œæ”¯æŒ containerdï¼ˆé»˜è®¤ï¼‰ã€CRI-O ç­‰ï¼Œä¸å†ç»‘å®š Docker&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;å½“å‰ä¸»æµæ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;containerdï¼ˆCNCF æ¯•ä¸šé¡¹ç›®ï¼Œæ€§èƒ½æ›´ä¼˜ï¼‰&lt;/li&gt;
&lt;li&gt;CRI-Oï¼ˆä¸“ä¸º K8s è®¾è®¡çš„è½»é‡çº§è¿è¡Œæ—¶ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h4 id="k8s-å¦‚ä½•æ‰©å±•-docker-èƒ½åŠ›"&gt;&lt;strong&gt;K8s å¦‚ä½•æ‰©å±• Docker èƒ½åŠ›&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Docker å±€é™&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;K8s è¡¥å……èƒ½åŠ›&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½åœºæ™¯å®ä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å•èŠ‚ç‚¹ç®¡ç†&lt;/td&gt;
&lt;td&gt;å¤šèŠ‚ç‚¹é›†ç¾¤è°ƒåº¦&lt;/td&gt;
&lt;td&gt;è·¨æœåŠ¡å™¨è‡ªåŠ¨éƒ¨ç½²å®¹å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— å†…ç½®æœåŠ¡å‘ç°&lt;/td&gt;
&lt;td&gt;Service/Ingress å®ç°è´Ÿè½½å‡è¡¡ä¸DNSå‘ç°&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡é—´é€šä¿¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰‹åŠ¨æ‰©ç¼©å®¹&lt;/td&gt;
&lt;td&gt;HPAï¼ˆHorizontal Pod Autoscalerï¼‰è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©&lt;/td&gt;
&lt;td&gt;æµé‡é«˜å³°æ—¶è‡ªåŠ¨æ‰©å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— æ»šåŠ¨æ›´æ–°æœºåˆ¶&lt;/td&gt;
&lt;td&gt;Deployment æ»šåŠ¨æ›´æ–°ä¸å›æ»š&lt;/td&gt;
&lt;td&gt;é›¶åœæœºå‘å¸ƒæ–°ç‰ˆæœ¬&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒä¸­çš„åä½œé€»è¾‘"&gt;âš™ï¸ ç”Ÿäº§ç¯å¢ƒä¸­çš„åä½œé€»è¾‘
&lt;/h3&gt;&lt;h4 id="é•œåƒç”Ÿå‘½å‘¨æœŸç®¡ç†"&gt;&lt;strong&gt;é•œåƒç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;sequenceDiagram
participant Dev as å¼€å‘è€…
participant Docker as Dockerå¼•æ“
participant Registry as é•œåƒä»“åº“
participant K8s as Kubernetesé›†ç¾¤
Dev-&amp;gt;&amp;gt;Docker: docker build -t myapp:v1
Docker-&amp;gt;&amp;gt;Registry: æ¨é€é•œåƒ
K8s-&amp;gt;&amp;gt;Registry: æ‹‰å–é•œåƒ
K8s-&amp;gt;&amp;gt;Node: è°ƒåº¦Podè¿è¡Œå®¹å™¨
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§ä¿éšœ&lt;/strong&gt;ï¼šDocker ç¡®ä¿å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒé•œåƒä¸€è‡´ï¼›K8s ç¡®ä¿é›†ç¾¤çŠ¶æ€ä¸å£°æ˜å¼é…ç½®ä¸€è‡´&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¿ç»´èƒ½åŠ›å¢å¼º"&gt;&lt;strong&gt;è¿ç»´èƒ½åŠ›å¢å¼º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœè‡ªæ„ˆ&lt;/strong&gt;ï¼šK8s ç›‘æ§ Pod çŠ¶æ€ï¼Œè‡ªåŠ¨é‡å¯å¤±è´¥å®¹å™¨æˆ–è¿ç§»è‡³å¥åº·èŠ‚ç‚¹ï¼ˆNodeControllerï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨/ç½‘ç»œæ‰©å±•ï¼š
&lt;ul&gt;
&lt;li&gt;Docker æä¾›æœ¬åœ°å· â†’ K8s é€šè¿‡ &lt;strong&gt;PV/PVC&lt;/strong&gt; å¯¹æ¥äº‘å­˜å‚¨ï¼ˆå¦‚ AWS EBSï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Docker å•æœºç½‘ç»œ â†’ K8s é€šè¿‡ &lt;strong&gt;CNI æ’ä»¶&lt;/strong&gt;ï¼ˆå¦‚ Calicoï¼‰å®ç°è·¨èŠ‚ç‚¹ç½‘ç»œç­–ç•¥&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯ä¸é€‰æ‹©å»ºè®®"&gt;ğŸš€ é€‚ç”¨åœºæ™¯ä¸é€‰æ‹©å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èå·¥å…·&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æœ¬åœ°å¼€å‘/æµ‹è¯•&lt;/td&gt;
&lt;td&gt;Docker&lt;/td&gt;
&lt;td&gt;è½»é‡å¿«é€Ÿï¼Œæ”¯æŒ &lt;code&gt;docker-compose&lt;/code&gt; æ¨¡æ‹Ÿå¤šæœåŠ¡ç¯å¢ƒ&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å•æœºç®€å•åº”ç”¨éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;Docker&lt;/td&gt;
&lt;td&gt;æ— éœ€å¤æ‚ç¼–æ’ï¼Œèµ„æºå ç”¨ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿäº§çº§å¾®æœåŠ¡é›†ç¾¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨æ‰©ç¼©å®¹ã€æœåŠ¡æ²»ç†ã€é«˜å¯ç”¨ä¿éšœï¼ˆè¶…è¿‡ 3 ä¸ªèŠ‚ç‚¹æ—¶ä¼˜åŠ¿æ˜¾è‘—ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ··åˆäº‘/å¤šé›†ç¾¤ç®¡ç†&lt;/td&gt;
&lt;td&gt;Kubernetes&lt;/td&gt;
&lt;td&gt;é€šè¿‡ Rancher/KubeSphere ç»Ÿä¸€ç®¡æ§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;å¸¸è§è¯¯åŒº&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;âŒ â€œK8s æ›¿ä»£ Dockerâ€ â†’ çœŸç›¸ï¼šK8s ä»ä¾èµ–å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerdï¼‰ï¼Œä½†æ— éœ€å®Œæ•´ Docker å¼•æ“&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;âŒ â€œç”Ÿäº§ç¯å¢ƒåªéœ€ Dockerâ€ â†’ çœŸç›¸ï¼šDocker ç¼ºä¹é›†ç¾¤ç®¡ç†èƒ½åŠ›ï¼Œå¤§è§„æ¨¡è¿ç»´æˆæœ¬å‰§å¢&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-10"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Docker ä¸ K8s æ˜¯å®¹å™¨æŠ€æœ¯æ ˆçš„&lt;strong&gt;äº’è¡¥åŒç¿¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Docker&lt;/strong&gt; è§£å†³â€œåº”ç”¨å¦‚ä½•è·‘èµ·æ¥â€çš„é—®é¢˜ï¼ˆ&lt;strong&gt;æ ‡å‡†åŒ–æ‰“åŒ…ä¸å•æœºè¿è¡Œ&lt;/strong&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;K8s&lt;/strong&gt; è§£å†³â€œåº”ç”¨å¦‚ä½•é«˜æ•ˆã€å¯é åœ°è·‘åœ¨é›†ç¾¤ä¸­â€çš„é—®é¢˜ï¼ˆ&lt;strong&gt;åˆ†å¸ƒå¼è°ƒåº¦ä¸è‡ªåŠ¨åŒ–è¿ç»´&lt;/strong&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚
äºŒè€…é€šè¿‡é•œåƒæ ¼å¼ï¼ˆOCI æ ‡å‡†ï¼‰ã€è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰å®ç°æ— ç¼ååŒï¼Œæ„æˆäº‘åŸç”Ÿæ¶æ„çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="pod"&gt;Pod
&lt;/h2&gt;&lt;p&gt;Pod æ˜¯ Kubernetes ä¸­æœ€å°çš„å¯è°ƒåº¦å’Œç®¡ç†å•å…ƒï¼Œå…¶è®¾è®¡ç†å¿µå’Œå®ç°æœºåˆ¶æ˜¯ç†è§£ Kubernetes æ¶æ„çš„æ ¸å¿ƒã€‚ä»¥ä¸‹ä»&lt;strong&gt;è®¾è®¡åŸç†&lt;/strong&gt;ã€&lt;strong&gt;æ ¸å¿ƒç‰¹ç‚¹&lt;/strong&gt;ã€&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;åŠ&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;å››ä¸ªç»´åº¦å…¨é¢è§£æ Podï¼š&lt;/p&gt;
&lt;h3 id="-pod-çš„è®¾è®¡åŸç†é€»è¾‘ä¸»æœºçš„æŠ½è±¡"&gt;ğŸ”§ Pod çš„è®¾è®¡åŸç†ï¼šé€»è¾‘ä¸»æœºçš„æŠ½è±¡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœ€å°è°ƒåº¦å•å…ƒ&lt;/strong&gt;&lt;br&gt;
Kubernetes ä¸ç›´æ¥ç®¡ç†å®¹å™¨ï¼Œè€Œæ˜¯é€šè¿‡ &lt;strong&gt;Pod&lt;/strong&gt; å°è£…ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå°†å…¶ä½œä¸ºç»Ÿä¸€è°ƒåº¦å•ä½ã€‚æ¯ä¸ª Pod è¢«åˆ†é…å”¯ä¸€çš„ IP å’Œä¸»æœºåï¼Œå†…éƒ¨å®¹å™¨å…±äº«ç½‘ç»œã€å­˜å‚¨å’Œè¿›ç¨‹ç©ºé—´ï¼Œå½¢æˆâ€œé€»è¾‘ä¸»æœºâ€[citation:1][citation:4][citation:5]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«æœºåˆ¶å®ç°&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œå…±äº«&lt;/strong&gt;ï¼šé€šè¿‡ &lt;strong&gt;Pause å®¹å™¨&lt;/strong&gt;ï¼ˆåŸºç¡€æ¶æ„å®¹å™¨ï¼‰åˆ›å»ºå…±äº«çš„ç½‘ç»œå‘½åç©ºé—´ï¼ŒPod å†…å®¹å™¨é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; ç›´æ¥é€šä¿¡[citation:1][citation:5]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨å…±äº«&lt;/strong&gt;ï¼šPod çº§å­˜å‚¨å·ï¼ˆVolumeï¼‰æŒ‚è½½åˆ°æ‰€æœ‰å®¹å™¨ï¼Œå®ç°æ•°æ®äº¤æ¢ä¸æŒä¹…åŒ–ï¼ˆå¦‚ &lt;code&gt;emptyDir&lt;/code&gt; æˆ– &lt;code&gt;PersistentVolume&lt;/code&gt;ï¼‰[citation:2][citation:4]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿›ç¨‹å…±äº«&lt;/strong&gt;ï¼šå¯é€‰å…±äº« PID å‘½åç©ºé—´ï¼Œå®¹å™¨å¯é€šè¿‡è¿›ç¨‹ ID ç›¸äº’è®¿é—®[citation:1]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šå®¹å™¨åä½œæ¨¡å¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sidecar æ¨¡å¼&lt;/strong&gt;ï¼šä¸»å®¹å™¨ï¼ˆå¦‚ Nginxï¼‰ä¸è¾…åŠ©å®¹å™¨ï¼ˆå¦‚æ—¥å¿—æ”¶é›†å™¨ Fluentdï¼‰ååŒå·¥ä½œï¼Œå…±äº«èµ„æº[citation:5]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Adapter æ¨¡å¼&lt;/strong&gt;ï¼šè½¬æ¢ä¸»å®¹å™¨çš„è¾“å‡ºæ ¼å¼ï¼ˆå¦‚åè®®è½¬æ¢ï¼‰[citation:4]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-pod-çš„æ ¸å¿ƒç‰¹ç‚¹"&gt;ğŸ§© Pod çš„æ ¸å¿ƒç‰¹ç‚¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸçŸ­æš‚æ€§&lt;/strong&gt;&lt;br&gt;
Pod æ˜¯ä¸´æ—¶å®ä½“ï¼Œè®¾è®¡ä¸º&lt;strong&gt;ä¸å¯å˜&lt;/strong&gt;ã€‚å½“éœ€æ›´æ–°åº”ç”¨æ—¶ï¼ŒKubernetes ä¼šåˆ›å»ºæ–° Pod å¹¶æ›¿æ¢æ—§ Podï¼Œè€Œéä¿®æ”¹è¿è¡Œä¸­çš„ Pod[citation:4][citation:6]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æ§åˆ¶å™¨è§£è€¦&lt;/strong&gt;&lt;br&gt;
Pod é€šå¸¸ç”±æ§åˆ¶å™¨ï¼ˆå¦‚ Deploymentã€StatefulSetï¼‰ç®¡ç†ï¼Œå®ç°å‰¯æœ¬æ•°ç»´æŠ¤ã€æ»šåŠ¨æ›´æ–°ç­‰èƒ½åŠ›ã€‚è£¸ Podï¼ˆæœªç»‘å®šæ§åˆ¶å™¨ï¼‰åœ¨èŠ‚ç‚¹æ•…éšœåæ— æ³•è‡ªæ„ˆ[citation:4][citation:6]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€é©±åŠ¨ä¸è‡ªæ„ˆèƒ½åŠ›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¢é’ˆæœºåˆ¶&lt;/strong&gt;ï¼šé€šè¿‡æ¢é’ˆç›‘æ§å®¹å™¨å¥åº·çŠ¶æ€ï¼š
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¢é’ˆç±»å‹&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;th&gt;è§¦å‘è¡Œä¸º&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;LivenessProbe&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ£€æµ‹å®¹å™¨æ˜¯å¦å´©æºƒ&lt;/td&gt;
&lt;td&gt;å¤±è´¥åˆ™é‡å¯å®¹å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadinessProbe&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ£€æµ‹å®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡&lt;/td&gt;
&lt;td&gt;å¤±è´¥åˆ™ä» Service ç«¯ç‚¹ç§»é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;StartupProbe&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ£€æµ‹æ…¢å¯åŠ¨å®¹å™¨ï¼ˆå¦‚æ•°æ®åº“åˆå§‹åŒ–ï¼‰&lt;/td&gt;
&lt;td&gt;é€šè¿‡åå…¶ä»–æ¢é’ˆæ‰ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å¯ç­–ç•¥&lt;/strong&gt;ï¼šå®šä¹‰å®¹å™¨é€€å‡ºåçš„è¡Œä¸ºï¼ˆ&lt;code&gt;Always&lt;/code&gt;ã€&lt;code&gt;OnFailure&lt;/code&gt;ã€&lt;code&gt;Never&lt;/code&gt;ï¼‰[citation:1][citation:7]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºéš”ç¦»ä¸é…é¢&lt;/strong&gt;&lt;br&gt;
Pod å¯è®¾ç½® CPU/å†…å­˜çš„ &lt;strong&gt;requestsï¼ˆæœ€ä½ä¿éšœï¼‰&lt;/strong&gt; å’Œ &lt;strong&gt;limitsï¼ˆä¸Šé™ï¼‰&lt;/strong&gt;ï¼Œé˜²æ­¢èµ„æºäº‰æŠ¢[citation:2]ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;resources&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;{&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cpu&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;100m&amp;#34;&lt;/span&gt;&lt;span class="nt"&gt;, memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;64Mi&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;}&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;limits&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;{&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cpu&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;200m&amp;#34;&lt;/span&gt;&lt;span class="nt"&gt;, memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;128Mi&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;}&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-pod-ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€æµè½¬"&gt;â³ Pod ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€æµè½¬
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code class="language-mermaid" data-lang="mermaid"&gt;graph LR
Pending --&amp;gt;|è°ƒåº¦æˆåŠŸ| ContainerCreating
ContainerCreating --&amp;gt;|å®¹å™¨å¯åŠ¨| Running
Running --&amp;gt;|ä»»åŠ¡ç»“æŸ| Succeeded
Running --&amp;gt;|å®¹å™¨å´©æºƒ| Failed
Running --&amp;gt;|ç”¨æˆ·åˆ é™¤| Terminating
Terminating --&amp;gt;|æ¸…ç†å®Œæˆ| Terminated
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®çŠ¶æ€è§£æ&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;çŠ¶æ€&lt;/th&gt;
&lt;th&gt;è§¦å‘åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ’æŸ¥é‡ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Pending&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è°ƒåº¦ä¸­æˆ–é•œåƒæ‹‰å–ä¸­&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹èµ„æº/é•œåƒä»“åº“è®¿é—®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ContainerCreating&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆ›å»ºå®¹å™¨ï¼ˆæŒ‚è½½å­˜å‚¨å·æˆ–åˆ†é… IPï¼‰&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å·ç»‘å®š/CNI æ’ä»¶é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;CrashLoopBackOff&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨åå¤å´©æºƒï¼ˆKubernetes æŒ‰æŒ‡æ•°é€€é¿ç­–ç•¥é‡å¯ï¼‰&lt;/td&gt;
&lt;td&gt;åº”ç”¨æ—¥å¿—/èµ„æºé…é¢/å¯åŠ¨å‘½ä»¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ImagePullBackOff&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é•œåƒæ‹‰å–å¤±è´¥&lt;/td&gt;
&lt;td&gt;é•œåƒæƒé™/ç½‘ç»œè¿é€šæ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜é›…ç»ˆæ­¢æµç¨‹&lt;/strong&gt;&lt;br&gt;
åˆ é™¤ Pod æ—¶è§¦å‘åºåˆ—ï¼š
&lt;pre tabindex="0"&gt;&lt;code class="language-mermaid" data-lang="mermaid"&gt;sequenceDiagram
User-&amp;gt;&amp;gt;API Server: å‘é€åˆ é™¤è¯·æ±‚
API Server-&amp;gt;&amp;gt;kubelet: æ ‡è®° Pod ä¸º Terminating
kubelet-&amp;gt;&amp;gt;Endpoint Controller: ç§»é™¤ Service ç«¯ç‚¹
kubelet-&amp;gt;&amp;gt;å®¹å™¨: å‘é€ SIGTERM ä¿¡å·
å®¹å™¨-&amp;gt;&amp;gt;PreStop Hook: æ‰§è¡Œä¼˜é›…é€€å‡ºé€»è¾‘ï¼ˆå¦‚å®Œæˆè¯·æ±‚å¤„ç†ï¼‰
kubelet-&amp;gt;&amp;gt;å®¹å™¨: è¶…æ—¶åå‘é€ SIGKILLï¼ˆé»˜è®¤ 30 ç§’ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒä¼˜å»ºè®®&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;terminationGracePeriodSeconds&lt;/code&gt; å»¶é•¿å®½é™æœŸ[citation:6][citation:8]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§ç‰¹æ€§ä¸ç”Ÿäº§å®è·µ"&gt;ğŸ› ï¸ é«˜çº§ç‰¹æ€§ä¸ç”Ÿäº§å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–å®¹å™¨ï¼ˆInit Containersï¼‰&lt;/strong&gt;&lt;br&gt;
åœ¨åº”ç”¨å®¹å™¨å¯åŠ¨å‰æ‰§è¡Œï¼Œç”¨äºï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“è¿ç§»æˆ–é…ç½®æ–‡ä»¶ç”Ÿæˆ&lt;/li&gt;
&lt;li&gt;ç­‰å¾…ä¾èµ–æœåŠ¡å°±ç»ªï¼ˆå¦‚æ•°æ®åº“è¿æ¥æ£€æµ‹ï¼‰[citation:6]&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;initContainers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;init-db&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;postgres:14&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;sh&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pg_isready -h db-host&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™æ€ Podï¼ˆStatic Podï¼‰&lt;/strong&gt;&lt;br&gt;
ç”± &lt;strong&gt;kubelet ç›´æ¥ç®¡ç†&lt;/strong&gt;ï¼Œç”¨äºéƒ¨ç½²èŠ‚ç‚¹çº§ç³»ç»Ÿç»„ä»¶ï¼ˆå¦‚ kube-apiserverï¼‰ï¼Œé…ç½®æ–‡ä»¶ä½äºèŠ‚ç‚¹ &lt;code&gt;/etc/kubernetes/manifests&lt;/code&gt;[citation:1]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šå®¹å™¨ Pod è®¾è®¡æ¨¡å¼&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å¼&lt;/th&gt;
&lt;th&gt;åœºæ™¯æ¡ˆä¾‹&lt;/th&gt;
&lt;th&gt;ä¼˜åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Sidecar&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Nginx + Fluentdï¼ˆæ—¥å¿—æ”¶é›†ï¼‰&lt;/td&gt;
&lt;td&gt;æ‰©å±•ä¸»å®¹å™¨åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ambassador&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨å®¹å™¨ + ä»£ç†å®¹å™¨ï¼ˆå¤„ç†å¤–éƒ¨æœåŠ¡è®¿é—®ï¼‰&lt;/td&gt;
&lt;td&gt;ç®€åŒ–ç½‘ç»œç­–ç•¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Adapter&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨å®¹å™¨ + ç›‘æ§å®¹å™¨ï¼ˆæŒ‡æ ‡æ ¼å¼è½¬æ¢ï¼‰&lt;/td&gt;
&lt;td&gt;æ ‡å‡†åŒ–è¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨è£¸ Pod&lt;/strong&gt;ï¼šåŠ¡å¿…é€šè¿‡ Deployment/StatefulSet ç®¡ç†[citation:6]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•œåƒæ ‡å‡†åŒ–&lt;/strong&gt;ï¼šä½¿ç”¨ç²¾ç®€é•œåƒï¼ˆå¦‚ &lt;code&gt;distroless&lt;/code&gt;ï¼‰ï¼Œç¦æ­¢ &lt;code&gt;latest&lt;/code&gt; æ ‡ç­¾[citation:6]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¢é’ˆç²¾ç»†åŒ–é…ç½®&lt;/strong&gt;ï¼šé¿å… &lt;code&gt;LivenessProbe&lt;/code&gt; è¯¯æ€æ…¢å¯åŠ¨åº”ç”¨ï¼ˆè®¾ &lt;code&gt;initialDelaySeconds: 30&lt;/code&gt;ï¼‰[citation:7]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“pod-çš„æ ¸å¿ƒä»·å€¼"&gt;ğŸ’ æ€»ç»“ï¼šPod çš„æ ¸å¿ƒä»·å€¼
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŠ½è±¡é€»è¾‘ä¸»æœº&lt;/strong&gt;ï¼šé€šè¿‡å…±äº«ç½‘ç»œ/å­˜å‚¨è§£å†³å®¹å™¨ååŒé—®é¢˜ï¼Œæ”¯æŒå¤šæ¨¡å¼åä½œ[citation:1][citation:5]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨åŒ–&lt;/strong&gt;ï¼šç»“åˆæ¢é’ˆä¸æ§åˆ¶å™¨å®ç°è‡ªæ„ˆã€æ‰©ç¼©å®¹[citation:4][citation:7]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜åŸºç¡€è®¾æ–½&lt;/strong&gt;ï¼šPod çš„ä¸´æ—¶æ€§æ¨åŠ¨å£°æ˜å¼æ›´æ–°ä¸é›¶åœæœºéƒ¨ç½²[citation:6]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ•…éšœæ’æŸ¥å£è¯€ï¼šPending æŸ¥è°ƒåº¦ï¼ŒCrash æŸ¥æ—¥å¿—ï¼ŒService ä¸é€šæŸ¥ Endpoint å’Œ ReadinessProbe[citation:6][citation:8]ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="æ¢é’ˆ"&gt;æ¢é’ˆ
&lt;/h2&gt;&lt;p&gt;Kubernetes ä¸­çš„æ¢é’ˆï¼ˆProbesï¼‰æ˜¯ç”¨äºç›‘æ§å®¹å™¨å¥åº·çŠ¶æ€çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé€šè¿‡å®šæœŸæ£€æµ‹ç¡®ä¿åº”ç”¨å¯é æ€§å’Œè‡ªæ„ˆèƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§æ¢é’ˆçš„è¯¦ç»†è¯´æ˜ã€åä½œå…³ç³»åŠæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ¢é’ˆç±»å‹ä¸æ ¸å¿ƒåŠŸèƒ½"&gt;ğŸ” &lt;strong&gt;æ¢é’ˆç±»å‹ä¸æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å­˜æ´»æ¢é’ˆliveness-probe"&gt;&lt;strong&gt;å­˜æ´»æ¢é’ˆï¼ˆLiveness Probeï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šæ£€æµ‹å®¹å™¨æ˜¯å¦ä»åœ¨æ­£å¸¸è¿è¡Œã€‚è‹¥å¤±è´¥ï¼ŒKubernetes ä¼šé‡å¯å®¹å™¨ï¼ˆéµå¾ª Pod çš„é‡å¯ç­–ç•¥ï¼‰&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;åº”ç”¨æ­»é”ï¼ˆè¿›ç¨‹å­˜åœ¨ä½†æ— æ³•å“åº”ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å†…å­˜æ³„æ¼å¯¼è‡´æœåŠ¡åƒµæ­»ã€‚&lt;/li&gt;
&lt;li&gt;å†…éƒ¨é€»è¾‘é”™è¯¯ä½¿æœåŠ¡ä¸å¯æ¢å¤&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…¸å‹é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;livenessProbe:
httpGet:
path: /healthz
port: 8080
initialDelaySeconds: 15 # å®¹å™¨å¯åŠ¨åç­‰å¾…15ç§’
periodSeconds: 10 # æ¯10ç§’æ£€æµ‹ä¸€æ¬¡
failureThreshold: 3 # è¿ç»­å¤±è´¥3æ¬¡åé‡å¯
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å°±ç»ªæ¢é’ˆreadiness-probe"&gt;&lt;strong&gt;å°±ç»ªæ¢é’ˆï¼ˆReadiness Probeï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šåˆ¤æ–­å®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚è‹¥å¤±è´¥ï¼ŒKubernetes ä¼šä» Service çš„ Endpoints ä¸­ç§»é™¤è¯¥ Podï¼Œåœæ­¢å‘å…¶è½¬å‘æµé‡ï¼ˆä¸é‡å¯å®¹å™¨ï¼‰&lt;a class="link" href="@ref" &gt;1,6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;åº”ç”¨å¯åŠ¨æ—¶éœ€åŠ è½½å¤§é‡æ•°æ®æˆ–é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ï¼‰æœªå°±ç»ªã€‚&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶è¿‡è½½æ— æ³•å¤„ç†æ–°è¯·æ±‚&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…¸å‹é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;readinessProbe:
tcpSocket:
port: 3306 # æ£€æµ‹ MySQL ç«¯å£
initialDelaySeconds: 5
periodSeconds: 5
timeoutSeconds: 1 # è¶…æ—¶1ç§’è§†ä¸ºå¤±è´¥
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¯åŠ¨æ¢é’ˆstartup-probe"&gt;&lt;strong&gt;å¯åŠ¨æ¢é’ˆï¼ˆStartup Probeï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šç¡®ä¿æ…¢å¯åŠ¨åº”ç”¨å®Œæˆåˆå§‹åŒ–ã€‚åœ¨å¯åŠ¨æ¢é’ˆæˆåŠŸå‰ï¼Œ&lt;strong&gt;å­˜æ´»/å°±ç»ªæ¢é’ˆä¸ä¼šç”Ÿæ•ˆ&lt;/strong&gt;ã€‚è‹¥å¤±è´¥ï¼Œå®¹å™¨ä¼šè¢«é‡å¯&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;Java åº”ç”¨ï¼ˆå¯åŠ¨è€—æ—¶æ•°åˆ†é’Ÿï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€åˆå§‹åŒ–æ•°æ®åº“æˆ–åŠ è½½å¤§æ–‡ä»¶çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…å­˜æ´»æ¢é’ˆè¿‡æ—©æ€æ­»æœªå®Œæˆå¯åŠ¨çš„å®¹å™¨&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…¸å‹é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;startupProbe:
httpGet:
path: /startup
port: 8080
failureThreshold: 30 # å…è®¸å¤±è´¥30æ¬¡ï¼ˆæ€»ç­‰å¾…æ—¶é—´ = 30 * periodSecondsï¼‰
periodSeconds: 10 # æœ€é•¿å®¹å¿300ç§’å¯åŠ¨æ—¶é—´
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ¢é’ˆçš„å®ç°æ–¹å¼"&gt;âš™ï¸ &lt;strong&gt;æ¢é’ˆçš„å®ç°æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸‰ç§æ¢é’ˆå‡æ”¯æŒä»¥ä¸‹æ£€æµ‹æœºåˆ¶ï¼š
1.
HTTP GET&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘å®¹å™¨å‘é€ HTTP è¯·æ±‚ï¼ŒçŠ¶æ€ç  &lt;code&gt;2xx&lt;/code&gt; æˆ– &lt;code&gt;3xx&lt;/code&gt; è§†ä¸ºæˆåŠŸã€‚
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨ Web æœåŠ¡ï¼ˆå¦‚ Nginxã€API æœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;1,7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;TCP Socket&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å°è¯•ä¸å®¹å™¨ç«¯å£å»ºç«‹ TCP è¿æ¥ï¼ŒæˆåŠŸå³é€šè¿‡ã€‚
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨æ•°æ®åº“ã€ç¼“å­˜ç­‰é HTTP æœåŠ¡ï¼ˆå¦‚ MySQLã€Redisï¼‰&lt;a class="link" href="@ref" &gt;2,6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;Exec å‘½ä»¤&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›å€¼ä¸º &lt;code&gt;0&lt;/code&gt; å³æˆåŠŸã€‚
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨è‡ªå®šä¹‰æ£€æŸ¥é€»è¾‘ï¼ˆå¦‚æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼‰&lt;a class="link" href="@ref" &gt;4,6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;livenessProbe:
exec:
command: [&amp;#34;sh&amp;#34;, &amp;#34;-c&amp;#34;, &amp;#34;pgrep java&amp;#34;] # æ£€æŸ¥ Java è¿›ç¨‹
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®é…ç½®å‚æ•°"&gt;âš ï¸ &lt;strong&gt;å…³é”®é…ç½®å‚æ•°&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å‚æ•°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;initialDelaySeconds&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨å¯åŠ¨åé¦–æ¬¡æ¢æµ‹çš„ç­‰å¾…æ—¶é—´&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¿…é¡»è®¾ç½®&lt;/strong&gt;ï¼é¿å…åº”ç”¨æœªå¯åŠ¨å®Œæˆå³è¢«åˆ¤å®šå¤±è´¥&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;periodSeconds&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¢æµ‹é—´éš”æ—¶é—´&lt;/td&gt;
&lt;td&gt;10 ç§’&lt;/td&gt;
&lt;td&gt;é«˜è´Ÿè½½åº”ç”¨å¯é€‚å½“å»¶é•¿ï¼Œå‡å°‘æ¢æµ‹å‹åŠ›ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;timeoutSeconds&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å•æ¬¡æ¢æµ‹è¶…æ—¶æ—¶é—´&lt;/td&gt;
&lt;td&gt;1 ç§’&lt;/td&gt;
&lt;td&gt;ç½‘ç»œå»¶è¿Ÿé«˜æ—¶éœ€è°ƒå¤§ï¼ˆå¦‚è®¾ä¸º 3 ç§’ï¼‰&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;failureThreshold&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿ç»­å¤±è´¥æ¬¡æ•°ååˆ¤å®šä¸ºæœ€ç»ˆå¤±è´¥&lt;/td&gt;
&lt;td&gt;3 æ¬¡&lt;/td&gt;
&lt;td&gt;å¯åŠ¨æ¢é’ˆéœ€è®¾è¾ƒå¤§å€¼ï¼ˆå¦‚ 30ï¼‰ä»¥å…¼å®¹æ…¢å¯åŠ¨åº”ç”¨&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;successThreshold&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿ç»­æˆåŠŸæ¬¡æ•°ååˆ¤å®šä¸ºæœ€ç»ˆæˆåŠŸ&lt;/td&gt;
&lt;td&gt;1 æ¬¡&lt;/td&gt;
&lt;td&gt;å­˜æ´»/å¯åŠ¨æ¢é’ˆå¿…é¡»ä¸º 1ï¼›å°±ç»ªæ¢é’ˆå¯è°ƒé«˜ä»¥é¿å…æŠ–åŠ¨&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ¢é’ˆåä½œå…³ç³»ä¸æ‰§è¡Œé¡ºåº"&gt;ğŸ”„ &lt;strong&gt;æ¢é’ˆåä½œå…³ç³»ä¸æ‰§è¡Œé¡ºåº&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¯åŠ¨é˜¶æ®µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨æ¢é’ˆ&lt;/strong&gt; ä¼˜å…ˆæ‰§è¡Œï¼ŒæˆåŠŸåæ‰å¯ç”¨å­˜æ´»/å°±ç»ªæ¢é’ˆ&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹ï¼šJava åº”ç”¨å¯åŠ¨éœ€ 3 åˆ†é’Ÿï¼Œå¯åŠ¨æ¢é’ˆé…ç½® &lt;code&gt;failureThreshold: 30&lt;/code&gt;ï¼ˆå‘¨æœŸ 10 ç§’ï¼‰ï¼Œæœ€é•¿å®¹å¿ 300 ç§’åˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿è¡Œé˜¶æ®µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜æ´»æ¢é’ˆ&lt;/strong&gt; å‘¨æœŸæ€§æ£€æŸ¥ï¼Œå¤±è´¥åˆ™é‡å¯å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°±ç»ªæ¢é’ˆ&lt;/strong&gt; å‘¨æœŸæ€§æ£€æŸ¥ï¼Œå¤±è´¥åˆ™ä» Service æ‘˜é™¤æµé‡ï¼ˆä½†&lt;strong&gt;ä¸é‡å¯&lt;/strong&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;ä¸‰è€…ä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;code&gt;Startup &amp;gt; Liveness &amp;amp; Readiness&lt;/code&gt; &lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—-1"&gt;ğŸ› ï¸ &lt;strong&gt;æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åŒºåˆ†æ¢é’ˆç”¨é€”ï¼š
&lt;ul&gt;
&lt;li&gt;å­˜æ´»æ¢é’ˆ â†’ å¤„ç†&lt;strong&gt;ä¸å¯æ¢å¤æ•…éšœ&lt;/strong&gt;ï¼ˆéœ€é‡å¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å°±ç»ªæ¢é’ˆ â†’ å¤„ç†&lt;strong&gt;ä¸´æ—¶ä¸å¯ç”¨&lt;/strong&gt;ï¼ˆéœ€æ‘˜æµé‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯åŠ¨æ¢é’ˆ â†’ &lt;strong&gt;å…¼å®¹æ…¢å¯åŠ¨åº”ç”¨&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¿å…è¿‡åº¦é‡å¯ï¼š
&lt;ul&gt;
&lt;li&gt;é¢‘ç¹é‡å¯å¯èƒ½æ©ç›–æ ¹æœ¬é—®é¢˜ï¼ˆå¦‚ä»£ç  Bugï¼‰ï¼Œéœ€ç»“åˆæ—¥å¿—åˆ†æ&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é•¿æ—¶ä»»åŠ¡å¤„ç†ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰¹å¤„ç†ä»»åŠ¡ï¼ˆå¦‚ Jobï¼‰å¯èƒ½æ— éœ€å­˜æ´»æ¢é’ˆï¼Œé¿å…ä»»åŠ¡ä¸­é€”è¢«é‡å¯&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å‚æ•°è°ƒä¼˜ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# Java æœåŠ¡å®Œæ•´é…ç½®
startupProbe: # å…è®¸æœ€é•¿ 5 åˆ†é’Ÿå¯åŠ¨
httpGet:
path: /startup
port: 8080
failureThreshold: 30
periodSeconds: 10
livenessProbe: # å¯åŠ¨æ¢é’ˆæˆåŠŸåç”Ÿæ•ˆ
httpGet:
path: /health
port: 8080
initialDelaySeconds: 20 # é¢„ç•™ç¼“å†²æ—¶é—´
readinessProbe: # æ£€æŸ¥ä¾èµ–é¡¹ï¼ˆå¦‚æ•°æ®åº“ï¼‰
httpGet:
path: /ready
port: 8080
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-11"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜æ´»æ¢é’ˆ&lt;/strong&gt;ï¼šä¿éšœè¿è¡Œæ—¶å¥åº·ï¼Œå¤±è´¥è§¦å‘é‡å¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°±ç»ªæ¢é’ˆ&lt;/strong&gt;ï¼šæ§åˆ¶æµé‡å‡†å…¥ï¼Œå¤±è´¥æš‚åœè¯·æ±‚è½¬å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨æ¢é’ˆ&lt;/strong&gt;ï¼šä¿æŠ¤æ…¢å¯åŠ¨åº”ç”¨ï¼Œé¿å…è¯¯æ€åˆå§‹åŒ–ä¸­çš„å®¹å™¨ã€‚
â€‹&lt;strong&gt;å…³é”®é…ç½®&lt;/strong&gt;â€‹ï¼š&lt;code&gt;initialDelaySeconds&lt;/code&gt; å¿…é¡»è®¾ç½®ï¼Œ&lt;code&gt;failureThreshold&lt;/code&gt; éœ€æŒ‰åº”ç”¨å¯åŠ¨æ—¶é—´è°ƒæ•´ã€‚é€šè¿‡ä¸‰ç±»æ¢é’ˆåä½œï¼ŒKubernetes å®ç°äº†åº”ç”¨è‡ªæ„ˆã€æµé‡ç²¾ç»†æ§åˆ¶ä¸æ…¢å¯åŠ¨å…¼å®¹æ€§ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒé«˜å¯ç”¨çš„æ ¸å¿ƒæœºåˆ¶&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å­˜å‚¨"&gt;å­˜å‚¨
&lt;/h2&gt;&lt;p&gt;Kubernetes ä¸­çš„å­˜å‚¨ç³»ç»Ÿæ˜¯æ”¯æ’‘æœ‰çŠ¶æ€åº”ç”¨çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡æŠ½è±¡å±‚å®ç°æ•°æ®æŒä¹…åŒ–ã€å…±äº«å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ä»¥ä¸‹ä»&lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;/strong&gt;ã€&lt;strong&gt;å­˜å‚¨ç±»å‹&lt;/strong&gt;ã€&lt;strong&gt;å·¥ä½œæœºåˆ¶&lt;/strong&gt;å’Œ&lt;strong&gt;ç”Ÿäº§å®è·µ&lt;/strong&gt;å››ä¸ªç»´åº¦å±•å¼€è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„"&gt;ğŸ”‘ &lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å­˜å‚¨å·volume"&gt;&lt;strong&gt;å­˜å‚¨å·ï¼ˆVolumeï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šPod çº§åˆ«çš„å­˜å‚¨æŠ½è±¡ï¼Œç”¨äºå®¹å™¨é—´å…±äº«æ•°æ®æˆ–æŒä¹…åŒ–æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼šä¸ Pod ç»‘å®šï¼ˆä¸´æ—¶å·ï¼‰æˆ–ç‹¬ç«‹äº Podï¼ˆæŒä¹…å·ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸´æ—¶å·&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;emptyDir&lt;/code&gt;ï¼Œéš Pod é”€æ¯è€Œåˆ é™¤&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…å·&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;PersistentVolume&lt;/code&gt;ï¼ˆPVï¼‰ï¼Œæ•°æ®ç‹¬ç«‹äº Pod å­˜åœ¨&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æŒä¹…å·persistentvolume-pv"&gt;&lt;strong&gt;æŒä¹…å·ï¼ˆPersistentVolume, PVï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è§’è‰²&lt;/strong&gt;ï¼šé›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç£ç›˜ã€NFSï¼‰ï¼Œç”±ç®¡ç†å‘˜é¢„å…ˆåˆ›å»ºæˆ–åŠ¨æ€ä¾›ç»™&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®å±æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;capacity&lt;/code&gt;ï¼šå­˜å‚¨å®¹é‡ï¼ˆå¦‚ 100Giï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;accessModes&lt;/code&gt;ï¼šè®¿é—®æ¨¡å¼ï¼ˆ&lt;code&gt;ReadWriteOnce&lt;/code&gt;ã€&lt;code&gt;ReadOnlyMany&lt;/code&gt;ã€&lt;code&gt;ReadWriteMany&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;reclaimPolicy&lt;/code&gt;ï¼šå›æ”¶ç­–ç•¥ï¼ˆ&lt;code&gt;Retain&lt;/code&gt;/&lt;code&gt;Delete&lt;/code&gt;/&lt;code&gt;Recycle&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æŒä¹…å·å£°æ˜persistentvolumeclaim-pvc"&gt;&lt;strong&gt;æŒä¹…å·å£°æ˜ï¼ˆPersistentVolumeClaim, PVCï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è§’è‰²&lt;/strong&gt;ï¼šç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚ï¼ˆå¦‚ç”³è¯· 50Gi ç©ºé—´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œæµç¨‹&lt;/strong&gt;ï¼šPVC ç»‘å®š PV â†’ Pod æŒ‚è½½ PVC â†’ å®¹å™¨ä½¿ç”¨å­˜å‚¨&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å­˜å‚¨ç±»storageclass-sc"&gt;&lt;strong&gt;å­˜å‚¨ç±»ï¼ˆStorageClass, SCï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåŠ¨æ€åˆ›å»º PV çš„æ¨¡æ¿ï¼Œå®šä¹‰å­˜å‚¨åç«¯ï¼ˆå¦‚ AWS EBSã€Cephï¼‰å’Œå‚æ•°&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒé…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
name: fast-ssd
provisioner: kubernetes.io/aws-ebs # å­˜å‚¨é©±åŠ¨
reclaimPolicy: Retain
volumeBindingMode: WaitForFirstConsumer # å»¶è¿Ÿç»‘å®š
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å­˜å‚¨ç±»å‹è¯¦è§£"&gt;ğŸ§© &lt;strong&gt;å­˜å‚¨ç±»å‹è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æœ¬åœ°å­˜å‚¨"&gt;&lt;strong&gt;æœ¬åœ°å­˜å‚¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;emptyDir&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šPod å†…å®¹å™¨å…±äº«ä¸´æ—¶æ•°æ®ï¼ˆå¦‚ç¼“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ•°æ®éš Pod åˆ é™¤è€Œé”€æ¯ï¼Œæ”¯æŒå†…å­˜æŒ‚è½½ï¼ˆ&lt;code&gt;emptyDir.medium: Memory&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;volumes:
- name: cache
emptyDir:
sizeLimit: 512Mi # ç©ºé—´é™åˆ¶
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;hostPath&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šè®¿é—®èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶ï¼ˆå¦‚æ”¶é›†èŠ‚ç‚¹æ—¥å¿—ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;ï¼šæ•°æ®ä¸èŠ‚ç‚¹ç»‘å®šï¼ŒPod è·¨èŠ‚ç‚¹è°ƒåº¦æ—¶æ•°æ®ä¸¢å¤±ï¼›éœ€é…åˆ &lt;code&gt;nodeAffinity&lt;/code&gt; ä½¿ç”¨&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼ˆå®‰å…¨é£é™©ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç½‘ç»œå­˜å‚¨"&gt;&lt;strong&gt;ç½‘ç»œå­˜å‚¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶å­˜å‚¨ï¼ˆNFS/CephFSï¼‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šæ”¯æŒå¤šèŠ‚ç‚¹è¯»å†™ï¼ˆ&lt;code&gt;ReadWriteMany&lt;/code&gt;ï¼‰ï¼Œé€‚åˆå…±äº«é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;volumes:
- name: nfs-vol
nfs:
server: 192.168.1.100
path: /data
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å—å­˜å‚¨ï¼ˆiSCSI/RBDï¼‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé«˜æ€§èƒ½ï¼ˆä½å»¶è¿Ÿï¼‰ï¼Œé€‚ç”¨äºæ•°æ®åº“&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™&lt;/strong&gt;ï¼šé€šå¸¸ä»…æ”¯æŒ &lt;code&gt;ReadWriteOnce&lt;/code&gt;ï¼ˆå•èŠ‚ç‚¹ç‹¬å è®¿é—®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="äº‘å­˜å‚¨"&gt;&lt;strong&gt;äº‘å­˜å‚¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;ï¼šAWS EBSã€Azure Diskã€GCP Persistent Diskã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†æˆ&lt;/strong&gt;ï¼šé€šè¿‡ CSIï¼ˆContainer Storage Interfaceï¼‰æ’ä»¶åŠ¨æ€ä¾›ç»™&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®å‹å­˜å‚¨"&gt;&lt;strong&gt;é…ç½®å‹å­˜å‚¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;**
&lt;pre tabindex="0"&gt;&lt;code&gt;ConfigMap
&lt;/code&gt;&lt;/pre&gt;/
&lt;pre tabindex="0"&gt;&lt;code&gt;Secret
&lt;/code&gt;&lt;/pre&gt;**ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå°†é…ç½®æˆ–æ•æ„Ÿæ•°æ®æ³¨å…¥å®¹å™¨ï¼ˆå¦‚æŒ‚è½½ä¸ºæ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒºåˆ«&lt;/strong&gt;ï¼š&lt;code&gt;Secret&lt;/code&gt; æ•°æ®åŠ å¯†å­˜å‚¨ï¼Œ&lt;code&gt;ConfigMap&lt;/code&gt; æ˜æ–‡å­˜å‚¨&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æŒä¹…åŒ–å­˜å‚¨å·¥ä½œæµç¨‹"&gt;âš™ï¸ &lt;strong&gt;æŒä¹…åŒ–å­˜å‚¨å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é™æ€ä¾›ç»™"&gt;&lt;strong&gt;é™æ€ä¾›ç»™&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;ç®¡ç†å‘˜åˆ›å»º PVï¼ˆå¦‚ NFS å·ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·åˆ›å»º PVC è¯·æ±‚å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ç»‘å®š PVC ä¸åŒ¹é…çš„ PV&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åŠ¨æ€ä¾›ç»™"&gt;&lt;strong&gt;åŠ¨æ€ä¾›ç»™&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·åˆ›å»º PVCï¼ˆæŒ‡å®š StorageClassï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;StorageClass è°ƒç”¨ Provisionerï¼ˆå¦‚ Ceph CSIï¼‰åŠ¨æ€åˆ›å»º PVã€‚&lt;/li&gt;
&lt;li&gt;PVC è‡ªåŠ¨ç»‘å®šæ–° PV&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æŒ‚è½½åˆ°-pod"&gt;&lt;strong&gt;æŒ‚è½½åˆ° Pod&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
containers:
- volumeMounts:
- name: data
mountPath: /app/data
volumes:
- name: data
persistentVolumeClaim:
claimName: my-pvc # å¼•ç”¨ PVC
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ-3"&gt;ğŸ› ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å­˜å‚¨é€‰å‹ç­–ç•¥"&gt;&lt;strong&gt;å­˜å‚¨é€‰å‹ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;éœ€æ±‚åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èå­˜å‚¨ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸´æ—¶ç¼“å­˜&lt;/td&gt;
&lt;td&gt;&lt;code&gt;emptyDir&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Redis ä¸´æ—¶æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤šèŠ‚ç‚¹è¯»å†™å…±äº«&lt;/td&gt;
&lt;td&gt;NFS/CephFS&lt;/td&gt;
&lt;td&gt;å…±äº«é…ç½®æ–‡ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®åº“æŒä¹…åŒ–&lt;/td&gt;
&lt;td&gt;å—å­˜å‚¨ï¼ˆäº‘ç›˜/Ceph RBDï¼‰&lt;/td&gt;
&lt;td&gt;MySQL PVC + SSD StorageClass&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•æ„Ÿæ•°æ®æ³¨å…¥&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Secret&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å¯†ç &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å…³é”®é…ç½®ä¼˜åŒ–"&gt;&lt;strong&gt;å…³é”®é…ç½®ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿç»‘å®š&lt;/strong&gt;ï¼ˆ&lt;code&gt;volumeBindingMode: WaitForFirstConsumer&lt;/code&gt;ï¼‰ï¼š
é¿å… PV æå‰ç»‘å®šåˆ°ä¸æ»¡è¶³è°ƒåº¦æ¡ä»¶çš„èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨é…é¢&lt;/strong&gt;ï¼š
é€šè¿‡ &lt;code&gt;ResourceQuota&lt;/code&gt; é™åˆ¶å‘½åç©ºé—´çš„ PVC æ•°é‡å’Œæ€»å®¹é‡&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®é«˜å¯ç”¨&lt;/strong&gt;ï¼š
åˆ†å¸ƒå¼å­˜å‚¨ï¼ˆå¦‚ Cephï¼‰æä¾›è·¨èŠ‚ç‚¹å†—ä½™&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ•…éšœæ’æŸ¥æŒ‡å—"&gt;&lt;strong&gt;æ•…éšœæ’æŸ¥æŒ‡å—&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;PVC é•¿æœŸ Pendingï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥ StorageClass é…ç½®æ˜¯å¦æ­£ç¡®&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®è®¤ PV èµ„æºå……è¶³æˆ– Provisioner è¿è¡Œæ­£å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ Provisioner æ—¥å¿—ï¼š&lt;code&gt;kubectl logs -n kube-system &amp;lt;provisioner-pod&amp;gt;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æŒ‚è½½å¤±è´¥ï¼š
&lt;ul&gt;
&lt;li&gt;éªŒè¯è®¿é—®æ¨¡å¼ï¼ˆå¦‚ &lt;code&gt;ReadWriteMany&lt;/code&gt; éœ€æ–‡ä»¶å­˜å‚¨æ”¯æŒï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥ç½‘ç»œå­˜å‚¨åç«¯è¿é€šæ€§ï¼ˆå¦‚ NFS æœåŠ¡å™¨çŠ¶æ€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-12"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubernetes å­˜å‚¨ä½“ç³»é€šè¿‡ &lt;strong&gt;PV/PVC è§£è€¦&lt;/strong&gt;åº”ç”¨ä¸åº•å±‚å­˜å‚¨ï¼Œç»“åˆ &lt;strong&gt;StorageClass åŠ¨æ€ä¾›ç»™&lt;/strong&gt;ç®€åŒ–ç®¡ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸´æ—¶å­˜å‚¨&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;emptyDir&lt;/code&gt;ï¼‰ç”¨äº Pod å†…å®¹å™¨å…±äº«ï¼Œ&lt;strong&gt;æŒä¹…å­˜å‚¨&lt;/strong&gt;ï¼ˆå¦‚ PVï¼‰ä¿éšœæ•°æ®ç”Ÿå­˜å‘¨æœŸ&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œ/äº‘å­˜å‚¨&lt;/strong&gt;è§£å†³è·¨èŠ‚ç‚¹æ•°æ®å…±äº«ä¸é«˜å¯ç”¨ï¼Œ&lt;strong&gt;CSI æ’ä»¶&lt;/strong&gt;æ‰©å±•ç¬¬ä¸‰æ–¹å­˜å‚¨é›†æˆèƒ½åŠ›&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§å…³é”®&lt;/strong&gt;ï¼šæ ¹æ®æ€§èƒ½ï¼ˆIOPSï¼‰ã€è®¿é—®æ¨¡å¼ï¼ˆRWO/RWXï¼‰ã€æŒä¹…æ€§éœ€æ±‚é€‰æ‹©å­˜å‚¨æ–¹æ¡ˆï¼Œå¹¶ç›‘æ§å­˜å‚¨ä½¿ç”¨ä¸å¥åº·çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="storage-class"&gt;Storage Class
&lt;/h2&gt;&lt;p&gt;StorageClassï¼ˆå­˜å‚¨ç±»ï¼‰æ˜¯ Kubernetes ä¸­ç”¨äº&lt;strong&gt;åŠ¨æ€ç®¡ç†æŒä¹…åŒ–å­˜å‚¨&lt;/strong&gt;çš„æ ¸å¿ƒèµ„æºå¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†å­˜å‚¨çš„ç±»å‹ã€ä¾›åº”ç­–ç•¥å’Œç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼Œä½¿ç®¡ç†å‘˜èƒ½å¤ŸæŠ½è±¡åº•å±‚å­˜å‚¨ç»†èŠ‚ï¼Œç”¨æˆ·åªéœ€é€šè¿‡ PVCï¼ˆPersistentVolumeClaimï¼‰æŒ‰éœ€ç”³è¯·å­˜å‚¨èµ„æºã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¦ç‚¹è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒä½œç”¨ä¸ä»·å€¼"&gt;ğŸ”‘ &lt;strong&gt;æ ¸å¿ƒä½œç”¨ä¸ä»·å€¼&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€å­˜å‚¨ä¾›åº”ï¼ˆDynamic Provisioningï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨åˆ›å»º PVï¼šå½“ç”¨æˆ·åˆ›å»º PVC æ—¶ï¼ŒStorageClass æ ¹æ®é¢„å®šä¹‰æ¨¡æ¿è‡ªåŠ¨ç”ŸæˆåŒ¹é…çš„ PVï¼Œæ— éœ€ç®¡ç†å‘˜æ‰‹åŠ¨é¢„é…&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç®€åŒ–å­˜å‚¨ç®¡ç†ï¼šé€‚ç”¨äºäº‘ç¯å¢ƒï¼ˆå¦‚ AWS EBSã€GCP PDï¼‰åŠåˆ†å¸ƒå¼å­˜å‚¨ï¼ˆå¦‚ Cephã€NFSï¼‰ï¼Œå¤§å¹…é™ä½è¿ç»´å¤æ‚åº¦&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨ç­–ç•¥æŠ½è±¡åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰å­˜å‚¨ç±»å‹ï¼ˆå¦‚ SSD/HDDï¼‰ã€æ€§èƒ½å‚æ•°ï¼ˆIOPSã€ååé‡ï¼‰ã€è®¿é—®æ¨¡å¼ï¼ˆRWO/RWXï¼‰å’Œå›æ”¶ç­–ç•¥ï¼Œç”¨æˆ·é€šè¿‡ PVC æŒ‰éœ€é€‰æ‹©&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šåœºæ™¯é€‚é…&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒäº‘å­˜å‚¨ã€æœ¬åœ°å­˜å‚¨ã€ç½‘ç»œå­˜å‚¨ç­‰å¤šç§åç«¯ï¼Œé€šè¿‡ä¸åŒ StorageClass åŒºåˆ†é«˜æ€§èƒ½ä¸ä½æˆæœ¬å­˜å‚¨&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå‚æ•°è¯¦è§£"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒå‚æ•°è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;StorageClass çš„ YAML é…ç½®åŒ…å«ä»¥ä¸‹å…³é”®å­—æ®µï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
name: fast-ssd
annotations:
storageclass.kubernetes.io/is-default-class: &amp;#34;true&amp;#34; # è®¾ä¸ºé»˜è®¤å­˜å‚¨ç±»
provisioner: ebs.csi.aws.com # å­˜å‚¨é©±åŠ¨ï¼ˆå¦‚ AWS EBS CSIï¼‰
parameters: # å­˜å‚¨åç«¯å‚æ•°
type: gp3
iops: &amp;#34;5000&amp;#34;
reclaimPolicy: Retain # å›æ”¶ç­–ç•¥ï¼ˆDelete/Retainï¼‰
allowVolumeExpansion: true # å…è®¸å­˜å‚¨æ‰©å®¹
volumeBindingMode: WaitForFirstConsumer # å·ç»‘å®šæ¨¡å¼
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;provisioner&lt;/code&gt;ï¼ˆå­˜å‚¨ä¾›åº”å™¨ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæŒ‡å®šå­˜å‚¨é©±åŠ¨ï¼Œè´Ÿè´£ PV çš„åˆ›å»º/åˆ é™¤/æ‰©å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;å†…ç½®é©±åŠ¨ï¼ˆå¦‚ &lt;code&gt;kubernetes.io/aws-ebs&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰é©±åŠ¨ï¼ˆå¦‚ NFS Provisioner &lt;code&gt;nfs-provisioner&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;reclaimPolicy&lt;/code&gt;ï¼ˆå›æ”¶ç­–ç•¥ï¼‰&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Delete&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆ é™¤ PVC æ—¶è‡ªåŠ¨é”€æ¯ PV åŠåº•å±‚å­˜å‚¨ï¼ˆå¦‚äº‘ç£ç›˜ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;éå…³é”®æ•°æ®ï¼ˆèŠ‚çœæˆæœ¬ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Retain&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¿ç•™ PV å’Œå­˜å‚¨æ•°æ®ï¼Œéœ€æ‰‹åŠ¨æ¸…ç†&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒå…³é”®æ•°æ®ï¼ˆé˜²è¯¯åˆ ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;volumeBindingMode&lt;/code&gt;ï¼ˆå·ç»‘å®šæ¨¡å¼ï¼‰&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Immediate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;PVC åˆ›å»ºåç«‹å³ç»‘å®š PV&lt;/td&gt;
&lt;td&gt;äº‘å­˜å‚¨ï¼ˆä¸èŠ‚ç‚¹ä½ç½®æ— å…³ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;WaitForFirstConsumer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å»¶è¿Ÿåˆ° Pod è°ƒåº¦æ—¶å†ç»‘å®š PVï¼Œç¡®ä¿å­˜å‚¨ä¸ Pod åœ¨åŒä¸€å¯ç”¨åŒº/èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;æœ¬åœ°å­˜å‚¨ï¼ˆå¦‚ SSDï¼‰ã€åŒºåŸŸæ€§äº‘å­˜å‚¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;allowVolumeExpansion&lt;/code&gt;ï¼ˆå­˜å‚¨æ‰©å®¹ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œå¯é€šè¿‡ç¼–è¾‘ PVC çš„ &lt;code&gt;spec.resources.requests.storage&lt;/code&gt; åŠ¨æ€æ‰©å®¹ï¼ˆéœ€å­˜å‚¨é©±åŠ¨æ”¯æŒï¼Œå¦‚ AWS EBSã€Ceph RBDï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;parameters&lt;/code&gt;ï¼ˆå­˜å‚¨å‚æ•°ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰å­˜å‚¨åç«¯çš„é…ç½®ï¼Œä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;AWS EBSï¼šç£ç›˜ç±»å‹ï¼ˆ&lt;code&gt;gp3&lt;/code&gt;/&lt;code&gt;io1&lt;/code&gt;ï¼‰ã€IOPS å€¼&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;NFSï¼šæ˜¯å¦ä¿ç•™æ•°æ®ï¼ˆ&lt;code&gt;archiveOnDelete: &amp;quot;false&amp;quot;&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åŠ¨æ€å­˜å‚¨ä¾›åº”æµç¨‹"&gt;ğŸ”„ &lt;strong&gt;åŠ¨æ€å­˜å‚¨ä¾›åº”æµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·åˆ›å»º PVC&lt;/strong&gt;
æŒ‡å®š StorageClass åç§°ã€å®¹é‡å’Œè®¿é—®æ¨¡å¼ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kind: PersistentVolumeClaim
spec:
storageClassName: fast-ssd # å…³è” StorageClass
accessModes: [ReadWriteOnce]
resources:
requests:
storage: 100Gi
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åˆ›å»º PV&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;StorageClass çš„ &lt;code&gt;provisioner&lt;/code&gt; æ ¹æ® PVC è¯·æ±‚åˆ›å»º PV&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ &lt;code&gt;volumeBindingMode=WaitForFirstConsumer&lt;/code&gt;ï¼Œåˆ™ç­‰å¾… Pod è°ƒåº¦æ—¶å†åˆ›å»º PV&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PVC ä¸ PV ç»‘å®š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç»‘å®šæˆåŠŸåï¼ŒPod æŒ‚è½½ PVC å³å¯ä½¿ç”¨å­˜å‚¨&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-2"&gt;ğŸ§© &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº‘å­˜å‚¨åŠ¨æ€åˆ†é…&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨ AWS ä¸­ä¸ºæ•°æ®åº“åŠ¨æ€ç”³è¯· EBS å·ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;provisioner: ebs.csi.aws.com
parameters:
type: gp3
volumeBindingMode: WaitForFirstConsumer # ç¡®ä¿å·ä¸ Pod åœ¨åŒä¸€å¯ç”¨åŒº
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ¬åœ°å­˜å‚¨ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šä½¿ç”¨èŠ‚ç‚¹æœ¬åœ° SSD è¿è¡Œ Redisã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;provisioner: kubernetes.io/no-provisioner # éœ€æ‰‹åŠ¨é¢„åˆ›å»º PV
volumeBindingMode: WaitForFirstConsumer # å»¶è¿Ÿç»‘å®šè‡³ç›®æ ‡èŠ‚ç‚¹
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå¤š Pod å…±äº«é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼šéƒ¨ç½² NFS Provisioner å¹¶å®šä¹‰ StorageClass&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šå­˜å‚¨ç­–ç•¥ç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåŒºåˆ†é«˜æ€§èƒ½ SSD ä¸ä½æˆæœ¬ HDDã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;ï¼šåˆ›å»ºå¤šä¸ª StorageClassï¼ˆå¦‚ &lt;code&gt;fast-ssd&lt;/code&gt; å’Œ &lt;code&gt;standard-hdd&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è®¾ç½®é»˜è®¤ StorageClass&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡æ³¨è§£ &lt;code&gt;storageclass.kubernetes.io/is-default-class: &amp;quot;true&amp;quot;&lt;/code&gt; é¿å… PVC æœªæŒ‡å®šå­˜å‚¨ç±»æ—¶å¤±è´¥&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›æ”¶ç­–ç•¥é€‰æ‹©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒæ…ç”¨ &lt;code&gt;Delete&lt;/code&gt;ï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;Retain&lt;/code&gt; ç»“åˆå¤‡ä»½å·¥å…·ï¼ˆå¦‚ Veleroï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿç»‘å®šä¼˜åŒ–æ‹“æ‰‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹åŒºåŸŸæ€§å­˜å‚¨ï¼ˆå¦‚äº‘ç›˜ï¼‰æˆ–æœ¬åœ°å·ä½¿ç”¨ &lt;code&gt;WaitForFirstConsumer&lt;/code&gt;ï¼Œé¿å…è·¨åŒºåŸŸ/èŠ‚ç‚¹è®¿é—®&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨æ‰©å®¹é™åˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ‰©å®¹ä»…æ”¯æŒå¢å¤§å®¹é‡ï¼Œä¸æ”¯æŒç¼©å°ï¼›éƒ¨åˆ†å­˜å‚¨ç±»å‹ï¼ˆå¦‚æœ¬åœ°å·ï¼‰ä¸æ”¯æŒåŠ¨æ€æ‰©å®¹&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™æ§åˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Provisioner éœ€é…ç½® RBAC è§„åˆ™ï¼ˆå¦‚ &lt;code&gt;ClusterRole&lt;/code&gt; æˆæƒ PV æ“ä½œæƒé™ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-13"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;StorageClass æ˜¯ Kubernetes åŠ¨æ€å­˜å‚¨ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡è§£è€¦å­˜å‚¨ä¾›åº”ä¸åº”ç”¨éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä¾›åº”&lt;/strong&gt;ï¼šè‡ªåŠ¨åŒ– PV åˆ›å»ºï¼Œå‡å°‘äººå·¥å¹²é¢„&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥å®šåˆ¶&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;provisioner&lt;/code&gt;ã€&lt;code&gt;reclaimPolicy&lt;/code&gt; ç­‰å‚æ•°é€‚é…å¤šå…ƒå­˜å‚¨åœºæ™¯&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§å…³é”®&lt;/strong&gt;ï¼šåˆç†é€‰æ‹©ç»‘å®šæ¨¡å¼ä¸å›æ”¶ç­–ç•¥ï¼Œç»“åˆç›‘æ§ç¡®ä¿å­˜å‚¨å¯é æ€§ä¸æ€§èƒ½æœ€ä¼˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="nfs"&gt;NFS
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯å…³äº &lt;strong&gt;NFSï¼ˆNetwork File Systemï¼‰&lt;/strong&gt; çš„è¯¦ç»†ä»‹ç»ï¼Œæ¶µç›–æ ¸å¿ƒåŸç†ã€å·¥ä½œæœºåˆ¶ã€é…ç½®éƒ¨ç½²ã€åº”ç”¨åœºæ™¯åŠä¼˜åŒ–å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-nfs-çš„æ ¸å¿ƒæ¦‚å¿µ"&gt;ğŸ” &lt;strong&gt;NFS çš„æ ¸å¿ƒæ¦‚å¿µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰ä¸ä½œç”¨"&gt;&lt;strong&gt;å®šä¹‰ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NFS&lt;/strong&gt; æ˜¯ä¸€ç§åŸºäº &lt;strong&gt;TCP/IP åè®®&lt;/strong&gt; çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œç”± Sun å…¬å¸äº 1984 å¹´å¼€å‘ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯é€æ˜åœ°è®¿é—®è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå¦‚åŒæ“ä½œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ &lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒä»·å€¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºå…±äº«&lt;/strong&gt;ï¼šå¤šå°è®¡ç®—æœºå…±äº«åŒä¸€å­˜å‚¨ç©ºé—´ï¼Œå‡å°‘æ•°æ®å†—ä½™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨å¹³å°å…¼å®¹&lt;/strong&gt;ï¼šæ”¯æŒä¸åŒæ“ä½œç³»ç»Ÿï¼ˆLinuxã€Unixã€Windows ç­‰ï¼‰é—´çš„æ–‡ä»¶å…±äº« &lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–ç®¡ç†&lt;/strong&gt;ï¼šé›†ä¸­å­˜å‚¨é…ç½®æ–‡ä»¶ã€ç”¨æˆ·å®¶ç›®å½•æˆ–åº”ç”¨æ•°æ®ï¼Œæå‡ä¸€è‡´æ€§ &lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¾èµ–ç»„ä»¶rpcremote-procedure-call"&gt;&lt;strong&gt;ä¾èµ–ç»„ä»¶ï¼šRPCï¼ˆRemote Procedure Callï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šNFS é€šè¿‡ RPC æœºåˆ¶å®ç°è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚RPC æœåŠ¡ï¼ˆå¦‚ &lt;code&gt;rpcbind&lt;/code&gt;ï¼‰ç›‘å¬å›ºå®šç«¯å£ &lt;strong&gt;111&lt;/strong&gt;ï¼Œè´Ÿè´£æ³¨å†Œå’Œåˆ†é… NFS æœåŠ¡çš„åŠ¨æ€ç«¯å£ï¼ˆå¦‚ &lt;code&gt;rpc.nfsd&lt;/code&gt;ã€&lt;code&gt;rpc.mountd&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å·¥ä½œæµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;NFS æœåŠ¡å™¨å¯åŠ¨æ—¶å‘ RPC æ³¨å†Œç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯é€šè¿‡ RPC æŸ¥è¯¢æœåŠ¡ç«¯ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ç›´æ¥è¿æ¥ NFS æœåŠ¡ç«¯å£ï¼ˆå¦‚ &lt;strong&gt;2049&lt;/strong&gt;ï¼‰è¿›è¡Œæ•°æ®ä¼ è¾“ &lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-nfs-çš„å·¥ä½œåŸç†"&gt;âš™ï¸ &lt;strong&gt;NFS çš„å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æœåŠ¡ç«¯ç»„ä»¶"&gt;&lt;strong&gt;æœåŠ¡ç«¯ç»„ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å®ˆæŠ¤è¿›ç¨‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rpc.nfsd&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç®¡ç†å®¢æˆ·ç«¯è¿æ¥ä¸æƒé™éªŒè¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rpc.mountd&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç†æŒ‚è½½è¯·æ±‚ï¼ŒéªŒè¯å®¢æˆ·ç«¯å¯¹å…±äº«ç›®å½•çš„è®¿é—®æƒé™ï¼ˆè¯»å– &lt;code&gt;/etc/exports&lt;/code&gt; é…ç½®ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rpc.lockd&lt;/code&gt; (å¯é€‰)&lt;/td&gt;
&lt;td&gt;ç®¡ç†æ–‡ä»¶é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥å†²çªã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rpc.statd&lt;/code&gt; (å¯é€‰)&lt;/td&gt;
&lt;td&gt;æ£€æµ‹æ–‡ä»¶ä¸€è‡´æ€§ï¼Œä¿®å¤æŸåæ–‡ä»¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å®¢æˆ·ç«¯è®¿é—®æµç¨‹"&gt;&lt;strong&gt;å®¢æˆ·ç«¯è®¿é—®æµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ‰§è¡Œ &lt;code&gt;mount -t nfs server_ip:/shared_dir /local_dir&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†…æ ¸é€šè¿‡ RPC è·å–æœåŠ¡ç«¯ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;å»ºç«‹ TCP è¿æ¥ï¼ŒæŒ‚è½½è¿œç¨‹ç›®å½•åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è¯»å†™æ–‡ä»¶æ—¶ï¼Œç”± NFS å®¢æˆ·ç«¯è½¬æ¢ä¸º RPC è¯·æ±‚å‘é€è‡³æœåŠ¡ç«¯ &lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-nfs-çš„é…ç½®ä¸éƒ¨ç½²"&gt;ğŸ“‚ &lt;strong&gt;NFS çš„é…ç½®ä¸éƒ¨ç½²&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æœåŠ¡ç«¯é…ç½®"&gt;&lt;strong&gt;æœåŠ¡ç«¯é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼š&lt;code&gt;/etc/exports&lt;/code&gt;
â€‹&lt;strong&gt;è¯­æ³•&lt;/strong&gt;â€‹ï¼š&lt;code&gt;[å…±äº«ç›®å½•] [å®¢æˆ·ç«¯IP/ç½‘æ®µ](æƒé™é€‰é¡¹)&lt;/code&gt;
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;/data/nfs_share 192.168.1.0/24(rw,sync,all_squash,anonuid=210,anongid=210)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸ç”¨æƒé™é€‰é¡¹&lt;/strong&gt;ï¼š
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é€‰é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rw&lt;/code&gt; / &lt;code&gt;ro&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯»å†™æˆ–åªè¯»æƒé™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;sync&lt;/code&gt; / &lt;code&gt;async&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒæ­¥å†™å…¥ï¼ˆæ•°æ®å®‰å…¨ï¼‰æˆ–å¼‚æ­¥å†™å…¥ï¼ˆé«˜æ€§èƒ½ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;root_squash&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†å®¢æˆ·ç«¯ root ç”¨æˆ·æ˜ å°„ä¸ºæœåŠ¡ç«¯åŒ¿åç”¨æˆ·ï¼ˆé»˜è®¤ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;no_root_squash&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¿ç•™å®¢æˆ·ç«¯ root æƒé™ï¼ˆé«˜é£é™©ï¼Œæ…ç”¨ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;all_squash&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰å®¢æˆ·ç«¯ç”¨æˆ·æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·ï¼ˆå¦‚ &lt;code&gt;nfsnobody&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;anonuid&lt;/code&gt;/&lt;code&gt;anongid&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šåŒ¿åç”¨æˆ·çš„ UID/GIDï¼ˆéœ€æœåŠ¡ç«¯å­˜åœ¨è¯¥ç”¨æˆ·ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œå‘½ä»¤&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;systemctl start rpcbind nfs-server # å…ˆå¯åŠ¨ rpcbindï¼Œå†å¯åŠ¨ NFS
exportfs -rv # é‡è½½é…ç½®æ— éœ€é‡å¯æœåŠ¡
showmount -e # æŸ¥çœ‹å…±äº«ç›®å½•åˆ—è¡¨
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®¢æˆ·ç«¯æŒ‚è½½æ–¹å¼"&gt;&lt;strong&gt;å®¢æˆ·ç«¯æŒ‚è½½æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰‹åŠ¨æŒ‚è½½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;mount -t nfs server_ip:/data /mnt&lt;/code&gt;ï¼ˆé‡å¯å¤±æ•ˆï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€æœºè‡ªåŠ¨æŒ‚è½½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ &lt;code&gt;/etc/fstab&lt;/code&gt; æ·»åŠ ï¼š&lt;code&gt;server_ip:/data /mnt nfs defaults,_netdev 0 0&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€æŒ‚è½½ (autofs)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‰éœ€è‡ªåŠ¨æŒ‚è½½ï¼Œç©ºé—²è¶…æ—¶åå¸è½½ï¼ˆé»˜è®¤ 5 åˆ†é’Ÿï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ï¼š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;yum install autofs
echo &amp;#34;/nfs /etc/auto.nfs&amp;#34; &amp;gt;&amp;gt; /etc/auto.master
echo &amp;#34;share -fstype=nfs server_ip:/data&amp;#34; &amp;gt; /etc/auto.nfs
systemctl start autofs
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯ä¸å…¸å‹æ¡ˆä¾‹"&gt;ğŸ§© &lt;strong&gt;åº”ç”¨åœºæ™¯ä¸å…¸å‹æ¡ˆä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¸¸è§åœºæ™¯"&gt;&lt;strong&gt;å¸¸è§åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«é™æ€èµ„æº&lt;/strong&gt;ï¼šå¤š Web æœåŠ¡å™¨å…±äº«ç½‘ç«™ä»£ç ï¼ˆå¦‚ Apache çš„ &lt;code&gt;/var/www/html&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ä¸­å­˜å‚¨ç”¨æˆ·å®¶ç›®å½•&lt;/strong&gt;ï¼šä¼ä¸šç¯å¢ƒä¸­ç”¨æˆ·æ— è®ºç™»å½•å“ªå°æœºå™¨ï¼Œå‡è®¿é—®åŒä¸€ Home ç›®å½• &lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åª’ä½“å…±äº«&lt;/strong&gt;ï¼šå¤šè®¾å¤‡è®¿é—®åŒä¸€å½±è§†åº“ï¼ˆå¦‚ Plex åª’ä½“æœåŠ¡å™¨ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å¤‡ä»½&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯å°†æ•°æ®å¤‡ä»½è‡³ NFS æœåŠ¡å™¨çš„æŒä¹…åŒ–å­˜å‚¨ &lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æƒé™ç®¡ç†æ¡ˆä¾‹"&gt;&lt;strong&gt;æƒé™ç®¡ç†æ¡ˆä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;éœ€æ±‚&lt;/strong&gt;ï¼šå…±äº«ç›®å½• &lt;code&gt;/nfs/upload&lt;/code&gt; ä¾›ç½‘æ®µ &lt;code&gt;192.168.1.0/24&lt;/code&gt; è¯»å†™ï¼Œæ‰€æœ‰ç”¨æˆ·æ˜ å°„ä¸ºæœåŠ¡ç«¯ç”¨æˆ· &lt;code&gt;nfs-upload&lt;/code&gt;ï¼ˆUID=210ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# æœåŠ¡ç«¯
useradd -u 210 nfs-upload
echo &amp;#34;/nfs/upload 192.168.1.0/24(rw,sync,all_squash,anonuid=210,anongid=210)&amp;#34; &amp;gt;&amp;gt; /etc/exports
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶åœ¨æœåŠ¡ç«¯å½’å± &lt;code&gt;nfs-upload&lt;/code&gt;ï¼Œé¿å…æƒé™å†²çª &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨å®è·µ"&gt;âš ï¸ &lt;strong&gt;æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ€§èƒ½è°ƒä¼˜-1"&gt;&lt;strong&gt;æ€§èƒ½è°ƒä¼˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŒ‚è½½å‚æ•°è°ƒæ•´&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;mount -t nfs -o rsize=8192,wsize=8192,hard,intr server_ip:/data /mnt
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rsize&lt;/code&gt;/&lt;code&gt;wsize&lt;/code&gt;ï¼šå¢å¤§è¯»å†™ç¼“å­˜ï¼ˆé»˜è®¤ 1KBï¼Œå»ºè®® 8KB ä»¥ä¸Šï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hard&lt;/code&gt;ï¼šç½‘ç»œä¸­æ–­æ—¶æŒç»­é‡è¯•ï¼ˆæ•°æ®ä¸€è‡´æ€§ä¼˜å…ˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;intr&lt;/code&gt;ï¼šå…è®¸ä¸­æ–­é•¿æ—¶é—´æŒ‚èµ·çš„ I/O æ“ä½œ &lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯ä¼˜åŒ–&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ SSD å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;å…³é—­ä¸å¿…è¦çš„æ—¥å¿—ï¼ˆå¦‚ &lt;code&gt;no_subtree_check&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®‰å…¨æ€§å¢å¼º"&gt;&lt;strong&gt;å®‰å…¨æ€§å¢å¼º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œéš”ç¦»&lt;/strong&gt;ï¼šé€šè¿‡é˜²ç«å¢™é™åˆ¶è®¿é—® IPï¼ˆä»…å…è®¸ä¿¡ä»»ç½‘æ®µï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¯†ä¼ è¾“&lt;/strong&gt;ï¼šNFSv4 æ”¯æŒ Kerberos è®¤è¯ï¼ˆæ›¿ä»£æ˜æ–‡ä¼ è¾“ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æƒé™æœ€å°åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;ç¦ç”¨ &lt;code&gt;no_root_squash&lt;/code&gt;ï¼Œé¿å… root æƒé™æ³„éœ²ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;all_squash&lt;/code&gt; + &lt;code&gt;anonuid&lt;/code&gt; é™åˆ¶å®¢æˆ·ç«¯æƒé™ &lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŒ‚è½½å¤±è´¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šé˜²ç«å¢™é˜»å¡ã€RPC æœªå¯åŠ¨ã€&lt;code&gt;/etc/exports&lt;/code&gt; é…ç½®é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;systemctl status rpcbind nfs-server # æ£€æŸ¥æœåŠ¡çŠ¶æ€
rpcinfo -p server_ip # éªŒè¯ RPC æ³¨å†Œ
showmount -e server_ip # æ£€æŸ¥å…±äº«ç›®å½•å¯è§æ€§
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯å¡æ­»ï¼ˆæœåŠ¡ç«¯å®•æœºï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºåˆ¶å¸è½½&lt;/strong&gt;ï¼š&lt;code&gt;umount -lf /mnt&lt;/code&gt; &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å·¥å…·&lt;/strong&gt;ï¼š&lt;code&gt;nfsstat&lt;/code&gt; åˆ†æè¯»å†™å»¶è¿Ÿï¼Œè°ƒæ•´ &lt;code&gt;rsize&lt;/code&gt;/&lt;code&gt;wsize&lt;/code&gt; &lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-14"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;NFS æ˜¯æ„å»ºåˆ†å¸ƒå¼å­˜å‚¨çš„åŸºçŸ³ï¼Œå…¶æ ¸å¿ƒåœ¨äº &lt;strong&gt;RPC æœºåˆ¶&lt;/strong&gt; å’Œ &lt;strong&gt;æƒé™æ˜ å°„æ¨¡å‹&lt;/strong&gt;ã€‚é€‚ç”¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸­å°è§„æ¨¡å…±äº«å­˜å‚¨&lt;/strong&gt;ï¼ˆå¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒã€åª’ä½“åº“ï¼‰&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è§„é¿çš„åœºæ™¯&lt;/strong&gt;ï¼šé«˜å¹¶å‘æ•°æ®åº“ï¼ˆæ€§èƒ½ç“¶é¢ˆï¼‰ã€è·¨å…¬ç½‘ä¼ è¾“ï¼ˆå®‰å…¨é£é™©ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;â€‹ï¼šç»“åˆ &lt;code&gt;autofs&lt;/code&gt; åŠ¨æ€æŒ‚è½½ã€å¯ç”¨ &lt;code&gt;sync&lt;/code&gt; ä¿è¯æ•°æ®å®‰å…¨ã€é€šè¿‡é˜²ç«å¢™å’Œ Kerberos åŠ å›ºè®¿é—®æ§åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="ceph"&gt;Ceph
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯å…³äº &lt;strong&gt;Ceph åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ&lt;/strong&gt;çš„è¯¦ç»†ä»‹ç»ï¼Œæ¶µç›–å…¶æ¶æ„è®¾è®¡ã€æ ¸å¿ƒç»„ä»¶ã€å·¥ä½œåŸç†ã€å…³é”®ç‰¹æ€§åŠå®è·µåœºæ™¯ï¼Œç»“åˆæŠ€æœ¯ç»†èŠ‚ä¸å·¥ç¨‹è§†è§’å±•å¼€åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ceph-æ¦‚è¿°ä¸è®¾è®¡ç›®æ ‡"&gt;ğŸ” &lt;strong&gt;Ceph æ¦‚è¿°ä¸è®¾è®¡ç›®æ ‡&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Ceph æ˜¯ä¸€ä¸ªå¼€æºçš„&lt;strong&gt;ç»Ÿä¸€åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ&lt;/strong&gt;ï¼Œæ—¨åœ¨ä¸ºæµ·é‡æ•°æ®æä¾›é«˜æ‰©å±•æ€§ã€é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„å­˜å‚¨æœåŠ¡ã€‚å…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— å•ç‚¹æ•…éšœ&lt;/strong&gt;ï¼šé€šè¿‡å¤šå‰¯æœ¬/çº åˆ ç æŠ€æœ¯å®ç°æ•°æ®å†—ä½™&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿æ€§æ‰©å±•&lt;/strong&gt;ï¼šæ”¯æŒä» TB åˆ° EB çº§åˆ«çš„å­˜å‚¨å®¹é‡æ‰©å±•ï¼Œæ€§èƒ½éšèŠ‚ç‚¹å¢åŠ çº¿æ€§æå‡&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªç®¡ç†èƒ½åŠ›&lt;/strong&gt;ï¼šè‡ªåŠ¨å¤„ç†æ•°æ®åˆ†å¸ƒã€æ•…éšœæ¢å¤å’Œè´Ÿè½½å‡è¡¡ï¼Œé™ä½è¿ç»´å¤æ‚åº¦&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€å­˜å‚¨æ¥å£&lt;/strong&gt;ï¼šåŒæ—¶æ”¯æŒå—å­˜å‚¨ï¼ˆRBDï¼‰ã€å¯¹è±¡å­˜å‚¨ï¼ˆRGWï¼‰ã€æ–‡ä»¶å­˜å‚¨ï¼ˆCephFSï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¶æ„ä¸ç»„ä»¶"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæ¶æ„ä¸ç»„ä»¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŸºç¡€å­˜å‚¨å±‚rados"&gt;&lt;strong&gt;åŸºç¡€å­˜å‚¨å±‚ï¼šRADOS&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå¯é è‡ªä¸»åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨ï¼ˆReliable Autonomic Distributed Object Storeï¼‰ï¼Œç®¡ç†æ•°æ®å­˜å‚¨ã€å¤åˆ¶å’Œæ¢å¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ— ä¸­å¿ƒå…ƒæ•°æ®æœåŠ¡å™¨ï¼Œä¾èµ– CRUSH ç®—æ³•å®ç°æ•°æ®å®šä½&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…³é”®å®ˆæŠ¤è¿›ç¨‹"&gt;&lt;strong&gt;å…³é”®å®ˆæŠ¤è¿›ç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§’è‰²&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;OSD&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®¡ç†ç‰©ç†ç£ç›˜ï¼Œå¤„ç†æ•°æ®è¯»å†™ã€å¤åˆ¶ã€æ•…éšœæ¢å¤ï¼›é»˜è®¤ä½¿ç”¨ BlueStore å¼•æ“ç›´æ¥æ“ä½œè£¸è®¾å¤‡&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªç£ç›˜å¯¹åº”ä¸€ä¸ª OSDï¼Œé›†ç¾¤æ€§èƒ½ä¸ OSD æ•°é‡æ­£ç›¸å…³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Monitor (MON)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»´æŠ¤é›†ç¾¤å…¨å±€çŠ¶æ€ï¼ˆå¦‚ OSD æ˜ å°„ã€CRUSH è§„åˆ™ï¼‰ï¼Œé€šè¿‡ Paxos åè®®ä¿è¯ä¸€è‡´æ€§&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;éœ€éƒ¨ç½²å¥‡æ•°ä¸ªï¼ˆå¦‚ 3/5ï¼‰é¿å…è„‘è£‚ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Manager (MGR)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¶é›†é›†ç¾¤æŒ‡æ ‡ã€æä¾›ç›‘æ§æ¥å£ï¼ˆå¦‚ Prometheusï¼‰ï¼Œæ”¯æŒæ‰©å±•æ¨¡å—ï¼ˆå¦‚ Dashboardï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;ä¸»å¤‡æ¨¡å¼ç¡®ä¿é«˜å¯ç”¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MDS&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…ç”¨äº CephFSï¼Œç®¡ç†æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®ï¼ˆç›®å½•ç»“æ„ã€æƒé™ï¼‰&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å¤šå®ä¾‹éƒ¨ç½²å¯æå‡å…ƒæ•°æ®æ€§èƒ½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å­˜å‚¨æ¥å£å±‚"&gt;&lt;strong&gt;å­˜å‚¨æ¥å£å±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RBD (å—å­˜å‚¨)&lt;/strong&gt;ï¼šæä¾›è™šæ‹Ÿç£ç›˜æ¥å£ï¼Œé€‚ç”¨äºè™šæ‹Ÿæœº/å®¹å™¨æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚ OpenStackã€Kubernetesï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RGW (å¯¹è±¡å­˜å‚¨)&lt;/strong&gt;ï¼šå…¼å®¹ S3/Swift APIï¼Œç”¨äºäº‘åŸç”Ÿåº”ç”¨å’Œç½‘ç›˜ç³»ç»Ÿ&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CephFS (æ–‡ä»¶å­˜å‚¨)&lt;/strong&gt;ï¼šPOSIX å…¼å®¹çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯å…±äº«è®¿é—®&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®åˆ†å¸ƒä¸ä¸€è‡´æ€§æœºåˆ¶"&gt;ğŸ”„ &lt;strong&gt;æ•°æ®åˆ†å¸ƒä¸ä¸€è‡´æ€§æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="crush-ç®—æ³•"&gt;&lt;strong&gt;CRUSH ç®—æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼šé€šè¿‡ä¼ªéšæœºå“ˆå¸Œè®¡ç®—æ•°æ®ä½ç½®ï¼Œé¿å…ä¸­å¿ƒå…ƒæ•°æ®ç“¶é¢ˆã€‚è¾“å…¥åŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;é›†ç¾¤æ‹“æ‰‘ï¼ˆCRUSH Mapï¼‰&lt;/li&gt;
&lt;li&gt;æ•…éšœåŸŸç­–ç•¥ï¼ˆå¦‚è·¨æœºæ¶/ä¸»æœºï¼‰&lt;/li&gt;
&lt;li&gt;æ•°æ®æƒé‡ï¼ˆå¦‚ SSD æƒé‡é«˜äº HDDï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¼ç®€åŒ–&lt;/strong&gt;ï¼š
&lt;code&gt;\text{OSD ID} = \text{CRUSH}(\text{object\_id}, \text{CRUSH Map}, \text{failure domains})&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šåŠ¨æ€é€‚åº”èŠ‚ç‚¹å¢å‡ï¼Œæ•°æ®è‡ªåŠ¨é‡å¹³è¡¡&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å½’ç½®ç»„pg"&gt;&lt;strong&gt;å½’ç½®ç»„ï¼ˆPGï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šé€»è¾‘å®¹å™¨ï¼Œèšåˆå¤šä¸ªå¯¹è±¡ï¼ˆObjectï¼‰å¹¶æ˜ å°„åˆ° OSD ç»„ã€‚æ˜ å°„å…³ç³»ä¸ºï¼š
&lt;code&gt;\text{Object} \xrightarrow{\text{hash}} \text{PG} \xrightarrow{\text{CRUSH}} \text{OSD}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®è¦ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;PG æ•°é‡å½±å“è´Ÿè½½å‡è¡¡ï¼ˆè¿‡å°‘å¯¼è‡´çƒ­ç‚¹ï¼Œè¿‡å¤šå¢åŠ å…ƒæ•°æ®å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;çŠ¶æ€æœºç®¡ç†ï¼ˆå¦‚ &lt;code&gt;active+clean&lt;/code&gt; è¡¨ç¤ºæ•°æ®å¥åº·ï¼‰&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ•°æ®å†—ä½™ç­–ç•¥"&gt;&lt;strong&gt;æ•°æ®å†—ä½™ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šå‰¯æœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®å¤åˆ¶åˆ°å¤šä¸ª OSDï¼ˆå¦‚ 3 å‰¯æœ¬ï¼‰ï¼Œå¼ºä¸€è‡´æ€§å†™å…¥ã€‚&lt;/td&gt;
&lt;td&gt;é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿåœºæ™¯ï¼ˆå¦‚æ•°æ®åº“ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº åˆ ç  (EC)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åˆ†å—ï¼ˆk+mï¼‰ï¼Œç”Ÿæˆæ ¡éªŒå—ï¼Œç©ºé—´åˆ©ç”¨ç‡é«˜ï¼ˆå¦‚ 10+2 ä»…éœ€ 1.2x ç©ºé—´ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å†·æ•°æ®å½’æ¡£ï¼ˆå¦‚å¤‡ä»½ç³»ç»Ÿï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜å¯ç”¨ä¸è‡ªæ„ˆç‰¹æ€§"&gt;ğŸ›¡ï¸ &lt;strong&gt;é«˜å¯ç”¨ä¸è‡ªæ„ˆç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ£€æµ‹&lt;/strong&gt;
OSD é—´å¿ƒè·³æœºåˆ¶æ£€æµ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒMON å®æ—¶æ›´æ–°é›†ç¾¤æ˜ å°„&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨æ¢å¤&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;OSD æ•…éšœæ—¶ï¼ŒPG è‡ªåŠ¨è¿ç§»è‡³å¥åº·èŠ‚ç‚¹ã€‚
&lt;ul&gt;
&lt;li&gt;æ•°æ® Scrubbingï¼šå®šæœŸæ ¡éªŒæ•°æ®ä¸€è‡´æ€§ï¼Œä¿®å¤é™é»˜é”™è¯¯&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;æ— ä¸­æ–­æ‰©å±•&lt;/strong&gt;
æ–°å¢èŠ‚ç‚¹åï¼ŒCRUSH ç®—æ³•è‡ªåŠ¨è¿ç§»éƒ¨åˆ† PG å®ç°è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯ä¸æ€§èƒ½ä¼˜åŒ–"&gt;ğŸ§© &lt;strong&gt;åº”ç”¨åœºæ™¯ä¸æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…¸å‹åº”ç”¨"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‘è®¡ç®—å¹³å°&lt;/strong&gt;ï¼šä¸º OpenStack/Kubernetes æä¾› RBD å—å­˜å‚¨å’Œ CephFS å…±äº«æ–‡ä»¶ç³»ç»Ÿ&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§æ•°æ®åˆ†æ&lt;/strong&gt;ï¼šä½œä¸º Hadoop/Spark åº•å±‚å­˜å‚¨ï¼Œæ›¿ä»£ HDFS&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šåª’ä½“å­˜å‚¨&lt;/strong&gt;ï¼šå¯¹è±¡å­˜å‚¨ RGW æ”¯æŒæµ·é‡å›¾ç‰‡/è§†é¢‘å­˜å–&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ€§èƒ½è°ƒä¼˜å®è·µ"&gt;&lt;strong&gt;æ€§èƒ½è°ƒä¼˜å®è·µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç¡¬ä»¶é€‰å‹ï¼š
&lt;ul&gt;
&lt;li&gt;OSD ç£ç›˜ï¼šNVMe SSD ç”¨äºé«˜æ€§èƒ½æ± ï¼ŒHDD ç”¨äºå®¹é‡æ± ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘ç»œï¼šä¸‡å…†/InfiniBand é¿å…å¸¦å®½ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å‚æ•°ä¼˜åŒ–ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# å¢åŠ  PG æ•°é‡ï¼ˆéœ€è®¡ç®—ï¼šTotal PGs = (OSDs Ã— 100) / Replicaï¼‰
ceph osd pool set my_pool pg_num 128
# å¯ç”¨ EC æ± 
ceph osd erasure-code-profile set my_ec k=4 m=2
ceph osd pool create ec_pool erasure my_ec
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜åŠ é€Ÿ&lt;/strong&gt;ï¼š
ä½¿ç”¨ â€‹&lt;strong&gt;Cache Tiering&lt;/strong&gt;â€‹ å°†çƒ­ç‚¹æ•°æ®ç½®äº SSD æ± &lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æŒ‘æˆ˜ä¸æœ€ä½³å®è·µ"&gt;âš ï¸ &lt;strong&gt;æŒ‘æˆ˜ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æŒ‘æˆ˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éƒ¨ç½²å¤æ‚åº¦é«˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;code&gt;cephadm&lt;/code&gt; æˆ– &lt;code&gt;Rook&lt;/code&gt;ï¼ˆKubernetes ç®—å­ï¼‰è‡ªåŠ¨åŒ–éƒ¨ç½²&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½æŠ–åŠ¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å… OSD ä¸ MON æ··éƒ¨ï¼›é™åˆ¶æ¢å¤å¸¦å®½ï¼ˆ&lt;code&gt;ceph osd set-recovery-max-active&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…ƒæ•°æ®æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸º CephFS éƒ¨ç½²å¤šæ´» MDSï¼›å¯ç”¨åŠ¨æ€å­æ ‘åˆ†åŒº&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº åˆ ç å†™å…¥å»¶è¿Ÿ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…å¯¹å†·æ•°æ®å¯ç”¨ ECï¼›çƒ­æ•°æ®ç”¨å¤šå‰¯æœ¬&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-15"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Ceph é€šè¿‡ &lt;strong&gt;RADOS åº•å±‚å¼•æ“&lt;/strong&gt; + &lt;strong&gt;CRUSH ç®—æ³•&lt;/strong&gt; + &lt;strong&gt;å¤šæ¥å£é€‚é…å±‚&lt;/strong&gt;çš„æ¶æ„ï¼Œå®ç°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®é«˜å¯é &lt;/strong&gt;ï¼šå¤šå‰¯æœ¬/EC å†—ä½™ç­–ç•¥åº”å¯¹ç¡¬ä»¶æ•…éšœ&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æè‡´æ‰©å±•æ€§&lt;/strong&gt;ï¼šæ–°å¢èŠ‚ç‚¹æ— éœ€æ•°æ®è¿ç§»ä¸­æ–­ä¸šåŠ¡&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´è‡ªåŠ¨åŒ–&lt;/strong&gt;ï¼šè‡ªå¹³è¡¡ã€è‡ªä¿®å¤é™ä½è¿ç»´æˆæœ¬&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½œä¸ºäº‘åŸç”Ÿæ—¶ä»£å­˜å‚¨åŸºåº§çš„é¦–é€‰ï¼ŒCeph å·²å¹¿æ³›åº”ç”¨äº OpenStackã€Kubernetes åŠå¤§è§„æ¨¡æ•°æ®åˆ†æå¹³å°ï¼Œå…¶å¼€æºç‰¹æ€§ä¸æ´»è·ƒç¤¾åŒºï¼ˆRedHat ä¸»å¯¼ï¼‰æŒç»­æ¨åŠ¨åŠŸèƒ½è¿­ä»£ï¼ˆå¦‚ QUINCY ç‰ˆæœ¬çš„ BlueStore ä¼˜åŒ–ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚ç”Ÿäº§ç¯å¢ƒä¸­éœ€ç»“åˆåœºæ™¯ç²¾ç»†åŒ–è°ƒä¼˜ï¼Œä»¥å‘æŒ¥å…¶æœ€å¤§æ½œåŠ›ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="pv"&gt;PV
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Kubernetes ä¸­ &lt;strong&gt;PersistentVolume (PV)&lt;/strong&gt; çš„è¯¦ç»†ä»‹ç»ï¼Œæ¶µç›–æ ¸å¿ƒæ¦‚å¿µã€å·¥ä½œæœºåˆ¶ã€é…ç½®å‚æ•°åŠå®è·µåœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-pv-çš„æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨"&gt;ğŸ”‘ &lt;strong&gt;PV çš„æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æº&lt;/strong&gt;ï¼šç”±ç®¡ç†å‘˜é¢„å…ˆé…ç½®æˆ–é€šè¿‡ StorageClass åŠ¨æ€åˆ›å»ºï¼ŒæŠ½è±¡åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSã€äº‘ç£ç›˜ã€Ceph ç­‰ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äº Pod&lt;/strong&gt;ï¼šPV çš„åˆ›å»ºã€ç»‘å®šã€é‡Šæ”¾ä¸ Pod æ— å…³ï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–ï¼ˆå³ä½¿ Pod é‡å¯æˆ–è¿ç§»ï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è§£å†³çš„é—®é¢˜"&gt;&lt;strong&gt;è§£å†³çš„é—®é¢˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨ä¸è®¡ç®—è§£è€¦&lt;/strong&gt;ï¼šåº”ç”¨æ— éœ€å…³å¿ƒå­˜å‚¨å®ç°ç»†èŠ‚ï¼ˆå¦‚ NFS è·¯å¾„ã€äº‘ç›˜ IDï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºå¯æ§æ€§&lt;/strong&gt;ï¼šé€šè¿‡ PV é™åˆ¶å­˜å‚¨ä½¿ç”¨é‡ï¼Œé¿å… Pod ä»»æ„å ç”¨å­˜å‚¨å¯¼è‡´é›†ç¾¤ä¸ç¨³å®š&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-pv-çš„å…³é”®é…ç½®å‚æ•°"&gt;âš™ï¸ &lt;strong&gt;PV çš„å…³é”®é…ç½®å‚æ•°&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒå±æ€§"&gt;&lt;strong&gt;æ ¸å¿ƒå±æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å‚æ•°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;capacity.storage&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å®¹é‡ï¼ˆå¦‚ &lt;code&gt;10Gi&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;storage: 5Gi&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;accessModes&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è®¿é—®æ¨¡å¼ï¼š - &lt;code&gt;ReadWriteOnce&lt;/code&gt; (RWO)ï¼šå•èŠ‚ç‚¹è¯»å†™ - &lt;code&gt;ReadOnlyMany&lt;/code&gt; (ROX)ï¼šå¤šèŠ‚ç‚¹åªè¯» - &lt;code&gt;ReadWriteMany&lt;/code&gt; (RWX)ï¼šå¤šèŠ‚ç‚¹è¯»å†™&lt;/td&gt;
&lt;td&gt;&lt;code&gt;- ReadWriteOnce&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;persistentVolumeReclaimPolicy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å›æ”¶ç­–ç•¥ï¼š - &lt;code&gt;Retain&lt;/code&gt;ï¼šä¿ç•™æ•°æ®ï¼ˆéœ€æ‰‹åŠ¨æ¸…ç†ï¼‰ - &lt;code&gt;Delete&lt;/code&gt;ï¼šè‡ªåŠ¨åˆ é™¤å­˜å‚¨èµ„æº - &lt;code&gt;Recycle&lt;/code&gt;ï¼šæ“¦é™¤æ•°æ®ï¼ˆå·²åºŸå¼ƒï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Retain&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;volumeMode&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å·ç±»å‹ï¼š - &lt;code&gt;Filesystem&lt;/code&gt;ï¼ˆé»˜è®¤ï¼ŒæŒ‚è½½ä¸ºç›®å½•ï¼‰ - &lt;code&gt;Block&lt;/code&gt;ï¼ˆè£¸è®¾å¤‡ï¼Œé«˜æ€§èƒ½åœºæ™¯ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Filesystem&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;storageClassName&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ StorageClass åç§°ï¼Œç”¨äºåŠ¨æ€ä¾›åº”&lt;/td&gt;
&lt;td&gt;&lt;code&gt;slow&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å­˜å‚¨åç«¯é…ç½®"&gt;&lt;strong&gt;å­˜å‚¨åç«¯é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹ï¼šNFS ç±»å‹ PV&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: PersistentVolume
metadata:
name: nfs-pv
spec:
capacity:
storage: 10Gi
accessModes:
- ReadWriteMany
persistentVolumeReclaimPolicy: Retain
nfs: # NFS å­˜å‚¨é…ç½®
path: /data/nfs-share
server: 192.168.1.100
[1,8](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹ï¼šAWS EBS ç±»å‹ PV&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: PersistentVolume
metadata:
name: ebs-pv
spec:
capacity:
storage: 20Gi
accessModes:
- ReadWriteOnce
awsElasticBlockStore:
volumeID: vol-0123456789abcdef # EBS å· ID
fsType: ext4
[5,8](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-pv-çš„ç”Ÿå‘½å‘¨æœŸ"&gt;ğŸ”„ &lt;strong&gt;PV çš„ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;PV çš„ç”Ÿå‘½å‘¨æœŸåŒ…å«ä»¥ä¸‹é˜¶æ®µ&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¾›åº” (Provisioning)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™æ€ä¾›åº”&lt;/strong&gt;ï¼šç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»º PVã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä¾›åº”&lt;/strong&gt;ï¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼ˆéœ€é…ç½® &lt;code&gt;provisioner&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‘å®š (Binding)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;PVC è¯·æ±‚å­˜å‚¨èµ„æº â†’ Kubernetes åŒ¹é…ç¬¦åˆæ¡ä»¶çš„ PV â†’ ç»‘å®šä¸º &lt;code&gt;Bound&lt;/code&gt; çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ (Using)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Pod æŒ‚è½½ PVCï¼ŒPV è¿›å…¥ä½¿ç”¨çŠ¶æ€ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿æŠ¤ (Protection)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ PV è¢« Pod ä½¿ç”¨ï¼Œåˆ é™¤æ“ä½œä¼šè¢«å»¶è¿Ÿï¼ˆé€šè¿‡ &lt;code&gt;Finalizers&lt;/code&gt; æœºåˆ¶ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›æ”¶ (Reclaiming)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;PVC åˆ é™¤åï¼ŒPV æ ¹æ®å›æ”¶ç­–ç•¥å¤„ç†ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Retain&lt;/code&gt;ï¼šä¿ç•™æ•°æ®ï¼Œéœ€æ‰‹åŠ¨æ¸…ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Delete&lt;/code&gt;ï¼šè‡ªåŠ¨åˆ é™¤åº•å±‚å­˜å‚¨ï¼ˆå¦‚äº‘ç£ç›˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Recycle&lt;/code&gt;ï¼ˆåºŸå¼ƒï¼‰ï¼šç®€å•æ“¦é™¤æ•°æ®ï¼ˆä»… NFS/HostPath æ”¯æŒï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-pv-çš„ç±»å‹ä¸é€‚ç”¨åœºæ™¯"&gt;ğŸ§© &lt;strong&gt;PV çš„ç±»å‹ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¸¸è§å­˜å‚¨ç±»å‹"&gt;&lt;strong&gt;å¸¸è§å­˜å‚¨ç±»å‹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è®¿é—®æ¨¡å¼æ”¯æŒ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NFS&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤š Pod å…±äº«æ•°æ®ï¼ˆå¦‚é…ç½®æ–‡ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;RWXï¼ˆå¤šèŠ‚ç‚¹è¯»å†™ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HostPath&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•èŠ‚ç‚¹æµ‹è¯•ï¼ˆæŒ‚è½½å®¿ä¸»æœºç›®å½•ï¼‰&lt;/td&gt;
&lt;td&gt;RWOï¼ˆå•èŠ‚ç‚¹è¯»å†™ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AWS EBS/GCP PD&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;äº‘ç¯å¢ƒæŒä¹…åŒ–å­˜å‚¨ï¼ˆé«˜æ€§èƒ½å—å­˜å‚¨ï¼‰&lt;/td&gt;
&lt;td&gt;RWO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ceph RBD&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ†å¸ƒå¼å—å­˜å‚¨ï¼ˆæ•°æ®åº“åœºæ™¯ï¼‰&lt;/td&gt;
&lt;td&gt;RWO/ROX&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Local&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨ï¼ˆéœ€ç»“åˆ &lt;code&gt;nodeAffinity&lt;/code&gt; è°ƒåº¦ï¼‰&lt;/td&gt;
&lt;td&gt;RWO &lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="è®¿é—®æ¨¡å¼å¯¹æ¯”"&gt;&lt;strong&gt;è®¿é—®æ¨¡å¼å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è®¿é—®æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼©å†™&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ”¯æŒåœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadWriteOnce&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;RWO&lt;/td&gt;
&lt;td&gt;å•èŠ‚ç‚¹è¯»å†™ï¼ˆå¦‚ MySQLï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadOnlyMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ROX&lt;/td&gt;
&lt;td&gt;å¤šèŠ‚ç‚¹åªè¯»ï¼ˆå¦‚å…±äº«é…ç½®æ–‡ä»¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadWriteMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;RWX&lt;/td&gt;
&lt;td&gt;å¤šèŠ‚ç‚¹è¯»å†™ï¼ˆå¦‚ NFS å…±äº«ç›®å½•ï¼‰ &lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå­˜å‚¨ç±»å‹å¯¹è®¿é—®æ¨¡å¼çš„æ”¯æŒä¸åŒï¼ˆå¦‚ AWS EBS ä»…æ”¯æŒ RWOï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-pv-ä¸-pvc-çš„åä½œå…³ç³»"&gt;ğŸ¤ &lt;strong&gt;PV ä¸ PVC çš„åä½œå…³ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PVC (PersistentVolumeClaim)&lt;/strong&gt;ï¼š
ç”¨æˆ·å£°æ˜å­˜å‚¨éœ€æ±‚ï¼ˆå¦‚å®¹é‡ã€è®¿é—®æ¨¡å¼ï¼‰ï¼ŒKubernetes è‡ªåŠ¨åŒ¹é… PV å¹¶ç»‘å®š&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‘å®šæµç¨‹&lt;/strong&gt;ï¼š
PVC åˆ›å»º â†’ åŒ¹é…å¯ç”¨ PV â†’ ç»‘å®šå PVC çŠ¶æ€ä¸º &lt;code&gt;Bound&lt;/code&gt; â†’ Pod æŒ‚è½½ PVC ä½¿ç”¨å­˜å‚¨&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŠ¨æ€ä¾›åº”ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# PVC è¯·æ±‚åŠ¨æ€åˆ›å»º PV
kind: PersistentVolumeClaim
metadata:
name: dynamic-pvc
spec:
storageClassName: nfs-storage # å…³è” StorageClass
accessModes:
- ReadWriteMany
resources:
requests:
storage: 5Gi
[7,8](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§æœ€ä½³å®è·µ"&gt;ğŸ› ï¸ &lt;strong&gt;ç”Ÿäº§æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å›æ”¶ç­–ç•¥é€‰æ‹©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å…³é”®æ•°æ®ç”¨ &lt;code&gt;Retain&lt;/code&gt;ï¼Œé¿å…è¯¯åˆ ï¼›ä¸´æ—¶æ•°æ®ç”¨ &lt;code&gt;Delete&lt;/code&gt; è‡ªåŠ¨æ¸…ç†&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä¾›åº”ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;StorageClass&lt;/code&gt; è‡ªåŠ¨åˆ›å»º PVï¼Œå‡å°‘äººå·¥ç®¡ç†æˆæœ¬&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ¬åœ°å­˜å‚¨ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Local
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç±»å‹ PV è®¾ç½®&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; nodeAffinity
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; ï¼Œç¡®ä¿ Pod è°ƒåº¦åˆ°æ­£ç¡®èŠ‚ç‚¹
5ï¼š
```
nodeAffinity:
required:
nodeSelectorTerms:
- matchExpressions:
- key: kubernetes.io/hostname
operator: In
values: [node-01]
```
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="4"&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ä¸æ‰©å±•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;kubectl describe pv&lt;/code&gt; ç›‘æ§çŠ¶æ€ï¼Œäº‘å­˜å‚¨å¯é€šè¿‡ä¿®æ”¹ &lt;code&gt;capacity&lt;/code&gt; å­—æ®µåŠ¨æ€æ‰©å®¹&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-16"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PV æ˜¯ Kubernetes å­˜å‚¨ä½“ç³»çš„æ ¸å¿ƒ&lt;/strong&gt;ï¼šæä¾›æŒä¹…åŒ–å­˜å‚¨æŠ½è±¡ï¼Œæ”¯æŒå¤šåç«¯å­˜å‚¨ç±»å‹ï¼ˆNFSã€äº‘ç›˜ã€Ceph ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®èƒ½åŠ›&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;accessModes&lt;/code&gt; æ§åˆ¶è®¿é—®æƒé™ã€&lt;code&gt;reclaimPolicy&lt;/code&gt; ç®¡ç†èµ„æºå›æ”¶ã€åŠ¨æ€ä¾›åº”å®ç°æŒ‰éœ€åˆ›å»ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒä¼˜å…ˆç”¨åŠ¨æ€ä¾›åº”ï¼ˆStorageClassï¼‰ï¼Œç»“åˆè®¿é—®æ¨¡å¼å’Œå›æ”¶ç­–ç•¥ä¿éšœæ•°æ®å®‰å…¨æ€§ä¸èµ„æºåˆ©ç”¨ç‡&lt;a class="link" href="@ref" &gt;4,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="pvc"&gt;PVC
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯å…³äº Kubernetes &lt;strong&gt;PersistentVolumeClaim (PVC)&lt;/strong&gt; çš„è¯¦ç»†è§£æï¼Œæ¶µç›–å…¶æ ¸å¿ƒæ¦‚å¿µã€å·¥ä½œåŸç†ã€å®è·µé…ç½®åŠç”Ÿäº§åœºæ™¯åº”ç”¨ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-pvc-çš„æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨"&gt;ğŸ”‘ PVC çš„æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨
&lt;/h3&gt;&lt;h4 id="å®šä¹‰-1"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PVC æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„å£°æ˜&lt;/strong&gt;ï¼š
ç”¨æˆ·åœ¨å‘½åç©ºé—´ä¸­åˆ›å»º PVCï¼ŒæŒ‡å®šæ‰€éœ€çš„å­˜å‚¨å®¹é‡ã€è®¿é—®æ¨¡å¼ï¼ˆå¦‚ &lt;code&gt;ReadWriteOnce&lt;/code&gt;ï¼‰å’Œå­˜å‚¨ç±»ï¼ˆStorageClassï¼‰ï¼Œæ— éœ€å…³å¿ƒåº•å±‚å­˜å‚¨å®ç°ç»†èŠ‚&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦åº”ç”¨ä¸å­˜å‚¨&lt;/strong&gt;ï¼š
PVC å°† Pod ä¸ç‰©ç†å­˜å‚¨åˆ†ç¦»ï¼Œå¼€å‘è€…åªéœ€å£°æ˜éœ€æ±‚ï¼ˆå¦‚ â€œéœ€è¦ 100Gi å¯è¯»å†™å­˜å‚¨â€ï¼‰ï¼Œç”± Kubernetes è‡ªåŠ¨åŒ¹é…æˆ–åŠ¨æ€åˆ›å»º PV&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è§£å†³çš„é—®é¢˜-1"&gt;&lt;strong&gt;è§£å†³çš„é—®é¢˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨èµ„æºå¯æ§æ€§&lt;/strong&gt;ï¼š
é™åˆ¶æ¯ä¸ª Pod çš„å­˜å‚¨ä½¿ç”¨é‡ï¼Œé¿å…æ— åºå†™å…¥å¯¼è‡´å­˜å‚¨è¿‡è½½ï¼ˆå¦‚å¤šä¸ª Pod äº‰ç”¨åŒä¸€ NFS ç›®å½•å¼•å‘ç£ç›˜çˆ†æ»¡ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€èµ„æºåˆ†é…&lt;/strong&gt;ï¼š
ç»“åˆ StorageClass å®ç°æŒ‰éœ€åˆ›å»º PVï¼Œå‡å°‘äººå·¥é¢„é…æˆæœ¬&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-pvc-çš„å·¥ä½œåŸç†ä¸ç”Ÿå‘½å‘¨æœŸ"&gt;âš™ï¸ PVC çš„å·¥ä½œåŸç†ä¸ç”Ÿå‘½å‘¨æœŸ
&lt;/h3&gt;&lt;h4 id="å£°æ˜ä¸ç»‘å®šæµç¨‹"&gt;&lt;strong&gt;å£°æ˜ä¸ç»‘å®šæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·åˆ›å»º PVCï¼š
æŒ‡å®šå®¹é‡ã€è®¿é—®æ¨¡å¼ç­‰éœ€æ±‚ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: my-pvc
spec:
storageClassName: fast-ssd # æŒ‡å®šå­˜å‚¨ç±»
accessModes:
- ReadWriteOnce
resources:
requests:
storage: 100Gi
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Kubernetes åŒ¹é… PVï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™æ€æ¨¡å¼&lt;/strong&gt;ï¼šä»é¢„åˆ›å»ºçš„ PV æ± ä¸­é€‰æ‹©ç¬¦åˆæ¡ä»¶çš„ PV&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ¨¡å¼&lt;/strong&gt;ï¼šé€šè¿‡ StorageClass è°ƒç”¨ Provisionerï¼ˆå¦‚ NFS Provisionerï¼‰è‡ªåŠ¨åˆ›å»º PV&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‘å®šçŠ¶æ€&lt;/strong&gt;ï¼š
åŒ¹é…æˆåŠŸåï¼ŒPVC çŠ¶æ€å˜ä¸º &lt;code&gt;Bound&lt;/code&gt;ï¼Œä¸ PV å»ºç«‹ä¸€å¯¹ä¸€å…³ç³»&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ"&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é˜¶æ®µ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Pending&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;PVC ç­‰å¾…åŒ¹é… PVï¼ˆæ— å¯ç”¨ PV æˆ– StorageClass æœªå°±ç»ªï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bound&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æˆåŠŸç»‘å®š PVï¼ŒPod å¯æŒ‚è½½ä½¿ç”¨&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Released&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Pod åˆ é™¤åï¼ŒPVC é‡Šæ”¾ PV ä½†ä¿ç•™æ•°æ®ï¼ˆæ ¹æ®å›æ”¶ç­–ç•¥ &lt;code&gt;Retain&lt;/code&gt;/&lt;code&gt;Delete&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Failed&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»‘å®šæˆ–å›æ”¶è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ˆå¦‚å­˜å‚¨åç«¯æ•…éšœï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="è®¿é—®æ¨¡å¼ä¸-pv-çš„å¯¹åº”å…³ç³»"&gt;**è®¿é—®æ¨¡å¼ä¸ PV çš„å¯¹åº”å…³ç³»
&lt;/h4&gt;&lt;p&gt;PVC éœ€ä¸ PV çš„è®¿é—®æ¨¡å¼å…¼å®¹æ‰èƒ½ç»‘å®šï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;PVC è®¿é—®æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ”¯æŒçš„ PV è®¿é—®æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadWriteOnce&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReadWriteOnce&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å• Pod è¯»å†™ï¼ˆå¦‚ MySQLï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadOnlyMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReadOnlyMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤š Pod åªè¯»ï¼ˆå¦‚é…ç½®æ–‡ä»¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReadWriteMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReadWriteMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤š Pod è¯»å†™ï¼ˆå¦‚ NFS å…±äº«ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šäº‘å­˜å‚¨ï¼ˆå¦‚ AWS EBSï¼‰é€šå¸¸ä»…æ”¯æŒ &lt;code&gt;ReadWriteOnce&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-pvc-çš„å®è·µé…ç½®"&gt;ğŸ› ï¸ PVC çš„å®è·µé…ç½®
&lt;/h3&gt;&lt;h4 id="é™æ€ç»‘å®šç¤ºä¾‹"&gt;&lt;strong&gt;é™æ€ç»‘å®šç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# PVC å£°æ˜ï¼ˆåŒ¹é…é¢„åˆ›å»ºçš„ PVï¼‰
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: static-pvc
spec:
accessModes:
- ReadWriteOnce
resources:
requests:
storage: 50Gi
selector: # é€šè¿‡æ ‡ç­¾é€‰æ‹© PV
matchLabels:
type: ssd
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="åŠ¨æ€ç»‘å®šç¤ºä¾‹"&gt;&lt;strong&gt;åŠ¨æ€ç»‘å®šç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# ä¾èµ– StorageClass åŠ¨æ€åˆ›å»º PV
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: dynamic-pvc
spec:
storageClassName: nfs-sc # æŒ‡å®šåŠ¨æ€å­˜å‚¨ç±»
accessModes:
- ReadWriteMany
resources:
requests:
storage: 200Gi
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="pod-æŒ‚è½½-pvc"&gt;&lt;strong&gt;Pod æŒ‚è½½ PVC&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: Pod
metadata:
name: web-server
spec:
containers:
- name: nginx
image: nginx
volumeMounts:
- name: data
mountPath: /var/www/html
volumes:
- name: data
persistentVolumeClaim:
claimName: dynamic-pvc # å¼•ç”¨ PVC åç§°
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šPVC å¿…é¡»ä¸ Pod åœ¨åŒä¸€å‘½åç©ºé—´&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ"&gt;ğŸ§© é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="åŠ¨æ€ä¾›åº”ä¼˜åŒ–"&gt;&lt;strong&gt;åŠ¨æ€ä¾›åº”ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿç»‘å®š&lt;/strong&gt;ï¼ˆ&lt;code&gt;volumeBindingMode: WaitForFirstConsumer&lt;/code&gt;ï¼‰ï¼š
ç­‰å¾… Pod è°ƒåº¦æ—¶å†åˆ›å»º PVï¼Œç¡®ä¿å­˜å‚¨ä¸ Pod åœ¨åŒä¸€æ•…éšœåŸŸï¼ˆå¦‚ AWS å¯ç”¨åŒºï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨æ‰©å®¹&lt;/strong&gt;ï¼š
è‹¥ StorageClass å…è®¸ï¼ˆ&lt;code&gt;allowVolumeExpansion: true&lt;/code&gt;ï¼‰ï¼Œå¯ç¼–è¾‘ PVC è¯·æ±‚æ›´å¤§å®¹é‡ï¼ˆå¦‚ä» &lt;code&gt;100Gi&lt;/code&gt; â†’ &lt;code&gt;200Gi&lt;/code&gt;ï¼‰ï¼Œéœ€å­˜å‚¨åç«¯æ”¯æŒï¼ˆå¦‚ Ceph RBDï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤šåœºæ™¯é€‚é…ç­–ç•¥"&gt;&lt;strong&gt;å¤šåœºæ™¯é€‚é…ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;PVC é…ç½®æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®åº“æŒä¹…åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReadWriteOnce&lt;/code&gt; + å—å­˜å‚¨ï¼ˆå¦‚ AWS EBSï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤š Pod å…±äº«é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReadWriteMany&lt;/code&gt; + NFS/CephFS&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸´æ—¶æ•°æ®å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç©º PVC + &lt;code&gt;emptyDir&lt;/code&gt; å·ï¼ˆæ— éœ€æŒä¹…åŒ–ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="æ•…éšœæ’æŸ¥æŒ‡å—-1"&gt;&lt;strong&gt;æ•…éšœæ’æŸ¥æŒ‡å—&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;PVC é•¿æœŸ Pendingï¼š
&lt;ol&gt;
&lt;li&gt;æ£€æŸ¥ PV èµ„æºæ˜¯å¦å……è¶³ï¼ˆ&lt;code&gt;kubectl get pv&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ StorageClass é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆ&lt;code&gt;kubectl describe storageclass&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ Provisioner æ—¥å¿—ï¼ˆå¦‚ NFS Provisioner Pod æ—¥å¿—ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æŒ‚è½½å¤±è´¥ï¼š
&lt;ol&gt;
&lt;li&gt;ç¡®è®¤ PVC ä¸ç›®æ ‡ PV çš„è®¿é—®æ¨¡å¼å…¼å®¹ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥ç½‘ç»œå­˜å‚¨è¿é€šæ€§ï¼ˆå¦‚ NFS æœåŠ¡å™¨å¯è¾¾æ€§ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-17"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;PVC æ˜¯ Kubernetes å­˜å‚¨ç®¡ç†çš„æ ¸å¿ƒæŠ½è±¡å±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šé€šè¿‡å£°æ˜å¼èµ„æºè¯·æ±‚ï¼Œå®ç°å­˜å‚¨èµ„æºçš„&lt;strong&gt;æŒ‰éœ€åˆ†é…&lt;/strong&gt;ä¸&lt;strong&gt;ç²¾ç»†åŒ–ç®¡æ§&lt;/strong&gt;ï¼Œé¿å…å­˜å‚¨æ»¥ç”¨å¼•å‘çš„ç³»ç»Ÿæ•…éšœ&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§å®è·µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™æ€ç»‘å®š&lt;/strong&gt;é€‚ç”¨äºå›ºå®šå­˜å‚¨éœ€æ±‚ï¼ˆå¦‚é¢„åˆ†é…é«˜æ€§èƒ½ SSDï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç»‘å®š&lt;/strong&gt;ç»“åˆ StorageClass æ˜¯äº‘åŸç”Ÿåœºæ™¯çš„é¦–é€‰ï¼Œæ”¯æŒå¼¹æ€§æ‰©å±•ä¸è‡ªåŠ¨åŒ–è¿ç»´&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®åŸåˆ™&lt;/strong&gt;ï¼šå§‹ç»ˆéµå¾ª &lt;strong&gt;â€œå…ˆè§„åˆ’ â†’ åç”³è¯· â†’ å†ä½¿ç”¨â€&lt;/strong&gt; æµç¨‹ï¼Œä¿éšœé›†ç¾¤å­˜å‚¨èµ„æºçš„ç¨³å®šæ€§å’Œéš”ç¦»æ€§&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="load-balance"&gt;Load Balance
&lt;/h2&gt;&lt;p&gt;Kubernetesï¼ˆK8sï¼‰è´Ÿè½½å‡è¡¡å™¨æ˜¯é›†ç¾¤æµé‡ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å°†è¯·æ±‚é«˜æ•ˆåˆ†å‘åˆ°åç«¯Podï¼Œç¡®ä¿åº”ç”¨çš„é«˜å¯ç”¨æ€§ã€å¼¹æ€§ä¼¸ç¼©å’Œç¨³å®šè¿è¡Œã€‚ä»¥ä¸‹æ˜¯å…¶è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è´Ÿè½½å‡è¡¡å™¨çš„ä½œç”¨"&gt;âš™ï¸ &lt;strong&gt;è´Ÿè½½å‡è¡¡å™¨çš„ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æµé‡åˆ†é…&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å°†å®¢æˆ·ç«¯è¯·æ±‚å‡åŒ€åˆ†å‘åˆ°å¤šä¸ªPodå®ä¾‹ï¼Œé¿å…å•ç‚¹è¿‡è½½ï¼Œæå‡ç³»ç»Ÿååé‡&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;é«˜å¯ç”¨æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨å‰”é™¤æ•…éšœPodï¼Œå°†æµé‡é‡å®šå‘åˆ°å¥åº·å®ä¾‹ï¼Œä¿éšœæœåŠ¡è¿ç»­æ€§&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;å¼¹æ€§ä¼¸ç¼©&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åŠ¨æ€æ„ŸçŸ¥Podæ•°é‡å˜åŒ–ï¼ˆå¦‚HPAæ‰©å®¹ï¼‰ï¼Œå®æ—¶è°ƒæ•´æµé‡åˆ†å‘ç­–ç•¥&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;ä¼šè¯ä¿æŒï¼ˆSession Affinityï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºå®¢æˆ·ç«¯IPå“ˆå¸Œæˆ–Cookieï¼Œç¡®ä¿åŒä¸€ç”¨æˆ·è¯·æ±‚å§‹ç»ˆè·¯ç”±åˆ°åŒä¸€Podï¼Œé€‚ç”¨äºæœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚è´­ç‰©è½¦ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="5"&gt;
&lt;li&gt;TLSç»ˆç»“&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è´Ÿè½½å‡è¡¡å±‚ç»ˆæ­¢HTTPSè¿æ¥ï¼Œå‡è½»åç«¯Podçš„åŠ è§£å¯†è´Ÿæ‹…&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è´Ÿè½½å‡è¡¡å™¨çš„ç±»å‹ä¸å·¥ä½œåŸç†"&gt;ğŸ“¡ &lt;strong&gt;è´Ÿè½½å‡è¡¡å™¨çš„ç±»å‹ä¸å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="service-ç±»å‹"&gt;&lt;strong&gt;Service ç±»å‹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ClusterIP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨æœåŠ¡é€šä¿¡ï¼ˆå¦‚å¾®æœåŠ¡é—´è°ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;åˆ†é…è™šæ‹ŸIPï¼ˆClusterIPï¼‰ï¼Œé€šè¿‡kube-proxyçš„iptables/IPVSè§„åˆ™è½¬å‘åˆ°åç«¯Pod&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: ClusterIP&lt;/code&gt; + ç«¯å£æ˜ å°„&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePort&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼€å‘æµ‹è¯•ç¯å¢ƒå¤–éƒ¨è®¿é—®&lt;/td&gt;
&lt;td&gt;åœ¨&lt;strong&gt;æ‰€æœ‰èŠ‚ç‚¹&lt;/strong&gt;å¼€æ”¾å›ºå®šç«¯å£ï¼ˆ30000-32767ï¼‰ï¼Œå¤–éƒ¨é€šè¿‡&lt;code&gt;&amp;lt;èŠ‚ç‚¹IP&amp;gt;:&amp;lt;NodePort&amp;gt;&lt;/code&gt;è®¿é—®&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: NodePort&lt;/code&gt; + &lt;code&gt;nodePort: 30007&lt;/code&gt;&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;äº‘ç¯å¢ƒç”Ÿäº§çº§å¤–éƒ¨è®¿é—®&lt;/td&gt;
&lt;td&gt;é›†æˆäº‘å‚å•†è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚AWS ELBï¼‰ï¼Œåˆ†é…å…¬ç½‘IPï¼Œæµé‡ç›´è¾¾Service&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: LoadBalancer&lt;/code&gt; + &lt;code&gt;externalTrafficPolicy: Local&lt;/code&gt;ï¼ˆä¿ç•™å®¢æˆ·ç«¯IPï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤æ‚HTTP/HTTPSè·¯ç”±ï¼ˆL7å±‚ï¼‰&lt;/td&gt;
&lt;td&gt;é€šè¿‡Ingress Controllerï¼ˆå¦‚Nginx/Traefikï¼‰å®ç°åŸŸåã€è·¯å¾„è·¯ç”±å’ŒSSLç»ˆæ­¢&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰&lt;code&gt;Ingress&lt;/code&gt;èµ„æº + Nginxæ³¨è§£&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="åº•å±‚å®ç°æŠ€æœ¯"&gt;&lt;strong&gt;åº•å±‚å®ç°æŠ€æœ¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;kube-proxyï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;iptablesæ¨¡å¼&lt;/strong&gt;ï¼šé€šè¿‡Linuxå†…æ ¸iptablesè§„åˆ™è½¬å‘ï¼Œä½†æ€§èƒ½éšè§„åˆ™æ•°é‡ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IPVSæ¨¡å¼&lt;/strong&gt;ï¼šé«˜æ€§èƒ½å†…æ ¸çº§è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒè½®è¯¢ï¼ˆRRï¼‰ã€æœ€å°‘è¿æ¥ï¼ˆLCï¼‰ç­‰ç®—æ³•&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MetalLB&lt;/strong&gt;ï¼š
ä¸º&lt;strong&gt;è‡ªæœ‰é›†ç¾¤&lt;/strong&gt;æä¾›LoadBalanceræ”¯æŒï¼Œåˆ†é…å¤–éƒ¨IPå¹¶é€šå‘Šè·¯ç”±ï¼ˆç±»ä¼¼äº‘å‚å•†LBï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è´Ÿè½½å‡è¡¡ç­–ç•¥"&gt;âš–ï¸ &lt;strong&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;K8sæ”¯æŒå¤šç§æµé‡åˆ†å‘ç­–ç•¥ï¼Œé€šè¿‡Serviceæˆ–Ingressé…ç½®ï¼š
1.
è½®è¯¢ï¼ˆRound Robinï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤ç­–ç•¥ï¼Œè¯·æ±‚ä¾æ¬¡åˆ†å‘åˆ°å„Podï¼Œé€‚ç”¨äºæ— çŠ¶æ€æœåŠ¡&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„Podï¼Œé€‚åˆé•¿è¿æ¥åœºæ™¯ï¼ˆå¦‚æ•°æ®åº“ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;IPå“ˆå¸Œï¼ˆIP Hashï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºå®¢æˆ·ç«¯IPè®¡ç®—å“ˆå¸Œå€¼å›ºå®šè·¯ç”±ï¼Œå®ç°ä¼šè¯ä¿æŒ&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®Podé…ç½®ï¼ˆå¦‚CPU/å†…å­˜ï¼‰åˆ†é…ä¸åŒæƒé‡ï¼Œå¼•å¯¼æ›´å¤šæµé‡åˆ°é«˜æ€§èƒ½å®ä¾‹&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®é…ç½®ä¸æœ€ä½³å®è·µ"&gt;ğŸ§© &lt;strong&gt;å…³é”®é…ç½®ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¥åº·æ£€æŸ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;livenessProbe&lt;/code&gt;/&lt;code&gt;readinessProbe&lt;/code&gt;ç¡®ä¿åªæœ‰å¥åº·Podæ¥æ”¶æµé‡&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;å¤–éƒ¨æµé‡ç­–ç•¥&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;externalTrafficPolicy: Local&lt;/code&gt;ï¼šé¿å…è·¨èŠ‚ç‚¹è·³è½¬ï¼Œä¿ç•™å®¢æˆ·ç«¯IPï¼Œä½†éœ€Podä¸èŠ‚ç‚¹å…±å­˜&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ä¼šè¯ä¿æŒé…ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; apiVersion: v1
kind: Service
spec:
sessionAffinity: ClientIP # åŸºäºå®¢æˆ·ç«¯IPä¼šè¯ä¿æŒ
sessionAffinityConfig:
clientIP:
timeoutSeconds: 3600 # ä¼šè¯è¶…æ—¶æ—¶é—´
&lt;/code&gt;&lt;/pre&gt;&lt;ol start="4"&gt;
&lt;li&gt;MetalLBéƒ¨ç½²ï¼ˆè‡ªæœ‰é›†ç¾¤ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†é…IPæ± å¹¶å¯ç”¨äºŒå±‚é€šå‘Š
7ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
name: ippool
spec:
addresses: [192.168.10.240-192.168.10.250]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ-1"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;External IP é•¿æœŸ Pending&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‘ç¯å¢ƒ&lt;/strong&gt;ï¼šæ£€æŸ¥äº‘è´¦å·æƒé™åŠé…é¢&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªæœ‰é›†ç¾¤&lt;/strong&gt;ï¼šéƒ¨ç½²MetalLBå¹¶é…ç½®IPæ± &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;NodePort è®¿é—®ä¸é€š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®è®¤èŠ‚ç‚¹é˜²ç«å¢™æ”¾è¡ŒNodePortç«¯å£ï¼ˆå¦‚30000-32767ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;å®¢æˆ·ç«¯IPä¸¢å¤±&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®&lt;code&gt;externalTrafficPolicy: Local&lt;/code&gt;ï¼Œé¿å…kube-proxyäºŒæ¬¡è½¬å‘&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;è´Ÿè½½ä¸å‡&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åˆ‡æ¢kube-proxyè‡³IPVSæ¨¡å¼ï¼Œå¯ç”¨æœ€å°‘è¿æ¥ç­–ç•¥&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-18"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;K8sè´Ÿè½½å‡è¡¡å™¨é€šè¿‡&lt;strong&gt;Serviceå››å±‚æŠ½è±¡&lt;/strong&gt;ï¼ˆClusterIP/NodePort/LoadBalancerï¼‰å’Œ&lt;strong&gt;Ingressä¸ƒå±‚è·¯ç”±&lt;/strong&gt;ï¼Œç»“åˆå¥åº·æ£€æŸ¥ã€ä¼šè¯ä¿æŒç­‰æœºåˆ¶ï¼Œå®ç°æµé‡çš„æ™ºèƒ½åˆ†å‘ã€‚ç”Ÿäº§ç¯å¢ƒä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‘ç¯å¢ƒ&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨&lt;code&gt;LoadBalancer&lt;/code&gt; + &lt;code&gt;Ingress&lt;/code&gt;ç»„åˆ&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªæœ‰é›†ç¾¤&lt;/strong&gt;ï¼šé€šè¿‡MetalLBæ¨¡æ‹ŸLoadBalanceråŠŸèƒ½&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®é…ç½®&lt;/strong&gt;ï¼šå¯ç”¨IPVSæ¨¡å¼ã€ä¼šè¯ä¿æŒç­–ç•¥å’Œç²¾ç»†åŒ–æµé‡ç­–ç•¥ï¼Œç¡®ä¿é«˜å¹¶å‘ä¸‹çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æœåŠ¡å‘ç°-1"&gt;æœåŠ¡å‘ç°
&lt;/h2&gt;&lt;p&gt;Kubernetesï¼ˆK8sï¼‰çš„æœåŠ¡å‘ç°æ˜¯å…¶å®¹å™¨ç¼–æ’çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè§£å†³äº†åŠ¨æ€ç¯å¢ƒä¸­æœåŠ¡é—´é€šä¿¡çš„å¯»å€é—®é¢˜ã€‚ä»¥ä¸‹ä»æœºåˆ¶ã€ç»„ä»¶ã€å®è·µåˆ°é«˜çº§åœºæ™¯çš„å…¨é¢è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æœåŠ¡å‘ç°çš„æœ¬è´¨ä¸æŒ‘æˆ˜"&gt;ğŸ” &lt;strong&gt;æœåŠ¡å‘ç°çš„æœ¬è´¨ä¸æŒ‘æˆ˜&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨K8sé›†ç¾¤ä¸­ï¼ŒPodçš„IPåœ°å€éšæ‰©ç¼©å®¹ã€æ•…éšœè¿ç§»è€ŒåŠ¨æ€å˜åŒ–ï¼Œä¼ ç»Ÿé™æ€IPé…ç½®ä¸å¯è¡Œã€‚æœåŠ¡å‘ç°çš„ç›®æ ‡æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€å¯»å€&lt;/strong&gt;ï¼šè‡ªåŠ¨æ„ŸçŸ¥åç«¯å®ä¾‹å˜åŒ–ï¼Œæ— éœ€äººå·¥å¹²é¢„&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæµé‡å‡åŒ€åˆ†å‘åˆ°å¥åº·å®ä¾‹&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ½è±¡éš”ç¦»&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯é€šè¿‡å›ºå®šå…¥å£ï¼ˆå¦‚DNSåç§°ï¼‰è®¿é—®æœåŠ¡ï¼Œå±è”½åº•å±‚Podç»†èŠ‚&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå®ç°æœºåˆ¶"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒå®ç°æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="service-èµ„æºæœåŠ¡æŠ½è±¡çš„åŸºçŸ³"&gt;&lt;strong&gt;Service èµ„æºï¼šæœåŠ¡æŠ½è±¡çš„åŸºçŸ³&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šä¸ºä¸€ç»„Podæä¾›ç¨³å®šçš„è™šæ‹ŸIPï¼ˆClusterIPï¼‰å’ŒDNSåç§°ï¼Œæ ‡ç­¾é€‰æ‹©å™¨åŠ¨æ€å…³è”Pod&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç±»å‹ä¸åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ClusterIP&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰ï¼šé›†ç¾¤å†…éƒ¨é€šä¿¡ï¼Œå¦‚å¾®æœåŠ¡é—´è°ƒç”¨&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NodePort&lt;/code&gt;ï¼šé€šè¿‡èŠ‚ç‚¹IP+ç«¯å£æš´éœ²æœåŠ¡ï¼Œé€‚ç”¨äºæµ‹è¯•ç¯å¢ƒ&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LoadBalancer&lt;/code&gt;ï¼šé›†æˆäº‘å‚å•†LBï¼Œç”Ÿäº§ç¯å¢ƒå¯¹å¤–æš´éœ²æœåŠ¡&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Headless&lt;/code&gt;ï¼ˆ&lt;code&gt;clusterIP: None&lt;/code&gt;ï¼‰ï¼šè¿”å›æ‰€æœ‰Pod IPï¼Œç”¨äºStatefulSetæˆ–è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ExternalName&lt;/code&gt;ï¼šæ˜ å°„åˆ°å¤–éƒ¨åŸŸåï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼Œå®ç°é›†ç¾¤å†…é€æ˜ä»£ç†&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="endpoint-ä¸-endpointsliceåŠ¨æ€å…³è”çš„æ¡¥æ¢"&gt;&lt;strong&gt;Endpoint ä¸ EndpointSliceï¼šåŠ¨æ€å…³è”çš„æ¡¥æ¢&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Endpoint&lt;/strong&gt;ï¼šå­˜å‚¨Serviceå…³è”çš„Pod IPå’Œç«¯å£åˆ—è¡¨ï¼ŒéšPodçŠ¶æ€å®æ—¶æ›´æ–°&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EndpointSlice&lt;/strong&gt;ï¼šæ›¿ä»£æ—§ç‰ˆEndpointï¼Œæ”¯æŒå¤§è§„æ¨¡é›†ç¾¤çš„åˆ†ç‰‡ç®¡ç†&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="dns-æœåŠ¡å‘ç°é»˜è®¤æ¨èæ–¹å¼"&gt;&lt;strong&gt;DNS æœåŠ¡å‘ç°ï¼šé»˜è®¤æ¨èæ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;CoreDNS
ï¼ˆK8s 1.11+é»˜è®¤ç»„ä»¶ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸ºServiceç”ŸæˆDNSè®°å½•ï¼š&lt;code&gt;&amp;lt;service&amp;gt;.&amp;lt;ns&amp;gt;.svc.cluster.local&lt;/code&gt; â†’ ClusterIP&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºHeadless Serviceç”ŸæˆSRVè®°å½•ï¼Œç›´æ¥è¿”å›Pod IPåˆ—è¡¨&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£ææµç¨‹&lt;/strong&gt;ï¼šPodå‘èµ·DNSæŸ¥è¯¢ â†’ CoreDNS â†’ æŸ¥è¯¢K8s APIè·å–Service/Endpoint â†’ è¿”å›IP&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç¯å¢ƒå˜é‡è¾…åŠ©å‘ç°æ–¹å¼"&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡ï¼šè¾…åŠ©å‘ç°æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å…¥è§„åˆ™&lt;/strong&gt;ï¼šPodå¯åŠ¨æ—¶ï¼Œæ³¨å…¥é›†ç¾¤å†…æ‰€æœ‰Serviceçš„&lt;code&gt;SERVICE_HOST&lt;/code&gt;å’Œ&lt;code&gt;SERVICE_PORT&lt;/code&gt;ç¯å¢ƒå˜é‡&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™&lt;/strong&gt;ï¼šå˜é‡åœ¨Podåˆ›å»ºæ—¶å›ºå®šï¼ŒæœåŠ¡å˜æ›´éœ€é‡å¯Podæ‰èƒ½ç”Ÿæ•ˆ&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="kube-proxyæµé‡è½¬å‘å¼•æ“"&gt;&lt;strong&gt;kube-proxyï¼šæµé‡è½¬å‘å¼•æ“&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç›‘å¬Service/Endpointå˜åŒ–ï¼Œç”Ÿæˆiptables/IPVSè§„åˆ™ï¼Œå°†ClusterIPæµé‡è½¬å‘åˆ°åç«¯Pod&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¨¡å¼å¯¹æ¯”ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;iptables&lt;/strong&gt;ï¼šç®€å•ä½†è§„åˆ™é‡å¤§æ—¶æ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IPVS&lt;/strong&gt;ï¼šå†…æ ¸çº§è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒæœ€å°è¿æ¥ã€åŠ æƒè½®è¯¢ç­‰ç®—æ³•ï¼Œé€‚åˆå¤§è§„æ¨¡é›†ç¾¤&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§åœºæ™¯ä¸æ‰©å±•æœºåˆ¶"&gt;ğŸ§© &lt;strong&gt;é«˜çº§åœºæ™¯ä¸æ‰©å±•æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="headless-service-å®æˆ˜"&gt;&lt;strong&gt;Headless Service å®æˆ˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;æœ‰çŠ¶æ€æœåŠ¡ï¼ˆå¦‚Zookeeperã€MySQLé›†ç¾¤ï¼‰ï¼Œéœ€Podç›´æ¥äº’è®¿&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯éœ€è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¦‚åŸºäºåœ°ç†ä½ç½®çš„è·¯ç”±ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é…ç½®ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
clusterIP: None
selector:
app: zookeeper
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤–éƒ¨æœåŠ¡é›†æˆ"&gt;&lt;strong&gt;å¤–éƒ¨æœåŠ¡é›†æˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ExternalNameï¼šæ— ç¼ä»£ç†å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚å…¬æœ‰äº‘RDSï¼‰
3,7ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
type: ExternalName
externalName: mysql.prod.example.com
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æœåŠ¡ç½‘æ ¼service-mesh"&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåœ¨DNSåŸºç¡€ä¸Šæä¾›é«˜çº§èƒ½åŠ›ï¼ˆç†”æ–­ã€é“¾è·¯è¿½è¸ªï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£è¡¨å·¥å…·&lt;/strong&gt;ï¼šIstioã€Linkerdï¼Œé€šè¿‡Sidecarä»£ç†å®ç°ç»†ç²’åº¦æµé‡ç®¡ç†&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§æœ€ä½³å®è·µ-1"&gt;ğŸ› ï¸ &lt;strong&gt;ç”Ÿäº§æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;DNSç­–ç•¥ä¼˜åŒ–&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ClusterFirst&lt;/code&gt;&lt;/strong&gt;ï¼ˆé»˜è®¤ï¼‰ï¼šä¼˜å…ˆè§£æé›†ç¾¤å†…åŸŸåï¼Œå¤–éƒ¨åŸŸåè½¬å‘è‡³ä¸Šæ¸¸DNS&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;None&lt;/code&gt;ç­–ç•¥&lt;/strong&gt;ï¼šå®Œå…¨è‡ªå®šä¹‰DNSé…ç½®ï¼Œæ»¡è¶³ç‰¹æ®Šéœ€æ±‚&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CoreDNS é«˜æ€§èƒ½é…ç½®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜&lt;/strong&gt;ï¼šå¯ç”¨&lt;code&gt;cache&lt;/code&gt;æ’ä»¶å‡å°‘APIè°ƒç”¨&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡ï¼šé€šè¿‡
&lt;pre tabindex="0"&gt;&lt;code&gt;loadbalance
&lt;/code&gt;&lt;/pre&gt;æ’ä»¶å®ç°åŠ æƒè½®è¯¢
8ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;my-service.default.svc.cluster.local {
loadbalance policy round_robin_weighted
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥ä¸æ•…éšœéš”ç¦»&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Endpointæ§åˆ¶å™¨&lt;/strong&gt;ï¼šè‡ªåŠ¨å‰”é™¤æœªé€šè¿‡&lt;code&gt;readinessProbe&lt;/code&gt;çš„Pod&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CoreDNSå¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼šé›†æˆ&lt;code&gt;health&lt;/code&gt;æ’ä»¶é¿å…è½¬å‘æµé‡åˆ°æ•…éšœèŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨ä¸ç›‘æ§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RBAC&lt;/strong&gt;ï¼šé™åˆ¶Service/Endpointè®¿é—®æƒé™&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Prometheusç›‘æ§&lt;/strong&gt;ï¼šé‡‡é›†CoreDNSçš„QPSã€å»¶è¿Ÿç­‰æŒ‡æ ‡&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸æ’æŸ¥"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸æ’æŸ¥&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜ç°è±¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Serviceæ— æ³•è§£æ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ£€æŸ¥CoreDNS PodçŠ¶æ€ â†’ éªŒè¯Endpointæ˜¯å¦æœ‰å¥åº·Pod â†’ ç¡®è®¤Podçš„&lt;code&gt;/etc/resolv.conf&lt;/code&gt;é…ç½®&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Headless Serviceè¿”å›å•IP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ£€æŸ¥Serviceçš„&lt;code&gt;clusterIP: None&lt;/code&gt;é…ç½® â†’ ç¡®è®¤åç«¯Podæ ‡ç­¾åŒ¹é…&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePortè®¿é—®è¶…æ—¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚ç‚¹é˜²ç«å¢™æ”¾è¡Œ30000-32767ç«¯å£ â†’ äº‘ç¯å¢ƒå®‰å…¨ç»„ç­–ç•¥æ£€æŸ¥&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-19"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;K8sæœåŠ¡å‘ç°ä»¥ &lt;strong&gt;ServiceæŠ½è±¡&lt;/strong&gt; ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡ &lt;strong&gt;DNSåŠ¨æ€è§£æ&lt;/strong&gt;ï¼ˆCoreDNSï¼‰å’Œ &lt;strong&gt;ç½‘ç»œä»£ç†&lt;/strong&gt;ï¼ˆkube-proxyï¼‰å®ç°æµé‡è·¯ç”±ï¼Œè¾…ä»¥ &lt;strong&gt;EndpointåŠ¨æ€æ˜ å°„&lt;/strong&gt; å’Œ &lt;strong&gt;ç¯å¢ƒå˜é‡&lt;/strong&gt; æ”¯æŒå¤šåœºæ™¯è®¿é—®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºç¡€é€šä¿¡&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨&lt;code&gt;ClusterIP&lt;/code&gt; + DNSï¼Œé¿å…IPç¡¬ç¼–ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€æœåŠ¡&lt;/strong&gt;ï¼š&lt;code&gt;Headless Service&lt;/code&gt;ç›´è¿Podï¼Œä¿ç•™æ§åˆ¶æƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨é›†æˆ&lt;/strong&gt;ï¼š&lt;code&gt;ExternalName&lt;/code&gt;æ— ç¼ä»£ç†ï¼Œå‡å°‘æ¶æ„æ”¹é€ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§ä¿éšœ&lt;/strong&gt;ï¼šCoreDNSé«˜å¯ç”¨éƒ¨ç½² + IPVSæ¨¡å¼ + ç²¾ç»†åŒ–ç›‘æ§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ç†è§£æœåŠ¡å‘ç°çš„åº•å±‚åä½œï¼ˆAPI Server â†’ CoreDNS â†’ kube-proxy â†’ Endpointï¼‰ï¼Œå¯é«˜æ•ˆæ„å»ºå¼¹æ€§ã€å¯è§‚æµ‹çš„äº‘åŸç”Ÿæ¶æ„&lt;a class="link" href="@ref" &gt;4,5,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="service"&gt;Service
&lt;/h2&gt;&lt;p&gt;Kubernetes &lt;strong&gt;Service&lt;/strong&gt; æ˜¯é›†ç¾¤å†…ç½‘ç»œè®¿é—®çš„æ ¸å¿ƒæŠ½è±¡å±‚ï¼Œä¸ºåŠ¨æ€å˜åŒ–çš„ Pod é›†åˆæä¾›&lt;strong&gt;ç¨³å®šå…¥å£&lt;/strong&gt;ã€&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;å’Œ&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;èƒ½åŠ›ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒæ¦‚å¿µåˆ°ç”Ÿäº§å®è·µå…¨é¢è§£æ Service çš„å·¥ä½œæœºåˆ¶ä¸ä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-service-çš„æ ¸å¿ƒä½œç”¨ä¸ä»·å€¼"&gt;ğŸ” Service çš„æ ¸å¿ƒä½œç”¨ä¸ä»·å€¼
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³ Pod åŠ¨æ€æ€§é—®é¢˜&lt;/strong&gt;
Pod IP éšæ‰©ç¼©å®¹æˆ–é‡å¯å˜åŒ–ï¼ŒService æä¾›å›ºå®šè™šæ‹Ÿ IPï¼ˆClusterIPï¼‰æˆ– DNS åç§°ï¼Œå±è”½åç«¯ Pod çš„ä¸ç¨³å®šæ€§&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°è´Ÿè½½å‡è¡¡&lt;/strong&gt;
è‡ªåŠ¨å°†æµé‡åˆ†å‘åˆ°å¤šä¸ªå¥åº· Podï¼ˆé»˜è®¤è½®è¯¢ç­–ç•¥ï¼‰ï¼Œé¿å…å•ç‚¹è¿‡è½½&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æä¾›æœåŠ¡å‘ç°&lt;/strong&gt;
é›†ç¾¤å†…é€šè¿‡ DNS åç§°ï¼ˆå¦‚ &lt;code&gt;my-svc.namespace.svc.cluster.local&lt;/code&gt;ï¼‰è®¿é—®æœåŠ¡ï¼Œæ— éœ€æ„ŸçŸ¥åç«¯ IP&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-service-çš„ç±»å‹ä¸é€‚ç”¨åœºæ™¯"&gt;âš™ï¸ Service çš„ç±»å‹ä¸é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è®¿é—®æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ClusterIP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨é€šè¿‡ VIP æˆ– DNS è®¿é—®&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡é—´é€šä¿¡ï¼ˆå¦‚å‰ç«¯è°ƒç”¨åç«¯ APIï¼‰&lt;/td&gt;
&lt;td&gt;é»˜è®¤ç±»å‹ï¼Œä»…é™é›†ç¾¤å†…è®¿é—®ï¼Œå®‰å…¨éš”ç¦»&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePort&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;lt;èŠ‚ç‚¹IP&amp;gt;:30000-32767&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æµ‹è¯•ç¯å¢ƒä¸´æ—¶æš´éœ²æœåŠ¡&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰èŠ‚ç‚¹å¼€æ”¾ç«¯å£ï¼Œæ˜“å—æ”»å‡»&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;äº‘å‚å•†è´Ÿè½½å‡è¡¡å™¨çš„å…¬ç½‘ IP&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒå¯¹å¤–æš´éœ²æœåŠ¡ï¼ˆå¦‚ Web åº”ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨é›†æˆäº‘å¹³å° LBï¼ˆå¦‚ AWS ELBï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ExternalName&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜ å°„åˆ°å¤–éƒ¨åŸŸåï¼ˆå¦‚ &lt;code&gt;mysql.example.com&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…è®¿é—®å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ APIï¼‰&lt;/td&gt;
&lt;td&gt;ä»…åš DNS è§£æï¼Œæ— ä»£ç†è½¬å‘&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Headless&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥é€šè¿‡ Pod DNS è®¿é—®&lt;/td&gt;
&lt;td&gt;StatefulSet åœºæ™¯ï¼ˆå¦‚ Zookeeper é€‰ä¸¾ï¼‰ã€è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/td&gt;
&lt;td&gt;&lt;code&gt;clusterIP: None&lt;/code&gt;ï¼Œæš´éœ²æ‰€æœ‰ Pod IP&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;ç”Ÿäº§å»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…éƒ¨æœåŠ¡ â†’ &lt;code&gt;ClusterIP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¯¹å¤–æœåŠ¡ â†’ &lt;code&gt;LoadBalancer&lt;/code&gt; + &lt;code&gt;Ingress&lt;/code&gt;ï¼ˆä¸ƒå±‚è·¯ç”±ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-service-çš„å·¥ä½œåŸç†ä¸æ ¸å¿ƒç»„ä»¶"&gt;ğŸ› ï¸ Service çš„å·¥ä½œåŸç†ä¸æ ¸å¿ƒç»„ä»¶
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåä½œæµç¨‹"&gt;&lt;strong&gt;æ ¸å¿ƒåä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[ç”¨æˆ·è¯·æ±‚] --&amp;gt; B(Service VIP/DNS)
B --&amp;gt; C{kube-proxy}
C --&amp;gt; D[Pod 1]
C --&amp;gt; E[Pod 2]
C --&amp;gt; F[Pod 3]
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;EndpointSlice&lt;/strong&gt;ï¼šåŠ¨æ€è®°å½• Service å…³è”çš„ Pod IP å’Œç«¯å£ï¼ˆæ›¿ä»£æ—§ç‰ˆ Endpointsï¼‰ï¼Œå®æ—¶å“åº” Pod å˜åŒ–&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;kube-proxyï¼šè¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ï¼Œç›‘å¬ Service å˜æ›´å¹¶ç”Ÿæˆè½¬å‘è§„åˆ™ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;iptables æ¨¡å¼&lt;/strong&gt;ï¼šé€šè¿‡ NAT è§„åˆ™è½¬å‘ï¼ˆé»˜è®¤ï¼‰ï¼Œé€‚åˆä¸­å°é›†ç¾¤&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IPVS æ¨¡å¼&lt;/strong&gt;ï¼šå†…æ ¸çº§è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒæœ€å°è¿æ¥/å“ˆå¸Œç­‰ç®—æ³•ï¼Œé€‚åˆå¤§è§„æ¨¡é›†ç¾¤&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CoreDNS&lt;/strong&gt;ï¼šè§£æ Service DNS åç§°åˆ° ClusterIP&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æµé‡è½¬å‘ç¤ºä¾‹"&gt;&lt;strong&gt;æµé‡è½¬å‘ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: Service
metadata:
name: nginx-svc
spec:
selector:
app: nginx-pod # åŒ¹é… Pod æ ‡ç­¾
ports:
- protocol: TCP
port: 80 # Service ç«¯å£
targetPort: 80 # Pod ç«¯å£
type: ClusterIP
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å½“ Pod é‡å¯æ—¶ï¼ŒEndpointSlice è‡ªåŠ¨æ›´æ–° IP åˆ—è¡¨ï¼Œkube-proxy åˆ·æ–° iptables/IPVS è§„åˆ™&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§ç‰¹æ€§ä¸ç”Ÿäº§å®è·µ-1"&gt;âš¡ é«˜çº§ç‰¹æ€§ä¸ç”Ÿäº§å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼šè¯ä¿æŒï¼ˆSession Affinityï¼‰&lt;/strong&gt;
é…ç½® &lt;code&gt;sessionAffinity: ClientIP&lt;/code&gt; ç¡®ä¿åŒä¸€å®¢æˆ·ç«¯è¯·æ±‚å›ºå®šåˆ°åŒä¸€ Podï¼ˆå¦‚è´­ç‰©è½¦åœºæ™¯ï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
sessionAffinity: ClientIP
sessionAffinityConfig:
clientIP:
timeoutSeconds: 3600
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨æµé‡ç­–ç•¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;externalTrafficPolicy: Local&lt;/code&gt;ï¼šä¿ç•™å®¢æˆ·ç«¯æº IPï¼Œé¿å…è·¨èŠ‚ç‚¹è½¬å‘ï¼ˆéœ€ Pod ä¸èŠ‚ç‚¹å…±å­˜ï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;externalTrafficPolicy: Cluster&lt;/code&gt;ï¼šé»˜è®¤ç­–ç•¥ï¼Œå¯èƒ½ä¸¢å¤±æº IP&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Headless Service å®æˆ˜&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
clusterIP: None # æ—  ClusterIP
selector:
app: zookeeper
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šStatefulSet ä¸­ Pod éœ€ç›´æ¥äº’è®¿ï¼ˆå¦‚ Zookeeper é€‰ä¸¾ï¼‰&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸æ’æŸ¥æŒ‡å—"&gt;âš ï¸ å¸¸è§é—®é¢˜ä¸æ’æŸ¥æŒ‡å—
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Service æ— æ³•è®¿é—®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥ EndpointSliceï¼š&lt;code&gt;kubectl get endpointslices&lt;/code&gt; éªŒè¯æ˜¯å¦æœ‰å¥åº· Pod IP&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥ kube-proxy çŠ¶æ€ï¼š&lt;code&gt;systemctl status kube-proxy&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ç½‘ç»œæ’ä»¶ï¼šCalico/Flannel æ˜¯å¦æ­£å¸¸&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NodePort ä¸é€š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹é˜²ç«å¢™æ˜¯å¦æ”¾è¡Œ 30000-32767 ç«¯å£&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;äº‘ç¯å¢ƒå®‰å…¨ç»„ç­–ç•¥æ˜¯å¦å…è®¸æµé‡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DNS è§£æå¤±è´¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®è®¤ CoreDNS Pod è¿è¡ŒçŠ¶æ€ï¼š&lt;code&gt;kubectl get pods -n kube-system&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥ Pod çš„ &lt;code&gt;/etc/resolv.conf&lt;/code&gt; é…ç½®&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-20"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Service æ˜¯ Kubernetes æœåŠ¡æ²»ç†çš„&lt;strong&gt;åŸºçŸ³&lt;/strong&gt;ï¼Œé€šè¿‡ &lt;strong&gt;ClusterIP ç¨³å®šè®¿é—®&lt;/strong&gt;ã€&lt;strong&gt;EndpointSlice åŠ¨æ€å‘ç°&lt;/strong&gt;ã€&lt;strong&gt;kube-proxy æ™ºèƒ½è½¬å‘&lt;/strong&gt; ä¸‰å¤§æœºåˆ¶ï¼Œè§£å†³äº†åŠ¨æ€ç¯å¢ƒä¸‹çš„æœåŠ¡æš´éœ²é—®é¢˜ã€‚ç”Ÿäº§ç¯å¢ƒä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨æœåŠ¡&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;code&gt;ClusterIP&lt;/code&gt; + æ ‡å‡† DNS å‘½åï¼ˆå¦‚ &lt;code&gt;backend-service.prod.svc.cluster.local&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹å¤–æš´éœ²&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;LoadBalancer&lt;/code&gt; ä¸ &lt;code&gt;Ingress&lt;/code&gt; å®ç°ä¸ƒå±‚è·¯ç”±ä¸ TLS ç»ˆç»“&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç‰¹æ®Šåœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;æœ‰çŠ¶æ€åº”ç”¨ â†’ &lt;code&gt;Headless Service&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨æœåŠ¡é›†æˆ â†’ &lt;code&gt;ExternalName&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¼šè¯ä¿æŒ â†’ &lt;code&gt;sessionAffinity&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æŒæ¡ Service çš„åº•å±‚æœºåˆ¶ä¸é«˜çº§ç‰¹æ€§ï¼Œæ˜¯æ„å»ºé«˜å¯ç”¨ã€å¼¹æ€§ä¼¸ç¼©çš„äº‘åŸç”Ÿåº”ç”¨çš„å…³é”®å‰æã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="serviceå¯¹æ¯”"&gt;Serviceå¯¹æ¯”
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Kubernetes Service å„ç±»å‹çš„è¯¦ç»†å¯¹æ¯”è§£æï¼Œæ¶µç›–æ ¸å¿ƒç‰¹æ€§ã€é€‚ç”¨åœºæ™¯ã€å·¥ä½œåŸç†åŠé…ç½®è¦ç‚¹ï¼Œç»“åˆæŠ€æœ¯ç»†èŠ‚ä¸ç”Ÿäº§å®è·µæ€»ç»“è€Œæˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-service-æ ¸å¿ƒç±»å‹å¯¹æ¯”è¡¨"&gt;ğŸ” &lt;strong&gt;Service æ ¸å¿ƒç±»å‹å¯¹æ¯”è¡¨&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è®¿é—®èŒƒå›´&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹é…ç½®&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ClusterIP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…é›†ç¾¤å†…éƒ¨&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡é—´é€šä¿¡ï¼ˆå¦‚ API è°ƒç”¨æ•°æ®åº“ï¼‰&lt;a class="link" href="@ref" &gt;2,6,7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;kube-proxy + CoreDNS&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: ClusterIP&lt;/code&gt;ï¼ˆé»˜è®¤å¯çœç•¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePort&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨ï¼ˆèŠ‚ç‚¹IP:ç«¯å£ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;å¼€å‘æµ‹è¯•ç¯å¢ƒä¸´æ—¶æš´éœ²æœåŠ¡&lt;a class="link" href="@ref" &gt;1,4,7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;kube-proxy + èŠ‚ç‚¹ç½‘ç»œ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: NodePort&lt;/code&gt; + &lt;code&gt;nodePort: 30000-32767&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨ï¼ˆå…¬ç½‘ IPï¼‰&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;äº‘ç¯å¢ƒç”Ÿäº§çº§æš´éœ²ï¼ˆå¦‚ Web åº”ç”¨ï¼‰&lt;a class="link" href="@ref" &gt;4,6,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;äº‘å‚å•† LBï¼ˆå¦‚ AWS ELBï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: LoadBalancer&lt;/code&gt; + &lt;code&gt;externalTrafficPolicy: Local&lt;/code&gt;ï¼ˆä¿ç•™å®¢æˆ·ç«¯ IPï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Headless&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨&lt;/td&gt;
&lt;td&gt;âŒ å¦&lt;/td&gt;
&lt;td&gt;æœ‰çŠ¶æ€æœåŠ¡ç›´è¿ï¼ˆå¦‚ Zookeeperã€MySQL é›†ç¾¤ï¼‰&lt;a class="link" href="@ref" &gt;1,5,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CoreDNS&lt;/td&gt;
&lt;td&gt;&lt;code&gt;clusterIP: None&lt;/code&gt; + æ— è™šæ‹Ÿ IP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ExternalName&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨&lt;/td&gt;
&lt;td&gt;âŒ å¦&lt;/td&gt;
&lt;td&gt;ä»£ç†å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚ç¬¬ä¸‰æ–¹ API æˆ–æ•°æ®åº“ï¼‰&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;CoreDNSï¼ˆCNAME è§£æï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;type: ExternalName&lt;/code&gt; + &lt;code&gt;externalName: mysql.example.com&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®å·®å¼‚&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ClusterIP&lt;/strong&gt;ï¼šåŸºç¡€ç±»å‹ï¼Œæä¾›å†…éƒ¨ç¨³å®š IP å’Œ DNSï¼Œ&lt;strong&gt;ä¸è§£è€¦æ— æ³•æš´éœ²å¤–éƒ¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NodePort&lt;/strong&gt;ï¼šåœ¨ ClusterIP ä¸Šå åŠ èŠ‚ç‚¹ç«¯å£æ˜ å°„ï¼Œ&lt;strong&gt;ç‰ºç‰²å®‰å…¨æ€§å’Œç«¯å£ç®¡ç†ä¾¿æ·æ€§&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;ï¼šåœ¨ NodePort åŸºç¡€ä¸Šé›†æˆäº‘ LBï¼Œ&lt;strong&gt;éœ€äº‘å¹³å°æ”¯æŒä¸”æˆæœ¬è¾ƒé«˜&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Headless&lt;/strong&gt;ï¼šæ—  ClusterIPï¼ŒDNS ç›´æ¥è¿”å› Pod IPï¼Œ&lt;strong&gt;æ”¯æŒè‡ªå®šä¹‰æœåŠ¡å‘ç°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å„ç±»å‹æ·±åº¦è§£æ"&gt;âš™ï¸ &lt;strong&gt;å„ç±»å‹æ·±åº¦è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="clusteripé»˜è®¤ç±»å‹"&gt;&lt;strong&gt;ClusterIPï¼ˆé»˜è®¤ç±»å‹ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;ï¼š
åˆ†é…è™šæ‹Ÿ IPï¼ˆClusterIPï¼‰ï¼Œkube-proxy é€šè¿‡ iptables/IPVS è§„åˆ™å°†æµé‡è½¬å‘åˆ°åç«¯ Pod &lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é«˜çº§é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
sessionAffinity: ClientIP # ä¼šè¯ä¿æŒï¼ˆåŒä¸€å®¢æˆ·ç«¯å›ºå®š Podï¼‰
ports:
- name: http # å¤šç«¯å£æ”¯æŒ
port: 80
targetPort: 8080
- name: metrics
port: 9090
targetPort: 9090
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šå¾®æœåŠ¡é—´é€šä¿¡çš„é¦–é€‰ï¼Œé…åˆ Deployment æ ‡ç­¾é€‰æ‹©å™¨ç¡®ä¿ç²¾å‡†å…³è”&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="nodeport"&gt;&lt;strong&gt;NodePort&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;ï¼š
æ¯ä¸ªèŠ‚ç‚¹å¼€æ”¾é™æ€ç«¯å£ï¼ˆé»˜è®¤ 30000-32767ï¼‰ï¼Œæµé‡ç»èŠ‚ç‚¹ç«¯å£ â†’ ClusterIP â†’ Pod&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…¸å‹é—®é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨é£é™©&lt;/strong&gt;ï¼šç›´æ¥æš´éœ²èŠ‚ç‚¹ IPï¼Œéœ€é…ç½®é˜²ç«å¢™é™åˆ¶è®¿é—®æº IP&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç«¯å£å†²çª&lt;/strong&gt;ï¼šæ‰‹åŠ¨æŒ‡å®šç«¯å£æ˜“å†²çªï¼Œå»ºè®®è‡ªåŠ¨åˆ†é…&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="loadbalancer"&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‘å¹³å°é›†æˆ&lt;/strong&gt;ï¼š
è‡ªåŠ¨åˆ›å»ºäº‘è´Ÿè½½å‡è¡¡å™¨ï¼Œåˆ†é…å…¬ç½‘ IPï¼Œå¹¶å…³è” NodePort ç«¯å£&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æµé‡ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;externalTrafficPolicy: Cluster&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰ï¼šå¯èƒ½ä¸¢å¤±å®¢æˆ·ç«¯ IPï¼ˆè·¨èŠ‚ç‚¹è½¬å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;externalTrafficPolicy: Local&lt;/code&gt;ï¼šä¿ç•™å®¢æˆ·ç«¯ IPï¼Œä½†éœ€ Pod ä¸èŠ‚ç‚¹å…±å­˜&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="headless-service"&gt;&lt;strong&gt;Headless Service&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒä»·å€¼ï¼š
DNS æŸ¥è¯¢è¿”å›æ‰€æœ‰ Pod IPï¼ˆå¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; nslookup zk-headless
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿”å›&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; 10.244.1.2, 10.244.1.3
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰ï¼Œé€‚ç”¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;StatefulSet æœåŠ¡å‘ç°&lt;/strong&gt;ï¼ˆå¦‚ Zookeeper é€‰ä¸¾éœ€äº’çŸ¥ IPï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼ˆå®¢æˆ·ç«¯ç›´æ¥é€‰æ‹© Podï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="externalname"&gt;&lt;strong&gt;ExternalName&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€æ˜ä»£ç†&lt;/strong&gt;ï¼š
å°†å†…éƒ¨æœåŠ¡åæ˜ å°„åˆ°å¤–éƒ¨åŸŸåï¼ˆå¦‚ &lt;code&gt;my-db â†’ db.example.com&lt;/code&gt;ï¼‰ï¼Œæ— æµé‡ä»£ç†&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
é€æ­¥è¿ç§»å¤–éƒ¨æœåŠ¡åˆ°é›†ç¾¤ï¼Œå‡å°‘é‡æ„æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒé€‰å‹å†³ç­–æŒ‡å—"&gt;ğŸ§© &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒé€‰å‹å†³ç­–æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç†ç”±&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨æœåŠ¡è°ƒç”¨&lt;/td&gt;
&lt;td&gt;ClusterIP&lt;/td&gt;
&lt;td&gt;å®‰å…¨éš”ç¦»ã€ä½å»¶è¿Ÿ&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸´æ—¶å¤–éƒ¨è®¿é—®ï¼ˆæµ‹è¯•ï¼‰&lt;/td&gt;
&lt;td&gt;NodePort&lt;/td&gt;
&lt;td&gt;å¿«é€Ÿæš´éœ²ï¼Œæ— éœ€äº‘èµ„æº&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;äº‘ç¯å¢ƒç”Ÿäº§çº§æš´éœ²&lt;/td&gt;
&lt;td&gt;LoadBalancer&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨å…¬ç½‘ IP + é«˜å¯ç”¨è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœ‰çŠ¶æ€é›†ç¾¤ï¼ˆå¦‚ Kafkaï¼‰&lt;/td&gt;
&lt;td&gt;Headless&lt;/td&gt;
&lt;td&gt;Pod ç›´è¿ + è‡ªå®šä¹‰å‘ç°æœºåˆ¶&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é›†æˆå¤–éƒ¨æ•°æ®åº“&lt;/td&gt;
&lt;td&gt;ExternalName&lt;/td&gt;
&lt;td&gt;æ— ç¼ä»£ç†å¤–éƒ¨æœåŠ¡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;é¿å‘æé†’&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NodePort æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ï¼šè¶…è¿‡ 1000 ä¸ª Service æ—¶ iptables è§„åˆ™è†¨èƒ€ï¼Œéœ€åˆ‡æ¢ IPVS æ¨¡å¼&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LoadBalancer æˆæœ¬&lt;/strong&gt;ï¼šæ¯ä¸ª Service ç‹¬ç«‹äº‘ LBï¼Œå»ºè®®ç»“åˆ Ingress æ”¶æ•›å…¥å£&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Headless å¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼šéœ€é…åˆ &lt;code&gt;readinessProbe&lt;/code&gt; é¿å… DNS è¿”å›ä¸å¥åº· Pod&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-21"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºç¡€å±‚&lt;/strong&gt;ï¼šClusterIP æ˜¯ Service çš„åŸºçŸ³ï¼Œ90% çš„å†…éƒ¨é€šä¿¡ä¾èµ–å®ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æš´éœ²å±‚&lt;/strong&gt;ï¼šNodePort è½»é‡ä½†é£é™©é«˜ï¼ŒLoadBalancer å¼ºå¤§ä½†æœ‰äº‘ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;ç‰¹æ®Šåœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;æœ‰çŠ¶æ€æœåŠ¡ â†’ Headlessï¼ˆæ— å¤´æœåŠ¡ï¼‰&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨é›†æˆ â†’ ExternalNameï¼ˆé€æ˜ä»£ç†ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿›é˜¶ç»„åˆ&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒ&lt;strong&gt;å¯¹å¤–æœåŠ¡&lt;/strong&gt;ä¼˜å…ˆé‡‡ç”¨ &lt;strong&gt;LoadBalancer + Ingress&lt;/strong&gt;ï¼ˆä¸ƒå±‚è·¯ç”±ï¼‰ï¼Œ&lt;strong&gt;å†…éƒ¨æœåŠ¡&lt;/strong&gt;ç”¨ &lt;strong&gt;ClusterIP + Service Mesh&lt;/strong&gt;ï¼ˆç»†ç²’åº¦æ²»ç†ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æŒæ¡ Service ç±»å‹å·®å¼‚æ˜¯ Kubernetes ç½‘ç»œèƒ½åŠ›çš„æ ¸å¿ƒï¼Œåˆç†é€‰å‹å¯å¤§å¹…æå‡æ¶æ„ç¨³å®šæ€§ä¸è¿ç»´æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ingress"&gt;Ingress
&lt;/h2&gt;&lt;h3 id="-kubernetes-ingress-å…¨é¢è§£æ"&gt;ğŸšª Kubernetes Ingress å…¨é¢è§£æ
&lt;/h3&gt;&lt;p&gt;Ingress æ˜¯ Kubernetes ä¸­ç®¡ç†å¤–éƒ¨è®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé€šè¿‡å®šä¹‰ HTTP/HTTPS è·¯ç”±è§„åˆ™å®ç°æµé‡åˆ†å‘ã€è´Ÿè½½å‡è¡¡å’Œ SSL ç»ˆæ­¢ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¦ç‚¹åŠå®è·µæŒ‡å—ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="-ingress-çš„æ ¸å¿ƒæ¦‚å¿µä¸å·¥ä½œåŸç†"&gt;ğŸ” &lt;strong&gt;Ingress çš„æ ¸å¿ƒæ¦‚å¿µä¸å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ingress èµ„æºå¯¹è±¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå®šä¹‰è·¯ç”±è§„åˆ™ï¼ˆå¦‚åŸŸåã€è·¯å¾„ï¼‰ï¼ŒæŒ‡å®šæµé‡å¦‚ä½•è½¬å‘åˆ°åç«¯ Service&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ YAMLï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
name: example-ingress
annotations:
nginx.ingress.kubernetes.io/rewrite-target: /
spec:
rules:
- host: app.example.com
http:
paths:
- path: /api
pathType: Prefix
backend:
service:
name: api-service
port:
number: 80
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Ingress Controller&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šç›‘å¬ Ingress è§„åˆ™å˜åŒ–ï¼ŒåŠ¨æ€ç”Ÿæˆä»£ç†é…ç½®ï¼ˆå¦‚ Nginxã€Traefikï¼‰å¹¶é‡è½½&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å·¥ä½œæµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;ç›‘æ§ API Server çš„ Ingress å˜æ›´ï¼›&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆä»£ç†é…ç½®æ–‡ä»¶ï¼ˆå¦‚ Nginx çš„ &lt;code&gt;nginx.conf&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;é‡è½½ä»£ç†æœåŠ¡åº”ç”¨æ–°é…ç½®&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="-æ ¸å¿ƒç»„ä»¶ä¸å…³ç³»"&gt;ğŸ§© &lt;strong&gt;æ ¸å¿ƒç»„ä»¶ä¸å…³ç³»&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§’è‰²&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress èµ„æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜è·¯ç”±è§„åˆ™ï¼ˆYAML é…ç½®ï¼‰&lt;/td&gt;
&lt;td&gt;ä¾èµ– Ingress Controller å®ç°åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress Controller&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰§è¡Œè§„åˆ™çš„åå‘ä»£ç†ï¼ˆå¦‚ Nginx Podï¼‰&lt;/td&gt;
&lt;td&gt;éœ€éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ï¼Œç›‘å¬è§„åˆ™å˜åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å…³è”åç«¯ Podï¼Œæä¾›ç¨³å®šçš„è®¿é—®ç«¯ç‚¹&lt;/td&gt;
&lt;td&gt;Ingress é€šè¿‡ Service æ‰¾åˆ° Pod&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šIngress &lt;strong&gt;ä¸ç›´æ¥æš´éœ²ç«¯å£&lt;/strong&gt;ï¼Œè€Œæ˜¯ç”± Ingress Controller æ¥æ”¶å¤–éƒ¨æµé‡å¹¶è½¬å‘&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h4 id="-ingress-çš„æš´éœ²æ–¹å¼"&gt;âš™ï¸ &lt;strong&gt;Ingress çš„æš´éœ²æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePort + Ingress Controller&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡èŠ‚ç‚¹ç«¯å£ï¼ˆå¦‚ &lt;code&gt;30000-32767&lt;/code&gt;ï¼‰æš´éœ² Controllerï¼Œå†è½¬å‘åˆ° Service&lt;/td&gt;
&lt;td&gt;æµ‹è¯•ç¯å¢ƒã€éäº‘ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;âš ï¸ ç«¯å£ç®¡ç†å¤æ‚ï¼Œå¤šä¸€å±‚ NAT è½¬å‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;LoadBalancer + Ingress Controller&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;äº‘å¹³å° LB ç›´è¿ Controllerï¼Œæµé‡ç›´è¾¾åç«¯&lt;/td&gt;
&lt;td&gt;å…¬æœ‰äº‘ç”Ÿäº§ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;âœ… é«˜å¯ç”¨ï¼›ğŸš« äº‘å¹³å°ä¾èµ–å’Œé«˜æˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HostNetwork + DaemonSet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Controller ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œç›´æ¥ç»‘å®š 80/443 ç«¯å£&lt;/td&gt;
&lt;td&gt;é«˜æ€§èƒ½ç”Ÿäº§ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;âœ… ä½å»¶è¿Ÿï¼›ğŸš« å•èŠ‚ç‚¹é™åˆ¶ï¼ˆæ¯èŠ‚ç‚¹ä»…ä¸€ä¸ª Podï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;DaemonSet é…ç½®ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
template:
spec:
hostNetwork: true # ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ
nodeSelector:
ingress: &amp;#34;true&amp;#34; # æŒ‡å®šèŠ‚ç‚¹æ ‡ç­¾
```[2](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h4 id="-å®‰è£…ä¸é…ç½®å®è·µ"&gt;ğŸ› ï¸ &lt;strong&gt;å®‰è£…ä¸é…ç½®å®è·µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£… Ingress Controllerï¼ˆä»¥ Nginx ä¸ºä¾‹ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Helm éƒ¨ç½²ï¼ˆæ¨èï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm install ingress-nginx ingress-nginx/ingress-nginx -n ingress-nginx
```[3,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›½å†…é•œåƒåŠ é€Ÿ&lt;/strong&gt;ï¼šæ›¿æ¢é•œåƒä¸ºé˜¿é‡Œäº‘ä»“åº“ï¼ˆå¦‚ &lt;code&gt;registry.cn-hangzhou.aliyuncs.com/google_containers/nginx-ingress-controller&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®è·¯ç”±è§„åˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸŸåè·¯ç”±ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;spec:
rules:
- host: app.example.com
http:
paths:
- backend:
service:
name: web-service
port: 80
```&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯å¾„é‡å†™&lt;/strong&gt;ï¼šé€šè¿‡æ³¨è§£ &lt;code&gt;nginx.ingress.kubernetes.io/rewrite-target: /&lt;/code&gt; å®ç°&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;HTTPS é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿæˆ TLS è¯ä¹¦&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»º Secret&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl create secret tls my-tls --key tls.key --cert tls.crt
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ingress å¼•ç”¨&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
tls:
- hosts:
- app.example.com
secretName: my-tls
```[1,3](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="-å¸¸è§é—®é¢˜ä¸æ’æŸ¥-1"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸æ’æŸ¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress æ— æ³•è®¿é—®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Controller Pod æœªè¿è¡Œæˆ–è§„åˆ™é”™è¯¯&lt;/td&gt;
&lt;td&gt;æ£€æŸ¥ Pod çŠ¶æ€ï¼š&lt;code&gt;kubectl get pods -n ingress-nginx&lt;/code&gt;ï¼›éªŒè¯ Service ç«¯å£åŒ¹é…&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HTTPS è¯ä¹¦ä¸ç”Ÿæ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Secret æœªæ­£ç¡®æŒ‚è½½æˆ–åŸŸåä¸åŒ¹é…&lt;/td&gt;
&lt;td&gt;ç¡®è®¤ Secret å­˜åœ¨ä¸” Ingress ä¸­åŸŸåä¸è¯ä¹¦ä¸€è‡´ï¼›æ£€æŸ¥æ³¨è§£ &lt;code&gt;use-regex: &amp;quot;true&amp;quot;&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¯ç”±è§„åˆ™æœªç”Ÿæ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è·¯å¾„åŒ¹é…é”™è¯¯æˆ–åç«¯ Service ä¸å¯ç”¨&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;code&gt;kubectl describe ingress &amp;lt;name&amp;gt;&lt;/code&gt; æŸ¥çœ‹äº‹ä»¶ï¼›éªŒè¯ Service çš„ Endpoint&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h4 id="-æ€»ç»“ä¸æœ€ä½³å®è·µ-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šç»Ÿä¸€å…¥å£ç®¡ç†å¤šæœåŠ¡ï¼Œæ”¯æŒä¸ƒå±‚è·¯ç”±ã€SSL ç»ˆæ­¢å’Œè´Ÿè½½å‡è¡¡ï¼Œæ›¿ä»£ç¹ççš„ NodePort ç®¡ç†&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‰å‹å»ºè®®ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¬æœ‰äº‘&lt;/strong&gt;ï¼šLoadBalancer + Ingress Controllerï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§æœ‰äº‘&lt;/strong&gt;ï¼šHostNetwork + DaemonSetï¼ˆé«˜æ€§èƒ½éœ€æ±‚ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘æµ‹è¯•&lt;/strong&gt;ï¼šNodePort å¿«é€ŸéªŒè¯&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿›é˜¶ä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HPA é›†æˆ&lt;/strong&gt;ï¼šæ ¹æ®æµé‡è‡ªåŠ¨æ‰©ç¼© Controller Podï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WAF æ³¨è§£&lt;/strong&gt;ï¼šé€šè¿‡æ³¨è§£æ·»åŠ  Web åº”ç”¨é˜²ç«å¢™è§„åˆ™ï¼ˆå¦‚ Nginx çš„ &lt;code&gt;modsecurity&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿäº§å£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;è§„åˆ™å£°æ˜ Ingressï¼Œæµé‡å…¥å£ Controllerï¼›
è·¯ç”±åˆ†å‘é è·¯å¾„ï¼ŒHTTPS éœ€é… TLS è¯ä¹¦ï¼›
å…¬æœ‰äº‘ç”¨ LBï¼Œç§æœ‰é›†ç¾¤ HostNetwork æ‰›ï¼â€‹&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ingress--service"&gt;Ingress &amp;amp; Service
&lt;/h2&gt;&lt;p&gt;Ingress å’Œ Service æ˜¯ Kubernetes ç½‘ç»œæ¨¡å‹ä¸­ç´§å¯†åä½œä½†èŒè´£åˆ†æ˜çš„ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå…±åŒå®ç°é›†ç¾¤å†…å¤–çš„æµé‡ç®¡ç†ã€‚å®ƒä»¬çš„å…³ç³»å¯é€šè¿‡ä»¥ä¸‹ç»´åº¦è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåˆ†å·¥å±‚çº§ä¸åŠŸèƒ½å·®å¼‚"&gt;ğŸ”„ æ ¸å¿ƒåˆ†å·¥ï¼šå±‚çº§ä¸åŠŸèƒ½å·®å¼‚
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç½‘ç»œå±‚çº§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ è¾“å±‚ï¼ˆL4ï¼‰&lt;/td&gt;
&lt;td&gt;1. &lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ï¼šä¸ºåŠ¨æ€ Pod æä¾›å›ºå®šè®¿é—®ç«¯ç‚¹ï¼ˆClusterIPï¼‰ 2. &lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šåœ¨ Pod é—´åˆ†å‘æµé‡ï¼ˆTCP/UDPï¼‰ 3. &lt;strong&gt;æš´éœ²æ–¹å¼&lt;/strong&gt;ï¼šæ”¯æŒ ClusterIPï¼ˆå†…éƒ¨ï¼‰ã€NodePortï¼ˆèŠ‚ç‚¹ç«¯å£ï¼‰ã€LoadBalancerï¼ˆå¤–éƒ¨ IPï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨é€šä¿¡ã€åŸºç¡€æœåŠ¡æš´éœ²ï¼ˆå¦‚æ•°æ®åº“ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨å±‚ï¼ˆL7ï¼‰&lt;/td&gt;
&lt;td&gt;1. &lt;strong&gt;è·¯ç”±è§„åˆ™&lt;/strong&gt;ï¼šåŸºäºåŸŸå/è·¯å¾„è·¯ç”± HTTP/HTTPS æµé‡ 2. &lt;strong&gt;TLS ç»ˆæ­¢&lt;/strong&gt;ï¼šé›†ä¸­ç®¡ç† SSL è¯ä¹¦ 3. &lt;strong&gt;ç»Ÿä¸€å…¥å£&lt;/strong&gt;ï¼šå¤šæœåŠ¡å…±äº«åŒä¸€ IP å’Œç«¯å£&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨è®¿é—® Web åº”ç”¨ã€API ç½‘å…³&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®åŒºåˆ«&lt;/strong&gt;ï¼š
Service ç›´æ¥ç®¡ç† Pod æµé‡ï¼ˆL4ï¼‰ï¼Œè€Œ Ingress ç®¡ç†å¤–éƒ¨è¯·æ±‚åˆ° Service çš„è·¯ç”±ï¼ˆL7ï¼‰ï¼Œâ€‹&lt;strong&gt;ä¸¤è€…æ˜¯ä¸Šä¸‹æ¸¸å…³ç³»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-åä½œå…³ç³»æµé‡è·¯å¾„è§£æ"&gt;ğŸ”— åä½œå…³ç³»ï¼šæµé‡è·¯å¾„è§£æ
&lt;/h3&gt;&lt;p&gt;å…¸å‹å¤–éƒ¨è®¿é—®è·¯å¾„å¦‚ä¸‹ï¼ˆä»¥ HTTP è¯·æ±‚ä¸ºä¾‹ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[ç”¨æˆ·] --&amp;gt; B[Ingress Controller]
B --&amp;gt; C[Ingress è§„åˆ™]
C --&amp;gt; D[Service]
D --&amp;gt; E[Pod]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Ingress Controller&lt;/strong&gt;ï¼šç›‘å¬ Ingress èµ„æºå˜åŒ–ï¼Œé…ç½®åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ingress è§„åˆ™&lt;/strong&gt;ï¼šæ ¹æ® &lt;code&gt;host&lt;/code&gt; å’Œ &lt;code&gt;path&lt;/code&gt; åŒ¹é…è¯·æ±‚ï¼Œè½¬å‘åˆ°å¯¹åº” Serviceï¼ˆå¦‚ &lt;code&gt;service-app&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service&lt;/strong&gt;ï¼šé€šè¿‡ ClusterIP æ¥æ”¶æµé‡ï¼Œè´Ÿè½½å‡è¡¡åˆ°åç«¯ Pod&lt;a class="link" href="@ref" &gt;4,10&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pod&lt;/strong&gt;ï¼šæœ€ç»ˆå¤„ç†è¯·æ±‚çš„åº”ç”¨å®¹å™¨&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼š
Ingress â€‹&lt;strong&gt;å¿…é¡»ä¾èµ– Service&lt;/strong&gt;â€‹ ä½œä¸ºåç«¯ç›®æ ‡ï¼Œä½† Service å¯ç‹¬ç«‹å­˜åœ¨ï¼ˆå¦‚ NodePort ç›´æ¥æš´éœ²ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®ç‰¹æ€§å¯¹æ¯”"&gt;âš–ï¸ å…³é”®ç‰¹æ€§å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Ingress&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åè®®æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»… HTTP/HTTPS&lt;/td&gt;
&lt;td&gt;TCP/UDP/HTTP ç­‰å…¨åè®®&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡å¯¹è±¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤šä¸ª Serviceï¼ˆè·¨æœåŠ¡è·¯ç”±ï¼‰&lt;/td&gt;
&lt;td&gt;å•ä¸ª Service çš„å¤šä¸ª Pod&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è·¯å¾„é‡å†™ã€ç†”æ–­ã€è®¤è¯&lt;/td&gt;
&lt;td&gt;åŸºç¡€è½®è¯¢/IP å“ˆå¸Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤–éƒ¨è®¿é—®å¿…è¦æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿…éœ€ï¼ˆç®¡ç†å¤–éƒ¨å…¥å£ï¼‰&lt;/td&gt;
&lt;td&gt;å¯é€‰ï¼ˆClusterIP ä»…å†…éƒ¨å¯ç”¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»„ä»¶ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ç‹¬ç«‹éƒ¨ç½² Ingress Controller&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä»…éœ€ kube-proxyï¼ˆé›†ç¾¤å†…ç½®ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åä½œåœºæ™¯"&gt;ğŸ› ï¸ å…¸å‹åä½œåœºæ™¯
&lt;/h3&gt;&lt;h4 id="å¤šæœåŠ¡ç»Ÿä¸€å…¥å£"&gt;&lt;strong&gt;å¤šæœåŠ¡ç»Ÿä¸€å…¥å£&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€æ±‚&lt;/strong&gt;ï¼šé€šè¿‡åŒä¸€åŸŸåæš´éœ² &lt;code&gt;web-service&lt;/code&gt; å’Œ &lt;code&gt;api-service&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# Ingress è§„åˆ™
spec:
rules:
- host: example.com
http:
paths:
- path: /web
backend: service: web-service:80
- path: /api
backend: service: api-service:80 [1,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;Service éœ€é¢„å…ˆåˆ›å»ºï¼Œç¡®ä¿æ ‡ç­¾åŒ¹é… Podã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="https-å®‰å…¨è®¿é—®"&gt;&lt;strong&gt;HTTPS å®‰å…¨è®¿é—®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Ingress é…ç½® TLSï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
tls:
- secretName: tls-cert # å¼•ç”¨è¯ä¹¦ Secret
hosts: [example.com]
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;Service ä»ä½¿ç”¨ HTTPï¼Œç”± Ingress å¤„ç†åŠ è§£å¯†&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ··åˆäº‘æµé‡ç®¡ç†"&gt;&lt;strong&gt;æ··åˆäº‘æµé‡ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Service ç±»å‹&lt;/strong&gt;ï¼š&lt;code&gt;ClusterIP&lt;/code&gt;ï¼ˆå†…éƒ¨é€šä¿¡ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ingress å¯¹æ¥&lt;/strong&gt;ï¼šäº‘å‚å•† LoadBalancerï¼ˆå¦‚è…¾è®¯äº‘ CLBï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å®šä½ä¸åä½œä»·å€¼"&gt;ğŸ’ æ€»ç»“ï¼šå®šä½ä¸åä½œä»·å€¼
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®šä½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸å¯æ›¿ä»£æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡çš„â€œç¨³å®šå¯¼èˆªå‘˜â€&lt;/td&gt;
&lt;td&gt;è§£å†³ Pod åŠ¨æ€æ€§ï¼Œä¿éšœä¸œè¥¿æµé‡å¯é æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤çš„â€œæ™ºèƒ½å‰å°â€&lt;/td&gt;
&lt;td&gt;ç®€åŒ–å—åŒ—æµé‡æ²»ç†ï¼Œå®ç°é«˜çº§è·¯ç”±æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨å¾®æœåŠ¡&lt;/strong&gt;ï¼šä¼˜å…ˆç”¨ Serviceï¼ˆClusterIPï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨ Web æœåŠ¡&lt;/strong&gt;ï¼šå¿…ç”¨ Ingress + Serviceï¼ˆLoadBalancer/NodePortï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§æ¶æ„&lt;/strong&gt;ï¼šIngress ä½œä¸ºå”¯ä¸€å¤–éƒ¨å…¥å£ï¼ŒService ä¸“æ³¨å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œå½¢æˆ &lt;strong&gt;â€œå¤–ç»Ÿå†…åˆ†â€&lt;/strong&gt; çš„é«˜æ•ˆæµé‡ç®¡ç†ä½“ç³»&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="load-balance--ingress"&gt;Load Balance &amp;amp; Ingress
&lt;/h2&gt;&lt;p&gt;åœ¨ Kubernetes ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç»“åˆ &lt;code&gt;LoadBalancer&lt;/code&gt; ä¸ &lt;code&gt;Ingress&lt;/code&gt; æ˜¯ç®¡ç†å¤–éƒ¨æµé‡å’Œå®ç°é«˜çº§è·¯ç”±çš„æ ¸å¿ƒæ–¹æ¡ˆã€‚è¿™ç§ç»„åˆæ—¢èƒ½åˆ©ç”¨äº‘å¹³å°åŸºç¡€è®¾æ–½çš„ç¨³å®šæ€§ï¼Œåˆèƒ½é€šè¿‡ Ingress å®ç°çµæ´»çš„ä¸ƒå±‚æµé‡æ²»ç†ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å®ç°åŸç†ã€é…ç½®æ­¥éª¤å’Œæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶æ„è®¾è®¡ä¸æµé‡è·¯å¾„"&gt;ğŸŒ æ¶æ„è®¾è®¡ä¸æµé‡è·¯å¾„
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåˆ†å·¥"&gt;&lt;strong&gt;æ ¸å¿ƒåˆ†å·¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;LoadBalancer&lt;/code&gt; Service&lt;/strong&gt;ï¼ˆå››å±‚ï¼ŒL4ï¼‰ï¼š
ç”±äº‘å‚å•†ï¼ˆå¦‚ AWS ELBã€é˜¿é‡Œäº‘ SLBï¼‰æˆ– MetalLBï¼ˆç§æœ‰äº‘ï¼‰æä¾›å¤–éƒ¨ IPï¼Œè´Ÿè´£åŸºç¡€æµé‡åˆ†å‘å’Œè´Ÿè½½å‡è¡¡ã€‚æ¯ä¸ª &lt;code&gt;LoadBalancer&lt;/code&gt; Service æ¶ˆè€—ä¸€ä¸ªç‹¬ç«‹ IPã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Ingress Controller&lt;/code&gt;&lt;/strong&gt;ï¼ˆä¸ƒå±‚ï¼ŒL7ï¼‰ï¼š
è¿è¡Œåœ¨é›†ç¾¤å†…çš„åå‘ä»£ç†ï¼ˆå¦‚ Nginx Ingress Controllerï¼‰ï¼Œè§£æ &lt;code&gt;Ingress&lt;/code&gt; èµ„æºå®šä¹‰çš„è§„åˆ™ï¼Œå®ç°åŸºäºåŸŸåã€è·¯å¾„çš„è·¯ç”±ã€TLS ç»ˆæ­¢ç­‰é«˜çº§åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æµé‡è·¯å¾„"&gt;&lt;strong&gt;æµé‡è·¯å¾„&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[å®¢æˆ·ç«¯] --&amp;gt; B[LoadBalancer&amp;lt;br&amp;gt;äº‘å‚å•† SLB/ELB]
B --&amp;gt; C[Ingress Controller Pod]
C --&amp;gt; D[Ingress è§„åˆ™]
D --&amp;gt; E[ç›®æ ‡ Service&amp;lt;br&amp;gt;ClusterIP]
E --&amp;gt; F[ä¸šåŠ¡ Pod]
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å…³é”®ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;LoadBalancer å°†æµé‡å¯¼å‘ Ingress Controller çš„ Serviceï¼ˆç±»å‹ä¸º &lt;code&gt;LoadBalancer&lt;/code&gt; æˆ– &lt;code&gt;NodePort&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Ingress Controller ç›´æ¥è®¿é—® Pod IPï¼ˆ&lt;strong&gt;è·³è¿‡ kube-proxy&lt;/strong&gt;ï¼‰ï¼Œå‡å°‘è½¬å‘å»¶è¿Ÿ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®æ­¥éª¤ä»¥-nginx-ingress-ä¸ºä¾‹"&gt;âš™ï¸ é…ç½®æ­¥éª¤ï¼ˆä»¥ Nginx Ingress ä¸ºä¾‹ï¼‰
&lt;/h3&gt;&lt;h4 id="éƒ¨ç½²-ingress-controller"&gt;&lt;strong&gt;éƒ¨ç½² Ingress Controller&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ Helm æˆ– YAML å®‰è£…ï¼Œå¹¶å…³è” LoadBalancerï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# Helm å®‰è£…
helm upgrade --install ingress-nginx ingress-nginx \
--repo https://kubernetes.github.io/ingress-nginx \
--namespace ingress-nginx --create-namespace
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åˆ›å»º LoadBalancer&lt;/strong&gt;ï¼š
Ingress Controller çš„ Service è®¾ç½®ä¸º &lt;code&gt;type: LoadBalancer&lt;/code&gt;ï¼Œäº‘å¹³å°ä¼šè‡ªåŠ¨åˆ†é…å¤–éƒ¨ IP&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®-ingress-è·¯ç”±è§„åˆ™"&gt;&lt;strong&gt;é…ç½® Ingress è·¯ç”±è§„åˆ™&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®šä¹‰åŸŸåå’Œè·¯å¾„è·¯ç”±ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
name: app-ingress
annotations:
nginx.ingress.kubernetes.io/rewrite-target: /$1 # URL é‡å†™
spec:
ingressClassName: nginx
rules:
- host: app.example.com
http:
paths:
- path: /api/(.*) # æ­£åˆ™åŒ¹é…è·¯å¾„
pathType: Prefix
backend:
service:
name: api-service
port:
number: 80
- path: /static
backend:
service:
name: static-service
port:
number: 8080
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="é…ç½®-tls-åŠ å¯†"&gt;&lt;strong&gt;é…ç½® TLS åŠ å¯†&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spec:
tls:
- hosts:
- app.example.com
secretName: tls-cert # æå‰åˆ›å»ºè¯ä¹¦ Secret
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å…³é”®ä¼˜åŒ–ä¸é«˜çº§åŠŸèƒ½"&gt;ğŸ”§ å…³é”®ä¼˜åŒ–ä¸é«˜çº§åŠŸèƒ½
&lt;/h3&gt;&lt;h4 id="url-é‡å†™ä¸æ­£åˆ™åŒ¹é…"&gt;&lt;strong&gt;URL é‡å†™ä¸æ­£åˆ™åŒ¹é…&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå°† &lt;code&gt;/api/v1/user&lt;/code&gt; é‡å†™ä¸º &lt;code&gt;/user&lt;/code&gt; è½¬å‘åˆ°åç«¯ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;annotations:
nginx.ingress.kubernetes.io/rewrite-target: /$1
spec:
paths:
- path: /api/(.*) # æ­£åˆ™æ•è·è·¯å¾„
&lt;/code&gt;&lt;/pre&gt;è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; /api/v1/user
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â†’ åç«¯æ¥æ”¶&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; /v1/user
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ã€‚&lt;/p&gt;
&lt;h4 id="grpc-é•¿è¿æ¥æ”¯æŒ"&gt;&lt;strong&gt;gRPC é•¿è¿æ¥æ”¯æŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šgRPC é•¿è¿æ¥å¯¼è‡´è´Ÿè½½ä¸å‡ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;annotations:
nginx.ingress.kubernetes.io/backend-protocol: &amp;#34;GRPC&amp;#34;
nginx.ingress.kubernetes.io/proxy-read-timeout: &amp;#39;3600&amp;#39; # è¶…æ—¶å»¶é•¿
&lt;/code&gt;&lt;/pre&gt;éœ€é…ç½® HTTPS ç«¯å£å’Œ TLS è¯ä¹¦ï¼ˆgRPC å¼ºåˆ¶ä½¿ç”¨ HTTP/2ï¼‰
5
ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤šåè®®æ”¯æŒ"&gt;&lt;strong&gt;å¤šåè®®æ”¯æŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é™¤ HTTP/HTTPS å¤–ï¼ŒIngress è¿˜å¯ä»£ç† WebSocketã€gRPCã€MQTT ç­‰åè®®&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ-4"&gt;ğŸ›¡ï¸ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="æ€§èƒ½ä¸é«˜å¯ç”¨"&gt;&lt;strong&gt;æ€§èƒ½ä¸é«˜å¯ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HPA æ‰©ç¼©å®¹&lt;/strong&gt;ï¼šä¸º Ingress Controller é…ç½® HPAï¼Œæ ¹æ® CPU/å†…å­˜è‡ªåŠ¨æ‰©ç¼©&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;èµ„æºè¯·æ±‚é™åˆ¶ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;resources:
requests:
cpu: 200m
memory: 512Mi
limits:
cpu: 2
memory: 2Gi
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šå‰¯æœ¬éƒ¨ç½²&lt;/strong&gt;ï¼šç¡®ä¿ Ingress Controller æœ‰ â‰¥2 ä¸ª Pod è·¨èŠ‚ç‚¹åˆ†å¸ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é™ä½æˆæœ¬"&gt;&lt;strong&gt;é™ä½æˆæœ¬&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±äº« LoadBalancer&lt;/strong&gt;ï¼š
æ‰€æœ‰å¤–éƒ¨æµé‡é€šè¿‡ä¸€ä¸ª LoadBalancer è¿›å…¥ï¼Œç”± Ingress æŒ‰åŸŸå/è·¯å¾„åˆ†æµåˆ°ä¸åŒæœåŠ¡ï¼Œé¿å…ä¸ºæ¯ä¸ª Service å•ç‹¬åˆ›å»º LB&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç§æœ‰äº‘æ–¹æ¡ˆmetallb"&gt;&lt;strong&gt;ç§æœ‰äº‘æ–¹æ¡ˆï¼ˆMetalLBï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨è£¸æœºé›†ç¾¤ä¸­æ›¿ä»£äº‘å‚å•† LBï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# MetalLB é…ç½® IP æ± 
apiVersion: v1
kind: ConfigMap
metadata:
namespace: metallb-system
name: config
data:
config: |
address-pools:
- name: default
protocol: layer2
addresses:
- 192.168.1.240-192.168.1.250 # é™æ€ IP æ± 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ingress Controller Service ç±»å‹è®¾ä¸º &lt;code&gt;LoadBalancer&lt;/code&gt;ï¼ŒMetalLB è‡ªåŠ¨åˆ†é… IP&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;âš–ï¸ é€‚ç”¨åœºæ™¯å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤š HTTP æœåŠ¡ç»Ÿä¸€å…¥å£&lt;/td&gt;
&lt;td&gt;LoadBalancer + Ingress&lt;/td&gt;
&lt;td&gt;å• IP æ”¯æŒå¤šåŸŸå/è·¯å¾„ï¼ŒèŠ‚çœæˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;gRPC é•¿è¿æ¥æœåŠ¡&lt;/td&gt;
&lt;td&gt;Ingress + gRPC æ³¨è§£&lt;/td&gt;
&lt;td&gt;è§£å†³è¿æ¥çº§è´Ÿè½½å‡è¡¡é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é HTTP åè®®ï¼ˆå¦‚ TCPï¼‰&lt;/td&gt;
&lt;td&gt;LoadBalancer Service ç‹¬ç«‹æš´éœ²&lt;/td&gt;
&lt;td&gt;ç®€å•ç›´æ¥ï¼Œé¿å…åè®®å…¼å®¹é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç§æœ‰äº‘/æ··åˆäº‘&lt;/td&gt;
&lt;td&gt;MetalLB + Ingress&lt;/td&gt;
&lt;td&gt;æ— äº‘å‚å•†ä¾èµ–ï¼Œæä¾›ç±»äº‘ LB ä½“éªŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-22"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;LoadBalancer æä¾›åŸºç¡€è®¾æ–½å±‚æµé‡æ¥å…¥ï¼ŒIngress å®ç°åº”ç”¨å±‚æ™ºèƒ½è·¯ç”±&lt;/strong&gt;ï¼ŒäºŒè€…åˆ†å±‚åä½œï¼Œå…¼é¡¾ç¨³å®šæ€§ä¸çµæ´»æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½²å£è¯€&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;äº‘å‚å•† LB æ¥æµé‡ï¼ŒIngress è§„åˆ™å®šè·¯ç”±ï¼›
è¯ä¹¦å¸è½½ä¸ƒå±‚åšï¼ŒæœåŠ¡åˆ†æµæˆæœ¬ä¼˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿›é˜¶æ–¹å‘&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆ &lt;strong&gt;WAF æ³¨è§£&lt;/strong&gt;ï¼ˆå¦‚ ModSecurityï¼‰å¢å¼ºå®‰å…¨é˜²æŠ¤&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;strong&gt;Prometheus ç›‘æ§&lt;/strong&gt; Ingress æµé‡æŒ‡æ ‡ï¼Œå®ç°åŠ¨æ€è°ƒä¼˜&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å¤–éƒ¨è®¿é—®"&gt;å¤–éƒ¨è®¿é—®
&lt;/h2&gt;&lt;p&gt;è¦ä» Kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—®å†…éƒ¨æœåŠ¡ï¼Œéœ€é€šè¿‡ç‰¹å®šæœºåˆ¶æš´éœ²æœåŠ¡ç«¯ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦æ–¹æ³•åŠå…¶åŸç†ã€é…ç½®å’Œé€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-service-ç±»å‹æš´éœ²æ ¸å¿ƒæ–¹å¼"&gt;ğŸ”Œ &lt;strong&gt;Service ç±»å‹æš´éœ²ï¼ˆæ ¸å¿ƒæ–¹å¼ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="nodeport-1"&gt;&lt;strong&gt;NodePort&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåœ¨æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šå¼€æ”¾å›ºå®šç«¯å£ï¼ˆé»˜è®¤ &lt;code&gt;30000-32767&lt;/code&gt;ï¼‰ï¼Œå¤–éƒ¨é€šè¿‡ &lt;code&gt;èŠ‚ç‚¹IP:ç«¯å£&lt;/code&gt; è®¿é—®ï¼Œæµé‡ç»èŠ‚ç‚¹è½¬å‘åˆ° Service å†åˆ° Pod&lt;a class="link" href="@ref" &gt;2,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: Service
metadata:
name: nginx-service
spec:
type: NodePort
ports:
- port: 80 # Service å†…éƒ¨ç«¯å£
targetPort: 80 # Pod ç«¯å£
nodePort: 30003 # æ‰‹åŠ¨æŒ‡å®šèŠ‚ç‚¹ç«¯å£
selector:
app: nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¼€å‘æµ‹è¯•ç¯å¢ƒã€ä¸´æ—¶è®¿é—®&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€æ‰‹åŠ¨ç®¡ç†èŠ‚ç‚¹ IP å’Œç«¯å£ï¼›&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹æ•…éšœæ—¶éœ€åˆ‡æ¢ IPï¼›&lt;/li&gt;
&lt;li&gt;ç«¯å£æš´éœ²å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="loadbalancer-1"&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šäº‘å¹³å°ï¼ˆå¦‚ AWS/GCPï¼‰è‡ªåŠ¨åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨ï¼Œåˆ†é…å…¬ç½‘ IPï¼Œæµé‡ç›´è¾¾ Service&lt;a class="link" href="@ref" &gt;2,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: Service
metadata:
name: lb-service
spec:
type: LoadBalancer
ports:
- port: 80
targetPort: 80
selector:
app: nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®æ–¹å¼&lt;/strong&gt;ï¼š&lt;code&gt;http://&amp;lt;EXTERNAL-IP&amp;gt;:80&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå…¬æœ‰äº‘ç¯å¢ƒç”Ÿäº§éƒ¨ç½²&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;ä¾èµ–äº‘å‚å•†ï¼Œç§æœ‰ç¯å¢ƒéœ€è‡ªå»ºæ–¹æ¡ˆï¼ˆå¦‚ MetalLBï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª Service ç‹¬ç«‹ LB æˆæœ¬é«˜&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ingresshttphttps-æµé‡ç½‘å…³"&gt;ğŸŒ &lt;strong&gt;Ingressï¼ˆHTTP/HTTPS æµé‡ç½‘å…³ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŸç†"&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ingress Controller&lt;/strong&gt;ï¼ˆå¦‚ Nginxã€Traefikï¼‰ç›‘å¬è§„åˆ™ï¼ŒæŒ‰åŸŸåæˆ–è·¯å¾„å°†å¤–éƒ¨è¯·æ±‚è·¯ç”±åˆ°ä¸åŒ Service&lt;a class="link" href="@ref" &gt;2,5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ingress èµ„æº&lt;/strong&gt;ï¼šå®šä¹‰è·¯ç”±è§„åˆ™ï¼ˆå¦‚ &lt;code&gt;example.com/api â†’ api-service&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ç¤ºä¾‹"&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
name: my-ingress
annotations:
kubernetes.io/ingress.class: &amp;#34;nginx&amp;#34;
spec:
rules:
- host: &amp;#34;app.example.com&amp;#34;
http:
paths:
- path: /
pathType: Prefix
backend:
service:
name: web-service
port:
number: 80
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="éƒ¨ç½²æ­¥éª¤"&gt;&lt;strong&gt;éƒ¨ç½²æ­¥éª¤&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;éƒ¨ç½² Ingress Controllerï¼ˆéœ€ç‹¬ç«‹å®‰è£…ï¼‰&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»º Ingress èµ„æºå®šä¹‰è·¯ç”±è§„åˆ™&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒå¤šæœåŠ¡å…±äº«åŒä¸€å…¥å£ï¼›&lt;/li&gt;
&lt;li&gt;éœ€ HTTPS åŠ å¯†ã€è·¯å¾„è·¯ç”±ç­‰é«˜çº§åŠŸèƒ½&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç‰¹æ®Šåœºæ™¯æ–¹æ¡ˆ"&gt;âš ï¸ &lt;strong&gt;ç‰¹æ®Šåœºæ™¯æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="pod-ç›´æ¥æš´éœ²ä¸æ¨è"&gt;&lt;strong&gt;Pod ç›´æ¥æš´éœ²ï¼ˆä¸æ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;hostNetwork: true&lt;/code&gt;&lt;/strong&gt;ï¼šPod ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œæ ˆï¼Œé€šè¿‡å®¿ä¸»æœº IP ç›´æ¥è®¿é—®&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;hostPort&lt;/code&gt;&lt;/strong&gt;ï¼šå®¹å™¨ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºç«¯å£&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šPod é‡å¯å¯èƒ½æ¼‚ç§»ï¼Œç«¯å£å†²çªé£é™©é«˜ï¼Œç ´åéš”ç¦»æ€§&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸´æ—¶è°ƒè¯•å·¥å…·"&gt;&lt;strong&gt;ä¸´æ—¶è°ƒè¯•å·¥å…·&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;**
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl port-forward
&lt;/code&gt;&lt;/pre&gt;**ï¼šæœ¬åœ°ç«¯å£ä¸ Service æˆ– Pod ç«¯å£ç»‘å®šï¼Œä¸´æ—¶è®¿é—®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl port-forward svc/my-service 8080:80
# è®¿é—® http://localhost:8080
&lt;/code&gt;&lt;/pre&gt;é€‚ç”¨äºå¼€å‘è°ƒè¯•ï¼Œéç”Ÿäº§æ–¹æ¡ˆ
5
ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;ğŸ”„ &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePort&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æµ‹è¯•/ä¸´æ—¶è®¿é—®&lt;/td&gt;
&lt;td&gt;ç®€å•ï¼Œæ— éœ€äº‘å¹³å°æ”¯æŒ&lt;/td&gt;
&lt;td&gt;éœ€ç®¡ç†èŠ‚ç‚¹ IPï¼Œç«¯å£èŒƒå›´å—é™&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å…¬æœ‰äº‘ç”Ÿäº§ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨åˆ†é…å…¬ç½‘ IPï¼Œé«˜å¯ç”¨&lt;/td&gt;
&lt;td&gt;ä¾èµ–äº‘å‚å•†ï¼Œæˆæœ¬é«˜&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ingress&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤šæœåŠ¡ HTTP/HTTPS è·¯ç”±&lt;/td&gt;
&lt;td&gt;æ”¯æŒå¤æ‚è·¯ç”±ã€TLS ç»ˆæ­¢&lt;/td&gt;
&lt;td&gt;éœ€é¢å¤–éƒ¨ç½²æ§åˆ¶å™¨&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Port-Forward&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ¬åœ°è°ƒè¯•&lt;/td&gt;
&lt;td&gt;å¿«é€Ÿè®¿é—®å†…éƒ¨æœåŠ¡&lt;/td&gt;
&lt;td&gt;ä¸´æ—¶æ€§ï¼Œä¸æ”¯æŒå¹¶å‘&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-23"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•ç¯å¢ƒ&lt;/strong&gt;ï¼šä¼˜å…ˆç”¨ &lt;code&gt;NodePort&lt;/code&gt; å¿«é€ŸéªŒè¯&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬æœ‰äº‘ç”Ÿäº§&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;LoadBalancer&lt;/code&gt; + &lt;code&gt;Ingress&lt;/code&gt;ï¼Œå®ç°é«˜å¯ç”¨ä¸çµæ´»è·¯ç”±&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§æœ‰äº‘/æ··åˆäº‘&lt;/strong&gt;ï¼šé€šè¿‡ MetalLB æ¨¡æ‹Ÿ &lt;code&gt;LoadBalancer&lt;/code&gt;ï¼Œæˆ–éƒ¨ç½² Ingress Controller&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ç›´æ¥æš´éœ² Pod&lt;/strong&gt;ï¼šé˜²æ­¢èŠ‚ç‚¹ä¾èµ–å’Œç«¯å£å†²çª&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©æš´éœ²æ–¹å¼ï¼Œå¯åœ¨ä¿éšœå®‰å…¨æ€§çš„å‰æä¸‹é«˜æ•ˆæ‰“é€šé›†ç¾¤å†…å¤–ç½‘ç»œã€‚ç”Ÿäº§ç¯å¢ƒæ¨è &lt;strong&gt;Ingress ä½œä¸ºç»Ÿä¸€å…¥å£&lt;/strong&gt;ï¼Œé…åˆ Service Meshï¼ˆå¦‚ Istioï¼‰å®ç°ç»†ç²’åº¦æµé‡æ²»ç†&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="qos"&gt;QoS
&lt;/h2&gt;&lt;p&gt;Kubernetes ä¸­çš„ &lt;strong&gt;QoSï¼ˆQuality of Serviceï¼ŒæœåŠ¡è´¨é‡ï¼‰&lt;/strong&gt; æ˜¯é€šè¿‡èµ„æºè¯·æ±‚ï¼ˆ&lt;code&gt;requests&lt;/code&gt;ï¼‰å’Œé™åˆ¶ï¼ˆ&lt;code&gt;limits&lt;/code&gt;ï¼‰æœºåˆ¶å®ç°çš„ä¼˜å…ˆçº§ç­–ç•¥ï¼Œç”¨äºåœ¨èµ„æºç´§å¼ æ—¶ä¿éšœå…³é”®åº”ç”¨çš„ç¨³å®šæ€§ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ä¼˜åŒ–é›†ç¾¤èµ„æºåˆ†é…ï¼Œç¡®ä¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸å—å¹²æ‰°ã€‚ä»¥ä¸‹ä»åˆ†ç±»ã€æœºåˆ¶åˆ°å®è·µçš„å…¨é¢è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-qos-çš„ä¸‰å¤§ç±»åˆ«ä¸åˆ¤å®šè§„åˆ™"&gt;ğŸ” QoS çš„ä¸‰å¤§ç±»åˆ«ä¸åˆ¤å®šè§„åˆ™
&lt;/h3&gt;&lt;p&gt;Kubernetes æ ¹æ® Pod ä¸­å®¹å™¨çš„ &lt;code&gt;requests&lt;/code&gt; å’Œ &lt;code&gt;limits&lt;/code&gt; é…ç½®è‡ªåŠ¨åˆ†é… QoS ç­‰çº§ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;QoS ç­‰çº§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åˆ¤å®šæ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;èµ„æºä¿éšœ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Guaranteed&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰å®¹å™¨å‡è®¾ç½® CPU/å†…å­˜çš„ &lt;code&gt;requests&lt;/code&gt; ä¸”ä¸ &lt;code&gt;limits&lt;/code&gt; å®Œå…¨ç›¸ç­‰ï¼ˆéé›¶ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… èµ„æºå®Œå…¨ä¿éšœï¼šèŠ‚ç‚¹èµ„æºä¸è¶³æ—¶&lt;strong&gt;ä¸ä¼šè¢«é©±é€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰å…³é”®æœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Burstable&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡³å°‘ä¸€ä¸ªå®¹å™¨è®¾ç½®äº† &lt;code&gt;requests&lt;/code&gt; æˆ– &lt;code&gt;limits&lt;/code&gt;ï¼Œä½†ä¸æ»¡è¶³ Guaranteed æ¡ä»¶&lt;/td&gt;
&lt;td&gt;âš ï¸ éƒ¨åˆ†ä¿éšœï¼šç¡®ä¿ &lt;code&gt;requests&lt;/code&gt; èµ„æºï¼Œå¯ä¸´æ—¶è¶…ç”¨ï¼›èµ„æºç´§å¼ æ—¶&lt;strong&gt;å¯èƒ½è¢«é©±é€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Web åº”ç”¨ã€å¾®æœåŠ¡ç­‰å¼¹æ€§éœ€æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BestEffort&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰å®¹å™¨å‡æœªè®¾ç½® &lt;code&gt;requests&lt;/code&gt; å’Œ &lt;code&gt;limits&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ— ä¿éšœï¼šèµ„æºç´§å¼ æ—¶&lt;strong&gt;ä¼˜å…ˆè¢«é©±é€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰¹å¤„ç†ä»»åŠ¡ã€ä¸´æ—¶æµ‹è¯•ç­‰éæ ¸å¿ƒåœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# Guaranteed
resources:
requests:
cpu: &amp;#34;500m&amp;#34;
memory: &amp;#34;512Mi&amp;#34;
limits:
cpu: &amp;#34;500m&amp;#34;
memory: &amp;#34;512Mi&amp;#34;
# Burstable
resources:
requests:
cpu: &amp;#34;250m&amp;#34;
memory: &amp;#34;256Mi&amp;#34;
limits:
cpu: &amp;#34;500m&amp;#34; # å…è®¸çªå‘ä½¿ç”¨
memory: &amp;#34;512Mi&amp;#34;
# BestEffort
resources: {} # æ— ä»»ä½•è®¾ç½®
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;ç‰¹æ®Šè§„åˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ä»…è®¾ç½® &lt;code&gt;limits&lt;/code&gt; æœªè®¾ &lt;code&gt;requests&lt;/code&gt;ï¼ŒKubernetes é»˜è®¤ &lt;code&gt;requests = limits&lt;/code&gt;ï¼Œä»å½’ç±»ä¸º Guaranteed&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥å®¹å™¨ä»…è®¾ç½®éƒ¨åˆ†èµ„æºï¼ˆå¦‚åªè®¾å†…å­˜ï¼‰ï¼Œåˆ™æ•´ä½“ Pod QoS ä¸º Burstable&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-qos-çš„å·¥ä½œåŸç†ä¸èµ„æºç®¡ç†æœºåˆ¶"&gt;âš™ï¸ QoS çš„å·¥ä½œåŸç†ä¸èµ„æºç®¡ç†æœºåˆ¶
&lt;/h3&gt;&lt;h4 id="èµ„æºè°ƒåº¦scheduler"&gt;&lt;strong&gt;èµ„æºè°ƒåº¦ï¼ˆSchedulerï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;requests&lt;/code&gt; å†³å®šè°ƒåº¦&lt;/strong&gt;ï¼šKubernetes æ ¹æ® &lt;code&gt;requests&lt;/code&gt; é€‰æ‹©æ»¡è¶³èµ„æºéœ€æ±‚çš„èŠ‚ç‚¹ï¼Œ&lt;strong&gt;ä¸ QoS ç­‰çº§æ— å…³&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;**
&lt;pre tabindex="0"&gt;&lt;code&gt;limits
&lt;/code&gt;&lt;/pre&gt;é™åˆ¶è¿è¡Œæ—¶èµ„æºï¼šé€šè¿‡ Linux
cgroups** å¼ºåˆ¶é™åˆ¶å®¹å™¨èµ„æºä½¿ç”¨ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CPU è¶…é™&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;cpu.cfs_quota_us&lt;/code&gt; é™åˆ¶ä½¿ç”¨é‡ï¼Œä¸ä¼šæ€æ­»å®¹å™¨&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜è¶…é™&lt;/strong&gt;ï¼šè§¦å‘ &lt;code&gt;OOMKilled&lt;/code&gt; å¹¶é‡å¯å®¹å™¨&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="èµ„æºå›æ”¶kubelet-eviction"&gt;&lt;strong&gt;èµ„æºå›æ”¶ï¼ˆkubelet Evictionï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“èŠ‚ç‚¹èµ„æºï¼ˆå¦‚å†…å­˜ã€ç£ç›˜ï¼‰ä¸è¶³æ—¶ï¼Œkubelet æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§é©±é€ Podï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;BestEffort&lt;/strong&gt; â†’ 2. &lt;strong&gt;Burstable&lt;/strong&gt; â†’ 3. &lt;strong&gt;Guaranteed&lt;/strong&gt;
å…·ä½“ç­–ç•¥å› èµ„æºç±»å‹è€Œå¼‚ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜ä¸è¶³&lt;/strong&gt;ï¼š
æŒ‰ â€‹&lt;strong&gt;å®é™…ä½¿ç”¨é‡è¶…å‡º &lt;code&gt;requests&lt;/code&gt; çš„æ¯”ä¾‹&lt;/strong&gt;â€‹ æ’åºï¼Œæ¯”ä¾‹è¶Šé«˜è¶Šä¼˜å…ˆé©±é€&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚
&lt;em&gt;ä¾‹&lt;/em&gt;ï¼šä¸¤ä¸ª Burstable Podï¼Œå†…å­˜ &lt;code&gt;requests&lt;/code&gt; å‡ä¸º &lt;code&gt;1Gi&lt;/code&gt;ï¼Œè‹¥ Pod A ä½¿ç”¨ &lt;code&gt;1.5Gi&lt;/code&gt;ï¼ŒPod B ä½¿ç”¨ &lt;code&gt;1.2Gi&lt;/code&gt;ï¼Œåˆ™ A ä¼˜å…ˆè¢«é©±é€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç£ç›˜ä¸è¶³&lt;/strong&gt;ï¼š
æŒ‰ â€‹&lt;strong&gt;ç£ç›˜ä½¿ç”¨é‡ç»å¯¹å€¼&lt;/strong&gt;â€‹ æ’åºï¼Œä¸ QoS æ— å…³ï¼Œä½¿ç”¨é‡æœ€å¤§çš„ Pod ä¼˜å…ˆè¢«é©±é€&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="oom-killer-å¹²é¢„"&gt;&lt;strong&gt;OOM Killer å¹²é¢„&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥ kubelet æœªåŠæ—¶å›æ”¶å†…å­˜å¯¼è‡´ç³»ç»Ÿ OOMï¼Œå†…æ ¸æ ¹æ® &lt;strong&gt;&lt;code&gt;oom_score_adj&lt;/code&gt;&lt;/strong&gt; å†³å®šç»ˆæ­¢é¡ºåºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BestEffort&lt;/strong&gt;ï¼š&lt;code&gt;oom_score_adj = 1000&lt;/code&gt;ï¼ˆæœ€ä¼˜å…ˆç»ˆæ­¢ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Burstable&lt;/strong&gt;ï¼š&lt;code&gt;oom_score_adj = min(max(2, 1000 - (1000 * requests) / èŠ‚ç‚¹æ€»å†…å­˜), 999)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Guaranteed&lt;/strong&gt;ï¼š&lt;code&gt;oom_score_adj = -998&lt;/code&gt;ï¼ˆæœ€åç»ˆæ­¢ï¼‰&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ-5"&gt;ğŸ› ï¸ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="å…³é”®æœåŠ¡é…ç½®-guaranteed"&gt;&lt;strong&gt;å…³é”®æœåŠ¡é…ç½® Guaranteed&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿ç¨³å®šæ€§&lt;/strong&gt;ï¼šä¸ºæ ¸å¿ƒæœåŠ¡ï¼ˆå¦‚ MySQLï¼‰è®¾ç½® &lt;code&gt;requests = limits&lt;/code&gt;ï¼Œé¿å…èµ„æºç«äº‰å¯¼è‡´ä¸­æ–­&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬å  CPU ä¼˜åŒ–&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;static&lt;/code&gt; CPU ç®¡ç†ç­–ç•¥ï¼Œç»‘å®šç‰©ç†æ ¸å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼¹æ€§åº”ç”¨é€‰æ‹©-burstable"&gt;&lt;strong&gt;å¼¹æ€§åº”ç”¨é€‰æ‹© Burstable&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æˆæœ¬ä¸æ€§èƒ½å¹³è¡¡&lt;/strong&gt;ï¼šä¸º Web æœåŠ¡è®¾ç½®åˆç†çš„ &lt;code&gt;requests&lt;/code&gt; ä¿éšœåŸºç¡€æ€§èƒ½ï¼Œ&lt;code&gt;limits&lt;/code&gt; æ”¾å®½è‡³ &lt;code&gt;requests&lt;/code&gt; çš„ 1.5~2 å€ä»¥åº”å¯¹æµé‡å³°å€¼&lt;a class="link" href="@ref" &gt;6,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;limits&lt;/code&gt; ä¸åº”è¶…è¿‡èŠ‚ç‚¹å¯ç”¨èµ„æºçš„ 70%ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœå½±å“å…¨å±€&lt;a class="link" href="@ref" &gt;10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="besteffort-è°¨æ…ä½¿ç”¨"&gt;&lt;strong&gt;BestEffort è°¨æ…ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»éå…³é”®ä»»åŠ¡&lt;/strong&gt;ï¼šå°† CI/CD ä»»åŠ¡ã€æ—¥å¿—æ”¶é›†å™¨ç­‰æ”¾å…¥ç‹¬ç«‹å‘½åç©ºé—´ï¼Œé¿å…é©±é€å½±å“æ ¸å¿ƒä¸šåŠ¡&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç›‘æ§ä¸è°ƒä¼˜å·¥å…·"&gt;&lt;strong&gt;ç›‘æ§ä¸è°ƒä¼˜å·¥å…·&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Prometheus + Grafana&lt;/strong&gt;ï¼šç›‘æ§å®¹å™¨å®é™…ç”¨é‡ä¸ &lt;code&gt;requests/limits&lt;/code&gt; çš„åå·®ï¼ŒåŠ¨æ€è°ƒæ•´é…ç½®&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Vertical Pod Autoscaler (VPA)&lt;/strong&gt;ï¼šè‡ªåŠ¨åˆ†æå†å²è´Ÿè½½ï¼Œæ¨èæœ€ä¼˜ &lt;code&gt;requests/limits&lt;/code&gt; å€¼&lt;a class="link" href="@ref" &gt;10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ-2"&gt;âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› ä¸è§£å†³ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Guaranteed Pod è¢«é©±é€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ£€æŸ¥æ˜¯å¦å› &lt;strong&gt;ç£ç›˜å‹åŠ›&lt;/strong&gt;è§¦å‘é©±é€ï¼ˆæŒ‰ä½¿ç”¨é‡æ’åºï¼Œä¸ QoS æ— å…³ï¼‰ï¼Œéœ€æ¸…ç†æ—¥å¿—æˆ–æ‰©å®¹å­˜å‚¨å·&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Burstable Pod é¢‘ç¹ OOM&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®é™…å†…å­˜ä½¿ç”¨æŒç»­æ¥è¿‘ &lt;code&gt;limits&lt;/code&gt;ï¼Œéœ€è°ƒé«˜ &lt;code&gt;limits&lt;/code&gt; æˆ–ä¼˜åŒ–åº”ç”¨å†…å­˜å ç”¨&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºåˆ©ç”¨ç‡ä½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;requests&lt;/code&gt; è®¾ç½®è¿‡é«˜å¯¼è‡´â€œèµ„æºç¢ç‰‡â€ï¼Œä½¿ç”¨ VPA è‡ªåŠ¨ç¼©å®¹æˆ–è°ƒæ•´ &lt;code&gt;requests&lt;/code&gt; åŒ¹é…å®é™…éœ€æ±‚&lt;a class="link" href="@ref" &gt;10&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-24"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Kubernetes QoS æœºåˆ¶é€šè¿‡ &lt;strong&gt;èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„ç²¾ç»†åˆ†çº§&lt;/strong&gt;ï¼ˆGuaranteed/Burstable/BestEffortï¼‰ï¼Œç»“åˆ &lt;strong&gt;cgroups éš”ç¦»&lt;/strong&gt; å’Œ &lt;strong&gt;ä¼˜å…ˆçº§é©±é€ç­–ç•¥&lt;/strong&gt;ï¼Œå®ç°äº†é›†ç¾¤èµ„æºçš„æ™ºèƒ½è°ƒåº¦ä¸ä¿éšœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šåœ¨æœ‰é™èµ„æºä¸‹ä¼˜å…ˆä¿éšœå…³é”®æœåŠ¡ï¼ŒåŒæ—¶æå‡æ•´ä½“åˆ©ç”¨ç‡&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®é“å¾‹&lt;/strong&gt;ï¼šå…³é”®æœåŠ¡å¿…è®¾ &lt;code&gt;Guaranteed&lt;/code&gt;ï¼Œå¼¹æ€§åº”ç”¨ç”¨ &lt;code&gt;Burstable&lt;/code&gt;ï¼Œä¸´æ—¶ä»»åŠ¡æ”¾ &lt;code&gt;BestEffort&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶ä¼¸ä¼˜åŒ–&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;LimitRange&lt;/code&gt; è®¾ç½®å‘½åç©ºé—´çº§é»˜è®¤èµ„æºçº¦æŸï¼Œæˆ–é€šè¿‡ &lt;code&gt;ResourceQuota&lt;/code&gt; é™åˆ¶å›¢é˜Ÿæ€»èµ„æºé‡&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½® QoSï¼Œå¯åœ¨ä¿éšœ SLOï¼ˆæœåŠ¡ç­‰çº§ç›®æ ‡ï¼‰çš„åŒæ—¶ï¼Œæœ€å¤§åŒ–é›†ç¾¤èµ„æºåˆ©ç”¨ç‡ï¼Œæ„å»º&lt;strong&gt;é«˜å¼¹æ€§ã€ä½æˆæœ¬&lt;/strong&gt;çš„äº‘åŸç”Ÿæ¶æ„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="entrypoint"&gt;ENTRYPOINT
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Docker ä¸­ &lt;code&gt;ENTRYPOINT&lt;/code&gt; ä¸ &lt;code&gt;CMD&lt;/code&gt; æŒ‡ä»¤çš„æ·±åº¦è§£æï¼Œæ¶µç›–æ ¸å¿ƒåŒºåˆ«ã€ä½¿ç”¨åœºæ™¯ã€æ‰§è¡Œè§„åˆ™åŠæœ€ä½³å®è·µï¼Œç»“åˆæŠ€æœ¯ç»†èŠ‚ä¸ç”Ÿäº§ç»éªŒå±•å¼€è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸å®šä½å·®å¼‚"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µä¸å®šä½å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æŒ‡ä»¤&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¯è¦†ç›–æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;ENTRYPOINT&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰å®¹å™¨çš„&lt;strong&gt;ä¸»æ‰§è¡Œç¨‹åº&lt;/strong&gt;ï¼ŒæŒ‡å®šå®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„æ ¸å¿ƒå‘½ä»¤&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä»…èƒ½é€šè¿‡ &lt;code&gt;docker run --entrypoint&lt;/code&gt; è¦†ç›–&lt;/td&gt;
&lt;td&gt;å›ºå®šæ¡†æ¶å‹å‘½ä»¤ï¼ˆå¦‚ &lt;code&gt;nginx&lt;/code&gt;ã€&lt;code&gt;python&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;CMD&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›ä¸»å‘½ä»¤çš„&lt;strong&gt;é»˜è®¤å‚æ•°&lt;/strong&gt;æˆ–å¤‡ç”¨å‘½ä»¤&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker run&lt;/code&gt; çš„å‚æ•°å¯ç›´æ¥è¦†ç›–&lt;/td&gt;
&lt;td&gt;å¯å˜å‚æ•°ï¼ˆå¦‚ &lt;code&gt;--verbose&lt;/code&gt;ã€&lt;code&gt;-g &amp;quot;daemon off;&amp;quot;&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;å…³é”®å·®å¼‚&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ENTRYPOINT&lt;/code&gt; å®šä¹‰ &lt;strong&gt;â€œåšä»€ä¹ˆâ€&lt;/strong&gt;ï¼ˆå¦‚è¿è¡Œåº”ç”¨ï¼‰ï¼Œ&lt;code&gt;CMD&lt;/code&gt; å®šä¹‰ &lt;strong&gt;â€œæ€ä¹ˆåšâ€&lt;/strong&gt;ï¼ˆå¦‚å‚æ•°ï¼‰&lt;a class="link" href="@ref" &gt;5,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤è€…å…±å­˜æ—¶ï¼Œ&lt;code&gt;CMD&lt;/code&gt; å†…å®¹ä½œä¸º &lt;code&gt;ENTRYPOINT&lt;/code&gt; çš„é»˜è®¤å‚æ•°è¿½åŠ &lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰§è¡Œæ ¼å¼ä¸è¡Œä¸ºå¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;æ‰§è¡Œæ ¼å¼ä¸è¡Œä¸ºå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¼å¼ç±»å‹"&gt;&lt;strong&gt;æ ¼å¼ç±»å‹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ ¼å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯­æ³•ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¿¡å·å¤„ç†&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Exec æ ¼å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ENTRYPOINT [&amp;quot;nginx&amp;quot;, &amp;quot;-g&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ—  Shell è§£æï¼Œç¯å¢ƒå˜é‡ä¸è‡ªåŠ¨æ‰©å±•&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒï¼ˆä¸»è¿›ç¨‹æ”¶ä¿¡å·ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Shell æ ¼å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ENTRYPOINT nginx -g&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;/bin/sh -c&lt;/code&gt; æ‰§è¡Œï¼Œæ”¯æŒå˜é‡æ›¿æ¢ï¼ˆå¦‚ &lt;code&gt;$HOME&lt;/code&gt;ï¼‰ï¼Œä½†å¿½ç•¥ &lt;code&gt;CMD&lt;/code&gt;å’Œ &lt;code&gt;docker run&lt;/code&gt; å‚æ•°&lt;a class="link" href="@ref" &gt;3,11&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸»è¿›ç¨‹æ˜¯ &lt;code&gt;sh&lt;/code&gt;ï¼Œä¿¡å·å¯èƒ½ä¸¢å¤±&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ Exec æ ¼å¼&lt;/strong&gt;ï¼Œé¿å… Shell å±‚å¹²æ‰°ä¿¡å·ä¼ é€’ä¸å‚æ•°è§£æ&lt;a class="link" href="@ref" &gt;6,11&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="ç»„åˆæ‰§è¡Œé€»è¾‘"&gt;&lt;strong&gt;ç»„åˆæ‰§è¡Œé€»è¾‘&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Dockerfile é…ç½®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®¹å™¨å¯åŠ¨å‘½ä»¤&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¦†ç›–è§„åˆ™&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ENTRYPOINT [&amp;quot;top&amp;quot;]&lt;/code&gt; + &lt;code&gt;CMD [&amp;quot;-b&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;top -b&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker run &amp;lt;image&amp;gt; -i&lt;/code&gt; â†’ &lt;code&gt;top -i&lt;/code&gt;ï¼ˆè¦†ç›– &lt;code&gt;CMD&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä»… &lt;code&gt;CMD [&amp;quot;echo&amp;quot;, &amp;quot;Hello&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;echo &amp;quot;Hello&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker run &amp;lt;image&amp;gt; ls&lt;/code&gt; â†’ æ‰§è¡Œ &lt;code&gt;ls&lt;/code&gt;ï¼ˆå®Œå…¨è¦†ç›–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Shell æ ¼å¼ &lt;code&gt;ENTRYPOINT echo Hello&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;/bin/sh -c &amp;quot;echo Hello&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker run&lt;/code&gt; å‚æ•°æ— æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹"&gt;ğŸ› ï¸ &lt;strong&gt;å…¸å‹ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å›ºå®šæ¡†æ¶--å¯å˜å‚æ•°æ¨èç»„åˆ"&gt;&lt;strong&gt;å›ºå®šæ¡†æ¶ + å¯å˜å‚æ•°ï¼ˆæ¨èç»„åˆï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# ä¸»å‘½ä»¤å›ºå®šä¸º Python è§£é‡Šå™¨
ENTRYPOINT [&amp;#34;python&amp;#34;, &amp;#34;app.py&amp;#34;]
# é»˜è®¤å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œå¯è¿è¡Œæ—¶è¦†ç›–
CMD [&amp;#34;--debug&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;è¿è¡Œæ•ˆæœï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;docker run my-app # æ‰§è¡Œ python app.py --debug
docker run my-app --production # æ‰§è¡Œ python app.py --production
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="çº¯å¯æ‰§è¡Œå®¹å™¨ä»…"&gt;&lt;strong&gt;çº¯å¯æ‰§è¡Œå®¹å™¨ï¼ˆä»… &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# å®¹å™¨å”¯ä¸€èŒè´£ï¼šè¿è¡Œ Redis
ENTRYPOINT [&amp;#34;redis-server&amp;#34;, &amp;#34;--bind 0.0.0.0&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼šæ•°æ®åº“ã€ä¸­é—´ä»¶ç­‰éœ€&lt;strong&gt;ä¸¥æ ¼é™å®šè¡Œä¸º&lt;/strong&gt;çš„æœåŠ¡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼€å‘è°ƒè¯•å®¹å™¨"&gt;&lt;strong&gt;å¼€å‘è°ƒè¯•å®¹å™¨ï¼ˆ&lt;code&gt;ENTRYPOINT&lt;/code&gt; ä¸º Shellï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;ENTRYPOINT [&amp;#34;/bin/bash&amp;#34;, &amp;#34;-c&amp;#34;] # å…è®¸ä»»æ„å‘½ä»¤è¾“å…¥
CMD [&amp;#34;echo &amp;#39;Ready for commands&amp;#39;&amp;#34;] # é»˜è®¤æç¤º
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;è¿è¡Œæ•ˆæœï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;docker run debug-container &amp;#34;ls /app&amp;#34; # æ‰§è¡Œ ls /app
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®¹å™¨ç«‹å³é€€å‡º&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šä¸»è¿›ç¨‹åå°åŒ–ï¼ˆå¦‚ &lt;code&gt;CMD service nginx start&lt;/code&gt; â†’ å®é™…ä¸»è¿›ç¨‹æ˜¯ &lt;code&gt;sh&lt;/code&gt;ï¼Œå¯åŠ¨åé€€å‡ºï¼‰&lt;a class="link" href="@ref" &gt;10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šå‰å°è¿è¡Œåº”ç”¨ï¼Œå¦‚ &lt;code&gt;CMD [&amp;quot;nginx&amp;quot;, &amp;quot;-g&amp;quot;, &amp;quot;daemon off;&amp;quot;]&lt;/code&gt;&lt;a class="link" href="@ref" &gt;10,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šExec æ ¼å¼ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæœªè§¦å‘ Shell è§£æ&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼šæ˜¾å¼è°ƒç”¨ Shell æˆ–ä½¿ç”¨è„šæœ¬åŒ…è£…ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;ENTRYPOINT [&amp;#34;sh&amp;#34;, &amp;#34;-c&amp;#34;, &amp;#34;echo $ENV_VAR&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°è¦†ç›–å¼‚å¸¸&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¡ˆä¾‹&lt;/strong&gt;ï¼š&lt;code&gt;ENTRYPOINT [&amp;quot;echo&amp;quot;]&lt;/code&gt; + &lt;code&gt;CMD [&amp;quot;Hello&amp;quot;]&lt;/code&gt; â†’ &lt;code&gt;docker run &amp;lt;image&amp;gt; &amp;quot;Test&amp;quot;&lt;/code&gt; è¾“å‡º &lt;code&gt;Test&lt;/code&gt;ï¼ˆä¸¢å¤± &lt;code&gt;Hello&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–ï¼šå›ºå®šå‰ç¼€ + å¯å˜å‚æ•°ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;ENTRYPOINT [&amp;#34;echo&amp;#34;, &amp;#34;Prefix:&amp;#34;]
CMD [&amp;#34;Default&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;docker run my-image # è¾“å‡º Prefix: Default
docker run my-image &amp;#34;Custom&amp;#34; # è¾“å‡º Prefix: Custom
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§æŠ€å·§ä¸ç”Ÿäº§å®è·µ"&gt;ğŸ§© &lt;strong&gt;é«˜çº§æŠ€å·§ä¸ç”Ÿäº§å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…¥å£ç‚¹è„šæœ¬entrypoint-script"&gt;&lt;strong&gt;å…¥å£ç‚¹è„šæœ¬ï¼ˆEntrypoint Scriptï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;COPY entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/entrypoint.sh
ENTRYPOINT [&amp;#34;entrypoint.sh&amp;#34;] # å¤„ç†åˆå§‹åŒ–é€»è¾‘
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;è„šæœ¬ç¤ºä¾‹&lt;/strong&gt;ï¼ˆ&lt;code&gt;entrypoint.sh&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#!/bin/bash
set -e
# åˆå§‹åŒ–ç¯å¢ƒå˜é‡
export APP_ENV=${APP_ENV:-production}
# æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆä»…ç”Ÿäº§ç¯å¢ƒï¼‰
if [ &amp;#34;$APP_ENV&amp;#34; = &amp;#34;production&amp;#34; ]; then
flask db upgrade
fi
# ä¼ é€’ CMD æˆ– docker run å‚æ•°
exec &amp;#34;$@&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šæ”¯æŒ&lt;strong&gt;é¢„é…ç½®&lt;/strong&gt;ï¼ˆç¯å¢ƒå˜é‡ã€è¿ç§»ï¼‰ã€&lt;strong&gt;ä¿¡å·ä¼ é€’&lt;/strong&gt;ï¼ˆ&lt;code&gt;exec&lt;/code&gt; ä¿è¯ä¸»è¿›ç¨‹ä¸ºåº”ç”¨ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="åŠ¨æ€è°ƒè¯•è¦†ç›–"&gt;&lt;strong&gt;åŠ¨æ€è°ƒè¯•è¦†ç›–&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# è¦†ç›– ENTRYPOINT è¿›å…¥å®¹å™¨ Shell
docker run --entrypoint /bin/bash -it my-app
# è¦†ç›– CMD æ‰§è¡Œä¸´æ—¶å‘½ä»¤
docker run my-app ./migrate-db.sh
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å¤šé˜¶æ®µæ„å»ºç»§æ‰¿"&gt;&lt;strong&gt;å¤šé˜¶æ®µæ„å»ºç»§æ‰¿&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;FROM base-image AS builder
# åŸºç¡€é•œåƒå« ENTRYPOINT
FROM final-stage
# æ˜¾å¼é‡ç½®ç»§æ‰¿çš„ ENTRYPOINT
ENTRYPOINT [&amp;#34;new-entry&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å†³ç­–æµç¨‹å›¾"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šå†³ç­–æµç¨‹å›¾&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[éœ€å›ºå®šå®¹å™¨ä¸»å‘½ä»¤ï¼Ÿ] -- Yes --&amp;gt; B[è®¾ç½® ENTRYPOINT]
A -- No --&amp;gt; C[ä»…ç”¨ CMD æä¾›é»˜è®¤å‘½ä»¤]
B --&amp;gt; D{éœ€é»˜è®¤å‚æ•°ï¼Ÿ}
D -- Yes --&amp;gt; E[æ·»åŠ  CMD ä½œä¸ºå‚æ•°]
D -- No --&amp;gt; F[ä»…ç”¨ ENTRYPOINT]
C --&amp;gt; G[å…è®¸ç”¨æˆ·å®Œå…¨è¦†ç›–å‘½ä»¤]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒåŸåˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ï¼šæœåŠ¡å‹å®¹å™¨ï¼ˆå¦‚ Nginxï¼‰â†’ &lt;code&gt;ENTRYPOINT&lt;/code&gt; + å‚æ•°åŒ– &lt;code&gt;CMD&lt;/code&gt;&lt;a class="link" href="@ref" &gt;11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šå·¥å…·ç±»å®¹å™¨ï¼ˆå¦‚ Curlï¼‰â†’ å•ç‹¬ &lt;code&gt;CMD&lt;/code&gt; æˆ– &lt;code&gt;ENTRYPOINT [&amp;quot;sh&amp;quot;, &amp;quot;-c&amp;quot;]&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥å£®æ€§&lt;/strong&gt;ï¼š&lt;strong&gt;å§‹ç»ˆä½¿ç”¨ Exec æ ¼å¼&lt;/strong&gt; + &lt;strong&gt;å…¥å£ç‚¹è„šæœ¬å¤„ç†åˆå§‹åŒ–&lt;/strong&gt;ï¼Œé¿å… Shell å±‚å¼•å‘çš„ä¿¡å·ä¸å‚æ•°é—®é¢˜&lt;a class="link" href="@ref" &gt;6,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="k8s-command"&gt;k8s command
&lt;/h2&gt;&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œ&lt;code&gt;command&lt;/code&gt; å’Œ &lt;code&gt;args&lt;/code&gt; æ˜¯å®šä¹‰å®¹å™¨å¯åŠ¨å‘½ä»¤åŠå…¶å‚æ•°çš„æ ¸å¿ƒå­—æ®µï¼Œç”¨äºè¦†ç›–å®¹å™¨é•œåƒé»˜è®¤çš„å¯åŠ¨è¡Œä¸ºï¼ˆå¦‚ Dockerfile ä¸­çš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt; å’Œ &lt;code&gt;CMD&lt;/code&gt;ï¼‰ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç±»æ¯” Docker&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦è¦†ç›–é•œåƒé»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;command&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„&lt;strong&gt;ä¸»å‘½ä»¤&lt;/strong&gt;ï¼ˆç›¸å½“äºå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼‰&lt;/td&gt;
&lt;td&gt;ç­‰ä»·äº &lt;code&gt;ENTRYPOINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è‹¥è®¾ç½®ï¼Œåˆ™å®Œå…¨è¦†ç›–é•œåƒçš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;args&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸º &lt;code&gt;command&lt;/code&gt; æä¾›&lt;strong&gt;å‚æ•°åˆ—è¡¨&lt;/strong&gt;ï¼ˆè‹¥ &lt;code&gt;command&lt;/code&gt; æœªè®¾ç½®ï¼Œåˆ™ä½œä¸ºé•œåƒ &lt;code&gt;ENTRYPOINT&lt;/code&gt; çš„å‚æ•°ï¼‰&lt;/td&gt;
&lt;td&gt;ç­‰ä»·äº &lt;code&gt;CMD&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è‹¥è®¾ç½®ï¼Œåˆ™è¦†ç›–é•œåƒçš„ &lt;code&gt;CMD&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…³é”®å…³ç³»&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥åŒæ—¶è®¾ç½® &lt;code&gt;command&lt;/code&gt; å’Œ &lt;code&gt;args&lt;/code&gt;ï¼Œåˆ™å®¹å™¨æ‰§è¡Œ &lt;code&gt;command + args&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ä»…è®¾ç½® &lt;code&gt;args&lt;/code&gt;ï¼Œåˆ™é•œåƒçš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt; ä¼šä½¿ç”¨ &lt;code&gt;args&lt;/code&gt; ä½œä¸ºæ–°å‚æ•°&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è¦†ç›–è§„åˆ™è¯¦è§£"&gt;âš™ï¸ &lt;strong&gt;è¦†ç›–è§„åˆ™è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸åŒé…ç½®ç»„åˆä¸‹å®¹å™¨çš„è¡Œä¸ºå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®ç»„åˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®¹å™¨å¯åŠ¨è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœªè®¾ç½® &lt;code&gt;command&lt;/code&gt;å’Œ &lt;code&gt;args&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨é•œåƒé»˜è®¤çš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt; å’Œ &lt;code&gt;CMD&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;td&gt;é•œåƒå®šä¹‰ &lt;code&gt;ENTRYPOINT [&amp;quot;nginx&amp;quot;]&lt;/code&gt; + &lt;code&gt;CMD [&amp;quot;-g&amp;quot;, &amp;quot;daemon off;&amp;quot;]&lt;/code&gt; â†’ æ‰§è¡Œ &lt;code&gt;nginx -g &amp;quot;daemon off;&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»…è®¾ç½® &lt;code&gt;command&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®Œå…¨å¿½ç•¥é•œåƒçš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt; å’Œ &lt;code&gt;CMD&lt;/code&gt;ï¼Œä»…æ‰§è¡Œ &lt;code&gt;command&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;command: [&amp;quot;echo&amp;quot;]&lt;/code&gt; â†’ æ‰§è¡Œ &lt;code&gt;echo&lt;/code&gt;ï¼ˆæ— å‚æ•°ï¼Œå¯èƒ½ç«‹å³é€€å‡ºï¼‰&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»…è®¾ç½® &lt;code&gt;args&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨é•œåƒçš„ &lt;code&gt;ENTRYPOINT&lt;/code&gt;ï¼Œå¹¶å°† &lt;code&gt;args&lt;/code&gt; ä½œä¸ºå…¶å‚æ•°ã€‚&lt;/td&gt;
&lt;td&gt;é•œåƒ &lt;code&gt;ENTRYPOINT [&amp;quot;python&amp;quot;]&lt;/code&gt; + &lt;code&gt;args: [&amp;quot;app.py&amp;quot;]&lt;/code&gt; â†’ æ‰§è¡Œ &lt;code&gt;python app.py&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒæ—¶è®¾ç½® &lt;code&gt;command&lt;/code&gt; å’Œ &lt;code&gt;args&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿½ç•¥é•œåƒé»˜è®¤é…ç½®ï¼Œæ‰§è¡Œ &lt;code&gt;command + args&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;command: [&amp;quot;printenv&amp;quot;]&lt;/code&gt; + &lt;code&gt;args: [&amp;quot;HOSTNAME&amp;quot;]&lt;/code&gt; â†’ æ‰§è¡Œ &lt;code&gt;printenv HOSTNAME&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;command&lt;/code&gt; å’Œ &lt;code&gt;args&lt;/code&gt; åœ¨ Pod åˆ›å»ºåä¸å¯ä¿®æ”¹&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡ºï¼ˆå¦‚ &lt;code&gt;echo&lt;/code&gt; å‘½ä»¤ï¼‰ï¼Œéœ€é€šè¿‡æ— é™å¾ªç¯ä¿æŒè¿è¡Œï¼ˆå¦‚ &lt;code&gt;command: [&amp;quot;/bin/sh&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;sleep infinity&amp;quot;]&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹ä½¿ç”¨åœºæ™¯"&gt;ğŸ› ï¸ &lt;strong&gt;å…¸å‹ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è¦†ç›–é•œåƒé»˜è®¤å‘½ä»¤"&gt;&lt;strong&gt;è¦†ç›–é•œåƒé»˜è®¤å‘½ä»¤&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;containers:
- name: demo
image: nginx
command: [&amp;#34;echo&amp;#34;] # è¦†ç›– nginx çš„é»˜è®¤å¯åŠ¨å‘½ä»¤
args: [&amp;#34;Hello, Kubernetes!&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šè¾“å‡º &lt;code&gt;Hello, Kubernetes!&lt;/code&gt; åé€€å‡ºï¼ˆéæŒä¹…åŒ–æœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="åŠ¨æ€ä¼ é€’å‚æ•°"&gt;&lt;strong&gt;åŠ¨æ€ä¼ é€’å‚æ•°&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;env:
- name: PORT
value: &amp;#34;8080&amp;#34;
containers:
- name: app
image: myapp-image
args: [&amp;#34;--port=$(PORT)&amp;#34;] # ä½¿ç”¨ç¯å¢ƒå˜é‡åŠ¨æ€è®¾ç½®å‚æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šå¯åŠ¨åº”ç”¨æ—¶ä¼ é€’ &lt;code&gt;--port=8080&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ‰§è¡Œå¤æ‚-shell-å‘½ä»¤"&gt;&lt;strong&gt;æ‰§è¡Œå¤æ‚ Shell å‘½ä»¤&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;containers:
- name: shell-demo
image: busybox
command: [&amp;#34;/bin/sh&amp;#34;, &amp;#34;-c&amp;#34;] # å¯åŠ¨ Shell è§£é‡Šå™¨
args: [&amp;#34;while true; do echo hello; sleep 10; done&amp;#34;] # å¾ªç¯è¾“å‡º
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€ç®¡é“æ“ä½œï¼ˆå¦‚ &lt;code&gt;grep&lt;/code&gt;ï¼‰æˆ–å¤šå‘½ä»¤ç»„åˆã€‚&lt;/li&gt;
&lt;li&gt;å®¹å™¨éœ€é•¿æœŸè¿è¡Œï¼ˆå¦‚ç›‘æ§è„šæœ¬ï¼‰&lt;a class="link" href="@ref" &gt;3,6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è°ƒè¯•å®¹å™¨å¯åŠ¨é—®é¢˜"&gt;&lt;strong&gt;è°ƒè¯•å®¹å™¨å¯åŠ¨é—®é¢˜&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;containers:
- name: debug-container
image: busybox
command: [&amp;#34;/bin/sh&amp;#34;, &amp;#34;-c&amp;#34;, &amp;#34;sleep 3600&amp;#34;] # ä¿æŒå®¹å™¨è¿è¡Œ 1 å°æ—¶
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼š
å½“ä¸šåŠ¡å®¹å™¨é¢‘ç¹å´©æºƒæ—¶ï¼Œé€šè¿‡ç¡çœ å‘½ä»¤ä¿æŒå®¹å™¨è¿è¡Œï¼Œä»è€Œè¿›å…¥å®¹å™¨æ‰‹åŠ¨è°ƒè¯•ï¼ˆ&lt;code&gt;kubectl exec&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§æŠ€å·§ä¸é¿å‘æŒ‡å—"&gt;ğŸ§© &lt;strong&gt;é«˜çº§æŠ€å·§ä¸é¿å‘æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ç¯å¢ƒå˜é‡æ‰©å±•"&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡æ‰©å±•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¼å¼è¦æ±‚&lt;/strong&gt;ï¼šå¿…é¡»ä½¿ç”¨ &lt;code&gt;$(VAR_NAME)&lt;/code&gt; è¯­æ³•ï¼ˆå¦‚ &lt;code&gt;args: [&amp;quot;$(MESSAGE)&amp;quot;]&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§é”™è¯¯&lt;/strong&gt;ï¼šç›´æ¥å†™ &lt;code&gt;$MESSAGE&lt;/code&gt; æ— æ³•è§£æ&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é¿å…-shell-æ ¼å¼é™·é˜±"&gt;&lt;strong&gt;é¿å… Shell æ ¼å¼é™·é˜±&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é”™è¯¯é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;command: echo Hello # Shell æ ¼å¼ï¼Œå®é™…æ‰§è¡Œ `/bin/sh -c &amp;#34;echo Hello&amp;#34;`
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼š
ä¸»è¿›ç¨‹ä¸º &lt;code&gt;sh&lt;/code&gt;ï¼Œå¯¼è‡´æ— æ³•æ¥æ”¶ &lt;code&gt;SIGTERM&lt;/code&gt; ä¿¡å·ï¼ˆä¼˜é›…ç»ˆæ­¢å¤±æ•ˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;Exec æ ¼å¼&lt;/strong&gt;ï¼ˆæ•°ç»„å½¢å¼ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤šå‘½ä»¤æ‰§è¡Œçš„æ­£ç¡®å†™æ³•"&gt;&lt;strong&gt;å¤šå‘½ä»¤æ‰§è¡Œçš„æ­£ç¡®å†™æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;command: [&amp;#34;/bin/sh&amp;#34;]
args: [&amp;#34;-c&amp;#34;, &amp;#34;ls /app; java -jar app.jar&amp;#34;] # åˆ†å·åˆ†éš”å‘½ä»¤
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;ä¸ºä½•ä¸ç”¨ &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt;&lt;/strong&gt;ï¼šè‹¥å‰åºå‘½ä»¤å¤±è´¥ï¼ˆå¦‚ &lt;code&gt;ls&lt;/code&gt; æŠ¥é”™ï¼‰ï¼Œ&lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; ä¼šä¸­æ–­å¯åŠ¨ï¼Œè€Œ &lt;code&gt;;&lt;/code&gt; ç¡®ä¿åç»­å‘½ä»¤æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µæ€»ç»“"&gt;âš ï¸ &lt;strong&gt;æœ€ä½³å®è·µæ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®å¯åŠ¨è§’è‰²&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å‹å®¹å™¨ï¼ˆå¦‚ Nginxï¼‰â†’ å›ºå®š &lt;code&gt;command&lt;/code&gt; + å‚æ•°åŒ– &lt;code&gt;args&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å·¥å…·ç±»å®¹å™¨ï¼ˆå¦‚ Curlï¼‰â†’ ä»…ç”¨ &lt;code&gt;args&lt;/code&gt; æˆ–é€šè¿‡ &lt;code&gt;command&lt;/code&gt; å¯åŠ¨ Shell&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å…åœ¨ &lt;code&gt;command&lt;/code&gt;/&lt;code&gt;args&lt;/code&gt; ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼ˆæ”¹ç”¨ &lt;code&gt;Secret&lt;/code&gt; æ³¨å…¥ç¯å¢ƒå˜é‡ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç»´æŠ¤æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¤æ‚åˆå§‹åŒ–é€»è¾‘é€šè¿‡ &lt;strong&gt;Entrypoint è„šæœ¬&lt;/strong&gt;å¤„ç†ï¼ˆå¤åˆ¶åˆ°é•œåƒä¸­ï¼Œå†è®¾ &lt;code&gt;command: [&amp;quot;/path/script.sh&amp;quot;]&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§éªŒè¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;kubectl logs &amp;lt;pod&amp;gt;&lt;/code&gt; ç¡®è®¤å‘½ä»¤è¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¯¹æ¯”æ€»ç»“command-vs-args"&gt;ğŸ’ &lt;strong&gt;å¯¹æ¯”æ€»ç»“ï¼šcommand vs args&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;command&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;args&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰å®¹å™¨ä¸»å‘½ä»¤ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;ä¼ é€’å‘½ä»¤å‚æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¦†ç›–ä¼˜å…ˆçº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¦†ç›–é•œåƒ &lt;code&gt;ENTRYPOINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¦†ç›–é•œåƒ &lt;code&gt;CMD&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šåº”ç”¨æ¡†æ¶ï¼ˆå¦‚ &lt;code&gt;python&lt;/code&gt;ã€&lt;code&gt;nginx&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€å‚æ•°ï¼ˆå¦‚ &lt;code&gt;--port=8080&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¼å¼è¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Exec æ ¼å¼ï¼ˆæ•°ç»„ï¼‰é¿å…ä¿¡å·é—®é¢˜&lt;/td&gt;
&lt;td&gt;æ”¯æŒç¯å¢ƒå˜é‡æ‰©å±•ï¼ˆ&lt;code&gt;$(VAR)&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;æŒæ¡ &lt;code&gt;command&lt;/code&gt; å’Œ &lt;code&gt;args&lt;/code&gt; çš„çµæ´»é…ç½®ï¼Œæ˜¯ç²¾å‡†æ§åˆ¶ Kubernetes å®¹å™¨è¡Œä¸ºçš„å…³é”®ä¸€æ­¥ã€‚é€šè¿‡åˆç†ç»„åˆäºŒè€…ï¼Œæ—¢èƒ½é€‚é…å¤šæ ·åŒ–çš„å¯åŠ¨éœ€æ±‚ï¼Œåˆèƒ½ç¡®ä¿å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„ç¨³å®šæ€§å’Œå¯è§‚æµ‹æ€§&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="æ ‡ç­¾"&gt;æ ‡ç­¾
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Kubernetes ä¸­&lt;strong&gt;æ ‡ç­¾ï¼ˆLabelsï¼‰&lt;/strong&gt; å’Œ&lt;strong&gt;æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorsï¼‰&lt;/strong&gt; çš„è¯¦ç»†è§£æï¼Œæ¶µç›–æ ¸å¿ƒæ¦‚å¿µã€å·¥ä½œæœºåˆ¶ã€åº”ç”¨åœºæ™¯åŠæœ€ä½³å®è·µï¼Œç»“åˆæŠ€æœ¯ç»†èŠ‚ä¸å·¥ç¨‹å®è·µå±•å¼€è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ‡ç­¾labelsçš„æ ¸å¿ƒæ¦‚å¿µ"&gt;ğŸ” æ ‡ç­¾ï¼ˆLabelsï¼‰çš„æ ¸å¿ƒæ¦‚å¿µ
&lt;/h3&gt;&lt;h4 id="å®šä¹‰ä¸ä½œç”¨-1"&gt;&lt;strong&gt;å®šä¹‰ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾çš„æœ¬è´¨&lt;/strong&gt;ï¼šé”®å€¼å¯¹ï¼ˆKey-Valueï¼‰å½¢å¼çš„å…ƒæ•°æ®ï¼Œé™„åŠ äº Kubernetes èµ„æºå¯¹è±¡ï¼ˆå¦‚ Podã€Nodeã€Service ç­‰ï¼‰ä¸Šï¼Œç”¨äºæ ‡è¯†èµ„æºçš„å±æ€§æˆ–åˆ†ç±»&lt;a class="link" href="@ref" &gt;1,2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒä»·å€¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç»„ç»‡&lt;/strong&gt;ï¼šå°†é€»è¾‘ç›¸å…³çš„èµ„æºåˆ†ç»„ï¼ˆå¦‚ &lt;code&gt;env=prod&lt;/code&gt;ã€&lt;code&gt;app=nginx&lt;/code&gt;ï¼‰ï¼Œå®ç°å¤šç»´åº¦ç®¡ç†&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¾è€¦åˆå…³è”&lt;/strong&gt;ï¼šè§£è€¦èµ„æºé—´ä¾èµ–å…³ç³»ï¼ˆå¦‚ Service é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨å…³è” Podï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–æ“ä½œ&lt;/strong&gt;ï¼šæ”¯æŒæ‰¹é‡æŸ¥è¯¢ã€æ›´æ–°æˆ–åˆ é™¤èµ„æº&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ ‡ç­¾çš„è¯­æ³•è§„èŒƒ"&gt;&lt;strong&gt;æ ‡ç­¾çš„è¯­æ³•è§„èŒƒ&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è§„åˆ™&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é”®ï¼ˆKeyï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å€¼ï¼ˆValueï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é•¿åº¦é™åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â‰¤ 63 å­—ç¬¦&lt;/td&gt;
&lt;td&gt;â‰¤ 63 å­—ç¬¦ï¼ˆå¯ä¸ºç©ºï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­—ç¬¦è¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­—æ¯/æ•°å­—å¼€å¤´ç»“å°¾ï¼Œå¯ç”¨ &lt;code&gt;-&lt;/code&gt;ã€&lt;code&gt;_&lt;/code&gt;ã€&lt;code&gt;.&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒé”®è¦æ±‚ï¼ˆè‹¥ä¸ä¸ºç©ºï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‰ç¼€è§„åˆ™&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯é€‰ï¼ˆå¦‚ &lt;code&gt;app.kubernetes.io/name&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;æ— å‰ç¼€è¦æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;environment&lt;/code&gt;ã€&lt;code&gt;tier&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;production&lt;/code&gt;ã€&lt;code&gt;frontend&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ å‰ç¼€éœ€ç¬¦åˆ DNS å­åŸŸåæ ¼å¼ï¼ˆå¦‚ &lt;code&gt;kubernetes.io/&lt;/code&gt; é¢„ç•™ç»™æ ¸å¿ƒç»„ä»¶ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ ‡ç­¾é€‰æ‹©å™¨label-selectorsçš„å·¥ä½œåŸç†"&gt;âš™ï¸ æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorsï¼‰çš„å·¥ä½œåŸç†
&lt;/h3&gt;&lt;h4 id="é€‰æ‹©å™¨ç±»å‹ä¸è¡¨è¾¾å¼"&gt;&lt;strong&gt;é€‰æ‹©å™¨ç±»å‹ä¸è¡¨è¾¾å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ“ä½œç¬¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸºäºç­‰å€¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;=&lt;/code&gt;ã€&lt;code&gt;==&lt;/code&gt;ã€&lt;code&gt;!=&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;env=prod&lt;/code&gt;ã€&lt;code&gt;tier!=backend&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç²¾ç¡®åŒ¹é…ç‰¹å®šæ ‡ç­¾å€¼&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸºäºé›†åˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;in&lt;/code&gt;ã€&lt;code&gt;notin&lt;/code&gt;ã€&lt;code&gt;exists&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;env in (prod, staging)&lt;/code&gt;ã€&lt;code&gt;!critical&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤šå€¼ç­›é€‰æˆ–é”®å­˜åœ¨æ€§æ£€æŸ¥&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤åˆé€»è¾‘&lt;/strong&gt;ï¼šå¤šæ¡ä»¶ç”¨é€—å·åˆ†éš”ï¼Œè¡¨ç¤º &lt;code&gt;AND&lt;/code&gt; å…³ç³»ï¼ˆå¦‚ &lt;code&gt;env=prod,app=nginx&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ ¸å¿ƒåº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;æ ¸å¿ƒåº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Service å‘ç°ï¼šService é€šè¿‡é€‰æ‹©å™¨åŒ¹é…åç«¯ Podï¼ˆç¤ºä¾‹é…ç½®ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: Service
metadata:
name: nginx-service
spec:
selector:
app: nginx # å…³è”æ‰€æœ‰å«æ­¤æ ‡ç­¾çš„ Pod[2,7](@ref)
ports:
- port: 80
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶å™¨ç®¡ç† Pod&lt;/strong&gt;ï¼šDeployment/ReplicaSet é€šè¿‡ &lt;code&gt;matchLabels&lt;/code&gt; å…³è”åˆ›å»ºçš„ Pod&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹è°ƒåº¦&lt;/strong&gt;ï¼šPod ä½¿ç”¨ &lt;code&gt;nodeSelector&lt;/code&gt; é€‰æ‹©ç‰¹å®šæ ‡ç­¾çš„èŠ‚ç‚¹ï¼ˆå¦‚ &lt;code&gt;disk=ssd&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡‘ä¸é›€å‘å¸ƒ&lt;/strong&gt;ï¼šé€šè¿‡æ ‡ç­¾åŒºåˆ†æ–°æ—§ç‰ˆæœ¬ Podï¼ˆå¦‚ &lt;code&gt;version: canary&lt;/code&gt;ï¼‰ï¼Œé€æ­¥å¼•æµæµé‡&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ ‡ç­¾æ“ä½œå‘½ä»¤ä¸å®è·µ"&gt;ğŸ› ï¸ æ ‡ç­¾æ“ä½œå‘½ä»¤ä¸å®è·µ
&lt;/h3&gt;&lt;h4 id="å¸¸ç”¨"&gt;&lt;strong&gt;å¸¸ç”¨ &lt;code&gt;kubectl&lt;/code&gt; å‘½ä»¤&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å‘½ä»¤ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ·»åŠ æ ‡ç­¾&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;kubectl label pod nginx env=prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¸º Pod æ·»åŠ æ–°æ ‡ç­¾&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ›´æ–°æ ‡ç­¾&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;kubectl label pod nginx env=staging --overwrite&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¦†ç›–ç°æœ‰æ ‡ç­¾å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ é™¤æ ‡ç­¾&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;kubectl label pod nginx env-&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç§»é™¤æŒ‡å®šæ ‡ç­¾&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿‡æ»¤æŸ¥è¯¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;kubectl get pods -l 'env in (prod, dev)'&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç­›é€‰å¤šç¯å¢ƒ Pod&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¾ç¤ºæ ‡ç­¾åˆ—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;kubectl get pods -L env,app&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¾“å‡ºè¡¨æ ¼ä¸­æ˜¾ç¤ºæŒ‡å®šæ ‡ç­¾åˆ—&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="yaml-é…ç½®ç¤ºä¾‹"&gt;&lt;strong&gt;YAML é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Deployment å…³è” Podï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: apps/v1
kind: Deployment
metadata:
labels:
app: nginx
spec:
selector:
matchLabels: # é€‰æ‹©å™¨å®šä¹‰
app: nginx
template:
metadata:
labels: # Pod æ ‡ç­¾ï¼ˆéœ€ä¸é€‰æ‹©å™¨åŒ¹é…ï¼‰
app: nginx
env: prod
```[4,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§åº”ç”¨ä¸æœ€ä½³å®è·µ"&gt;ğŸ§© é«˜çº§åº”ç”¨ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="å¤šå±‚çº§æ ‡ç­¾ç³»ç»Ÿ"&gt;&lt;strong&gt;å¤šå±‚çº§æ ‡ç­¾ç³»ç»Ÿ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åˆ†å±‚è®¾è®¡æ ‡ç­¾æå‡ç®¡ç†ç²’åº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒç»´åº¦&lt;/strong&gt;ï¼š&lt;code&gt;environment: production&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨ç»´åº¦&lt;/strong&gt;ï¼š&lt;code&gt;app: checkout-service&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»„ä»¶ç»´åº¦&lt;/strong&gt;ï¼š&lt;code&gt;tier: backend&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡ç»´åº¦&lt;/strong&gt;ï¼š&lt;code&gt;team: payment&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è‡ªåŠ¨åŒ–ä¸å®‰å…¨"&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–ä¸å®‰å…¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CI/CD é›†æˆ&lt;/strong&gt;ï¼šåœ¨æµæ°´çº¿ä¸­è‡ªåŠ¨æ³¨å…¥æ ‡ç­¾ï¼ˆå¦‚ &lt;code&gt;branch: feature-xyz&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™æ§åˆ¶&lt;/strong&gt;ï¼šç»“åˆ RBAC é™åˆ¶å¸¦æ•æ„Ÿæ ‡ç­¾çš„èµ„æºè®¿é—®ï¼ˆå¦‚ &lt;code&gt;access: restricted&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="kubernetes-æ¨èæ ‡ç­¾"&gt;&lt;strong&gt;Kubernetes æ¨èæ ‡ç­¾&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ ‡ç­¾é”®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;app.kubernetes.io/name&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨åç§°ï¼ˆå¦‚ &lt;code&gt;nginx&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;app.kubernetes.io/instance&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨å®ä¾‹æ ‡è¯†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;app.kubernetes.io/version&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨ç‰ˆæœ¬ï¼ˆå¦‚ &lt;code&gt;1.16.0&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨æ ‡å‡†æ ‡ç­¾å¢å¼ºè·¨å›¢é˜Ÿåä½œä¸å·¥å…·å…¼å®¹æ€§&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—-1"&gt;âš ï¸ å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾é€‰æ‹©å™¨ä¸ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šæ ‡ç­¾æ‹¼å†™é”™è¯¯æˆ–é€‰æ‹©å™¨é€»è¾‘é”™è¯¯ï¼ˆå¦‚ &lt;code&gt;env=prod&lt;/code&gt; è¯¯å†™ä¸º &lt;code&gt;env=production&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç”¨ &lt;code&gt;kubectl get pods --show-labels&lt;/code&gt; éªŒè¯æ ‡ç­¾&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pod è°ƒåº¦å¤±è´¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼š&lt;code&gt;nodeSelector&lt;/code&gt; æŒ‡å®šçš„æ ‡ç­¾æœªå­˜åœ¨äºä»»ä½•èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šä¸ºèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾ï¼ˆ&lt;code&gt;kubectl label node &amp;lt;node-name&amp;gt; disk=ssd&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾å†²çª&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¡ˆä¾‹&lt;/strong&gt;ï¼šDeployment çš„ &lt;code&gt;matchLabels&lt;/code&gt; ä¸ Pod æ¨¡æ¿æ ‡ç­¾ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ§åˆ¶å™¨æ— æ³•å…³è” Podã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„èŒƒ&lt;/strong&gt;ï¼šç¡®ä¿æ§åˆ¶å™¨é€‰æ‹©å™¨ä¸ Pod æ ‡ç­¾ä¸¥æ ¼åŒ¹é…&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-25"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ ‡ç­¾ä¸æ ‡ç­¾é€‰æ‹©å™¨æ˜¯ Kubernetes èµ„æºç®¡ç†çš„&lt;strong&gt;æ ¸å¿ƒç¼–æ’æœºåˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾&lt;/strong&gt;æ˜¯èµ„æºçš„â€œèº«ä»½æ ‡è¯†â€ï¼Œæä¾›å¤šç»´åº¦çš„åˆ†ç±»èƒ½åŠ›&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç­¾é€‰æ‹©å™¨&lt;/strong&gt;æ˜¯èµ„æºå…³è”çš„â€œç²˜åˆå‰‚â€ï¼Œæ”¯æ’‘æœåŠ¡å‘ç°ã€æ»šåŠ¨æ›´æ–°ç­‰å…³é”®åœºæ™¯&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;â€‹ï¼šé‡‡ç”¨åˆ†å±‚æ ‡ç­¾ç³»ç»Ÿã€éµå¾ª Kubernetes æ ‡å‡†æ ‡ç­¾ã€é€šè¿‡è‡ªåŠ¨åŒ–å‡å°‘äººå·¥é”™è¯¯&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†è¿ç”¨æ ‡ç­¾ï¼Œå¯å®ç°é›†ç¾¤èµ„æºçš„&lt;strong&gt;é«˜æ•ˆè‡ªæ²»&lt;/strong&gt;ä¸&lt;strong&gt;ç²¾ç»†åŒ–ç®¡æ§&lt;/strong&gt;ï¼Œä¸ºå¤æ‚å¾®æœåŠ¡æ¶æ„æä¾›åº•å±‚æ”¯æ’‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å®‰å…¨"&gt;å®‰å…¨
&lt;/h2&gt;&lt;p&gt;Kubernetesï¼ˆK8sï¼‰é›†ç¾¤å®‰å…¨æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œéœ€ä»ç½‘ç»œã€è®¤è¯æˆæƒã€è¿è¡Œæ—¶é˜²æŠ¤ç­‰å¤šç»´åº¦æ„å»ºé˜²å¾¡ä½“ç³»ã€‚ä»¥ä¸‹æ˜¯å…³é”®ç­–ç•¥åŠæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ç½‘ç»œå®‰å…¨æ§åˆ¶æµé‡å…¥å£ä¸éš”ç¦»"&gt;ğŸ”’ &lt;strong&gt;ç½‘ç»œå®‰å…¨ï¼šæ§åˆ¶æµé‡å…¥å£ä¸éš”ç¦»&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œç­–ç•¥ï¼ˆNetwork Policiesï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šé™åˆ¶Podé—´é€šä¿¡ï¼Œä»…å…è®¸æˆæƒæµé‡ã€‚ä¾‹å¦‚ï¼Œåªå…è®¸å‰ç«¯Podè®¿é—®åç«¯æœåŠ¡ï¼Œç¦æ­¢å…¶ä»–è®¿é—®&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é…ç½®ç¤ºä¾‹&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
name: deny-all
spec:
podSelector: {}
policyTypes: [Ingress, Egress] # é»˜è®¤æ‹’ç»æ‰€æœ‰å‡ºå…¥ç«™æµé‡
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å·¥å…·&lt;/strong&gt;ï¼šCalicoã€Ciliumï¼ˆæ”¯æŒç»†ç²’åº¦ç­–ç•¥ï¼‰&lt;a class="link" href="@ref" &gt;2,10&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šé€šè¿‡Istio/Linkerdå¯ç”¨&lt;strong&gt;åŒå‘TLSï¼ˆmTLSï¼‰&lt;/strong&gt;ï¼ŒåŠ å¯†æœåŠ¡é—´é€šä¿¡ï¼Œå¹¶å®ç°æµé‡é‰´æƒ&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é˜²ç«å¢™ä¸è®¿é—®æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹ä»…å¼€æ”¾å¿…è¦ç«¯å£ï¼ˆå¦‚API Serverçš„6443ã€kubeletçš„10250ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;äº‘ç¯å¢ƒä½¿ç”¨å®‰å…¨ç»„é™åˆ¶å…¥å£æµé‡ï¼ˆå¦‚ä»…å…è®¸è¿ç»´IPè®¿é—®æ§åˆ¶å¹³é¢ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è®¤è¯ä¸æˆæƒæœ€å°æƒé™åŸåˆ™"&gt;ğŸ”‘ &lt;strong&gt;è®¤è¯ä¸æˆæƒï¼šæœ€å°æƒé™åŸåˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;API Serverè®¤è¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿…é€‰é¡¹&lt;/strong&gt;ï¼šå¯ç”¨TLSåŠ å¯†ï¼Œç¦ç”¨åŒ¿åè®¿é—®ï¼ˆ&lt;code&gt;--anonymous-auth=false&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¤è¯æ–¹å¼&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯è¯ä¹¦ã€ServiceAccount Tokenã€OIDCç­‰&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ ¸å¿ƒæ¦‚å¿µï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;èŒƒå›´&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Role&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰å‘½åç©ºé—´å†…èµ„æºæƒé™ï¼ˆå¦‚Podè¯»å†™ï¼‰&lt;/td&gt;
&lt;td&gt;å•ä¸ªå‘½åç©ºé—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ClusterRole&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰é›†ç¾¤çº§èµ„æºæƒé™ï¼ˆå¦‚Nodeç®¡ç†ï¼‰&lt;/td&gt;
&lt;td&gt;å…¨å±€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RoleBinding&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†è§’è‰²ç»‘å®šåˆ°ç”¨æˆ·/ServiceAccount&lt;/td&gt;
&lt;td&gt;å•ä¸ªå‘½åç©ºé—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ClusterRoleBinding&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…¨å±€ç»‘å®šè§’è‰²&lt;/td&gt;
&lt;td&gt;å…¨å±€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®è·µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘äººå‘˜ï¼šä»…èƒ½æŸ¥çœ‹å‘½åç©ºé—´å†…Podæ—¥å¿—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¿ç»´äººå‘˜ï¼šå¯æ“ä½œDeploymentï¼Œä½†ç¦æ­¢è®¿é—®Secrets&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¡è®¡å‘½ä»¤&lt;/p&gt;
&lt;p&gt;ï¼šå®šæœŸæ£€æŸ¥æƒé™åˆ†é…ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl get rolebindings,clusterrolebindings -A
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServiceAccountç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¦æ­¢Podä½¿ç”¨é»˜è®¤ServiceAccountï¼ˆè®¾ç½®&lt;code&gt;automountServiceAccountToken: false&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯ä¸ªå¾®æœåŠ¡åˆ›å»ºç‹¬ç«‹ServiceAccountå¹¶ç»‘å®šæœ€å°æƒé™è§’è‰²&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å®¹å™¨ä¸é•œåƒå®‰å…¨å µä½æ¼æ´å…¥å£"&gt;ğŸ³ &lt;strong&gt;å®¹å™¨ä¸é•œåƒå®‰å…¨ï¼šå µä½æ¼æ´å…¥å£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é•œåƒå®‰å…¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç§æœ‰ä»“åº“&lt;/strong&gt;ï¼šä½¿ç”¨Harboræ‰˜ç®¡é•œåƒï¼Œå¼€å¯æ¼æ´æ‰«æ&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•œåƒç­¾å&lt;/strong&gt;ï¼šé›†æˆCosign/NotaryéªŒè¯é•œåƒæ¥æºçœŸå®æ€§&lt;a class="link" href="@ref" &gt;2,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¼æ´æ‰«æ&lt;/strong&gt;ï¼šåœ¨CI/CDä¸­åµŒå…¥Trivyã€Clairï¼Œé˜»æ–­é«˜é£é™©é•œåƒéƒ¨ç½²&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿è¡Œæ—¶å®‰å…¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆSecurityContextï¼‰&lt;/p&gt;
&lt;p&gt;ï¼šé™åˆ¶å®¹å™¨æƒé™&lt;/p&gt;
&lt;p&gt;2,5&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;securityContext:
runAsNonRoot: true # ç¦æ­¢rootè¿è¡Œ
allowPrivilegeEscalation: false # ç¦æ­¢ææƒ
capabilities: drop: [&amp;#34;ALL&amp;#34;] # æ”¾å¼ƒæ‰€æœ‰ç‰¹æƒ
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Podå®‰å…¨ç­–ç•¥æ›¿ä»£æ–¹æ¡ˆ&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å†…ç½® &lt;strong&gt;Pod Security Admissionï¼ˆPSAï¼‰&lt;/strong&gt; è®¾ç½®åŸºçº¿ç­–ç•¥&lt;a class="link" href="@ref" &gt;2,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é«˜çº§éœ€æ±‚ï¼šé‡‡ç”¨ &lt;strong&gt;OPA Gatekeeper&lt;/strong&gt; å®šä¹‰è‡ªå®šä¹‰ç­–ç•¥ï¼ˆå¦‚ç¦æ­¢ç‰¹æƒå®¹å™¨ï¼‰&lt;a class="link" href="@ref" &gt;1,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€è®¾æ–½åŠ å›ºåº•å±‚é˜²çº¿"&gt;ğŸ–¥ï¸ &lt;strong&gt;åŸºç¡€è®¾æ–½åŠ å›ºï¼šåº•å±‚é˜²çº¿&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èŠ‚ç‚¹å®‰å…¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å®šæœŸæ›´æ–°OSï¼ˆä½¿ç”¨&lt;code&gt;unattended-upgrades&lt;/code&gt;å·¥å…·ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¦ç”¨SSHå¯†ç ç™»å½•ï¼Œå¼ºåˆ¶å¯†é’¥è®¤è¯ï¼›éƒ¨ç½²ä¸»æœºå®‰å…¨Agentï¼ˆå¦‚Falcoç›‘æ§å¼‚å¸¸è¿›ç¨‹ï¼‰&lt;a class="link" href="@ref" &gt;2,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;K8sç»„ä»¶å®‰å…¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆå¦‚etcdï¼‰å¯ç”¨&lt;strong&gt;åŒå‘TLSè®¤è¯&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸå‡çº§K8sç‰ˆæœ¬ï¼ˆä½¿ç”¨&lt;code&gt;kubeadm upgrade&lt;/code&gt;æˆ–Rancherç­‰ç®¡ç†å·¥å…·ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç›‘æ§ä¸å“åº”å®æ—¶å¨èƒæ„ŸçŸ¥"&gt;ğŸ‘ï¸ &lt;strong&gt;ç›‘æ§ä¸å“åº”ï¼šå®æ—¶å¨èƒæ„ŸçŸ¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—ä¸å®¡è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®æ—¥å¿—æº&lt;/strong&gt;ï¼šAPI Serverå®¡è®¡æ—¥å¿—ã€å®¹å™¨è¿è¡Œæ—¶æ—¥å¿—ï¼ˆcontainerdï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¡è®¡é…ç½®&lt;/p&gt;
&lt;p&gt;ï¼šè®°å½•æ•æ„Ÿæ“ä½œï¼ˆå¦‚Secretsè®¿é—®ï¼‰&lt;/p&gt;
&lt;p&gt;2&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# audit-policy.yaml
rules:
- level: Metadata
resources: [{group: &amp;#34;&amp;#34;, resources: [&amp;#34;secrets&amp;#34;, &amp;#34;configmaps&amp;#34;]}]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¨èƒæ£€æµ‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Falco&lt;/strong&gt; ç›‘æ§å¼‚å¸¸è¡Œä¸ºï¼ˆå¦‚å®¹å™¨å†…å¯åŠ¨SSHæœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;2,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é›†æˆ &lt;strong&gt;SIEMå·¥å…·&lt;/strong&gt;ï¼ˆå¦‚Elastic Securityï¼‰åˆ†æå‘Šè­¦&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒè¿›é˜¶å®è·µ"&gt;ğŸ›¡ï¸ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒè¿›é˜¶å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Secretsç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;HashiCorp Vault&lt;/strong&gt; æˆ– &lt;strong&gt;Sealed Secrets&lt;/strong&gt; åŠ å¯†æ•æ„Ÿä¿¡æ¯ï¼Œé¿å…æ˜æ–‡å­˜å‚¨&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸè½®æ¢å¯†é’¥ï¼ˆå¦‚é€šè¿‡VaultåŠ¨æ€ç”Ÿæˆæ•°æ®åº“å¯†ç ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é›†ç¾¤åŠ å›ºå·¥å…·&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;kube-bench&lt;/p&gt;
&lt;p&gt;ï¼šæ£€æŸ¥CISåŸºå‡†åˆè§„æ€§&lt;/p&gt;
&lt;p&gt;2,5&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;docker run --rm -v $(pwd):/host aquasec/kube-bench node --version 1.28
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‘æ‰˜ç®¡æœåŠ¡ï¼šAWS EKSã€GKE Autopilotå†…ç½®å®‰å…¨æœ€ä½³å®è·µ&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¾éš¾æ¢å¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šæœŸå¤‡ä»½etcdæ•°æ®ï¼ˆ&lt;code&gt;etcdctl snapshot save&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Velero&lt;/strong&gt; å¤‡ä»½é›†ç¾¤èµ„æºï¼ˆPVã€Deploymentç­‰ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“åˆ†å±‚é˜²å¾¡ä½“ç³»"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šåˆ†å±‚é˜²å¾¡ä½“ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢„é˜²&lt;/strong&gt;ï¼šç½‘ç»œéš”ç¦» + RBAC + å®‰å…¨ä¸Šä¸‹æ–‡ + é•œåƒæ‰«æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æµ‹&lt;/strong&gt;ï¼šå®¡è®¡æ—¥å¿— + Falcoå®æ—¶ç›‘æ§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”&lt;/strong&gt;ï¼šå®šæœŸæ¼”ç»ƒæ¢å¤æµç¨‹ï¼Œå­£åº¦å®‰å…¨å®¡è®¡&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒåŸåˆ™&lt;/strong&gt;ï¼šæœ€å°æƒé™ã€é›¶ä¿¡ä»»ç½‘ç»œã€çºµæ·±é˜²å¾¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®å£è¯€&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;ç½‘ç»œéš”ç¦»æ˜¯åŸºç¡€ï¼ŒRBACç®¡æƒé™ï¼›
éRootè¿è¡Œå®¹å™¨ï¼Œé•œåƒæ‰«æé˜²æ¼æ´ï¼›
å¯†é’¥åŠ å¯†è«æ˜æ–‡ï¼Œå®¡è®¡æ—¥å¿—æº¯æºå¤´ï¼â€‹&lt;/strong&gt;â€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°åˆ†å±‚ç­–ç•¥ï¼Œå¯æ˜¾è‘—é™ä½K8sé›†ç¾¤è¢«æ”»å‡»çš„é£é™©ï¼Œä¿éšœä¸šåŠ¡æŒç»­å®‰å…¨è¿è¡Œ&lt;a class="link" href="@ref" &gt;1,2,10&lt;/a&gt;ã€‚&lt;/p&gt;</description></item><item><title>ã€k8sã€‘Fundamentals</title><link>https://dyhes.github.io/p/k8sfundamentals/</link><pubDate>Wed, 14 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/k8sfundamentals/</guid><description>&lt;h2 id="kubernetes-explained-in-6-minutes--k8s-architecture"&gt;&lt;strong&gt;Kubernetes Explained in 6 Minutes | k8s Architecture&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.youtube.com/watch?v=TlHvYWVUZyc" target="_blank" rel="noopener"
&gt;https://www.youtube.com/watch?v=TlHvYWVUZyc&lt;/a&gt;
&lt;img src="https://i.ibb.co/fVy2MFQZ/image.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/4nYSrZFb/image-3.png"
loading="lazy"
&gt;
Pods are the smallest deployable units in k8s.&lt;/p&gt;
&lt;p&gt;A pod hosts one or more containers and provide shared storage and networking for those containers&lt;/p&gt;
&lt;p&gt;Pods are created and managed by the k8s control plane&lt;/p&gt;
&lt;h2 id="vs-docker-compose"&gt;v.s. Docker Compose
&lt;/h2&gt;&lt;p&gt;Docker Compose å’Œ Kubernetesï¼ˆk8sï¼‰åœ¨å®¹å™¨åŒ–æŠ€æœ¯ç”Ÿæ€ä¸­æ‰®æ¼”ç€ä¸åŒçš„è§’è‰²ï¼Œä¸»è¦åŒºåˆ«ä½“ç°åœ¨åŠŸèƒ½å®šä½ã€æ¶æ„è®¾è®¡ã€é€‚ç”¨åœºæ™¯å’Œå¤æ‚åº¦ç­‰æ–¹é¢ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„æ ¸å¿ƒå·®å¼‚æ€»ç»“ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŠŸèƒ½å®šä½"&gt;&lt;strong&gt;åŠŸèƒ½å®šä½&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;ï¼šä¸“æ³¨äºå•æœºç¯å¢ƒä¸‹çš„å¤šå®¹å™¨åº”ç”¨ç®¡ç†ï¼Œé€šè¿‡ç®€å•çš„ YAML æ–‡ä»¶å®šä¹‰æœåŠ¡ã€ç½‘ç»œå’Œå­˜å‚¨ï¼Œå®ç°ä¸€é”®å¯åŠ¨å¤šå®¹å™¨åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¿«é€Ÿæ­å»ºæœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œæ”¯æŒæœåŠ¡ä¾èµ–å…³ç³»å®šä¹‰ï¼ˆå¦‚æ•°æ®åº“å’Œ Web æœåŠ¡è”åŠ¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¯å¢ƒéš”ç¦»ï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ç¯å¢ƒç‹¬ç«‹é…ç½®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼ˆå¯åŠ¨ã€åœæ­¢ã€æ—¥å¿—æŸ¥çœ‹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;ï¼šé¢å‘å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼Œæä¾›è·¨é›†ç¾¤çš„å®¹å™¨ç¼–æ’èƒ½åŠ›ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–è¿ç»´ã€é«˜å¯ç”¨æ€§å’Œå¤æ‚åœºæ™¯çš„æ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰ã€æ»šåŠ¨æ›´æ–°ã€æ•…éšœè‡ªæ„ˆã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡ï¼ˆå†…ç½® Service å’Œ DNSï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åŠ¨æ€å­˜å‚¨ç®¡ç†ï¼ˆPV/PVCï¼‰ã€å¤šç§Ÿæˆ·éš”ç¦»ï¼ˆNamespaceï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ¶æ„è®¾è®¡"&gt;&lt;strong&gt;æ¶æ„è®¾è®¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¶æ„&lt;/strong&gt;ï¼šå•æœºæ¶æ„ï¼Œä¾èµ– Docker Daemon ç®¡ç†æœ¬åœ°å®¹å™¨ï¼Œé€šè¿‡ &lt;code&gt;docker-compose.yml&lt;/code&gt; æ–‡ä»¶å®šä¹‰æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;ï¼šä»…éœ€ Docker å¼•æ“å’Œ Compose CLIï¼Œæ— éœ€é¢å¤–ç»„ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¶æ„&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼é›†ç¾¤æ¶æ„ï¼ŒåŒ…å« Master èŠ‚ç‚¹ï¼ˆAPI Serverã€Schedulerã€Controller Managerï¼‰å’Œ Worker èŠ‚ç‚¹ï¼ˆè¿è¡Œ Podï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;ï¼šåŒ…å« Podã€Serviceã€Deployment ç­‰æŠ½è±¡å±‚ï¼Œæ”¯æŒè·¨ä¸»æœºè°ƒåº¦å’Œå¤æ‚çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®æ–‡ä»¶ä¸å¤æ‚åº¦"&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶ä¸å¤æ‚åº¦&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼šç®€å•ç›´è§‚çš„ YAML æ–‡ä»¶ï¼Œä¾‹å¦‚å®šä¹‰ Web æœåŠ¡å’Œæ•°æ®åº“ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;3&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx:latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;80:80&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql:5.7&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;MYSQL_ROOT_PASSWORD=example&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­¦ä¹ æˆæœ¬&lt;/strong&gt;ï¼šé€‚åˆå¼€å‘è€…å’Œå°å‹å›¢é˜Ÿï¼Œæ— éœ€æ·±å…¥ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼šéœ€è¦ç¼–å†™å¤šä¸ª YAML æ–‡ä»¶å®šä¹‰ Deploymentã€Service ç­‰ï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx-deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx:1.14.2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;containerPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­¦ä¹ æˆæœ¬&lt;/strong&gt;ï¼šéœ€æŒæ¡é›†ç¾¤ç®¡ç†ã€ç½‘ç»œæ¨¡å‹å’Œå­˜å‚¨ç¼–æ’ç­‰æ¦‚å¿µï¼Œé€‚åˆæœ‰è¿ç»´ç»éªŒçš„å›¢é˜Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€å‘ä¸æµ‹è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ¬åœ°å¿«é€Ÿå¯åŠ¨å¤šå®¹å™¨åº”ç”¨ï¼Œæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¾èµ–ã€‚&lt;/td&gt;
&lt;td&gt;ä¸é€‚ç”¨ï¼Œéœ€ä¾èµ–é›†ç¾¤ç¯å¢ƒã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æœºéƒ¨ç½²&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆå°è§„æ¨¡åº”ç”¨ï¼ˆå¦‚åŸå‹éªŒè¯ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;ä¸é€‚ç”¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— æ³•æ»¡è¶³é«˜å¯ç”¨æ€§å’Œæ‰©å±•éœ€æ±‚ã€‚&lt;/td&gt;
&lt;td&gt;æ”¯æŒæ•°åƒèŠ‚ç‚¹ã€è‡ªåŠ¨æ•…éšœæ¢å¤å’Œè·¨äº‘éƒ¨ç½²ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¾®æœåŠ¡æ¶æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒç®€å•æœåŠ¡äº¤äº’ã€‚&lt;/td&gt;
&lt;td&gt;ç®¡ç†æ•°ç™¾ä¸ªå¾®æœåŠ¡ï¼Œæä¾›è´Ÿè½½å‡è¡¡å’Œæµé‡æ§åˆ¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ååŒä½¿ç”¨å»ºè®®"&gt;&lt;strong&gt;ååŒä½¿ç”¨å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘é˜¶æ®µ&lt;/strong&gt;ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿæ„å»ºé•œåƒå¹¶æµ‹è¯•æœåŠ¡é—´äº¤äº’ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§é˜¶æ®µ&lt;/strong&gt;ï¼šé€šè¿‡ Kubernetes éƒ¨ç½²å®¹å™¨é›†ç¾¤ï¼Œç»“åˆ Prometheusï¼ˆç›‘æ§ï¼‰ã€Istioï¼ˆæœåŠ¡ç½‘æ ¼ï¼‰ç­‰å·¥å…·å®ç°äº‘åŸç”Ÿæ¶æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç§»è·¯å¾„&lt;/strong&gt;ï¼šå¯é€šè¿‡å·¥å…·ï¼ˆå¦‚ Komposeï¼‰å°† Compose æ–‡ä»¶è½¬æ¢ä¸º Kubernetes èµ„æºæè¿°æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Docker Compose æ˜¯&lt;strong&gt;è½»é‡çº§å¼€å‘å·¥å…·&lt;/strong&gt;ï¼Œé€‚åˆå¿«é€Ÿå¯åŠ¨å’Œç®€å•ç®¡ç†ï¼›Kubernetes æ˜¯&lt;strong&gt;ä¼ä¸šçº§ç¼–æ’å¹³å°&lt;/strong&gt;ï¼Œè§£å†³å¤§è§„æ¨¡ã€é«˜å¯ç”¨åœºæ™¯çš„å¤æ‚æ€§ã€‚ä¸¤è€…äº’è¡¥è€Œéç«äº‰ï¼Œå®é™…é¡¹ç›®ä¸­å¸¸ç»“åˆä½¿ç”¨ï¼šCompose ç”¨äºå¼€å‘ï¼ŒKubernetes ç”¨äºç”Ÿäº§ã€‚&lt;/p&gt;
&lt;h2 id="docker-compose-vs-minikube"&gt;Docker Compose vs. Minikube
&lt;/h2&gt;&lt;p&gt;Docker Compose ä¸ Minikube æ˜¯å®¹å™¨åŒ–å¼€å‘ä¸­å¸¸ç”¨çš„ä¸¤ç§å·¥å…·ï¼Œä½†å…¶è®¾è®¡ç›®æ ‡ã€é€‚ç”¨åœºæ™¯å’ŒåŠŸèƒ½ç‰¹æ€§å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»å…­ä¸ªç»´åº¦å¯¹æ¯”ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è®¾è®¡ç›®æ ‡ä¸å®šä½"&gt;è®¾è®¡ç›®æ ‡ä¸å®šä½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•æœºå®¹å™¨ç¼–æ’å·¥å…·&lt;/strong&gt;ï¼šä¸“æ³¨äºåœ¨å•å°ä¸»æœºä¸Šå¿«é€Ÿå¯åŠ¨å’Œåè°ƒå¤šä¸ªå®¹å™¨ï¼Œé€šè¿‡ç®€å•çš„ YAML æ–‡ä»¶å®šä¹‰æœåŠ¡ã€ç½‘ç»œå’Œå­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¼€å‘/æµ‹è¯•ç¯å¢ƒä¸­å¿«é€Ÿå¯åŠ¨ä¾èµ–æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼‰ï¼Œæˆ–å°å‹é¡¹ç›®çš„æœ¬åœ°é›†æˆæµ‹è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Minikube&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ¬åœ° Kubernetes æ¨¡æ‹Ÿå™¨&lt;/strong&gt;ï¼šåœ¨å•æœºç¯å¢ƒä¸­å¯åŠ¨è½»é‡çº§ Kubernetes é›†ç¾¤ï¼ˆé€šå¸¸åŸºäºè™šæ‹Ÿæœºæˆ– Docker å®¹å™¨ï¼‰ï¼Œç”¨äºå­¦ä¹ å’Œæ¨¡æ‹Ÿç”Ÿäº§çº§ Kubernetes ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦éªŒè¯ Kubernetes é…ç½®ã€æµ‹è¯•é›†ç¾¤åŠŸèƒ½ï¼Œæˆ–å®ç°å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§éƒ¨ç½²çš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ¶æ„å·®å¼‚"&gt;æ¶æ„å·®å¼‚
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Minikube&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é›†ç¾¤æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒå•æœºéƒ¨ç½²ï¼Œæ— é›†ç¾¤æ¦‚å¿µ&lt;/td&gt;
&lt;td&gt;æ¨¡æ‹Ÿå¤šèŠ‚ç‚¹ Kubernetes é›†ç¾¤ï¼ˆå•èŠ‚ç‚¹ä¸ºä¸»ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–å®¹å™¨åç§°æˆ–è‡ªå®šä¹‰ç½‘ç»œ&lt;/td&gt;
&lt;td&gt;å†…ç½® Kubernetes DNS æœåŠ¡ï¼ˆå¦‚ Service åç§°è§£æï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨åˆ†é…ç«¯å£å’Œå­˜å‚¨å·&lt;/td&gt;
&lt;td&gt;æ”¯æŒ Kubernetes çš„ PersistentVolume å’Œ StorageClass&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨èŠ‚ç‚¹é€šä¿¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;é€šè¿‡ CNI æ’ä»¶æ”¯æŒè·¨èŠ‚ç‚¹ Pod é€šä¿¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="éƒ¨ç½²åœºæ™¯å¯¹æ¯”"&gt;éƒ¨ç½²åœºæ™¯å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Minikube&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€å‘ç¯å¢ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿«é€Ÿå¯åŠ¨æœ¬åœ°æœåŠ¡ä¾èµ–ï¼ˆå¦‚ MySQLã€Redisï¼‰&lt;/td&gt;
&lt;td&gt;éœ€è¦éªŒè¯ Kubernetes é…ç½®æˆ– Operator è¡Œä¸ºæ—¶ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æµ‹è¯•ç¯å¢ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•æœºé›†æˆæµ‹è¯•&lt;/td&gt;
&lt;td&gt;æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„æ»šåŠ¨æ›´æ–°ã€æ•…éšœè‡ªæ„ˆç­‰ç‰¹æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸é€‚ç”¨&lt;/td&gt;
&lt;td&gt;éœ€ç»“åˆå®Œæ•´ Kubernetes é›†ç¾¤ï¼ˆå¦‚ EKSã€GKEï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§"&gt;æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Docker Compose çš„ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®€å•æ˜“ç”¨ï¼šé€šè¿‡ &lt;code&gt;docker-compose up&lt;/code&gt; ä¸€é”®å¯åŠ¨å¤šå®¹å™¨æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;è½»é‡çº§ï¼šæ— é›†ç¾¤ç®¡ç†å¼€é”€ï¼Œé€‚åˆèµ„æºæœ‰é™çš„æœ¬åœ°å¼€å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Minikube çš„è¿›é˜¶èƒ½åŠ›&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–è¿ç»´&lt;/strong&gt;ï¼šæ”¯æŒ Kubernetes çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ã€æ»šåŠ¨æ›´æ–°ã€è“ç»¿éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§çº§ç‰¹æ€§&lt;/strong&gt;ï¼šå†…ç½® Service å’Œ Ingress å®ç°è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒ Liveness/Readiness æ¢é’ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæ€é›†æˆ&lt;/strong&gt;ï¼šä¸ Helmã€Prometheus ç­‰äº‘åŸç”Ÿå·¥å…·é“¾æ— ç¼å¯¹æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å­¦ä¹ ä¸ç»´æŠ¤æˆæœ¬"&gt;å­¦ä¹ ä¸ç»´æŠ¤æˆæœ¬
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Docker Compose&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Minikube&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æ›²çº¿&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆä»…éœ€æŒæ¡ YAML è¯­æ³•ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€ç†è§£ Podã€Deploymentã€Service ç­‰æ¦‚å¿µï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿ç»´å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆå•æœºæ—¥å¿—å’Œç›‘æ§ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€ç®¡ç†é›†ç¾¤çŠ¶æ€ã€ç½‘ç»œç­–ç•¥å’Œå­˜å‚¨æ–¹æ¡ˆï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒè¯•éš¾åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥é€šè¿‡å®¹å™¨æ—¥å¿—æ’æŸ¥é—®é¢˜&lt;/td&gt;
&lt;td&gt;éœ€ç†Ÿæ‚‰ &lt;code&gt;kubectl logs&lt;/code&gt; å’Œ &lt;code&gt;kubectl describe&lt;/code&gt; å‘½ä»¤&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨å»ºè®®"&gt;ä½¿ç”¨å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© Docker Compose çš„åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿«é€ŸéªŒè¯å¾®æœåŠ¡æœ¬åœ°äº¤äº’é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦åŒæ—¶å¯åŠ¨å¤šä¸ªè½»é‡çº§æœåŠ¡ï¼ˆå¦‚ Spring Boot åº”ç”¨ + PostgreSQL + Redisï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© Minikube çš„åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒéœ€ä¿æŒä¸€è‡´çš„ Kubernetes é…ç½®ï¼ˆå¦‚ ConfigMapã€Ingressï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯• Operator æˆ– Helm Chart çš„æœ¬åœ°è¡Œä¸ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆä½¿ç”¨ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘é˜¶æ®µ&lt;/strong&gt;ï¼šç”¨ Docker Compose å¯åŠ¨æ•°æ®åº“ç­‰ä¾èµ–æœåŠ¡ï¼Œé™ä½èµ„æºæ¶ˆè€—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢„å‘å¸ƒé˜¶æ®µ&lt;/strong&gt;ï¼šé€šè¿‡ Minikube éªŒè¯ Kubernetes éƒ¨ç½²é…ç½®ï¼Œç¡®ä¿ä¸ç”Ÿäº§ç¯å¢ƒå¯¹é½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å·¥å…·&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Docker Compose&lt;/td&gt;
&lt;td&gt;æç®€çš„æœ¬åœ°å¤šå®¹å™¨åä½œ&lt;/td&gt;
&lt;td&gt;æ— æ³•æ¨¡æ‹Ÿé›†ç¾¤ç‰¹æ€§ï¼Œç¼ºä¹ç”Ÿäº§çº§è¿ç»´èƒ½åŠ›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Minikube&lt;/td&gt;
&lt;td&gt;æœ¬åœ° Kubernetes å…¨åŠŸèƒ½æ¨¡æ‹Ÿ&lt;/td&gt;
&lt;td&gt;å­¦ä¹ æˆæœ¬é«˜ï¼Œå•èŠ‚ç‚¹æ€§èƒ½å—é™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ ¹æ®å®é™…éœ€æ±‚çµæ´»é€‰æ‹©ï¼š&lt;strong&gt;è½»é‡çº§å¼€å‘é€‰ Docker Composeï¼Œç”Ÿäº§å…¼å®¹æ€§éªŒè¯é€‰ Minikube&lt;/strong&gt;ã€‚ä¸¤è€…äº¦å¯ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚å¼€å‘é˜¶æ®µç”¨ Composeï¼Œéƒ¨ç½²å‰é€šè¿‡ Minikube å®Œæˆæœ€ç»ˆæµ‹è¯•ã€‚&lt;/p&gt;
&lt;h2 id="what-is-kubernetes--kubernetes-explained-in-15-mins"&gt;&lt;strong&gt;What is Kubernetes | Kubernetes explained in 15 mins&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.youtube.com/watch?v=VnvRFRk_51k" target="_blank" rel="noopener"
&gt;https://www.youtube.com/watch?v=VnvRFRk_51k&lt;/a&gt;
&lt;img src="https://i.ibb.co/tphfPPrb/image-2.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/VdWMsPL/image-4.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/9mJv4f7m/image-5.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;Usually one pod per application unless your main application needs some helper containers&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JS Application&lt;/li&gt;
&lt;li&gt;Server (Java A)&lt;/li&gt;
&lt;li&gt;DB&lt;/li&gt;
&lt;li&gt;Message Broker&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="kubernetes-crash-course-for-absolute-beginners"&gt;&lt;strong&gt;Kubernetes Crash Course for Absolute Beginners&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.youtube.com/watch?v=s_o8dwzRlu4" target="_blank" rel="noopener"
&gt;https://www.youtube.com/watch?v=s_o8dwzRlu4&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="service"&gt;Service
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Service: Permanent IP address&lt;/li&gt;
&lt;li&gt;Lifecycle of Pod and Service not connected&lt;/li&gt;
&lt;li&gt;replicas is connected to the same service (load balance)
&lt;img src="https://i.ibb.co/JFC6CShQ/image-6.png"
loading="lazy"
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/Mk6tQnMW/image-9.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;Ingress: entry point&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/tW5x25B/image-7.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h2 id="configmap--secret"&gt;ConfigMap &amp;amp; Secret
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;ConfigMap&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;External Configuration of your application&lt;/li&gt;
&lt;li&gt;for non-confidential data only
Secret: Used to store secret data&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="volume"&gt;Volume
&lt;/h2&gt;&lt;p&gt;persistent (not gone when pod restarted) data storage
&lt;img src="https://i.ibb.co/jZxkCg1f/image-8.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h3 id="deployment--statefulset"&gt;Deployment &amp;amp; StatefulSet
&lt;/h3&gt;&lt;p&gt;Blue print and abstraction of pods&lt;/p&gt;
&lt;p&gt;DB canâ€™t be replicated via Deployment!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Deployment: for stateless apps&lt;/li&gt;
&lt;li&gt;StatefulSet: for stateful apps or databases (tedious)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DB are often hosted outside of k8s cluster&lt;/p&gt;
&lt;h2 id="k8s-configuration"&gt;K8s Configuration
&lt;/h2&gt;&lt;p&gt;&lt;img src="https://i.ibb.co/CpvVkxxV/image-10.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Attributes of â€™specâ€™ is specific to the kind&lt;/li&gt;
&lt;li&gt;third part â€™statusâ€™ automatically generated and added by k8s&lt;/li&gt;
&lt;li&gt;Etcd holds the current status of any k8s component&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="minikube-and-kubectl"&gt;Minikube and Kubectl
&lt;/h2&gt;&lt;p&gt;&lt;img src="https://i.ibb.co/TMnX4cwJ/image-11.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/RpSgfPGX/image-12.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/qFdWN1C6/image-13.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/ZRS0MSK3/image-14.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h3 id="practice"&gt;Practice
&lt;/h3&gt;&lt;p&gt;&lt;img src="https://i.ibb.co/8gYygnX0/image-15.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/tPHWB5s7/image-16.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/Kpmknx0R/image-17.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/7JN34Yjf/image-18.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/QF5Mkpqx/image-19.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/ynt0hLFT/image-20.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For pods, label is a required field.&lt;/li&gt;
&lt;li&gt;For others(like deployments), label is optional but a good practice.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/WqB5s75/image-21.png"
loading="lazy"
&gt;
&lt;strong&gt;selector&lt;/strong&gt;: identify which pod belonging to a deployment&lt;/p&gt;
&lt;p&gt;â€˜â€”â€™: you can have multiple yaml configurations within one file&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/6RpkKtmz/image-22.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/VYxxMmkX/image-23.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/BVJtv5XK/image-24.png"
loading="lazy"
&gt;&lt;/p&gt;</description></item></channel></rss>