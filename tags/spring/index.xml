<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Spring on é£é¸¿è¸é›ªæ³¥</title><link>https://dyhes.github.io/tags/spring/</link><description>Recent content in Spring on é£é¸¿è¸é›ªæ³¥</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 22 Oct 2025 16:27:30 +0800</lastBuildDate><atom:link href="https://dyhes.github.io/tags/spring/index.xml" rel="self" type="application/rss+xml"/><item><title>ã€NowCoderã€‘Spring 2</title><link>https://dyhes.github.io/p/nowcoderspring-2/</link><pubDate>Thu, 09 Oct 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/nowcoderspring-2/</guid><description>&lt;h2 id="beanfactorypostprocessor--beanpostprocessor"&gt;BeanFactoryPostProcessor &amp;amp; BeanPostProcessor
&lt;/h2&gt;&lt;p&gt;BeanFactoryPostProcessor å’Œ BeanPostProcessor æ˜¯ Spring æ¡†æ¶ä¸­ä¸¤ä¸ªéå¸¸é‡è¦çš„å®¹å™¨æ‰©å±•æ¥å£ï¼Œå®ƒä»¬å…è®¸ä½ åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µä»‹å…¥å¹¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚ä¸ºäº†è®©ä½ èƒ½å¿«é€ŸæŠŠæ¡å…¨è²Œï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªè¡¨æ ¼æ¥ç›´è§‚å¯¹æ¯”å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;BeanFactoryPostProcessor&lt;/th&gt;
&lt;th&gt;BeanPostProcessor&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨å¯¹è±¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Bean å·¥å‚å’Œ &lt;strong&gt;Bean å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å·²ç»å®ä¾‹åŒ–çš„ &lt;strong&gt;Bean å®ä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰§è¡Œæ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰ Bean &lt;strong&gt;å®ä¾‹åŒ–ä¹‹å‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨æ¯ä¸ª Bean &lt;strong&gt;å®ä¾‹åŒ–ä¹‹å&lt;/strong&gt;ï¼Œåˆå§‹åŒ–æ–¹æ³•å‰å&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;postProcessBeforeInitialization(Object bean, String beanName)&lt;/code&gt; &lt;code&gt;postProcessAfterInitialization(Object bean, String beanName)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹ Bean çš„å…ƒæ•°æ®ï¼ˆå¦‚å±æ€§å€¼ã€ä½œç”¨åŸŸï¼‰&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æˆ–åŒ…è£… Bean å®ä¾‹ï¼ˆå¦‚ AOP ä»£ç†ã€æ³¨è§£å¤„ç†ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å½±å“èŒƒå›´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å…¨å±€ï¼Œå½±å“ Bean çš„å®šä¹‰é˜¶æ®µ&lt;/td&gt;
&lt;td&gt;é’ˆå¯¹æ¯ä¸ª Bean çš„å®ä¾‹åŒ–é˜¶æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ·±å…¥ç†è§£-beanfactorypostprocessor"&gt;ğŸ”§ æ·±å…¥ç†è§£ BeanFactoryPostProcessor
&lt;/h3&gt;&lt;p&gt;BeanFactoryPostProcessor çš„æ ¸å¿ƒåœ¨äºå®ƒåœ¨ &lt;strong&gt;Bean å®ä¾‹åŒ–ä¹‹å‰&lt;/strong&gt; å¯¹ &lt;strong&gt;Bean å®šä¹‰ï¼ˆBeanDefinitionï¼‰&lt;/strong&gt; è¿›è¡Œå¹²é¢„ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªåœ¨è“å›¾é˜¶æ®µä¿®æ”¹å»ºç­‘è®¾è®¡çš„å·¥ç¨‹å¸ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;ï¼šå®ƒçš„ä¸»è¦èŒè´£æ˜¯è¯»å–å’Œä¿®æ”¹ Bean çš„é…ç½®å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°æ”¹å˜ä¸€ä¸ª Bean çš„ä½œç”¨åŸŸï¼ˆä»å•ä¾‹æ”¹ä¸ºåŸå‹ï¼‰ã€ä¿®æ”¹å…¶å±æ€§å€¼ï¼Œæˆ–è€…ç”šè‡³æ·»åŠ æ–°çš„å±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å±æ€§å ä½ç¬¦é…ç½®&lt;/strong&gt;ï¼šSpring å†…ç½®çš„ &lt;code&gt;PropertySourcesPlaceholderConfigurer&lt;/code&gt;å°±æ˜¯ä¸€ä¸ª &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;ï¼Œå®ƒè´Ÿè´£è§£æ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;æ–‡ä»¶ä¸­çš„ &lt;code&gt;${...}&lt;/code&gt;å ä½ç¬¦ï¼Œå¹¶ç”¨å®é™…å€¼æ›¿æ¢å®ƒä»¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®åŠ å¯†è§£å¯†&lt;/strong&gt;ï¼šå¦‚æœä½ åœ¨é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨äº†åŠ å¯†çš„æ•°æ®åº“å¯†ç ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;åœ¨å®¹å™¨å¯åŠ¨æ—¶è¿›è¡Œè§£å¯†ï¼Œå¹¶å°†è§£å¯†åçš„å€¼è®¾ç½®å› &lt;code&gt;BeanDefinition&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ·±å…¥ç†è§£-beanpostprocessor"&gt;ğŸ¯ æ·±å…¥ç†è§£ BeanPostProcessor
&lt;/h3&gt;&lt;p&gt;BeanPostProcessor åˆ™æ˜¯åœ¨ &lt;strong&gt;Bean å®ä¾‹å·²ç»åˆ›å»ºå‡ºæ¥ä¹‹å&lt;/strong&gt; è¿›è¡Œå¹²é¢„ã€‚å®ƒå°±åƒæ˜¯åœ¨äº§å“ç»„è£…çº¿ä¸Šï¼Œå¯¹å·²ç»æˆå‹çš„åŠæˆå“è¿›è¡Œæœ€ååŠ å·¥å’ŒåŒ…è£…çš„è´¨æ£€å‘˜æˆ–åŒ…è£…å·¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸æ‰§è¡Œæ—¶æœº&lt;/strong&gt;ï¼šå®ƒæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«åœ¨ Bean çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ã€&lt;code&gt;afterPropertiesSet&lt;/code&gt;ï¼‰å‰åè¢«è°ƒç”¨ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;postProcessBeforeInitialization&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨ Bean åˆå§‹åŒ–æ–¹æ³•&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;æ‰§è¡Œã€‚é€‚åˆè¿›è¡Œä¸€äº›ä¾èµ–æ£€æŸ¥æˆ–ç®€å•çš„å±æ€§è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;postProcessAfterInitialization&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨ Bean åˆå§‹åŒ–æ–¹æ³•&lt;strong&gt;ä¹‹å&lt;/strong&gt;æ‰§è¡Œã€‚è¿™æ˜¯æœ€å¸¸ç”¨ã€æœ€å¼ºå¤§çš„é˜¶æ®µï¼Œ&lt;strong&gt;Spring AOP çš„åŠ¨æ€ä»£ç†å°±æ˜¯åœ¨æ­¤å¤„åˆ›å»ºçš„&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;AOP ä»£ç†&lt;/strong&gt;ï¼šSpring æ¡†æ¶çš„ &lt;code&gt;AnnotationAwareAspectJAutoProxyCreator&lt;/code&gt;æ˜¯ä¸€ä¸ª &lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼Œå®ƒä¼šåœ¨ &lt;code&gt;postProcessAfterInitialization&lt;/code&gt;æ–¹æ³•ä¸­æ‰«æ Beanï¼Œå¦‚æœå‘ç°å®ƒéœ€è¦è¢«åˆ‡é¢å¢å¼ºï¼Œå°±ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡è¿”å›ç»™å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£å¤„ç†&lt;/strong&gt;ï¼šå¤„ç† &lt;code&gt;@Autowired&lt;/code&gt;ã€&lt;code&gt;@Value&lt;/code&gt;ç­‰æ³¨è§£çš„ &lt;code&gt;AutowiredAnnotationBeanPostProcessor&lt;/code&gt;ä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-åœ¨-bean-ç”Ÿå‘½å‘¨æœŸä¸­çš„å®Œæ•´æµç¨‹"&gt;ğŸ”„ åœ¨ Bean ç”Ÿå‘½å‘¨æœŸä¸­çš„å®Œæ•´æµç¨‹
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†è®©ä½ æ›´æ¸…æ™°åœ°ç†è§£å®ƒä»¬å¦‚ä½•åä½œï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Bean åˆ›å»ºç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[Spring å®¹å™¨å¯åŠ¨] --&amp;gt; B[åŠ è½½è§£æ BeanDefinition]
B --&amp;gt; C[æ‰§è¡Œæ‰€æœ‰ BeanFactoryPostProcessor]
C --&amp;gt; D[å®ä¾‹åŒ– Bean&amp;lt;br&amp;gt;ï¼ˆè°ƒç”¨æ„é€ å‡½æ•°ï¼‰]
D --&amp;gt; E[å±æ€§å¡«å……&amp;lt;br&amp;gt;ï¼ˆä¾èµ–æ³¨å…¥ï¼‰]
E --&amp;gt; F[æ‰§è¡Œ BeanPostProcessor&amp;lt;br&amp;gt;postProcessBeforeInitialization]
F --&amp;gt; G[æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•&amp;lt;br&amp;gt;ï¼ˆ@PostConstructç­‰ï¼‰]
G --&amp;gt; H[æ‰§è¡Œ BeanPostProcessor&amp;lt;br&amp;gt;postProcessAfterInitialization]
H --&amp;gt; I[Bean å°±ç»ªï¼Œå¯ç”¨]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å›¾ä¸­å¯ä»¥æ˜ç¡®çœ‹åˆ°ï¼Œ&lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;åœ¨å¾ˆæ—©æœŸçš„é˜¶æ®µå·¥ä½œï¼Œè€Œ &lt;code&gt;BeanPostProcessor&lt;/code&gt;åˆ™è´¯ç©¿äº† Bean å®ä¾‹åŒ–åçš„å…³é”®é˜¶æ®µã€‚&lt;/p&gt;
&lt;h3 id="-å®è·µå»ºè®®ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ’¡ å®è·µå»ºè®®ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œæ–¹å¼&lt;/strong&gt;ï¼šé€šå¸¸ä½¿ç”¨ &lt;code&gt;@Component&lt;/code&gt;æ³¨è§£å³å¯è®© Spring è‡ªåŠ¨è¯†åˆ«å¹¶æ³¨å†Œè¿™äº›å¤„ç†å™¨ã€‚ä½†å¯¹äº &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;ï¼Œç”±äºå…¶æ‰§è¡Œæ—¶æœºéå¸¸æ—©ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦é€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•é™æ€æ³¨å†Œï¼ˆä¾‹å¦‚ä½¿ç”¨ &lt;code&gt;static&lt;/code&gt;å…³é”®å­—ï¼‰ä»¥é¿å…æå‰åˆå§‹åŒ–å…¶ä»–ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼šä½ å¯ä»¥å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£æˆ–ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥æ§åˆ¶å¤šä¸ª &lt;code&gt;BeanPostProcessor&lt;/code&gt;çš„æ‰§è¡Œé¡ºåºã€‚å¯¹äº &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;ï¼Œå…¶å­æ¥å£ &lt;code&gt;BeanDefinitionRegistryPostProcessor&lt;/code&gt;æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä¼šæœ€å…ˆæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼š&lt;code&gt;BeanPostProcessor&lt;/code&gt;ä¼šä½œç”¨äºå®¹å™¨ä¸­çš„&lt;strong&gt;æ¯ä¸€ä¸ª&lt;/strong&gt; Beanã€‚å› æ­¤ï¼Œåœ¨å…¶å®ç°æ–¹æ³•ä¸­æœ€å¥½é€šè¿‡ &lt;code&gt;bean&lt;/code&gt;çš„ç±»å‹æˆ– &lt;code&gt;beanName&lt;/code&gt;è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†ï¼Œä»¥æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„å¯¹æ¯”èƒ½å¸®åŠ©ä½ æ›´æ·±å…¥åœ°ç†è§£ Spring å®¹å™¨çš„æ‰©å±•æœºåˆ¶ï¼å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“åº”ç”¨åœºæ™¯æœ‰è¿›ä¸€æ­¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="æ—¥å¿—"&gt;æ—¥å¿—
&lt;/h2&gt;&lt;p&gt;åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ—¥å¿—æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†è‹¥é…ç½®æˆ–ä½¿ç”¨ä¸å½“ï¼Œç¡®å®ä¼šå¯¹æ€§èƒ½äº§ç”Ÿæ˜¾è‘—å½±å“ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†ä¸»è¦çš„å½±å“æ–¹é¢å’Œä¼˜åŒ–æ–¹å‘ï¼Œå¸®åŠ©ä½ å¿«é€Ÿäº†è§£æ ¸å¿ƒé—®é¢˜ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å½±å“æ–¹é¢&lt;/th&gt;
&lt;th&gt;å¯¹æ€§èƒ½çš„å…·ä½“å½±å“&lt;/th&gt;
&lt;th&gt;å…³é”®çš„ä¼˜åŒ–ç­–ç•¥&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;I/O æ“ä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤§é‡çš„æ—¥å¿—å†™å…¥ä¼šé€ æˆç£ç›˜I/Oç“¶é¢ˆï¼Œå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œå¢åŠ è¯·æ±‚å“åº”æ—¶é—´ã€‚&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨å¼‚æ­¥æ—¥å¿—ã€è°ƒæ•´æ—¥å¿—çº§åˆ«ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CPU ä¸å†…å­˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¢‘ç¹çš„æ—¥å¿—æ ¼å¼åŒ–ã€å­—ç¬¦ä¸²æ‹¼æ¥å’Œå¼‚å¸¸å †æ ˆå¤„ç†ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºï¼›æ—¥å¿—ç¼“å†²ä¹Ÿå ç”¨å†…å­˜ã€‚&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨å‚æ•°åŒ–æ—¥å¿—ã€é¿å…ä¸å¿…è¦çš„å †æ ˆæ‰“å°ã€ç²¾ç®€æ—¥å¿—å†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¥å¿—çº§åˆ«ä¸æ ¼å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®¾ç½®è¿‡ä½çº§åˆ«ï¼ˆå¦‚DEBUGï¼‰ä¼šäº§ç”Ÿæµ·é‡æ—¥å¿—ï¼›å¤æ‚çš„è¾“å‡ºæ ¼å¼ï¼ˆå¦‚åŒ…å«ç±»åã€è¡Œå·ï¼‰ä¼šæå¤§å¢åŠ å¼€é”€ã€‚&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒä½¿ç”¨WARNæˆ–ERRORçº§åˆ«ã€ç®€åŒ–è¾“å‡ºæ ¼å¼ï¼ˆé¿å…%F, %L, %Mç­‰æ¨¡å¼ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä¼˜åŒ–æ—¥å¿—æ€§èƒ½çš„å®ç”¨æŠ€å·§"&gt;ğŸ’¡ ä¼˜åŒ–æ—¥å¿—æ€§èƒ½çš„å®ç”¨æŠ€å·§
&lt;/h3&gt;&lt;p&gt;äº†è§£äº†é—®é¢˜æ‰€åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä»¥ä¸‹å…·ä½“æªæ–½æ¥ä¼˜åŒ–æ—¥å¿—æ€§èƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§„èŒƒæ—¥å¿—å†™æ³•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨å‚æ•°åŒ–å ä½ç¬¦&lt;/strong&gt;ï¼šåŠ¡å¿…ä½¿ç”¨ &lt;code&gt;log.debug(&amp;quot;User id: {}&amp;quot;, userId);&lt;/code&gt;è¿™æ ·çš„æ ¼å¼ï¼Œè€Œä¸æ˜¯ &lt;code&gt;&amp;quot;User id: &amp;quot; + userId&lt;/code&gt;ã€‚å‰è€…åªæœ‰åœ¨æ—¥å¿—çº§åˆ«ç¡®éœ€è¾“å‡ºæ—¶æ‰ä¼šè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œèƒ½æœ‰æ•ˆé¿å…æ— è°“çš„æ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…æ‰“å°å¼‚å¸¸å †æ ˆ&lt;/strong&gt;ï¼šå¯¹äºå¯é¢„è§çš„ã€éæ ¸å¿ƒçš„å¼‚å¸¸ï¼ˆå¦‚å‚æ•°æ ¡éªŒå¤±è´¥ï¼‰ï¼Œå¯ä»¥è€ƒè™‘åªæ‰“å°é”™è¯¯ä¿¡æ¯è€Œéå®Œæ•´çš„å †æ ˆï¼Œå› ä¸ºç”Ÿæˆå †æ ˆä¿¡æ¯ï¼ˆå°¤å…¶æ˜¯æ¶‰åŠåå°„åŠ¨æ€ç±»æ—¶ï¼‰å¼€é”€å¾ˆå¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆç†é…ç½®æ—¥å¿—ç³»ç»Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é‡‡ç”¨å¼‚æ­¥æ—¥å¿—&lt;/strong&gt;ï¼šè¿™æ˜¯æå‡é«˜å¹¶å‘åº”ç”¨æ€§èƒ½æœ€æœ‰æ•ˆçš„æ‰‹æ®µä¹‹ä¸€ã€‚å¼‚æ­¥æ—¥å¿—å°†æ—¥å¿—å†™å…¥æ“ä½œæ”¾å…¥å•ç‹¬çš„çº¿ç¨‹é˜Ÿåˆ—ä¸­ï¼Œä¸é˜»å¡ä¸»ä¸šåŠ¡çº¿ç¨‹ã€‚ä½†éœ€æ³¨æ„ï¼Œåœ¨åº”ç”¨å¼ºåˆ¶å…³é—­æ—¶å¯èƒ½æœ‰å°‘é‡æ—¥å¿—ä¸¢å¤±çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«&lt;/strong&gt;ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒï¼Œé€šå¸¸å°†å…¨å±€æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º &lt;strong&gt;INFO&lt;/strong&gt; æˆ– &lt;strong&gt;WARN&lt;/strong&gt;ã€‚åŒæ—¶ï¼Œå¯ä»¥ç»“åˆé…ç½®ä¸­å¿ƒï¼ˆå¦‚Apolloï¼‰å®ç°ä¸åœæœºåŠ¨æ€è°ƒæ•´ç‰¹å®šç±»æˆ–åŒ…çš„æ—¥å¿—çº§åˆ«åˆ°DEBUGï¼Œä¾¿äºä¸´æ—¶æ’æŸ¥é—®é¢˜ï¼Œæ’æŸ¥å®Œåç«‹å³è°ƒå›ï¼Œé¿å…é•¿æœŸè¾“å‡ºè°ƒè¯•æ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–æ—¥å¿—è¾“å‡ºæ¨¡å¼ï¼ˆPatternï¼‰&lt;/strong&gt;ï¼šåœ¨æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­ï¼Œé¿å…ä½¿ç”¨è¯¸å¦‚ &lt;strong&gt;&lt;code&gt;%F&lt;/code&gt;ï¼ˆæ–‡ä»¶åï¼‰ã€&lt;code&gt;%L&lt;/code&gt;ï¼ˆè¡Œå·ï¼‰ã€&lt;code&gt;%M&lt;/code&gt;ï¼ˆæ–¹æ³•åï¼‰&lt;/strong&gt; è¿™ç±»éœ€è¦è§£æä½ç½®ä¿¡æ¯çš„æ¨¡å¼ç¬¦ï¼Œå› ä¸ºå®ƒä»¬ä¼šé€šè¿‡æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼æ¥è·å–ä¿¡æ¯ï¼Œæ€§èƒ½ä»£ä»·æé«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¼ºæ—¥å¿—ç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¾ç½®åˆç†çš„æ—¥å¿—æ»šåŠ¨ç­–ç•¥&lt;/strong&gt;ï¼šé…ç½®æ—¥å¿—æ–‡ä»¶çš„å¤§å°å’Œæ•°é‡ä¸Šé™ï¼Œé¿å…å•ä¸ªæ–‡ä»¶è¿‡å¤§ä¸”èƒ½è‡ªåŠ¨å½’æ¡£æ¸…ç†ï¼Œé˜²æ­¢å æ»¡ç£ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ—¥å¿—åˆ†ç±»è¾“å‡º&lt;/strong&gt;ï¼šå°†ä¸åŒæ¨¡å—æˆ–çº§åˆ«çš„æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå°†é”™è¯¯æ—¥å¿—å•ç‹¬å­˜æ”¾ï¼Œè¿™æ ·åœ¨æ’æŸ¥é—®é¢˜æ—¶æ— éœ€æ‰«æå…¨éƒ¨INFOæ—¥å¿—ï¼Œæå‡æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ ¸å¿ƒå»ºè®®æ€»ç»“"&gt;ğŸ’ æ ¸å¿ƒå»ºè®®æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ—¥å¿—æ˜¯ç³»ç»Ÿçš„â€œé»‘åŒ£å­â€ï¼Œå…³é”®åœ¨äºå¹³è¡¡å¥½&lt;strong&gt;å¯è§‚æµ‹æ€§&lt;/strong&gt;å’Œ&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘/æµ‹è¯•ç¯å¢ƒ&lt;/strong&gt;ï¼šå¯ä»¥å¼€å¯DEBUGçº§åˆ«å’Œè¯¦ç»†æ ¼å¼ï¼Œä¾¿äºè°ƒè¯•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒ&lt;/strong&gt;ï¼šåŠ¡å¿…æå‡æ—¥å¿—çº§åˆ«ï¼ˆå¦‚INFOæˆ–WARNï¼‰ï¼Œä½¿ç”¨å¼‚æ­¥æ‰“å°ï¼Œå¹¶ç®€åŒ–è¾“å‡ºæ ¼å¼ã€‚ç‰¢è®°â€œç®€å•çš„ä¸œè¥¿ + é«˜å¹¶å‘ = ä¸ç®€å•â€ï¼Œå¯¹ç”Ÿäº§ç¯å¢ƒä¿æŒæ•¬ç•ä¹‹å¿ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ä¼˜åŒ–é¡¹ç›®ä¸­çš„æ—¥å¿—é…ç½®ã€‚å¦‚æœä½ æœ‰ç‰¹å®šçš„æ—¥å¿—æ¡†æ¶ï¼ˆå¦‚Logbackæˆ–Log4j2ï¼‰æˆ–åº”ç”¨åœºæ™¯ï¼ˆå¦‚é«˜å¹¶å‘APIæœåŠ¡ï¼‰ï¼Œæˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„å»ºè®®ã€‚&lt;/p&gt;
&lt;h2 id="å•ç‹¬æ—¥å¿—çº§åˆ«"&gt;å•ç‹¬æ—¥å¿—çº§åˆ«
&lt;/h2&gt;&lt;p&gt;ä¸ºç‰¹å®šç±»è®¾ç½®å•ç‹¬çš„æ—¥å¿—çº§åˆ«æ˜¯æ—¥å¿—ç®¡ç†ä¸­çš„å¸¸è§éœ€æ±‚ï¼Œå®ƒèƒ½è®©æ‚¨åœ¨ä¸æå‡å…¨å±€æ—¥å¿—å†—é•¿åº¦çš„å‰æä¸‹ï¼Œèšç„¦äºå…³é”®æ¨¡å—çš„è¯¦ç»†è¿è¡Œæƒ…å†µã€‚å…·ä½“æ“ä½œæ–¹æ³•å–å†³äºæ‚¨ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶å’Œé…ç½®æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†åœ¨ä¸åŒé…ç½®ç¯å¢ƒä¸‹ä¸ºç‰¹å®šç±»è®¾ç½®æ—¥å¿—çº§åˆ«çš„æ ¸å¿ƒæ–¹æ³•ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ç½®ç¯å¢ƒ&lt;/th&gt;
&lt;th&gt;å…³é”®é…ç½®ç¤ºä¾‹&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring Boot (application.properties)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;logging.level.com.example.myapp.service.UserService=DEBUG&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨é…ç½®æ–‡ä»¶ä¸­ç›´æ¥æŒ‡å®šç±»çš„å…¨é™å®šåå’Œçº§åˆ«ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring Boot (application.yml)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;logging: level: com.example.myapp.service.UserService: DEBUG&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;YAMLæ ¼å¼çš„å†™æ³•ï¼Œæ•ˆæœåŒä¸Šã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Logback (logback.xml)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;lt;logger name=&amp;quot;com.example.myapp.service.UserService&amp;quot; level=&amp;quot;DEBUG&amp;quot; additivity=&amp;quot;false&amp;quot;/&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨XMLä¸­ä½¿ç”¨&lt;code&gt;&amp;lt;logger&amp;gt;&lt;/code&gt;å…ƒç´ ï¼Œ&lt;code&gt;additivity=&amp;quot;false&amp;quot;&lt;/code&gt;å¯é¿å…æ—¥å¿—é‡å¤è¾“å‡ºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Log4j2 (log4j2.properties)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;logger.mine.name = com.example.myapp.service.UserService&lt;/code&gt; &lt;code&gt;logger.mine.level = DEBUG&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨propertiesæ–‡ä»¶ä¸­å®šä¹‰å‘½åloggerå¹¶è®¾ç½®çº§åˆ«ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Log4j2 (log4j2.xml)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;lt;Logger name=&amp;quot;com.example.myapp.service.UserService&amp;quot; level=&amp;quot;DEBUG&amp;quot;/&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨XMLä¸­é…ç½®ï¼Œç±»ä¼¼äºLogbackã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ç†è§£ä¸è¿ç”¨æ—¥å¿—çº§åˆ«"&gt;ğŸ’¡ ç†è§£ä¸è¿ç”¨æ—¥å¿—çº§åˆ«
&lt;/h3&gt;&lt;p&gt;åœ¨å…·ä½“æ“ä½œå‰ï¼Œç†è§£æ—¥å¿—çº§åˆ«çš„å«ä¹‰è‡³å…³é‡è¦ã€‚æ ‡å‡†çš„æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜é€šå¸¸ä¸ºï¼š&lt;code&gt;TRACE&lt;/code&gt;&amp;lt; &lt;code&gt;DEBUG&lt;/code&gt;&amp;lt; &lt;code&gt;INFO&lt;/code&gt;&amp;lt; &lt;code&gt;WARN&lt;/code&gt;&amp;lt; &lt;code&gt;ERROR&lt;/code&gt;ã€‚ å½“æ‚¨ä¸ºä¸€ä¸ªç±»è®¾ç½®æŸä¸ªçº§åˆ«ï¼ˆä¾‹å¦‚ &lt;code&gt;DEBUG&lt;/code&gt;ï¼‰åï¼Œåªæœ‰&lt;strong&gt;è¯¥çº§åˆ«åŠæ›´é«˜çº§åˆ«&lt;/strong&gt;çš„æ—¥å¿—æ¶ˆæ¯ä¼šè¢«è®°å½•ã€‚ è¿™æ„å‘³ç€è®¾ç½®ä¸º &lt;code&gt;DEBUG&lt;/code&gt;ä¼šè¾“å‡º &lt;code&gt;DEBUG&lt;/code&gt;, &lt;code&gt;INFO&lt;/code&gt;, &lt;code&gt;WARN&lt;/code&gt;, &lt;code&gt;ERROR&lt;/code&gt;çš„æ—¥å¿—ï¼Œè€Œ &lt;code&gt;TRACE&lt;/code&gt;åˆ™ä¸ä¼šè¾“å‡ºã€‚&lt;/p&gt;
&lt;h3 id="-é…ç½®è¦ç‚¹ä¸æœ€ä½³å®è·µ"&gt;ğŸ”§ é…ç½®è¦ç‚¹ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¡®å®šç±»çš„å…¨é™å®šå&lt;/strong&gt;ï¼šé…ç½®æ—¶ï¼ŒåŠ¡å¿…ä½¿ç”¨ç±»çš„å®Œæ•´åç§°ï¼ˆåŒ…æ‹¬åŒ…è·¯å¾„ï¼‰ï¼Œä¾‹å¦‚ &lt;code&gt;com.example.mypackage.MyClass&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è§£ &lt;code&gt;additivity&lt;/code&gt;å±æ€§ï¼ˆLogbackï¼‰&lt;/strong&gt;ï¼šåœ¨Logbackçš„ &lt;code&gt;&amp;lt;logger&amp;gt;&lt;/code&gt;é…ç½®ä¸­ï¼Œ&lt;code&gt;additivity=&amp;quot;false&amp;quot;&lt;/code&gt;è¡¨ç¤ºè¯¥loggerçš„æ—¥å¿—ä¸ä¼šä¼ é€’ç»™çˆ¶loggerï¼ˆå¦‚æ ¹loggerï¼‰ï¼Œå¸¸ç”¨äºé¿å…æ—¥å¿—è¢«é‡å¤è®°å½•åˆ°ä¸åŒçš„è¾“å‡ºç›®æ ‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è°ƒæ•´å¯èƒ½æ€§&lt;/strong&gt;ï¼šåœ¨ä¸€äº›é«˜çº§åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹ç‰¹å®šç±»çš„æ—¥å¿—çº§åˆ«ï¼Œè¿™ä¸ºçº¿ä¸Šé—®é¢˜è¯Šæ–­æä¾›äº†æå¤§ä¾¿åˆ©ï¼Œè€Œæ— éœ€é‡å¯åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒåŒºåˆ†&lt;/strong&gt;ï¼šåœ¨å¼€å‘ç¯å¢ƒï¼Œæ‚¨å¯èƒ½ä¼šä¸ºå¾ˆå¤šç±»å¼€å¯ &lt;code&gt;DEBUG&lt;/code&gt;çº§åˆ«ä»¥ä¾¿è°ƒè¯•ï¼›ä½†åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œä¸ºäº†æ€§èƒ½å’Œå­˜å‚¨è€ƒè™‘ï¼Œé€šå¸¸åªå¯¹å…³é”®ç»„ä»¶æˆ–æ­£åœ¨æ’æŸ¥é—®é¢˜çš„æ¨¡å—å¼€å¯è¯¦ç»†æ—¥å¿—ï¼Œå…¨å±€çº§åˆ«å»ºè®®è®¾ç½®ä¸º &lt;code&gt;INFO&lt;/code&gt;æˆ– &lt;code&gt;WARN&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©æ‚¨ç²¾å‡†åœ°æ§åˆ¶é¡¹ç›®ä¸­çš„æ—¥å¿—è¾“å‡ºã€‚å¦‚æœæ‚¨æœ‰ç‰¹å®šçš„æ—¥å¿—æ¡†æ¶ï¼ˆå¦‚Logbackæˆ–Log4j2ï¼‰æˆ–æ›´å¤æ‚çš„åœºæ™¯éœ€æ±‚ï¼Œæˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;h2 id="n1-é—®é¢˜"&gt;N+1 é—®é¢˜
&lt;/h2&gt;&lt;p&gt;Spring Data JPA ä¸­çš„ N+1 é—®é¢˜æ˜¯å¼€å‘ä¸­ä¸€ä¸ªéå¸¸å…¸å‹çš„æ€§èƒ½ç“¶é¢ˆï¼Œç®€å•ç†è§£å°±æ˜¯&lt;strong&gt;ä½ æƒ³è·å–1æ‰¹æ•°æ®ï¼Œä½†æ¡†æ¶å´åœ¨å®é™…æ‰§è¡Œäº†1æ¬¡ä¸»æŸ¥è¯¢åï¼Œåˆé¢å¤–æ‰§è¡Œäº†Næ¬¡å…³è”æŸ¥è¯¢&lt;/strong&gt;ã€‚è¿™ä¼šæ˜¾è‘—å¢åŠ æ•°æ®åº“å‹åŠ›ï¼Œå¯¼è‡´åº”ç”¨å“åº”å˜æ…¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢é€šè¿‡ä¸€ä¸ªå¯¹æ¯”å›¾ï¼Œè®©ä½ å¿«é€Ÿäº†è§£N+1é—®é¢˜çš„æ ¸å¿ƒè§£å†³æ€è·¯ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[åº”ç”¨ç¨‹åºæŸ¥è¯¢æ•°æ®] --&amp;gt; B{é€‰æ‹©å“ªç§åŠ è½½æ–¹å¼ï¼Ÿ}
B --&amp;gt; C[æ‡’åŠ è½½ï¼ˆLazyï¼‰]
B --&amp;gt; D[é¢„åŠ è½½&amp;lt;br&amp;gt;ï¼ˆEager Loading / JOIN FETCHï¼‰]
C --&amp;gt; E[é¦–æ¬¡æŸ¥è¯¢ä»…åŠ è½½ä¸»å®ä½“]
E --&amp;gt; F[ä»£ç è®¿é—®å…³è”å¯¹è±¡æ—¶&amp;lt;br&amp;gt;ï¼ˆä¾‹å¦‚å¾ªç¯ä¸­ï¼‰]
F --&amp;gt; G[è§¦å‘Næ¬¡é¢å¤–æŸ¥è¯¢&amp;lt;br&amp;gt;ï¼ˆN+1é—®é¢˜ï¼‰]
D --&amp;gt; H[é€šè¿‡JOINç­‰å•æ¬¡æŸ¥è¯¢&amp;lt;br&amp;gt;åŠ è½½ä¸»å®ä½“åŠå…³è”æ•°æ®]
H --&amp;gt; I[å…³è”æ•°æ®å·²å°±ç»ªï¼Œæ— é¢å¤–æŸ¥è¯¢]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºäº†å¸®ä½ å½»åº•ç†è§£å¹¶è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°†ä»é—®é¢˜æœ¬è´¨ã€è§£å†³æ–¹æ¡ˆåˆ°æœ€ä½³å®è·µè¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚&lt;/p&gt;
&lt;h3 id="-ç†è§£n1é—®é¢˜çš„æœ¬è´¨"&gt;ğŸ” ç†è§£N+1é—®é¢˜çš„æœ¬è´¨
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯N+1é—®é¢˜ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ä½ ä½¿ç”¨Spring Data JPAçš„é»˜è®¤æ–¹æ³•ï¼ˆå¦‚&lt;code&gt;findAll()&lt;/code&gt;ï¼‰æŸ¥è¯¢ä¸€ä¸ªå®ä½“ï¼ˆä¾‹å¦‚&lt;code&gt;User&lt;/code&gt;ï¼‰æ—¶ï¼ŒORMä¼šå…ˆæ‰§è¡Œ1æ¡SQLï¼ˆ&lt;code&gt;SELECT * FROM user&lt;/code&gt;ï¼‰è·å–æ‰€æœ‰ç”¨æˆ·ã€‚å¦‚æœ&lt;code&gt;User&lt;/code&gt;å®ä½“æœ‰å…³è”é›†åˆï¼ˆæ¯”å¦‚&lt;code&gt;roles&lt;/code&gt;ï¼‰ï¼Œå¹¶ä¸”ä½ &lt;strong&gt;åœ¨ä»£ç ä¸­è®¿é—®äº†è¿™ä¸ªé›†åˆ&lt;/strong&gt;ï¼ŒJPAå°±ä¼šä¸ºæ¯ä¸ªç”¨æˆ·ï¼ˆNä¸ªï¼‰å†æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è§’è‰²çš„SQLï¼ˆ&lt;code&gt;SELECT * FROM user_roles WHERE user_id = ?&lt;/code&gt;ï¼‰ã€‚æ€»å…±äº§ç”Ÿ &lt;strong&gt;1ï¼ˆæŸ¥è¯¢ç”¨æˆ·ï¼‰ + Nï¼ˆæŸ¥è¯¢æ¯ä¸ªç”¨æˆ·çš„è§’è‰²ï¼‰&lt;/strong&gt; æ¬¡æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸»è¦æºäºJPAçš„&lt;strong&gt;å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰&lt;/strong&gt; æœºåˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;@OneToMany&lt;/code&gt;ç­‰å…³è”å…³ç³»æ˜¯æ‡’åŠ è½½çš„ã€‚è¿™æ„å‘³ç€æŸ¥è¯¢ä¸»å®ä½“æ—¶ï¼Œå…³è”æ•°æ®ä¸ä¼šç«‹å³åŠ è½½ï¼Œåªæœ‰åœ¨ä»£ç çœŸæ­£è®¿é—®å®ƒæ—¶ï¼ˆå¦‚è°ƒç”¨&lt;code&gt;user.getRoles().size()&lt;/code&gt;ï¼‰ï¼Œæ‰ä¼šè§¦å‘é¢å¤–çš„æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚ä½•è¯†åˆ«N+1é—®é¢˜ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨SQLæ—¥å¿—&lt;/strong&gt;ï¼šåœ¨&lt;code&gt;application.yml&lt;/code&gt;ä¸­è®¾ç½®&lt;code&gt;spring.jpa.show-sql=true&lt;/code&gt;ã€‚å¦‚æœä½ åœ¨æ—¥å¿—ä¸­çœ‹åˆ°1æ¡ä¸»æŸ¥è¯¢åï¼Œè·Ÿç€å¤§é‡ç»“æ„ç›¸ä¼¼çš„å…³è”æŸ¥è¯¢ï¼Œå¾ˆå¯èƒ½å°±é‡åˆ°äº†N+1é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨æ€§èƒ½ç›‘æ§å·¥å…·&lt;/strong&gt;ï¼šåƒHibernate Statisticsæˆ–APMå·¥å…·å¯ä»¥å¸®åŠ©åˆ†ææŸ¥è¯¢æ¬¡æ•°å’Œæ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä¸»è¦è§£å†³æ–¹æ¡ˆä¸ä»£ç ç¤ºä¾‹"&gt;ğŸ› ï¸ ä¸»è¦è§£å†³æ–¹æ¡ˆä¸ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;è§£å†³N+1é—®é¢˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š&lt;strong&gt;åœ¨æŸ¥è¯¢ä¸»å®ä½“æ—¶ï¼Œé€šè¿‡å•æ¬¡SQLè¿æ¥æŸ¥è¯¢ï¼Œä¸€æ¬¡æ€§å°†æ‰€éœ€çš„å…³è”æ•°æ®åŠ è½½è¿›æ¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id="1-ä½¿ç”¨-join-fetchæ˜¾å¼è¿æ¥è·å–"&gt;1. ä½¿ç”¨ &lt;code&gt;JOIN FETCH&lt;/code&gt;ï¼ˆæ˜¾å¼è¿æ¥è·å–ï¼‰
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯æœ€ç›´æ¥å’Œé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡åœ¨è‡ªå®šä¹‰çš„JPQLæŸ¥è¯¢ä¸­ç›´æ¥ä½¿ç”¨&lt;code&gt;JOIN FETCH&lt;/code&gt;ï¼Œå¯ä»¥å¼ºåˆ¶Hibernateåœ¨å•æ¡SQLä¸­å®Œæˆæ‰€æœ‰æ•°æ®çš„åŠ è½½ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åœ¨Repositoryä¸­å®šä¹‰è‡ªå®šä¹‰æŸ¥è¯¢
public interface UserRepository extends JpaRepository&amp;lt;User, Long&amp;gt; {
@Query(&amp;#34;SELECT u FROM User u JOIN FETCH u.roles&amp;#34;)
List&amp;lt;User&amp;gt; findAllWithRoles();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šæ€§èƒ½æœ€å¥½ï¼Œä¸€æ¡SQLæå®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¦‚æœå…³è”å±‚æ¬¡è¿‡æ·±ï¼Œå¯èƒ½å¯¼è‡´ç»“æœé›†è†¨èƒ€ï¼ˆç¬›å¡å°”ç§¯ï¼‰ã€‚å¯¹äºåˆ†é¡µæŸ¥è¯¢éœ€è¦é¢å¤–å¤„ç†ã€‚&lt;/p&gt;
&lt;h4 id="2-ä½¿ç”¨-entitygraphå®ä½“å›¾"&gt;2. ä½¿ç”¨ &lt;code&gt;@EntityGraph&lt;/code&gt;ï¼ˆå®ä½“å›¾ï¼‰
&lt;/h4&gt;&lt;p&gt;Entity Graphæä¾›äº†ä¸€ç§æ›´å£°æ˜å¼çš„æ–¹æ³•æ¥æŒ‡å®šåœ¨æŸ¥è¯¢ä¸­éœ€è¦å³æ—¶åŠ è½½å“ªäº›å…³è”å±æ€§ï¼Œæ— éœ€ç¼–å†™JPQLã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// é¦–å…ˆï¼Œåœ¨å®ä½“ç±»ä¸Šå®šä¹‰å‘½åå®ä½“å›¾
@Entity
@NamedEntityGraph(name = &amp;#34;User.withRoles&amp;#34;, attributeNodes = @NamedAttributeNode(&amp;#34;roles&amp;#34;))
public class User {
// ... å®ä½“å­—æ®µ
}
// ç„¶ååœ¨Repositoryä¸­ä½¿ç”¨
public interface UserRepository extends JpaRepository&amp;lt;User, Long&amp;gt; {
@EntityGraph(value = &amp;#34;User.withRoles&amp;#34;, type = EntityGraph.EntityGraphType.FETCH)
List&amp;lt;User&amp;gt; findAll();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šä»£ç ç®€æ´ï¼Œä¸Spring Data JPAåŸç”Ÿæ–¹æ³•ç»“åˆæ€§å¥½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šåº•å±‚ä¹Ÿæ˜¯ç”Ÿæˆ&lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;ï¼Œå¯èƒ½æ¯”&lt;code&gt;JOIN FETCH&lt;/code&gt;æ•ˆç‡ç•¥ä½ï¼Œä¸”åŒæ ·éœ€è¦æ³¨æ„æ·±å±‚æ¬¡å…³è”çš„æ•°æ®é‡ã€‚&lt;/p&gt;
&lt;h4 id="3-ä½¿ç”¨æŠ•å½±dtoæŠ•å½±"&gt;3. ä½¿ç”¨æŠ•å½±ï¼ˆDTOæŠ•å½±ï¼‰
&lt;/h4&gt;&lt;p&gt;è¿™ç§æ–¹æ³•ä¸ç›´æ¥è¿”å›å®Œæ•´çš„å®ä½“å¯¹è±¡ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªåªåŒ…å«æ‰€éœ€å­—æ®µçš„å®šåˆ¶åŒ–DTOï¼ˆData Transfer Objectï¼‰ã€‚è¿™ä¸ä»…èƒ½é¿å…N+1é—®é¢˜ï¼Œè¿˜èƒ½å‡å°‘æ•°æ®ä¼ è¾“é‡ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å®šä¹‰DTOæ¥å£æˆ–ç±»
public interface UserWithRoleCount {
String getName();
Integer getRoleCount(); // é€šè¿‡è¡¨è¾¾å¼è®¡ç®—ï¼Œé¿å…åŠ è½½æ•´ä¸ªé›†åˆ
}
// åœ¨Repositoryä¸­
public interface UserRepository extends JpaRepository&amp;lt;User, Long&amp;gt; {
@Query(&amp;#34;SELECT u.name as name, SIZE(u.roles) as roleCount FROM User u&amp;#34;)
List&amp;lt;UserWithRoleCount&amp;gt; findUserWithRoleCount();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šé«˜åº¦çµæ´»ï¼Œæ€§èƒ½æä½³ï¼Œå°¤å…¶é€‚åˆåˆ—è¡¨å±•ç¤ºåœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šéœ€è¦é¢å¤–å®šä¹‰DTOç±»ï¼›è¿”å›çš„å¯¹è±¡ä¸æ˜¯è¢«ç®¡ç†çš„å®ä½“ï¼Œä¸èƒ½ç›´æ¥ç”¨äºæ›´æ–°æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id="-æœ€ä½³å®è·µä¸é€‰å‹å»ºè®®"&gt;ğŸ’¡ æœ€ä½³å®è·µä¸é€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ¨èæ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;ç†ç”±&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç®€å•å…³è”ï¼Œéœ€è¦å®Œæ•´å®ä½“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JOIN FETCH&lt;/code&gt;æˆ– &lt;code&gt;@EntityGraph&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥é«˜æ•ˆï¼Œèƒ½å……åˆ†åˆ©ç”¨ORMç‰¹æ€§ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤æ‚å…³è”ï¼Œæˆ–åªéœ€éƒ¨åˆ†å­—æ®µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;DTOæŠ•å½±&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…ä¸å¿…è¦çš„æ•°æ®åŠ è½½å’Œä¼ è¾“ï¼Œæ€§èƒ½æœ€ä¼˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç»“åˆåˆ†é¡µçš„&lt;code&gt;JOIN FETCH&lt;/code&gt;&lt;/strong&gt; æˆ– &lt;strong&gt;æ‰¹é‡æŸ¥è¯¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆå¦‚å…ˆåˆ†é¡µæŸ¥IDï¼Œå†&lt;code&gt;JOIN FETCH&lt;/code&gt;ï¼‰ï¼Œé¿å…&lt;code&gt;JOIN&lt;/code&gt;å¯¼è‡´åˆ†é¡µä¸å‡†ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;é‡è¦çš„è¯¯åŒºæ¾„æ¸…&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å°†å…³è”çš„è·å–ç­–ç•¥ä»&lt;code&gt;LAZY&lt;/code&gt;æ”¹ä¸º&lt;code&gt;EAGER&lt;/code&gt;&lt;strong&gt;å¹¶ä¸èƒ½&lt;/strong&gt;è§£å†³N+1é—®é¢˜ï¼å®ƒåªä¼šæ”¹å˜é—®é¢˜è§¦å‘çš„æ—¶æœºï¼ˆä»è®¿é—®æ—¶æå‰åˆ°æŸ¥è¯¢æ—¶ï¼‰ï¼ŒHibernateä¾ç„¶å¯èƒ½ä½¿ç”¨N+1æ¡&lt;code&gt;SELECT&lt;/code&gt;è¯­å¥æ¥åŠ è½½æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¡&lt;code&gt;JOIN&lt;/code&gt;è¯­å¥ã€‚&lt;/p&gt;
&lt;h3 id="-å…¶ä»–æ³¨æ„äº‹é¡¹"&gt;âš ï¸ å…¶ä»–æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®é‡å¤é—®é¢˜&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;JOIN&lt;/code&gt;æ—¶ï¼Œå¦‚æœä¸»å®ä½“ï¼ˆå¦‚&lt;code&gt;User&lt;/code&gt;ï¼‰åœ¨å…³è”è¡¨ï¼ˆå¦‚&lt;code&gt;roles&lt;/code&gt;ï¼‰ä¸­æœ‰å¤šæ¡è®°å½•ï¼Œä¼šå¯¼è‡´ä¸»å®ä½“é‡å¤ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨&lt;code&gt;DISTINCT&lt;/code&gt;å…³é”®å­—ï¼Œå¦‚&lt;code&gt;SELECT DISTINCT u FROM User u JOIN FETCH u.roles&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦è¿‡åº¦ä¼˜åŒ–&lt;/strong&gt;ï¼šå¹¶éæ‰€æœ‰N+1æƒ…å†µéƒ½æ˜¯é—®é¢˜ã€‚å¦‚æœä¸šåŠ¡ä¸Šç¡®å®š&lt;code&gt;N&lt;/code&gt;å¾ˆå°ï¼ˆæ¯”å¦‚æœ€å¤šä¸º3ï¼‰ï¼Œä¸”åç»­ä¸ä¸€å®šä¼šè®¿é—®å…³è”æ•°æ®ï¼Œé‚£ä¹ˆå»¶è¿ŸåŠ è½½åè€Œæ˜¯æ›´åˆç†çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£é‡Šå’Œæ–¹æ¡ˆèƒ½å¸®åŠ©ä½ å½»åº•è§£å†³Spring Data JPAä¸­çš„N+1é—®é¢˜ã€‚å¦‚æœä½ æœ‰ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ¢è®¨æ›´å…·ä½“çš„ä¼˜åŒ–ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id="join-fetch"&gt;JOIN FETCH
&lt;/h2&gt;&lt;p&gt;è§£å†³ JPA çš„ N+1 æŸ¥è¯¢é—®é¢˜æœ‰å¤šç§æˆç†Ÿæ–¹æ¡ˆï¼Œæ ¸å¿ƒæ€è·¯éƒ½æ˜¯&lt;strong&gt;å‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°&lt;/strong&gt;ã€‚ä¸‹è¡¨å¯¹æ¯”äº†å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è§£å†³æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒæœºåˆ¶&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;å…³é”®ä¼˜åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;JOIN FETCH&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡å•æ¡ SQL &lt;strong&gt;è¿æ¥æŸ¥è¯¢&lt;/strong&gt;ä¸€æ¬¡æ€§åŠ è½½ä¸»å®ä½“ä¸å…³è”å®ä½“&lt;/td&gt;
&lt;td&gt;æ˜ç¡®éœ€è¦ç«‹å³ä½¿ç”¨å…³è”æ•°æ®çš„åœºæ™¯ï¼ˆå¦‚è¯¦æƒ…é¡µï¼‰&lt;/td&gt;
&lt;td&gt;æ€§èƒ½æœ€ä¼˜ï¼Œä¸€æ¡æŸ¥è¯¢æå®š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@EntityGraph&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜å¼åœ°æŒ‡å®šéœ€è¦&lt;strong&gt;ç«‹å³åŠ è½½&lt;/strong&gt;çš„å…³è”è·¯å¾„&lt;/td&gt;
&lt;td&gt;å¸Œæœ›ä¸ Spring Data JPA åŸç”Ÿæ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;findAll()&lt;/code&gt;ï¼‰ç»“åˆä½¿ç”¨çš„åœºæ™¯&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€æ´ï¼Œé›†æˆåº¦é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰¹é‡åŠ è½½ (&lt;code&gt;@BatchSize&lt;/code&gt;)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å°† N æ¬¡æŸ¥è¯¢è½¬æ¢ä¸º **&lt;code&gt;N / batch_size&lt;/code&gt;+ 1&lt;code&gt;** æ¬¡æŸ¥è¯¢ï¼Œé€šè¿‡&lt;/code&gt;IN` å­å¥æ‰¹é‡åŠ è½½&lt;/td&gt;
&lt;td&gt;å…³è”é›†åˆè¾ƒå¤§æˆ–ä¸ç¡®å®šæ˜¯å¦éœ€è¦ç«‹å³åŠ è½½çš„åœºæ™¯&lt;/td&gt;
&lt;td&gt;çµæ´»ï¼Œæœ‰æ•ˆå¹³è¡¡å»¶è¿ŸåŠ è½½ä¸æ€§èƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­æŸ¥è¯¢åŠ è½½ (&lt;code&gt;@Fetch(FetchMode.SUBSELECT)&lt;/code&gt;)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨è®¿é—®æ‡’åŠ è½½é›†åˆæ—¶ï¼Œä½¿ç”¨ä¸€æ¡&lt;strong&gt;å­æŸ¥è¯¢&lt;/strong&gt;åŠ è½½æ‰€æœ‰å…³è”æ•°æ®&lt;/td&gt;
&lt;td&gt;éœ€è¦å®Œæ•´åŠ è½½æ‰€æœ‰ä¸»å®ä½“çš„å…³è”é›†åˆæ—¶&lt;/td&gt;
&lt;td&gt;å°† N æ¬¡æŸ¥è¯¢å‡å°‘ä¸º 2 æ¬¡ï¼ˆä¸»æŸ¥è¯¢ + å­æŸ¥è¯¢ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;DTO æŠ•å½±&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸è¿”å›å®Œæ•´å®ä½“ï¼ŒåªæŸ¥è¯¢&lt;strong&gt;éœ€è¦çš„å­—æ®µ&lt;/strong&gt;åˆ°è‡ªå®šä¹‰çš„ DTO ä¸­&lt;/td&gt;
&lt;td&gt;åˆ—è¡¨å±•ç¤ºç­‰åªéœ€éƒ¨åˆ†å­—æ®µçš„åœºæ™¯ï¼Œå¯ä»æ ¹æœ¬ä¸Šé¿å…åŠ è½½æ— å…³å…³è”&lt;/td&gt;
&lt;td&gt;å‡å°‘æ•°æ®ä¼ è¾“é‡ï¼ŒæŸ¥è¯¢é«˜æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©è§£å†³æ–¹æ¡ˆ"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å“ªç§æ–¹æ¡ˆå–å†³äºä½ çš„å…·ä½“ä¸šåŠ¡éœ€æ±‚å’Œæ•°æ®è®¿é—®æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¡®çŸ¥éœ€è¦å®Œæ•´å…³è”æ•°æ®æ—¶&lt;/strong&gt;ï¼šä¼˜å…ˆè€ƒè™‘ &lt;strong&gt;&lt;code&gt;JOIN FETCH&lt;/code&gt;&lt;/strong&gt; æˆ– &lt;strong&gt;&lt;code&gt;@EntityGraph&lt;/code&gt;&lt;/strong&gt;ã€‚å®ƒä»¬èƒ½é€šè¿‡å•æ¬¡è¿æ¥æŸ¥è¯¢é«˜æ•ˆè·å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸ¥çœ‹è®¢å•è¯¦æƒ…æ—¶ï¼Œéœ€è¦åŒæ—¶å±•ç¤ºè®¢å•é¡¹å’Œå•†å“ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ç¡®å®šæˆ–ä¸éœ€è¦ç«‹å³ä½¿ç”¨å…³è”æ•°æ®æ—¶&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;strong&gt;æ‰¹é‡åŠ è½½ï¼ˆ&lt;code&gt;@BatchSize&lt;/code&gt;ï¼‰&lt;/strong&gt; æ˜¯å¾ˆå¥½çš„å¹³è¡¡é€‰æ‹©ã€‚å®ƒä¿æŒäº†æ‡’åŠ è½½çš„çµæ´»æ€§ï¼Œåˆåœ¨éœ€è¦åŠ è½½æ—¶å°†å¤šæ¬¡æŸ¥è¯¢åˆå¹¶ä¸ºå°‘é‡æŸ¥è¯¢ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åªéœ€éƒ¨åˆ†å­—æ®µæ—¶&lt;/strong&gt;ï¼š&lt;strong&gt;DTO æŠ•å½±&lt;/strong&gt;æ˜¯æœ€ä½³é€‰æ‹©ï¼Œå®ƒé¿å…äº†åŠ è½½æ•´ä¸ªå®ä½“å¯¹è±¡åŠå…¶å…³è”å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†å¤§å‹æ•°æ®é›†æ—¶&lt;/strong&gt;ï¼šç»“åˆ&lt;strong&gt;åˆ†é¡µæŸ¥è¯¢&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;Pageable&lt;/code&gt;ï¼‰ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶å•æ¬¡æŸ¥è¯¢åŠ è½½çš„æ•°æ®é‡ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-é‡è¦æé†’ä¸æœ€ä½³å®è·µ"&gt;âš ï¸ é‡è¦æé†’ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;JOIN FETCH&lt;/code&gt;ä¸åˆ†é¡µçš„æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼šå¯¹ä½¿ç”¨äº† &lt;code&gt;JOIN FETCH&lt;/code&gt;çš„æŸ¥è¯¢è¿›è¡Œåˆ†é¡µå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚å› ä¸º &lt;code&gt;JOIN&lt;/code&gt;ä¼šå¯¼è‡´ç»“æœé›†è¡Œæ•°è†¨èƒ€ï¼ˆç¬›å¡å°”ç§¯ï¼‰ï¼Œæ•°æ®åº“å±‚é¢çš„åˆ†é¡µå¯èƒ½ä¸å‡†ç¡®ã€‚å¯¹äºéœ€è¦åˆ†é¡µçš„åˆ—è¡¨æŸ¥è¯¢ï¼Œä¸€ä¸ªå¸¸è§çš„ç­–ç•¥æ˜¯å…ˆåˆ†é¡µæŸ¥è¯¢ä¸»å®ä½“çš„ IDï¼Œå†æ ¹æ® ID åˆ—è¡¨ä½¿ç”¨ &lt;code&gt;JOIN FETCH&lt;/code&gt;æŸ¥è¯¢å®Œæ•´æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦è·å–&lt;/strong&gt;ï¼š&lt;code&gt;JOIN FETCH&lt;/code&gt;å’Œ &lt;code&gt;@EntityGraph&lt;/code&gt;ä¼šåŠ è½½å…³è”å®ä½“çš„æ‰€æœ‰å­—æ®µã€‚å¦‚æœå…³è”å®ä½“éå¸¸åºå¤§ï¼Œè€Œä½ åªéœ€è¦å…¶ä¸­å‡ ä¸ªå­—æ®µï¼Œå¯èƒ½ä¼šé€ æˆä¸å¿…è¦çš„æ•°æ®ä¼ è¾“ã€‚æ­¤æ—¶ï¼ŒDTO æŠ•å½±å¯èƒ½æ˜¯æ›´é«˜æ•ˆçš„æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦æ··æ·† &lt;code&gt;FetchType.EAGER&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨å®ä½“ç±»çš„å…³è”å­—æ®µä¸Šè®¾ç½® &lt;code&gt;@OneToMany(fetch = FetchType.EAGER)&lt;/code&gt;&lt;strong&gt;å¹¶ä¸èƒ½&lt;/strong&gt;ä¿è¯ä½¿ç”¨ &lt;code&gt;JOIN&lt;/code&gt;æŸ¥è¯¢ã€‚Hibernate å¯èƒ½ä»ç„¶ä½¿ç”¨é¢å¤–çš„ &lt;code&gt;SELECT&lt;/code&gt;è¯­å¥æ¥åŠ è½½æ•°æ®ï¼Œè¿™æœ¬è´¨ä¸Šè¿˜æ˜¯ N+1 é—®é¢˜ã€‚&lt;code&gt;JOIN FETCH&lt;/code&gt;å’Œ &lt;code&gt;@EntityGraph&lt;/code&gt;æ˜¯åœ¨æŸ¥è¯¢å±‚é¢ç»™å‡ºçš„æ˜ç¡®æŒ‡ä»¤ï¼Œæ˜¯æ›´å¯æ§çš„ä¼˜åŒ–æ‰‹æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨ SQL æ—¥å¿—&lt;/strong&gt;ï¼šåœ¨å¼€å‘é˜¶æ®µï¼Œå¼€å¯ JPA çš„ SQL æ—¥å¿—è¾“å‡ºï¼ˆå¦‚ &lt;code&gt;spring.jpa.show-sql=true&lt;/code&gt;ï¼‰æ˜¯å‘ç°å’Œè¯Šæ–­ N+1 é—®é¢˜çš„æœ€ç›´æ¥æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„æ–¹æ¡ˆæ±‡æ€»èƒ½å¸®åŠ©ä½ æœ‰æ•ˆåœ°è§£å†³ JPA å¼€å‘ä¸­çš„ N+1 æŸ¥è¯¢é—®é¢˜ã€‚å¦‚æœä½ æœ‰ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ¢è®¨æ›´å…·ä½“çš„ä¼˜åŒ–ç­–ç•¥ã€‚&lt;/p&gt;</description></item><item><title>ã€NowCoderã€‘Spring</title><link>https://dyhes.github.io/p/nowcoderspring/</link><pubDate>Thu, 11 Sep 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/nowcoderspring/</guid><description>&lt;h2 id="conditional"&gt;@Conditional
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œä½ è¯´çš„æ²¡é”™ã€‚&lt;strong&gt;&lt;code&gt;@Conditional&lt;/code&gt;æ³¨è§£æœ¬èº«å±äº Spring Framework&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯ Spring Bootã€‚å®ƒæ˜¯åœ¨ Spring Framework 4.0 ç‰ˆæœ¬ä¸­å¼•å…¥çš„æ ¸å¿ƒåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®ä½ æ›´æ¸…æ™°åœ°ç†è§£å®ƒä»¬çš„å…³ç³»å’ŒåŒºåˆ«ï¼Œæˆ‘å‡†å¤‡äº†ä¸€ä¸ªè¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;Spring Framework çš„ &lt;code&gt;@Conditional&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;Spring Boot çš„æ¡ä»¶æ³¨è§£ (å¦‚ &lt;code&gt;@ConditionalOnClass&lt;/code&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Framework (&lt;code&gt;org.springframework.context.annotation&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;Spring Boot (&lt;code&gt;org.springframework.boot.autoconfigure.condition&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€å®ç° &lt;code&gt;Condition&lt;/code&gt;æ¥å£ï¼Œåœ¨ &lt;code&gt;matches&lt;/code&gt;æ–¹æ³•ä¸­ç¼–å†™è‡ªå®šä¹‰æ¡ä»¶åˆ¤æ–­é€»è¾‘&lt;/td&gt;
&lt;td&gt;å·²å°è£…å¥½å¸¸è§æ¡ä»¶çš„åˆ¤æ–­é€»è¾‘ï¼Œå¼€ç®±å³ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æé«˜ï¼Œå¯å®ç°ä»»ä½•å¤æ‚æ¡ä»¶&lt;/td&gt;
&lt;td&gt;é’ˆå¯¹å¸¸è§åœºæ™¯ï¼Œçµæ´»æ€§ä¸å¦‚è‡ªå®šä¹‰ï¼Œä½†æ›´æ–¹ä¾¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è§£å†³æ¡†æ¶å±‚é¢çš„æ¡ä»¶åŒ–è£…é…é—®é¢˜&lt;/td&gt;
&lt;td&gt;ç®€åŒ– Spring Boot åº”ç”¨çš„è‡ªåŠ¨é…ç½®ï¼Œå®ç°â€œçº¦å®šä¼˜äºé…ç½®â€å’Œæ¨¡å—åŒ–åŠ è½½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜“ç”¨æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›¸å¯¹è¾ƒä½ï¼Œéœ€ç¼–å†™ä»£ç &lt;/td&gt;
&lt;td&gt;é«˜ï¼Œé€šå¸¸åªéœ€å‡ ä¸ªå±æ€§å³å¯å®Œæˆæ¡ä»¶å£°æ˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-spring-boot-çš„æ¡ä»¶æ³¨è§£"&gt;ğŸ› ï¸ Spring Boot çš„æ¡ä»¶æ³¨è§£
&lt;/h3&gt;&lt;p&gt;Spring Boot åœ¨ &lt;code&gt;@Conditional&lt;/code&gt;çš„åŸºç¡€ä¸Šï¼Œä¸º&lt;strong&gt;å¸¸è§çš„æ¡ä»¶åŒ–åœºæ™¯&lt;/strong&gt;æä¾›äº†ä¸€ç³»åˆ—å¼€ç®±å³ç”¨çš„æ´¾ç”Ÿæ³¨è§£ï¼Œå®ƒä»¬ä½äº &lt;code&gt;org.springframework.boot.autoconfigure.condition&lt;/code&gt;åŒ…ä¸‹ã€‚è¿™äº›æ³¨è§£æå¤§åœ°ç®€åŒ–äº†è‡ªåŠ¨é…ç½®çš„ç¼–å†™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;&lt;/strong&gt;ï¼šå½“ç±»è·¯å¾„ä¸‹å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;&lt;/strong&gt;ï¼šå½“å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„ Bean æ—¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnProperty&lt;/code&gt;&lt;/strong&gt;ï¼šå½“æŒ‡å®šçš„é…ç½®å±æ€§æ»¡è¶³è¦æ±‚æ—¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;&lt;/strong&gt;ï¼šå½“åº”ç”¨æ˜¯ä¸€ä¸ª Web åº”ç”¨æ—¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnExpression&lt;/code&gt;&lt;/strong&gt;ï¼šå½“ SpEL è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º &lt;code&gt;true&lt;/code&gt;æ—¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥æŠŠè¿™äº› Spring Boot æ¡ä»¶æ³¨è§£ç†è§£ä¸º &lt;strong&gt;&lt;code&gt;@Conditional&lt;/code&gt;çš„â€œè¯­æ³•ç³–â€æˆ–ç‰¹å®šå®ç°&lt;/strong&gt;ã€‚å®ƒä»¬çš„åº•å±‚ä¾ç„¶ä¾èµ–äº Spring Framework çš„ &lt;code&gt;@Conditional&lt;/code&gt;æœºåˆ¶ï¼Œåªæ˜¯ Spring Boot å¸®ä½ æå‰å†™å¥½äº†é‚£äº›é€šç”¨çš„æ¡ä»¶åˆ¤æ–­é€»è¾‘ï¼ˆæ¯”å¦‚æ£€æŸ¥ç±»è·¯å¾„ã€æ£€æŸ¥é…ç½®å±æ€§ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="-æ€»ç»“ä¸€ä¸‹"&gt;ğŸ’¡ æ€»ç»“ä¸€ä¸‹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Conditional&lt;/code&gt;æ˜¯åŸºçŸ³&lt;/strong&gt;ï¼šå®ƒæ¥è‡ª Spring Frameworkï¼Œæä¾›äº†æ¡ä»¶è£…é…çš„åŸºæœ¬æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Boot æ³¨è§£æ˜¯é«˜æ•ˆå·¥å…·&lt;/strong&gt;ï¼šSpring Boot åœ¨æ­¤åŸºç¡€ä¸Šå°è£…äº†ä¸€ç³»åˆ—å¸¸ç”¨æ¡ä»¶æ³¨è§£ï¼Œæ—¨åœ¨ç®€åŒ–è‡ªåŠ¨é…ç½®ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰å¤æ‚æ¡ä»¶&lt;/strong&gt;ï¼šå½“ Spring Boot æä¾›çš„æ³¨è§£æ— æ³•æ»¡è¶³ä½ çš„ç‰¹æ®Šæ¡ä»¶åˆ¤æ–­éœ€æ±‚æ—¶ï¼Œä½ ä»ç„¶å¯ä»¥å›å½’æœ¬æºï¼Œé€šè¿‡å®ç° &lt;code&gt;Condition&lt;/code&gt;æ¥å£å¹¶ç»“åˆ &lt;code&gt;@Conditional&lt;/code&gt;æ³¨è§£æ¥å®ç°é«˜åº¦è‡ªå®šä¹‰çš„æ¡ä»¶è£…é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´æ¸…æ¥šåœ°ç†è§£å®ƒä»¬çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;h2 id="resource--autowired"&gt;@Resource &amp;amp; @Autowired
&lt;/h2&gt;&lt;p&gt;äº†è§£ &lt;code&gt;@Resource&lt;/code&gt;å’Œ &lt;code&gt;@Autowired&lt;/code&gt;çš„åŒºåˆ«å¯¹Springåº”ç”¨å¼€å‘å¾ˆé‡è¦ã€‚ä¸‹é¢ç”¨ä¸€ä¸ªè¡¨æ ¼å¸®ä½ å¿«é€Ÿæ¢³ç†å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ï¼Œç„¶åæˆ‘ä¼šè¿›ä¸€æ­¥è§£é‡Šå…³é”®ç‚¹å’Œä½¿ç”¨å»ºè®®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;@Autowired&lt;/th&gt;
&lt;th&gt;@Resource&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¥æºä¸è§„èŒƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring æ¡†æ¶ç‰¹æœ‰ (&lt;code&gt;org.springframework.beans.factory.annotation&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;Java æ ‡å‡† (JSR-250) (&lt;code&gt;javax.annotation&lt;/code&gt;)ï¼Œè·¨æ¡†æ¶æ”¯æŒæ›´å¥½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤æ³¨å…¥æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æŒ‰ç±»å‹ (byType)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æŒ‰åç§° (byName)&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŒ‡å®šåç§°æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é…åˆ &lt;code&gt;@Qualifier(&amp;quot;beanName&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;name&lt;/code&gt;å±æ€§ (å¦‚ &lt;code&gt;@Resource(name=&amp;quot;myBean&amp;quot;)&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ&lt;/td&gt;
&lt;td&gt;âŒ ä¸æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¿…éœ€æ€§æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;code&gt;@Autowired(required=false)&lt;/code&gt;å…è®¸æ³¨å…¥ &lt;code&gt;null&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— ç›´æ¥é…ç½®ï¼Œä¾èµ–å¿…é¡»å­˜åœ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤„ç†å¤šBeanå†²çª&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»“åˆ &lt;code&gt;@Qualifier&lt;/code&gt;æˆ–ä½¿ç”¨ &lt;code&gt;@Primary&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¼˜å…ˆæŒ‰åç§°åŒ¹é…ï¼Œå¤±è´¥åˆ™å›é€€åˆ°æŒ‰ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é›†åˆç±»å‹æ³¨å…¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çº¯ Spring é¡¹ç›®ã€æ„é€ å™¨æ³¨å…¥ã€å¯é€‰ä¾èµ–&lt;/td&gt;
&lt;td&gt;éœ€æŒ‰åç§°æ³¨å…¥ã€é Spring ç¯å¢ƒã€å¸Œæœ›å‡å°‘æ³¨è§£&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è¯¦è§£ä¸ä½¿ç”¨åœºæ™¯"&gt;ğŸ” è¯¦è§£ä¸ä½¿ç”¨åœºæ™¯
&lt;/h3&gt;&lt;h4 id="1-æ¥æºä¸è§„èŒƒ"&gt;1. æ¥æºä¸è§„èŒƒ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt; æ˜¯ &lt;strong&gt;Spring æ¡†æ¶çš„åŸç”Ÿæ³¨è§£&lt;/strong&gt;ï¼Œå› æ­¤æ·±åº¦é›†æˆäº Spring çš„ IOC å®¹å™¨ã€‚å¦‚æœä½ çš„åº”ç”¨å®Œå…¨åŸºäº Spring ç”Ÿæ€ï¼Œä½¿ç”¨å®ƒéå¸¸è‡ªç„¶ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Resource&lt;/code&gt;&lt;/strong&gt; æºäº &lt;strong&gt;JSR-250 æ ‡å‡†&lt;/strong&gt;ï¼ˆJava è§„èŒƒè¯·æ±‚ï¼‰ã€‚è¿™æ„å‘³ç€å®ƒä¸ä»…èƒ½åœ¨ Spring ä¸­ä½¿ç”¨ï¼Œè¿˜èƒ½åœ¨å…¶ä»–æ”¯æŒ JSR-250 çš„ JavaEE/Jakarta EE å®¹å™¨ä¸­å·¥ä½œï¼Œ&lt;strong&gt;è·¨æ¡†æ¶å…¼å®¹æ€§æ›´å¥½&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-é»˜è®¤æ³¨å…¥æœºåˆ¶"&gt;2. é»˜è®¤æ³¨å…¥æœºåˆ¶
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯ä¸¤è€…æœ€æ˜¾è‘—çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt; é»˜è®¤&lt;strong&gt;æŒ‰ç±»å‹åŒ¹é…&lt;/strong&gt;ã€‚å½“å­˜åœ¨å¤šä¸ªåŒç±»å‹ Bean æ—¶ï¼Œå®ƒä¼šå°è¯•é€šè¿‡å­—æ®µæˆ–å‚æ•°åç§°è¿›è¡ŒäºŒæ¬¡åŒ¹é…ã€‚è‹¥ä»æ— æ³•ç¡®å®šï¼Œéœ€ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ˜ç¡®æŒ‡å®š Bean åç§°ï¼Œå¦åˆ™æŠ›å‡º &lt;code&gt;NoUniqueBeanDefinitionException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Resource&lt;/code&gt;&lt;/strong&gt; é»˜è®¤&lt;strong&gt;æŒ‰åç§°åŒ¹é…&lt;/strong&gt;ï¼ˆå…ˆçœ‹ &lt;code&gt;name&lt;/code&gt;å±æ€§ï¼Œè‹¥æ— åˆ™ç”¨å­—æ®µ/æ–¹æ³•åï¼‰ã€‚å¦‚æœæŒ‰åç§°æ‰¾ä¸åˆ°ï¼Œ&lt;strong&gt;æ‰ä¼šå›é€€åˆ°æŒ‰ç±»å‹åŒ¹é…&lt;/strong&gt;ã€‚ä½ å¯ä»¥é€šè¿‡ &lt;code&gt;name&lt;/code&gt;æˆ– &lt;code&gt;type&lt;/code&gt;å±æ€§æ˜¾å¼å®šä¹‰åŒ¹é…è§„åˆ™ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-ä¾èµ–å¿…éœ€æ€§"&gt;3. ä¾èµ–å¿…éœ€æ€§
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt; æä¾›äº† &lt;code&gt;required&lt;/code&gt;å±æ€§ï¼Œ&lt;code&gt;@Autowired(required=false)&lt;/code&gt;å…è®¸ä¾èµ–é¡¹ä¸º &lt;code&gt;null&lt;/code&gt;ï¼Œé€‚ç”¨äº&lt;strong&gt;å¯é€‰ä¾èµ–&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Resource&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;æ²¡æœ‰&lt;/strong&gt;ç±»ä¼¼çš„å¿…éœ€æ€§é…ç½®å±æ€§ã€‚å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ Beanï¼Œå®ƒé€šå¸¸ä¼šæŠ›å‡ºå¼‚å¸¸ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-æ³¨å…¥æ–¹å¼æ”¯æŒ"&gt;4. æ³¨å…¥æ–¹å¼æ”¯æŒ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt; æ”¯æŒæ›´å¹¿æ³›çš„æ³¨å…¥æ–¹å¼ï¼š&lt;strong&gt;å­—æ®µã€æ„é€ å™¨ã€Setter æ–¹æ³•ã€æ™®é€šæ–¹æ³•&lt;/strong&gt;ã€‚å®˜æ–¹æ¨èä½¿ç”¨&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºå®ç°ä¸å¯å˜å¯¹è±¡å’Œæé«˜å¯æµ‹è¯•æ€§ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Resource&lt;/code&gt;&lt;/strong&gt; é€šå¸¸ç”¨äº&lt;strong&gt;å­—æ®µæ³¨å…¥å’Œ Setter æ–¹æ³•æ³¨å…¥&lt;/strong&gt;ï¼Œ&lt;strong&gt;ä¸æ”¯æŒæ„é€ å™¨æ³¨å…¥&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="5-å¤„ç†å¤šä¸ªåŒç±»å‹bean"&gt;5. å¤„ç†å¤šä¸ªåŒç±»å‹Bean
&lt;/h4&gt;&lt;p&gt;å½“åŒä¸€ç±»å‹æœ‰å¤šä¸ªå®ç°æ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt;ï¼šéœ€è¦ç»“åˆ &lt;strong&gt;&lt;code&gt;@Qualifier(&amp;quot;specificBeanName&amp;quot;)&lt;/code&gt;&lt;/strong&gt; æ¥æŒ‡å®šå…·ä½“çš„ Beanï¼Œæˆ–è€…ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Primary&lt;/code&gt;&lt;/strong&gt; æ ‡è®°é»˜è®¤ä¼˜å…ˆæ³¨å…¥çš„ Bean ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Resource&lt;/code&gt;&lt;/strong&gt;ï¼šå¯ä»¥ç›´æ¥é€šè¿‡å…¶ &lt;strong&gt;&lt;code&gt;name&lt;/code&gt;&lt;/strong&gt; å±æ€§æŒ‡å®š Bean åç§°ï¼Œå¦‚ &lt;code&gt;@Resource(name=&amp;quot;specificBeanName&amp;quot;)&lt;/code&gt;ï¼Œæ›´åŠ ç›´æ¥ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©ä¸æœ€ä½³å®è·µ"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¡¹ç›®ç¯å¢ƒå†³å®šåŸºç¡€é€‰æ‹©&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯&lt;strong&gt;çº¯ Spring é¡¹ç›®&lt;/strong&gt;ï¼Œä¸¤è€…çš†å¯ï¼Œä½†å›¢é˜Ÿåº”ç»Ÿä¸€é£æ ¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦&lt;strong&gt;è·¨æ¡†æ¶å…¼å®¹&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œä»£ç å¯èƒ½è¿ç§»åˆ°å…¶ä»–JavaEEå®¹å™¨ï¼‰ï¼Œä¼˜å…ˆè€ƒè™‘ &lt;code&gt;@Resource&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…·ä½“åœºæ™¯çš„è€ƒé‡&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼šé€‰æ‹© &lt;code&gt;@Autowired&lt;/code&gt;ï¼Œå› ä¸ºå®ƒæ”¯æŒæ„é€ å™¨æ³¨å…¥ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯æ›´å®‰å…¨ã€æ›´æ¨èçš„æ–¹å¼ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®æŒ‰åç§°æ³¨å…¥&lt;/strong&gt;ï¼š&lt;code&gt;@Resource&lt;/code&gt;çš„ &lt;code&gt;name&lt;/code&gt;å±æ€§è®©æŒ‰åæ³¨å…¥éå¸¸ç›´æ¥ï¼Œæ— éœ€é¢å¤–æ³¨è§£ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–å¯ä¸ºç©º&lt;/strong&gt;ï¼šé€‰æ‹© &lt;code&gt;@Autowired(required=false)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿æŒä¸€è‡´æ€§&lt;/strong&gt;ï¼šåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå°½é‡é¿å…æ··ç”¨ä¸¤ç§æ³¨è§£ï¼Œé€‰æ‹©ä¸€ç§å¹¶åšæŒä½¿ç”¨ï¼Œä»¥&lt;strong&gt;ä¿æŒä»£ç çš„æ¸…æ™°å’Œå¯ç»´æŠ¤æ€§&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç°ä»£Springçš„é»˜è®¤é€‰æ‹©&lt;/strong&gt;ï¼šåœ¨è®¸å¤šç°ä»£çš„Springï¼ˆç‰¹åˆ«æ˜¯Spring Bootï¼‰é¡¹ç›®ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;ç»“åˆæ„é€ å™¨æ³¨å…¥&lt;/strong&gt;å·²æˆä¸ºä¸€ç§äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œå› ä¸ºå®ƒèƒ½æ˜ç¡®ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”ä¾¿äºæµ‹è¯•ã€‚&lt;code&gt;@Resource&lt;/code&gt;åˆ™åœ¨éœ€è¦æŒ‰åç§°ç²¾ç¡®åŒ¹é…æ—¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¤‡é€‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šæ— è®ºä½¿ç”¨å“ªä¸ªæ³¨è§£ï¼Œéƒ½è¦æ³¨æ„é¿å…å¾ªç¯ä¾èµ–ï¼ˆAä¾èµ–Bï¼ŒBåˆä¾èµ–Aï¼‰ã€‚è™½ç„¶Springå®¹å™¨é€šè¿‡ä¸‰çº§ç¼“å­˜ç­‰æ‰‹æ®µå°è¯•è§£å†³æ„é€ å™¨å¾ªç¯ä¾èµ–ï¼Œä½†ä»åº”&lt;strong&gt;ä»è®¾è®¡ä¸Šé¿å…&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£æ‰«æ&lt;/strong&gt;ï¼šç¡®ä¿ä½ çš„é…ç½®ï¼ˆå¦‚XMLä¸­çš„ &lt;code&gt;&amp;lt;context:component-scan&amp;gt;&lt;/code&gt;æˆ–Javaé…ç½®ä¸­çš„ &lt;code&gt;@ComponentScan&lt;/code&gt;ï¼‰èƒ½æ‰«æåˆ°è¿™äº›æ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="bean"&gt;@Bean
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œä½ çš„ç†è§£å®Œå…¨æ­£ç¡®ã€‚&lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£çš„ä½¿ç”¨å¹¶ä¸å¼ºåˆ¶ä¾èµ–äº &lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£ã€‚ä¸ºäº†è®©ä½ èƒ½å¿«é€ŸæŠŠæ¡æ ¸å¿ƒåŒºåˆ«ï¼Œæˆ‘å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ¥å¯¹æ¯” &lt;code&gt;@Bean&lt;/code&gt;åœ¨ä¸åŒæ³¨è§£ç±»ä¸­çš„è¡Œä¸ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean&lt;/code&gt;åœ¨ &lt;code&gt;@Configuration&lt;/code&gt;ç±»ä¸­ (Full æ¨¡å¼)&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean&lt;/code&gt;åœ¨ &lt;code&gt;@Component&lt;/code&gt;/&lt;code&gt;@Service&lt;/code&gt;ç­‰ç±»ä¸­ (Lite æ¨¡å¼)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®ç±»ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯ï¼Œé€šè¿‡ CGLIB ä»£ç†å¢å¼º&lt;/td&gt;
&lt;td&gt;âŒ å¦ï¼ŒåŸå§‹ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•é—´è°ƒç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¢«ä»£ç†æ‹¦æˆªï¼Œè¿”å›å®¹å™¨ç®¡ç†çš„&lt;strong&gt;åŒä¸€å®ä¾‹&lt;/strong&gt; (å•ä¾‹)&lt;/td&gt;
&lt;td&gt;æ™®é€š Java æ–¹æ³•è°ƒç”¨ï¼Œæ¯æ¬¡æ‰§è¡Œæ–¹æ³•ä½“ï¼Œ&lt;strong&gt;å¯èƒ½åˆ›å»ºæ–°å®ä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean å•ä¾‹ä¿è¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… ä¸¥æ ¼ä¿è¯&lt;/td&gt;
&lt;td&gt;âš ï¸ æ— æ³•ä¿è¯ï¼Œæœ‰é‡å¤åˆ›å»ºé£é™©&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•å£°æ˜é™åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯ä¸º &lt;code&gt;private&lt;/code&gt;æˆ– &lt;code&gt;final&lt;/code&gt;(ä½†ä¸æ¨è)&lt;/td&gt;
&lt;td&gt;ä¸èƒ½æ˜¯ &lt;code&gt;private&lt;/code&gt;æˆ– &lt;code&gt;final&lt;/code&gt;(éœ€å¯è¢«æ™®é€šè°ƒç”¨)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…éƒ¨ä¾èµ–å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡å®¹å™¨ç®¡ç†ä¾èµ–ï¼Œæ”¯æŒ &lt;code&gt;@Autowired&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;td&gt;ä¾èµ–éœ€æ˜¾å¼é€šè¿‡&lt;strong&gt;æ–¹æ³•å‚æ•°&lt;/strong&gt;ä¼ é€’ (ç”± Spring æ³¨å…¥)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰ Bean åŠ Bean é—´&lt;strong&gt;å¤æ‚ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç»„ä»¶å†…éƒ¨&lt;/strong&gt;æ³¨å†Œè¾…åŠ© Beanï¼Œä¸”è¯¥ Bean é€šå¸¸&lt;strong&gt;ä¸ä¸å…¶ä»–ç»„ä»¶å…±äº«&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸¤ç§æ¨¡å¼è¯¦è§£"&gt;ğŸ” ä¸¤ç§æ¨¡å¼è¯¦è§£
&lt;/h3&gt;&lt;p&gt;Spring å¤„ç† &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œä¼šæ ¹æ®å…¶æ‰€åœ¨çš„ç±»æ˜¯å¦è¢« &lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£æ ‡æ³¨ï¼Œåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Full æ¨¡å¼ï¼ˆå®Œæ•´æ¨¡å¼ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä½äº &lt;code&gt;@Configuration&lt;/code&gt;æ ‡æ³¨çš„ç±»ä¸­æ—¶ï¼ŒSpring ä¼šä½¿ç”¨ &lt;strong&gt;CGLIB åŠ¨æ€ä»£ç†&lt;/strong&gt;å¯¹è¯¥é…ç½®ç±»è¿›è¡Œå¢å¼ºã€‚&lt;strong&gt;è¿™æ˜¯ç¡®ä¿è·¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å¼•ç”¨ä¿æŒå•ä¾‹çš„å…³é”®&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç†è¡Œä¸º&lt;/strong&gt;ï¼šå½“åœ¨ä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œä»£ç†ä¼šæ‹¦æˆªæ­¤è°ƒç”¨ã€‚å®ƒé¦–å…ˆæ£€æŸ¥ Spring å®¹å™¨ä¸­æ˜¯å¦å·²å­˜åœ¨è¯¥ Bean çš„å®ä¾‹ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›å®¹å™¨ä¸­çš„å®ä¾‹ï¼Œå¦‚æœä¸å­˜åœ¨æ‰æ‰§è¡Œæ–¹æ³•ä½“åˆ›å»ºå®ä¾‹å¹¶æ³¨å†Œåˆ°å®¹å™¨åè¿”å›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š&lt;strong&gt;ä¸¥æ ¼ä¿è¯å•ä¾‹è¯­ä¹‰&lt;/strong&gt;ï¼Œæ— è®ºä¸€ä¸ª Bean è¢«å…¶ä»– &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¾èµ–å¤šå°‘æ¬¡ï¼Œåœ¨å®¹å™¨ä¸­éƒ½åªæœ‰å”¯ä¸€å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class FullConfig {
@Bean
public ServiceA serviceA() {
// è¿™é‡Œçš„ serviceB() è°ƒç”¨ä¼šè¢«ä»£ç†æ‹¦æˆªï¼Œè¿”å›å®¹å™¨ä¸­å”¯ä¸€çš„ ServiceB å®ä¾‹
return new ServiceA(serviceB());
}
@Bean
public ServiceB serviceB() {
return new ServiceB();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Lite æ¨¡å¼ï¼ˆè½»é‡æ¨¡å¼ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä½äº &lt;code&gt;@Component&lt;/code&gt;, &lt;code&gt;@Service&lt;/code&gt;, &lt;code&gt;@Repository&lt;/code&gt;ç­‰æ³¨è§£æ ‡æ³¨çš„ç±»ä¸­ï¼Œæˆ–ç”šè‡³æ˜¯ä¸€ä¸ªæ™®é€šç±»ä¸­æ—¶ï¼ŒSpring &lt;strong&gt;ä¸ä¼š&lt;/strong&gt;ä½¿ç”¨ CGLIB ä»£ç†è¿™äº›ç±»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•è°ƒç”¨è¡Œä¸º&lt;/strong&gt;ï¼š&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¹‹é—´çš„è°ƒç”¨æ˜¯&lt;strong&gt;æ ‡å‡†çš„ Java æ–¹æ³•è°ƒç”¨&lt;/strong&gt;ï¼Œæ²¡æœ‰ä»»ä½• Spring å®¹å™¨å±‚é¢çš„æ‹¦æˆªã€‚æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰§è¡Œæ–¹æ³•ä½“ä¸­çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;ï¼šè¿™ææ˜“å¯¼è‡´&lt;strong&gt;æ— æ„ä¸­åˆ›å»ºå¤šä¸ªå®ä¾‹&lt;/strong&gt;ï¼Œç ´åå•ä¾‹è¯­ä¹‰ï¼Œå¯èƒ½å¼•å‘èµ„æºæµªè´¹ã€çŠ¶æ€ä¸ä¸€è‡´æˆ–çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ­£ç¡®ç”¨æ³•&lt;/strong&gt;ï¼šåœ¨ Lite æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•éœ€è¦ä¾èµ–å¦ä¸€ä¸ª Beanï¼Œ&lt;strong&gt;å”¯ä¸€å®‰å…¨å¯é çš„æ–¹å¼æ˜¯é€šè¿‡æ–¹æ³•å‚æ•°å£°æ˜ä¾èµ–&lt;/strong&gt;ï¼Œè®© Spring å®¹å™¨åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶è‡ªåŠ¨æ³¨å…¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class LiteComponent {
// æ­£ç¡®ï¼šä¾èµ–é€šè¿‡å‚æ•°æ³¨å…¥
@Bean
public ServiceA serviceA(ServiceB serviceB) { // Spring æ³¨å…¥ serviceB
return new ServiceA(serviceB);
}
@Bean
public ServiceB serviceB() {
return new ServiceB();
}
// é”™è¯¯ï¼šç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Œåœ¨ Lite æ¨¡å¼ä¸‹ä¼šå¯¼è‡´å¤šæ¬¡åˆ›å»º ServiceB
// @Bean
// public ServiceA serviceA() {
// return new ServiceA(serviceB()); // è¿™æ˜¯æ™®é€šæ–¹æ³•è°ƒç”¨ï¼
// }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©æ¨¡å¼"&gt;ğŸ¯ å¦‚ä½•é€‰æ‹©æ¨¡å¼
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»å¤§å¤šæ•°åœºæ™¯æ¨èä½¿ç”¨ Full æ¨¡å¼ (&lt;code&gt;@Configuration&lt;/code&gt;+ &lt;code&gt;@Bean&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ Spring å®˜æ–¹æ¨èçš„æ ‡å‡†æ–¹å¼ï¼Œèƒ½å®‰å…¨ã€æ¸…æ™°ã€æ–¹ä¾¿åœ°è¡¨è¾¾ Bean å®šä¹‰åŠå…¶é—´çš„å¤æ‚ä¾èµ–å…³ç³»ï¼Œé¿å…æ„å¤–çš„å•ä¾‹ç ´åã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨ Lite æ¨¡å¼ (åœ¨ &lt;code&gt;@Component&lt;/code&gt;ç­‰ç±»ä¸­ä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šå¸¸ä»…é€‚ç”¨äºä»¥ä¸‹ç‰¹å®šæƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»„ä»¶å†…éƒ¨æ³¨å†Œè¾…åŠ© Bean&lt;/strong&gt;ï¼šå½“ä¸€ä¸ª &lt;code&gt;@Component&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;@Service&lt;/code&gt;ï¼‰ç±»è‡ªèº«æ˜¯ä¸šåŠ¡é€»è¾‘ Beanï¼Œä½†å®ƒå†…éƒ¨éœ€è¦æ³¨å†Œä¸€ä¸¤ä¸ª&lt;strong&gt;éå¸¸ç®€å•ä¸”ä»…æœåŠ¡äºè‡ªèº«&lt;/strong&gt;çš„å·¥å…·ç±» Beanï¼ˆä¸”è¯¥å·¥å…· Bean &lt;strong&gt;ä¸éœ€è¦è¢«å…¶ä»–ä»»ä½• Bean ä¾èµ–&lt;/strong&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ºç¬¬ä¸‰æ–¹åº“ç±»æ·»åŠ  Bean&lt;/strong&gt;ï¼šå½“ä½ æ— æ³•ä¿®æ”¹ä¸€ä¸ªå·²æœ‰çš„ &lt;code&gt;@Component&lt;/code&gt;ç±»ï¼ˆå¦‚æ¥è‡ªç¬¬ä¸‰æ–¹åº“ï¼‰ï¼Œä½†éœ€è¦åœ¨è¿™ä¸ªç±»ä¸­é€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;æ·»åŠ ä¸€ä¸ª Bean å®šä¹‰æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡è¦åŸåˆ™&lt;/strong&gt;ï¼šåœ¨ Lite æ¨¡å¼ä¸‹ï¼ŒåŠ¡å¿…éµå®ˆâ€œ&lt;strong&gt;é€šè¿‡æ–¹æ³•å‚æ•°æ³¨å…¥ä¾èµ–&lt;/strong&gt;â€çš„é“å¾‹ï¼Œç»å¯¹é¿å…åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä½“å†…ç›´æ¥è°ƒç”¨å…¶ä»– &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒçš„çµæ´»æ€§ï¼Œå®ƒä¸ä»…å¯ä»¥ä¸ &lt;code&gt;@Configuration&lt;/code&gt;æ­é…æä¾›å¼ºä¸€è‡´æ€§çš„å•ä¾‹ä¿è¯ï¼ˆFull æ¨¡å¼ï¼‰ï¼Œä¹Ÿèƒ½åœ¨ &lt;code&gt;@Component&lt;/code&gt;ç­‰ç»„ä»¶ç±»ä¸­ä½¿ç”¨ä»¥å®ç°æ›´è½»é‡çš„é…ç½®ï¼ˆLite æ¨¡å¼ï¼‰ã€‚ç†è§£è¿™ä¸¤ç§æ¨¡å¼çš„æ ¸å¿ƒå·®å¼‚â€”â€”&lt;strong&gt;CGLIB ä»£ç†å¸¦æ¥çš„æ‹¦æˆªè¡Œä¸º&lt;/strong&gt;â€”â€”æ˜¯æ­£ç¡®ä½¿ç”¨å®ƒä»¬çš„å…³é”®ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸ºäº†ä»£ç çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå»ºè®®ä¼˜å…ˆé€‰æ‹© &lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£çš„ Full æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h2 id="spring-scope"&gt;Spring Scope
&lt;/h2&gt;&lt;p&gt;Spring Bean çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå®ƒå†³å®šäº† Bean &lt;strong&gt;å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸã€åˆ›å»ºæ–¹å¼ä»¥åŠåœ¨å®¹å™¨ä¸­çš„å¯è§æ€§&lt;/strong&gt;ã€‚äº†è§£å¹¶æ­£ç¡®ä½¿ç”¨ä½œç”¨åŸŸï¼Œå¯¹äºæ„å»ºé«˜æ•ˆã€ç¨³å®šä¸”çº¿ç¨‹å®‰å…¨çš„ Spring åº”ç”¨è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº† Spring æ”¯æŒçš„ 6 ç§æ ¸å¿ƒä½œç”¨åŸŸåŠå…¶ä¸»è¦ç‰¹ç‚¹ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“å°è±¡ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä½œç”¨åŸŸ (Scope)&lt;/th&gt;
&lt;th&gt;é€‚ç”¨ç¯å¢ƒ&lt;/th&gt;
&lt;th&gt;å®ä¾‹æ•°é‡ä¸ç”Ÿå‘½å‘¨æœŸ&lt;/th&gt;
&lt;th&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;singleton&lt;/strong&gt; (é»˜è®¤)&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰&lt;/td&gt;
&lt;td&gt;æ•´ä¸ª IoC å®¹å™¨ä¸­&lt;strong&gt;åªæœ‰ä¸€ä¸ª&lt;/strong&gt;å®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸å®¹å™¨ç›¸åŒ&lt;/td&gt;
&lt;td&gt;æ— çŠ¶æ€æœåŠ¡ã€å·¥å…·ç±»ã€æ•°æ®è®¿é—®å±‚ï¼ˆDAOã€Serviceï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;prototype&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¯æ¬¡è¯·æ±‚&lt;/strong&gt;éƒ½åˆ›å»ºä¸€ä¸ª&lt;strong&gt;æ–°&lt;/strong&gt;å®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸç”±è°ƒç”¨æ–¹ç®¡ç†&lt;/td&gt;
&lt;td&gt;æœ‰çŠ¶æ€å¯¹è±¡ã€éœ€è¦éš”ç¦»çš„ä¸Šä¸‹æ–‡ï¼ˆå¦‚ DTOã€ä»»åŠ¡å¤„ç†å™¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;request&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Web (Spring MVC)&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª &lt;strong&gt;HTTP è¯·æ±‚&lt;/strong&gt;ä¸€ä¸ªå®ä¾‹ï¼Œè¯·æ±‚ç»“æŸå³é”€æ¯&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚è¡¨å•æ•°æ®ã€è¯·æ±‚IDï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;session&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Web (Spring MVC)&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª &lt;strong&gt;HTTP ä¼šè¯&lt;/strong&gt;ä¸€ä¸ªå®ä¾‹ï¼Œä¼šè¯ç»“æŸå³é”€æ¯&lt;/td&gt;
&lt;td&gt;å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼ˆå¦‚ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;application&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Web (Spring MVC)&lt;/td&gt;
&lt;td&gt;æ•´ä¸ª &lt;strong&gt;Web åº”ç”¨&lt;/strong&gt;ä¸€ä¸ªå®ä¾‹ï¼Œåº”ç”¨å…³é—­æ‰é”€æ¯&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å…¨å±€é…ç½®ã€åº”ç”¨çº§ç¼“å­˜ï¼ˆå¦‚åº”ç”¨åç§°ã€ç‰ˆæœ¬å·ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;websocket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Web (WebSocket)&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª &lt;strong&gt;WebSocket ä¼šè¯&lt;/strong&gt;ä¸€ä¸ªå®ä¾‹ï¼Œä¼šè¯ç»“æŸå³é”€æ¯&lt;/td&gt;
&lt;td&gt;å­˜å‚¨ WebSocket è¿æ¥çŠ¶æ€ã€ä¼šè¯ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="è¯¦ç»†è§£æå„ä½œç”¨åŸŸ"&gt;è¯¦ç»†è§£æå„ä½œç”¨åŸŸ
&lt;/h3&gt;&lt;h4 id="1-singletonå•ä¾‹"&gt;1. Singletonï¼ˆå•ä¾‹ï¼‰
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯ Spring å®¹å™¨&lt;strong&gt;é»˜è®¤&lt;/strong&gt;çš„ä½œç”¨åŸŸï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šåœ¨æ•´ä¸ª Spring IoC å®¹å™¨ä¸­ï¼Œè¯¥ Bean å®šä¹‰&lt;strong&gt;åªå¯¹åº”ä¸€ä¸ªå®ä¾‹&lt;/strong&gt;ã€‚æ‰€æœ‰é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ &lt;code&gt;@Autowired&lt;/code&gt;ï¼‰æˆ– &lt;code&gt;getBean()&lt;/code&gt;æ–¹æ³•è·å–è¯¥ Bean çš„è¯·æ±‚ï¼Œå¾—åˆ°çš„éƒ½æ˜¯&lt;strong&gt;åŒä¸€ä¸ªå…±äº«å®ä¾‹&lt;/strong&gt;ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸å®¹å™¨ç»‘å®šï¼Œå®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼ˆå¯é…ç½®æ‡’åŠ è½½ï¼‰ï¼Œå®¹å™¨å…³é—­æ—¶é”€æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼šæ— éœ€ç‰¹æ®Šé…ç½®å³ä¸º Singletonã€‚ä¹Ÿå¯æ˜¾å¼æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@Scope(&amp;#34;singleton&amp;#34;) // æˆ– @Scope(ConfigurableBeanFactory.SCOPE_SINGLETON)
public class MyService {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;strong&gt;æ— çŠ¶æ€&lt;/strong&gt;çš„ Beanï¼Œä¾‹å¦‚æœåŠ¡å±‚ï¼ˆServiceï¼‰ã€æ•°æ®è®¿é—®å±‚ï¼ˆRepository/Daoï¼‰ã€å·¥å…·ç±»ç­‰ã€‚è¿™äº› Bean é€šå¸¸ä¸ä¿å­˜ä¼šå˜åŒ–çš„æˆå‘˜å˜é‡ï¼Œå› æ­¤å¯ä»¥å®‰å…¨å…±äº«ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­£å› ä¸ºå®ä¾‹æ˜¯å…±äº«çš„ï¼ŒSingleton Bean æ˜¯&lt;strong&gt;çº¿ç¨‹ä¸å®‰å…¨çš„&lt;/strong&gt;ã€‚å¦‚æœå®ƒåŒ…å«å¯ä¿®æ”¹çš„çŠ¶æ€ï¼ˆæˆå‘˜å˜é‡ï¼‰ï¼Œä½ éœ€è¦è‡ªè¡Œå¤„ç†å¹¶å‘è®¿é—®é—®é¢˜ï¼ˆå¦‚ä½¿ç”¨åŒæ­¥é”æˆ– &lt;code&gt;ThreadLocal&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-prototypeåŸå‹"&gt;2. Prototypeï¼ˆåŸå‹ï¼‰
&lt;/h4&gt;&lt;p&gt;ä¸ Singleton ç›¸åï¼Œæ¯æ¬¡è·å–éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°å®ä¾‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¯æ¬¡é€šè¿‡å®¹å™¨&lt;strong&gt;è¯·æ±‚&lt;/strong&gt;ï¼ˆæ³¨å…¥æˆ–è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;ï¼‰è¯¥ Bean æ—¶ï¼ŒSpring éƒ½ä¼š&lt;strong&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹&lt;/strong&gt;ç»™ä½ ã€‚Spring å®¹å™¨åªè´Ÿè´£åˆ›å»ºï¼Œ&lt;strong&gt;ä¸ç®¡ç†å…¶å®Œæ•´ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼Œå³ä¸ä¼šè°ƒç”¨å…¶ &lt;code&gt;@PreDestroy&lt;/code&gt;æ–¹æ³•ã€‚å®ä¾‹çš„é”€æ¯ç”± GC è´Ÿè´£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@Scope(&amp;#34;prototype&amp;#34;) // æˆ– @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
public class OrderDto {
// æ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦æ–°å®ä¾‹çš„æœ‰çŠ¶æ€å¯¹è±¡
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;strong&gt;æœ‰çŠ¶æ€çš„&lt;/strong&gt; Beanï¼Œæ¯ä¸ªä½¿ç”¨è€…éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹æ¥ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ï¼Œä¾‹å¦‚æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ã€è¡¨å•å¯¹è±¡ã€ä»»åŠ¡å¤„ç†å™¨ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¢‘ç¹åˆ›å»ºæ–°å®ä¾‹ä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Singleton Bean ä¸­ç›´æ¥æ³¨å…¥ Prototype Bean å¯èƒ½æ— æ³•è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚å› ä¸ºæ³¨å…¥åªå‘ç”Ÿä¸€æ¬¡ï¼ŒSingleton Bean å°†å§‹ç»ˆæŒæœ‰æœ€åˆæ³¨å…¥çš„é‚£ä¸ª Prototype å®ä¾‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ &lt;code&gt;ObjectFactory&lt;/code&gt;æˆ– &lt;code&gt;Provider&lt;/code&gt;æ¥å»¶è¿ŸæŸ¥æ‰¾ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private ObjectFactory&amp;lt;PrototypeBean&amp;gt; prototypeBeanFactory;
public void someMethod() {
PrototypeBean newInstance = prototypeBeanFactory.getObject();
// ... ä½¿ç”¨æ–°å®ä¾‹
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-request"&gt;3. Request
&lt;/h4&gt;&lt;p&gt;ä¸“ä¸º Web åº”ç”¨è®¾è®¡ï¼Œç”Ÿå‘½å‘¨æœŸä¸ HTTP è¯·æ±‚ç»‘å®šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¯ä¸€ä¸ªæ¥è‡ªå®¢æˆ·ç«¯çš„ &lt;strong&gt;HTTP è¯·æ±‚&lt;/strong&gt;éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ Bean å®ä¾‹ã€‚å½“è¿™ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•å¹¶è¿”å›å“åº”åï¼Œè¯¥å®ä¾‹å°±ä¼šè¢«é”€æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼ˆéœ€åœ¨ Web ç¯å¢ƒä¸­ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@RequestScope // æˆ– @Scope(value = WebApplicationContext.SCOPE_REQUEST)
public class RequestContext {
private String requestId;
// ... å­˜å‚¨è¯·æ±‚ç›¸å…³ä¿¡æ¯
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç”¨äºå­˜å‚¨åªåœ¨ä¸€æ¬¡è¯·æ±‚å†…æœ‰æ•ˆçš„ä¸´æ—¶æ•°æ®ï¼Œä¾‹å¦‚ HTTP è¯·æ±‚å‚æ•°ã€æœ¬æ¬¡è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-session"&gt;4. Session
&lt;/h4&gt;&lt;p&gt;ä¸“ä¸º Web åº”ç”¨è®¾è®¡ï¼Œç”Ÿå‘½å‘¨æœŸä¸ HTTP ä¼šè¯ç»‘å®šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¯ä¸€ä¸ªç”¨æˆ·çš„ &lt;strong&gt;HTTP ä¼šè¯&lt;/strong&gt;ï¼ˆSessionï¼‰å¯¹åº”ä¸€ä¸ª Bean å®ä¾‹ã€‚åŒä¸€ä¸ªç”¨æˆ·åœ¨ä¸åŒè¯·æ±‚ä¸­è®¿é—®çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚å½“ä¼šè¯è¶…æ—¶æˆ–å¤±æ•ˆï¼ˆå¦‚ç”¨æˆ·æ³¨é”€ï¼‰æ—¶ï¼Œè¯¥å®ä¾‹è¢«é”€æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼ˆéœ€åœ¨ Web ç¯å¢ƒä¸­ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@SessionScope // æˆ– @Scope(value = WebApplicationContext.SCOPE_SESSION)
public class UserSession {
private Long userId;
private String username;
// ... å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç”¨äºå­˜å‚¨ç”¨æˆ·çº§åˆ«çš„çŠ¶æ€ä¿¡æ¯ï¼Œæœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯&lt;strong&gt;è´­ç‰©è½¦&lt;/strong&gt;å’Œç”¨æˆ·ç™»å½•å‡­è¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="5-application"&gt;5. Application
&lt;/h4&gt;&lt;p&gt;ä¸“ä¸º Web åº”ç”¨è®¾è®¡ï¼Œç”Ÿå‘½å‘¨æœŸä¸ &lt;code&gt;ServletContext&lt;/code&gt;ç»‘å®šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šåœ¨æ•´ä¸ª &lt;strong&gt;Web åº”ç”¨ç¨‹åº&lt;/strong&gt;ä¸­åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸ &lt;code&gt;ServletContext&lt;/code&gt;ç›¸åŒï¼Œä»åº”ç”¨å¯åŠ¨åˆ°å…³é—­ã€‚å®ƒå’Œ Singleton å¾ˆåƒï¼Œä½†å®ƒæ˜¯ &lt;strong&gt;ServletContext çº§åˆ«&lt;/strong&gt;çš„å•ä¾‹ï¼Œè€Œé Spring å®¹å™¨çº§åˆ«ã€‚å¦‚æœä¸€ä¸ªåº”ç”¨æœ‰å¤šä¸ª Spring å®¹å™¨ï¼ŒSingleton ä¼šæœ‰å¤šä¸ªå®ä¾‹ï¼Œè€Œ Application åªæœ‰ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼ˆéœ€åœ¨ Web ç¯å¢ƒä¸­ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@ApplicationScope // æˆ– @Scope(value = WebApplicationContext.SCOPE_APPLICATION)
public class AppConfig {
private String appName;
private String appVersion;
// ... å­˜å‚¨å…¨å±€é…ç½®ä¿¡æ¯
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå­˜æ”¾æ•´ä¸ªåº”ç”¨å…±äº«çš„å…¨å±€é…ç½®ä¿¡æ¯æˆ–ç¼“å­˜æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="6-websocket"&gt;6. Websocket
&lt;/h4&gt;&lt;p&gt;ä¸“ä¸º WebSocket åº”ç”¨è®¾è®¡ï¼Œç”Ÿå‘½å‘¨æœŸä¸ WebSocket ä¼šè¯ç»‘å®šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¯ä¸ª &lt;strong&gt;WebSocket ä¼šè¯&lt;/strong&gt;å¯¹åº”ä¸€ä¸ª Bean å®ä¾‹ã€‚å½“ WebSocket è¿æ¥å…³é—­åï¼Œè¯¥å®ä¾‹è¢«é”€æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼ˆéœ€é›†æˆ Spring WebSocketï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@Scope(value = &amp;#34;websocket&amp;#34;)
public class WebSocketSessionHandler {
private String sessionId;
// ... å­˜å‚¨WebSocketä¼šè¯ä¿¡æ¯
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¤„ç† WebSocket è¿æ¥æ—¶çš„çŠ¶æ€ç®¡ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ¯ å¦‚ä½•é€‰æ‹©ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨åŸŸé€‰æ‹©åŸåˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— çŠ¶æ€ Bean&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;Singleton&lt;/strong&gt;ï¼Œè¿™æ˜¯æ€§èƒ½æœ€ä¼˜çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€ Bean&lt;/strong&gt;ï¼šæ ¹æ®çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸé€‰æ‹© &lt;strong&gt;Prototype&lt;/strong&gt;ï¼ˆçº¿ç¨‹å†…ï¼‰ã€&lt;strong&gt;Request&lt;/strong&gt;ï¼ˆä¸€æ¬¡è¯·æ±‚ï¼‰ã€&lt;strong&gt;Session&lt;/strong&gt;ï¼ˆä¸€æ¬¡ä¼šè¯ï¼‰æˆ– &lt;strong&gt;Websocket&lt;/strong&gt;ï¼ˆä¸€æ¬¡è¿æ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€é…ç½®&lt;/strong&gt;ï¼šåœ¨ Web ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ &lt;strong&gt;Application&lt;/strong&gt; ä½œç”¨åŸŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•ä¾‹ Bean ä¸­æ³¨å…¥åŸå‹ Bean çš„é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Singleton Bean ä¸­ç›´æ¥ &lt;code&gt;@Autowired&lt;/code&gt;ä¸€ä¸ª Prototype Beanï¼Œç”±äºä¾èµ–æ³¨å…¥åªåœ¨ Singleton Bean åˆå§‹åŒ–æ—¶å‘ç”Ÿä¸€æ¬¡ï¼Œå¯¼è‡´åè€…å³ä½¿å®šä¹‰ä¸º Prototypeï¼Œä¹Ÿåªä¼šè¢«æ³¨å…¥ä¸€æ¬¡ï¼Œæ— æ³•æ¯æ¬¡è·å¾—æ–°å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;ObjectFactory&lt;/code&gt;ï¼ˆSpring æä¾›ï¼‰æˆ– &lt;code&gt;Provider&lt;/code&gt;ï¼ˆJSR-330 æ ‡å‡†ï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class SingletonService {
// ä½¿ç”¨ ObjectFactory å»¶è¿Ÿè·å–
@Autowired
private ObjectFactory&amp;lt;PrototypeBean&amp;gt; prototypeBeanFactory;
public void doSomething() {
// æ¯æ¬¡è°ƒç”¨ getObject() éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ PrototypeBean å®ä¾‹
PrototypeBean newInstance = prototypeBeanFactory.getObject();
// ...
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Web ä½œç”¨åŸŸçš„ä¾èµ–æ³¨å…¥é™åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é Web ç¯å¢ƒçš„ Beanï¼ˆå¦‚æ™®é€šçš„ Singleton Serviceï¼‰æ— æ³•ç›´æ¥æ³¨å…¥ Requestã€Session ç­‰ Web ä½œç”¨åŸŸçš„ Beanï¼Œå› ä¸º Web ä¸Šä¸‹æ–‡åœ¨å®ƒä»¬åˆå§‹åŒ–æ—¶å¯èƒ½ä¸å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼šä¸º Web ä½œç”¨åŸŸçš„ Bean é…ç½®&lt;strong&gt;ä»£ç†ï¼ˆProxyï¼‰&lt;/strong&gt;ã€‚Spring ä¼šæ³¨å…¥ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œåœ¨å®é™…è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»£ç†ä¼šå»å½“å‰è¯·æ±‚/ä¼šè¯ä¸­æŸ¥æ‰¾çœŸæ­£çš„ç›®æ ‡ Beanã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class RequestScopedBean {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·ï¼Œåœ¨ Singleton Service ä¸­å°±å¯ä»¥æ­£å¸¸ &lt;code&gt;@Autowired&lt;/code&gt;è¿™ä¸ª &lt;code&gt;RequestScopedBean&lt;/code&gt;äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Spring Bean Scopeã€‚&lt;/p&gt;
&lt;h2 id="å•ä¾‹åŸå‹å¤±æ•ˆ"&gt;å•ä¾‹åŸå‹å¤±æ•ˆ
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£æ˜¯ Spring æ¡†æ¶ä¸­ä¸€é¡¹&lt;strong&gt;æ–¹æ³•çº§åˆ«ä¾èµ–æ³¨å…¥&lt;/strong&gt;çš„é«˜çº§ç‰¹æ€§ã€‚å®ƒä¸»è¦ç”¨äºè§£å†³ &lt;strong&gt;å•ä¾‹ Bean éœ€è¦ä¾èµ–åŸå‹ï¼ˆPrototypeï¼‰Bean&lt;/strong&gt; æ—¶çš„ç»å…¸é—®é¢˜ï¼Œç¡®ä¿æ¯æ¬¡éƒ½èƒ½è·å¾—&lt;strong&gt;æ–°çš„åŸå‹å®ä¾‹&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯è¢«å•ä¾‹ç¼“å­˜çš„é‚£ä¸ªå›ºå®šå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº† &lt;code&gt;@Lookup&lt;/code&gt;çš„æ ¸å¿ƒä¿¡æ¯ï¼Œå¸®ä½ å¿«é€Ÿäº†è§£å®ƒï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹é¢&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å•ä¾‹ Bean ä¸­&lt;strong&gt;åŠ¨æ€è·å–&lt;/strong&gt;åŸå‹ä½œç”¨åŸŸï¼ˆPrototypeï¼‰Bean çš„æ–°å®ä¾‹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1. å•ä¾‹ Bean ä¸­éœ€è¦é¢‘ç¹åˆ›å»ºçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ 2. å¤šçº¿ç¨‹ç¯å¢ƒä¸­è·å–çº¿ç¨‹ä¸å®‰å…¨çš„åŸå‹ Beanã€‚ 3. éœ€è¦é¿å…å¾ªç¯ä¾èµ–ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring é€šè¿‡ &lt;strong&gt;CGLIB åŠ¨æ€ä»£ç†&lt;/strong&gt;ç”Ÿæˆå­ç±»ï¼Œé‡å†™è¢« &lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼Œä½¿å…¶æ¯æ¬¡è°ƒç”¨éƒ½ä»å®¹å™¨ä¸­è·å–æ–°å®ä¾‹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•è¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•ä¸èƒ½æ˜¯ &lt;code&gt;private&lt;/code&gt;, &lt;code&gt;final&lt;/code&gt;æˆ– &lt;code&gt;static&lt;/code&gt;ã€‚æ¨èä½¿ç”¨ &lt;code&gt;protected&lt;/code&gt;æŠ½è±¡æ–¹æ³•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°å®ä¾‹å’Œå¯èƒ½çš„ä»£ç†å¼€é”€ï¼Œéœ€æ³¨æ„åœ¨é«˜é¢‘åœºæ™¯ä¸‹çš„æ€§èƒ½å½±å“ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1. &lt;code&gt;ObjectFactory&lt;/code&gt;/ &lt;code&gt;Provider&lt;/code&gt; 2. æ‰‹åŠ¨ä» &lt;code&gt;ApplicationContext&lt;/code&gt;è·å–ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å¦‚ä½•æ­£ç¡®ä½¿ç”¨-lookup"&gt;ğŸ”§ å¦‚ä½•æ­£ç¡®ä½¿ç”¨ @Lookup
&lt;/h3&gt;&lt;h4 id="1-åŸºæœ¬ç”¨æ³•"&gt;1. åŸºæœ¬ç”¨æ³•
&lt;/h4&gt;&lt;p&gt;å‡è®¾ä½ æœ‰ä¸€ä¸ªåŸå‹ Bean å’Œä¸€ä¸ªå•ä¾‹ Beanã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰åŸå‹ Bean&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;@Scope(&amp;quot;prototype&amp;quot;)&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@Scope(&amp;#34;prototype&amp;#34;) // å…³é”®ï¼šå£°æ˜ä¸ºåŸå‹ä½œç”¨åŸŸ
public class TaskExecutor {
private String taskId;
// æ¯æ¬¡ä½¿ç”¨éƒ½åº”æ˜¯æ–°çš„å®ä¾‹ï¼Œå¯èƒ½åŒ…å«çŠ¶æ€
public void execute() {
System.out.println(&amp;#34;Executing task with ID: &amp;#34; + taskId + &amp;#34; on instance: &amp;#34; + this);
}
// ... çœç•¥ getter å’Œ setter
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨å•ä¾‹ Bean ä¸­ä½¿ç”¨ &lt;code&gt;@Lookup&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public abstract class TaskService { // æ³¨æ„ï¼šç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»æˆ–æœ‰å¯é‡å†™çš„æ–¹æ³•
// ä½¿ç”¨ @Lookup æ³¨è§£ä¸€ä¸ªæ–¹æ³•
@Lookup // value å¯æŒ‡å®š Bean åï¼Œè‹¥çœç•¥åˆ™æŒ‰è¿”å›ç±»å‹æŸ¥æ‰¾
protected abstract TaskExecutor getTaskExecutor(); // æ–¹æ³•ä½“è¿”å› null å³å¯
public void processTask(String taskId) {
TaskExecutor executor = getTaskExecutor(); // æ¯æ¬¡è°ƒç”¨éƒ½è·å–æ–°å®ä¾‹
executor.setTaskId(taskId);
executor.execute();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-æµ‹è¯•ä¸æ•ˆæœ"&gt;2. æµ‹è¯•ä¸æ•ˆæœ
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootTest
public class TaskServiceTest {
@Autowired
private TaskService taskService;
@Test
public void testLookup() {
taskService.processTask(&amp;#34;Task-1&amp;#34;);
taskService.processTask(&amp;#34;Task-2&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é¢„æœŸè¾“å‡º&lt;/strong&gt;ï¼ˆå®ä¾‹çš„å“ˆå¸Œå€¼æ¯æ¬¡ä¸åŒï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Executing task with ID: Task-1 on instance: com.example.TaskExecutor@5e8c92f4
Executing task with ID: Task-2 on instance: com.example.TaskExecutor@2f0a87c5
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-å·¥ä½œåŸç†cglib-ä»£ç†"&gt;âš™ï¸ å·¥ä½œåŸç†ï¼šCGLIB ä»£ç†
&lt;/h3&gt;&lt;p&gt;Spring åœ¨å¯åŠ¨æ—¶ï¼Œå¦‚æœå‘ç°æŸä¸ª Bean çš„æ–¹æ³•ä¸Šæœ‰ &lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£ï¼Œå®ƒä¼šä¸ºè¯¥ Bean åŠ¨æ€ç”Ÿæˆä¸€ä¸ª &lt;strong&gt;CGLIB ä»£ç†å­ç±»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£ææ³¨è§£&lt;/strong&gt;ï¼šSpring å®¹å™¨åœ¨åˆå§‹åŒ–å•ä¾‹ Beanï¼ˆå¦‚ &lt;code&gt;TaskService&lt;/code&gt;ï¼‰æ—¶ï¼Œä¼šæ‰«æå…¶æ–¹æ³•ã€‚å‘ç° &lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£åï¼ŒSpring ä¼šå°†æ­¤æ–¹æ³•ä¿¡æ¯å°è£…ä¸ºä¸€ä¸ª &lt;code&gt;LookupOverride&lt;/code&gt;å¯¹è±¡ï¼Œå¹¶å­˜å‚¨åˆ°è¯¥ Bean çš„ &lt;code&gt;BeanDefinition&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºä»£ç†&lt;/strong&gt;ï¼šç”±äº &lt;code&gt;TaskService&lt;/code&gt;çš„ &lt;code&gt;BeanDefinition&lt;/code&gt;ä¸­åŒ…å«äº†éœ€è¦é‡å†™çš„æ–¹æ³•ï¼ˆ&lt;code&gt;LookupOverride&lt;/code&gt;ï¼‰ï¼ŒSpring ä¸ä¼šç›´æ¥å®ä¾‹åŒ–åŸå§‹çš„ &lt;code&gt;TaskService&lt;/code&gt;ï¼Œè€Œæ˜¯é€šè¿‡ &lt;code&gt;CglibSubclassingInstantiationStrategy&lt;/code&gt;åˆ›å»ºä¸€ä¸ª CGLIB å¢å¼ºçš„å­ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•æ‹¦æˆª&lt;/strong&gt;ï¼šåœ¨è¿™ä¸ªä»£ç†å­ç±»ä¸­ï¼Œè¢« &lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;getTaskExecutor()&lt;/code&gt;ï¼‰ä¼šè¢«é‡å†™ã€‚å…¶é€»è¾‘ç”± &lt;code&gt;LookupOverrideMethodInterceptor&lt;/code&gt;æ‹¦æˆªå™¨å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è·å– Bean&lt;/strong&gt;ï¼šå½“è°ƒç”¨ &lt;code&gt;getTaskExecutor()&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œæ‹¦æˆªå™¨ä¼šä»‹å…¥æ‰§è¡Œã€‚å®ƒä¼šæ ¹æ®æ³¨è§£ä¸ŠæŒ‡å®šçš„ Bean åç§°ï¼ˆæˆ–æ–¹æ³•çš„è¿”å›ç±»å‹ï¼‰&lt;strong&gt;è°ƒç”¨ &lt;code&gt;beanFactory.getBean(...)&lt;/code&gt;&lt;/strong&gt; æ–¹æ³•ï¼Œä» Spring å®¹å™¨ä¸­å®æ—¶è·å–ä¸€ä¸ªæ–°çš„ &lt;code&gt;TaskExecutor&lt;/code&gt;å®ä¾‹å¹¶è¿”å›ã€‚è¿™æ ·å°±ä¿è¯äº†æ¯æ¬¡è°ƒç”¨éƒ½è·å¾—çš„æ˜¯æœ€æ–°çš„åŸå‹ Bean å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¸¸è§åº”ç”¨åœºæ™¯"&gt;ğŸ“Œ å¸¸è§åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…å•ä¾‹ä¸­çš„åŸå‹å¤±æ•ˆ&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€ç»å…¸çš„åœºæ™¯ã€‚å½“ä¸€ä¸ªå•ä¾‹ Bean éœ€è¦é€šè¿‡ä¾èµ–æ³¨å…¥ä½¿ç”¨ä¸€ä¸ªåŸå‹ Beanï¼Œä¸”å¸Œæœ›&lt;strong&gt;æ¯æ¬¡æ“ä½œéƒ½ä½¿ç”¨ä¸€ä¸ªæ–°çš„åŸå‹å®ä¾‹&lt;/strong&gt;æ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆçš„é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ObjectFactory&lt;/code&gt;/ &lt;code&gt;Provider&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯æ›´ç°ä»£å’Œçµæ´»çš„é€‰æ‹©ï¼Œæ— éœ€æŠ½è±¡ç±»æˆ–æ–¹æ³•æ³¨å…¥ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class TaskService {
@Autowired
private ObjectFactory&amp;lt;TaskExecutor&amp;gt; taskExecutorFactory; // æˆ– Provider&amp;lt;TaskExecutor&amp;gt;
public void processTask(String taskId) {
TaskExecutor executor = taskExecutorFactory.getObject(); // æ¯æ¬¡è°ƒç”¨ getObject()
executor.setTaskId(taskId);
executor.execute();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›´æ¥æ³¨å…¥ &lt;code&gt;ApplicationContext&lt;/code&gt;&lt;/strong&gt;ï¼šè™½ç„¶çµæ´»ï¼Œä½†ä¼šä½¿ä»£ç ä¸ Spring API è€¦åˆï¼Œä¸æ¨èä½œä¸ºé¦–é€‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private ApplicationContext applicationContext;
public void processTask() {
TaskExecutor executor = applicationContext.getBean(TaskExecutor.class);
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç±»ä¸æ–¹æ³•è®¾è®¡&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åŒ…å« &lt;code&gt;@Lookup&lt;/code&gt;æ–¹æ³•çš„ç±»&lt;strong&gt;ä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;&lt;/strong&gt;ï¼Œå¦åˆ™æ— æ³•è¢« CGLIB ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¢«æ³¨è§£çš„æ–¹æ³•&lt;strong&gt;ä¸èƒ½æ˜¯ &lt;code&gt;private&lt;/code&gt;, &lt;code&gt;final&lt;/code&gt;æˆ– &lt;code&gt;static&lt;/code&gt;&lt;/strong&gt;ã€‚Spring éœ€è¦èƒ½é‡å†™è¯¥æ–¹æ³•ã€‚é€šå¸¸å°†å…¶å®šä¹‰ä¸º &lt;strong&gt;&lt;code&gt;protected abstract&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•çš„å…·ä½“å®ç°ï¼ˆå³ä½¿è¿”å› &lt;code&gt;null&lt;/code&gt;ï¼‰&lt;strong&gt;åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«è°ƒç”¨&lt;/strong&gt;ï¼Œå› ä¸ºä»£ç†ä¼šå®Œå…¨è¦†ç›–å®ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¸è®¾è®¡&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;ï¼šæ¯æ¬¡è°ƒç”¨ &lt;code&gt;@Lookup&lt;/code&gt;æ–¹æ³•éƒ½ä¼šè§¦å‘ä¸€æ¬¡ä»å®¹å™¨ä¸­è·å– Bean çš„æ“ä½œï¼ˆæœ¬è´¨æ˜¯ &lt;code&gt;getBean()&lt;/code&gt;ï¼‰ï¼Œè¿™å¯èƒ½å¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨é«˜æ€§èƒ½æˆ–å¾ªç¯ä¸­é¢‘ç¹è°ƒç”¨çš„åœºæ™¯ã€‚åŒæ—¶ï¼ŒCGLIB ä»£ç†çš„åˆ›å»ºæœ¬èº«ä¹Ÿæœ‰æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡è€ƒé‡&lt;/strong&gt;ï¼š&lt;code&gt;@Lookup&lt;/code&gt;ä¼šå¼•å…¥ &lt;strong&gt;â€œé­”æ³•â€&lt;/strong&gt; ï¼ˆMagicï¼‰ï¼Œå³ä»£ç è¡Œä¸ºå¹¶éç›´æ¥æ˜¾è€Œæ˜“è§ï¼Œè¿™å¯èƒ½å¢åŠ ä»£ç çš„ç†è§£å’Œç»´æŠ¤éš¾åº¦ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ &lt;code&gt;ObjectFactory&lt;/code&gt;æˆ– &lt;code&gt;Provider&lt;/code&gt;&lt;/strong&gt; ä½œä¸ºæ›´æ˜ç¡®ä¸”ä¾µå…¥æ€§æ›´ä½çš„æ›¿ä»£æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨åŸŸä¸æ­§ä¹‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¢«æŸ¥æ‰¾çš„ Beanï¼ˆå¦‚ &lt;code&gt;TaskExecutor&lt;/code&gt;ï¼‰&lt;strong&gt;å¿…é¡»æ˜ç¡®é…ç½®ä¸ºåŸå‹ä½œç”¨åŸŸ&lt;/strong&gt;ï¼ˆ&lt;code&gt;@Scope(&amp;quot;prototype&amp;quot;)&lt;/code&gt;ï¼‰ï¼Œå¦åˆ™ &lt;code&gt;@Lookup&lt;/code&gt;å°†å¤±æ•ˆï¼Œæ¯æ¬¡è¿”å›çš„è¿˜æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„ Beanï¼ˆä¾‹å¦‚ &lt;code&gt;TaskExecutor&lt;/code&gt;æœ‰å¤šä¸ªå®ç°ï¼‰ï¼Œ&lt;strong&gt;å¿…é¡»åœ¨ &lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£çš„ &lt;code&gt;value&lt;/code&gt;å±æ€§ä¸­æŒ‡å®šå…·ä½“çš„ Bean åç§°&lt;/strong&gt;ï¼Œå¦åˆ™ Spring ä¼šå› æ— æ³•ç¡®å®šæ³¨å…¥å“ªä¸ª Bean è€ŒæŠ›å‡º &lt;code&gt;NoUniqueBeanDefinitionException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;@Lookup&lt;/code&gt;æ³¨è§£æ˜¯ Spring æä¾›çš„ä¸€ç§å¼ºå¤§ä½†&lt;strong&gt;è¾ƒä¸ºç‰¹æ®Š&lt;/strong&gt;çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ã€‚å®ƒèƒ½ä¼˜é›…åœ°è§£å†³å•ä¾‹ Bean ä¾èµ–åŸå‹ Bean æ—¶çš„å®ä¾‹å¤±æ•ˆé—®é¢˜ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯åŸºäº CGLIB ä»£ç†è¿›è¡Œæ–¹æ³•é‡å†™å’ŒåŠ¨æ€æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œåœ¨ç°ä»£ Spring å¼€å‘ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;ObjectFactory&lt;/code&gt;æˆ– &lt;code&gt;Provider&lt;/code&gt;é€šå¸¸æ˜¯æ›´è¢«æ¨èçš„é€‰æ‹©&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒä»¬æ›´ç®€å•ã€æ›´çµæ´»ï¼Œä¸”ä¸ä¼šè¦æ±‚å°†ç±»å®šä¹‰ä¸ºæŠ½è±¡ç±»ã€‚è¯·æ ¹æ®ä½ çš„å…·ä½“åœºæ™¯å’Œæ¶æ„åå¥½åšå‡ºé€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="bean-åˆ›å»ºé¡ºåº"&gt;@Bean åˆ›å»ºé¡ºåº
&lt;/h2&gt;&lt;p&gt;ç†è§£ Spring ä¸­ &lt;code&gt;@Bean&lt;/code&gt;çš„åˆå§‹åŒ–é¡ºåºç¡®å®å¾ˆé‡è¦ï¼Œå®ƒå…³ç³»åˆ°ä¾èµ–æ³¨å…¥æ˜¯å¦æ­£ç¡®å’Œåº”ç”¨ç¨‹åºèƒ½å¦æ­£å¸¸å¯åŠ¨ã€‚ä¸‹é¢æˆ‘å°†ä¸ºä½ è¯¦ç»†è§£é‡Šã€‚&lt;/p&gt;
&lt;p&gt;å½±å“ &lt;code&gt;@Bean&lt;/code&gt;åˆå§‹åŒ–é¡ºåºçš„å› ç´ ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼ŒæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ’åˆ—ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å½±å“å› ç´ &lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;ä¼˜å…ˆçº§&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¾å¼ä¾èµ– (&lt;code&gt;@DependsOn&lt;/code&gt;)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡æ³¨è§£ç›´æ¥ã€æ˜ç¡®åœ°æŒ‡å®š Bean çš„ä¾èµ–å…³ç³»ï¼Œå¼ºåˆ¶è¢«ä¾èµ–çš„ Bean å…ˆåˆå§‹åŒ–ã€‚&lt;/td&gt;
&lt;td&gt;æœ€é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éšå¼ä¾èµ– (æ„é€ å™¨å‚æ•°)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­å£°æ˜ä¾èµ–ï¼ŒSpring ä¼šè‡ªåŠ¨å…ˆåˆå§‹åŒ–è¿™äº›å‚æ•°ä»£è¡¨çš„ Beanã€‚&lt;/td&gt;
&lt;td&gt;å¾ˆé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®ç±»åŠ è½½é¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸åŒé…ç½®ç±»ä¸­çš„ &lt;code&gt;@Bean&lt;/code&gt;ï¼Œå…¶åˆå§‹åŒ–é¡ºåºä¸é…ç½®ç±»æœ¬èº«çš„åŠ è½½é¡ºåºæœ‰å…³ã€‚&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒé…ç½®ç±»ä¸­çš„å£°æ˜é¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é€šå¸¸&lt;/strong&gt;æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªé…ç½®ç±»ä¸­çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¼šæŒ‰ç…§å…¶&lt;strong&gt;å®šä¹‰é¡ºåº&lt;/strong&gt;ä»ä¸Šåˆ°ä¸‹è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/td&gt;
&lt;td&gt;è¾ƒä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Order&lt;/code&gt;æ³¨è§£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦ç”¨äºå½±å“æŸäº›&lt;strong&gt;é›†åˆ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;List&lt;/code&gt;ï¼‰ä¸­ Bean çš„&lt;strong&gt;æ³¨å…¥é¡ºåº&lt;/strong&gt;ï¼Œè€Œé Bean çš„&lt;strong&gt;åˆå§‹åŒ–é¡ºåº&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;ä¸é€‚ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çœ‹çœ‹è¿™äº›æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id="-æ§åˆ¶åˆå§‹åŒ–é¡ºåºçš„ä¸»è¦æ–¹å¼"&gt;ğŸ”§ æ§åˆ¶åˆå§‹åŒ–é¡ºåºçš„ä¸»è¦æ–¹å¼
&lt;/h3&gt;&lt;h4 id="1-æ˜¾å¼ä¾èµ–å…³ç³»-dependson"&gt;1. æ˜¾å¼ä¾èµ–å…³ç³» (&lt;code&gt;@DependsOn&lt;/code&gt;)
&lt;/h4&gt;&lt;p&gt;å½“ Bean A ä¾èµ–äº Bean Bï¼Œä½†è¿™ç§ä¾èµ–å…³ç³»&lt;strong&gt;æ— æ³•é€šè¿‡æ„é€ å™¨å‚æ•°æˆ–Setteræ–¹æ³•ç›´è§‚ä½“ç°&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼ŒBean A çš„åˆå§‹åŒ–éœ€è¦ Bean B å…ˆå®ŒæˆæŸäº›é™æ€é…ç½®æˆ–åå°çº¿ç¨‹å¯åŠ¨ï¼‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;@DependsOn&lt;/code&gt;æ³¨è§£æ¥æ˜¾å¼æŒ‡å®šã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean
public BeanB beanB() {
return new BeanB();
}
@Bean
@DependsOn(&amp;#34;beanB&amp;#34;) // æ˜ç¡®æŒ‡å®š beanB å¿…é¡»åœ¨ beanA ä¹‹å‰åˆå§‹åŒ–
public BeanA beanA() {
return new BeanA();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;beanB&lt;/code&gt;â†’ &lt;code&gt;beanA&lt;/code&gt;&lt;/p&gt;
&lt;h4 id="2-éšå¼ä¾èµ–å…³ç³»æ„é€ å™¨å‚æ•°"&gt;2. éšå¼ä¾èµ–å…³ç³»ï¼ˆæ„é€ å™¨å‚æ•°ï¼‰
&lt;/h4&gt;&lt;p&gt;æœ€è‡ªç„¶ã€æœ€æ¨èçš„æ–¹å¼ã€‚é€šè¿‡åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­å£°æ˜ä¾èµ–ï¼ŒSpring ä¼š&lt;strong&gt;è‡ªåŠ¨&lt;/strong&gt;å…ˆåˆå§‹åŒ–è¿™äº›å‚æ•°æ‰€ä»£è¡¨çš„ Beanã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class DatabaseConfig {
@Bean
public DataSource dataSource() {
// åˆå§‹åŒ–æ•°æ®æº
return new DataSource();
}
// dataSource å‚æ•°ä¼šä¿ƒä½¿Springå…ˆåˆå§‹åŒ–dataSource() Bean
@Bean
public JdbcTemplate jdbcTemplate(DataSource dataSource) {
// ä¾èµ–æ³¨å…¥ dataSource
return new JdbcTemplate(dataSource);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;dataSource&lt;/code&gt;â†’ &lt;code&gt;jdbcTemplate&lt;/code&gt;&lt;/p&gt;
&lt;h4 id="3-é…ç½®ç±»åŠ è½½ä¸åŒé…ç½®ç±»ä¸­çš„é¡ºåº"&gt;3. é…ç½®ç±»åŠ è½½ä¸åŒé…ç½®ç±»ä¸­çš„é¡ºåº
&lt;/h4&gt;&lt;p&gt;Spring åœ¨åŠ è½½é…ç½®ç±»æ—¶ï¼Œå…¶å†…éƒ¨çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•&lt;strong&gt;é€šå¸¸&lt;/strong&gt;ä¼šæŒ‰ç…§å…¶åœ¨ä»£ç ä¸­çš„&lt;strong&gt;å£°æ˜é¡ºåº&lt;/strong&gt;ï¼ˆä»ä¸Šè‡³ä¸‹ï¼‰è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class ConfigOrderExample {
@Bean
public FirstBean firstBean() {
return new FirstBean(); // é€šå¸¸å…ˆåˆå§‹åŒ–
}
@Bean
public SecondBean secondBean() {
return new SecondBean(); // é€šå¸¸ååˆå§‹åŒ–
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­¤è¡Œä¸ºå¹¶éç»å¯¹ç”± Spring è§„èŒƒä¿è¯ï¼Œä½†åœ¨å®è·µä¸­ï¼ŒSpring é€šè¿‡ &lt;code&gt;LinkedHashSet&lt;/code&gt;å­˜å‚¨æ–¹æ³•å…ƒæ•°æ®ï¼Œä»è€Œç»´æŠ¤äº†å£°æ˜é¡ºåºã€‚&lt;strong&gt;æ›´å¯é çš„åšæ³•æ˜¯ä½¿ç”¨æ„é€ å™¨å‚æ•°æˆ– &lt;code&gt;@DependsOn&lt;/code&gt;æ¥æ˜ç¡®ä¾èµ–ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id="4-ä½¿ç”¨-orderæ³¨è§£"&gt;4. ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é‡è¦æç¤º&lt;/strong&gt;ï¼š&lt;code&gt;@Order&lt;/code&gt;æ³¨è§£ä¸»è¦ç”¨æ¥æŒ‡å®šä¸€ä¸ª&lt;strong&gt;é›†åˆ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;List&lt;/code&gt;ï¼‰ä¸­å¤šä¸ª Bean çš„&lt;strong&gt;æ’åºæˆ–ä¼˜å…ˆçº§&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œå¤šä¸ª &lt;code&gt;HandlerInterceptor&lt;/code&gt;çš„æ‰§è¡Œé¡ºåºï¼‰ï¼Œæˆ–è€…å½±å“ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•åœ¨é…ç½®ç±»ä¸­çš„æ£€ç´¢é¡ºåºï¼ˆåº•å±‚ä½¿ç”¨ &lt;code&gt;LinkedHashSet&lt;/code&gt;ï¼Œä½†æ•ˆæœä¸ç›´è§‚ï¼‰ã€‚&lt;strong&gt;å®ƒå¹¶ä¸ç›´æ¥æˆ–å¯é åœ°æ§åˆ¶ Bean çš„åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸé¡ºåº&lt;/strong&gt;ã€‚å¯¹äºåˆå§‹åŒ–é¡ºåºï¼Œåº”ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@DependsOn&lt;/code&gt;æˆ–æ„é€ å™¨å‚æ•°ã€‚&lt;/p&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šæœ€å…³é”®çš„æ³¨æ„äº‹é¡¹ã€‚å¦‚æœ Bean A ä¾èµ– Bean Bï¼Œè€Œ Bean B åˆä¾èµ– Bean Aï¼ŒSpring è™½ç„¶èƒ½é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶è§£å†³&lt;strong&gt;å•ä¾‹Bean&lt;/strong&gt;çš„&lt;strong&gt;Setteræ³¨å…¥&lt;/strong&gt;å¾ªç¯ä¾èµ–ï¼Œä½†&lt;strong&gt;æ„é€ å™¨æ³¨å…¥çš„å¾ªç¯ä¾èµ–æ— æ³•è§£å†³&lt;/strong&gt;ï¼Œä¼šå¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ã€‚åœ¨è®¾è®¡æ—¶åº”å°½é‡é¿å…å¾ªç¯ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è§£â€œåˆå§‹åŒ–â€çš„å«ä¹‰&lt;/strong&gt;ï¼šè¿™é‡Œçš„â€œåˆå§‹åŒ–é¡ºåºâ€æŒ‡çš„æ˜¯ Bean &lt;strong&gt;å®ä¾‹è¢«åˆ›å»ºã€å±æ€§è¢«æ³¨å…¥ã€ä»¥åŠå„ç§åˆå§‹åŒ–å›è°ƒï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ï¼‰è¢«æ‰§è¡Œ&lt;/strong&gt;çš„æ—¶æœºã€‚ä¸€ä¸ª Bean åªæœ‰å®Œå…¨åˆå§‹åŒ–åï¼Œæ‰èƒ½è¢«æ³¨å…¥åˆ°å…¶ä»–ä¾èµ–å®ƒçš„ Bean ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå‹ Bean (Prototype)&lt;/strong&gt;ï¼šå¯¹äºä½œç”¨åŸŸä¸º &lt;code&gt;prototype&lt;/code&gt;çš„ Beanï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å®ƒä»¬çš„â€œåˆå§‹åŒ–â€å‘ç”Ÿåœ¨æ¯æ¬¡è¢«è·å–æ—¶ï¼Œå› æ­¤å…¶é¡ºåºæ›´ä¾èµ–äºåº”ç”¨ç¨‹åºçš„è°ƒç”¨é€»è¾‘ï¼Œè€Œä¸æ˜¯å®¹å™¨å¯åŠ¨æ—¶çš„é¢„å®šä¹‰é¡ºåºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§é€‰æ‹©&lt;/strong&gt;ï¼š&lt;strong&gt;éšå¼ä¾èµ–ï¼ˆæ„é€ å™¨å‚æ•°ï¼‰æ˜¯æœ€ç›´æ¥å’Œæ¨èçš„æ–¹å¼&lt;/strong&gt;ã€‚åªæœ‰åœ¨æ— æ³•é€šè¿‡æ„é€ å™¨å‚æ•°è¡¨è¾¾ä¾èµ–å…³ç³»æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨ &lt;code&gt;@DependsOn&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’¡ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;è¦å¯é åœ°æ§åˆ¶ &lt;code&gt;@Bean&lt;/code&gt;çš„åˆå§‹åŒ–é¡ºåºï¼Œè®°ä½ä»¥ä¸‹åŸåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¦–é€‰æ„é€ å™¨å‚æ•°&lt;/strong&gt;ï¼šè®© Spring è‡ªåŠ¨å¤„ç†ä¾èµ–ï¼Œè¿™æ˜¯æœ€è‡ªç„¶ä¸”ä¸æ˜“å‡ºé”™çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿…è¦æ—¶ç”¨ &lt;code&gt;@DependsOn&lt;/code&gt;&lt;/strong&gt;ï¼šå½“å­˜åœ¨éç›´æ¥çš„ã€éšå¼çš„åˆå§‹åŒ–ä¾èµ–æ—¶ï¼Œä½¿ç”¨ &lt;code&gt;@DependsOn&lt;/code&gt;è¿›è¡Œæ˜¾å¼å£°æ˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦ä¾èµ–åŒé…ç½®ç±»ä¸­çš„å£°æ˜é¡ºåº&lt;/strong&gt;ï¼šè™½ç„¶é€šå¸¸æœ‰æ•ˆï¼Œä½†å¹¶éç»å¯¹å¯é ï¼Œä¸åº”ä½œä¸ºä¿è¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ§åˆ¶åˆå§‹åŒ–é¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;@Order&lt;/code&gt;ä¸»è¦ç”¨äºé›†åˆæ’åºï¼Œè€Œéç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œæ§åˆ¶ Spring Bean çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id="å•ä¸ª-bean-åˆå§‹åŒ–"&gt;å•ä¸ª Bean åˆå§‹åŒ–
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ Spring Bean çš„åˆå§‹åŒ–é¡ºåºå¯¹ç¼–å†™å¯é ä»£ç å¾ˆé‡è¦ã€‚é€šè¿‡ä¸‹é¢çš„è¡¨æ ¼ï¼Œä½ å¯ä»¥å¿«é€Ÿäº†è§£è¿™ä¸‰ç§åˆå§‹åŒ–æ–¹å¼çš„æ ¸å¿ƒç‰¹å¾å’ŒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@PostConstruct&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;InitializingBean.afterPropertiesSet()&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;init-method&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ€å…ˆæ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;å…¶æ¬¡æ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;æœ€åæ‰§è¡Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäº &lt;strong&gt;JSR-250&lt;/strong&gt; Java æ ‡å‡†æ³¨è§£&lt;/td&gt;
&lt;td&gt;å®ç° Spring ç‰¹å®šçš„ &lt;strong&gt;InitializingBean&lt;/strong&gt; æ¥å£&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;strong&gt;XML&lt;/strong&gt; æˆ– &lt;strong&gt;&lt;code&gt;@Bean(initMethod=&amp;quot;...&amp;quot;)&lt;/code&gt;&lt;/strong&gt; é…ç½®æŒ‡å®šæ–¹æ³•å&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾µå…¥æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt; (ä»…éœ€æ³¨è§£ï¼Œä¸æ¡†æ¶è§£è€¦)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt; (éœ€å®ç° Spring æ¥å£ï¼Œä¸æ¡†æ¶è€¦åˆ)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ— &lt;/strong&gt; (æ— éœ€ä¿®æ”¹Beanæºç )&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•å&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»»æ„&lt;/td&gt;
&lt;td&gt;å›ºå®šä¸º &lt;strong&gt;&lt;code&gt;afterPropertiesSet()&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»»æ„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šæ–¹æ³•æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ (æŒ‰å£°æ˜é¡ºåºæ‰§è¡Œ)&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ (ä»…æ­¤ä¸€ä¸ªæ–¹æ³•)&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ (æ¯ä¸ªBeané€šå¸¸æŒ‡å®šä¸€ä¸ªæ–¹æ³•)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¨èçš„é¦–é€‰æ–¹å¼&lt;/strong&gt;ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åˆå§‹åŒ–åœºæ™¯&lt;/td&gt;
&lt;td&gt;éœ€è¦ä¸Springç”Ÿå‘½å‘¨æœŸç´§å¯†é›†æˆæˆ–å…¼å®¹æ—§ä»£ç çš„åœºæ™¯&lt;/td&gt;
&lt;td&gt;åˆå§‹åŒ–&lt;strong&gt;ç¬¬ä¸‰æ–¹åº“&lt;/strong&gt;çš„Beanæˆ–æ— æ³•ä¿®æ”¹æºç çš„ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰ç§åˆå§‹åŒ–æ–¹å¼è¯¦è§£"&gt;ğŸ› ï¸ ä¸‰ç§åˆå§‹åŒ–æ–¹å¼è¯¦è§£
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@PostConstruct&lt;/code&gt;æ³¨è§£ (JSR-250æ ‡å‡†)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æ³•&lt;/strong&gt;ï¼šåœ¨æ–¹æ³•ä¸Šæ·»åŠ  &lt;code&gt;@PostConstruct&lt;/code&gt;æ³¨è§£ã€‚è¯¥æ–¹æ³•åº”åœ¨ä¾èµ–æ³¨å…¥å®Œæˆåæ‰§è¡Œä»»ä½•åˆå§‹åŒ–é€»è¾‘ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import javax.annotation.PostConstruct;
@Component
public class CacheService {
@PostConstruct
public void initCache() {
System.out.println(&amp;#34;1. @PostConstruct: ç¼“å­˜é¢„çƒ­å®Œæˆï¼&amp;#34;);
// åˆå§‹åŒ–é€»è¾‘ï¼Œå¦‚åŠ è½½é…ç½®ã€å»ºç«‹æ•°æ®è¿æ¥ç­‰
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºJavaæ ‡å‡†ï¼Œä¸Springæ¡†æ¶&lt;strong&gt;è§£è€¦&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•åå¯ä»»æ„ï¼Œä½†å¿…é¡»ä¸º&lt;strong&gt;æ— å‚&lt;/strong&gt;æ–¹æ³•ï¼Œè¿”å›ç±»å‹é€šå¸¸ä¸º &lt;code&gt;void&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;InitializingBean&lt;/code&gt;æ¥å£&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æ³•&lt;/strong&gt;ï¼šBean å®ç° &lt;code&gt;InitializingBean&lt;/code&gt;æ¥å£å¹¶é‡å†™ &lt;code&gt;afterPropertiesSet()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.InitializingBean;
@Component
public class DatabaseConnector implements InitializingBean {
@Override
public void afterPropertiesSet() throws Exception {
System.out.println(&amp;#34;2. InitializingBean: æ•°æ®åº“è¿æ¥å·²å»ºç«‹ï¼&amp;#34;);
// åˆå§‹åŒ–é€»è¾‘ï¼Œå¦‚æ ¡éªŒæ³¨å…¥çš„å±æ€§ç­‰
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¾èµ–&lt;/strong&gt;Springæ¡†æ¶æ¥å£ï¼Œ&lt;strong&gt;ä¾µå…¥æ€§è¾ƒé«˜&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨äºéœ€è¦ç¡®ä¿åˆå§‹åŒ–é€»è¾‘åœ¨ç‰¹å®šæ—¶æœºæ‰§è¡Œçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;init-method&lt;/code&gt;é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æ³•&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ &lt;code&gt;@Bean(initMethod = &amp;quot;...&amp;quot;)&lt;/code&gt;æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean(initMethod = &amp;#34;setup&amp;#34;)
public ExternalService externalService() {
return new ExternalService();
}
}
public class ExternalService { // è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œæ— éœ€Springæ³¨è§£
public void setup() { // æ–¹æ³•åå¯ä»»æ„
System.out.println(&amp;#34;3. init-method: å¤–éƒ¨æœåŠ¡åˆå§‹åŒ–å®Œæˆï¼&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®Œå…¨è§£è€¦&lt;/strong&gt;ï¼ŒBeanç±»æœ¬èº«æ— éœ€ä»»ä½•Springä¾èµ–æˆ–æ³¨è§£ã€‚&lt;/li&gt;
&lt;li&gt;éå¸¸é€‚ç”¨äº&lt;strong&gt;åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»&lt;/strong&gt;ï¼Œæˆ–è€…éœ€è¦é€šè¿‡å¤–éƒ¨é…ç½®çµæ´»æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰§è¡Œé¡ºåºèƒŒåçš„åŸç†"&gt;âš™ï¸ æ‰§è¡Œé¡ºåºèƒŒåçš„åŸç†
&lt;/h3&gt;&lt;p&gt;Spring Bean çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯ç²¾å¿ƒè®¾è®¡çš„ã€‚ä¸Šè¿°é¡ºåºä¹‹æ‰€ä»¥å›ºå®šï¼Œæ˜¯å› ä¸ºå®ƒä»¬åœ¨ Spring å®¹å™¨çš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@PostConstruct&lt;/code&gt;&lt;/strong&gt;ï¼šç”± &lt;code&gt;CommonAnnotationBeanPostProcessor&lt;/code&gt;å¤„ç†ã€‚å®ƒæ˜¯ä¸€ä¸ª &lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼Œå…¶ &lt;code&gt;postProcessBeforeInitialization&lt;/code&gt;æ–¹æ³•ä¼šåœ¨&lt;strong&gt;åˆå§‹åŒ–é˜¶æ®µçš„æœ€å¼€å§‹&lt;/strong&gt;æ‰«æå¹¶æ‰§è¡Œæ‰€æœ‰å¸¦ &lt;code&gt;@PostConstruct&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;InitializingBean.afterPropertiesSet()&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;BeanPostProcessor&lt;/code&gt;å‰ç½®å¤„ç†å®Œæˆåï¼ŒSpring ä¼šæ£€æŸ¥ Bean æ˜¯å¦å®ç°äº† &lt;code&gt;InitializingBean&lt;/code&gt;æ¥å£ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è°ƒç”¨å…¶ &lt;code&gt;afterPropertiesSet()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;init-method&lt;/code&gt;&lt;/strong&gt;ï¼šæœ€åï¼ŒSpring ä¼šæ£€æŸ¥ Bean çš„å®šä¹‰ï¼ˆ&lt;code&gt;BeanDefinition&lt;/code&gt;ï¼‰ä¸­æ˜¯å¦é…ç½®äº†è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™é€šè¿‡åå°„è°ƒç”¨å®ƒã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼š&lt;code&gt;BeanPostProcessor&lt;/code&gt;æ˜¯â€œå…¨å±€æ’ä»¶â€ï¼Œå®ƒçš„é€»è¾‘æœ€å…ˆæ‰§è¡Œã€‚ç„¶åæ‰æ˜¯å¤„ç† Bean è‡ªèº«çš„ç‰¹å®šæ¥å£ï¼ˆ&lt;code&gt;InitializingBean&lt;/code&gt;ï¼‰ï¼Œæœ€åæ˜¯å¤„ç†ç”¨æˆ·é€šè¿‡é…ç½®ä»»æ„æŒ‡å®šçš„æ–¹æ³•ï¼ˆ&lt;code&gt;init-method&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é€‰æ‹©å»ºè®®ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ’¡ é€‰æ‹©å»ºè®®ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç°ä»£ Spring åº”ç”¨çš„é¦–é€‰æ˜¯ &lt;code&gt;@PostConstruct&lt;/code&gt;&lt;/strong&gt;ã€‚å®ƒä»£ç ç®€æ´ã€ä¾µå…¥æ€§ä½ï¼Œå¹¶ä¸”ç¬¦åˆ Java æ ‡å‡†ï¼Œæ˜¯ç›®å‰æœ€æ¨èçš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;InitializingBean&lt;/code&gt;æ¥å£åœ¨ç°ä»£åº”ç”¨ä¸­å·²ä¸å¸¸ç”¨&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ä»£ç ä¸ Spring æ¡†æ¶ç´§è€¦åˆã€‚é€šå¸¸ä»…åœ¨éœ€è¦ä¸æ—§ä»£ç å…¼å®¹æˆ–æ¡†æ¶æ˜ç¡®è¦æ±‚æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;init-method&lt;/code&gt;åœ¨ä¸æ— æ³•ä¿®æ”¹æºç çš„ç¬¬ä¸‰æ–¹åº“é…åˆæ—¶éå¸¸æœ‰ç”¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åœ¨åŒä¸€ä¸ª Bean ä¸­æ··åˆä½¿ç”¨å¤šç§æ–¹å¼&lt;/strong&gt;ï¼Œé™¤éä½ éå¸¸æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„é¡ºåºå’Œé€»è¾‘ï¼Œå¦åˆ™ä¼šä½¿ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰€æœ‰åˆå§‹åŒ–æ–¹æ³•ä¸­éƒ½åº”å¦¥å–„å¤„ç†å¼‚å¸¸&lt;/strong&gt;ã€‚å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œä¼šå¯¼è‡´ Bean åˆ›å»ºå¤±è´¥ï¼Œè¿›è€Œå¯èƒ½å½±å“åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¯åŠ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é‡è¦æé†’"&gt;âš ï¸ é‡è¦æé†’
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–æ³¨å…¥å®Œæˆ&lt;/strong&gt;ï¼šæ‰€æœ‰è¿™äº›åˆå§‹åŒ–æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå…±åŒå‰æï¼š&lt;strong&gt;Bean çš„ä¾èµ–æ³¨å…¥ï¼ˆä¾‹å¦‚é€šè¿‡ &lt;code&gt;@Autowired&lt;/code&gt;æ³¨å…¥çš„å±æ€§ï¼‰å·²ç»å®Œæˆ&lt;/strong&gt;ã€‚ä½ å¯ä»¥åœ¨è¿™äº›æ–¹æ³•ä¸­å®‰å…¨åœ°ä½¿ç”¨å…¶ä»–ä¾èµ–çš„ Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šè¦è­¦æƒ• Bean ä¹‹é—´çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚å¦‚æœä¸¤ä¸ª Bean ç›¸äº’ä¾èµ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆå§‹åŒ–é€»è¾‘å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œç”šè‡³é˜»æ­¢åº”ç”¨ä¸Šä¸‹æ–‡æ­£å¸¸å¯åŠ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´æ¸…æ¥šåœ°ç†è§£ Spring Bean çš„åˆå§‹åŒ–é¡ºåºå’Œæœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id="beanpostprocessor"&gt;BeanPostProcessor
&lt;/h2&gt;&lt;p&gt;BeanPostProcessor æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ªéå¸¸é‡è¦ä¸”å¼ºå¤§çš„æ‰©å±•æ¥å£ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨ Spring å®¹å™¨åˆ›å»º Bean å®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨ Bean åˆå§‹åŒ–å‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œå®ç°å¯¹ Bean çš„ä¿®æ”¹æˆ–å¢å¼ºã€‚ä¸‹é¢æˆ‘å°†ä»å¤šä¸ªæ–¹é¢ä¸ºä½ è¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨"&gt;ğŸ§  æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;BeanPostProcessor&lt;/strong&gt; æ˜¯ Spring æä¾›çš„ä¸€ä¸ªæ ¸å¿ƒæ‰©å±•ç‚¹ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œ&lt;strong&gt;å¼€æ”¾-å°é—­åŸåˆ™&lt;/strong&gt;â€ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚å®ƒå…è®¸ä½ åœ¨ä¸ä¿®æ”¹ Spring æºç å’ŒåŸæœ‰ Bean å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œä»‹å…¥ Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿›è¡Œå®šåˆ¶åŒ–å¤„ç†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•&lt;/strong&gt;ï¼šè¯¥æ¥å£å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;postProcessBeforeInitialization(Object bean, String beanName)&lt;/code&gt;: åœ¨ Bean çš„&lt;strong&gt;åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ã€&lt;code&gt;InitializingBean.afterPropertiesSet()&lt;/code&gt;æˆ–è‡ªå®šä¹‰çš„ &lt;code&gt;init-method&lt;/code&gt;ï¼‰ä¹‹å‰&lt;/strong&gt;è°ƒç”¨ã€‚å¸¸ç”¨äºæ‰§è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œï¼Œå¦‚ä¿®æ”¹å±æ€§å€¼ã€èµ„æºæ³¨å…¥æˆ–æ ¡éªŒæ£€æŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;postProcessAfterInitialization(Object bean, String beanName)&lt;/code&gt;: åœ¨ Bean çš„&lt;strong&gt;åˆå§‹åŒ–æ–¹æ³•ä¹‹å&lt;/strong&gt;è°ƒç”¨ã€‚é€šå¸¸ç”¨äºè¿”å›ä»£ç†å¯¹è±¡ï¼ˆå¦‚ AOP ä»£ç†ï¼‰æˆ–æ‰§è¡Œæœ€ç»ˆçš„åç½®å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡åˆè¡·&lt;/strong&gt;ï¼šBeanPostProcessor çš„è®¾è®¡ä½“ç°äº† Spring æ¡†æ¶çš„â€œ&lt;strong&gt;å¼€æ”¾å°é—­åŸåˆ™&lt;/strong&gt;â€ã€‚Spring å®¹å™¨è´Ÿè´£ Bean çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä½†åŒæ—¶é€šè¿‡ BeanPostProcessor è¿™ç§æ‰©å±•ç‚¹ï¼Œè®©å¼€å‘è€…å¯ä»¥åœ¨ä¸ä¿®æ”¹ Spring æºç çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹ Bean ç”Ÿå‘½å‘¨æœŸçš„è‡ªå®šä¹‰æ“ä½œï¼Œå¤§å¤§æå‡äº† Spring çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ‰§è¡Œæ—¶æœºä¸æµç¨‹"&gt;â° æ‰§è¡Œæ—¶æœºä¸æµç¨‹
&lt;/h3&gt;&lt;p&gt;BeanPostProcessor çš„æ‰§è¡ŒåµŒå…¥åœ¨ Bean çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œå…¶æ•´ä½“æµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹åŒ– Bean&lt;/strong&gt;ï¼ˆé€šè¿‡æ„é€ å‡½æ•°æˆ–å·¥å‚æ–¹æ³•ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¡«å…… Bean å±æ€§&lt;/strong&gt;ï¼ˆä¾èµ–æ³¨å…¥ï¼ŒPopulateï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BeanPostProcessor.postProcessBeforeInitialization()&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;, &lt;code&gt;InitializingBean.afterPropertiesSet()&lt;/code&gt;, è‡ªå®šä¹‰ &lt;code&gt;init-method&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BeanPostProcessor.postProcessAfterInitialization()&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bean å‡†å¤‡å°±ç»ª&lt;/strong&gt;ï¼Œå¯ä½¿ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Spring å®¹å™¨ä¼šéå†æ‰€æœ‰æ³¨å†Œçš„ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼Œå¹¶æŒ‰é¡ºåºä¾æ¬¡è°ƒç”¨å®ƒä»¬çš„å‰ç½®å’Œåç½®æ–¹æ³•ã€‚å¤šä¸ª &lt;code&gt;BeanPostProcessor&lt;/code&gt;å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£æˆ–ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚&lt;/p&gt;
&lt;h3 id="-å¸¸è§çš„å†…ç½®å®ç°"&gt;ğŸ”§ å¸¸è§çš„å†…ç½®å®ç°
&lt;/h3&gt;&lt;p&gt;Spring æ¡†æ¶å†…éƒ¨å¤§é‡ä½¿ç”¨äº† &lt;code&gt;BeanPostProcessor&lt;/code&gt;æ¥å®ç°å…¶æ ¸å¿ƒåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å®ç°ç±»&lt;/th&gt;
&lt;th&gt;ä¸»è¦åŠŸèƒ½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ApplicationContextAwareProcessor&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç†å„ç§ &lt;code&gt;Aware&lt;/code&gt;æ¥å£ï¼ˆå¦‚ &lt;code&gt;ApplicationContextAware&lt;/code&gt;ï¼‰ï¼Œç”¨äºå‘ Bean æ³¨å…¥å®¹å™¨ä¸Šä¸‹æ–‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;InitDestroyAnnotationBeanPostProcessor&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç† &lt;code&gt;@PostConstruct&lt;/code&gt;å’Œ &lt;code&gt;@PreDestroy&lt;/code&gt;ç”Ÿå‘½å‘¨æœŸæ³¨è§£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AutowiredAnnotationBeanPostProcessor&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç† &lt;code&gt;@Autowired&lt;/code&gt;å’Œ &lt;code&gt;@Value&lt;/code&gt;æ³¨è§£ï¼Œå®ç°è‡ªåŠ¨ä¾èµ–æ³¨å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CommonAnnotationBeanPostProcessor&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç† JSR-250 æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Resource&lt;/code&gt;ã€&lt;code&gt;@PostConstruct&lt;/code&gt;ã€&lt;code&gt;@PreDestroy&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AbstractAutoProxyCreator&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;AOP è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ï¼Œä¸º Bean åˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œæ˜¯å®ç° Spring AOP çš„å…³é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•è‡ªå®šä¹‰-beanpostprocessor"&gt;ğŸ› ï¸ å¦‚ä½•è‡ªå®šä¹‰ BeanPostProcessor
&lt;/h3&gt;&lt;p&gt;å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ &lt;code&gt;BeanPostProcessor&lt;/code&gt;é€šå¸¸åªéœ€ä¸‰æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ¥å£&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç° &lt;code&gt;BeanPostProcessor&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å†™æ–¹æ³•&lt;/strong&gt;ï¼šæ ¹æ®éœ€æ±‚åœ¨ &lt;code&gt;postProcessBeforeInitialization&lt;/code&gt;æˆ– &lt;code&gt;postProcessAfterInitialization&lt;/code&gt;ä¸­ç¼–å†™é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œåˆ°å®¹å™¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Component&lt;/code&gt;æ³¨è§£æˆ– &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å°†å…¶æ³¨å†Œä¸º Spring Beanï¼ŒSpring å®¹å™¨ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶åº”ç”¨å®ƒã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä¸‹é¢çš„ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ä¼šå°†æ‰€æœ‰ä»¥ &amp;ldquo;user&amp;rdquo; å¼€å¤´çš„ Bean çš„ String ç±»å‹å±æ€§å€¼è½¬ä¸ºå¤§å†™ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;
import org.springframework.stereotype.Component;
import java.lang.reflect.Field;
@Component
public class UpperCaseBeanPostProcessor implements BeanPostProcessor {
@Override
public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
if (beanName.startsWith(&amp;#34;user&amp;#34;)) {
Field[] fields = bean.getClass().getDeclaredFields();
for (Field field : fields) {
if (field.getType() == String.class) {
try {
field.setAccessible(true);
Object value = field.get(bean);
if (value instanceof String) {
field.set(bean, ((String) value).toUpperCase());
}
} catch (Exception e) {
throw new BeansException(&amp;#34;Failed to process String field&amp;#34;, e);
}
}
}
}
return bean;
}
@Override
public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
return bean;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;BeanPostProcessor&lt;/code&gt;çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;AOP ä¸åŠ¨æ€ä»£ç†&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;postProcessAfterInitialization&lt;/code&gt;ä¸­ä¸ºç‰¹å®š Bean åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå®ç°æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ç­‰åŠŸèƒ½ï¼ˆè¿™æ˜¯ Spring AOP çš„åº•å±‚åŸç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±æ€§å¤„ç†ä¸åŠ å¯†&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;postProcessBeforeInitialization&lt;/code&gt;ä¸­å¯¹ Bean çš„æ•æ„Ÿå±æ€§ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰è¿›è¡Œè§£å¯†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰æ³¨è§£å¤„ç†&lt;/strong&gt;ï¼šè¯†åˆ« Bean ä¸Šçš„è‡ªå®šä¹‰æ³¨è§£ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼ˆå¦‚æ–¹æ³•çº§åˆ«çš„æƒé™æ£€æŸ¥æˆ–æ—¥å¿—è®°å½•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–æ£€æŸ¥ä¸éªŒè¯&lt;/strong&gt;ï¼šåœ¨åˆå§‹åŒ–å‰åæ£€æŸ¥å¿…éœ€çš„ä¾èµ–æ˜¯å¦å·²æ³¨å…¥ï¼Œæˆ–éªŒè¯å±æ€§å€¼çš„åˆæ³•æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ³¨å…¥ä¸åˆå§‹åŒ–&lt;/strong&gt;ï¼šåœ¨åˆå§‹åŒ–åä¸º Bean åŠ¨æ€æ³¨å…¥æŸäº›èµ„æºæˆ–æ‰§è¡Œé¢å¤–çš„åˆå§‹åŒ–æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯¹æ‰€æœ‰ Bean ç”Ÿæ•ˆ&lt;/strong&gt;ï¼šè‡ªå®šä¹‰çš„ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ä¼š&lt;strong&gt;å¯¹å®¹å™¨ä¸­æ‰€æœ‰çš„ Bean ç”Ÿæ•ˆ&lt;/strong&gt;ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†æ—¶åº”é€šè¿‡ &lt;code&gt;beanName&lt;/code&gt;æˆ– &lt;code&gt;bean.getClass()&lt;/code&gt;è¿›è¡Œè¿‡æ»¤ï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†å½±å“æ€§èƒ½å’Œå‡ºç°æ„å¤–é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;ï¼š&lt;code&gt;BeanPostProcessor&lt;/code&gt;ä¼šåœ¨æ¯ä¸ª Bean çš„åˆ›å»ºè¿‡ç¨‹ä¸­éƒ½è¢«è°ƒç”¨ï¼Œå› æ­¤å…¶ä¸­çš„é€»è¾‘åº”&lt;strong&gt;å°½å¯èƒ½é«˜æ•ˆ&lt;/strong&gt;ï¼Œé¿å…å¤æ‚è€—æ—¶çš„æ“ä½œï¼Œä»¥å…æ‹–æ…¢åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼šå¤šä¸ª &lt;code&gt;BeanPostProcessor&lt;/code&gt;çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ã€‚å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£æˆ–ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥æ˜ç¡®æŒ‡å®šå…¶é¡ºåºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ BeanFactoryPostProcessor çš„åŒºåˆ«&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼šæ“ä½œå¯¹è±¡æ˜¯ &lt;strong&gt;Bean å®ä¾‹&lt;/strong&gt;ï¼Œåœ¨ Bean&lt;strong&gt;å®ä¾‹åŒ–å&lt;/strong&gt;ä»‹å…¥ç”Ÿå‘½å‘¨æœŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;ï¼šæ“ä½œå¯¹è±¡æ˜¯ &lt;strong&gt;BeanDefinition&lt;/strong&gt;ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œåœ¨ Bean&lt;strong&gt;å®ä¾‹åŒ–å‰&lt;/strong&gt;ä»‹å…¥ï¼Œç”¨äºä¿®æ”¹ Bean çš„å®šä¹‰ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-beanpostprocessor-ä¸å…¶å®ƒæ‰©å±•ç‚¹å¯¹æ¯”"&gt;ğŸ“Š BeanPostProcessor ä¸å…¶å®ƒæ‰©å±•ç‚¹å¯¹æ¯”
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†æ›´å…¨é¢åœ°ç†è§£ BeanPostProcessor åœ¨ Spring å®¹å™¨ä¸­çš„å®šä½ï¼Œä¸‹è¡¨å°†å…¶ä¸ä¸€äº›æ˜“æ··æ·†çš„æ¥å£è¿›è¡Œäº†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§/æ¥å£&lt;/th&gt;
&lt;th&gt;BeanPostProcessor&lt;/th&gt;
&lt;th&gt;BeanFactoryPostProcessor&lt;/th&gt;
&lt;th&gt;InitializingBean / @PostConstruct&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ“ä½œç›®æ ‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å·²å®ä¾‹åŒ–çš„ &lt;strong&gt;Bean å¯¹è±¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Bean çš„å…ƒæ•°æ® &lt;strong&gt;BeanDefinition&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Bean &lt;strong&gt;è‡ªèº«&lt;/strong&gt;çš„åˆå§‹åŒ–é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»‹å…¥æ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Bean &lt;strong&gt;å®ä¾‹åŒ–å&lt;/strong&gt;ï¼Œåˆå§‹åŒ–å‰å&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰ BeanDefinition &lt;strong&gt;åŠ è½½å&lt;/strong&gt;ï¼Œå®ä¾‹åŒ–å‰&lt;/td&gt;
&lt;td&gt;Bean è‡ªèº«åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œæ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹/ä»£ç† Beanã€AOPã€é€šç”¨å¢å¼º&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹ Bean å®šä¹‰å±æ€§ã€å ä½ç¬¦æ›¿æ¢&lt;/td&gt;
&lt;td&gt;ç¼–å†™ Bean è‡ªèº«ç‰¹å®šçš„åˆå§‹åŒ–ä»£ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦å½±å“æ‰€æœ‰ Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å¦ (åªå½±å“å®ç°æ¥å£/æ³¨è§£çš„ Bean)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;BeanPostProcessor æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„å…³é”®èŠ‚ç‚¹è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼Œä»è€Œå®ç°å„ç§é«˜çº§åŠŸèƒ½ã€‚é€šè¿‡å®ç°è¯¥æ¥å£ï¼Œä½ å¯ä»¥ä¿®æ”¹ Bean çš„å±æ€§ã€åˆ›å»ºä»£ç†ã€å¤„ç†è‡ªå®šä¹‰æ³¨è§£ç­‰ï¼Œè€Œæ— éœ€ä¿®æ”¹åŸå§‹ Bean çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ BeanPostProcessorã€‚&lt;/p&gt;
&lt;h2 id="beanfactorypostprocessor"&gt;BeanFactoryPostProcessor
&lt;/h2&gt;&lt;p&gt;BeanFactoryPostProcessor æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”å…³é”®çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸ä½ åœ¨ Spring å®¹å™¨åŠ è½½äº† Bean çš„å®šä¹‰ï¼ˆBeanDefinitionï¼‰ä¹‹åï¼Œä½†åœ¨çœŸæ­£åˆ›å»º Bean å®ä¾‹&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;ï¼Œå¯¹ Bean çš„é…ç½®å…ƒæ•°æ®è¿›è¡Œä¿®æ”¹æˆ–å®šåˆ¶ã€‚è¿™ä¸ºæ¡†æ¶çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§æä¾›äº†å·¨å¤§ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¿«é€Ÿç†è§£å®ƒçš„æ ¸å¿ƒç‰¹è´¨ï¼Œç‰¹åˆ«æ˜¯ä¸å¦ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„æ¥å£ &lt;code&gt;BeanPostProcessor&lt;/code&gt;çš„åŒºåˆ«ï¼Œæˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;BeanFactoryPostProcessor&lt;/th&gt;
&lt;th&gt;BeanPostProcessor&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤„ç†å¯¹è±¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Bean çš„å®šä¹‰ä¿¡æ¯&lt;/strong&gt; (&lt;code&gt;BeanDefinition&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Bean çš„å®ä¾‹&lt;/strong&gt; (å¯¹è±¡æœ¬èº«)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨æ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰ &lt;code&gt;BeanDefinition&lt;/code&gt;&lt;strong&gt;åŠ è½½å&lt;/strong&gt;ï¼ŒBean&lt;strong&gt;å®ä¾‹åŒ–ä¹‹å‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª Bean &lt;strong&gt;å®ä¾‹åŒ–ä¹‹å&lt;/strong&gt;ï¼Œåˆå§‹åŒ–&lt;strong&gt;å‰å&lt;/strong&gt; (&lt;code&gt;@PostConstruct&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤„ç†å†…å®¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹ Bean çš„å…ƒä¿¡æ¯ï¼ˆå¦‚ç±»åã€å±æ€§å€¼ã€ä½œç”¨åŸŸï¼‰ã€åŠ¨æ€æ³¨å†Œæˆ–ç§»é™¤ Bean å®šä¹‰&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æˆ–å¢å¼º Bean å®ä¾‹æœ¬èº«ï¼ˆå¦‚ AOP ä»£ç†ã€å±æ€§æ³¨å…¥ã€æ—¥å¿—å¢å¼ºï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦å½±å“å®¹å™¨ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;strong&gt;æ˜¯&lt;/strong&gt;ï¼Œå¯ä»¥æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ &lt;code&gt;BeanDefinition&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;å¦&lt;/strong&gt;ï¼Œåªå½±å“ Bean å®ä¾‹çš„è¡Œä¸ºæˆ–å±æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å±æ€§å ä½ç¬¦è§£æã€åŠ¨æ€ Bean æ³¨å†Œã€æ¡ä»¶åŒ–é…ç½®ã€ä¿®æ”¹ Bean å±æ€§é»˜è®¤å€¼&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Autowired&lt;/code&gt;æ³¨å…¥ã€AOP ä»£ç†ã€&lt;code&gt;@PostConstruct&lt;/code&gt;å¤„ç†ã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸æ‰§è¡Œæ—¶æœº"&gt;âš™ï¸ æ ¸å¿ƒæœºåˆ¶ä¸æ‰§è¡Œæ—¶æœº
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;æ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Spring å®¹å™¨ï¼ˆé€šå¸¸æ˜¯ &lt;code&gt;ApplicationContext&lt;/code&gt;ï¼‰åœ¨å¯åŠ¨æ—¶ï¼Œä¼šç»å†ä»¥ä¸‹å‡ ä¸ªå…³é”®é˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ è½½é…ç½®ä¿¡æ¯&lt;/strong&gt;ï¼ˆXMLã€æ³¨è§£ã€Java Configï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£æé…ç½®&lt;/strong&gt;ï¼Œå°†å…¶è½¬æ¢ä¸ºå†…éƒ¨çš„ &lt;code&gt;BeanDefinition&lt;/code&gt;å¯¹è±¡ï¼ˆå³ Bean çš„å®šä¹‰å…ƒæ•°æ®ï¼‰ï¼Œå¹¶æ³¨å†Œåˆ° &lt;code&gt;BeanFactory&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œ &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚åœ¨æ‰€æœ‰ &lt;code&gt;BeanDefinition&lt;/code&gt;è¢«åŠ è½½åˆ°å·¥å‚ä¹‹åï¼Œä½†åœ¨ä»»ä½• Bean è¢«å®ä¾‹åŒ–ä¹‹å‰ï¼ŒSpring ä¼š&lt;strong&gt;è‡ªåŠ¨æ£€æµ‹å¹¶è°ƒç”¨æ‰€æœ‰å®ç°äº† &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;æ¥å£çš„ Bean çš„ &lt;code&gt;postProcessBeanFactory&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹åŒ–å¹¶åˆå§‹åŒ– Bean&lt;/strong&gt;ï¼šæ‰§è¡Œå®Œæ‰€æœ‰ &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;åï¼Œå®¹å™¨æ‰ä¼šå¼€å§‹åˆ›å»ºéå»¶è¿ŸåŠ è½½çš„å•ä¾‹ Beanã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™å°±æ„å‘³ç€ï¼Œ&lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;æ‹¥æœ‰åœ¨ Beanâ€œè¯ç”Ÿâ€å‰ä¿®æ”¹å…¶â€œè“å›¾â€ï¼ˆ&lt;code&gt;BeanDefinition&lt;/code&gt;ï¼‰çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h3 id="-å¸¸è§çš„å†…ç½®å®ç°-1"&gt;ğŸ› ï¸ å¸¸è§çš„å†…ç½®å®ç°
&lt;/h3&gt;&lt;p&gt;Spring æ¡†æ¶æœ¬èº«å°±å¤§é‡ä½¿ç”¨äº† &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;æ¥å®ç°å…¶æ ¸å¿ƒåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;PropertySourcesPlaceholderConfigurer&lt;/code&gt;&lt;/strong&gt; / &lt;strong&gt;&lt;code&gt;PropertyPlaceholderConfigurer&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€ç»å…¸çš„ä¾‹å­ã€‚å®ƒè´Ÿè´£å¤„ç†é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦ï¼ˆå¦‚ &lt;code&gt;${jdbc.url}&lt;/code&gt;ï¼‰ï¼Œåœ¨ Bean å±æ€§æ³¨å…¥å‰ï¼Œå°†è¿™äº›å ä½ç¬¦æ›¿æ¢ä¸ºå®é™…é…ç½®çš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConfigurationClassPostProcessor&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯ Spring æ³¨è§£é©±åŠ¨çš„æ ¸å¿ƒã€‚å®ƒè´Ÿè´£è§£æ &lt;code&gt;@Configuration&lt;/code&gt;é…ç½®ç±»ã€å¤„ç† &lt;code&gt;@ComponentScan&lt;/code&gt;ï¼ˆæ‰«ææ³¨è§£ï¼‰ã€&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ç­‰ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯è½¬æ¢ä¸ºæ ‡å‡†çš„ &lt;code&gt;BeanDefinition&lt;/code&gt;æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MapperScannerConfigurer&lt;/code&gt;&lt;/strong&gt;ï¼ˆMyBatis-Spring æ•´åˆï¼‰ï¼šç”¨äºæ‰«ææŒ‡å®šçš„åŒ…è·¯å¾„ï¼Œå°† MyBatis çš„ Mapper æ¥å£åŠ¨æ€æ³¨å†Œä¸º Spring çš„ Beanã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•è‡ªå®šä¹‰-beanfactorypostprocessor"&gt;ğŸ”§ å¦‚ä½•è‡ªå®šä¹‰ BeanFactoryPostProcessor
&lt;/h3&gt;&lt;p&gt;åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;éå¸¸ç®€å•ï¼Œåªéœ€ä¸‰æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ¥å£&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç° &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å†™æ–¹æ³•&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;postProcessBeanFactory&lt;/code&gt;æ–¹æ³•ä¸­ç¼–å†™ä½ çš„è‡ªå®šä¹‰é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œåˆ°å®¹å™¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Component&lt;/code&gt;æ³¨è§£æˆ– &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å°†å…¶æ³¨å†Œä¸º Spring Beanã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ç¤ºä¾‹ä¿®æ”¹å·²æ³¨å†Œ-bean-çš„å®šä¹‰"&gt;ç¤ºä¾‹ï¼šä¿®æ”¹å·²æ³¨å†Œ Bean çš„å®šä¹‰
&lt;/h4&gt;&lt;p&gt;ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°†ä¸€ä¸ªå·²å®šä¹‰çš„ Bean çš„é»˜è®¤ä½œç”¨åŸŸä¿®æ”¹ä¸ºåŸå‹ï¼ˆprototypeï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.beans.factory.config.BeanFactoryPostProcessor;
import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;
import org.springframework.stereotype.Component;
@Component
public class MyBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
@Override
public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
// é€šè¿‡åç§°è·å–ç‰¹å®šBeançš„å®šä¹‰
BeanDefinition bd = beanFactory.getBeanDefinition(&amp;#34;myService&amp;#34;);
// å°†å…¶ä½œç”¨åŸŸä¿®æ”¹ä¸º prototype
bd.setScope(BeanDefinition.SCOPE_PROTOTYPE);
// ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚ï¼š
// bd.getPropertyValues().add(&amp;#34;defaultName&amp;#34;, &amp;#34;Custom Default&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ç¤ºä¾‹åŠ¨æ€æ³¨å†Œæ–°çš„-beandefinition"&gt;ç¤ºä¾‹ï¼šåŠ¨æ€æ³¨å†Œæ–°çš„ BeanDefinition
&lt;/h4&gt;&lt;p&gt;ä½ ç”šè‡³å¯ä»¥å®Œå…¨åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®šä¹‰å¹¶æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.config.BeanFactoryPostProcessor;
import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.support.BeanDefinitionRegistry;
import org.springframework.beans.factory.support.GenericBeanDefinition;
public class DynamicBeanRegistrationPostProcessor implements BeanFactoryPostProcessor {
@Override
public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
// å°† beanFactory å‘ä¸‹è½¬å‹ä¸º BeanDefinitionRegistryï¼Œå› ä¸ºå®ƒæä¾›äº†æ³¨å†Œæ–°å®šä¹‰çš„æ–¹æ³•
if (beanFactory instanceof BeanDefinitionRegistry) {
BeanDefinitionRegistry registry = (BeanDefinitionRegistry) beanFactory;
// ä½¿ç”¨ Builder åˆ›å»ºæ–°çš„ BeanDefinition
GenericBeanDefinition newBeanDef = (GenericBeanDefinition) BeanDefinitionBuilder
.genericBeanDefinition(MyDynamicService.class) // æŒ‡å®šBeançš„Class
.setScope(BeanDefinition.SCOPE_SINGLETON) // è®¾ç½®ä½œç”¨åŸŸ
.addPropertyValue(&amp;#34;url&amp;#34;, &amp;#34;https://example.com&amp;#34;) // è®¾ç½®å±æ€§å€¼
.getBeanDefinition();
// å°†æ–°å®šä¹‰æ³¨å†Œåˆ°å®¹å™¨ä¸­
registry.registerBeanDefinition(&amp;#34;myDynamicService&amp;#34;, newBeanDef);
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼šä½ å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£æˆ–ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥æ§åˆ¶å¤šä¸ª &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;çš„æ‰§è¡Œé¡ºåºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡æ—©å®ä¾‹åŒ–&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;postProcessBeanFactory&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œ&lt;strong&gt;ä¸è¦ç¼–å†™ä¼šå¯¼è‡´ Bean è¢«æå‰å®ä¾‹åŒ–çš„ä»£ç &lt;/strong&gt;ï¼ˆä¾‹å¦‚ç›´æ¥è°ƒç”¨ &lt;code&gt;beanFactory.getBean(...)&lt;/code&gt;ï¼‰ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šç ´åå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¹¶å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ &lt;code&gt;BeanDefinitionRegistryPostProcessor&lt;/code&gt;çš„å…³ç³»&lt;/strong&gt;ï¼š&lt;code&gt;BeanDefinitionRegistryPostProcessor&lt;/code&gt;æ˜¯ &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;çš„ä¸€ä¸ªå­æ¥å£ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ›´æ—©çš„æ‰©å±•ç‚¹ &lt;code&gt;postProcessBeanDefinitionRegistry&lt;/code&gt;ï¼Œå…è®¸ä½ åœ¨&lt;strong&gt;å¸¸è§„çš„ &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;æ‰§è¡Œä¹‹å‰&lt;/strong&gt;å°±æ“ä½œ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;ï¼Œéå¸¸é€‚åˆè¿›è¡Œå¤§é‡çš„åŠ¨æ€ Bean å®šä¹‰æ³¨å†Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;è‡ªå®šä¹‰ &lt;code&gt;BeanFactoryPostProcessor&lt;/code&gt;çš„ç”¨é€”éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒæ•æ„Ÿçš„é…ç½®&lt;/strong&gt;ï¼šæ ¹æ®ä¸åŒçš„æ¿€æ´» profileï¼ˆå¦‚ dev, test, prodï¼‰ï¼ŒåŠ¨æ€ä¿®æ”¹ Bean çš„å±æ€§é»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶åŒ–æ³¨å†Œ Bean&lt;/strong&gt;ï¼šæ ¹æ®æŸä¸ªæ¡ä»¶ï¼ˆå¦‚ç³»ç»Ÿå±æ€§ã€ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼‰æ¥å†³å®šæ˜¯å¦æ³¨å†ŒæŸä¸ª Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†æˆç¬¬ä¸‰æ–¹åº“&lt;/strong&gt;ï¼šä¸ºé‚£äº›æ²¡æœ‰æä¾› Spring æ³¨è§£çš„ç±»åŠ¨æ€åˆ›å»ºå’Œæ³¨å†Œ &lt;code&gt;BeanDefinition&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¯†å±æ€§è§£å¯†&lt;/strong&gt;ï¼šåœ¨å±æ€§æ³¨å…¥å‰ï¼Œè¯†åˆ«å¹¶è§£å¯†é…ç½®ä¸­ç»è¿‡åŠ å¯†çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ å…¨é¢ç†è§£ BeanFactoryPostProcessor åœ¨ Spring æ¡†æ¶ä¸­çš„ä½œç”¨å’Œå¨åŠ›ã€‚&lt;/p&gt;
&lt;h2 id="aware-æ¥å£"&gt;Aware æ¥å£
&lt;/h2&gt;&lt;p&gt;Spring çš„ &lt;strong&gt;Aware æ¥å£&lt;/strong&gt;æ˜¯ä¸€ç»„éå¸¸é‡è¦çš„&lt;strong&gt;æ ‡è®°æ¥å£ï¼ˆMarker Interfacesï¼‰&lt;/strong&gt;ï¼Œå®ƒä»¬å…è®¸ Bean åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­**&amp;ldquo;æ„ŸçŸ¥&amp;quot;å¹¶è·å– Spring å®¹å™¨æä¾›çš„ç‰¹å®šèµ„æºæˆ–ä¸Šä¸‹æ–‡ä¿¡æ¯**ã€‚è¿™ç›¸å½“äºç»™ Bean èµ‹äºˆäº†ä¸å®¹å™¨ç›´æ¥äº¤äº’çš„&amp;quot;è¶…èƒ½åŠ›&amp;rdquo;ï¼Œä½¿å…¶ä¸å†æ˜¯ä¸€ä¸ªè¢«åŠ¨çš„å—ç®¡å¯¹è±¡ï¼Œè€Œèƒ½ä¸»åŠ¨äº†è§£æ‰€åœ¨ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®ä½ å¿«é€Ÿäº†è§£ï¼Œå…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“ä¸€äº›å¸¸è§çš„ Aware æ¥å£åŠå…¶æ ¸å¿ƒä½œç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¥å£åç§°&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒä½œç”¨&lt;/th&gt;
&lt;th&gt;å¯è·å–çš„èµ„æºæˆ–ä¿¡æ¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BeanNameAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥è‡ªå·±åœ¨å®¹å™¨ä¸­çš„åç§°&lt;/td&gt;
&lt;td&gt;Bean åœ¨å®¹å™¨ä¸­çš„åç§° (String)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BeanFactoryAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥åº•å±‚çš„ Bean å·¥å‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BeanFactory&lt;/code&gt;å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ApplicationContextAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥åº”ç”¨ä¸Šä¸‹æ–‡&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ApplicationContext&lt;/code&gt;å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;EnvironmentAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥ç¯å¢ƒé…ç½®&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Environment&lt;/code&gt;å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ResourceLoaderAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥èµ„æºåŠ è½½å™¨&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ResourceLoader&lt;/code&gt;å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ApplicationEventPublisherAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥äº‹ä»¶å‘å¸ƒå™¨&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ApplicationEventPublisher&lt;/code&gt;å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MessageSourceAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®© Bean æ„ŸçŸ¥å›½é™…åŒ–æ¶ˆæ¯æº&lt;/td&gt;
&lt;td&gt;&lt;code&gt;MessageSource&lt;/code&gt;å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰§è¡Œæ—¶æœºä¸å·¥ä½œåŸç†"&gt;âš™ï¸ æ‰§è¡Œæ—¶æœºä¸å·¥ä½œåŸç†
&lt;/h3&gt;&lt;p&gt;Spring å®¹å™¨åœ¨åˆ›å»º Bean çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨&lt;strong&gt;å±æ€§æ³¨å…¥ä¹‹åã€åˆå§‹åŒ–å›è°ƒï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ï¼‰ä¹‹å‰&lt;/strong&gt;ï¼Œæ£€æŸ¥ Bean æ˜¯å¦å®ç°äº†ä»»ä½• Aware æ¥å£ã€‚å¦‚æœå®ç°äº†ï¼Œå®¹å™¨å°±ä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„ setter æ–¹æ³•ï¼Œå°†ç›¸å…³çš„èµ„æºæˆ–ä¿¡æ¯æ³¨å…¥åˆ° Bean ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹ä¸»è¦ç”± Spring çš„ &lt;strong&gt;&lt;code&gt;BeanPostProcessor&lt;/code&gt;&lt;/strong&gt; å®ç°ï¼ˆä¾‹å¦‚ &lt;code&gt;ApplicationContextAwareProcessor&lt;/code&gt;ï¼‰æ¥å®Œæˆçš„ã€‚è¿™äº›åå¤„ç†å™¨ä¼šæ‹¦æˆª Bean çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¹¶è´Ÿè´£è°ƒç”¨ç›¸åº”çš„ Aware æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ç”Ÿå‘½å‘¨æœŸç®€è¦é¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Bean å®ä¾‹åŒ–ï¼ˆé€šè¿‡æ„é€ å‡½æ•°æˆ–å·¥å‚æ–¹æ³•ï¼‰&lt;/li&gt;
&lt;li&gt;å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Aware æ¥å£å›è°ƒ&lt;/strong&gt;ï¼ˆæœ¬æ–‡é‡ç‚¹ï¼‰&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ã€&lt;code&gt;InitializingBean.afterPropertiesSet()&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;Bean å‡†å¤‡å°±ç»ª&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§-aware-æ¥å£è¯¦è§£"&gt;ğŸ› ï¸ å¸¸è§ Aware æ¥å£è¯¦è§£
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;BeanNameAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸ Bean è·å–å…¶åœ¨ Spring å®¹å™¨ä¸­çš„åç§°ï¼ˆå³åœ¨é…ç½®æ–‡ä»¶æˆ–æ³¨è§£ä¸­å®šä¹‰çš„ Bean IDæˆ–åç§°ï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.BeanNameAware;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements BeanNameAware {
private String beanName;
@Override
public void setBeanName(String name) {
this.beanName = name; // å®¹å™¨ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¼ å…¥Beançš„åç§°
System.out.println(&amp;#34;My bean name is: &amp;#34; + beanName);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ—¥å¿—è®°å½•ã€ç›‘æ§ï¼Œæˆ–åœ¨éœ€è¦æ ¹æ® Bean åç§°æ‰§è¡Œç‰¹å®šé€»è¾‘æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;BeanFactoryAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸ Bean è·å–å¯¹ &lt;strong&gt;&lt;code&gt;BeanFactory&lt;/code&gt;&lt;/strong&gt; çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥åŠ¨æ€åœ°è·å–å…¶ä»– Bean æˆ–æŸ¥è¯¢å®¹å™¨ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.BeanFactory;
import org.springframework.beans.factory.BeanFactoryAware;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements BeanFactoryAware {
private BeanFactory beanFactory;
@Override
public void setBeanFactory(BeanFactory beanFactory) {
this.beanFactory = beanFactory;
}
public void useOtherBean() {
// åŠ¨æ€è·å–å…¶ä»–Bean
AnotherBean otherBean = beanFactory.getBean(AnotherBean.class);
otherBean.doSomething();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦æ ¹æ®è¿è¡Œæ—¶æ¡ä»¶åŠ¨æ€åŠ è½½ä¸åŒ Bean å®ç°çš„æ’ä»¶åŒ–æ¶æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ApplicationContextAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æœ€å¸¸ç”¨çš„ Aware æ¥å£ä¹‹ä¸€ã€‚å®ƒå…è®¸ Bean è·å–å¯¹ &lt;strong&gt;&lt;code&gt;ApplicationContext&lt;/code&gt;&lt;/strong&gt; çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥è®¿é—®å®¹å™¨çš„å‡ ä¹æ‰€æœ‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements ApplicationContextAware {
private ApplicationContext applicationContext;
@Override
public void setApplicationContext(ApplicationContext applicationContext) {
this.applicationContext = applicationContext;
}
// è·å–å…¶ä»–Bean
public void getAnotherBean() {
AnotherBean otherBean = applicationContext.getBean(AnotherBean.class);
}
// å‘å¸ƒåº”ç”¨äº‹ä»¶
public void publishEvent() {
applicationContext.publishEvent(new MyCustomEvent(this, &amp;#34;Event Data&amp;#34;));
}
// è·å–ç¯å¢ƒå±æ€§
public String getProperty(String key) {
return applicationContext.getEnvironment().getProperty(key);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šäº‹ä»¶å‘å¸ƒã€åŠ¨æ€è·å– Beanã€è®¿é—®ç¯å¢ƒå±æ€§æˆ–èµ„æºæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;EnvironmentAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸ Bean è·å– &lt;strong&gt;&lt;code&gt;Environment&lt;/code&gt;&lt;/strong&gt; å¯¹è±¡ï¼Œç”¨äºè®¿é—®é…ç½®å±æ€§ã€ç¯å¢ƒå˜é‡ç­‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.context.EnvironmentAware;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements EnvironmentAware {
private Environment environment;
@Override
public void setEnvironment(Environment environment) {
this.environment = environment;
}
public String getConfigValue(String key) {
return environment.getProperty(key);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦è¯»å–é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.properties&lt;/code&gt;ï¼‰ä¸­çš„å±æ€§å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ResourceLoaderAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸ Bean è·å– &lt;strong&gt;&lt;code&gt;ResourceLoader&lt;/code&gt;&lt;/strong&gt; å¯¹è±¡ï¼Œç”¨äºåŠ è½½ç±»è·¯å¾„æˆ–æ–‡ä»¶ç³»ç»Ÿèµ„æºã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.context.ResourceLoaderAware;
import org.springframework.core.io.Resource;
import org.springframework.core.io.ResourceLoader;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements ResourceLoaderAware {
private ResourceLoader resourceLoader;
@Override
public void setResourceLoader(ResourceLoader resourceLoader) {
this.resourceLoader = resourceLoader;
}
public void loadResource() {
Resource resource = resourceLoader.getResource(&amp;#34;classpath:config.json&amp;#34;);
// ä½¿ç”¨èµ„æº...
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåŠ è½½æ¨¡æ¿æ–‡ä»¶ã€é…ç½®æ–‡ä»¶æˆ–å…¶ä»–å¤–éƒ¨èµ„æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ApplicationEventPublisherAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸ Bean è·å– &lt;strong&gt;&lt;code&gt;ApplicationEventPublisher&lt;/code&gt;&lt;/strong&gt; å¯¹è±¡ï¼Œç”¨äºå‘å¸ƒåº”ç”¨äº‹ä»¶ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.context.ApplicationEventPublisher;
import org.springframework.context.ApplicationEventPublisherAware;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements ApplicationEventPublisherAware {
private ApplicationEventPublisher eventPublisher;
@Override
public void setApplicationEventPublisher(ApplicationEventPublisher eventPublisher) {
this.eventPublisher = eventPublisher;
}
public void publishEvent() {
eventPublisher.publishEvent(new MyCustomEvent(this, &amp;#34;Something happened!&amp;#34;));
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„äº‹ä»¶å‘å¸ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MessageSourceAware&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸ Bean è·å– &lt;strong&gt;&lt;code&gt;MessageSource&lt;/code&gt;&lt;/strong&gt; å¯¹è±¡ï¼Œç”¨äºæ”¯æŒå›½é™…åŒ–æ¶ˆæ¯å¤„ç†ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.context.MessageSource;
import org.springframework.context.MessageSourceAware;
import org.springframework.stereotype.Component;
@Component
public class MyBean implements MessageSourceAware {
private MessageSource messageSource;
@Override
public void setMessageSource(MessageSource messageSource) {
this.messageSource = messageSource;
}
public String getMessage(String code, Object[] args, Locale locale) {
return messageSource.getMessage(code, args, locale);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦æ”¯æŒå›½é™…åŒ–çš„åº”ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ"&gt;âš ï¸ æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨ï¼Œé¿å…è¿‡åº¦è€¦åˆ&lt;/strong&gt;ï¼šAware æ¥å£è™½ç„¶å¼ºå¤§ï¼Œä½†ä¼šè®©ä½ çš„ä»£ç ä¸ Spring æ¡†æ¶ç´§å¯†è€¦åˆï¼Œé™ä½å¯æµ‹è¯•æ€§å’Œå¯ç§»æ¤æ€§ã€‚&lt;strong&gt;åº”ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ä¾èµ–æ³¨å…¥&lt;/strong&gt;ï¼ˆ&lt;code&gt;@Autowired&lt;/code&gt;ï¼‰ï¼Œåªæœ‰åœ¨ä¾èµ–æ³¨å…¥æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶æ‰è€ƒè™‘ä½¿ç”¨ Aware æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è§£ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼šAware æ¥å£çš„æ–¹æ³•è°ƒç”¨å‘ç”Ÿåœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šé˜¶æ®µï¼ˆå±æ€§æ³¨å…¥ä¹‹åï¼Œåˆå§‹åŒ–å›è°ƒä¹‹å‰ï¼‰ï¼Œç¡®ä¿åœ¨ä½¿ç”¨æ³¨å…¥çš„èµ„æºæ—¶å®ƒä»¬å·²ç»å‡†å¤‡å¥½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹¶éæ‰€æœ‰ Aware æ¥å£éƒ½éœ€å®ç°&lt;/strong&gt;ï¼šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„ Aware æ¥å£ï¼Œä¸éœ€è¦å®ç°æ‰€æœ‰æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;ApplicationContextAware&lt;/code&gt;ï¼Œè®¸å¤šåŠŸèƒ½å¯ä»¥é€šè¿‡ç›´æ¥æ³¨å…¥ç‰¹å®šå¯¹è±¡å®ç°ï¼ˆå¦‚ç›´æ¥æ³¨å…¥ &lt;code&gt;Environment&lt;/code&gt;ã€&lt;code&gt;ResourceLoader&lt;/code&gt;æˆ– &lt;code&gt;ApplicationEventPublisher&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;BeanFactoryAware&lt;/code&gt;ï¼ŒåŠ¨æ€è·å– Bean çš„éœ€æ±‚é€šå¸¸å¯ä»¥é€šè¿‡ &lt;code&gt;ObjectProvider&lt;/code&gt;æˆ– &lt;code&gt;@Lazy&lt;/code&gt;æ³¨è§£æ›´å¥½åœ°è§£å†³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’¡ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring çš„ Aware æ¥å£æä¾›äº†ä¸€ç§è®© Bean ä¸å®¹å™¨äº¤äº’çš„å¼ºå¤§æœºåˆ¶ï¼Œèµ‹äºˆäº† Bean æ›´é«˜çš„çµæ´»æ€§å’Œä¸»åŠ¨æ€§ã€‚å®ƒä»¬å°±åƒæ˜¯ä¸º Bean å¼€å¯çš„&amp;quot;ä¸Šå¸è§†è§’&amp;quot;ï¼Œä½¿å…¶èƒ½å¤Ÿæ„ŸçŸ¥å¹¶åˆ©ç”¨å®¹å™¨çš„å„ç§æœåŠ¡å’Œèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæ­£å¦‚èœ˜è››ä¾ çš„å”å”æ‰€è¯´ï¼š&amp;ldquo;èƒ½åŠ›è¶Šå¤§ï¼Œè´£ä»»è¶Šå¤§ã€‚&amp;rdquo; è™½ç„¶ Aware æ¥å£åŠŸèƒ½å¼ºå¤§ï¼Œä½†åº”å½“&lt;strong&gt;è°¨æ…ä¸”æœ‰èŠ‚åˆ¶åœ°ä½¿ç”¨&lt;/strong&gt;ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œä¼ ç»Ÿçš„ä¾èµ–æ³¨å…¥ä»ç„¶æ˜¯æ›´ç®€æ´ã€æ›´è§£è€¦çš„é€‰æ‹©ã€‚åªæœ‰å½“æ ‡å‡†ä¾èµ–æ³¨å…¥æ— æ³•æ»¡è¶³ä½ çš„ç‰¹å®šéœ€æ±‚æ—¶ï¼ŒAware æ¥å£æ‰æ˜¯ä½ è¯¥æå‡ºçš„é‚£æŠŠ&amp;quot;ç‘å£«å†›åˆ€&amp;quot;ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Spring çš„ Aware æ¥å£ã€‚&lt;/p&gt;
&lt;h2 id="applicationcontextaware"&gt;ApplicationContextAware
&lt;/h2&gt;&lt;p&gt;ApplicationContextAware æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªå…³é”®æ‰©å±•æ¥å£ï¼Œå®ƒå…è®¸ Bean &lt;strong&gt;è·å–åˆ° Spring å®¹å™¨çš„å¼•ç”¨&lt;/strong&gt;ï¼Œä»è€Œèƒ½å¤Ÿä¸å®¹å™¨è¿›è¡Œäº¤äº’ã€‚ä¸‹é¢æˆ‘å°†ä¸ºä½ è¯¦ç»†è§£é‡Šå®ƒçš„å·¥ä½œåŸç†ã€ä½¿ç”¨æ–¹æ³•å’Œé€‚ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨-1"&gt;ğŸ§  æ ¸å¿ƒæ¦‚å¿µä¸ä½œç”¨
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ApplicationContextAware&lt;/strong&gt; æ˜¯ Spring ä¼—å¤š &lt;code&gt;Aware&lt;/code&gt;æ¥å£ä¸­çš„ä¸€ç§ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯&lt;strong&gt;è®© Bean æ„ŸçŸ¥åˆ° Spring å®¹å™¨çš„å­˜åœ¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•&lt;/strong&gt;ï¼šè¯¥æ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;void setApplicationContext(ApplicationContext applicationContext) throws BeansException;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¾è®¡åˆè¡·&lt;/strong&gt;ï¼šå½“ä¸€ä¸ª Bean å®ç°äº† &lt;code&gt;ApplicationContextAware&lt;/code&gt;æ¥å£åï¼ŒSpring å®¹å™¨ä¼šåœ¨è¯¥ Bean çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œ&lt;strong&gt;è‡ªåŠ¨è°ƒç”¨&lt;/strong&gt; &lt;code&gt;setApplicationContext&lt;/code&gt;æ–¹æ³•ï¼Œå¹¶å°†å½“å‰å®¹å™¨çš„å¼•ç”¨ï¼ˆ&lt;code&gt;ApplicationContext&lt;/code&gt;å¯¹è±¡ï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™æ ·ï¼Œè¯¥ Bean å°±è·å¾—äº†ä¸ Spring å®¹å™¨äº¤äº’çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å·¥ä½œåŸç†ä¸æ‰§è¡Œæ—¶æœº"&gt;âš™ï¸ å·¥ä½œåŸç†ä¸æ‰§è¡Œæ—¶æœº
&lt;/h3&gt;&lt;p&gt;Spring å®¹å™¨é€šè¿‡ä¸€ä¸ªåä¸º &lt;strong&gt;&lt;code&gt;ApplicationContextAwareProcessor&lt;/code&gt;&lt;/strong&gt; çš„ &lt;strong&gt;&lt;code&gt;BeanPostProcessor&lt;/code&gt;&lt;/strong&gt; æ¥å¤„ç†æ‰€æœ‰ &lt;code&gt;Aware&lt;/code&gt;æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ‰§è¡Œæ—¶æœºåµŒå…¥åœ¨ Bean çš„åˆ›å»ºç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹åŒ– Bean&lt;/strong&gt;ï¼ˆé€šè¿‡æ„é€ å‡½æ•°æˆ–å·¥å‚æ–¹æ³•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¡«å…… Bean å±æ€§&lt;/strong&gt;ï¼ˆä¾èµ–æ³¨å…¥ï¼ŒPopulateï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç† Aware æ¥å£&lt;/strong&gt;ï¼š&lt;code&gt;ApplicationContextAwareProcessor&lt;/code&gt;ä¼šæ£€æµ‹å½“å‰ Bean æ˜¯å¦å®ç°äº† &lt;code&gt;ApplicationContextAware&lt;/code&gt;ç­‰æ¥å£ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ç›¸åº”çš„ &lt;code&gt;setApplicationContext&lt;/code&gt;æ–¹æ³•ï¼Œå°† &lt;code&gt;ApplicationContext&lt;/code&gt;æ³¨å…¥åˆ° Bean ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;, &lt;code&gt;InitializingBean.afterPropertiesSet()&lt;/code&gt;, è‡ªå®šä¹‰ &lt;code&gt;init-method&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bean å‡†å¤‡å°±ç»ª&lt;/strong&gt;ï¼Œå¯ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•ä½¿ç”¨"&gt;ğŸ“ å¦‚ä½•ä½¿ç”¨
&lt;/h3&gt;&lt;p&gt;å®ç° &lt;code&gt;ApplicationContextAware&lt;/code&gt;æ¥å£é€šå¸¸åªéœ€ä¸‰æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ¥å£&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç° &lt;code&gt;ApplicationContextAware&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å†™æ–¹æ³•&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;setApplicationContext&lt;/code&gt;æ–¹æ³•ä¸­ä¿å­˜å®¹å™¨å¼•ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œåˆ°å®¹å™¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Component&lt;/code&gt;æ³¨è§£æˆ– XML é…ç½®å°†å…¶æ³¨å†Œä¸º Spring Beanã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œæä¾›é™æ€æ–¹æ³•æ¥è·å– Beanï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.BeansException;
import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;
import org.springframework.stereotype.Component;
@Component
public class SpringContextUtil implements ApplicationContextAware {
private static ApplicationContext applicationContext;
@Override
public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
SpringContextUtil.applicationContext = applicationContext; // ä¿å­˜å®¹å™¨å¼•ç”¨
}
// æä¾›é™æ€æ–¹æ³•é€šè¿‡åç§°è·å–Bean
public static Object getBean(String name) {
return applicationContext.getBean(name);
}
// æä¾›é™æ€æ–¹æ³•é€šè¿‡ç±»å‹è·å–Bean
public static &amp;lt;T&amp;gt; T getBean(Class&amp;lt;T&amp;gt; clazz) {
return applicationContext.getBean(clazz);
}
// å…¶ä»–å®ç”¨æ–¹æ³•ï¼Œå¦‚è·å–æ‰€æœ‰Beanå®šä¹‰åç§°ã€åˆ¤æ–­æ˜¯å¦åŒ…å«Beanç­‰
public static String[] getBeanDefinitionNames() {
return applicationContext.getBeanDefinitionNames();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¹‹åï¼Œåœ¨ä»£ç ä¸­å³å¯é€šè¿‡ &lt;code&gt;SpringContextUtil.getBean(MyService.class)&lt;/code&gt;çš„æ–¹å¼è·å–å®¹å™¨ç®¡ç†çš„ Beanã€‚&lt;/p&gt;
&lt;h3 id="-å¸¸è§åº”ç”¨åœºæ™¯-1"&gt;ğŸ¯ å¸¸è§åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ApplicationContextAware&lt;/code&gt;é€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è·å– Bean&lt;/strong&gt;ï¼šåœ¨æ— æ³•é€šè¿‡å¸¸è§„ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ &lt;code&gt;@Autowired&lt;/code&gt;ï¼‰è·å– Bean çš„åœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚åœ¨é™æ€æ–¹æ³•ä¸­ã€åœ¨å·¥å…·ç±»ä¸­ã€åœ¨æŸäº›é Spring æ‰˜ç®¡çš„ç±»ä¸­ï¼‰ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;ApplicationContextAware&lt;/code&gt;å·¥å…·ç±»åŠ¨æ€æŸ¥æ‰¾å¹¶è·å– Beanã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘å¸ƒåº”ç”¨äº‹ä»¶&lt;/strong&gt;ï¼šSpring çš„ &lt;code&gt;ApplicationContext&lt;/code&gt;æ”¯æŒäº‹ä»¶å‘å¸ƒ/è®¢é˜…æœºåˆ¶ã€‚å®ç°äº† &lt;code&gt;ApplicationContextAware&lt;/code&gt;çš„ Bean å¯ä»¥è·å– &lt;code&gt;ApplicationContext&lt;/code&gt;æ¥å‘å¸ƒäº‹ä»¶ï¼Œå…¶ä»– Bean å¯ä»¥ç›‘å¬å¹¶å¤„ç†è¿™äº›äº‹ä»¶ï¼Œå®ç°è§£è€¦ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åœ¨æŸä¸ªå®ç°äº†ApplicationContextAwareçš„Beanä¸­
applicationContext.publishEvent(new MyCustomEvent(this, eventData));
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¿é—®å®¹å™¨ä¿¡æ¯ä¸ç¯å¢ƒå±æ€§&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;ApplicationContext&lt;/code&gt;ï¼Œå¯ä»¥è·å–ç¯å¢ƒé…ç½®ä¿¡æ¯ã€å½“å‰æ¿€æ´»çš„ Profileã€å›½é™…åŒ–æ¶ˆæ¯ç­‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// è·å–ç¯å¢ƒå˜é‡ä¸­çš„é…ç½®
String propertyValue = applicationContext.getEnvironment().getProperty(&amp;#34;my.config.key&amp;#34;);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ-1"&gt;âš ï¸ æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;ApplicationContextAware&lt;/code&gt;å¼ºå¤§ï¼Œä½†åº”è°¨æ…ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦ä½¿ç”¨ä¸è€¦åˆ&lt;/strong&gt;ï¼š&lt;strong&gt;å®˜æ–¹æ¨èä¼˜å…ˆä½¿ç”¨ä¾èµ–æ³¨å…¥&lt;/strong&gt;ã€‚ç›´æ¥ä½¿ç”¨ &lt;code&gt;ApplicationContextAware&lt;/code&gt;å¹¶è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;ä¼šä½¿ä»£ç ä¸ Spring æ¡†æ¶è€¦åˆï¼Œè¿åâ€œæ§åˆ¶åè½¬â€ï¼ˆIoCï¼‰åŸåˆ™ï¼Œé™ä½ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„ç©ºæŒ‡é’ˆå¼‚å¸¸&lt;/strong&gt;ï¼šç¡®ä¿åœ¨ Bean å®Œå…¨åˆå§‹åŒ–åå†ä½¿ç”¨ä¿å­˜çš„ &lt;code&gt;ApplicationContext&lt;/code&gt;å¼•ç”¨ï¼Œä¾‹å¦‚é¿å…åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™æ€å˜é‡é™·é˜±&lt;/strong&gt;ï¼šä¸Šé¢å·¥å…·ç±»ç¤ºä¾‹ä¸­ä½¿ç”¨äº†é™æ€å˜é‡æŒæœ‰ &lt;code&gt;ApplicationContext&lt;/code&gt;ã€‚è¿™åœ¨ç®€å•çš„å•åº”ç”¨ä¸­æ˜¯å¯è¡Œçš„ï¼Œä½†åœ¨æŸäº›å¤æ‚åœºæ™¯ï¼ˆå¦‚æŸäº›çƒ­éƒ¨ç½²ã€ç‰¹å®šå®¹å™¨ç¯å¢ƒï¼‰å¯èƒ½éœ€è¦è€ƒè™‘å…¶ç”Ÿå‘½å‘¨æœŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èæ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹äºè·å– Beanï¼š&lt;strong&gt;å°½é‡ä½¿ç”¨ä¾èµ–æ³¨å…¥&lt;/strong&gt;ï¼ˆ&lt;code&gt;@Autowired&lt;/code&gt;, &lt;code&gt;@Resource&lt;/code&gt;ï¼‰ã€‚å¦‚æœå¿…é¡»åœ¨éæ‰˜ç®¡ç±»ä¸­ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘&lt;strong&gt;æ–¹æ³•å‚æ•°ä¼ é€’&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºäº‹ä»¶å‘å¸ƒï¼šå¯ä»¥ç›´æ¥æ³¨å…¥ &lt;code&gt;ApplicationEventPublisher&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç¯å¢ƒå±æ€§ï¼šå¯ä»¥ç›´æ¥æ³¨å…¥ &lt;code&gt;Environment&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä¸å…¶ä»–-aware-æ¥å£çš„å…³ç³»"&gt;ğŸ” ä¸å…¶ä»– Aware æ¥å£çš„å…³ç³»
&lt;/h3&gt;&lt;p&gt;Spring æä¾›äº†ä¸°å¯Œçš„ &lt;code&gt;Aware&lt;/code&gt;æ¥å£å®¶æ—ï¼Œè®© Bean å¯ä»¥æ„ŸçŸ¥ä¸åŒæ–¹é¢çš„å®¹å™¨ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¥å£åç§°&lt;/th&gt;
&lt;th&gt;æ³¨å…¥çš„ä¾èµ–&lt;/th&gt;
&lt;th&gt;ä¸»è¦ç”¨é€”&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ApplicationContextAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ApplicationContext&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è·å–å®¹å™¨ä¸Šä¸‹æ–‡ï¼ŒåŠ¨æ€è·å–Beanï¼Œå‘å¸ƒäº‹ä»¶ï¼Œè®¿é—®ç¯å¢ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BeanNameAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Bean åœ¨å®¹å™¨ä¸­çš„åç§° (String)&lt;/td&gt;
&lt;td&gt;è®© Bean çŸ¥é“è‡ªå·±åœ¨å®¹å™¨ä¸­çš„åå­—ï¼Œç”¨äºæ—¥å¿—æˆ–è°ƒè¯•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BeanFactoryAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BeanFactory&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è·å– Bean å·¥å‚ï¼Œç”¨äºæ›´åº•å±‚çš„å®¹å™¨æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;EnvironmentAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Environment&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è·å–ç¯å¢ƒé…ç½®ã€å±æ€§æ–‡ä»¶ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ApplicationEventPublisherAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ApplicationEventPublisher&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è·å–äº‹ä»¶å‘å¸ƒå™¨ï¼Œç”¨äºå‘å¸ƒåº”ç”¨äº‹ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ResourceLoaderAware&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ResourceLoader&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è·å–èµ„æºåŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ç±»è·¯å¾„æˆ–æ–‡ä»¶ç³»ç»Ÿèµ„æº&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ApplicationContextAware&lt;/code&gt;æ˜¯ Spring æä¾›çš„ä¸€ç§è®© Bean æ„ŸçŸ¥å¹¶è·å–å®¹å™¨å¼•ç”¨çš„æœºåˆ¶ã€‚å®ƒä¸»è¦ç”¨äºéœ€è¦&lt;strong&gt;åŠ¨æ€ä¸å®¹å™¨äº¤äº’&lt;/strong&gt;çš„åœºæ™¯ï¼Œå¦‚åŠ¨æ€è·å– Beanã€å‘å¸ƒäº‹ä»¶ã€è®¿é—®ç¯å¢ƒä¿¡æ¯ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æ ‡å‡†ä¸šåŠ¡é€»è¾‘å¼€å‘ä¸­ï¼Œ&lt;strong&gt;åº”ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ä¾èµ–æ³¨å…¥&lt;/strong&gt;ç­‰æ›´ç¬¦åˆ IoC åŸåˆ™çš„æ–¹å¼ã€‚å°† &lt;code&gt;ApplicationContextAware&lt;/code&gt;è§†ä¸ºä¸€ä¸ªåœ¨ç‰¹å®šåœºæ™¯ä¸‹æœ‰ç”¨çš„&lt;strong&gt;é«˜çº§å·¥å…·&lt;/strong&gt;ï¼Œè€Œéå¸¸è§„æ‰‹æ®µã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ å…¨é¢ç†è§£ ApplicationContextAwareã€‚&lt;/p&gt;
&lt;h2 id="scopeproxymodetarget_class"&gt;ScopeProxyMode.TARGET_CLASS
&lt;/h2&gt;&lt;p&gt;ã€‚åœ¨ Spring æœåŠ¡ä¸Šä½¿ç”¨ &lt;code&gt;@RequestScope&lt;/code&gt;å¹¶è®¾ç½® &lt;code&gt;proxyMode = ScopedProxyMode.TARGET_CLASS&lt;/code&gt;ï¼Œæ˜¯ä¸ºäº†è§£å†³ Bean ç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…çš„é—®é¢˜ï¼Œå¹¶ç¡®ä¿åœ¨ Web åº”ç”¨ä¸­èƒ½æ­£ç¡®è·å–å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¸‹é¢æˆ‘æ¥è¯¦ç»†è§£é‡Šã€‚&lt;/p&gt;
&lt;h3 id="-ç†è§£-requestscope"&gt;ğŸ¯ ç†è§£ @RequestScope
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RequestScope&lt;/code&gt;æ˜¯ Spring ä¸º Web åº”ç”¨æä¾›çš„ä¸€ç§ Bean ä½œç”¨åŸŸæ³¨è§£ã€‚å®ƒè¡¨æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸç»‘å®š&lt;/strong&gt;ï¼šè¯¥ Bean çš„ç”Ÿå‘½å‘¨æœŸä¸ä¸€ä¸ª &lt;strong&gt;HTTP è¯·æ±‚&lt;/strong&gt; ç»‘å®šã€‚æ¯æ¬¡æœ‰æ–°çš„ HTTP è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒSpring éƒ½ä¼šä¸ºæ­¤ Bean åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å½“è¿™ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•å¹¶è¿”å›å“åº”åï¼Œè¿™ä¸ªå®ä¾‹å°±ä¼šè¢«é”€æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹ç”¨é€”&lt;/strong&gt;ï¼šéå¸¸é€‚åˆå­˜å‚¨ä¸&lt;strong&gt;å•ä¸ªè¯·æ±‚å¯†åˆ‡ç›¸å…³&lt;/strong&gt;çš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆä» Token æˆ– Session ä¸­è§£æå‡ºçš„ç”¨æˆ· IDã€ç”¨æˆ·åç­‰ï¼‰ã€æœ¬æ¬¡è¯·æ±‚çš„ç‰¹å®šå‚æ•°ç­‰ã€‚è¿™æ ·å°±ä¸éœ€è¦åœ¨æ–¹æ³•é—´æ˜¾å¼ä¼ é€’è¿™äº›å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä¸ºä½•éœ€è¦-proxymodescopedproxymodetarget_class"&gt;ğŸ”§ ä¸ºä½•éœ€è¦ proxyMode=ScopedProxyMode.TARGET_CLASS
&lt;/h3&gt;&lt;p&gt;è¿™ä¸ªé…ç½®çš„æ ¸å¿ƒç›®çš„æ˜¯ä¸ºäº†è§£å†³&lt;strong&gt;ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ Bean ä¹‹é—´çš„ä¾èµ–é—®é¢˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯å‡è®¾&lt;/strong&gt;ï¼šä½ æœ‰ä¸€ä¸ªå•ä¾‹ï¼ˆSingletonï¼‰çš„ Serviceï¼ˆä¾‹å¦‚ &lt;code&gt;OrderService&lt;/code&gt;ï¼‰ï¼Œå®ƒéœ€è¦ä¾èµ–ä¸€ä¸ª &lt;code&gt;@RequestScope&lt;/code&gt;çš„ Beanï¼ˆä¾‹å¦‚ &lt;code&gt;CurrentUserContext&lt;/code&gt;ï¼Œç”¨äºè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜æ‰€åœ¨&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å•ä¾‹ Bean (&lt;code&gt;OrderService&lt;/code&gt;) åœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶å°±ä¼šè¢«åˆ›å»ºå¹¶åˆå§‹åŒ–ï¼Œæ­¤æ—¶å®ƒéœ€è¦æ³¨å…¥æ‰€æœ‰ä¾èµ–é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;ä½† &lt;code&gt;@RequestScope&lt;/code&gt;çš„ Bean (&lt;code&gt;CurrentUserContext&lt;/code&gt;) åªæœ‰åœ¨ HTTP è¯·æ±‚åˆ°æ¥æ—¶æ‰ä¼šè¢«åˆ›å»ºã€‚åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œæ ¹æœ¬æ²¡æœ‰è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ŒSpring æ— æ³•ç›´æ¥åˆ›å»ºä¸€ä¸ª &lt;code&gt;CurrentUserContext&lt;/code&gt;å®ä¾‹æ¥æ³¨å…¥åˆ° &lt;code&gt;OrderService&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;code&gt;proxyMode = ScopedProxyMode.TARGET_CLASS&lt;/code&gt;å°±æ˜¯å‘Šè¯‰ Springï¼šâ€œ&lt;strong&gt;ä¸è¦ç›´æ¥æ³¨å…¥ä¸€ä¸ªçœŸå®çš„ &lt;code&gt;CurrentUserContext&lt;/code&gt;å®ä¾‹ï¼Œè€Œæ˜¯æ³¨å…¥ä¸€ä¸ªå®ƒçš„ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰&lt;/strong&gt;ã€‚â€&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-scopedproxymodetarget_class-çš„å«ä¹‰"&gt;âš™ï¸ ScopedProxyMode.TARGET_CLASS çš„å«ä¹‰
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ScopedProxyMode&lt;/code&gt;å†³å®šäº†ä»£ç†çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;TARGET_CLASS&lt;/strong&gt;ï¼šæŒ‡å®šä½¿ç”¨ &lt;strong&gt;CGLIB åº“&lt;/strong&gt; æ¥åˆ›å»ºä»£ç†ã€‚è¿™ç§æ–¹å¼ä¼šç”Ÿæˆä¸€ä¸ªç›®æ ‡ç±»ï¼ˆå³è¢«ä»£ç†çš„ &lt;code&gt;@RequestScope&lt;/code&gt;Beanï¼‰çš„&lt;strong&gt;å­ç±»&lt;/strong&gt;ä½œä¸ºä»£ç†å¯¹è±¡ã€‚å®ƒ&lt;strong&gt;ä¸è¦æ±‚&lt;/strong&gt;ç›®æ ‡ Bean å®ç°ä»»ä½•æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦ä¸€ç§é€‰é¡¹æ˜¯ INTERFACES&lt;/strong&gt;ï¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚è¿™è¦æ±‚ç›®æ ‡ Bean&lt;strong&gt;å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£&lt;/strong&gt;ï¼Œä»£ç†å¯¹è±¡ä¼šå®ç°è¿™äº›æ¥å£ã€‚å¦‚æœ Bean æ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™æ— æ³•ä½¿ç”¨æ­¤æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä»£ç†å¯¹è±¡å¦‚ä½•å·¥ä½œ"&gt;ğŸš€ ä»£ç†å¯¹è±¡å¦‚ä½•å·¥ä½œ
&lt;/h3&gt;&lt;p&gt;å½“ä½ é€šè¿‡ &lt;code&gt;@Autowired&lt;/code&gt;åœ¨å•ä¾‹ Bean ä¸­æ³¨å…¥ä¸€ä¸ªé…ç½®äº† &lt;code&gt;proxyMode = ScopedProxyMode.TARGET_CLASS&lt;/code&gt;çš„ &lt;code&gt;@RequestScope&lt;/code&gt;Bean æ—¶ï¼Œå®é™…æ³¨å…¥çš„æ˜¯ä¸€ä¸ª CGLIB ä»£ç†å¯¹è±¡ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å…¥ä»£ç†&lt;/strong&gt;ï¼šSpring å®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºè¿™ä¸ªä»£ç†å¯¹è±¡ï¼ˆå®ƒæ˜¯å•ä¾‹çš„ï¼‰ï¼Œå¹¶å°†å…¶æˆåŠŸæ³¨å…¥åˆ°å•ä¾‹ Bean ä¸­ï¼Œè§£å†³äº†å¯åŠ¨æ—¶çš„ä¾èµ–é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•è°ƒç”¨è¢«æ‹¦æˆª&lt;/strong&gt;ï¼šå½“å•ä¾‹ Bean çš„ä¸šåŠ¡æ–¹æ³•è¢«è°ƒç”¨ï¼ˆä¾‹å¦‚ &lt;code&gt;orderService.placeOrder()&lt;/code&gt;ï¼‰ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•å†…éƒ¨è°ƒç”¨äº† &lt;code&gt;currentUserContext.getUserId()&lt;/code&gt;æ—¶ï¼š
&lt;ul&gt;
&lt;li&gt;è¿™ä¸ªè°ƒç”¨å®é™…ä¸Šå‘ç”Ÿåœ¨ä»£ç†å¯¹è±¡ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç†å¯¹è±¡ä¼š&lt;strong&gt;æ‹¦æˆª&lt;/strong&gt;è¿™æ¬¡æ–¹æ³•è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è·å–çœŸå®å®ä¾‹&lt;/strong&gt;ï¼šä»£ç†å¯¹è±¡ä¼š&lt;strong&gt;åœ¨å½“å‰æœ‰æ•ˆçš„ HTTP è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­&lt;/strong&gt;ï¼Œå‘ Spring å®¹å™¨è¯·æ±‚è·å–&lt;strong&gt;å½“å‰è¯·æ±‚å¯¹åº”çš„ã€çœŸå®çš„&lt;/strong&gt; &lt;code&gt;CurrentUserContext&lt;/code&gt;Bean å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å§”æ‰˜è°ƒç”¨&lt;/strong&gt;ï¼šä»£ç†å¯¹è±¡å°†æ–¹æ³•è°ƒç”¨ï¼ˆ&lt;code&gt;getUserId()&lt;/code&gt;ï¼‰&lt;strong&gt;å§”æ‰˜&lt;/strong&gt;ç»™åˆšåˆšè·å–åˆ°çš„çœŸå®å®ä¾‹å»æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›ç»“æœ&lt;/strong&gt;ï¼šçœŸå®å®ä¾‹æ‰§è¡Œå®Œæ¯•åï¼Œå°†ç»“æœè¿”å›ç»™ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å†å°†å…¶è¿”å›ç»™æœ€åˆçš„è°ƒç”¨è€…ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹å¯¹å¼€å‘è€…æ˜¯é€æ˜çš„ï¼Œä½ æ„Ÿè§‰å°±åƒåœ¨ç›´æ¥æ“ä½œä¸€ä¸ªæ™®é€šçš„ Beanï¼Œä½†å®é™…ä¸Šæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½å¯èƒ½èƒŒåå…³è”ç€ä¸åŒçš„è¯·æ±‚å®ä¾‹ã€‚&lt;/p&gt;
&lt;h3 id="-ä¸åŒä½œç”¨åŸŸçš„ç‰¹å¾"&gt;ğŸ“Š ä¸åŒä½œç”¨åŸŸçš„ç‰¹å¾
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä½œç”¨åŸŸ (Scope)&lt;/th&gt;
&lt;th&gt;ç”Ÿå‘½å‘¨æœŸä¸èŒƒå›´&lt;/th&gt;
&lt;th&gt;å…¸å‹ä½¿ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€è¦ä»£ç†è§£å†³æ³¨å…¥é—®é¢˜ï¼Ÿ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;singleton&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring IoC å®¹å™¨ (é»˜è®¤)&lt;/td&gt;
&lt;td&gt;æ— çŠ¶æ€æœåŠ¡ã€å·¥å…·ç±»ã€é…ç½®ç±»&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;prototype&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡é€šè¿‡å®¹å™¨è·å–æ—¶&lt;/td&gt;
&lt;td&gt;éœ€è¦ä¿æŒç‹¬ç«‹çŠ¶æ€çš„å¯¹è±¡&lt;/td&gt;
&lt;td&gt;æ˜¯ (å½“è¢«å•ä¾‹Beanä¾èµ–æ—¶)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;request&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€æ¬¡ HTTP è¯·æ±‚&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å½“å‰è¯·æ±‚ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·èº«ä»½ã€è¯·æ±‚å‚æ•°&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ (å½“è¢«æ›´é•¿ç”Ÿå‘½å‘¨æœŸçš„Beanå¦‚å•ä¾‹ä¾èµ–æ—¶)&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;session&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ªç”¨æˆ·ä¼šè¯ (Session)&lt;/td&gt;
&lt;td&gt;è´­ç‰©è½¦ã€ç”¨æˆ·ç™»å½•çŠ¶æ€&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ (å½“è¢«æ›´é•¿ç”Ÿå‘½å‘¨æœŸçš„Beanå¦‚å•ä¾‹ä¾èµ–æ—¶)&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;application&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•´ä¸ª Web åº”ç”¨ (ServletContext)&lt;/td&gt;
&lt;td&gt;å…¨å±€é…ç½®ã€åº”ç”¨çº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸éœ€è¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;websocket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ª WebSocket ä¼šè¯&lt;/td&gt;
&lt;td&gt;å®æ—¶é€šä¿¡ï¼Œå¦‚èŠå¤©å®¤&lt;/td&gt;
&lt;td&gt;è§†æƒ…å†µè€Œå®š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-3"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CGLIB é™åˆ¶&lt;/strong&gt;ï¼šç”±äº &lt;code&gt;TARGET_CLASS&lt;/code&gt;ä½¿ç”¨ CGLIB é€šè¿‡ç”Ÿæˆå­ç±»æ¥åˆ›å»ºä»£ç†ï¼Œå› æ­¤&lt;strong&gt;è¢«ä»£ç†çš„ç±»ä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;ç±»&lt;/strong&gt;ï¼Œå¹¶ä¸”&lt;strong&gt;è¦è¢«é‡å†™çš„æ–¹æ³•ä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å¾®å°å¼€é”€&lt;/strong&gt;ï¼šæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½éœ€è¦é€šè¿‡ä»£ç†é—´æ¥è·å–çœŸå®å®ä¾‹ï¼Œä¼šæœ‰éå¸¸å¾®å°çš„æ€§èƒ½å¼€é”€ï¼Œä½†åœ¨å¤§å¤šæ•° Web åº”ç”¨ä¸­é€šå¸¸å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒè¯•&lt;/strong&gt;ï¼šåœ¨æ—¥å¿—æˆ–è°ƒè¯•å™¨ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ° Bean çš„ç±»å‹æ˜¯ç±»ä¼¼ &lt;code&gt;CurrentUserContext$$EnhancerBySpringCGLIB$$...&lt;/code&gt;è¿™æ ·çš„åç§°ï¼Œè¿™è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª CGLIB ä»£ç†å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ä¸º &lt;code&gt;@RequestScope&lt;/code&gt;Bean è®¾ç½® &lt;code&gt;proxyMode = ScopedProxyMode.TARGET_CLASS&lt;/code&gt;ï¼Œå®è´¨ä¸Šæ˜¯ Spring æä¾›çš„ä¸€ç§ &lt;strong&gt;â€œå»¶è¿ŸæŸ¥æ‰¾â€&lt;/strong&gt; æœºåˆ¶ã€‚å®ƒé€šè¿‡æ³¨å…¥ä¸€ä¸ª&lt;strong&gt;ä»£ç†å¯¹è±¡&lt;/strong&gt;æ¥è§£å†³é•¿ç”Ÿå‘½å‘¨æœŸ Beanï¼ˆå¦‚ Singletonï¼‰ä¾èµ–çŸ­ç”Ÿå‘½å‘¨æœŸ Beanï¼ˆå¦‚ Requestï¼‰æ—¶çš„çŸ›ç›¾ï¼Œç¡®ä¿æ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½èƒ½&lt;strong&gt;å®‰å…¨ä¸”é€æ˜åœ°è·å–åˆ°å½“å‰è¯·æ±‚å¯¹åº”çš„çœŸå®å®ä¾‹&lt;/strong&gt;ï¼Œä»è€Œåœ¨ Web åº”ç”¨ä¸­ä¼˜é›…åœ°å¤„ç†è¯·æ±‚èŒƒå›´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id="scopedproxymode"&gt;ScopedProxyMode
&lt;/h2&gt;&lt;p&gt;ScopedProxyMode æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºæŒ‡å®š&lt;strong&gt;ä½œç”¨åŸŸä»£ç†æ¨¡å¼&lt;/strong&gt;çš„å…³é”®æšä¸¾ï¼Œå®ƒå†³å®šäº† Spring å¦‚ä½•è§£å†³ä¸åŒç”Ÿå‘½å‘¨æœŸ Bean ä¹‹é—´çš„ä¾èµ–é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å°†çŸ­ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ requestã€sessionï¼‰çš„ Bean æ³¨å…¥åˆ°é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ singletonï¼‰çš„ Bean ä¸­æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ‰€æœ‰ &lt;code&gt;ScopedProxyMode&lt;/code&gt;æšä¸¾å€¼çš„è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä»£ç†æ¨¡å¼ (ScopedProxyMode)&lt;/th&gt;
&lt;th&gt;å®ç°æ–¹å¼&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ç‰¹ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;DEFAULT&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸ç­‰åŒäº &lt;code&gt;NO&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–é»˜è®¤é…ç½®çš„åœºæ™¯&lt;/td&gt;
&lt;td&gt;å…¶è¡Œä¸ºå–å†³äºç»„ä»¶æ‰«æçº§åˆ«é…ç½®çš„é»˜è®¤å€¼ï¼Œé€šå¸¸å›é€€ä¸º &lt;code&gt;NO&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NO&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸åˆ›å»ºä»»ä½•ä»£ç†&lt;/td&gt;
&lt;td&gt;ç›¸åŒæˆ–å…¼å®¹ä½œç”¨åŸŸ Bean é—´çš„ä¾èµ–ï¼ˆå¦‚ singleton æ³¨å…¥ singletonï¼‰&lt;/td&gt;
&lt;td&gt;ç›´æ¥æ³¨å…¥ç›®æ ‡ Bean çš„å®ä¾‹ã€‚&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè‹¥å°†çŸ­ç”Ÿå‘½å‘¨æœŸ Bean æ³¨å…¥é•¿ç”Ÿå‘½å‘¨æœŸ Bean ä¸”ä¸ä½¿ç”¨ä»£ç†ï¼Œå¯èƒ½å¯¼è‡´é•¿ç”Ÿå‘½å‘¨æœŸ Bean å§‹ç»ˆæŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸ Bean çš„&lt;strong&gt;åŒä¸€ä¸ªå®ä¾‹&lt;/strong&gt;ï¼Œæ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;INTERFACES&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;strong&gt;JDK åŠ¨æ€ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»£ç†çš„ç›®æ ‡å¯¹è±¡&lt;strong&gt;å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿæˆçš„ä»£ç†å¯¹è±¡å®ç°äº†ç›®æ ‡å¯¹è±¡çš„æ‰€æœ‰æ¥å£ã€‚&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼šå¦‚æœè¢«ä»£ç†çš„ç±»æœªå®ç°ä»»ä½•æ¥å£ï¼Œä½¿ç”¨æ­¤æ¨¡å¼ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TARGET_CLASS&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;strong&gt;CGLIB åº“&lt;/strong&gt;ç”Ÿæˆå­ç±»è¿›è¡Œä»£ç†&lt;/td&gt;
&lt;td&gt;ä»£ç†çš„ç›®æ ‡å¯¹è±¡æ˜¯&lt;strong&gt;ç±»&lt;/strong&gt;ï¼ˆæ— è®ºæ˜¯å¦å®ç°æ¥å£ï¼‰&lt;/td&gt;
&lt;td&gt;é€šè¿‡ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»æ¥åˆ›å»ºä»£ç†ã€‚è¿™æ˜¯ &lt;code&gt;@RefreshScope&lt;/code&gt;ç­‰æ³¨è§£çš„&lt;strong&gt;é»˜è®¤æ¨¡å¼&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒé€‚ç”¨æ€§æ›´å¹¿ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å·¥ä½œåŸç†ä»¥-target_class-ä¸ºä¾‹"&gt;ğŸ”§ å·¥ä½œåŸç†ï¼ˆä»¥ TARGET_CLASS ä¸ºä¾‹ï¼‰
&lt;/h3&gt;&lt;p&gt;å½“ä½ å°†ä¸€ä¸ª &lt;code&gt;@RequestScope&lt;/code&gt;Beanï¼ˆçŸ­ç”Ÿå‘½å‘¨æœŸï¼‰æ³¨å…¥åˆ°ä¸€ä¸ª Singleton Beanï¼ˆé•¿ç”Ÿå‘½å‘¨æœŸï¼‰æ—¶ï¼Œå¹¶è®¾ç½®äº† &lt;code&gt;proxyMode = ScopedProxyMode.TARGET_CLASS&lt;/code&gt;ï¼ŒSpring å®é™…æ³¨å…¥çš„æ˜¯ä¸€ä¸ª &lt;strong&gt;CGLIB ä»£ç†å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†å¯¹è±¡æ³¨å…¥&lt;/strong&gt;ï¼šSingleton Bean åœ¨åˆå§‹åŒ–æ—¶ï¼ŒæˆåŠŸæ³¨å…¥çš„æ˜¯è¿™ä¸ªä»£ç†å¯¹è±¡ï¼ˆå®ƒæœ¬èº«æ˜¯å•ä¾‹çš„ï¼‰ï¼Œè§£å†³äº†å®¹å™¨å¯åŠ¨æ—¶çŸ­ç”Ÿå‘½å‘¨æœŸ Bean å®ä¾‹å°šæœªå­˜åœ¨çš„çŸ›ç›¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•è°ƒç”¨æ‹¦æˆª&lt;/strong&gt;ï¼šå½“ Singleton Bean çš„ä¸šåŠ¡æ–¹æ³•è¢«è°ƒç”¨ï¼Œå¹¶è¿›è€Œè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼ˆå¦‚ &lt;code&gt;userPreferences.getSettings()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶è·å–ç›®æ ‡&lt;/strong&gt;ï¼šä»£ç†å¯¹è±¡ä¼šæ‹¦æˆªæ­¤æ¬¡è°ƒç”¨ï¼Œå¹¶å‘ Spring å®¹å™¨&lt;strong&gt;å®æ—¶è¯·æ±‚&lt;/strong&gt;å½“å‰ HTTP è¯·æ±‚å¯¹åº”çš„ã€çœŸæ­£çš„ &lt;code&gt;@RequestScope&lt;/code&gt;Bean å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å§”æ‰˜æ‰§è¡Œ&lt;/strong&gt;ï¼šä»£ç†å¯¹è±¡å°†æ–¹æ³•è°ƒç”¨&lt;strong&gt;å§”æ‰˜&lt;/strong&gt;ç»™åˆšåˆšè·å–åˆ°çš„çœŸå®å®ä¾‹æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›ç»“æœ&lt;/strong&gt;ï¼šæœ€ç»ˆå°†çœŸå®å®ä¾‹æ‰§è¡Œçš„ç»“æœè¿”å›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹å¯¹å¼€å‘è€…æ˜¯é€æ˜çš„ï¼Œè®©ä½ æ„Ÿè§‰åƒæ˜¯åœ¨ç›´æ¥æ“ä½œä¸€ä¸ªæ™®é€šçš„ Beanã€‚&lt;/p&gt;
&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼šä½¿ç”¨ä»£ç†ï¼ˆç‰¹åˆ«æ˜¯ &lt;code&gt;TARGET_CLASS&lt;/code&gt;ï¼‰ä¼šå¸¦æ¥å¾®å°çš„æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½å¯èƒ½æ¶‰åŠä»£ç†æ‹¦æˆªå’Œä»å®¹å™¨ä¸­è·å–ç›®æ ‡å®ä¾‹çš„æ“ä½œã€‚ä½†å¯¹äºå¤§å¤šæ•° Web åº”ç”¨ï¼Œè¿™ç‚¹å¼€é”€é€šå¸¸å¯ä»¥æ¥å—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç±»è®¾è®¡çº¦æŸ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨ &lt;code&gt;TARGET_CLASS&lt;/code&gt;ï¼Œè¢«ä»£ç†çš„&lt;strong&gt;ç±»ä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;&lt;/strong&gt; çš„ï¼Œå› ä¸º CGLIB éœ€è¦é€šè¿‡ç»§æ‰¿æ¥ç”Ÿæˆå­ç±»ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¢«ä»£ç†çš„&lt;strong&gt;æ–¹æ³•ä¹Ÿä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;&lt;/strong&gt; çš„ï¼Œå¦åˆ™æ— æ³•è¢«é‡å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒè¯•&lt;/strong&gt;ï¼šåœ¨è°ƒè¯•æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°æ³¨å…¥çš„ Bean ç±»å‹æ˜¯ç±»ä¼¼ &lt;code&gt;MyBean$$EnhancerBySpringCGLIB$$...&lt;/code&gt;è¿™æ ·çš„å½¢å¼ï¼Œè¿™è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª CGLIB ä»£ç†å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;TARGET_CLASS&lt;/code&gt;æ¨¡å¼éœ€è¦é¡¹ç›®ä¸­æœ‰ CGLIB åº“ã€‚å¦‚æœä½ ä½¿ç”¨ Spring Bootï¼Œå®ƒå·²ç»è‡ªåŠ¨åŒ…å«äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©ä»£ç†æ¨¡å¼"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©ä»£ç†æ¨¡å¼
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤æˆ–ç®€å•åœºæ™¯&lt;/strong&gt;ï¼šå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œé€šå¸¸ä½¿ç”¨ &lt;code&gt;@Scope&lt;/code&gt;æ³¨è§£çš„ &lt;strong&gt;&lt;code&gt;proxyMode&lt;/code&gt;é»˜è®¤å€¼&lt;/strong&gt;å³å¯ã€‚ä¾‹å¦‚ &lt;code&gt;@RefreshScope&lt;/code&gt;é»˜è®¤å°±æ˜¯ &lt;code&gt;TARGET_CLASS&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿½æ±‚æ˜ç¡®æ€§&lt;/strong&gt;ï¼šè‹¥å¸Œæœ›æ˜¾å¼æ§åˆ¶ï¼Œå¯æ ¹æ®ç›®æ ‡ Bean ç±»å‹é€‰æ‹©ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœ Bean&lt;strong&gt;å®ç°äº†æ¥å£&lt;/strong&gt;ï¼Œä¸”ä½ å¸Œæœ›åŸºäºæ¥å£ç¼–ç¨‹ï¼Œå¯ä»¥è€ƒè™‘ &lt;code&gt;INTERFACES&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ Beanæ˜¯&lt;strong&gt;ç±»&lt;/strong&gt;ï¼ˆå°¤å…¶æ˜¯æœªå®ç°æ¥å£çš„ï¼‰ï¼Œæˆ–è€…æƒ³è¦æœ€å¹¿æ³›çš„å…¼å®¹æ€§ï¼Œ&lt;strong&gt;&lt;code&gt;TARGET_CLASS&lt;/code&gt;æ˜¯æœ€å®‰å…¨å¯é çš„é€‰æ‹©&lt;/strong&gt;ï¼Œè¿™ä¹Ÿæ˜¯è®¸å¤š Spring æ³¨è§£çš„é»˜è®¤è¡Œä¸ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…æ„å¤–&lt;/strong&gt;ï¼šé™¤éä½ éå¸¸æ¸…æ¥šä¸å­˜åœ¨ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…çš„é—®é¢˜ï¼Œå¦åˆ™&lt;strong&gt;è°¨æ…ä½¿ç”¨ &lt;code&gt;NO&lt;/code&gt;&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´éš¾ä»¥å¯Ÿè§‰çš„ Bugã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ£€æŸ¥ä»£ç†å¯¹è±¡"&gt;ğŸ” æ£€æŸ¥ä»£ç†å¯¹è±¡
&lt;/h3&gt;&lt;p&gt;Spring æä¾›äº† &lt;code&gt;AopUtils&lt;/code&gt;å·¥å…·ç±»æ¥å¸®åŠ©åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä»£ç†ä»¥åŠæ˜¯ä½•ç§ä»£ç†ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.aop.support.AopUtils;
// æ£€æŸ¥æ˜¯å¦æ˜¯ JDK åŠ¨æ€ä»£ç†
AopUtils.isJdkDynamicProxy(bean);
// æ£€æŸ¥æ˜¯å¦æ˜¯ CGLIB ä»£ç†
AopUtils.isCglibProxy(bean);
// è·å–ä»£ç†å¯¹è±¡èƒŒåçš„ç›®æ ‡ç±»
AopUtils.getTargetClass(bean);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç†è§£ &lt;code&gt;ScopedProxyMode&lt;/code&gt;çš„ä¸åŒæ¨¡å¼åŠå…¶é€‚ç”¨åœºæ™¯ï¼Œèƒ½å¸®åŠ©ä½ åœ¨ Spring åº”ç”¨ä¸­æ›´ä¼˜é›…åœ°ç®¡ç† Bean çš„ä½œç”¨åŸŸå’Œä¾èµ–å…³ç³»ï¼Œé¿å…å¸¸è§çš„é™·é˜±ã€‚&lt;/p&gt;
&lt;h2 id="configuration-çš„-proxybeanmethods"&gt;@Configuration çš„ proxyBeanMethods
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£ä¸­çš„ &lt;code&gt;proxyBeanMethods&lt;/code&gt;å±æ€§æ˜¯ Spring Boot 2.2 åŠä»¥ä¸Šç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒå†³å®šäº†é…ç½®ç±»ä¸­ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•æ˜¯å¦è¢«ä»£ç†ï¼Œç›´æ¥å½±å“ Bean çš„åˆ›å»ºæ–¹å¼å’Œåº”ç”¨æ€§èƒ½ã€‚ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“å®ƒçš„ä¸¤ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;Full å…¨æ¨¡å¼ (&lt;code&gt;proxyBeanMethods = true&lt;/code&gt;) ğŸŒŸ&lt;/th&gt;
&lt;th&gt;Lite è½»é‡çº§æ¨¡å¼ (&lt;code&gt;proxyBeanMethods = false&lt;/code&gt;) âš¡&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;strong&gt;CGLIB ä»£ç†&lt;/strong&gt;é…ç½®ç±»&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ— ä»£ç†&lt;/strong&gt;ï¼Œé…ç½®ç±»ä¸ºæ™®é€šç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean å®ä¾‹ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¡®ä¿é€šè¿‡é…ç½®ç±»æ–¹æ³•è°ƒç”¨è·å–çš„æ˜¯ &lt;strong&gt;Spring å®¹å™¨ä¸­çš„å•ä¾‹ Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è°ƒç”¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•éƒ½&lt;strong&gt;æ‰§è¡Œæ–¹æ³•ä½“&lt;/strong&gt;ï¼Œé€šå¸¸&lt;strong&gt;åˆ›å»ºæ–°å®ä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼šèµ° Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸ä¼šèµ°&lt;/strong&gt; Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•è°ƒç”¨çº¦æŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¢«ä»£ç†çš„é…ç½®ç±»åŠå…¶ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•&lt;strong&gt;ä¸èƒ½å£°æ˜ä¸º &lt;code&gt;final&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®ç±»å’Œæ–¹æ³•å¯å£°æ˜ä¸º &lt;code&gt;final&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ‰&lt;strong&gt;ä»£ç†åˆ›å»ºå’Œè¿è¡Œæ—¶æ‹¦æˆªçš„å¼€é”€&lt;/strong&gt;ï¼Œ&lt;strong&gt;å¯åŠ¨ç¨æ…¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ— ä»£ç†å¼€é”€&lt;/strong&gt;ï¼Œ&lt;strong&gt;å¯åŠ¨æ›´å¿«&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒé€šè¿‡&lt;strong&gt;æ–¹æ³•è°ƒç”¨&lt;/strong&gt;åœ¨é…ç½®ç±»å†…éƒ¨&lt;strong&gt;ç›´æ¥å¼•ç”¨å…¶ä»– &lt;code&gt;@Bean&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®ç±»å†…éƒ¨&lt;strong&gt;æ— æ³•é€šè¿‡æ–¹æ³•è°ƒç”¨ä¾èµ–å…¶ä»– &lt;code&gt;@Bean&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®ç±»ä¸­çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•&lt;strong&gt;å­˜åœ¨ç›¸äº’ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®ç±»ä¸­çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•&lt;strong&gt;ç›¸äº’ç‹¬ç«‹&lt;/strong&gt;ï¼Œæ— è°ƒç”¨å…³ç³»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Š &lt;strong&gt;å…³äºæ€§èƒ½çš„è¡¥å……è¯´æ˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Full æ¨¡å¼&lt;/strong&gt;ï¼šä»£ç†å¼€é”€åŒ…æ‹¬ç”Ÿæˆ CGLIB å­ç±»ã€è¿è¡Œæ—¶æ–¹æ³•æ‹¦æˆªå’Œæ£€æŸ¥å®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨ Bean å®ä¾‹ã€‚è¿™åœ¨æœ‰è®¸å¤šé…ç½®ç±»æ—¶å¯èƒ½å¯¹å¯åŠ¨æ€§èƒ½æœ‰å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Lite æ¨¡å¼&lt;/strong&gt;ï¼šè™½æ— ä»£ç†å¼€é”€ï¼Œä½†è‹¥ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¢«é¢‘ç¹è°ƒç”¨ä¸”åŒ…å«å¤æ‚é€»è¾‘ï¼Œæ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹ä¹Ÿå¯èƒ½å¸¦æ¥æ€§èƒ½è´Ÿæ‹…ã€‚é€šå¸¸å…¶å¯åŠ¨é€Ÿåº¦ä¼˜äº Full æ¨¡å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©æ¨¡å¼-1"&gt;ğŸ§© å¦‚ä½•é€‰æ‹©æ¨¡å¼ï¼Ÿ
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©çš„å…³é”®åœ¨äºåˆ¤æ–­é…ç½®ç±»å†…éƒ¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¹‹é—´æ˜¯å¦å­˜åœ¨è°ƒç”¨å…³ç³»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ Full æ¨¡å¼ (&lt;code&gt;proxyBeanMethods = true&lt;/code&gt;) çš„æƒ…å†µ&lt;/strong&gt;ï¼šå½“ä½ çš„é…ç½®ç±»ä¸­ï¼Œä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•éœ€è¦è°ƒç”¨å¦ä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•æ¥è·å–ä¾èµ–é¡¹æ—¶ã€‚è¿™æ˜¯ &lt;strong&gt;Spring Boot 2.2 ä¹‹åçš„é»˜è®¤è¡Œä¸º&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration(proxyBeanMethods = true) // é»˜è®¤å€¼ï¼Œæ˜¾å¼å†™å‡ºä¾¿äºç†è§£
public class AppConfig {
@Bean
public DataSource dataSource() {
// åˆ›å»ºå¹¶é…ç½® DataSource
return new HikariDataSource();
}
@Bean
public JdbcTemplate jdbcTemplate() {
// ç›´æ¥è°ƒç”¨ dataSource() æ–¹æ³•ï¼Œè·å–çš„æ˜¯å®¹å™¨ä¸­å”¯ä¸€çš„ DataSource Bean
return new JdbcTemplate(dataSource());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ Lite æ¨¡å¼ (&lt;code&gt;proxyBeanMethods = false&lt;/code&gt;) çš„æƒ…å†µ&lt;/strong&gt;ï¼šå½“é…ç½®ç±»ä¸­çš„æ¯ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•éƒ½æ˜¯è‡ªåŒ…å«çš„ï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰è°ƒç”¨å…³ç³»æ—¶ã€‚&lt;strong&gt;Spring Boot è‡ªèº«çš„è®¸å¤šè‡ªåŠ¨é…ç½®ç±»é‡‡ç”¨æ­¤æ¨¡å¼ä»¥ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration(proxyBeanMethods = false) // æ˜¾å¼è®¾ç½®ä¸º Lite æ¨¡å¼
public class UtilsConfig {
@Bean
public MyUtility myUtility() {
return new MyUtility();
}
@Bean
public MyTool myTool() {
return new MyTool();
}
// myUtility() å’Œ myTool() ç›¸äº’ç‹¬ç«‹
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‹¥åœ¨ Lite æ¨¡å¼çš„é…ç½®ç±»ä¸­éœ€è¦å»ºç«‹ Bean ä¹‹é—´çš„ä¾èµ–ï¼Œåº”é€šè¿‡æ–¹æ³•&lt;strong&gt;å‚æ•°&lt;/strong&gt;è®© Spring è‡ªåŠ¨æ³¨å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration(proxyBeanMethods = false)
public class AppConfig {
@Bean
public DataSource dataSource() {
return new HikariDataSource();
}
@Bean
// é€šè¿‡å‚æ•°å£°æ˜ä¾èµ–ï¼ŒSpringä¼šè‡ªåŠ¨ä»å®¹å™¨ä¸­æä¾›DataSource Bean
public JdbcTemplate jdbcTemplate(DataSource dataSource) {
return new JdbcTemplate(dataSource);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-é‡è¦çš„ä½¿ç”¨çº¦æŸ"&gt;âš ï¸ é‡è¦çš„ä½¿ç”¨çº¦æŸ
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ Full æ¨¡å¼æ—¶ï¼Œè¯·æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±äº Spring æ˜¯é€šè¿‡ CGLIB ç”Ÿæˆç›®æ ‡é…ç½®ç±»çš„å­ç±»æ¥åˆ›å»ºä»£ç†çš„ï¼Œå› æ­¤&lt;strong&gt;é…ç½®ç±»æœ¬èº«ä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;çš„&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ç±»ä¸­&lt;strong&gt;è¢« &lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ä¹Ÿä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;æˆ– &lt;code&gt;private&lt;/code&gt;çš„&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦è¢«é‡å†™ä»¥å®ç°ä»£ç†é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ç®€å•æ¥è¯´"&gt;ğŸ’¡ ç®€å•æ¥è¯´
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æƒ³è¦åœ¨é…ç½®ç±»å†…éƒ¨é€šè¿‡æ–¹æ³•è°ƒç”¨ç›´æ¥å¼•ç”¨å…¶ä»– &lt;code&gt;@Bean&lt;/code&gt;ï¼Œå¹¶ç¡®ä¿æ‹¿åˆ°çš„æ˜¯å•ä¾‹ â†’ ç”¨ &lt;code&gt;proxyBeanMethods = true&lt;/code&gt;(Fullæ¨¡å¼)&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿½æ±‚æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦ï¼Œä¸”é…ç½®ç±»ä¸­çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ç›¸äº’ç‹¬ç«‹ï¼Œæˆ–é€šè¿‡æ–¹æ³•å‚æ•°æ³¨å…¥ä¾èµ– â†’ ç”¨ &lt;code&gt;proxyBeanMethods = false&lt;/code&gt;(Liteæ¨¡å¼)&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ä¸ç¡®å®šï¼Œéµå¾ª Spring çš„é»˜è®¤è®¾ç½® &lt;code&gt;proxyBeanMethods = true&lt;/code&gt;æ˜¯å®‰å…¨çš„é€‰æ‹©ã€‚å½“ä½ æ˜ç¡®é…ç½®ç±»ä¸­æ— å†…éƒ¨æ–¹æ³•è°ƒç”¨ä¸”å…³æ³¨å¯åŠ¨æ€§èƒ½æ—¶ï¼Œå¯ä»¥æ˜¾å¼è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="componentscan"&gt;@ComponentScan
&lt;/h2&gt;&lt;p&gt;è¿™å¥è¯å¾ˆå¥½åœ°æ¦‚æ‹¬äº† &lt;code&gt;@ComponentScan&lt;/code&gt;çš„æ ¸å¿ƒå·¥ä½œæœºåˆ¶ã€‚å®ƒå°±åƒ Spring åœ¨å¯åŠ¨æ—¶çš„ä¸€ä½â€œä¾¦å¯Ÿå…µâ€ï¼Œä½ å‘Šè¯‰å®ƒå»å“ªäº›åŒºåŸŸï¼ˆæ‰«æèŒƒå›´ï¼‰æœå¯»ï¼Œå¹¶ä¸”åªæŠŠå¸¦æœ‰ç‰¹å®šæ ‡è¯†ï¼ˆç‰¹å®šæ³¨è§£ï¼‰çš„ç›®æ ‡å¸¦å›å¤§æœ¬è¥ï¼ˆSpring å®¹å™¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ€»ç»“è¿™ä¸¤ä¸ªå…³é”®ç‚¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;th&gt;å¦‚ä½•è®¾ç½®&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰«æèŒƒå›´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰ Spring è¦å»&lt;strong&gt;å“ªäº›åŒ…åŠå…¶å­åŒ…&lt;/strong&gt;ä¸‹æŸ¥æ‰¾ç±»æ–‡ä»¶&lt;/td&gt;
&lt;td&gt;&lt;code&gt;basePackages&lt;/code&gt;: ç›´æ¥æŒ‡å®šåŒ…åå­—ç¬¦ä¸² &lt;code&gt;basePackageClasses&lt;/code&gt;: é€šè¿‡ç±»åæ¨å…¶æ‰€åœ¨åŒ…&lt;/td&gt;
&lt;td&gt;å®šä¹‰äº†â€œç‰©ç†æœç´¢ç©ºé—´â€ï¼Œä¸åœ¨æ­¤èŒƒå›´å†…çš„ç±»æ–‡ä»¶æ ¹æœ¬ä¸ä¼šè¢« Spring è€ƒè™‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‰¹å®šæ³¨è§£ (è½½å…¥æ¡ä»¶)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰åœ¨æ‰«æèŒƒå›´å†…ï¼Œ&lt;strong&gt;å“ªäº›ç±»åº”è¯¥è¢«è¯†åˆ«&lt;/strong&gt;å¹¶æ³¨å†Œä¸º Bean&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤è¯†åˆ«&lt;/strong&gt;: &lt;code&gt;@Component&lt;/code&gt;, &lt;code&gt;@Service&lt;/code&gt;, &lt;code&gt;@Repository&lt;/code&gt;, &lt;code&gt;@Controller&lt;/code&gt;ç­‰ &lt;strong&gt;è‡ªå®šä¹‰è¿‡æ»¤&lt;/strong&gt;: ä½¿ç”¨ &lt;code&gt;includeFilters&lt;/code&gt;/ &lt;code&gt;excludeFilters&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰äº†â€œé€»è¾‘å…¥é€‰æ ‡å‡†â€ï¼Œå³ä½¿ç±»åœ¨æ‰«æèŒƒå›´å†…ï¼Œæ²¡æœ‰ç‰¹å®šæ³¨è§£ä¹Ÿä¸ä¼šè¢«è‡ªåŠ¨è½½å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å·¥ä½œåŸç†åˆ†æ­¥è§£æ"&gt;ğŸ” å·¥ä½œåŸç†åˆ†æ­¥è§£æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ’å®šèŒƒå›´ï¼ˆæ‰«æèŒƒå›´ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;Spring é¦–å…ˆæ ¹æ® &lt;code&gt;@ComponentScan&lt;/code&gt;æ³¨è§£ä¸­å®šä¹‰çš„ &lt;code&gt;basePackages&lt;/code&gt;æˆ– &lt;code&gt;basePackageClasses&lt;/code&gt;å±æ€§æ¥ç¡®å®šè¦æ‰«æçš„åŒ…è·¯å¾„ã€‚å¦‚æœä¸æ˜¾å¼æŒ‡å®šï¼Œåˆ™&lt;strong&gt;é»˜è®¤æ‰«ææ ‡æ³¨äº† &lt;code&gt;@ComponentScan&lt;/code&gt;çš„è¿™ä¸ªé…ç½®ç±»æ‰€åœ¨çš„åŒ…åŠå…¶æ‰€æœ‰å­åŒ…&lt;/strong&gt; ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€ä¸€æ’æŸ¥ï¼ˆæ‰«æè¿‡ç¨‹ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;Spring ä¼šéå†æ‰«æèŒƒå›´å†…çš„æ‰€æœ‰ &lt;code&gt;.class&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ£€æŸ¥æ ‡è¯†ï¼ˆè¿‡æ»¤æ¡ä»¶ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ªç±»ï¼ŒSpring ä¼šæ£€æŸ¥å…¶æ˜¯å¦å¸¦æœ‰ç‰¹å®šçš„æ³¨è§£ã€‚&lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹&lt;/strong&gt;ï¼ŒSpring ä¼šè¯†åˆ«æ ‡æ³¨äº† &lt;code&gt;@Component&lt;/code&gt;ã€&lt;code&gt;@Service&lt;/code&gt;ã€&lt;code&gt;@Repository&lt;/code&gt;ã€&lt;code&gt;@Controller&lt;/code&gt;ç­‰æ³¨è§£çš„ç±» ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è½½å…¥å®¹å™¨ï¼ˆæ³¨å†ŒBeanï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å‘ç°ç¬¦åˆæ¡ä»¶çš„ç±»ï¼ŒSpring å°±ä¼šå°†å…¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼Œæˆä¸ºä¸€ä¸ªå¯ä¾›ä½¿ç”¨çš„ Beanã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-é€šè¿‡è¿‡æ»¤å™¨ç²¾ç»†æ§åˆ¶"&gt;âš™ï¸ é€šè¿‡è¿‡æ»¤å™¨ç²¾ç»†æ§åˆ¶
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@ComponentScan&lt;/code&gt;æä¾›äº†å¼ºå¤§çš„ &lt;code&gt;includeFilters&lt;/code&gt;å’Œ &lt;code&gt;excludeFilters&lt;/code&gt;å±æ€§ï¼Œå…è®¸ä½ è¶…è¶Šé»˜è®¤çš„æ³¨è§£è§„åˆ™ï¼Œè¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;includeFilters&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äº&lt;strong&gt;åŒ…å«&lt;/strong&gt;é‚£äº›å³ä½¿æ²¡æœ‰é»˜è®¤æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Component&lt;/code&gt;ï¼‰çš„ç±»ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®¾ç½®åªåŒ…å«æ‰€æœ‰å®ç°äº†æŸä¸ªæ¥å£çš„ç±»ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@ComponentScan(
basePackages = &amp;#34;com.example&amp;#34;,
includeFilters = @ComponentScan.Filter(
type = FilterType.ASSIGNABLE_TYPE, // æŒ‰ç±»å‹åˆ†é…
classes = MyCustomInterface.class // åŒ…å«æ‰€æœ‰å®ç°äº†æ­¤æ¥å£çš„ç±»
),
useDefaultFilters = false // å…³é—­é»˜è®¤è¿‡æ»¤è§„åˆ™ï¼
)
public class AppConfig {
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;excludeFilters&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äº&lt;strong&gt;æ’é™¤&lt;/strong&gt;é‚£äº›è™½ç„¶ç¬¦åˆé»˜è®¤è§„åˆ™ä½†ä½ ä¸æƒ³æ³¨å†Œçš„ç±»ã€‚ä¾‹å¦‚ï¼Œæ’é™¤æ‰€æœ‰æ ‡æ³¨äº† &lt;code&gt;@Controller&lt;/code&gt;çš„ç±»ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@ComponentScan(
basePackages = &amp;#34;com.example&amp;#34;,
excludeFilters = @ComponentScan.Filter(
type = FilterType.ANNOTATION, // æŒ‰æ³¨è§£æ’é™¤
classes = Controller.class // æ’é™¤æ‰€æœ‰@Controlleræ³¨è§£çš„ç±»
)
)
public class AppConfig {
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FilterType çš„ç±»å‹åŒ…æ‹¬&lt;/strong&gt; ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ANNOTATION&lt;/code&gt;ï¼šæ ¹æ®æ³¨è§£è¿›è¡Œè¿‡æ»¤ï¼ˆé»˜è®¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ASSIGNABLE_TYPE&lt;/code&gt;ï¼šæ ¹æ®ç»™å®šçš„ç±»å‹ï¼ˆç±»æˆ–æ¥å£ï¼‰è¿›è¡Œè¿‡æ»¤ï¼Œå…¶å­ç±»æˆ–å®ç°ç±»ä¹Ÿä¼šè¢«åŒ…å«ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ASPECTJ&lt;/code&gt;ï¼šä½¿ç”¨ AspectJ è¡¨è¾¾å¼è¿›è¡Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;REGEX&lt;/code&gt;ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç±»åè¿›è¡Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CUSTOM&lt;/code&gt;ï¼šè‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼Œéœ€è¦å®ç° &lt;code&gt;TypeFilter&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ç®€å•æ€»ç»“"&gt;ğŸ’¡ ç®€å•æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ‰€ä»¥ï¼Œâ€œ&lt;code&gt;@ComponentScan&lt;/code&gt;æ³¨è§£åªæ˜¯å®šä¹‰äº†æ‰«æèŒƒå›´ï¼Œåœ¨æ­¤èŒƒå›´å†…å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„Beanæ‰ä¼šè¢«è½½å…¥å®¹å™¨â€è¿™å¥è¯å¯ä»¥è¿™æ ·ç†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;â€œæ‰«æèŒƒå›´â€&lt;/strong&gt;ï¼šè§£å†³äº†â€œ&lt;strong&gt;å»å“ªå„¿æ‰¾&lt;/strong&gt;â€çš„é—®é¢˜ï¼Œç¡®å®šäº†æœç´¢çš„ç‰©ç†è¾¹ç•Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;â€œç‰¹å®šæ³¨è§£â€&lt;/strong&gt;ï¼šè§£å†³äº†â€œ&lt;strong&gt;æ‰¾ä»€ä¹ˆ&lt;/strong&gt;â€çš„é—®é¢˜ï¼Œå®šä¹‰äº†ç­›é€‰ç›®æ ‡çš„é€»è¾‘è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚åªæœ‰åœ¨æ‰«æèŒƒå›´å†…ä¸”ç¬¦åˆè¿‡æ»¤æ¡ä»¶ï¼ˆé€šå¸¸æ˜¯å¸¦æœ‰ç‰¹å®šæ³¨è§£ï¼‰çš„ç±»ï¼Œæ‰ä¼šè¢« Spring è‡ªåŠ¨å‘ç°å¹¶æ³¨å†Œä¸º Beanã€‚&lt;/p&gt;
&lt;h2 id="transactional-rollbackfor"&gt;@Transactional rollbackfor
&lt;/h2&gt;&lt;p&gt;Spring çš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£å¯¹&lt;strong&gt;è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰å’Œ Error&lt;/strong&gt;é»˜è®¤å›æ»šï¼Œè€Œå¯¹&lt;strong&gt;å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰&lt;/strong&gt; é»˜è®¤ä¸å›æ»šï¼Œè¿™ä¸»è¦æ˜¯åŸºäº Java çš„å¼‚å¸¸è®¾è®¡å“²å­¦å’Œ Spring å¯¹äº‹åŠ¡å¤„ç†çš„å¹³è¡¡è€ƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¼‚å¸¸ç±»å‹&lt;/th&gt;
&lt;th&gt;é»˜è®¤å›æ»šè¡Œä¸º&lt;/th&gt;
&lt;th&gt;è®¾è®¡åˆè¡·ä¸å¸¸è§åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€è¦æ˜¾å¼æ•è·æˆ–å£°æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿è¡Œæ—¶å¼‚å¸¸&lt;/strong&gt; (RuntimeException)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å›æ»š&lt;/strong&gt; âœ…&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä»£è¡¨&lt;strong&gt;ç¼–ç¨‹é”™è¯¯&lt;/strong&gt;æˆ–&lt;strong&gt;ä¸å¯æ¢å¤çš„ç³»ç»Ÿå¼‚å¸¸&lt;/strong&gt;ï¼ˆå¦‚ç©ºæŒ‡é’ˆã€æ•°ç»„è¶Šç•Œã€é™¤é›¶é”™è¯¯ï¼‰ã€‚è¿™äº›å¼‚å¸¸ä¸åº”è¢«æ•è·ï¼Œè€Œåº”é€šè¿‡ä¿®æ”¹ä»£ç æ¥é¿å…ï¼Œå›æ»šäº‹åŠ¡æ˜¯å®‰å…¨çš„ã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;åœ¨ä»£ç ä¸­æ˜¾å¼æ•è·æˆ–å£°æ˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é”™è¯¯&lt;/strong&gt; (Error)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å›æ»š&lt;/strong&gt; âœ…&lt;/td&gt;
&lt;td&gt;è¡¨ç¤º&lt;strong&gt;ä¸¥é‡çš„ç³»ç»Ÿé—®é¢˜&lt;/strong&gt;ï¼ˆå¦‚å†…å­˜æº¢å‡ºã€è™šæ‹Ÿæœºé”™è¯¯ï¼‰ã€‚åº”ç”¨ç¨‹åºé€šå¸¸æ— æ³•å¤„ç†ï¼Œå›æ»šæ˜¯åˆç†çš„ã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;åœ¨ä»£ç ä¸­æ˜¾å¼æ•è·æˆ–å£°æ˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å—æ£€å¼‚å¸¸&lt;/strong&gt; (Checked Exception)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸å›æ»š&lt;/strong&gt; âŒ&lt;/td&gt;
&lt;td&gt;ä»£è¡¨&lt;strong&gt;å¯é¢„è§çš„ä¸šåŠ¡å¼‚å¸¸&lt;/strong&gt;ï¼ˆå¦‚æ–‡ä»¶æœªæ‰¾åˆ°ã€æ•°æ®åº“è¿æ¥å¤±è´¥ã€ç½‘ç»œä¸­æ–­ï¼‰ã€‚è°ƒç”¨æ–¹&lt;strong&gt;æœŸæœ›&lt;/strong&gt;å¹¶èƒ½&lt;strong&gt;å¤„ç†&lt;/strong&gt;è¿™äº›å¼‚å¸¸ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œä¸šåŠ¡é€»è¾‘ä¸Šçš„è¡¥æ•‘è€Œéç®€å•å›æ»šã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¿…é¡»&lt;/strong&gt;åœ¨ä»£ç ä¸­æ˜¾å¼æ•è·æˆ–ç”¨ &lt;code&gt;throws&lt;/code&gt;å£°æ˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•æ§åˆ¶å›æ»šè¡Œä¸º"&gt;âš™ï¸ å¦‚ä½•æ§åˆ¶å›æ»šè¡Œä¸º
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ Spring è®¾ç½®äº†é»˜è®¤è¡Œä¸ºï¼Œä½†ä½ å®Œå…¨å¯ä»¥æŒ‰éœ€å®šåˆ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®©å—æ£€å¼‚å¸¸è§¦å‘å›æ»š&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;rollbackFor&lt;/code&gt;å±æ€§ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional(rollbackFor = Exception.class) // æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»š
@Transactional(rollbackFor = IOException.class) // ç‰¹å®šå—æ£€å¼‚å¸¸å›æ»š
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®©è¿è¡Œæ—¶å¼‚å¸¸ä¸è§¦å‘å›æ»š&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;noRollbackFor&lt;/code&gt;å±æ€§ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional(noRollbackFor = NullPointerException.class) // ç©ºæŒ‡é’ˆå¼‚å¸¸ä¸å›æ»š
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-4"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¿…é¡»è¢«æŠ›å‡º&lt;/strong&gt;ï¼š&lt;code&gt;@Transactional&lt;/code&gt;æ˜¯åœ¨&lt;strong&gt;ä»£ç†æ¨¡å¼&lt;/strong&gt;ä¸‹å·¥ä½œçš„ï¼Œå®ƒé€šè¿‡ AOP æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œåªæœ‰åœ¨æ–¹æ³•&lt;strong&gt;æŠ›å‡ºå¼‚å¸¸&lt;/strong&gt;æ—¶ï¼Œä»£ç†æ‰èƒ½æ•è·åˆ°å¹¶å†³å®šæ˜¯å¦å›æ»šã€‚å¦‚æœä½ åœ¨æ–¹æ³•å†…éƒ¨ç”¨ &lt;code&gt;try-catch&lt;/code&gt;æ•è·äº†å¼‚å¸¸å¹¶â€œåæ‰â€ï¼ˆæ²¡æœ‰é‡æ–°æŠ›å‡ºï¼‰ï¼Œäº‹åŠ¡ç®¡ç†å™¨å°±ä¸çŸ¥é“å‘ç”Ÿäº†å¼‚å¸¸ï¼Œè‡ªç„¶ä¸ä¼šå›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£åº”ç”¨äº &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;ï¼šSpring çš„äº‹åŠ¡ä»£ç†é€šå¸¸åªå¯¹ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-è®¾è®¡åˆè¡·å¹³è¡¡ä¸¥æ ¼æ€§ä¸çµæ´»æ€§"&gt;ğŸ’¡ è®¾è®¡åˆè¡·ï¼šå¹³è¡¡ä¸¥æ ¼æ€§ä¸çµæ´»æ€§
&lt;/h3&gt;&lt;p&gt;Spring å›¢é˜Ÿè¿™æ ·è®¾è®¡é»˜è®¤è¡Œä¸ºï¼Œæ˜¯ä¸ºäº†åœ¨&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§&lt;/strong&gt;å’Œ&lt;strong&gt;ä¸šåŠ¡çµæ´»æ€§&lt;/strong&gt;ä¹‹é—´å–å¾—å¹³è¡¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œæ—¶å¼‚å¸¸å’Œé”™è¯¯&lt;/strong&gt;é€šå¸¸æ„å‘³ç€æ— æ³•é¢„æ–™çš„æ•…éšœï¼Œæ­¤æ—¶å›æ»šäº‹åŠ¡æ˜¯&lt;strong&gt;æœ€å®‰å…¨&lt;/strong&gt;çš„é€‰æ‹©ï¼Œå¯ä»¥é˜²æ­¢è„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å—æ£€å¼‚å¸¸&lt;/strong&gt;åˆ™å¸¸è¢«ç”¨äº&lt;strong&gt;ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ³¨å†Œæ—¶â€œç”¨æˆ·åå·²å­˜åœ¨â€å¯ä»¥æŠ›å‡ºå—æ£€å¼‚å¸¸ &lt;code&gt;UserAlreadyExistsException&lt;/code&gt;ã€‚æ­¤æ—¶ä¸šåŠ¡é€»è¾‘å¯èƒ½å¸Œæœ›æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åæç¤ºç”¨æˆ·æ¢ä¸€ä¸ªç”¨æˆ·åï¼Œ&lt;strong&gt;è€Œä¸æ˜¯ç®€å•åœ°å›æ»šæ•´ä¸ªäº‹åŠ¡&lt;/strong&gt;ï¼ˆå¯èƒ½è¿˜æœ‰å…¶ä»–æœ‰æ•ˆæ“ä½œéœ€è¦æäº¤ï¼‰ã€‚å¦‚æœæ‰€æœ‰å—æ£€å¼‚å¸¸éƒ½é»˜è®¤å›æ»šï¼Œå°±ä¼šå‰¥å¤ºå¼€å‘è€…æ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»å¤„ç†çš„æƒåŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ—‚ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼ŒSpring &lt;code&gt;@Transactional&lt;/code&gt;çš„é»˜è®¤å›æ»šè§„åˆ™æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªç†å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é‡åˆ°â€œåâ€çš„ã€æ„å¤–çš„å¼‚å¸¸ï¼ˆRuntimeException/Errorï¼‰&lt;/strong&gt; â†’ è‡ªåŠ¨å›æ»šï¼Œä¿æŠ¤æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡åˆ°â€œå·²çŸ¥â€çš„ã€å¯å¤„ç†çš„å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰&lt;/strong&gt; â†’ äº¤ç»™ä½ æ¥å†³å®šå¦‚ä½•å¤„ç†ï¼ˆå›æ»šè¿˜æ˜¯ç»§ç»­ï¼‰ï¼Œä¿æŒçµæ´»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ &lt;code&gt;rollbackFor&lt;/code&gt;å’Œ &lt;code&gt;noRollbackFor&lt;/code&gt;å±æ€§è½»æ¾è¦†ç›–è¿™äº›é»˜è®¤è¡Œä¸ºï¼Œä½¿å…¶å®Œç¾é€‚é…ä½ çš„ä¸šåŠ¡åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id="propagation_requires_new"&gt;PROPAGATION_REQUIRES_NEW
&lt;/h2&gt;&lt;p&gt;ç†è§£ Spring ä¸­ &lt;code&gt;PROPAGATION_REQUIRES_NEW&lt;/code&gt;å’Œ &lt;code&gt;PROPAGATION_NESTED&lt;/code&gt;çš„åŒºåˆ«å¯¹å¤„ç†å¤æ‚äº‹åŠ¡åœºæ™¯å¾ˆé‡è¦ã€‚æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼å’Œè¯¦ç»†è§£é‡Šå¸®ä½ æ¢³ç†æ¸…æ¥šã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;PROPAGATION_REQUIRES_NEW&lt;/th&gt;
&lt;th&gt;PROPAGATION_NESTED&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡ç‹¬ç«‹æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®Œå…¨ç‹¬ç«‹çš„æ–°äº‹åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¤–éƒ¨äº‹åŠ¡çš„çœŸæ­£å­äº‹åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸å¤–éƒ¨äº‹åŠ¡å…³ç³»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‹¬ç«‹æäº¤æˆ–å›æ»šï¼Œä¸å—å¤–éƒ¨äº‹åŠ¡å½±å“&lt;/td&gt;
&lt;td&gt;æ˜¯å¤–éƒ¨äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œå¤–éƒ¨äº‹åŠ¡æäº¤å®ƒæ‰æäº¤ï¼Œå¤–éƒ¨äº‹åŠ¡å›æ»šå®ƒå¿…å›æ»š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›æ»šå½±å“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†…éƒ¨äº‹åŠ¡å·²æäº¤ï¼Œåˆ™å¤–éƒ¨äº‹åŠ¡å›æ»š&lt;strong&gt;ä¸å½±å“&lt;/strong&gt;å®ƒ&lt;/td&gt;
&lt;td&gt;å†…éƒ¨äº‹åŠ¡å›æ»š&lt;strong&gt;ä¸å½±å“&lt;/strong&gt;å¤–éƒ¨äº‹åŠ¡ï¼ˆå¤–éƒ¨äº‹åŠ¡å¯å†³å®šç»§ç»­æˆ–å›æ»šåˆ°ä¿å­˜ç‚¹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤–éƒ¨äº‹åŠ¡å›æ»š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨äº‹åŠ¡å›æ»š&lt;strong&gt;ä¸å½±å“&lt;/strong&gt;å·²æäº¤çš„å†…éƒ¨äº‹åŠ¡&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨äº‹åŠ¡å›æ»š&lt;strong&gt;å¯¼è‡´&lt;/strong&gt;å†…éƒ¨äº‹åŠ¡å›æ»š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®ç°æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‹¬ç«‹çš„æ–°äº‹åŠ¡ï¼Œæ‹¥æœ‰è‡ªå·±çš„æ•°æ®åº“è¿æ¥å’Œé”&lt;/td&gt;
&lt;td&gt;åŸºäºæ•°æ®åº“&lt;strong&gt;ä¿å­˜ç‚¹ (Savepoint)&lt;/strong&gt; å®ç°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ–°è¿æ¥å’Œäº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œå¼€é”€ç›¸å¯¹è¾ƒå¤§&lt;/td&gt;
&lt;td&gt;åŸºäºä¿å­˜ç‚¹ï¼Œå¼€é”€é€šå¸¸è¾ƒå°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸è§åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ—¥å¿—è®°å½•ã€å®¡è®¡è·Ÿè¸ªï¼ˆå³ä½¿ä¸»ä¸šåŠ¡å¤±è´¥ï¼Œæ—¥å¿—ä»éœ€ä¿ç•™ï¼‰&lt;/td&gt;
&lt;td&gt;æ‰¹é‡å¤„ç†ã€å¤æ‚ä¸šåŠ¡ï¼ˆå…è®¸éƒ¨åˆ†æ“ä½œå¤±è´¥è€Œä¸å½±å“æ•´ä½“ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŠ€æœ¯æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦äº‹åŠ¡ç®¡ç†å™¨æ”¯æŒï¼ˆé€šå¸¸éƒ½å¯ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€è¦æ•°æ®åº“å’ŒJDBCé©±åŠ¨æ”¯æŒä¿å­˜ç‚¹ï¼ˆJDBC 3.0ä»¥ä¸Šï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“ &lt;strong&gt;ç®€è¦æ€»ç»“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;REQUIRES_NEW&lt;/strong&gt;ï¼šåƒä¸€ä¸ª&lt;strong&gt;ç‹¬ç«‹å…¬å¸&lt;/strong&gt;ï¼Œå®ƒçš„æˆåŠŸæˆ–å¤±è´¥ä¸æ¯å…¬å¸ï¼ˆå¤–éƒ¨äº‹åŠ¡ï¼‰æ— å…³ï¼Œåä¹‹äº¦ç„¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NESTED&lt;/strong&gt;ï¼šåƒæ¯å…¬å¸çš„&lt;strong&gt;ä¸€ä¸ªéƒ¨é—¨&lt;/strong&gt;ã€‚éƒ¨é—¨å®äº†ï¼ˆå›æ»šï¼‰ï¼Œå…¬å¸å¯èƒ½è¿˜èƒ½ç»§ç»­è¿è¥ï¼ˆå¤–éƒ¨äº‹åŠ¡æäº¤ï¼‰ï¼›ä½†æ•´ä¸ªå…¬å¸å®äº†ï¼ˆå¤–éƒ¨äº‹åŠ¡å›æ»šï¼‰ï¼Œéƒ¨é—¨å¿…ç„¶ä¸å¤å­˜åœ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å·¥ä½œæœºåˆ¶ä¸ç»†èŠ‚"&gt;ğŸ” å·¥ä½œæœºåˆ¶ä¸ç»†èŠ‚
&lt;/h3&gt;&lt;h4 id="propagation_requires_new-1"&gt;PROPAGATION_REQUIRES_NEW
&lt;/h4&gt;&lt;p&gt;å½“æ–¹æ³•è®¾ç½®ä¸º &lt;code&gt;PROPAGATION_REQUIRES_NEW&lt;/code&gt;æ—¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡&lt;/strong&gt;ï¼šå¦‚æœå½“å‰å·²å­˜åœ¨äº‹åŠ¡ï¼ˆç§°ä¸ºå¤–éƒ¨äº‹åŠ¡ï¼‰ï¼ŒSpring ä¼š&lt;strong&gt;æŒ‚èµ·&lt;/strong&gt;è¿™ä¸ªäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨æ–°äº‹åŠ¡&lt;/strong&gt;ï¼šéšå³&lt;strong&gt;å¯åŠ¨ä¸€ä¸ªå…¨æ–°çš„ã€å®Œå…¨ç‹¬ç«‹çš„äº‹åŠ¡&lt;/strong&gt;ã€‚è¿™ä¸ªæ–°äº‹åŠ¡æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥ã€éš”ç¦»çº§åˆ«å’Œé”æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œæ–¹æ³•&lt;/strong&gt;ï¼šåœ¨æ–°äº‹åŠ¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æäº¤/å›æ»š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥æ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œ&lt;strong&gt;æ–°äº‹åŠ¡ç‹¬ç«‹æäº¤&lt;/strong&gt;ï¼Œå…¶ç»“æœç«‹å³æŒä¹…åŒ–åˆ°æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼Œæ–°äº‹åŠ¡å›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¢å¤å¤–éƒ¨äº‹åŠ¡&lt;/strong&gt;ï¼šæ— è®ºæ–°äº‹åŠ¡å¦‚ä½•ç»“æŸï¼Œä¹‹å‰è¢«æŒ‚èµ·çš„&lt;strong&gt;å¤–éƒ¨äº‹åŠ¡éƒ½ä¼šæ¢å¤&lt;/strong&gt;æ‰§è¡Œã€‚å¤–éƒ¨äº‹åŠ¡çš„æäº¤æˆ–å›æ»šå¯¹æ–°äº‹åŠ¡å·²æäº¤çš„ç»“æœ&lt;strong&gt;ä¸äº§ç”Ÿä»»ä½•å½±å“&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="propagation_nested"&gt;PROPAGATION_NESTED
&lt;/h4&gt;&lt;p&gt;å½“æ–¹æ³•è®¾ç½®ä¸º &lt;code&gt;PROPAGATION_NESTED&lt;/code&gt;ä¸”å½“å‰å·²å­˜åœ¨äº‹åŠ¡æ—¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºä¿å­˜ç‚¹&lt;/strong&gt;ï¼šSpring å’Œåº•å±‚æ•°æ®åº“åä½œï¼Œåœ¨å¤–éƒ¨äº‹åŠ¡çš„å½“å‰çŠ¶æ€è®¾ç½®ä¸€ä¸ª&lt;strong&gt;ä¿å­˜ç‚¹ (Savepoint)&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œæ–¹æ³•&lt;/strong&gt;ï¼šç›®æ ‡æ–¹æ³•å°±åœ¨è¿™ä¸ªåŸºäºä¿å­˜ç‚¹çš„&lt;strong&gt;åµŒå¥—äº‹åŠ¡&lt;/strong&gt;ä¸­æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éƒ¨åˆ†å›æ»š&lt;/strong&gt;ï¼šå¦‚æœåµŒå¥—äº‹åŠ¡ï¼ˆæ–¹æ³•æ‰§è¡Œï¼‰ä¸­å‘ç”Ÿå›æ»šï¼Œæ•°æ®åº“æ“ä½œ&lt;strong&gt;ä»…å›æ»šåˆ°ä¹‹å‰è®¾ç½®çš„ä¿å­˜ç‚¹&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€åµŒå¥—äº‹åŠ¡å†…çš„æ“ä½œè¢«æ’¤é”€ï¼Œä½†&lt;strong&gt;å¤–éƒ¨äº‹åŠ¡åœ¨ä¿å­˜ç‚¹ä¹‹å‰çš„æ‰€æœ‰æ“ä½œä¾ç„¶æœ‰æ•ˆ&lt;/strong&gt;ï¼Œå¤–éƒ¨äº‹åŠ¡å¯ä»¥é€‰æ‹©ç»§ç»­æ‰§è¡Œæˆ–æ•´ä½“å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•´ä½“æäº¤/å›æ»š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœå¤–éƒ¨äº‹åŠ¡æœ€ç»ˆ&lt;strong&gt;æäº¤&lt;/strong&gt;ï¼ŒåµŒå¥—äº‹åŠ¡ä¸­çš„æ“ä½œä¹Ÿå°†è¢«ä¸€å¹¶æäº¤ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå¤–éƒ¨äº‹åŠ¡æœ€ç»ˆ&lt;strong&gt;å›æ»š&lt;/strong&gt;ï¼Œåˆ™&lt;strong&gt;æ‰€æœ‰æ“ä½œ&lt;/strong&gt;ï¼ŒåŒ…æ‹¬åµŒå¥—äº‹åŠ¡å†…çš„æ“ä½œï¼Œéƒ½å°†å›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-2"&gt;ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PROPAGATION_REQUIRES_NEW é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—è®°å½•/å®¡è®¡è·Ÿè¸ª&lt;/strong&gt;ï¼šæ— è®ºä¸»ä¸šåŠ¡äº‹åŠ¡æˆåŠŸä¸å¦ï¼ˆå³ä½¿å›æ»šï¼‰ï¼Œæ“ä½œæ—¥å¿—éƒ½å¿…é¡»è¢«ç‹¬ç«‹è®°å½•å¹¶æŒä¹…åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥æ¶ˆæ¯å‘é€&lt;/strong&gt;ï¼šä¸»äº‹åŠ¡å¤±è´¥å›æ»šï¼Œä½†æ¶ˆæ¯å¯èƒ½å·²å‘å‡ºï¼Œéœ€ç‹¬ç«‹äº‹åŠ¡ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦æ›´é«˜æˆ–æ›´ä½éš”ç¦»çº§åˆ«çš„æ“ä½œ&lt;/strong&gt;ï¼šç‹¬ç«‹äº‹åŠ¡å¯ä»¥è®¾ç½®è‡ªå·±çš„éš”ç¦»çº§åˆ«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PROPAGATION_NESTED é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ•°æ®å¤„ç†&lt;/strong&gt;ï¼šå¤„ç†100æ¡æ•°æ®ï¼Œå³ä½¿å…¶ä¸­ç¬¬99æ¡å¤±è´¥ï¼Œä¹Ÿå¸Œæœ›å‰98æ¡æˆåŠŸï¼Œæœ€å1æ¡å¯ä»¥ä¸å¤„ç†æˆ–ç¨åé‡è¯•ã€‚NESTED å…è®¸éƒ¨åˆ†å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚ä¸šåŠ¡ä¸­çš„éæ ¸å¿ƒæ­¥éª¤&lt;/strong&gt;ï¼šä¾‹å¦‚ä¸‹å•æµç¨‹ä¸­ï¼Œæ ¸å¿ƒæ˜¯æ‰£åº“å­˜å’Œåˆ›å»ºè®¢å•ï¼Œè€Œå‘é€ä¼˜æƒ åˆ¸æ›´æ–°ç§¯åˆ†å¯ä»¥æ˜¯NESTEDäº‹åŠ¡ã€‚å¦‚æœæ›´æ–°ç§¯åˆ†å¤±è´¥ï¼Œä¸åº”å¯¼è‡´æ•´ä¸ªè®¢å•å¤±è´¥ï¼Œä½†è‹¥è®¢å•æœ€ç»ˆæ”¯ä»˜å¤±è´¥ï¼ˆå¤–éƒ¨äº‹åŠ¡å›æ»šï¼‰ï¼Œç§¯åˆ†æ“ä½œä¹Ÿä¼šè¢«å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;â€œè¯•ä¸€è¯•â€æ“ä½œ&lt;/strong&gt;ï¼šä¸€äº›å¯èƒ½å¤±è´¥ä½†ä¸å½±å“ä¸»æµç¨‹çš„æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹-3"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯æ”¯æŒ&lt;/strong&gt;ï¼š&lt;code&gt;PROPAGATION_NESTED&lt;/code&gt;éœ€è¦&lt;strong&gt;æ•°æ®åº“å’ŒJDBCé©±åŠ¨ç¨‹åºæ”¯æŒä¿å­˜ç‚¹&lt;/strong&gt;ï¼ˆé€šå¸¸éœ€è¦ JDBC 3.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ã€‚å¹¶éæ‰€æœ‰æ•°æ®åº“éƒ½åŒç­‰æ”¯æŒæ‰€æœ‰ä¿å­˜ç‚¹åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼Œå¦‚æœå†…éƒ¨äº‹åŠ¡å·²æäº¤ï¼Œå³ä½¿å¤–éƒ¨äº‹åŠ¡å› å¼‚å¸¸å›æ»šï¼Œå†…éƒ¨äº‹åŠ¡çš„ç»“æœ&lt;strong&gt;ä¹Ÿä¸ä¼šè¢«æ’¤é”€&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;NESTED&lt;/code&gt;ï¼Œå¦‚æœåµŒå¥—äº‹åŠ¡å› å¼‚å¸¸å›æ»šï¼Œé»˜è®¤æƒ…å†µä¸‹&lt;strong&gt;å¼‚å¸¸ä¼šä¼ æ’­åˆ°å¤–éƒ¨äº‹åŠ¡&lt;/strong&gt;ã€‚å¦‚æœä½ ä¸å¸Œæœ›å¤–éƒ¨äº‹åŠ¡å› åµŒå¥—äº‹åŠ¡çš„å¼‚å¸¸è€Œå›æ»šï¼Œå¿…é¡»åœ¨è°ƒç”¨åµŒå¥—äº‹åŠ¡çš„æ–¹æ³•ä¸­ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;try...catch&lt;/code&gt;&lt;/strong&gt; å¤„ç†å¼‚å¸¸ï¼Œå¹¶å†³å®šå¤–éƒ¨äº‹åŠ¡æ˜¯ç»§ç»­è¿˜æ˜¯å›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªè°ƒç”¨é—®é¢˜&lt;/strong&gt;ï¼šåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªæœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼Œ&lt;strong&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¯èƒ½ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸º Spring çš„äº‹åŠ¡ç®¡ç†é€šå¸¸é€šè¿‡ä»£ç†å®ç°ï¼Œè‡ªè°ƒç”¨ä¼šç»•è¿‡ä»£ç†ã€‚å»ºè®®å°†éœ€è¦ä¸åŒäº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„æ–¹æ³•æ”¾åœ¨ä¸åŒçš„ Service ç±»ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-é€‰æ‹©å»ºè®®"&gt;ğŸ’¡ é€‰æ‹©å»ºè®®
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©çš„å…³é”®åœ¨äºä½ å¸Œæœ›çš„&lt;strong&gt;ç‹¬ç«‹æ€§ç¨‹åº¦&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;å®Œå…¨ç‹¬ç«‹&lt;/strong&gt;ï¼Œæˆè´¥ä¸å¦ä¸ä¸»ä¸šåŠ¡äº’ä¸å¹²æ‰°ï¼Ÿ -&amp;gt; &lt;strong&gt;PROPAGATION_REQUIRES_NEW&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¸Œæœ›æ˜¯ä¸»ä¸šåŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†å…è®¸&lt;strong&gt;éƒ¨åˆ†å¤±è´¥&lt;/strong&gt;è€Œä¸å½±å“å…¨å±€ï¼Ÿ -&amp;gt; &lt;strong&gt;PROPAGATION_NESTED&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="ä¸‰çº§ç¼“å­˜"&gt;ä¸‰çº§ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶é€šè¿‡ä¸€å¥—ç²¾å·§çš„&lt;strong&gt;ä¸‰çº§ç¼“å­˜&lt;/strong&gt;æœºåˆ¶ï¼Œç¡®å®èƒ½å¤Ÿé»˜è®¤è§£å†³å•ä¾‹æ¨¡å¼ä¸‹é€šè¿‡å­—æ®µæ³¨å…¥æˆ– Setter æ³¨å…¥å¼•å‘çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ &lt;strong&gt;â€œæå‰æš´éœ²â€&lt;/strong&gt; ä¸€ä¸ªå°šæœªå®Œæˆåˆå§‹åŒ–çš„ Bean å¼•ç”¨ï¼Œä»è€Œæ‰“ç ´ç›¸äº’ç­‰å¾…çš„åƒµå±€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼å¯ä»¥å¸®ä½ å¿«é€Ÿç†è§£ä¸‰çº§ç¼“å­˜å„è‡ªçš„åˆ†å·¥ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç¼“å­˜åç§° (æºç ä¸­çš„ Map)&lt;/th&gt;
&lt;th&gt;å±‚çº§&lt;/th&gt;
&lt;th&gt;å­˜å‚¨å†…å®¹ä¸ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;singletonObjects&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€çº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;å­˜æ”¾å·²ç»å®Œå…¨åˆå§‹åŒ–å¥½çš„ Beanï¼ˆ&lt;strong&gt;æˆå“&lt;/strong&gt;ï¼‰ã€‚æˆ‘ä»¬å¹³æ—¶ä» Spring å®¹å™¨ä¸­è·å–åˆ°çš„å°±æ˜¯è¿™é‡Œçš„å¯¹è±¡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;earlySingletonObjects&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;äºŒçº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;å­˜æ”¾æå‰æš´éœ²å‡ºæ¥çš„ Bean æ—©æœŸå¼•ç”¨ï¼ˆ&lt;strong&gt;åŠæˆå“&lt;/strong&gt;ï¼‰ã€‚å®ƒçš„ä½œç”¨æ˜¯ç¡®ä¿åœ¨æ•´ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå¯¹åŒä¸€ä¸ª Bean çš„æ—©æœŸå¼•ç”¨æ˜¯å”¯ä¸€çš„ï¼Œä¸»è¦ç”¨äºé˜²æ­¢é‡å¤åˆ›å»ºä»£ç†å¯¹è±¡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;singletonFactories&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸‰çº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ç”¨äºç”Ÿæˆ Bean æ—©æœŸå¼•ç”¨çš„ &lt;strong&gt;&lt;code&gt;ObjectFactory&lt;/code&gt;&lt;/strong&gt; å·¥å‚å¯¹è±¡ã€‚è¿™æ˜¯å®ç°â€œæå‰æš´éœ²â€æœ€å…³é”®çš„ä¸€æ­¥ï¼Œå®ƒå°è£…äº†ç”Ÿæˆæ—©æœŸå¼•ç”¨çš„é€»è¾‘ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è§£å†³æµç¨‹è¯¦è§£"&gt;ğŸ”„ è§£å†³æµç¨‹è¯¦è§£
&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬ä»¥ä¸€ä¸ªç»å…¸çš„åœºæ™¯ä¸ºä¾‹ï¼šBean A ä¾èµ– Bean Bï¼Œè€Œ Bean B åˆä¾èµ– Bean Aã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼€å§‹åˆ›å»º Bean A&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹åŒ–&lt;/strong&gt;ï¼šSpring é¦–å…ˆè°ƒç”¨ Bean A çš„æ„é€ å™¨ï¼Œåœ¨å†…å­˜ä¸­åˆ†é…å¯¹è±¡ç©ºé—´ï¼ˆæ­¤æ—¶ A å¯¹è±¡å·²å­˜åœ¨ï¼Œä½†æ‰€æœ‰ä¾èµ–å­—æ®µå¦‚ &lt;code&gt;B b&lt;/code&gt;éƒ½ä¸º &lt;code&gt;null&lt;/code&gt;ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªâ€œåŠæˆå“â€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æš´éœ²å·¥å‚ï¼ˆå…³é”®æ­¥éª¤ï¼‰&lt;/strong&gt;ï¼šå®ä¾‹åŒ–åï¼ŒSpring ä¸ä¼šç«‹å³ä¸º A æ³¨å…¥å±æ€§ï¼Œè€Œæ˜¯å°†ä¸€ä¸ªèƒ½ç”Ÿäº§ A æ—©æœŸå¼•ç”¨çš„ &lt;code&gt;ObjectFactory&lt;/code&gt;å·¥å‚å¯¹è±¡æ”¾å…¥ &lt;strong&gt;ä¸‰çº§ç¼“å­˜&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å…¥å±æ€§&lt;/strong&gt;ï¼šæ¥ä¸‹æ¥ï¼ŒSpring å‡†å¤‡ä¸º A æ³¨å…¥å±æ€§ Bã€‚å®ƒå‘ç°éœ€è¦ä¾èµ– Bean Bã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½¬è€Œåˆ›å»º Bean B&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹åŒ–&lt;/strong&gt;ï¼šä¸ A ç±»ä¼¼ï¼ŒSpring å…ˆå®ä¾‹åŒ– Bean Bï¼ˆå¾—åˆ°ä¸€ä¸ªåŠæˆå“çš„ Bï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æš´éœ²å·¥å‚&lt;/strong&gt;ï¼šåŒæ ·ï¼Œå°† B çš„ &lt;code&gt;ObjectFactory&lt;/code&gt;å·¥å‚æ”¾å…¥&lt;strong&gt;ä¸‰çº§ç¼“å­˜&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å…¥å±æ€§&lt;/strong&gt;ï¼šå½“ Spring å°è¯•ä¸º B æ³¨å…¥å±æ€§ A æ—¶ï¼Œå…³é”®çš„è½¬æŠ˜ç‚¹å‡ºç°äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç ´è§£å¾ªç¯çš„å…³é”®æ—¶åˆ»&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Spring å‘ç° B éœ€è¦ Aï¼Œäºæ˜¯å¼€å§‹æŸ¥æ‰¾ Aã€‚å®ƒé¦–å…ˆæ£€æŸ¥&lt;strong&gt;ä¸€çº§ç¼“å­˜&lt;/strong&gt;ï¼ˆæˆå“æ± ï¼‰ï¼Œæ²¡æœ‰æ‰¾åˆ° Aã€‚&lt;/li&gt;
&lt;li&gt;æ¥ç€æ£€æŸ¥&lt;strong&gt;äºŒçº§ç¼“å­˜&lt;/strong&gt;ï¼ˆåŠæˆå“æ± ï¼‰ï¼Œæ­¤æ—¶ä¹Ÿæ²¡æœ‰ Aã€‚&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆï¼Œå®ƒåœ¨&lt;strong&gt;ä¸‰çº§ç¼“å­˜&lt;/strong&gt;ä¸­æ‰¾åˆ°äº†ä¹‹å‰å­˜æ”¾çš„ A çš„ &lt;code&gt;ObjectFactory&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Spring ç«‹å³è°ƒç”¨è¿™ä¸ªå·¥å‚çš„ &lt;code&gt;getObject()&lt;/code&gt;æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œä¸€ä¸ªå…³é”®æ“ä½œï¼š&lt;strong&gt;&lt;code&gt;getEarlyBeanReference()&lt;/code&gt;&lt;/strong&gt;ã€‚å¦‚æœ Bean A éœ€è¦è¢« AOP ä»£ç†ï¼ˆä¾‹å¦‚è¢« &lt;code&gt;@Transactional&lt;/code&gt;æ ‡è®°ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šåœ¨æ­¤åˆ»è¿”å›ä¸€ä¸ª&lt;strong&gt;ä»£ç†å¯¹è±¡&lt;/strong&gt;ï¼›å¦‚æœä¸éœ€è¦ï¼Œåˆ™è¿”å›åŸå§‹å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;å°†è¿™ä¸ªè·å–åˆ°çš„ A çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½æ˜¯ä»£ç†å¯¹è±¡ï¼‰æ”¾å…¥&lt;strong&gt;äºŒçº§ç¼“å­˜&lt;/strong&gt;ï¼Œå¹¶å°†å…¶ä»&lt;strong&gt;ä¸‰çº§ç¼“å­˜&lt;/strong&gt;ä¸­ç§»é™¤ã€‚ç„¶åï¼Œå°†è¿™ä¸ªæ—©æœŸå¼•ç”¨æ³¨å…¥åˆ° Bean B ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡³æ­¤ï¼Œå¾ªç¯è¢«æ‰“ç ´&lt;/strong&gt;ï¼šBean B æˆåŠŸè·å¾—äº† A çš„å¼•ç”¨ï¼ˆå°½ç®¡ A è¿˜ä¸å®Œæ•´ï¼‰ï¼Œä»è€Œå¯ä»¥ç»§ç»­å®Œæˆ B åç»­çš„åˆå§‹åŒ–æµç¨‹ï¼ˆå¦‚ &lt;code&gt;@PostConstruct&lt;/code&gt;æ–¹æ³•ï¼‰ã€‚B åˆå§‹åŒ–å®Œæˆåï¼Œè¢«æ”¾å…¥&lt;strong&gt;ä¸€çº§ç¼“å­˜&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®Œæˆ Bean A çš„åˆ›å»º&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å½“ Bean B åˆ›å»ºå®Œæ¯•ï¼Œæµç¨‹è¿”å›åˆ°è¿˜åœ¨ç­‰å¾…ä¾èµ–çš„ Bean Aã€‚æ­¤æ—¶ï¼ŒSpring å¯ä»¥é¡ºåˆ©åœ°ä»ä¸€çº§ç¼“å­˜ä¸­è·å–åˆ°å·²ç»å®Œå…¨åˆå§‹åŒ–çš„ Bean Bï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ° Bean A ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;Bean A éšåå®Œæˆè‡ªå·±çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæœ€ç»ˆä¹Ÿæ™‹å‡ä¸ºâ€œæˆå“â€ï¼Œè¢«ç§»åŠ¨åˆ°&lt;strong&gt;ä¸€çº§ç¼“å­˜&lt;/strong&gt;ã€‚åŒæ—¶ï¼ŒSpring ä¼šæ¸…ç†æ‰äºŒçº§ç¼“å­˜ä¸­å…³äº A çš„ä¸´æ—¶æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜"&gt;âš ï¸ ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ
&lt;/h3&gt;&lt;p&gt;ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Œä¸¤çº§ä¸å¤Ÿå—ï¼Ÿè¿™ä¸»è¦æ˜¯ä¸ºäº†&lt;strong&gt;ä¼˜é›…åœ°å¤„ç† AOP ä»£ç†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœåªæœ‰ä¸¤çº§ç¼“å­˜ï¼ˆä¸€çº§å’ŒäºŒçº§ï¼‰&lt;/strong&gt;ï¼šåœ¨å®ä¾‹åŒ– Bean A åï¼Œæˆ‘ä»¬å°±å¿…é¡»ç«‹å³åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸ºå…¶åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªä»£ç†å¯¹è±¡ç›´æ¥æ”¾å…¥äºŒçº§ç¼“å­˜ã€‚ä½†è¿™è¿èƒŒäº† Spring çš„è®¾è®¡åŸåˆ™ï¼šä»£ç†å¯¹è±¡é€šå¸¸åº”è¯¥åœ¨ Bean å®Œå…¨åˆå§‹åŒ–ä¹‹åæ‰ç”Ÿæˆï¼ˆåœ¨ &lt;code&gt;postProcessAfterInitialization&lt;/code&gt;é˜¶æ®µï¼‰ã€‚å¦‚æœæå‰ç”Ÿæˆï¼Œå¯èƒ½ä¼šå½±å“ Bean ç”Ÿå‘½å‘¨æœŸçš„æ­£å¸¸æ‰§è¡Œï¼Œå¸¦æ¥ä¸ç¡®å®šæ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸‰çº§ç¼“å­˜çš„ä¼˜åŠ¿&lt;/strong&gt;ï¼šä¸‰çº§ç¼“å­˜å­˜æ”¾çš„æ˜¯ä¸€ä¸ª&lt;strong&gt;å·¥å‚ï¼ˆ&lt;code&gt;ObjectFactory&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼Œè¿™ä¸ªå·¥å‚æ˜¯â€œæ‡’åŠ è½½â€çš„ã€‚åªæœ‰å½“å‘ç”Ÿå¾ªç¯ä¾èµ–ã€çœŸçš„æœ‰å…¶ä»– Bean éœ€è¦æ³¨å…¥è¿™ä¸ªæ—©æœŸå¼•ç”¨æ—¶ï¼Œå·¥å‚æ‰ä¼šè¢«è°ƒç”¨å¹¶ç”Ÿæˆä»£ç†ï¼ˆæˆ–è¿”å›åŸå§‹å¯¹è±¡ï¼‰ã€‚è¿™æ ·æ—¢è§£å†³äº†å¾ªç¯ä¾èµ–ï¼Œåˆä¿è¯äº† Beanï¼ˆåŒ…æ‹¬å…¶ä»£ç†å¯¹è±¡ï¼‰çš„ç”Ÿå‘½å‘¨æœŸä¸å—ç ´åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-spring-æ— æ³•è§£å†³çš„å¾ªç¯ä¾èµ–åœºæ™¯"&gt;ğŸš« Spring æ— æ³•è§£å†³çš„å¾ªç¯ä¾èµ–åœºæ™¯
&lt;/h3&gt;&lt;p&gt;éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œä¸‰çº§ç¼“å­˜å¹¶éä¸‡èƒ½è¯ï¼Œå®ƒåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä¼šå¤±æ•ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥çš„å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šå› ä¸ºæ„é€ å™¨æ³¨å…¥è¦æ±‚åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„åŒæ—¶å°±å¿…é¡»å®Œæˆæ‰€æœ‰ä¾èµ–çš„æ³¨å…¥ã€‚æ­¤æ—¶å¯¹è±¡éƒ½è¿˜æ²¡åˆ›å»ºå‡ºæ¥ï¼Œæ ¹æœ¬æ— æ³•è¿›è¡Œâ€œæå‰æš´éœ²â€ï¼ŒSpring ä¼šç›´æ¥æŠ›å‡º &lt;code&gt;BeanCurrentlyInCreationException&lt;/code&gt;å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå‹ï¼ˆPrototypeï¼‰Bean çš„å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šSpring ä¸ç¼“å­˜åŸå‹ Bean çš„å®ä¾‹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸‰çº§ç¼“å­˜æœºåˆ¶æ— æ³•ç”¨äºè§£å†³åŸå‹ Bean çš„å¾ªç¯ä¾èµ–ï¼ŒåŒæ ·ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äºè¿™äº›æ— æ³•è§£å†³çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Lazy&lt;/code&gt;æ³¨è§£&lt;/strong&gt; å°†ä¾èµ–æ ‡è®°ä¸ºæ‡’åŠ è½½ï¼Œæˆ–è€…ä»ä»£ç è®¾è®¡å±‚é¢&lt;strong&gt;é‡æ„&lt;/strong&gt;ä»¥æ¶ˆé™¤å¾ªç¯ä¾èµ–ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè¯¦ç»†çš„è§£é‡Šèƒ½å¸®åŠ©ä½ å½»åº•ç†è§£ Spring è§£å†³å¾ªç¯ä¾èµ–çš„å·§å¦™æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id="æ—¶æœº"&gt;æ—¶æœº
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶ä¸­æ„é€ å™¨æ³¨å…¥ã€å­—æ®µæ³¨å…¥å’Œ Setter æ³¨å…¥çš„&lt;strong&gt;æ ¸å¿ƒåŒºåˆ«ä¹‹ä¸€å°±åœ¨äºå®ƒä»¬çš„æ³¨å…¥æ—¶æœº&lt;/strong&gt;ï¼Œè¿™ç›´æ¥å½±å“äº†ä»£ç çš„å¯é æ€§ã€å®‰å…¨æ€§å’Œè®¾è®¡æ¨¡å¼ã€‚ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨å±€ï¼Œæˆ‘å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ¥å¯¹æ¯”å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;æ„é€ å™¨æ³¨å…¥ (Constructor Injection)&lt;/th&gt;
&lt;th&gt;Setter æ³¨å…¥ (Setter Injection)&lt;/th&gt;
&lt;th&gt;å­—æ®µæ³¨å…¥ (Field Injection)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‘ç”Ÿæ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®ä¾‹åŒ–é˜¶æ®µ&lt;/strong&gt;ï¼Œå¯¹è±¡åˆ›å»ºæ—¶&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;åˆå§‹åŒ–é˜¶æ®µ&lt;/strong&gt;ï¼Œå¯¹è±¡åˆ›å»ºå&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;åˆå§‹åŒ–é˜¶æ®µ&lt;/strong&gt;ï¼Œå¯¹è±¡åˆ›å»ºå&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–çŠ¶æ€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯¹è±¡åˆ›å»ºåå³å¤„äº&lt;strong&gt;å®Œå…¨åˆå§‹åŒ–&lt;/strong&gt;çŠ¶æ€&lt;/td&gt;
&lt;td&gt;å¯¹è±¡å¯èƒ½å¤„äº&lt;strong&gt;éƒ¨åˆ†åˆå§‹åŒ–&lt;/strong&gt;çŠ¶æ€&lt;/td&gt;
&lt;td&gt;å¯¹è±¡å¯èƒ½å¤„äº&lt;strong&gt;éƒ¨åˆ†åˆå§‹åŒ–&lt;/strong&gt;çŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸å¯å˜æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–å¯å£°æ˜ä¸º &lt;code&gt;final&lt;/code&gt;ï¼Œ&lt;strong&gt;æ”¯æŒä¸å¯å˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–å¯å˜ï¼Œ&lt;strong&gt;ä¸æ”¯æŒä¸å¯å˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–å¯å˜ï¼Œ&lt;strong&gt;ä¸æ”¯æŒä¸å¯å˜&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼ºåˆ¶æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼ºåˆ¶&lt;/strong&gt;ä¾èµ–ï¼Œå¿…é¡»æä¾›&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯é€‰&lt;/strong&gt;ä¾èµ–ï¼Œå¯ä¸æä¾›&lt;/td&gt;
&lt;td&gt;é»˜è®¤å¼ºåˆ¶ï¼Œå¯è®¾ä¸ºå¯é€‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¾ªç¯ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ— æ³•&lt;/strong&gt;è§£å†³æ„é€ å™¨å¾ªç¯ä¾èµ–&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ä»¥&lt;/strong&gt;è§£å†³ï¼ˆå€ŸåŠ©ä¸‰çº§ç¼“å­˜ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ä»¥&lt;/strong&gt;è§£å†³ï¼ˆå€ŸåŠ©ä¸‰çº§ç¼“å­˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨èåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â­â­â­â­â­ (&lt;strong&gt;Spring å®˜æ–¹æ¨è&lt;/strong&gt;)&lt;/td&gt;
&lt;td&gt;â­â­â­â­ (é€‚ç”¨äºå¯é€‰ä¾èµ–)&lt;/td&gt;
&lt;td&gt;â­â­ (ä¸æ¨èç”¨äºä¸šåŠ¡ä»£ç )&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å„æ³¨å…¥æ–¹å¼è¯¦è§£ä¸å½±å“"&gt;ğŸ’¡ å„æ³¨å…¥æ–¹å¼è¯¦è§£ä¸å½±å“
&lt;/h3&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ·±å…¥çœ‹çœ‹æ¯ç§æ³¨å…¥æ–¹å¼çš„å…·ä½“æ—¶æœºå’Œå…¶å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;h4 id="1-æ„é€ å™¨æ³¨å…¥"&gt;1. æ„é€ å™¨æ³¨å…¥
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¶æœº&lt;/strong&gt;ï¼šåœ¨ Bean çš„&lt;strong&gt;å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰&lt;/strong&gt; è¿‡ç¨‹ä¸­ï¼ŒSpring å®¹å™¨é€šè¿‡åå°„è°ƒç”¨ç±»çš„æ„é€ å™¨æ¥åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œæ­¤æ—¶ä¾èµ–é¡¹ä½œä¸ºå‚æ•°ç›´æ¥ä¼ å…¥ã€‚è¿™æ˜¯ç”Ÿå‘½å‘¨æœŸä¸­&lt;strong&gt;æœ€æ—©&lt;/strong&gt;çš„æ³¨å…¥ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒå½±å“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡&lt;/strong&gt;ï¼šå¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºå‡ºæ¥ï¼Œå…¶æ‰€æœ‰å¿…éœ€çš„ä¾èµ–å°±å·²ç»å°±ä½ï¼Œå¯ä»¥ç«‹å³å®‰å…¨ä½¿ç”¨ï¼Œé¿å…äº†ç©ºæŒ‡é’ˆå¼‚å¸¸çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰&lt;/strong&gt;ï¼šä¾èµ–é¡¹å¯ä»¥è¢«å£°æ˜ä¸º &lt;code&gt;final&lt;/code&gt;ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå†…ä¸å¯æ”¹å˜ã€‚è¿™å¤§å¤§æå‡äº†&lt;strong&gt;çº¿ç¨‹å®‰å…¨æ€§&lt;/strong&gt;ï¼Œå› ä¸ºå¯¹è±¡çš„çŠ¶æ€æ˜¯å›ºå®šçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜¾å¼å¥‘çº¦&lt;/strong&gt;ï¼šæ„é€ å™¨æ¸…æ™°åœ°å®šä¹‰äº†åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆå¯¹è±¡æ‰€å¿…éœ€çš„å…¨éƒ¨ä¾èµ–ï¼Œæ˜¯ä¸€ç§&lt;strong&gt;è‡ªæˆ‘æ–‡æ¡£åŒ–&lt;/strong&gt;çš„ä»£ç è®¾è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-setter-æ³¨å…¥"&gt;2. Setter æ³¨å…¥
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¶æœº&lt;/strong&gt;ï¼šåœ¨ Bean å®ä¾‹åŒ–&lt;strong&gt;ä¹‹å&lt;/strong&gt;ï¼Œ&lt;strong&gt;åˆå§‹åŒ–ï¼ˆInitializationï¼‰&lt;/strong&gt; é˜¶æ®µä¹‹å‰ï¼ŒSpring å®¹å™¨é€šè¿‡è°ƒç”¨å¯¹åº”çš„ setter æ–¹æ³•æ¥å®Œæˆä¾èµ–æ³¨å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒå½±å“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šå…è®¸åœ¨å¯¹è±¡åˆ›å»ºåé‡æ–°é…ç½®æˆ–æ›¿æ¢ä¾èµ–ï¼Œé€‚ç”¨äºé‚£äº›ç¡®å®æ˜¯å¯é€‰çš„ä¾èµ–é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éƒ¨åˆ†åˆå§‹åŒ–é£é™©&lt;/strong&gt;ï¼šå¯¹è±¡åœ¨æ„é€ åã€setter è°ƒç”¨å‰ï¼Œå…¶ä¾èµ–é¡¹æ˜¯ &lt;code&gt;null&lt;/code&gt;æˆ–æœªå®šä¹‰çŠ¶æ€ã€‚å¦‚æœå…¶ä»–æ–¹æ³•è¯¯åœ¨ setter è°ƒç”¨å‰ä½¿ç”¨äº†è¿™äº›ä¾èµ–ï¼Œä¼šå¯¼è‡´é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å­—æ®µæ³¨å…¥"&gt;3. å­—æ®µæ³¨å…¥
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¶æœº&lt;/strong&gt;ï¼šä¸ Setter æ³¨å…¥ç±»ä¼¼ï¼Œå‘ç”Ÿåœ¨ Bean å®ä¾‹åŒ–ä¹‹åã€åˆå§‹åŒ–ä¹‹å‰ã€‚Spring å®¹å™¨é€šè¿‡&lt;strong&gt;åå°„ï¼ˆReflectionï¼‰&lt;/strong&gt; æœºåˆ¶ç›´æ¥ä¸ºæ ‡æ³¨äº† &lt;code&gt;@Autowired&lt;/code&gt;çš„å­—æ®µèµ‹å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒå½±å“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;ï¼šè¡¨é¢ä¸Šä»£ç éå¸¸ç®€æ´ï¼Œä¸éœ€è¦æ„é€ å™¨æˆ– setter æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸¥é‡ç¼ºç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éšè—ä¾èµ–&lt;/strong&gt;ï¼šä¾èµ–å…³ç³»æ²¡æœ‰é€šè¿‡å…¬å…±æ¥å£ï¼ˆæ„é€ å™¨æˆ–æ–¹æ³•ï¼‰æš´éœ²ï¼Œè¿åäº†&lt;strong&gt;ä¾èµ–æ˜ç¡®&lt;/strong&gt;çš„åŸåˆ™ï¼Œä½¿ä»£ç æ›´éš¾ç†è§£å’Œæµ‹è¯•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç ´åå°è£…&lt;/strong&gt;ï¼šé€šè¿‡åå°„ç›´æ¥æ“ä½œç§æœ‰å­—æ®µï¼Œç ´åäº†å¯¹è±¡çš„å°è£…æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ Spring å¼ºè€¦åˆ&lt;/strong&gt;ï¼šå› ä¸ºæ³¨å…¥é€»è¾‘å®Œå…¨ä¾èµ–äº Spring çš„æ³¨è§£ï¼Œä½¿å¾—è¿™ä¸ªç±»éš¾ä»¥è„±ç¦» Spring å®¹å™¨è¿›è¡Œç‹¬ç«‹çš„å•å…ƒæµ‹è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“ä¸æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ’ æ€»ç»“ä¸æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;p&gt;ç†è§£æ³¨å…¥æ—¶æœºçš„åŒºåˆ«ï¼Œå…³é”®åœ¨äºè®¤è¯†åˆ°å®ƒå¦‚ä½•å½±å“å¯¹è±¡çš„&lt;strong&gt;çŠ¶æ€å®Œæ•´æ€§å’Œä»£ç çš„å¥å£®æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt; ç¡®ä¿äº†å¯¹è±¡çš„&lt;strong&gt;ä¸å˜æ€§å’Œå³æ—¶å¯ç”¨æ€§&lt;/strong&gt;ï¼Œæ˜¯ç°ä»£ Spring åº”ç”¨ä¸­çš„&lt;strong&gt;é¦–é€‰æ–¹å¼&lt;/strong&gt;ï¼Œå°¤å…¶é€‚ç”¨äºæ‰€æœ‰å¿…éœ€çš„ã€ä¸å¯å˜çš„ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Setter æ³¨å…¥&lt;/strong&gt; é€‚ç”¨äºçœŸæ­£çš„&lt;strong&gt;å¯é€‰ä¾èµ–&lt;/strong&gt;ï¼Œæˆ–è€…é‚£äº›åœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå†…å¯èƒ½éœ€è¦æ”¹å˜çš„ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µæ³¨å…¥&lt;/strong&gt; å°½ç®¡ä¹¦å†™ç®€ä¾¿ï¼Œä½†ç”±äºå…¶å›ºæœ‰çš„ç¼ºç‚¹ï¼Œåœ¨æ­£å¼çš„ä¸šåŠ¡ä»£ç ä¸­åº”&lt;strong&gt;é¿å…ä½¿ç”¨&lt;/strong&gt;ï¼Œå®ƒå¯èƒ½æ›´é€‚åˆä¸€äº›éå¸¸ç®€å•çš„é…ç½®ç±»æˆ–é—ç•™ä»£ç ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´æ¸…æ™°åœ°ç†è§£ä¸åŒæ³¨å…¥æ–¹å¼çš„æ—¶æœºå’Œå½±å“ï¼å¦‚æœä½ å¯¹ç‰¹å®šåœºæ™¯ä¸‹çš„é€‰æ‹©è¿˜æœ‰ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="conditionalonmissingbean--datasource"&gt;@ConditionalOnMissingBean &amp;amp; DataSource
&lt;/h2&gt;&lt;p&gt;ã€‚DataSource çš„è‡ªåŠ¨é…ç½®ç¡®å®æ˜¯åŸºäº &lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;æœºåˆ¶çš„ï¼Œè¿™æ˜¯ Spring Boot â€œ&lt;strong&gt;çº¦å®šä¼˜äºé…ç½®&lt;/strong&gt;â€å’Œâ€œ&lt;strong&gt;ç”¨æˆ·è‡ªå®šä¹‰ä¼˜å…ˆ&lt;/strong&gt;â€ç†å¿µçš„å®Œç¾ä½“ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼š&lt;strong&gt;æ˜¯çš„ï¼ŒSpring Boot é»˜è®¤æä¾›çš„ DataSource Bean æ˜¯ä½¿ç”¨ &lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;æ¡ä»¶æ³¨è§£çš„&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€åªæœ‰åœ¨æ‚¨æ²¡æœ‰è‡ªå·±æ˜¾å¼é…ç½® DataSource Bean çš„æƒ…å†µä¸‹ï¼ŒSpring Boot çš„è‡ªåŠ¨é…ç½®æ‰ä¼šç”Ÿæ•ˆï¼Œä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„æ•°æ®æºã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£ä¸åŒåœºæ™¯ä¸‹çš„è¡Œä¸ºï¼Œè¯·çœ‹ä¸‹è¡¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¡ä»¶åœºæ™¯&lt;/th&gt;
&lt;th&gt;DataSource åˆ›å»ºç»“æœ&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®¹å™¨ä¸­ä¸å­˜åœ¨ä»»ä½• DataSource ç±»å‹çš„ Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;strong&gt;åˆ›å»º&lt;/strong&gt; é»˜è®¤ DataSource&lt;/td&gt;
&lt;td&gt;Spring Boot è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆï¼Œæ ¹æ® &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;ä¸­çš„è¿æ¥é…ç½®åˆ›å»ºæ•°æ®æºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”¨æˆ·å·²è‡ªå®šä¹‰å¹¶æ³¨å†Œäº† DataSource Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;ä¸åˆ›å»º&lt;/strong&gt; é»˜è®¤ DataSource&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;æ£€æµ‹åˆ°å·²æœ‰åŒåBeanï¼Œè‡ªåŠ¨é…ç½®&lt;strong&gt;ä¸ç”Ÿæ•ˆ&lt;/strong&gt;ï¼Œä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„Beanã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸å…¶ä»–æ¡ä»¶æ³¨è§£ç»„åˆä½¿ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€&lt;strong&gt;åŒæ—¶æ»¡è¶³&lt;/strong&gt;æ‰€æœ‰æ¡ä»¶&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨é…ç½®ç±»é€šå¸¸è¿˜ç»„åˆäº† &lt;code&gt;@ConditionalOnClass&lt;/code&gt;ç­‰æ³¨è§£ï¼Œç¡®ä¿åªåœ¨å¼•å…¥æ•°æ®åº“ä¾èµ–ç­‰æ­£ç¡®ç¯å¢ƒä¸‹è¿è¡Œã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æºç ä¸æœºåˆ¶æµ…æ"&gt;ğŸ” æºç ä¸æœºåˆ¶æµ…æ
&lt;/h3&gt;&lt;p&gt;åœ¨ Spring Boot çš„è‡ªåŠ¨é…ç½®ç±» &lt;code&gt;DataSourceAutoConfiguration&lt;/code&gt;ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ç±»ä¼¼çš„ä»£ç é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration(proxyBeanMethods = false)
@ConditionalOnClass({ DataSource.class, EmbeddedDatabaseType.class })
@ConditionalOnMissingBean(type = &amp;#34;dataSource&amp;#34;) // å…³é”®æ¡ä»¶æ³¨è§£
@EnableConfigurationProperties(DataSourceProperties.class)
public class DataSourceAutoConfiguration {
@Bean
@ConditionalOnMissingBean // è¿™é‡Œå†æ¬¡å£°æ˜ï¼Œé’ˆå¯¹æ–¹æ³•çº§åˆ«çš„Beanæ³¨å†Œ
public DataSource dataSource(DataSourceProperties properties) {
return properties.initializeDataSourceBuilder().build();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ®µä»£ç æ­ç¤ºäº†å…¶å·¥ä½œæ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnClass({ DataSource.class, ... })&lt;/code&gt;ï¼šç¡®ä¿ç±»è·¯å¾„ä¸‹å­˜åœ¨æ•°æ®åº“ç›¸å…³çš„ç±»ï¼ˆå³æ‚¨å·²ç»å¼•å…¥äº†åƒ &lt;code&gt;spring-boot-starter-jdbc&lt;/code&gt;æˆ–æ•°æ®åº“é©±åŠ¨è¿™æ ·çš„ä¾èµ–ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnMissingBean(type = &amp;quot;dataSource&amp;quot;)&lt;/code&gt;&lt;/strong&gt; å’Œ &lt;strong&gt;&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¸Šçš„ &lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯æ ¸å¿ƒã€‚å®ƒä»¬æ£€æŸ¥æ•´ä¸ª Spring å®¹å™¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨åä¸º &lt;code&gt;dataSource&lt;/code&gt;æˆ–ç±»å‹ä¸º &lt;code&gt;DataSource&lt;/code&gt;çš„ Beanã€‚åªæœ‰åœ¨&lt;strong&gt;æ‰¾ä¸åˆ°&lt;/strong&gt;çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œè¿™ä¸ªé…ç½®ç±»ä¸­çš„ &lt;code&gt;dataSource()&lt;/code&gt;æ–¹æ³•æ¥åˆ›å»ºé»˜è®¤çš„ DataSource Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@EnableConfigurationProperties(DataSourceProperties.class)&lt;/code&gt;ï¼šå°†é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.yml&lt;/code&gt;ï¼‰ä¸­ä»¥ &lt;code&gt;spring.datasource&lt;/code&gt;ä¸ºå‰ç¼€çš„å±æ€§ç»‘å®šåˆ° &lt;code&gt;DataSourceProperties&lt;/code&gt;å¯¹è±¡ä¸Šï¼Œç”¨äºé…ç½®æ•°æ®æºè¿æ¥ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ ¸å¿ƒä»·å€¼ä¸å¯ç¤º"&gt;ğŸ’¡ æ ¸å¿ƒä»·å€¼ä¸å¯ç¤º
&lt;/h3&gt;&lt;p&gt;ç†è§£è¿™ä¸ªæœºåˆ¶éå¸¸é‡è¦ï¼Œå®ƒå¸¦æ¥äº†ä¸¤å¤§å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å†²çª&lt;/strong&gt;ï¼šé˜²æ­¢ Spring Boot çš„è‡ªåŠ¨é…ç½®æ„å¤–è¦†ç›–æ‚¨æ‰‹åŠ¨å®šä¹‰çš„ã€æ›´ç¬¦åˆç‰¹å®šéœ€æ±‚çš„ DataSource Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æä¾›é»˜è®¤å€¼&lt;/strong&gt;ï¼šåœ¨æ‚¨æ²¡æœ‰è¿›è¡Œä»»ä½•é¢å¤–é…ç½®æ—¶ï¼Œæä¾›ä¸€ä¸ªå¼€ç®±å³ç”¨çš„åŸºæœ¬æ•°æ®æºï¼Œæå¤§ç®€åŒ–äº†é¡¹ç›®çš„åˆå§‹é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å®è·µå»ºè®®"&gt;ğŸ› ï¸ å®è·µå»ºè®®
&lt;/h3&gt;&lt;p&gt;äº†è§£æ­¤æœºåˆ¶åï¼Œæ‚¨å¯ä»¥æ›´å¥½åœ°ç®¡ç†æ•°æ®æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦è‡ªå®šä¹‰æ•°æ®æºï¼ˆå¦‚ä½¿ç”¨ DBCP2ã€HikariCP é…ç½®ç‹¬ç«‹æ•°æ®æºï¼‰&lt;/strong&gt;ï¼šåªéœ€åœ¨æ‚¨çš„é…ç½®ç±»ä¸­ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å®šä¹‰è¿”å›ç›¸åº”çš„ &lt;code&gt;DataSource&lt;/code&gt;å®ä¾‹å³å¯ï¼ŒSpring Boot ä¼šè‡ªåŠ¨â€œè®©è·¯â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ•°æ®æºé…ç½®&lt;/strong&gt;ï¼šåœ¨é…ç½®å¤šæ•°æ®æºæ—¶ï¼Œæ‚¨éœ€è¦å®Œå…¨æ¥ç®¡ DataSource çš„åˆ›å»ºï¼Œæ¯ä¸ªæ•°æ®æºéƒ½åº”æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ &lt;code&gt;@Bean&lt;/code&gt;ã€‚è‡ªåŠ¨é…ç½®ä¼šå› æ£€æµ‹åˆ°å·²æœ‰ DataSource Bean è€Œå¤±æ•ˆï¼Œä¹‹åæ‚¨éœ€è¦é€šè¿‡ &lt;code&gt;@Primary&lt;/code&gt;ç­‰æ³¨è§£æ¥æŒ‡å®šä¸»æ•°æ®æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›ä»¥ä¸Šè§£é‡Šèƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£ Spring Boot çš„è®¾è®¡å“²å­¦ã€‚&lt;/p&gt;
&lt;h2 id="bean-æ¡ä»¶æ³¨è§£"&gt;@Bean æ¡ä»¶æ³¨è§£
&lt;/h2&gt;&lt;p&gt;Spring Boot æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„æ¡ä»¶æ³¨è§£ï¼Œå¯ä»¥æ ‡æ³¨åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¸Šï¼Œå®ç° Bean çš„æŒ‰æ¡ä»¶åŠ è½½ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿæ¦‚è§ˆï¼Œä¸‹è¡¨æ±‡æ€»äº†è¿™äº›æ ¸å¿ƒæ³¨è§£åŠå…¶ä¸»è¦ç”¨é€”ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒä½œç”¨&lt;/th&gt;
&lt;th&gt;å…³é”®å±æ€§è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnBean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“å®¹å™¨ä¸­å­˜åœ¨&lt;/strong&gt;æŒ‡å®šçš„ Bean æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;name&lt;/code&gt;: æŒ‡å®šéœ€è¦å­˜åœ¨çš„ Bean çš„ç±»å‹æˆ–åç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“å®¹å™¨ä¸­ä¸å­˜åœ¨&lt;/strong&gt;æŒ‡å®šçš„ Bean æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;name&lt;/code&gt;: æŒ‡å®šéœ€è¦ä¸å­˜åœ¨çš„ Bean çš„ç±»å‹æˆ–åç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“ç±»è·¯å¾„ä¸‹å­˜åœ¨&lt;/strong&gt;æŒ‡å®šçš„ç±»æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;name&lt;/code&gt;: æŒ‡å®šéœ€è¦å­˜åœ¨çš„ç±»çš„ Class å¯¹è±¡æˆ–å…¨é™å®šåã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnMissingClass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“ç±»è·¯å¾„ä¸‹ä¸å­˜åœ¨&lt;/strong&gt;æŒ‡å®šçš„ç±»æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;: æŒ‡å®šéœ€è¦ä¸å­˜åœ¨çš„ç±»çš„å…¨é™å®šåã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnProperty&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“é…ç½®å±æ€§&lt;/strong&gt;æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;prefix&lt;/code&gt;, &lt;code&gt;name&lt;/code&gt;: æŒ‡å®šå±æ€§ã€‚&lt;code&gt;havingValue&lt;/code&gt;: åŒ¹é…å€¼ã€‚&lt;code&gt;matchIfMissing&lt;/code&gt;: å±æ€§ç¼ºå¤±æ—¶æ˜¯å¦åŒ¹é…ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnResource&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“ç±»è·¯å¾„ä¸‹å­˜åœ¨&lt;/strong&gt;æŒ‡å®šçš„èµ„æºæ–‡ä»¶æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;resources&lt;/code&gt;: æŒ‡å®šéœ€è¦å­˜åœ¨çš„èµ„æºè·¯å¾„ï¼Œä¾‹å¦‚ &lt;code&gt;&amp;quot;classpath:config.properties&amp;quot;&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnExpression&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å½“ SpEL è¡¨è¾¾å¼&lt;/strong&gt;çš„è®¡ç®—ç»“æœä¸º &lt;code&gt;true&lt;/code&gt;æ—¶ï¼Œæ‰åˆ›å»ºå½“å‰ Beanã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;: é…ç½® SpEL è¡¨è¾¾å¼å­—ç¬¦ä¸²ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Conditional&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é€šç”¨æ¡ä»¶æ³¨è§£&lt;/strong&gt;ï¼Œéœ€é…åˆè‡ªå®šä¹‰çš„ &lt;code&gt;Condition&lt;/code&gt;æ¥å£å®ç°ç±»ä½¿ç”¨ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;: æŒ‡å®šå®ç°äº† &lt;code&gt;Condition&lt;/code&gt;æ¥å£çš„ç±»ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒæ³¨è§£è¯¦è§£ä¸ä»£ç ç¤ºä¾‹"&gt;ğŸ’¡ æ ¸å¿ƒæ³¨è§£è¯¦è§£ä¸ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç ç‰‡æ®µæ¥å…·ä½“äº†è§£è¿™äº›æ³¨è§£çš„ç”¨æ³•ã€‚&lt;/p&gt;
&lt;h4 id="1-bean-æ¡ä»¶æ³¨è§£"&gt;1. Bean æ¡ä»¶æ³¨è§£
&lt;/h4&gt;&lt;p&gt;è¿™ç±»æ³¨è§£æ ¹æ®å®¹å™¨ä¸­å…¶ä»– Bean çš„å­˜åœ¨ä¸å¦æ¥å†³å®šæ˜¯å¦å®ä¾‹åŒ–å½“å‰ Beanã€‚å®ƒä»¬æ˜¯å®ç° &lt;strong&gt;â€œç”¨æˆ·é…ç½®ä¼˜å…ˆâ€&lt;/strong&gt; åŸåˆ™çš„å…³é”®ï¼Œå¸¸ç”¨äºæä¾›é»˜è®¤é…ç½®æˆ–è¦†ç›–è‡ªåŠ¨é…ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class MyAutoConfiguration {
// åªæœ‰å½“å®¹å™¨ä¸­æ²¡æœ‰ SomeService ç±»å‹çš„ Bean æ—¶ï¼Œæ‰ä¼šåˆ›å»ºè¿™ä¸ªé»˜è®¤çš„
@Bean
@ConditionalOnMissingBean(SomeService.class)
public SomeService someService() {
return new DefaultSomeService();
}
// åªæœ‰å½“å®¹å™¨ä¸­å­˜åœ¨åä¸º &amp;#34;dataSource&amp;#34; çš„ Bean æ—¶ï¼Œæ‰ä¼šåˆ›å»º JdbcTemplate
@Bean
@ConditionalOnBean(name = &amp;#34;dataSource&amp;#34;)
public JdbcTemplate jdbcTemplate(DataSource dataSource) {
return new JdbcTemplate(dataSource);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;âš ï¸ æ³¨æ„&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;@ConditionalOnBean&lt;/code&gt;å’Œ &lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;æ—¶éœ€ç•™æ„ Bean çš„åŠ è½½é¡ºåºï¼Œå› ä¸ºå®ƒä»¬æ˜¯æ ¹æ®ç›®å‰å·²å¤„ç†è¿‡çš„ Bean å®šä¹‰æ¥è¯„ä¼°çš„ã€‚&lt;/p&gt;
&lt;h4 id="2-ç±»æ¡ä»¶æ³¨è§£"&gt;2. ç±»æ¡ä»¶æ³¨è§£
&lt;/h4&gt;&lt;p&gt;è¿™ç±»æ³¨è§£é€šè¿‡æ£€æŸ¥ç±»è·¯å¾„ä¸‹ç‰¹å®šç±»çš„å­˜åœ¨ä¸å¦æ¥æ§åˆ¶ Bean çš„åŠ è½½ï¼Œæ˜¯ Spring Boot è‡ªåŠ¨é…ç½®çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class MyAutoConfiguration {
// åªæœ‰å½“ç±»è·¯å¾„ä¸‹å­˜åœ¨ com.fasterxml.jackson.databind.ObjectMapper ç±»æ—¶ï¼Œæ‰é…ç½®è¯¥ Bean
@Bean
@ConditionalOnClass(name = &amp;#34;com.fasterxml.jackson.databind.ObjectMapper&amp;#34;)
public MyJsonService myJsonService() {
return new MyJsonService();
}
// åªæœ‰å½“ç±»è·¯å¾„ä¸‹ä¸å­˜åœ¨ org.springframework.transaction.PlatformTransactionManager æ—¶ï¼Œæ‰é…ç½®è¿™ä¸ªç®€å•çš„å®ç°
@Bean
@ConditionalOnMissingClass(&amp;#34;org.springframework.transaction.PlatformTransactionManager&amp;#34;)
public TransactionManager simpleTransactionManager() {
return new SimpleTransactionManager();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-å±æ€§ä¸èµ„æºæ¡ä»¶æ³¨è§£"&gt;3. å±æ€§ä¸èµ„æºæ¡ä»¶æ³¨è§£
&lt;/h4&gt;&lt;p&gt;è¿™ç±»æ³¨è§£è®© Bean çš„åŠ è½½ä¾èµ–äºå¤–éƒ¨é…ç½®æˆ–èµ„æºï¼Œæä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class MyAutoConfiguration {
// å½“é…ç½®æ–‡ä»¶ä¸­ feature.x.enabled çš„å€¼ä¸º true æ—¶ï¼ˆæˆ–è¯¥é…ç½®ç¼ºå¤±æ—¶ï¼‰ï¼Œæ‰å¯ç”¨è¯¥ç‰¹æ€§
@Bean
@ConditionalOnProperty(prefix = &amp;#34;feature.x&amp;#34;, name = &amp;#34;enabled&amp;#34;, havingValue = &amp;#34;true&amp;#34;, matchIfMissing = true)
public FeatureXService featureXService() {
return new FeatureXService();
}
// åªæœ‰å½“ç±»è·¯å¾„ä¸‹å­˜åœ¨ config/special.properties æ–‡ä»¶æ—¶ï¼Œæ‰åˆ›å»ºè¯¥ Bean
@Bean
@ConditionalOnResource(resources = &amp;#34;classpath:config/special.properties&amp;#34;)
public SpecialService specialService() {
return new SpecialService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="4-è¡¨è¾¾å¼ä¸è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£"&gt;4. è¡¨è¾¾å¼ä¸è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£
&lt;/h4&gt;&lt;p&gt;å½“å†…ç½®æ³¨è§£æ— æ³•æ»¡è¶³å¤æ‚æ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ SpEL è¡¨è¾¾å¼æˆ–è‡ªå®šä¹‰æ¡ä»¶ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class MyAutoConfiguration {
// ä½¿ç”¨ SpEL è¡¨è¾¾å¼è¿›è¡Œå¤æ‚æ¡ä»¶åˆ¤æ–­
@Bean
@ConditionalOnExpression(&amp;#34;#{environment.getProperty(&amp;#39;app.mode&amp;#39;) == &amp;#39;cluster&amp;#39; &amp;amp;&amp;amp; environment.getProperty(&amp;#39;app.role&amp;#39;) == &amp;#39;master&amp;#39;}&amp;#34;)
public ClusterMasterService clusterMasterService() {
return new ClusterMasterService();
}
// ä½¿ç”¨è‡ªå®šä¹‰æ¡ä»¶ï¼ˆä¾‹å¦‚ï¼Œåˆ¤æ–­æ“ä½œç³»ç»Ÿï¼‰
@Bean
@Conditional(OnWindowsCondition.class) // OnWindowsCondition éœ€å®ç° Condition æ¥å£
public WindowsSpecificService windowsService() {
return new WindowsSpecificService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-è¿›é˜¶ä½¿ç”¨ä¸æœ€ä½³å®è·µ"&gt;ğŸ› ï¸ è¿›é˜¶ä½¿ç”¨ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç»„åˆæ¡ä»¶&lt;/strong&gt;ï¼šSpring Boot è¿˜æä¾›äº†ä¸€äº›ç‰¹æ®Šçš„â€œå…ƒæ¡ä»¶â€æ³¨è§£ï¼Œå¦‚ &lt;code&gt;@AnyNestedCondition&lt;/code&gt;ï¼ˆä»»ä¸€åµŒå¥—æ¡ä»¶æ»¡è¶³å³åŒ¹é…ï¼‰æˆ– &lt;code&gt;@AllNestedConditions&lt;/code&gt;ï¼ˆæ‰€æœ‰åµŒå¥—æ¡ä»¶éƒ½éœ€æ»¡è¶³ï¼‰ï¼Œç”¨äºç»„åˆå¤šä¸ªç®€å•æ¡ä»¶å½¢æˆå¤æ‚é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨åŸŸ&lt;/strong&gt;ï¼šè™½ç„¶è¿™äº›æ³¨è§£ä¸»è¦ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä½†å…¶ä¸­è®¸å¤šï¼ˆå¦‚ &lt;code&gt;@ConditionalOnClass&lt;/code&gt;ï¼‰ä¹Ÿå¯ä»¥æ ‡æ³¨åœ¨ç±»ä¸Šã€‚å½“æ ‡æ³¨åœ¨ç±»ä¸Šæ—¶ï¼Œå°†å¯¹ç±»ä¸­æ‰€æœ‰ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®&lt;/strong&gt;ï¼šç†è§£è¿™äº›æ³¨è§£æ˜¯æ·±å…¥æŒæ¡ Spring Boot è‡ªåŠ¨é…ç½®åŸç†çš„å…³é”®ã€‚Spring Boot è‡ªèº«çš„ &lt;code&gt;@Configuration&lt;/code&gt;ç±»å¤§é‡ä½¿ç”¨è¿™äº›æ¡ä»¶æ³¨è§£ï¼Œç¡®ä¿åªæœ‰åœ¨åˆé€‚çš„æ¡ä»¶ä¸‹æ‰å¯ç”¨ç›¸åº”çš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„æ¢³ç†èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°è¿ç”¨ Spring Boot çš„æ¡ä»¶æ³¨è§£ã€‚å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šæ³¨è§£çš„ç”¨æ³•æˆ–ç»„åˆä½¿ç”¨çš„åœºæ™¯æœ‰æ›´æ·±å…¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="ç±»ä¸Š"&gt;ç±»ä¸Š
&lt;/h2&gt;&lt;p&gt;Spring Boot çš„æ¡ä»¶æ³¨è§£ä¸­ï¼Œç¡®å®æœ‰å°‘æ•°å‡ ä¸ªé€šå¸¸å»ºè®®æˆ–&lt;strong&gt;ä»…é™äºåœ¨ç±»çº§åˆ«ä½¿ç”¨&lt;/strong&gt;ï¼Œè¿™ä¸»è¦æ˜¯ç”±å®ƒä»¬æ‰€è¦åˆ¤æ–­çš„æ¡ä»¶æ€§è´¨å†³å®šçš„ã€‚ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨è²Œï¼Œä¸‹è¡¨æ•´ç†äº†å¸¸è§æ¡ä»¶æ³¨è§£çš„ä½œç”¨èŒƒå›´ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;ä¸»è¦ä½œç”¨&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨ä½œç”¨èŒƒå›´&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnWarDeployment&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ¤æ–­åº”ç”¨æ˜¯å¦ä»¥&lt;strong&gt;ä¼ ç»Ÿ WAR åŒ…&lt;/strong&gt;æ–¹å¼éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»…ç±»ä¸Š&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnCloudPlatform&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ¤æ–­åº”ç”¨æ˜¯å¦è¿è¡Œåœ¨æŒ‡å®šçš„&lt;strong&gt;äº‘å¹³å°&lt;/strong&gt;ä¸Š&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»…ç±»ä¸Š&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦ä¸º &lt;strong&gt;Web åº”ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»æˆ–æ–¹æ³•ä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnNotWebApplication&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦&lt;strong&gt;é Web åº”ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»æˆ–æ–¹æ³•ä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnJava&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ¤æ–­å½“å‰ &lt;strong&gt;JVM ç‰ˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»æˆ–æ–¹æ³•ä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è¯¦è§£ç±»çº§åˆ«æ³¨è§£"&gt;ğŸ¯ è¯¦è§£ç±»çº§åˆ«æ³¨è§£
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹ä¸¤ä¸ªæ³¨è§£ç”±äºå…¶åˆ¤æ–­æ¡ä»¶çš„å…¨å±€æ€§ï¼Œé€šå¸¸åªç”¨äºç±»çº§åˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnWarDeployment&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™ä¸ªæ³¨è§£ç”¨äºåˆ¤æ–­åº”ç”¨ç¨‹åºæ˜¯å¦ä»¥ä¼ ç»Ÿçš„ &lt;strong&gt;WAR åŒ…å½¢å¼éƒ¨ç½²åˆ°å¤–éƒ¨ Servlet å®¹å™¨&lt;/strong&gt;ï¼ˆå¦‚ Tomcatï¼‰ä¸­è¿è¡Œã€‚å¯¹äºä½¿ç”¨åµŒå…¥å¼æœåŠ¡å™¨ï¼ˆå¦‚ Spring Boot å†…åµŒçš„ Tomcatï¼‰çš„ Spring Boot å¯æ‰§è¡Œ JAR åº”ç”¨ï¼Œæ­¤æ¡ä»¶å°†ä¸åŒ¹é…ã€‚å› ä¸ºè¿™ä¸ªæ¡ä»¶å…³ä¹æ•´ä¸ªåº”ç”¨çš„&lt;strong&gt;æ‰“åŒ…å’Œéƒ¨ç½²æ–¹å¼&lt;/strong&gt;ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„ã€é¡¶å±‚çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å®ƒé€šå¸¸è¢«æ ‡æ³¨åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸Šï¼Œä»¥æ§åˆ¶æ•´ä¸ªé…ç½®æ¨¡å—æ˜¯å¦ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnCloudPlatform&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™ä¸ªæ³¨è§£ç”¨äºåˆ¤æ–­åº”ç”¨å½“å‰æ˜¯å¦è¿è¡Œåœ¨æŒ‡å®šçš„&lt;strong&gt;äº‘å¹³å°&lt;/strong&gt;ï¼ˆå¦‚ Kubernetesï¼‰ä¸Šã€‚è¯¥åˆ¤æ–­ä¾èµ–äºäº‘å¹³å°æ³¨å…¥çš„ç¯å¢ƒå˜é‡æˆ–å…¶ä»–å…¨å±€æŒ‡æ ‡ï¼ŒåŒæ ·æ˜¯åº”ç”¨çº§åˆ«çš„å…¨å±€æ¡ä»¶ã€‚å› æ­¤ï¼Œå®ƒä¹Ÿ&lt;strong&gt;æ›´é€‚åˆåœ¨ç±»çº§åˆ«ä½¿ç”¨&lt;/strong&gt;ï¼Œä»¥å†³å®šä¸€æ•´å¥—ä¸ç‰¹å®šäº‘ç¯å¢ƒç›¸å…³çš„é…ç½®æ˜¯å¦åº”è¯¥è¢«åŠ è½½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä½œç”¨èŒƒå›´ä¸ä½¿ç”¨è€ƒé‡"&gt;ğŸ’¡ ä½œç”¨èŒƒå›´ä¸ä½¿ç”¨è€ƒé‡
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;ã€&lt;code&gt;@ConditionalOnNotWebApplication&lt;/code&gt;å’Œ &lt;code&gt;@ConditionalOnJava&lt;/code&gt;è¿™äº›æ³¨è§£å¯ä»¥ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä½†å°†å®ƒä»¬ç”¨äº&lt;strong&gt;ç±»çº§åˆ«å¾€å¾€æ›´å¸¸è§ä¸”æ›´é«˜æ•ˆ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆç‡ä¸é€»è¾‘åˆ†ç»„&lt;/strong&gt;ï¼šå°†ä¸€ä¸ªæ¡ä»¶æ³¨è§£æ”¾åœ¨ç±»ä¸Šï¼Œå¯ä»¥ä¸€æ¬¡æ€§å†³å®šæ•´ä¸ªé…ç½®ç±»ï¼ˆåŒ…æ‹¬å…¶ä¸­æ‰€æœ‰çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ã€&lt;code&gt;@Import&lt;/code&gt;å’Œ &lt;code&gt;@ComponentScan&lt;/code&gt;ï¼‰æ˜¯å¦éœ€è¦è¢«å¤„ç†ã€‚è¿™é¿å…äº†åœ¨å¤šä¸ªæ–¹æ³•ä¸Šé‡å¤ç›¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œä½¿ä»£ç æ›´æ¸…æ™°ï¼Œä¹Ÿç¬¦åˆå°†ç›¸å…³é…ç½®é€»è¾‘åˆ†ç»„çš„åŸåˆ™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®çš„å¸¸è§æ¨¡å¼&lt;/strong&gt;ï¼šSpring Boot è‡ªèº«çš„è‡ªåŠ¨é…ç½®å¤§é‡é‡‡ç”¨äº†è¿™ç§æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œè®¸å¤šä¸ Web ç›¸å…³çš„é…ç½®ç±»éƒ½ä¼šä½¿ç”¨ &lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;è¿›è¡Œæ ‡è®°ï¼Œç¡®ä¿åªæœ‰åœ¨ Web åº”ç”¨ä¸­æ‰å¯ç”¨è¿™äº›é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä½¿ç”¨å»ºè®®ä¸æœ€ä½³å®è·µ"&gt;ğŸ› ï¸ ä½¿ç”¨å»ºè®®ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…³æ³¨æ¡ä»¶æ€§è´¨&lt;/strong&gt;ï¼šåœ¨é€‰æ‹©å°†æ¡ä»¶æ³¨è§£æ”¾åœ¨ç±»ä¸Šè¿˜æ˜¯æ–¹æ³•ä¸Šæ—¶ï¼Œè€ƒè™‘æ¡ä»¶çš„&lt;strong&gt;ä½œç”¨åŸŸ&lt;/strong&gt;ã€‚åƒåˆ¤æ–­åº”ç”¨ç±»å‹ã€éƒ¨ç½²æ–¹å¼ã€äº‘ç¯å¢ƒã€Java ç‰ˆæœ¬ç­‰å…¨å±€æ€§æ¡ä»¶ï¼Œæ”¾åœ¨ç±»ä¸Šé€šå¸¸æ›´åˆé€‚ã€‚è€Œåˆ¤æ–­ç‰¹å®š Bean æ˜¯å¦å­˜åœ¨ã€æŸä¸ªå…·ä½“å±æ€§å€¼ç­‰æ›´ç»†ç²’åº¦çš„æ¡ä»¶ï¼Œåˆ™å¯èƒ½æ›´é€‚åˆæ”¾åœ¨æ–¹æ³•ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥é˜…å®˜æ–¹æ–‡æ¡£&lt;/strong&gt;ï¼šå½“ä¸ç¡®å®šæŸä¸ªæ³¨è§£çš„æœ€ä½³ä½¿ç”¨èŒƒå›´æ—¶ï¼Œæœ€å¯é çš„æ–¹æ³•æ˜¯æŸ¥é˜… Spring Boot çš„å®˜æ–¹ API æ–‡æ¡£ï¼Œå…¶ä¸­ä¼šæ˜ç¡®è¯´æ˜æ¯ä¸ªæ³¨è§£çš„å¯ç”¨ç›®æ ‡ï¼ˆ&lt;code&gt;@Target&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´æ¸…æ™°åœ°ç†è§£ Spring Boot æ¡ä»¶æ³¨è§£çš„ä½œç”¨èŒƒå›´ã€‚å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šæ³¨è§£çš„ç”¨æ³•è¿˜æœ‰ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="springfactoriesloader"&gt;SpringFactoriesLoader
&lt;/h2&gt;&lt;p&gt;SpringFactoriesLoader æ˜¯ Spring æ¡†æ¶å†…éƒ¨ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„å·¥å…·ç±»ï¼Œå®ƒå®ç°äº†ä¸€ç§å¢å¼ºçš„ SPIï¼ˆService Provider Interfaceï¼‰æœºåˆ¶ï¼Œæ˜¯ Spring Boot è‡ªåŠ¨é…ç½®çš„åŸºçŸ³ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£å®ƒã€‚&lt;/p&gt;
&lt;h3 id="ä¸€æ ¸å¿ƒæ¦‚å¿µä¸è§’è‰²"&gt;&lt;strong&gt;ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸è§’è‰²&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;SpringFactoriesLoader&lt;/code&gt;çš„æ ¸å¿ƒå·¥ä½œæ˜¯&lt;strong&gt;æ‰«ææ•´ä¸ªç±»è·¯å¾„ï¼ˆClasspathï¼‰ä¸­æ‰€æœ‰ JAR åŒ…å†…çš„ &lt;code&gt;META-INF/spring.factories&lt;/code&gt;æ–‡ä»¶&lt;/strong&gt;ï¼Œè§£æå…¶ä¸­çš„é…ç½®ï¼Œå¹¶æ ¹æ®æ¥å£ç±»å‹åŠ è½½å¹¶å®ä¾‹åŒ–å¯¹åº”çš„å®ç°ç±»ã€‚å®ƒæ˜¯ä¸€ç§çº¦å®šä¼˜äºé…ç½®çš„å·¥å‚åŠ è½½æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒä¸ Java åŸç”Ÿçš„ SPI æœºåˆ¶æ€æƒ³ç±»ä¼¼ï¼Œä½†æ›´åŠ å¼ºå¤§å’Œçµæ´»ã€‚ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¶å…¨è²Œï¼Œä¸‹è¡¨å¯¹æ¯”äº†å®ƒçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ ¸å¿ƒè§’è‰²&lt;/th&gt;
&lt;th&gt;èŒè´£è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;spring.factories&lt;/code&gt;æ–‡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»æ”¾åœ¨ &lt;code&gt;META-INF/&lt;/code&gt;ç›®å½•ä¸‹ã€‚å†…å®¹ä¸º Properties æ ¼å¼ï¼ˆkey=valueï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡æ¥å£ï¼ˆKeyï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®æ–‡ä»¶çš„ keyï¼Œæ˜¯æ¥å£æˆ–æŠ½è±¡ç±»çš„å…¨é™å®šåï¼ˆå¦‚ &lt;code&gt;org.springframework.context.ApplicationContextInitializer&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®ç°ç±»ï¼ˆValueï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®æ–‡ä»¶çš„ valueï¼Œæ˜¯å®ç°ç±»çš„å…¨é™å®šåã€‚å¤šä¸ªå®ç°ç±»ç”¨é€—å·åˆ†éš”ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;SpringFactoriesLoader&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ¸å¿ƒåŠ è½½å™¨ï¼Œè´Ÿè´£å®šä½æ–‡ä»¶ã€è§£æå†…å®¹ã€åŠ è½½ç±»å¹¶å®ä¾‹åŒ–å¯¹è±¡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„ &lt;code&gt;spring.factories&lt;/code&gt;æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# ç¤ºä¾‹ï¼šSpring Boot è‡ªåŠ¨é…ç½®çš„ä¸€éƒ¨åˆ†
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.MyAutoConfiguration,\
com.example.AnotherAutoConfiguration
# ç¤ºä¾‹ï¼šåº”ç”¨åˆå§‹åŒ–å™¨
org.springframework.context.ApplicationContextInitializer=\
com.example.MyInitializer
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="äºŒå·¥ä½œæœºåˆ¶ä¸æºç è§£æ"&gt;&lt;strong&gt;äºŒã€å·¥ä½œæœºåˆ¶ä¸æºç è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;SpringFactoriesLoader&lt;/code&gt;çš„å·¥ä½œæµç¨‹å¯ä»¥æ¸…æ™°åœ°åˆ†ä¸º&lt;strong&gt;èµ„æºå®šä½ã€é…ç½®è§£æã€ç¼“å­˜æœºåˆ¶å’Œå®ä¾‹åŒ–&lt;/strong&gt;å››ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;h4 id="1-èµ„æºå®šä½"&gt;&lt;strong&gt;1. èµ„æºå®šä½&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆ&lt;code&gt;ClassLoader&lt;/code&gt;ï¼‰ï¼Œè°ƒç”¨å…¶ &lt;code&gt;getResources(&amp;quot;META-INF/spring.factories&amp;quot;)&lt;/code&gt;æ–¹æ³•ï¼Œè·å–ç±»è·¯å¾„ä¸‹æ‰€æœ‰ JAR åŒ…ä¸­è¯¥æ–‡ä»¶çš„ URL æšä¸¾ã€‚è¿™ç¡®ä¿äº†èƒ½å¤Ÿå‘ç°æ‰€æœ‰ä¾èµ–åŒ…ä¸­å£°æ˜çš„æ‰©å±•ç‚¹ã€‚&lt;/p&gt;
&lt;h4 id="2-é…ç½®è§£æä¸ç¼“å­˜"&gt;&lt;strong&gt;2. é…ç½®è§£æä¸ç¼“å­˜&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æ­¥éª¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜æ£€æŸ¥&lt;/strong&gt;ï¼šé¦–å…ˆæ£€æŸ¥ä¸€ä¸ªé™æ€çš„ &lt;code&gt;ConcurrentReferenceHashMap&lt;/code&gt;ç¼“å­˜ï¼ˆkey ä¸º &lt;code&gt;ClassLoader&lt;/code&gt;ï¼Œvalue ä¸ºè§£æç»“æœï¼‰ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼Œé¿å…é‡å¤çš„ I/O æ“ä½œå’Œè§£æå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£ææ–‡ä»¶&lt;/strong&gt;ï¼šå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™éå†ç¬¬ä¸€æ­¥è·å–çš„æ‰€æœ‰ URLï¼Œä½¿ç”¨ &lt;code&gt;PropertiesLoaderUtils&lt;/code&gt;å°†æ¯ä¸ª &lt;code&gt;spring.factories&lt;/code&gt;æ–‡ä»¶å†…å®¹åŠ è½½ä¸º &lt;code&gt;Properties&lt;/code&gt;å¯¹è±¡ã€‚ç„¶åï¼Œå°†é”®å€¼å¯¹è§£æåˆ°ä¸€ä¸ª &lt;code&gt;MultiValueMap&amp;lt;String, String&amp;gt;&lt;/code&gt;ä¸­ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæ¥å£åå¯¹åº”ä¸€ä¸ªå®ç°ç±»åçš„åˆ—è¡¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥ç¼“å­˜&lt;/strong&gt;ï¼šå°†æœ€ç»ˆçš„è§£æç»“æœæ”¾å…¥ç¼“å­˜ï¼Œä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å®ä¾‹åŒ–"&gt;&lt;strong&gt;3. å®ä¾‹åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æ ¸å¿ƒæ–¹æ³•æ˜¯ &lt;code&gt;loadFactories(Class&amp;lt;T&amp;gt; factoryType, ClassLoader classLoader)&lt;/code&gt;ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è·å–ç±»ååˆ—è¡¨&lt;/strong&gt;ï¼šå†…éƒ¨è°ƒç”¨ &lt;code&gt;loadFactoryNames&lt;/code&gt;æ–¹æ³•ï¼Œä»ç¼“å­˜æˆ–ä¸Šè¿°æµç¨‹ä¸­è·å–æŒ‡å®šæ¥å£çš„æ‰€æœ‰å®ç°ç±»çš„å…¨é™å®šååˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åå°„åˆ›å»ºå®ä¾‹&lt;/strong&gt;ï¼šéå†ç±»ååˆ—è¡¨ï¼Œé€šè¿‡åå°„ï¼ˆ&lt;code&gt;ClassUtils.forName&lt;/code&gt;å’Œ &lt;code&gt;ReflectionUtils.accessibleConstructor&lt;/code&gt;ï¼‰å®ä¾‹åŒ–æ¯ä¸ªç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’åº&lt;/strong&gt;ï¼šæœ€åï¼Œä½¿ç”¨ &lt;code&gt;AnnotationAwareOrderComparator.sort(result)&lt;/code&gt;å¯¹å®ä¾‹åŒ–åçš„å¯¹è±¡åˆ—è¡¨è¿›è¡Œæ’åºã€‚è¿™ä½¿å¾—å®ç°ç±»å¯ä»¥é€šè¿‡ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æˆ–å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£æ¥å®šä¹‰æ‰§è¡Œé¡ºåºï¼Œéå¸¸æœ‰ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ä¸‰ä¸»è¦æ–¹æ³•"&gt;&lt;strong&gt;ä¸‰ã€ä¸»è¦æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;SpringFactoriesLoader&lt;/code&gt;æä¾›äº†ä¸¤ä¸ªæœ€å¸¸ç”¨çš„é™æ€æ–¹æ³•ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;List&amp;lt;String&amp;gt; loadFactoryNames(Class&amp;lt;?&amp;gt; factoryType, ClassLoader classLoader)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ¹æ®æ¥å£ç±»å‹ï¼Œè·å–æ‰€æœ‰å®ç°ç±»çš„&lt;strong&gt;å…¨é™å®šå&lt;/strong&gt;ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰ã€‚æ­¤è¿‡ç¨‹&lt;strong&gt;ä¸ä¼šå®ä¾‹åŒ–&lt;/strong&gt;è¿™äº›ç±»ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;&amp;lt;T&amp;gt; List&amp;lt;T&amp;gt; loadFactories(Class&amp;lt;T&amp;gt; factoryType, ClassLoader classLoader)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ¹æ®æ¥å£ç±»å‹ï¼Œ&lt;strong&gt;åŠ è½½ã€å®ä¾‹åŒ–å¹¶è¿”å›&lt;/strong&gt;æ‰€æœ‰å®ç°ç±»çš„å¯¹è±¡åˆ—è¡¨ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="å››åœ¨-spring-boot-ä¸­çš„å…³é”®åº”ç”¨"&gt;&lt;strong&gt;å››ã€åœ¨ Spring Boot ä¸­çš„å…³é”®åº”ç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;SpringFactoriesLoader&lt;/code&gt;åœ¨ Spring Boot çš„å¯åŠ¨è¿‡ç¨‹ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œæ˜¯è‡ªåŠ¨é…ç½®çš„çµé­‚ã€‚åœ¨ &lt;code&gt;SpringApplication&lt;/code&gt;çš„æ„é€ æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å…³é”®è°ƒç”¨ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public SpringApplication(ResourceLoader resourceLoader, Class&amp;lt;?&amp;gt;... primarySources) {
// ...
// è®¾ç½®åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–å™¨
setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
// è®¾ç½®ç›‘å¬å™¨
setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œçš„ &lt;code&gt;getSpringFactoriesInstances&lt;/code&gt;æ–¹æ³•å†…éƒ¨å°±è°ƒç”¨äº† &lt;code&gt;SpringFactoriesLoader.loadFactories&lt;/code&gt;ã€‚å…·ä½“åº”ç”¨åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®ï¼ˆ&lt;code&gt;EnableAutoConfiguration&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šæœ€è‘—åçš„åº”ç”¨ã€‚Spring Boot ä» &lt;code&gt;spring-boot-autoconfigure&lt;/code&gt;jar åŒ…çš„ &lt;code&gt;spring.factories&lt;/code&gt;ä¸­åŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆå¦‚ &lt;code&gt;DataSourceAutoConfiguration&lt;/code&gt;ï¼‰ï¼Œæ ¹æ®æ¡ä»¶ï¼ˆå¦‚ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼‰è‡ªåŠ¨é…ç½® Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–å™¨ï¼ˆ&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šåœ¨å®¹å™¨åˆ·æ–°ä¹‹å‰è¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬å™¨ï¼ˆ&lt;code&gt;ApplicationListener&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šç›‘å¬ Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¶ä»–æ‰©å±•ç‚¹&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;EnvironmentPostProcessor&lt;/code&gt;ï¼ˆç”¨äºè‡ªå®šä¹‰ç¯å¢ƒå˜é‡å¤„ç†ï¼‰ã€&lt;code&gt;FailureAnalyzer&lt;/code&gt;ï¼ˆç”¨äºå¯åŠ¨å¤±è´¥åˆ†æï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="äº”ä¸-java-spi-çš„å¯¹æ¯”"&gt;&lt;strong&gt;äº”ã€ä¸ Java SPI çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç†è§£ Spring SPI ä¸ Java åŸç”Ÿ SPI çš„å·®å¼‚ï¼Œèƒ½æ›´å¥½åœ°ä½“ä¼šå…¶è®¾è®¡ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;Java SPI&lt;/th&gt;
&lt;th&gt;Spring SPI (&lt;code&gt;SpringFactoriesLoader&lt;/code&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªæ¥å£ä¸€ä¸ªæ–‡ä»¶ï¼Œè·¯å¾„ä¸º &lt;code&gt;META-INF/services/æ¥å£å…¨é™å®šå&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ªç»Ÿä¸€çš„ &lt;code&gt;META-INF/spring.factories&lt;/code&gt;æ–‡ä»¶ï¼ŒProperties æ ¼å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ è½½æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;java.util.ServiceLoader&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;org.springframework.core.io.support.SpringFactoriesLoader&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸€æ¬¡è·å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åªèƒ½é€šè¿‡è¿­ä»£å™¨éå†è·å–æ‰€æœ‰å®ç°å®ä¾‹&lt;/td&gt;
&lt;td&gt;å¯ç›´æ¥é€šè¿‡æ¥å£ç±»å‹è·å–æ‰€æœ‰å®ç°å®ä¾‹çš„åˆ—è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ’åºæ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒï¼ŒåŠ è½½é¡ºåºä¸ç¡®å®š&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼Œä½¿ç”¨ &lt;code&gt;AnnotationAwareOrderComparator&lt;/code&gt;è¿›è¡Œæ’åº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Java æ ‡å‡†æœåŠ¡å‘ç°ï¼ˆå¦‚ JDBC é©±åŠ¨åŠ è½½ï¼‰&lt;/td&gt;
&lt;td&gt;Spring æ¡†æ¶åŠ Spring Boot çš„æ‰©å±•å’Œè‡ªåŠ¨é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="å…­æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;å…­ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨å·¥å…·ç±»&lt;/strong&gt;ï¼šå°½ç®¡åŠŸèƒ½å¼ºå¤§ï¼Œä½† &lt;code&gt;SpringFactoriesLoader&lt;/code&gt;åœ¨å®˜æ–¹æ–‡æ¡£ä¸­è¢«æ ‡è®°ä¸ºâ€œæ¡†æ¶å†…éƒ¨ä½¿ç”¨â€çš„å·¥å…·ç±»ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨å®ƒçš„æƒ…å†µç›¸å¯¹è¾ƒå°‘ï¼Œæ›´å¸¸è§çš„åšæ³•æ˜¯é€šè¿‡ Spring æä¾›çš„æ›´é«˜çº§çš„æ‰©å±•ç‚¹ï¼ˆå¦‚ &lt;code&gt;@Configuration&lt;/code&gt;ã€&lt;code&gt;BeanPostProcessor&lt;/code&gt;ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä» Spring Boot 2.4 å¼€å§‹&lt;/strong&gt;ï¼šæ”¯æŒåœ¨ &lt;code&gt;spring.factories&lt;/code&gt;ä¸­ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration&lt;/code&gt;&lt;/strong&gt; ä½œä¸º keyï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåœ¨æ–°çš„ &lt;code&gt;META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;æ–‡ä»¶ä¸­ç›´æ¥åˆ—å‡ºè‡ªåŠ¨é…ç½®ç±»ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼Œåè€…æ›´ä¸ºç®€æ´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ å…¨é¢ç†è§£ &lt;code&gt;SpringFactoriesLoader&lt;/code&gt;ã€‚å®ƒæ˜¯æ·±å…¥æŒæ¡ Spring Boot è‡ªåŠ¨é…ç½®å’Œæ¡†æ¶æ‰©å±•æœºåˆ¶çš„å…³é”®ä¸€ç¯ã€‚&lt;/p&gt;
&lt;h2 id="enableautoconfiguration"&gt;@EnableAutoConfiguration
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;æ˜¯ Spring Boot è‡ªåŠ¨é…ç½®æœºåˆ¶çš„æ ¸å¿ƒæ³¨è§£ï¼Œå®ƒä½¿å¾— Spring Boot èƒ½å¤Ÿæ ¹æ®ä½ æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚&lt;/p&gt;
&lt;h3 id="ä¸€æ ¸å¿ƒæœºåˆ¶ä¸€è§ˆ"&gt;&lt;strong&gt;ä¸€ã€æ ¸å¿ƒæœºåˆ¶ä¸€è§ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨å±€ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªè¡¨æ ¼æ¥æ¢³ç† &lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæœºåˆ¶ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ ¸å¿ƒæœºåˆ¶&lt;/th&gt;
&lt;th&gt;å…³é”®ç»„ä»¶/æ¦‚å¿µ&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨è§£é©±åŠ¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;, &lt;code&gt;@Import&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¯ç”¨è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œå¹¶å¯¼å…¥æ ¸å¿ƒé€‰æ‹©å™¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®å‘ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt;, &lt;code&gt;spring.factories&lt;/code&gt;/ &lt;code&gt;AutoConfiguration.imports&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ‰«æç±»è·¯å¾„ï¼Œå‘ç°æ‰€æœ‰æ½œåœ¨çš„è‡ªåŠ¨é…ç½®ç±»ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¡ä»¶è¿‡æ»¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;, &lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;td&gt;æ ¹æ®å½“å‰ç¯å¢ƒï¼ˆä¾èµ–ã€é…ç½®ã€å·²å­˜åœ¨çš„Beanï¼‰ç­›é€‰å‡ºæœ€ç»ˆç”Ÿæ•ˆçš„é…ç½®ç±»ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®åŠ è½½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¡ä»¶æ³¨è§£åŒ¹é…æˆåŠŸçš„é…ç½®ç±»&lt;/td&gt;
&lt;td&gt;å°†ç¬¦åˆæ¡ä»¶çš„é…ç½®ç±»åŠ è½½åˆ°Springå®¹å™¨ï¼Œåˆ›å»ºæ‰€éœ€çš„Beanã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="äºŒæ³¨è§£å®šä¹‰ä¸å…ƒæ³¨è§£"&gt;&lt;strong&gt;äºŒã€æ³¨è§£å®šä¹‰ä¸å…ƒæ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;æœ¬èº«æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå®ƒçš„å®šä¹‰æ­ç¤ºäº†å…¶å·¥ä½œåŸç†ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage // å…³é”®å…ƒæ³¨è§£ä¹‹ä¸€
@Import(AutoConfigurationImportSelector.class) // æœ€æ ¸å¿ƒçš„å…ƒæ³¨è§£
public @interface EnableAutoConfiguration {
String ENABLED_OVERRIDE_PROPERTY = &amp;#34;spring.boot.enableautoconfiguration&amp;#34;;
Class&amp;lt;?&amp;gt;[] exclude() default {};
String[] excludeName() default {};
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ä¸¤ä¸ªå…ƒæ³¨è§£å°¤ä¸ºå…³é”®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@AutoConfigurationPackage&lt;/code&gt;&lt;/strong&gt;ï¼šå®ƒçš„ä½œç”¨æ˜¯&lt;strong&gt;è®°å½•ä¸»é…ç½®ç±»ï¼ˆå³æ ‡æ³¨äº†&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;çš„ç±»ï¼‰æ‰€åœ¨çš„åŒ…è·¯å¾„&lt;/strong&gt;ã€‚è¿™ä¸ªä¿¡æ¯ä¸»è¦ç”¨äºåç»­çš„ç»„ä»¶æ‰«æï¼ˆå¦‚JPAå®ä½“æ‰«æï¼‰ï¼Œé»˜è®¤ä¼šæ‰«æè¯¥åŒ…åŠå…¶å­åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Import(AutoConfigurationImportSelector.class)&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯è‡ªåŠ¨é…ç½®çš„&lt;strong&gt;çµé­‚&lt;/strong&gt;ã€‚å®ƒé€šè¿‡Springçš„&lt;code&gt;@Import&lt;/code&gt;æœºåˆ¶ï¼Œå¯¼å…¥äº†&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt;è¿™ä¸ªç±»ï¼Œç”±å®ƒæ¥è´Ÿè´£å†³å®šå…·ä½“å“ªäº›é…ç½®ç±»åº”è¯¥è¢«åŠ è½½åˆ°Springå®¹å™¨ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ä¸‰è‡ªåŠ¨é…ç½®çš„åŠ è½½æµç¨‹"&gt;&lt;strong&gt;ä¸‰ã€è‡ªåŠ¨é…ç½®çš„åŠ è½½æµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt;æ˜¯å®ç°è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒç±»ï¼Œå…¶åŠ è½½æµç¨‹çš„ç²¾é«“åœ¨äº &lt;strong&gt;â€œå€™é€‰â€&lt;/strong&gt; ä¸ &lt;strong&gt;â€œæ¡ä»¶â€&lt;/strong&gt; è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚&lt;/p&gt;
&lt;h4 id="1-è·å–å€™é€‰é…ç½®ç±»"&gt;&lt;strong&gt;1. è·å–å€™é€‰é…ç½®ç±»&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯å…ˆå‡†å¤‡ä¸€ä»½æ‰€æœ‰å¯èƒ½çš„â€œèœå•â€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt;å®ç°äº† &lt;code&gt;DeferredImportSelector&lt;/code&gt;æ¥å£ï¼Œè¿™æ„å‘³ç€å®ƒçš„ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•ä¼šåœ¨æ‰€æœ‰å¸¸è§„çš„ &lt;code&gt;@Configuration&lt;/code&gt;ç±»å¤„ç†å®Œæˆä¹‹åæ‰è¢«è°ƒç”¨ï¼Œç¡®ä¿è‡ªåŠ¨é…ç½®ä¸ä¼šå¹²æ‰°ç”¨æˆ·çš„æ‰‹åŠ¨é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œå®ƒä¼šé€šè¿‡ &lt;code&gt;SpringFactoriesLoader&lt;/code&gt;æœºåˆ¶ï¼Œ&lt;strong&gt;æ‰«ææ•´ä¸ªç±»è·¯å¾„ä¸‹æ‰€æœ‰JARåŒ…ä¸­çš„ &lt;code&gt;META-INF/spring.factories&lt;/code&gt;æ–‡ä»¶ï¼ˆSpring Boot 2.xï¼‰æˆ– &lt;code&gt;META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;æ–‡ä»¶ï¼ˆSpring Boot 3.xï¼‰&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¿™äº›æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ &lt;strong&gt;&lt;code&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration&lt;/code&gt;&lt;/strong&gt; è¿™ä¸ªé”®ï¼ˆkeyï¼‰å¯¹åº”çš„æ‰€æœ‰é…ç½®ç±»çš„å…¨é™å®šåã€‚è¿™äº›ç±»å°±æ˜¯â€œå€™é€‰â€çš„è‡ªåŠ¨é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-æ¡ä»¶åŒ–ç­›é€‰"&gt;&lt;strong&gt;2. æ¡ä»¶åŒ–ç­›é€‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æœ‰äº†â€œå€™é€‰èœå•â€ï¼Œæ¥ä¸‹æ¥å°±è¦æ ¹æ®â€œé£Ÿå®¢â€çš„å®é™…æƒ…å†µï¼ˆå½“å‰åº”ç”¨çš„ç¯å¢ƒã€ä¾èµ–ç­‰ï¼‰æ¥å†³å®šæœ€ç»ˆä¸Šå“ªäº›èœã€‚è¿™æ˜¯é€šè¿‡ä¸€ç³»åˆ— &lt;strong&gt;&lt;code&gt;@ConditionalOn...&lt;/code&gt;&lt;/strong&gt; æ³¨è§£å®Œæˆçš„ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¡ä»¶æ³¨è§£&lt;/th&gt;
&lt;th&gt;ç”Ÿæ•ˆæ¡ä»¶&lt;/th&gt;
&lt;th&gt;ä¸¾ä¾‹è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»è·¯å¾„ä¸‹å­˜åœ¨æŒ‡å®šçš„ç±»&lt;/td&gt;
&lt;td&gt;åªæœ‰åœ¨å­˜åœ¨ &lt;code&gt;DataSource.class&lt;/code&gt;æ—¶ï¼Œæ•°æ®æºè‡ªåŠ¨é…ç½®æ‰ç”Ÿæ•ˆã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„Bean&lt;/td&gt;
&lt;td&gt;å¦‚æœç”¨æˆ·æ²¡æœ‰è‡ªå·±å®šä¹‰ &lt;code&gt;DataSource&lt;/code&gt;Beanï¼Œåˆ™è‡ªåŠ¨é…ç½®æä¾›ä¸€ä¸ªé»˜è®¤çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnProperty&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨æŒ‡å®šçš„å±æ€§ä¸”å€¼åŒ¹é…&lt;/td&gt;
&lt;td&gt;å¦‚ &lt;code&gt;@ConditionalOnProperty(prefix=&amp;quot;my.service&amp;quot;, name=&amp;quot;enabled&amp;quot;, havingValue=&amp;quot;true&amp;quot;)&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰åº”ç”¨æ˜¯Webåº”ç”¨&lt;/td&gt;
&lt;td&gt;ç”¨äºWebç›¸å…³çš„è‡ªåŠ¨é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹ç¡®ä¿äº†&lt;strong&gt;è‡ªåŠ¨é…ç½®æ˜¯â€œæŒ‰éœ€â€åŠ è½½çš„&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œåªæœ‰åœ¨ä½ çš„pom.xmlä¸­å¼•å…¥äº†&lt;code&gt;spring-boot-starter-web&lt;/code&gt;ï¼ˆæ„å‘³ç€ç±»è·¯å¾„ä¸‹æœ‰Spring MVCçš„ç›¸å…³ç±»ï¼‰ï¼ŒSpring Bootæ‰ä¼šè‡ªåŠ¨é…ç½®å†…åµŒTomcatå’ŒSpring MVCçš„æ ¸å¿ƒç»„ä»¶ã€‚&lt;/p&gt;
&lt;h3 id="å››"&gt;&lt;strong&gt;å››ã€&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;ä¸ &lt;code&gt;@SpringBootApplication&lt;/code&gt;&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œåœ¨å¤§å¤šæ•°Spring Booté¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;ï¼Œè€Œæ˜¯ä½¿ç”¨äº†&lt;code&gt;@SpringBootApplication&lt;/code&gt;æ³¨è§£ã€‚è¿™æ˜¯å› ä¸º&lt;code&gt;@SpringBootApplication&lt;/code&gt;æ˜¯ä¸€ä¸ª&lt;strong&gt;å¤åˆæ³¨è§£&lt;/strong&gt;ï¼Œå®ƒå·²ç»åŒ…å«äº†&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration // è¢«åŒ…å«åœ¨å†…
@ComponentScan
public @interface SpringBootApplication {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å› æ­¤ï¼Œä½¿ç”¨&lt;code&gt;@SpringBootApplication&lt;/code&gt;å°±ç­‰ä»·äºåŒæ—¶ä½¿ç”¨äº†&lt;code&gt;@Configuration&lt;/code&gt;, &lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;å’Œ&lt;code&gt;@ComponentScan&lt;/code&gt;ï¼Œè¿™æ˜¯Spring Bootæ¨èçš„æ ‡å‡†ç”¨æ³•ã€‚&lt;/p&gt;
&lt;h3 id="äº”å®é™…åº”ç”¨ä¸é…ç½®æ§åˆ¶"&gt;&lt;strong&gt;äº”ã€å®é™…åº”ç”¨ä¸é…ç½®æ§åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ’é™¤ç‰¹å®šçš„è‡ªåŠ¨é…ç½®"&gt;&lt;strong&gt;1. æ’é™¤ç‰¹å®šçš„è‡ªåŠ¨é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¦‚æœæŸäº›è‡ªåŠ¨é…ç½®ä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œæˆ–è€…ä½ æƒ³å®Œå…¨æ‰‹åŠ¨æ§åˆ¶ï¼Œå¯ä»¥è½»æ¾åœ°æ’é™¤å®ƒä»¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨æ³¨è§£å±æ€§æ’é™¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})
public class MyApplication {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨é…ç½®æ–‡ä»¶æ’é™¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-è°ƒè¯•è‡ªåŠ¨é…ç½®"&gt;&lt;strong&gt;2. è°ƒè¯•è‡ªåŠ¨é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¦‚æœæƒ³çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆäº†ï¼Œå“ªäº›æ²¡æœ‰ç”Ÿæ•ˆä»¥åŠåŸå› ï¼Œå¯ä»¥å¼€å¯è°ƒè¯•æ¨¡å¼ã€‚åœ¨&lt;code&gt;application.properties&lt;/code&gt;ä¸­è®¾ç½®ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;debug=true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯åŠ¨åº”ç”¨åï¼Œæ§åˆ¶å°ä¼šæ‰“å°ä¸€ä»½è¯¦ç»†çš„è‡ªåŠ¨é…ç½®æŠ¥å‘Šï¼Œåˆ†ä¸ºâ€œPositive Matchesâ€ï¼ˆåŒ¹é…æˆåŠŸçš„é…ç½®ï¼‰å’Œâ€œNegative Matchesâ€ï¼ˆæœªåŒ¹é…çš„é…ç½®åŠåŸå› ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="å…­æ€»ç»“"&gt;&lt;strong&gt;å…­ã€æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;æ˜¯Spring Bootâ€œçº¦å®šä¼˜äºé…ç½®â€ç†å¿µçš„æ ¸å¿ƒä½“ç°ã€‚å…¶å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨è§¦å‘&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;@SpringBootApplication&lt;/code&gt;æ³¨è§£é—´æ¥å¯ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å€™é€‰å‘ç°&lt;/strong&gt;ï¼šç”±&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt;æ‰«æ&lt;code&gt;spring.factories&lt;/code&gt;æˆ–&lt;code&gt;AutoConfiguration.imports&lt;/code&gt;æ–‡ä»¶ï¼Œè·å–æ‰€æœ‰å¯èƒ½çš„è‡ªåŠ¨é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶è¿‡æ»¤&lt;/strong&gt;ï¼šåˆ©ç”¨&lt;code&gt;@ConditionalOn...&lt;/code&gt;ç³»åˆ—æ³¨è§£ï¼Œæ ¹æ®å½“å‰åº”ç”¨çš„ç±»è·¯å¾„ã€å·²æœ‰Beanã€é…ç½®å±æ€§ç­‰æ¡ä»¶è¿›è¡Œç­›é€‰ï¼Œæœ€ç»ˆç¡®å®šéœ€è¦åŠ è½½çš„é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Beanæ³¨å†Œ&lt;/strong&gt;ï¼šå°†ç­›é€‰åçš„é…ç½®ç±»ä¸­å®šä¹‰çš„Beanæ³¨å†Œåˆ°Springå®¹å™¨ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç†è§£è¿™ä¸€æœºåˆ¶ï¼Œä¸ä»…èƒ½è®©ä½ æ›´å¥½åœ°ä½¿ç”¨Spring Bootï¼Œä¹Ÿèƒ½åœ¨éœ€è¦å®šåˆ¶å’Œæ‰©å±•æ—¶å¾—å¿ƒåº”æ‰‹ã€‚&lt;/p&gt;
&lt;h2 id="import"&gt;@Import
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Import&lt;/code&gt;æ³¨è§£æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºå®ç°&lt;strong&gt;æ¨¡å—åŒ–é…ç½®&lt;/strong&gt;å’Œ&lt;strong&gt;çµæ´»æ³¨å†Œ Bean&lt;/strong&gt; çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚å®ƒå…è®¸ä½ å°†ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®ç±»ã€æ™®é€šç»„ä»¶æˆ–åŠ¨æ€é€‰æ‹©çš„é…ç½®å¯¼å…¥åˆ°å½“å‰çš„ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä»è€Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†åº”ç”¨çš„é…ç½®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™å¼ è¡¨æ ¼æ¸…æ™°åœ°å±•ç¤ºäº† &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£çš„å››ç§æ ¸å¿ƒç”¨æ³•åŠå…¶å…¸å‹åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤è¯†ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯¼å…¥ç±»å‹&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒæœºåˆ¶&lt;/th&gt;
&lt;th&gt;ä¸»è¦ç‰¹ç‚¹&lt;/th&gt;
&lt;th&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ™®é€šç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring è‡ªåŠ¨å°†ç±»å®ä¾‹åŒ–å¹¶æ³¨å†Œä¸º Bean&lt;/td&gt;
&lt;td&gt;ç®€å•ç›´æ¥ï¼Œé€‚åˆå¿«é€Ÿæ³¨å†Œ&lt;/td&gt;
&lt;td&gt;æ•´åˆç¬¬ä¸‰æ–¹åº“ä¸­çš„ç®€å•å·¥å…·ç±»æˆ–æœåŠ¡ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Configuration&lt;/code&gt;é…ç½®ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€’å½’å¤„ç†ç›®æ ‡é…ç½®ç±»ä¸­çš„æ‰€æœ‰ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ç­‰&lt;/td&gt;
&lt;td&gt;å®ç°é…ç½®çš„æ¨¡å—åŒ–ï¼Œæ‰¹é‡æ³¨å†Œ Bean&lt;/td&gt;
&lt;td&gt;æŒ‰åŠŸèƒ½æ¨¡å—ï¼ˆå¦‚æ•°æ®æºã€å®‰å…¨ï¼‰æ‹†åˆ†é…ç½®ï¼Œå¹¶åœ¨ä¸»é…ç½®ä¸­ç»„åˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;ImportSelector&lt;/code&gt;å®ç°ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•åŠ¨æ€è¿”å›è¦å¯¼å…¥çš„ç±»åæ•°ç»„&lt;/td&gt;
&lt;td&gt;æä¾›&lt;strong&gt;æ¡ä»¶åŒ–ã€åŠ¨æ€åŒ–&lt;/strong&gt;çš„å¯¼å…¥èƒ½åŠ›&lt;/td&gt;
&lt;td&gt;Spring Boot çš„è‡ªåŠ¨é…ç½®ã€æ ¹æ®ç¯å¢ƒæˆ–æ³¨è§£å±æ€§åŠ è½½ä¸åŒé…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;å®ç°ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;registerBeanDefinitions&lt;/code&gt;æ–¹æ³•ç›´æ¥ç¼–ç¨‹å¼æ³¨å†Œ Bean å®šä¹‰&lt;/td&gt;
&lt;td&gt;æä¾›&lt;strong&gt;æœ€é«˜çº§åˆ«çš„çµæ´»æ€§&lt;/strong&gt;ï¼Œå¯è‡ªå®šä¹‰ Bean çš„å„ç±»å±æ€§&lt;/td&gt;
&lt;td&gt;é›†æˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆå¦‚ MyBatisï¼‰ã€éœ€è¦ç²¾ç»†æ§åˆ¶ Bean å®šä¹‰çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸æºç ç®€æ"&gt;ğŸ”§ æ ¸å¿ƒæœºåˆ¶ä¸æºç ç®€æ
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Import&lt;/code&gt;æ³¨è§£çš„å¤„ç†ä¸»è¦ç”± Spring çš„ &lt;code&gt;ConfigurationClassPostProcessor&lt;/code&gt;åŠå…¶å†…éƒ¨çš„ &lt;code&gt;ConfigurationClassParser&lt;/code&gt;å®Œæˆã€‚å…¶åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£æå…¥å£&lt;/strong&gt;ï¼šSpring å®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œä¼šè°ƒç”¨ &lt;code&gt;ConfigurationClassPostProcessor&lt;/code&gt;æ¥å¤„ç†æ‰€æœ‰é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç† &lt;code&gt;@Import&lt;/code&gt;&lt;/strong&gt;ï¼šå½“ &lt;code&gt;ConfigurationClassParser&lt;/code&gt;è§£æåˆ°ä¸€ä¸ªé…ç½®ç±»ä¸Šå­˜åœ¨ &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£æ—¶ï¼Œå®ƒä¼šæ ¹æ® &lt;code&gt;value&lt;/code&gt;å±æ€§ä¸­æŒ‡å®šçš„ç±»ç±»å‹ï¼Œè¿›å…¥ä¸åŒçš„å¤„ç†åˆ†æ”¯ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯æ™®é€šç±»ï¼Œåˆ™ç›´æ¥å°†å…¶æ³¨å†Œä¸º Bean å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ &lt;code&gt;ImportSelector&lt;/code&gt;å®ç°ç±»ï¼Œåˆ™ä¼šå®ä¾‹åŒ–è¯¥é€‰æ‹©å™¨ï¼Œå¹¶è°ƒç”¨å…¶ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•æ¥è·å–éœ€è¦å¯¼å…¥çš„ç±»åæ•°ç»„ï¼Œç„¶åé€’å½’å¤„ç†è¿™äº›ç±»ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;å®ç°ç±»ï¼Œåˆ™ä¼šå®ä¾‹åŒ–è¯¥æ³¨å†Œå™¨ï¼Œå¹¶å°†å…¶æš‚å­˜èµ·æ¥ï¼Œå¾…æ‰€æœ‰é…ç½®ç±»è§£æå®Œæˆåï¼Œå†è°ƒç”¨å…¶ &lt;code&gt;registerBeanDefinitions&lt;/code&gt;æ–¹æ³•è¿›è¡Œç¼–ç¨‹å¼æ³¨å†Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹åˆ«æœºåˆ¶ï¼š&lt;code&gt;DeferredImportSelector&lt;/code&gt;&lt;/strong&gt; è¿™æ˜¯ &lt;code&gt;ImportSelector&lt;/code&gt;çš„ä¸€ä¸ªå­æ¥å£ã€‚å®ç°è¯¥æ¥å£çš„é€‰æ‹©å™¨ä¼šè¢«&lt;strong&gt;å»¶è¿Ÿå¤„ç†&lt;/strong&gt;ï¼Œç›´åˆ°æ‰€æœ‰å…¶ä»–çš„é…ç½®ç±»ï¼ˆåŒ…æ‹¬é€šè¿‡ &lt;code&gt;@Import&lt;/code&gt;å¯¼å…¥çš„æ™®é€šé…ç½®ç±»ï¼‰éƒ½å¤„ç†å®Œæ¯•åæ‰æ‰§è¡Œã€‚è¿™ä¸ºå¤„ç†é…ç½®ç±»ä¹‹é—´çš„ä¾èµ–å’Œé¡ºåºé—®é¢˜æä¾›äº†ä¾¿åˆ©ï¼ŒSpring Boot çš„è‡ªåŠ¨é…ç½®å°±åˆ©ç”¨äº†è¿™ä¸€æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯ä¸ç¤ºä¾‹"&gt;ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯ä¸ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="1-æ¨¡å—åŒ–é…ç½®"&gt;1. æ¨¡å—åŒ–é…ç½®
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯ &lt;code&gt;@Import&lt;/code&gt;æœ€å¸¸ç”¨çš„åœºæ™¯ï¼Œå¯ä»¥å°†åºå¤§çš„é…ç½®æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// æ•°æ®åº“é…ç½®æ¨¡å—
@Configuration
public class DatabaseConfig {
@Bean
public DataSource dataSource() {
return new HikariDataSource();
}
}
// å®‰å…¨é…ç½®æ¨¡å—
@Configuration
public class SecurityConfig {
@Bean
public SecurityFilter securityFilter() {
return new SecurityFilter();
}
}
// ä¸»é…ç½®ç±»ï¼šç»„åˆæ‰€æœ‰æ¨¡å—
@Configuration
@Import({DatabaseConfig.class, SecurityConfig.class}) // å¯¼å…¥å¤šä¸ªé…ç½®æ¨¡å—
public class AppConfig {
// ä¸»é…ç½®...
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-æ¡ä»¶åŒ–ä¸åŠ¨æ€é…ç½®"&gt;2. æ¡ä»¶åŒ–ä¸åŠ¨æ€é…ç½®
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;ImportSelector&lt;/code&gt;ï¼Œå¯ä»¥æ ¹æ®è¿è¡Œæ—¶çš„æ¡ä»¶ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€æ³¨è§£å±æ€§ï¼‰åŠ¨æ€å†³å®šåŠ è½½å“ªäº›é…ç½®ï¼Œè¿™æ˜¯ Spring Boot &lt;strong&gt;è‡ªåŠ¨é…ç½®çš„åŸºçŸ³&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// è‡ªå®šä¹‰é€‰æ‹©å™¨ï¼šæ ¹æ®ç³»ç»Ÿç¯å¢ƒå†³å®šå¯¼å…¥çš„é…ç½®
public class EnvironmentImportSelector implements ImportSelector {
@Override
public String[] selectImports(AnnotationMetadata importingClassMetadata) {
// ä¾‹å¦‚ï¼Œæ ¹æ®ç¯å¢ƒå˜é‡åˆ¤æ–­
if (&amp;#34;prod&amp;#34;.equals(System.getProperty(&amp;#34;app.env&amp;#34;))) {
return new String[] { ProdDatabaseConfig.class.getName() };
} else {
return new String[] { DevDatabaseConfig.class.getName() };
}
}
}
// åœ¨å¯åŠ¨ç±»æˆ–é…ç½®ç±»ä¸Šä½¿ç”¨
@Configuration
@Import(EnvironmentImportSelector.class)
public class AppConfig {
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-ç¼–ç¨‹å¼æ³¨å†Œä¸ç¬¬ä¸‰æ–¹é›†æˆ"&gt;3. ç¼–ç¨‹å¼æ³¨å†Œä¸ç¬¬ä¸‰æ–¹é›†æˆ
&lt;/h4&gt;&lt;p&gt;å½“éœ€è¦æ›´ç²¾ç»†åœ°æ§åˆ¶ Bean çš„æ³¨å†Œè¿‡ç¨‹ï¼Œæˆ–é›†æˆé‚£äº›æ²¡æœ‰ä½¿ç”¨ Spring æ³¨è§£çš„ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œ&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ˜¯ç†æƒ³é€‰æ‹©ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// è‡ªå®šä¹‰æ³¨å†Œå™¨ï¼Œç¼–ç¨‹å¼åœ°æ³¨å†ŒBean
public class MyCustomRegistrar implements ImportBeanDefinitionRegistrar {
@Override
public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
// åˆ›å»ºBeanå®šä¹‰
RootBeanDefinition beanDefinition = new RootBeanDefinition(MyExternalService.class);
// å¯ä»¥è®¾ç½®æ„é€ å™¨å‚æ•°ã€å±æ€§ç­‰
beanDefinition.getConstructorArgumentValues().addGenericArgumentValue(&amp;#34;someParameter&amp;#34;);
// å°†Beanå®šä¹‰æ³¨å†Œåˆ°å®¹å™¨ä¸­
registry.registerBeanDefinition(&amp;#34;myExternalService&amp;#34;, beanDefinition);
}
}
// é€šè¿‡@Importå¼•å…¥
@Configuration
@Import(MyCustomRegistrar.class)
public class AppConfig {
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä½¿ç”¨æ³¨æ„äº‹é¡¹"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯å¯¼å…¥&lt;/strong&gt;ï¼šé…ç½®ç±» A å¯¼å…¥é…ç½®ç±» Bï¼Œè€Œé…ç½®ç±» B åˆå¯¼å…¥é…ç½®ç±» Aï¼Œè¿™å¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºæˆ–å¯åŠ¨å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ™®é€šçš„ &lt;code&gt;@Import&lt;/code&gt;æŒ‰å£°æ˜é¡ºåºæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DeferredImportSelector&lt;/code&gt;çš„å®ç°ä¼šåœ¨æœ€åæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£æˆ–ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥è°ƒæ•´å¤šä¸ª &lt;code&gt;ImportSelector&lt;/code&gt;æˆ– &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;çš„æ‰§è¡Œé¡ºåºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ &lt;code&gt;@ComponentScan&lt;/code&gt;çš„å…³ç³»&lt;/strong&gt;ï¼š&lt;code&gt;@Import&lt;/code&gt;æ˜¯ä¸€ç§&lt;strong&gt;æ˜¾å¼å¯¼å…¥&lt;/strong&gt;çš„æ–¹å¼ï¼Œå®ƒä¸ä¾èµ–äºåŒ…æ‰«æã€‚è¿™å¯¹äºå¼•å…¥é‚£äº›ä¸åœ¨ &lt;code&gt;@ComponentScan&lt;/code&gt;æŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„ç±»éå¸¸æœ‰ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Import&lt;/code&gt;æ³¨è§£æ˜¯ Spring æ¡†æ¶ä¸­å®ç°&lt;strong&gt;æ¨¡å—åŒ–ã€æ¡ä»¶åŒ–å’Œå¯æ‰©å±•é…ç½®&lt;/strong&gt;çš„å¼ºå¤§å·¥å…·ã€‚ä»ç®€å•çš„ç»„åˆé…ç½®ï¼Œåˆ°æ”¯æ’‘èµ· Spring Boot åºå¤§çš„è‡ªåŠ¨é…ç½®ç”Ÿæ€ï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚ç†è§£å¹¶ç†Ÿç»ƒè¿ç”¨å®ƒçš„å››ç§ç”¨æ³•ï¼Œå°†å¸®åŠ©ä½ æ„å»ºå‡ºæ›´æ¸…æ™°ã€æ›´çµæ´»ã€æ›´æ˜“äºç»´æŠ¤çš„ Spring åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ å…¨é¢æŒæ¡ &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£ï¼&lt;/p&gt;
&lt;h2 id="importselector"&gt;ImportSelector
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶ä¸­çš„ &lt;code&gt;ImportSelector&lt;/code&gt;æ¥å£æ˜¯ä¸€ä¸ªç”¨äº&lt;strong&gt;åŠ¨æ€é€‰æ‹©å’Œç»„ç»‡é…ç½®ç±»&lt;/strong&gt;çš„æ ¸å¿ƒæ‰©å±•ç‚¹ï¼Œå®ƒèƒ½è®©ä½ æ ¹æ®ç‰¹å®šæ¡ä»¶ï¼ˆå¦‚æ³¨è§£å±æ€§ã€ç³»ç»Ÿç¯å¢ƒç­‰ï¼‰åœ¨è¿è¡Œæ—¶çµæ´»å†³å®šå‘ Spring å®¹å™¨ä¸­æ³¨å†Œå“ªäº›ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼"&gt;ğŸ¯ æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;ImportSelector&lt;/code&gt;è§£å†³äº† Spring é…ç½®ä¸­â€œ&lt;strong&gt;é™æ€&lt;/strong&gt;â€å£°æ˜çš„é™åˆ¶ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥å®ç°é…ç½®çš„&lt;strong&gt;åŠ¨æ€åŒ–&lt;/strong&gt;å’Œ&lt;strong&gt;æ¡ä»¶åŒ–&lt;/strong&gt;ï¼Œè¿™æ˜¯è®¸å¤šé«˜çº§ç‰¹æ€§ï¼ˆå¦‚ Spring Boot çš„è‡ªåŠ¨é…ç½®ï¼‰çš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„è¡¨æ ¼å¯¹æ¯”äº†ä½¿ç”¨æ™®é€š &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£å’Œä½¿ç”¨ &lt;code&gt;ImportSelector&lt;/code&gt;çš„å…³é”®åŒºåˆ«ï¼Œå¸®åŠ©ä½ ç›´è§‚ç†è§£å…¶ä»·å€¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;æ™®é€š &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ImportSelector&lt;/code&gt;æ¥å£&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é™æ€ï¼Œåœ¨ç¼–è¯‘æ—¶ç¡®å®š&lt;/td&gt;
&lt;td&gt;åŠ¨æ€ï¼Œåœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶ç¡®å®š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šï¼Œæ— æ³•æ ¹æ®æ¡ä»¶å˜åŒ–&lt;/td&gt;
&lt;td&gt;é«˜ï¼Œå¯æ ¹æ®æ³¨è§£å…ƒæ•°æ®ã€ç¯å¢ƒå˜é‡ç­‰çµæ´»é€‰æ‹©&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥å¯¼å…¥å·²çŸ¥çš„é…ç½®ç±»&lt;/td&gt;
&lt;td&gt;æ¨¡å—åŒ–è£…é…ã€æ¡ä»¶åŒ–é…ç½®ã€è‡ªåŠ¨é…ç½®ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆç›´æ¥åœ¨æ³¨è§£ä¸­å£°æ˜ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;selectImports(AnnotationMetadata)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸ä½¿ç”¨æ–¹æ³•"&gt;ğŸ”§ æ ¸å¿ƒæœºåˆ¶ä¸ä½¿ç”¨æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ImportSelector&lt;/code&gt;æ¥å£çš„æ ¸å¿ƒåœ¨äºå…¶å®šä¹‰çš„ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface ImportSelector {
String[] selectImports(AnnotationMetadata importingClassMetadata);
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;AnnotationMetadata importingClassMetadata&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™ä¸ªå‚æ•°éå¸¸å…³é”®ï¼Œå®ƒèƒ½è®©ä½ è·å–åˆ°&lt;strong&gt;æ ‡æ³¨äº† &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£çš„é‚£ä¸ªç±»çš„æ‰€æœ‰æ³¨è§£ä¿¡æ¯&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒè¯»å–è‡ªå®šä¹‰å¯ç”¨æ³¨è§£ä¸Šçš„å±æ€§å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼ &lt;code&gt;String[]&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªç”±&lt;strong&gt;éœ€è¦å¯¼å…¥åˆ° Spring å®¹å™¨ä¸­çš„é…ç½®ç±»çš„å…¨é™å®šå&lt;/strong&gt;ç»„æˆçš„æ•°ç»„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ¥å£&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç° &lt;code&gt;ImportSelector&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼–å†™é€‰æ‹©é€»è¾‘&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•ä¸­ç¼–å†™ä½ çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ ¹æ®æ¡ä»¶è¿”å›ä¸åŒçš„é…ç½®ç±»å…¨åã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;@Import&lt;/code&gt;å¼•å…¥&lt;/strong&gt;ï¼šåœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£ï¼Œå…¶å€¼å°±æ˜¯ä½ å®ç°çš„ &lt;code&gt;ImportSelector&lt;/code&gt;ç±»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-3"&gt;ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ImportSelector&lt;/code&gt;çš„å¼ºå¤§ä¹‹å¤„ä½“ç°åœ¨å¤šç§åœºæ™¯ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºäºç¯å¢ƒçš„æ¡ä»¶é…ç½®&lt;/strong&gt;ï¼šæ ¹æ®ä¸åŒçš„ç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€ç”Ÿäº§ï¼‰è‡ªåŠ¨åŠ è½½ä¸åŒçš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®ç³»ç»Ÿå±æ€§æˆ–é…ç½®æ–‡ä»¶å†³å®šä½¿ç”¨å“ªç§æ•°æ®æºé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—åŒ–åŠŸèƒ½å¼€å…³&lt;/strong&gt;ï¼šç»“åˆè‡ªå®šä¹‰çš„ &lt;code&gt;@EnableXXX&lt;/code&gt;æ³¨è§£ï¼Œå®ç°åŠŸèƒ½çš„æŒ‰éœ€å¼€å¯ã€‚æ³¨è§£ä¸­çš„å±æ€§ï¼ˆå¦‚ &lt;code&gt;@EnableModule(cache = true)&lt;/code&gt;ï¼‰å¯ä»¥è¢« &lt;code&gt;ImportSelector&lt;/code&gt;è¯»å–ï¼Œä»è€Œå†³å®šæ˜¯å¦å¯¼å…¥ç¼“å­˜æ¨¡å—çš„é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Boot è‡ªåŠ¨é…ç½®&lt;/strong&gt;ï¼šè¿™æ˜¯ &lt;code&gt;ImportSelector&lt;/code&gt;æœ€è‘—åçš„åº”ç”¨ã€‚Spring Boot çš„ &lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;æ³¨è§£èƒŒåä½¿ç”¨çš„æ˜¯ &lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt;ï¼Œå®ƒä» &lt;code&gt;spring.factories&lt;/code&gt;æ–‡ä»¶ä¸­è¯»å–å¤§é‡è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶æ ¹æ®æ¡ä»¶ï¼ˆå¦‚ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼‰æœ€ç»ˆç­›é€‰å‡ºéœ€è¦ç”Ÿæ•ˆçš„é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-è¿›é˜¶ç”¨æ³•"&gt;âš™ï¸ è¿›é˜¶ç”¨æ³•
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å»¶è¿Ÿå¯¼å…¥ï¼š&lt;code&gt;DeferredImportSelector&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ &lt;code&gt;ImportSelector&lt;/code&gt;çš„ä¸€ä¸ªå­æ¥å£ã€‚å®ç°å®ƒå¯ä»¥å°†é…ç½®ç±»çš„å¯¼å…¥å†³ç­–&lt;strong&gt;æ¨è¿Ÿåˆ°æ‰€æœ‰å…¶ä»– &lt;code&gt;@Configuration&lt;/code&gt;ç±»éƒ½è¢«å¤„ç†ä¹‹åå†è¿›è¡Œ&lt;/strong&gt;ã€‚è¿™å¯¹äºå¤„ç†é…ç½®ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»æˆ–ç¡®ä¿æŸäº›è‡ªåŠ¨é…ç½®åœ¨ç‰¹å®šé¡ºåºä¸‹æ‰§è¡Œéå¸¸æœ‰ç”¨ï¼ŒSpring Boot çš„è‡ªåŠ¨é…ç½®å°±ä¾èµ–äºæ­¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·å–å®¹å™¨ä¿¡æ¯ï¼šå®ç° &lt;code&gt;Aware&lt;/code&gt;æ¥å£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„ &lt;code&gt;ImportSelector&lt;/code&gt;å®ç°ç±»è¿˜éœ€è¦æ„ŸçŸ¥ Spring å®¹å™¨çš„ç¯å¢ƒï¼ˆ&lt;code&gt;Environment&lt;/code&gt;ï¼‰ã€èµ„æºåŠ è½½å™¨ï¼ˆ&lt;code&gt;ResourceLoader&lt;/code&gt;ï¼‰ç­‰ä¿¡æ¯ï¼Œå¯ä»¥åŒæ—¶å®ç°ç›¸åº”çš„ &lt;code&gt;Aware&lt;/code&gt;æ¥å£ï¼ˆå¦‚ &lt;code&gt;EnvironmentAware&lt;/code&gt;ã€&lt;code&gt;ResourceLoaderAware&lt;/code&gt;ï¼‰ã€‚Spring ä¼šåœ¨è°ƒç”¨ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•ä¹‹å‰ï¼Œå…ˆè°ƒç”¨è¿™äº› &lt;code&gt;Aware&lt;/code&gt;æ¥å£çš„æ–¹æ³•ï¼Œå°†æ‰€éœ€èµ„æºæ³¨å…¥ç»™ä½ çš„ç±»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ç®€å•ä»£ç ç¤ºä¾‹"&gt;ğŸ“ ç®€å•ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¨¡æ‹ŸåŠŸèƒ½å¼€å…³çš„ç®€å•ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰åŠŸèƒ½å¼€å…³æ³¨è§£&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Import(MyFeatureSelector.class) // å…³è”ä¸‹é¢çš„Selector
public @interface EnableMyFeature {
boolean cacheEnabled() default false;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç° ImportSelector&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class MyFeatureSelector implements ImportSelector {
@Override
public String[] selectImports(AnnotationMetadata importingClassMetadata) {
// è·å–å¯ç”¨æ³¨è§£çš„å±æ€§
Map&amp;lt;String, Object&amp;gt; attrs = importingClassMetadata
.getAnnotationAttributes(EnableMyFeature.class.getName());
boolean cacheEnabled = (Boolean) attrs.get(&amp;#34;cacheEnabled&amp;#34;);
if (cacheEnabled) {
return new String[]{&amp;#34;com.example.CacheConfig&amp;#34;};
}
return new String[0]; // è¿”å›ç©ºæ•°ç»„ï¼Œè¡¨ç¤ºä¸å¯¼å…¥ä»»ä½•é¢å¤–é…ç½®
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@EnableMyFeature(cacheEnabled = true) // å¼€å¯ç¼“å­˜åŠŸèƒ½
public class AppConfig {
// ... å…¶ä»–é…ç½®
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“ä¸æœ€ä½³å®è·µ"&gt;ğŸ’ æ€»ç»“ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ImportSelector&lt;/code&gt;æ˜¯ Spring æ¡†æ¶ä¸­å®ç°&lt;strong&gt;çµæ´»é…ç½®å’Œæ¨¡å—åŒ–é©±åŠ¨&lt;/strong&gt;çš„å…³é”®ã€‚å½“ä½ çš„åº”ç”¨éœ€è¦æ ¹æ®è¿è¡Œæ—¶æ¡ä»¶åŠ¨æ€ç»„è£…ç»„ä»¶ï¼Œæˆ–è€…æ­£åœ¨è®¾è®¡ä¸€ä¸ªéœ€è¦è¢«å…¶ä»–åº”ç”¨é›†æˆçš„åŠŸèƒ½æ¨¡å—æˆ– Starter æ—¶ï¼Œ&lt;code&gt;ImportSelector&lt;/code&gt;æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨æ—¶ï¼Œæœ‰å‡ ç‚¹æœ€ä½³å®è·µå€¼å¾—æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿æŒ &lt;code&gt;selectImports&lt;/code&gt;æ–¹æ³•å†…çš„é€»è¾‘&lt;strong&gt;è½»é‡ä¸”é«˜æ•ˆ&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒç›´æ¥å½±å“åº”ç”¨å¯åŠ¨æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥ç»“åˆ &lt;code&gt;@Conditional&lt;/code&gt;ç³»åˆ—æ³¨è§£è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ¡ä»¶æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;å……åˆ†ç†è§£å’Œåˆ©ç”¨ &lt;code&gt;AnnotationMetadata&lt;/code&gt;å‚æ•°ï¼Œå®ƒæä¾›äº†å†³ç­–æ‰€éœ€çš„å…³é”®ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£ Spring ä¸­çš„ &lt;code&gt;ImportSelector&lt;/code&gt;ã€‚å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“çš„åº”ç”¨åœºæ™¯æˆ–å®ç°ç»†èŠ‚æœ‰è¿›ä¸€æ­¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="importbeandefinitionregistrar"&gt;ImportBeanDefinitionRegistrar
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ‰©å±•æ¥å£ï¼Œå®ƒå…è®¸ä½ åœ¨ Spring å®¹å™¨åˆå§‹åŒ–æ—¶ï¼Œ&lt;strong&gt;ä»¥ç¼–ç¨‹æ–¹å¼åŠ¨æ€åœ°å‘å®¹å™¨ä¸­æ³¨å†Œ Bean å®šä¹‰&lt;/strong&gt;ã€‚è¿™ä¸ºéœ€è¦ç²¾ç»†æ§åˆ¶ Bean æ³¨å†Œæµç¨‹çš„åœºæ™¯æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œæ˜¯æ„å»ºå¯æ‰©å±•æ¡†æ¶å’Œæ’ä»¶åŒ–ç³»ç»Ÿçš„åˆ©å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¨å±€ï¼Œä¸‹è¡¨å¯¹æ¯”äº† &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;ä¸å…¶ä»–å‡ ç§å¸¸è§çš„ Bean æ³¨å†Œæ–¹å¼çš„æ ¸å¿ƒå·®å¼‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Component&lt;/code&gt;ç­‰æ³¨è§£&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ImportSelector&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜å¼&lt;/td&gt;
&lt;td&gt;å£°æ˜å¼&lt;/td&gt;
&lt;td&gt;åŠ¨æ€é€‰æ‹©ç±»å&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç¼–ç¨‹å¼ã€åŠ¨æ€&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶ç²’åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«&lt;/td&gt;
&lt;td&gt;æ–¹æ³•çº§åˆ«&lt;/td&gt;
&lt;td&gt;ç±»åæ•°ç»„çº§åˆ«&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;BeanDefinition çº§åˆ«ï¼ˆå¯è®¾ç½®å±æ€§ã€æ„é€ å‚æ•°ç­‰ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®š&lt;/td&gt;
&lt;td&gt;å›ºå®š&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼Œå¯æ¡ä»¶åŒ–è¿”å›ç±»å&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æœ€é«˜ï¼Œå¯åŸºäºå¤æ‚æ¡ä»¶é€»è¾‘æ³¨å†Œ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨å†Œè‡ªå®šä¹‰ä¸šåŠ¡ç»„ä»¶&lt;/td&gt;
&lt;td&gt;æ³¨å†Œç¬¬ä¸‰æ–¹åº“ç»„ä»¶&lt;/td&gt;
&lt;td&gt;Spring Boot è‡ªåŠ¨é…ç½®&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¡†æ¶é›†æˆã€æ’ä»¶ç³»ç»Ÿã€åŠ¨æ€æ•°æ®æº&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸ä½¿ç”¨æ–¹æ³•-1"&gt;ğŸ”§ æ ¸å¿ƒæœºåˆ¶ä¸ä½¿ç”¨æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ¥å£çš„æ ¸å¿ƒæ˜¯ &lt;code&gt;registerBeanDefinitions&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface ImportBeanDefinitionRegistrar {
void registerBeanDefinitions(AnnotationMetadata importingClassMetadata,
BeanDefinitionRegistry registry);
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;AnnotationMetadata importingClassMetadata&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™ä¸ªå‚æ•°æä¾›äº†&lt;strong&gt;å¯¼å…¥è¯¥ Registrar çš„é…ç½®ç±»ï¼ˆå³ä½¿ç”¨äº† &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£çš„ç±»ï¼‰çš„æ‰€æœ‰æ³¨è§£å…ƒæ•°æ®&lt;/strong&gt;ã€‚ä½ å¯ä»¥åˆ©ç”¨å®ƒæ¥è¯»å–é…ç½®ç±»ä¸Šçš„æ³¨è§£å±æ€§ï¼Œä»è€Œå®ç°é«˜åº¦å¯é…ç½®çš„åŠ¨æ€æ³¨å†Œé€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;BeanDefinitionRegistry registry&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯ &lt;strong&gt;Spring å®¹å™¨ä¸­ Bean å®šä¹‰çš„æ³¨å†Œä¸­å¿ƒ&lt;/strong&gt;ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥æ‰§è¡Œ &lt;code&gt;registerBeanDefinition&lt;/code&gt;æ¥æ³¨å†Œæ–°çš„ Beanï¼Œæˆ–è€…æŸ¥è¯¢å®¹å™¨ä¸­å·²å­˜åœ¨çš„ Bean å®šä¹‰ï¼ˆ&lt;code&gt;containsBeanDefinition&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä½¿ç”¨æ–¹å¼å›ºå®šä¸”ç®€å•ï¼Œé€šå¸¸åªéœ€ä¸‰æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ¥å£&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»å®ç° &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼–å†™æ³¨å†Œé€»è¾‘&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;registerBeanDefinitions&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;æ¥æ³¨å†Œä½ çš„ Bean å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;@Import&lt;/code&gt;å¼•å…¥&lt;/strong&gt;ï¼šåœ¨ä¸€ä¸ªé…ç½®ç±»ï¼ˆæ ‡æ³¨äº† &lt;code&gt;@Configuration&lt;/code&gt;çš„ç±»ï¼‰ä¸Šä½¿ç”¨ &lt;code&gt;@Import&lt;/code&gt;æ³¨è§£ï¼Œå°†ä½ å®ç°çš„ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;ç±»å¯¼å…¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-4"&gt;ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒèƒ½å¤Ÿåº”å¯¹å„ç§å¤æ‚çš„ã€éœ€è¦åŠ¨æ€æ§åˆ¶çš„æ³¨å†Œåœºæ™¯ã€‚&lt;/p&gt;
&lt;h4 id="1-æ¡ä»¶åŒ–-bean-æ³¨å†Œ"&gt;1. æ¡ä»¶åŒ– Bean æ³¨å†Œ
&lt;/h4&gt;&lt;p&gt;æ ¹æ®æŸäº›ç‰¹å®šæ¡ä»¶ï¼ˆå¦‚æŸä¸ªç±»æ˜¯å¦å­˜åœ¨ã€æŸä¸ª Bean æ˜¯å¦å·²å®šä¹‰ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰æ¥å†³å®šæ˜¯å¦æ³¨å†ŒæŸä¸ª Beanã€‚è¿™åœ¨æ¨¡å—åŒ–å¼€å‘å’Œæ¡†æ¶é›†æˆä¸­éå¸¸å¸¸è§ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Override
public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
// æ£€æŸ¥å®¹å™¨ä¸­æ˜¯å¦å·²å­˜åœ¨æŸä¸ªå…³é”®çš„ Bean æˆ–ç±»
boolean conditionMet = registry.containsBeanDefinition(&amp;#34;someRequiredBean&amp;#34;) ||
ClassUtils.isPresent(&amp;#34;some.RequiredClass&amp;#34;, null);
if (conditionMet) {
RootBeanDefinition beanDefinition = new RootBeanDefinition(MyConditionalBean.class);
registry.registerBeanDefinition(&amp;#34;myConditionalBean&amp;#34;, beanDefinition);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-æ³¨è§£é©±åŠ¨ä¸è‡ªåŠ¨æ‰«æ"&gt;2. æ³¨è§£é©±åŠ¨ä¸è‡ªåŠ¨æ‰«æ
&lt;/h4&gt;&lt;p&gt;ä½ å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@MyService&lt;/code&gt;ï¼‰ï¼Œç„¶åé€šè¿‡ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ‰«æç‰¹å®šçš„åŒ…è·¯å¾„ï¼Œå°†æ‰€æœ‰æ ‡æ³¨äº†è¯¥æ³¨è§£çš„ç±»è‡ªåŠ¨æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚è¿™ç§æ–¹å¼å¸¸ç”¨äºä¸ºè‡ªå®šä¹‰æ¡†æ¶æˆ– Starter æä¾›è‡ªåŠ¨é…ç½®èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// è‡ªå®šä¹‰æ³¨è§£
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface MyService {}
// åœ¨ Registrar ä¸­æ‰«æå¹¶æ³¨å†Œ
@Override
public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(registry, false);
// æ·»åŠ åŒ…å«è¿‡æ»¤å™¨ï¼ŒåªåŒ…å«å¸¦æœ‰ @MyService æ³¨è§£çš„ç±»
scanner.addIncludeFilter(new AnnotationTypeFilter(MyService.class));
// æ‰«ææŒ‡å®šåŒ…
scanner.scan(&amp;#34;com.example.mypackage&amp;#34;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-é›†æˆç¬¬ä¸‰æ–¹æ¡†æ¶"&gt;3. é›†æˆç¬¬ä¸‰æ–¹æ¡†æ¶
&lt;/h4&gt;&lt;p&gt;è®¸å¤šè‘—åçš„æ¡†æ¶ï¼Œå¦‚ Spring Cloud Feignã€MyBatis-Spring ç­‰ï¼Œéƒ½åˆ©ç”¨ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ¥å°†é Spring ç®¡ç†çš„ç»„ä»¶ï¼ˆå¦‚ Feign å®¢æˆ·ç«¯æ¥å£ã€MyBatis Mapper æ¥å£ï¼‰åŠ¨æ€åœ°ç”Ÿæˆä»£ç† Bean å¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ï¼Œä»è€Œå®ç°æ— ç¼é›†æˆã€‚&lt;/p&gt;
&lt;h3 id="-è¿›é˜¶ç”¨æ³•ä¸æœ€ä½³å®è·µ"&gt;âš™ï¸ è¿›é˜¶ç”¨æ³•ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="å®ç°-awareæ¥å£è·å–æ›´å¤šä¸Šä¸‹æ–‡"&gt;å®ç° &lt;code&gt;Aware&lt;/code&gt;æ¥å£è·å–æ›´å¤šä¸Šä¸‹æ–‡
&lt;/h4&gt;&lt;p&gt;ä¸ºäº†è®©ä½ çš„ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;å®ç°æ›´å¼ºå¤§ï¼Œä½ å¯ä»¥è®©å®ƒå®ç°ä¸€äº› &lt;code&gt;Aware&lt;/code&gt;æ¥å£ï¼ˆå¦‚ &lt;code&gt;EnvironmentAware&lt;/code&gt;ã€&lt;code&gt;ResourceLoaderAware&lt;/code&gt;ï¼‰ï¼Œä»è€Œè·å– Spring å®¹å™¨çš„ç¯å¢ƒä¿¡æ¯ã€èµ„æºåŠ è½½å™¨ç­‰ï¼Œä½¿ä½ çš„æ³¨å†Œé€»è¾‘æ›´åŠ æ™ºèƒ½ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class AdvancedRegistrar implements ImportBeanDefinitionRegistrar, EnvironmentAware {
private Environment environment;
@Override
public void setEnvironment(Environment environment) {
this.environment = environment; // è·å–ç¯å¢ƒä¿¡æ¯ï¼Œå¦‚é…ç½®å±æ€§
}
@Override
public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
// å¯ä»¥ä½¿ç”¨ environment ä¸­çš„å±æ€§æ¥å½±å“æ³¨å†Œé€»è¾‘
String someProperty = environment.getProperty(&amp;#34;my.config.property&amp;#34;);
// ... åŸºäºå±æ€§çš„åŠ¨æ€æ³¨å†Œé€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ç²¾ç»†æ§åˆ¶-bean-å®šä¹‰"&gt;ç²¾ç»†æ§åˆ¶ Bean å®šä¹‰
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;GenericBeanDefinition&lt;/code&gt;ã€&lt;code&gt;RootBeanDefinition&lt;/code&gt;ç­‰ï¼Œä½ å¯ä»¥å¯¹è¦æ³¨å†Œçš„ Bean è¿›è¡Œéå¸¸ç²¾ç»†çš„æ§åˆ¶ï¼Œä¾‹å¦‚è®¾ç½®ä½œç”¨åŸŸã€æ‡’åŠ è½½ã€åˆå§‹åŒ–æ–¹æ³•ã€æ„é€ å™¨å‚æ•°ã€å±æ€§å€¼ç­‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Override
public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
GenericBeanDefinition beanDefinition = new GenericBeanDefinition();
beanDefinition.setBeanClass(MyComplexBean.class);
beanDefinition.setScope(BeanDefinition.SCOPE_SINGLETON);
beanDefinition.setLazyInit(true);
// è®¾ç½®æ„é€ å™¨å‚æ•°
ConstructorArgumentValues cav = new ConstructorArgumentValues();
cav.addIndexedArgumentValue(0, &amp;#34;constructorArg1&amp;#34;);
beanDefinition.setConstructorArgumentValues(cav);
// è®¾ç½®å±æ€§å€¼
MutablePropertyValues pvs = new MutablePropertyValues();
pvs.add(&amp;#34;propertyName&amp;#34;, &amp;#34;propertyValue&amp;#34;);
beanDefinition.setPropertyValues(pvs);
registry.registerBeanDefinition(&amp;#34;myComplexBean&amp;#34;, beanDefinition);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„äº‹é¡¹-5"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œæ—¶æœº&lt;/strong&gt;ï¼š&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;çš„æ‰§è¡Œæ˜¯åœ¨ Spring å®¹å™¨è§£æé…ç½®ç±»çš„æ—©æœŸé˜¶æ®µã€‚æ­¤æ—¶ï¼Œå®¹å™¨ä¸­å¤§éƒ¨åˆ†çš„ Bean å®šä¹‰å¯èƒ½è¿˜æœªè¢«åˆ›å»ºæˆ Bean å®ä¾‹ï¼Œä½†ä½ &lt;strong&gt;å¯ä»¥æŸ¥è¯¢åˆ°å…¶ä»– &lt;code&gt;BeanDefinition&lt;/code&gt;æ˜¯å¦å­˜åœ¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦ä½¿ç”¨&lt;/strong&gt;ï¼šè™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†åº”&lt;strong&gt;é¿å…åœ¨æ‰€æœ‰åœºæ™¯ä¸‹æ»¥ç”¨&lt;/strong&gt;ã€‚å¯¹äºç®€å•çš„é™æ€ Bean æ³¨å†Œï¼Œä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;æˆ– &lt;code&gt;@Component&lt;/code&gt;ç­‰æ³¨è§£é€šå¸¸æ›´ç®€æ´æ˜äº†ã€‚åªæœ‰åœ¨çœŸæ­£éœ€è¦åŠ¨æ€é€»è¾‘æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;ï¼Œä»¥ä¿æŒä»£ç çš„ç®€æ´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è§£åº•å±‚åŸç†&lt;/strong&gt;ï¼šæ·±å…¥ä½¿ç”¨ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;éœ€è¦å¯¹ Spring çš„ &lt;code&gt;BeanDefinition&lt;/code&gt;ä½“ç³»æœ‰è¾ƒå¥½çš„ç†è§£ï¼Œå› ä¸ºè¿™æœ¬è´¨ä¸Šæ˜¯ç›´æ¥åœ¨æ“ä½œå®¹å™¨æœ€æ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-8"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªåº•å±‚ä¸”å¼ºå¤§çš„æ‰©å±•ç‚¹ï¼Œå®ƒå°† Bean æ³¨å†Œçš„æ§åˆ¶æƒå®Œå…¨äº¤ç»™äº†å¼€å‘è€…ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥å®ç°ä»ç®€å•çš„æ¡ä»¶æ³¨å†Œåˆ°å¤æ‚çš„æ¡†æ¶é›†æˆç­‰å„ç§é«˜çº§åŠŸèƒ½ã€‚ç†è§£å¹¶æ°å½“è¿ç”¨å®ƒï¼Œå°†æå¤§æå‡ä½ åº”å¯¹å¤æ‚ Spring åº”ç”¨æ¶æ„çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ æŒæ¡ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;çš„ç²¾é«“ï¼å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“çš„åº”ç”¨åœºæ™¯æˆ–å®ç°ç»†èŠ‚æœ‰è¿›ä¸€æ­¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="beandefinitionregistry"&gt;BeanDefinitionRegistry
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;æ˜¯ Spring IoC å®¹å™¨çš„æ ¸å¿ƒæ¥å£ä¹‹ä¸€ï¼Œä½ å¯ä»¥å°†å®ƒç†è§£æˆ &lt;strong&gt;Spring å®¹å™¨ä¸­ä¸“é—¨ç®¡ç† Bean å®šä¹‰ï¼ˆ&lt;code&gt;BeanDefinition&lt;/code&gt;ï¼‰çš„â€œæˆ·ç±ç®¡ç†ä¸­å¿ƒâ€&lt;/strong&gt;ã€‚å®ƒè´Ÿè´£æ³¨å†Œã€å­˜å‚¨å’Œç®¡ç†æ‰€æœ‰ Bean çš„é…ç½®å…ƒæ•°æ®ï¼Œæ˜¯ Spring æ¡†æ¶å®ç°æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº† &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å…±åŒæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„ Bean å®šä¹‰ç”Ÿå‘½å‘¨æœŸç®¡ç†ä½“ç³»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/th&gt;
&lt;th&gt;å¯¹åº”æ–¹æ³•&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨å†Œ Bean å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;registerBeanDefinition(String beanName, BeanDefinition beanDefinition)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°† Bean çš„é…ç½®å…ƒæ•°æ®ï¼ˆ&lt;code&gt;BeanDefinition&lt;/code&gt;ï¼‰æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç§»é™¤ Bean å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;removeBeanDefinition(String beanName)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä»å®¹å™¨ä¸­ç§»é™¤æŒ‡å®šåç§°çš„ Bean å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥è¯¢ Bean å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;getBeanDefinition(String beanName)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ¹æ®åç§°è·å–å¯¹åº”çš„ Bean å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ£€æŸ¥æ˜¯å¦å­˜åœ¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;containsBeanDefinition(String beanName)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆ¤æ–­å®¹å™¨ä¸­æ˜¯å¦å·²åŒ…å«æŒ‡å®šåç§°çš„ Bean å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·å–æ‰€æœ‰åç§°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;getBeanDefinitionNames()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿”å›å®¹å™¨ä¸­æ‰€æœ‰å·²æ³¨å†Œçš„ Bean å®šä¹‰åç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»Ÿè®¡æ•°é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;getBeanDefinitionCount()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿”å›å®¹å™¨ä¸­å·²æ³¨å†Œçš„ Bean å®šä¹‰æ€»æ•°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ£€æŸ¥åç§°æ˜¯å¦å ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;isBeanNameInUse(String beanName)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ£€æŸ¥ç»™å®šçš„åç§°æ˜¯å¦å·²è¢«æ³¨å†Œä¸º Bean å®šä¹‰æˆ–åˆ«åã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸å®ç°åŸç†"&gt;ğŸ”§ æ ¸å¿ƒæœºåˆ¶ä¸å®ç°åŸç†
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„å…·ä½“å®ç°å†³å®šäº†å…¶å†…éƒ¨è¿ä½œæœºåˆ¶ã€‚&lt;/p&gt;
&lt;h4 id="1-åº•å±‚æ•°æ®ç»“æ„"&gt;&lt;strong&gt;1. åº•å±‚æ•°æ®ç»“æ„&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æœ€å…³é”®çš„å®ç°ç±»æ˜¯ &lt;code&gt;DefaultListableBeanFactory&lt;/code&gt;ã€‚å…¶å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª &lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;&lt;/strong&gt; æ¥å­˜å‚¨ Bean å®šä¹‰ï¼Œé”®æ˜¯ Bean çš„åç§°ï¼ˆ&lt;code&gt;beanName&lt;/code&gt;ï¼‰ï¼Œå€¼å°±æ˜¯ &lt;code&gt;BeanDefinition&lt;/code&gt;å¯¹è±¡ã€‚è¿™ç§ç»“æ„ç¡®ä¿äº†é«˜æ•ˆçš„æŸ¥æ‰¾å’Œå­˜å‚¨ ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åœ¨ DefaultListableBeanFactory å†…éƒ¨
private final Map&amp;lt;String, BeanDefinition&amp;gt; beanDefinitionMap = new ConcurrentHashMap&amp;lt;&amp;gt;(256);
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-æ³¨å†Œæµç¨‹è¯¦è§£"&gt;&lt;strong&gt;2. æ³¨å†Œæµç¨‹è¯¦è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä»¥ &lt;code&gt;DefaultListableBeanFactory.registerBeanDefinition()&lt;/code&gt;æ–¹æ³•ä¸ºä¾‹ï¼Œæ³¨å†Œä¸€ä¸ª Bean å®šä¹‰å¹¶éç®€å•æ”¾å…¥ Mapï¼Œè¿˜åŒ…å«ä¸€ç³»åˆ—ä¸¥è°¨çš„æ­¥éª¤ ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœ‰æ•ˆæ€§æ ¡éªŒ&lt;/strong&gt;ï¼šæ£€æŸ¥ &lt;code&gt;beanName&lt;/code&gt;å’Œ &lt;code&gt;beanDefinition&lt;/code&gt;æ˜¯å¦ä¸ºç©ºï¼Œå¹¶å¯¹ &lt;code&gt;AbstractBeanDefinition&lt;/code&gt;è¿›è¡Œé¢å¤–çš„éªŒè¯ï¼ˆå¦‚æ ¡éªŒæ–¹æ³•è¦†ç›–&lt;code&gt;methodOverrides&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†è¦†ç›–æƒ…å†µ&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;beanName&lt;/code&gt;å·²å­˜åœ¨ï¼Œä¼šæ ¹æ®é…ç½®å†³å®šæ˜¯æŠ›å‡ºå¼‚å¸¸ï¼ˆä¸å…è®¸è¦†ç›–æ—¶ï¼‰è¿˜æ˜¯ç”¨æ–°å®šä¹‰è¦†ç›–æ—§å®šä¹‰ï¼ˆå…è®¸è¦†ç›–æ—¶ï¼‰ï¼Œå¹¶è®°å½•ç›¸åº”æ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹¶å‘å®‰å…¨å¤„ç†&lt;/strong&gt;ï¼šå¦‚æœ Bean çš„åˆ›å»ºè¿‡ç¨‹å·²ç»å¼€å§‹ï¼Œæ³¨å†Œæ“ä½œä¼šè¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼ˆåŠ é”ï¼‰ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°ç¼“å­˜&lt;/strong&gt;ï¼šå°†æ–°çš„ Bean å®šä¹‰æ”¾å…¥ &lt;code&gt;beanDefinitionMap&lt;/code&gt;ï¼Œå¹¶æ›´æ–°ç›¸å…³çš„è¾…åŠ©åˆ—è¡¨ï¼ˆå¦‚ &lt;code&gt;beanDefinitionNames&lt;/code&gt;ï¼‰ã€‚å¦‚æœå­˜åœ¨åŒåçš„å•ä¾‹ Beanï¼Œä¼šé‡ç½®ç›¸å…³ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="3-ä¸»è¦å®ç°ç±»"&gt;&lt;strong&gt;3. ä¸»è¦å®ç°ç±»&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Spring æä¾›äº†å‡ ä¸ªé‡è¦çš„å®ç°ç±»ï¼Œç”¨äºä¸åŒåœºæ™¯ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;DefaultListableBeanFactory&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;strong&gt;æœ€æ ¸å¿ƒã€æœ€å¸¸ç”¨çš„å®ç°&lt;/strong&gt;ã€‚å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€åŠŸèƒ½å®Œæ•´çš„ Bean å·¥å‚ï¼ŒåŒæ—¶å®ç°äº† &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;GenericApplicationContext&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚å®ƒå†…éƒ¨æŒæœ‰ä¸€ä¸ª &lt;code&gt;DefaultListableBeanFactory&lt;/code&gt;å®ä¾‹ï¼Œå¹¶å°†æ‰€æœ‰ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;æ¥å£çš„æ–¹æ³•è°ƒç”¨&lt;strong&gt;å§”æ‰˜&lt;/strong&gt;ç»™è¿™ä¸ªå†…éƒ¨å·¥å‚å»æ‰§è¡Œ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SimpleBeanDefinitionRegistry&lt;/code&gt;&lt;/strong&gt;ï¼šä¸€ä¸ªç®€å•çš„å®ç°ï¼Œä»…æä¾›æ³¨å†Œè¡¨åŠŸèƒ½ï¼Œä¸åŒ…å«å®Œæ•´çš„ Bean å·¥å‚èƒ½åŠ›ï¼Œé€šå¸¸ç”¨äºæµ‹è¯•æˆ–ç®€å•çš„é›†æˆåœºæ™¯ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-5"&gt;ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒæ”¯æŒ Spring çš„å¤šç§é«˜çº§ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h4 id="1-åŠ¨æ€æ³¨å†Œ-bean"&gt;&lt;strong&gt;1. åŠ¨æ€æ³¨å†Œ Bean&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯æœ€ç»å…¸çš„åº”ç”¨ã€‚ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶ç¼–ç¨‹å¼åœ°å‘ Spring å®¹å™¨ä¸­æ·»åŠ  Beanã€‚è¿™é€šå¸¸é€šè¿‡å®ç° &lt;strong&gt;&lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;&lt;/strong&gt; æ¥å£æ¥å®Œæˆï¼Œè¯¥æ¥å£çš„å›è°ƒæ–¹æ³•ä¼šä¼ å…¥ä¸€ä¸ª &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;å®ä¾‹ ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class MyDynamicRegistrar implements ImportBeanDefinitionRegistrar {
@Override
public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
// åŠ¨æ€åˆ›å»ºBeanå®šä¹‰
RootBeanDefinition beanDefinition = new RootBeanDefinition(MyService.class);
// æ ¹æ®æ¡ä»¶åˆ¤æ–­ï¼ŒåŠ¨æ€æ³¨å†ŒBean
if (someCondition) {
registry.registerBeanDefinition(&amp;#34;myService&amp;#34;, beanDefinition);
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ¡†æ¶é›†æˆï¼ˆå¦‚ MyBatis çš„ Mapper æ¥å£æ‰«æï¼‰ã€æ ¹æ®é…ç½®ä¿¡æ¯åŠ¨æ€å¼€å¯æŸäº›åŠŸèƒ½æ¨¡å—ã€‚&lt;/p&gt;
&lt;h4 id="2-ä¸"&gt;&lt;strong&gt;2. ä¸ &lt;code&gt;BeanDefinitionRegistryPostProcessor&lt;/code&gt;é›†æˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯ Spring å®¹å™¨æ‰©å±•çš„ä¸€ä¸ªå…³é”®æ¥å£ã€‚å®ƒå…è®¸åœ¨&lt;strong&gt;æ‰€æœ‰å¸¸è§„çš„ Bean å®šä¹‰è¢«åŠ è½½ä¹‹åã€ä½†å°šæœªå®ä¾‹åŒ–ä»»ä½• Bean ä¹‹å‰&lt;/strong&gt;ï¼Œå¯¹ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;è¿›è¡Œä¿®æ”¹ã€‚ä½ å¯ä»¥æ·»åŠ ã€ç§»é™¤ç”šè‡³ä¿®æ”¹å·²æœ‰çš„ Bean å®šä¹‰ ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class MyBeanDefinitionRegistryPostProcessor implements BeanDefinitionRegistryPostProcessor {
@Override
public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException {
// æ­¤æ—¶å¯ä»¥å¹²é¢„BeanDefinitionRegistry
if (registry.containsBeanDefinition(&amp;#34;someBean&amp;#34;)) {
// ä¾‹å¦‚ï¼Œç§»é™¤æŸä¸ªBeanå®šä¹‰
// registry.removeBeanDefinition(&amp;#34;someBean&amp;#34;);
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè‡ªåŠ¨åŒ–é…ç½®ï¼ˆSpring Boot çš„è‡ªåŠ¨é…ç½®æ ¸å¿ƒæœºåˆ¶ï¼‰ã€æ›¿æ¢æ‰å®¹å™¨ä¸­æŸä¸ªé»˜è®¤çš„ Bean å®šä¹‰ã€‚&lt;/p&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼šè™½ç„¶ &lt;code&gt;DefaultListableBeanFactory&lt;/code&gt;åœ¨å…³é”®æ“ä½œä¸Šä½¿ç”¨äº†å¹¶å‘å®¹å™¨å’ŒåŒæ­¥å—ï¼Œä½†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç›´æ¥æ“ä½œ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;ä»éœ€è°¨æ…ï¼Œå°¤å…¶æ˜¯åœ¨å®¹å™¨å¯åŠ¨é˜¶æ®µ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ç›´æ¥æ“ä½œ&lt;/strong&gt;ï¼šå¯¹äºå¤§å¤šæ•°å¸¸è§„åº”ç”¨å¼€å‘ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ Spring æä¾›çš„é«˜çº§æŠ½è±¡ï¼ˆå¦‚ &lt;code&gt;@Component&lt;/code&gt;, &lt;code&gt;@Bean&lt;/code&gt;, &lt;code&gt;@Configuration&lt;/code&gt;ï¼‰æ¥å£°æ˜ Beanï¼Œè€Œéç›´æ¥æ“ä½œ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;ã€‚ç›´æ¥æ“ä½œæ˜¯åº•å±‚ APIï¼Œä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´å®¹å™¨çŠ¶æ€æ··ä¹± ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è§£ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼šBean çš„æ³¨å†Œï¼ˆ&lt;code&gt;BeanDefinition&lt;/code&gt;é˜¶æ®µï¼‰å’Œå®ä¾‹åŒ–ï¼ˆè·å– Bean å¯¹è±¡é˜¶æ®µï¼‰æ˜¯åˆ†å¼€çš„ã€‚&lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;åªè´Ÿè´£å‰åŠéƒ¨åˆ†ï¼ŒBean çš„åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ç”± &lt;code&gt;BeanFactory&lt;/code&gt;å®Œæˆ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-9"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;æ˜¯ Spring IoC å®¹å™¨åº•å±‚è´Ÿè´£ç®¡ç† Bean å®šä¹‰çš„æ ¸å¿ƒ Registryã€‚å®ƒé€šè¿‡é«˜æ•ˆçš„ Map ç»“æ„å­˜å‚¨ Bean çš„å…ƒæ•°æ®ï¼Œæä¾›äº†å®Œæ•´çš„å¢åˆ æ”¹æŸ¥ APIï¼Œå¹¶æ”¯æŒé€šè¿‡ &lt;code&gt;ImportBeanDefinitionRegistrar&lt;/code&gt;å’Œ &lt;code&gt;BeanDefinitionRegistryPostProcessor&lt;/code&gt;ç­‰æœºåˆ¶å®ç°å¼ºå¤§çš„åŠ¨æ€æ‰©å±•èƒ½åŠ›ã€‚ç†è§£ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;ï¼Œæœ‰åŠ©äºä½ æ›´æ·±å…¥åœ°æŒæ¡ Spring å®¹å™¨çš„å·¥ä½œåŸç†å’Œæ‰©å±•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ é€å½»ç†è§£ &lt;code&gt;BeanDefinitionRegistry&lt;/code&gt;ï¼&lt;/p&gt;
&lt;h2 id="autoconfiguration"&gt;@AutoConfiguration
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼ŒSpring Boot ä¸­ç¡®å®å­˜åœ¨ &lt;code&gt;@AutoConfiguration&lt;/code&gt;æ³¨è§£ã€‚å®ƒæ˜¯ Spring Boot &lt;strong&gt;2.7 ç‰ˆæœ¬&lt;/strong&gt;å¼•å…¥çš„ä¸€ä¸ªæ ¸å¿ƒæ³¨è§£ï¼Œä¸“é—¨ç”¨äºæ ‡è®°&lt;strong&gt;è‡ªåŠ¨é…ç½®ç±»&lt;/strong&gt;ï¼Œæ˜¯ Spring Boot è‡ªåŠ¨åŒ–é…ç½®æœºåˆ¶çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡å…¶å…¨è²Œï¼Œä¸‹è¡¨å¯¹æ¯”äº† &lt;code&gt;@AutoConfiguration&lt;/code&gt;ä¸æ ‡å‡† &lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@AutoConfiguration&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Configuration&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼•å…¥ç‰ˆæœ¬/èƒŒæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Boot 2.7+ï¼Œä¸“ä¸ºè‡ªåŠ¨é…ç½®è®¾è®¡&lt;/td&gt;
&lt;td&gt;Spring Frameworkï¼Œç”¨äºé€šç”¨é…ç½®ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®&lt;/strong&gt;ï¼šä¸ºç¬¬ä¸‰æ–¹åº“æˆ–é€šç”¨åŠŸèƒ½æä¾›&amp;quot;å¼€ç®±å³ç”¨&amp;quot;çš„é»˜è®¤é…ç½®&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‰‹åŠ¨é…ç½®&lt;/strong&gt;ï¼šç”±å¼€å‘è€…æ˜¾å¼å®šä¹‰å’Œæ§åˆ¶çš„é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ è½½æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;æ–‡ä»¶æ³¨å†Œï¼Œç”± Spring Boot è‡ªåŠ¨å‘ç°å’ŒåŠ è½½&lt;/td&gt;
&lt;td&gt;é€šè¿‡ç»„ä»¶æ‰«æï¼ˆå¦‚&lt;code&gt;@ComponentScan&lt;/code&gt;ï¼‰æˆ–ä½¿ç”¨&lt;code&gt;@Import&lt;/code&gt;æ³¨è§£æ˜¾å¼å¯¼å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¡ä»¶åŒ–æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼ºçƒˆä¾èµ–&lt;/strong&gt;æ¡ä»¶æ³¨è§£ï¼ˆå¦‚&lt;code&gt;@ConditionalOnClass&lt;/code&gt;ï¼‰ï¼Œå®ç°&amp;quot;æŒ‰éœ€åŠ è½½&amp;quot;&lt;/td&gt;
&lt;td&gt;å¯ä»¥ç»“åˆæ¡ä»¶æ³¨è§£ä½¿ç”¨ï¼Œä½†éå¿…é¡»ï¼Œå¸¸ç”¨äºç¡®å®šæ€§é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼€å‘ &lt;strong&gt;Starter&lt;/strong&gt;ã€é›†æˆç¬¬ä¸‰æ–¹åº“ã€æä¾›é€šç”¨æ¨¡å—çš„é»˜è®¤é…ç½®&lt;/td&gt;
&lt;td&gt;å®šä¹‰åº”ç”¨ç‰¹å®šçš„ä¸šåŠ¡ Beanã€è¿›è¡Œå®šåˆ¶åŒ–é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒä»·å€¼ä¸å·¥ä½œåŸç†"&gt;ğŸ’¡ æ ¸å¿ƒä»·å€¼ä¸å·¥ä½œåŸç†
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@AutoConfiguration&lt;/code&gt;æ³¨è§£çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ç°äº† Spring Boot &lt;strong&gt;&amp;ldquo;çº¦å®šä¼˜äºé…ç½®&amp;rdquo;&lt;/strong&gt; çš„ç†å¿µã€‚å®ƒå…è®¸æ¡†æ¶æˆ–ç¬¬ä¸‰æ–¹åº“çš„å¼€å‘è€…é¢„å…ˆå®šä¹‰å¥½ä¸€å¥—é…ç½®é€»è¾‘ï¼Œå½“åº”ç”¨ç¨‹åºå¼•å…¥äº†ç‰¹å®šçš„ä¾èµ–ï¼ˆStarterï¼‰æ—¶ï¼ŒSpring Boot å°±èƒ½è‡ªåŠ¨æ¿€æ´»è¿™äº›é…ç½®ï¼Œä»è€Œå¤§å¹…å‡å°‘å¼€å‘è€…çš„æ‰‹åŠ¨é…ç½®å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;å…¶å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜é…ç½®ç±»&lt;/strong&gt;ï¼šå¼€å‘è€…ä½¿ç”¨ &lt;code&gt;@AutoConfiguration&lt;/code&gt;æ³¨è§£æ ‡è®°ä¸€ä¸ªç±»ï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;ç­‰æ–¹æ³•å®šä¹‰éœ€è¦è‡ªåŠ¨é…ç½®çš„ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œé…ç½®ç±»&lt;/strong&gt;ï¼šåœ¨è¯¥ç»„ä»¶ Jar åŒ…çš„ &lt;code&gt;META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;æ–‡ä»¶ä¸­ï¼Œå†™å…¥è¯¥è‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šåã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŠ è½½&lt;/strong&gt;ï¼šSpring Boot åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šæ‰«æç±»è·¯å¾„ä¸‹æ‰€æœ‰ Jar åŒ…ä¸­çš„ &lt;code&gt;AutoConfiguration.imports&lt;/code&gt;æ–‡ä»¶ï¼Œå¹¶åŠ è½½å…¶ä¸­å£°æ˜çš„è‡ªåŠ¨é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶åŒ–ç­›é€‰&lt;/strong&gt;ï¼šåœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒSpring Boot ä¼šæ£€æŸ¥è‡ªåŠ¨é…ç½®ç±»ä¸Šçš„&lt;strong&gt;æ¡ä»¶æ³¨è§£&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@ConditionalOnClass&lt;/code&gt;ï¼‰ï¼Œåªæœ‰æ»¡è¶³æ‰€æœ‰æ¡ä»¶çš„é…ç½®æ‰ä¼šæœ€ç»ˆç”Ÿæ•ˆï¼Œä»è€Œå°† Bean æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•ä½¿ç”¨-autoconfiguration"&gt;ğŸ› ï¸ å¦‚ä½•ä½¿ç”¨ &lt;code&gt;@AutoConfiguration&lt;/code&gt;
&lt;/h3&gt;&lt;h4 id="1-å®šä¹‰è‡ªåŠ¨é…ç½®ç±»"&gt;1. å®šä¹‰è‡ªåŠ¨é…ç½®ç±»
&lt;/h4&gt;&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„è‡ªåŠ¨é…ç½®ç±»å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒå¤§é‡ä½¿ç”¨äº†æ¡ä»¶æ³¨è§£æ¥ç¡®ä¿åªåœ¨åˆé€‚çš„ç¯å¢ƒä¸‹ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å¼•å…¥ç‰ˆæœ¬ï¼šSpring Boot 2.7+
package com.example.mystarter;
import org.springframework.boot.autoconfigure.AutoConfiguration;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.context.annotation.Bean;
@AutoConfiguration // æ ‡è®°æ­¤ä¸ºè‡ªåŠ¨é…ç½®ç±»
@ConditionalOnClass(MyService.class) // æ¡ä»¶1ï¼šç±»è·¯å¾„ä¸‹å­˜åœ¨ MyService ç±»
@ConditionalOnProperty(prefix = &amp;#34;my.starter&amp;#34;, name = &amp;#34;enabled&amp;#34;, havingValue = &amp;#34;true&amp;#34;, matchIfMissing = true) // æ¡ä»¶2ï¼šé…ç½®å±æ€§åŒ¹é…
public class MyStarterAutoConfiguration {
@Bean
@ConditionalOnMissingBean // å…³é”®æ³¨è§£ï¼šåªæœ‰å½“ç”¨æˆ·æ²¡æœ‰è‡ªå·±å®šä¹‰ MyService ç±»å‹çš„ Bean æ—¶ï¼Œæ‰æ³¨å…¥æ­¤é»˜è®¤ Bean
public MyService myService() {
return new DefaultMyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-æ³¨å†Œé…ç½®ç±»"&gt;2. æ³¨å†Œé…ç½®ç±»
&lt;/h4&gt;&lt;p&gt;åœ¨é¡¹ç›®çš„ &lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶è·¯å¾„&lt;/strong&gt;ï¼š&lt;code&gt;META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶å†…å®¹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;com.example.mystarter.MyStarterAutoConfiguration
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®Œæˆä»¥ä¸Šä¸¤æ­¥å¹¶æ‰“åŒ…åï¼Œå…¶ä»–é¡¹ç›®åªéœ€å¼•å…¥è¿™ä¸ª Jar åŒ…ä¾èµ–ï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨å®Œæˆ &lt;code&gt;MyService&lt;/code&gt;Bean çš„é…ç½®ï¼ˆå¦‚æœæ»¡è¶³æ¡ä»¶çš„è¯ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-6"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ä¸ &lt;code&gt;@ComponentScan&lt;/code&gt;å†²çª&lt;/strong&gt;ï¼šè‡ªåŠ¨é…ç½®ç±»&lt;strong&gt;ä¸åº”è¯¥&lt;/strong&gt;è¢« &lt;code&gt;@ComponentScan&lt;/code&gt;æ‰«æåˆ°ã€‚æœ€å¥½å°†å®ƒä»¬æ”¾åœ¨ç‹¬ç«‹çš„åŒ…ä¸­ï¼Œä¸ä¸ä¸»åº”ç”¨çš„æ ¹åŒ…é‡å ï¼Œä»¥é˜²æ­¢è¢«æ„å¤–æ‰«æå’Œé‡å¤åŠ è½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;çš„é‡è¦æ€§&lt;/strong&gt;ï¼šåœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­å®šä¹‰ Bean æ—¶ï¼Œé€šå¸¸å»ºè®®åŠ ä¸Š &lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;æ³¨è§£ã€‚è¿™ç¡®ä¿äº†å¦‚æœåº”ç”¨å¼€å‘è€…å·²ç»è‡ªå®šä¹‰äº†è¯¥ç±»å‹çš„ Beanï¼Œåˆ™è‡ªåŠ¨é…ç½®æä¾›çš„é»˜è®¤ Bean ä¸ä¼šç”Ÿæ•ˆï¼Œä»è€Œ&lt;strong&gt;é¿å…å†²çªå¹¶å°Šé‡ç”¨æˆ·çš„è‡ªå®šä¹‰é…ç½®&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ è½½é¡ºåºæ§åˆ¶&lt;/strong&gt;ï¼š&lt;code&gt;@AutoConfiguration&lt;/code&gt;æ³¨è§£æä¾›äº† &lt;code&gt;before&lt;/code&gt;, &lt;code&gt;after&lt;/code&gt;, &lt;code&gt;beforeName&lt;/code&gt;, &lt;code&gt;afterName&lt;/code&gt;ç­‰å±æ€§ï¼Œå¯ä»¥ç”¨æ¥ç²¾ç»†æ§åˆ¶å¤šä¸ªè‡ªåŠ¨é…ç½®ç±»ä¹‹é—´çš„åŠ è½½é¡ºåºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-10"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œ&lt;code&gt;@AutoConfiguration&lt;/code&gt;æ³¨è§£æ˜¯ Spring Boot è‡ªåŠ¨åŒ–é…ç½®èƒ½åŠ›çš„æ ¸å¿ƒä½“ç°ã€‚å®ƒé€šè¿‡å£°æ˜å¼çš„æ³¨è§£å’Œçº¦å®šå¥½çš„æ–‡ä»¶æ³¨å†Œæœºåˆ¶ï¼Œè®©æ¡†æ¶å’Œåº“çš„é›†æˆå˜å¾—å¼‚å¸¸ç®€å•å’Œé«˜æ•ˆã€‚ç†è§£å¹¶æ­£ç¡®ä½¿ç”¨å®ƒï¼Œæ˜¯å¼€å‘å’Œå®šåˆ¶é«˜è´¨é‡ Spring Boot Starter çš„å…³é”®ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ &lt;code&gt;@AutoConfiguration&lt;/code&gt;æ³¨è§£ï¼&lt;/p&gt;
&lt;h2 id="request_new-å¹¶å‘é£é™©"&gt;REQUEST_NEW å¹¶å‘é£é™©
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸ºåœ¨å¹¶å‘ç¯å¢ƒä¸‹ç¡®å®ä¼šå¼•å…¥ä¸€äº›ç‰¹å®šçš„é£é™©ï¼Œç†è§£è¿™äº›é£é™©å¯¹äºè®¾è®¡é«˜å¹¶å‘ã€é«˜å¯é æ€§çš„ç³»ç»Ÿè‡³å…³é‡è¦ã€‚ä¸‹é¢è¿™ä¸ªæµç¨‹å›¾æ¦‚æ‹¬äº†ä¸»è¦çš„å¹¶å‘é£é™©åœºæ™¯åŠå…¶æˆå› ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[å¹¶å‘è°ƒç”¨REQUIRES_NEWæ–¹æ³•] --&amp;gt; B{ä¸»è¦é£é™©åœºæ™¯}
B --&amp;gt; C[æ•°æ®ä¸ä¸€è‡´é£é™©]
B --&amp;gt; D[é”ç«äº‰ä¸æ­»é”é£é™©]
B --&amp;gt; E[æ€§èƒ½ä¸èµ„æºè€—å°½é£é™©]
C --&amp;gt; C1[å¤–å±‚äº‹åŠ¡å›æ»š&amp;lt;br&amp;gt;å†…å±‚äº‹åŠ¡æäº¤]
C1 --&amp;gt; C2[ä¸šåŠ¡æ•°æ®éƒ¨åˆ†æäº¤]
D --&amp;gt; D1[å¤–å±‚äº‹åŠ¡æŒæœ‰é”]
D1 --&amp;gt; D2[REQUIRES_NEWäº‹åŠ¡&amp;lt;br&amp;gt;è¯·æ±‚ç›¸åŒèµ„æºé”]
D2 --&amp;gt; D3[ç›¸äº’ç­‰å¾…å¯¼è‡´æ­»é”]
E --&amp;gt; E1[é¢‘ç¹åˆ›å»ºæ–°äº‹åŠ¡]
E1 --&amp;gt; E2[æ•°æ®åº“è¿æ¥å ç”¨å¢é•¿]
E2 --&amp;gt; E3[è¿æ¥æ± è€—å°½é£é™©]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†å‰–æè¿™äº›é£é™©çš„å…·ä½“è¡¨ç°å’Œæ ¹æºã€‚&lt;/p&gt;
&lt;h3 id="-æ•°æ®ä¸ä¸€è‡´é£é™©"&gt;ğŸ’¥ æ•°æ®ä¸ä¸€è‡´é£é™©
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;æœ€æ ¸å¿ƒçš„å¹¶å‘é£é™©ï¼Œä¸»è¦ä½“ç°åœ¨äº‹åŠ¡ç»“æœçš„éƒ¨åˆ†æäº¤ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤–å±‚å›æ»šï¼Œå†…å±‚æäº¤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“æ–¹æ³•Aï¼ˆ&lt;code&gt;PROPAGATION_REQUIRED&lt;/code&gt;ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆ&lt;code&gt;PROPAGATION_REQUIRES_NEW&lt;/code&gt;ï¼‰æ—¶ï¼Œå¦‚æœæ–¹æ³•Bæ‰§è¡ŒæˆåŠŸå¹¶æäº¤ï¼Œä½†æ–¹æ³•Aåœ¨åç»­æ“ä½œä¸­å¤±è´¥å¹¶å›æ»šï¼Œæ–¹æ³•Bå·²æäº¤çš„æ“ä½œå°†æ— æ³•æ’¤å›ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œä¸‹å•æ“ä½œï¼ˆæ–¹æ³•Aï¼‰ä¸­è®°å½•äº†å®¡è®¡æ—¥å¿—ï¼ˆæ–¹æ³•Bï¼‰ï¼Œå³ä½¿è®¢å•æœ€ç»ˆå¤±è´¥å›æ»šï¼Œå®¡è®¡æ—¥å¿—å´å·²æ°¸ä¹…ä¿å­˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éš”ç¦»çº§åˆ«ä¸â€œå¹»è¯»â€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚æœ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸å½“ï¼ˆå¦‚ &lt;code&gt;READ_COMMITTED&lt;/code&gt;ï¼‰ï¼Œè€Œå¤–å±‚äº‹åŠ¡éš”ç¦»çº§åˆ«æ›´é«˜ï¼ˆå¦‚ &lt;code&gt;REPEATABLE_READ&lt;/code&gt;ï¼‰ï¼Œå¯èƒ½äº§ç”Ÿå¹»è¯»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆ&lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼‰æ’å…¥æ•°æ®å¹¶æäº¤åï¼Œä¸€ä¸ªå¹¶å‘çš„å¤–å±‚äº‹åŠ¡å¯èƒ½åœ¨ä¸¤æ¬¡æŸ¥è¯¢é—´å‘ç°æ•°æ®è¡Œæ•°å˜åŒ–ï¼Œå³ä½¿å¤–å±‚äº‹åŠ¡å°šæœªç»“æŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-é”ç«äº‰ä¸æ­»é”é£é™©"&gt;ğŸ”’ é”ç«äº‰ä¸æ­»é”é£é™©
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;ä¼šåˆ›å»ºç‹¬ç«‹çš„æ–°äº‹åŠ¡ï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½ä»¥ç‹¬ç«‹çš„æ–¹å¼è·å–å’ŒæŒæœ‰æ•°æ®åº“é”ï¼Œä»è€Œå¼•å‘å¤æ‚çš„é”é—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ­»é”ï¼ˆDeadlockï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æœ€å¸¸è§çš„é”é—®é¢˜ã€‚è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡A&lt;/strong&gt;ï¼ˆå¤–å±‚äº‹åŠ¡ï¼‰é”å®šäº†èµ„æºXã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡B&lt;/strong&gt;ï¼ˆå¦ä¸€ä¸ª &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡ï¼‰éœ€è¦èµ„æºXï¼Œä½†è¢«Aé˜»å¡ï¼ŒåŒæ—¶å®ƒé”å®šäº†èµ„æºYã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡A&lt;/strong&gt;åç»­éœ€è¦èµ„æºYï¼Œä½†è¢«Bé˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œäº‹åŠ¡Aå’Œäº‹åŠ¡Bç›¸äº’ç­‰å¾…ï¼Œå½¢æˆæ­»é”ã€‚ç”±äº &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡ç‹¬ç«‹è¿è¡Œï¼Œæ•°æ®åº“æ— æ³•è‡ªåŠ¨åŒ–è§£è¿™ç§è·¨äº‹åŠ¡çš„å¾ªç¯ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”ç²’åº¦æ‰©å¤§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡éœ€è¦ä¿®æ”¹å¤§é‡æ•°æ®ï¼Œå®ƒä¼šé•¿æ—¶é—´æŒæœ‰è¿™äº›æ•°æ®ä¸Šçš„æ’ä»–é”ã€‚è¿™å¯èƒ½å¯¼è‡´å…¶ä»–éœ€è¦è®¿é—®ç›¸åŒæ•°æ®çš„äº‹åŠ¡è¢«é˜»å¡ï¼Œé™ä½ç³»ç»Ÿæ•´ä½“ååé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€§èƒ½ä¸èµ„æºæ¶ˆè€—"&gt;â±ï¸ æ€§èƒ½ä¸èµ„æºæ¶ˆè€—
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;çš„è¡Œä¸ºæ¨¡å¼å†³å®šäº†å®ƒåœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¢‘ç¹äº‹åŠ¡åˆ›å»º&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç‰©ç†äº‹åŠ¡ï¼Œè¿™æ¶‰åŠä»æ•°æ®åº“è¿æ¥æ± è·å–è¿æ¥ã€è®¾ç½®äº‹åŠ¡çŠ¶æ€ã€ç®¡ç†ä¿å­˜ç‚¹ç­‰æ“ä½œã€‚åœ¨é«˜é¢‘è°ƒç”¨åœºæ™¯ä¸‹ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡CPUå’Œå†…å­˜èµ„æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åº“è¿æ¥å‹åŠ›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ–°äº‹åŠ¡éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥ã€‚åœ¨å¹¶å‘é«˜çš„ç³»ç»Ÿä¸­ï¼Œå¤§é‡ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡å¯èƒ½å¿«é€Ÿè€—å°½è¿æ¥æ± ï¼Œå¯¼è‡´å…¶ä»–è¯·æ±‚æ— æ³•è·å–è¿æ¥è€Œè¶…æ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä¸åŒæ­¥é”synchronizedçš„é”™è¯¯ç»“åˆ"&gt;ğŸ”„ ä¸åŒæ­¥é”ï¼ˆsynchronizedï¼‰çš„é”™è¯¯ç»“åˆ
&lt;/h3&gt;&lt;p&gt;å½“å¼€å‘è€…è¯•å›¾ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å…³é”®å­—ä¿è¯æ–¹æ³•çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ—¶æ–¹æ³•å†…éƒ¨åˆä½¿ç”¨äº† &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡æ—¶ï¼Œä¼šå¼•å‘ä¸€ä¸ªå…¸å‹é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é£é™©åœºæ™¯&lt;/strong&gt;ï¼šå°†åŒæ­¥é”æ”¾åœ¨äº‹åŠ¡å†…éƒ¨ã€‚å‡è®¾æ–¹æ³•AåŠ é”ï¼Œå¹¶åœ¨é”å†…è°ƒç”¨ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;çš„æ–¹æ³•Bã€‚
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹Aè¿›å…¥é”ï¼Œåˆ›å»ºæ–°äº‹åŠ¡T1ï¼Œä½†æ•°æ®ä¿®æ”¹å°šæœªæäº¤ã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹Bè¿›å…¥é”ï¼Œåˆ›å»ºå¦ä¸€ä¸ªæ–°äº‹åŠ¡T2ã€‚ç”±äºT1è¿˜æœªæäº¤ï¼ŒT2è¯»å–åˆ°çš„å¯èƒ½æ˜¯æ—§æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­£ç¡®åšæ³•&lt;/strong&gt;ï¼š&lt;strong&gt;é”åº”ç½®äºäº‹åŠ¡å¤–å±‚&lt;/strong&gt;ã€‚å…ˆé€šè¿‡é”ä¿è¯ä¸²è¡ŒåŒ–è®¿é—®ï¼Œå†è¿›å…¥äº‹åŠ¡è¾¹ç•Œã€‚è¿™æ ·èƒ½ç¡®ä¿ä¸€ä¸ªäº‹åŠ¡å®Œå…¨æ‰§è¡Œå¹¶æäº¤åï¼Œä¸‹ä¸€ä¸ªäº‹åŠ¡æ‰èƒ½å¼€å§‹ï¼Œä»è€Œè¯»åˆ°æœ€æ–°æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æœ€ä½³å®è·µä¸æ›¿ä»£æ–¹æ¡ˆ"&gt;ğŸ’¡ æœ€ä½³å®è·µä¸æ›¿ä»£æ–¹æ¡ˆ
&lt;/h3&gt;&lt;p&gt;äº†è§£äº†é£é™©åï¼Œå…³é”®åœ¨äºå¦‚ä½•è§„é¿æˆ–å®‰å…¨ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å®è·µ/æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®¡æ…è¯„ä¼°éœ€æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¦–å…ˆé—®è‡ªå·±ï¼šè¿™ä¸ªæ“ä½œæ˜¯å¦&lt;strong&gt;å¿…é¡»&lt;/strong&gt;ç‹¬ç«‹äºä¸»äº‹åŠ¡æäº¤ï¼Ÿ&lt;/td&gt;
&lt;td&gt;å®¡è®¡æ—¥å¿—ã€é€šçŸ¥æ¶ˆæ¯ç­‰å³ä½¿ä¸»ä¸šåŠ¡å¤±è´¥ä¹Ÿéœ€è®°å½•çš„åœºæ™¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒæ•´éš”ç¦»çº§åˆ«&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ¹æ®ä¸šåŠ¡ä¸€è‡´æ€§è¦æ±‚ï¼Œä¸º &lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡è®¾ç½®åˆé€‚çš„éš”ç¦»çº§åˆ«ï¼ˆå¦‚ &lt;code&gt;REPEATABLE_READ&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;éœ€è¦é˜²æ­¢å¹»è¯»ï¼Œä¸”æ•°æ®åº“æ”¯æŒï¼ˆå¦‚MySQL InnoDBï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½¿ç”¨ç¼–ç¨‹å¼äº‹åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨ &lt;code&gt;TransactionTemplate&lt;/code&gt;ç²¾ç¡®æ§åˆ¶äº‹åŠ¡è¾¹ç•Œï¼Œé¿å…å£°æ˜å¼äº‹åŠ¡çš„éšæ€§é™·é˜±ï¼ˆå¦‚è‡ªè°ƒç”¨å¤±æ•ˆï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;éœ€è¦ç»†ç²’åº¦äº‹åŠ¡æ§åˆ¶æˆ–ä¸é”å¤æ‚äº¤äº’çš„åœºæ™¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è€ƒè™‘ &lt;code&gt;NESTED&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœæ•°æ®åº“æ”¯æŒï¼Œ&lt;code&gt;PROPAGATION_NESTED&lt;/code&gt;ä½¿ç”¨ä¿å­˜ç‚¹ï¼ˆSavepointï¼‰ã€‚å†…å±‚æ“ä½œå¯ç‹¬ç«‹å›æ»šï¼Œä½†å¤–å±‚å›æ»šä¼šè§¦å‘å†…å±‚å›æ»šï¼Œèƒ½æ›´å¥½åœ°ä¿è¯åŸå­æ€§ã€‚&lt;/td&gt;
&lt;td&gt;å¸Œæœ›å†…å±‚æ“ä½œå¯å›æ»šï¼Œä½†å¤–å±‚å¤±è´¥æ—¶å…¨éƒ¨å›æ»šçš„åœºæ™¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ€»ç»“-11"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚å®ƒé€šè¿‡åˆ›å»ºç‹¬ç«‹äº‹åŠ¡æä¾›äº†çµæ´»æ€§ï¼Œä½†ä¹Ÿå¼•å…¥äº†æ•°æ®ä¸ä¸€è‡´ã€æ­»é”å’Œæ€§èƒ½æŸè€—ç­‰å¹¶å‘é£é™©ã€‚&lt;strong&gt;æ ¸å¿ƒä½¿ç”¨åŸåˆ™æ˜¯ï¼šé™¤éä½ èƒ½æ¸…æ™°ç†è§£å¹¶æ¥å—å…¶å¸¦æ¥çš„é£é™©ï¼Œå¦åˆ™åº”è°¨æ…ä½¿ç”¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è®¾è®¡å’Œç¼–ç æ—¶ï¼ŒåŠ¡å¿…æ˜ç¡®äº‹åŠ¡è¾¹ç•Œï¼Œé¿å…ä¸å¿…è¦çš„é•¿äº‹åŠ¡å’Œé”ç«äº‰ï¼Œå¹¶ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ä¿å­˜ç‚¹ç­‰æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆæ¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°é©¾é©­ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;ã€‚å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šåœºæ™¯æœ‰æ›´æ·±å…¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="requires_new"&gt;REQUIRES_NEW
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯&lt;strong&gt;åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ã€ç‹¬ç«‹çš„äº‹åŠ¡&lt;/strong&gt;ï¼Œå¹¶æŒ‚èµ·å½“å‰å­˜åœ¨çš„äº‹åŠ¡ã€‚è¿™ä¸ªæ–°äº‹åŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æäº¤å’Œå›æ»šæœºåˆ¶ï¼Œå…¶æˆè´¥ä¸ä¼šå½±å“å¤–å±‚äº‹åŠ¡ï¼Œåä¹‹äº¦ç„¶ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹è¡¨æ ¼æ±‡æ€»äº†å®ƒæœ€å…¸å‹çš„é€‚ç”¨åœºæ™¯ï¼Œä½ å¯ä»¥å¿«é€Ÿäº†è§£å…¶æ ¸å¿ƒä»·å€¼ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒä»·å€¼&lt;/th&gt;
&lt;th&gt;å…·ä½“æ¡ˆä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…³é”®æ“ä½œç‹¬ç«‹æŒä¹…åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¡®ä¿å…³é”®è®°å½•ï¼ˆå¦‚æ—¥å¿—ã€å®¡è®¡çº¿ç´¢ï¼‰å³ä½¿ä¸»ä¸šåŠ¡å¤±è´¥ä¹Ÿèƒ½ä¿ç•™ã€‚&lt;/td&gt;
&lt;td&gt;è®¢å•å¤±è´¥ï¼Œä½†æ“ä½œæ—¥å¿—å¿…é¡»è®°å½•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿæˆ–æœåŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨å»¶è¿Ÿæˆ–å¤±è´¥å¯¼è‡´ä¸»äº‹åŠ¡é•¿æ—¶é—´é”å®šèµ„æºã€‚&lt;/td&gt;
&lt;td&gt;è°ƒç”¨æ”¯ä»˜ç½‘å…³ã€å‘é€çŸ­ä¿¡/é‚®ä»¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éœ€è¦ç‹¬ç«‹é‡è¯•çš„è¡¥å¿æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»äº‹åŠ¡å¤±è´¥åï¼Œå·²ç‹¬ç«‹æäº¤çš„å­äº‹åŠ¡å¯ä½œä¸ºè¡¥å¿æ“ä½œçš„ä¾æ®ã€‚&lt;/td&gt;
&lt;td&gt;è®¢å•å–æ¶ˆåï¼ŒåŸºäºå·²ç‹¬ç«‹æäº¤çš„è®°å½•å‘èµ·é€€æ¬¾ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä¸å…¶ä»–ä¼ æ’­è¡Œä¸ºçš„åŒºåˆ«"&gt;ğŸ’¡ ä¸å…¶ä»–ä¼ æ’­è¡Œä¸ºçš„åŒºåˆ«
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†æ›´å‡†ç¡®åœ°ä½¿ç”¨ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼Œç†è§£å®ƒå’Œå…¶ä»–ç›¸ä¼¼ä¼ æ’­è¡Œä¸ºçš„åŒºåˆ«å¾ˆé‡è¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸ &lt;code&gt;REQUIRED&lt;/code&gt;çš„åŒºåˆ«&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€æ ¹æœ¬çš„åŒºåˆ«ã€‚&lt;code&gt;REQUIRED&lt;/code&gt;æ˜¯&lt;strong&gt;åŠ å…¥&lt;/strong&gt;å½“å‰äº‹åŠ¡ï¼Œæ‰€æœ‰æ“ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡å•å…ƒé‡Œï¼Œä¸€è£ä¿±è£ï¼Œä¸€æŸä¿±æŸã€‚è€Œ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;æ˜¯&lt;strong&gt;åˆ›å»º&lt;/strong&gt;æ–°äº‹åŠ¡ï¼Œä¸¤è€…å®Œå…¨ç‹¬ç«‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ &lt;code&gt;NESTED&lt;/code&gt;çš„åŒºåˆ«&lt;/strong&gt;ï¼š&lt;code&gt;NESTED&lt;/code&gt;æ˜¯ä¸€ç§åµŒå¥—äº‹åŠ¡ï¼ŒåŸºäºæ•°æ®åº“çš„ä¿å­˜ç‚¹ï¼ˆSavepointï¼‰å®ç°ã€‚å®ƒçš„å…³é”®ç‰¹æ€§æ˜¯&lt;strong&gt;éƒ¨åˆ†å›æ»š&lt;/strong&gt;ï¼šå¦‚æœåµŒå¥—äº‹åŠ¡å¤±è´¥ï¼Œå¯ä»¥å›æ»šåˆ°ä¿å­˜ç‚¹è€Œä¸å½±å“å¤–å±‚äº‹åŠ¡ï¼›ä½†æ˜¯ï¼Œå¦‚æœå¤–å±‚äº‹åŠ¡å›æ»šï¼Œåˆ™åµŒå¥—äº‹åŠ¡ä¹Ÿ&lt;strong&gt;å¿…ç„¶å›æ»š&lt;/strong&gt;ã€‚è€Œ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;å³ä½¿åœ¨å¤–éƒ¨äº‹åŠ¡å›æ»šæ—¶ï¼Œå†…éƒ¨äº‹åŠ¡åªè¦æäº¤äº†å°±ä¸€å®šä¼šæŒä¹…åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ éœ€è¦å†…å±‚æ“ä½œçš„æäº¤ç»“æœ&lt;strong&gt;å®Œå…¨ä¸ä¾èµ–äº&lt;/strong&gt;å¤–å±‚äº‹åŠ¡çš„æœ€ç»ˆç»“æœï¼Œå°±ç”¨ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼›å¦‚æœä½ å¸Œæœ›å†…å±‚æ“ä½œå¯ä»¥å•ç‹¬å›æ»šï¼Œä½†å¤–å±‚å¤±è´¥æ—¶å†…å±‚ä¹Ÿåº”å›æ»šä»¥ä¿æŒåŸå­æ€§ï¼Œåˆ™ç”¨ &lt;code&gt;NESTED&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„äº‹é¡¹ä¸ä»£ä»·"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹ä¸ä»£ä»·
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;è™½ç„¶å¼ºå¤§ï¼Œä½†å¹¶éé“¶å¼¹ï¼Œä½¿ç”¨æ—¶éœ€æ³¨æ„ä»¥ä¸‹æˆæœ¬å’Œé£é™©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;ï¼šæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºæ–°çš„äº‹åŠ¡ï¼Œæ„å‘³ç€éœ€è¦ä»æ•°æ®åº“è¿æ¥æ± è·å–æ–°çš„è¿æ¥ï¼Œæ¶‰åŠäº‹åŠ¡ç®¡ç†å™¨çš„é¢å¤–å·¥ä½œã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¿™ä¼šå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºè€—å°½é£é™©&lt;/strong&gt;ï¼šæ¯ä¸ªæ–°äº‹åŠ¡é€šå¸¸éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥ã€‚å¦‚æœé¢‘ç¹è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“è¿æ¥æ± è¢«è¿…é€Ÿè€—å°½ï¼Œå½±å“ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§è€ƒé‡&lt;/strong&gt;ï¼šæ­£å› ä¸ºå†…å¤–äº‹åŠ¡ç‹¬ç«‹ï¼Œå¯èƒ½å¯¼è‡´&lt;strong&gt;æ•°æ®ä¸ä¸€è‡´&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œä¸»ä¸šåŠ¡å›æ»šäº†ï¼Œä½†è®°å½•æ—¥å¿—çš„å­äº‹åŠ¡å´æˆåŠŸäº†ã€‚è®¾è®¡æ—¶å¿…é¡»ç¡®è®¤è¿™ç§ä¸ä¸€è‡´æ˜¯å¦æ˜¯ä¸šåŠ¡æ‰€èƒ½æ¥å—çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­»é”é£é™©&lt;/strong&gt;ï¼šæ–°äº‹åŠ¡å¯èƒ½ä¼šä»¥ä¸åŒçš„é¡ºåºè·å–é”ï¼Œä¸æŒ‚èµ·çš„å¤–å±‚äº‹åŠ¡å½¢æˆå¾ªç¯ç­‰å¾…ï¼Œä»è€Œå¢åŠ æ­»é”çš„æ¦‚ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å®æˆ˜ä»£ç ç¤ºä¾‹"&gt;ğŸ“ å®æˆ˜ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº† &lt;code&gt;REQUIRES_NEW&lt;/code&gt;çš„ç”¨æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class OrderService {
@Autowired
private AuditLogService auditLogService;
@Transactional // é»˜è®¤æ˜¯ PROPAGATION_REQUIRED
public void createOrder(Order order) {
// 1. ä¿å­˜è®¢å•æ ¸å¿ƒä¸šåŠ¡æ•°æ®
orderRepository.save(order);
try {
// 2. è®°å½•å®¡è®¡æ—¥å¿—ï¼Œä½¿ç”¨ REQUIRES_NEW ç¡®ä¿ç‹¬ç«‹æäº¤
auditLogService.logAction(&amp;#34;ORDER_CREATED&amp;#34;, order.getId());
} catch (Exception e) {
// å³ä½¿æ—¥å¿—è®°å½•å¤±è´¥ï¼Œä¹Ÿä¸åº”å½±å“ä¸»è®¢å•çš„åˆ›å»º
logger.error(&amp;#34;å®¡è®¡æ—¥å¿—è®°å½•å¤±è´¥ï¼Œä½†è®¢å•åˆ›å»ºç»§ç»­&amp;#34;, e);
}
// 3. å…¶ä»–å¯èƒ½å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘...
// å¦‚æœè¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè®¢å•åˆ›å»ºä¼šå›æ»šï¼Œä½†å®¡è®¡æ—¥å¿—è®°å½•æ“ä½œï¼ˆå¦‚æœæˆåŠŸï¼‰å·²ç‹¬ç«‹æäº¤ã€‚
}
}
@Service
public class AuditLogService {
@Transactional(propagation = Propagation.REQUIRES_NEW) // å§‹ç»ˆå¼€å¯æ–°äº‹åŠ¡
public void logAction(String action, Long orderId) {
AuditLog log = new AuditLog(action, orderId);
auditLogRepository.save(log);
// è¿™ä¸ªæ–¹æ³•çš„æäº¤å’Œå›æ»šç‹¬ç«‹äº createOrder æ–¹æ³•çš„äº‹åŠ¡
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ€»ç»“ä¸å†³ç­–å»ºè®®"&gt;ğŸ’ æ€»ç»“ä¸å†³ç­–å»ºè®®
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©æ˜¯å¦ä½¿ç”¨ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹å†³ç­–æ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ¤æ–­æ ¸å¿ƒéœ€æ±‚&lt;/strong&gt;ï¼šé—®è‡ªå·±ï¼Œ&lt;strong&gt;è¿™ä¸ªå­æ“ä½œæ˜¯å¦å¿…é¡»åœ¨ä¸»ä¸šåŠ¡å¤±è´¥æ—¶ä¾ç„¶æˆåŠŸï¼Ÿ&lt;/strong&gt; å¦‚æœç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€å¿…é¡»çš„ï¼Œé‚£ä¹ˆ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;æ˜¯åˆé€‚çš„å€™é€‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯„ä¼°ä¸€è‡´æ€§è¦æ±‚&lt;/strong&gt;ï¼šæ¥å—è¿™ç§â€œéƒ¨åˆ†æˆåŠŸâ€æ‰€å¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´æ€§æ˜¯å¦æ˜¯ä¸šåŠ¡è®¾è®¡çš„ä¸€éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘æ€§èƒ½ä¸èµ„æº&lt;/strong&gt;ï¼šè¯„ä¼°ç³»ç»Ÿçš„å¹¶å‘é‡å’Œæ•°æ®åº“è¿æ¥èµ„æºï¼Œç¡®ä¿ä¸ä¼šå› æ­¤æˆä¸ºç“¶é¢ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œ&lt;code&gt;REQUIRES_NEW&lt;/code&gt;æ˜¯ä¸€æŠŠåŠŸèƒ½å¼ºå¤§ä½†éœ€è¦è°¨æ…ä½¿ç”¨çš„åˆ©å™¨ã€‚å®ƒéå¸¸é€‚åˆé‚£äº›éœ€è¦ä¸ä¸»ä¸šåŠ¡è§£è€¦ã€ç¡®ä¿æœ€ç»ˆæ‰§è¡Œçš„è¾…åŠ©æ€§æˆ–è¡¥å¿æ€§æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;ã€‚å¦‚æœä½ æœ‰æ›´å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Spring Fundamentals</title><link>https://dyhes.github.io/p/shopeespring-fundamentals/</link><pubDate>Mon, 01 Sep 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeespring-fundamentals/</guid><description>&lt;h2 id="restclient--webclient"&gt;&lt;code&gt;RestClient&lt;/code&gt; &amp;amp; &lt;code&gt;WebClient&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;Spring Framework ä¸­çš„ &lt;code&gt;RestClient&lt;/code&gt;å’Œ &lt;code&gt;WebClient&lt;/code&gt;éƒ½æ˜¯ç”¨äºè¿›è¡Œ HTTP è°ƒç”¨çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç†å¿µã€é€‚ç”¨åœºæ™¯å’Œç‰¹æ€§æœ‰æ˜¾è‘—åŒºåˆ«ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ï¼Œä»¥ä¾¿ä½ å¿«é€ŸæŠŠæ¡ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;RestClient&lt;/th&gt;
&lt;th&gt;WebClient&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒæ­¥/å¼‚æ­¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒæ­¥ (é˜»å¡)&lt;/td&gt;
&lt;td&gt;å¼‚æ­¥ (éé˜»å¡) / æ”¯æŒåŒæ­¥è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ ç»Ÿå‘½ä»¤å¼ã€é˜»å¡å¼&lt;/td&gt;
&lt;td&gt;å“åº”å¼ (Reactive)ï¼ŒåŸºäº Reactor (Mono/Flux)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;API é£æ ¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æµç•…çš„ (Fluent) API&lt;/td&gt;
&lt;td&gt;æµç•…çš„ (Fluent) API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºå¸¸è§„åŒæ­¥è¯·æ±‚ï¼Œæ€§èƒ½é€‚ä¸­&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ã€éé˜»å¡ I/Oï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œé€‚åˆé«˜ååé‡åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æ›²çº¿&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›¸å¯¹ç®€å•ï¼Œæ˜“äºä¸Šæ‰‹&lt;/td&gt;
&lt;td&gt;ç›¸å¯¹é™¡å³­ï¼Œéœ€ç†è§£å“åº”å¼ç¼–ç¨‹æ¦‚å¿µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring ç‰ˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Framework 6.1+ / Spring Boot 3.2+&lt;/td&gt;
&lt;td&gt;Spring Framework 5+&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒé€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ ç»Ÿçš„åŒæ­¥é˜»å¡è°ƒç”¨ã€å¾®æœåŠ¡é—´çš„åŒæ­¥é€šä¿¡ã€ä» &lt;code&gt;RestTemplate&lt;/code&gt;è¿ç§»&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘åº”ç”¨ã€å“åº”å¼ç³»ç»Ÿã€å¾®æœåŠ¡æ¶æ„ã€æµå¼æ•°æ®å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å“ªä¸€ä¸ªï¼Œå–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œé¡¹ç›®ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;RestClient&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®åŸºäº &lt;strong&gt;Spring Boot 3.2 æˆ–æ›´é«˜ç‰ˆæœ¬&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è¿›è¡Œä¼ ç»Ÿçš„ã€&lt;strong&gt;åŒæ­¥é˜»å¡å¼&lt;/strong&gt;çš„ HTTP è°ƒç”¨ ã€‚&lt;/li&gt;
&lt;li&gt;å¸Œæœ›ä»£ç &lt;strong&gt;ç®€æ´æ˜“è¯»&lt;/strong&gt;ï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯• ã€‚&lt;/li&gt;
&lt;li&gt;ä»æ—§çš„ &lt;code&gt;RestTemplate&lt;/code&gt;è¿ç§»ï¼Œå¸Œæœ›æœ‰ä¸€ä¸ªæ›´ç°ä»£çš„åŒæ­¥å®¢æˆ·ç«¯ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;WebClient&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®éœ€è¦&lt;strong&gt;é«˜å¹¶å‘ã€é«˜æ€§èƒ½å’Œéé˜»å¡ I/O&lt;/strong&gt; å¤„ç† ã€‚&lt;/li&gt;
&lt;li&gt;æ•´ä¸ªåº”ç”¨æ ˆé‡‡ç”¨ &lt;strong&gt;å“åº”å¼ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt; (å¦‚ Spring WebFlux) ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤„ç†&lt;strong&gt;æµå¼æ•°æ®&lt;/strong&gt; (å¦‚ Server-Sent Events, å¤§æ•°æ®é‡ä¼ è¾“) ã€‚&lt;/li&gt;
&lt;li&gt;åº”ç”¨è¿è¡Œåœ¨ &lt;strong&gt;Spring 5&lt;/strong&gt; æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Š ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å…³äº-resttemplate"&gt;ğŸ—‚ï¸ å…³äº RestTemplate
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ä½ çš„é—®é¢˜ä¸»è¦é›†ä¸­åœ¨ &lt;code&gt;RestClient&lt;/code&gt;å’Œ &lt;code&gt;WebClient&lt;/code&gt;ï¼Œä½†äº†è§£ä¸€ä¸‹ &lt;code&gt;RestTemplate&lt;/code&gt;ä¹Ÿæœ‰åŠ©äºç†è§£æ¼”è¿›ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RestTemplate&lt;/code&gt;æ˜¯ Spring æ—©æœŸæä¾›çš„&lt;strong&gt;åŒæ­¥é˜»å¡å¼&lt;/strong&gt; HTTP å®¢æˆ·ç«¯ï¼Œé‡‡ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œæä¾›äº†å¤šç§ä¾¿æ·æ–¹æ³• ã€‚&lt;strong&gt;å®ƒåœ¨ Spring 5 ä¹‹åå·²ä¸å†æ¨èç§¯æä½¿ç”¨ï¼Œå¹¶åœ¨ Spring 6 ä¸­è¢«æ ‡è®°ä¸ºè¿‡æ—¶ (deprecated)&lt;/strong&gt;ã€‚&lt;code&gt;RestClient&lt;/code&gt;å¯ä»¥çœ‹ä½œæ˜¯ &lt;code&gt;RestTemplate&lt;/code&gt;çš„ç°ä»£åŒ–æ›¿ä»£å“ ã€‚&lt;/p&gt;
&lt;h3 id="-ç®€è¦æ€»ç»“"&gt;ğŸ’ ç®€è¦æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;RestClient&lt;/code&gt;æ˜¯ &lt;strong&gt;åŒæ­¥è¯·æ±‚çš„ç°ä»£é€‰æ‹©&lt;/strong&gt;ï¼Œæ—¨åœ¨æ›¿ä»£ &lt;code&gt;RestTemplate&lt;/code&gt;ï¼Œæä¾›æ›´æµç•…çš„ API å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒã€‚&lt;code&gt;WebClient&lt;/code&gt;åˆ™æ˜¯ &lt;strong&gt;å“åº”å¼å’Œå¼‚æ­¥ä¸–ç•Œçš„å¼ºå¤§å·¥å…·&lt;/strong&gt;ï¼Œä¸ºé«˜å¹¶å‘å’Œå®æ—¶åº”ç”¨è€Œç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ åšå‡ºæ¸…æ™°çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="æ— ç•Œé˜Ÿåˆ—"&gt;æ— ç•Œé˜Ÿåˆ—
&lt;/h2&gt;&lt;p&gt;ThreadPoolExecutor åœ¨ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ˆå¦‚ &lt;code&gt;LinkedBlockingQueue&lt;/code&gt;é»˜è®¤æ„é€ ï¼‰æ—¶ï¼Œå…¶ &lt;code&gt;maximumPoolSize&lt;/code&gt;å‚æ•°ç¡®å®ä¼šâ€œå¤±æ•ˆâ€ã€‚ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€å¼ å›¾ï¼Œç›´è§‚äº†è§£çº¿ç¨‹æ± çš„ä»»åŠ¡å¤„ç†æµç¨‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[æ–°ä»»åŠ¡æäº¤] --&amp;gt; B{æ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡?}
B -- å¦ --&amp;gt; C[åˆ›å»ºæ–°çš„æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œ]
B -- æ˜¯ --&amp;gt; D{ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡?}
D -- å¦ --&amp;gt; E[ä»»åŠ¡å…¥é˜Ÿç­‰å¾…]
D -- æ˜¯ --&amp;gt; F{çº¿ç¨‹æ•°å°äºmaximumPoolSize?}
F -- æ˜¯ --&amp;gt; G[åˆ›å»ºæ–°çº¿ç¨‹&amp;lt;éæ ¸å¿ƒ&amp;gt;æ‰§è¡Œ]
F -- å¦ --&amp;gt; H[æ‰§è¡Œæ‹’ç»ç­–ç•¥]
E --&amp;gt; I{é˜Ÿåˆ—æ˜¯æ— ç•Œçš„?}
I -- æ˜¯ --&amp;gt; J[âŒ é˜Ÿåˆ—æ°¸è¿œä¸ä¼šæ»¡&amp;lt;br&amp;gt;æµç¨‹ç»ˆæ­¢äºæ­¤]
I -- å¦ --&amp;gt; K[æµç¨‹ç»§ç»­]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ&lt;strong&gt;ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ï¼Œä»»åŠ¡å…¥é˜Ÿçš„ç¯èŠ‚ï¼ˆæ­¥éª¤2ï¼‰æ°¸è¿œä¸ä¼šå¤±è´¥&lt;/strong&gt;ï¼Œå› æ­¤æµç¨‹æ°¸è¿œä¸ä¼šèµ°åˆ°åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºæ–°éæ ¸å¿ƒçº¿ç¨‹ï¼ˆæ­¥éª¤3ï¼‰é‚£ä¸€æ­¥ã€‚&lt;/p&gt;
&lt;h3 id="-è¯¦è§£çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶"&gt;ğŸ” è¯¦è§£çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ThreadPoolExecutor&lt;/code&gt;å¤„ç†æ–°ä»»åŠ¡æ—¶ï¼Œéµå¾ªä¸€ä¸ªå›ºå®šçš„ä¼˜å…ˆçº§é¡ºåºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒçº¿ç¨‹ä¼˜å…ˆ&lt;/strong&gt;ï¼šå¦‚æœå½“å‰è¿è¡Œçº¿ç¨‹æ•°å°äº &lt;code&gt;corePoolSize&lt;/code&gt;ï¼Œå³ä½¿å…¶ä»–çº¿ç¨‹ç©ºé—²ï¼Œä¹Ÿä¼šç«‹å³&lt;strong&gt;åˆ›å»ºæ–°çº¿ç¨‹&lt;/strong&gt;æ¥æ‰§è¡Œæ–°ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¥é˜Ÿç­‰å¾…&lt;/strong&gt;ï¼šå¦‚æœå½“å‰è¿è¡Œçº¿ç¨‹æ•°å·²è¾¾åˆ°æˆ–è¶…è¿‡ &lt;code&gt;corePoolSize&lt;/code&gt;ï¼Œçº¿ç¨‹æ± ä¸ä¼šç«‹å³åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯å°è¯•å°†ä»»åŠ¡&lt;strong&gt;æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—&lt;/strong&gt;ï¼ˆ&lt;code&gt;workQueue&lt;/code&gt;ï¼‰ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹&lt;/strong&gt;ï¼š&lt;strong&gt;åªæœ‰å½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡&lt;/strong&gt;ï¼ˆå³æ— æ³•å…¥é˜Ÿï¼‰ï¼Œä¸”å½“å‰è¿è¡Œçº¿ç¨‹æ•°å°äº &lt;code&gt;maximumPoolSize&lt;/code&gt;æ—¶ï¼Œçº¿ç¨‹æ± æ‰ä¼š&lt;strong&gt;åˆ›å»ºæ–°çº¿ç¨‹&lt;/strong&gt;ï¼ˆéæ ¸å¿ƒçº¿ç¨‹ï¼‰æ¥æ‰§è¡Œæ–°ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‹’ç»ç­–ç•¥&lt;/strong&gt;ï¼šå¦‚æœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰è¿è¡Œçº¿ç¨‹æ•°å·²è¾¾åˆ° &lt;code&gt;maximumPoolSize&lt;/code&gt;ï¼Œé‚£ä¹ˆæ–°ä»»åŠ¡å°†è¢«&lt;strong&gt;æ‹’ç»&lt;/strong&gt;ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼ˆ&lt;code&gt;RejectedExecutionHandler&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ— ç•Œé˜Ÿåˆ—å¦‚ä½•å¯¼è‡´æœ€å¤§çº¿ç¨‹æ•°å¤±æ•ˆ"&gt;âš ï¸ æ— ç•Œé˜Ÿåˆ—å¦‚ä½•å¯¼è‡´æœ€å¤§çº¿ç¨‹æ•°å¤±æ•ˆ
&lt;/h3&gt;&lt;p&gt;æ— ç•Œé˜Ÿåˆ—ï¼ˆå¦‚é»˜è®¤æ„é€ çš„ &lt;code&gt;LinkedBlockingQueue&lt;/code&gt;ï¼‰çš„&lt;strong&gt;ç†è®ºå®¹é‡æ˜¯ &lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;&lt;/strong&gt;ï¼Œçº¦21äº¿ï¼Œåœ¨å®è·µä¸­å¯ä»¥è®¤ä¸ºæ˜¯â€œæ— é™â€çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä»»åŠ¡æäº¤é€Ÿåº¦æŒç»­é«˜äºå¤„ç†é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡ä¼š&lt;strong&gt;æ— é™åœ°å †ç§¯&lt;/strong&gt;åœ¨æ— ç•Œé˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºé˜Ÿåˆ—&lt;strong&gt;æ°¸è¿œä¹Ÿä¸ä¼šâ€œæ»¡â€&lt;/strong&gt;ï¼Œçº¿ç¨‹æ± å°±&lt;strong&gt;æ°¸è¿œæ²¡æœ‰æœºä¼š&lt;/strong&gt;èµ°åˆ°ä¸Šè¿°æµç¨‹çš„ç¬¬3æ­¥ï¼ˆåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å› æ­¤ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æœ€å¤šåªä¼šè¾¾åˆ° &lt;code&gt;corePoolSize&lt;/code&gt;ï¼Œ&lt;strong&gt;&lt;code&gt;maximumPoolSize&lt;/code&gt;è¿™ä¸ªå‚æ•°ä¹Ÿå°±å¤±å»äº†æ„ä¹‰&lt;/strong&gt;ï¼Œæ ¹æœ¬æ²¡æœ‰æœºä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ½œåœ¨é£é™©ä¸å½±å“"&gt;ğŸ”¥ æ½œåœ¨é£é™©ä¸å½±å“
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—å¹¶è®© &lt;code&gt;maximumPoolSize&lt;/code&gt;å¤±æ•ˆä¼šå¸¦æ¥æ˜¾è‘—é£é™©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜è€—å°½ï¼ˆOOMï¼‰&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€å±é™©çš„é—®é¢˜ã€‚å¦‚æœä»»åŠ¡ç”Ÿäº§é€Ÿåº¦æŒç»­è¿œå¤§äºæ¶ˆè´¹é€Ÿåº¦ï¼Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¯¹è±¡ä¼šæ— é™å †ç§¯ï¼Œæœ€ç»ˆè€—å°½ Java å †å†…å­˜ï¼Œå¯¼è‡´ &lt;code&gt;OutOfMemoryError: Java heap space&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å»¶è¿ŸåŠ å‰§&lt;/strong&gt;ï¼šä»»åŠ¡ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¾ˆé•¿æ—¶é—´æ‰èƒ½è¢«å¤„ç†ï¼Œå¯¼è‡´ç³»ç»Ÿå¹³å‡å“åº”æ—¶é—´é£™å‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç®¡ç†å¤±æ§&lt;/strong&gt;ï¼šæ— æ³•é€šè¿‡ &lt;code&gt;maximumPoolSize&lt;/code&gt;æ¥è®¾ç½®çº¿ç¨‹æ•°çš„ç¡¬ä¸Šé™ï¼Œå¤±å»äº†çº¿ç¨‹æ± æ§åˆ¶èµ„æºçš„ä¸€ä¸ªé‡è¦æ‰‹æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•æ­£ç¡®é…ç½®"&gt;ğŸ’¡ å¦‚ä½•æ­£ç¡®é…ç½®
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œé€šå¸¸çš„å»ºè®®æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;ArrayBlockingQueue(int capacity)&lt;/code&gt;æˆ– &lt;code&gt;LinkedBlockingQueue(int capacity)&lt;/code&gt;ï¼Œä¸ºé˜Ÿåˆ—è®¾ç½®ä¸€ä¸ªåˆç†çš„å®¹é‡ä¸Šé™ã€‚è¿™æ˜¯&lt;strong&gt;æœ€é‡è¦çš„åŸåˆ™&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®åˆç†çš„æ‹’ç»ç­–ç•¥&lt;/strong&gt;ï¼šå½“é˜Ÿåˆ—æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œé‡‡å–é€‚å½“çš„ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;CallerRunsPolicy&lt;/code&gt;è®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±è¿è¡Œï¼Œæˆ–è‡ªå®šä¹‰ç­–ç•¥è®°å½•æ—¥å¿—å¹¶ç¨åé‡è¯•ï¼‰ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„æŠ›å‡ºå¼‚å¸¸æˆ–ç›´æ¥ä¸¢å¼ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä¸æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®&lt;/strong&gt;ï¼šæ ¹æ®ä»»åŠ¡ç‰¹æ€§ï¼ˆCPUå¯†é›†å‹ã€IOå¯†é›†å‹ï¼‰è®¾ç½® &lt;code&gt;corePoolSize&lt;/code&gt;å’Œ &lt;code&gt;maximumPoolSize&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£å…¶ä¸­çš„åŸç†å’Œé£é™©ã€‚&lt;/p&gt;
&lt;h2 id="retrymax-attempts"&gt;Retry.max-attempts
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;spring.ai.retry.max-attempts: 1&lt;/code&gt;è¡¨ç¤º&lt;strong&gt;æ€»å…±åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸ä¼šè¿›è¡Œä»»ä½•é‡è¯•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£è¿™ä¸ªé…ç½®ä»¥åŠå…¶ä»–å¸¸è§è®¾ç½®çš„å«ä¹‰ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„è¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ç½®å€¼&lt;/th&gt;
&lt;th&gt;å®é™…é‡è¯•æ¬¡æ•°&lt;/th&gt;
&lt;th&gt;æ€»æ‰§è¡Œæ¬¡æ•°ï¼ˆå«é¦–æ¬¡ï¼‰&lt;/th&gt;
&lt;th&gt;å«ä¹‰è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: 1&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œä¸é‡è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: 2&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡å¤±è´¥åé‡è¯•1æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: 3&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡å¤±è´¥åé‡è¯•2æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;N-1&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡å¤±è´¥åé‡è¯•N-1æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ç†è§£-spring-retry-çš„æœºåˆ¶"&gt;ğŸ’¡ ç†è§£ Spring Retry çš„æœºåˆ¶
&lt;/h3&gt;&lt;p&gt;Spring Retry ä¸­çš„ &lt;code&gt;max-attempts&lt;/code&gt;å‚æ•°å®šä¹‰äº†åŒ…æ‹¬åˆå§‹è°ƒç”¨åœ¨å†…çš„&lt;strong&gt;æœ€å¤§å°è¯•æ¬¡æ•°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ &lt;code&gt;max-attempts&lt;/code&gt;è®¾ç½®ä¸º &lt;strong&gt;1&lt;/strong&gt; æ—¶ï¼Œæ„å‘³ç€æ–¹æ³•æœ€å¤šåªå°è¯•&lt;strong&gt;1æ¬¡&lt;/strong&gt;ã€‚å¦‚æœé¦–æ¬¡è°ƒç”¨å°±å¤±è´¥ï¼Œæ“ä½œä¼šç›´æ¥å¤±è´¥ï¼Œ&lt;strong&gt;ä¸ä¼šè§¦å‘ä»»ä½•é‡è¯•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥éœ€åœ¨å¤±è´¥åé‡è¯•ä¸€æ¬¡ï¼Œåˆ™éœ€å°† &lt;code&gt;max-attempts&lt;/code&gt;è®¾ç½®ä¸º &lt;strong&gt;2&lt;/strong&gt;ã€‚è¿™æ ·ï¼Œåˆå§‹è°ƒç”¨åŠ ä¸Šä¸€æ¬¡é‡è¯•ï¼Œæ€»å…±å°è¯•2æ¬¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;p&gt;åœ¨å†³å®šæ˜¯å¦ä»¥åŠå¦‚ä½•é‡è¯•æ—¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼šé‡è¯•æœºåˆ¶è¦æ±‚è¢«é‡è¯•çš„æ“ä½œæ˜¯&lt;strong&gt;å¹‚ç­‰&lt;/strong&gt;çš„ã€‚å³å¤šæ¬¡æ‰§è¡Œè¯¥æ“ä½œä¸æ‰§è¡Œä¸€æ¬¡äº§ç”Ÿçš„ç»“æœç›¸åŒã€‚åœ¨AIæ¥å£è°ƒç”¨ç­‰åœºæ™¯ä¸­ï¼Œéœ€ç‰¹åˆ«æ³¨æ„è¿™ä¸€ç‚¹ï¼Œä¾‹å¦‚é‡å¤æäº¤ç›¸åŒçš„æç¤ºè¯ï¼ˆPromptï¼‰ä¸€èˆ¬ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä½†æŸäº›ç‰¹å®šæ“ä½œå¯èƒ½éœ€è¦è°¨æ…è¯„ä¼°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®çš„ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼š&lt;code&gt;spring.ai.retry.max-attempts&lt;/code&gt;è¿™ä¸ªé…ç½®æ˜¯ç‰¹å®šäº &lt;strong&gt;Spring AI&lt;/strong&gt; æ¡†æ¶çš„ã€‚ä¸åŒçš„åº“æˆ–æ¡†æ¶ï¼ˆå¦‚ Spring Retryã€Resilience4jï¼‰å…¶é‡è¯•é…ç½®é¡¹çš„åç§°å’Œé»˜è®¤å€¼å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†â€œæœ€å¤§å°è¯•æ¬¡æ•°â€é€šå¸¸éƒ½åŒ…å«åˆå§‹è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ç»“è®º"&gt;ğŸ’ ç»“è®º
&lt;/h3&gt;&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœä½ çš„é…ç½®æ˜¯ &lt;code&gt;spring.ai.retry.max-attempts: 1&lt;/code&gt;ï¼Œé‚£ä¹ˆç›¸å…³æ“ä½œåªè¦å¤±è´¥å°±ä¼šç«‹åˆ»åœæ­¢ï¼Œä¸ä¼šè‡ªåŠ¨é‡è¯•ã€‚å¦‚æœéœ€è¦é‡è¯•ï¼Œè¯·æ ¹æ®ä¸Šè¡¨è°ƒæ•´è¿™ä¸ªå‚æ•°çš„å€¼ã€‚&lt;/p&gt;
&lt;h2 id="restcontrolleradvice"&gt;@RestControllerAdvice
&lt;/h2&gt;&lt;p&gt;@RestControllerAdvice æ˜¯ Spring Frameworkï¼ˆ3.2+ï¼‰å’Œ Spring Boot ä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„æ³¨è§£ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ é›†ä¸­å¤„ç† RESTful Web æœåŠ¡ä¸­çš„å¼‚å¸¸ã€æ•°æ®ç»‘å®šå’Œé¢„å¤„ç†é€»è¾‘ï¼Œè®©ä»£ç æ›´æ•´æ´ã€æ›´æ˜“äºç»´æŠ¤ã€‚ä¸‹é¢æˆ‘æ¥ä¸ºä½ è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸ç‰¹ç‚¹"&gt;ğŸ§  æ ¸å¿ƒæœºåˆ¶ä¸ç‰¹ç‚¹
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice æ˜¯ä¸€ä¸ª&lt;strong&gt;ç»„åˆæ³¨è§£&lt;/strong&gt;ï¼Œå®ƒèåˆäº† &lt;code&gt;@ControllerAdvice&lt;/code&gt;å’Œ &lt;code&gt;@ResponseBody&lt;/code&gt;çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ControllerAdvice&lt;/code&gt;å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªå…¨å±€çš„æ§åˆ¶å™¨å¢å¼ºç±»ï¼Œå¯ä»¥æ•è·æ‰€æœ‰æ§åˆ¶å™¨ï¼ˆ&lt;code&gt;@RestController&lt;/code&gt;ï¼‰æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶å…è®¸è¿›è¡Œå…¨å±€çš„æ•°æ®ç»‘å®šå’Œé¢„å¤„ç†æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ResponseBody&lt;/code&gt;ç¡®ä¿äº†è¯¥ç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„è¿”å›å€¼éƒ½ä¼š&lt;strong&gt;è‡ªåŠ¨è¢«åºåˆ—åŒ–ä¸º JSON æˆ– XML æ ¼å¼&lt;/strong&gt;ï¼Œå¹¶ç›´æ¥å†™å…¥ HTTP å“åº”ä½“ä¸­ï¼Œéå¸¸é€‚åˆæ„å»º RESTful APIã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒä¸ä¼ ç»Ÿ &lt;code&gt;@ControllerAdvice&lt;/code&gt;çš„ä¸€ä¸ªå…³é”®åŒºåˆ«åœ¨äºå“åº”æ ¼å¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;@ControllerAdvice&lt;/th&gt;
&lt;th&gt;@RestControllerAdvice&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å“åº”æ ¼å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯è¿”å›è§†å›¾åç§°æˆ– ModelAndView&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç›´æ¥è¿”å› JSON/XML&lt;/strong&gt; (å†…ç½® &lt;code&gt;@ResponseBody&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ ç»Ÿ MVC è§†å›¾æ¸²æŸ“&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;RESTful API&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›å€¼å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è§†å›¾è§£æå™¨æ¸²æŸ“&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨åºåˆ—åŒ–ä¸ºç»“æ„åŒ–æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä¸»è¦ç”¨é€”"&gt;âš™ï¸ ä¸»è¦ç”¨é€”
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice ä¸»è¦æœ‰ä¸‰å¤§ç”¨é€”ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹æ¥æ•è·å’Œå¤„ç†æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æŠ›å‡ºçš„å„ç§å¼‚å¸¸ï¼Œå¹¶è¿”å›ç»Ÿä¸€çš„ã€å‹å¥½çš„é”™è¯¯ä¿¡æ¯æ ¼å¼ç»™å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç»‘å®šä¸éªŒè¯å¤„ç†&lt;/strong&gt;ï¼šå¯ä»¥ç»Ÿä¸€å¤„ç†å‚æ•°æ ¡éªŒï¼ˆå¦‚ä½¿ç”¨ &lt;code&gt;@Valid&lt;/code&gt;æ³¨è§£ï¼‰å¤±è´¥æ—¶äº§ç”Ÿçš„é”™è¯¯ï¼Œé¿å…åœ¨æ¯ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸­é‡å¤ç¼–å†™æ ¡éªŒé€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æ•°æ®é¢„å¤„ç†&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@InitBinder&lt;/code&gt;æˆ– &lt;code&gt;@ModelAttribute&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼Œå¯ä»¥å¯¹æ‰€æœ‰æ§åˆ¶å™¨æ–¹æ³•çš„è¯·æ±‚å‚æ•°è¿›è¡Œå…¨å±€æ€§çš„å¤„ç†æˆ–ç»‘å®šä¸€äº›å…¬å…±æ•°æ®æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-åŸºæœ¬ä½¿ç”¨æ–¹æ³•"&gt;ğŸ› ï¸ åŸºæœ¬ä½¿ç”¨æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;é€šå¸¸éœ€è¦åˆ›å»ºä¸€ä¸ªç±»å¹¶åŠ ä¸Šè¯¥æ³¨è§£ï¼Œç„¶ååœ¨å…¶ä¸­å®šä¹‰ç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id="å…¨å±€å¼‚å¸¸å¤„ç†ç¤ºä¾‹"&gt;å…¨å±€å¼‚å¸¸å¤„ç†ç¤ºä¾‹
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice // è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå…¨å±€RESTå¼‚å¸¸å¤„ç†ç±»
public class GlobalExceptionHandler {
// å¤„ç†è‡ªå®šä¹‰çš„&amp;#34;èµ„æºæœªæ‰¾åˆ°&amp;#34;å¼‚å¸¸
@ExceptionHandler(ResourceNotFoundException.class)
public ResponseEntity&amp;lt;ErrorResponse&amp;gt; handleResourceNotFound(ResourceNotFoundException ex) {
// åˆ›å»ºè‡ªå®šä¹‰çš„é”™è¯¯å“åº”ä½“
ErrorResponse error = new ErrorResponse(&amp;#34;NOT_FOUND&amp;#34;, ex.getMessage());
// è¿”å›HTTPçŠ¶æ€ç ä¸º404çš„å“åº”
return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
}
// å¤„ç†å‚æ•°éæ³•å¼‚å¸¸
@ExceptionHandler(IllegalArgumentException.class)
public ResponseEntity&amp;lt;ErrorResponse&amp;gt; handleIllegalArgument(IllegalArgumentException ex) {
ErrorResponse error = new ErrorResponse(&amp;#34;BAD_REQUEST&amp;#34;, ex.getMessage());
return ResponseEntity.badRequest().body(error); // HTTP 400
}
// ä½œä¸ºä¸€ä¸ªå…œåº•æ–¹æ¡ˆï¼Œå¤„ç†æ‰€æœ‰å…¶ä»–æœªæ˜ç¡®æ•è·çš„å¼‚å¸¸
@ExceptionHandler(Exception.class)
public ResponseEntity&amp;lt;ErrorResponse&amp;gt; handleGenericException(Exception ex) {
ErrorResponse error = new ErrorResponse(&amp;#34;INTERNAL_SERVER_ERROR&amp;#34;, &amp;#34;æœåŠ¡å™¨å¼€å°å·®äº†ï¼Œè¯·ç¨åå†è¯•&amp;#34;);
return ResponseEntity.internalServerError().body(error); // HTTP 500
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä»£ç è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ExceptionHandler&lt;/code&gt;æ³¨è§£ç”¨äºæ ‡è®°å¤„ç†ç‰¹å®šå¼‚å¸¸çš„æ–¹æ³•ã€‚å½“æ§åˆ¶å™¨ä¸­æŠ›å‡ºç›¸åº”ç±»å‹çš„å¼‚å¸¸æ—¶ï¼ŒSpringä¼šè°ƒç”¨æ­¤æ–¹æ³•æ¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•çš„è¿”å›å€¼é€šå¸¸æ˜¯ä¸€ä¸ª &lt;code&gt;ResponseEntity&lt;/code&gt;å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è®¾ç½®HTTPçŠ¶æ€ç å’Œå“åº”ä½“ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„POJOå¯¹è±¡ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºJSONã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‰€æœ‰ç±»ä¼¼çš„å¼‚å¸¸éƒ½ä¼šä»¥ç»Ÿä¸€çš„JSONæ ¼å¼è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¤§å¤§æå‡äº†APIçš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…¨å±€æ•°æ®ç»‘å®šç¤ºä¾‹"&gt;å…¨å±€æ•°æ®ç»‘å®šç¤ºä¾‹
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice
public class GlobalDataAdvice {
// æ­¤æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰è¢«è°ƒç”¨ï¼Œå¹¶å‘æ¨¡å‹ä¸­æ·»åŠ ä¸€ä¸ªåä¸º&amp;#34;commonData&amp;#34;çš„å±æ€§
@ModelAttribute(&amp;#34;commonData&amp;#34;)
public Map&amp;lt;String, Object&amp;gt; addCommonData() {
Map&amp;lt;String, Object&amp;gt; data = new HashMap&amp;lt;&amp;gt;();
data.put(&amp;#34;appName&amp;#34;, &amp;#34;My Awesome App&amp;#34;);
data.put(&amp;#34;version&amp;#34;, &amp;#34;1.0.0&amp;#34;);
data.put(&amp;#34;company&amp;#34;, &amp;#34;Example Corp&amp;#34;);
return data;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä»£ç è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ModelAttribute&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•å¯ä»¥ç”¨äºå‘æ‰€æœ‰æ§åˆ¶å™¨çš„æ¨¡å‹ä¸­æ·»åŠ å…¬å…±æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·ï¼Œåœ¨æ¯ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡æ¨¡å‹è·å–åˆ°è¿™äº›å…¬å…±æ•°æ®ï¼Œæ— éœ€é‡å¤ç¼–å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ§åˆ¶ä½œç”¨èŒƒå›´"&gt;ğŸ“‹ æ§åˆ¶ä½œç”¨èŒƒå›´
&lt;/h3&gt;&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;æ³¨è§£çš„å‚æ•°æ¥ç²¾ç»†æ§åˆ¶å…¶ç”Ÿæ•ˆçš„æ§åˆ¶å™¨èŒƒå›´ï¼Œé¿å…â€œä¸€åˆ€åˆ‡â€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;basePackages&lt;/code&gt;ï¼šæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…åï¼Œåªæœ‰è¿™äº›åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ§åˆ¶å™¨æ‰ä¼šè¢«è¯¥ advice å¤„ç†ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice(basePackages = &amp;#34;com.example.api.controllers&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;assignableTypes&lt;/code&gt;ï¼šæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ§åˆ¶å™¨ç±»ï¼Œåªæœ‰è¿™äº›ç‰¹å®šçš„æ§åˆ¶å™¨æ‰ä¼šè¢«å¤„ç†ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice(assignableTypes = {UserController.class, ProductController.class})
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„äº‹é¡¹"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒ…æ‰«æè·¯å¾„&lt;/strong&gt;ï¼šç¡®ä¿ä½ çš„ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;ç±»ä½äº Spring Boot åº”ç”¨ç¨‹åºçš„ç»„ä»¶æ‰«æè·¯å¾„ä¹‹ä¸‹ï¼Œå¦åˆ™ Spring æ— æ³•å‘ç°å¹¶æ³¨å†Œå®ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸åŒ¹é…ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“å¤šä¸ª &lt;code&gt;@ExceptionHandler&lt;/code&gt;æ–¹æ³•éƒ½èƒ½å¤„ç†åŒä¸€ä¸ªå¼‚å¸¸æ—¶ï¼Œ&lt;strong&gt;æœ€å…·ä½“ï¼ˆå¼‚å¸¸ç±»å±‚æ¬¡æœ€æ·±ï¼‰çš„å¤„ç†å™¨ä¼šä¼˜å…ˆæ‰§è¡Œ&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œå¤„ç† &lt;code&gt;IOException&lt;/code&gt;çš„æ–¹æ³•å’Œå¤„ç† &lt;code&gt;FileNotFoundException&lt;/code&gt;ï¼ˆå®ƒæ˜¯&lt;code&gt;IOException&lt;/code&gt;çš„å­ç±»ï¼‰çš„æ–¹æ³•åŒæ—¶å­˜åœ¨æ—¶ï¼Œå¯¹äº&lt;code&gt;FileNotFoundException&lt;/code&gt;ï¼Œä¼šä¼˜å…ˆåŒ¹é…åè€…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä¸ª @RestControllerAdvice ç±»&lt;/strong&gt;ï¼šä½ å¯ä»¥å®šä¹‰å¤šä¸ª &lt;code&gt;@RestControllerAdvice&lt;/code&gt;ç±»æ¥æŒ‰æ¨¡å—æˆ–åŠŸèƒ½åˆ†ç±»å¤„ç†å¼‚å¸¸ã€‚å¯ä»¥é€šè¿‡ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥æŒ‡å®šå®ƒä»¬çš„ä¼˜å…ˆçº§ï¼Œ order å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ä¼ ç»Ÿ MVC çš„åŒºåˆ«&lt;/strong&gt;ï¼šå¦‚æœä½ å¼€å‘çš„æ˜¯ä¼ ç»Ÿçš„ã€éœ€è¦è¿”å›è§†å›¾ï¼ˆå¦‚ JSP, Thymeleafï¼‰çš„ MVC åº”ç”¨ï¼Œå¹¶ä¸”å¼‚å¸¸å¤„ç†éœ€è¦è·³è½¬åˆ°ç‰¹å®šçš„é”™è¯¯é¡µé¢ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ &lt;code&gt;@ControllerAdvice&lt;/code&gt;è€Œä¸æ˜¯ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;ï¼Œå› ä¸ºåè€…ä¼šç›´æ¥å°†è¿”å›å¯¹è±¡å†™å…¥å“åº”ä½“ï¼Œè€Œä¸ä¼šè¿›è¡Œè§†å›¾è§£æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯"&gt;ğŸ’¡ åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice éå¸¸é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šå¤„ç† &lt;code&gt;IllegalArgumentException&lt;/code&gt;ã€&lt;code&gt;NullPointerException&lt;/code&gt;ç­‰å¸¸è§å¼‚å¸¸ï¼Œè¿”å›æ ‡å‡†é”™è¯¯æ ¼å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•æ„Ÿä¿¡æ¯è¿‡æ»¤&lt;/strong&gt;ï¼šåœ¨å“åº”å‰å¯¹æ•°æ®è¿›è¡Œè„±æ•å¤„ç†ï¼ˆå¦‚éšè—ç”¨æˆ·å¯†ç ï¼‰ï¼Œè¿™é€šå¸¸éœ€è¦é…åˆ &lt;code&gt;ResponseBodyAdvice&lt;/code&gt;æ¥å£æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™æ ¡éªŒ&lt;/strong&gt;ï¼šæ‹¦æˆªæœªæˆæƒè¯·æ±‚ï¼Œè¿”å› 403 å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;API ç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥&lt;/strong&gt;ï¼šä¸ºæ‰€æœ‰å“åº”ä½“è‡ªåŠ¨æ·»åŠ å…¬å…±å­—æ®µï¼Œå¦‚æ¥å£ç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ“š æ€»ç»“
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice æ˜¯ Spring æ¡†æ¶ä¸º &lt;strong&gt;RESTful API&lt;/strong&gt; è®¾è®¡çš„å…¨å±€å¢å¼ºå·¥å…·ï¼Œé€šè¿‡&lt;strong&gt;é›†ä¸­å¤„ç†å¼‚å¸¸ã€æ•°æ®ç»‘å®šå’Œé¢„å¤„ç†&lt;/strong&gt;ï¼Œå®ƒèƒ½æœ‰æ•ˆåœ°ä½¿ä¸šåŠ¡é€»è¾‘ä¸æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚å¼‚å¸¸å¤„ç†ï¼‰è§£è€¦ï¼Œè®©ä»£ç æ›´åŠ ç®€æ´ã€å¯ç»´æŠ¤ï¼Œç‰¹åˆ«é€‚åˆå¾®æœåŠ¡æ¶æ„æˆ–å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå¸®åŠ©å¼€å‘è€…ç»Ÿä¸€æ¥å£å“åº”æ ¼å¼ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;åªéœ€å®šä¹‰ä¸€ä¸ªç±»å¹¶åŠ ä¸Š &lt;code&gt;@RestControllerAdvice&lt;/code&gt;æ³¨è§£ï¼Œå†é…åˆ &lt;code&gt;@ExceptionHandler&lt;/code&gt;ã€&lt;code&gt;@ModelAttribute&lt;/code&gt;ç­‰æ³¨è§£ï¼Œå°±èƒ½è½»æ¾å®ç°å…¨å±€å¤„ç†é€»è¾‘ã€‚&lt;/p&gt;
&lt;h2 id="å®¡è®¡"&gt;å®¡è®¡
&lt;/h2&gt;&lt;p&gt;Springæ¡†æ¶æä¾›äº†å¤šç§æ³¨è§£æ¥æ”¯æŒæ•°æ®å®¡è®¡åŠŸèƒ½ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§æµæ´¾ï¼š&lt;strong&gt;Spring Data JPAæä¾›çš„åŸºç¡€å®¡è®¡æ³¨è§£&lt;/strong&gt;å’Œ&lt;strong&gt;Hibernate Enversæä¾›çš„å†å²è¿½è¸ªä¸ç‰ˆæœ¬åŒ–å®¡è®¡æ³¨è§£&lt;/strong&gt;ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼å¸®ä½ å¿«é€Ÿäº†è§£å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«å’Œä¸»è¦æ³¨è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;Spring Data JPA åŸºç¡€å®¡è®¡&lt;/th&gt;
&lt;th&gt;Hibernate Envers å†å²å®¡è®¡ (å€ŸåŠ© &lt;code&gt;@Audited&lt;/code&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæ³¨è§£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@CreatedDate&lt;/code&gt;, &lt;code&gt;@LastModifiedDate&lt;/code&gt;, &lt;code&gt;@CreatedBy&lt;/code&gt;, &lt;code&gt;@LastModifiedBy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Audited&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨å¡«å……&lt;/strong&gt;å®ä½“çš„åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹äººç­‰åŸºç¡€å­—æ®µ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®°å½•å®ä½“æ‰€æœ‰å˜æ›´çš„å®Œæ•´å†å²&lt;/strong&gt;ï¼Œå¯è¿½æº¯ä»»ä½•æ—¶é—´ç‚¹çš„æ•°æ®çŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®¡è®¡ä¿¡æ¯å­˜å‚¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸å®ä½“æœ¬èº«å­˜å‚¨åœ¨&lt;strong&gt;åŒä¸€å¼ è¡¨&lt;/strong&gt;çš„é¢å¤–å­—æ®µé‡Œ&lt;/td&gt;
&lt;td&gt;åœ¨&lt;strong&gt;å•ç‹¬çš„å®¡è®¡è¡¨&lt;/strong&gt;ï¼ˆé€šå¸¸ä»¥ &lt;code&gt;_AUD&lt;/code&gt;ç»“å°¾ï¼‰ä¸­åˆ›å»ºå†å²è®°å½•ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®è¿½æº¯èƒ½åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…èƒ½çœ‹åˆ°&lt;strong&gt;å½“å‰çš„æœ€æ–°çŠ¶æ€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯æŸ¥è¯¢&lt;strong&gt;ä»»ä½•å†å²ä¿®è®¢ç‰ˆæœ¬&lt;/strong&gt;ï¼Œæ”¯æŒæŒ‰æ—¶é—´æˆ–ç‰ˆæœ¬å·å›æº¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…³é”®ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;spring-boot-starter-data-jpa&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;hibernate-envers&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•æ•°æ®æ¡ç›®çš„åˆ›å»ºå’Œæ›´æ–°ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;éœ€è¦æ»¡è¶³å¼ºåˆè§„æ€§è¦æ±‚ã€è¿½è¸ªæ•°æ®å®Œæ•´å˜æ›´å†å²ã€å®ç°æ•°æ®ç‰ˆæœ¬æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨è§£&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="-spring-data-jpa-åŸºç¡€å®¡è®¡"&gt;ğŸ“ Spring Data JPA åŸºç¡€å®¡è®¡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨å®¡è®¡&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡è®°å®ä½“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å®ä½“ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨éœ€è¦çš„å­—æ®µä¸Šæ·»åŠ å®¡è®¡æ³¨è§£ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@CreatedDate
@Column(name = &amp;#34;create_time&amp;#34;, updatable = false)
private LocalDateTime createTime;
@LastModifiedDate
@Column(name = &amp;#34;update_time&amp;#34;)
private LocalDateTime updateTime;
@CreatedBy
@Column(name = &amp;#34;creator&amp;#34;, updatable = false)
private String creator;
@LastModifiedBy
@Column(name = &amp;#34;modifier&amp;#34;)
private String modifier;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æä¾›å®¡è®¡è€…ä¿¡æ¯&lt;/strong&gt;ï¼ˆå¦‚æœä½¿ç”¨äº† &lt;code&gt;@CreatedBy&lt;/code&gt;æˆ– &lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼‰ï¼šå®ç° &lt;code&gt;AuditorAware&lt;/code&gt;æ¥å£å¹¶å°†å…¶æ³¨å…¥å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œç»“åˆ Spring Security è·å–å½“å‰ç”¨æˆ·åï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class SpringSecurityAuditorAware implements AuditorAware&amp;lt;String&amp;gt; {
@Override
public Optional&amp;lt;String&amp;gt; getCurrentAuditor() {
// ä»å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è·å–å½“å‰è®¤è¯çš„ç”¨æˆ·å
Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
if (authentication == null || !authentication.isAuthenticated()) {
return Optional.empty();
}
return Optional.ofNullable(authentication.getName());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-hibernate-envers-å†å²å®¡è®¡"&gt;ğŸ” Hibernate Envers å†å²å®¡è®¡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ  Envers ä¾èµ–ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.hibernate&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;hibernate-envers&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡è®°éœ€è¦å†å²å®¡è®¡çš„å®ä½“&lt;/strong&gt;ï¼šåœ¨å®ä½“ç±»ä¸Šæ·»åŠ  &lt;code&gt;@Audited&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Entity
@Audited // å¢åŠ æ­¤æ³¨è§£
public class YourEntity {
// ... å­—æ®µå®šä¹‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢å®¡è®¡å†å²&lt;/strong&gt;ï¼šé€šè¿‡ç»§æ‰¿ &lt;code&gt;RevisionRepository&lt;/code&gt;çš„æ¥å£è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface YourEntityAuditRepository extends RevisionRepository&amp;lt;YourEntity, Long, Integer&amp;gt; {
List&amp;lt;Revision&amp;lt;Integer, YourEntity&amp;gt;&amp;gt; findRevisionsById(Long id);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å®ç”¨å»ºè®®"&gt;ğŸ’¡ å®ç”¨å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºç¡€å®¡è®¡&lt;/strong&gt;é€‚ç”¨äºå¤§å¤šæ•°éœ€è¦ç®€å•è®°å½•åˆ›å»º/æ›´æ–°ä¿¡æ¯çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†å²å®¡è®¡&lt;/strong&gt; (&lt;code&gt;@Audited&lt;/code&gt;) åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†ä¼šç”Ÿæˆé¢å¤–çš„å®¡è®¡è¡¨ï¼Œé€‚åˆå¯¹æ•°æ®å˜æ›´è¿½è¸ªæœ‰ä¸¥æ ¼è¦æ±‚ï¼ˆå¦‚åˆè§„æ€§è¦æ±‚é«˜ï¼‰çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@CreatedBy&lt;/code&gt;å’Œ &lt;code&gt;@LastModifiedBy&lt;/code&gt;æ—¶ï¼Œç¡®ä¿æ­£ç¡®å®ç° &lt;code&gt;AuditorAware&lt;/code&gt;æ¥å£ä»¥æä¾›å½“å‰çš„å®¡è®¡è€…ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å®¡è®¡åŠŸèƒ½å¯¹äº&lt;strong&gt;é—®é¢˜æ’æŸ¥&lt;/strong&gt;ã€&lt;strong&gt;å®‰å…¨åˆ†æ&lt;/strong&gt;å’Œ&lt;strong&gt;æ»¡è¶³åˆè§„æ€§è¦æ±‚&lt;/strong&gt;éå¸¸æœ‰å¸®åŠ©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°åœ¨Springé¡¹ç›®ä¸­åº”ç”¨å®¡è®¡åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id="entitylistener"&gt;@EntityListener
&lt;/h2&gt;&lt;p&gt;@EntityListeners æ˜¯ JPAï¼ˆJava Persistence APIï¼‰ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼Œä¸»è¦ç”¨äº&lt;strong&gt;ç›‘å¬å®ä½“ç±»çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶&lt;/strong&gt;ï¼ˆå¦‚åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€åŠ è½½ç­‰ï¼‰ï¼Œå¹¶åœ¨è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶&lt;strong&gt;è‡ªåŠ¨æ‰§è¡ŒæŒ‡å®šçš„å›è°ƒé€»è¾‘&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿäº†è§£å®ƒæ”¯æŒç›‘å¬å“ªäº›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PrePersist&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢« &lt;code&gt;EntityManager&lt;/code&gt;çš„ &lt;code&gt;persist()&lt;/code&gt;æ–¹æ³•æŒä¹…åŒ–ï¼ˆæ–°å¢ï¼‰&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostPersist&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«æŒä¹…åŒ–ï¼ˆæ–°å¢ï¼‰&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PreUpdate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«æ›´æ–°ï¼ˆUPDATEæ“ä½œï¼‰&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostUpdate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«æ›´æ–°&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PreRemove&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢« &lt;code&gt;EntityManager&lt;/code&gt;çš„ &lt;code&gt;remove()&lt;/code&gt;æ–¹æ³•åˆ é™¤&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostRemove&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«åˆ é™¤&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostLoad&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“ä»æ•°æ®åº“è¢«åŠ è½½ï¼ˆSELECTæ“ä½œï¼‰æˆ–åˆ·æ–°ï¼ˆrefreshï¼‰&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•ä½¿ç”¨-entitylisteners"&gt;ğŸ”§ å¦‚ä½•ä½¿ç”¨ @EntityListeners
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ç›‘å¬å™¨ç±»&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»ï¼Œåœ¨å…¶ä¸­å®šä¹‰æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ä¸Šè¡¨ä¸­çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ³¨è§£æ¥æŒ‡å®šè¿™äº›æ–¹æ³•åœ¨ä½•æ—¶è§¦å‘ã€‚è¿™äº›æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»ä¸º &lt;code&gt;void&lt;/code&gt;ï¼Œå¹¶ä¸”æ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆå‚æ•°ç±»å‹ä¸ºæ‰€è¦ç›‘å¬çš„å®ä½“ç±»å‹ï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class MyEntityListener {
@PrePersist
public void beforeSave(MyEntity entity) {
System.out.println(&amp;#34;å³å°†ä¿å­˜å®ä½“: &amp;#34; + entity.getId());
// å¯ä»¥åœ¨æ­¤å¤„è®¾ç½®åˆ›å»ºæ—¶é—´ã€åˆå§‹åŒ–çŠ¶æ€ç­‰
}
@PostUpdate
public void afterUpdate(MyEntity entity) {
System.out.println(&amp;#34;å®ä½“å·²æ›´æ–°: &amp;#34; + entity.getId());
// å¯ä»¥è®°å½•æ›´æ–°æ—¥å¿—ã€å‘é€é€šçŸ¥ç­‰
}
// å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å°†ç›‘å¬å™¨å…³è”åˆ°å®ä½“&lt;/strong&gt;ï¼šåœ¨éœ€è¦è¢«ç›‘å¬çš„å®ä½“ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@EntityListeners&lt;/code&gt;æ³¨è§£ï¼Œå¹¶æŒ‡å®šç›‘å¬å™¨ç±»ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Entity
@EntityListeners(MyEntityListener.class) // å¯ä»¥æŒ‡å®šå¤šä¸ªç›‘å¬å™¨ï¼Œå¦‚ {Listener1.class, Listener2.class}
public class MyEntity {
@Id
@GeneratedValue
private Long id;
// ... å…¶ä»–å­—æ®µå’Œæ–¹æ³•
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;(å¯é€‰) å¯ç”¨å®¡è®¡åŠŸèƒ½&lt;/strong&gt;ï¼šå¦‚æœä½ ä½¿ç”¨ Spring Data JPA çš„å®¡è®¡åŠŸèƒ½ï¼ˆå¦‚è‡ªåŠ¨å¡«å…… &lt;code&gt;@CreatedDate&lt;/code&gt;ã€&lt;code&gt;@LastModifiedDate&lt;/code&gt;ã€&lt;code&gt;@CreatedBy&lt;/code&gt;ã€&lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼‰ï¼Œé™¤äº†éœ€è¦ &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt;ï¼Œè¿˜éœ€åœ¨é…ç½®ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ¥å¯ç”¨å®¡è®¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å®ç”¨ç¤ºä¾‹è‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—"&gt;ğŸ’¡ å®ç”¨ç¤ºä¾‹ï¼šè‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·ä¿¡æ¯ï¼ˆUserEntityï¼‰è¢«æ›´æ–°åè‡ªåŠ¨è®°å½•ä¸€æ¡å®¡è®¡æ—¥å¿—ï¼Œå¯ä»¥è¿™æ ·åšï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æ—¥å¿—ç›‘å¬å™¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class UserAuditListener {
private static final Logger log = LoggerFactory.getLogger(UserAuditListener.class);
@PostUpdate
public void auditUserUpdate(UserEntity user) {
log.info(&amp;#34;ç”¨æˆ· {} çš„ä¿¡æ¯äº {} è¢«ä¿®æ”¹&amp;#34;, user.getId(), LocalDateTime.now());
// å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œå¯ä»¥å°†æ—¥å¿—å†™å…¥æ•°æ®åº“çš„å®¡è®¡è¡¨ï¼Œæˆ–å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ç­‰
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ç”¨æˆ·å®ä½“ä¸Šå…³è”ç›‘å¬å™¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Entity
@EntityListeners({AuditingEntityListener.class, UserAuditListener.class}) // å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç›‘å¬å™¨
@Table(name = &amp;#34;user&amp;#34;)
public class UserEntity {
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
private String username;
// ... å…¶ä»–å­—æ®µã€getterå’Œsetter
// å‡è®¾è¿™é‡Œè¿˜æœ‰ @CreatedDate, @LastModifiedDate ç­‰å®¡è®¡å­—æ®µ
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·ï¼Œæ¯å½“ä¸€ä¸ª &lt;code&gt;UserEntity&lt;/code&gt;å®ä¾‹è¢«æ›´æ–°åï¼Œ&lt;code&gt;auditUserUpdate&lt;/code&gt;æ–¹æ³•å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œè®°å½•ä¸‹å®¡è®¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬å™¨æ–¹æ³•çš„å‚æ•°&lt;/strong&gt;ï¼šç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ­¤å‚æ•°ä»£è¡¨&lt;strong&gt;æ­£åœ¨ç»å†è¯¥ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„å®ä½“å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼šè¿™äº›å›è°ƒæ–¹æ³•é€šå¸¸åœ¨&lt;strong&gt;ä¸å®ä½“æ“ä½œç›¸åŒçš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å½±å“&lt;/strong&gt;ï¼šå¦‚æœåœ¨ &lt;code&gt;@PrePersist&lt;/code&gt;, &lt;code&gt;@PreUpdate&lt;/code&gt;, &lt;code&gt;@PreRemove&lt;/code&gt;ç­‰æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½ä¼š&lt;strong&gt;é˜»æ­¢åç»­æ•°æ®åº“æ“ä½œçš„å‘ç”Ÿ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@EntityListeners&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="enablejpaauditing"&gt;@EnableJpaAuditing
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ³¨è§£æ˜¯ Spring Data JPA å®¡è®¡åŠŸèƒ½çš„&lt;strong&gt;æ€»å¼€å…³&lt;/strong&gt;ğŸ”Œã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯&lt;strong&gt;æ¿€æ´»ä¸€å¥—è‡ªåŠ¨å¡«å……å®ä½“å®¡è®¡å­—æ®µçš„æœºåˆ¶&lt;/strong&gt;ï¼Œè®©ä½ æ— éœ€åœ¨æ¯æ¬¡ä¿å­˜æˆ–æ›´æ–°æ•°æ®æ—¶æ‰‹åŠ¨è®¾ç½®è¯¸å¦‚åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹äººè¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿäº†è§£å®ƒçš„ä¸»è¦åŠŸèƒ½ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åŠŸèƒ½ç»´åº¦&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¿€æ´»å®¡è®¡ç›‘å¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯ç”¨ &lt;code&gt;AuditingEntityListener&lt;/code&gt;ï¼Œä½¿å…¶èƒ½å¤Ÿç›‘å¬å®ä½“ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¦‚ &lt;code&gt;@PrePersist&lt;/code&gt;, &lt;code&gt;@PreUpdate&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨å¡«å…… &lt;code&gt;@CreatedDate&lt;/code&gt;, &lt;code&gt;@LastModifiedDate&lt;/code&gt;ç­‰å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æä¾›å®¡è®¡è€…ä¿¡æ¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;auditorAwareRef&lt;/code&gt;å‚æ•°æŒ‡å®šä¸€ä¸ª &lt;code&gt;AuditorAware&lt;/code&gt;Beanï¼Œä¸º &lt;code&gt;@CreatedBy&lt;/code&gt;å’Œ &lt;code&gt;@LastModifiedBy&lt;/code&gt;æä¾›å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/td&gt;
&lt;td&gt;è®°å½•æ•°æ®æ˜¯ç”±å“ªä¸ªç”¨æˆ·åˆ›å»ºæˆ–ä¿®æ”¹çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰æ—¶é—´æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;dateTimeProviderRef&lt;/code&gt;å‚æ•°æŒ‡å®šä¸€ä¸ª &lt;code&gt;DateTimeProvider&lt;/code&gt;Beanï¼Œè‡ªå®šä¹‰å®¡è®¡æ—¶é—´çš„è·å–æ–¹å¼ï¼ˆå¦‚ç»Ÿä¸€æ—¶åŒºï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;ç¡®ä¿æ‰€æœ‰å®¡è®¡æ—¶é—´éƒ½ä½¿ç”¨ç»Ÿä¸€çš„æ—¶åŒºï¼ˆå¦‚ UTCï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶æ—¥æœŸè®¾ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;setDates&lt;/code&gt;å‚æ•°æ§åˆ¶æ˜¯å¦è‡ªåŠ¨è®¾ç½®æ—¥æœŸå­—æ®µï¼ˆé»˜è®¤ä¸º &lt;code&gt;true&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;æµ‹è¯•æ—¶å¯èƒ½éœ€è¦ä¸´æ—¶å…³é—­æ—¥æœŸè‡ªåŠ¨è®¾ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å…³äºå®ƒå¦‚ä½•å·¥ä½œä»¥åŠå¦‚ä½•é…ç½®çš„è¯¦ç»†è¯´æ˜ã€‚&lt;/p&gt;
&lt;h3 id="-1-æ ¸å¿ƒä½œç”¨ä¸å·¥ä½œåŸç†"&gt;ğŸ“Š 1. æ ¸å¿ƒä½œç”¨ä¸å·¥ä½œåŸç†
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ä¸»è¦ç”¨æ¥&lt;strong&gt;æ¿€æ´» Spring Data JPA çš„å®¡è®¡åŠŸèƒ½&lt;/strong&gt;ã€‚ä¸€æ—¦å¯ç”¨ï¼Œå½“å®ä½“å¯¹è±¡è¢«æŒä¹…åŒ–ï¼ˆæ–°å¢ï¼‰æˆ–æ›´æ–°æ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨å¡«å……æ ‡è®°äº†ç‰¹å®šå®¡è®¡æ³¨è§£çš„å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®æœºåˆ¶ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨å¡«å……å­—æ®µ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@CreatedDate&lt;/code&gt;, &lt;code&gt;@LastModifiedDate&lt;/code&gt;, &lt;code&gt;@CreatedBy&lt;/code&gt;, &lt;code&gt;@LastModifiedBy&lt;/code&gt;ç­‰æ³¨è§£æ ‡è®°çš„å­—æ®µï¼Œå…¶å€¼ä¼šåœ¨æ•°æ®åˆ›å»ºæˆ–æ›´æ–°æ—¶ç”±æ¡†æ¶è‡ªåŠ¨å¡«å……ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬å®ä½“ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼šæ­¤åŠŸèƒ½ä¾èµ–äº &lt;code&gt;AuditingEntityListener&lt;/code&gt;æ¥ç›‘å¬å®ä½“çš„æŒä¹…åŒ–ï¼ˆ&lt;code&gt;@PrePersist&lt;/code&gt;ï¼‰å’Œæ›´æ–°ï¼ˆ&lt;code&gt;@PreUpdate&lt;/code&gt;ï¼‰ç­‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-2-é…ç½®è¯´æ˜"&gt;âš™ï¸ 2. é…ç½®è¯´æ˜
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;é€šå¸¸æ”¾ç½®åœ¨ Spring Boot çš„ä¸»é…ç½®ç±»ä¸Šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableJpaAuditing // å¯ç”¨JPAå®¡è®¡åŠŸèƒ½
public class DemoApplication {
public static void main(String[] args) {
SpringApplication.run(DemoApplication.class, args);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-3-è®°å½•æ“ä½œç”¨æˆ·createdby-lastmodifiedby"&gt;ğŸ‘¤ 3. è®°å½•æ“ä½œç”¨æˆ·ï¼ˆ&lt;code&gt;@CreatedBy&lt;/code&gt;/ &lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥è¦è‡ªåŠ¨è®°å½•æ•°æ®çš„åˆ›å»ºè€…å’Œæœ€åä¿®æ”¹è€…ï¼Œä½ éœ€è¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç° &lt;code&gt;AuditorAware&lt;/code&gt;æ¥å£&lt;/strong&gt;ï¼šæ­¤æ¥å£ç”¨äºè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class SpringSecurityAuditorAware implements AuditorAware&amp;lt;String&amp;gt; {
@Override
public Optional&amp;lt;String&amp;gt; getCurrentAuditor() {
// ä»å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è·å–å½“å‰è®¤è¯çš„ç”¨æˆ·å
Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
if (authentication == null || !authentication.isAuthenticated()) {
return Optional.empty();
}
return Optional.ofNullable(authentication.getName());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ä¸­å¼•ç”¨&lt;/strong&gt;ï¼ˆå¦‚æœéœ€è¦æ˜ç¡®æŒ‡å®š Beanï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableJpaAuditing(auditorAwareRef = &amp;#34;springSecurityAuditorAware&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-4-è‡ªå®šä¹‰æ—¥æœŸä¸æ—¶é—´æä¾›è€…"&gt;ğŸ• 4. è‡ªå®šä¹‰æ—¥æœŸä¸æ—¶é—´æä¾›è€…
&lt;/h3&gt;&lt;p&gt;ä½ å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;DateTimeProvider&lt;/code&gt;æ¥å£æ¥è‡ªå®šä¹‰å®¡è®¡æ—¶é—´çš„æ¥æºï¼Œä¾‹å¦‚ç»Ÿä¸€ä½¿ç”¨ UTC æ—¶é—´æˆ–ç‰¹å®šæ—¶åŒºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class CustomDateTimeProvider implements DateTimeProvider {
@Override
public Optional&amp;lt;TemporalAccessor&amp;gt; getNow() {
// è¿”å›å½“å‰UTCæ—¶é—´
return Optional.of(Instant.now());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¹¶åœ¨é…ç½®ä¸­æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableJpaAuditing(dateTimeProviderRef = &amp;#34;customDateTimeProvider&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-5-æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜"&gt;ğŸ’¡ 5. æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åŸºç±»ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@MappedSuperclass&lt;/code&gt;åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å®¡è®¡å­—æ®µçš„åŸºç±»ï¼Œè®©å…¶ä»–å®ä½“ç±»ç»§æ‰¿ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ¯ä¸ªå®ä½“ä¸­é‡å¤å®šä¹‰è¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class AuditableEntity {
@CreatedDate
@Column(name = &amp;#34;created_date&amp;#34;, updatable = false)
private LocalDateTime createdDate;
@LastModifiedDate
@Column(name = &amp;#34;last_modified_date&amp;#34;)
private LocalDateTime lastModifiedDate;
// ... å…¶ä»–å®¡è®¡å­—æ®µï¼ˆå¦‚@CreatedBy, @LastModifiedByï¼‰åŠå…¶getter/setter
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¶é—´å­—æ®µç±»å‹&lt;/strong&gt;ï¼šå®¡è®¡æ—¶é—´å­—æ®µæ”¯æŒå¤šç§ç±»å‹ï¼Œå¦‚ &lt;code&gt;Date&lt;/code&gt;ã€&lt;code&gt;Calendar&lt;/code&gt;ã€&lt;code&gt;Long&lt;/code&gt;ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œä»¥åŠ Java 8 çš„ &lt;code&gt;LocalDateTime&lt;/code&gt;ã€&lt;code&gt;Instant&lt;/code&gt;ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸¸è§é—®é¢˜æ’æŸ¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¡è®¡å­—æ®µæœªè‡ªåŠ¨å¡«å……&lt;/strong&gt;ï¼šé¦–å…ˆæ£€æŸ¥æ˜¯å¦æ·»åŠ äº† &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ³¨è§£ï¼Œå®ä½“ç±»æ˜¯å¦ä½¿ç”¨äº† &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt;ï¼Œä»¥åŠå­—æ®µä¸Šçš„å®¡è®¡æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@CreatedDate&lt;/code&gt;ï¼‰æ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶åŒºé—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœé‡åˆ°æ—¶é—´æ—¶åŒºä¸ä¸€è‡´ï¼Œå¯ä»¥è€ƒè™‘å®ç°è‡ªå®šä¹‰çš„ &lt;code&gt;DateTimeProvider&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ“Œ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ³¨è§£æ˜¯ Spring Data JPA å®¡è®¡åŠŸèƒ½çš„&lt;strong&gt;æ ¸å¿ƒé…ç½®&lt;/strong&gt;ã€‚å®ƒé€šè¿‡&lt;strong&gt;è‡ªåŠ¨å¡«å……&lt;/strong&gt;å®¡è®¡å­—æ®µï¼Œå¤§å¤§ç®€åŒ–äº†å¯¹æ•°æ®åˆ›å»ºå’Œä¿®æ”¹ä¿¡æ¯çš„è·Ÿè¸ªï¼Œæå‡äº†å¼€å‘æ•ˆç‡ï¼Œå¹¶å¢å¼ºäº†æ•°æ®çš„å¯è¿½æº¯æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="transational"&gt;@Transational
&lt;/h2&gt;&lt;p&gt;Spring Boot ä¸­å¤„ç†æ•°æ®åº“äº‹åŠ¡ï¼Œä¸»è¦ç”¨çš„æ˜¯ &lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt; è¿™ä¸ªæ³¨è§£ã€‚å®ƒé€šå¸¸æ ‡æ³¨åœ¨&lt;strong&gt;æœåŠ¡å±‚ï¼ˆServiceï¼‰&lt;/strong&gt; çš„ç±»æˆ–æ–¹æ³•ä¸Šï¼Œç”¨æ¥å°†ä¸€ç³»åˆ—æ•°æ®åº“æ“ä½œç»‘æˆä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼å¸®ä½ å¿«é€Ÿäº†è§£è¿™äº›æ³¨è§£å’Œå±æ€§ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£/å±æ€§&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨å€¼/ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒäº‹åŠ¡æ³¨è§£&lt;/strong&gt;ï¼Œå¯åº”ç”¨äºç±»æˆ–æ–¹æ³•ä¸Šã€‚æ ‡æ³¨åœ¨ç±»ä¸Šæ—¶ï¼Œè¯¥ç±»æ‰€æœ‰&lt;strong&gt;public&lt;/strong&gt;æ–¹æ³•éƒ½ä¼šå¼€å¯äº‹åŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Transactional&lt;/code&gt; &lt;code&gt;@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;propagation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸º&lt;/strong&gt;ï¼Œå®šä¹‰æ–¹æ³•å¦‚ä½•å‚ä¸æˆ–åˆ›å»ºäº‹åŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Propagation.REQUIRED&lt;/code&gt;(é»˜è®¤) &lt;code&gt;Propagation.REQUIRES_NEW&lt;/code&gt; &lt;code&gt;Propagation.NESTED&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isolation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/strong&gt;ï¼Œæ§åˆ¶äº‹åŠ¡é—´çš„å¯è§æ€§ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Isolation.DEFAULT&lt;/code&gt;(é»˜è®¤) &lt;code&gt;Isolation.READ_COMMITTED&lt;/code&gt; &lt;code&gt;Isolation.REPEATABLE_READ&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;timeout&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡è¶…æ—¶æ—¶é—´&lt;/strong&gt;ï¼ˆç§’ï¼‰ï¼Œè¶…è¿‡è¯¥æ—¶é—´äº‹åŠ¡æœªå®Œæˆåˆ™è‡ªåŠ¨å›æ»šã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;timeout = 5&lt;/code&gt;(5ç§’)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;readOnly&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šäº‹åŠ¡æ˜¯å¦ä¸º&lt;strong&gt;åªè¯»&lt;/strong&gt;ã€‚ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;readOnly = true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rollbackFor&lt;/code&gt; &lt;code&gt;noRollbackFor&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šå“ªäº›&lt;strong&gt;å¼‚å¸¸è§¦å‘å›æ»š&lt;/strong&gt;æˆ–&lt;strong&gt;ä¸è§¦å‘å›æ»š&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;rollbackFor = Exception.class&lt;/code&gt; &lt;code&gt;noRollbackFor = RuntimeException.class&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@EnableTransactionManagement&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ç”¨æ³¨è§£å¼äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼Œé€šå¸¸æ”¾åœ¨ä¸»é…ç½®ç±»æˆ–å¯åŠ¨ç±»ä¸Šã€‚&lt;strong&gt;Spring Boot é»˜è®¤å·²å¯ç”¨&lt;/strong&gt;ï¼Œé€šå¸¸å¯çœç•¥ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@SpringBootApplication&lt;/code&gt; &lt;code&gt;@EnableTransactionManagement&lt;/code&gt; (æ˜¾å¼æ·»åŠ )&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§  &lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;å…³é”®å±æ€§è¯¦è§£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Transactional&lt;/code&gt;çš„å¼ºå¤§åœ¨äºå…¶ä¸°å¯Œçš„å±æ€§é…ç½®ï¼Œè®©ä½ èƒ½ç²¾ç»†æ§åˆ¶äº‹åŠ¡è¡Œä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;propagation (ä¼ æ’­è¡Œä¸º)&lt;/strong&gt;ï¼šå½“å¤šä¸ªäº‹åŠ¡æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶ï¼Œæ­¤å±æ€§å†³å®šäº†äº‹åŠ¡å¦‚ä½•ä¼ æ’­ã€‚è¿™æ˜¯å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶æœ€å…³é”®çš„æ¦‚å¿µä¹‹ä¸€ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;REQUIRED&lt;/strong&gt; (é»˜è®¤)ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;REQUIRES_NEW&lt;/strong&gt;ï¼šæ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å°†å…¶æŒ‚èµ·ã€‚è¿™æ„å‘³ç€æ–°äº‹åŠ¡ä¸åŸæœ‰äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NESTED&lt;/strong&gt;ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚åµŒå¥—äº‹åŠ¡æ˜¯å¤–éƒ¨äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæäº¤æˆ–å›æ»šä¸å¤–éƒ¨äº‹åŠ¡æœ‰å…³è”ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–å€¼å¦‚ &lt;code&gt;SUPPORTS&lt;/code&gt;, &lt;code&gt;MANDATORY&lt;/code&gt;, &lt;code&gt;NOT_SUPPORTED&lt;/code&gt;, &lt;code&gt;NEVER&lt;/code&gt;åˆ™ç”¨äºæ›´ç‰¹å®šçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rollbackFor / noRollbackFor (å›æ»šè§„åˆ™)&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;@Transactional&lt;/code&gt;åªåœ¨é‡åˆ°&lt;strong&gt;è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰&lt;/strong&gt; å’Œ &lt;strong&gt;Error&lt;/strong&gt; æ—¶å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦åœ¨é‡åˆ°&lt;strong&gt;å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼Œå¦‚ Exception, IOException, SQLExceptionï¼‰&lt;/strong&gt; æ—¶ä¹Ÿå›æ»šäº‹åŠ¡ï¼Œå¿…é¡»ä½¿ç”¨ &lt;code&gt;rollbackFor&lt;/code&gt;å±æ€§æ˜ç¡®æŒ‡å®šï¼Œä¾‹å¦‚ &lt;code&gt;@Transactional(rollbackFor = Exception.class)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;âš¡ &lt;strong&gt;ä½¿ç”¨æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿æ³¨è§£ç”Ÿæ•ˆ&lt;/strong&gt;ï¼š&lt;code&gt;@Transactional&lt;/code&gt;é€šå¸¸åŸºäº Spring AOP ä»£ç†å®ç°ã€‚éœ€æ³¨æ„ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•å¿…é¡»æ˜¯ public&lt;/strong&gt;ï¼šé public æ–¹æ³•ä¸Šçš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ä¼šè¢«å¿½ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åŒç±»è‡ªè°ƒç”¨&lt;/strong&gt;ï¼šä¸€ä¸ªç±»ä¸­çš„ &lt;code&gt;A&lt;/code&gt;æ–¹æ³•ï¼ˆæ— &lt;code&gt;@Transactional&lt;/code&gt;ï¼‰è°ƒç”¨åŒç±»ä¸­çš„ &lt;code&gt;B&lt;/code&gt;æ–¹æ³•ï¼ˆæœ‰&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰ï¼Œ&lt;code&gt;B&lt;/code&gt;æ–¹æ³•çš„äº‹åŠ¡ä¼šå¤±æ•ˆã€‚å› ä¸ºè‡ªè°ƒç”¨ä¸ç»è¿‡ä»£ç†å¯¹è±¡ã€‚è§£å†³æ–¹æ³•æ˜¯å°† &lt;code&gt;B&lt;/code&gt;æ–¹æ³•æ”¾åˆ°å¦ä¸€ä¸ª Service ç±»ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸éœ€æŠ›å‡º&lt;/strong&gt;ï¼šäº‹åŠ¡å›æ»šä¾èµ–äºå¼‚å¸¸è¢«æŠ›å‡ºã€‚å¦‚æœä½ åœ¨æ–¹æ³•å†…ç”¨ &lt;code&gt;try-catch&lt;/code&gt;æ•è·äº†å¼‚å¸¸ä½†æœªé‡æ–°æŠ›å‡ºï¼Œäº‹åŠ¡å°±ä¸ä¼šå›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­£ç¡®è®¾ç½®å›æ»šå¼‚å¸¸&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œæ˜ç¡®é…ç½® &lt;code&gt;rollbackFor&lt;/code&gt;ã€‚è‹¥éœ€æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»šï¼Œå¯è®¾ä¸º &lt;code&gt;rollbackFor = Exception.class&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“å¼•æ“æ”¯æŒäº‹åŠ¡&lt;/strong&gt;ï¼šç¡®ä¿ä½ ä½¿ç”¨çš„æ•°æ®åº“è¡¨ä½¿ç”¨çš„æ˜¯æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼ˆå¦‚ InnoDBï¼‰ã€‚ä¾‹å¦‚ï¼ŒMySQL çš„ MyISAM å¼•æ“å°±ä¸æ”¯æŒäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç»¼åˆä½¿ç”¨äº†å¤šä¸ªå±æ€§çš„æœåŠ¡å±‚æ–¹æ³•ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class OrderService {
@Autowired
private OrderRepository orderRepository;
@Autowired
private InventoryRepository inventoryRepository;
// åœ¨ä¸€ä¸ªæ–°äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œè¶…æ—¶æ—¶é—´5ç§’ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»š
@Transactional(propagation = Propagation.REQUIRES_NEW,
timeout = 5,
rollbackFor = Exception.class)
public void placeOrder(Order order) throws Exception {
// 1. æ‰£å‡åº“å­˜
inventoryRepository.reduceStock(order.getProductId(), order.getQuantity());
// 2. åˆ›å»ºè®¢å•
orderRepository.save(order);
// å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼ˆåŒ…æ‹¬Exceptionï¼‰ï¼Œæ‰€æœ‰æ“ä½œéƒ½å°†å›æ»š
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ğŸ“š &lt;strong&gt;æ€»ç»“&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Spring Boot ä¸­æ•°æ®åº“äº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒæ˜¯ &lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt; æ³¨è§£ã€‚è¦æœ‰æ•ˆä½¿ç”¨å®ƒï¼Œä½ éœ€è¦ç†è§£å…¶&lt;strong&gt;ä¼ æ’­è¡Œä¸º&lt;/strong&gt;ã€&lt;strong&gt;éš”ç¦»çº§åˆ«&lt;/strong&gt;ã€&lt;strong&gt;å›æ»šè§„åˆ™&lt;/strong&gt;ç­‰å…³é”®å±æ€§ï¼Œå¹¶æ³¨æ„é¿å…å¸¸è§çš„å¤±æ•ˆé™·é˜±ï¼Œå¦‚&lt;strong&gt;åŒç±»è‡ªè°ƒç”¨&lt;/strong&gt;å’Œ&lt;strong&gt;å¼‚å¸¸è¢«æ•è·&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°åœ¨ Spring Boot é¡¹ç›®ä¸­åº”ç”¨äº‹åŠ¡ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id="ç±»çº§åˆ«-transactional"&gt;ç±»çº§åˆ« @Transactional
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring ä¸­ï¼Œå½“ä½ å°† &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£åº”ç”¨äºç±»çº§åˆ«æ—¶ï¼Œå®ƒä¼šä¸ºè¯¥ç±»çš„æ‰€æœ‰ &lt;strong&gt;public æ–¹æ³•&lt;/strong&gt;æä¾›ä¸€ä¸ªé»˜è®¤çš„äº‹åŠ¡é…ç½®æ¨¡æ¿ã€‚è¿™æ„å‘³ç€è¿™äº›æ–¹æ³•çš„æ‰§è¡Œéƒ½ä¼šè¢«çº³å…¥äº‹åŠ¡ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿäº†è§£å…¶æ ¸å¿ƒè¦ç‚¹ï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸ªè¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹é¢&lt;/th&gt;
&lt;th&gt;ç±»çº§åˆ« &lt;code&gt;@Transactional&lt;/code&gt;çš„ä½œç”¨&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤äº‹åŠ¡è¡Œä¸º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»ä¸­æ‰€æœ‰ &lt;strong&gt;public æ–¹æ³•&lt;/strong&gt;åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šè‡ªåŠ¨å¼€å¯å’Œç®¡ç†äº‹åŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;é public æ–¹æ³•ï¼ˆprivate, protectedï¼‰ä¸Šçš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£&lt;strong&gt;ä¸ä¼šç”Ÿæ•ˆ&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•çº§æ³¨è§£è¦†ç›–ç±»çº§é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœæŸä¸ª public æ–¹æ³•ä¸Šä¹Ÿæœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ï¼Œé‚£ä¹ˆ&lt;strong&gt;æ–¹æ³•ä¸Šçš„é…ç½®ä¼šä¼˜å…ˆäºç±»çº§åˆ«çš„é…ç½®&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æä¾›äº†çµæ´»æ€§ï¼Œå…è®¸å¯¹ç‰¹å®šæ–¹æ³•è¿›è¡Œæ›´ç»†è‡´çš„äº‹åŠ¡æ§åˆ¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»Ÿä¸€ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹ä¾¿åœ°ä¸ºæ•´ä¸ªæœåŠ¡ç±»çš„æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•è®¾å®š&lt;strong&gt;ç»Ÿä¸€çš„äº‹åŠ¡å±æ€§&lt;/strong&gt;ï¼ˆå¦‚ä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€åªè¯»ç­‰ï¼‰ï¼Œå‡å°‘é‡å¤é…ç½®ã€‚&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºç±»ä¸­å¤§å¤šæ•°æ–¹æ³•æœ‰ç›¸ä¼¼äº‹åŠ¡éœ€æ±‚çš„æƒ…å†µï¼Œæœ‰åŠ©äºä¿æŒä»£ç æ•´æ´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯èƒ½å¸¦æ¥çš„æ€§èƒ½å½±å“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœç›²ç›®åœ°å°†æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬åªè¯»æŸ¥è¯¢ï¼‰éƒ½ç½®äºäº‹åŠ¡ä¸­ï¼Œå¯èƒ½ä¼šå¸¦æ¥&lt;strong&gt;ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“äº‹åŠ¡æœ¬èº«æœ‰ä¸€å®šå¼€é”€ã€‚å¯¹äºä¸ä¿®æ”¹æ•°æ®çš„çº¯æŸ¥è¯¢æ–¹æ³•ï¼Œè€ƒè™‘ä½¿ç”¨ &lt;code&gt;@Transactional(readOnly = true)&lt;/code&gt;æˆ–ä¸åœ¨ç±»çº§åˆ«è®¾ç½®äº‹åŠ¡ï¼Œè€Œæ˜¯åœ¨æ–¹æ³•çº§åˆ«å•ç‹¬é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;æ–¹æ³•çº§åˆ«è¦†ç›–çš„ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†æ–¹æ³•çº§åˆ«çš„äº‹åŠ¡é…ç½®å¦‚ä½•è¦†ç›–ç±»çº§åˆ«çš„é…ç½®ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class) // ç±»çº§åˆ«ï¼šé»˜è®¤å¿…éœ€äº‹åŠ¡ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»š
public class UserService {
@Autowired
private UserRepository userRepository;
// æ­¤æ–¹æ³•å°†ä½¿ç”¨ç±»çº§åˆ«çš„äº‹åŠ¡é…ç½®ï¼šPropagation.REQUIRED, rollbackFor = Exception.class
public void createUser(User user) {
userRepository.save(user);
}
// æ­¤æ–¹æ³•ä¸Šçš„æ³¨è§£è¦†ç›–äº†ç±»çº§åˆ«çš„é…ç½®ï¼šæ€»æ˜¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶ä¸”åªè¯»
@Transactional(propagation = Propagation.REQUIRES_NEW, readOnly = true)
public User getUserById(Long id) {
return userRepository.findById(id).orElse(null);
}
// æ­¤æ–¹æ³•ä¸Šçš„æ³¨è§£è¦†ç›–äº†ç±»çº§åˆ«çš„é…ç½®ï¼šæŒ‡å®šäº†è¶…æ—¶æ—¶é—´
@Transactional(timeout = 30)
public void updateUserProfile(User user) {
// ... ä¸€äº›è€—æ—¶æ“ä½œ
userRepository.updateUser(user);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ğŸ“‹ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç±»çº§åˆ« &lt;code&gt;@Transactional&lt;/code&gt;æ—¶ï¼Œæœ‰å‡ ä¸ªé‡è¦çš„åœ°æ–¹éœ€è¦æ³¨æ„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ…ç”¨äºé public æ–¹æ³•&lt;/strong&gt;ï¼šSpring çš„äº‹åŠ¡ç®¡ç†åŸºäº AOPï¼ˆåŠ¨æ€ä»£ç†ï¼‰ï¼Œé public æ–¹æ³•ä¸Šçš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£&lt;strong&gt;ä¼šè¢«å¿½ç•¥&lt;/strong&gt;ï¼Œä¸”é€šå¸¸ä¸ä¼šæœ‰ä»»ä½•æŠ¥é”™ï¼Œè¿™æ˜¯ä¸€å¤„å®¹æ˜“è¸©å‘çš„åœ°æ–¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è‡ªè°ƒç”¨é—®é¢˜&lt;/strong&gt;ï¼šåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸€ä¸ªæ²¡æœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodA&lt;/code&gt;ï¼‰ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªæœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodB&lt;/code&gt;ï¼‰ï¼Œ&lt;strong&gt;&lt;code&gt;methodB&lt;/code&gt;çš„äº‹åŠ¡æ³¨è§£ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸ºè‡ªè°ƒç”¨ä¸ç»è¿‡ä»£ç†å¯¹è±¡ã€‚è§£å†³æ–¹æ³•æ˜¯å°† &lt;code&gt;methodB&lt;/code&gt;ç§»åˆ°å¦ä¸€ä¸ª Service ç±»ä¸­ï¼Œæˆ–é€šè¿‡æ³¨å…¥è‡ªèº«ä»£ç†ç­‰æ–¹å¼è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®å›æ»šè§„åˆ™&lt;/strong&gt;ï¼šç±»çº§åˆ«è®¾ç½®çš„ &lt;code&gt;rollbackFor&lt;/code&gt;æˆ– &lt;code&gt;noRollbackFor&lt;/code&gt;å±æ€§ä¼šåº”ç”¨äºæ‰€æœ‰æ–¹æ³•ã€‚åŠ¡å¿…æ¸…æ¥šé»˜è®¤å›æ»šçš„æ˜¯ &lt;code&gt;RuntimeException&lt;/code&gt;å’Œ &lt;code&gt;Error&lt;/code&gt;ï¼Œå¦‚æœéœ€è¦æ£€æŸ¥å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ä¹Ÿè§¦å‘å›æ»šï¼Œéœ€è¦åœ¨ç±»æˆ–æ–¹æ³•çº§åˆ«æ˜ç¡®é…ç½® &lt;code&gt;rollbackFor = Exception.class&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“å¼•æ“æ”¯æŒ&lt;/strong&gt;ï¼šç¡®ä¿ä½ ä½¿ç”¨çš„æ•°æ®åº“è¡¨å¼•æ“æ”¯æŒäº‹åŠ¡ï¼ˆå¦‚ MySQL çš„ InnoDBï¼‰ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼ˆå¦‚ MyISAMï¼‰ï¼Œäº‹åŠ¡æ³¨è§£å°†ä¸ä¼šç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ€»ç»“ä¸€ä¸‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;å¯ä»¥&lt;strong&gt;é«˜æ•ˆåœ°ä¸ºæ‰€æœ‰ public æ–¹æ³•æä¾›ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼Œéå¸¸é€‚åˆé‚£äº›å¤§å¤šæ•°æ–¹æ³•éƒ½éœ€è¦ç±»ä¼¼äº‹åŠ¡é…ç½®çš„ Service ç±»ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å®ƒæ˜¯ä¸€æŠŠâ€œåŒåˆƒå‰‘â€ï¼Œéœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šéœ€è¦ç‰¹äº‹ç‰¹åŠçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;è¿›è¡Œè¦†ç›–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…æ€§&lt;/strong&gt;ï¼šé¿å…ç»™ä¸éœ€è¦äº‹åŠ¡çš„åªè¯»æ–¹æ³•å¸¦æ¥é¢å¤–å¼€é”€ï¼Œå¹¶ç•™æ„é public æ–¹æ³•æ³¨è§£å¤±æ•ˆå’Œè‡ªè°ƒç”¨é™·é˜±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ç±»çº§åˆ«çš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="spring-security-æƒé™æ³¨è§£"&gt;Spring Security æƒé™æ³¨è§£
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶ï¼Œç‰¹åˆ«æ˜¯å…¶å®‰å…¨æ¨¡å— &lt;strong&gt;Spring Security&lt;/strong&gt;ï¼Œæä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„&lt;strong&gt;æƒé™æ§åˆ¶æ³¨è§£&lt;/strong&gt;ï¼Œå¯ä»¥å¸®åŠ©ä½ è½»æ¾åœ°åœ¨æ–¹æ³•æˆ–ç±»çº§åˆ«å®ç°ç²¾ç»†åŒ–çš„è®¿é—®æ§åˆ¶ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ±‡æ€»è¿™äº›æ ¸å¿ƒæ³¨è§£ï¼Œå¹¶é™„ä¸Šè¯¦ç»†è¯´æ˜å’Œä»£ç ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;åº”ç”¨åœºæ™¯ä¸æè¿°&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨è¡¨è¾¾å¼/ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PreAuthorize&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•&lt;strong&gt;æ‰§è¡Œå‰&lt;/strong&gt;è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œ&lt;strong&gt;æœ€å¸¸ç”¨&lt;/strong&gt;ã€‚æ”¯æŒä¸°å¯Œçš„ SpEL è¡¨è¾¾å¼ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PreAuthorize(&amp;quot;hasRole('ADMIN')&amp;quot;)``@PreAuthorize(&amp;quot;hasAuthority('USER_DELETE')&amp;quot;)``@PreAuthorize(&amp;quot;#id == authentication.principal.id&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PostAuthorize&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•&lt;strong&gt;æ‰§è¡Œå&lt;/strong&gt;è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œé€‚ç”¨äºéœ€è¦&lt;strong&gt;åŸºäºè¿”å›å€¼&lt;/strong&gt;è¿›è¡Œé‰´æƒçš„åœºæ™¯ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PostAuthorize(&amp;quot;returnObject.owner == authentication.name&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@Secured&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¾ƒç®€å•çš„è§’è‰²æ£€æŸ¥ï¼Œ&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt; SpEL è¡¨è¾¾å¼ã€‚è§’è‰²åå¿…é¡»ä»¥ &lt;code&gt;ROLE_&lt;/code&gt;å‰ç¼€å¼€å¤´ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Secured({&amp;quot;ROLE_ADMIN&amp;quot;, &amp;quot;ROLE_USER&amp;quot;})&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@RolesAllowed&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JSR-250 æ ‡å‡†æ³¨è§£ï¼ŒåŠŸèƒ½ä¸ &lt;code&gt;@Secured&lt;/code&gt;ç±»ä¼¼ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@RolesAllowed({&amp;quot;ADMIN&amp;quot;, &amp;quot;USER&amp;quot;})&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PreFilter&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æ‰§è¡Œå‰ï¼Œæ ¹æ®è§„åˆ™&lt;strong&gt;è¿‡æ»¤ä¼ å…¥çš„é›†åˆå‚æ•°&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PreFilter(&amp;quot;filterObject.owner == authentication.name&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PostFilter&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æ‰§è¡Œåï¼Œæ ¹æ®è§„åˆ™&lt;strong&gt;è¿‡æ»¤è¿”å›çš„é›†åˆç»“æœ&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PostFilter(&amp;quot;filterObject.status == 'PUBLIC' or filterObject.owner == authentication.name&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;è¯¦è§£ä¸ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="-1-preauthorize"&gt;ğŸ”’ 1. @PreAuthorize
&lt;/h3&gt;&lt;p&gt;æ­¤æ³¨è§£ç”¨äºåœ¨æ–¹æ³•è°ƒç”¨&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;æ‰§è¡Œæƒé™æ£€æŸ¥ï¼Œå¦‚æœè¡¨è¾¾å¼è¯„ä¼°ç»“æœä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œæ–¹æ³•å°†ä¸ä¼šæ‰§è¡Œã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@PreAuthorize(&amp;#34;hasRole(&amp;#39;ADMIN&amp;#39;)&amp;#34;) // è¦æ±‚ç”¨æˆ·æ‹¥æœ‰&amp;#39;ROLE_ADMIN&amp;#39;è§’è‰²
public void deleteUser(Long userId) {
// åˆ é™¤ç”¨æˆ·çš„é€»è¾‘
}
@PreAuthorize(&amp;#34;hasAuthority(&amp;#39;USER_DELETE&amp;#39;) and #userId != authentication.principal.id&amp;#34;) // è¦æ±‚æ‹¥æœ‰&amp;#39;USER_DELETE&amp;#39;æƒé™ä¸”ä¸èƒ½åˆ é™¤è‡ªå·±
public void deleteUser(Long userId) {
// åˆ é™¤ç”¨æˆ·çš„é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-2-postauthorize"&gt;ğŸ” 2. @PostAuthorize
&lt;/h3&gt;&lt;p&gt;æ­¤æ³¨è§£åœ¨æ–¹æ³•&lt;strong&gt;æ‰§è¡Œå&lt;/strong&gt;è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œç‰¹åˆ«é€‚åˆè®¿é—®æ§åˆ¶å†³ç­–éœ€è¦ä¾èµ–æ–¹æ³•è¿”å›å€¼çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åªèƒ½è¿”å›å±äºè‡ªå·±çš„ç”¨æˆ·ä¿¡æ¯
@PostAuthorize(&amp;#34;returnObject.username == authentication.principal.name&amp;#34;)
public User getUserById(Long id) {
return userRepository.findById(id).orElse(null);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-3-secured"&gt;ğŸ›¡ï¸ 3. @Secured
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªè¾ƒæ—©æœŸçš„ Spring Security æ³¨è§£ï¼Œä¸»è¦ç”¨äºåŸºäºè§’è‰²çš„ç®€å•æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Secured(&amp;#34;ROLE_ADMIN&amp;#34;) // è¦æ±‚ç”¨æˆ·æ‹¥æœ‰&amp;#39;ROLE_ADMIN&amp;#39;è§’è‰²
public void updateSystemConfig() {
// æ›´æ–°ç³»ç»Ÿé…ç½®çš„é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-4-rolesallowed"&gt;ğŸ“‹ 4. @RolesAllowed
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ JSR-250 æ ‡å‡†æ³¨è§£ï¼Œéœ€è¦å•ç‹¬å¯ç”¨ (&lt;code&gt;jsr250Enabled = true&lt;/code&gt;)ã€‚å…¶ä½œç”¨ä¸ &lt;code&gt;@Secured&lt;/code&gt;ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RolesAllowed({&amp;#34;ADMIN&amp;#34;, &amp;#34;SUPER_USER&amp;#34;}) // å…è®¸æ‹¥æœ‰&amp;#39;ADMIN&amp;#39;æˆ–&amp;#39;SUPER_USER&amp;#39;è§’è‰²çš„ç”¨æˆ·è®¿é—®
public void viewAuditLogs() {
// æŸ¥çœ‹å®¡è®¡æ—¥å¿—çš„é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-5-prefilter-ä¸-postfilter"&gt;ğŸ§¹ 5. @PreFilter ä¸ @PostFilter
&lt;/h3&gt;&lt;p&gt;è¿™ä¸¤ä¸ªæ³¨è§£ç”¨äºå¯¹é›†åˆæ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå®ç°æ•°æ®çº§åˆ«çš„æƒé™æ§åˆ¶ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åªèƒ½å¤„ç†å±äºè‡ªå·±çš„ä»»åŠ¡
@PreFilter(&amp;#34;filterObject.assignee == authentication.name&amp;#34;)
public void updateTasks(List&amp;lt;Task&amp;gt; tasks) {
tasks.forEach(taskRepository::save);
}
// åªè¿”å›çŠ¶æ€ä¸ºå…¬å…±æˆ–å±äºè‡ªå·±çš„å¸–å­
@PostFilter(&amp;#34;filterObject.status == &amp;#39;PUBLIC&amp;#39; or filterObject.owner == authentication.name&amp;#34;)
public List&amp;lt;Post&amp;gt; getAllPosts() {
return postRepository.findAll();
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-å¯ç”¨æ³¨è§£æ”¯æŒ"&gt;âš™ï¸ &lt;strong&gt;å¯ç”¨æ³¨è§£æ”¯æŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è¦ä½¿ç”¨ &lt;code&gt;@PreAuthorize&lt;/code&gt;, &lt;code&gt;@PostAuthorize&lt;/code&gt;, &lt;code&gt;@Secured&lt;/code&gt;ç­‰æ³¨è§£ï¼Œä½ å¿…é¡»åœ¨ä½ çš„é…ç½®ç±»ä¸Šæ˜¾å¼å¯ç”¨å®ƒä»¬ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@EnableMethodSecurity(prePostEnabled = true, securedEnabled = true, jsr250Enabled = true)
public class SecurityConfig {
// å…¶ä»–å®‰å…¨é…ç½®...
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;prePostEnabled = true&lt;/code&gt;: å¯ç”¨ &lt;code&gt;@PreAuthorize&lt;/code&gt;å’Œ &lt;code&gt;@PostAuthorize&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;securedEnabled = true&lt;/code&gt;: å¯ç”¨ &lt;code&gt;@Secured&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;jsr250Enabled = true&lt;/code&gt;: å¯ç”¨ &lt;code&gt;@RolesAllowed&lt;/code&gt;(JSR-250)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¡¨è¾¾å¼ä¸­çš„å¯¹è±¡&lt;/strong&gt;ï¼šåœ¨ SpEL è¡¨è¾¾å¼ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;authentication&lt;/code&gt;ã€&lt;code&gt;principal&lt;/code&gt;æ¥è·å–å½“å‰è®¤è¯ä¿¡æ¯å’Œç”¨æˆ·ä¸»ä½“ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;#å‚æ•°å&lt;/code&gt;æ¥å¼•ç”¨æ–¹æ³•çš„å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§’è‰²ä¸æƒé™&lt;/strong&gt;ï¼š&lt;code&gt;hasRole('ADMIN')&lt;/code&gt;ä¼šåœ¨ä¼ å…¥çš„å­—ç¬¦ä¸²å‰è‡ªåŠ¨æ·»åŠ  &lt;code&gt;ROLE_&lt;/code&gt;å‰ç¼€ï¼ˆå³æŸ¥æ‰¾ &lt;code&gt;ROLE_ADMIN&lt;/code&gt;ï¼‰ã€‚è€Œ &lt;code&gt;hasAuthority('USER_DELETE')&lt;/code&gt;åˆ™ä¼šç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸² &amp;lsquo;USER_DELETE&amp;rsquo; è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚æ ¹æ®ä½ çš„æƒé™è®¾è®¡æ–¹å¼é€‰æ‹©ä½¿ç”¨ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•è°ƒç”¨çš„æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼šè¿™äº›åŸºäº AOP çš„æ³¨è§£é€šå¸¸åªåœ¨é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œçš„å¤–éƒ¨æ–¹æ³•è°ƒç”¨æ—¶ç”Ÿæ•ˆã€‚åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ªè¢«æ³¨è§£ä¿®é¥°çš„æ–¹æ³•ï¼Œæ³¨è§£å¯èƒ½ä¼šå¤±æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spring Security çš„æƒé™æ³¨è§£ä¸ºåº”ç”¨å®‰å…¨æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ä¿éšœã€‚æ­£ç¡®ä½¿ç”¨å®ƒä»¬ï¼Œå¯ä»¥è®©ä½ è½»æ¾æ„å»ºå‡ºæƒé™æ§åˆ¶ç²¾ç»†ã€ä»£ç æ¸…æ™°æ˜“ç»´æŠ¤çš„ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id="sentinelresource"&gt;@SentinelResource
&lt;/h2&gt;&lt;p&gt;Sentinel ä¸­å®ç°é™æµçš„æ ¸å¿ƒæ³¨è§£æ˜¯ &lt;code&gt;@SentinelResource&lt;/code&gt;ã€‚å®ƒå…è®¸ä½ å£°æ˜éœ€è¦ä¿æŠ¤çš„ä¸šåŠ¡èµ„æºï¼Œå¹¶æŒ‡å®šé™æµæˆ–é™çº§åçš„å¤„ç†é€»è¾‘ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“å®ƒçš„æ ¸å¿ƒå±æ€§ï¼Œç„¶åè¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£å±æ€§&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;value&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºåç§°&lt;/strong&gt;ï¼Œå¿…å¡«ã€‚Sentinel æ ¹æ®æ­¤åç§°æ¥é…ç½®å’Œç»Ÿè®¡è§„åˆ™ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@SentinelResource(value = &amp;quot;getUserById&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;blockHandler&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é™æµ/ç†”æ–­å¤„ç†æ–¹&lt;/strong&gt;æ³•åã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚è¯¥æ–¹æ³•éœ€ä¸åŸæ–¹æ³•åŒå‚æ•°åˆ—è¡¨ï¼Œå¹¶é¢å¤–åŠ ä¸€ä¸ª &lt;code&gt;BlockException&lt;/code&gt;å‚æ•°ï¼Œä¸”éœ€åŒè¿”å›å€¼ç±»å‹ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;blockHandler = &amp;quot;handleBlock&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;blockHandlerClass&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®š &lt;code&gt;blockHandler&lt;/code&gt;æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚æ­¤æ—¶ &lt;code&gt;blockHandler&lt;/code&gt;æ–¹æ³•å¿…é¡»æ˜¯è¯¥ç±»çš„ &lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;blockHandlerClass = {ExceptionUtil.class}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;fallback&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸šåŠ¡å¼‚å¸¸é™çº§å¤„ç†&lt;/strong&gt;æ–¹æ³•åã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆé &lt;code&gt;BlockException&lt;/code&gt;ï¼‰ã€‚å‚æ•°åˆ—è¡¨éœ€ä¸åŸæ–¹æ³•ä¸€è‡´ï¼Œå¯åŠ ä¸€ä¸ª &lt;code&gt;Throwable&lt;/code&gt;å‚æ•°ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;fallback = &amp;quot;fallbackHandler&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;fallbackClass&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®š &lt;code&gt;fallback&lt;/code&gt;æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚æ­¤æ—¶ &lt;code&gt;fallback&lt;/code&gt;æ–¹æ³•å¿…é¡»æ˜¯è¯¥ç±»çš„ &lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;fallbackClass = {ExceptionUtil.class}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;ä½¿ç”¨æ­¥éª¤&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="1-æ·»åŠ ä¾èµ–"&gt;1. æ·»åŠ ä¾èµ–
&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ  Spring Cloud Alibaba Sentinel ä¾èµ–ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.alibaba.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-alibaba-sentinel&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;2022.0.0.0&amp;lt;/version&amp;gt; &amp;lt;!-- è¯·é€‰æ‹©ä¸ä½ çš„Spring Bootç‰ˆæœ¬åŒ¹é…çš„ç‰ˆæœ¬ --&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="2-é…ç½®-sentinel-æ§åˆ¶å°å¯é€‰ä½†æ¨è"&gt;2. é…ç½® Sentinel æ§åˆ¶å°ï¼ˆå¯é€‰ä½†æ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;code&gt;application.yml&lt;/code&gt;ä¸­é…ç½® Sentinel Dashboard åœ°å€ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
sentinel:
transport:
dashboard: localhost:8080 # Sentinel æ§åˆ¶å°åœ°å€
port: 8719 # åº”ç”¨ä¸Sentinelæ§åˆ¶å°äº¤äº’çš„æœ¬åœ°ç«¯å£
eager: true # å–æ¶ˆæ§åˆ¶å°æ‡’åŠ è½½ï¼Œé¡¹ç›®å¯åŠ¨å³è¿æ¥
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="3-ä½¿ç”¨-sentinelresourceæ³¨è§£"&gt;3. ä½¿ç”¨ &lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£
&lt;/h3&gt;&lt;p&gt;ä½ å¯ä»¥åœ¨ Service æ–¹æ³•æˆ– Controller æ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 1ï¼šåœ¨ Controller ä¸­ä½¿ç”¨ï¼Œ&lt;code&gt;blockHandler&lt;/code&gt;å¤„ç†é™æµ&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.alibaba.csp.sentinel.annotation.SentinelResource;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
@RestController
public class MyController {
@GetMapping(&amp;#34;/test&amp;#34;)
@SentinelResource(value = &amp;#34;testResource&amp;#34;, blockHandler = &amp;#34;handleBlock&amp;#34;)
public String test() {
return &amp;#34;æ­£å¸¸è®¿é—®&amp;#34;;
}
// é™æµé™çº§æ–¹æ³• (éœ€ç¬¦åˆ blockHandler æ–¹æ³•ç­¾åè¦æ±‚)
public String handleBlock(BlockException ex) {
return &amp;#34;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•&amp;#34;; // è§¦å‘é™æµæ—¶è¿”å›æ­¤ä¿¡æ¯
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 2ï¼šä½¿ç”¨ &lt;code&gt;blockHandlerClass&lt;/code&gt;æŒ‡å®šå¤–éƒ¨ç±»å¤„ç†é™æµ&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åœ¨Controlleræˆ–Serviceä¸­
@SentinelResource(value = &amp;#34;getUserById&amp;#34;,
blockHandler = &amp;#34;handleBlock&amp;#34;,
blockHandlerClass = {ExceptionUtil.class})
public User getUserById(String id) {
// ä¸šåŠ¡é€»è¾‘
}
// ç‹¬ç«‹çš„å¼‚å¸¸å¤„ç†å·¥å…·ç±» ExceptionUtil.java
public final class ExceptionUtil {
// å¿…é¡»æ˜¯é™æ€æ–¹æ³•
public static User handleBlock(String id, BlockException ex) {
// è®°å½•æ—¥å¿—æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œ
return new User(&amp;#34;fallback-user&amp;#34;, &amp;#34;è¯·æ±‚è¢«é™æµ&amp;#34;); // è¿”å›é™çº§æ•°æ®
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 3ï¼šåŒæ—¶ä½¿ç”¨ &lt;code&gt;blockHandler&lt;/code&gt;å’Œ &lt;code&gt;fallback&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SentinelResource(value = &amp;#34;demoService&amp;#34;,
blockHandler = &amp;#34;blockHandler&amp;#34;, // å¤„ç† Sentinel è§„åˆ™æ‹¦æˆªçš„å¼‚å¸¸ï¼ˆå¦‚é™æµã€ç†”æ–­ï¼‰
fallback = &amp;#34;fallbackHandler&amp;#34;) // å¤„ç†ä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„å…¶ä»–å¼‚å¸¸
public String demoService(String input) {
if (&amp;#34;error&amp;#34;.equals(input)) {
throw new RuntimeException(&amp;#34;ä¸šåŠ¡å¼‚å¸¸&amp;#34;);
}
return &amp;#34;å¤„ç†æˆåŠŸ: &amp;#34; + input;
}
// Sentinel BlockException å¤„ç†æ–¹
public String blockHandler(String input, BlockException ex) {
return &amp;#34;è¯·æ±‚è¢«é™æµæˆ–ç†”æ–­ï¼Œè¾“å…¥: &amp;#34; + input;
}
// é€šç”¨ Fallback å¤„ç†æ–¹ (Throwable å¯é€‰)
public String fallbackHandler(String input, Throwable t) {
return &amp;#34;æœåŠ¡é™çº§ï¼ŒåŸå› : &amp;#34; + t.getMessage();
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="4-é…ç½®é™æµè§„åˆ™"&gt;4. é…ç½®é™æµè§„åˆ™
&lt;/h3&gt;&lt;p&gt;é…ç½®è§„åˆ™æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹å¼ä¸€ï¼šé€šè¿‡ Sentinel æ§åˆ¶å°åŠ¨æ€é…ç½®ï¼ˆæ¨èï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯åŠ¨ Sentinel æ§åˆ¶å°ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Jar åŒ…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è®¿é—®æ§åˆ¶å°ï¼ˆé»˜è®¤ç”¨æˆ·åå¯†ç å‡ä¸º &lt;code&gt;sentinel&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;strong&gt;â€œç°‡ç‚¹é“¾è·¯â€&lt;/strong&gt; ä¸­æ‰¾åˆ°ä½ é€šè¿‡ &lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£å®šä¹‰çš„èµ„æºåï¼ˆå¦‚ &lt;code&gt;testResource&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç‚¹å‡» &lt;strong&gt;â€œæµæ§â€&lt;/strong&gt; æŒ‰é’®ï¼Œè®¾ç½® &lt;strong&gt;QPS&lt;/strong&gt; æˆ–&lt;strong&gt;çº¿ç¨‹æ•°&lt;/strong&gt;é˜ˆå€¼ã€æµæ§æ¨¡å¼ï¼ˆç›´æ¥ã€å…³è”ã€é“¾è·¯ï¼‰å’Œæµæ§æ•ˆæœï¼ˆå¿«é€Ÿå¤±è´¥ã€Warm Upã€æ’é˜Ÿç­‰å¾…ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ–¹å¼äºŒï¼šé€šè¿‡ä»£ç åˆå§‹åŒ–è§„åˆ™ï¼ˆé€‚ç”¨äºåˆå§‹é…ç½®æˆ–æµ‹è¯•ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.alibaba.csp.sentinel.slots.block.RuleConstant;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;
import org.springframework.boot.ApplicationRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import java.util.Collections;
@Configuration
public class SentinelConfig {
@Bean
public ApplicationRunner initSentinelRules() {
return args -&amp;gt; {
FlowRule rule = new FlowRule();
rule.setResource(&amp;#34;testResource&amp;#34;); // ä¸ @SentinelResource çš„ value ä¸€è‡´
rule.setGrade(RuleConstant.FLOW_GRADE_QPS); // é™æµé˜ˆå€¼ç±»å‹ (QPS æ¨¡å¼)
rule.setCount(2); // é˜ˆå€¼ (æ¯ç§’æœ€å¤šå…è®¸ 2 æ¬¡è¯·æ±‚)
rule.setLimitApp(&amp;#34;default&amp;#34;);
FlowRuleManager.loadRules(Collections.singletonList(rule));
};
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;è¯·æ³¨æ„ï¼Œä»£ç é…ç½®çš„è§„åˆ™åœ¨åº”ç”¨é‡å¯åé€šå¸¸ä¼šä¸¢å¤±ï¼Œå»ºè®®é€šè¿‡æ§åˆ¶å°é…ç½®æˆ–ç»“åˆ Nacos ç­‰é…ç½®ä¸­å¿ƒè¿›è¡ŒæŒä¹…åŒ–ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h3 id="5-ç»Ÿä¸€å¼‚å¸¸å¤„ç†å¯é€‰"&gt;5. ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆå¯é€‰ï¼‰
&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ æƒ³è‡ªå®šä¹‰è¢«é™æµæ—¶è¿”å›çš„ JSON æ ¼å¼è€Œéç®€å•å­—ç¬¦ä¸²ï¼Œå¯ä»¥å®ç° &lt;code&gt;BlockExceptionHandler&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler;
import org.springframework.stereotype.Component;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
@Component
public class CustomBlockExceptionHandler implements BlockExceptionHandler {
@Override
public void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception {
response.setStatus(429); // Too Many Requests
response.setContentType(&amp;#34;application/json;charset=utf-8&amp;#34;);
response.getWriter().write(&amp;#34;{\&amp;#34;code\&amp;#34;: 429, \&amp;#34;msg\&amp;#34;: \&amp;#34;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\&amp;#34;}&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºåå”¯ä¸€æ€§&lt;/strong&gt;ï¼š&lt;code&gt;value&lt;/code&gt;å®šä¹‰çš„èµ„æºååº”å”¯ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•ç­¾å&lt;/strong&gt;ï¼š&lt;code&gt;blockHandler&lt;/code&gt;å’Œ &lt;code&gt;fallback&lt;/code&gt;æ–¹æ³•éœ€è¦ä¸¥æ ¼éµå¾ª&lt;strong&gt;å‚æ•°å’Œè¿”å›å€¼ç±»å‹&lt;/strong&gt;çš„çº¦å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶å°é…ç½®&lt;/strong&gt;ï¼šé€šè¿‡ Sentinel æ§åˆ¶å°é…ç½®è§„åˆ™æ˜¯&lt;strong&gt;åŠ¨æ€ç”Ÿæ•ˆ&lt;/strong&gt;çš„ï¼Œæ— éœ€é‡å¯åº”ç”¨ï¼Œéå¸¸çµæ´»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™æŒä¹…åŒ–&lt;/strong&gt;ï¼šé»˜è®¤é…ç½®çš„è§„åˆ™å­˜åœ¨äºå†…å­˜ä¸­ï¼Œåº”ç”¨é‡å¯ä¼šä¸¢å¤±ã€‚å¦‚éœ€æŒä¹…åŒ–ï¼Œå¯é›†æˆ Nacosã€ZooKeeper ç­‰é…ç½®ä¸­å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŸ‹ç‚¹&lt;/strong&gt;ï¼šSentinel é»˜è®¤ä¹Ÿä¼šä¸ºæ‰€æœ‰ HTTP ç«¯ç‚¹ï¼ˆå¦‚ &lt;code&gt;@RequestMapping&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼‰æä¾›èµ„æºä¿æŠ¤ï¼Œèµ„æºåä¸º URL è·¯å¾„ã€‚ä½ åŒæ ·å¯ä»¥åœ¨æ§åˆ¶å°ä¸ºè¿™äº›è‡ªåŠ¨åŸ‹ç‚¹çš„èµ„æºé…ç½®è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ é¡ºåˆ©åœ°åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Sentinel è¿›è¡Œé™æµã€‚&lt;/p&gt;
&lt;h2 id="spring-retry"&gt;Spring Retry
&lt;/h2&gt;&lt;p&gt;Spring Retry ç»„ä»¶é€šè¿‡å‡ ä¸ªç®€æ´è€Œå¼ºå¤§çš„æ³¨è§£ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›äº†å¤„ç†ä¸´æ—¶æ€§æ•…éšœï¼ˆå¦‚ç½‘ç»œæ³¢åŠ¨ã€æ•°æ®åº“è¿æ¥æš‚æ—¶ä¸å¯ç”¨ç­‰ï¼‰çš„ä¼˜é›…é‡è¯•æœºåˆ¶ã€‚å®ƒèƒ½æœ‰æ•ˆå¢å¼ºç³»ç»Ÿçš„å®¹é”™æ€§å’Œç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Spring Retry çš„æ ¸å¿ƒæ³¨è§£æ¦‚è§ˆï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨å‚æ•°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@EnableRetry&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ç”¨é‡è¯•åŠŸèƒ½&lt;/strong&gt;çš„å¼€å…³æ³¨è§£ï¼Œé€šå¸¸æ”¾åœ¨é…ç½®ç±»æˆ–ä¸»å¯åŠ¨ç±»ä¸Šã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Retryable&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è®°&lt;strong&gt;éœ€è¦è¿›è¡Œé‡è¯•çš„æ–¹æ³•&lt;/strong&gt;ã€‚å½“æ–¹æ³•æŠ›å‡ºæŒ‡å®šå¼‚å¸¸æ—¶ï¼ŒSpring Retry ä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;include&lt;/code&gt;, &lt;code&gt;exclude&lt;/code&gt;, &lt;code&gt;maxAttempts&lt;/code&gt;, &lt;code&gt;backoff&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Backoff&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä½œä¸º &lt;code&gt;@Retryable&lt;/code&gt;çš„å‚æ•°ä½¿ç”¨ï¼Œç”¨äº&lt;strong&gt;é…ç½®é‡è¯•çš„å»¶è¿Ÿç­–ç•¥&lt;/strong&gt;ï¼Œå¦‚å›ºå®šé—´éš”ã€æŒ‡æ•°å¢é•¿ç­‰ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;delay&lt;/code&gt;, &lt;code&gt;multiplier&lt;/code&gt;, &lt;code&gt;maxDelay&lt;/code&gt;, &lt;code&gt;random&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Recover&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è®°ä¸€ä¸ªæ–¹æ³•ä½œä¸º&lt;strong&gt;é‡è¯•å…¨éƒ¨å¤±è´¥åçš„â€œå…œåº•â€æ¢å¤æ–¹æ³•&lt;/strong&gt;ã€‚å½“æ‰€æœ‰é‡è¯•å°è¯•éƒ½å¤±è´¥åï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CircuitBreaker&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›&lt;strong&gt;ç†”æ–­å™¨åŠŸèƒ½&lt;/strong&gt;ã€‚åœ¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼åï¼Œç†”æ–­å™¨ä¼šæ‰“å¼€ï¼Œæš‚æ—¶åœæ­¢æ‰€æœ‰é‡è¯•å°è¯•ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åå†è¿›å…¥åŠå¼€çŠ¶æ€å°è¯•æ¢å¤ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;openTimeout&lt;/code&gt;, &lt;code&gt;resetTimeout&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConcurrencyLimit&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é™åˆ¶æ–¹æ³•çš„å¹¶å‘æ‰§è¡Œæ•°é‡&lt;/strong&gt;ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;(æœ€å¤§å¹¶å‘æ•°)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•å¯ç”¨é‡è¯•"&gt;ğŸš€ å¦‚ä½•å¯ç”¨é‡è¯•
&lt;/h3&gt;&lt;p&gt;è¦ä½¿ç”¨ Spring Retryï¼Œé¦–å…ˆéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–ã€‚å¦‚æœä½ ä½¿ç”¨ Mavenï¼Œå¯ä»¥åœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.retry&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-retry&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.3.1&amp;lt;/version&amp;gt; &amp;lt;!-- è¯·æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ --&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Spring Retry åŸºäºAOPï¼Œå› æ­¤è¿˜éœ€è¦å¼•å…¥AOPä¾èµ– --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-aspects&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åï¼Œåœ¨ä¸€ä¸ªé…ç½®ç±»ï¼ˆä½¿ç”¨ &lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£ï¼‰æˆ–ä½ çš„ä¸»å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š &lt;code&gt;@EnableRetry&lt;/code&gt;æ³¨è§£æ¥å¯ç”¨é‡è¯•åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@EnableRetry // å°±æ˜¯å®ƒäº†
public class AppConfig {
// ... å…¶ä»–é…ç½®
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é…ç½®é‡è¯•è¡Œä¸º"&gt;âš™ï¸ é…ç½®é‡è¯•è¡Œä¸º
&lt;/h3&gt;&lt;h4 id="1"&gt;&lt;strong&gt;1. &lt;code&gt;@Retryable&lt;/code&gt;- æ ¸å¿ƒé‡è¯•æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£ç”¨äºæ ‡è®°é‚£äº›åœ¨é‡åˆ°ç‰¹å®šå¼‚å¸¸æ—¶éœ€è¦é‡è¯•çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºæœ¬ç”¨æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyService {
@Retryable(value = RuntimeException.class) // é‡åˆ°RuntimeExceptionå°±é‡è¯•
public void serviceMethod() {
// å¯èƒ½å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸¸ç”¨å‚æ•°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;value&lt;/code&gt;æˆ– &lt;code&gt;include&lt;/code&gt;&lt;/strong&gt;: æŒ‡å®š&lt;strong&gt;éœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;æ•°ç»„ã€‚ä¾‹å¦‚ &lt;code&gt;@Retryable(value = {IOException.class, SQLException.class})&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;exclude&lt;/code&gt;&lt;/strong&gt;: æŒ‡å®š&lt;strong&gt;ä¸è¿›è¡Œé‡è¯•çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;maxAttempts&lt;/code&gt;&lt;/strong&gt;: &lt;strong&gt;æœ€å¤§é‡è¯•æ¬¡æ•°&lt;/strong&gt;ï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼‰ã€‚é»˜è®¤æ˜¯3æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;backoff&lt;/code&gt;&lt;/strong&gt;: é€šè¿‡ &lt;code&gt;@Backoff&lt;/code&gt;æ³¨è§£&lt;strong&gt;é…ç½®é‡è¯•ä¹‹é—´çš„å»¶è¿Ÿç­–ç•¥&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2"&gt;&lt;strong&gt;2. &lt;code&gt;@Backoff&lt;/code&gt;- æ§åˆ¶é‡è¯•é—´éš”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@Backoff&lt;/code&gt;æ³¨è§£ç”¨äºå®šåˆ¶é‡è¯•çš„ç­‰å¾…æ—¶é—´ï¼Œé¿å…ç«‹å³é‡è¯•ç»™ç³»ç»Ÿå¸¦æ¥å‹åŠ›ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›ºå®šé—´éš”é‡è¯•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retryable(
value = {RemoteAccessException.class},
maxAttempts = 5,
backoff = @Backoff(delay = 2000) // æ¯æ¬¡é‡è¯•é—´éš”2ç§’
)
public void callApi() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŒ‡æ•°é€€é¿é‡è¯•&lt;/strong&gt;ï¼ˆå»¶è¿Ÿæ—¶é—´éšé‡è¯•æ¬¡æ•°æŒ‡æ•°å¢é•¿ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retryable(
value = {RemoteAccessException.class},
maxAttempts = 4,
backoff = @Backoff(delay = 1000, multiplier = 2, maxDelay = 5000)
// åˆå§‹å»¶è¿Ÿ1ç§’ï¼Œä¸‹æ¬¡2ç§’ï¼Œå†ä¸‹æ¬¡4ç§’ï¼Œæœ€å¤§ä¸è¶…è¿‡5ç§’
)
public void callApi() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éšæœºå»¶è¿Ÿé‡è¯•&lt;/strong&gt;ï¼ˆé¿å…å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶é‡è¯•å½¢æˆâ€œé‡è¯•é£æš´â€ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retryable(
value = {RemoteAccessException.class},
maxAttempts = 3,
backoff = @Backoff(delay = 1000, maxDelay = 3000, random = true)
// å»¶è¿Ÿæ—¶é—´åœ¨1ç§’åˆ°3ç§’ä¹‹é—´éšæœº
)
public void callApi() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3"&gt;&lt;strong&gt;3. &lt;code&gt;@Recover&lt;/code&gt;- é‡è¯•å¤±è´¥åçš„é™çº§å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“æ‰€æœ‰é‡è¯•å°è¯•éƒ½å¤±è´¥åï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;@Recover&lt;/code&gt;æ³¨è§£å®šä¹‰ä¸€ä¸ªæ¢å¤æ–¹æ³•æ¥æ‰§è¡Œé™çº§é€»è¾‘ï¼Œå¦‚è®°å½•æ—¥å¿—ã€è¿”å›é»˜è®¤å€¼æˆ–è¿›è¡Œè¡¥å¿æ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æ¢å¤æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyService {
@Retryable(value = IOException.class, maxAttempts = 3)
public String readFile() throws IOException {
// å°è¯•è¯»å–æ–‡ä»¶
}
@Recover // å½“æ‰€æœ‰é‡è¯•å¤±è´¥åï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•
public String recover(IOException e) {
// é™çº§é€»è¾‘ï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªé»˜è®¤å†…å®¹æˆ–è®°å½•å‘Šè­¦
return &amp;#34;Default Content&amp;#34;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯é‡è¯•æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œè¿”å›ç±»å‹åº”ä¸é‡è¯•æ–¹æ³•ä¸€è‡´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4"&gt;&lt;strong&gt;4. &lt;code&gt;@CircuitBreaker&lt;/code&gt;- ç†”æ–­å™¨æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¯¹äºå¯èƒ½é•¿æ—¶é—´ä¸å¯ç”¨çš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;@CircuitBreaker&lt;/code&gt;å®ç°ç†”æ–­æ¨¡å¼ï¼Œé˜²æ­¢æŒç»­é‡è¯•æ¶ˆè€—èµ„æºã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@CircuitBreaker(
value = RemoteAccessException.class,
maxAttempts = 5, // åœ¨ç†”æ–­å‰å°è¯•çš„æ¬¡æ•°
openTimeout = 5000, // ç†”æ–­å™¨æ‰“å¼€åçš„æŒç»­æ—¶é—´(æ¯«ç§’)
resetTimeout = 10000 // ç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€å‰çš„ç­‰å¾…æ—¶é—´(æ¯«ç§’)
)
public void callUnstableService() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç†”æ–­å™¨å·¥ä½œæµç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­ï¼ˆClosedï¼‰&lt;/strong&gt;ï¼šæ­£å¸¸çŠ¶æ€ï¼Œå¤±è´¥æ¬¡æ•°æœªè¾¾é˜ˆå€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰“å¼€ï¼ˆOpenï¼‰&lt;/strong&gt;ï¼šå¤±è´¥æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼Œ&lt;strong&gt;çŸ­æ—¶é—´å†…æ‰€æœ‰è¯·æ±‚ç«‹å³å¤±è´¥ï¼Œä¸å†é‡è¯•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠå¼€ï¼ˆHalf-Openï¼‰&lt;/strong&gt;ï¼šç»è¿‡ &lt;code&gt;resetTimeout&lt;/code&gt;åï¼Œç†”æ–­å™¨å…è®¸å°‘é‡è¯·æ±‚é€šè¿‡ã€‚è‹¥æˆåŠŸåˆ™å…³é—­ç†”æ–­å™¨ï¼Œæ¢å¤å¸¸æ€ï¼›è‹¥å¤±è´¥åˆ™å†æ¬¡æ‰“å¼€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-è¿›é˜¶ç‰¹æ€§ä¸æœ€ä½³å®è·µ"&gt;ğŸ’¡ è¿›é˜¶ç‰¹æ€§ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring Framework 7.0 çš„å†…ç½®æ”¯æŒ&lt;/strong&gt;ï¼šä» Spring Framework 7.0 å¼€å§‹ï¼Œé‡è¯•å’Œå®¹é”™åŠŸèƒ½ï¼ˆåŒ…æ‹¬ &lt;code&gt;@Retryable&lt;/code&gt;å’Œæ–°çš„ &lt;code&gt;@ConcurrencyLimit&lt;/code&gt;ï¼‰å·²&lt;strong&gt;é›†æˆåˆ°æ¡†æ¶æ ¸å¿ƒæ¨¡å—ä¸­&lt;/strong&gt;ï¼Œæ— éœ€å•ç‹¬å¼•å…¥ &lt;code&gt;spring-retry&lt;/code&gt;ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@ConcurrencyLimit&lt;/code&gt;&lt;/strong&gt;ï¼šæ­¤æ³¨è§£å¯ç”¨äº&lt;strong&gt;é™åˆ¶æ–¹æ³•çš„å¹¶å‘è°ƒç”¨æ•°&lt;/strong&gt;ï¼Œé˜²æ­¢è¿‡è½½ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@ConcurrencyLimit(10) // æœ€å¤šå…è®¸10ä¸ªå¹¶å‘è¯·æ±‚
public void handleRequest() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”å¼æ”¯æŒ&lt;/strong&gt;ï¼šSpring Retry ä¹Ÿæ”¯æŒå¯¹ Reactor ç­‰å“åº”å¼æµè¿›è¡Œé‡è¯•è£…é¥°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¢« &lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•å¿…é¡»æ˜¯ &lt;strong&gt;&lt;code&gt;public&lt;/code&gt;&lt;/strong&gt; çš„ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨&lt;strong&gt;åŒä¸€ä¸ªç±»å†…éƒ¨&lt;/strong&gt;è°ƒç”¨é‡è¯•æ–¹æ³•ï¼Œå› ä¸ºåŸºäºAOPçš„ä»£ç†å¯èƒ½ä¸ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;é‡è¯•é€»è¾‘ä¼š&lt;strong&gt;å¢åŠ å“åº”æ—¶é—´å’Œèµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼Œè¯·è°¨æ…è®¾ç½®é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿç­–ç•¥ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶éæ‰€æœ‰å¼‚å¸¸éƒ½é€‚åˆé‡è¯•ï¼ˆå¦‚ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼‰ï¼Œé‡è¯•åº”ä¸»è¦ç”¨äºå¤„ç†&lt;strong&gt;ç¬æ—¶æ•…éšœ&lt;/strong&gt;ï¼ˆç½‘ç»œè¶…æ—¶ã€æ•°æ®åº“è¿æ¥çŸ­æš‚å¤±æ•ˆç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spring Retry é€šè¿‡å£°æ˜å¼çš„æ³¨è§£ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥éå¸¸ç®€æ´å’Œæ¸…æ™°çš„æ–¹å¼ä¸ºæ–¹æ³•å¢æ·» resiliencyï¼ˆå¼¹æ€§ï¼‰èƒ½åŠ›ã€‚æ­£ç¡®é…ç½®å’Œä½¿ç”¨è¿™äº›æ³¨è§£ï¼Œèƒ½æ˜¾è‘—æå‡åº”ç”¨ç¨‹åºåº”å¯¹ä¸å¯é ä¾èµ–å’Œç½‘ç»œæ³¢åŠ¨çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨ Spring Retryã€‚&lt;/p&gt;
&lt;h2 id="recover"&gt;@Recover
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Recover&lt;/code&gt;æ³¨è§£çš„&lt;strong&gt;ç”Ÿæ•ˆèŒƒå›´ç¡®å®ä»…é™äºå®ƒæ‰€åœ¨çš„ç±»&lt;/strong&gt;ã€‚å®ƒåªèƒ½å¤„ç†&lt;strong&gt;åŒä¸€ä¸ªç±»ä¸­&lt;/strong&gt;è¢« &lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£æ ‡è®°çš„æ–¹æ³•åœ¨é‡è¯•å…¨éƒ¨å¤±è´¥åçš„æ¢å¤é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿç†è§£ &lt;code&gt;@Recover&lt;/code&gt;çš„å·¥ä½œè§„åˆ™ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬å…¶æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;è§„åˆ™è¯´æ˜&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹æˆ–å¤‡æ³¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å†…ç”Ÿæ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•&lt;strong&gt;å¿…é¡»&lt;/strong&gt;ä¸å¯¹åº”çš„ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•åœ¨&lt;strong&gt;åŒä¸€ä¸ªç±»&lt;/strong&gt;ä¸­å®šä¹‰ã€‚&lt;/td&gt;
&lt;td&gt;æ— æ³•æ•è·å’Œå¤„ç†å…¶ä»–ç±»ä¸­æ–¹æ³•çš„é‡è¯•å¤±è´¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸ç±»å‹åŒ¹é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°&lt;/strong&gt;å¿…é¡»æ˜¯ &lt;code&gt;Throwable&lt;/code&gt;ç±»å‹æˆ–å…¶å­ç±»ï¼Œä¸”é€šå¸¸åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•é…ç½®çš„å¼‚å¸¸ç±»å‹ä¸€è‡´æˆ–ä¸ºå…¶çˆ¶ç±»ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Retryable(value = IOException.class)&lt;/code&gt;å¯¹åº” &lt;code&gt;@Recover public void recover(IOException e)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‚æ•°åˆ—è¡¨åŒ¹é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„å‚æ•°ï¼ˆé™¤ç¬¬ä¸€ä¸ªå¼‚å¸¸å‚æ•°å¤–ï¼‰åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•çš„å‚æ•°&lt;strong&gt;ä¿æŒä¸€è‡´&lt;/strong&gt;ï¼ˆåŒ…æ‹¬å‚æ•°ç±»å‹å’Œé¡ºåºï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Retryable(String a, int b)&lt;/code&gt;å¯¹åº” &lt;code&gt;@Recover(...Exception e, String a, int b)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›å€¼åŒ¹é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;è¿”å›å€¼ç±»å‹&lt;/strong&gt;å¿…é¡»ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•çš„è¿”å›å€¼ç±»å‹&lt;strong&gt;å®Œå…¨ç›¸åŒ&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å¦‚æœ &lt;code&gt;@Retryable&lt;/code&gt;è¿”å› &lt;code&gt;String&lt;/code&gt;ï¼Œ&lt;code&gt;@Recover&lt;/code&gt;ä¹Ÿå¿…é¡»è¿”å› &lt;code&gt;String&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•åŒ¹é…ä¼˜å…ˆçº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å½“æœ‰å¤šä¸ª &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ—¶ï¼ŒSpring Retry ä¼šé€‰æ‹©&lt;strong&gt;å¼‚å¸¸ç±»å‹æœ€å…·ä½“ã€å‚æ•°æœ€å…¼å®¹&lt;/strong&gt;çš„é‚£ä¸ªã€‚&lt;/td&gt;
&lt;td&gt;è‹¥æœ‰ &lt;code&gt;recover(IOException e)&lt;/code&gt;å’Œ &lt;code&gt;recover(Exception e)&lt;/code&gt;ï¼Œå½“æŠ›å‡º &lt;code&gt;IOException&lt;/code&gt;æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‰è€…ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;å¦‚ä½•æ­£ç¡®ä½¿ç”¨ &lt;code&gt;@Recover&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç¡®ä¿ &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æŒ‰é¢„æœŸå·¥ä½œï¼Œéœ€æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç±»å†…å®šä¹‰&lt;/strong&gt;ï¼š&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•å¿…é¡»å’Œå®ƒè¦å¤„ç†çš„ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•åœ¨&lt;strong&gt;åŒä¸€ä¸ªç±»ä¸­&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°åŒ¹é…&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œä¸”åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;ä¸­æŒ‡å®šçš„å¼‚å¸¸ç±»å‹åŒ¹é…æˆ–æ›´é€šç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åç»­å‚æ•°åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´&lt;/strong&gt;ï¼ˆåŒ…æ‹¬ç±»å‹å’Œé¡ºåºï¼‰ã€‚ä½ å¯ä»¥é€‰æ‹©æ¥æ”¶æ‰€æœ‰å‚æ•°ï¼Œæˆ–åªæ¥æ”¶éœ€è¦çš„éƒ¨åˆ†ï¼Œä½†&lt;strong&gt;é¡ºåºå¿…é¡»ä¸€è‡´&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼åŒ¹é…&lt;/strong&gt;ï¼š&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;è¿”å›ç±»å‹å¿…é¡»ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•å®Œå…¨ç›¸åŒ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;åŒä¸€ç±»ä¸­æœ‰å¤šä¸ª &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ—¶å¦‚ä½•åŒºåˆ†ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ª &lt;code&gt;@Retryable&lt;/code&gt;å’Œ &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ—¶ï¼ŒSpring Retry é€šè¿‡&lt;strong&gt;å¼‚å¸¸ç±»å‹&lt;/strong&gt;å’Œ&lt;strong&gt;æ–¹æ³•å‚æ•°&lt;/strong&gt;æ¥åŒ¹é…ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyService {
@Retryable(value = IOException.class, maxAttempts = 3)
public String methodA(String fileName) throws IOException {
// å°è¯•è¯»å–æ–‡ä»¶ï¼Œå¯èƒ½æŠ›å‡ºIOException
return &amp;#34;Content from &amp;#34; + fileName;
}
@Retryable(value = SQLException.class, maxAttempts = 3)
public void methodB(Integer id) throws SQLException {
// æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½æŠ›å‡ºSQLException
}
// åŒ¹é…methodAçš„æ¢å¤æ–¹æ³•
@Recover
public String recoverForIOException(IOException e, String fileName) {
return &amp;#34;Recovered from IOException for file: &amp;#34; + fileName + &amp;#34;; Error: &amp;#34; + e.getMessage();
}
// åŒ¹é…methodBçš„æ¢å¤æ–¹æ³•
@Recover
public void recoverForSQLException(SQLException e, Integer id) {
// å¤„ç†SQLExceptionçš„æ¢å¤é€»è¾‘ï¼Œè®°å½•æ—¥å¿—ç­‰
System.out.println(&amp;#34;Recovered from SQLException for ID: &amp;#34; + id);
}
// ä¸€ä¸ªæ›´é€šç”¨çš„æ¢å¤æ–¹æ³•ï¼Œå¤„ç†å…¶ä»–æœªæ˜ç¡®æŒ‡å®šçš„å¼‚å¸¸
@Recover
public String genericRecover(Exception e, Object... args) {
// å¤„ç†å…¶ä»–å¼‚å¸¸æˆ–ä½œä¸ºå…œåº•
return &amp;#34;Generic recovery after all retries failed for: &amp;#34; + e.getMessage();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ &lt;code&gt;methodA&lt;/code&gt;é‡è¯•å¤±è´¥åï¼Œä¼šè°ƒç”¨ &lt;code&gt;recoverForIOException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å½“ &lt;code&gt;methodB&lt;/code&gt;é‡è¯•å¤±è´¥åï¼Œä¼šè°ƒç”¨ &lt;code&gt;recoverForSQLException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰ä¸€ä¸ª &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸æœªè¢«å‰ä¸¤ä¸ª &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ˜ç¡®åŒ¹é…ï¼Œä¸”å…¶å‚æ•°ä¸ &lt;code&gt;genericRecover&lt;/code&gt;å…¼å®¹ï¼ˆæ³¨æ„å®ƒæ˜¯ &lt;code&gt;Object... args&lt;/code&gt;ï¼‰ï¼Œåˆ™å¯èƒ½ä¼šè°ƒç”¨ &lt;code&gt;genericRecover&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è‡ªè°ƒç”¨&lt;/strong&gt;ï¼šç”±äº &lt;code&gt;@Retryable&lt;/code&gt;å’Œ &lt;code&gt;@Recover&lt;/code&gt;åŸºäº &lt;strong&gt;Spring AOP ä»£ç†&lt;/strong&gt;å®ç°ï¼Œæ‰€ä»¥&lt;strong&gt;åœ¨åŒä¸€ä¸ªç±»å†…éƒ¨çš„ä¸€ä¸ªæ–¹æ³•ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ª &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œé‡è¯•å’Œæ¢å¤é€»è¾‘ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚åŠ¡å¿…é€šè¿‡å¤–éƒ¨è°ƒç”¨æˆ–ä»Springå®¹å™¨ä¸­è·å–ä»£ç†åçš„Beanæ¥è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿å¹‚ç­‰æ€§&lt;/strong&gt;ï¼šç”±äºæ–¹æ³•ä¼šè¢«å¤šæ¬¡é‡è¯•ï¼ŒåŠ¡å¿…ä¿è¯ &lt;code&gt;@Retryable&lt;/code&gt;æ ‡è®°çš„æ–¹æ³•çš„&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼Œå³å¤šæ¬¡æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…è®¾ç½®é‡è¯•&lt;/strong&gt;ï¼šé¿å…æ— é™é‡è¯•æˆ–é‡è¯•é—´éš”è¿‡çŸ­ï¼Œä»¥å…å¯¹ä¸‹æ¸¸æœåŠ¡é€ æˆè¿‡å¤§å‹åŠ›ã€‚é‡è¯•é€‚ç”¨äº&lt;strong&gt;ä¸´æ—¶æ€§æ•…éšœ&lt;/strong&gt;ï¼ˆå¦‚ç½‘ç»œæ³¢åŠ¨ã€ç¬æ—¶è¶…æ—¶ï¼‰ï¼Œè€Œéä¸šåŠ¡é€»è¾‘é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@Recover&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="ç±»çº§-retryable"&gt;ç±»çº§ Retryable
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£&lt;strong&gt;å¯ä»¥æ·»åŠ åˆ°ç±»ä¸Š&lt;/strong&gt;ã€‚å½“å®ƒç”¨äºç±»çº§åˆ«æ—¶ï¼Œè¡¨ç¤º&lt;strong&gt;è¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;éƒ½ä¼šæˆä¸ºå¯é‡è¯•çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿäº†è§£ &lt;code&gt;@Retryable&lt;/code&gt;åœ¨æ–¹æ³•çº§åˆ«å’Œç±»çº§åˆ«åº”ç”¨çš„ä¸»è¦åŒºåˆ«ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;æ–¹æ³•çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨èŒƒå›´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…ä½œç”¨äºè¢«æ³¨è§£çš„&lt;strong&gt;å•ä¸ªæ–¹æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½œç”¨äºè¯¥ç±»çš„&lt;strong&gt;æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯ä»¥ä¸º&lt;strong&gt;æ¯ä¸ªæ–¹æ³•å•ç‹¬å®šåˆ¶&lt;/strong&gt;é‡è¯•ç­–ç•¥ï¼ˆå¼‚å¸¸ã€æ¬¡æ•°ã€å»¶è¿Ÿç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸ºè¯¥ç±»æ‰€æœ‰æ–¹æ³•æä¾›&lt;strong&gt;ç»Ÿä¸€çš„é»˜è®¤é‡è¯•ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦ä¸ºä¸åŒæ–¹æ³•è®¾ç½®ä¸åŒé‡è¯•è§„åˆ™æ—¶&lt;/td&gt;
&lt;td&gt;ç±»ä¸­å¤šä¸ªæ–¹æ³•éœ€è¦&lt;strong&gt;å…±äº«ç›¸åŒ&lt;/strong&gt;çš„é‡è¯•ç­–ç•¥æ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶ç²¾åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ï¼Œå¯ç²¾å‡†æ§åˆ¶æ¯ä¸ªæ–¹æ³•çš„è¡Œä¸º&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç›¸å¯¹è¾ƒä½&lt;/strong&gt;ï¼Œä¾èµ–ç±»çº§åˆ«çš„ç»Ÿä¸€é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸ç”¨å±æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;, &lt;code&gt;include&lt;/code&gt;, &lt;code&gt;exclude&lt;/code&gt;, &lt;code&gt;maxAttempts&lt;/code&gt;, &lt;code&gt;backoff&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;include&lt;/code&gt;, &lt;code&gt;exclude&lt;/code&gt;, &lt;code&gt;maxAttempts&lt;/code&gt;, &lt;code&gt;delay&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;ç±»çº§åˆ«ä½¿ç”¨ç¤ºä¾‹ä¸è¦ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
@Retryable(maxAttempts = 3, backoff = @Backoff(delay = 1000)) // åº”ç”¨äºæ•´ä¸ªç±»
public class MyService {
// æ­¤æ–¹æ³•ä¼šç»§æ‰¿ç±»çº§åˆ«çš„é‡è¯•é…ç½®ï¼šæœ€å¤šé‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”1ç§’
public void methodOne() {
// ... å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
}
// æ­¤æ–¹æ³•ä¹Ÿä¼šç»§æ‰¿ç±»çº§åˆ«çš„é‡è¯•é…ç½®
public void methodTwo() {
// ... å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
}
// å³ä½¿ç±»çº§åˆ«æœ‰é…ç½®ï¼Œæ–¹æ³•çº§åˆ«çš„æ³¨è§£ä¹Ÿä¼šè¦†ç›–ç±»çº§åˆ«çš„é…ç½®ã€‚æ­¤æ–¹æ³•ä¼šä½¿ç”¨è‡ªå·±çš„é‡è¯•ç­–ç•¥ï¼šæœ€å¤šé‡è¯•5æ¬¡
@Retryable(maxAttempts = 5)
public void methodThree() {
// ... å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;âš¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åªå¯¹ public æ–¹æ³•ç”Ÿæ•ˆ&lt;/strong&gt;ï¼šSpring Retry åŸºäº AOP å®ç°ï¼Œå› æ­¤ &lt;code&gt;@Retryable&lt;/code&gt;ï¼ˆæ— è®ºæ˜¯ç±»çº§åˆ«è¿˜æ˜¯æ–¹æ³•çº§åˆ«ï¼‰&lt;strong&gt;åªå¯¹ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•æœ‰æ•ˆ&lt;/strong&gt;ã€‚å¯¹ &lt;code&gt;protected&lt;/code&gt;ã€&lt;code&gt;private&lt;/code&gt;æˆ–é»˜è®¤æƒé™çš„æ–¹æ³•æ— æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åŒç±»è°ƒç”¨&lt;/strong&gt;ï¼šå¦‚æœä¸€ä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodA&lt;/code&gt;ï¼‰&lt;strong&gt;ç›´æ¥è°ƒç”¨&lt;/strong&gt;äº†åŒä¸€ä¸ªç±»ä¸­çš„å¦ä¸€ä¸ª &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodB&lt;/code&gt;ï¼‰ï¼Œé‚£ä¹ˆ &lt;code&gt;methodB&lt;/code&gt;çš„é‡è¯•é€»è¾‘&lt;strong&gt;ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸º Spring AOP ä»£ç†æœºåˆ¶çš„é™åˆ¶ã€‚è°ƒç”¨å¿…é¡»é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œï¼Œé€šå¸¸æ„å‘³ç€æ–¹æ³•éœ€è¦è¢«å¤–éƒ¨ç±»è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…é…ç½®å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼šåœ¨ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨ &lt;code&gt;include&lt;/code&gt;æˆ– &lt;code&gt;exclude&lt;/code&gt;ç»†åŒ–å¼‚å¸¸ç±»å‹ï¼Œé»˜è®¤å¯èƒ½ä¼šå¯¹è®¸å¤šå¼‚å¸¸è¿›è¡Œé‡è¯•ã€‚å»ºè®®&lt;strong&gt;æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œä½¿ç”¨ &lt;code&gt;include&lt;/code&gt;æˆ– &lt;code&gt;exclude&lt;/code&gt;å±æ€§æ¥æ˜ç¡®æŒ‡å®šéœ€è¦æˆ–ä¸éœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œä»¥é¿å…å¯¹ä¸æœŸæœ›çš„å¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;NullPointerException&lt;/code&gt;ç­‰ä»£ç é”™è¯¯ï¼‰è¿›è¡Œé‡è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å®ç”¨å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«é€šç”¨é…ç½®&lt;/strong&gt;ï¼šå¦‚æœä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ–¹æ³•éœ€è¦&lt;strong&gt;ç›¸åŒçš„é‡è¯•ç­–ç•¥&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨åŒä¸€ä¸ªä¸ç¨³å®šå¤–éƒ¨æœåŠ¡çš„å¤šä¸ªæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆåœ¨ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;éå¸¸æ–¹ä¾¿ï¼Œèƒ½é¿å…é‡å¤é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦ç‰¹ä¾‹æ—¶è¦†å†™&lt;/strong&gt;ï¼šå¦‚æœç±»ä¸­å¤§å¤šæ•°æ–¹æ³•é€‚ç”¨é€šç”¨é‡è¯•ç­–ç•¥ï¼Œä½†å°‘æ•°æ–¹æ³•éœ€è¦ç‰¹æ®Šé…ç½®ï¼Œä½ å¯ä»¥åœ¨ç±»çº§åˆ«å®šä¹‰é€šç”¨è§„åˆ™ï¼Œç„¶ååœ¨é‚£äº›éœ€è¦å®šåˆ¶çš„æ–¹æ³•ä¸Šå•ç‹¬ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;è¿›è¡Œè¦†ç›–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®å¼‚å¸¸èŒƒå›´&lt;/strong&gt;ï¼šåœ¨ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;æ—¶ï¼Œ&lt;strong&gt;å¼ºçƒˆå»ºè®®é€šè¿‡ &lt;code&gt;include&lt;/code&gt;æˆ– &lt;code&gt;exclude&lt;/code&gt;å±æ€§æ˜ç¡®æŒ‡å®šè¦é‡è¯•æˆ–æ’é™¤çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œä»¥å¢å¼ºä»£ç çš„å¯æ§æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="ç¼“å­˜"&gt;ç¼“å­˜
&lt;/h2&gt;&lt;h2 id="ç±»çº§ç¼“å­˜"&gt;ç±»çº§ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶çš„ç¼“å­˜æ³¨è§£ä¸­ï¼Œä¸»è¦æœ‰ &lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt; å’Œ &lt;strong&gt;&lt;code&gt;@CachePut&lt;/code&gt;&lt;/strong&gt; è¿™ä¸¤ä¸ªæ³¨è§£æ—¢å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ ‡æ³¨åœ¨ç±»ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿäº†è§£è¿™äº›æ³¨è§£åœ¨ç±»å’Œæ–¹æ³•ä¸Šçš„ä½¿ç”¨ç‰¹ç‚¹ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;ç±»çº§åˆ«ä½¿ç”¨&lt;/th&gt;
&lt;th&gt;æ–¹æ³•çº§åˆ«ä½¿ç”¨&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥&lt;strong&gt;ç±»æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;çš„æ”¯æŒç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯æ”¯æŒç¼“å­˜çš„ã€‚&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«å¯ä¸ºæ‰€æœ‰æ–¹æ³•æä¾›&lt;strong&gt;é»˜è®¤ç¼“å­˜è¡Œä¸º&lt;/strong&gt;ï¼Œæ–¹æ³•çº§åˆ«æ³¨è§£å¯&lt;strong&gt;è¦†ç›–&lt;/strong&gt;ç±»çº§åˆ«çš„å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CachePut&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥&lt;strong&gt;ç±»æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;çš„æ‰§è¡Œç»“æœéƒ½ä¼šæ›´æ–°ç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥æ–¹æ³•çš„æ‰§è¡Œç»“æœä¼šæ›´æ–°ç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«å¯ä¸ºæ‰€æœ‰æ–¹æ³•æä¾›&lt;strong&gt;é»˜è®¤ç¼“å­˜æ›´æ–°è¡Œä¸º&lt;/strong&gt;ï¼Œæ–¹æ³•çº§åˆ«æ³¨è§£å¯&lt;strong&gt;è¦†ç›–&lt;/strong&gt;ç±»çº§åˆ«çš„å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CacheEvict&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ï¼ˆç”±æºç å¯å¾—å¯ç±»çº§åˆ«ï¼‰&lt;/td&gt;
&lt;td&gt;ç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œåï¼ˆæˆ–ä¹‹å‰ï¼‰æ¸…é™¤ç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;é€šå¸¸ç”¨äºæ–¹æ³•çº§åˆ«ï¼Œä»¥ç²¾ç¡®æ§åˆ¶ç¼“å­˜æ¸…é™¤æ“ä½œã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ï¼ˆç”±æºç å¯å¾—å¯ç±»çº§åˆ«ï¼‰&lt;/td&gt;
&lt;td&gt;ç”¨äºç»„åˆå¤šä¸ªç¼“å­˜æ“ä½œï¼ˆå¦‚åŒæ—¶ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt;ã€&lt;code&gt;@CachePut&lt;/code&gt;ã€&lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰äºä¸€ä¸ªæ–¹æ³•ã€‚&lt;/td&gt;
&lt;td&gt;é€šå¸¸ç”¨äºæ–¹æ³•çº§åˆ«ï¼Œå¤„ç†å¤æ‚çš„ç¼“å­˜é€»è¾‘ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºç±»çº§åˆ«ï¼Œ&lt;strong&gt;å…±äº«&lt;/strong&gt;ç¼“å­˜é…ç½®ï¼ˆå¦‚ &lt;code&gt;cacheNames&lt;/code&gt;ã€&lt;code&gt;keyGenerator&lt;/code&gt;ï¼‰ï¼Œç®€åŒ–æ–¹æ³•çº§åˆ«æ³¨è§£çš„é…ç½®ã€‚&lt;/td&gt;
&lt;td&gt;ä¸ç›´æ¥ç”¨äºæ–¹æ³•ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯ä¸€ä¸ª&lt;strong&gt;ç±»çº§åˆ«&lt;/strong&gt;çš„é…ç½®æ³¨è§£ï¼Œæ—¨åœ¨å‡å°‘æ–¹æ³•çº§åˆ«æ³¨è§£çš„é‡å¤é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;è¡¥å……è¯´æ˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„&lt;strong&gt;ç±»çº§åˆ«æ³¨è§£&lt;/strong&gt;ï¼Œå®ƒæœ¬èº«ä¸ç›´æ¥è§¦å‘ä»»ä½•ç¼“å­˜æ“ä½œï¼Œè€Œæ˜¯ä¸ºç±»ä¸­çš„å…¶ä»–ç¼“å­˜æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Cacheable&lt;/code&gt;, &lt;code&gt;@CachePut&lt;/code&gt;, &lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰æä¾›&lt;strong&gt;å…±äº«çš„é»˜è®¤é…ç½®&lt;/strong&gt;ï¼Œä»è€Œé¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šé‡å¤ç›¸åŒçš„é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å®ç”¨å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨ç±»çº§åˆ«æ³¨è§£&lt;/strong&gt;ï¼šåœ¨ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt;æˆ– &lt;code&gt;@CachePut&lt;/code&gt;æ„å‘³ç€è¯¥ç±»çš„&lt;strong&gt;æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;éƒ½å°†åº”ç”¨ç¼“å­˜è§„åˆ™ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸€äº›ä¸éœ€è¦ç¼“å­˜çš„æ–¹æ³•ï¼ˆå¦‚ç®€å•æŸ¥è¯¢ã€é¢‘ç¹æ›´æ–°æ–¹æ³•ï¼‰ä¹Ÿè¢«ç¼“å­˜ï¼Œä»è€Œ&lt;strong&gt;æµªè´¹èµ„æºæˆ–äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´&lt;/strong&gt;ã€‚é€šå¸¸å»ºè®®æ ¹æ®å®é™…éœ€æ±‚ï¼Œåœ¨å…·ä½“æ–¹æ³•ä¸Šä½¿ç”¨ç›¸åº”çš„ç¼“å­˜æ³¨è§£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“æ–¹æ³•çº§åˆ«å’Œç±»çº§åˆ«éƒ½æœ‰ç›¸åŒç±»å‹çš„ç¼“å­˜æ³¨è§£æ—¶ï¼Œ&lt;strong&gt;æ–¹æ³•çº§åˆ«çš„æ³¨è§£é…ç½®ä¼šè¦†ç›–ç±»çº§åˆ«çš„é»˜è®¤é…ç½®&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;ï¼šä¸ºäº†ä¿æŒä»£ç ç®€æ´ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;@CacheConfig&lt;/code&gt;åœ¨ç±»çº§åˆ«å®šä¹‰ä¸€äº›é€šç”¨çš„ç¼“å­˜è®¾ç½®ï¼ˆå¦‚ &lt;code&gt;cacheNames&lt;/code&gt;ï¼‰ï¼Œç„¶ååœ¨æ–¹æ³•çº§åˆ«çš„æ³¨è§£ä¸­åªéœ€æŒ‡å®šå¿…è¦çš„å±æ€§ï¼ˆå¦‚ &lt;code&gt;key&lt;/code&gt;æˆ– &lt;code&gt;condition&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Spring ç¼“å­˜æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="goaway"&gt;GOAWAY
&lt;/h2&gt;&lt;p&gt;å½“ä½ ä½œä¸ºå®¢æˆ·ç«¯è°ƒç”¨å¤§æ¨¡å‹æ¥å£é‡åˆ°æœåŠ¡ç«¯è¿”å› &lt;code&gt;GOAWAY received&lt;/code&gt;é”™è¯¯æ—¶ï¼Œè¿™é€šå¸¸æ˜¯HTTP/2åè®®å±‚é¢è¿æ¥ç®¡ç†çš„è¡Œä¸ºã€‚æˆ‘æ¥ä¸ºä½ è§£é‡ŠåŸå› å’Œåº”å¯¹æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id="-äº†è§£-goaway-å¸§"&gt;ğŸ” äº†è§£ GOAWAY å¸§
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;GOAWAY&lt;/code&gt;å¸§æ˜¯ &lt;strong&gt;HTTP/2 åè®®ä¸­ç”¨äºæ­£å¸¸å…³é—­è¿æ¥çš„ä¿¡å·&lt;/strong&gt; ã€‚æœåŠ¡ç«¯å‘é€å®ƒæ¥å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼šâ€œå½“å‰è¿æ¥å³å°†å…³é—­ï¼Œè¯·åœæ­¢åœ¨æ­¤è¿æ¥ä¸Šå‘èµ·æ–°è¯·æ±‚ï¼Œä½†ä¼šå¤„ç†å®Œå·²å‘å‡ºçš„è¯·æ±‚â€ã€‚è¿™é€šå¸¸æ˜¯&lt;strong&gt;æœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·çš„è¡Œä¸º&lt;/strong&gt;ï¼Œå¸¸è§äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯ç»´æŠ¤æˆ–é‡å¯&lt;/strong&gt;ï¼šæœåŠ¡ç«¯è®¡åˆ’åœæœºå‰ï¼Œå‘é€GOAWAYå¸§é€šçŸ¥å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿å…¶åˆ‡æ¢åˆ°æ–°è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ä¸è¿æ¥ç®¡ç†&lt;/strong&gt;ï¼šæœåŠ¡ç«¯å¯èƒ½ä¸ºäº†è´Ÿè½½å‡è¡¡æˆ–è¿æ¥ç»´æŠ¤ï¼ˆå¦‚å®šæœŸç»ˆæ­¢è¿æ¥ä»¥åˆ·æ–°ï¼‰è€Œå…³é—­è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å™¨ç«¯é™åˆ¶&lt;/strong&gt;ï¼šä¾‹å¦‚ï¼ŒNginx çš„ &lt;code&gt;http2_max_requests&lt;/code&gt;å‚æ•°é»˜è®¤å…è®¸ä¸€ä¸ªè¿æ¥ä¸Šæœ€å¤šå¤„ç†1000ä¸ªè¯·æ±‚ï¼Œä¹‹åä¼šå‘é€GOAWAYå¸§å…³é—­è¿æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å®¢æˆ·ç«¯çš„å¤„ç†ç­–ç•¥"&gt;ğŸ› ï¸ å®¢æˆ·ç«¯çš„å¤„ç†ç­–ç•¥
&lt;/h3&gt;&lt;p&gt;ä½œä¸ºå®¢æˆ·ç«¯ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åº”å¯¹ &lt;code&gt;GOAWAY&lt;/code&gt;é”™è¯¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é‡è¯•è¯·æ±‚&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€ç›´æ¥å’Œå¸¸è§çš„å¤„ç†æ–¹å¼ã€‚å½“æ•è·åˆ°åŒ…å« &amp;ldquo;GOAWAY&amp;rdquo; ä¿¡æ¯çš„ &lt;code&gt;IOException&lt;/code&gt;æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥&lt;strong&gt;è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚&lt;/strong&gt;ã€‚å¯¹äº &lt;strong&gt;å¹‚ç­‰æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚GETè¯·æ±‚ï¼‰ï¼Œé‡è¯•æ˜¯å®‰å…¨çš„ã€‚å¯¹äº&lt;strong&gt;éå¹‚ç­‰æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚POSTï¼‰ï¼Œè™½ç„¶éœ€è°¨æ…ï¼Œä½†è‹¥GOAWAYå¸§è¡¨æ˜è¯·æ±‚æœªè¢«å¤„ç†ï¼Œé‡è¯•é€šå¸¸ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚Java HttpClient ç­‰åº“åœ¨æ”¶åˆ°GOAWAYå¸§æ—¶å¯èƒ½ä¼šæŠ›å‡ºIOExceptionï¼Œå…¶æ¶ˆæ¯å¯èƒ½åŒ…å«&amp;quot;GOAWAY received&amp;quot;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å»ºè¿æ¥&lt;/strong&gt;ï¼šHTTP/2å®¢æˆ·ç«¯åœ¨æ”¶åˆ°GOAWAYå¸§åï¼Œ&lt;strong&gt;åº”ä¸»åŠ¨å»ºç«‹æ–°çš„è¿æ¥&lt;/strong&gt;ä»¥ä¾›åç»­è¯·æ±‚ä½¿ç”¨ã€‚ä¸€äº›HTTP/2å®¢æˆ·ç«¯åº“å¯èƒ½ä¼šè‡ªåŠ¨å¤„ç†æ­¤è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨è¿æ¥æ± å¹¶ç›‘æ§çŠ¶æ€&lt;/strong&gt;ï¼šå¯¹äºé¢‘ç¹è°ƒç”¨æœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œå®ç°&lt;strong&gt;è¿æ¥æ± ç®¡ç†&lt;/strong&gt;æœ‰åŠ©äºä¼˜åŒ–èµ„æºã€‚åŒæ—¶ï¼Œå¯ä»¥&lt;strong&gt;ç›‘æ§è¿æ¥çŠ¶æ€&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼ŒgRPC Javaåº“å…è®¸æŸ¥è¯¢Channelçš„çŠ¶æ€ï¼Œè‹¥è¿æ¥å› GOAWAYè¿›å…¥æ•…éšœçŠ¶æ€ï¼Œå¯æ‰‹åŠ¨è§¦å‘é‡å»ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜é›…é™çº§ä¸è¶…æ—¶æ§åˆ¶&lt;/strong&gt;ï¼šå¦‚æœæœåŠ¡ç«¯é¢‘ç¹å‘é€GOAWAYï¼ˆå¦‚ç”±äºè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰ï¼Œç¡®ä¿å®¢æˆ·ç«¯æœ‰&lt;strong&gt;é‡è¯•æ¬¡æ•°é™åˆ¶&lt;/strong&gt;å’Œ&lt;strong&gt;è¶…æ—¶æœºåˆ¶&lt;/strong&gt;ï¼Œé¿å…æ— é™é‡è¯•æˆ–é•¿æ—¶é—´ç­‰å¾…ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹è¡¨æ±‡æ€»äº†å…³é”®å¤„ç†ç­–ç•¥å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¤„ç†ç­–ç•¥&lt;/th&gt;
&lt;th&gt;å…·ä½“åšæ³•&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨é‡è¯•è¯·æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•è·GOAWAYé”™è¯¯åï¼Œé‡è¯•å¤±è´¥çš„è¯·æ±‚ã€‚&lt;/td&gt;
&lt;td&gt;å¹‚ç­‰æ“ä½œï¼ˆGETï¼‰å¯å®‰å…¨é‡è¯•ï¼›éå¹‚ç­‰æ“ä½œï¼ˆPOSTï¼‰éœ€è°¨æ…ï¼Œç¡®è®¤è¯·æ±‚æœªè¢«å¤„ç†æ–¹å¯é‡è¯•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é‡å»ºè¿æ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;HTTP/2å®¢æˆ·ç«¯æ”¶åˆ°GOAWAYåï¼Œåº”å»ºç«‹æ–°è¿æ¥ä»¥ä¾›åç»­è¯·æ±‚ä½¿ç”¨ã€‚&lt;/td&gt;
&lt;td&gt;æŸäº›HTTP/2å®¢æˆ·ç«¯åº“å¯èƒ½è‡ªåŠ¨å¤„ç†æ­¤è¿‡ç¨‹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½¿ç”¨è¿æ¥æ± ä¸ç›‘æ§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°è¿æ¥æ± ç®¡ç†ï¼›ç›‘æ§è¿æ¥çŠ¶æ€ï¼ˆå¦‚gRPC ChannelçŠ¶æ€ï¼‰ï¼Œè¿æ¥æ•…éšœæ—¶æ‰‹åŠ¨é‡å»ºã€‚&lt;/td&gt;
&lt;td&gt;æœ‰åŠ©äºä¼˜åŒ–èµ„æºå’Œä½¿ç”¨ï¼›éœ€è¦å®¢æˆ·ç«¯å…·å¤‡çŠ¶æ€æŸ¥è¯¢èƒ½åŠ›ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼˜é›…é™çº§ä¸è¶…æ—¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®¾ç½®é‡è¯•æ¬¡æ•°ä¸Šé™å’Œè¶…æ—¶æ—¶é—´ï¼Œé¿å…æ— é™é‡è¯•æˆ–é•¿æ—¶é—´ç­‰å¾…ã€‚&lt;/td&gt;
&lt;td&gt;é˜²æ­¢å› æœåŠ¡ç«¯æŒç»­GOAWAYå¯¼è‡´å®¢æˆ·ç«¯èµ„æºè€—å°½æˆ–å“åº”ç¼“æ…¢ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ’æŸ¥å…¶ä»–æ½œåœ¨é—®é¢˜"&gt;ğŸ” æ’æŸ¥å…¶ä»–æ½œåœ¨é—®é¢˜
&lt;/h3&gt;&lt;p&gt;å¦‚æœGOAWAYå¸§ä¼´éšç‰¹å®šçš„é”™è¯¯ç ï¼ˆè€Œä¸ä»…ä»…æ˜¯è¿æ¥å…³é—­ï¼‰ï¼Œæˆ–è€…é—®é¢˜æŒç»­å‡ºç°ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥æœåŠ¡å™¨ç«¯é…ç½®ä¸çŠ¶æ€&lt;/strong&gt;ï¼šæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€HTTP/2è¿æ¥çš„ç›¸å…³é…ç½®ï¼ˆå¦‚æœ€å¤§è¯·æ±‚æ•°ã€æœ€å¤§è¿æ¥å¹´é¾„ï¼‰å¯èƒ½è§¦å‘GOAWAYã€‚å…³æ³¨æœåŠ¡ç«¯çš„ç»´æŠ¤å…¬å‘Šæˆ–çŠ¶æ€é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¡æŸ¥è¯·æ±‚å†…å®¹&lt;/strong&gt;ï¼šè™½ç„¶è¾ƒå°‘è§ï¼Œä½†æŸäº›åè®®é”™è¯¯ï¼ˆå¦‚è¯·æ±‚å¤´è¿‡å¤§ï¼‰ä¹Ÿå¯èƒ½å¯¼è‡´æœåŠ¡ç«¯å‘é€é”™è¯¯ç ä¸º&lt;code&gt;PROTOCOL_ERROR&lt;/code&gt;çš„GOAWAYå¸§ã€‚ç¡®ä¿è¯·æ±‚ç¬¦åˆHTTP/2è§„èŒƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ç®€è¦æ€»ç»“-1"&gt;ğŸ’ ç®€è¦æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é‡åˆ° &lt;code&gt;GOAWAY received&lt;/code&gt;é”™è¯¯æ—¶ï¼Œ&lt;strong&gt;å®¢æˆ·ç«¯åº”è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ï¼ˆæ³¨æ„å¹‚ç­‰æ€§ï¼‰ï¼Œå¹¶ç¡®ä¿èƒ½å»ºç«‹æ–°çš„HTTP/2è¿æ¥&lt;/strong&gt;ã€‚å¤šæ•°ç°ä»£HTTPå®¢æˆ·ç«¯åº“èƒ½ä¸€å®šç¨‹åº¦å¤„ç†GOAWAYå¸§ã€‚è‹¥é—®é¢˜é¢‘å‘ï¼Œéœ€æ£€æŸ¥æœåŠ¡ç«¯é…ç½®å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ è§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="synchronized--reentrantlock"&gt;synchronized &amp;amp; ReentrantLock
&lt;/h2&gt;&lt;p&gt;äº†è§£ &lt;code&gt;synchronized&lt;/code&gt;å’Œ &lt;code&gt;ReentrantLock&lt;/code&gt;åœ¨é”å®šä»£ç å—æ—¶çš„åŒºåˆ«ï¼Œå¯¹äºç¼–å†™æ­£ç¡®ã€é«˜æ•ˆçš„å¤šçº¿ç¨‹ç¨‹åºå¾ˆé‡è¦ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;synchronized&lt;/th&gt;
&lt;th&gt;ReentrantLock&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸºæœ¬æ€§è´¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Javaå…³é”®å­—ï¼ŒJVMåŸç”Ÿæ”¯æŒ****&lt;/td&gt;
&lt;td&gt;&lt;code&gt;java.util.concurrent.locks&lt;/code&gt;åŒ…ä¸­çš„ç±»****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é”ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;éšå¼&lt;/strong&gt;ç®¡ç†ï¼Œè¿›å…¥ä»£ç å—è‡ªåŠ¨åŠ é”ï¼Œé€€å‡ºï¼ˆæ­£å¸¸æˆ–å¼‚å¸¸ï¼‰è‡ªåŠ¨é‡Šæ”¾é”****&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¾å¼&lt;/strong&gt;ç®¡ç†ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;lock()&lt;/code&gt;å’Œ &lt;code&gt;unlock()&lt;/code&gt;**ï¼Œ&lt;strong&gt;é€šå¸¸å¿…é¡»åœ¨ &lt;code&gt;finally&lt;/code&gt;å—ä¸­é‡Šæ”¾é”ä»¥é¿å…æ­»é”&lt;/strong&gt;**&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¬å¹³æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒ&lt;strong&gt;éå…¬å¹³&lt;/strong&gt;é”****&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;strong&gt;å…¬å¹³é”&lt;/strong&gt;ï¼ˆ&lt;code&gt;new ReentrantLock(true)&lt;/code&gt;ï¼‰å’Œ&lt;strong&gt;éå…¬å¹³é”&lt;/strong&gt;ï¼ˆé»˜è®¤ï¼Œ&lt;code&gt;new ReentrantLock(false)&lt;/code&gt;ï¼‰****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯ä¸­æ–­æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­å“åº”ä¸­æ–­****&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼ˆ&lt;code&gt;lockInterruptibly()&lt;/code&gt;æ–¹æ³•ï¼‰ï¼Œç­‰å¾…é”çš„çº¿ç¨‹å¯å“åº”ä¸­æ–­ï¼Œé¿å…æ— é™ç­‰å¾…****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¶…æ—¶å°è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;å°è¯•è·å–é”æˆ–è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´****&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼ˆ&lt;code&gt;tryLock(long timeout, TimeUnit unit)&lt;/code&gt;ï¼‰ï¼Œå¯è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ­»é”æˆ–é•¿æœŸé˜»å¡****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¡ä»¶å˜é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;Object&lt;/code&gt;çš„ &lt;code&gt;wait()&lt;/code&gt;, &lt;code&gt;notify()&lt;/code&gt;, &lt;code&gt;notifyAll()&lt;/code&gt;å®ç°ï¼Œ&lt;strong&gt;åªæœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—&lt;/strong&gt;ï¼Œå”¤é†’çº¿ç¨‹ä¸ç²¾ç¡®****&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;strong&gt;å¤šä¸ª &lt;code&gt;Condition&lt;/code&gt;&lt;/strong&gt; å¯¹è±¡ï¼ˆ&lt;code&gt;newCondition()&lt;/code&gt;ï¼‰ï¼Œå¯å®ç°&lt;strong&gt;ç²¾ç¡®å”¤é†’&lt;/strong&gt;ï¼ˆå¦‚ç‹¬ç«‹çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ç­‰å¾…é˜Ÿåˆ—ï¼‰****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JVM å±‚é¢é€šè¿‡ &lt;strong&gt;ç›‘è§†å™¨ï¼ˆMonitorï¼‰&lt;/strong&gt; å’Œå¯¹è±¡å¤´ä¸­çš„ &lt;strong&gt;Mark Word&lt;/strong&gt; å®ç°ï¼Œæ”¯æŒ&lt;strong&gt;é”å‡çº§&lt;/strong&gt;ï¼ˆæ— é”-&amp;gt;åå‘é”-&amp;gt;è½»é‡çº§é”-&amp;gt;é‡é‡çº§é”ï¼‰****&lt;/td&gt;
&lt;td&gt;API å±‚é¢é€šè¿‡ &lt;strong&gt;AQS (AbstractQueuedSynchronizer)&lt;/strong&gt; åŠå…¶ &lt;strong&gt;CLHé˜Ÿåˆ—&lt;/strong&gt; å®ç°****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt; (é«˜ç«äº‰)&lt;/td&gt;
&lt;td&gt;æ—©æœŸç‰ˆæœ¬æ€§èƒ½è¾ƒå·®ï¼Œä½†&lt;strong&gt;JDK 6åŠä¹‹å&lt;/strong&gt;ç‰ˆæœ¬ç»è¿‡å¤§é‡ä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰ï¼Œ&lt;strong&gt;æ€§èƒ½ä¸ ReentrantLock æ¥è¿‘*&lt;/strong&gt;***&lt;/td&gt;
&lt;td&gt;åœ¨é«˜ç«äº‰åœºæ™¯ä¸‹ historically è¡¨ç°æ›´å¥½ï¼Œä½†ç°ä»£JDKç‰ˆæœ¬ä¸­ä¼˜åŠ¿å·²ä¸æ˜æ˜¾****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ï¼Œä»£ç ä¾µå…¥æ€§ä½ï¼Œä½¿ç”¨ç®€å•****&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™åŠ é”å’Œé‡Šæ”¾é”çš„ä»£ç ï¼Œä½†çµæ´»æ€§æ›´é«˜****&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä»£ç å†™æ³•å·®å¼‚"&gt;ğŸ–¥ï¸ ä»£ç å†™æ³•å·®å¼‚
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;é”å®šä»£ç å—æ—¶ï¼Œä½ åªéœ€è¦ç”¨ &lt;code&gt;synchronized(object)&lt;/code&gt;æ‹¬èµ·éœ€è¦åŒæ­¥çš„ä»£ç å³å¯ï¼Œé”çš„è·å–å’Œé‡Šæ”¾ç”± JVM è‡ªåŠ¨å®Œæˆï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final Object lock = new Object();
public void myMethod() {
// ... å…¶ä»–ä»£ç 
synchronized(lock) { // è‡ªåŠ¨è·å–é”
// ä¸´ç•ŒåŒºä»£ç 
} // è‡ªåŠ¨é‡Šæ”¾é”
// ... å…¶ä»–ä»£ç 
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;åˆ™éœ€è¦ä½ æ˜¾å¼åœ°åˆ›å»ºé”å¯¹è±¡ï¼Œå¹¶æ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;lock()&lt;/code&gt;å’Œ &lt;code&gt;unlock()&lt;/code&gt;&lt;strong&gt;ï¼Œä¸”é‡Šæ”¾é”çš„æ“ä½œé€šå¸¸å¿…é¡»æ”¾åœ¨ &lt;code&gt;finally&lt;/code&gt;å—ä¸­&lt;/strong&gt;ä»¥ç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ä¹Ÿèƒ½é‡Šæ”¾é”ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final ReentrantLock lock = new ReentrantLock();
public void myMethod() {
// ... å…¶ä»–ä»£ç 
lock.lock(); // æ‰‹åŠ¨è·å–é”
try {
// ä¸´ç•ŒåŒºä»£ç 
} finally {
lock.unlock(); // å¿…é¡»åœ¨finallyä¸­æ‰‹åŠ¨é‡Šæ”¾é”
}
// ... å…¶ä»–ä»£ç 
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-åŠŸèƒ½ç‰¹æ€§å·®å¼‚"&gt;âš™ï¸ åŠŸèƒ½ç‰¹æ€§å·®å¼‚
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;çš„åŠŸèƒ½ç›¸å¯¹åŸºç¡€ï¼Œå®ƒ&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­è¢«ä¸­æ–­ï¼Œä¹Ÿ&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;å°è¯•è·å–é”ï¼ˆæ‹¿ä¸åˆ°å°±ä¸€ç›´ç­‰ï¼‰ï¼Œå®ƒé»˜è®¤ä¸”åªèƒ½æ˜¯&lt;strong&gt;éå…¬å¹³é”&lt;/strong&gt;ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ &lt;code&gt;Object&lt;/code&gt;çš„ &lt;code&gt;wait()&lt;/code&gt;å’Œ &lt;code&gt;notify()&lt;/code&gt;/&lt;code&gt;notifyAll()&lt;/code&gt;æ¥å®ç°çº¿ç¨‹é—´çš„åè°ƒï¼Œä½†æ— æ³•ç²¾ç¡®å”¤é†’ç‰¹å®šç±»å‹çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;åˆ™æä¾›äº†æ›´å¤šé«˜çº§åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ä¸­æ–­çš„é”ç­‰å¾…&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;lockInterruptibly()&lt;/code&gt;æ–¹æ³•è·å–é”ï¼Œåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å¯ä»¥å“åº”å…¶ä»–çº¿ç¨‹çš„ä¸­æ–­è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶å°è¯•è·å–é”&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;tryLock(long timeout, TimeUnit unit)&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ— é™æœŸç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¹³é”é€‰æ‹©&lt;/strong&gt;ï¼šå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­é€‰æ‹©åˆ›å»ºå…¬å¹³é”ï¼ˆå…ˆæ¥å…ˆå¾—ï¼‰æˆ–éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼Œååé‡é€šå¸¸æ›´é«˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä¸ªæ¡ä»¶å˜é‡&lt;/strong&gt;ï¼šå¯ä»¥é€šè¿‡ &lt;code&gt;newCondition()&lt;/code&gt;åˆ›å»ºå¤šä¸ª &lt;code&gt;Condition&lt;/code&gt;å¯¹è±¡ï¼Œç”¨äºæ›´ç²¾ç»†çš„çº¿ç¨‹é—´é€šä¿¡ï¼Œä¾‹å¦‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œå¯ä»¥åˆ†åˆ«ç®¡ç†â€œé˜Ÿåˆ—éç©ºâ€å’Œâ€œé˜Ÿåˆ—æœªæ»¡â€ä¸¤ä¸ªæ¡ä»¶ï¼Œå®ç°ç²¾ç¡®å”¤é†’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€§èƒ½å·®å¼‚"&gt;âš¡ æ€§èƒ½å·®å¼‚
&lt;/h3&gt;&lt;p&gt;åœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ&lt;code&gt;synchronized&lt;/code&gt;æ˜¯é‡é‡çº§é”ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œ&lt;code&gt;ReentrantLock&lt;/code&gt;åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ€§èƒ½è¡¨ç°æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½†åœ¨ JDK 6 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œ&lt;code&gt;synchronized&lt;/code&gt;è¿›è¡Œäº†é‡å¤§ä¼˜åŒ–&lt;/strong&gt;ï¼Œå¦‚å¼•å…¥äº†&lt;strong&gt;åå‘é”&lt;/strong&gt;ã€&lt;strong&gt;è½»é‡çº§é”&lt;/strong&gt;ã€&lt;strong&gt;è‡ªæ—‹é”&lt;/strong&gt;ã€&lt;strong&gt;é”æ¶ˆé™¤&lt;/strong&gt;ã€&lt;strong&gt;é”ç²—åŒ–&lt;/strong&gt;ç­‰æœºåˆ¶ã€‚è¿™äº›ä¼˜åŒ–ä½¿å¾— &lt;code&gt;synchronized&lt;/code&gt;åœ¨ä½è‡³ä¸­ç­‰ç«äº‰ç¨‹åº¦çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½å·²ç»ä¸ &lt;code&gt;ReentrantLock&lt;/code&gt;ç›¸å·®æ— å‡ ï¼Œç”šè‡³æœ‰æ—¶æ›´ä¼˜ã€‚å› æ­¤ï¼Œ&lt;strong&gt;æ€§èƒ½å› ç´ åœ¨ç°ä»£ Java ç‰ˆæœ¬ä¸­å·²ä¸å†æ˜¯é¦–è¦è€ƒè™‘ç‚¹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-åº•å±‚å®ç°"&gt;ğŸ”§ åº•å±‚å®ç°
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;çš„é”æœºåˆ¶æ˜¯ &lt;strong&gt;JVM å±‚é¢&lt;/strong&gt;å®ç°çš„ã€‚æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”ï¼Œå…¶é”çŠ¶æ€è®°å½•åœ¨å¯¹è±¡å¤´çš„ &lt;strong&gt;Mark Word&lt;/strong&gt; ä¸­ã€‚JVM ä¼šæ ¹æ®å®é™…ç«äº‰æƒ…å†µï¼Œè‡ªåŠ¨è¿›è¡Œ&lt;strong&gt;é”å‡çº§&lt;/strong&gt;ï¼ˆä»æ— é” -&amp;gt; åå‘é” -&amp;gt; è½»é‡çº§é” -&amp;gt; é‡é‡çº§é”ï¼‰ï¼Œè¿™ä¸ªä¼˜åŒ–è¿‡ç¨‹å¯¹å¼€å‘è€…å®Œå…¨é€æ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;çš„é”æœºåˆ¶æ˜¯ &lt;strong&gt;API å±‚é¢&lt;/strong&gt;ï¼ˆJava ä»£ç ï¼‰å®ç°çš„ï¼Œå…¶æ ¸å¿ƒæ˜¯ &lt;strong&gt;AQS (AbstractQueuedSynchronizer)&lt;/strong&gt;ã€‚AQS å†…éƒ¨é€šè¿‡ä¸€ä¸ª &lt;strong&gt;volatile çš„ state å˜é‡&lt;/strong&gt;ï¼ˆCASæ“ä½œï¼‰æ¥è¡¨ç¤ºé”çŠ¶æ€ï¼Œå¹¶é€šè¿‡ä¸€ä¸ª &lt;strong&gt;FIFO çš„CLHé˜Ÿåˆ—&lt;/strong&gt;æ¥ç®¡ç†æœªèƒ½ç«‹å³è·å–åˆ°é”çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-1"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;äº†è§£äº†å®ƒä»¬çš„åŒºåˆ«åï¼Œå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘ &lt;code&gt;synchronized&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;ç®€å•çš„åŒæ­¥&lt;/strong&gt;ï¼Œä»£ç &lt;strong&gt;ç®€æ´æ€§å’Œæ˜“ç»´æŠ¤æ€§&lt;/strong&gt;æ˜¯é¦–è¦è€ƒè™‘å› ç´ ã€‚&lt;/li&gt;
&lt;li&gt;é”çš„ç«äº‰ç¨‹åº¦&lt;strong&gt;ä¸æ¿€çƒˆ&lt;/strong&gt;ï¼Œæˆ–è€…ä½ å¸Œæœ›ä¾èµ– JVM çš„è‡ªåŠ¨é”ä¼˜åŒ–æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦ &lt;code&gt;ReentrantLock&lt;/code&gt;æä¾›çš„é‚£äº›&lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼ˆå¦‚å¯ä¸­æ–­ã€è¶…æ—¶ã€å…¬å¹³é”ã€å¤šä¸ªæ¡ä»¶å˜é‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦ &lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼Œå¦‚å¯ä¸­æ–­çš„é”è·å–ã€è¶…æ—¶å°è¯•è·å–é”ã€å…¬å¹³é”ç‰¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;å¤æ‚çš„çº¿ç¨‹é—´åè°ƒ&lt;/strong&gt;ï¼Œä½¿ç”¨&lt;strong&gt;å¤šä¸ªæ¡ä»¶å˜é‡&lt;/strong&gt;ï¼ˆ&lt;code&gt;Condition&lt;/code&gt;ï¼‰å¯ä»¥æ›´æ¸…æ™°ã€é«˜æ•ˆåœ°å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ç»å…¸çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å°½ç®¡ç°ä»£ &lt;code&gt;synchronized&lt;/code&gt;æ€§èƒ½å¾ˆå¥½ï¼Œä½†åœ¨æŸäº›&lt;strong&gt;æé«˜ç«äº‰&lt;/strong&gt;çš„ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œç»“åˆ &lt;code&gt;tryLock()&lt;/code&gt;å¯èƒ½ä»æœ‰ä¼˜åŠ¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸€å¥è¯æ€»ç»“ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨æ›´ç®€æ´å®‰å…¨çš„ &lt;code&gt;synchronized&lt;/code&gt;ï¼›åªæœ‰å½“ç¡®å®éœ€è¦ &lt;code&gt;ReentrantLock&lt;/code&gt;æä¾›çš„é‚£äº›é«˜çº§ç‰¹æ€§æ—¶ï¼Œæ‰é€‰æ‹©å®ƒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;h2 id="synchronized-åµŒå¥—"&gt;synchronized åµŒå¥—
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—çš„&lt;strong&gt;åµŒå¥—ä½¿ç”¨éœ€è¦éå¸¸è°¨æ…&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å¯¼è‡´æ­»é”ã€‚è™½ç„¶æŠ€æœ¯ä¸Šå¯ä»¥å®ç°ï¼Œä½†é€šå¸¸æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†åµŒå¥—ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;çš„æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹é¢&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å…³é”®æé†’&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯åµŒå¥—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ä¸€ä¸ª&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨ï¼Œè°ƒç”¨å¦ä¸€ä¸ª&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•ï¼Œæˆ–å°è¯•è·å–å¦ä¸€ä¸ªå¯¹è±¡çš„é”ã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯é‡å…¥æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Java çš„ &lt;code&gt;synchronized&lt;/code&gt;é”æ˜¯å¯é‡å…¥çš„&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€&lt;strong&gt;åŒä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;å¯ä»¥å¤šæ¬¡è·å–&lt;strong&gt;åŒä¸€ä¸ªé”&lt;/strong&gt;è€Œä¸ä¼šé˜»å¡è‡ªå·±ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯åµŒå¥—èƒ½è¿›è¡Œçš„åŸºç¡€ï¼Œé¿å…äº†çº¿ç¨‹è‡ªå·±å¡æ­»è‡ªå·±çš„æƒ…å†µã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ­»é”é£é™©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜åº¦é£é™©&lt;/strong&gt;ã€‚å½“åµŒå¥—æ¶‰åŠ&lt;strong&gt;å¤šä¸ªé”&lt;/strong&gt;ï¼ˆä¸åŒå¯¹è±¡æˆ–ç±»é”ï¼‰ï¼Œå¹¶ä¸”&lt;strong&gt;å¤šä¸ªçº¿ç¨‹ä»¥ä¸åŒçš„é¡ºåºè¯·æ±‚è¿™äº›é”&lt;/strong&gt;æ—¶ï¼Œææ˜“å‘ç”Ÿæ­»é”ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯åµŒå¥—æœ€å¤§çš„é—®é¢˜ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œç›¸å…³çº¿ç¨‹ä¼šæ— é™ç­‰å¾…ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿‡åº¦çš„åŒæ­¥ï¼Œå°¤å…¶æ˜¯åµŒå¥—å’Œç²—ç²’åº¦çš„é”ï¼Œä¼š&lt;strong&gt;æ˜¾è‘—é™ä½ç¨‹åºå¹¶å‘æ€§èƒ½&lt;/strong&gt;ï¼Œå¢åŠ çº¿ç¨‹é˜»å¡æ—¶é—´ã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨&lt;strong&gt;ç»†ç²’åº¦é”&lt;/strong&gt;ã€&lt;strong&gt;å¹¶å‘å·¥å…·ç±»&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;ReentrantLock&lt;/code&gt;åŠå…¶ &lt;code&gt;tryLock&lt;/code&gt;æ–¹æ³•ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;æ—¨åœ¨å‡å°‘é”çš„æŒæœ‰æ—¶é—´ã€é™ä½æ­»é”æ¦‚ç‡æˆ–æä¾›æ›´çµæ´»çš„é”æœºåˆ¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è°¨æ…åµŒå¥—çš„åŸå› "&gt;âš ï¸ è°¨æ…åµŒå¥—çš„åŸå› 
&lt;/h3&gt;&lt;p&gt;åµŒå¥—ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;æœ€ä¸»è¦çš„é£é™©æ˜¯&lt;strong&gt;æ­»é”ï¼ˆDeadlockï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ­»é”é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼šå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶æŒæœ‰å¤šä¸ªé”ï¼Œä½†&lt;strong&gt;è·å–è¿™äº›é”çš„é¡ºåºä¸ä¸€è‡´&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;çº¿ç¨‹1ï¼šå…ˆè·å–äº†é”Aï¼Œç„¶åå°è¯•è·å–é”Bã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çº¿ç¨‹2ï¼šå…ˆè·å–äº†é”Bï¼Œç„¶åå°è¯•è·å–é”Aã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œçº¿ç¨‹1æŒæœ‰Aç­‰å¾…Bï¼Œçº¿ç¨‹2æŒæœ‰Bç­‰å¾…Aï¼Œä¸¤è€…éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå½¢æˆæ­»é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;ç‰¹æ€§å†³å®šäº†çº¿ç¨‹åœ¨å°è¯•è·å–ä¸€ä¸ªå·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨çš„é”æ—¶ï¼Œä¼š&lt;strong&gt;ä¸€ç›´é˜»å¡ç­‰å¾…&lt;/strong&gt;ï¼Œè‡ªèº«æ— æ³•ä¸­æ–­æˆ–è¶…æ—¶ã€‚è¿™ä½¿å¾—ä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå¾€å¾€éœ€è¦å¤–éƒ¨å¹²é¢„ã€‚&lt;/p&gt;
&lt;h3 id="-å¯é‡å…¥æ€§åµŒå¥—çš„åŸºç¡€"&gt;ğŸ”„ å¯é‡å…¥æ€§ï¼šåµŒå¥—çš„åŸºç¡€
&lt;/h3&gt;&lt;p&gt;Java ä¸­çš„ &lt;code&gt;synchronized&lt;/code&gt;é”æ˜¯&lt;strong&gt;å¯é‡å…¥çš„ï¼ˆReentrantï¼‰&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€&lt;strong&gt;åŒä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;å¯ä»¥å¤šæ¬¡è¿›å…¥ç”±&lt;strong&gt;åŒä¸€ä¸ªé”&lt;/strong&gt;ä¿æŠ¤çš„åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class ReentrantExample {
public synchronized void methodA() {
System.out.println(&amp;#34;Method A&amp;#34;);
methodB(); // åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å†æ¬¡è·å–å½“å‰å¯¹è±¡(this)çš„é”ï¼Œè¿›å…¥methodB
}
public synchronized void methodB() {
System.out.println(&amp;#34;Method B&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;methodA&lt;/code&gt;å’Œ &lt;code&gt;methodB&lt;/code&gt;éƒ½ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;ä¿®é¥°ï¼ˆé”å¯¹è±¡éƒ½æ˜¯ &lt;code&gt;this&lt;/code&gt;ï¼‰ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ &lt;code&gt;methodA&lt;/code&gt;æ—¶ï¼Œå®ƒè·å¾—äº†å½“å‰å¯¹è±¡çš„é”ã€‚åœ¨ &lt;code&gt;methodA&lt;/code&gt;å†…éƒ¨è°ƒç”¨ &lt;code&gt;methodB&lt;/code&gt;ï¼ˆä¹Ÿéœ€è¦è·å–åŒä¸€ä¸ªé”ï¼‰æ—¶ï¼Œç”±äºæ˜¯å¯é‡å…¥é”ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥è¿›å…¥ &lt;code&gt;methodB&lt;/code&gt;ã€‚å¦‚æœæ²¡æœ‰å¯é‡å…¥æ€§ï¼Œè¿™é‡Œå°±ä¼šå‘ç”Ÿæ­»é”ã€‚&lt;/p&gt;
&lt;h3 id="-æ›¿ä»£æ–¹æ¡ˆä¸æœ€ä½³å®è·µ"&gt;ğŸ› ï¸ æ›¿ä»£æ–¹æ¡ˆä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;p&gt;é‰´äºåµŒå¥— &lt;code&gt;synchronized&lt;/code&gt;çš„é£é™©ï¼Œåº”è€ƒè™‘ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆå’Œæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ç»†ç²’åº¦é”ï¼ˆFine-grained Lockingï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€è·¯&lt;/strong&gt;ï¼šä¸è¦ç”¨ä¸€ä¸ªç²—ç²’åº¦çš„é”ï¼ˆå¦‚ç›´æ¥é”æ•´ä¸ªå¯¹è±¡ &lt;code&gt;synchronized(this)&lt;/code&gt;æˆ–ä¸€ä¸ªå¤§çš„åŒæ­¥æ–¹æ³•ï¼‰ä¿æŠ¤æ‰€æœ‰å…±äº«èµ„æºï¼Œè€Œæ˜¯&lt;strong&gt;ä¸ºä¸åŒçš„å…±äº«èµ„æºä½¿ç”¨ä¸åŒçš„ä¸“ç”¨é”å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åšæ³•&lt;/strong&gt;ï¼šåˆ›å»ºå¤šä¸ªä¸“é—¨çš„ final é”å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class FineGrainedExample {
private final Object lockA = new Object();
private final Object lockB = new Object();
private int resourceA;
private int resourceB;
public void updateA() {
synchronized(lockA) { // åªé”ä¸resourceAç›¸å…³çš„æ“ä½œ
// ä¿®æ”¹ resourceA
}
}
public void updateB() {
synchronized(lockB) { // åªé”ä¸resourceBç›¸å…³çš„æ“ä½œ
// ä¿®æ”¹ resourceB
}
}
public void updateBoth() {
synchronized(lockA) { // å…ˆè·å–é”A
synchronized(lockB) { // å†è·å–é”B
// æ“ä½œ resourceA å’Œ resourceB
}
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¥½å¤„&lt;/strong&gt;ï¼š&lt;code&gt;updateA&lt;/code&gt;å’Œ &lt;code&gt;updateB&lt;/code&gt;å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œäº’ä¸é˜»å¡ï¼Œæé«˜äº†å¹¶å‘æ€§ã€‚åœ¨éœ€è¦è·å–å¤šä¸ªé”çš„æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;updateBoth&lt;/code&gt;ï¼‰ä¸­ï¼ŒåŠ¡å¿…&lt;strong&gt;å›ºå®šé”çš„è·å–é¡ºåº&lt;/strong&gt;ï¼ˆä¾‹å¦‚æ€»æ˜¯å…ˆ lockA å lockBï¼‰ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä¸¥æ ¼éµå®ˆæ­¤é¡ºåºï¼Œè¿™æ˜¯é¿å…æ­»é”çš„å…³é”®æŠ€å·§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼©å°åŒæ­¥èŒƒå›´&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°½é‡åªå¯¹&lt;strong&gt;çœŸæ­£éœ€è¦åŒæ­¥çš„ä»£ç å—&lt;/strong&gt;ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–¹æ³•ã€‚è¿™å‡å°‘äº†é”æŒæœ‰çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ Java å¹¶å‘å·¥å…·åŒ…ï¼ˆjava.util.concurrentï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºå¤æ‚çš„å¹¶å‘åœºæ™¯ï¼Œè€ƒè™‘ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;ã€‚å®ƒæä¾›äº† &lt;code&gt;tryLock()&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥å°è¯•è·å–é”ï¼Œå¦‚æœå¤±è´¥ä¸ä¼šæ— é™é˜»å¡ï¼Œå…è®¸çº¿ç¨‹å›é€€æˆ–é‡è¯•ï¼Œä»è€Œæœ‰æ•ˆé¿å…æ­»é”ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ›´é«˜çº§çš„å¹¶å‘å®¹å™¨ï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼‰å’ŒåŒæ­¥å·¥å…·ï¼ˆå¦‚ &lt;code&gt;CountDownLatch&lt;/code&gt;, &lt;code&gt;CyclicBarrier&lt;/code&gt;, &lt;code&gt;Semaphore&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—å¯ä»¥åµŒå¥—ï¼Œä¸»è¦å¾—ç›Šäºé”çš„&lt;strong&gt;å¯é‡å…¥æ€§&lt;/strong&gt;ã€‚ä½†åµŒå¥—ï¼Œå°¤å…¶æ˜¯æ¶‰åŠ&lt;strong&gt;å¤šä¸ªä¸åŒé”&lt;/strong&gt;çš„åµŒå¥—ï¼Œ&lt;strong&gt;ææ˜“å¯¼è‡´æ­»é”&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°½é‡é¿å…ä¸å¿…è¦çš„åµŒå¥—&lt;/strong&gt;ï¼Œç‰¹åˆ«æ˜¯é”é¡ºåºå¯èƒ½ä¸å›ºå®šçš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆè€ƒè™‘&lt;strong&gt;ç»†ç²’åº¦é”&lt;/strong&gt;å’Œ&lt;strong&gt;å›ºå®šé”è·å–é¡ºåº&lt;/strong&gt;æ¥ç®¡ç†å¯¹å¤šä¸ªèµ„æºçš„è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å¤æ‚åœºæ™¯ä¸‹ï¼Œè¯„ä¼°ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;ç­‰æ›´çµæ´»ã€åŠŸèƒ½æ›´ä¸°å¯Œçš„å¹¶å‘å·¥å…·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°å†³ç­–ã€‚&lt;/p&gt;
&lt;h2 id="value--constants"&gt;@Value &amp;amp; Constants
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring åº”ç”¨ä¸­å®šä¹‰é…ç½®å€¼æ—¶ï¼Œä½¿ç”¨ &lt;code&gt;static final&lt;/code&gt;å¸¸é‡å’Œé€šè¿‡ &lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥æ˜¯ä¸¤ç§å¸¸è§æ–¹å¼ï¼Œå®ƒä»¬å„æœ‰ç‰¹ç‚¹ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ã€‚ä¸‹é¢æˆ‘æ¥ä¸ºä½ è§£é‡Šå®ƒä»¬çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;Static Final å¸¸é‡&lt;/th&gt;
&lt;th&gt;@Value æ³¨å…¥é…ç½®&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸºæœ¬å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«çš„å¸¸é‡ï¼Œä½¿ç”¨ &lt;code&gt;static final&lt;/code&gt;å…³é”®å­—å£°æ˜&lt;/td&gt;
&lt;td&gt;Spring çš„æ³¨è§£ï¼Œç”¨äºå°†å¤–éƒ¨é…ç½®å€¼æ³¨å…¥åˆ° Bean çš„å®ä¾‹å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰&lt;strong&gt;çœŸæ­£æ’å®š&lt;/strong&gt;ã€ä¸è¿è¡Œç¯å¢ƒæ— å…³çš„å€¼ï¼ˆå¦‚æ•°å­¦å¸¸æ•°ã€æšä¸¾é”®ï¼‰&lt;/td&gt;
&lt;td&gt;æ³¨å…¥&lt;strong&gt;éšç¯å¢ƒå˜åŒ–&lt;/strong&gt;çš„é…ç½®å€¼ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç¬¬ä¸‰æ–¹ API å¯†é’¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å€¼çš„æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œæˆ–é€šè¿‡ç®€å•è®¡ç®—å¾—åˆ°&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.properties&lt;/code&gt;ï¼‰ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸåˆå§‹åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç±»åŠ è½½æ—¶&lt;/strong&gt;åˆå§‹åŒ–ï¼Œæ—©äº Spring å®¹å™¨å¯åŠ¨&lt;/td&gt;
&lt;td&gt;Spring &lt;strong&gt;åˆ›å»º Bean å®ä¾‹æ—¶&lt;/strong&gt;è¿›è¡Œå±æ€§å¡«å……&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®Œå…¨ç”± JVM ç®¡ç†ï¼ŒSpring æ— æ³•å¹²é¢„&lt;/td&gt;
&lt;td&gt;å®Œå…¨ç”± Spring å®¹å™¨ç®¡ç†ï¼Œæ˜¯ Spring IOC çš„ä¸€éƒ¨åˆ†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ï¼Œä¿®æ”¹å€¼éœ€é‡æ–°ç¼–è¯‘ä»£ç &lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ç”Ÿæ•ˆï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°ï¼ˆå¦‚ç»“åˆ &lt;code&gt;@RefreshScope&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸å¯å˜ï¼Œ&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‹¥ Bean æ˜¯å•ä¾‹ä¸”å­—æ®µå¯å˜ï¼Œéœ€æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æµ‹è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®€å•ç›´æ¥&lt;/td&gt;
&lt;td&gt;æ›´æ˜“äºæ¨¡æ‹Ÿå’Œæ›¿æ¢ä¸åŒé…ç½®è¿›è¡Œæµ‹è¯•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä½¿ç”¨-static-final-å¸¸é‡"&gt;ğŸ”§ ä½¿ç”¨ Static Final å¸¸é‡
&lt;/h3&gt;&lt;p&gt;Static Final å¸¸é‡åœ¨&lt;strong&gt;ç±»åŠ è½½æ—¶&lt;/strong&gt;ï¼ˆJVM åŠ è½½è¯¥ç±»æ—¶ï¼‰å°±å¿…é¡»è¢«åˆå§‹åŒ–ï¼Œä¸”ä¸€æ—¦èµ‹å€¼ä¾¿æ— æ³•æ›´æ”¹ã€‚å®ƒå®Œå…¨ç”± JVM ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰çœŸæ­£ä¸å˜çš„å€¼&lt;/strong&gt;ï¼šå¦‚æ•°å­¦å¸¸æ•° Ï€ã€eï¼Œæˆ–è€…é¡¹ç›®ä¸­ä¸€äº›å›ºå®šçš„æšä¸¾é”®ã€çŠ¶æ€ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¿è¡Œç¯å¢ƒæ— å…³çš„å›ºå®šå€¼&lt;/strong&gt;ï¼šè¿™äº›å€¼åœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½ç›¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class Constants {
// ç¼–è¯‘æ—¶å¸¸é‡ï¼Œé€šå¸¸ç›´æ¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
public static final double PI = 3.1415926535;
public static final String APP_NAME = &amp;#34;MY_SPRING_APP&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä½¿ç”¨-value-æ³¨å…¥é…ç½®"&gt;ğŸ”§ ä½¿ç”¨ @Value æ³¨å…¥é…ç½®
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Value&lt;/code&gt;æ˜¯ Spring æä¾›çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œå®ƒåœ¨ Spring &lt;strong&gt;åˆ›å»º Bean å®ä¾‹ã€è¿›è¡Œå±æ€§å¡«å……æ—¶&lt;/strong&gt;æ‰ä¼šå‘ç”Ÿã€‚å…¶å€¼æ¥æºäºå¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;ï¼‰ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦å¤–éƒ¨åŒ–é…ç½®çš„å€¼&lt;/strong&gt;ï¼šå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€ç¬¬ä¸‰æ–¹æœåŠ¡çš„ API å¯†é’¥ã€æœåŠ¡å™¨ç«¯å£å·ç­‰ã€‚è¿™äº›å€¼é€šå¸¸å› ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰è€Œå¼‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯èƒ½éœ€è¦åŠ¨æ€åˆ·æ–°çš„é…ç½®&lt;/strong&gt;ï¼ˆç»“åˆ &lt;code&gt;@RefreshScope&lt;/code&gt;ç­‰æœºåˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ &lt;code&gt;application.properties&lt;/code&gt;ä¸­å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;app.api.url=https://api.example.com
app.thread.pool.size=10
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Bean ä¸­æ³¨å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ApiService {
// æ³¨å…¥é…ç½®å€¼
@Value(&amp;#34;${app.api.url}&amp;#34;)
private String apiUrl;
@Value(&amp;#34;${app.thread.pool.size:5}&amp;#34;) // å†’å·åæŒ‡å®šé»˜è®¤å€¼
private int threadPoolSize;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-é‡è¦çš„æ³¨æ„äº‹é¡¹"&gt;âš ï¸ é‡è¦çš„æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸è¦å°è¯•ç”¨ @Value ç›´æ¥æ³¨å…¥ static å­—æ®µ&lt;/strong&gt;ï¼šSpring çš„ä¾èµ–æ³¨å…¥åŸºäº Bean å®ä¾‹æ“ä½œï¼Œè€Œ &lt;code&gt;static&lt;/code&gt;å­—æ®µå±äºç±»çº§åˆ«ï¼ŒSpring æ— æ³•é€šè¿‡å®ä¾‹ç›´æ¥ä¸ºå…¶æ³¨å…¥å€¼ã€‚ç›´æ¥è¿™æ ·åšä¼šå¯¼è‡´æ³¨å…¥å¤±è´¥ï¼Œå­—æ®µå€¼ä¸º &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Static Final ç»„åˆå­—æ®µæ— æ³•é€šè¿‡ @Value æ³¨å…¥&lt;/strong&gt;ï¼š&lt;code&gt;static final&lt;/code&gt;ç»„åˆå­—æ®µæ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œå¿…é¡»åœ¨ç±»åŠ è½½æ—¶ç¡®å®šå…¶å€¼ï¼Œå› æ­¤æ— æ³•åœ¨è¿è¡Œæ—¶é€šè¿‡ Spring æ³¨å…¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é—´æ¥æ³¨å…¥ Static å˜é‡çš„æ–¹æ³•&lt;/strong&gt;ï¼šå¦‚æœç¡®å®éœ€è¦è®©ä¸€ä¸ªé™æ€å˜é‡æŒæœ‰ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–çš„å€¼ï¼Œå¯ä»¥é€šè¿‡éé™æ€ setter æ–¹æ³•é—´æ¥å®ç°ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ConfigHolder {
private static String staticConfigValue;
@Value(&amp;#34;${some.config}&amp;#34;)
public void setStaticConfigValue(String value) {
ConfigHolder.staticConfigValue = value; // åœ¨setterä¸­ä¸ºé™æ€å˜é‡èµ‹å€¼
}
public static String getStaticConfigValue() {
return staticConfigValue;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@PostConstruct&lt;/code&gt;è¿›è¡Œåˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ConfigHolder {
private static String staticConfigValue;
@Value(&amp;#34;${some.config}&amp;#34;)
private String injectedValue;
@PostConstruct
public void init() {
staticConfigValue = injectedValue; // åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ä¸ºé™æ€å˜é‡èµ‹å€¼
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-2"&gt;ğŸ’ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é€‰æ‹© &lt;strong&gt;&lt;code&gt;static final&lt;/code&gt;å¸¸é‡&lt;/strong&gt;ï¼šç”¨äºå­˜å‚¨é‚£äº›&lt;strong&gt;çœŸæ­£ä¸å˜&lt;/strong&gt;ã€&lt;strong&gt;ä¸è¿è¡Œç¯å¢ƒæ— å…³&lt;/strong&gt;çš„å›ºå®šå€¼ï¼Œä¾‹å¦‚æ•°å­¦å¸¸æ•°ã€å›ºå®šçš„æšä¸¾é”®ã€çŠ¶æ€ç ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹© &lt;strong&gt;&lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥&lt;/strong&gt;ï¼šç”¨äºé‚£äº›&lt;strong&gt;éœ€è¦å¤–éƒ¨åŒ–&lt;/strong&gt;ã€&lt;strong&gt;å¯èƒ½éšç¯å¢ƒå˜åŒ–&lt;/strong&gt;ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰çš„é…ç½®å€¼ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ã€ç¬¬ä¸‰æ–¹ API å¯†é’¥ã€åŠŸèƒ½å¼€å…³ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚è¿™æ˜¯ Spring Boot å¤–éƒ¨åŒ–é…ç½®å’Œæ¾è€¦åˆç†å¿µçš„ä½“ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;strong&gt;&lt;code&gt;static final&lt;/code&gt;å…³ä¹ä»£ç å†…çš„å›ºå®šä¸å˜ï¼Œ&lt;code&gt;@Value&lt;/code&gt;å…³ä¹è¿è¡Œæ—¶çš„çµæ´»é…ç½®&lt;/strong&gt;ã€‚æ­£ç¡®åŒºåˆ†å’Œä½¿ç”¨å®ƒä»¬ï¼Œèƒ½è®©ä½ çš„åº”ç”¨æ›´å¥å£®ã€æ›´æ˜“ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼ã€‚å¦‚æœä½ æœ‰æ›´å¤šå…³äº Spring é…ç½®ç®¡ç†çš„é—®é¢˜ï¼Œæˆ‘å¾ˆä¹æ„ç»§ç»­ä¸ä½ è®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id="configurationproperties"&gt;@ConfigurationProperties
&lt;/h2&gt;&lt;p&gt;é™¤äº† &lt;code&gt;@Value&lt;/code&gt;ï¼ŒSpring Bootï¼ˆç‰¹åˆ«æ˜¯ 3.3 åŠä»¥åç‰ˆæœ¬ï¼‰æ¨èä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ³¨è§£è¿›è¡Œæ›´&lt;strong&gt;ä¼˜é›…&lt;/strong&gt;ã€&lt;strong&gt;ç±»å‹å®‰å…¨&lt;/strong&gt;ä¸”&lt;strong&gt;é›†ä¸­&lt;/strong&gt;çš„é…ç½®æ³¨å…¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œå¸®ä½ å¿«é€Ÿäº†è§£å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Value&lt;/code&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ³¨è§£&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€ä¸ªæ³¨å…¥å•ä¸ªé…ç½®å€¼&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‰¹é‡ç»‘å®š&lt;/strong&gt;ä¸€ç»„å…·æœ‰ç›¸åŒå‰ç¼€çš„é…ç½®åˆ° Java Bean ä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å‹æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦æ”¯æŒåŸºæœ¬ç±»å‹å’Œç®€å•ç±»å‹è½¬æ¢&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;strong&gt;å¤æ‚ç±»å‹&lt;/strong&gt;ï¼ˆå¦‚å¯¹è±¡ã€åˆ—è¡¨ Listã€Mapï¼‰ã€åµŒå¥—ç»“æ„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç é£æ ¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®åˆ†æ•£åœ¨å„å¤„ï¼Œè¾ƒå¤šæ³¨è§£æ—¶ä»£ç æ˜¾å†—ä½™&lt;/td&gt;
&lt;td&gt;é…ç½®&lt;strong&gt;é›†ä¸­ç®¡ç†&lt;/strong&gt;ï¼Œä»£ç æ›´ç®€æ´ã€å†…èš&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¾æ•£ç»‘å®š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒã€‚å±æ€§åå¿…é¡»ä¸¥æ ¼åŒ¹é…&lt;/td&gt;
&lt;td&gt;æ”¯æŒã€‚ä¾‹å¦‚é…ç½® &lt;code&gt;my-config.item-name&lt;/code&gt;å¯æ˜ å°„åˆ° &lt;code&gt;myConfig.itemName&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ ¡éªŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;strong&gt;JSR-303&lt;/strong&gt; æ ¡éªŒï¼ˆå¦‚ &lt;code&gt;@NotNull&lt;/code&gt;, &lt;code&gt;@Email&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¡é‡å•ä½æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒè‡ªåŠ¨å•ä½è½¬æ¢&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;strong&gt;Duration&lt;/strong&gt; (å¦‚ &lt;code&gt;10s&lt;/code&gt;, &lt;code&gt;30m&lt;/code&gt;) å’Œ &lt;strong&gt;DataSize&lt;/strong&gt; (å¦‚ &lt;code&gt;10MB&lt;/code&gt;, &lt;code&gt;1GB&lt;/code&gt;) ç­‰å•ä½çš„è‡ªåŠ¨è½¬æ¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨å…¥å°‘é‡ã€ç®€å•ã€ç‹¬ç«‹çš„é…ç½®é¡¹&lt;/td&gt;
&lt;td&gt;æ³¨å…¥ä¸€ç»„&lt;strong&gt;ç›¸å…³çš„&lt;/strong&gt;ã€&lt;strong&gt;ç»“æ„åŒ–&lt;/strong&gt;çš„é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¦‚ä½•é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/strong&gt;ï¼šå½“éœ€è¦æ³¨å…¥ä¸€ç»„&lt;strong&gt;ç›¸å…³çš„é…ç½®&lt;/strong&gt;ï¼ˆä¾‹å¦‚æ•°æ®åº“è¿æ¥å‚æ•°ã€ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®ã€åº”ç”¨ç‰¹æ€§å¼€å…³ç­‰ï¼‰æ—¶ï¼Œè¿™æ˜¯é¦–é€‰æ–¹æ¡ˆï¼Œèƒ½å¸¦æ¥æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Value&lt;/code&gt;ä½œä¸ºè¡¥å……&lt;/strong&gt;ï¼šå½“ä½ åªéœ€è¦æ³¨å…¥&lt;strong&gt;ä¸€ä¸¤ä¸ªç®€å•ä¸”ç‹¬ç«‹&lt;/strong&gt;çš„é…ç½®å€¼æ—¶ï¼Œä½¿ç”¨ &lt;code&gt;@Value&lt;/code&gt;æ›´åŠ ç›´æ¥å’Œæ–¹ä¾¿ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä½¿ç”¨-configurationproperties"&gt;ğŸ› ï¸ ä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;
&lt;/h3&gt;&lt;h4 id="1-åˆ›å»ºé…ç½®ç±»"&gt;1. åˆ›å»ºé…ç½®ç±»
&lt;/h4&gt;&lt;p&gt;å®šä¹‰ä¸€ä¸ª Java ç±»ï¼Œä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ³¨è§£å¹¶æŒ‡å®šé…ç½®å‰ç¼€ï¼ˆ&lt;code&gt;prefix&lt;/code&gt;ï¼‰ã€‚ç±»çš„å­—æ®µååº”ä¸é…ç½®é¡¹å»æ‰å‰ç¼€åçš„åç§°åŒ¹é…ï¼ˆæ”¯æŒæ¾æ•£ç»‘å®šï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;
import jakarta.validation.constraints.NotEmpty;
import jakarta.validation.constraints.NotNull;
import java.time.Duration;
import java.util.List;
@Component
@ConfigurationProperties(prefix = &amp;#34;app&amp;#34;) // æŒ‡å®šé…ç½®å‰ç¼€
public class AppConfig {
@NotNull // æ•°æ®æ ¡éªŒ
private String name;
private String version;
private Duration timeout; // æ”¯æŒæ—¶é—´å•ä½ï¼Œå¦‚ 30s, 5m
private DataSize maxFileSize; // æ”¯æŒæ•°æ®å¤§å°å•ä½ï¼Œå¦‚ 10MB, 1GB
@NotEmpty
private List&amp;lt;String&amp;gt; servers; // æ”¯æŒé›†åˆç±»å‹
// å¿…é¡»æä¾› getter å’Œ setter æ–¹æ³•
public String getName() { return name; }
public void setName(String name) { this.name = name; }
public String getVersion() { return version; }
public void setVersion(String version) { this.version = version; }
public Duration getTimeout() { return timeout; }
public void setTimeout(Duration timeout) { this.timeout = timeout; }
public DataSize getMaxFileSize() { return maxFileSize; }
public void setMaxFileSize(DataSize maxFileSize) { this.maxFileSize = maxFileSize; }
public List&amp;lt;String&amp;gt; getServers() { return servers; }
public void setServers(List&amp;lt;String&amp;gt; servers) { this.servers = servers; }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®-å¦‚-applicationyml"&gt;2. åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½® (å¦‚ &lt;code&gt;application.yml&lt;/code&gt;)
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;app:
name: my-application
version: &amp;#34;1.0.0&amp;#34;
timeout: 30s # æ—¶é—´å•ä½
max-file-size: 10MB # æ•°æ®å¤§å°å•ä½
servers:
- &amp;#34;server1.example.com&amp;#34;
- &amp;#34;server2.example.com&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­æ³¨å…¥å¹¶ä½¿ç”¨"&gt;3. åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­æ³¨å…¥å¹¶ä½¿ç”¨
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
@Service
public class MyService {
private final AppConfig appConfig;
@Autowired // é€šè¿‡æ„é€ å™¨æ³¨å…¥
public MyService(AppConfig appConfig) {
this.appConfig = appConfig;
}
public void doSomething() {
System.out.println(&amp;#34;App Name: &amp;#34; + appConfig.getName());
System.out.println(&amp;#34;Timeout: &amp;#34; + appConfig.getTimeout());
// ä½¿ç”¨å…¶ä»–é…ç½®...
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¿€æ´»é…ç½®ç»‘å®š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šå¸¸ï¼Œç»™é…ç½®ç±»æ·»åŠ  &lt;code&gt;@Component&lt;/code&gt;æ³¨è§£å³å¯å°†å…¶çº³å…¥ Spring å®¹å™¨ç®¡ç† ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº&lt;strong&gt;æ— æ³•ç›´æ¥æ·»åŠ æ³¨è§£çš„ç¬¬ä¸‰æ–¹ç±»&lt;/strong&gt;ï¼Œæˆ–å¸Œæœ›æ›´æ˜¾å¼åœ°ç®¡ç†æ—¶ï¼Œå¯åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@EnableConfigurationProperties(YourConfigClass.class)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¾æ•£ç»‘å®š (Relaxed Binding)&lt;/strong&gt;ï¼š&lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ”¯æŒå¤šç§å±æ€§åæ ¼å¼ï¼ˆå¦‚é©¼å³°ã€ä¸­åˆ’çº¿ã€ä¸‹åˆ’çº¿ï¼‰çš„è‡ªåŠ¨åŒ¹é…ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ä¸­ &lt;code&gt;max-file-size&lt;/code&gt;å¯è‡ªåŠ¨ç»‘å®šåˆ° Java ç±»ä¸­çš„ &lt;code&gt;maxFileSize&lt;/code&gt;å­—æ®µ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æ ¡éªŒ&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»ä¸Šæ·»åŠ  &lt;code&gt;@Validated&lt;/code&gt;æ³¨è§£ï¼Œå¹¶åœ¨å­—æ®µä¸Šä½¿ç”¨æ ¡éªŒæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@NotNull&lt;/code&gt;, &lt;code&gt;@Email&lt;/code&gt;, &lt;code&gt;@Size&lt;/code&gt;ç­‰ï¼‰ï¼Œå¯åœ¨åº”ç”¨å¯åŠ¨æ—¶å¯¹é…ç½®å€¼è¿›è¡Œæ ¡éªŒï¼Œæ— æ•ˆé…ç½®ä¼šé˜»æ­¢åº”ç”¨å¯åŠ¨ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚ç±»å‹ä¸åµŒå¥—é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;@ConfigurationProperties&lt;/code&gt;å¯ä»¥è½»æ¾å¤„ç†åµŒå¥—å¯¹è±¡ã€åˆ—è¡¨ã€Map ç­‰å¤æ‚æ•°æ®ç»“æ„ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å… YAML é…ç½®ä¸­çš„å…«è¿›åˆ¶é™·é˜±&lt;/strong&gt;ï¼šåœ¨ YAML é…ç½®ä¸­ï¼Œä»¥ &lt;code&gt;0&lt;/code&gt;å¼€å¤´çš„æ•°å­—ï¼ˆå¦‚ &lt;code&gt;0127&lt;/code&gt;ï¼‰ä¼šè¢«è§£æä¸ºå…«è¿›åˆ¶æ•°ã€‚ä¸ºé¿å…æ„å¤–ï¼Œå»ºè®®å¯¹æ•°å­—ç‰¹åˆ«æ˜¯ä»¥ &lt;code&gt;0&lt;/code&gt;å¼€å¤´çš„æ•°å­—ä½¿ç”¨å¼•å·ï¼ˆå¦‚ &lt;code&gt;port: &amp;quot;0127&amp;quot;&lt;/code&gt;ï¼‰å°†å…¶æ˜ç¡®è¡¨ç¤ºä¸ºå­—ç¬¦ä¸² ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ“š æ€»ç»“
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;@Value&lt;/code&gt;åœ¨æ³¨å…¥å°‘é‡ç®€å•é…ç½®æ—¶ä¾ç„¶æ–¹ä¾¿ï¼Œä½† &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æä¾›äº†ä¸€ç§æ›´&lt;strong&gt;ç°ä»£ã€å¥å£®ã€å¯ç»´æŠ¤&lt;/strong&gt;çš„é…ç½®ç®¡ç†æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆäºç®¡ç†å¤§é‡æˆ–ç»“æ„åŒ–çš„é…ç½®ã€‚&lt;strong&gt;å»ºè®®ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ¥ç»„ç»‡ä½ çš„é…ç½®&lt;/strong&gt;ï¼Œè®©ä»£ç æ›´æ¸…æ™°ã€æ›´å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´ä¼˜é›…åœ°ç®¡ç† Spring Boot åº”ç”¨çš„é…ç½®ï¼&lt;/p&gt;
&lt;h2 id="å­è¿›ç¨‹--çº¿ç¨‹"&gt;å­è¿›ç¨‹ &amp;amp; çº¿ç¨‹
&lt;/h2&gt;&lt;p&gt;ç†è§£å­è¿›ç¨‹å’Œçº¿ç¨‹åœ¨å†…å­˜è®¿é—®å’Œèµ„æºç®¡ç†ä¸Šçš„åŒºåˆ«ï¼Œå¯¹è®¾è®¡å¹¶å‘ç¨‹åºå¾ˆé‡è¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œå¸®ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒå·®å¼‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;å­è¿›ç¨‹ (Subprocess)&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ (Thread)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç‹¬ç«‹&lt;/strong&gt;çš„åœ°å€ç©ºé—´ï¼Œ&lt;strong&gt;å¤åˆ¶&lt;/strong&gt;çˆ¶è¿›ç¨‹çš„å †æ ˆæ•°æ®ï¼ˆé€šå¸¸é‡‡ç”¨&lt;strong&gt;å†™æ—¶å¤åˆ¶&lt;/strong&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å…±äº«&lt;/strong&gt;æ‰€å±è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼ˆå †ã€å…¨å±€å˜é‡ï¼‰ï¼Œæ‹¥æœ‰&lt;strong&gt;ç‹¬ç«‹&lt;/strong&gt;çš„æ ˆç©ºé—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºå¼€é”€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒå¤§&lt;/strong&gt;ã€‚åˆ›å»ºéœ€å¤åˆ¶çˆ¶è¿›ç¨‹èµ„æºï¼ˆå¦‚å†…å­˜é¡µè¡¨ï¼‰ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ä¹Ÿè¾ƒå¤§&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒå°&lt;/strong&gt;ã€‚åˆ›å»ºåªéœ€åˆ†é…ç‹¬ç«‹æ ˆå’Œå°‘é‡å¯„å­˜å™¨ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¿«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®å…±äº«ä¸é€šä¿¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é€šè¿‡&lt;strong&gt;è¿›ç¨‹é—´é€šä¿¡ (IPC)&lt;/strong&gt;ï¼Œå¦‚ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ç­‰ï¼Œç›¸å¯¹å¤æ‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç›´æ¥å…±äº«&lt;/strong&gt;è¿›ç¨‹çš„å…¨å±€æ•°æ®ã€å †å†…å­˜ï¼Œé€šè¿‡&lt;strong&gt;åŒæ­¥åŸè¯­&lt;/strong&gt;ï¼ˆå¦‚äº’æ–¥é”ï¼‰åè°ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‹¬ç«‹æ€§/éš”ç¦»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼ºéš”ç¦»&lt;/strong&gt;ã€‚ä¸€ä¸ªå­è¿›ç¨‹å´©æºƒ&lt;strong&gt;é€šå¸¸ä¸ä¼š&lt;/strong&gt;å½±å“çˆ¶è¿›ç¨‹æˆ–å…¶ä»–å­è¿›ç¨‹&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼±éš”ç¦»&lt;/strong&gt;ã€‚ä¸€ä¸ªçº¿ç¨‹å´©æºƒ&lt;strong&gt;å¯èƒ½å¯¼è‡´&lt;/strong&gt;æ•´ä¸ªè¿›ç¨‹ç»ˆæ­¢ï¼Œå½±å“åŒè¿›ç¨‹æ‰€æœ‰çº¿ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ›å»ºé€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒæ…¢&lt;/strong&gt;ï¼Œå› ä¸ºéœ€è¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´å’Œèµ„æº&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒå¿«&lt;/strong&gt;ï¼Œå› ä¸ºå…±äº«è¿›ç¨‹çš„å¤§éƒ¨åˆ†èµ„æºï¼Œåªéœ€åˆ†é…ç‹¬ç«‹çš„æ ˆå’Œå¯„å­˜å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒåº¦ä¸åˆ‡æ¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒåº¦ï¼Œè¿›ç¨‹é—´åˆ‡æ¢æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´åˆ‡æ¢ï¼Œ&lt;strong&gt;å¼€é”€å¤§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒåº¦ï¼ˆå†…æ ¸çº§çº¿ç¨‹ï¼‰ï¼Œçº¿ç¨‹é—´åˆ‡æ¢åªéœ€ä¿å­˜æ¢å¤å¯„å­˜å™¨ã€æ ˆç­‰ï¼Œ&lt;strong&gt;å¼€é”€å°&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®¡ç®—å¯†é›†å‹&lt;/strong&gt;ä»»åŠ¡ã€éœ€è¦&lt;strong&gt;å¼ºéš”ç¦»æ€§&lt;/strong&gt;å’Œ&lt;strong&gt;ç¨³å®šæ€§&lt;/strong&gt;çš„åœºæ™¯ï¼ˆå¦‚å®‰å…¨æ²™ç®±ã€å¾®æœåŠ¡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;I/Oå¯†é›†å‹&lt;/strong&gt;ä»»åŠ¡ã€éœ€è¦&lt;strong&gt;é«˜é¢‘æ•°æ®å…±äº«&lt;/strong&gt;å’Œ&lt;strong&gt;ä½å»¶è¿Ÿé€šä¿¡&lt;/strong&gt;çš„åœºæ™¯ï¼ˆå¦‚WebæœåŠ¡å™¨ã€GUIåº”ç”¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§  &lt;strong&gt;æ·±å…¥ç†è§£â€œå†™æ—¶å¤åˆ¶â€ (Copy-On-Write, COW)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å­è¿›ç¨‹å¹¶éåœ¨åˆ›å»ºç¬é—´å°±å®Œæ•´å¤åˆ¶çˆ¶è¿›ç¨‹çš„æ‰€æœ‰å †æ ˆæ•°æ®ã€‚ç°ä»£æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Linuxï¼‰æ™®éé‡‡ç”¨&lt;strong&gt;å†™æ—¶å¤åˆ¶&lt;/strong&gt;æŠ€æœ¯æ¥ä¼˜åŒ–æ€§èƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºæ—¶&lt;/strong&gt;ï¼šå­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜é¡µï¼Œå†…æ ¸ä»…å°†é¡µè¡¨æ ‡è®°ä¸ºåªè¯»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¿®æ”¹æ—¶&lt;/strong&gt;ï¼šå½“çˆ¶æˆ–å­è¿›ç¨‹å°è¯•å†™å…¥æŸé¡µæ—¶ï¼Œå†…æ ¸ä¼š&lt;strong&gt;é€æ˜åœ°&lt;/strong&gt;ä¸ºè¯¥è¿›ç¨‹å¤åˆ¶ä¸€ä¸ªè¯¥é¡µçš„å‰¯æœ¬ä¾›å…¶ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·é¿å…äº†ä¸å¿…è¦çš„å¤åˆ¶ï¼Œå¤§å¤§å‡å°‘äº†è¿›ç¨‹åˆ›å»ºçš„å¼€é”€å’Œåˆå§‹å†…å­˜å ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¦‚ä½•é€‰æ‹©ï¼šå­è¿›ç¨‹ vs. çº¿ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©çš„å…³é”®å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘å­è¿›ç¨‹çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦é«˜ç¨³å®šæ€§å’Œéš”ç¦»æ€§&lt;/strong&gt;ï¼šå…³é”®ä»»åŠ¡ç»„ä»¶ï¼Œå¸Œæœ›ä¸€ä¸ªå•å…ƒçš„å´©æºƒä¸å½±å“å…¶ä»–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ©ç”¨å¤šæ ¸è¿›è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡&lt;/strong&gt;ï¼šå¦‚ç§‘å­¦è®¡ç®—ã€å›¾åƒæ¸²æŸ“ï¼Œè¿›ç¨‹å¯ç‹¬ç«‹åœ¨ä¸åŒCPUæ ¸å¿ƒè¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½æ¨¡å—éœ€ç‹¬ç«‹éƒ¨ç½²æˆ–ä¼¸ç¼©&lt;/strong&gt;ï¼šç±»ä¼¼å¾®æœåŠ¡æ¶æ„çš„æ€æƒ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘çº¿ç¨‹çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦å¤§é‡å¹¶å‘å¤„ç†I/Oæ“ä½œ&lt;/strong&gt;ï¼šå¦‚ç½‘ç»œæœåŠ¡å™¨å¤„ç†æµ·é‡è¯·æ±‚ï¼Œçº¿ç¨‹é—´åˆ‡æ¢å¼€é”€å°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹é—´éœ€è¦é¢‘ç¹ã€é«˜æ•ˆåœ°å…±äº«å’Œäº¤æ¢æ•°æ®&lt;/strong&gt;ï¼šå¦‚å›¾å½¢ç•Œé¢åº”ç”¨å“åº”äº¤äº’å¹¶å®æ—¶æ›´æ–°æ˜¾ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡å¯åˆ†è§£ä¸ºå¤šä¸ªé¡ºåºæ­¥éª¤å¹¶æµæ°´çº¿åŒ–&lt;/strong&gt;ï¼šå¦‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ¨¡å¼&lt;/strong&gt;ï¼šç°ä»£å¤æ‚ç³»ç»Ÿå¸¸æ··åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤šè¿›ç¨‹çš„WebæœåŠ¡å™¨ï¼ˆå¤šä¸ªWorkerè¿›ç¨‹ï¼‰ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨åˆæ˜¯å¤šçº¿ç¨‹çš„ï¼ˆå¤„ç†å¤šä¸ªè¯·æ±‚ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å­è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;h2 id="meta-inf"&gt;META-INF
&lt;/h2&gt;&lt;p&gt;META-INF å’Œ WEB-INF éƒ½æ˜¯ Java ç›¸å…³é¡¹ç›®ä¸­å¸¸è§çš„ç›®å½•ï¼Œä½†å®ƒä»¬çš„&lt;strong&gt;ç›®çš„ã€ä½ç½®å’Œå†…å®¹&lt;/strong&gt;æœ‰æ˜¾è‘—ä¸åŒã€‚ä¸ºäº†å¸®ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒåŒºåˆ«ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;META-INF&lt;/th&gt;
&lt;th&gt;WEB-INF&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ &lt;strong&gt;JAR åŒ…/Javaåº”ç”¨çš„å…ƒæ•°æ®&lt;/strong&gt; (Metadata)&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ &lt;strong&gt;Java Web åº”ç”¨çš„é…ç½®å’Œæ ¸å¿ƒèµ„æº&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸è§ä½ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½äº &lt;strong&gt;JAR æ–‡ä»¶&lt;/strong&gt;çš„æ ¹ç›®å½•ä¸‹ï¼Œæˆ–é¡¹ç›®&lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹&lt;/td&gt;
&lt;td&gt;ä½äº &lt;strong&gt;Java Web åº”ç”¨&lt;/strong&gt;çš„æ ¹ç›®å½•ä¸‹ (ä¾‹å¦‚ &lt;code&gt;src/main/webapp/WEB-INF&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦å¯ç›´æ¥é€šè¿‡URLè®¿é—®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸&lt;strong&gt;ä¸èƒ½&lt;/strong&gt;ç›´æ¥é€šè¿‡æµè§ˆå™¨è®¿é—®&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç»å¯¹ä¸èƒ½&lt;/strong&gt;ç›´æ¥é€šè¿‡å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰URLè®¿é—®ï¼Œæ˜¯æœåŠ¡ç«¯å®‰å…¨ç›®å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæ–‡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;MANIFEST.MF&lt;/code&gt;, &lt;code&gt;spring.factories&lt;/code&gt;, æœåŠ¡æä¾›è€…é…ç½®ç­‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;web.xml&lt;/code&gt;, &lt;code&gt;/classes&lt;/code&gt;, &lt;code&gt;/lib&lt;/code&gt;, &lt;code&gt;/jsp&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ä½œç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸º &lt;strong&gt;JVMã€æ¡†æ¶ã€å®¹å™¨&lt;/strong&gt; æä¾›é…ç½®ä¿¡æ¯ï¼Œç”¨äº&lt;strong&gt;å¼•å¯¼ã€é…ç½®ã€æ‰©å±•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®Webåº”ç”¨&lt;/strong&gt;ï¼ˆServletã€Filterï¼‰ã€&lt;strong&gt;å­˜æ”¾ç¼–è¯‘åçš„ç±»æ–‡ä»¶&lt;/strong&gt;ã€&lt;strong&gt;ç®¡ç†ä¾èµ–åº“&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ·±å…¥äº†è§£-meta-inf"&gt;ğŸ“¦ æ·±å…¥äº†è§£ META-INF
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;META-INF&lt;/code&gt;ç›®å½•ä¸»è¦ç”¨äºå­˜å‚¨ &lt;strong&gt;JAR åŒ…æˆ– Java åº”ç”¨çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰å’Œé…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™äº›ä¿¡æ¯è¢« Java è™šæ‹Ÿæœºã€æ¡†æ¶æˆ–å®¹å™¨è¯†åˆ«å’Œä½¿ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½ç½®&lt;/strong&gt;ï¼šé€šå¸¸ä½äº &lt;strong&gt;JAR æ–‡ä»¶çš„æ ¹ç›®å½•&lt;/strong&gt;ã€‚åœ¨ Maven/Gradle é¡¹ç›®ä¸­ï¼Œä½ é€šå¸¸ä¼šæŠŠéœ€è¦æ‰“åŒ…è¿› JAR çš„ &lt;code&gt;META-INF&lt;/code&gt;èµ„æºæ–‡ä»¶æ”¾åœ¨ &lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ–‡ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MANIFEST.MF&lt;/code&gt;&lt;/strong&gt;ï¼šæœ€é‡è¦çš„æ–‡ä»¶ï¼Œå®šä¹‰äº† JAR åŒ…çš„å…ƒæ•°æ®ï¼Œå¦‚&lt;strong&gt;ä¸»ç±»ï¼ˆMain-Classï¼‰&lt;/strong&gt;ã€&lt;strong&gt;ç±»è·¯å¾„ï¼ˆClass-Pathï¼‰&lt;/strong&gt;ã€ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;spring.factories&lt;/code&gt;&lt;/strong&gt; / &lt;strong&gt;&lt;code&gt;spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;&lt;/strong&gt;ï¼šSpring Boot ç”¨äº&lt;strong&gt;è‡ªåŠ¨é…ç½®&lt;/strong&gt;çš„å…³é”®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;services/&lt;/code&gt;&lt;/strong&gt; ç›®å½•ï¼šç”¨äº &lt;strong&gt;Java SPIï¼ˆService Provider Interfaceï¼‰&lt;/strong&gt; æœºåˆ¶ï¼Œå­˜æ”¾æœåŠ¡æ¥å£å®ç°ç±»çš„é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;INDEX.LIST&lt;/code&gt;&lt;/strong&gt;ï¼šåŒ…å« JAR ä¸­ç±»å’Œèµ„æºçš„åˆ—è¡¨ï¼Œç”¨äºåŠ é€Ÿç±»åŠ è½½ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–ï¼šå¦‚æ•°å­—ç­¾åæ–‡ä»¶ï¼ˆ&lt;code&gt;.SF&lt;/code&gt;, &lt;code&gt;.DSA&lt;/code&gt;ç­‰ï¼‰ã€&lt;code&gt;persistence.xml&lt;/code&gt;ï¼ˆJPAé…ç½®ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ·±å…¥äº†è§£-web-inf"&gt;ğŸŒ æ·±å…¥äº†è§£ WEB-INF
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;WEB-INF&lt;/code&gt;æ˜¯ &lt;strong&gt;Java Web åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªå®‰å…¨ç›®å½•&lt;/strong&gt;ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶å’Œæ ¸å¿ƒèµ„æºã€‚&lt;strong&gt;å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰æ— æ³•ç›´æ¥é€šè¿‡ URL è®¿é—®è¯¥ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™æ˜¯ Java Web åº”ç”¨å®‰å…¨æ¨¡å‹çš„é‡è¦éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½ç½®&lt;/strong&gt;ï¼šä½äº &lt;strong&gt;Java Web åº”ç”¨çš„æ ¹ç›®å½•&lt;/strong&gt;ä¸‹ã€‚åœ¨æ ‡å‡† Maven Web é¡¹ç›®ä¸­ï¼Œè·¯å¾„é€šå¸¸æ˜¯ &lt;code&gt;src/main/webapp/WEB-INF&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ–‡ä»¶ä¸å­ç›®å½•&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;web.xml&lt;/code&gt;&lt;/strong&gt;ï¼šWeb åº”ç”¨çš„&lt;strong&gt;éƒ¨ç½²æè¿°ç¬¦æ–‡ä»¶&lt;/strong&gt;ï¼Œæ˜¯æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚ç”¨äºå®šä¹‰ Servletã€Filterã€Listenerã€æ¬¢è¿é¡µé¢ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/classes/&lt;/code&gt;&lt;/strong&gt; ç›®å½•ï¼šå­˜æ”¾&lt;strong&gt;ç¼–è¯‘åçš„ Java ç±»æ–‡ä»¶&lt;/strong&gt;ï¼ˆ.classï¼‰ï¼Œä¾‹å¦‚ä½ çš„ Servletsã€å·¥å…·ç±»ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/lib/&lt;/code&gt;&lt;/strong&gt; ç›®å½•ï¼šå­˜æ”¾ Web åº”ç”¨ä¾èµ–çš„&lt;strong&gt;ç¬¬ä¸‰æ–¹ JAR æ–‡ä»¶&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/jsp/&lt;/code&gt;&lt;/strong&gt; æˆ– &lt;strong&gt;&lt;code&gt;/jsp2/&lt;/code&gt;&lt;/strong&gt; ç­‰ç›®å½•ï¼šå¸¸æŒ‰æƒ¯ä¾‹ç”¨äºå­˜æ”¾ &lt;strong&gt;JSP æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™äº›é¡µé¢ä¹Ÿæ— æ³•è¢«å®¢æˆ·ç«¯ç›´æ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡ Servlet è½¬å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®æ–¹å¼&lt;/strong&gt;ï¼š&lt;code&gt;WEB-INF&lt;/code&gt;ä¸‹çš„èµ„æºï¼ˆå¦‚ä¸€å¼ å›¾ç‰‡æˆ–ä¸€ä¸ªJSPï¼‰è‹¥è¦è¢«å‰ç«¯è®¿é—®ï¼Œ&lt;strong&gt;å¿…é¡»é€šè¿‡æœåŠ¡å™¨ç«¯ç¨‹åºï¼ˆå¦‚ Servletã€Controllerï¼‰è¿›è¡Œä¸­è½¬&lt;/strong&gt;ï¼Œä¾‹å¦‚åœ¨ Servlet ä¸­è¯»å–æ–‡ä»¶æµå¹¶å†™å…¥å“åº”ï¼Œæˆ–é€šè¿‡æ§åˆ¶å™¨è½¬å‘è¯·æ±‚åˆ° JSP é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä¸è®°å¿†æŠ€å·§"&gt;ğŸ’¡ æ€»ç»“ä¸è®°å¿†æŠ€å·§
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;META-INF&lt;/code&gt;&lt;/strong&gt; æ˜¯ &lt;strong&gt;JAR åŒ…çš„â€œè¯´æ˜ä¹¦å’Œæ‰©å±•é…ç½®â€&lt;/strong&gt;ï¼Œç»™ JVM å’Œæ¡†æ¶çœ‹çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;WEB-INF&lt;/code&gt;&lt;/strong&gt; æ˜¯ &lt;strong&gt;Web åº”ç”¨çš„â€œå¿ƒè„å’Œå¤§è„‘â€&lt;/strong&gt;ï¼Œå­˜æ”¾é…ç½®ã€ä»£ç å’Œä¾èµ–ï¼Œå—ä¿æŠ¤ä¸”ä¸å…è®¸ç›´æ¥å¤–éƒ¨è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®°ä½ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼š&lt;strong&gt;&lt;code&gt;WEB-INF&lt;/code&gt;æ˜¯ Web åº”ç”¨ç‰¹æœ‰çš„å®‰å…¨ç›®å½•ï¼Œè€Œ &lt;code&gt;META-INF&lt;/code&gt;åˆ™å¹¿æ³›å­˜åœ¨äºå„ç§ JAR åŒ…ä¸­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id="qualifier"&gt;@Qualifier
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring ä¸­ï¼Œ&lt;code&gt;@Bean @Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;å’Œ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;è¿™ä¸¤ç§æ–¹å¼&lt;strong&gt;æœ€ä¸»è¦çš„åŒºåˆ«&lt;/strong&gt;åœ¨äºï¼š&lt;strong&gt;&lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;ç›´æ¥å®šä¹‰äº† Bean çš„åç§°ï¼ˆæˆ–æ ‡è¯†ç¬¦ï¼‰&lt;/strong&gt;ï¼Œè€Œ &lt;strong&gt;&lt;code&gt;@Bean&lt;/code&gt;é…åˆ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;æ˜¯åœ¨å®šä¹‰ Bean çš„åŒæ—¶ï¼Œä¸ºå…¶æ·»åŠ äº†ä¸€ä¸ªåä¸º &amp;ldquo;backup&amp;rdquo; çš„â€œé™å®šç¬¦â€ï¼ˆQualifierï¼‰&lt;/strong&gt;ï¼Œè¿™ä¸ªé™å®šç¬¦å¯ä»¥ç†è§£ä¸º Bean çš„ä¸€ä¸ª&lt;strong&gt;é¢å¤–æ ‡ç­¾æˆ–å…ƒæ•°æ®&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼èƒ½å¸®ä½ æ›´æ¸…æ™°åœ°ç†è§£å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§å¯¹æ¯”&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean&lt;/code&gt;+ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨è§£æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£ä¸­ç›´æ¥é€šè¿‡ &lt;code&gt;name&lt;/code&gt;æˆ– &lt;code&gt;value&lt;/code&gt;å±æ€§æŒ‡å®šåç§°&lt;/td&gt;
&lt;td&gt;è”åˆä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier&lt;/code&gt;ä¸¤ä¸ªæ³¨è§£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®šä¹‰ Bean çš„åç§°ï¼ˆæ ‡è¯†ç¬¦ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸º Bean æ·»åŠ ä¸€ä¸ªâ€œé™å®šç¬¦â€ï¼ˆQualifierï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean çš„åç§°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜ç¡®æŒ‡å®šä¸º &lt;code&gt;&amp;quot;backup&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸º &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•çš„æ–¹æ³•åï¼ˆé™¤éåŒæ—¶ä½¿ç”¨äº† &lt;code&gt;@Bean(name=&amp;quot;...&amp;quot;)&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é™å®šç¬¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆé™¤éé¢å¤–æ·»åŠ äº† &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£ï¼‰&lt;/td&gt;
&lt;td&gt;æ˜ç¡®æ·»åŠ äº† &lt;code&gt;&amp;quot;backup&amp;quot;&lt;/code&gt;è¿™ä¸ªé™å®šç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–æ³¨å…¥æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯é€šè¿‡åç§°åŒ¹é… (å¦‚ &lt;code&gt;@Resource(name=&amp;quot;backup&amp;quot;)&lt;/code&gt;) æˆ– &lt;code&gt;@Qualifier&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸éœ€è¦æ˜ç¡®ä½¿ç”¨ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;æ¥æŒ‡å®šæ³¨å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦ç”¨äº&lt;strong&gt;å®šä¹‰ Bean çš„åç§°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦ç”¨äº&lt;strong&gt;ä¸º Bean æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ï¼Œä»¥ä¾¿åœ¨ä¾èµ–æ³¨å…¥æ—¶è¿›è¡Œæ›´ç²¾ç»†çš„åŒºåˆ†å’Œé€‰æ‹©&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ç®€å•æ¥è¯´"&gt;ğŸ’¡ ç®€å•æ¥è¯´
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ åªæ˜¯æƒ³&lt;strong&gt;ç»™è¿™ä¸ª Bean å–ä¸ªç‰¹å®šçš„åå­—&lt;/strong&gt;ï¼Œé‚£ä¹ˆ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;æ›´ç›´æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ å¸Œæœ›ä¸ºè¿™ä¸ª Bean &lt;strong&gt;æ‰“ä¸Šä¸€ä¸ªç‰¹æ®Šçš„â€œæ ‡ç­¾â€&lt;/strong&gt;ï¼Œä»¥ä¾¿åœ¨å…¶ä»–åœ°æ–¹&lt;strong&gt;é€šè¿‡è¿™ä¸ªâ€œæ ‡ç­¾â€æ¥ç²¾ç¡®é€‰æ‹©å®ƒ&lt;/strong&gt;ï¼ˆå°¤å…¶æ˜¯åœ¨æœ‰å¤šä¸ªåŒç±»å‹ Bean éœ€è¦åŒºåˆ†æ—¶ï¼‰ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;é…åˆ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä»£ç ç¤ºä¾‹"&gt;ğŸ› ï¸ ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª &lt;code&gt;MyService&lt;/code&gt;ç±»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼å®šä¹‰çš„ Beanï¼Œå…¶&lt;strong&gt;åç§°&lt;/strong&gt;å°±æ˜¯ &amp;ldquo;backup&amp;rdquo;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean(&amp;#34;backup&amp;#34;) // Bean çš„åç§°è¢«å®šä¹‰ä¸º &amp;#34;backup&amp;#34;
public MyService myService() {
return new MyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ³¨å…¥æ—¶ï¼Œå¯ä»¥é€šè¿‡åç§°åŒ¹é…ï¼ˆå¦‚ &lt;code&gt;@Resource&lt;/code&gt;ï¼‰æˆ–ç»“åˆ &lt;code&gt;@Qualifier&lt;/code&gt;æ¥æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// ä½¿ç”¨ @Resource æŒ‰åç§°æ³¨å…¥
@Resource(name = &amp;#34;backup&amp;#34;)
private MyService backupService;
// æˆ–è€…ä½¿ç”¨ @Autowired å’Œ @Qualifier æŒ‰åç§°æ³¨å…¥
@Autowired
@Qualifier(&amp;#34;backup&amp;#34;)
private MyService backupService;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;2. ä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼å®šä¹‰çš„ Beanï¼Œå…¶&lt;strong&gt;åç§°é»˜è®¤æ˜¯æ–¹æ³•å&lt;/strong&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;myService&lt;/code&gt;ï¼‰ï¼Œä½†åŒæ—¶å®ƒæ‹¥æœ‰ä¸€ä¸ªåä¸º &amp;ldquo;backup&amp;rdquo; çš„&lt;strong&gt;é™å®šç¬¦&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean
@Qualifier(&amp;#34;backup&amp;#34;) // ä¸ºè¿™ä¸ª Bean æ·»åŠ äº†ä¸€ä¸ª &amp;#34;backup&amp;#34; çš„é™å®šç¬¦
public MyService myService() {
return new MyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ³¨å…¥æ—¶ï¼Œ&lt;strong&gt;é€šå¸¸éœ€è¦æ˜ç¡®ä½¿ç”¨ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;&lt;/strong&gt; æ¥æŒ‡å®šè¦æ³¨å…¥çš„æ˜¯å¸¦æœ‰è¿™ä¸ªé™å®šç¬¦çš„ Beanï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// éœ€è¦é…åˆ @Qualifier æ¥æŒ‡å®šæ³¨å…¥å¸¦æœ‰è¯¥é™å®šç¬¦çš„ Bean
@Autowired
@Qualifier(&amp;#34;backup&amp;#34;)
private MyService backupService;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„ç‚¹å’Œå¸¸è§ç–‘é—®"&gt;âš ï¸ æ³¨æ„ç‚¹å’Œå¸¸è§ç–‘é—®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ä»¥ç»„åˆä½¿ç”¨&lt;/strong&gt;ï¼šä½ å®Œå…¨å¯ä»¥åŒæ—¶ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;ï¼Œè¿™æ · Bean çš„åç§°æ˜¯ &amp;ldquo;backup&amp;rdquo;ï¼ŒåŒæ—¶å®ƒä¹Ÿæœ‰ä¸€ä¸ª &amp;ldquo;backup&amp;rdquo; çš„é™å®šç¬¦ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean(&amp;#34;backup&amp;#34;) // æŒ‡å®šBeanåç§°ä¸º&amp;#34;backup&amp;#34;
@Qualifier(&amp;#34;backup&amp;#34;) // åŒæ—¶ä¸ºå…¶æ·»åŠ &amp;#34;backup&amp;#34;é™å®šç¬¦
public MyService myService() {
return new MyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™å®šç¬¦çš„å¨åŠ›&lt;/strong&gt;ï¼š&lt;code&gt;@Qualifier&lt;/code&gt;çš„çœŸæ­£å¨åŠ›åœ¨äºå®ƒå¯ä»¥ç”¨äº&lt;strong&gt;åˆ†ç»„&lt;/strong&gt;ã€‚ä½ å¯ä»¥ä¸ºå¤šä¸ªä¸åŒçš„ Bean æ‰“ä¸Š&lt;strong&gt;ç›¸åŒçš„é™å®šç¬¦&lt;/strong&gt;ï¼Œç„¶ååœ¨æ³¨å…¥ç‚¹æ—¶ï¼Œæ³¨å…¥æ‰€æœ‰å¸¦æœ‰è¯¥é™å®šç¬¦çš„ Beanï¼ˆä¾‹å¦‚æ³¨å…¥ä¸€ä¸ª &lt;code&gt;List&amp;lt;MyService&amp;gt;&lt;/code&gt;ï¼‰ã€‚è¿™æ˜¯å•çº¯ä½¿ç”¨ Bean åç§°éš¾ä»¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Primary&lt;/code&gt;çš„ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“åŒæ—¶å­˜åœ¨ &lt;code&gt;@Primary&lt;/code&gt;Bean å’Œä½¿ç”¨äº† &lt;code&gt;@Qualifier&lt;/code&gt;æŒ‡å®šçš„ Bean æ—¶ï¼Œ&lt;strong&gt;&lt;code&gt;@Qualifier&lt;/code&gt;çš„æ¡ä»¶æ›´ä¸¥æ ¼ï¼Œä¼˜å…ˆçº§æ›´é«˜&lt;/strong&gt;ï¼ŒSpring ä¼šä¼˜å…ˆæ³¨å…¥æ»¡è¶³ &lt;code&gt;@Qualifier&lt;/code&gt;æ¡ä»¶çš„ Beanã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å¦‚ä½•é€‰æ‹©"&gt;å¦‚ä½•é€‰æ‹©ï¼Ÿ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœä½ åªæ˜¯æƒ³å‘½åï¼Œ&lt;strong&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;å°±è¶³å¤Ÿäº†&lt;/strong&gt;ï¼Œæ›´åŠ ç®€æ´ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ éœ€è¦&lt;strong&gt;åŸºäºæŸç§ç‰¹å¾ï¼ˆè€Œä¸ä»…ä»…æ˜¯åå­—ï¼‰æ¥åŒºåˆ†æˆ–é€‰æ‹© Bean&lt;/strong&gt;æ—¶ï¼Œ&lt;code&gt;@Qualifier&lt;/code&gt;å°±éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰å¤šä¸ªæ•°æ®æºï¼Œå¯ä»¥ç”¨ &lt;code&gt;@Qualifier(&amp;quot;master&amp;quot;)&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier(&amp;quot;slave&amp;quot;)&lt;/code&gt;æ¥æ ‡è®°ä¸»ä»æ•°æ®æºï¼Œä»£ç çš„è¯­ä¹‰ä¼šæ›´æ¸…æ™°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£ä¸¤è€…çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;h2 id="bean-list"&gt;@Bean List
&lt;/h2&gt;&lt;p&gt;å½“ä½ åŒæ—¶å®šä¹‰äº† &lt;code&gt;@Bean&lt;/code&gt;è¿”å› &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;å’Œ &lt;code&gt;@Bean&lt;/code&gt;è¿”å› &lt;code&gt;OpenAiInstance&lt;/code&gt;ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­é€šè¿‡ &lt;code&gt;@Autowired&lt;/code&gt;æ³¨å…¥ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;æ—¶ï¼ŒSpring çš„è¡Œä¸ºæœ‰ä¸€ä¸ªéå¸¸æ˜ç¡®çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒç»“è®º"&gt;âš¡ æ ¸å¿ƒç»“è®º
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;private final List&amp;lt;OpenAiInstance&amp;gt; instances;&lt;/code&gt;&lt;strong&gt;å°†ä¼šæ³¨å…¥ Spring å®¹å™¨ä¸­æ‰€æœ‰ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„ Bean&lt;/strong&gt;ã€‚è¿™åŒ…æ‹¬äº†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é‚£ä¸ªé€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¿”å›çš„&lt;strong&gt;å•ä¸ª &lt;code&gt;OpenAiInstance&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¿”å›çš„ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;&lt;strong&gt;é›†åˆä¸­çš„æ¯ä¸€ä¸ª &lt;code&gt;OpenAiInstance&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼ŒSpring ä¸ä¼šå› ä¸ºä½ å®šä¹‰äº†ä¸€ä¸ªè¿”å› &lt;code&gt;List&lt;/code&gt;çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ï¼Œå°±æŠŠè¿™ä¸ª &lt;code&gt;List&lt;/code&gt;æœ¬èº«å½“ä½œä¸€ä¸ª Bean æ³¨å…¥åˆ° &lt;code&gt;instances&lt;/code&gt;ä¸­ã€‚è€Œæ˜¯ä¼šè¿›è¡Œä¸€ç§ç§°ä¸ºâ€œé›†åˆæ³¨å…¥â€çš„æ“ä½œï¼Œå°†æ‰€æœ‰åŒ¹é…çš„å•ä¸ª Beanâ€œæ‰å¹³åŒ–â€åœ°æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„ &lt;code&gt;List&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è¯¦ç»†åˆ†æä¸ç¤ºä¾‹"&gt;ğŸ” è¯¦ç»†åˆ†æä¸ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä½ æœ‰å¦‚ä¸‹é…ç½®ç±»ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class OpenAiConfig {
// å®šä¹‰ä¸€ä¸ªè¿”å›å•ä¸ªOpenAiInstanceçš„Bean
@Bean
public OpenAiInstance primaryInstance() {
return new OpenAiInstance(&amp;#34;GPT-4o&amp;#34;, &amp;#34;api.key.primary&amp;#34;);
}
// å®šä¹‰ä¸€ä¸ªè¿”å›List&amp;lt;OpenAiInstance&amp;gt;çš„Bean
@Bean
public List&amp;lt;OpenAiInstance&amp;gt; backupInstances() {
return Arrays.asList(
new OpenAiInstance(&amp;#34;GPT-3.5-Turbo&amp;#34;, &amp;#34;api.key.backup1&amp;#34;),
new OpenAiInstance(&amp;#34;Claude-2&amp;#34;, &amp;#34;api.key.backup2&amp;#34;)
);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ä½ çš„æœåŠ¡ä¸­è¿™æ ·æ³¨å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyAIService {
private final List&amp;lt;OpenAiInstance&amp;gt; instances;
// æ„é€ å™¨æ³¨å…¥
public MyAIService(List&amp;lt;OpenAiInstance&amp;gt; instances) {
this.instances = instances;
}
public void useInstances() {
for (OpenAiInstance instance : instances) {
System.out.println(instance.getName());
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æœ€ç»ˆ-instancesåˆ—è¡¨ä¸­çš„å…ƒç´ "&gt;ğŸ’¡ æœ€ç»ˆ &lt;code&gt;instances&lt;/code&gt;åˆ—è¡¨ä¸­çš„å…ƒç´ 
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;MyAIService.instances&lt;/code&gt;è¿™ä¸ªåˆ—è¡¨å°†åŒ…å« &lt;strong&gt;3 ä¸ª&lt;/strong&gt; &lt;code&gt;OpenAiInstance&lt;/code&gt;å¯¹è±¡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¥è‡ª &lt;code&gt;primaryInstance()&lt;/code&gt;æ–¹æ³•è¿”å›çš„ Beanã€‚&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;code&gt;backupInstances()&lt;/code&gt;æ–¹æ³•è¿”å›çš„ List ä¸­çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;code&gt;backupInstances()&lt;/code&gt;æ–¹æ³•è¿”å›çš„ List ä¸­çš„ç¬¬äºŒä¸ªå¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// instances åˆ—è¡¨ä¸­çš„å…ƒç´ å¤§è‡´ç›¸å½“äºï¼š
List&amp;lt;OpenAiInstance&amp;gt; injectedList = List.of(
primaryInstance(), // å•ç‹¬çš„Bean
backupInstances().get(0), // Listä¸­çš„ç¬¬ä¸€ä¸ª
backupInstances().get(1) // Listä¸­çš„ç¬¬äºŒä¸ª
);
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ€»ç»“ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ“Œ æ€»ç»“ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¡Œä¸º&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨å…¥æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring ä¼šå¯¹æ³¨å…¥ç‚¹ï¼ˆå¦‚ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt; instances&lt;/code&gt;ï¼‰è¿›è¡Œ&lt;strong&gt;ç±»å‹åŒ¹é…&lt;/strong&gt;ï¼Œæ”¶é›†å®¹å™¨ä¸­æ‰€æœ‰è¯¥ç±»å‹çš„ Beanï¼Œè€ŒéæŒ‰åç§°åŒ¹é…æŸä¸ªç‰¹å®šçš„ List Beanã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean çš„æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨å…¥çš„ List åŒ…å«äº†æ‰€æœ‰ &lt;code&gt;OpenAiInstance&lt;/code&gt;ç±»å‹çš„ Beanï¼Œæ— è®ºå®ƒä»¬æ˜¯é€šè¿‡å•ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å®šä¹‰ï¼Œè¿˜æ˜¯ä½œä¸ºå¦ä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¿”å›çš„ Collectionï¼ˆList, Set ç­‰ï¼‰ä¸­çš„å…ƒç´ ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é¡ºåºé—®é¢˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†åˆä¸­ Bean çš„æ³¨å…¥é¡ºåºé»˜è®¤æ˜¯ä¸ç¡®å®šçš„ã€‚è‹¥è¦æ§åˆ¶é¡ºåºï¼Œå¯ä»¥åœ¨ Bean å®šä¹‰æˆ–ç±»ä¸Šä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Order&lt;/code&gt;&lt;/strong&gt; æ³¨è§£ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¦‚ä½•æ³¨å…¥ç‰¹å®šçš„ List Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœä½ å¸Œæœ›æ³¨å…¥çš„æ˜¯ &lt;code&gt;backupInstances()&lt;/code&gt;æ–¹æ³•è¿”å›çš„é‚£ä¸ª&lt;strong&gt;å…·ä½“çš„ List å¯¹è±¡æœ¬èº«&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ‰å¹³åŒ–çš„ &lt;code&gt;OpenAiInstance&lt;/code&gt;Beanï¼Œä½ éœ€è¦ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Qualifier&lt;/code&gt;&lt;/strong&gt; æ³¨è§£æ¥æŒ‰åç§°æŒ‡å®šï¼š &lt;code&gt;public MyAIService(@Qualifier(&amp;quot;backupInstances&amp;quot;) List&amp;lt;OpenAiInstance&amp;gt; instances)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ› ï¸ æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®æ„å›¾&lt;/strong&gt;ï¼šåœ¨è®¾è®¡æ—¶æƒ³æ¸…æ¥šï¼Œä½ æ˜¯å¸Œæœ›æ”¶é›†æ‰€æœ‰è¯¥ç±»å‹çš„ Beanï¼Œè¿˜æ˜¯åªæƒ³æ³¨å…¥æŸä¸€ä¸ªç‰¹å®šçš„é›†åˆã€‚å‰è€…å¸¸ç”¨äºç­–ç•¥æ¨¡å¼æˆ–å¤„ç†é“¾ï¼Œåè€…åˆ™æ˜¯ä¸€ä¸ªç‰¹å®šçš„é…ç½®é›†åˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;&lt;/strong&gt;ï¼šå½“å­˜åœ¨æ­§ä¹‰æ—¶ï¼ˆæ¯”å¦‚æœ‰å¤šä¸ªåŒç±»å‹çš„ Bean æˆ–å¤šä¸ªè¿”å›é›†åˆçš„ Beanï¼‰ï¼Œ&lt;strong&gt;å§‹ç»ˆä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ¥æ˜ç¡®æŒ‡å®šè¦æ³¨å…¥çš„ Bean çš„åç§°&lt;/strong&gt;ï¼Œè¿™æ˜¯æœ€å®‰å…¨ã€æœ€æ¸…æ™°çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶é¡ºåº&lt;/strong&gt;ï¼šå¦‚æœæ³¨å…¥çš„ List é¡ºåºå¯¹ä¸šåŠ¡é€»è¾‘å¾ˆé‡è¦ï¼ˆä¾‹å¦‚å¤„ç†å™¨çš„æ‰§è¡Œé¡ºåºï¼‰ï¼Œè®°å¾—ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥å®šä¹‰é¡ºåºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ å½»åº•ç†è§£ Spring çš„æ³¨å…¥è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h2 id="é€‰å–-list"&gt;é€‰å– List
&lt;/h2&gt;&lt;p&gt;è¦åœ¨ Spring ä¸­åªæ³¨å…¥ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;è€Œä¸æ³¨å…¥å•ç‹¬çš„ &lt;code&gt;OpenAiInstance&lt;/code&gt;Beanï¼Œæ ¸å¿ƒæ€è·¯æ˜¯è®© Spring åœ¨è‡ªåŠ¨è£…é…æ—¶ï¼Œèƒ½å¤Ÿæ˜ç¡®åŒºåˆ†ä½ è¦çš„æ˜¯ &lt;strong&gt;ä¸€ä¸ªå…·ä½“çš„ List Bean&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯&lt;strong&gt;æ‰€æœ‰ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„ Bean çš„é›†åˆ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å‡ ç§å®ç°æ–¹æ³•ï¼Œä½ å¯ä»¥æ ¹æ®é¡¹ç›®ç»“æ„é€‰æ‹©æœ€åˆé€‚çš„ä¸€ç§ï¼š&lt;/p&gt;
&lt;h3 id="æ–¹æ³•ä¸€è§ˆè¡¨"&gt;æ–¹æ³•ä¸€è§ˆè¡¨
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒæ€è·¯&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="#%e6%96%b9%e6%b3%95%e4%b8%80-%e4%bd%bf%e7%94%a8-qualifier-%e6%b3%a8%e8%a7%a3" &gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä¸º List Bean æ·»åŠ æ ‡è¯†ï¼Œæ³¨å…¥æ—¶æŒ‡å®šè¯¥æ ‡è¯†&lt;/td&gt;
&lt;td&gt;è¯­ä¹‰æ¸…æ™°ï¼ŒSpring æ ‡å‡†æ–¹å¼&lt;/td&gt;
&lt;td&gt;éœ€ç¡®ä¿æ³¨å…¥æ—¶ &lt;code&gt;@Qualifier&lt;/code&gt;çš„ value ä¸ Bean åç§°æˆ–é™å®šç¬¦ä¸€è‡´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="#%e6%96%b9%e6%b3%95%e4%ba%8c-%e4%bd%bf%e7%94%a8-resource-%e6%b3%a8%e8%a7%a3" &gt;ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£æŒ‰åç§°æ³¨å…¥&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥æŒ‰ Bean çš„åç§°è¿›è¡Œæ³¨å…¥&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€æ´&lt;/td&gt;
&lt;td&gt;ä¾èµ– Bean çš„åç§°ï¼Œåç§°æ”¹å˜æ—¶éœ€åŒæ­¥ä¿®æ”¹æ³¨å…¥ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="#%e8%a1%a5%e5%85%85%e8%af%b4%e6%98%8e-%e7%a1%ae%e4%bf%9d%e6%b2%a1%e6%9c%89%e6%97%a0%e5%85%b3%e7%9a%84%e5%8d%95%e7%8b%ac-bean" &gt;ç¡®ä¿æ²¡æœ‰æ— å…³çš„å•ç‹¬ Bean&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä»æºå¤´ä¸Šé¿å…äº§ç”Ÿä¸å¿…è¦çš„ Bean&lt;/td&gt;
&lt;td&gt;ä¸€åŠ³æ°¸é€¸&lt;/td&gt;
&lt;td&gt;å¯èƒ½ä¸é€‚ç”¨äºéœ€è¦å•ç‹¬ Bean çš„å¤æ‚åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ“ä½œæ–¹æ³•è¯¦è§£"&gt;ğŸ› ï¸ æ“ä½œæ–¹æ³•è¯¦è§£
&lt;/h3&gt;&lt;h4 id="æ–¹æ³•ä¸€-ä½¿ç”¨-qualifieræ³¨è§£"&gt;æ–¹æ³•ä¸€: ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯æœ€æ¨èå’Œå¸¸è§çš„æ–¹å¼ã€‚é€šè¿‡ä¸ºä½ çš„ List Bean æ·»åŠ ä¸€ä¸ªé™å®šç¬¦ï¼ˆQualifierï¼‰ï¼Œå¹¶åœ¨æ³¨å…¥ç‚¹æ˜ç¡®æŒ‡å®šè¿™ä¸ªé™å®šç¬¦ï¼Œæ¥ç²¾ç¡®æ§åˆ¶è¦æ³¨å…¥çš„ Beanã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ List Bean å¹¶æ·»åŠ é™å®šç¬¦&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½ çš„é…ç½®ç±»ä¸­ï¼Œå®šä¹‰è¿”å› List çš„æ–¹æ³•ï¼Œå¹¶ä¸ºå…¶æ·»åŠ  &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£ï¼ˆä¾‹å¦‚ï¼ŒæŒ‡å®šä¸º &lt;code&gt;&amp;quot;openaiInstanceList&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class OpenAiConfig {
@Bean
@Qualifier(&amp;#34;openaiInstanceList&amp;#34;) // ä¸ºè¿™ä¸ªList Beanæ·»åŠ ä¸€ä¸ªé™å®šç¬¦
public List&amp;lt;OpenAiInstance&amp;gt; openAiInstances() {
List&amp;lt;OpenAiInstance&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(new OpenAiInstance(&amp;#34;model-a&amp;#34;, &amp;#34;key-1&amp;#34;));
list.add(new OpenAiInstance(&amp;#34;model-b&amp;#34;, &amp;#34;key-2&amp;#34;));
return list;
}
// é¿å…åœ¨æ­¤é…ç½®ç±»ä¸­å®šä¹‰å•ç‹¬çš„ OpenAiInstance Bean
// æˆ–è€…ç¡®ä¿ä»»ä½•å•ç‹¬çš„ OpenAiInstance Bean æœ‰ä¸åŒçš„é™å®šç¬¦æˆ–åç§°
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å…¥æ—¶æŒ‡å®šé™å®šç¬¦&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½ çš„æœåŠ¡ç±»ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;@Autowired&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier&lt;/code&gt;è¿›è¡Œæ³¨å…¥ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyAIService {
private final List&amp;lt;OpenAiInstance&amp;gt; instances;
// åœ¨æ„é€ å™¨å‚æ•°ä¸Šä½¿ç”¨ @Qualifier
public MyAIService(@Qualifier(&amp;#34;openaiInstanceList&amp;#34;) List&amp;lt;OpenAiInstance&amp;gt; instances) {
this.instances = instances; // è¿™é‡Œæ³¨å…¥çš„å°†åªæ˜¯ä½ ä¸Šé¢å®šä¹‰çš„List
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨å­—æ®µæ³¨å…¥ï¼ˆä½†é€šå¸¸æ›´æ¨èæ„é€ å™¨æ³¨å…¥ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
@Qualifier(&amp;#34;openaiInstanceList&amp;#34;)
private List&amp;lt;OpenAiInstance&amp;gt; instances;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ–¹æ³•äºŒ-ä½¿ç”¨-resourceæ³¨è§£"&gt;æ–¹æ³•äºŒ: ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£é»˜è®¤æŒ‰åç§°è¿›è¡Œæ³¨å…¥ã€‚å¦‚æœä½ ä¸º List Bean æŒ‡å®šäº†åç§°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æ³¨å…¥ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ List Bean å¹¶å‘½å&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£çš„ &lt;code&gt;name&lt;/code&gt;å±æ€§æˆ–ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;beanName&amp;quot;)&lt;/code&gt;ä¸º Bean å‘½åã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class OpenAiConfig {
@Bean(&amp;#34;myOpenAiList&amp;#34;) // æŒ‡å®šè¿™ä¸ªList Beançš„åç§°ä¸º &amp;#34;myOpenAiList&amp;#34;
public List&amp;lt;OpenAiInstance&amp;gt; openAiInstances() {
List&amp;lt;OpenAiInstance&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(new OpenAiInstance(&amp;#34;model-a&amp;#34;, &amp;#34;key-1&amp;#34;));
list.add(new OpenAiInstance(&amp;#34;model-b&amp;#34;, &amp;#34;key-2&amp;#34;));
return list;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æŒ‰åç§°æ³¨å…¥&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyAIService {
@Resource(name = &amp;#34;myOpenAiList&amp;#34;) // æŒ‰åç§°æ³¨å…¥
private List&amp;lt;OpenAiInstance&amp;gt; instances;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="-è¡¥å……è¯´æ˜-ç¡®ä¿æ²¡æœ‰æ— å…³çš„å•ç‹¬-bean"&gt;ğŸ”§ è¡¥å……è¯´æ˜: ç¡®ä¿æ²¡æœ‰æ— å…³çš„å•ç‹¬ Bean
&lt;/h4&gt;&lt;p&gt;Spring ä¼šè‡ªåŠ¨å°†å®¹å™¨ä¸­æ‰€æœ‰ç±»å‹åŒ¹é…çš„ Bean æ³¨å…¥åˆ° &lt;code&gt;@Autowired&lt;/code&gt;å£°æ˜çš„é›†åˆä¸­ã€‚å› æ­¤ï¼Œè¯·æ£€æŸ¥ä½ çš„é¡¹ç›®ï¼Œ&lt;strong&gt;ç¡®ä¿æ²¡æœ‰å…¶ä»–è¢« Spring ç®¡ç†çš„ã€ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„å•ç‹¬ Bean&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥ç‚¹ï¼š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯å¦æœ‰å…¶ä»–ç±»è¢«æ ‡æ³¨äº† &lt;code&gt;@Component&lt;/code&gt;, &lt;code&gt;@Service&lt;/code&gt;, &lt;code&gt;@Repository&lt;/code&gt;ç­‰æ³¨è§£ï¼Œå¹¶ä¸”å…¶ç±»å‹æ˜¯ &lt;code&gt;OpenAiInstance&lt;/code&gt;ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åœ¨å…¶ä»–é…ç½®ç±»ä¸­ï¼Œæ˜¯å¦è¿˜æœ‰è¿”å›ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¿™äº›å•ç‹¬çš„ Bean å¹¶éå¿…è¦ï¼Œ&lt;strong&gt;ç§»é™¤&lt;/strong&gt;å®ƒä»¬çš„ Spring ç®¡ç†æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Component&lt;/code&gt;ï¼‰æˆ– &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿™äº›å•ç‹¬çš„ Bean æ˜¯å¿…éœ€çš„ï¼Œä½†ä¸èƒ½æ³¨å…¥åˆ°è¿™ä¸ªç‰¹å®šçš„ List ä¸­ï¼Œé‚£ä¹ˆä½ å°±å¿…é¡»ä½¿ç”¨ä¸Šè¿°çš„ &lt;code&gt;@Qualifier&lt;/code&gt;æˆ– &lt;code&gt;@Resource&lt;/code&gt;æ–¹æ³•æ¥è¿›è¡Œç²¾ç¡®æ³¨å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ ¸å¿ƒè¦ç‚¹"&gt;ğŸ’ æ ¸å¿ƒè¦ç‚¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜æ ¹æº&lt;/strong&gt;ï¼šSpring çš„ &lt;code&gt;@Autowired&lt;/code&gt;å¯¹é›†åˆçš„é»˜è®¤è¡Œä¸ºæ˜¯â€œæ”¶é›†æ‰€æœ‰ç›¸åŒç±»å‹çš„ Beanâ€ï¼Œè€Œä¸æ˜¯â€œæŒ‰åç§°æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„é›†åˆ Beanâ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³å…³é”®&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Qualifier&lt;/code&gt;æˆ– &lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£ï¼Œå°†æ³¨å…¥ç­–ç•¥ä»â€œæŒ‰ç±»å‹æ”¶é›†â€è½¬å˜ä¸ºâ€œæŒ‰åç§°æŸ¥æ‰¾â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£&lt;/strong&gt;é€šå¸¸æ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒè¯­ä¹‰æ˜ç¡®ï¼Œæ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºå¤„ç†è¿™ç§æ­§ä¹‰çš„æ ‡å‡†æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›æ–¹æ³•èƒ½å¸®åŠ©ä½ è§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="runnablefuture--completablefuture"&gt;RunnableFuture &amp;amp; CompletableFuture
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ &lt;code&gt;RunnableFuture&lt;/code&gt;å’Œ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„åŒºåˆ«å’Œè”ç³»ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°æ ¹æ®ä»»åŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚å·¥å…·ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;RunnableFuture (ä»¥FutureTaskä¸ºä»£è¡¨)&lt;/th&gt;
&lt;th&gt;CompletableFuture&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¥å£ï¼Œä¸»è¦å®ç°ç±»æ˜¯ &lt;code&gt;FutureTask&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…·ä½“çš„ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å°† &lt;code&gt;Runnable&lt;/code&gt;æˆ– &lt;code&gt;Callable&lt;/code&gt;ä»»åŠ¡åŒ…è£…ä¸ºå¯å¼‚æ­¥æ‰§è¡Œä¸”å¯è·å–ç»“æœçš„ &lt;code&gt;Future&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¼ºå¤§çš„&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡ç¼–æ’&lt;/strong&gt;èƒ½åŠ›ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ã€ç»„åˆå¤šä¸ªä»»åŠ¡ã€å¼‚å¸¸å¤„ç†ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼±ã€‚é€šå¸¸éœ€è‡ªè¡Œç®¡ç†å¤šä¸ª &lt;code&gt;Future&lt;/code&gt;çš„ä¾èµ–å’Œç»“æœè·å–&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æå…¶å¼ºå¤§&lt;/strong&gt;ã€‚æä¾› &lt;code&gt;thenApply&lt;/code&gt;/&lt;code&gt;thenAccept&lt;/code&gt;/&lt;code&gt;thenRun&lt;/code&gt;, &lt;code&gt;thenCompose&lt;/code&gt;, &lt;code&gt;thenCombine&lt;/code&gt;, &lt;code&gt;allOf&lt;/code&gt;/&lt;code&gt;anyOf&lt;/code&gt;ç­‰æ–¹æ³•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»“æœè·å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é˜»å¡å¼&lt;/strong&gt;ã€‚é€šè¿‡ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ï¼Œä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;éé˜»å¡å›è°ƒ&lt;/strong&gt;ã€‚å¯é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†ç»“æœï¼Œä¹Ÿæ”¯æŒé˜»å¡å¼çš„ &lt;code&gt;get()&lt;/code&gt;å’Œ &lt;code&gt;join()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ä¼šæŠ›å‡º &lt;code&gt;ExecutionException&lt;/code&gt;ï¼Œéœ€è‡ªè¡Œæ•è·å¤„ç†&lt;/td&gt;
&lt;td&gt;æä¾› &lt;code&gt;exceptionally&lt;/code&gt;, &lt;code&gt;handle&lt;/code&gt;, &lt;code&gt;whenComplete&lt;/code&gt;ç­‰æ–¹æ³•ï¼Œæ”¯æŒåœ¨å›è°ƒé“¾ä¸­ä¼˜é›…å¤„ç†å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚æ­¥æ‰§è¡Œæ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ä¾èµ– &lt;code&gt;ExecutorService&lt;/code&gt;æäº¤æ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;æä¾› &lt;code&gt;supplyAsync&lt;/code&gt;, &lt;code&gt;runAsync&lt;/code&gt;ç­‰é™æ€æ–¹æ³•ï¼Œå¯ç›´æ¥æäº¤å¼‚æ­¥ä»»åŠ¡ï¼ˆå¯æŒ‡å®šæˆ–ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç†å¿µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸ºä¸€ä¸ª&lt;strong&gt;å•ä¸€ä»»åŠ¡&lt;/strong&gt;æä¾›åŸºæœ¬å¼‚æ­¥æ‰§è¡Œå’Œç»“æœè·å–èƒ½åŠ›&lt;/td&gt;
&lt;td&gt;ä¸º&lt;strong&gt;å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„åä½œã€ç»„åˆå’Œç¼–æ’&lt;/strong&gt;è€Œè®¾è®¡ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒè”ç³»"&gt;ğŸ§© æ ¸å¿ƒè”ç³»
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å­˜åœ¨ä¸Šè¿°å·®å¼‚ï¼Œä½†ä¸¤è€…éƒ½è‡´åŠ›äºå®ç°å¼‚æ­¥è®¡ç®—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±åŒåŸºç¡€&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture&lt;/code&gt;å®ç°äº† &lt;code&gt;Future&lt;/code&gt;æ¥å£ï¼Œè€Œ &lt;code&gt;RunnableFuture&lt;/code&gt;ç»§æ‰¿è‡ª &lt;code&gt;Future&lt;/code&gt;ã€‚å› æ­¤ï¼Œ&lt;code&gt;CompletableFuture&lt;/code&gt;ä¹Ÿå…·å¤‡ &lt;code&gt;Future&lt;/code&gt;å®šä¹‰çš„åŸºæœ¬èƒ½åŠ›ï¼Œå¦‚åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆã€å–æ¶ˆä»»åŠ¡ä»¥åŠé€šè¿‡ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•é˜»å¡è·å–ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›®æ ‡ä¸€è‡´&lt;/strong&gt;ï¼šå®ƒä»¬éƒ½ç”¨äºå°†ä»»åŠ¡æäº¤åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼Œæé«˜ç¨‹åºå“åº”æ€§å’Œèµ„æºåˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-3"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å–å†³äºä½ çš„å…·ä½“åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;RunnableFuture&lt;/code&gt;(ä¸»è¦æ˜¯ &lt;code&gt;FutureTask&lt;/code&gt;) å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦ä¸€ä¸ª&lt;strong&gt;ç®€å•ã€å¯æ§&lt;/strong&gt;çš„æœºåˆ¶æ¥æ‰§è¡Œå•ä¸ªå¼‚æ­¥ä»»åŠ¡å¹¶è·å–å…¶ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;ä½ çš„ä»»åŠ¡é€»è¾‘ç›¸å¯¹&lt;strong&gt;ç‹¬ç«‹&lt;/strong&gt;ï¼Œä¸æ¶‰åŠå¤æ‚çš„åç»­ä¾èµ–æˆ–ç»„åˆæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;ä½ æ„¿æ„&lt;strong&gt;è‡ªè¡Œç®¡ç†&lt;/strong&gt;çº¿ç¨‹æ± å’Œä»»åŠ¡çš„æäº¤ã€‚&lt;/li&gt;
&lt;li&gt;ä½ ä¸éœ€è¦å¤æ‚çš„&lt;strong&gt;é“¾å¼å›è°ƒ&lt;/strong&gt;æˆ–&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;CompletableFuture&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦å¤„ç†&lt;strong&gt;å¤šä¸ªå¼‚æ­¥ä»»åŠ¡&lt;/strong&gt;ï¼Œå¹¶ä¸”è¿™äº›ä»»åŠ¡ä¹‹é—´å­˜åœ¨&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼ˆä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ªä»»åŠ¡çš„è¾“å…¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ æƒ³è¦&lt;strong&gt;ç»„åˆå¤šä¸ªä»»åŠ¡&lt;/strong&gt;çš„ç»“æœï¼ˆä¾‹å¦‚ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œæˆ–ç­‰å¾…å…¶ä¸­ä¸€ä¸ªå®Œæˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å¸Œæœ›ä½¿ç”¨&lt;strong&gt;éé˜»å¡çš„å›è°ƒ&lt;/strong&gt;æ–¹å¼å¤„ç†ä»»åŠ¡ç»“æœï¼Œè€Œä¸æ˜¯æ€»æ˜¯è°ƒç”¨é˜»å¡çš„ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å¸Œæœ›æœ‰&lt;strong&gt;æ›´å¼ºå¤§å’Œä¼˜é›…çš„å¼‚å¸¸å¤„ç†&lt;/strong&gt;æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨æ•´ä¸ªå¼‚æ­¥é“¾ä¸­ä¼ æ’­å’Œå¤„ç†å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;ä½ æ­£åœ¨å°è¯•ä»¥&lt;strong&gt;å‡½æ•°å¼ç¼–ç¨‹&lt;/strong&gt;çš„é£æ ¼ç¼–å†™å¼‚æ­¥ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œ&lt;code&gt;RunnableFuture&lt;/code&gt;ï¼ˆåŠå…¶å¸¸è§å®ç° &lt;code&gt;FutureTask&lt;/code&gt;ï¼‰æ˜¯&lt;strong&gt;åŸºç¡€çš„å·¥å…·&lt;/strong&gt;ï¼Œæä¾›äº†å¼‚æ­¥æ‰§è¡Œçš„åŸºæœ¬éª¨æ¶ï¼›è€Œ &lt;code&gt;CompletableFuture&lt;/code&gt;åˆ™æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºçš„&lt;strong&gt;é«˜é˜¶å·¥å…·&lt;/strong&gt;ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œè¯­æ³•ç³–ï¼Œè®©å¤æ‚çš„å¼‚æ­¥ç¼–ç¨‹å˜å¾—æ›´ä¸ºç®€æ´å’Œå¼ºå¤§ã€‚&lt;/p&gt;
&lt;h2 id="executorservicesubmit--completablefuturerunasync"&gt;ExecutorService.submit &amp;amp; CompletableFuture.runAsync
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ &lt;code&gt;CompletableFuture.runAsync()&lt;/code&gt;å’Œ &lt;code&gt;ExecutorService.submit()&lt;/code&gt;çš„åŒºåˆ«ä¸è”ç³»ï¼Œèƒ½å¸®åŠ©ä½ åœ¨ä¸åŒåœºæ™¯ä¸‹åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œè®©ä½ å¿«é€ŸæŠŠæ¡å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ExecutorService.submit()&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;CompletableFuture.runAsync()&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒå®šä½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹æ± ç®¡ç†&lt;/strong&gt;ï¼Œæä¾›åŸºç¡€å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œèƒ½åŠ›&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡ç¼–æ’&lt;/strong&gt;ï¼Œæä¾›å¼ºå¤§çš„é“¾å¼è°ƒç”¨ã€ç»„åˆå’Œå›è°ƒæœºåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Future&amp;lt;?&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯æäº¤ &lt;code&gt;Runnable&lt;/code&gt;æˆ– &lt;code&gt;Callable&lt;/code&gt;ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;ä¸»è¦æäº¤ &lt;code&gt;Runnable&lt;/code&gt;ä»»åŠ¡ï¼ˆæ— è¿”å›å€¼ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»“æœè·å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é˜»å¡å¼&lt;/strong&gt;ã€‚é€šè¿‡ &lt;code&gt;Future.get()&lt;/code&gt;è·å–ï¼Œä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;éé˜»å¡å›è°ƒ&lt;/strong&gt;ã€‚å¯é€šè¿‡ &lt;code&gt;thenRun()&lt;/code&gt;, &lt;code&gt;thenAccept()&lt;/code&gt;ç­‰å›è°ƒå¤„ç†ï¼Œä¹Ÿæ”¯æŒé˜»å¡å¼çš„ &lt;code&gt;join()&lt;/code&gt;æˆ– &lt;code&gt;get()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼±ã€‚éœ€è‡ªè¡Œç®¡ç†å¤šä¸ª &lt;code&gt;Future&lt;/code&gt;çš„ä¾èµ–å…³ç³»&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼ºå¤§&lt;/strong&gt;ã€‚æä¾› &lt;code&gt;thenApply&lt;/code&gt;/&lt;code&gt;thenAccept&lt;/code&gt;/&lt;code&gt;thenRun&lt;/code&gt;, &lt;code&gt;thenCompose&lt;/code&gt;, &lt;code&gt;thenCombine&lt;/code&gt;, &lt;code&gt;allOf&lt;/code&gt;/&lt;code&gt;anyOf&lt;/code&gt;ç­‰æ–¹æ³•è¿›è¡Œçµæ´»ç»„åˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Future.get()&lt;/code&gt;ä¼šæŠ›å‡º &lt;code&gt;ExecutionException&lt;/code&gt;ï¼Œéœ€è‡ªè¡Œæ•è·å¤„ç†&lt;/td&gt;
&lt;td&gt;æä¾› &lt;code&gt;exceptionally&lt;/code&gt;, &lt;code&gt;handle&lt;/code&gt;, &lt;code&gt;whenComplete&lt;/code&gt;ç­‰æ–¹æ³•ï¼Œæ”¯æŒåœ¨å›è°ƒé“¾ä¸­ä¼˜é›…å¤„ç†å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤çº¿ç¨‹æ± &lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ˜¾å¼åˆ›å»ºï¼ˆå¦‚ &lt;code&gt;FixedThreadPool&lt;/code&gt;, &lt;code&gt;CachedThreadPool&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;è‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç†å¿µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´å…³æ³¨&lt;strong&gt;ä»»åŠ¡çš„æ‰§è¡Œå’Œçº¿ç¨‹èµ„æºçš„ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´å…³æ³¨&lt;strong&gt;ä»»åŠ¡å®Œæˆåçš„åç»­æ“ä½œã€ä»»åŠ¡ä¹‹é—´çš„ç»„åˆä¸ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å®ƒä»¬çš„è”ç³»"&gt;ğŸ”— å®ƒä»¬çš„è”ç³»
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å­˜åœ¨ä¸Šè¿°åŒºåˆ«ï¼Œä½†ä¸¤è€…éƒ½ç”¨äºå®ç°å¼‚æ­¥è®¡ç®—ï¼Œå¹¶ä¸”å¯ä»¥ååŒå·¥ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…±åŒç›®æ ‡&lt;/strong&gt;ï¼šéƒ½æ˜¯ç”¨æ¥&lt;strong&gt;å¼‚æ­¥æ‰§è¡Œä»»åŠ¡&lt;/strong&gt;ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½è¡”æ¥&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture.runAsync(Runnable runnable, Executor executor)&lt;/code&gt;æ–¹æ³•å¯ä»¥&lt;strong&gt;æ¥æ”¶ä¸€ä¸ª &lt;code&gt;ExecutorService&lt;/code&gt;ä½œä¸ºå‚æ•°&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;ExecutorService&lt;/code&gt;æ¥ç®¡ç†çº¿ç¨‹æ± èµ„æºï¼ŒåŒæ—¶äº«å— &lt;code&gt;CompletableFuture&lt;/code&gt;å¼ºå¤§çš„å¼‚æ­¥ç¼–æ’èƒ½åŠ›ã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»„åˆæ–¹å¼ï¼Œå…¼é¡¾äº†çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-4"&gt;ğŸ¯ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;ExecutorService.submit()&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦&lt;strong&gt;ç²¾ç»†æ§åˆ¶çº¿ç¨‹æ± &lt;/strong&gt;ï¼ˆå¤§å°ã€ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ&lt;strong&gt;ç®€å•çš„ã€ç‹¬ç«‹çš„&lt;/strong&gt;å¼‚æ­¥ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦æäº¤&lt;strong&gt;æœ‰è¿”å›å€¼çš„ &lt;code&gt;Callable&lt;/code&gt;ä»»åŠ¡&lt;/strong&gt;ï¼ˆè™½ç„¶ &lt;code&gt;CompletableFuture.supplyAsync&lt;/code&gt;æ›´æ“…é•¿å¤„ç†å¸¦è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ç¼–æ’ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¡¹ç›®åŸºäºæ—§ç‰ˆ Javaï¼ˆ&amp;lt; 8ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;CompletableFuture.runAsync()&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦&lt;strong&gt;æ„å»ºå¤æ‚çš„å¼‚æ­¥ä»»åŠ¡é“¾&lt;/strong&gt;ï¼Œä¸€ä¸ªä»»åŠ¡çš„å®Œæˆè§¦å‘ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;ç»„åˆå¤šä¸ªå¼‚æ­¥æ“ä½œ&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¸Œæœ›ä½¿ç”¨&lt;strong&gt;éé˜»å¡çš„å›è°ƒ&lt;/strong&gt;å¤„ç†ä»»åŠ¡ç»“æœï¼Œé¿å…çº¿ç¨‹ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;æƒ³è¦&lt;strong&gt;æ›´ä¼˜é›…ã€å‡½æ•°å¼çš„å¼‚å¸¸å¤„ç†&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Java 8+ï¼Œå¹¶ä¸”ä»£ç å¯è¯»æ€§å’Œç®€æ´æ€§æ˜¯é‡è¦è€ƒè™‘å› ç´ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•æ¥è¯´ï¼š&lt;/strong&gt; å¦‚æœä½ åªæ˜¯éœ€è¦ä¸€ä¸ªå·¥äººï¼ˆçº¿ç¨‹ï¼‰å»å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Œç”¨ &lt;code&gt;ExecutorService.submit&lt;/code&gt;ã€‚å¦‚æœä½ ä¸ä»…éœ€è¦å·¥äººå®Œæˆä»»åŠ¡ï¼Œè¿˜å¸Œæœ›ä»–å®Œæˆåèƒ½è‡ªåŠ¨é€šçŸ¥ä½ ã€ç»§ç»­åšå…¶ä»–æŒ‡å®šå·¥ä½œã€æˆ–è€…å’Œå…¶ä»–å·¥äººåä½œï¼Œç”¨ &lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;æˆ– &lt;code&gt;supplyAsync&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-3"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç®¡ç†&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;ExecutorService&lt;/code&gt;åï¼Œè®°å¾—åœ¨é€‚å½“æ—¶å€™è°ƒç”¨ &lt;code&gt;shutdown()&lt;/code&gt;æ¥å…³é—­çº¿ç¨‹æ± ï¼Œé¿å…èµ„æºæ³„æ¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡ä¸éé˜»å¡&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture&lt;/code&gt;çš„ &lt;code&gt;get()&lt;/code&gt;å’Œ &lt;code&gt;join()&lt;/code&gt;æ–¹æ³•ä¹Ÿæ˜¯é˜»å¡çš„ã€‚å……åˆ†å‘æŒ¥ &lt;code&gt;CompletableFuture&lt;/code&gt;ä¼˜åŠ¿çš„å…³é”®åœ¨äº&lt;strong&gt;ä½¿ç”¨å…¶å›è°ƒæ–¹æ³•&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;thenAccept&lt;/code&gt;ï¼‰è¿›è¡Œéé˜»å¡å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;Future.get()&lt;/code&gt;æ—¶è¦æ³¨æ„å¤„ç† &lt;code&gt;ExecutionException&lt;/code&gt;ï¼›ä½¿ç”¨ &lt;code&gt;CompletableFuture&lt;/code&gt;æ—¶ï¼Œå»ºè®®åœ¨é“¾ä¸­æ·»åŠ  &lt;code&gt;exceptionally&lt;/code&gt;æˆ– &lt;code&gt;handle&lt;/code&gt;ç­‰æ–¹æ³•ä»¥å¦¥å–„å¤„ç†å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ ¹æ®å…·ä½“åœºæ™¯åšå‡ºæœ€ä½³é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="completablefutureçš„-getå’Œ-join"&gt;CompletableFutureçš„ get()å’Œ join()
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„ &lt;code&gt;get()&lt;/code&gt;å’Œ &lt;code&gt;join()&lt;/code&gt;æ–¹æ³•çš„åŒºåˆ«ï¼Œå¯¹äºç¼–å†™æ­£ç¡®ã€é«˜æ•ˆçš„å¼‚æ­¥ä»£ç å¾ˆé‡è¦ã€‚å®ƒä»¬æ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;å’Œ&lt;strong&gt;å—æ£€å¼‚å¸¸&lt;/strong&gt;çš„è¦æ±‚ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;get()&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;join()&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŠ›å‡º &lt;strong&gt;&lt;code&gt;ExecutionException&lt;/code&gt;&lt;/strong&gt;ï¼ˆåŒ…è£…åŸå§‹å¼‚å¸¸ï¼‰å’Œ &lt;strong&gt;&lt;code&gt;InterruptedException&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŠ›å‡º &lt;strong&gt;&lt;code&gt;CompletionException&lt;/code&gt;&lt;/strong&gt;ï¼ˆåŒ…è£…åŸå§‹å¼‚å¸¸ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å—æ£€å¼‚å¸¸&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt;ã€‚å¿…é¡»æ˜¾å¼æ•è·æˆ–å£°æ˜æŠ›å‡º &lt;code&gt;InterruptedException&lt;/code&gt;, &lt;code&gt;ExecutionException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;ã€‚æŠ›å‡ºçš„æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ (&lt;code&gt;CompletionException&lt;/code&gt;)ï¼Œæ— éœ€å¼ºåˆ¶å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ”¯æŒ&lt;/strong&gt;ã€‚æä¾› &lt;code&gt;get(long timeout, TimeUnit unit)&lt;/code&gt;é‡è½½æ–¹æ³•&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸­æ–­å“åº”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt;ã€‚ç­‰å¾…è¿‡ç¨‹ä¸­çº¿ç¨‹è¢«ä¸­æ–­ä¼šæŠ›å‡º &lt;code&gt;InterruptedException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;ã€‚ä¸ç›´æ¥å“åº”ä¸­æ–­ï¼Œè€Œæ˜¯åŒ…è£…è¿› &lt;code&gt;CompletionException&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦&lt;strong&gt;ç²¾ç»†æ§åˆ¶å¼‚å¸¸&lt;/strong&gt;æˆ–&lt;strong&gt;è®¾ç½®è¶…æ—¶&lt;/strong&gt;çš„åœºæ™¯&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;ä¼˜å…ˆï¼Œå¸¸ç”¨äº &lt;code&gt;CompletableFuture&lt;/code&gt;&lt;strong&gt;é“¾å¼è°ƒç”¨&lt;/strong&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä¸»è¦åŒºåˆ«è¯´æ˜"&gt;ğŸ“Œ ä¸»è¦åŒºåˆ«è¯´æ˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†ä¸å—æ£€å¼‚å¸¸&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ä¼šæŠ›å‡ºå—æ£€å¼‚å¸¸ &lt;code&gt;ExecutionException&lt;/code&gt;ï¼ˆå½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ï¼‰å’Œ &lt;code&gt;InterruptedException&lt;/code&gt;ï¼ˆå½“çº¿ç¨‹åœ¨ç­‰å¾…ç»“æœæ—¶è¢«ä¸­æ–­æ—¶ï¼‰ã€‚ä½ å¿…é¡»ä½¿ç”¨ &lt;code&gt;try-catch&lt;/code&gt;åŒ…å›´æˆ–æ˜¯åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜æŠ›å‡ºè¿™äº›å¼‚å¸¸ï¼Œå¦åˆ™ä»£ç æ— æ³•ç¼–è¯‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;join()&lt;/code&gt;æ–¹æ³•åœ¨ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸æ—¶ä¼šæŠ›å‡ºéå—æ£€çš„ &lt;code&gt;CompletionException&lt;/code&gt;ã€‚è¿™æ„å‘³ç€ä½ &lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;åœ¨ä»£ç ä¸­å¼ºåˆ¶å¤„ç†å®ƒï¼Œä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥é€‰æ‹©æ•è·å®ƒä»¥è·å¾—æ›´å¥å£®çš„ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•æä¾›äº†ä¸€ä¸ªé‡è½½ç‰ˆæœ¬ &lt;code&gt;get(long timeout, TimeUnit unit)&lt;/code&gt;ï¼Œå…è®¸ä½ è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ— é™æœŸé˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;join()&lt;/code&gt;æ–¹æ³•&lt;strong&gt;æ²¡æœ‰&lt;/strong&gt;æä¾›è¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨å®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä»£ç ç¤ºä¾‹-1"&gt;ğŸ–¥ï¸ ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸¤è€…åœ¨å¼‚å¸¸å¤„ç†å’Œä»£ç ç¼–å†™ä¸Šçš„ä¸åŒï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
public class GetVsJoinExample {
public static void main(String[] args) {
// æ¨¡æ‹Ÿä¸€ä¸ªä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡
CompletableFuture&amp;lt;String&amp;gt; faultyFuture = CompletableFuture.supplyAsync(() -&amp;gt; {
throw new RuntimeException(&amp;#34;Something went wrong!&amp;#34;);
});
// ä½¿ç”¨ get() - å¿…é¡»å¤„ç†å—æ£€å¼‚å¸¸
try {
String resultGet = faultyFuture.get();
System.out.println(&amp;#34;Result with get: &amp;#34; + resultGet);
} catch (InterruptedException | ExecutionException e) {
// ExecutionException åŒ…è£¹äº†åŸå§‹çš„ RuntimeException
System.out.println(&amp;#34;Exception with get: &amp;#34; + e.getCause().getMessage());
}
// ä½¿ç”¨ join() - æ— éœ€å¤„ç†å—æ£€å¼‚å¸¸ï¼Œä½†ä¹Ÿå¯é€‰æ‹©æ•è·
try {
String resultJoin = faultyFuture.join();
System.out.println(&amp;#34;Result with join: &amp;#34; + resultJoin);
} catch (Exception e) { // é€šå¸¸æ•è·çš„æ˜¯ CompletionException
System.out.println(&amp;#34;Exception with join: &amp;#34; + e.getCause().getMessage());
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;è¾“å‡ºç±»ä¼¼ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Exception with get: Something went wrong!
Exception with join: Something went wrong!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;join()&lt;/code&gt;çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ä¸€äº›ã€‚&lt;/p&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-5"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½•æ—¶ä½¿ç”¨ &lt;code&gt;get()&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å½“ä½ éœ€è¦ä¸ºè·å–ç»“æœ&lt;strong&gt;è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/strong&gt;ï¼Œé˜²æ­¢æ— é™æœŸç­‰å¾…æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ éœ€è¦&lt;strong&gt;ç²¾ç»†åœ°åŒºåˆ†å’Œå¤„ç†&lt;/strong&gt;ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼ˆå¦‚ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ &lt;code&gt;ExecutionException&lt;/code&gt;å’Œçº¿ç¨‹ä¸­æ–­å¼‚å¸¸ &lt;code&gt;InterruptedException&lt;/code&gt;ï¼‰æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½•æ—¶ä½¿ç”¨ &lt;code&gt;join()&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å½“ä½ è¿½æ±‚&lt;strong&gt;ä»£ç çš„ç®€æ´æ€§&lt;/strong&gt;ï¼Œä¸å¸Œæœ›ç¼–å†™å¤§é‡çš„ &lt;code&gt;try-catch&lt;/code&gt;å—æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ åœ¨ &lt;strong&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;é“¾å¼è°ƒç”¨&lt;/strong&gt;çš„æœ«ç«¯ï¼ˆä¾‹å¦‚ç»“åˆ &lt;code&gt;allOf&lt;/code&gt;åä½¿ç”¨ &lt;code&gt;join&lt;/code&gt;ï¼‰è·å–æœ€ç»ˆç»“æœæ—¶ï¼Œè¿™æ˜¯éå¸¸å¸¸è§çš„ç”¨æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-4"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡æ€§&lt;/strong&gt;ï¼šæ— è®ºæ˜¯ &lt;code&gt;get()&lt;/code&gt;è¿˜æ˜¯ &lt;code&gt;join()&lt;/code&gt;ï¼Œå®ƒä»¬éƒ½æ˜¯&lt;strong&gt;é˜»å¡&lt;/strong&gt;æ–¹æ³•ã€‚è°ƒç”¨å®ƒä»¬ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼ˆæˆ–è¶…æ—¶/ä¸­æ–­ï¼‰ã€‚è™½ç„¶ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„å¼ºå¤§åœ¨äºå…¶éé˜»å¡çš„å›è°ƒï¼ˆå¦‚ &lt;code&gt;thenApply&lt;/code&gt;, &lt;code&gt;thenAccept&lt;/code&gt;ï¼‰ï¼Œä½†æœ€ç»ˆè·å–ç»“æœå¾€å¾€ä»éœ€é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸æ¢æŸ¥&lt;/strong&gt;ï¼šæ— è®ºé€‰æ‹©å“ªä¸ªæ–¹æ³•ï¼Œå¦‚æœå¼‚æ­¥ä»»åŠ¡ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡ &lt;code&gt;Throwable.getCause()&lt;/code&gt;æ–¹æ³•æ¥è·å–æœ€åŸå§‹çš„å¼‚å¸¸ä¿¡æ¯ï¼Œè¿™å¯¹äºè°ƒè¯•è‡³å…³é‡è¦ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id="supplyasync-å’Œ-runasync"&gt;supplyAsync å’Œ runAsync
&lt;/h2&gt;&lt;p&gt;äº†è§£ &lt;code&gt;supplyAsync&lt;/code&gt;å’Œ &lt;code&gt;runAsync&lt;/code&gt;çš„åŒºåˆ«å¯¹äºç¼–å†™æ­£ç¡®çš„å¼‚æ­¥ä»£ç å¾ˆé‡è¦ã€‚å®ƒä»¬æ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;æ˜¯å¦éœ€è¦è¿”å›ç»“æœ&lt;/strong&gt;ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;supplyAsync&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;runAsync&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›å€¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿”å› &lt;code&gt;CompletableFuture&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œæºå¸¦è®¡ç®—ç»“æœ&lt;/td&gt;
&lt;td&gt;è¿”å› &lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt;ï¼Œ&lt;strong&gt;æ— è®¡ç®—ç»“æœ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‚æ•°æ¥å£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¥å— &lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªç»“æœ&lt;/td&gt;
&lt;td&gt;æ¥å— &lt;code&gt;Runnable&lt;/code&gt;ï¼Œæ‰§è¡Œæ“ä½œï¼Œ&lt;strong&gt;æ— è¿”å›&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤çº¿ç¨‹æ± &lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“æŸ¥è¯¢ã€è¿œç¨‹è°ƒç”¨ã€è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç­‰&lt;strong&gt;éœ€è¦ç»“æœ&lt;/strong&gt;çš„æ“ä½œ&lt;/td&gt;
&lt;td&gt;è®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ã€æ¸…ç†èµ„æºç­‰&lt;strong&gt;æ— éœ€ç»“æœ&lt;/strong&gt;çš„è¾…åŠ©æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è¯¦ç»†è¯´æ˜"&gt;ğŸ’¡ è¯¦ç»†è¯´æ˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿”å›å€¼ (Return Value)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;supplyAsync&lt;/code&gt;ç”¨äºæ‰§è¡Œ&lt;strong&gt;æœ‰è¿”å›å€¼&lt;/strong&gt;çš„å¼‚æ­¥ä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ª &lt;code&gt;CompletableFuture&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œæœªæ¥å¯ä»¥é€šè¿‡ &lt;code&gt;get()&lt;/code&gt;æˆ– &lt;code&gt;join()&lt;/code&gt;ç­‰æ–¹æ³•è·å–è®¡ç®—ç»“æœ &lt;code&gt;T&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;runAsync&lt;/code&gt;ç”¨äºæ‰§è¡Œ&lt;strong&gt;æ²¡æœ‰è¿”å›å€¼&lt;/strong&gt;çš„å¼‚æ­¥ä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ª &lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt;ã€‚å®ƒåªè¡¨ç¤ºä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè€Œä¸å…³å¿ƒå…·ä½“ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•° (Parameter)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;supplyAsync&lt;/code&gt;æ¥æ”¶ä¸€ä¸ª &lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;å‡½æ•°å¼æ¥å£ï¼Œå…¶ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªç»“æœ &lt;code&gt;T&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;runAsync&lt;/code&gt;æ¥æ”¶ä¸€ä¸ª &lt;code&gt;Runnable&lt;/code&gt;å‡½æ•°å¼æ¥å£ï¼Œå…¶ &lt;code&gt;run()&lt;/code&gt;æ–¹æ³•æ‰§è¡Œæ“ä½œï¼Œä½†ä¸è¿”å›ä»»ä½•ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ±  (Thread Pool)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤è€…éƒ½æä¾›äº†é‡è½½æ–¹æ³•ï¼Œå…è®¸ä½ é€‰æ‹©ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;æˆ–æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ &lt;code&gt;Executor&lt;/code&gt;ã€‚&lt;strong&gt;å¼ºçƒˆå»ºè®®&lt;/strong&gt;ä¸ºä¸åŒçš„ä¸šåŠ¡ç±»å‹ï¼ˆå¦‚IOå¯†é›†å‹ã€è®¡ç®—å¯†é›†å‹ï¼‰æŒ‡å®šä¸åŒçš„è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä»¥å®ç°èµ„æºéš”ç¦»å’Œé¿å…ç›¸äº’å½±å“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç† (Exception Handling)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;supplyAsync&lt;/code&gt;ï¼Œä»»åŠ¡ä¸­æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«æ•è·å¹¶åŒ…è£…åœ¨ &lt;code&gt;CompletableFuture&lt;/code&gt;ä¸­ï¼Œè°ƒç”¨ &lt;code&gt;get()&lt;/code&gt;æ—¶ä¼šæŠ›å‡º &lt;code&gt;ExecutionException&lt;/code&gt;ï¼Œä½ å¯ä»¥é€šè¿‡ &lt;code&gt;exceptionally&lt;/code&gt;ã€&lt;code&gt;handle&lt;/code&gt;æˆ– &lt;code&gt;whenComplete&lt;/code&gt;ç­‰æ–¹æ³•åœ¨é“¾ä¸­å¤„ç†è¿™äº›å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;runAsync&lt;/code&gt;ï¼Œå¦‚æœä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ä¸”&lt;strong&gt;æ²¡æœ‰&lt;/strong&gt;ä½¿ç”¨ &lt;code&gt;whenComplete&lt;/code&gt;æˆ– &lt;code&gt;handle&lt;/code&gt;ç­‰æ–¹æ³•æ¥æ˜¾å¼å¤„ç†ï¼Œå¼‚å¸¸å¯èƒ½ä¼šè¢«â€œé™é»˜åå™¬â€ï¼Œè¿™ä¼šå¯¼è‡´è°ƒè¯•å›°éš¾ã€‚å› æ­¤ï¼ŒåŠ¡å¿…ä¸º &lt;code&gt;runAsync&lt;/code&gt;æ·»åŠ å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä»£ç ç¤ºä¾‹-2"&gt;ğŸ–¥ï¸ ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
public class SupplyAsyncVsRunAsync {
// æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„æœåŠ¡
static class MyService {
// ä¸€ä¸ªæœ‰è¿”å›å€¼çš„ä»»åŠ¡
String fetchData() {
try {
Thread.sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
} catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
return &amp;#34;Data from server&amp;#34;;
}
// ä¸€ä¸ªæ— è¿”å›å€¼çš„ä»»åŠ¡
void logEvent(String event) {
try {
Thread.sleep(500); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
} catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
System.out.println(&amp;#34;Event logged: &amp;#34; + event);
}
}
public static void main(String[] args) throws ExecutionException, InterruptedException {
MyService service = new MyService();
// ä½¿ç”¨ supplyAsync æ‰§è¡Œæœ‰è¿”å›å€¼çš„ä»»åŠ¡
CompletableFuture&amp;lt;String&amp;gt; dataFuture = CompletableFuture.supplyAsync(() -&amp;gt; service.fetchData());
String result = dataFuture.get(); // é˜»å¡ç­‰å¾…å¹¶è·å–ç»“æœ
System.out.println(&amp;#34;Result: &amp;#34; + result);
// ä½¿ç”¨ runAsync æ‰§è¡Œæ— è¿”å›å€¼çš„ä»»åŠ¡ï¼Œå¹¶æ·»åŠ å¼‚å¸¸å¤„ç†
CompletableFuture&amp;lt;Void&amp;gt; logFuture = CompletableFuture.runAsync(() -&amp;gt; service.logEvent(&amp;#34;User logged in&amp;#34;))
.whenComplete((v, ex) -&amp;gt; { // å¤„ç†å®Œæˆæˆ–å¼‚å¸¸
if (ex != null) {
System.err.println(&amp;#34;Logging failed: &amp;#34; + ex.getMessage());
} else {
System.out.println(&amp;#34;Logging completed successfully.&amp;#34;);
}
});
logFuture.join(); // ç­‰å¾…æ—¥å¿—ä»»åŠ¡å®Œæˆï¼ˆä½†ä¸å…³å¿ƒå…·ä½“ç»“æœï¼‰
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„äº‹é¡¹-5"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± &lt;/strong&gt;ï¼šé»˜è®¤çš„ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;é€‚ç”¨äºè½»é‡è®¡ç®—ä»»åŠ¡ã€‚å¯¹äºIOå¯†é›†å‹æˆ–ä¸ç¡®å®šè¡Œä¸ºçš„ä»»åŠ¡ï¼Œæœ€å¥½&lt;strong&gt;åˆ›å»ºä¸“ç”¨çš„çº¿ç¨‹æ± &lt;/strong&gt;ï¼Œé¿å…èµ„æºç«äº‰å’Œä¸Šä¸‹æ–‡æ±¡æŸ“é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å… runAsync é™é»˜å¤±è´¥&lt;/strong&gt;ï¼šåŠ¡å¿…ä¸º &lt;code&gt;runAsync&lt;/code&gt;æ·»åŠ  &lt;code&gt;whenComplete&lt;/code&gt;ã€&lt;code&gt;handle&lt;/code&gt;æˆ– &lt;code&gt;exceptionally&lt;/code&gt;ç­‰å¼‚å¸¸å¤„ç†å›è°ƒï¼Œé˜²æ­¢å¼‚å¸¸è¢«åå™¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt;ï¼šå¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œ&lt;code&gt;ThreadLocal&lt;/code&gt;ä¸Šä¸‹æ–‡ï¼ˆå¦‚MDCä¸­çš„traceIdï¼‰ä¼šä¸¢å¤±ã€‚éœ€è¦è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æˆ–TransmittableThreadLocalç­‰æ–¹æ¡ˆè§£å†³ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é€‰æ‹© &lt;code&gt;supplyAsync&lt;/code&gt;è¿˜æ˜¯ &lt;code&gt;runAsync&lt;/code&gt;ï¼Œä¸»è¦å–å†³äºä½ çš„ä»»åŠ¡æ˜¯å¦éœ€è¦è¿”å›ä¸€ä¸ªç»“æœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ç»“æœï¼Œç”¨ &lt;code&gt;supplyAsync(Supplier&amp;lt;T&amp;gt;)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦ç»“æœï¼Œç”¨ &lt;code&gt;runAsync(Runnable)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ— è®ºé€‰æ‹©å“ªä¸ªï¼Œéƒ½å»ºè®®&lt;strong&gt;æŒ‡å®šåˆé€‚çš„è‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/strong&gt;å¹¶&lt;strong&gt;åšå¥½å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼Œè¿™æ ·æ‰èƒ½æ„å»ºå‡ºå¥å£®çš„å¼‚æ­¥åº”ç”¨ã€‚&lt;/p&gt;
&lt;h2 id="å¼±å¼•ç”¨"&gt;å¼±å¼•ç”¨
&lt;/h2&gt;&lt;p&gt;å¦‚æœä½ å¯¹ &lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;è¿”å›çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡å»ºç«‹äº†å¼±å¼•ç”¨ï¼ˆ&lt;code&gt;WeakReference&lt;/code&gt;ï¼‰å¹¶åŠ å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œ&lt;strong&gt;è¿™ä¸ª &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡æœ¬èº«ä¸ä¼šå› ä¸ºä»»åŠ¡çš„å®Œæˆè€Œè‡ªåŠ¨ä»åˆ—è¡¨ä¸­æ¶ˆå¤±&lt;/strong&gt;ã€‚å®ƒæ˜¯å¦ä¼šä»åˆ—è¡¨ä¸­è¢«ç§»é™¤ï¼Œå–å†³äºä½ æ˜¯å¦ä¸»åŠ¨æ¸…ç†åˆ—è¡¨ä¸­çš„æ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ€»ç»“ä¸åŒæƒ…å†µä¸‹çš„è¡Œä¸ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;&lt;code&gt;WeakReference.get()&lt;/code&gt;è¿”å›å€¼&lt;/th&gt;
&lt;th&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡çŠ¶æ€&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€ä»åˆ—è¡¨ä¸­æ‰‹åŠ¨ç§»é™¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡å®Œæˆï¼Œä½†å­˜åœ¨å…¶ä»–å¼ºå¼•ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸ä¸º &lt;code&gt;null&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¯è¾¾ï¼Œæœªè¢« GC å›æ”¶&lt;/td&gt;
&lt;td&gt;æ˜¯ï¼ˆè‹¥éœ€ç®¡ç†åˆ—è¡¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡å®Œæˆï¼Œä¸”æ— å…¶ä»–å¼ºå¼•ç”¨&lt;/strong&gt;ï¼ˆä»…è¢« &lt;code&gt;WeakReference&lt;/code&gt;å¼•ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å˜ä¸º &lt;code&gt;null&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å·²è¢« GC å›æ”¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ï¼ˆåº”æ¸…ç†&lt;code&gt;get()&lt;/code&gt;è¿”å›&lt;code&gt;null&lt;/code&gt;çš„ &lt;code&gt;WeakReference&lt;/code&gt;æ¡ç›®ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡æœªå®Œæˆï¼Œä¸”æ— å…¶ä»–å¼ºå¼•ç”¨&lt;/strong&gt;ï¼ˆä»…è¢« &lt;code&gt;WeakReference&lt;/code&gt;å¼•ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;å¯èƒ½å˜ä¸º &lt;code&gt;null&lt;/code&gt;(éšæ—¶è¢«GC)&lt;/td&gt;
&lt;td&gt;å·²è¢« GC å›æ”¶ï¼Œä½†ä»»åŠ¡å¯èƒ½ä»åœ¨è¿è¡Œ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ï¼ˆåº”æ¸…ç†&lt;code&gt;get()&lt;/code&gt;è¿”å›&lt;code&gt;null&lt;/code&gt;çš„ &lt;code&gt;WeakReference&lt;/code&gt;æ¡ç›®ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ’¡ æ ¸å¿ƒåŸç†ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼±å¼•ç”¨çš„ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;code&gt;WeakReference&lt;/code&gt;ä¸ä¼šé˜»æ­¢å…¶æŒ‡å‘çš„å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ &lt;code&gt;CompletableFuture&lt;/code&gt;å®ä¾‹ï¼‰è¢«åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ã€‚å½“è¿™ä¸ª &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡&lt;strong&gt;æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æŒ‡å‘å®ƒ&lt;/strong&gt;æ—¶ï¼ŒGC å‘ç”Ÿæ—¶å®ƒå°±ä¼šè¢«å›æ”¶ ã€‚ä¹‹åï¼Œä½ çš„ &lt;code&gt;WeakReference.get()&lt;/code&gt;æ–¹æ³•å°†è¿”å› &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ—è¡¨çš„è¡Œä¸º&lt;/strong&gt;ï¼šä½ åˆ›å»ºçš„ &lt;code&gt;List&lt;/code&gt;ä¿å­˜çš„æ˜¯ &lt;code&gt;WeakReference&lt;/code&gt;å¯¹è±¡æœ¬èº«ï¼ˆè¿™äº›æ˜¯å¼ºå¼•ç”¨ï¼‰ã€‚&lt;code&gt;WeakReference&lt;/code&gt;å¯¹è±¡æœ¬èº«ä¸ä¼šè‡ªåŠ¨ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚å³ä½¿å®ƒæŒ‡å‘çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;è¢«å›æ”¶å¯¼è‡´ &lt;code&gt;get()&lt;/code&gt;è¿”å› &lt;code&gt;null&lt;/code&gt;ï¼Œè¿™ä¸ªâ€œç©ºå£³â€ &lt;code&gt;WeakReference&lt;/code&gt;å¯¹è±¡ä¾ç„¶ä¼šç•™åœ¨åˆ—è¡¨ä¸­ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡æ‰§è¡Œä¸GCå…³ç³»&lt;/strong&gt;ï¼šé‡è¦çš„æ˜¯ï¼Œ&lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡ä»£è¡¨çš„&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆ&lt;/strong&gt;ï¼Œä¸å…¶&lt;strong&gt;å¯¹è±¡æœ¬èº«æ˜¯å¦è¢«GCå›æ”¶æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µ&lt;/strong&gt; ã€‚ä»»åŠ¡ç”±çº¿ç¨‹æ± è°ƒåº¦æ‰§è¡Œï¼Œå³ä½¿ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡è¢«å›æ”¶ï¼Œå·²æäº¤çš„ä»»åŠ¡ä¸€èˆ¬ä»ä¼šç»§ç»­æ‰§è¡Œç›´è‡³å®Œæˆ ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•æ­£ç¡®ç®¡ç†åˆ—è¡¨"&gt;ğŸ› ï¸ å¦‚ä½•æ­£ç¡®ç®¡ç†åˆ—è¡¨
&lt;/h3&gt;&lt;p&gt;æ—¢ç„¶å¼±å¼•ç”¨æ¡ç›®ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä½ éœ€è¦æ‰‹åŠ¨ç®¡ç†è¿™ä¸ªåˆ—è¡¨ï¼Œé¿å…å®ƒæ— é™è†¨èƒ€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šæœŸæ¸…ç†&lt;/strong&gt;ï¼šå®šæœŸéå†è¿™ä¸ª &lt;code&gt;List&amp;lt;WeakReference&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&lt;/code&gt;ï¼Œè°ƒç”¨æ¯ä¸ª &lt;code&gt;WeakReference&lt;/code&gt;çš„ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ï¼Œå¦‚æœè¿”å› &lt;code&gt;null&lt;/code&gt;ï¼Œå°±å°†è¿™ä¸ª &lt;code&gt;WeakReference&lt;/code&gt;ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚è¿™å¯ä»¥é˜²æ­¢åˆ—è¡¨ç§¯ç´¯å¤§é‡æ— ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;ReferenceQueue&lt;/code&gt;ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šè¿™æ˜¯æ›´é«˜æ•ˆå’Œè‡ªåŠ¨åŒ–çš„æ–¹å¼ã€‚ä½ å¯ä»¥åœ¨åˆ›å»º &lt;code&gt;WeakReference&lt;/code&gt;æ—¶å…³è”ä¸€ä¸ª &lt;code&gt;ReferenceQueue&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ReferenceQueue&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; queue = new ReferenceQueue&amp;lt;&amp;gt;();
WeakReference&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; weakRef = new WeakReference&amp;lt;&amp;gt;(completableFuture, queue);
list.add(weakRef);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å½“ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡è¢« GC å›æ”¶åï¼Œå¯¹åº”çš„ &lt;code&gt;WeakReference&lt;/code&gt;ä¼šè¢«è‡ªåŠ¨åŠ å…¥åˆ°è¿™ä¸ª &lt;code&gt;queue&lt;/code&gt;ä¸­ã€‚ä½ å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è½®è¯¢æˆ–é˜»å¡è·å–è¿™ä¸ªé˜Ÿåˆ—ä¸­çš„å¼•ç”¨ï¼Œç„¶åä»ä½ çš„åˆ—è¡¨ä¸­ç§»é™¤å®ƒä»¬ï¼Œå®ç°è‡ªåŠ¨æ¸…ç† ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-6"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡å¯èƒ½è¢«æå‰å›æ”¶&lt;/strong&gt;ï¼šå³ä½¿å¼‚æ­¥ä»»åŠ¡è¿˜åœ¨è¿è¡Œï¼Œå¦‚æœä½ çš„ä»£ç å…¶ä»–åœ°æ–¹æ²¡æœ‰ä¿æŒå¯¹ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œå®ƒä¹Ÿå¯èƒ½åœ¨ä»»ä½•æ—¶å€™è¢« GC å›æ”¶ã€‚è¿™ä¸ä¼šå½±å“ä»»åŠ¡çš„æ‰§è¡Œ ï¼Œä½†æ„å‘³ç€ä½ æ— æ³•å†é€šè¿‡è¿™ä¸ª &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡ï¼ˆä¾‹å¦‚è°ƒç”¨ &lt;code&gt;get()&lt;/code&gt;æˆ– &lt;code&gt;join()&lt;/code&gt;ï¼‰æ¥è·å–ä»»åŠ¡çš„ç»“æœæˆ–çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨å¼±å¼•ç”¨&lt;/strong&gt;ï¼šåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½¿ç”¨å¼±å¼•ç”¨ç®¡ç† &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡æœ‰æ—¶å¯èƒ½å¢åŠ å¤æ‚æ€§ã€‚ä½ éœ€è¦ä»”ç»†è¯„ä¼°æ˜¯å¦çœŸçš„éœ€è¦è¿™æ ·åšã€‚é€šå¸¸ï¼Œæ›´ç®€å•çš„åšæ³•æ˜¯ä¸»åŠ¨ç®¡ç†ä¸€ä¸ªæ™®é€šçš„ &lt;code&gt;List&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt;&lt;/code&gt;ï¼Œå¹¶åœ¨ä»»åŠ¡å®Œæˆåï¼ˆä¾‹å¦‚ä½¿ç”¨ &lt;code&gt;thenRun&lt;/code&gt;å›è°ƒï¼‰ä¸»åŠ¨å°†å…¶ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¯¹ &lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;è¿”å›çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;å»ºç«‹å¼±å¼•ç”¨å¹¶åŠ å…¥åˆ—è¡¨åï¼Œ&lt;strong&gt;ä»»åŠ¡å®Œæˆæ—¶ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡æœ¬èº«ä¸ä¼šè‡ªåŠ¨ä»åˆ—è¡¨ä¸­æ¶ˆå¤±&lt;/strong&gt;ã€‚åˆ—è¡¨ä¸­çš„ &lt;code&gt;WeakReference&lt;/code&gt;æ¡ç›®éœ€è¦ä½ &lt;strong&gt;æ‰‹åŠ¨ç®¡ç†&lt;/strong&gt;ï¼ˆå®šæœŸæ¸…ç†æˆ–ä½¿ç”¨ &lt;code&gt;ReferenceQueue&lt;/code&gt;ï¼‰æ¥ç§»é™¤é‚£äº›å…¶å¼•ç”¨çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡å·²è¢« GC å›æ”¶çš„â€œç©ºå£³â€å¼±å¼•ç”¨ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼&lt;/p&gt;
&lt;h2 id="readwritelock"&gt;readWriteLock
&lt;/h2&gt;&lt;p&gt;ç†è§£ JUC ä¸­ &lt;code&gt;ReadWriteLock&lt;/code&gt;ï¼ˆä¸»è¦ä»¥ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;ä¸ºä¾‹ï¼‰çš„è¡Œä¸ºé€»è¾‘å¯¹äºç¼–å†™é«˜æ•ˆã€çº¿ç¨‹å®‰å…¨çš„å¹¶å‘ç¨‹åºå¾ˆé‡è¦ã€‚å®ƒé€šè¿‡åˆ†ç¦»è¯»é”å’Œå†™é”ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹æä¾›äº†æ¯”ç‹¬å é”æ›´å¥½çš„å¹¶å‘æ€§èƒ½ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“å…¶æ ¸å¿ƒè¡Œä¸ºè§„åˆ™ï¼Œç„¶åè¯¦ç»†è§£é‡Šã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é”æ¨¡å¼&lt;/th&gt;
&lt;th&gt;è¯»é”&lt;/th&gt;
&lt;th&gt;å†™é”&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;strong&gt;å…±äº«&lt;/strong&gt;ã€‚å¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è·å–è¯»é”&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚æœ‰è¯»é”æ—¶ï¼Œæ— æ³•è·å–å†™é”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚æœ‰å†™é”æ—¶ï¼Œæ— æ³•è·å–è¯»é”&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚æœ‰å†™é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–å†™é”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è¯¦ç»†è¡Œä¸ºé€»è¾‘"&gt;ğŸ“– è¯¦ç»†è¡Œä¸ºé€»è¾‘
&lt;/h3&gt;&lt;h4 id="1-è¯»è¯»å…±äº«-read-read-sharing"&gt;1. è¯»è¯»å…±äº« (Read-Read Sharing)
&lt;/h4&gt;&lt;p&gt;å½“æ²¡æœ‰çº¿ç¨‹æŒæœ‰&lt;strong&gt;å†™é”&lt;/strong&gt;æ—¶ï¼Œ&lt;strong&gt;å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–è¯»é”&lt;/strong&gt;å¹¶æ‰§è¡Œè¯»æ“ä½œã€‚è¿™æå¤§åœ°æé«˜äº†åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹çš„ååé‡ã€‚&lt;/p&gt;
&lt;h4 id="2-è¯»å†™äº’æ–¥-read-write-mutual-exclusion"&gt;2. è¯»å†™äº’æ–¥ (Read-Write Mutual Exclusion)
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ‰è¯»æ— å†™&lt;/strong&gt;ï¼šåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯»é”ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹&lt;strong&gt;éƒ½æ— æ³•è·å–å†™é”&lt;/strong&gt;ã€‚å†™çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰è¯»é”é‡Šæ”¾ã€‚è¿™ä¿è¯äº†è¯»æ“ä½œä¸ä¼šè¯»åˆ°å†™æ“ä½œè¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰å†™æ— è¯»&lt;/strong&gt;ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”æ—¶ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹&lt;strong&gt;éƒ½æ— æ³•è·å–è¯»é”&lt;/strong&gt;ï¼ˆæˆ–å…¶ä»–å†™é”ï¼‰ã€‚è¯»çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å†™é”é‡Šæ”¾ã€‚è¿™ä¿è¯äº†å†™æ“ä½œçš„ç‹¬å æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å†™å†™äº’æ–¥-write-write-mutual-exclusion"&gt;3. å†™å†™äº’æ–¥ (Write-Write Mutual Exclusion)
&lt;/h4&gt;&lt;p&gt;å†™é”æ˜¯&lt;strong&gt;ç‹¬å é”&lt;/strong&gt;ã€‚åŒä¸€æ—¶åˆ»&lt;strong&gt;åªå…è®¸ä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;æŒæœ‰å†™é”ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹å°è¯•è·å–å†™é”ï¼Œå®ƒä»¬å¿…é¡»ä¸²è¡Œæ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3 id="-é‡è¦ç‰¹æ€§"&gt;ğŸ”§ é‡è¦ç‰¹æ€§
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;é™¤äº†éµå®ˆä»¥ä¸ŠåŸºæœ¬è§„åˆ™ï¼Œè¿˜æä¾›äº†ä¸€äº›é‡è¦ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯é‡å…¥æ€§ (Reentrancy)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸&lt;strong&gt;åŒä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;å¤šæ¬¡è·å–åŒä¸€æŠŠè¯»é”æˆ–å†™é”ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰è¯»é”åï¼Œå…¶åŒæ­¥æ–¹æ³•å†…éƒ¨å¯ä»¥å†æ¬¡è·å–è¯»é”è€Œä¸ä¼šé˜»å¡è‡ªèº«ã€‚è¿™å¯¹äºé€’å½’æ“ä½œæˆ–å›è°ƒéå¸¸æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”é™çº§ (Lock Downgrading)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ï¼Œå…è®¸çº¿ç¨‹åœ¨&lt;strong&gt;æŒæœ‰å†™é”&lt;/strong&gt;çš„æƒ…å†µä¸‹ï¼Œè·å–&lt;strong&gt;è¯»é”&lt;/strong&gt;ï¼Œç„¶å&lt;strong&gt;é‡Šæ”¾å†™é”&lt;/strong&gt;çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;writeLock.lock(); // è·å–å†™é”
try {
// ... ä¿®æ”¹æ•°æ® ...
readLock.lock(); // è·å–è¯»é”ï¼ˆé”é™çº§å¼€å§‹ï¼‰
} finally {
writeLock.unlock(); // é‡Šæ”¾å†™é”ï¼ˆé”é™çº§å®Œæˆï¼Œç°åœ¨åªæŒæœ‰è¯»é”ï¼‰
}
try {
// ... è¯»å–æ•°æ® ...ï¼ˆæ­¤æ—¶å…¶ä»–è¯»çº¿ç¨‹ä¹Ÿå¯ä»¥å¹¶å‘è¯»å–äº†ï¼‰
} finally {
readLock.unlock();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é”é™çº§çš„ä»·å€¼&lt;/strong&gt;ï¼šå®ƒä¿è¯äº†ä»â€œå†™â€åˆ°â€œåç»­è¯»â€çš„è¿ç»­æ€§ã€‚åœ¨é‡Šæ”¾å†™é”åã€è·å–è¯»é”å‰ï¼Œå¯èƒ½æœ‰å…¶ä»–å†™çº¿ç¨‹æ’å…¥ä¿®æ”¹æ•°æ®ï¼Œå¯¼è‡´å½“å‰çº¿ç¨‹è¯»å–çš„æ•°æ®ä¸å…¶åˆšæ‰å†™å…¥çš„ä¸ä¸€è‡´ã€‚é”é™çº§é¿å…äº†è¿™ç§ä¸ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¬å¹³æ€§é€‰æ‹© (Fairness)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éå…¬å¹³æ¨¡å¼ (é»˜è®¤)&lt;/strong&gt;ï¼šååé‡æ›´é«˜ï¼Œä½†å¯èƒ½é€ æˆçº¿ç¨‹&lt;strong&gt;é¥¥é¥¿&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œæºæºä¸æ–­çš„è¯»çº¿ç¨‹å¯èƒ½è®©å†™çº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¹³æ¨¡å¼&lt;/strong&gt;ï¼šä¸¥æ ¼æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºï¼ˆè¿‘ä¼¼FIFOï¼‰åˆ†é…é”ï¼Œå‡å°‘äº†é¥¥é¥¿çš„å¯èƒ½æ€§ï¼Œä½†å¯èƒ½é™ä½æ•´ä½“ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸ä½¿ç”¨åœºæ™¯"&gt;âš ï¸ æ³¨æ„äº‹é¡¹ä¸ä½¿ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReadWriteLock&lt;/code&gt;éå¸¸é€‚ç”¨äº &lt;strong&gt;â€œè¯»å¤šå†™å°‘â€&lt;/strong&gt; çš„åœºæ™¯ï¼Œä¾‹å¦‚ç¼“å­˜ã€é…ç½®ä¿¡æ¯å­˜å‚¨ç­‰ï¼Œå…¶ä¸­è¯»å–æ“ä½œè¿œè¿œå¤šäºå†™å…¥æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™çº¿ç¨‹é¥¥é¥¿ (Starvation)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨éå…¬å¹³æ¨¡å¼ä¸‹ï¼Œå¦‚æœè¯»æ“ä½œéå¸¸é¢‘ç¹ä¸”æŒä¹…ï¼Œ&lt;strong&gt;å†™çº¿ç¨‹å¯èƒ½ä¼šå› ä¸ºä¸€ç›´æ— æ³•è·å–å†™é”è€Œé¥¥é¥¿&lt;/strong&gt;ã€‚å…¬å¹³æ¨¡å¼å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£æ­¤é—®é¢˜ï¼Œä½†éœ€æƒè¡¡ååé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”å‡çº§ (Lock Upgrading)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯»é”ä¸èƒ½ç›´æ¥å‡çº§ä¸ºå†™é”&lt;/strong&gt;ã€‚å¦‚æœå°è¯•åœ¨æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹è·å–å†™é”ï¼Œä¼šå¯¼è‡´&lt;strong&gt;æ­»é”&lt;/strong&gt;ï¼ˆå› ä¸ºå†™é”éœ€è¦ç­‰å¾…è‡ªå·±é‡Šæ”¾è¯»é”ï¼‰ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å…ˆé‡Šæ”¾æ‰€æœ‰è¯»é”ï¼Œç„¶åå†å°è¯•è·å–å†™é”ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯åŸå­çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;ReadWriteLock&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="æ— é”è¯»"&gt;æ— é”è¯»
&lt;/h2&gt;&lt;p&gt;ã€‚ä½¿ç”¨è¯»å†™é”ï¼ˆå¦‚ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;ï¼‰å’Œä»…ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;æ¥é”å†™æ“ä½œï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;å¯¹è¯»æ“ä½œçš„å¤„ç†æ–¹å¼&lt;/strong&gt;ï¼Œè¿™ç›´æ¥å½±å“äº†ç¨‹åºçš„å¹¶å‘æ€§èƒ½å’Œè®¾è®¡æ€è·¯ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†æ ¸å¿ƒåŒºåˆ«ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨è¯»å†™é” (ReentrantReadWriteLock)&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ ReentrantLock (ä»…é”å†™æ“ä½œ)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç†å¿µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;ã€‚è¯»é”å…±äº«ï¼Œå†™é”ç‹¬å &lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å†™æ“ä½œäº’æ–¥&lt;/strong&gt;ã€‚ä¸æ§åˆ¶è¯»æ“ä½œï¼Œéœ€å¦è¾Ÿçº¿ç¨‹å®‰å…¨é€”å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»å¹¶å‘æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ã€‚å¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è·å–è¯»é”ï¼Œ&lt;strong&gt;å¹¶è¡Œè¯»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–å®ç°&lt;/strong&gt;ã€‚è‹¥è¯»æ“ä½œæ— é”ä¸”æ•°æ®ç»“æ„éçº¿ç¨‹å®‰å…¨ï¼Œåˆ™å¹¶å‘è¯»ä¸å®‰å…¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™å¹¶å‘æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ã€‚å†™é”ç‹¬å ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ã€‚å†™é”ç‹¬å ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;åœºæ™¯ä¸‹æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾&lt;/td&gt;
&lt;td&gt;æ€§èƒ½å–å†³äº&lt;strong&gt;è¯»æ“ä½œçš„å®ç°æ–¹å¼&lt;/strong&gt;å’Œ&lt;strong&gt;æ•°æ®ç«äº‰ç¨‹åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›è¯»é”ã€å†™é”ä¸¤å¥—API&lt;/td&gt;
&lt;td&gt;ä»…æä¾›ä¸€å¥—é”APIï¼Œä½†åŠŸèƒ½ä¸°å¯Œï¼ˆå¯å…¬å¹³ã€å¯ä¸­æ–­ã€å¯è¶…æ—¶ã€æ”¯æŒæ¡ä»¶å˜é‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ½œåœ¨é—®é¢˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°ç›¸å¯¹å¤æ‚ï¼Œå¯èƒ½å­˜åœ¨&lt;strong&gt;å†™çº¿ç¨‹é¥¥é¥¿&lt;/strong&gt;ï¼ˆéå…¬å¹³é”ä¸‹ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€è‡ªè¡Œç¡®ä¿è¯»æ“ä½œçš„çº¿ç¨‹å®‰å…¨ï¼Œå¯èƒ½éœ€é…åˆ&lt;strong&gt;volatile&lt;/strong&gt;æˆ–&lt;strong&gt;åŸå­å˜é‡&lt;/strong&gt;ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é”ç®¡ç†æ›´å¤æ‚ï¼Œéœ€æ­£ç¡®ä½¿ç”¨ä¸¤æŠŠé”&lt;/td&gt;
&lt;td&gt;é”ç®¡ç†ç®€å•ï¼Œä½†&lt;strong&gt;çº¿ç¨‹å®‰å…¨çš„è®¾è®¡è´£ä»»è½¬ç§»åˆ°äº†è¯»æ“ä½œå’Œæ•°æ®ç»“æ„çš„å®ç°ä¸Š&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ æ›´ç›´è§‚åœ°ç†è§£ä¸¤ç§æ–¹å¼åœ¨â€œè¯»å¤šå†™å°‘â€åœºæ™¯ä¸‹çš„æ€§èƒ½å·®å¼‚ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹åŸºäºå…¸å‹æµ‹è¯•çš„æ€§èƒ½å¯¹æ¯”ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;xychart-beta
title &amp;#34;è¯»å¤šå†™å°‘åœºæ™¯ä¸‹é”æ€§èƒ½å¯¹æ¯”ï¼ˆè€—æ—¶è¶Šå°‘è¶Šå¥½ï¼‰&amp;#34;
x-axis [&amp;#34;å†™é”ï¼ˆReentrantLockï¼‰&amp;#34;, &amp;#34;è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰&amp;#34;]
y-axis &amp;#34;è€—æ—¶ï¼ˆmsï¼‰&amp;#34; 0 --&amp;gt; 3500
bar [3124, 1345]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹çœ‹è¿™ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç å’Œè®¾è®¡è€ƒé‡ã€‚&lt;/p&gt;
&lt;h3 id="-ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç "&gt;ğŸ› ï¸ ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç 
&lt;/h3&gt;&lt;h4 id="1-ä½¿ç”¨è¯»å†™é”-reentrantreadwritelock"&gt;1. ä½¿ç”¨è¯»å†™é” (&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;)
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.locks.ReentrantReadWriteLock;
public class ReadWriteLockDemo {
private final ReentrantReadWriteLock rwLock = new ReentrantReadWriteLock();
private Object sharedData;
// è¯»æ“ä½œï¼šè·å–è¯»é”
public Object read() {
rwLock.readLock().lock();
try {
return sharedData;
} finally {
rwLock.readLock().unlock();
}
}
// å†™æ“ä½œï¼šè·å–å†™é”
public void write(Object newData) {
rwLock.writeLock().lock();
try {
sharedData = newData;
} finally {
rwLock.writeLock().unlock();
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»æ“ä½œä½¿ç”¨ &lt;code&gt;readLock()&lt;/code&gt;ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ &lt;code&gt;read()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;å†™æ“ä½œä½¿ç”¨ &lt;code&gt;writeLock()&lt;/code&gt;ï¼Œä¸å…¶ä»–å†™é”å’Œè¯»é”éƒ½äº’æ–¥ï¼Œä¿è¯ç‹¬å ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ä½¿ç”¨-reentrantlockä»…é”å†™æ“ä½œ"&gt;2. ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;(ä»…é”å†™æ“ä½œ)
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.locks.ReentrantLock;
import java.util.concurrent.atomic.AtomicReference; // æˆ–ä½¿ç”¨ volatile é…åˆå…¶ä»–æœºåˆ¶
public class ReentrantLockWriteOnlyDemo {
private final ReentrantLock writeLock = new ReentrantLock();
// ä½¿ç”¨ AtomicReference æˆ– volatile æ¥ä¿è¯å…±äº«æ•°æ®çš„å¯è§æ€§
private AtomicReference&amp;lt;Object&amp;gt; sharedData = new AtomicReference&amp;lt;&amp;gt;();
// è¯»æ“ä½œï¼šæ— é”ï¼Œç›´æ¥è¯»ã€‚ä½†éœ€ä¿è¯sharedDataçš„çº¿ç¨‹å®‰å…¨å‘å¸ƒã€‚
public Object read() {
return sharedData.get();
}
// å†™æ“ä½œï¼šè·å–é”
public void write(Object newData) {
writeLock.lock();
try {
sharedData.set(newData);
} finally {
writeLock.unlock();
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;ä¿è¯äº’æ–¥ã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œ&lt;strong&gt;ä¸åŠ é”&lt;/strong&gt;ï¼Œç›´æ¥è¯»å–ã€‚è¿™æ„å‘³ç€ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦é€‰æ‹©&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;çš„æ–¹å¼æš´éœ²æ•°æ®ï¼ˆå¦‚ &lt;code&gt;AtomicReference&lt;/code&gt;, &lt;code&gt;volatile&lt;/code&gt;å˜é‡ï¼Œæˆ–ä¸å¯å˜å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒ&lt;strong&gt;ä¸èƒ½é˜²æ­¢&lt;/strong&gt;åœ¨è¯»å–è¿‡ç¨‹ä¸­æ•°æ®è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå¯èƒ½è¯»åˆ°ä¸­é—´çŠ¶æ€æˆ–æ—§å€¼ï¼ˆå–å†³äºå†…å­˜è¯­ä¹‰çš„å®ç°ï¼Œå¦‚ &lt;code&gt;volatile&lt;/code&gt;èƒ½ä¿è¯å¯è§æ€§ä½†éåŸå­æ€§ï¼‰ã€‚è¿™ç§æ¨¡å¼é€šå¸¸é€‚ç”¨äº&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;æˆ–è¯»æ“ä½œéå¸¸å¿«ã€ç®€å•çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-6"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œåº”ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ çš„åº”ç”¨æ˜¯å…¸å‹çš„ &lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt; ï¼ˆä¾‹å¦‚ 95% è¯»ï¼Œ5% å†™ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œæœ¬èº«&lt;strong&gt;æ¯”è¾ƒè€—æ—¶&lt;/strong&gt;ï¼ˆå¦‚è¯»å–å¤§å¯¹è±¡ã€ç®€å•è®¡ç®—ï¼‰ï¼Œä½ å¸Œæœ›æœ€å¤§åŒ–è¯»çš„å¹¶å‘ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;ä½ æ„¿æ„æ¥å—æ¯” &lt;code&gt;ReentrantLock&lt;/code&gt;ç¨å¤æ‚ä¸€äº›çš„é”ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;(ä»…é”å†™) + æ— é”è¯» å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œé¢‘ç‡è¾ƒé«˜ï¼Œè¯»å†™æ“ä½œç«äº‰æ¿€çƒˆï¼Œæ­¤æ—¶ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;çš„å¤æ‚å¼€é”€å¯èƒ½å¸¦æ¥åæ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œ&lt;strong&gt;éå¸¸å¿«é€Ÿ&lt;/strong&gt;ï¼Œæˆ–è€…æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚å…è®¸è¯»åˆ°æœ€æ–°æ›´æ–°å‰çš„å€¼ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å¸Œæœ›ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;æä¾›çš„&lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼Œå¦‚å°è¯•é”ã€å¯ä¸­æ–­é”ã€å…¬å¹³é”æˆ–æ¡ä»¶å˜é‡ï¼ˆ&lt;code&gt;Condition&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ ä½¿ç”¨çš„&lt;strong&gt;æ•°æ®ç»“æ„æœ¬èº«å°±èƒ½ä¿è¯æ— é”è¯»çš„çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ get æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-7"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†™çº¿ç¨‹é¥¥é¥¿&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;çš„&lt;strong&gt;éå…¬å¹³æ¨¡å¼&lt;/strong&gt;ï¼ˆé»˜è®¤ï¼‰ä¸‹ï¼Œå¦‚æœè¯»çº¿ç¨‹æºæºä¸æ–­ï¼Œå†™çº¿ç¨‹å¯èƒ½ä¼šé•¿æ—¶é—´ç­‰å¾…ï¼Œæ— æ³•è·å–é”ã€‚å¦‚æœå¯¹å†™æ“ä½œçš„å®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨&lt;strong&gt;å…¬å¹³æ¨¡å¼&lt;/strong&gt;ï¼ˆ&lt;code&gt;new ReentrantReadWriteLock(true)&lt;/code&gt;ï¼‰ï¼Œä½†ä¼šä¸€å®šç¨‹åº¦ä¸Šç‰ºç‰²æ•´ä½“ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”å‡çº§&lt;/strong&gt;ï¼š&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;å°†è¯»é”ç›´æ¥å‡çº§ä¸ºå†™é”ã€‚è¯•å›¾åœ¨æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹è·å–å†™é”ä¼šå¯¼è‡´&lt;strong&gt;æ­»é”&lt;/strong&gt;ã€‚ä½ å¿…é¡»å…ˆé‡Šæ”¾è¯»é”ï¼Œç„¶åå†å°è¯•è·å–å†™é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å¯è§æ€§&lt;/strong&gt;ï¼šåœ¨ä½¿ç”¨â€œ&lt;code&gt;ReentrantLock&lt;/code&gt;ä»…é”å†™â€æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¯»æ“ä½œèƒ½çœ‹åˆ°å†™æ“ä½œçš„æœ€æ–°ç»“æœã€‚é€šå¸¸éœ€è¦å€ŸåŠ© &lt;code&gt;volatile&lt;/code&gt;å…³é”®å­—æˆ–åŸå­ç±»ï¼ˆå¦‚ &lt;code&gt;AtomicReference&lt;/code&gt;ï¼‰æ¥ä¿è¯å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ ¹æ®å®é™…åœºæ™¯åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="concurrenthashmap"&gt;ConcurrentHashMap
&lt;/h2&gt;&lt;p&gt;æ ¹æ®ä½ çš„æè¿°ï¼Œä½ çš„ä½¿ç”¨åœºæ™¯ï¼ˆ&lt;strong&gt;åªæœ‰åœ¨å…ƒç´ ä¸ºç©ºæ—¶æ‰æ‰§è¡Œå†™å…¥æ“ä½œï¼Œå…¶ä»–æ—¶é—´åŸºæœ¬éƒ½æ˜¯è¯»å–&lt;/strong&gt;ï¼‰éå¸¸é€‚åˆä½¿ç”¨ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ã€‚å®ƒåœ¨è¿™ç§â€œè¯»å¤šå†™å°‘â€çš„æ¨¡å¼ä¸‹èƒ½å‘æŒ¥å‡ºæœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒåŸå› ï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸ªè¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;ä¸ºä½•é€‚åˆä½ çš„åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»æ“ä½œå®Œå…¨æ— é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¢‘ç¹çš„è¯»å–æ“ä½œï¼ˆè·å–&lt;code&gt;Collection&lt;/code&gt;å¼•ç”¨ï¼‰ä¸ä¼šé˜»å¡ï¼Œå¯ä»¥&lt;strong&gt;æé«˜å¹¶å‘&lt;/strong&gt;åœ°è¿›è¡Œï¼Œè¿™æ˜¯æ€§èƒ½çš„å…³é”®ã€‚&lt;/td&gt;
&lt;td&gt;æ— ã€‚è¿™æ­£æ˜¯ä½ éœ€è¦çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™é”ç²’åº¦æç»†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å³ä½¿å‘ç”Ÿå†™å…¥ï¼ˆç©ºæ’å…¥ï¼‰ï¼Œä¹Ÿ&lt;strong&gt;åªé”å®šå½“å‰æ“ä½œçš„å•ä¸ªæ¡¶ï¼ˆbucketï¼‰&lt;/strong&gt;ï¼Œä¸å½±å“å…¶ä»–æ¡¶çš„è¯»å†™æ“ä½œï¼Œå°†é”çš„ç«äº‰å’Œå½±å“é™åˆ°æœ€ä½ã€‚&lt;/td&gt;
&lt;td&gt;æä½æ¦‚ç‡ä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¦åˆå§‹åŒ–åŒä¸€ä¸ªç©ºæ¡¶ï¼Œå®ƒä»¬ä¼šä¸²è¡Œæ‰§è¡Œï¼Œä½†è¿™ç§æƒ…å†µå¾ˆå°‘è§ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…ç½®åŸå­æ“ä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›äº† &lt;code&gt;putIfAbsent&lt;/code&gt;ã€&lt;code&gt;computeIfAbsent&lt;/code&gt;ç­‰åŸå­æ–¹æ³•ï¼Œ&lt;strong&gt;ä¸€è¡Œä»£ç å°±èƒ½å®Œæˆâ€œæ£€æŸ¥ä¸ºç©ºåˆ™æ’å…¥â€çš„æ“ä½œ&lt;/strong&gt;ï¼Œå®Œç¾åŒ¹é…ä½ çš„éœ€æ±‚ï¼Œä¸”çº¿ç¨‹å®‰å…¨ã€‚&lt;/td&gt;
&lt;td&gt;åŠ¡å¿…ä½¿ç”¨è¿™äº›ç°æˆæ–¹æ³•ï¼Œè€Œä¸æ˜¯è‡ªå·±ç”¨ &lt;code&gt;get&lt;/code&gt;å’Œ &lt;code&gt;put&lt;/code&gt;ç»„åˆï¼Œå¦åˆ™ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜å¯è§æ€§ä¿è¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†…éƒ¨çš„ &lt;code&gt;Node&lt;/code&gt;å€¼ç”¨ &lt;code&gt;volatile&lt;/code&gt;ä¿®é¥°ï¼Œç¡®ä¿ä¸€ä¸ªçº¿ç¨‹æ’å…¥æ–°å€¼åï¼Œå…¶ä»–çº¿ç¨‹èƒ½&lt;strong&gt;ç«‹åˆ»çœ‹åˆ°æœ€æ–°çš„&lt;code&gt;Collection&lt;/code&gt;å¼•ç”¨&lt;/strong&gt;ï¼Œä¸ä¼šè¯»åˆ°è¿‡æœŸçš„ç©ºå€¼ã€‚&lt;/td&gt;
&lt;td&gt;æ— ã€‚è¿™æ­£æ˜¯ä½ éœ€è¦çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•å®ç°ä½ çš„éœ€æ±‚"&gt;ğŸ¯ å¦‚ä½•å®ç°ä½ çš„éœ€æ±‚
&lt;/h3&gt;&lt;p&gt;ä½ æè¿°çš„é€»è¾‘â€”â€”â€œå¦‚æœç©ºåˆ™æ’å…¥ï¼Œå¦åˆ™åªè¯»â€â€”â€”éå¸¸é€‚åˆç”¨ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ &lt;code&gt;computeIfAbsent&lt;/code&gt;æ–¹æ³•æ¥å®ç°ã€‚å®ƒèƒ½ä¿è¯åŸå­æ€§ï¼Œå¹¶ä¸”éå¸¸ç®€æ´ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å‡è®¾ä½ çš„ ConcurrentHashMap å®šä¹‰ä¸º
ConcurrentHashMap&amp;lt;String, Collection&amp;lt;Object&amp;gt;&amp;gt; map = new ConcurrentHashMap&amp;lt;&amp;gt;();
String key = &amp;#34;someKey&amp;#34;;
// ä½¿ç”¨ computeIfAbsent æ¥ä¿è¯ï¼šå¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™åŸå­æ€§åœ°è®¡ç®—å¹¶æ”¾å…¥ä¸€ä¸ªæ–°å€¼
Collection&amp;lt;Object&amp;gt; valueCollection = map.computeIfAbsent(key, k -&amp;gt; {
// è¿™ä¸ªæ˜ å°„å‡½æ•°åªåœ¨é”® k ä¸å­˜åœ¨æ—¶æ‰§è¡Œ
// åœ¨è¿™é‡Œåˆ›å»ºå¹¶è¿”å›ä½ çš„æ–° Collectionï¼Œä¾‹å¦‚ï¼š
return Collections.synchronizedList(new ArrayList&amp;lt;&amp;gt;()); // æˆ–è€… new ConcurrentLinkedQueue&amp;lt;&amp;gt;() ç­‰
});
// ä¹‹åï¼Œä½ å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ valueCollection è¿›è¡Œè¯»å–æ“ä½œ
for (Object item : valueCollection) {
// å¤„ç†å…ƒç´ 
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹"&gt;âš ï¸ ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©çº¿ç¨‹å®‰å…¨çš„é›†åˆ (Collection)&lt;/strong&gt;ï¼šä½ æ”¾å…¥ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ &lt;code&gt;Collection&lt;/code&gt;æœ¬èº«ä¹Ÿå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶æ“ä½œè¿™ä¸ªé›†åˆã€‚ä½ å¯ä»¥é€‰æ‹©ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;java.util.concurrent&lt;/code&gt;åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼ˆå¦‚ &lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;, &lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨ &lt;code&gt;Collections.synchronizedCollection()&lt;/code&gt;, &lt;code&gt;Collections.synchronizedList()&lt;/code&gt;ç­‰åŒ…è£…æ–¹æ³•åŒ…è£…ä¸€ä¸ªæ™®é€šé›†åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…é‡å¤é€ è½®å­&lt;/strong&gt;ï¼š&lt;strong&gt;åƒä¸‡ä¸è¦&lt;/strong&gt;è‡ªå·±å†™ä»£ç å…ˆ &lt;code&gt;get(key)&lt;/code&gt;æ£€æŸ¥æ˜¯å¦ä¸º &lt;code&gt;null&lt;/code&gt;ï¼Œç„¶åå† &lt;code&gt;put(key, newValue)&lt;/code&gt;ã€‚è¿™åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä¸¤ä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶æ£€æŸ¥åˆ° &lt;code&gt;null&lt;/code&gt;ï¼Œç„¶åéƒ½æ‰§è¡Œ &lt;code&gt;put&lt;/code&gt;ï¼Œå¯¼è‡´ä¸€ä¸ªè¦†ç›–å¦ä¸€ä¸ªã€‚&lt;strong&gt;å§‹ç»ˆä½¿ç”¨ &lt;code&gt;putIfAbsent&lt;/code&gt;æˆ– &lt;code&gt;computeIfAbsent&lt;/code&gt;è¿™æ ·çš„åŸå­æ–¹æ³•ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼çš„ä½¿ç”¨&lt;/strong&gt;ï¼š&lt;code&gt;computeIfAbsent&lt;/code&gt;çš„è¿”å›å€¼å°±æ˜¯ä½ éœ€è¦çš„ &lt;code&gt;Collection&lt;/code&gt;å¼•ç”¨ï¼ˆæ— è®ºæ˜¯æ–°åˆ›å»ºçš„è¿˜æ˜¯å·²ç»å­˜åœ¨çš„ï¼‰ã€‚ç›´æ¥ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼ï¼Œè€Œä¸æ˜¯å†è°ƒç”¨ä¸€æ¬¡ &lt;code&gt;map.get(key)&lt;/code&gt;ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;éå¸¸é€‚åˆã€‚&lt;/strong&gt; &lt;code&gt;ConcurrentHashMap&lt;/code&gt;å‡ ä¹æ˜¯ä¸ºä½ æè¿°çš„è¿™ç±»åœºæ™¯é‡èº«å®šåšçš„ã€‚å®ƒçš„&lt;strong&gt;æ— é”è¯»&lt;/strong&gt;å’Œ&lt;strong&gt;ç»†ç²’åº¦å†™é”&lt;/strong&gt;å®Œç¾å¥‘åˆäº†ä½ â€œåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè¯»å–æ— æ•°æ¬¡â€çš„éœ€æ±‚ã€‚åªéœ€ä½¿ç”¨å…¶å†…ç½®çš„åŸå­æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;computeIfAbsent&lt;/code&gt;ï¼‰å¹¶ç¡®ä¿å­˜æ”¾çš„é›†åˆæœ¬èº«çº¿ç¨‹å®‰å…¨å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ åšå‡ºå†³ç­–ï¼&lt;/p&gt;
&lt;h2 id="concurrentset"&gt;ConcurrentSet
&lt;/h2&gt;&lt;p&gt;Java æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å«åš &lt;code&gt;ConcurrentHashSet&lt;/code&gt;çš„ç±»ã€‚ä½†æ˜¯ï¼Œä½ å®Œå…¨å¯ä»¥é€šè¿‡ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;æ¥è½»æ¾åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ã€è¡Œä¸ºç±»ä¼¼çš„ Setã€‚è‡ª JDK 8 èµ·ï¼Œ&lt;code&gt;ConcurrentHashMap&lt;/code&gt;æä¾›äº†ä¸¤ä¸ªéå¸¸æ–¹ä¾¿çš„æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„ Setï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;newKeySet()&lt;/code&gt;&lt;/strong&gt;: è¿”å›ä¸€ä¸ªç”± &lt;code&gt;ConcurrentHashMap&lt;/code&gt;æ”¯æŒçš„æ ‡å‡† &lt;code&gt;Set&lt;/code&gt;ï¼Œä½ å¯ä»¥å®‰å…¨åœ°æ·»åŠ ã€åˆ é™¤å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;keySet(defaultValue)&lt;/code&gt;&lt;/strong&gt;: è¿”å›ä¸€ä¸ªä¸ç‰¹å®š &lt;code&gt;ConcurrentHashMap&lt;/code&gt;å®ä¾‹é”®è§†å›¾å…³è”çš„ Setï¼Œå…è®¸åœ¨æ·»åŠ æ–°é”®æ—¶æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„æ˜ å°„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨ &lt;code&gt;newKeySet()&lt;/code&gt;æ–¹æ³•åˆ›å»ºçº¿ç¨‹å®‰å…¨ Set çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;
public class ConcurrentHashSetExample {
public static void main(String[] args) {
// ä½¿ç”¨ ConcurrentHashMap çš„ newKeySet() æ–¹æ³•åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„ Set
Set&amp;lt;String&amp;gt; concurrentSet = ConcurrentHashMap.newKeySet();
concurrentSet.add(&amp;#34;Java&amp;#34;);
concurrentSet.add(&amp;#34;Python&amp;#34;);
concurrentSet.add(&amp;#34;C++&amp;#34;);
System.out.println(&amp;#34;Set: &amp;#34; + concurrentSet); // è¾“å‡º: Set: [Java, Python, C++]
// å®‰å…¨çš„å¹¶å‘æ“ä½œ
boolean containsJava = concurrentSet.contains(&amp;#34;Java&amp;#34;); // true
concurrentSet.remove(&amp;#34;Python&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-å…¶ä»–åˆ›å»ºçº¿ç¨‹å®‰å…¨-set-çš„æ–¹æ³•"&gt;ğŸ’¡ å…¶ä»–åˆ›å»ºçº¿ç¨‹å®‰å…¨ Set çš„æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;é™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼ä¹Ÿèƒ½è·å¾—çº¿ç¨‹å®‰å…¨çš„ Setï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¯ä»¥å°†ä¸€ä¸ªæ™®é€šçš„ &lt;code&gt;HashSet&lt;/code&gt;åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„ Setã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Set&amp;lt;String&amp;gt; syncSet = Collections.synchronizedSet(new HashSet&amp;lt;&amp;gt;());
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¿™ç§æ–¹å¼é€šè¿‡å¯¹æ•´ä¸ªé›†åˆåŠ é”å®ç°çº¿ç¨‹å®‰å…¨ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½å¯èƒ½ä¸å¦‚åŸºäº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ Setã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CopyOnWriteArraySet&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ &lt;code&gt;java.util.concurrent&lt;/code&gt;åŒ…ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨ Set å®ç°ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.CopyOnWriteArraySet;
Set&amp;lt;String&amp;gt; copyOnWriteSet = new CopyOnWriteArraySet&amp;lt;&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šå®ƒé€‚ç”¨äº&lt;strong&gt;è¯»å¤šå†™æå°‘&lt;/strong&gt;çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç›‘å¬å™¨åˆ—è¡¨ï¼‰ã€‚æ¯æ¬¡ä¿®æ”¹ï¼ˆå†™æ“ä½œï¼‰éƒ½ä¼šå¤åˆ¶åº•å±‚æ•°ç»„ï¼Œå› æ­¤å†™æ“ä½œå¼€é”€è¾ƒå¤§ï¼Œä½†è¯»æ“ä½œéå¸¸å¿«ä¸”ä¸éœ€è¦é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-7"&gt;ğŸ“Š å¦‚ä½•é€‰æ‹©ï¼Ÿ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å®ç°æ–¹å¼&lt;/th&gt;
&lt;th&gt;åŸç†&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ConcurrentHashMap.newKeySet()&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼Œä½¿ç”¨ç»†ç²’åº¦é”æˆ– CAS å®ç°é«˜æ€§èƒ½å¹¶å‘&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘è¯»å†™&lt;/strong&gt;ï¼Œéœ€è¦æœ€ä½³æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Collections.synchronizedSet()&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ synchronized å…³é”®å­—å¯¹æ•´ä¸ªé›†åˆåŠ é”&lt;/td&gt;
&lt;td&gt;å¹¶å‘ç«äº‰ä¸é«˜ï¼Œæˆ–è€…éœ€è¦ä¸æ—§ä»£ç å…¼å®¹çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CopyOnWriteArraySet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†™æ—¶å¤åˆ¶ï¼Œè¯»æ“ä½œæ— é”&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯»å¤šå†™æå°‘&lt;/strong&gt;ï¼Œé›†åˆå¤§å°é€šå¸¸ä¿æŒè¾ƒå°ï¼Œä¸”éå†æ“ä½œè¿œå¤šäºä¿®æ”¹æ“ä½œçš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-8"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„é”®å’Œå€¼ä¸å…è®¸ä¸º &lt;code&gt;null&lt;/code&gt;&lt;/strong&gt;ï¼šå› æ­¤ï¼Œé€šè¿‡ &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;åˆ›å»ºçš„ Set &lt;strong&gt;ä¹Ÿä¸å…è®¸æ”¾å…¥ &lt;code&gt;null&lt;/code&gt;å…ƒç´ &lt;/strong&gt;ã€‚è€Œ &lt;code&gt;HashSet&lt;/code&gt;å…è®¸ä¸€ä¸ª &lt;code&gt;null&lt;/code&gt;å…ƒç´ ï¼Œè¿™æ˜¯å®ƒä»¬çš„ä¸€ä¸ªåŒºåˆ«ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿­ä»£å™¨çš„å¼±ä¸€è‡´æ€§&lt;/strong&gt;ï¼šç”± &lt;code&gt;ConcurrentHashMap&lt;/code&gt;æ”¯æŒçš„ Set æ‰€è¿”å›çš„è¿­ä»£å™¨å…·æœ‰&lt;strong&gt;å¼±ä¸€è‡´æ€§&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€è¿­ä»£å™¨å¯ä»¥å®¹å¿å¹¶å‘ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸ä¼šæŠ›å‡º &lt;code&gt;ConcurrentModificationException&lt;/code&gt;ã€‚ä½†å®ƒä¸ä¿è¯èƒ½åæ˜ å‡ºè¿­ä»£å™¨åˆ›å»ºä¹‹åçš„æ‰€æœ‰ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©å–å†³äºåœºæ™¯&lt;/strong&gt;ï¼šå¦‚æœä½ çš„åœºæ™¯æ˜¯&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;ï¼ˆä¾‹å¦‚ç›‘å¬å™¨åˆ—è¡¨ã€é…ç½®é¡¹ï¼‰ï¼Œ&lt;code&gt;CopyOnWriteArraySet&lt;/code&gt;å¯èƒ½æ›´åˆé€‚ã€‚å¯¹äº&lt;strong&gt;è¯»å†™éƒ½å¾ˆé¢‘ç¹&lt;/strong&gt;çš„é«˜å¹¶å‘åœºæ™¯ï¼ŒåŸºäº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ Set é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ ï¼&lt;/p&gt;
&lt;h2 id="listremoveall"&gt;List.removeAll
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œåœ¨ Java ä¸­ï¼Œå¯¹ &lt;code&gt;List&lt;/code&gt;è°ƒç”¨ &lt;code&gt;removeAll(Collection)&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œå¦‚æœä¼ å…¥çš„ &lt;code&gt;Collection&lt;/code&gt;æ˜¯ä¸€ä¸ª &lt;code&gt;Set&lt;/code&gt;ï¼ˆç‰¹åˆ«æ˜¯ &lt;code&gt;HashSet&lt;/code&gt;ï¼‰æˆ–åŸºäºå“ˆå¸Œçš„æ˜ å°„ï¼Œ&lt;strong&gt;æ•ˆç‡é€šå¸¸ä¼šæ˜¾è‘—é«˜äºä¼ å…¥ä¸€ä¸ª &lt;code&gt;List&lt;/code&gt;&lt;/strong&gt;ã€‚æ€§èƒ½å·®å¼‚ä¸»è¦æºäºä¸åŒæ•°æ®ç»“æ„åœ¨&lt;strong&gt;æŸ¥æ‰¾æ“ä½œï¼ˆ&lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•ï¼‰&lt;/strong&gt; ä¸Šçš„æ•ˆç‡å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼ç›´è§‚å¯¹æ¯”äº†ä¸º &lt;code&gt;removeAll&lt;/code&gt;ä¼ å…¥ &lt;code&gt;HashSet&lt;/code&gt;å’Œ &lt;code&gt;ArrayList&lt;/code&gt;ä½œä¸ºå‚æ•°æ—¶çš„æ ¸å¿ƒæ•ˆç‡å·®å¼‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§/æ“ä½œ&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ &lt;code&gt;HashSet&lt;/code&gt;ä½œä¸ºå‚æ•°&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ &lt;code&gt;ArrayList&lt;/code&gt;ä½œä¸ºå‚æ•°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥æ‰¾æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºå“ˆå¸Œè¡¨ (HashMap)&lt;/td&gt;
&lt;td&gt;åŸºäºé¡ºåºéå†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;contains() æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¹³å‡ O(1)&lt;/strong&gt; (å¸¸æ•°æ—¶é—´å¤æ‚åº¦ï¼Œæå¿«)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;O(n)&lt;/strong&gt; (çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œéšå…ƒç´ å¢å¤šè€Œå˜æ…¢)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;removeAll æ€»æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt; (ä»…éœ€éå†å¾…åˆ åˆ—è¡¨ï¼Œæ¯æ¬¡æ£€æŸ¥éƒ½æå¿«)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt; (æ¯æ¬¡æ£€æŸ¥éƒ½éœ€éå†å‚æ•°åˆ—è¡¨ï¼Œæ•´ä½“å¤æ‚åº¦ O(n*m))&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æµ·é‡æ•°æ®&lt;/strong&gt;æˆ–&lt;strong&gt;é¢‘ç¹æ“ä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®é‡æå°æˆ–ä»…ä½œç®€å•æ¼”ç¤º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ•ˆç‡å·®å¼‚åŸå› "&gt;ğŸ” æ•ˆç‡å·®å¼‚åŸå› 
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ArrayList&lt;/code&gt;çš„ &lt;code&gt;removeAll(Collection&amp;lt;?&amp;gt; c)&lt;/code&gt;æ–¹æ³•å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ƒä¼šéå† &lt;code&gt;ArrayList&lt;/code&gt;æœ¬èº«çš„æ¯ä¸ªå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œå®ƒè°ƒç”¨å‚æ•°é›†åˆ &lt;code&gt;c&lt;/code&gt;çš„ &lt;code&gt;contains(Object o)&lt;/code&gt;æ–¹æ³•ï¼Œåˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆ &lt;code&gt;c&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå­˜åœ¨ï¼Œåˆ™å°†å…¶ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…³é”®åœ¨äºç¬¬2æ­¥ï¼š&lt;strong&gt;&lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•çš„æ•ˆç‡å–å†³äºå‚æ•°é›†åˆ &lt;code&gt;c&lt;/code&gt;çš„ç±»å‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å½“ &lt;code&gt;c&lt;/code&gt;ä¸º &lt;code&gt;List&lt;/code&gt;(å¦‚ &lt;code&gt;ArrayList&lt;/code&gt;)&lt;/strong&gt;: å…¶ &lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•é€šå¸¸éœ€è¦&lt;strong&gt;éå†å†…éƒ¨æ•°ç»„&lt;/strong&gt;ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º &lt;strong&gt;O(n)&lt;/strong&gt; (n ä¸ºåˆ—è¡¨å¤§å°)ã€‚è¿™æ„å‘³ç€å¯¹ &lt;code&gt;ArrayList&lt;/code&gt;çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œæœ€åæƒ…å†µä¸‹å¯èƒ½éœ€è¦éå†æ•´ä¸ªå‚æ•°åˆ—è¡¨ã€‚å¦‚æœä¸¤ä¸ªåˆ—è¡¨éƒ½å¾ˆå¤§ï¼Œæ€»ä½“æ—¶é—´å¤æ‚åº¦å¯èƒ½æ¥è¿‘ &lt;strong&gt;O(n * m)&lt;/strong&gt;ï¼Œæ€§èƒ½ä¼šéå¸¸å·®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å½“ &lt;code&gt;c&lt;/code&gt;ä¸º &lt;code&gt;Set&lt;/code&gt;(å¦‚ &lt;code&gt;HashSet&lt;/code&gt;)&lt;/strong&gt;: å…¶ &lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•åŸºäº&lt;strong&gt;å“ˆå¸Œè¡¨&lt;/strong&gt;å®ç°ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ˆå“ˆå¸Œå†²çªè¾ƒå°‘ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º &lt;strong&gt;O(1)&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€æ— è®ºé›†åˆ &lt;code&gt;c&lt;/code&gt;æœ‰å¤šå¤§ï¼Œæ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨çš„æ—¶é—´å‡ ä¹æ˜¯æ’å®šçš„ã€‚å› æ­¤ï¼Œæ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸»è¦å–å†³äºå¾…æ¸…ç†çš„ &lt;code&gt;ArrayList&lt;/code&gt;çš„å¤§å°ï¼Œå³ &lt;strong&gt;O(n)&lt;/strong&gt;ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è½¬æ¢å‚æ•°ä¸º Set&lt;/strong&gt;ï¼šå¦‚æœè°ƒç”¨ &lt;code&gt;list.removeAll(otherList)&lt;/code&gt;ä¸” &lt;code&gt;otherList&lt;/code&gt;å¾ˆå¤§ï¼Œ&lt;strong&gt;å¼ºçƒˆå»ºè®®&lt;/strong&gt;å…ˆå°† &lt;code&gt;otherList&lt;/code&gt;è½¬æ¢ä¸º &lt;code&gt;HashSet&lt;/code&gt;å†ä¼ å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// ä¼˜åŒ–æ–¹æ¡ˆï¼šå°†Listå‚æ•°è½¬æ¢ä¸ºHashSet
list.removeAll(new HashSet&amp;lt;&amp;gt;(otherList));
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·è™½ç„¶åˆ›å»º &lt;code&gt;HashSet&lt;/code&gt;æœ‰ä¸€ç‚¹ç‚¹å¼€é”€ï¼Œä½†ä¸åç»­å·¨å¤§çš„æ€§èƒ½æå‡ç›¸æ¯”ï¼Œè¿™ç‚¹å¼€é”€å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå°¤å…¶æ˜¯åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›´æ¥ä½¿ç”¨ Set ç±»å‹&lt;/strong&gt;ï¼šå¦‚æœä¸šåŠ¡åœºæ™¯å…è®¸ï¼Œå¹¶ä¸”ä½ æ­£åœ¨å¤„ç†å¤§é‡éœ€è¦æ­¤ç±»æ“ä½œçš„é›†åˆï¼Œ&lt;strong&gt;è€ƒè™‘ä»ä¸€å¼€å§‹å°±ä½¿ç”¨ &lt;code&gt;Set&lt;/code&gt;è€Œä¸æ˜¯ &lt;code&gt;List&lt;/code&gt;&lt;/strong&gt; æ¥å­˜å‚¨å…ƒç´ ï¼Œä»¥é¿å…é‡å¤è½¬æ¢å’Œåˆ©ç”¨å…¶å›ºæœ‰çš„é«˜æ€§èƒ½æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„å¯¹è±¡ hashCode å’Œ equals&lt;/strong&gt;ï¼š&lt;code&gt;HashSet&lt;/code&gt;çš„é«˜æ•ˆåŸºäºè‰¯å¥½çš„å“ˆå¸Œåˆ†å¸ƒå’Œæ­£ç¡®çš„ &lt;code&gt;equals&lt;/code&gt;æ–¹æ³•ã€‚ç¡®ä¿è¦ç§»é™¤çš„å…ƒç´ ç±»æ­£ç¡®é‡å†™äº† &lt;code&gt;hashCode()&lt;/code&gt;å’Œ &lt;code&gt;equals(Object obj)&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä¸¾ä¸ªä¾‹å­"&gt;ğŸ’¡ ä¸¾ä¸ªä¾‹å­
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å« 10000 ä¸ªå…ƒç´ çš„ &lt;code&gt;ArrayList&lt;/code&gt;(&lt;code&gt;list&lt;/code&gt;)ï¼Œè¦ç§»é™¤å¦ä¸€ä¸ªåŒ…å« 1000 ä¸ªå…ƒç´ çš„é›†åˆ (&lt;code&gt;collectionToRemove&lt;/code&gt;) ä¸­ä¹Ÿå­˜åœ¨çš„å…ƒç´ ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;collectionToRemove&lt;/code&gt;æ˜¯ &lt;code&gt;ArrayList&lt;/code&gt;ï¼Œ&lt;code&gt;list.removeAll(collectionToRemove)&lt;/code&gt;å¯èƒ½éœ€è¦è¿›è¡Œçº¦ 10000 * 1000 = 10,000,000 æ¬¡æ¯”è¾ƒã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;collectionToRemove&lt;/code&gt;æ˜¯ &lt;code&gt;HashSet&lt;/code&gt;ï¼Œ&lt;code&gt;list.removeAll(collectionToRemove)&lt;/code&gt;å¯èƒ½éœ€è¦è¿›è¡Œçº¦ 10000 * 1 = 10,000 æ¬¡å“ˆå¸ŒæŸ¥æ‰¾ï¼ˆå®é™…ä¸Šæ¯æ¬¡æŸ¥æ‰¾çš„æˆæœ¬å¾ˆä½ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-9"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜æƒè¡¡&lt;/strong&gt;ï¼š&lt;code&gt;HashSet&lt;/code&gt;ç›¸æ¯” &lt;code&gt;ArrayList&lt;/code&gt;é€šå¸¸ä¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œå› ä¸ºéœ€è¦ç»´æŠ¤å“ˆå¸Œè¡¨ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…ƒç´ é¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;HashSet&lt;/code&gt;ä¸ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œè€Œ &lt;code&gt;List&lt;/code&gt;é€šå¸¸æ˜¯æœ‰åºçš„ã€‚ä½†è¿™ä¸å½±å“ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œçš„ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°æ•°æ®é‡å·®å¼‚ä¸æ˜æ˜¾&lt;/strong&gt;ï¼šå¦‚æœå‚ä¸æ“ä½œçš„é›†åˆéå¸¸å°ï¼Œæ€§èƒ½å·®å¼‚å¯èƒ½å¾®ä¹å…¶å¾®ï¼Œç”šè‡³å› ä¸ºåˆ›å»º &lt;code&gt;HashSet&lt;/code&gt;çš„å¼€é”€è€Œç¨æ…¢ã€‚ä¼˜åŒ–é€šå¸¸åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶æ•ˆæœæ˜¾è‘—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œ&lt;strong&gt;åœ¨éœ€è¦å¯¹ &lt;code&gt;List&lt;/code&gt;è¿›è¡Œ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œä¸”å‚æ•°é›†åˆè¾ƒå¤§æ—¶ï¼Œå°†å…¶è½¬æ¢ä¸º &lt;code&gt;HashSet&lt;/code&gt;å†ä¼ å…¥æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id="removeall-çº¿ç¨‹å®‰å…¨"&gt;removeAll çº¿ç¨‹å®‰å…¨
&lt;/h2&gt;&lt;p&gt;Java ä¸­ &lt;code&gt;List.removeAll(Collection)&lt;/code&gt;æ–¹æ³•&lt;strong&gt;æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/strong&gt;ã€‚å½“ä¼ å…¥çš„ &lt;code&gt;Collection&lt;/code&gt;å‚æ•°åŠ¨æ€å˜åŒ–æ—¶ï¼Œ&lt;strong&gt;å¾ˆå¯èƒ½å¯¼è‡´é”™è¯¯æˆ–ä¸å¯é¢„çŸ¥çš„è¡Œä¸º&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-ä¸»è¦é£é™©ä¸å…·ä½“è¡¨ç°"&gt;âš ï¸ ä¸»è¦é£é™©ä¸å…·ä½“è¡¨ç°
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¹¶å‘ä¿®æ”¹å¼‚å¸¸ (&lt;code&gt;ConcurrentModificationException&lt;/code&gt;)&lt;/strong&gt;: è¿™æ˜¯æœ€å¸¸è§çš„é”™è¯¯ã€‚å¦‚æœåœ¨éå†å‚æ•°é›†åˆ &lt;code&gt;c&lt;/code&gt;çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†è¯¥é›†åˆï¼ˆå¦‚æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰ï¼Œè¿­ä»£å™¨ä¼šæ£€æµ‹åˆ°è¿™ç§ä¿®æ”¹å¹¶ç«‹å³æŠ›å‡º &lt;code&gt;ConcurrentModificationException&lt;/code&gt;ï¼Œå¯¼è‡´ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œå¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸ä¸€è‡´å’Œæœªå®šä¹‰è¡Œä¸º&lt;/strong&gt;: å³ä½¿æœªæŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨å¹¶å‘ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œ&lt;code&gt;removeAll&lt;/code&gt;çš„æ‰§è¡Œç»“æœä¹Ÿæ˜¯ä¸å¯é¢„æµ‹çš„ã€‚å®ƒå¯èƒ½æ— æ³•ç§»é™¤æ‰€æœ‰é¢„æœŸçš„å…ƒç´ ï¼Œæˆ–è€…ç§»é™¤äº†éé¢„æœŸçš„å…ƒç´ ï¼Œå› ä¸ºå…¶å†…éƒ¨ä½¿ç”¨çš„é›†åˆâ€œå¿«ç…§â€å·²ç»è¿‡æœŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½é—®é¢˜&lt;/strong&gt;: &lt;code&gt;removeAll&lt;/code&gt;æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦é€šå¸¸ä¸º O(n*m)ï¼ˆn æ˜¯åˆ—è¡¨å¤§å°ï¼Œm æ˜¯å‚æ•°é›†åˆå¤§å°ï¼‰ã€‚å¦‚æœå‚æ•°é›†åˆå¾ˆå¤§ä¸”åœ¨æ“ä½œè¿‡ç¨‹ä¸­è¢«é¢‘ç¹ä¿®æ”¹ï¼Œå¯èƒ½ä¼šåŠ å‰§æ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ç§»é™¤"&gt;ğŸ›¡ï¸ å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ç§»é™¤
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨åœ°ä½¿ç”¨ &lt;code&gt;removeAll&lt;/code&gt;æˆ–ç±»ä¼¼åŠŸèƒ½ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åŒæ­¥å— (Synchronization)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ‰§è¡Œ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œå‰åï¼Œä½¿ç”¨åŒæ­¥é”&lt;strong&gt;åŒæ—¶ä¿æŠ¤ç›®æ ‡åˆ—è¡¨å’Œå‚æ•°é›†åˆ&lt;/strong&gt;ï¼Œç¡®ä¿åœ¨æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰å…¶ä»–çº¿ç¨‹èƒ½ä¿®æ”¹è¿™ä¸¤ä¸ªé›†åˆã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å‡è®¾ list å’Œ collectionToRemove æ˜¯éœ€è¦æ“ä½œçš„é›†åˆ
synchronized (list) {
synchronized (collectionToRemove) {
list.removeAll(collectionToRemove);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç®€å•ç›´æ¥ï¼Œé€‚ç”¨äºå„ç§é›†åˆç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šç²’åº¦è¾ƒç²—ï¼Œæ€§èƒ½è¾ƒä½ï¼Œå®¹æ˜“å¯¼è‡´æ­»é”ï¼Œéœ€è°¨æ…è®¾è®¡é”é¡ºåºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±» (Thread-safe Collections)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†ç›®æ ‡ &lt;code&gt;List&lt;/code&gt;æ›¿æ¢ä¸º &lt;strong&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/strong&gt;ã€‚ä½†è¯·æ³¨æ„ï¼Œ&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;çš„ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œä¼šé”å®šæ•´ä¸ªåˆ—è¡¨ï¼Œå¹¶ä¸”å¯èƒ½äº§ç”Ÿè¾ƒå¤§çš„æ•°ç»„æ‹·è´å¼€é”€ï¼Œ&lt;strong&gt;å®ƒæ›´é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®ä¿å‚æ•°é›†åˆä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¾‹å¦‚ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ KeySet&lt;/strong&gt; æˆ– &lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;åŒ…è£…çš„é›†åˆï¼Œå¹¶åœ¨è¿­ä»£æ—¶è¿›è¡Œå¤–éƒ¨åŒæ­¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºå‚æ•°é›†åˆçš„å‰¯æœ¬ (Create a Snapshot Copy)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒç”¨ &lt;code&gt;removeAll&lt;/code&gt;ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä»½å‚æ•°é›†åˆçš„å‰¯æœ¬ï¼Œç„¶åå¯¹å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚è¿™å¯ä»¥é¿å…åœ¨éå†è¿‡ç¨‹ä¸­åŸé›†åˆè¢«ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;String&amp;gt; snapshotCopy = new ArrayList&amp;lt;&amp;gt;(dynamicCollection); // åˆ›å»ºå¿«ç…§
list.removeAll(snapshotCopy);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå®ç°ç®€å•ï¼Œé¿å…äº†ç›´æ¥æ“ä½œåŠ¨æ€é›†åˆå¸¦æ¥çš„å¹¶å‘é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¦‚æœåŸé›†åˆéå¸¸å¤§ï¼Œåˆ›å»ºå‰¯æœ¬ä¼šæœ‰æ€§èƒ½å’Œå†…å­˜å¼€é”€ã€‚å¹¶ä¸”ï¼Œæ­¤å¿«ç…§æ— æ³•åæ˜ åˆ›å»ºä¹‹ååŸé›†åˆçš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å®ç”¨å»ºè®®-1"&gt;ğŸ’¡ å®ç”¨å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯„ä¼°éœ€æ±‚&lt;/strong&gt;ï¼šé¦–å…ˆç¡®è®¤æ˜¯å¦çœŸçš„éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åŠ¨æ€ä¿®æ”¹ä½œä¸ºå‚æ•°çš„é›†åˆã€‚å¦‚æœèƒ½é€šè¿‡è®¾è®¡é¿å…è¿™ç§æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œæå‰å‡†å¤‡å¥½ä¸€ä¸ªä¸å¯å˜çš„å‚æ•°é›†åˆï¼‰ï¼Œå°†æ˜¯æœ€å¥½å’Œæœ€å®‰å…¨çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œéå¸¸é¢‘ç¹ä¸”é›†åˆå¾ˆå¤§ï¼ŒåŒæ­¥å’Œæ‹·è´æ–¹æ¡ˆéƒ½å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè€ƒè™‘ä½¿ç”¨æ›´é«˜çº§çš„å¹¶å‘æ¨¡å‹æˆ–æ•°æ®ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨å¹¶å‘é›†åˆ&lt;/strong&gt;ï¼šå¯¹äºå…¨æ–°çš„ä»£ç ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ &lt;code&gt;java.util.concurrent&lt;/code&gt;åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼‰ï¼Œå®ƒä»¬ä¸ºå¹¶å‘è®¿é—®è®¾è®¡äº†æ›´ç²¾ç»†çš„é”æœºåˆ¶æˆ–æ— é”ç®—æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œç›´æ¥åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä½¿ç”¨åŠ¨æ€å˜åŒ–çš„ &lt;code&gt;Collection&lt;/code&gt;è°ƒç”¨ &lt;code&gt;List.removeAll&lt;/code&gt;æ˜¯ä¸å®‰å…¨çš„ã€‚åŠ¡å¿…é€šè¿‡åŒæ­¥ã€ä½¿ç”¨çº¿ç¨‹å®‰å…¨é›†åˆæˆ–åˆ›å»ºå‰¯æœ¬ç­‰æ‰‹æ®µæ¥ä¿è¯æ“ä½œçš„æ­£ç¡®æ€§ã€‚&lt;/p&gt;
&lt;h2 id="å¤åˆæ“ä½œ"&gt;å¤åˆæ“ä½œ
&lt;/h2&gt;&lt;p&gt;äº†è§£ä½ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹é›†åˆæ“ä½œçš„è°¨æ…æ€åº¦ã€‚åˆ›å»ºåªè¯»å¿«ç…§ç„¶åæ¸…ç©ºåŸé›†åˆè¿™ä¸€å¤åˆæ“ä½œï¼Œ&lt;strong&gt;æ˜¯å¦éœ€è¦åŠ é”ï¼Œå®Œå…¨å–å†³äºä½ ä½¿ç”¨çš„é›†åˆç±»å‹å’Œä½ çš„çº¿ç¨‹å®‰å…¨è¦æ±‚&lt;/strong&gt;ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†æ ¸å¿ƒç»“è®ºï¼Œå¸®ä½ å¿«é€Ÿåˆ¤æ–­ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ“ä½œåœºæ™¯&lt;/th&gt;
&lt;th&gt;é›†åˆç±»å‹&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€è¦é¢å¤–åŠ é”&lt;/th&gt;
&lt;th&gt;å…³é”®åŸå› &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æ¬¡æ“ä½œ&lt;/strong&gt; (ä»… &lt;code&gt;clear()&lt;/code&gt;æˆ–ä»…åˆ›å»ºå¿«ç…§)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•ä¸ªæ–¹æ³•è°ƒç”¨å†…éƒ¨å·²ä¿è¯åŸå­æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æ¬¡æ“ä½œ&lt;/strong&gt; (ä»… &lt;code&gt;clear()&lt;/code&gt;æˆ–ä»…åˆ›å»ºå¿«ç…§)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•ä¸ªæ–¹æ³•è°ƒç”¨å†…éƒ¨å·²ä¿è¯åŸå­æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤åˆæ“ä½œ&lt;/strong&gt; (åˆ›å»ºå¿«ç…§&lt;strong&gt;åç«‹åˆ»&lt;/strong&gt;æ¸…ç©º)&lt;/td&gt;
&lt;td&gt;ä»»ä½•çº¿ç¨‹å®‰å…¨é›†åˆ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿è¯ä¸¤ä¸ªç‹¬ç«‹æ“ä½œä¹‹é—´çš„åŸå­æ€§ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹åœ¨é—´éš™ä¿®æ”¹é›†åˆã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•å®ç°å¤åˆæ“ä½œçš„åŸå­æ€§"&gt;ğŸ› ï¸ å¦‚ä½•å®ç°å¤åˆæ“ä½œçš„åŸå­æ€§
&lt;/h3&gt;&lt;p&gt;è‹¥ä½ éœ€è¦â€œåˆ›å»ºå¿«ç…§åç«‹åˆ»æ¸…ç©ºâ€æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•å…ƒï¼Œå¿…é¡»ä½¿ç”¨å¤–éƒ¨åŒæ­¥ï¼ˆå¦‚ &lt;code&gt;synchronized&lt;/code&gt;å—ï¼‰å°†è¿™ä¸¤ä¸ªæ“ä½œæ†ç»‘åœ¨ä¸€èµ·ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å‡è®¾ä½ æœ‰ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Set
Set&amp;lt;String&amp;gt; threadSafeSet = Collections.synchronizedSet(new HashSet&amp;lt;&amp;gt;());
// æˆ– Set&amp;lt;String&amp;gt; threadSafeSet = ConcurrentHashMap.newKeySet();
// ä½¿ç”¨ synchronized å—ç¡®ä¿åˆ›å»ºå¿«ç…§å’Œæ¸…ç©ºçš„åŸå­æ€§
synchronized (threadSafeSet) { // æ³¨æ„ï¼šå¦‚æœä½¿ç”¨ ConcurrentHashMap.newKeySet(), æ­¤å¤„åŒæ­¥å—å¯èƒ½å¤±æ•ˆï¼Œè¯¦è§ä¸‹æ–‡æ³¨æ„äº‹é¡¹
// 1. åˆ›å»ºåªè¯»å¿«ç…§
Set&amp;lt;String&amp;gt; readOnlySnapshot = new HashSet&amp;lt;&amp;gt;(threadSafeSet); // æˆ– Collections.unmodifiableSet(new HashSet&amp;lt;&amp;gt;(threadSafeSet))
// 2. æ¸…ç©ºåŸé›†åˆ
threadSafeSet.clear();
}
// æ­¤æ—¶åŒæ­¥å—ç»“æŸï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­æ“ä½œ
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;çš„ç‰¹æ®Šæ€§&lt;/strong&gt;ï¼šç”± &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;è¿”å›çš„ Setï¼Œå…¶è¿­ä»£å™¨æ˜¯&lt;strong&gt;å¼±ä¸€è‡´æ€§&lt;/strong&gt;çš„ã€‚ è¿™æ„å‘³ç€åˆ›å»ºå¿«ç…§ï¼ˆå³é€šè¿‡æ„é€ å‡½æ•° &lt;code&gt;new HashSet&amp;lt;&amp;gt;(concurrentSet)&lt;/code&gt;è¿›è¡Œè¿­ä»£ï¼‰æ—¶ï¼Œ&lt;strong&gt;å¯èƒ½æ— æ³•æ•è·åˆ°è¿­ä»£å™¨åˆ›å»ºé‚£ä¸€åˆ»çš„ç»å¯¹ç²¾ç¡®çŠ¶æ€&lt;/strong&gt;ï¼Œä½†èƒ½é¿å…æŠ›å‡º &lt;code&gt;ConcurrentModificationException&lt;/code&gt;ã€‚å¦‚æœä½ éœ€è¦&lt;strong&gt;ç»å¯¹ç²¾ç¡®&lt;/strong&gt;çš„å¿«ç…§ï¼Œåˆ™éœ€é¢å¤–åŒæ­¥ã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹ &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;è¿”å›çš„é›†åˆä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å¤–éƒ¨åŒæ­¥å—&lt;strong&gt;æ— æ³•å®ç°çœŸæ­£çš„äº’æ–¥&lt;/strong&gt;ï¼Œå› ä¸ºå…¶å†…éƒ¨å¹¶æœªä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å®ç°çº¿ç¨‹å®‰å…¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº† CAS ç­‰æœºåˆ¶ã€‚ å¯¹äºéœ€è¦å¼ºä¸€è‡´æ€§å¿«ç…§çš„åœºæ™¯ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘å…¶ä»–æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿­ä»£å™¨çš„æ˜¾å¼åŒæ­¥&lt;/strong&gt;ï¼šå³ä½¿æ˜¯ &lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;è¿”å›çš„é›†åˆï¼Œå…¶è¿­ä»£å™¨ä¹Ÿå¿…é¡»&lt;strong&gt;åœ¨æ‰‹åŠ¨åŒæ­¥å—ä¸­è¿›è¡Œéå†&lt;/strong&gt;ï¼Œå¦åˆ™å¯èƒ½åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å‘ç”Ÿå¹¶å‘ä¿®æ”¹ã€‚ ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨ &lt;code&gt;synchronized&lt;/code&gt;å—å†…åˆ›å»ºæ–°é›†åˆï¼ˆå³è¿­ä»£ï¼‰æ˜¯æ­£ç¡®çš„åšæ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å—ä¼š&lt;strong&gt;é˜»å¡å…¶ä»–æ‰€æœ‰çº¿ç¨‹&lt;/strong&gt;å¯¹è¯¥é›†åˆçš„è®¿é—®ã€‚å› æ­¤ï¼Œåº”å°½é‡ç¼©çŸ­åŒæ­¥å—å†…çš„ä»£ç æ‰§è¡Œæ—¶é—´ï¼Œä»¥é¿å…æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šæ ¹æ®ä½ çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ‰æ—¶å¯ä»¥è®¾è®¡ä¸ºä¸è¦æ±‚è¿™ç§ç»å¯¹çš„åŸå­æ€§ã€‚æˆ–è€…ï¼Œåœ¨æŸäº›è¯»è¿œå¤šäºå†™çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ &lt;code&gt;CopyOnWriteArraySet&lt;/code&gt;å¯èƒ½æ˜¯å¦ä¸€ç§é€‰æ‹©ï¼Œä½†å…¶è¿­ä»£å™¨èƒ½åæ˜ åˆ›å»ºæ—¶çš„çŠ¶æ€ï¼Œä¸” &lt;code&gt;clear()&lt;/code&gt;æ“ä½œä¼šå¤åˆ¶æ•°ç»„ï¼Œå¼€é”€è¾ƒå¤§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘å…è®¸â€œåˆ›å»ºå¿«ç…§â€å’Œâ€œæ¸…ç©ºé›†åˆâ€è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨å¾®å°çš„å»¶è¿Ÿ&lt;/strong&gt;ï¼Œå¹¶ä¸”ä½ ä½¿ç”¨çš„é›†åˆæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;æˆ– &lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;ï¼‰ï¼Œé‚£ä¹ˆ&lt;strong&gt;ä¸ä¸€å®šéœ€è¦é¢å¤–åŠ é”&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœä½ è¦æ±‚â€œåˆ›å»ºå¿«ç…§â€å’Œâ€œæ¸…ç©ºé›†åˆâ€å¿…é¡»ä½œä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„åŸå­æ“ä½œ&lt;/strong&gt;ï¼Œå³åœ¨å¿«ç…§åˆ›å»ºåæ²¡æœ‰ä»»ä½•å…¶ä»–çº¿ç¨‹èƒ½æ’å…¥æ–°çš„å…ƒç´ ï¼Œé‚£ä¹ˆ&lt;strong&gt;ä½ å¿…é¡»ä½¿ç”¨å¤–éƒ¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ &lt;code&gt;synchronized&lt;/code&gt;å—ï¼‰&lt;/strong&gt; æ¥åŒ…è£¹è¿™ä¸¤ä¸ªæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ ¹æ®å®é™…åœºæ™¯åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ï¼&lt;/p&gt;
&lt;h2 id="synchronized"&gt;synchronized
&lt;/h2&gt;&lt;p&gt;ç†è§£ä½ å…³äº &lt;code&gt;synchronized&lt;/code&gt;é”çš„ç–‘é—®ã€‚ç®€å•æ¥è¯´ï¼Œ&lt;strong&gt;&lt;code&gt;synchronized&lt;/code&gt;é”å®šçš„å¯¹è±¡å¹¶éåœ¨å…¶ä»–ä»»ä½•åœ°æ–¹éƒ½æ— æ³•ä½¿ç”¨&lt;/strong&gt;ã€‚å®ƒåªé˜»æ­¢å…¶ä»–çº¿ç¨‹&lt;strong&gt;è·å–åŒä¸€ä¸ªé”å¯¹è±¡&lt;/strong&gt;æ¥æ‰§è¡Œç›¸åº”çš„åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ï¼Œè€Œå¯¹è±¡çš„å…¶ä»–æ“ä½œé€šå¸¸ä¸å—å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘ç”¨ä¸€ä¸ªæµç¨‹å›¾æ¥å±•ç¤ºå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è®¿é—®è¯¥å¯¹è±¡ä¸åŒéƒ¨åˆ†çš„è¡Œä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[å…¶ä»–çº¿ç¨‹å°è¯•è®¿é—®&amp;lt;br&amp;gt;è¢«synchronizedé”ä½çš„å¯¹è±¡] --&amp;gt; B{è®¿é—®ä»€ä¹ˆ?}
B -- ésynchronizedæ–¹æ³•/ä»£ç å— --&amp;gt; C[âœ… å…è®¸è®¿é—®&amp;lt;br&amp;gt;æ— éœ€è·å–é”]
B -- synchronizedæ–¹æ³•/ä»£ç å—&amp;lt;br&amp;gt;ä¸”éœ€åŒä¸€æŠŠé” --&amp;gt; D{å°è¯•è·å–åŒä¸€å¯¹è±¡é”}
D -- è·å–æˆåŠŸ --&amp;gt; E[âœ… è¿›å…¥åŒæ­¥ä»£ç ]
D -- è·å–å¤±è´¥&amp;lt;br&amp;gt;ï¼ˆé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼‰ --&amp;gt; F[â›” é˜»å¡ç­‰å¾…]
B -- å…¶ä»–å¯¹è±¡çš„&amp;lt;br&amp;gt;synchronizedæ–¹æ³• --&amp;gt; G[âœ… å…è®¸è®¿é—®&amp;lt;br&amp;gt;é”å¯¹è±¡ä¸åŒï¼Œäº’ä¸å¹²æ‰°]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šå›¾ç›´è§‚å±•ç¤ºäº†é”çš„æ ¸å¿ƒè§„åˆ™ï¼š&lt;strong&gt;åŒæ­¥åªå‘ç”Ÿåœ¨ç«äº‰åŒä¸€æŠŠé”çš„çº¿ç¨‹ä¹‹é—´&lt;/strong&gt;ã€‚ä¸‹é¢æˆ‘ä»¬å†æ·±å…¥çœ‹çœ‹è¿™äº›è§„åˆ™å’Œä¸€äº›æ³¨æ„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h3 id="-ç†è§£synchronizedçš„é”è§„åˆ™"&gt;ğŸ”’ ç†è§£synchronizedçš„é”è§„åˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”å¯¹è±¡è€Œéå¯¹è±¡æœ¬èº«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;å…³é”®å­—é”å®šçš„æ˜¯&lt;strong&gt;ä½œä¸ºé”çš„é‚£ä¸ªå¯¹è±¡å®ä¾‹&lt;/strong&gt;ï¼ˆæˆ– Class å¯¹è±¡ï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œã€‚å…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è‡ªç”±è°ƒç”¨è¯¥å¯¹è±¡çš„éåŒæ­¥æ–¹æ³•ï¼ˆ&lt;code&gt;non-synchronized methods&lt;/code&gt;ï¼‰ï¼Œæˆ–è€…è®¿é—®å…¶å­—æ®µï¼ˆé™¤éæœ‰å…¶ä»–åŒæ­¥æªæ–½ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒæ­¥æ–¹æ³• vs éåŒæ­¥æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸€ä¸ªå¯¹è±¡çš„ &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œå®ƒè·å–çš„æ˜¯&lt;strong&gt;è¯¥å¯¹è±¡å®ä¾‹çš„é”&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ­£å¸¸è°ƒç”¨è¯¥å¯¹è±¡çš„&lt;strong&gt;é &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;ã€‚å¦‚æœè¿™äº›éåŒæ­¥æ–¹æ³•ç›´æ¥è®¿é—®äº†å…±äº«æ•°æ®ï¼Œå¯èƒ½ä¼šå¼•å‘æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸åŒçš„é”å¯¹è±¡äº’ä¸å¹²æ‰°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯&lt;strong&gt;åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹&lt;/strong&gt;ï¼Œé‚£ä¹ˆå®ƒä»¬æ— æ³•åŒæ—¶è¿›å…¥è¯¥å¯¹è±¡çš„ä¸¤ä¸ªä¸åŒçš„ &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯&lt;strong&gt;ä¸åŒçš„å¯¹è±¡å®ä¾‹&lt;/strong&gt;ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥åŒæ—¶è¿›å…¥åŒä¸€ &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•ï¼Œå› ä¸ºè·å–çš„æ˜¯å„è‡ªå¯¹è±¡çš„é”ï¼Œäº’ä¸å¹²æ‰°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»é” (Class Lock) ä¸å®ä¾‹é” (Instance Lock)&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;synchronized&lt;/code&gt;ä¿®é¥°é™æ€æ–¹æ³•æˆ–æŒ‡å®š &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡æ—¶ï¼Œè·å–çš„æ˜¯&lt;strong&gt;ç±»é”&lt;/strong&gt;ã€‚ç±»é”å’Œå®ä¾‹é”æ˜¯&lt;strong&gt;ä¸åŒçš„é”&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å› æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªå¯¹è±¡çš„å®ä¾‹é”æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–è¯¥ç±»çš„ç±»é”å»æ‰§è¡Œé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸¤è€…ä¸ä¼šäº’æ–¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-10"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡å°‘åŒæ­¥èŒƒå›´&lt;/strong&gt;ï¼šä¸ºäº†æé«˜å¹¶å‘æ€§èƒ½ï¼Œåº”å°½é‡&lt;strong&gt;å‡å°åŒæ­¥ä»£ç å—çš„èŒƒå›´&lt;/strong&gt;ï¼Œåªå¯¹çœŸæ­£éœ€è¦çº¿ç¨‹å®‰å…¨çš„ä»£ç åŠ é”ã€‚é¿å…å°†æ•´ä¸ªæ–¹æ³•æˆ–å¤§é‡æ“ä½œä¸åŠ åŒºåˆ†åœ°åŒæ­¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°¨æ…é€‰æ‹©é”å¯¹è±¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é€šå¸¸ä½¿ç”¨ &lt;code&gt;private final&lt;/code&gt;å¯¹è±¡ä½œä¸ºé”ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final Object lock = new Object();
...
synchronized(lock) { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¿å…ä½¿ç”¨ &lt;code&gt;String&lt;/code&gt;å­—é¢é‡æˆ–å¯èƒ½è¢«é‡ç”¨çš„å¯¹è±¡ä½œä¸ºé”ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åœ¨æœªçŸ¥çš„åœ°æ–¹è¢«å…±äº«ï¼Œå¯¼è‡´æ„å¤–çš„æ­»é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹Ÿ&lt;strong&gt;ä¸å»ºè®®ä½¿ç”¨ &lt;code&gt;synchronized(this)&lt;/code&gt;&lt;/strong&gt;ï¼Œå› ä¸ºè¿™ä¼šå°†å¯¹è±¡å®ä¾‹æœ¬èº«æš´éœ²ä¸ºé”ï¼Œå¤–éƒ¨ä»£ç ä¹Ÿå¯èƒ½åŒæ­¥æ­¤å¯¹è±¡ï¼Œå¯¼è‡´éš¾ä»¥é¢„æ–™å’Œè¯Šæ–­çš„æ­»é”é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-8"&gt;ğŸ’¡ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;é”å®šçš„å¯¹è±¡æœ¬èº«&lt;strong&gt;å¹¶éå®Œå…¨æ— æ³•ä½¿ç”¨&lt;/strong&gt;ï¼Œå…¶æ ¸å¿ƒè§„åˆ™æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥åªå‘ç”Ÿåœ¨ç«äº‰åŒä¸€æŠŠé”çš„çº¿ç¨‹ä¹‹é—´&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æŒæœ‰å¯¹è±¡é”æ—¶ï¼Œåªé˜»æ­¢å…¶ä»–çº¿ç¨‹&lt;strong&gt;è·å–åŒä¸€ä¸ªé”å¯¹è±¡&lt;/strong&gt;æ¥æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹è±¡çš„&lt;strong&gt;éåŒæ­¥æ–¹æ³•&lt;/strong&gt;ã€&lt;strong&gt;å…¶ä»–é”ä¿æŠ¤çš„åŒæ­¥æ–¹æ³•&lt;/strong&gt;ä»¥åŠ&lt;strong&gt;å…¶ä»–å®ä¾‹çš„æ–¹æ³•&lt;/strong&gt;é€šå¸¸éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šå’Œå›¾è¡¨èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ &lt;code&gt;synchronized&lt;/code&gt;é”çš„è¡Œä¸ºã€‚åœ¨è®¾è®¡å¤šçº¿ç¨‹ç¨‹åºæ—¶ï¼Œè¯·åŠ¡å¿…æ˜ç¡®é”çš„èŒƒå›´å’Œå¯¹è±¡ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨çš„åŒæ—¶é¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚&lt;/p&gt;
&lt;h2 id="synchronized-åŒæ­¥"&gt;synchronized åŒæ­¥
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;classA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ClassB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;a&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;synchronized&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// do something&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;b&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;xxx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®ä½ æä¾›çš„ä»£ç ï¼Œ&lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¸­å¯¹ &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡æˆå‘˜ï¼ˆ&lt;code&gt;cb.xxx = xxx&lt;/code&gt;ï¼‰çš„è®¿é—®&lt;strong&gt;ä¸ä¼šè¢«&lt;/strong&gt; &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„ &lt;code&gt;synchronized(cb)&lt;/code&gt;é”é”å®šã€‚&lt;/p&gt;
&lt;h3 id="-åŸå› åˆ†æ"&gt;ğŸ” åŸå› åˆ†æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;synchronized&lt;/code&gt;æœºåˆ¶çš„æœ¬è´¨&lt;/strong&gt;ï¼š&lt;code&gt;synchronized(obj)&lt;/code&gt;å…³é”®å­—ç”¨äºè·å–æŒ‡å®šå¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ &lt;code&gt;cb&lt;/code&gt;ï¼‰çš„&lt;strong&gt;ç›‘è§†å™¨é”ï¼ˆMonitor Lockï¼‰&lt;/strong&gt;ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¿è¯&lt;strong&gt;åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;èƒ½å¤Ÿè¿›å…¥æ‰€æœ‰ä»¥è¯¥å¯¹è±¡ (&lt;code&gt;cb&lt;/code&gt;) ä½œä¸ºé”çš„&lt;strong&gt;åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•&lt;/strong&gt;ã€‚å®ƒå¹¶ä¸ç›´æ¥é”å®šå¯¹è±¡æœ¬èº«çš„å†…å­˜è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”çš„äº’æ–¥èŒƒå›´&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚çº¿ç¨‹Aï¼‰æ­£åœ¨æ‰§è¡Œ &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„ &lt;code&gt;synchronized(cb)&lt;/code&gt;ä»£ç å—ï¼Œæ„å‘³ç€å®ƒå·²ç»æˆåŠŸè·å–äº† &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„é”ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œå¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚çº¿ç¨‹Bï¼‰è¯•å›¾æ‰§è¡Œ&lt;strong&gt;ä»»ä½•ä¹Ÿä»¥ &lt;code&gt;cb&lt;/code&gt;ä¸ºé”çš„åŒæ­¥ä»£ç å—&lt;/strong&gt;ï¼ˆä¾‹å¦‚å¦ä¸€ä¸ª &lt;code&gt;synchronized(cb)&lt;/code&gt;å—ï¼‰ï¼Œçº¿ç¨‹Bå°†ä¼šè¢«&lt;strong&gt;é˜»å¡&lt;/strong&gt;ï¼Œç›´åˆ°çº¿ç¨‹Aé‡Šæ”¾ &lt;code&gt;cb&lt;/code&gt;çš„é”ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶è€Œï¼Œä½ çš„ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¸­çš„æ“ä½œ (&lt;code&gt;cb.xxx = xxx&lt;/code&gt;) &lt;strong&gt;å¹¶æ²¡æœ‰è¢«ä»»ä½•åŒæ­¥æœºåˆ¶ä¿æŠ¤&lt;/strong&gt;ã€‚å®ƒä¸ä¼šå°è¯•å»è·å– &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„é”ã€‚å› æ­¤ï¼Œå³ä½¿çº¿ç¨‹Aæ­£æŒæœ‰ &lt;code&gt;cb&lt;/code&gt;çš„é”å¹¶åœ¨æ‰§è¡Œ &lt;code&gt;a()&lt;/code&gt;ä¸­çš„åŒæ­¥å—ï¼Œçº¿ç¨‹Bä¾ç„¶å¯ä»¥ç›´æ¥æ‰§è¡Œ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•å¹¶å¯¹ &lt;code&gt;cb&lt;/code&gt;çš„æˆå‘˜è¿›è¡Œèµ‹å€¼ï¼Œ&lt;strong&gt;ä¸ä¼šå‘ç”Ÿé˜»å¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;b()&lt;/code&gt;ä¸­çš„è®¿é—®ä¸ä¼šè¢«é˜»å¡ï¼Œä½†è¿™ç§è®¾è®¡ä¼šå¸¦æ¥ä¸¥é‡çš„&lt;strong&gt;çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„åŒæ­¥å—æ­£åœ¨è¯»å–æˆ–ä¿®æ”¹ &lt;code&gt;cb&lt;/code&gt;çš„æŸäº›çŠ¶æ€ï¼Œè€ŒåŒæ—¶ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¹Ÿåœ¨å¹¶å‘åœ°ä¿®æ”¹ &lt;code&gt;cb&lt;/code&gt;çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™äº›æ“ä½œå¯èƒ½ä¼šäº¤å‰è¿›è¡Œï¼Œå¯¼è‡´æœ€ç»ˆç»“æœä¸å¯é¢„æµ‹ï¼Œç ´åæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§æ€§ï¼ˆVisibilityï¼‰&lt;/strong&gt;ï¼šå³ä½¿ &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•åœ¨åŒæ­¥å—å†…ä¿®æ”¹äº† &lt;code&gt;cb&lt;/code&gt;çš„çŠ¶æ€ï¼Œè¿™äº›ä¿®æ”¹å¯èƒ½ä¸ä¼šç«‹å³å¯¹å…¶ä»–çº¿ç¨‹ï¼ˆä¾‹å¦‚è°ƒç”¨ &lt;code&gt;b()&lt;/code&gt;çš„çº¿ç¨‹ï¼‰å¯è§ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ²¡æœ‰æ­£ç¡®åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å¯èƒ½ä¼šç¼“å­˜å˜é‡çš„å‰¯æœ¬ã€‚&lt;code&gt;synchronized&lt;/code&gt;å…³é”®å­—é™¤äº†ä¿è¯åŸå­æ€§ï¼Œè¿˜èƒ½ä¿è¯å¯è§æ€§â€”â€”å½“çº¿ç¨‹é€€å‡ºåŒæ­¥å—æ—¶ï¼Œä¼šå¼ºåˆ¶å°†å·¥ä½œå†…å­˜ä¸­çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼›å½“çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­ç›¸åº”å˜é‡çš„å€¼ï¼Œä»ä¸»å†…å­˜é‡æ–°è¯»å–ã€‚è€Œ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ç¼ºä¹è¿™ç§ä¿éšœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨"&gt;ğŸ’¡ å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨
&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ éœ€è¦ç¡®ä¿å¯¹ &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„æ‰€æœ‰è®¿é—®éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€é”æœºåˆ¶ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;classA&lt;/code&gt;å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª&lt;strong&gt;ä¸“ç”¨çš„ã€æœ€ç»ˆçš„é”å¯¹è±¡&lt;/strong&gt;æ¥ä¿æŠ¤æ‰€æœ‰å¯¹ &lt;code&gt;cb&lt;/code&gt;çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class classA {
private ClassB cb;
private final Object lock = new Object(); // ä¸“ç”¨çš„é”å¯¹è±¡
void a() {
synchronized(lock) { // ä½¿ç”¨ç»Ÿä¸€çš„é”
// å®‰å…¨åœ°æ“ä½œ cb
}
}
void b() {
synchronized(lock) { // ä½¿ç”¨åŒä¸€ä¸ªé”
cb.xxx = xxx; // ç°åœ¨å®‰å…¨äº†
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·ï¼Œæ— è®ºæ˜¯ &lt;code&gt;a()&lt;/code&gt;è¿˜æ˜¯ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ï¼Œè¦è®¿é—® &lt;code&gt;cb&lt;/code&gt;éƒ½å¿…é¡»å…ˆè·å¾— &lt;code&gt;lock&lt;/code&gt;è¿™ä¸ªå”¯ä¸€çš„é”ï¼Œä»è€Œå®ç°äº†äº’æ–¥è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®© &lt;code&gt;ClassB&lt;/code&gt;æˆä¸ºçº¿ç¨‹å®‰å…¨ç±»&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;ClassB&lt;/code&gt;çš„å†…éƒ¨å®ç°ä¸­ï¼Œé€šè¿‡åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—æ¥ä¿è¯å…¶è‡ªèº«çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨ã€‚è¿™æ ·ï¼Œå¤–éƒ¨è°ƒç”¨æ—¶å³ä½¿æ²¡æœ‰åŒæ­¥ï¼Œå…¶æ–¹æ³•ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-9"&gt;âœ… æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ä¸€å¥è¯å›ç­”ï¼š&lt;strong&gt;ä¸ä¼šé”å®š&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¸­å¯¹ &lt;code&gt;cb.xxx&lt;/code&gt;çš„èµ‹å€¼æ“ä½œä¸ä¼šå› ä¸º &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„ &lt;code&gt;synchronized(cb)&lt;/code&gt;è€Œé˜»å¡ï¼Œå› ä¸ºå®ƒæ ¹æœ¬æ²¡æœ‰å°è¯•å»è·å– &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„é”ã€‚è¿™ç§è®¾è®¡å­˜åœ¨æ•°æ®ç«äº‰å’Œå¯è§æ€§é—®é¢˜ã€‚è‹¥è¦å®ç°çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦å¯¹æ‰€æœ‰è®¿é—® &lt;code&gt;cb&lt;/code&gt;å…±äº«èµ„æºçš„ä»£ç è·¯å¾„è¿›è¡Œé€‚å½“çš„åŒæ­¥ã€‚&lt;/p&gt;
&lt;h2 id="profile-active"&gt;@profile-active@
&lt;/h2&gt;&lt;p&gt;ã€‚åœ¨ä½ æœ¬åœ°è¿è¡Œæ—¶ï¼Œ&lt;code&gt;@profile-active@&lt;/code&gt;è‡ªåŠ¨å˜æˆ &lt;code&gt;local&lt;/code&gt;ï¼Œè¿™é€šå¸¸æ˜¯ &lt;strong&gt;Maven çš„èµ„æºé…ç½®è¿‡æ»¤ï¼ˆResource Filteringï¼‰åŠŸèƒ½&lt;/strong&gt; å’Œ &lt;strong&gt;Spring Boot çš„ Profile æœºåˆ¶&lt;/strong&gt; å…±åŒä½œç”¨çš„ç»“æœã€‚ä¸‹é¢æˆ‘æ¥è§£é‡Šä¸€ä¸‹åŸå› å’Œè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶maven-èµ„æºè¿‡æ»¤"&gt;ğŸ› ï¸ &lt;strong&gt;æ ¸å¿ƒæœºåˆ¶ï¼šMaven èµ„æºè¿‡æ»¤&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Maven åœ¨ç¼–è¯‘é¡¹ç›®æ—¶ï¼ˆä¾‹å¦‚æ‰§è¡Œ &lt;code&gt;mvn compile&lt;/code&gt;æˆ– &lt;code&gt;mvn package&lt;/code&gt;ï¼‰ï¼Œå¦‚æœå¼€å¯äº†èµ„æºè¿‡æ»¤ï¼ˆFilteringï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç† &lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹çš„æŸäº›æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å ä½ç¬¦ï¼ˆä¾‹å¦‚ &lt;code&gt;@propertyName@&lt;/code&gt;æˆ– &lt;code&gt;${propertyName}&lt;/code&gt;ï¼‰æ›¿æ¢ä¸º POM æ–‡ä»¶ä¸­å®šä¹‰çš„å¯¹åº”å±æ€§çš„å®é™…å€¼ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;POM æ–‡ä»¶ä¸­çš„ Profiles é…ç½®&lt;/strong&gt;ï¼šä½ çš„é¡¹ç›® POM æ–‡ä»¶ï¼ˆ&lt;code&gt;pom.xml&lt;/code&gt;ï¼‰ä¸­å¾ˆå¯èƒ½å®šä¹‰äº†å¤šä¸ª Maven Profilesï¼Œä¾‹å¦‚æœ¬åœ°å¼€å‘ï¼ˆlocalï¼‰ã€æµ‹è¯•ç¯å¢ƒï¼ˆtestï¼‰ã€ç”Ÿäº§ç¯å¢ƒï¼ˆprodï¼‰ç­‰ã€‚è¿™äº› Profiles å¯ä»¥ç”¨æ¥åœ¨æ„å»ºæ—¶æŒ‡å®šä¸åŒçš„é…ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;profiles&amp;gt;
&amp;lt;profile&amp;gt;
&amp;lt;!-- æœ¬åœ°å¼€å‘ç¯å¢ƒ --&amp;gt;
&amp;lt;id&amp;gt;local&amp;lt;/id&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;!-- å®šä¹‰äº†ä¸€ä¸ªåä¸º profiles.active çš„å±æ€§ï¼Œå…¶å€¼ä¸º local --&amp;gt;
&amp;lt;profiles.active&amp;gt;local&amp;lt;/profiles.active&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;activation&amp;gt;
&amp;lt;!-- è®¾ç½®è¯¥ profile ä¸ºé»˜è®¤æ¿€æ´» --&amp;gt;
&amp;lt;activeByDefault&amp;gt;true&amp;lt;/activeByDefault&amp;gt;
&amp;lt;/activation&amp;gt;
&amp;lt;/profile&amp;gt;
&amp;lt;profile&amp;gt;
&amp;lt;!-- æµ‹è¯•ç¯å¢ƒ --&amp;gt;
&amp;lt;id&amp;gt;test&amp;lt;/id&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;profiles.active&amp;gt;test&amp;lt;/profiles.active&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;/profile&amp;gt;
&amp;lt;!-- å¯èƒ½è¿˜æœ‰å…¶ä»–ç¯å¢ƒé…ç½® --&amp;gt;
&amp;lt;/profiles&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œ&lt;code&gt;local&lt;/code&gt;Profile é€šå¸¸è¢«è®¾ç½®ä¸º &lt;code&gt;&amp;lt;activeByDefault&amp;gt;true&amp;lt;/activeByDefault&amp;gt;&lt;/code&gt;ï¼Œè¿™æ„å‘³ç€å¦‚æœæ²¡æœ‰é€šè¿‡ &lt;code&gt;-P&lt;/code&gt;å‚æ•°æ˜¾å¼æŒ‡å®šå…¶ä»– Profileï¼ŒMaven å°±ä¼šä½¿ç”¨ &lt;code&gt;local&lt;/code&gt;è¿™ä¸ª Profile çš„é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºè¿‡æ»¤çš„é…ç½®&lt;/strong&gt;ï¼šä¸ºäº†è®© Maven åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ›¿æ¢é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦ï¼Œéœ€è¦åœ¨ POM æ–‡ä»¶çš„ &lt;code&gt;&amp;lt;build&amp;gt;&lt;/code&gt;éƒ¨åˆ†é…ç½®èµ„æºè¿‡æ»¤ï¼Œå¹¶å¼€å¯ &lt;code&gt;filtering&lt;/code&gt;é€‰é¡¹ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;build&amp;gt;
&amp;lt;resources&amp;gt;
&amp;lt;resource&amp;gt;
&amp;lt;directory&amp;gt;src/main/resources&amp;lt;/directory&amp;gt;
&amp;lt;filtering&amp;gt;true&amp;lt;/filtering&amp;gt; &amp;lt;!-- å…³é”®ï¼šå¼€å¯è¿‡æ»¤ --&amp;gt;
&amp;lt;includes&amp;gt;
&amp;lt;include&amp;gt;application.yml&amp;lt;/include&amp;gt; &amp;lt;!-- æŒ‡å®šéœ€è¦è¿‡æ»¤çš„æ–‡ä»¶ --&amp;gt;
&amp;lt;!-- å¯èƒ½è¿˜åŒ…æ‹¬å…¶ä»–é…ç½®æ–‡ä»¶ --&amp;gt;
&amp;lt;/includes&amp;gt;
&amp;lt;/resource&amp;gt;
&amp;lt;/resources&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å ä½ç¬¦çš„åŒ¹é…&lt;/strong&gt;ï¼šä½ çš„ &lt;code&gt;application.yml&lt;/code&gt;æ–‡ä»¶ä¸­åŒ…å«äº† &lt;code&gt;'@profile-active@'&lt;/code&gt;ï¼ˆæœç´¢ç»“æœä¸­å¤šä¸º &lt;code&gt;@profiles.active@&lt;/code&gt;ï¼Œä½†æœºåˆ¶ç›¸åŒï¼‰ã€‚Maven åœ¨å¤„ç†è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šæŸ¥æ‰¾ POM ä¸­å½“å‰æ¿€æ´»çš„ Profile é‡Œå®šä¹‰çš„å±æ€§ã€‚ç”±äºé»˜è®¤æ¿€æ´»çš„æ˜¯ &lt;code&gt;local&lt;/code&gt;Profileï¼Œä¸”è¯¥ Profile å®šä¹‰äº† &lt;code&gt;&amp;lt;profiles.active&amp;gt;local&amp;lt;/profiles.active&amp;gt;&lt;/code&gt;ï¼ŒMaven å°±ä¼šç”¨ &lt;code&gt;local&lt;/code&gt;è¿™ä¸ªå€¼å»æ›¿æ¢ &lt;code&gt;@profile-active@&lt;/code&gt;è¿™ä¸ªå ä½ç¬¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-spring-boot-çš„é…åˆ"&gt;ğŸ”§ &lt;strong&gt;Spring Boot çš„é…åˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Spring Boot åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œä¼šè¯»å– &lt;code&gt;application.yml&lt;/code&gt;ä¸­ &lt;code&gt;spring.profiles.active&lt;/code&gt;çš„å€¼æ¥ç¡®å®šåº”è¯¥æ¿€æ´»å“ªä¸ªæˆ–å“ªäº›Spring Profileã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»è¿‡ Maven èµ„æºè¿‡æ»¤åï¼Œä½ çš„é…ç½®å®é™…ä¸Šå˜æˆäº†ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
profiles:
active: &amp;#39;local&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› æ­¤ï¼ŒSpring Boot åº”ç”¨å°±ä¼šä½¿ç”¨ &lt;code&gt;application-local.yml&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;application-local.properties&lt;/code&gt;ï¼‰ç­‰é’ˆå¯¹æœ¬åœ°ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶åŠ è½½å…¶ä¸­å®šä¹‰çš„å±æ€§ã€Bean ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä¸åŒç¯å¢ƒçš„æ„å»ºä¸é…ç½®æ›¿æ¢"&gt;ğŸ“Š &lt;strong&gt;ä¸åŒç¯å¢ƒçš„æ„å»ºä¸é…ç½®æ›¿æ¢&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸‹è¡¨æ¦‚æ‹¬äº†ä¸åŒ Maven Profile å¦‚ä½•å½±å“æœ€ç»ˆçš„ Spring Profileï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Maven Profile (é€šè¿‡ &lt;code&gt;-P&lt;/code&gt;æŒ‡å®š)&lt;/th&gt;
&lt;th&gt;Maven å±æ€§ &lt;code&gt;profiles.active&lt;/code&gt;çš„å€¼&lt;/th&gt;
&lt;th&gt;æœ€ç»ˆ &lt;code&gt;spring.profiles.active&lt;/code&gt;çš„å€¼&lt;/th&gt;
&lt;th&gt;Spring Boot åŠ è½½çš„é…ç½®æ–‡ä»¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;(ä¸æŒ‡å®šï¼Œä½¿ç”¨é»˜è®¤)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local&lt;/code&gt;(ç”± &lt;code&gt;&amp;lt;activeByDefault&amp;gt;&lt;/code&gt;æŒ‡å®š)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application-local.yml&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-P test&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application-test.yml&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-P prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application-prod.yml&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-11"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿èµ„æºè¿‡æ»¤å·²å¼€å¯&lt;/strong&gt;ï¼šæ£€æŸ¥ä½ çš„ &lt;code&gt;pom.xml&lt;/code&gt;ï¼Œç¡®è®¤åœ¨ &lt;code&gt;&amp;lt;build&amp;gt;&amp;lt;resources&amp;gt;&lt;/code&gt;ä¸­ä¸ºåŒ…å« &lt;code&gt;application.yml&lt;/code&gt;çš„ç›®å½•è®¾ç½®äº† &lt;code&gt;&amp;lt;filtering&amp;gt;true&amp;lt;/filtering&amp;gt;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Parent POM çš„ä½¿ç”¨&lt;/strong&gt;ï¼šå¦‚æœä½ çš„é¡¹ç›®ç»§æ‰¿äº† &lt;code&gt;spring-boot-starter-parent&lt;/code&gt;ï¼Œå®ƒå·²ç»é¢„é…ç½®äº†ä¸€äº›èµ„æºè¿‡æ»¤è§„åˆ™ï¼Œè¿™é€šå¸¸ä¼šç®€åŒ–ä½ çš„é…ç½®å¹¶ç¡®ä¿è¿‡æ»¤æ­£å¸¸å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œè¦†ç›–&lt;/strong&gt;ï¼šå³ä½¿åœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­è®¾ç½®äº†é»˜è®¤å€¼ï¼Œä½ åœ¨é€šè¿‡ &lt;code&gt;mvn&lt;/code&gt;å‘½ä»¤æ‰“åŒ…æ—¶ä»ç„¶å¯ä»¥ä½¿ç”¨ &lt;code&gt;-P&lt;/code&gt;å‚æ•°æ¥è¦†ç›–é»˜è®¤çš„ Profileï¼Œä¾‹å¦‚ &lt;code&gt;mvn clean package -P test&lt;/code&gt;ï¼Œè¿™æ ·æœ€ç»ˆç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¸­ &lt;code&gt;@profile-active@&lt;/code&gt;å°±ä¼šè¢«æ›¿æ¢ä¸º &lt;code&gt;test&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;@profile-active@&lt;/code&gt;è‡ªåŠ¨å˜æˆ &lt;code&gt;local&lt;/code&gt;ï¼Œæ˜¯å› ä¸º Maven åœ¨æ„å»ºæ—¶ï¼Œæ ¹æ®å…¶ POM æ–‡ä»¶ä¸­é»˜è®¤æ¿€æ´»çš„ &lt;code&gt;local&lt;/code&gt;Profile é‡Œå®šä¹‰çš„å±æ€§å€¼ï¼Œå¯¹è¿™ä¸ªå ä½ç¬¦è¿›è¡Œäº†è‡ªåŠ¨æ›¿æ¢ã€‚è¿™æ˜¯å®ç° &lt;strong&gt;ä¸åŒç¯å¢ƒå·®å¼‚åŒ–æ„å»º&lt;/strong&gt; çš„ä¸€ç§å¸¸è§æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id="applicationcontextinitializer"&gt;ApplicationContextInitializer
&lt;/h2&gt;&lt;p&gt;ApplicationContextInitializer æŠ›å‡ºå¼‚å¸¸å¯¼è‡´ç¨‹åºå¯åŠ¨å¤±è´¥ï¼Œæ˜¯å› ä¸ºå®ƒåœ¨ Spring Boot å¯åŠ¨æµç¨‹ä¸­æ‰®æ¼”ç€â€œå¼€è·¯å…ˆé”‹â€çš„è§’è‰²ã€‚å®ƒä¸€æ—¦å‡ºé”™ï¼Œåç»­çš„å®¹å™¨åˆå§‹åŒ–å·¥ä½œå°±æ— æ³•ç»§ç»­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®åŠ©ä½ æ›´ç›´è§‚åœ°ç†è§£å®ƒåœ¨æ•´ä¸ªå¯åŠ¨æµç¨‹ä¸­çš„å…³é”®ä½ç½®ï¼Œä»¥åŠä¸ºä½•å®ƒçš„å¼‚å¸¸å¦‚æ­¤è‡´å‘½ï¼Œè¯·çœ‹ä¸‹é¢çš„æµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[SpringApplication.run()] --&amp;gt; B[åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ Context]
B --&amp;gt; C[æ‰§è¡Œ ApplicationContextInitializer&amp;lt;br&amp;gt;ï¼ˆåˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼‰]
C --&amp;gt; D{åˆå§‹åŒ–å™¨æ‰§è¡ŒæˆåŠŸ?}
D -- æ˜¯ --&amp;gt; E[åŠ è½½é…ç½®/Beanå®šä¹‰ç­‰]
E --&amp;gt; F[åˆ·æ–°ä¸Šä¸‹æ–‡&amp;lt;br&amp;gt;ï¼ˆIoCå®¹å™¨åˆå§‹åŒ–ï¼‰]
F --&amp;gt; G[åº”ç”¨å¯åŠ¨æˆåŠŸ]
D -- å¦&amp;lt;br&amp;gt;ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ --&amp;gt; H[å¯åŠ¨æµç¨‹ä¸­æ–­]
H --&amp;gt; I[åº”ç”¨å¯åŠ¨å¤±è´¥]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„æ‰§è¡Œæ˜¯ä¸Šä¸‹æ–‡å‡†å¤‡å°±ç»ªåã€å®¹å™¨åˆ·æ–°å‰çš„ä¸€ä¸ª&lt;strong&gt;å…³é”®æ­¥éª¤&lt;/strong&gt;ã€‚è¿™ä¸ªé˜¶æ®µå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ•´ä¸ªå¯åŠ¨æµç¨‹å°±ä¼šä¸­æ–­ã€‚&lt;/p&gt;
&lt;h3 id="-å¼‚å¸¸å¸¦æ¥çš„å…·ä½“å½±å“"&gt;âš ï¸ å¼‚å¸¸å¸¦æ¥çš„å…·ä½“å½±å“
&lt;/h3&gt;&lt;p&gt;å½“ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„ &lt;code&gt;initialize&lt;/code&gt;æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šäº§ç”Ÿä»¥ä¸‹è¿é”ååº”ï¼Œå¯¼è‡´å¯åŠ¨å¤±è´¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸­æ–­åˆå§‹åŒ–æµç¨‹&lt;/strong&gt;ï¼šSpring Boot çš„å¯åŠ¨è¿‡ç¨‹æ˜¯é¡ºåºçš„ã€ä¸¥æ ¼çš„ã€‚&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„åˆå§‹åŒ–æ˜¯ &lt;code&gt;prepareContext&lt;/code&gt;é˜¶æ®µçš„ä¸€éƒ¨åˆ†ï¼Œæ­¤é˜¶æ®µçš„å¼‚å¸¸ä¼šç›´æ¥å¯¼è‡´åç»­æ›´æ ¸å¿ƒçš„ &lt;code&gt;refreshContext&lt;/code&gt;ï¼ˆåˆ·æ–°å®¹å™¨ï¼‰æ–¹æ³•æ— æ³•æ‰§è¡Œã€‚ æ²¡æœ‰ç»è¿‡æ­£ç¡®åˆ·æ–°å’Œåˆå§‹åŒ–çš„ &lt;code&gt;ApplicationContext&lt;/code&gt;æ˜¯ä¸€ä¸ªä¸å®Œæ•´ã€æ— æ³•ä½¿ç”¨çš„å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç ´åä¸Šä¸‹æ–‡ä¸€è‡´æ€§&lt;/strong&gt;ï¼š&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„æœ¬èŒå·¥ä½œæ˜¯åœ¨å®¹å™¨åˆ·æ–°å‰å¯¹å…¶è¿›è¡Œâ€œä¿®é¥°â€ï¼Œä¾‹å¦‚è®¾ç½®ç¯å¢ƒå˜é‡ã€æ³¨å†Œè‡ªå®šä¹‰çš„ Bean å®šä¹‰æˆ–å±æ€§æºã€‚ å¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¸­é€”å¤±è´¥ï¼Œå¯èƒ½ä¼šä½¿åº”ç”¨ä¸Šä¸‹æ–‡å¤„äºä¸€ä¸ª&lt;strong&gt;ä¸ä¸€è‡´çš„çŠ¶æ€&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼ŒæŸäº›é…ç½®å·²åŠ è½½ï¼Œè€Œå¦ä¸€äº›åˆ™æ²¡æœ‰ï¼‰ã€‚Spring ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¼šé€‰æ‹©è®©å¯åŠ¨å¤±è´¥ï¼Œè€Œä¸æ˜¯å°è¯•æ¢å¤åˆ°ä¸€ä¸ªæœªçŸ¥çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§¦å‘å¯åŠ¨ç›‘å¬å™¨é“¾çš„å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šSpring Boot é€šè¿‡ &lt;code&gt;SpringApplicationRunListener&lt;/code&gt;æ¥å¹¿æ’­å¯åŠ¨è¿‡ç¨‹ä¸­çš„å„ä¸ªäº‹ä»¶ã€‚ å½“ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œ&lt;code&gt;finished&lt;/code&gt;äº‹ä»¶ä¼šæ¥æ”¶åˆ°è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼Œç»§è€Œè§¦å‘æ•´ä¸ªåº”ç”¨çš„å¯åŠ¨å¤±è´¥å¤„ç†é€»è¾‘ï¼Œå¹¶æ‰“å°å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¸¸è§çš„å¼‚å¸¸åŸå› åŠæ’æŸ¥å»ºè®®"&gt;ğŸ” å¸¸è§çš„å¼‚å¸¸åŸå› åŠæ’æŸ¥å»ºè®®
&lt;/h3&gt;&lt;p&gt;äº†è§£åŸå› åï¼Œæ’æŸ¥é—®é¢˜å°±æœ‰äº†æ–¹å‘ã€‚&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;ä¸­å¯èƒ½å¼•å‘å¯åŠ¨å¤±è´¥çš„å¼‚å¸¸é€šå¸¸åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®é”™è¯¯ï¼ˆ&lt;code&gt;IllegalStateException&lt;/code&gt;, &lt;code&gt;BeanDefinitionStoreException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨åˆå§‹åŒ–å™¨ä¸­å°è¯•æ³¨å†Œ Bean å®šä¹‰æˆ–è®¿é—®é…ç½®æ—¶ï¼Œé…ç½®ä¿¡æ¯ä¸æ­£ç¡®ã€ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œé”™è¯¯ä¿¡æ¯å¯èƒ½æåŠ &lt;code&gt;Failed to load ApplicationContext&lt;/code&gt;æˆ–å±æ€§é…ç½®é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šä»”ç»†æ£€æŸ¥åˆå§‹åŒ–å™¨ä¸­ä½¿ç”¨çš„æ‰€æœ‰é…ç½®å±æ€§ã€ç±»è·¯å¾„èµ„æºå’Œç¯å¢ƒå˜é‡ã€‚ç¡®ä¿åœ¨åˆå§‹åŒ–å™¨æ‰§è¡Œæ—¶ï¼Œå…¶æ‰€ä¾èµ–çš„å¤–éƒ¨é…ç½®å·²æ­£ç¡®åŠ è½½ä¸”å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç±»åŠ è½½æˆ–ä¾èµ–é—®é¢˜ï¼ˆ&lt;code&gt;NoClassDefFoundError&lt;/code&gt;, &lt;code&gt;ClassNotFoundException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåˆå§‹åŒ–å™¨ä»£ç ä¸­å¼•ç”¨äº†æŸä¸ªç±»ï¼Œä½†è¯¥ç±»åœ¨ç±»è·¯å¾„ä¸­ä¸å­˜åœ¨ï¼Œæˆ–è€…å…¶ä¾èµ–çš„ Jar åŒ…æœªè¢«æ­£ç¡®å¼•å…¥ã€‚è¿™åœ¨é¡¹ç›®å‡çº§æˆ–ä¾èµ–ç‰ˆæœ¬å˜æ›´æ—¶å°¤å…¶å¸¸è§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šç¡®è®¤é¡¹ç›®ä¾èµ–ï¼ˆå¦‚ Maven æˆ– Gradle é…ç½®ï¼‰çš„å®Œæ•´æ€§å’Œç‰ˆæœ¬å…¼å®¹æ€§ã€‚æ£€æŸ¥æ‰“åŒ…åçš„äº§ç‰©ä¸­æ˜¯å¦åŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ Jar åŒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bean å®šä¹‰æˆ–ä¾èµ–æ³¨å…¥é—®é¢˜ï¼ˆ&lt;code&gt;BeanCreationException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šè™½ç„¶è¾ƒå°‘ç›´æ¥åœ¨ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;ä¸­å‘ç”Ÿï¼Œä½†å¦‚æœåˆå§‹åŒ–å™¨å°è¯•è¿‡æ—©åœ°é€šè¿‡ä¸Šä¸‹æ–‡è·å–ä¸€ä¸ªå°šæœªå®Œæˆé…ç½®æˆ–å­˜åœ¨å¾ªç¯ä¾èµ–ç­‰é—®é¢˜çš„ Beanï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šå®¡è§†åˆå§‹åŒ–å™¨çš„é€»è¾‘ï¼Œé¿å…åœ¨ &lt;code&gt;initialize&lt;/code&gt;æ–¹æ³•ä¸­è¿‡æ—©åœ°è·å– Bean å®ä¾‹ã€‚ç¡®ä¿ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¸…æ™°ï¼Œæ— å¾ªç¯ä¾èµ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¨‹åºé€»è¾‘é”™è¯¯ï¼ˆå„ç§ &lt;code&gt;RuntimeException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåˆå§‹åŒ–å™¨è‡ªèº«çš„ä»£ç å­˜åœ¨ Bugï¼Œä¾‹å¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ã€æ•°ç»„è¶Šç•Œã€IO å¼‚å¸¸ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šå¯¹åˆå§‹åŒ–å™¨ä¸­çš„ä»£ç è¿›è¡Œä»”ç»†çš„ä»£ç å®¡æŸ¥å’Œè°ƒè¯•ã€‚æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿è·Ÿè¸ªæ‰§è¡Œæµç¨‹å’Œå˜é‡çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•è°ƒè¯•å’Œå®šä½é—®é¢˜"&gt;ğŸ’¡ å¦‚ä½•è°ƒè¯•å’Œå®šä½é—®é¢˜
&lt;/h3&gt;&lt;p&gt;å½“é‡åˆ°å›  &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;å¯¼è‡´çš„å¯åŠ¨å¤±è´¥æ—¶ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥çœ‹å®Œæ•´å †æ ˆè·Ÿè¸ª&lt;/strong&gt;ï¼šæ§åˆ¶å°è¾“å‡ºçš„å¼‚å¸¸ä¿¡æ¯æ˜¯é¦–è¦çº¿ç´¢ï¼Œå®ƒé€šå¸¸ä¼šæ˜ç¡®æŒ‡å‡ºå¼‚å¸¸ç±»å‹å’Œé¦–æ¬¡å‘ç”Ÿçš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨è°ƒè¯•æ¨¡å¼&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ  &lt;code&gt;--debug&lt;/code&gt;å‚æ•°ï¼Œæˆ–è®¾ç½®æ—¥å¿—çº§åˆ« &lt;code&gt;logging.level.org.springframework=DEBUG&lt;/code&gt;ï¼ŒSpring Boot ä¼šè¾“å‡ºæ›´è¯¦ç»†çš„å†…éƒ¨æ‰§è¡Œä¿¡æ¯ï¼Œå¸®åŠ©ä½ å®šä½é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥åˆå§‹åŒ–å™¨ä»£ç &lt;/strong&gt;ï¼šé‡ç‚¹å…³æ³¨ä½ è‡ªå·±çš„ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;å®ç°ä¸­çš„ &lt;code&gt;initialize&lt;/code&gt;æ–¹æ³•ï¼Œé€è¡Œæ£€æŸ¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥ä¾èµ–å’Œé…ç½®&lt;/strong&gt;ï¼šç¡®è®¤æ‰€æœ‰ç›¸å…³ä¾èµ–å·²æ­£ç¡®å¼•å…¥ï¼Œä¸”ç‰ˆæœ¬å…¼å®¹ã€‚æ£€æŸ¥ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;ç­‰é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æµ‹è¯•&lt;/strong&gt;ï¼šå¦‚æœå¯èƒ½ï¼Œå°è¯•å°†å¯ç–‘çš„åˆå§‹åŒ–å™¨æš‚æ—¶ç§»é™¤æˆ–æ³¨é‡Šæ‰ï¼Œçœ‹åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸å¯åŠ¨ï¼Œä»¥æ­¤åˆ¤æ–­é—®é¢˜æ˜¯å¦ç”±è¯¥åˆå§‹åŒ–å™¨å¼•èµ·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œ&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;å°±åƒæ˜¯ Spring Boot åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„ä¸€ä¸ª&lt;strong&gt;å…³é”®è´¨æ£€å‘˜&lt;/strong&gt;ï¼Œå®ƒçš„å·¥ä½œå¿…é¡»åœ¨ç”Ÿäº§çº¿ï¼ˆå®¹å™¨åˆ·æ–°ï¼‰å…¨é¢å¯åŠ¨å‰å®Œæˆã€‚ä¸€æ—¦è´¨æ£€å‘˜å‘ç°é‡å¤§é—®é¢˜å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ºäº†æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨ä¸ç¨³å®šï¼Œç”Ÿäº§çº¿å°±ä¸ä¼šè¢«å¯åŠ¨ã€‚&lt;/p&gt;
&lt;h2 id="ping"&gt;ping
&lt;/h2&gt;&lt;p&gt;æ ¹æ®æœç´¢ç»“æœï¼Œæ ‡å‡†çš„ &lt;code&gt;ping&lt;/code&gt;å‘½ä»¤&lt;strong&gt;ä¸èƒ½&lt;/strong&gt;ç”¨äºæ£€æµ‹å•ç‹¬çš„ç«¯å£ã€‚&lt;code&gt;ping&lt;/code&gt;å‘½ä»¤åŸºäº ICMP åè®®å·¥ä½œï¼Œè¯¥åè®®ä½äºç½‘ç»œå±‚ï¼Œåªèƒ½æµ‹è¯•åˆ°ç›®æ ‡IPåœ°å€çš„ç½‘ç»œè¿é€šæ€§ï¼Œè€Œç«¯å£å±äºä¼ è¾“å±‚çš„æ¦‚å¿µï¼Œå› æ­¤ &lt;code&gt;ping&lt;/code&gt;æ— æ³•ç›´æ¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œæœ‰è®¸å¤šå…¶ä»–ä¸“é—¨ç”¨äºæµ‹è¯•ç«¯å£è¿é€šæ€§çš„å·¥å…·å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ä¸‹è¡¨æ±‡æ€»äº†è¿™äº›å¸¸ç”¨çš„æ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å·¥å…·åç§°&lt;/th&gt;
&lt;th&gt;åŸºæœ¬å‘½ä»¤æ ¼å¼&lt;/th&gt;
&lt;th&gt;ä¸»è¦ç‰¹ç‚¹ / è¾“å‡ºè¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;telnet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;telnet &amp;lt;ç›®æ ‡IP&amp;gt; &amp;lt;ç«¯å£å·&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºTCPç«¯å£ã€‚è¿æ¥æˆåŠŸä¼šæ˜¾ç¤º &lt;code&gt;Connected to ...&lt;/code&gt;ï¼›å¤±è´¥åˆ™æ˜¾ç¤º &lt;code&gt;Connection refused&lt;/code&gt;æˆ–è¶…æ—¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;nc (netcat)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;nc -zv &amp;lt;ç›®æ ‡IP&amp;gt; &amp;lt;ç«¯å£å·&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºTCP/UDPç«¯å£ã€‚&lt;code&gt;-z&lt;/code&gt;è¡¨ç¤ºæ‰«æï¼Œ&lt;code&gt;-v&lt;/code&gt;æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚æˆåŠŸè¾“å‡º &lt;code&gt;succeeded!&lt;/code&gt;ï¼›å¤±è´¥è¾“å‡º &lt;code&gt;failed: Connection refused&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;nmap&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;nmap -p &amp;lt;ç«¯å£å·&amp;gt; &amp;lt;ç›®æ ‡IP&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŠŸèƒ½å¼ºå¤§çš„ç«¯å£æ‰«æå™¨ã€‚å¯æ‰«æå•ä¸ªç«¯å£ã€èŒƒå›´æˆ–å…¨éƒ¨ç«¯å£ï¼Œå¹¶æ˜¾ç¤ºçŠ¶æ€ï¼ˆopen, closed, filteredï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Test-NetConnection&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Test-NetConnection &amp;lt;ç›®æ ‡IP&amp;gt; -Port &amp;lt;ç«¯å£å·&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Windows PowerShell è‡ªå¸¦å‘½ä»¤ï¼Œèƒ½æä¾›è¯¦ç»†çš„ç«¯å£æµ‹è¯•ç»“æœã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å·¥å…·é€‰æ‹©ä¸ä½¿ç”¨å»ºè®®"&gt;ğŸ’¡ å·¥å…·é€‰æ‹©ä¸ä½¿ç”¨å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿæ£€æŸ¥å•ä¸ªTCPç«¯å£&lt;/strong&gt;ï¼šåœ¨Linuxæˆ–macOSä¸Šï¼Œ&lt;code&gt;nc&lt;/code&gt;ï¼ˆnetcatï¼‰æˆ– &lt;code&gt;telnet&lt;/code&gt;æ˜¯è½»é‡å¿«æ·çš„é€‰æ‹©ã€‚åœ¨Windowsä¸Šï¼Œå¯ä»¥ä½¿ç”¨PowerShellçš„ &lt;code&gt;Test-NetConnection&lt;/code&gt;æˆ–å®‰è£… &lt;code&gt;telnet&lt;/code&gt;å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦è¯¦ç»†æ‰«æä¿¡æ¯&lt;/strong&gt;ï¼šå¦‚æœä½ éœ€è¦äº†è§£ç«¯å£çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚æœåŠ¡ç‰ˆæœ¬ï¼‰æˆ–è¿›è¡Œæ‰¹é‡ç«¯å£æ‰«æï¼Œ&lt;code&gt;nmap&lt;/code&gt;æ˜¯æœ€ä¸“ä¸šçš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼šä½¿ç”¨è¿™äº›å·¥å…·å‰ï¼Œè¯·ç¡®ä¿ä½ æœ‰æƒé™å¯¹ç›®æ ‡IPè¿›è¡Œç«¯å£æµ‹è¯•ï¼Œä»¥å…è¿åç½‘ç»œå®‰å…¨è§„å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æœ‰æ•ˆåœ°æµ‹è¯•ç«¯å£è¿é€šæ€§ã€‚å¦‚æœä½ æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼ˆä¾‹å¦‚æƒ³æµ‹è¯•æŸä¸ªå…·ä½“æœåŠ¡çš„ç«¯å£ï¼‰ï¼Œæˆ‘å¯ä»¥ä¸ºä½ æä¾›æ›´å…·ä½“çš„å‘½ä»¤ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;h2 id="mvmw"&gt;mvmw
&lt;/h2&gt;&lt;p&gt;Maven é¡¹ç›®&lt;strong&gt;å¹¶éå¤©ç”Ÿå°±è‡ªå¸¦ &lt;code&gt;./mvnw&lt;/code&gt;æ–‡ä»¶&lt;/strong&gt;ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ &lt;strong&gt;Maven Wrapperï¼ˆç®€ç§° mvnwï¼‰&lt;/strong&gt; çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªéœ€è¦é¢å¤–é…ç½®åˆ°é¡¹ç›®ä¸­çš„å·¥å…·ï¼Œç›®çš„æ˜¯ç¡®ä¿æ‰€æœ‰å¼€å‘è€…ï¼ˆåŒ…æ‹¬æŒç»­é›†æˆç¯å¢ƒï¼‰éƒ½ä½¿ç”¨å®Œå…¨ä¸€è‡´çš„ Maven ç‰ˆæœ¬è¿›è¡Œæ„å»ºï¼Œä»è€Œé¿å…å› æœ¬åœ° Maven ç‰ˆæœ¬ä¸åŒè€Œå¯¼è‡´çš„å„ç§é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id="-maven-wrapper-æ˜¯ä»€ä¹ˆ"&gt;ğŸ”§ Maven Wrapper æ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h3&gt;&lt;p&gt;Maven Wrapper ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ–‡ä»¶ç»„æˆï¼Œé€šå¸¸ä½äºé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;mvnw&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äº Linux æˆ– macOS ç³»ç»Ÿçš„ Shell è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;mvnw.cmd&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äº Windows ç³»ç»Ÿçš„æ‰¹å¤„ç†è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;.mvn/wrapper/&lt;/code&gt;ç›®å½•&lt;/strong&gt;ï¼šåŒ…å«é…ç½®æ–‡ä»¶ï¼ˆ&lt;code&gt;maven-wrapper.properties&lt;/code&gt;ï¼‰å’Œæ ¸å¿ƒ JAR æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šå½“ä½ é¦–æ¬¡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ &lt;code&gt;./mvnw clean install&lt;/code&gt;ï¼ˆLinux/macOSï¼‰æˆ– &lt;code&gt;mvnw.cmd clean install&lt;/code&gt;ï¼ˆWindowsï¼‰å‘½ä»¤æ—¶ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶ä¸‹è½½é¡¹ç›®æŒ‡å®šçš„ Maven ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨è¯¥ç‰ˆæœ¬è¿›è¡Œæ„å»ºã€‚&lt;/p&gt;
&lt;h3 id="-å“ªäº›é¡¹ç›®ä¼šè‡ªå¸¦-mvnw"&gt;ğŸ“ å“ªäº›é¡¹ç›®ä¼šè‡ªå¸¦ Mvnwï¼Ÿ
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ Maven Wrapper ä¸æ˜¯æ ‡å‡†é…ç½®ï¼Œä½†ä½ åœ¨ä¸€äº›ç°ä»£æ¡†æ¶ç”Ÿæˆçš„é¡¹ç›®ä¸­ä¼šç»å¸¸çœ‹åˆ°å®ƒï¼Œæœ€å¸¸è§çš„å°±æ˜¯ &lt;strong&gt;Spring Boot&lt;/strong&gt; é¡¹ç›®ã€‚å½“ä½ ä½¿ç”¨ Spring Initializr ç”Ÿæˆä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼Œå®ƒä¼šé»˜è®¤åŒ…å« Maven Wrapper çš„ç›¸å…³æ–‡ä»¶ï¼Œè¿™å·²ç»æˆä¸ºä¸€ç§æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;h3 id="-ä½¿ç”¨-mvnw-ä¸ç³»ç»Ÿ-maven-çš„å¯¹æ¯”"&gt;ğŸ’¡ ä½¿ç”¨ Mvnw ä¸ç³»ç»Ÿ Maven çš„å¯¹æ¯”
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†è®©ä½ æ›´æ¸…æ™°åœ°äº†è§£åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ &lt;code&gt;./mvnw&lt;/code&gt;(Maven Wrapper)&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ &lt;code&gt;mvn&lt;/code&gt;å‘½ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¯å¢ƒè¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åªéœ€å®‰è£… JDKï¼Œæ— éœ€é¢„å…ˆå®‰è£… Maven&lt;/td&gt;
&lt;td&gt;å¿…é¡»æå‰å®‰è£…å¹¶é…ç½®å¥½ Maven&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸¥æ ¼ä¸€è‡´&lt;/strong&gt;ï¼Œä½¿ç”¨é¡¹ç›®é…ç½®ä¸­æŒ‡å®šçš„ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;å–å†³äºæ¯ä½å¼€å‘è€…è‡ªå·±ç”µè„‘ä¸Šçš„ Maven ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›¢é˜Ÿåä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¨è&lt;/strong&gt;ï¼Œèƒ½æœ‰æ•ˆé¿å…â€œåœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘â€çš„é—®é¢˜&lt;/td&gt;
&lt;td&gt;å®¹æ˜“å› ç‰ˆæœ¬å·®å¼‚å¯¼è‡´æ„å»ºå¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CI/CD é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç®€åŒ–é…ç½®&lt;/strong&gt;ï¼ŒCI æœåŠ¡å™¨æ— éœ€é¢„è£…ç‰¹å®šç‰ˆæœ¬ Maven&lt;/td&gt;
&lt;td&gt;éœ€è¦åœ¨ CI ç¯å¢ƒä¸­æ‰‹åŠ¨å®‰è£…å’Œç»´æŠ¤ Maven&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•ä¸ºé¡¹ç›®æ·»åŠ -maven-wrapper"&gt;ğŸ› ï¸ å¦‚ä½•ä¸ºé¡¹ç›®æ·»åŠ  Maven Wrapperï¼Ÿ
&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ çš„é¡¹ç›®è¿˜æ²¡æœ‰ Maven Wrapperï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ·»åŠ ã€‚å‰ææ˜¯ä½ çš„ç”µè„‘ä¸Šå·²ç»å®‰è£…äº†ä¸€ä¸ªå¯ç”¨çš„ Mavenï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;mvn -N io.takari:maven:wrapper
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ–è€…æŒ‡å®šä½ å¸Œæœ›é¡¹ç›®ä½¿ç”¨çš„ Maven ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;mvn -N io.takari:maven:wrapper -Dmaven=3.9.6
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰§è¡ŒæˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ° &lt;code&gt;mvnw&lt;/code&gt;ã€&lt;code&gt;mvnw.cmd&lt;/code&gt;å’Œ &lt;code&gt;.mvn/wrapper&lt;/code&gt;ç›®å½•è¢«åˆ›å»ºå‡ºæ¥ã€‚è¯·åŠ¡å¿…å°†è¿™äº›æ–‡ä»¶**æäº¤åˆ°é¡¹ç›®çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰**ä¸­ï¼Œè¿™æ ·å…¶ä»–å¼€å‘è€…æ‹‰å–ä»£ç åå°±èƒ½ç›´æ¥ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;h3 id="-æ€»ç»“-10"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;./mvnw&lt;/code&gt;æ˜¯ Maven Wrapper æä¾›çš„è„šæœ¬ï¼Œå®ƒ&lt;strong&gt;ä¸æ˜¯ Maven é¡¹ç›®çš„é»˜è®¤é…ç½®ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ºäº†æå‡å›¢é˜Ÿåä½œå’Œæ„å»ºä¸€è‡´æ€§è€Œå¼•å…¥çš„å¢å¼ºå·¥å…·&lt;/strong&gt;ã€‚å¯¹äºæ–°é¡¹ç›®ï¼Œç‰¹åˆ«æ˜¯å›¢é˜Ÿåˆä½œæˆ–ç”¨äº CI/CD ç¯å¢ƒçš„é¡¹ç›®ï¼Œå¼ºçƒˆå»ºè®®é›†æˆ Maven Wrapperã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ã€‚å¦‚æœä½ å¯¹ç”Ÿæˆ Maven Wrapper çš„å…·ä½“æ­¥éª¤æˆ–è€…é…ç½®æœ‰æ›´å¤šç–‘é—®ï¼Œæˆ‘å¯ä»¥æä¾›æ›´è¯¦ç»†çš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id="properties"&gt;properties
&lt;/h2&gt;&lt;p&gt;æ ¹æ® Spring Boot çš„çº¦å®šï¼Œ&lt;strong&gt;å¯ä»¥æœ‰ç¯å¢ƒåç¼€&lt;/strong&gt;ã€‚åƒ &lt;code&gt;application-local.properties&lt;/code&gt;è¿™æ ·çš„å‘½åæ˜¯å®Œå…¨ç¬¦åˆè§„åˆ™çš„ï¼Œå®ƒæ­£æ˜¯ Spring Boot ç”¨äºæ”¯æŒå¤šç¯å¢ƒé…ç½®çš„æ ¸å¿ƒç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°å±•ç¤ºäº†å¤šç¯å¢ƒé…ç½®æ–‡ä»¶çš„å‘½åè§„åˆ™å’Œä½œç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ç½®æ–‡ä»¶åç§°&lt;/th&gt;
&lt;th&gt;ä½œç”¨è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;application.properties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¸»é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸å­˜æ”¾&lt;strong&gt;é€šç”¨&lt;/strong&gt;æˆ–&lt;strong&gt;é»˜è®¤&lt;/strong&gt;é…ç½®ï¼Œå¹¶æŒ‡å®šå½“å‰æ¿€æ´»çš„ç¯å¢ƒã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;application-{profile}.properties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ &lt;code&gt;{profile}&lt;/code&gt;ä¸ºç¯å¢ƒæ ‡è¯†ï¼ˆå¦‚ &lt;code&gt;dev&lt;/code&gt;, &lt;code&gt;test&lt;/code&gt;, &lt;code&gt;prod&lt;/code&gt;, &lt;code&gt;local&lt;/code&gt;ï¼‰ï¼Œå­˜æ”¾è¯¥ç¯å¢ƒçš„&lt;strong&gt;ç‰¹æœ‰&lt;/strong&gt;é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="å¦‚ä½•æ¿€æ´»ç‰¹å®šç¯å¢ƒ"&gt;å¦‚ä½•æ¿€æ´»ç‰¹å®šç¯å¢ƒ
&lt;/h3&gt;&lt;p&gt;è¦è®© Spring Boot åŠ è½½ &lt;code&gt;application-local.properties&lt;/code&gt;ä¸­çš„é…ç½®ï¼Œä½ éœ€è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ä¹‹ä¸€æ¥æ¿€æ´»åä¸º &lt;code&gt;local&lt;/code&gt;çš„ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­è®¾ç½®&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;application.properties&lt;/code&gt;æ–‡ä»¶ä¸­æŒ‡å®šé»˜è®¤æ¿€æ´»çš„ç¯å¢ƒã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.profiles.active=local
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è®¾ç½®&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨åº”ç”¨æ—¶ä½¿ç”¨ &lt;code&gt;--spring.profiles.active&lt;/code&gt;å‚æ•°ï¼Œè¿™ç§æ–¹å¼ä¼˜å…ˆçº§å¾ˆé«˜ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;java -jar your-app.jar --spring.profiles.active=local
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®&lt;/strong&gt;ï¼šè®¾ç½®æ“ä½œç³»ç»Ÿä¸­çš„ &lt;code&gt;SPRING_PROFILES_ACTIVE&lt;/code&gt;ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;export SPRING_PROFILES_ACTIVE=local
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºä¸ä¼˜å…ˆçº§"&gt;é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºä¸ä¼˜å…ˆçº§
&lt;/h3&gt;&lt;p&gt;ç†è§£é…ç½®çš„åŠ è½½é¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå†³å®šäº†å½“ç›¸åŒé…ç½®é¡¹å‡ºç°åœ¨ä¸åŒæ–‡ä»¶æ—¶ï¼Œå“ªä¸ªä¼šç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring Boot ä¼š&lt;strong&gt;å…ˆåŠ è½½ &lt;code&gt;application.properties&lt;/code&gt;&lt;/strong&gt;ï¼Œç„¶å&lt;strong&gt;å†åŠ è½½å½“å‰æ¿€æ´»çš„ &lt;code&gt;application-{profile}.properties&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶ä¸­å±æ€§ä¼š&lt;strong&gt;è¦†ç›–&lt;/strong&gt;ä¸»é…ç½®æ–‡ä»¶ä¸­çš„ç›¸åŒå±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤–ï¼Œ&lt;code&gt;properties&lt;/code&gt;æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜äº &lt;code&gt;yml&lt;/code&gt;æ ¼å¼ã€‚å‘½ä»¤è¡Œå‚æ•°çš„ä¼˜å…ˆçº§åˆ™é«˜äºæ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å®ç”¨å»ºè®®ä¸-yaml-é…ç½®ç¤ºä¾‹"&gt;å®ç”¨å»ºè®®ä¸ YAML é…ç½®ç¤ºä¾‹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;local&lt;/code&gt;ç¯å¢ƒçš„å…¸å‹ç”¨é€”&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºå¼€å‘è€…ä¸ªäººæœ¬åœ°æœºå™¨ï¼Œé…ç½®å¯èƒ½ä¸å¼€å‘æœåŠ¡å™¨ä¸åŒï¼Œä¾‹å¦‚è¿æ¥æœ¬åœ°æ•°æ®åº“ã€å¼€å¯æ›´è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ YAML æ ¼å¼è¿›è¡Œå¤šç¯å¢ƒé…ç½®&lt;/strong&gt;ï¼šé™¤äº† &lt;code&gt;.properties&lt;/code&gt;æ–‡ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ç®€æ´çš„ &lt;code&gt;.yml&lt;/code&gt;æ–‡ä»¶ã€‚YAML è¿˜æ”¯æŒåœ¨å•ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ &lt;code&gt;---&lt;/code&gt;åˆ†éš”ç¬¦æ¥å®šä¹‰æ‰€æœ‰ç¯å¢ƒé…ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# application.yml ç¤ºä¾‹
spring:
profiles:
active: local # æŒ‡å®šé»˜è®¤æ¿€æ´» local ç¯å¢ƒ
---
spring:
config:
activate:
on-profile: local # å®šä¹‰ local ç¯å¢ƒçš„é…ç½®
server:
port: 8080
database:
url: jdbc:mysql://localhost:3306/myapp
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°é…ç½®æœ¬åœ°å¼€å‘ç¯å¢ƒã€‚å¦‚æœä½ åœ¨å®è·µè¿‡ç¨‹ä¸­é‡åˆ°å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚å¦‚ä½•ç®¡ç†ä¸åŒç¯å¢ƒçš„æ•°æ®åº“è¿æ¥ï¼Œæˆ‘å¾ˆä¹æ„ç»§ç»­æä¾›å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id="beanfactory--applicationcontext"&gt;BeanFactory &amp;amp; ApplicationContext
&lt;/h2&gt;&lt;p&gt;BeanFactory å’Œ ApplicationContext æ˜¯ Spring æ¡†æ¶ä¸­ä¸¤ä¸ªæ ¸å¿ƒçš„å®¹å™¨æ¥å£ï¼Œå®ƒä»¬çš„å…³ç³»å’ŒåŒºåˆ«æ˜¯ç†è§£ Spring IoC å®¹å™¨çš„å…³é”®ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°å¯¹æ¯”äº†å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;BeanFactory&lt;/th&gt;
&lt;th&gt;ApplicationContext&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¥å£å±‚çº§ä¸å®šä½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºç¡€ã€åº•å±‚çš„ IoC å®¹å™¨&lt;/td&gt;
&lt;td&gt;BeanFactory çš„&lt;strong&gt;å­æ¥å£&lt;/strong&gt;ï¼ŒåŠŸèƒ½å…¨é¢çš„&lt;strong&gt;é«˜çº§å®¹å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean åŠ è½½æ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‡’åŠ è½½&lt;/strong&gt;ï¼šä»…åœ¨è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;æ—¶å®ä¾‹åŒ– Bean&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é¢„åŠ è½½&lt;/strong&gt;ï¼šå®¹å™¨å¯åŠ¨æ—¶å³åˆå§‹åŒ–æ‰€æœ‰å•ä¾‹ Beanï¼ˆéæ‡’åŠ è½½çš„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼ä¸šçº§åŠŸèƒ½æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨é…ç½®ï¼Œä¸æ”¯æŒæˆ–åŸºç¡€æ”¯æŒ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;åŸç”Ÿé›†æˆ&lt;/strong&gt;ï¼šäº‹ä»¶å‘å¸ƒã€å›½é™…åŒ–ã€èµ„æºä¾¿æ·è®¿é—®ã€AOPã€ç¯å¢ƒæŠ½è±¡ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åå¤„ç†å™¨æ³¨å†Œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‰‹åŠ¨æ³¨å†Œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨æ³¨å†Œ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®é”™è¯¯æ£€æµ‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å»¶è¿Ÿåˆ°é¦–æ¬¡è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;æ—¶æ‰æš´éœ²&lt;/td&gt;
&lt;td&gt;å®¹å™¨å¯åŠ¨æ—¶å³å¯å‘ç°é…ç½®é”™è¯¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;èµ„æºæåº¦å—é™çš„ç¯å¢ƒï¼ˆå¦‚åµŒå…¥å¼è®¾å¤‡ï¼‰&lt;/td&gt;
&lt;td&gt;ç»å¤§å¤šæ•°ä¼ä¸šçº§åº”ç”¨å’Œ Spring Boot é¡¹ç›®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒåŒºåˆ«æ·±åº¦è§£æ"&gt;ğŸ’¡ æ ¸å¿ƒåŒºåˆ«æ·±åº¦è§£æ
&lt;/h3&gt;&lt;h4 id="1-åŠ è½½ç­–ç•¥ä¸å¯åŠ¨æ€§èƒ½"&gt;1. åŠ è½½ç­–ç•¥ä¸å¯åŠ¨æ€§èƒ½
&lt;/h4&gt;&lt;p&gt;æœ€æ˜¾è‘—çš„åŒºåˆ«åœ¨äºå®ƒä»¬åˆ›å»º Bean çš„æ—¶æœºï¼Œè¿™ç›´æ¥å½±å“äº†åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦å’Œå†…å­˜å ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BeanFactory çš„æ‡’åŠ è½½&lt;/strong&gt;ï¼šBeanFactory åœ¨å¯åŠ¨æ—¶æœ¬èº«å¾ˆå¿«ï¼Œå› ä¸ºå®ƒåªåŠ è½½é…ç½®ä¿¡æ¯ï¼Œä¸åˆ›å»º Bean å®ä¾‹ã€‚Bean çš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ç­‰æ“ä½œä¼šå»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡è¢«è¯·æ±‚æ—¶ï¼ˆå³è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;æ–¹æ³•ï¼‰æ‰è¿›è¡Œã€‚è¿™ç§æ–¹å¼çš„&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;æ˜¯å¯åŠ¨å¿«ï¼ŒèŠ‚çœåˆå§‹å†…å­˜ã€‚ä½†&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;æ˜¯è¿è¡ŒæœŸç¬¬ä¸€æ¬¡è¯·æ±‚å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œå¹¶ä¸”é…ç½®é—®é¢˜ï¼ˆå¦‚æŸä¸ªä¾èµ–æ— æ³•æ³¨å…¥ï¼‰è¦åˆ°ä½¿ç”¨æ—¶æ‰ä¼šæš´éœ²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationContext çš„é¢„åŠ è½½&lt;/strong&gt;ï¼šApplicationContext åœ¨å¯åŠ¨é˜¶æ®µå°±ä¼šå®Œæˆæ‰€æœ‰å•ä¾‹ Bean çš„åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ã€‚è¿™ç§æ–¹å¼çš„&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;æ˜¯å¯åŠ¨åæœåŠ¡å“åº”è¿…é€Ÿï¼Œä¸”æ‰€æœ‰é…ç½®é—®é¢˜åœ¨å¯åŠ¨æ—¶å°±èƒ½å‘ç°ï¼Œæœ‰åˆ©äºä¿éšœåº”ç”¨ç¨³å®šæ€§ã€‚&lt;strong&gt;ä»£ä»·&lt;/strong&gt;åˆ™æ˜¯å¯åŠ¨æ—¶é—´æ›´é•¿ï¼Œåˆå§‹å†…å­˜å ç”¨æ›´é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ä¼ä¸šçº§åŠŸèƒ½ä»åŸºç¡€åˆ°å…¨æ ˆ"&gt;2. ä¼ä¸šçº§åŠŸèƒ½ï¼šä»â€œåŸºç¡€â€åˆ°â€œå…¨æ ˆâ€
&lt;/h4&gt;&lt;p&gt;ApplicationContext çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒæä¾›äº†å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å¼€å‘æ”¯æŒï¼Œè€Œ BeanFactory ä»…æä¾›æœ€åŸºç¡€çš„ IoC åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶å‘å¸ƒæœºåˆ¶&lt;/strong&gt;ï¼šApplicationContext å†…ç½®äº†åŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„äº‹ä»¶æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;publishEvent()&lt;/code&gt;æ–¹æ³•å‘å¸ƒäº‹ä»¶ï¼Œå¹¶ç”¨ &lt;code&gt;@EventListener&lt;/code&gt;æ³¨è§£æ¥ç›‘å¬äº‹ä»¶ã€‚è¿™å¯¹äºå®ç°åº”ç”¨å†…æ¨¡å—é—´çš„æ¾è€¦åˆé€šä¿¡éå¸¸æœ‰ç”¨ã€‚BeanFactory åˆ™ä¸ç›´æ¥æ”¯æŒæ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›½é™…åŒ–æ”¯æŒ&lt;/strong&gt;ï¼šApplicationContext ç»§æ‰¿äº† &lt;code&gt;MessageSource&lt;/code&gt;æ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è§£å†³å›½é™…åŒ–æ¶ˆæ¯é—®é¢˜ï¼Œè½»æ¾å®ç°å¤šè¯­è¨€æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºè®¿é—®&lt;/strong&gt;ï¼šApplicationContext æä¾›äº†æ›´å¼ºå¤§çš„ &lt;code&gt;ResourceLoader&lt;/code&gt;æ¥å£ï¼Œæ”¯æŒä»¥ç»Ÿä¸€çš„æ–¹å¼ä»ç±»è·¯å¾„ã€æ–‡ä»¶ç³»ç»Ÿã€URLç­‰åœ°æ–¹ä¾¿æ·åœ°åŠ è½½èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æ¡†æ¶æ— ç¼é›†æˆ&lt;/strong&gt;ï¼šApplicationContext åŸç”Ÿæ”¯æŒæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Autowired&lt;/code&gt;ï¼‰ã€AOPã€&lt;code&gt;Environment&lt;/code&gt;æŠ½è±¡ï¼ˆç”¨äºç®¡ç†é…ç½®æ–‡ä»¶å’Œå±æ€§ï¼‰ç­‰ç°ä»£ Spring ç‰¹æ€§ï¼Œè€Œè¿™äº›åœ¨ BeanFactory ä¸­éœ€è¦å¤§é‡æ‰‹åŠ¨é…ç½®æ‰èƒ½å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-8"&gt;ğŸ”§ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;äº†è§£äº†è¿™äº›åŒºåˆ«åï¼Œé€‰æ‹©æ ‡å‡†å°±éå¸¸æ¸…æ™°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯·ç›´æ¥ä½¿ç”¨ ApplicationContext&lt;/strong&gt;ã€‚å®ƒæ˜¯ç°ä»£ Spring åº”ç”¨ï¼ˆåŒ…æ‹¬ Spring Bootï¼‰çš„&lt;strong&gt;æ ‡å‡†ä¸”æ¨è&lt;/strong&gt;çš„é€‰æ‹©ã€‚å…¶é¢„åŠ è½½ç­–ç•¥å¸¦æ¥çš„ç¨³å®šæ€§ä¼˜åŠ¿ï¼Œä»¥åŠå¼€ç®±å³ç”¨çš„ä¼ä¸šçº§åŠŸèƒ½ï¼Œæå¤§åœ°æå‡äº†å¼€å‘æ•ˆç‡å’Œåº”ç”¨çš„å¥å£®æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»…åœ¨èµ„æºæåº¦å—é™çš„ç‰¹å®šåœºæ™¯ä¸‹è€ƒè™‘ BeanFactory&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œåœ¨å†…å­˜å’Œè®¡ç®—èƒ½åŠ›éå¸¸ç´§å¼ çš„åµŒå…¥å¼è®¾å¤‡æˆ–ç§»åŠ¨åº”ç”¨ä¸­ï¼Œä¸ºäº†æè‡´çš„èµ„æºæ§åˆ¶ï¼Œæ‰å¯èƒ½ä½¿ç”¨æ›´è½»é‡çº§çš„ BeanFactoryã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“ä¸å…³ç³»"&gt;ğŸ’ æ€»ç»“ä¸å…³ç³»
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼ŒBeanFactory æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼Œæä¾›äº† IoC æœ€åŸºç¡€çš„èƒ½åŠ›ï¼›è€Œ ApplicationContext æ˜¯æ„å»ºåœ¨å¿ƒè„ä¹‹ä¸Šçš„â€œå®Œæ•´èº¯ä½“â€ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„ç°ä»£åŒ–å®¹å™¨ã€‚&lt;strong&gt;ApplicationContext å®Œå…¨åŒ…å«äº† BeanFactory çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å¤§é‡æ‰©å±•&lt;/strong&gt;ã€‚å› æ­¤ï¼Œåœ¨å½“ä»Šçš„å¼€å‘ä¸­ï¼ŒApplicationContext æ˜¯ç»å¯¹çš„ä¸»æµã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„å¯¹æ¯”èƒ½å¸®åŠ©ä½ é€å½»åœ°ç†è§£ BeanFactory å’Œ ApplicationContextã€‚å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“åŠŸèƒ½ï¼ˆå¦‚äº‹ä»¶æœºåˆ¶ï¼‰çš„å®ç°ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;</description></item><item><title>ã€Spring Cloudã€‘Concepts</title><link>https://dyhes.github.io/p/spring-cloudconcepts/</link><pubDate>Tue, 01 Jul 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/spring-cloudconcepts/</guid><description>&lt;h2 id="spring-cloud"&gt;Spring Cloud
&lt;/h2&gt;&lt;p&gt;Spring Cloud æ˜¯ä¸€å¥—åŸºäº &lt;strong&gt;Spring Boot&lt;/strong&gt; çš„å¾®æœåŠ¡å¼€å‘å·¥å…·é›†ï¼Œæ—¨åœ¨ç®€åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ„å»ºã€éƒ¨ç½²å’Œç®¡ç†ã€‚å®ƒé€šè¿‡æ•´åˆæˆç†Ÿçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–ã€å…¨ç«™å¼çš„å¾®æœåŠ¡æŠ€æœ¯æ ˆï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆå®ç°æœåŠ¡æ²»ç†ã€é…ç½®ç®¡ç†ã€å®¹é”™å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ä»¥ä¸‹ä»å¤šä¸ªç»´åº¦å±•å¼€è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå®šä½ä¸ç»„æˆæ¶æ„"&gt;æ ¸å¿ƒå®šä½ä¸ç»„æˆæ¶æ„
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰ä¸å®šä½&lt;/strong&gt;
Spring Cloud å¹¶éå•ä¸€æ¡†æ¶ï¼Œè€Œæ˜¯&lt;strong&gt;ä¸€ç³»åˆ—æœ‰åºé›†åˆçš„å­é¡¹ç›®&lt;/strong&gt;ï¼Œä¸“æ³¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å…±æ€§æŒ‘æˆ˜ï¼ˆå¦‚æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡ç­‰ï¼‰ã€‚å®ƒåŸºäº Spring Boot çš„çº¦å®šä¼˜äºé…ç½®åŸåˆ™ï¼Œå®ç°â€œå¼€ç®±å³ç”¨â€ï¼Œæ˜¾è‘—é™ä½åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½çš„å¼€å‘å¤æ‚åº¦&lt;a class="link" href="@ref" &gt;1,4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶ä¸åŠŸèƒ½&lt;/strong&gt;
Spring Cloud çš„ç»„ä»¶å¯åˆ†ä¸ºä¸¤ç±»ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯¹æˆç†Ÿæ¡†æ¶çš„å°è£…&lt;/strong&gt;ï¼ˆå¦‚ Netflix OSSã€Apache Kafka ç­‰ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªç ”çš„åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½&lt;/strong&gt;ï¼ˆå¦‚ Spring Cloud Configã€Spring Cloud Gatewayï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚
æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶ç±»åˆ«&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä»£è¡¨ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡æ²»ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Eureka, Consul, Zookeeper&lt;/td&gt;
&lt;td&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ŒåŠ¨æ€ç®¡ç†æœåŠ¡å®ä¾‹çŠ¶æ€&lt;a class="link" href="@ref" &gt;3,6,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Cloud Config&lt;/td&gt;
&lt;td&gt;é›†ä¸­åŒ–ç®¡ç†é…ç½®ï¼Œæ”¯æŒ Git/æœ¬åœ°å­˜å‚¨ï¼ŒåŠ¨æ€åˆ·æ–°ï¼ˆç»“åˆ Spring Cloud Busï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Ribbon, Spring Cloud LoadBalancer&lt;/td&gt;
&lt;td&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒè½®è¯¢ã€éšæœºç­‰ç­–ç•¥&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡å®¹é”™&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Hystrix, Resilience4j&lt;/td&gt;
&lt;td&gt;æ–­è·¯å™¨æ¨¡å¼ã€æœåŠ¡é™çº§ï¼Œé˜²æ­¢é›ªå´©æ•ˆåº”&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;API ç½‘å…³&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Cloud Gateway, Zuul&lt;/td&gt;
&lt;td&gt;ç»Ÿä¸€å…¥å£ã€è·¯ç”±è½¬å‘ã€é™æµã€å®‰å…¨è¿‡æ»¤ï¼ˆGateway æ”¯æŒå¼‚æ­¥éé˜»å¡ï¼Œæ€§èƒ½æ›´ä¼˜ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†å¸ƒå¼è¿½è¸ª&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Sleuth + Zipkin&lt;/td&gt;
&lt;td&gt;å…¨é“¾è·¯ç›‘æ§ï¼Œè¿½è¸ªè¯·æ±‚è·¯å¾„ï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆ&lt;a class="link" href="@ref" &gt;6,10&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å£°æ˜å¼æœåŠ¡è°ƒç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Feign&lt;/td&gt;
&lt;td&gt;åŸºäºæ¥å£çš„ REST å®¢æˆ·ç«¯ï¼Œæ•´åˆè´Ÿè½½å‡è¡¡ä¸ç†”æ–­&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿"&gt;æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—åŒ–ä¸æ‰©å±•æ€§&lt;/strong&gt;
ç»„ä»¶ç‹¬ç«‹è®¾è®¡ï¼ˆå¦‚ Config ç‹¬ç«‹äº Eurekaï¼‰ï¼Œå¯æŒ‰éœ€å¼•å…¥ã€‚æ”¯æŒä¸ Dockerã€Kubernetes é›†æˆï¼Œé€‚é…äº‘åŸç”Ÿéƒ¨ç½²&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼€ç®±å³ç”¨&lt;/strong&gt;
é€šè¿‡æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@EnableEurekaClient&lt;/code&gt;ï¼‰å’Œé…ç½®å¿«é€Ÿå¯ç”¨åŠŸèƒ½ï¼Œæ— éœ€ç¼–å†™åº•å±‚ä»£ç &lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼šæœåŠ¡æ³¨å†Œä¸è°ƒç”¨
&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableEurekaClient // æœåŠ¡æ³¨å†Œ
@SpringBootApplication
public class ProviderApp { ... }
@FeignClient(name = &amp;#34;provider-service&amp;#34;) // å£°æ˜å¼è°ƒç”¨
public interface ProviderClient {
@GetMapping(&amp;#34;/data&amp;#34;)
String getData();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨ä¸å®¹é”™&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ Hystrix å®ç°æœåŠ¡é™çº§ï¼ˆfallback æ–¹æ³•ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ç»“åˆ Ribbon è‡ªåŠ¨åˆ‡æ¢æ•…éšœå®ä¾‹ï¼Œä¿éšœæœåŠ¡è¿ç»­æ€§&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæ€æ•´åˆèƒ½åŠ›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ Spring Security é›†æˆå®ç° OAuth2/JWT å®‰å…¨æ§åˆ¶&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ”¯æŒ RabbitMQã€Kafka ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆé€šè¿‡ Spring Cloud Streamï¼‰&lt;a class="link" href="@ref" &gt;1,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¾®æœåŠ¡æ¶æ„&lt;/strong&gt;
é€‚ç”¨äºä¸šåŠ¡æ‹†åˆ†çš„åœºæ™¯ï¼ˆå¦‚ç”µå•†ã€é‡‘èç³»ç»Ÿï¼‰ï¼Œé€šè¿‡æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆEurekaï¼‰åŠ¨æ€ç®¡ç†æ•°ç™¾ä¸ªå¾®æœåŠ¡ï¼Œé…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†ç¯å¢ƒå‚æ•°&lt;a class="link" href="@ref" &gt;9,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘ä¸å¼¹æ€§æ‰©å±•&lt;/strong&gt;
è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰å’Œè‡ªåŠ¨ä¼¸ç¼©ï¼ˆKubernetes é›†æˆï¼‰åº”å¯¹æµé‡é«˜å³°ï¼Œç½‘å…³å±‚é™æµä¿æŠ¤åç«¯æœåŠ¡&lt;a class="link" href="@ref" &gt;2,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆäº‘ä¸å¤šäº‘ç¯å¢ƒ&lt;/strong&gt;
é…ç½®ä¸­å¿ƒæ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼ˆDev/Test/Prodï¼‰ï¼ŒæœåŠ¡å¯åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘é—´æ— ç¼è¿ç§»&lt;a class="link" href="@ref" &gt;9,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰©è”ç½‘ä¸å®æ—¶æ•°æ®å¤„ç†&lt;/strong&gt;
ç»“åˆ Spring Cloud Stream å¤„ç†è®¾å¤‡æ•°æ®æµï¼Œé€šè¿‡ Kafka å®ç°é«˜ååé‡æ¶ˆæ¯ä¼ é€’&lt;a class="link" href="@ref" &gt;10,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯æ¼”è¿›ä¸è¶‹åŠ¿"&gt;æŠ€æœ¯æ¼”è¿›ä¸è¶‹åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ–°ä¸€ä»£ç»„ä»¶æ›¿ä»£&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gateway æ›¿ä»£ Zuul&lt;/strong&gt;ï¼šåŸºäº Reactor æ¨¡å‹ï¼Œæ€§èƒ½æå‡ 50% ä»¥ä¸Š&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Resilience4j æ›¿ä»£ Hystrix&lt;/strong&gt;ï¼šæ›´è½»é‡çº§çš„å®¹é”™åº“ï¼Œæ”¯æŒé€Ÿç‡é™åˆ¶ã€é‡è¯•ç­–ç•¥&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘åŸç”Ÿèåˆ&lt;/strong&gt;
æ”¯æŒ Service Meshï¼ˆå¦‚ Istioï¼‰ï¼Œæä¾›æ›´ç»†ç²’åº¦çš„æµé‡æ²»ç†å’Œå¯è§‚æµ‹æ€§&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Serverless æ”¯æŒ&lt;/strong&gt;
ç»“åˆ AWS Lambdaã€Azure Functionsï¼Œå®ç°äº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨æ¶æ„&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŒ‘æˆ˜ä¸åº”å¯¹"&gt;æŒ‘æˆ˜ä¸åº”å¯¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;ï¼šéœ€ä¸¥æ ¼åŒ¹é… Spring Boot ä¸ Spring Cloud ç‰ˆæœ¬ï¼ˆå¦‚ 2022.0.x éœ€ Spring Boot 3.0+ï¼‰&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®åˆ·æ–°å»¶è¿Ÿ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;/actuator/refresh&lt;/code&gt; ç«¯ç‚¹æ‰‹åŠ¨è§¦å‘æ›´æ–°ï¼Œæˆ–ç»“åˆ Bus æ¶ˆæ¯æ€»çº¿æ‰¹é‡åˆ·æ–°&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Cloud é€šè¿‡æ ‡å‡†åŒ–ã€æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œæˆä¸º&lt;strong&gt;ä¸­å°å‹ä¼ä¸šæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„é¦–é€‰å·¥å…·&lt;/strong&gt;ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š
âœ… é™ä½åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘é—¨æ§›ï¼›
âœ… æä¾›å…¨é“¾è·¯å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼›
âœ… å…¼å®¹äº‘åŸç”ŸæŠ€æœ¯æ ˆï¼Œæ”¯æ’‘æœªæ¥æ¶æ„æ¼”è¿›ã€‚
éšç€å¾®æœåŠ¡ä¸äº‘è®¡ç®—çš„æŒç»­å‘å±•ï¼ŒSpring Cloud å°†æŒç»­æ¼”è¿›ï¼Œåœ¨æœåŠ¡ç½‘æ ¼ã€Serverless ç­‰æ–¹å‘æ·±åŒ–æ•´åˆï¼Œæ¨åŠ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘èŒƒå¼çš„é©æ–°&lt;a class="link" href="@ref" &gt;1,4,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="dubbo"&gt;Dubbo
&lt;/h2&gt;&lt;p&gt;Dubbo æ˜¯ç”±é˜¿é‡Œå·´å·´å¼€æºçš„é«˜æ€§èƒ½ &lt;strong&gt;Java RPC æ¡†æ¶&lt;/strong&gt;ï¼Œç°ä¸º &lt;strong&gt;Apache é¡¶çº§é¡¹ç›®&lt;/strong&gt;ï¼Œä¸“æ³¨äºåˆ†å¸ƒå¼æœåŠ¡çš„é€æ˜åŒ–è¿œç¨‹è°ƒç”¨ä¸æ²»ç†ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒè®¾è®¡ã€åŠŸèƒ½ç‰¹æ€§ã€æ¶æ„å®ç°åŠåº”ç”¨åœºæ™¯å±•å¼€è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸ç»„ä»¶"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µä¸ç»„ä»¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒè§’è‰²&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Providerï¼ˆæœåŠ¡æä¾›è€…ï¼‰&lt;/strong&gt;ï¼šæš´éœ²æœåŠ¡æ¥å£çš„å®ç°ï¼Œå¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡åœ°å€ä¸å…ƒæ•°æ®&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Consumerï¼ˆæœåŠ¡æ¶ˆè´¹è€…ï¼‰&lt;/strong&gt;ï¼šé€šè¿‡æ³¨å†Œä¸­å¿ƒå‘ç°æœåŠ¡ï¼Œå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ä¸å®¹é”™&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Registryï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰&lt;/strong&gt;ï¼šå­˜å‚¨æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œå®ç°åŠ¨æ€æœåŠ¡å‘ç°ä¸å˜æ›´æ¨é€ï¼ˆæ”¯æŒ Zookeeperã€Nacos ç­‰ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Monitorï¼ˆç›‘æ§ä¸­å¿ƒï¼‰&lt;/strong&gt;ï¼šæ”¶é›†æœåŠ¡è°ƒç”¨æ¬¡æ•°ã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–ä¸æ•…éšœæ’æŸ¥&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚æ¶æ„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¥å£å±‚&lt;/strong&gt;ï¼šå®šä¹‰æœåŠ¡æ¥å£ï¼ˆå¦‚ &lt;code&gt;HelloService&lt;/code&gt;ï¼‰ï¼Œä¾›æä¾›è€…ä¸æ¶ˆè´¹è€…å…±ç”¨&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†å±‚&lt;/strong&gt;ï¼šç”Ÿæˆå®¢æˆ·ç«¯ä»£ç†ï¼ˆStubï¼‰ä¸æœåŠ¡ç«¯ä»£ç†ï¼ˆSkeletonï¼‰ï¼Œå±è”½è¿œç¨‹è°ƒç”¨ç»†èŠ‚&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤å±‚&lt;/strong&gt;ï¼šæ•´åˆè´Ÿè½½å‡è¡¡ã€è·¯ç”±ã€å®¹é”™ç­–ç•¥ï¼ˆå¦‚å¤±è´¥é‡è¯•ã€ç†”æ–­ï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åè®®å±‚&lt;/strong&gt;ï¼šå¤„ç† RPC è°ƒç”¨åºåˆ—åŒ–ä¸ç½‘ç»œé€šä¿¡ï¼ˆæ”¯æŒ Dubboã€HTTPã€gRPC ç­‰åè®®ï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½è¿œç¨‹è°ƒç”¨ï¼ˆRPCï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäº &lt;strong&gt;Netty NIO&lt;/strong&gt; å¼‚æ­¥é€šä¿¡ï¼Œé»˜è®¤ä½¿ç”¨ &lt;strong&gt;Dubbo åè®®&lt;/strong&gt;ï¼ˆå•ä¸€é•¿è¿æ¥ + äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼‰ï¼Œå‡å°‘è¿æ¥å¼€é”€ï¼Œå•æœºå¯æ”¯æ’‘äº¿çº§è°ƒç”¨é‡&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒ &lt;strong&gt;å¼‚æ­¥è°ƒç”¨&lt;/strong&gt;ï¼ˆéé˜»å¡ï¼‰ã€&lt;strong&gt;æ³›åŒ–è°ƒç”¨&lt;/strong&gt;ï¼ˆæ— éœ€ä¾èµ–æ¥å£ç±»ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æ²»ç†èƒ½åŠ›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šæä¾›éšæœºã€è½®è¯¢ã€æœ€å°‘æ´»è·ƒè°ƒç”¨ã€ä¸€è‡´æ€§å“ˆå¸Œç­‰ç­–ç•¥&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®¹é”™æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Failover&lt;/code&gt;ï¼šå¤±è´¥è‡ªåŠ¨åˆ‡æ¢èŠ‚ç‚¹ï¼ˆé»˜è®¤ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Failsafe&lt;/code&gt;ï¼šå¿½ç•¥å¼‚å¸¸ï¼Œè¿”å›ç©ºç»“æœ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Failfast&lt;/code&gt;ï¼šå¿«é€Ÿå¤±è´¥æŠ›å‡ºå¼‚å¸¸&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€é…ç½®&lt;/strong&gt;ï¼šé€šè¿‡ Nacos/Apollo å®æ—¶æ›´æ–°è·¯ç”±è§„åˆ™ã€æƒé‡å‚æ•°ï¼Œæ— éœ€é‡å¯æœåŠ¡&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æä¾›è€…å¯åŠ¨æ—¶æ³¨å†ŒæœåŠ¡åˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ¶ˆè´¹è€…è®¢é˜…æœåŠ¡åˆ—è¡¨å¹¶ç¼“å­˜åœ°å€ï¼Œæ³¨å†Œä¸­å¿ƒå˜æ›´æ—¶å®æ—¶æ¨é€æ›´æ–°&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶æ„è®¾è®¡ä¸å·¥ä½œæµç¨‹"&gt;ğŸ—ï¸ &lt;strong&gt;æ¶æ„è®¾è®¡ä¸å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨æµç¨‹&lt;/strong&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æ³¨å†Œ&lt;/strong&gt;ï¼šProvider å¯åŠ¨åå‘ Registry æ³¨å†ŒæœåŠ¡ï¼ˆIP + ç«¯å£ + åè®®ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ï¼šConsumer ä» Registry è®¢é˜…æœåŠ¡åœ°å€åˆ—è¡¨&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†è°ƒç”¨&lt;/strong&gt;ï¼šConsumer é€šè¿‡åŠ¨æ€ä»£ç†å‘èµ·è°ƒç”¨ï¼Œç»è´Ÿè½½å‡è¡¡é€‰æ‹© Provider èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œé€šä¿¡&lt;/strong&gt;ï¼šè¯·æ±‚ç»åºåˆ—åŒ–åé€šè¿‡ Netty å‘é€è‡³ Providerï¼Œå“åº”ç»“æœè¿”å›ç»™ Consumer&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ä¸ŠæŠ¥&lt;/strong&gt;ï¼šåŒæ–¹å®šæ—¶å‘é€è°ƒç”¨ç»Ÿè®¡æ•°æ®è‡³ Monitor&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åè®®é€‰æ‹©&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åè®®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Dubbo&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ã€å°æ•°æ®é‡ï¼ˆé»˜è®¤ï¼‰&lt;/td&gt;
&lt;td&gt;é•¿è¿æ¥ + NIOï¼Œæ€§èƒ½æœ€ä¼˜&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HTTP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤šè¯­è¨€å…¼å®¹ã€ç©¿é€é˜²ç«å¢™&lt;/td&gt;
&lt;td&gt;åŸºäº RESTfulï¼Œæ˜“è°ƒè¯•&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Triple&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Dubbo 3.0+ï¼ˆäº‘åŸç”Ÿï¼‰&lt;/td&gt;
&lt;td&gt;å…¼å®¹ gRPCï¼Œæ”¯æŒæµå¼é€šä¿¡&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯"&gt;ğŸŒ &lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¾®æœåŠ¡æ¶æ„&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ‹†åˆ†å•ä½“åº”ç”¨ä¸ºç‹¬ç«‹æœåŠ¡ï¼Œé€šè¿‡ Dubbo å®ç°æœåŠ¡é—´é«˜æ•ˆé€šä¿¡ä¸æ²»ç†&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;é«˜å¹¶å‘ç³»ç»Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç”µå•†ç§’æ€ã€é‡‘èäº¤æ˜“ç­‰åœºæ™¯ï¼Œåˆ©ç”¨è´Ÿè½½å‡è¡¡ä¸å®¹é”™ä¿éšœç³»ç»Ÿç¨³å®šæ€§&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;å¼‚æ„ç³»ç»Ÿé›†æˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ HTTP/Triple åè®®å®ç° Dubbo ä¸ Spring Cloud/gRPC æœåŠ¡çš„äº’é€š&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-dubbo-0-æ–°ç‰¹æ€§"&gt;ğŸš€ &lt;strong&gt;Dubbo 0 æ–°ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ€§èƒ½ä¼˜åŒ–&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨çº§æœåŠ¡å‘ç°&lt;/strong&gt;ï¼šç›¸æ¯”æ¥å£çº§å‘ç°ï¼Œå†…å­˜å ç”¨é™ä½ 75%ï¼ŒGC å‹åŠ›è¶‹é›¶&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;äº‘åŸç”Ÿæ”¯æŒ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Triple åè®®&lt;/strong&gt;ï¼šåŸºäº HTTP/2ï¼Œå…¼å®¹ gRPCï¼Œæ”¯æŒæµå¼é€šä¿¡ï¼Œé€‚é… Service Mesh&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes åŸç”Ÿé›†æˆ&lt;/strong&gt;ï¼šç›´æ¥å¯¹æ¥ K8s Service ä½“ç³»ï¼Œæ— éœ€é¢å¤–æ³¨å†Œä¸­å¿ƒ&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;Proxyless Mesh&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æä¾›æ—  Sidecar çš„ Service Mesh æ–¹æ¡ˆï¼Œå‡å°‘ä»£ç†å±‚å¼€é”€&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨&lt;/strong&gt;ï¼šZookeeper/Nacos é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´æœåŠ¡ç˜«ç—ª&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬ç®¡ç†&lt;/strong&gt;ï¼šæ¥å£å˜æ›´æ—¶éœ€åè°ƒ Provider/Consumer åŒæ­¥å‡çº§ï¼Œé˜²æ­¢è°ƒç”¨å¤±è´¥&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å‘Šè­¦&lt;/strong&gt;ï¼šé€šè¿‡ Dashboard ç›‘æ§ QPSã€å¼‚å¸¸ç‡ï¼ŒåŠæ—¶ç†”æ–­å¼‚å¸¸æœåŠ¡&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Dubbo ä»¥ &lt;strong&gt;é«˜æ€§èƒ½ RPC è°ƒç”¨&lt;/strong&gt; ä¸ºæ ¸å¿ƒï¼Œç»“åˆ &lt;strong&gt;æœåŠ¡æ²»ç†èƒ½åŠ›&lt;/strong&gt;ï¼ˆè´Ÿè½½å‡è¡¡/å®¹é”™/åŠ¨æ€é…ç½®ï¼‰ä¸ &lt;strong&gt;äº‘åŸç”Ÿé€‚é…&lt;/strong&gt;ï¼ˆTriple/K8sï¼‰ï¼Œæˆä¸ºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„é¦–é€‰æ¡†æ¶ã€‚
â€‹&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;â€‹ï¼šå¾®æœåŠ¡æ‹†åˆ†ã€é«˜å¹¶å‘ä¸šåŠ¡ã€å¼‚æ„ç³»ç»Ÿé›†æˆï¼›&lt;strong&gt;æ–°é¡¹ç›®æ¨è&lt;/strong&gt;â€‹ï¼šç›´æ¥é‡‡ç”¨ Dubbo 3.0 + Triple åè®®ï¼Œå…¼é¡¾æ€§èƒ½ä¸äº‘åŸç”Ÿç”Ÿæ€&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="ribbon"&gt;Ribbon
&lt;/h2&gt;&lt;p&gt;Spring Cloud Ribbon æ˜¯ Spring Cloud ç”Ÿæ€ä¸­å®ç°&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;çš„æ ¸å¿ƒç»„ä»¶ï¼ŒåŸºäº Netflix Ribbon äºŒæ¬¡å°è£…ï¼Œä¸“æ³¨äºåœ¨å¾®æœåŠ¡è°ƒç”¨ä¸­åŠ¨æ€åˆ†é…è¯·æ±‚è‡³å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œæå‡ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ä¸ä¼¸ç¼©æ€§ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒåŸç†ã€åŠŸèƒ½ç‰¹æ€§ã€ä½¿ç”¨å®è·µåŠæ¼”è¿›è¶‹åŠ¿å±•å¼€è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŸç†ä¸æ¶æ„"&gt;æ ¸å¿ƒåŸç†ä¸æ¶æ„
&lt;/h3&gt;&lt;h4 id="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡-vs-æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡"&gt;&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ vs æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼ˆå¦‚ Nginxã€F5ï¼‰ï¼š
åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´éƒ¨ç½²ç‹¬ç«‹è´Ÿè½½å‡è¡¡å™¨ï¼Œé›†ä¸­ç®¡ç†è¯·æ±‚åˆ†å‘ã€‚å®¢æˆ·ç«¯æ— æ„ŸçŸ¥æœåŠ¡å®ä¾‹ä¿¡æ¯&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼ˆRibbonï¼‰ï¼š
è´Ÿè½½å‡è¡¡é€»è¾‘åµŒå…¥å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯ä»æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Eurekaï¼‰è·å–æœåŠ¡åˆ—è¡¨ï¼Œè‡ªè¡Œé€‰æ‹©å®ä¾‹å¹¶ç›´æ¥è°ƒç”¨ï¼Œé¿å…å•ç‚¹æ•…éšœï¼Œæå‡çµæ´»æ€§ä¸æ€§èƒ½&lt;a class="link" href="@ref" &gt;1,3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ribbon-å·¥ä½œæµç¨‹"&gt;&lt;strong&gt;Ribbon å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚æ‹¦æˆª&lt;/strong&gt;ï¼š
æ‹¦æˆªæ ‡æ³¨ &lt;code&gt;@LoadBalanced&lt;/code&gt; çš„ &lt;code&gt;RestTemplate&lt;/code&gt; è¯·æ±‚ï¼Œé€šè¿‡ &lt;code&gt;LoadBalancerInterceptor&lt;/code&gt; æ³¨å…¥è´Ÿè½½å‡è¡¡é€»è¾‘&lt;a class="link" href="@ref" &gt;2,3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ï¼š
ä»æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Eurekaï¼‰åŠ¨æ€è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œç¼“å­˜åˆ°æœ¬åœ°ï¼ˆ&lt;code&gt;ServerList&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼š
é€šè¿‡ &lt;code&gt;Ping&lt;/code&gt; ç»„ä»¶ï¼ˆå¦‚ &lt;code&gt;NIWSDiscoveryPing&lt;/code&gt;ï¼‰å®šæœŸæ£€æµ‹å®ä¾‹å¯ç”¨æ€§ï¼Œå‰”é™¤æ•…éšœèŠ‚ç‚¹ï¼ˆé»˜è®¤ 30 ç§’/æ¬¡ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹é€‰æ‹©&lt;/strong&gt;ï¼š
æ ¹æ®é…ç½®çš„ &lt;code&gt;IRule&lt;/code&gt; ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰é€‰æ‹©ç›®æ ‡å®ä¾‹&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚è½¬å‘&lt;/strong&gt;ï¼š
å°†è¯·æ±‚ç›´æ¥è½¬å‘è‡³é€‰å®šå®ä¾‹&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ ¸å¿ƒç»„ä»¶"&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;LoadBalancer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡å™¨å…¥å£ï¼Œç®¡ç†ç­–ç•¥æ‰§è¡Œä¸å®ä¾‹é€‰æ‹©&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServerList&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŠ¨æ€/é™æ€å­˜å‚¨æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼ˆå¦‚ä» Eureka è·å–ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServerListFilter&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿‡æ»¤å®ä¾‹ï¼ˆå¦‚æ’é™¤æ•…éšœèŠ‚ç‚¹æˆ–é«˜å¹¶å‘å®ä¾‹ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServerListUpdater&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šæ—¶æ›´æ–°æœåŠ¡åˆ—è¡¨ï¼ˆé»˜è®¤ 30 ç§’åŒæ­¥æ³¨å†Œä¸­å¿ƒï¼‰&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;IRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;IPing&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼ŒéªŒè¯å®ä¾‹å¥åº·çŠ¶æ€&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="è´Ÿè½½å‡è¡¡ç­–ç•¥irule"&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆIRuleï¼‰
&lt;/h3&gt;&lt;p&gt;Ribbon æä¾› 7 ç§å†…ç½®ç­–ç•¥ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰©å±•ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RoundRobinRule&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰&lt;/td&gt;
&lt;td&gt;çº¿æ€§è½®è¯¢ï¼Œä¾æ¬¡åˆ†é…è¯·æ±‚&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å®ä¾‹æ€§èƒ½å‡åŒ€çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RandomRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®Œå…¨éšæœºé€‰æ‹©å®ä¾‹&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;ç®€å•éšæœºåˆ†é…ï¼Œæ— çŠ¶æ€è¦æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;WeightedResponseTimeRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ¹æ®å¹³å‡å“åº”æ—¶é—´åŠ¨æ€åˆ†é…æƒé‡ï¼Œå“åº”è¶Šå¿«æƒé‡è¶Šé«˜&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å®ä¾‹æ€§èƒ½å·®å¼‚å¤§çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;AvailabilityFilteringRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿‡æ»¤æ•…éšœå®ä¾‹ï¼ˆå¦‚æ–­è·¯å™¨è·³é—¸ï¼‰å’Œé«˜å¹¶å‘å®ä¾‹ï¼Œå‰©ä½™èŠ‚ç‚¹è½®è¯¢&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;é«˜å¯ç”¨æ€§è¦æ±‚ä¸¥æ ¼çš„ç³»ç»Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RetryRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨åŸºç¡€ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ï¼‰ä¸Šå¢åŠ é‡è¯•æœºåˆ¶ï¼Œè¶…æ—¶ååˆ‡æ¢å®ä¾‹&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;ç½‘ç»œæ³¢åŠ¨é¢‘ç¹çš„ç¯å¢ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BestAvailableRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€‰æ‹©å¹¶å‘è¯·æ±‚æ•°æœ€å°çš„å®ä¾‹&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;éœ€å‡è¡¡å®ä¾‹è´Ÿè½½çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ZoneAvoidanceRule&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç»¼åˆåŒºåŸŸï¼ˆZoneï¼‰æ€§èƒ½ä¸å®ä¾‹å¯ç”¨æ€§ï¼Œä¼˜å…ˆåŒåŒºåŸŸä½å»¶è¿Ÿå®ä¾‹&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å¤šåŒºåŸŸéƒ¨ç½²çš„åˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰ç­–ç•¥ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class MyCustomRule extends AbstractLoadBalancerRule {
@Override
public Server choose(Object key) {
List&amp;lt;Server&amp;gt; servers = getLoadBalancer().getReachableServers();
// è‡ªå®šä¹‰é€»è¾‘ï¼šå¦‚é€‰æ‹© IP ä»¥å¥‡æ•°ç»“å°¾çš„å®ä¾‹
return servers.stream().filter(s -&amp;gt; isOddIp(s)).findFirst().orElse(null);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨å®è·µ"&gt;ä½¿ç”¨å®è·µ
&lt;/h3&gt;&lt;h4 id="åŸºç¡€é…ç½®"&gt;&lt;strong&gt;åŸºç¡€é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¯ç”¨è´Ÿè½½å‡è¡¡ï¼š
é€šè¿‡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @LoadBalanced
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ³¨è§£æ¿€æ´»&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; RestTemplate
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çš„è´Ÿè½½å‡è¡¡èƒ½åŠ›
1,8ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
@LoadBalanced
public RestTemplate restTemplate() {
return new RestTemplate();
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æœåŠ¡è°ƒç”¨ï¼š
ä½¿ç”¨æœåŠ¡åï¼ˆé IPï¼‰å‘èµ·è¯·æ±‚ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;restTemplate.getForObject(&amp;#34;http://SERVICE-PROVIDER/api/resource&amp;#34;, String.class);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç­–ç•¥é…ç½®"&gt;&lt;strong&gt;ç­–ç•¥é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶æ–¹å¼ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;service-provider:
ribbon:
NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Java Config æ–¹å¼ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class RibbonConfig {
@Bean
public IRule ribbonRule() {
return new RandomRule(); // éšæœºç­–ç•¥
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é«˜çº§é…ç½®"&gt;&lt;strong&gt;é«˜çº§é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è¶…æ—¶ä¸é‡è¯•ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;ribbon:
ConnectTimeout: 1000 # è¿æ¥è¶…æ—¶(ms)
ReadTimeout: 3000 # è¯»å–è¶…æ—¶(ms)
MaxAutoRetries: 1 # åŒå®ä¾‹é‡è¯•æ¬¡æ•°
MaxAutoRetriesNextServer: 1 # åˆ‡æ¢å®ä¾‹é‡è¯•æ¬¡æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;ç¦ç”¨ Eurekaï¼š
æ‰‹åŠ¨æŒ‡å®šæœåŠ¡åˆ—è¡¨
6ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;ribbon:
eureka:
enabled: false
listOfServers: localhost:8081,localhost:8082
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ¼”è¿›è¶‹åŠ¿ä¸æ›¿ä»£æ–¹æ¡ˆ"&gt;æ¼”è¿›è¶‹åŠ¿ä¸æ›¿ä»£æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud LoadBalancer&lt;/strong&gt;ï¼š
Spring å®˜æ–¹æ¨å‡ºçš„ä¸‹ä¸€ä»£è´Ÿè½½å‡è¡¡å™¨ï¼Œæ”¯æŒ Reactive ç¼–ç¨‹æ¨¡å‹ï¼Œé€æ­¥æ›¿ä»£ Ribbon&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service Meshï¼ˆå¦‚ Istioï¼‰&lt;/strong&gt;ï¼š
æä¾›æ›´ç»†ç²’åº¦çš„æµé‡ç®¡ç†ã€ç†”æ–­å’Œè§‚æµ‹èƒ½åŠ›ï¼Œä½†éœ€é¢å¤–åŸºç¡€è®¾æ–½æ”¯æŒ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Ribbon çš„å±€é™æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;Netflix å·²åœæ­¢ç»´æŠ¤ï¼Œæ–°ç‰¹æ€§æ”¯æŒæœ‰é™&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®å¤æ‚åº¦é«˜ï¼ˆå¦‚å¤šç­–ç•¥ç»„åˆï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼š
Ribbon é€šè¿‡&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;è§£å†³äº†å¾®æœåŠ¡è°ƒç”¨çš„å¼¹æ€§åˆ†é…é—®é¢˜ï¼Œç»“åˆæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Eurekaï¼‰å®ç°åŠ¨æ€è·¯ç”±ä¸æ•…éšœéš”ç¦»ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿå¯ç”¨æ€§&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
ä¸­å°å‹å¾®æœåŠ¡æ¶æ„ã€éœ€å¿«é€Ÿé›†æˆè´Ÿè½½å‡è¡¡èƒ½åŠ›çš„ Spring Cloud é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¼”è¿›å»ºè®®&lt;/strong&gt;ï¼š
æ–°é¡¹ç›®å¯ä¼˜å…ˆè€ƒè™‘ â€‹&lt;strong&gt;Spring Cloud LoadBalancer&lt;/strong&gt;ï¼›å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿå¯æ¢ç´¢ â€‹&lt;strong&gt;Service Mesh&lt;/strong&gt;â€‹ æ–¹æ¡ˆ&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šRibbon è™½é€æ­¥è¢«æ›¿ä»£ï¼Œä½†å…¶è®¾è®¡æ€æƒ³ï¼ˆå¦‚å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€ç­–ç•¥å¯æ’æ‹”ï¼‰ä»æ˜¯å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒèŒƒå¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="spring-cloud-loadbalancer"&gt;Spring Cloud Loadbalancer
&lt;/h2&gt;&lt;p&gt;Spring Cloud LoadBalancer æ˜¯ Spring Cloud å®˜æ–¹æ¨å‡ºçš„&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç»„ä»¶&lt;/strong&gt;ï¼Œç”¨äºæ›¿ä»£ Netflix Ribbonï¼Œä¸ºå¾®æœåŠ¡æ¶æ„æä¾›è½»é‡çº§ã€é«˜æ€§èƒ½çš„è¯·æ±‚åˆ†å‘èƒ½åŠ›ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒåŸç†ã€åŠŸèƒ½ç‰¹æ€§ã€ä½¿ç”¨å®è·µåŠæ¼”è¿›ä¼˜åŠ¿ç­‰ç»´åº¦å±•å¼€è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå®šä½ä¸æ¶æ„"&gt;æ ¸å¿ƒå®šä½ä¸æ¶æ„
&lt;/h3&gt;&lt;h4 id="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"&gt;&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¸æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡çš„åŒºåˆ«&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼ˆå¦‚ Nginxã€F5ï¼‰ï¼šè¯·æ±‚å…ˆåˆ°ç‹¬ç«‹è´Ÿè½½å‡è¡¡å™¨ï¼Œå†ç”±å…¶è½¬å‘åˆ°æœåŠ¡å®ä¾‹ï¼Œå®¢æˆ·ç«¯ä¸æ„ŸçŸ¥å®ä¾‹ä¿¡æ¯&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šè´Ÿè½½é€»è¾‘åµŒå…¥å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯ä»æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Eurekaã€Nacosï¼‰è·å–æœåŠ¡åˆ—è¡¨ï¼Œè‡ªè¡Œé€‰æ‹©å®ä¾‹å¹¶ç›´æ¥è°ƒç”¨ï¼Œé¿å…å•ç‚¹æ•…éšœï¼Œæå‡æ€§èƒ½&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ ¸å¿ƒç»„ä»¶-1"&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BlockingLoadBalancerClient&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç†åŒæ­¥è¯·æ±‚ï¼ˆå¦‚ &lt;code&gt;RestTemplate&lt;/code&gt;ï¼‰ï¼Œé€‚ç”¨äºé˜»å¡å¼è°ƒç”¨åœºæ™¯&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ReactiveLoadBalancer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼ˆå¦‚ &lt;code&gt;WebClient&lt;/code&gt;ï¼‰ï¼ŒåŸºäº Reactor æ¨¡å‹ï¼Œæ”¯æŒéé˜»å¡ I/O&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;LoadBalancerClientFactory&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å·¥å‚ç±»ï¼Œä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºç‹¬ç«‹çš„è´Ÿè½½å‡è¡¡å™¨å®ä¾‹&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServiceInstanceListSupplier&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œæ”¯æŒç¼“å­˜æ›´æ–°&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å·¥ä½œæµç¨‹"&gt;&lt;strong&gt;å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚æ‹¦æˆª&lt;/strong&gt;ï¼š&lt;code&gt;@LoadBalanced&lt;/code&gt; æ³¨è§£æ ‡è®°çš„ &lt;code&gt;RestTemplate&lt;/code&gt; æˆ– &lt;code&gt;WebClient&lt;/code&gt; å‘èµ·è¯·æ±‚æ—¶ï¼Œè¢« &lt;code&gt;LoadBalancerInterceptor&lt;/code&gt; æ‹¦æˆª&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ï¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼ˆå¦‚ &lt;code&gt;user-service&lt;/code&gt; çš„ IP:Portï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹é€‰æ‹©&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;ReactorLoadBalancer&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;RoundRobinLoadBalancer&lt;/code&gt;ï¼‰æŒ‰ç­–ç•¥é€‰æ‹©å®ä¾‹&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚è½¬å‘&lt;/strong&gt;ï¼šå°†è¯·æ±‚ä¸­çš„æœåŠ¡åï¼ˆå¦‚ &lt;code&gt;http://user-service/api&lt;/code&gt;ï¼‰æ›¿æ¢ä¸ºå®é™…å®ä¾‹åœ°å€ï¼ˆå¦‚ &lt;code&gt;http://192.168.1.1:8080/api&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§"&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§
&lt;/h3&gt;&lt;h4 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RoundRobinLoadBalancer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è½®è¯¢é€‰æ‹©å®ä¾‹ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å®ä¾‹æ€§èƒ½å‡åŒ€çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RandomLoadBalancer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®Œå…¨éšæœºé€‰æ‹©å®ä¾‹&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;td&gt;ç®€å•éšæœºåˆ†é…éœ€æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰ç­–ç•¥&lt;/td&gt;
&lt;td&gt;å®ç° &lt;code&gt;ReactorServiceInstanceLoadBalancer&lt;/code&gt; æ¥å£&lt;/td&gt;
&lt;td&gt;éœ€åŠ æƒè½®è¯¢ã€æœ€å°è¿æ¥æ•°ç­‰å¤æ‚åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰ç­–ç•¥ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public ReactorLoadBalancer&amp;lt;ServiceInstance&amp;gt; customLoadBalancer(...) {
return new CustomLoadBalancer( // è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æŒ‰å®ä¾‹æƒé‡é€‰æ‹©ï¼‰
supplier, name);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="åŠ¨æ€æœåŠ¡å‘ç°é›†æˆ"&gt;&lt;strong&gt;åŠ¨æ€æœåŠ¡å‘ç°é›†æˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¸ &lt;strong&gt;Eureka&lt;/strong&gt;ã€&lt;strong&gt;Nacos&lt;/strong&gt;ã€&lt;strong&gt;Consul&lt;/strong&gt; ç­‰æ³¨å†Œä¸­å¿ƒæ— ç¼é›†æˆï¼Œè‡ªåŠ¨åŒæ­¥å®ä¾‹ä¸Šä¸‹çº¿çŠ¶æ€&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæœ¬åœ°ç¼“å­˜ï¼Œå®šæœŸåˆ·æ–°å®ä¾‹åˆ—è¡¨ï¼ˆé»˜è®¤ 30 ç§’ï¼‰ï¼Œé¿å…é¢‘ç¹è¯·æ±‚æ³¨å†Œä¸­å¿ƒ&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¥åº·æ£€æŸ¥ä¸å®¹é”™"&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥ä¸å®¹é”™&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨è¿‡æ»¤ä¸å¥åº·å®ä¾‹ï¼ˆå¦‚æ³¨å†Œä¸­å¿ƒæ ‡è®°ä¸º &lt;code&gt;DOWN&lt;/code&gt; çš„èŠ‚ç‚¹ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆé‡è¯•æœºåˆ¶ï¼ˆéœ€é…ç½® &lt;code&gt;spring.cloud.loadbalancer.retry.enabled=true&lt;/code&gt;ï¼‰ï¼Œåœ¨è°ƒç”¨å¤±è´¥æ—¶åˆ‡æ¢å®ä¾‹&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å“åº”å¼ç¼–ç¨‹æ”¯æŒ"&gt;&lt;strong&gt;å“åº”å¼ç¼–ç¨‹æ”¯æŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åŸç”Ÿé€‚é… &lt;code&gt;WebClient&lt;/code&gt;ï¼Œæ”¯æŒå“åº”å¼éé˜»å¡è°ƒç”¨ï¼Œæå‡é«˜å¹¶å‘åœºæ™¯ååé‡&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ä»£ç ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
@LoadBalanced
public WebClient.Builder webClientBuilder() {
return WebClient.builder();
}
public Mono&amp;lt;String&amp;gt; callService() {
return webClient.get()
.uri(&amp;#34;http://user-service/api/data&amp;#34;)
.retrieve()
.bodyToMono(String.class);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨å®è·µ-1"&gt;ä½¿ç”¨å®è·µ
&lt;/h3&gt;&lt;h4 id="åŸºç¡€é…ç½®-1"&gt;&lt;strong&gt;åŸºç¡€é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;æ­¥éª¤ 1ï¼šæ·»åŠ ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-loadbalancer&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ­¥éª¤ 2ï¼šå¯ç”¨è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class Config {
@Bean
@LoadBalanced // æ ‡è®°è´Ÿè½½å‡è¡¡
public RestTemplate restTemplate() {
return new RestTemplate();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ­¥éª¤ 3ï¼šå‘èµ·æœåŠ¡è°ƒç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;String result = restTemplate.getForObject(
&amp;#34;http://user-service/api/data&amp;#34;, String.class); // ä½¿ç”¨æœåŠ¡åè€Œé IP
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ç­–ç•¥åˆ‡æ¢"&gt;&lt;strong&gt;ç­–ç•¥åˆ‡æ¢&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;æ–¹å¼ 1ï¼šå…¨å±€é…ç½®ï¼ˆé»˜è®¤è½®è¯¢ â†’ éšæœºï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public ReactorLoadBalancer&amp;lt;ServiceInstance&amp;gt; randomLoadBalancer(...) {
return new RandomLoadBalancer(supplier, name);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ–¹å¼ 2ï¼šé’ˆå¯¹ç‰¹å®šæœåŠ¡é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@LoadBalancerClient(
value = &amp;#34;payment-service&amp;#34;,
configuration = RandomLoadBalancerConfig.class // æŒ‡å®šéšæœºç­–ç•¥
)
public class PaymentServiceConfig { }
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="é«˜çº§å‚æ•°è°ƒä¼˜"&gt;&lt;strong&gt;é«˜çº§å‚æ•°è°ƒä¼˜&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
loadbalancer:
retry:
enabled: true # å¯ç”¨é‡è¯•
health-check:
interval: 10s # å¥åº·æ£€æŸ¥é—´éš”
cache:
ttl: 5s # å®ä¾‹åˆ—è¡¨ç¼“å­˜æ—¶é—´
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="å¯¹æ¯”-ribbon-çš„ä¼˜åŠ¿ä¸æ¼”è¿›"&gt;å¯¹æ¯” Ribbon çš„ä¼˜åŠ¿ä¸æ¼”è¿›
&lt;/h3&gt;&lt;h4 id="ribbon-çš„å±€é™æ€§"&gt;&lt;strong&gt;Ribbon çš„å±€é™æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Netflix å·²åœæ­¢ç»´æŠ¤ï¼Œæ–°ç‰¹æ€§æ”¯æŒä¸è¶³&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®å¤æ‚ï¼ˆå¦‚å¤šç­–ç•¥ç»„åˆéœ€è‡ªå®šä¹‰ &lt;code&gt;IRule&lt;/code&gt;ï¼‰ï¼Œä¸”ä¸ Spring Boot 3+ å…¼å®¹æ€§å·®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="loadbalancer-çš„æ ¸å¿ƒä¼˜åŠ¿"&gt;&lt;strong&gt;LoadBalancer çš„æ ¸å¿ƒä¼˜åŠ¿&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Ribbon&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»´æŠ¤æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring å®˜æ–¹ç»´æŠ¤ï¼ŒæŒç»­æ›´æ–°&lt;/td&gt;
&lt;td&gt;Netflix åœæ­¢ç»´æŠ¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäº Reactor æ¨¡å‹ï¼Œæ”¯æŒå¼‚æ­¥éé˜»å¡ I/O&lt;/td&gt;
&lt;td&gt;åŒæ­¥é˜»å¡ï¼Œååé‡è¾ƒä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨è§£é©±åŠ¨ + è‡ªåŠ¨åŒ–é…ç½®ï¼Œæ”¯æŒ YAML åŠ¨æ€è°ƒæ•´&lt;/td&gt;
&lt;td&gt;éœ€ç¡¬ç¼–ç æˆ–å¤æ‚ Java é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿæ€é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ·±åº¦é›†æˆ Spring Cloud 2020+ åŠ WebFlux&lt;/td&gt;
&lt;td&gt;ä¾èµ– Netflix OSSï¼Œæ‰©å±•æ€§æœ‰é™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯æ¨è"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯æ¨è&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–°é¡¹ç›®&lt;/strong&gt;ï¼šä¼˜å…ˆé€‰æ‹© LoadBalancerï¼Œå°¤å…¶éœ€å“åº”å¼ç¼–ç¨‹æˆ– Spring Boot 3+ çš„é¡¹ç›®&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—§é¡¹ç›®è¿ç§»&lt;/strong&gt;ï¼šé€æ­¥æ›¿æ¢ Ribbonï¼Œé€šè¿‡ &lt;code&gt;@LoadBalanced&lt;/code&gt; æ— ç¼è¿‡æ¸¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜çº§éœ€æ±‚åœºæ™¯&lt;/strong&gt;ï¼šç»“åˆ &lt;strong&gt;Nacos æƒé‡ç­–ç•¥&lt;/strong&gt;æˆ– &lt;strong&gt;Service Meshï¼ˆå¦‚ Istioï¼‰&lt;/strong&gt; å®ç°æ›´ç»†ç²’åº¦æµé‡æ²»ç†&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"&gt;å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å®ä¾‹åˆ—è¡¨æœªæ›´æ–°&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šç¼“å­˜ TTL è¿‡é•¿æˆ–æ³¨å†Œä¸­å¿ƒæœªåŠæ—¶åŒæ­¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç¼©çŸ­ &lt;code&gt;spring.cloud.loadbalancer.cache.ttl&lt;/code&gt;ï¼ˆé»˜è®¤ 35sï¼‰ï¼Œæ£€æŸ¥æ³¨å†Œä¸­å¿ƒå¿ƒè·³é…ç½®&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šé…ç½®ç±»æœªæ‰«ææˆ–æœåŠ¡åå¤§å°å†™é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç¡®ä¿é…ç½®ç±»åœ¨å¯åŠ¨ç±»æ‰«æè·¯å¾„ä¸‹ï¼Œæ£€æŸ¥ &lt;code&gt;@LoadBalancerClient&lt;/code&gt; çš„ &lt;code&gt;value&lt;/code&gt; ä¸æœåŠ¡åä¸€è‡´&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¦–æ¬¡è°ƒç”¨è¶…æ—¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šå®ä¾‹åˆ—è¡¨é¦–æ¬¡åŠ è½½å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šå¯ç”¨é¥¥é¥¿åŠ è½½ï¼ˆå¦‚ &lt;code&gt;spring.cloud.loadbalancer.eager-load.enabled=true&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Cloud LoadBalancer é€šè¿‡&lt;strong&gt;è½»é‡çº§è®¾è®¡&lt;/strong&gt;ã€&lt;strong&gt;åŸç”Ÿå“åº”å¼æ”¯æŒ&lt;/strong&gt;åŠ&lt;strong&gt;ä¸ Spring ç”Ÿæ€æ·±åº¦é›†æˆ&lt;/strong&gt;ï¼Œæˆä¸ºå¾®æœåŠ¡è´Ÿè½½å‡è¡¡çš„ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š
âœ… â€‹&lt;strong&gt;ç®€åŒ–é…ç½®&lt;/strong&gt;â€‹ï¼šæ³¨è§£é©±åŠ¨ï¼Œå¼€ç®±å³ç”¨ï¼›
âœ… â€‹&lt;strong&gt;æå‡æ€§èƒ½&lt;/strong&gt;â€‹ï¼šå¼‚æ­¥éé˜»å¡æ¨¡å‹æ”¯æ’‘é«˜å¹¶å‘ï¼›
âœ… â€‹&lt;strong&gt;æ— ç¼æ¼”è¿›&lt;/strong&gt;â€‹ï¼šå®Œç¾æ›¿ä»£ Ribbonï¼Œå…¼å®¹äº‘åŸç”ŸæŠ€æœ¯æ ˆã€‚
å¯¹äºæ–°é¡¹ç›®ï¼Œå»ºè®®ç›´æ¥é‡‡ç”¨ LoadBalancerï¼›æ—§é¡¹ç›®å¯é€æ­¥è¿ç§»ï¼Œå¹¶ç»“åˆ Nacos æˆ– Service Mesh æ‰©å±•é«˜çº§æµé‡æ²»ç†èƒ½åŠ›&lt;a class="link" href="@ref" &gt;5,7,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="spring-cloud-gateway"&gt;Spring Cloud Gateway
&lt;/h2&gt;&lt;p&gt;Spring Cloud Gateway æ˜¯ Spring Cloud ç”Ÿæ€ä¸­çš„æ ¸å¿ƒ API ç½‘å…³ç»„ä»¶ï¼ŒåŸºäº Spring 5ã€Spring Boot 2 å’Œ Project Reactor æ„å»ºï¼Œé‡‡ç”¨å¼‚æ­¥éé˜»å¡æ¨¡å‹ï¼Œä¸“ä¸ºå¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œæä¾›é«˜æ€§èƒ½è·¯ç”±ã€è¿‡æ»¤ã€å®‰å…¨æ§åˆ¶ç­‰èƒ½åŠ›ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒæ¶æ„ã€åŠŸèƒ½ç‰¹æ€§ã€é…ç½®å®è·µåŠåœºæ™¯å¯¹æ¯”å±•å¼€è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡æ€æƒ³"&gt;ğŸ” æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡æ€æƒ³
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯åŸºç¡€&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å¼ç¼–ç¨‹&lt;/strong&gt;ï¼šåŸºäº WebFlux å’Œ Reactor Nettyï¼Œæ”¯æŒå¼‚æ­¥ I/Oï¼Œå•æœºååé‡å¯è¾¾ 3 ä¸‡+ QPS&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±ï¼ˆRouteï¼‰&lt;/strong&gt;ï¼šå®šä¹‰è½¬å‘è§„åˆ™ï¼ˆIDã€ç›®æ ‡ URIã€æ–­è¨€ã€è¿‡æ»¤å™¨ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–­è¨€ï¼ˆPredicateï¼‰&lt;/strong&gt;ï¼šåŸºäº Java 8 å‡½æ•°å¼æ¥å£ï¼ŒåŒ¹é…è¯·æ±‚æ¡ä»¶ï¼ˆå¦‚è·¯å¾„ã€Headerã€æ—¶é—´ç­‰ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ»¤å™¨ï¼ˆFilterï¼‰&lt;/strong&gt;ï¼šä¿®æ”¹è¯·æ±‚/å“åº”ï¼Œåˆ†å…¨å±€ï¼ˆGlobalFilterï¼‰å’Œå±€éƒ¨ï¼ˆGatewayFilterï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¯·æ±‚è¿›å…¥ç½‘å…³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gateway Handler Mapping&lt;/strong&gt; åŒ¹é…è·¯ç”±æ–­è¨€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gateway Web Handler&lt;/strong&gt; æ‰§è¡Œè¿‡æ»¤å™¨é“¾ï¼ˆPre å¤„ç†è¯·æ±‚ â†’ è½¬å‘åˆ°åç«¯ â†’ Post å¤„ç†å“åº”ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½è¯¦è§£"&gt;âš™ï¸ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£
&lt;/h3&gt;&lt;h4 id="åŠ¨æ€è·¯ç”±"&gt;&lt;strong&gt;åŠ¨æ€è·¯ç”±&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åŒ¹é…è§„åˆ™ï¼šæ”¯æŒ 12 ç§å†…ç½®æ–­è¨€ï¼Œå¸¸ç”¨é…ç½®ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
gateway:
routes:
- id: user_route
uri: lb://USER-SERVICE # è´Ÿè½½å‡è¡¡
predicates:
- Path=/user/** # è·¯å¾„åŒ¹é…
- After=2025-07-01T00:00:00+08:00 # æ—¶é—´åŒ¹é…
- Header=X-Token, \d+ # æ­£åˆ™åŒ¹é…æ•°å­—Token[1,5](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¿‡æ»¤å™¨æœºåˆ¶"&gt;&lt;strong&gt;è¿‡æ»¤å™¨æœºåˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¨å±€è¿‡æ»¤å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰è·¯ç”±ç”Ÿæ•ˆï¼ˆå¦‚è®¤è¯ã€æ—¥å¿—ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;AddRequestHeader=X-Gateway-Request, true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å±€éƒ¨è¿‡æ»¤å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‰¹å®šè·¯ç”±ç”Ÿæ•ˆï¼ˆå¦‚è·¯å¾„é‡å†™ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;RewritePath=/old/(?&amp;lt;segment&amp;gt;.*), /new/$\{segment}&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class AuthFilter implements GlobalFilter {
@Override
public Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {
if (exchange.getRequest().getHeaders().get(&amp;#34;Authorization&amp;#34;) == null) {
exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
return exchange.getResponse().setComplete(); // æ‹¦æˆªæœªæˆæƒè¯·æ±‚
}
return chain.filter(exchange);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é«˜çº§æ²»ç†èƒ½åŠ›"&gt;&lt;strong&gt;é«˜çº§æ²»ç†èƒ½åŠ›&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é™æµä¸ç†”æ–­ï¼š
&lt;ul&gt;
&lt;li&gt;é›†æˆ Redis ä»¤ç‰Œæ¡¶ç®—æ³•é™æµï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;filters:
- name: RequestRateLimiter
args:
redis-rate-limiter.replenishRate: 10 # æ¯ç§’10è¯·æ±‚
redis-rate-limiter.burstCapacity: 20 # å³°å€¼å®¹é‡[6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;ç†”æ–­é™çº§ï¼ˆæ”¯æŒ Resilience4jï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;filters:
- name: CircuitBreaker
args:
name: serviceCircuit
fallbackUri: forward:/fallback # ç†”æ–­æ—¶é™çº§[6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ§åˆ¶&lt;/strong&gt;ï¼š
é›†æˆ JWT/OAuth2 å®ç°ç»Ÿä¸€è®¤è¯ï¼Œæ‹¦æˆªéæ³•è¯·æ±‚&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®ä¸éƒ¨ç½²å®è·µ"&gt;ğŸ› ï¸ é…ç½®ä¸éƒ¨ç½²å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŸºç¡€é…ç½®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¾èµ–å¼•å…¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-gateway&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;è·¯ç”±è§„åˆ™ï¼šé€šè¿‡ &lt;code&gt;application.yml&lt;/code&gt; åŠ¨æ€å®šä¹‰ï¼Œæ”¯æŒçƒ­æ›´æ–°&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°é›†æˆ&lt;/strong&gt;
ç»“åˆ Nacos/Eureka å®ç°åŠ¨æ€è·¯ç”±ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;eureka:
client:
service-url:
defaultZone: http://localhost:8761/eureka/
routes:
- id: product_route
uri: lb://PRODUCT-SERVICE # è‡ªåŠ¨è´Ÿè½½å‡è¡¡[4](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§ä¼˜åŒ–å»ºè®®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–è·¯ç”±è§„åˆ™&lt;/strong&gt;ï¼šå­˜å‚¨åˆ° Nacos é…ç½®ä¸­å¿ƒï¼Œé¿å…é‡å¯ä¸¢å¤±&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§&lt;/strong&gt;ï¼šé›†æˆ Prometheus + Grafana ç›‘æ§ QPSã€å»¶è¿Ÿã€é”™è¯¯ç‡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨&lt;/strong&gt;ï¼šå¤šèŠ‚ç‚¹éƒ¨ç½² + Nginx è´Ÿè½½å‡è¡¡ç½‘å…³é›†ç¾¤&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯ä¸å¯¹æ¯”é€‰å‹"&gt;âš–ï¸ é€‚ç”¨åœºæ™¯ä¸å¯¹æ¯”é€‰å‹
&lt;/h3&gt;&lt;h4 id="å…¸å‹åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€å…¥å£&lt;/strong&gt;ï¼šèšåˆå¾®æœåŠ¡ APIï¼Œéšè—å†…éƒ¨æ¶æ„ï¼ˆå¦‚ç”µå•†å¹³å°çš„ &lt;code&gt;/order&lt;/code&gt; è·¯ç”±åˆ°è®¢å•æœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ²»ç†&lt;/strong&gt;ï¼šåœ¨ç½‘å…³å±‚ç»Ÿä¸€å®ç°é‰´æƒã€é˜²çˆ¬è™«ã€IP é»‘åå•&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç°åº¦å‘å¸ƒ&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;Weight&lt;/code&gt; æ–­è¨€æŒ‰æƒé‡åˆ†æµæµé‡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸å…¶ä»–ç½‘å…³å¯¹æ¯”"&gt;&lt;strong&gt;ä¸å…¶ä»–ç½‘å…³å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Spring Cloud Gateway&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Nginx&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Zuul 1.x&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰&lt;/td&gt;
&lt;td&gt;æé«˜ï¼ˆC è¯­è¨€ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆåŒæ­¥é˜»å¡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… åŸç”Ÿæ”¯æŒ&lt;/td&gt;
&lt;td&gt;âŒ éœ€ Lua è„šæœ¬æ‰©å±•&lt;/td&gt;
&lt;td&gt;âœ… æœ‰é™æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring ç”Ÿæ€é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ— ç¼å…¼å®¹&lt;/td&gt;
&lt;td&gt;âŒ éœ€æ‰‹åŠ¨æ•´åˆ&lt;/td&gt;
&lt;td&gt;âœ… å…¼å®¹ä½†å·²åœæ›´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨è§„æ¨¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­å°å‹å¾®æœåŠ¡é›†ç¾¤&lt;/td&gt;
&lt;td&gt;è¶…å¤§è§„æ¨¡é™æ€èµ„æºåˆ†å‘&lt;/td&gt;
&lt;td&gt;æ—§ç³»ç»Ÿè¿ç§»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Cloud Gateway çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½ä¸ç°ä»£åŒ–æ¶æ„&lt;/strong&gt;ï¼šåŸºäºå“åº”å¼æ¨¡å‹ï¼Œæ»¡è¶³é«˜å¹¶å‘éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼é…ç½®&lt;/strong&gt;ï¼šYAML é©±åŠ¨è·¯ç”±ä¸è¿‡æ»¤ï¼Œé™ä½å¼€å‘å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæ€èåˆ&lt;/strong&gt;ï¼šæ·±åº¦é›†æˆ Spring Cloud æœåŠ¡å‘ç°ã€é™æµç†”æ–­ã€å®‰å…¨æ¡†æ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;ï¼šæ”¯æŒè‡ªå®šä¹‰è¿‡æ»¤å™¨å’Œæ–­è¨€ï¼Œé€‚åº”å®šåˆ¶åŒ–ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šæ–°é¡¹ç›®é¦–é€‰ Gateway æ›¿ä»£ Zuul 1.xï¼›ç”Ÿäº§ç¯å¢ƒéœ€é…åˆé…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰å’Œç›‘æ§æ ˆï¼ˆPrometheus + SkyWalkingï¼‰å®ç°å…¨é“¾è·¯æ²»ç†&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="feign--openfeign"&gt;Feign &amp;amp; OpenFeign
&lt;/h2&gt;&lt;p&gt;Feign å’Œ OpenFeign éƒ½æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­ç”¨äº&lt;strong&gt;å£°æ˜å¼ HTTP æœåŠ¡è°ƒç”¨&lt;/strong&gt;çš„ç»„ä»¶ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯é€šè¿‡æ¥å£æŠ½è±¡ç®€åŒ–è¿œç¨‹è°ƒç”¨ã€‚ä½†ä¸¤è€…åœ¨æŠ€æœ¯èƒŒæ™¯ã€åŠŸèƒ½æ”¯æŒå’Œé€‚ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»å¤šä¸ªç»´åº¦å¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŒºåˆ«æ¦‚è§ˆ"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒåŒºåˆ«æ¦‚è§ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Feign&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;OpenFeign&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŠ€æœ¯èƒŒæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Netflix å¼€æºï¼Œ2019 å¹´ååœæ­¢ç»´æŠ¤&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Spring Cloud å®˜æ–¹ç»´æŠ¤ï¼Œæ›¿ä»£ Feign çš„å¢å¼ºç»„ä»¶&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–é¡¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;spring-cloud-starter-feign&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;spring-cloud-starter-openfeign&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨è§£æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒ Feign åŸç”Ÿæ³¨è§£ã€JAX-RS æ³¨è§£&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ”¯æŒ Spring MVC æ³¨è§£&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@GetMapping&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ– Ribbonï¼ˆå·²åœæ›´ï¼‰ï¼Œé…ç½®å¤æ‚&lt;/td&gt;
&lt;td&gt;æ·±åº¦é›†æˆ Spring Cloud ç”Ÿæ€ï¼ˆå¦‚ LoadBalancerã€Nacosï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ—§é¡¹ç›®å…¼å®¹&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Spring Boot 2.x+/Cloud 2020+ æ–°é¡¹ç›®é¦–é€‰&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-åŠŸèƒ½ç‰¹æ€§æ·±åº¦å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;åŠŸèƒ½ç‰¹æ€§æ·±åº¦å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ³¨è§£å…¼å®¹æ€§"&gt;&lt;strong&gt;æ³¨è§£å…¼å®¹æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Feign
ä»…æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @RequestLine
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ã€&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Param
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç­‰åŸç”Ÿæ³¨è§£ï¼Œéœ€é¢å¤–é€‚é… Spring MVC æ¥å£ï¼Œå¼€å‘ä½“éªŒå‰²è£‚
2,7
ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RequestLine(&amp;#34;GET /user/{id}&amp;#34;) // Feign åŸç”Ÿæ³¨è§£
User getUser(@Param(&amp;#34;id&amp;#34;) Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;OpenFeign
ç›´æ¥å…¼å®¹ Spring MVC æ³¨è§£ï¼Œæ¥å£å®šä¹‰ä¸ Controller ä¸€è‡´ï¼Œé™ä½å­¦ä¹ æˆæœ¬
3,6ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@FeignClient(name = &amp;#34;user-service&amp;#34;)
public interface UserClient {
@GetMapping(&amp;#34;/user/{id}&amp;#34;) // Spring MVC æ³¨è§£
User getUser(@PathVariable Long id);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰©å±•æœºåˆ¶"&gt;&lt;strong&gt;æ‰©å±•æœºåˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feign&lt;/strong&gt;
ç¼–è§£ç å™¨ä»…æ”¯æŒåŸºç¡€ç±»å‹ï¼ˆJSON/XMLï¼‰ï¼Œå®šåˆ¶éœ€å®ç° &lt;code&gt;Encoder&lt;/code&gt;/&lt;code&gt;Decoder&lt;/code&gt;ï¼Œä¸”&lt;strong&gt;ç¼ºä¹æ‹¦æˆªå™¨æ”¯æŒ&lt;/strong&gt;â€‹&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;OpenFeign
æä¾›å®Œæ•´æ‰©å±•ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼–è§£ç å™¨&lt;/strong&gt;ï¼šå†…ç½® &lt;code&gt;SpringEncoder&lt;/code&gt; æ”¯æŒå¤æ‚å¯¹è±¡ï¼ˆé›†åˆã€Mapï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‹¦æˆªå™¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;RequestInterceptor&lt;/code&gt; ç»Ÿä¸€æ·»åŠ è®¤è¯å¤´ã€æ—¥å¿—&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Contract åè®®&lt;/strong&gt;ï¼šæ”¯æŒ &lt;code&gt;SpringMvcContract&lt;/code&gt; å®šåˆ¶è¯·æ±‚ç»‘å®šè§„åˆ™&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è´Ÿè½½å‡è¡¡ä¸å®¹é”™"&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ä¸å®¹é”™&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feign&lt;/strong&gt;
å¼ºä¾èµ– Ribbonï¼ˆå·²åœæ›´ï¼‰ï¼Œéœ€ç‹¬ç«‹é…ç½®è´Ÿè½½ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;RandomRule&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;OpenFeign&lt;/li&gt;
&lt;li&gt;é»˜è®¤é›†æˆ &lt;strong&gt;Spring Cloud LoadBalancer&lt;/strong&gt;ï¼ˆæ›¿ä»£ Ribbonï¼‰ï¼Œæ”¯æŒå“åº”å¼è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ï¼›
&lt;ul&gt;
&lt;li&gt;æ— ç¼å…¼å®¹ &lt;strong&gt;Sentinel&lt;/strong&gt;/&lt;strong&gt;Resilience4j&lt;/strong&gt; å®ç°ç†”æ–­é™çº§&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨å®è·µå¯¹æ¯”"&gt;ğŸ› ï¸ &lt;strong&gt;ä½¿ç”¨å®è·µå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é…ç½®å¤æ‚åº¦"&gt;&lt;strong&gt;é…ç½®å¤æ‚åº¦&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;èƒ½åŠ›&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Feign&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;OpenFeign&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¥å¿—å¢å¼º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨é…ç½®æ—¥å¿—çº§åˆ«&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;code&gt;FULL&lt;/code&gt; çº§åˆ«å…¨é“¾è·¯æ—¥å¿—ï¼ˆå«è¯·æ±‚å¤´/ä½“ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿æ¥ä¼˜åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤ JDK URLConnectionï¼Œæ€§èƒ½ä½&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;strong&gt;OkHttp&lt;/strong&gt;/&lt;strong&gt;Apache HttpClient&lt;/strong&gt; è¿æ¥æ± &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;feign:
httpclient:
enabled: true
max-connections: 1000
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;| &lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt; | ä¾èµ– Ribbon è¶…æ—¶å‚æ•° | ç‹¬ç«‹é…ç½®è¶…æ—¶ + é‡è¯•ç­–ç•¥&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
openfeign:
client:
config:
default:
connectTimeout: 5000
readTimeout: 10000
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="é«˜å¯ç”¨è®¾è®¡"&gt;&lt;strong&gt;é«˜å¯ç”¨è®¾è®¡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feign&lt;/strong&gt;
éœ€æ•´åˆ Hystrixï¼ˆå·²åœæ›´ï¼‰å®ç°ç†”æ–­ï¼Œé™çº§é€»è¾‘éœ€å†™ &lt;code&gt;fallback&lt;/code&gt; ç±»&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;OpenFeign&lt;/li&gt;
&lt;li&gt;æ”¯æŒ &lt;strong&gt;Fallback Factory&lt;/strong&gt;ï¼šæ•è·å¼‚å¸¸åŠ¨æ€é™çº§&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼›
&lt;ul&gt;
&lt;li&gt;æ•´åˆ &lt;strong&gt;Spring Cloud CircuitBreaker&lt;/strong&gt;ï¼šç»Ÿä¸€ç†”æ–­ API&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ¼”è¿›è¶‹åŠ¿ä¸é€‰å‹å»ºè®®"&gt;ğŸš€ &lt;strong&gt;æ¼”è¿›è¶‹åŠ¿ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æŠ€æœ¯æ¼”è¿›"&gt;&lt;strong&gt;æŠ€æœ¯æ¼”è¿›&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feign&lt;/strong&gt;ï¼šNetflix åœæ›´åç”Ÿæ€åœæ»ï¼Œ&lt;strong&gt;ä»…é€‚åˆæ—§é¡¹ç›®ç»´æŠ¤&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;OpenFeignï¼š
&lt;ul&gt;
&lt;li&gt;æˆä¸º Spring Cloud &lt;strong&gt;å®˜æ–¹æ ‡å‡†ç»„ä»¶&lt;/strong&gt;ï¼ŒæŒç»­æ›´æ–°ï¼›&lt;/li&gt;
&lt;li&gt;æ·±åº¦é›†æˆ &lt;strong&gt;äº‘åŸç”Ÿç”Ÿæ€&lt;/strong&gt;ï¼ˆKubernetesã€Service Meshï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‰å‹å†³ç­–æ ‘"&gt;&lt;strong&gt;é€‰å‹å†³ç­–æ ‘&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[é¡¹ç›®æŠ€æœ¯æ ˆ] --&amp;gt;|Spring Boot 2.x+/Cloud 2020+| B(é€‰æ‹© OpenFeign)
A --&amp;gt;|é—ç•™ç³»ç»Ÿ/é Spring é¡¹ç›®| C(è€ƒè™‘ Feign)
B --&amp;gt; D[éœ€é«˜çº§æ‰©å±•ï¼Ÿ] --&amp;gt;|æ˜¯| E[ä½¿ç”¨æ‹¦æˆªå™¨+è‡ªå®šä¹‰ Contract]
D --&amp;gt;|å¦| F[é»˜è®¤é…ç½®å¿«é€Ÿé›†æˆ]
C --&amp;gt; G[éœ€ Spring æ³¨è§£ï¼Ÿ] --&amp;gt;|æ˜¯| H[è¿ç§»è‡³ OpenFeign]
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="è¿ç§»å»ºè®®"&gt;&lt;strong&gt;è¿ç§»å»ºè®®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æ—§é¡¹ç›®è¿ç§» OpenFeign åªéœ€ä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ›¿æ¢ä¾èµ–ï¼š&lt;code&gt;spring-cloud-starter-feign&lt;/code&gt; â†’ &lt;code&gt;spring-cloud-starter-openfeign&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ³¨è§£å‡çº§ï¼šåŸç”Ÿ &lt;code&gt;@RequestLine&lt;/code&gt; æ›¿æ¢ä¸º &lt;code&gt;@GetMapping&lt;/code&gt; ç­‰ Spring MVC æ³¨è§£&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feign&lt;/strong&gt;ï¼š&lt;strong&gt;å†å²ç»„ä»¶&lt;/strong&gt;ï¼Œé€‚ç”¨äºé Spring ç”Ÿæ€æˆ–é—ç•™ç³»ç»Ÿï¼Œä½†æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ä¸è¶³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OpenFeign&lt;/strong&gt;ï¼š&lt;strong&gt;ç°ä»£å¾®æœåŠ¡æ ‡é…&lt;/strong&gt;ï¼Œä»¥ Spring åŸç”Ÿé›†æˆã€æ³¨è§£å…¼å®¹æ€§ã€æ‰©å±•çµæ´»æ€§ä¸ºæ ¸å¿ƒä¼˜åŠ¿ï¼Œæ˜¯æ–°é¡¹ç›®é¦–é€‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;ï¼šæ–°é¡¹ç›®ç›´æ¥é‡‡ç”¨ OpenFeignï¼›æ—§é¡¹ç›®é€æ­¥è¿ç§»ï¼Œé‡ç‚¹å…³æ³¨æ³¨è§£æ›¿æ¢å’Œä¾èµ–æ›´æ–°&lt;a class="link" href="@ref" &gt;1,6,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="hystrix--sentinel"&gt;Hystrix &amp;amp; Sentinel
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Hystrix ä¸ Sentinel çš„è¯¦ç»†å¯¹æ¯”ï¼Œä»è®¾è®¡ç†å¿µã€æ ¸å¿ƒåŠŸèƒ½ã€æ€§èƒ½å¼€é”€åˆ°é€‚ç”¨åœºæ™¯ç­‰ç»´åº¦å±•å¼€åˆ†æï¼Œå¸®åŠ©æ‚¨è¿›è¡ŒæŠ€æœ¯é€‰å‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è®¾è®¡ç†å¿µä¸å®šä½"&gt;ğŸ” &lt;strong&gt;è®¾è®¡ç†å¿µä¸å®šä½&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Hystrix&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Sentinel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒç›®æ ‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡&lt;strong&gt;ç†”æ–­å™¨æ¨¡å¼&lt;/strong&gt;å’Œ&lt;strong&gt;æœåŠ¡éš”ç¦»&lt;/strong&gt;é˜²æ­¢çº§è”æ•…éšœï¼Œä¾§é‡å®¹é”™&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä»¥&lt;strong&gt;æµé‡æ§åˆ¶&lt;/strong&gt;ä¸ºæ ¸å¿ƒï¼Œè¦†ç›–ç†”æ–­é™çº§ã€ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ï¼Œä¿éšœé«˜å¹¶å‘ç¨³å®šæ€§&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºæ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å‘½ä»¤æ¨¡å¼ï¼ˆ&lt;code&gt;HystrixCommand&lt;/code&gt;ï¼‰ï¼Œéœ€é¢„å®šä¹‰èµ„æºä¸éš”ç¦»ç­–ç•¥&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;è½»é‡çº§èµ„æºå®šä¹‰ï¼ˆæ³¨è§£/APIï¼‰ï¼Œè§„åˆ™ä¸èµ„æºè§£è€¦ï¼Œæ”¯æŒåŠ¨æ€è°ƒæ•´&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»´æŠ¤çŠ¶æ€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Netflix å·²åœæ­¢ç»´æŠ¤ï¼Œç”Ÿæ€åœæ»&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;é˜¿é‡Œå·´å·´æŒç»­æ›´æ–°ï¼Œç¤¾åŒºæ´»è·ƒï¼Œå…¼å®¹ Spring Cloud 2020+ åŠäº‘åŸç”Ÿç”Ÿæ€&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ç†”æ–­é™çº§"&gt;&lt;strong&gt;ç†”æ–­é™çº§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Hystrix&lt;/li&gt;
&lt;li&gt;åŸºäº&lt;strong&gt;å¤±è´¥æ¯”ç‡&lt;/strong&gt;è§¦å‘ç†”æ–­ï¼Œç¼ºå°‘å“åº”æ—¶é—´ç†”æ–­æ”¯æŒ&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;é™çº§éœ€ç¡¬ç¼–ç  &lt;code&gt;fallback&lt;/code&gt; æ–¹æ³•ï¼Œçµæ´»æ€§ä½&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Sentinel&lt;/li&gt;
&lt;li&gt;æ”¯æŒ&lt;strong&gt;å¼‚å¸¸æ¯”ä¾‹&lt;/strong&gt;ã€&lt;strong&gt;æ…¢è°ƒç”¨æ¯”ä¾‹&lt;/strong&gt;ï¼ˆå“åº”æ—¶é—´é˜ˆå€¼ï¼‰ã€&lt;strong&gt;å¼‚å¸¸æ•°&lt;/strong&gt;ä¸‰ç§ç†”æ–­ç­–ç•¥&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;ç»“åˆ &lt;code&gt;@SentinelResource&lt;/code&gt; æ³¨è§£ï¼Œå¯åŠ¨æ€é…ç½®é™çº§é€»è¾‘&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æµé‡æ§åˆ¶"&gt;&lt;strong&gt;æµé‡æ§åˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Hystrix&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— å†…ç½®é™æµåŠŸèƒ½&lt;/strong&gt;ï¼Œä¾èµ–çº¿ç¨‹æ± /ä¿¡å·é‡éš”ç¦»é—´æ¥é™æµ&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Sentinel&lt;/li&gt;
&lt;li&gt;æ”¯æŒ &lt;strong&gt;QPS&lt;/strong&gt;ã€&lt;strong&gt;å¹¶å‘çº¿ç¨‹æ•°&lt;/strong&gt;ã€&lt;strong&gt;çƒ­ç‚¹å‚æ•°&lt;/strong&gt;ã€&lt;strong&gt;é“¾è·¯å…¥å£&lt;/strong&gt;ç­‰å¤šç»´åº¦é™æµ&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;æä¾› &lt;strong&gt;Warm Up&lt;/strong&gt;ï¼ˆé¢„çƒ­ï¼‰ã€&lt;strong&gt;åŒ€é€Ÿæ’é˜Ÿ&lt;/strong&gt;ï¼ˆæ¼æ¡¶ç®—æ³•ï¼‰ç­‰é«˜çº§æµæ§æ¨¡å¼&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="éš”ç¦»ç­–ç•¥"&gt;&lt;strong&gt;éš”ç¦»ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Hystrix&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Sentinel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹æ± éš”ç¦»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤æ–¹å¼ï¼Œéš”ç¦»å½»åº•ä½†çº¿ç¨‹åˆ‡æ¢å¼€é”€å¤§&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒçº¿ç¨‹æ± ï¼Œé¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢æŸè€—&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¿¡å·é‡éš”ç¦»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒè½»é‡çº§ä¿¡å·é‡ï¼Œä½†æ— æ³•è‡ªåŠ¨é™çº§æ…¢è°ƒç”¨&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºä¿¡å·é‡å®ç°å¹¶å‘æ§åˆ¶ï¼Œç»“åˆå“åº”æ—¶é—´ç†”æ–­å¤„ç†æ…¢è°ƒç”¨&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="ç³»ç»Ÿä¿æŠ¤ä¸æ‰©å±•æ€§"&gt;&lt;strong&gt;ç³»ç»Ÿä¿æŠ¤ä¸æ‰©å±•æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Sentinel ç‹¬æœ‰åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤&lt;/strong&gt;ï¼šæ ¹æ® CPU è´Ÿè½½ã€å¹³å‡ RT ç­‰æŒ‡æ ‡åŠ¨æ€é™æµ&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çƒ­ç‚¹å‚æ•°é™æµ&lt;/strong&gt;ï¼šé’ˆå¯¹é«˜é¢‘å‚æ•°ï¼ˆå¦‚ç”¨æˆ· IDï¼‰å•ç‹¬é™åˆ¶&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™æŒä¹…åŒ–&lt;/strong&gt;ï¼šé›†æˆ Nacos/ZooKeeperï¼Œé¿å…é‡å¯ä¸¢å¤±è§„åˆ™&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€§èƒ½ä¸å¼€é”€"&gt;âš¡ &lt;strong&gt;æ€§èƒ½ä¸å¼€é”€&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Hystrix&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Sentinel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éš”ç¦»å¼€é”€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çº¿ç¨‹æ± éš”ç¦»å¯¼è‡´é«˜å¹¶å‘ä¸‹ &lt;strong&gt;15%~30%&lt;/strong&gt; æ€§èƒ½æŸè€—&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºä¿¡å·é‡ä¸æ»‘åŠ¨çª—å£ç»Ÿè®¡ï¼Œæ€§èƒ½æŸè€— &lt;strong&gt;&amp;lt;5%&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»Ÿè®¡æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ»‘åŠ¨çª—å£ + RxJava äº‹ä»¶é©±åŠ¨ï¼Œå¤æ‚åº¦é«˜&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ»‘åŠ¨çª—å£ï¼ˆ&lt;code&gt;LeapArray&lt;/code&gt;ï¼‰è½»é‡é«˜æ•ˆ&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿæ€ä¸è¿ç»´æ”¯æŒ"&gt;ğŸ–¥ï¸ &lt;strong&gt;ç”Ÿæ€ä¸è¿ç»´æ”¯æŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Hystrix&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Sentinel&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶å°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŠŸèƒ½ç®€å•ï¼Œç›‘æ§æ•°æ®å±•ç¤ºæœ‰é™&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Dashboard å¼ºå¤§&lt;/strong&gt;ï¼šå®æ—¶ç›‘æ§ã€åŠ¨æ€è§„åˆ™æ¨é€ã€æœºå™¨å‘ç°&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¡†æ¶é€‚é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Cloud Netflixï¼ˆå·²æ·˜æ±°ï¼‰&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ Spring Cloud Gatewayã€Dubboã€gRPCã€Servlet ç­‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ’ä»¶å¼æ‰©å±•ï¼Œå®šåˆ¶å¤æ‚&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;SPI æ¥å£ä¸°å¯Œï¼Œæ”¯æŒè‡ªå®šä¹‰è§„åˆ™ç®¡ç†ã€æ•°æ®æºé€‚é…&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åœºæ™¯ä¸é€‰å‹å»ºè®®"&gt;ğŸš€ &lt;strong&gt;å…¸å‹åœºæ™¯ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="hystrix-é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;Hystrix é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é—ç•™ç³»ç»Ÿå…¼å®¹ï¼šéœ€å¿«é€Ÿé›†æˆç†”æ–­éš”ç¦»ï¼Œä¸”å¹¶å‘é‡ä¸­ç­‰ï¼ˆå¦‚ &amp;lt;10K QPSï¼‰&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¼ºçº¿ç¨‹éš”ç¦»éœ€æ±‚ï¼šéœ€å½»åº•éš”ç¦»æ•…éšœæœåŠ¡ï¼ˆç‰ºç‰²æ€§èƒ½æ¢å–éš”ç¦»æ€§ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="sentinel-é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;Sentinel é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘æµé‡æ²»ç†&lt;/strong&gt;ï¼šç”µå•†ç§’æ€ã€API ç½‘å…³é™æµï¼Œéœ€åº”å¯¹çªå‘æµé‡&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç²¾ç»†åŒ–ç†”æ–­æ§åˆ¶&lt;/strong&gt;ï¼šåŸºäºå“åº”æ—¶é—´è‡ªåŠ¨é™çº§æ…¢æœåŠ¡ï¼ˆå¦‚ RT &amp;gt; 500ms è§¦å‘ç†”æ–­ï¼‰&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨é“¾è·¯ç¨³å®šæ€§ä¿éšœ&lt;/strong&gt;ï¼šç»“åˆç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´æµé‡ï¼Œé¿å…é›†ç¾¤é›ªå´©&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;é€‰å‹å†³ç­–æ ‘&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[æ–°é¡¹ç›®ï¼Ÿ] --&amp;gt;|æ˜¯| B[QPS &amp;gt; 10ä¸‡ï¼Ÿ] --&amp;gt;|æ˜¯| C(é€‰æ‹© Sentinel)
B --&amp;gt;|å¦| D[éœ€ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ï¼Ÿ] --&amp;gt;|æ˜¯| C
D --&amp;gt;|å¦| E[éœ€çƒ­ç‚¹é™æµ/åŒ€é€Ÿæ’é˜Ÿï¼Ÿ] --&amp;gt;|æ˜¯| C
E --&amp;gt;|å¦| F(è€ƒè™‘ Hystrix)
A --&amp;gt;|é—ç•™ç³»ç»Ÿ| G[æ˜¯å¦å·²ç”¨ Hystrixï¼Ÿ] --&amp;gt;|æ˜¯| H[è¯„ä¼°è¿ç§»æˆæœ¬]
H --&amp;gt;|æˆæœ¬ä½| C
H --&amp;gt;|æˆæœ¬é«˜| F
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å·¥å…·&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠ£åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Hystrix&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çº¿ç¨‹æ± éš”ç¦»å½»åº•ï¼›å‘½ä»¤æ¨¡å¼å°è£…æ¸…æ™°&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ€§èƒ½å·®ã€æ— æµé‡æ§åˆ¶ã€å·²åœæ›´&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Sentinel&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æµé‡æ§åˆ¶ä¸°å¯Œã€æ€§èƒ½æŸè€—ä½ã€ç”Ÿæ€å®Œå–„ã€å®æ—¶è¿ç»´å¼ºå¤§&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;å­¦ä¹ æ›²çº¿ç•¥é™¡ï¼ˆéœ€æŒæ¡è§„åˆ™åŠ¨æ€é…ç½®ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–°é¡¹ç›®ä¼˜å…ˆ Sentinel&lt;/strong&gt;ï¼šå°¤å…¶é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ç”µå•†ã€é‡‘èï¼‰ï¼Œåˆ©ç”¨å…¶æµé‡æ•´å½¢ä¸ç³»ç»Ÿä¿æŠ¤èƒ½åŠ›&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—§ç³»ç»Ÿé€æ­¥è¿ç§»&lt;/strong&gt;ï¼šæ›¿æ¢ Hystrix æ—¶ï¼Œå…³æ³¨ &lt;code&gt;@SentinelResource&lt;/code&gt; æ³¨è§£ä¸è§„åˆ™æŒä¹…åŒ–é…ç½®&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å‘æç¤º&lt;/strong&gt;ï¼šSentinel éœ€é¿å…å…¨å±€å¼‚å¸¸å¤„ç†è¦†ç›–ç†”æ–­ç»Ÿè®¡ï¼Œéœ€é€šè¿‡åˆ‡é¢æˆ– &lt;code&gt;RequestOriginParser&lt;/code&gt; è§£å†³&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="sentinel"&gt;Sentinel
&lt;/h2&gt;&lt;p&gt;Sentinel æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„&lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿæµé‡æ²»ç†ç»„ä»¶&lt;/strong&gt;ï¼Œä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œé€šè¿‡æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ç­‰æœºåˆ¶ä¿éšœå¾®æœåŠ¡æ¶æ„çš„ç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½"&gt;ğŸ” æ ¸å¿ƒåŠŸèƒ½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æµé‡æ§åˆ¶ï¼ˆFlow Controlï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;QPS/çº¿ç¨‹æ•°é™æµ&lt;/strong&gt;ï¼šé™åˆ¶æ¯ç§’è¯·æ±‚æ•°æˆ–å¹¶å‘çº¿ç¨‹æ•°ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµæ§ç­–ç•¥&lt;/strong&gt;ï¼šæ”¯æŒç›´æ¥æ‹’ç»ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰ã€é¢„çƒ­å¯åŠ¨ï¼ˆWarm Upï¼‰ã€åŒ€é€Ÿæ’é˜Ÿï¼ˆæ¼æ¡¶ç®—æ³•ï¼‰&lt;a class="link" href="@ref" &gt;2,4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çƒ­ç‚¹å‚æ•°é™æµ&lt;/strong&gt;ï¼šé’ˆå¯¹é«˜é¢‘å‚æ•°ï¼ˆå¦‚ç”¨æˆ·IDï¼‰å•ç‹¬é™æµï¼Œé¿å…å±€éƒ¨çƒ­ç‚¹å¼•å‘ç³»ç»Ÿå´©æºƒ&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†”æ–­é™çº§ï¼ˆCircuit Breaking &amp;amp; Degradationï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç†”æ–­æœºåˆ¶ï¼šåŸºäºä¸‰ç§çŠ¶æ€åˆ‡æ¢ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Closed&lt;/strong&gt;ï¼šæ­£å¸¸é€šè¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Open&lt;/strong&gt;ï¼šè§¦å‘ç†”æ–­ï¼Œè¯·æ±‚ç›´æ¥æ‹’ç»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Half-Open&lt;/strong&gt;ï¼šè¯•æ¢æ€§æ”¾è¡Œå°‘é‡è¯·æ±‚ï¼ŒæˆåŠŸåˆ™å…³é—­ç†”æ–­&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é™çº§ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ…¢è°ƒç”¨æ¯”ä¾‹&lt;/strong&gt;ï¼ˆå“åº”æ—¶é—´è¶…é˜ˆå€¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸æ¯”ä¾‹/æ•°é‡&lt;/strong&gt;ï¼ˆé”™è¯¯ç‡è¶…é˜ˆå€¼ï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fallback å¤„ç†&lt;/strong&gt;ï¼šç†”æ–­æ—¶æ‰§è¡Œå¤‡ç”¨é€»è¾‘ï¼ˆå¦‚è¿”å›ç¼“å­˜æ•°æ®æˆ–å‹å¥½æç¤ºï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ï¼ˆSystem Adaptive Protectionï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®ç³»ç»Ÿè´Ÿè½½ï¼ˆCPUã€å†…å­˜ã€Loadï¼‰åŠ¨æ€è°ƒæ•´å…¥å£æµé‡ï¼Œé¿å…èµ„æºè€—å°½&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆçº§ä¿æŠ¤æ ¸å¿ƒä¸šåŠ¡ï¼Œéæ ¸å¿ƒè¯·æ±‚è‡ªåŠ¨é™çº§&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶ç›‘æ§ä¸åŠ¨æ€è§„åˆ™&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Dashboard æ§åˆ¶å°&lt;/strong&gt;ï¼šå¯è§†åŒ–ç›‘æ§ QPSã€å“åº”æ—¶é—´ã€ç†”æ–­çŠ¶æ€ç­‰æŒ‡æ ‡&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™åŠ¨æ€ç”Ÿæ•ˆ&lt;/strong&gt;ï¼šæ— éœ€é‡å¯æœåŠ¡ï¼Œé€šè¿‡æ§åˆ¶å°æˆ–é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰å®æ—¶æ›´æ–°è§„åˆ™&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶æ„ä¸å·¥ä½œåŸç†"&gt;âš™ï¸ æ¶æ„ä¸å·¥ä½œåŸç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæ¶æ„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºï¼ˆResourceï¼‰&lt;/strong&gt;ï¼šè¢«ä¿æŠ¤çš„å®ä½“ï¼ˆå¦‚ APIã€æ–¹æ³•ã€æœåŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™ï¼ˆRuleï¼‰&lt;/strong&gt;ï¼šå®šä¹‰æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§çš„é˜ˆå€¼å’Œç­–ç•¥&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Slot è´£ä»»é“¾ï¼šå¤„ç†èµ„æºçš„æ’æ§½é“¾ï¼ŒåŒ…å«å…³é”®ç»„ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NodeSelectorSlot&lt;/code&gt;ï¼šèµ„æºè°ƒç”¨è·¯å¾„ç»Ÿè®¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FlowSlot&lt;/code&gt;ï¼šæµé‡æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DegradeSlot&lt;/code&gt;ï¼šç†”æ–­é™çº§&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;ol&gt;
&lt;li&gt;è¯·æ±‚è¿›å…¥ Sentinel å®šä¹‰çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ Slot é“¾ä¾æ¬¡å¤„ç†ï¼šç»Ÿè®¡æŒ‡æ ‡ â†’ æ ¡éªŒæµé‡è§„åˆ™ â†’ æ‰§è¡Œç†”æ–­åˆ¤æ–­ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥è§¦å‘é™åˆ¶ï¼Œæ‰§è¡Œæ‹’ç»æˆ– Fallbackï¼›å¦åˆ™æ­£å¸¸æ”¾è¡Œ&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨å®è·µ"&gt;ğŸ› ï¸ ä½¿ç”¨å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿé›†æˆï¼ˆSpring Cloudï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¾èµ–å¼•å…¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.alibaba.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-alibaba-sentinel&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®æ§åˆ¶å°ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
sentinel:
transport:
dashboard: localhost:8080 # Sentinelæ§åˆ¶å°åœ°å€
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æ³¨è§£å®šä¹‰èµ„æºï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@GetMapping(&amp;#34;/api&amp;#34;)
@SentinelResource(value = &amp;#34;apiResource&amp;#34;,
blockHandler = &amp;#34;blockHandler&amp;#34;,
fallback = &amp;#34;fallback&amp;#34;)
public String api() {
return &amp;#34;Success&amp;#34;;
}
// é™æµå¤„ç†
public String blockHandler(BlockException ex) {
return &amp;#34;Request blocked!&amp;#34;;
}
// ç†”æ–­é™çº§
public String fallback(Throwable t) {
return &amp;#34;Fallback response&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;3,5,8&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™æŒä¹…åŒ–ï¼ˆNacos é›†æˆï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å°†è§„åˆ™å­˜å‚¨åˆ° Nacosï¼Œé¿å…é‡å¯ä¸¢å¤±ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
sentinel:
datasource:
flow:
nacos:
server-addr: localhost:8848
dataId: sentinel-flow-rules
&lt;/code&gt;&lt;/pre&gt;3,6&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒä¼˜åŠ¿"&gt;âš¡ æ ¸å¿ƒä¼˜åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨ä¸æ‰©å±•æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒé›†ç¾¤æµæ§ï¼Œç»Ÿä¸€ç®¡ç†å¤šèŠ‚ç‚¹æµé‡&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;SPI æ‰©å±•æ¥å£å…è®¸è‡ªå®šä¹‰ Slotã€æ•°æ®æºç­‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæ€å…¼å®¹æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ— ç¼é›†æˆ Spring Cloudã€Dubboã€gRPC ç­‰æ¡†æ¶&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€‚é…äº‘åŸç”Ÿç¯å¢ƒï¼ˆKubernetesã€Service Meshï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¼‚æ­¥ç»Ÿè®¡ä¸è½»é‡çº§è®¾è®¡ï¼Œå¯¹ä¸šåŠ¡æ€§èƒ½å½±å“ä½äº 1%&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸ”„ å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç§’æ€é«˜å¹¶å‘&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;QPSé™æµ + é¢„çƒ­å¯åŠ¨ï¼Œé¿å…ç¬æ—¶æµé‡å‹å®ç³»ç»Ÿ&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡é›ªå´©é¢„é˜²&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç†”æ–­å¼‚å¸¸æœåŠ¡ï¼ŒFallbackè¿”å›å…œåº•æ•°æ®&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šç§Ÿæˆ·éš”ç¦»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çƒ­ç‚¹å‚æ•°é™æµï¼Œä¿éšœå…³é”®ç”¨æˆ·èµ„æº&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ··åˆäº‘éƒ¨ç½²&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ï¼Œæ ¹æ®è´Ÿè½½åŠ¨æ€é™æµ&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Sentinel é€šè¿‡&lt;strong&gt;å¤šç»´åº¦æµé‡æ²»ç†&lt;/strong&gt;ï¼ˆé™æµã€ç†”æ–­ã€è´Ÿè½½ä¿æŠ¤ï¼‰å’Œ&lt;strong&gt;åŠ¨æ€è§„åˆ™é…ç½®&lt;/strong&gt;ï¼Œæˆä¸ºå¾®æœåŠ¡ç¨³å®šæ€§çš„æ ¸å¿ƒå®ˆå«ã€‚å…¶ä¼˜åŠ¿åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€ç®±å³ç”¨&lt;/strong&gt;ï¼šæ³¨è§£ä¸é…ç½®ç®€åŒ–æ¥å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶å¯æ§&lt;/strong&gt;ï¼šDashboard ç›‘æ§ + åŠ¨æ€è§„åˆ™ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ‰©å±•æ€§&lt;/strong&gt;ï¼šè‡ªå®šä¹‰ Slot ä¸è§„åˆ™æŒä¹…åŒ–æ”¯æŒ&lt;a class="link" href="@ref" &gt;2,6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒéœ€ç»“åˆ Nacos å®ç°è§„åˆ™æŒä¹…åŒ–ï¼Œé¿å…è§„åˆ™ä¸¢å¤±é£é™©&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="sentinelresource"&gt;@SentinelResource
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@SentinelResource&lt;/code&gt; æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„æµé‡æ²»ç†æ¡†æ¶ &lt;strong&gt;Sentinel&lt;/strong&gt; ä¸­çš„æ ¸å¿ƒæ³¨è§£ï¼Œç”¨äºåœ¨æ–¹æ³•æˆ–ç±»çº§åˆ«å®šä¹‰å—ä¿æŠ¤çš„èµ„æºï¼Œå¹¶é…ç½®é™æµã€ç†”æ–­é™çº§ç­‰è§„åˆ™çš„å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒåŠŸèƒ½ã€å‚æ•°è¯¦è§£ã€ä½¿ç”¨å®è·µåŠå¸¸è§è¯¯åŒºå››ä¸ªç»´åº¦å±•å¼€è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½ä¸å®šä½"&gt;ğŸ” æ ¸å¿ƒåŠŸèƒ½ä¸å®šä½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºå®šä¹‰&lt;/strong&gt;
é€šè¿‡æ³¨è§£æ ‡è®°éœ€å— Sentinel ä¿æŠ¤çš„ä»£ç å•å…ƒï¼ˆå¦‚æ–¹æ³•ã€æ¥å£ï¼‰ï¼Œä½¿å…¶æˆä¸ºæµé‡æ²»ç†çš„ç®¡æ§ç‚¹&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸å¤„ç†
æä¾›ä¸¤ç§å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;blockHandler&lt;/code&gt;&lt;/strong&gt;ï¼šå¤„ç†å› é™æµæˆ–ç†”æ–­è§¦å‘çš„ &lt;code&gt;BlockException&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;FlowException&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;fallback&lt;/code&gt;&lt;/strong&gt;ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„é &lt;code&gt;BlockException&lt;/code&gt; å¼‚å¸¸ï¼ˆå¦‚ç©ºæŒ‡é’ˆã€è¶…æ—¶ç­‰ï¼‰ï¼Œå®ç°æœåŠ¡é™çº§&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è§„åˆ™é›†æˆ&lt;/strong&gt;
é…åˆ Sentinel Dashboard åŠ¨æ€é…ç½®è§„åˆ™ï¼ˆQPSé™æµã€ç†”æ–­ç­–ç•¥ï¼‰ï¼Œå®æ—¶ç”Ÿæ•ˆæ— éœ€é‡å¯æœåŠ¡&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å‚æ•°è¯¦è§£ä¸é…ç½®"&gt;âš™ï¸ å‚æ•°è¯¦è§£ä¸é…ç½®
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒå‚æ•°è¯´æ˜"&gt;&lt;strong&gt;æ ¸å¿ƒå‚æ•°è¯´æ˜&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å‚æ•°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¿…å¡«&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;èµ„æºå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåŒ¹é… Dashboard ä¸­çš„è§„åˆ™&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;quot;userQuery&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;blockHandler&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å¤„ç† &lt;code&gt;BlockException&lt;/code&gt; çš„æ–¹æ³•å&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;quot;handleBlock&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;blockHandlerClass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ &lt;code&gt;blockHandler&lt;/code&gt; æ–¹æ³•çš„ç±»ï¼ˆéœ€&lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CommonHandler.class&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;fallback&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å¤„ç†ä¸šåŠ¡å¼‚å¸¸çš„æ–¹æ³•å&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;quot;fallbackLogic&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;fallbackClass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ &lt;code&gt;fallback&lt;/code&gt; æ–¹æ³•çš„ç±»ï¼ˆéœ€&lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FallbackHandler.class&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;exceptionsToIgnore&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;æŒ‡å®šå¿½ç•¥çš„å¼‚å¸¸ç±»å‹ï¼Œæ­¤ç±»å¼‚å¸¸&lt;strong&gt;ä¸è§¦å‘&lt;/strong&gt; fallback&lt;/td&gt;
&lt;td&gt;&lt;code&gt;{IllegalArgumentException.class}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;defaultFallback&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å…¨å±€é»˜è®¤é™çº§æ–¹æ³•ï¼ˆæ— å‚æ•°æˆ–ä»… &lt;code&gt;Throwable&lt;/code&gt; å‚æ•°ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;&amp;quot;defaultFallback&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="æ–¹æ³•ç­¾åè¦æ±‚"&gt;&lt;strong&gt;æ–¹æ³•ç­¾åè¦æ±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å¤„ç†ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•ç­¾åè¦æ±‚&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;blockHandler&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŸæ–¹æ³•å‚æ•° + &lt;code&gt;BlockException&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;handleBlock(String param, BlockException ex)&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;fallback&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŸæ–¹æ³•å‚æ•° æˆ– åŸå‚æ•° + &lt;code&gt;Throwable&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;fallbackLogic(String param, Throwable t)&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;defaultFallback&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— å‚æ•° æˆ– ä»… &lt;code&gt;Throwable&lt;/code&gt; å‚æ•°ï¼ˆå¦‚ &lt;code&gt;defaultFallback(Throwable t)&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨å®è·µä¸ä»£ç ç¤ºä¾‹"&gt;ğŸ› ï¸ ä½¿ç”¨å®è·µä¸ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="åŸºç¡€é…ç½®æ­¥éª¤"&gt;&lt;strong&gt;åŸºç¡€é…ç½®æ­¥éª¤&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;Step 1ï¼šæ·»åŠ ä¾èµ–ä¸åˆ‡é¢æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.alibaba.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-alibaba-sentinel&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.alibaba.csp&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;sentinel-annotation-aspectj&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Step 2ï¼šå¯ç”¨åˆ‡é¢&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class SentinelConfig {
@Bean
public SentinelResourceAspect sentinelResourceAspect() {
return new SentinelResourceAspect(); // å…³é”®ï¼šä½¿æ³¨è§£ç”Ÿæ•ˆ[1,6](@ref)
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="æ³¨è§£ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;æ³¨è§£ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController
public class UserController {
// å®šä¹‰èµ„æºå¹¶æŒ‡å®šå¼‚å¸¸å¤„ç†
@GetMapping(&amp;#34;/user/{id}&amp;#34;)
@SentinelResource(
value = &amp;#34;getUser&amp;#34;,
blockHandler = &amp;#34;handleBlock&amp;#34;,
blockHandlerClass = BlockExceptionHandler.class, // é™æ€æ–¹æ³•ç±»
fallback = &amp;#34;userFallback&amp;#34;
)
public User getUser(@PathVariable String id) {
if (&amp;#34;0&amp;#34;.equals(id)) throw new RuntimeException(&amp;#34;Invalid ID&amp;#34;);
return userService.findById(id);
}
// fallbackæ–¹æ³•ï¼ˆåŒç±»åˆ«åï¼‰
public User userFallback(String id, Throwable t) {
return new User(&amp;#34;0&amp;#34;, &amp;#34;Fallback User&amp;#34;);
}
}
// å…¨å±€BlockExceptionå¤„ç†å™¨
public class BlockExceptionHandler {
public static User handleBlock(String id, BlockException ex) {
return new User(&amp;#34;0&amp;#34;, &amp;#34;è¯·æ±‚è¢«é™æµ&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="sentinel-dashboard-é…ç½®"&gt;&lt;strong&gt;Sentinel Dashboard é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;è®¿é—® &lt;code&gt;localhost:8080&lt;/code&gt; è¿›å…¥æ§åˆ¶å°ï¼Œæ‰¾åˆ°èµ„æº &lt;code&gt;getUser&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®æµæ§è§„åˆ™ï¼šQPSé˜ˆå€¼=2ï¼Œè¶…å‡ºåˆ™è§¦å‘ &lt;code&gt;blockHandler&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®é™çº§è§„åˆ™ï¼šå¼‚å¸¸æ¯”ä¾‹&amp;gt;50%æ—¶ç†”æ–­ï¼Œè§¦å‘ &lt;code&gt;fallback&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—"&gt;âš ï¸ å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åˆ‡é¢æœªç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æœªæ³¨å…¥ &lt;code&gt;SentinelResourceAspect&lt;/code&gt; Bean â†’ éœ€æ£€æŸ¥åˆ‡é¢é…ç½®&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;æ–¹æ³•ç­¾åä¸åŒ¹é…&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;blockHandler&lt;/code&gt; ç¼ºå°‘ &lt;code&gt;BlockException&lt;/code&gt; å‚æ•° â†’ å¯¼è‡´æ— æ³•å¤„ç†é™æµå¼‚å¸¸&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;é™æ€æ–¹æ³•è¦æ±‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;è·¨ç±»å¤„ç†æ—¶æœªç”¨ &lt;code&gt;static&lt;/code&gt; ä¿®é¥°æ–¹æ³• â†’ æŠ›å‡º &lt;code&gt;NoSuchMethodException&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;å¼‚å¸¸å¤„ç†ä¼˜å…ˆçº§æ··æ·†&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åŒæ—¶é…ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; blockHandler
```
å’Œ
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; fallback
```
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ—¶ï¼š
- &lt;code&gt;BlockException&lt;/code&gt; â†’ ä»…è§¦å‘ &lt;code&gt;blockHandler&lt;/code&gt;ã€‚
- ä¸šåŠ¡å¼‚å¸¸ â†’ ä»…è§¦å‘ &lt;code&gt;fallback&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@SentinelResource&lt;/code&gt; é€šè¿‡&lt;strong&gt;å£°æ˜å¼èµ„æºå®šä¹‰&lt;/strong&gt;ä¸&lt;strong&gt;åŒè·¯å¼‚å¸¸å¤„ç†æœºåˆ¶&lt;/strong&gt;ï¼ˆ&lt;code&gt;blockHandler&lt;/code&gt; + &lt;code&gt;fallback&lt;/code&gt;ï¼‰ï¼Œæˆä¸ºå¾®æœåŠ¡æµé‡æ²»ç†çš„æ ¸å¿ƒå·¥å…·ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–é›†æˆ&lt;/strong&gt;ï¼šæ³¨è§£é©±åŠ¨ï¼Œä¸ Spring ç”Ÿæ€æ— ç¼ç»“åˆ&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ²»ç†&lt;/strong&gt;ï¼šæ”¯æŒåŠ¨æ€è§„åˆ™é…ç½®ï¼Œå®æ—¶å“åº”æµé‡å˜åŒ–&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¹é”™ä¿éšœ&lt;/strong&gt;ï¼šåŒé“¾è·¯é™çº§ç­–ç•¥ç¡®ä¿æœåŠ¡é«˜å¯ç”¨&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒåŠ¡å¿…é…åˆ &lt;strong&gt;è§„åˆ™æŒä¹…åŒ–ï¼ˆå¦‚ Nacosï¼‰&lt;/strong&gt; ä¸ &lt;strong&gt;å…¨å±€å¼‚å¸¸å¤„ç†å™¨&lt;/strong&gt;ï¼Œé¿å…è§„åˆ™ä¸¢å¤±å¯¼è‡´æ²»ç†å¤±æ•ˆ&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="blcokexception"&gt;BLCOKEXCEPTION
&lt;/h2&gt;&lt;p&gt;åœ¨Sentinelæ¡†æ¶ä¸­ï¼Œ&lt;code&gt;BlockException&lt;/code&gt;æ˜¯æµé‡æ§åˆ¶çš„æ ¸å¿ƒå¼‚å¸¸ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºè¯·æ±‚å› è§¦å‘é™æµã€ç†”æ–­æˆ–ç³»ç»Ÿä¿æŠ¤è§„åˆ™è€Œè¢«æ‹’ç»ã€‚ä»¥ä¸‹æ˜¯å…¶å·¥ä½œæœºåˆ¶å’Œå¼€å‘å®è·µçš„å…³é”®è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-blockexception"&gt;ğŸ” &lt;strong&gt;&lt;code&gt;BlockException&lt;/code&gt;çš„æœ¬è´¨ä¸è§¦å‘æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰ä¸ä½œç”¨"&gt;&lt;strong&gt;å®šä¹‰ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;BlockException&lt;/code&gt;æ˜¯Sentinelå†…éƒ¨è‡ªåŠ¨æŠ›å‡ºçš„&lt;strong&gt;ç³»ç»Ÿçº§å¼‚å¸¸&lt;/strong&gt;ï¼Œå¼€å‘è€…&lt;strong&gt;æ— éœ€&lt;/strong&gt;åœ¨ä¸šåŠ¡ä»£ç ä¸­æ‰‹åŠ¨æŠ›å‡ºã€‚å®ƒè¡¨ç¤ºå½“å‰è¯·æ±‚å› è¿åé¢„è®¾è§„åˆ™ï¼ˆå¦‚QPSè¶…é™ã€ç†”æ–­è§¦å‘ç­‰ï¼‰è¢«Sentinelæ‹¦æˆª&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="è§¦å‘åœºæ™¯"&gt;&lt;strong&gt;è§¦å‘åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è§„åˆ™ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¼‚å¸¸å­ç±»&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æµé‡æ§åˆ¶ï¼ˆFlowï¼‰&lt;/td&gt;
&lt;td&gt;QPSæˆ–å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡é˜ˆå€¼&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FlowException&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç†”æ–­é™çº§ï¼ˆDegradeï¼‰&lt;/td&gt;
&lt;td&gt;æ…¢è°ƒç”¨æ¯”ä¾‹/å¼‚å¸¸æ¯”ä¾‹è¶…é™æˆ–å¼‚å¸¸æ•°ç´¯ç§¯&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DegradeException&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç³»ç»Ÿä¿æŠ¤ï¼ˆSystemï¼‰&lt;/td&gt;
&lt;td&gt;ç³»ç»Ÿè´Ÿè½½ï¼ˆCPU/å†…å­˜ï¼‰è¶…è¿‡é˜ˆå€¼&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SystemBlockException&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æƒé™æ§åˆ¶ï¼ˆAuthorityï¼‰&lt;/td&gt;
&lt;td&gt;é»‘ç™½åå•æ ¡éªŒå¤±è´¥&lt;/td&gt;
&lt;td&gt;&lt;code&gt;AuthorityException&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å¤„ç†ç­–ç•¥å¼€å‘è€…å¦‚ä½•åº”å¯¹"&gt;âš™ï¸ &lt;strong&gt;å¤„ç†ç­–ç•¥ï¼šå¼€å‘è€…å¦‚ä½•åº”å¯¹&lt;code&gt;BlockException&lt;/code&gt;&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶æ— éœ€æŠ›å‡ºï¼Œä½†å¼€å‘è€…éœ€å¤„ç†æ­¤å¼‚å¸¸ä»¥ä¿éšœç”¨æˆ·ä½“éªŒã€‚Sentinelæä¾›ä¸‰ç§å¤„ç†æ–¹å¼ï¼š&lt;/p&gt;
&lt;h4 id="æ³¨è§£é©±åŠ¨"&gt;&lt;strong&gt;æ³¨è§£é©±åŠ¨ï¼š&lt;code&gt;@SentinelResource&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;blockHandler&lt;/code&gt;å±æ€§æŒ‡å®šé™æµ/ç†”æ–­çš„é™çº§é€»è¾‘ï¼Œä¸ä¸šåŠ¡ä»£ç è§£è€¦&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SentinelResource(
value = &amp;#34;queryOrder&amp;#34;,
blockHandler = &amp;#34;handleBlock&amp;#34;, // å¤„ç†BlockExceptionçš„æ–¹æ³•
fallback = &amp;#34;handleFallback&amp;#34; // å¤„ç†ä¸šåŠ¡å¼‚å¸¸çš„æ–¹æ³•
)
public Order queryOrder(String orderId) {
// ä¸šåŠ¡é€»è¾‘ï¼ˆæ— éœ€æ„ŸçŸ¥BlockExceptionï¼‰
}
// é™çº§æ–¹æ³•ï¼ˆéœ€ä¸åŸæ–¹æ³•å‚æ•°ä¸€è‡´ï¼Œæœ«å°¾å¯åŠ BlockExceptionå‚æ•°ï¼‰
public Order handleBlock(String orderId, BlockException ex) {
return Order.DEFAULT_ORDER; // è¿”å›å…œåº•æ•°æ®
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å…¨å±€ç»Ÿä¸€å¤„ç†"&gt;&lt;strong&gt;å…¨å±€ç»Ÿä¸€å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®ç°&lt;code&gt;BlockExceptionHandler&lt;/code&gt;æ¥å£ï¼Œå®šåˆ¶æ‰€æœ‰èµ„æºçš„å¼‚å¸¸å“åº”&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class GlobalBlockHandler implements BlockExceptionHandler {
@Override
public void handle(HttpServletRequest request, HttpServletResponse response, BlockException ex) {
String message = &amp;#34;è¯·æ±‚è¢«æ‹’ç»ï¼š&amp;#34;;
if (ex instanceof FlowException) {
message += &amp;#34;æ¥å£é™æµ&amp;#34;;
} else if (ex instanceof DegradeException) {
message += &amp;#34;æœåŠ¡ç†”æ–­&amp;#34;;
}
response.setContentType(&amp;#34;application/json&amp;#34;);
response.getWriter().write(&amp;#34;{\&amp;#34;code\&amp;#34;:429,\&amp;#34;msg\&amp;#34;:\&amp;#34;&amp;#34; + message + &amp;#34;\&amp;#34;}&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ä»£ç æ˜¾å¼æ•è·"&gt;&lt;strong&gt;ä»£ç æ˜¾å¼æ•è·&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨è°ƒç”¨Sentinelä¿æŠ¤èµ„æºåç›´æ¥æ•è·å¼‚å¸¸ï¼ˆçµæ´»æ€§é«˜ï¼Œä½†ä¾µå…¥æ€§å¼ºï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;try {
orderService.queryOrder(&amp;#34;123&amp;#34;);
} catch (BlockException ex) {
// è‡ªå®šä¹‰å¤„ç†é€»è¾‘
log.error(&amp;#34;è¯·æ±‚è¢«Sentinelæ‹¦æˆª&amp;#34;, ex);
return &amp;#34;æœåŠ¡ç¹å¿™ï¼Œè¯·é‡è¯•&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•ç­¾åçº¦æŸ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;blockHandler&lt;/code&gt;æ–¹æ³•éœ€ä¸åŸæ–¹æ³•&lt;strong&gt;å‚æ•°ä¸€è‡´&lt;/strong&gt;ï¼ˆå¯é¢å¤–åŠ &lt;code&gt;BlockException&lt;/code&gt;å‚æ•°ï¼‰ï¼Œä¸”&lt;strong&gt;è¿”å›ç±»å‹ç›¸åŒ&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ä½¿ç”¨è·¨ç±»å¤„ç†ï¼ˆ&lt;code&gt;blockHandlerClass&lt;/code&gt;ï¼‰ï¼Œæ–¹æ³•å¿…é¡»æ˜¯&lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸&lt;code&gt;fallback&lt;/code&gt;çš„åŒºåˆ«&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;blockHandler&lt;/code&gt;ä»…å¤„ç†&lt;code&gt;BlockException&lt;/code&gt;ï¼ˆè§„åˆ™è§¦å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fallback&lt;/code&gt;å¤„ç†ä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„&lt;strong&gt;é&lt;code&gt;BlockException&lt;/code&gt;å¼‚å¸¸&lt;/strong&gt;ï¼ˆå¦‚ç©ºæŒ‡é’ˆã€è¶…æ—¶ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™æŒä¹…åŒ–å¿…è¦æ€§&lt;/strong&gt;
Sentinelé»˜è®¤è§„åˆ™å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé‡å¯åå¤±æ•ˆã€‚éœ€é›†æˆNacosç­‰é…ç½®ä¸­å¿ƒå®ç°è§„åˆ™æŒä¹…åŒ–ï¼Œé¿å…ç”Ÿäº§ç¯å¢ƒè§„åˆ™ä¸¢å¤±&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šæœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸šåŠ¡é€»è¾‘ä¸é™çº§è§£è€¦&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨&lt;code&gt;@SentinelResource&lt;/code&gt; + &lt;code&gt;blockHandler&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¨å±€é™æµ/ç†”æ–­å“åº”æ ¼å¼åŒ–&lt;/td&gt;
&lt;td&gt;å®ç°&lt;code&gt;BlockExceptionHandler&lt;/code&gt;ç»Ÿä¸€å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚é™çº§é€»è¾‘ï¼ˆå¦‚é‡è¯•ã€æ—¥å¿—ï¼‰&lt;/td&gt;
&lt;td&gt;æ˜¾å¼æ•è·&lt;code&gt;BlockException&lt;/code&gt; + è‡ªå®šä¹‰é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¿…é¡»&lt;/strong&gt;é›†æˆNacosæŒä¹…åŒ–è§„åˆ™&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;æ ¸å¿ƒç»“è®º&lt;/strong&gt;ï¼šå¼€å‘è€…&lt;strong&gt;æ— éœ€&lt;/strong&gt;åœ¨ä¸šåŠ¡ä»£ç ä¸­æŠ›å‡º`BlockException**ï¼Œä½†éœ€é€šè¿‡æ³¨è§£ã€å…¨å±€å¤„ç†å™¨æˆ–æ˜¾å¼æ•è·å¤„ç†æ­¤å¼‚å¸¸ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨æµé‡é«˜å³°æˆ–æ•…éšœæ—¶ä»èƒ½æä¾›å¯æ§çš„é™çº§å“åº”ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="seata"&gt;Seata
&lt;/h2&gt;&lt;p&gt;Seataï¼ˆSimple Extensible Autonomous Transaction Architectureï¼‰æ˜¯ä¸€æ¬¾ç”±é˜¿é‡Œå·´å·´å¼€æºçš„&lt;strong&gt;åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼Œä¸“æ³¨äºè§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹è·¨æœåŠ¡ã€è·¨æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚å®ƒé€šè¿‡æä¾›å¤šç§äº‹åŠ¡æ¨¡å¼ï¼ˆATã€TCCã€SAGAã€XAï¼‰å’Œç®€æ´çš„APIï¼Œå®ç°å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„é«˜æ•ˆç®¡ç†ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„"&gt;ğŸ” æ ¸å¿ƒæ¦‚å¿µä¸æ¶æ„
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒç»„ä»¶-2"&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;TC (Transaction Coordinator)&lt;/strong&gt;ï¼šäº‹åŠ¡åè°ƒå™¨ï¼Œç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡ç«¯ç»„ä»¶ï¼Œè´Ÿè´£ç»´æŠ¤å…¨å±€äº‹åŠ¡çŠ¶æ€ï¼ˆæäº¤/å›æ»šï¼‰ã€è°ƒåº¦åˆ†æ”¯äº‹åŠ¡ï¼Œæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„â€œå¤§è„‘â€&lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TM (Transaction Manager)&lt;/strong&gt;ï¼šäº‹åŠ¡ç®¡ç†å™¨ï¼Œé›†æˆåœ¨ä¸šåŠ¡æœåŠ¡ä¸­ï¼Œè´Ÿè´£å®šä¹‰å…¨å±€äº‹åŠ¡è¾¹ç•Œï¼ˆå¼€å¯ã€æäº¤ã€å›æ»šï¼‰ï¼Œå¹¶å‘TCå‘èµ·å…¨å±€äº‹åŠ¡å†³è®®&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RM (Resource Manager)&lt;/strong&gt;ï¼šèµ„æºç®¡ç†å™¨ï¼Œç®¡ç†åˆ†æ”¯äº‹åŠ¡çš„èµ„æºï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼Œå‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡å¹¶æ‰§è¡Œæäº¤/å›æ»šæ“ä½œ&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å·¥ä½œæµç¨‹-1"&gt;&lt;strong&gt;å·¥ä½œæµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€äº‹åŠ¡å¼€å¯&lt;/strong&gt;ï¼šTMå‘TCç”³è¯·å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œç”Ÿæˆå…¨å±€å”¯ä¸€äº‹åŠ¡IDï¼ˆXIDï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†æ”¯äº‹åŠ¡æ³¨å†Œ&lt;/strong&gt;ï¼šRMåœ¨æ‰§è¡Œä¸šåŠ¡æ“ä½œå‰ï¼Œå‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œçº³å…¥XIDç®¡ç†&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ‰§è¡Œ&lt;/strong&gt;ï¼šå„åˆ†æ”¯äº‹åŠ¡åœ¨æœ¬åœ°æäº¤ï¼ˆå¦‚ATæ¨¡å¼ä¸€é˜¶æ®µæäº¤ï¼‰ï¼Œè®°å½•å›æ»šæ—¥å¿—ï¼ˆundo_logï¼‰&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€å†³è®®&lt;/strong&gt;ï¼šä¸šåŠ¡å®Œæˆåï¼ŒTMé€šçŸ¥TCæäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ï¼›TCè°ƒåº¦æ‰€æœ‰RMæ‰§è¡Œæœ€ç»ˆæ“ä½œï¼ˆå¦‚åˆ é™¤æ—¥å¿—æˆ–åå‘è¡¥å¿ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº‹åŠ¡æ¨¡å¼è¯¦è§£"&gt;âš™ï¸ äº‹åŠ¡æ¨¡å¼è¯¦è§£
&lt;/h3&gt;&lt;p&gt;Seataæä¾›å››ç§æ¨¡å¼é€‚é…ä¸åŒåœºæ™¯ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾µå…¥æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AT (Automatic Transaction)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ä»£ç†æ•°æ®æºè‡ªåŠ¨ç”ŸæˆSQLå›æ»šæ—¥å¿—ï¼ŒäºŒé˜¶æ®µå¼‚æ­¥æäº¤æˆ–åå‘è¡¥å¿&lt;/td&gt;
&lt;td&gt;æ— ä¾µå…¥ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ç”µå•†è®¢å•ï¼‰&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TCC (Try-Confirm-Cancel)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼€å‘è€…éœ€å®ç°Tryï¼ˆé¢„ç•™èµ„æºï¼‰ã€Confirmï¼ˆæäº¤ï¼‰ã€Cancelï¼ˆå›æ»šï¼‰ä¸‰é˜¶æ®µ&lt;/td&gt;
&lt;td&gt;å¼ºä¾µå…¥&lt;/td&gt;
&lt;td&gt;éœ€å¼ºä¸€è‡´æ€§ï¼ˆå¦‚é‡‘èæ‰£æ¬¾ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SAGA&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œå¤±è´¥æ—¶è§¦å‘é€†å‘è¡¥å¿æ“ä½œ&lt;/td&gt;
&lt;td&gt;ä¸­åº¦ä¾µå…¥&lt;/td&gt;
&lt;td&gt;å¼‚æ­¥æµç¨‹ï¼ˆå¦‚ç‰©æµè°ƒåº¦ï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XA&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºæ•°æ®åº“XAåè®®çš„ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ï¼Œå…¨ç¨‹é”èµ„æº&lt;/td&gt;
&lt;td&gt;æ— ä¾µå…¥&lt;/td&gt;
&lt;td&gt;æ”¯æŒXAåè®®çš„æ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="-atæ¨¡å¼æ ¸å¿ƒæœºåˆ¶"&gt;âœ¨ &lt;strong&gt;ATæ¨¡å¼æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€é˜¶æ®µ&lt;/strong&gt;ï¼šä¸šåŠ¡SQLä¸å›æ»šæ—¥å¿—ï¼ˆundo_logï¼‰åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ï¼Œé‡Šæ”¾èµ„æºé”&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äºŒé˜¶æ®µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æäº¤&lt;/strong&gt;ï¼šå¼‚æ­¥åˆ é™¤undo_logï¼ˆå‡ ä¹æ— å»¶è¿Ÿï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›æ»š&lt;/strong&gt;ï¼šæ ¹æ®undo_logç”Ÿæˆåå‘SQLè¡¥å¿æ•°æ®ï¼Œè‹¥æ•°æ®è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ï¼ˆè„å†™ï¼‰ï¼Œè§¦å‘äººå·¥å¤„ç†&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-éƒ¨ç½²ä¸é›†æˆ"&gt;ğŸ› ï¸ éƒ¨ç½²ä¸é›†æˆ
&lt;/h3&gt;&lt;h4 id="tcæœåŠ¡ç«¯éƒ¨ç½²"&gt;&lt;strong&gt;TCæœåŠ¡ç«¯éƒ¨ç½²&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½Seata-Serverï¼ˆ&lt;a class="link" href="https://seata.apache.org/" target="_blank" rel="noopener"
&gt;å®˜ç½‘&lt;/a&gt;ï¼‰å¹¶è§£å‹&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚Nacosï¼‰å’Œå­˜å‚¨æ¨¡å¼ï¼ˆæ¨è
&lt;pre tabindex="0"&gt;&lt;code&gt;db
&lt;/code&gt;&lt;/pre&gt;æ¨¡å¼é«˜å¯ç”¨ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# registry.conf
registry { type = &amp;#34;nacos&amp;#34; }
config { type = &amp;#34;nacos&amp;#34; }
# file.conf
store.mode = &amp;#34;db&amp;#34; # æ•°æ®åº“å­˜å‚¨äº‹åŠ¡æ—¥å¿—[1,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ•°æ®åº“è¡¨ï¼ˆ&lt;code&gt;global_table&lt;/code&gt;ã€&lt;code&gt;branch_table&lt;/code&gt;ã€&lt;code&gt;lock_table&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®¢æˆ·ç«¯é›†æˆspring-cloud"&gt;&lt;strong&gt;å®¢æˆ·ç«¯é›†æˆï¼ˆSpring Cloudï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¾èµ–å¼•å…¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;io.seata&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;seata-spring-boot-starter&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.4.1&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;seata:
application-id: order-service
tx-service-group: my_tx_group # éœ€ä¸TCæœåŠ¡æ˜ å°„[7](@ref)
service:
vgroup-mapping:
my_tx_group: default # TCé›†ç¾¤ç»„å
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æ³¨è§£ä½¿ç”¨ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@GlobalTransactional // å¼€å¯å…¨å±€äº‹åŠ¡
public void createOrder() {
orderService.save(); // æœ¬åœ°äº‹åŠ¡
inventoryService.reduce(); // è¿œç¨‹è°ƒç”¨ï¼ˆRMè‡ªåŠ¨æ³¨å†Œï¼‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ"&gt;ğŸŒ åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="å…¸å‹åœºæ™¯-1"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¨æœåŠ¡äº‹åŠ¡&lt;/strong&gt;ï¼šè®¢å•åˆ›å»ºï¼ˆæ‰£åº“å­˜+ç”Ÿæˆè®¢å•ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨åº“äº‹åŠ¡&lt;/strong&gt;ï¼šåˆ†åº“åˆ†è¡¨ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ï¼ˆå¦‚ç”¨æˆ·è´¦æˆ·+æ—¥å¿—è¡¨ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼šç»“åˆæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚RocketMQï¼‰å®ç°å¼‚æ­¥äº‹åŠ¡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;ATæ¨¡å¼è°ƒä¼˜ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å…é•¿äº‹åŠ¡ï¼Œå‡å°‘undo_logå­˜å‚¨å‹åŠ›&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;SELECT FOR UPDATE&lt;/code&gt;ä¿è¯è¯»éš”ç¦»ï¼ˆå…¨å±€é”æ§åˆ¶ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é«˜å¯ç”¨éƒ¨ç½²ï¼š
&lt;ul&gt;
&lt;li&gt;TCé›†ç¾¤åŒ– + Nacosæ³¨å†Œä¸­å¿ƒ&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“å­˜å‚¨æ¨¡å¼ï¼ˆ&lt;code&gt;store.mode=db&lt;/code&gt;ï¼‰é¿å…å•ç‚¹æ•…éšœ&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ç”Ÿäº§ç¯å¢ƒé¿å‘"&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒé¿å‘&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è„å†™å¤„ç†&lt;/strong&gt;ï¼šATæ¨¡å¼å›æ»šæ—¶æ£€æµ‹æ•°æ®ç¯¡æ”¹ï¼Œéœ€è®¾è®¡è¡¥å¿æœºåˆ¶æˆ–äººå·¥å¹²é¢„&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»çº§åˆ«&lt;/strong&gt;ï¼šé»˜è®¤è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼Œéœ€ä¸šåŠ¡å±‚é€šè¿‡é”ç­–ç•¥è§„é¿&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä¸è¶‹åŠ¿"&gt;ğŸ’ æ€»ç»“ä¸è¶‹åŠ¿
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒä»·å€¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— ä¾µå…¥ AT æ¨¡å¼&lt;/strong&gt;ï¼šé™ä½åˆ†å¸ƒå¼äº‹åŠ¡ä½¿ç”¨é—¨æ§›ï¼Œæ€§èƒ½æ¥è¿‘æœ¬åœ°äº‹åŠ¡&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ¨¡å¼å…¼å®¹&lt;/strong&gt;ï¼šé€‚é…ä»å¼ºä¸€è‡´ï¼ˆXA/TCCï¼‰åˆ°æœ€ç»ˆä¸€è‡´ï¼ˆSAGAï¼‰çš„å¤šæ ·åŒ–éœ€æ±‚&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å‘å±•è¶‹åŠ¿ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‘åŸç”Ÿæ”¯æŒ&lt;/strong&gt;ï¼šSeata 3.0 å¼ºåŒ– Kubernetes é›†æˆåŠ Service Mesh é€‚é…&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æå‡&lt;/strong&gt;ï¼šå¼‚æ­¥åŒ–æäº¤ã€SAGA çŠ¶æ€æœºä¼˜åŒ–å‡å°‘äº‹åŠ¡å»¶è¿Ÿ&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å®è·µå»ºè®®&lt;/strong&gt;ï¼šæ–°é¡¹ç›®ä¼˜å…ˆé‡‡ç”¨ &lt;strong&gt;ATæ¨¡å¼ + NacosæŒä¹…åŒ–&lt;/strong&gt;ï¼Œå¤æ‚åœºæ™¯ç»“åˆ TCC/SAGAï¼›ç›‘æ§ TC é›†ç¾¤çŠ¶æ€ä¸äº‹åŠ¡æ—¥å¿—ï¼Œç¡®ä¿é«˜å¯ç”¨æ€§&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ä¸€è‡´æ€§"&gt;ä¸€è‡´æ€§
&lt;/h2&gt;&lt;p&gt;Seata æä¾›çš„å››ç§äº‹åŠ¡æ¨¡å¼ï¼ˆATã€TCCã€SAGAã€XAï¼‰åœ¨&lt;strong&gt;ä¸€è‡´æ€§&lt;/strong&gt;çš„å®ç°ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œä¸»è¦åˆ†ä¸º&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ï¼ˆACID ä¸¥æ ¼ä¿è¯ï¼‰å’Œ&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼ˆå…è®¸çŸ­æš‚ä¸ä¸€è‡´ï¼Œæœ€ç»ˆè¾¾æˆä¸€è‡´ï¼‰ã€‚ä»¥ä¸‹é’ˆå¯¹æ¯ç§æ¨¡å¼çš„ä¸€è‡´æ€§ç‰¹ç‚¹è¿›è¡Œè¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-xa-æ¨¡å¼å¼ºä¸€è‡´æ€§"&gt;ğŸ” &lt;strong&gt;XA æ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§ç±»å‹&lt;/strong&gt;ï¼š&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ï¼ˆåŸºäºä¸¤é˜¶æ®µæäº¤åè®® 2PCï¼‰&lt;a class="link" href="@ref" &gt;1,4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€é˜¶æ®µï¼ˆPrepareï¼‰&lt;/strong&gt;ï¼šæ‰€æœ‰å‚ä¸è€…ï¼ˆå¦‚æ•°æ®åº“ï¼‰æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ä½†ä¸æäº¤ï¼Œé”å®šèµ„æºå¹¶è¿”å›â€œå°±ç»ªâ€çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬äºŒé˜¶æ®µï¼ˆCommit/Rollbackï¼‰&lt;/strong&gt;ï¼šäº‹åŠ¡åè°ƒå™¨ï¼ˆTCï¼‰æ ¹æ®æ‰€æœ‰å‚ä¸è€…çš„çŠ¶æ€å†³å®šå…¨å±€æäº¤æˆ–å›æ»šï¼Œå‚ä¸è€…åŒæ­¥æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æ€§&lt;/strong&gt;ï¼šå®Œå…¨éš”ç¦»ï¼ˆé€šè¿‡å…¨å±€é”ä¿è¯ï¼‰ï¼Œæ— è„è¯»æˆ–å¹¶å‘å†²çª&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé‡‘èè½¬è´¦ã€é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿç­‰å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-tcc-æ¨¡å¼å¼ºä¸€è‡´æ€§"&gt;âš™ï¸ &lt;strong&gt;TCC æ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§ç±»å‹&lt;/strong&gt;ï¼š&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ï¼ˆé€šè¿‡ä¸šåŠ¡å±‚è¡¥å¿é€»è¾‘ä¿è¯ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Try é˜¶æ®µ&lt;/strong&gt;ï¼šé¢„ç•™èµ„æºï¼ˆå¦‚å†»ç»“åº“å­˜ï¼‰ï¼Œæ£€æŸ¥ä¸šåŠ¡çº¦æŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Confirm/Cancel é˜¶æ®µ&lt;/strong&gt;ï¼šæ ¹æ®å…¨å±€äº‹åŠ¡ç»“æœï¼ŒåŒæ­¥æ‰§è¡Œèµ„æºç¡®è®¤æäº¤ï¼ˆConfirmï¼‰æˆ–é‡Šæ”¾é¢„ç•™ï¼ˆCancelï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æ€§&lt;/strong&gt;ï¼šåŸºäºèµ„æºé¢„ç•™ï¼ˆå¦‚å†»ç»“çŠ¶æ€ï¼‰å®ç°ä¸šåŠ¡å±‚éš”ç¦»ï¼Œæ— å…¨å±€é”&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ”¯ä»˜ã€é«˜å¹¶å‘è®¢å•ç­‰éœ€å¼ºä¸€è‡´ä¸”éœ€é«˜æ€§èƒ½çš„åœºæ™¯&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-at-æ¨¡å¼æœ€ç»ˆä¸€è‡´æ€§"&gt;ğŸ”„ &lt;strong&gt;AT æ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§ç±»å‹&lt;/strong&gt;ï¼š&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼ˆå¼‚æ­¥è¡¥å¿æœºåˆ¶ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€é˜¶æ®µ&lt;/strong&gt;ï¼šç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡ï¼ŒåŒæ—¶ç”Ÿæˆå›æ»šæ—¥å¿—ï¼ˆ&lt;code&gt;undo_log&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;äºŒé˜¶æ®µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æäº¤&lt;/strong&gt;ï¼šå¼‚æ­¥åˆ é™¤&lt;code&gt;undo_log&lt;/code&gt;ï¼ˆæ— é˜»å¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›æ»š&lt;/strong&gt;ï¼šæ ¹æ®&lt;code&gt;undo_log&lt;/code&gt;ç”Ÿæˆåå‘ SQL è¡¥å¿æ•°æ®ï¼ˆéœ€æ£€æŸ¥è„å†™ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æ€§&lt;/strong&gt;ï¼šè¯»æœªæäº¤ï¼ˆé»˜è®¤ï¼‰ï¼Œéœ€é€šè¿‡&lt;code&gt;SELECT FOR UPDATE&lt;/code&gt;æ˜¾å¼åŠ å…¨å±€é”é¿å…è„å†™&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç”µå•†åº“å­˜æ‰£å‡ã€è®¢å•åˆ›å»ºç­‰çŸ­äº‹åŠ¡ã€é«˜å¹¶å‘åœºæ™¯&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-saga-æ¨¡å¼æœ€ç»ˆä¸€è‡´æ€§"&gt;ğŸ“¦ &lt;strong&gt;SAGA æ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§ç±»å‹&lt;/strong&gt;ï¼š&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼ˆäº‹ä»¶é©±åŠ¨è¡¥å¿ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­£å‘äº‹åŠ¡é“¾&lt;/strong&gt;ï¼šä¾æ¬¡æ‰§è¡Œå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼ˆå¦‚åˆ›å»ºè®¢å•â†’æ‰£åº“å­˜â†’å‘è´§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€†å‘è¡¥å¿é“¾&lt;/strong&gt;ï¼šè‹¥æŸäº‹åŠ¡å¤±è´¥ï¼ŒæŒ‰åå‘é¡ºåºè§¦å‘è¡¥å¿æ“ä½œï¼ˆå¦‚å–æ¶ˆè®¢å•â†’å›æ»šåº“å­˜ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æ€§&lt;/strong&gt;ï¼šæ— éš”ç¦»ï¼Œä¸­é—´çŠ¶æ€å¯è§ï¼ˆå¦‚è®¢å•å·²åˆ›å»ºä½†åº“å­˜æœªæ‰£ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè·¨å¤šæœåŠ¡çš„å¤æ‚æµç¨‹ï¼ˆå¦‚ç”µå•†ä¸‹å•+ç‰©æµè°ƒåº¦ï¼‰ï¼Œæˆ–å¯¹æ¥é—ç•™ç³»ç»Ÿ&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ¨¡å¼å¯¹æ¯”æ€»ç»“"&gt;âš–ï¸ &lt;strong&gt;æ¨¡å¼å¯¹æ¯”æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸€è‡´æ€§ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®ç°æœºåˆ¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;éš”ç¦»æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XA&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ğŸ”’ å¼ºä¸€è‡´&lt;/td&gt;
&lt;td&gt;2PC åŒæ­¥æäº¤/å›æ»š&lt;/td&gt;
&lt;td&gt;å®Œå…¨éš”ç¦»&lt;/td&gt;
&lt;td&gt;é‡‘èè½¬è´¦ã€å¼ºä¸€è‡´æ•°æ®åº“æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TCC&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ğŸ”’ å¼ºä¸€è‡´&lt;/td&gt;
&lt;td&gt;Try-Confirm-Cancel åŒæ­¥è¡¥å¿&lt;/td&gt;
&lt;td&gt;èµ„æºé¢„ç•™éš”ç¦»&lt;/td&gt;
&lt;td&gt;æ”¯ä»˜ã€é«˜å¹¶å‘èµ„é‡‘äº¤æ˜“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AT&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â³ æœ€ç»ˆä¸€è‡´&lt;/td&gt;
&lt;td&gt;å¼‚æ­¥åˆ é™¤æ—¥å¿—/åå‘ SQL è¡¥å¿&lt;/td&gt;
&lt;td&gt;è¯»æœªæäº¤ï¼ˆéœ€æ˜¾å¼é”ï¼‰&lt;/td&gt;
&lt;td&gt;çŸ­äº‹åŠ¡ã€é«˜å¹¶å‘ï¼ˆå¦‚åº“å­˜æ‰£å‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SAGA&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â³ æœ€ç»ˆä¸€è‡´&lt;/td&gt;
&lt;td&gt;äº‹ä»¶é©±åŠ¨ + é€†å‘è¡¥å¿é“¾&lt;/td&gt;
&lt;td&gt;æ— éš”ç¦»&lt;/td&gt;
&lt;td&gt;é•¿æµç¨‹ã€è·¨æœåŠ¡å¤æ‚äº‹åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é€‰å‹å»ºè®®"&gt;ğŸ’ &lt;strong&gt;é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¼ºä¸€è‡´æ€§éœ€æ±‚ï¼š
&lt;ul&gt;
&lt;li&gt;é‡‘èçº§åœºæ™¯ â†’ &lt;strong&gt;XA æ¨¡å¼&lt;/strong&gt;ï¼ˆæ•°æ®åº“æ”¯æŒ XA åè®®ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é«˜æ€§èƒ½èµ„é‡‘æ“ä½œ â†’ &lt;strong&gt;TCC æ¨¡å¼&lt;/strong&gt;ï¼ˆéœ€ç¼–å†™è¡¥å¿é€»è¾‘ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆä¸€è‡´æ€§å®¹å¿ï¼š
&lt;ul&gt;
&lt;li&gt;çŸ­äº‹åŠ¡ã€æ— ä¾µå…¥ â†’ &lt;strong&gt;AT æ¨¡å¼&lt;/strong&gt;ï¼ˆé»˜è®¤æ¨èï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é•¿æµç¨‹ã€å¼‚æ­¥è¡¥å¿ â†’ &lt;strong&gt;SAGA æ¨¡å¼&lt;/strong&gt;ï¼ˆéœ€è®¾è®¡çŠ¶æ€æœºï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„&lt;/strong&gt;ï¼šå¼ºä¸€è‡´æ€§æ¨¡å¼ï¼ˆXA/TCCï¼‰å› åŒæ­¥é˜»å¡å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œè€Œæœ€ç»ˆä¸€è‡´æ€§æ¨¡å¼ï¼ˆAT/SAGAï¼‰éœ€ä¸šåŠ¡å±‚å¤„ç†ä¸­é—´çŠ¶æ€ï¼ˆå¦‚è®¢å•â€œå¤„ç†ä¸­â€ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚å®é™…é€‰å‹éœ€ç»“åˆä¸šåŠ¡å®¹å¿åº¦ã€æ€§èƒ½è¦æ±‚åŠå¼€å‘æˆæœ¬ç»¼åˆæƒè¡¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ä»£ç ç¤ºä¾‹"&gt;ä»£ç ç¤ºä¾‹
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ Spring Cloud ä¸ Seata æ•´åˆçš„å››ç§äº‹åŠ¡æ¨¡å¼ï¼ˆATã€TCCã€SAGAã€XAï¼‰çš„ä»£ç å®ç°åŠæ ¸å¿ƒé…ç½®ï¼Œç»“åˆç”Ÿäº§å®è·µæ€»ç»“å…³é”®è¦ç‚¹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-at-æ¨¡å¼è‡ªåŠ¨è¡¥å¿"&gt;ğŸ”§ AT æ¨¡å¼ï¼ˆè‡ªåŠ¨è¡¥å¿ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç®€å• CRUD æ“ä½œï¼ˆå¦‚è®¢å•åˆ›å»ºã€åº“å­˜æ‰£å‡ï¼‰&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;
â€‹&lt;strong&gt;æ ¸å¿ƒåŸç†&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€é˜¶æ®µ&lt;/strong&gt;ï¼šæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œç”Ÿæˆ &lt;code&gt;undo_log&lt;/code&gt; å›æ»šæ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äºŒé˜¶æ®µ&lt;/strong&gt;ï¼šå…¨å±€æäº¤æ—¶å¼‚æ­¥åˆ é™¤æ—¥å¿—ï¼›å›æ»šæ—¶é€šè¿‡æ—¥å¿—åå‘è¡¥å¿&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä»£ç ç¤ºä¾‹-1"&gt;ä»£ç ç¤ºä¾‹
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–é…ç½®&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;io.seata&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;seata-spring-boot-starter&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.6.1&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æºä»£ç†&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public DataSource dataSource(DataSourceProperties properties) {
return new DataSourceProxy(properties.initializeDataSourceBuilder().build()); // å¿…é¡»ä»£ç†[5](@ref)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€äº‹åŠ¡æ³¨è§£&lt;/strong&gt;ï¼ˆè®¢å•æœåŠ¡ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class OrderService {
@GlobalTransactional(rollbackFor = Exception.class)
public void createOrder(Order order) {
orderMapper.insert(order); // æœ¬åœ°äº‹åŠ¡
// è°ƒç”¨åº“å­˜æœåŠ¡ï¼ˆåˆ†æ”¯äº‹åŠ¡ï¼‰
restTemplate.postForEntity(&amp;#34;http://inventory-service/deduct&amp;#34;, order, Void.class);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†æ”¯äº‹åŠ¡&lt;/strong&gt;ï¼ˆåº“å­˜æœåŠ¡ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class StockService {
@Transactional // æœ¬åœ°äº‹åŠ¡æ³¨è§£
public void deductStock(Long productId, int count) {
// æ‰£å‡åº“å­˜é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿…å¤‡é…ç½®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰å‚ä¸åº“éœ€å»º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; undo_log
```
è¡¨
4ï¼š
```
CREATE TABLE undo_log (id BIGINT AUTO_INCREMENT, branch_id BIGINT, xid VARCHAR(100), ...);
```
------
### âš™ï¸ TCC æ¨¡å¼ï¼ˆä¸¤é˜¶æ®µè¡¥å¿ï¼‰
**é€‚ç”¨åœºæ™¯**ï¼šéœ€ç»†ç²’åº¦èµ„æºæ§åˆ¶çš„å¤æ‚é€»è¾‘ï¼ˆå¦‚å†»ç»“åº“å­˜ã€èµ„é‡‘é¢„ç•™ï¼‰[6](@ref)
â€‹**æ ¸å¿ƒåŸç†**â€‹ï¼š
- **Try**ï¼šé¢„ç•™èµ„æºï¼ˆå¦‚å†»ç»“åº“å­˜ï¼‰ã€‚
- **Confirm**ï¼šæäº¤é¢„ç•™èµ„æºï¼ˆæ­£å¼æ‰£å‡ï¼‰ã€‚
- **Cancel**ï¼šé‡Šæ”¾é¢„ç•™èµ„æºï¼ˆè§£å†»ï¼‰[2](@ref)ã€‚
#### ä»£ç ç¤ºä¾‹
1. **TCC æ¥å£å®šä¹‰**ï¼ˆåº“å­˜æœåŠ¡ï¼‰ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;@LocalTCC
public interface StockTccService {
@TwoPhaseBusinessAction(name = &amp;ldquo;deduct&amp;rdquo;, commitMethod = &amp;ldquo;confirm&amp;rdquo;, rollbackMethod = &amp;ldquo;cancel&amp;rdquo;)
boolean tryDeduct(@BusinessActionContextParameter(paramName = &amp;ldquo;productId&amp;rdquo;) Long productId,
@BusinessActionContextParameter(paramName = &amp;ldquo;count&amp;rdquo;) int count);&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; boolean confirm(BusinessActionContext context); // æäº¤
boolean cancel(BusinessActionContext context); // å›æ»š
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;2. **Try é˜¶æ®µå®ç°**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;@Service
public class StockTccServiceImpl implements StockTccService {
@Override
public boolean tryDeduct(Long productId, int count) {
// æ£€æŸ¥åº“å­˜å¹¶å†»ç»“èµ„æºï¼ˆéå®é™…æ‰£å‡ï¼‰
stockMapper.freezeStock(productId, count);
return true;
}&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; @Override
public boolean confirm(BusinessActionContext context) {
// å®é™…æ‰£å‡å†»ç»“çš„èµ„æº
stockMapper.reduceFreezedStock(context.getActionContext(&amp;quot;productId&amp;quot;));
return true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;3. **å…¨å±€äº‹åŠ¡è°ƒç”¨**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;@GlobalTransactional
public void createOrder(Order order) {
orderService.create(order);
stockTccService.tryDeduct(order.getProductId(), order.getCount()); // è°ƒç”¨TCC
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;
------
### ğŸ”„ SAGA æ¨¡å¼ï¼ˆé•¿äº‹åŠ¡è¡¥å¿ï¼‰
**é€‚ç”¨åœºæ™¯**ï¼šè·¨å¤šæœåŠ¡çš„å¼‚æ­¥é•¿æµç¨‹ï¼ˆå¦‚è®¢å•â†’ç‰©æµâ†’æ”¯ä»˜ï¼‰[2](@ref)
â€‹**æ ¸å¿ƒåŸç†**â€‹ï¼š
- æ­£å‘äº‹åŠ¡é“¾ä¾æ¬¡æ‰§è¡Œï¼Œå¤±è´¥æ—¶è§¦å‘é€†å‘è¡¥å¿é“¾ã€‚
#### ä»£ç ç¤ºä¾‹
1. **çŠ¶æ€æœºå®šä¹‰**ï¼ˆJSON é…ç½®ï¼‰ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;{
&amp;ldquo;name&amp;rdquo;: &amp;ldquo;orderProcess&amp;rdquo;,
&amp;ldquo;states&amp;rdquo;: [
{ &amp;ldquo;name&amp;rdquo;: &amp;ldquo;createOrder&amp;rdquo;, &amp;ldquo;service&amp;rdquo;: &amp;ldquo;orderService&amp;rdquo;, &amp;ldquo;compensate&amp;rdquo;: &amp;ldquo;cancelOrder&amp;rdquo; },
{ &amp;ldquo;name&amp;rdquo;: &amp;ldquo;startShipping&amp;rdquo;, &amp;ldquo;service&amp;rdquo;: &amp;ldquo;shippingService&amp;rdquo;, &amp;ldquo;compensate&amp;rdquo;: &amp;ldquo;cancelShipping&amp;rdquo; }
]
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;2. **è¡¥å¿æ–¹æ³•å®ç°**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;@Service
public class OrderService {
public void cancelOrder(BusinessActionContext context) {
orderMapper.deleteById(context.getActionContext(&amp;ldquo;orderId&amp;rdquo;)); // é€†å‘æ“ä½œ
}
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;3. **å¯åŠ¨ SAGA äº‹åŠ¡**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;StateMachineEngine stateMachineEngine = SeataStateMachineEngine.getInstance();
stateMachineEngine.start(&amp;ldquo;orderProcess&amp;rdquo;, businessParams); // è§¦å‘çŠ¶æ€æœº&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;
------
### ğŸ”’ XA æ¨¡å¼ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰
**é€‚ç”¨åœºæ™¯**ï¼šé‡‘èè½¬è´¦ç­‰å¼ºä¸€è‡´éœ€æ±‚[2](@ref)
â€‹**æ ¸å¿ƒåŸç†**â€‹ï¼šåŸºäºæ•°æ®åº“ XA åè®®çš„ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ã€‚
#### ä»£ç ç¤ºä¾‹
1. **é…ç½®å¯ç”¨ XA**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;seata:
data-source-proxy-mode: XA # åˆ‡æ¢æ¨¡å¼&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;2. **å…¨å±€äº‹åŠ¡æ³¨è§£**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;@GlobalTransactional
public void transfer(Account from, Account to, BigDecimal amount) {
accountService.deduct(from, amount); // æœ¬åœ°äº‹åŠ¡
accountService.add(to, amount); // å¦ä¸€æ•°æ®æºæ“ä½œ
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;
------
### ğŸ’ æ¨¡å¼å¯¹æ¯”ä¸é€‰å‹å»ºè®®
| **æ¨¡å¼** | **ä¸€è‡´æ€§** | **æ€§èƒ½** | **ä¾µå…¥æ€§** | **é€‚ç”¨åœºæ™¯** |
| -------- | ---------- | -------- | ---------- | ------------------------ |
| **AT** | æœ€ç»ˆä¸€è‡´ | é«˜ | ä½ | ç®€å• CRUDï¼ˆè®¢å•ã€åº“å­˜ï¼‰ |
| **TCC** | æœ€ç»ˆä¸€è‡´ | é«˜ | é«˜ | å¤æ‚é€»è¾‘ï¼ˆèµ„é‡‘å†»ç»“ï¼‰ |
| **SAGA** | æœ€ç»ˆä¸€è‡´ | æœ€é«˜ | ä¸­ | é•¿æµç¨‹ï¼ˆç‰©æµçŠ¶æ€é“¾ï¼‰ |
| **XA** | å¼ºä¸€è‡´ | ä½ | ä½ | é‡‘èè½¬è´¦ã€æ•°æ®åº“åŸç”Ÿæ”¯æŒ |
**é€‰å‹å†³ç­–æ ‘**ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;graph LR
A[éœ€å¼ºä¸€è‡´?] &amp;ndash;&amp;gt;|æ˜¯| B[é€‰XA]
A &amp;ndash;&amp;gt;|å¦| C[éœ€çµæ´»è¡¥å¿?]
C &amp;ndash;&amp;gt;|æ˜¯| D[é€‰TCC/SAGA]
C &amp;ndash;&amp;gt;|å¦| E[é€‰AT]&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;
------
### âš ï¸ é¿å‘æŒ‡å—
1.
AT æ¨¡å¼ï¼š
- éœ€æ‰€æœ‰æ•°æ®åº“åˆ›å»º `undo_log` è¡¨ï¼ŒPostgreSQL éœ€æ‰‹åŠ¨å»ºè¡¨[5](@ref)ã€‚
- é»˜è®¤è¯»æœªæäº¤ï¼Œé«˜å¹¶å‘æ—¶ç”¨ `SELECT FOR UPDATE` é¿å…è„å†™[4](@ref)ã€‚
2.
TCC æ¨¡å¼ï¼š
- éœ€ä¿è¯ `confirm/cancel` å¹‚ç­‰ï¼ˆç½‘ç»œé‡è¯•å¯èƒ½å¯¼è‡´é‡å¤è°ƒç”¨ï¼‰[6](@ref)ã€‚
3.
ç”Ÿäº§å»ºè®®ï¼š
- **TC é«˜å¯ç”¨**ï¼šéƒ¨ç½² Seata-Server é›†ç¾¤ + Nacos æ³¨å†Œä¸­å¿ƒ[2,3](@ref)ã€‚
- **ç›‘æ§**ï¼šé›†æˆ Seata Dashboard è·Ÿè¸ªäº‹åŠ¡çŠ¶æ€ä¸å›æ»šæ—¥å¿—ã€‚
&amp;gt; å®Œæ•´ä»£ç ç¤ºä¾‹å‚è€ƒï¼š[Seata Samples å®˜æ–¹ä»“åº“](https://github.com/seata/seata-samples) æˆ–æ˜é‡‘æ•™ç¨‹[2,5](@ref)ã€‚
## @GlobalTransactional
### ğŸ“Œ `@GlobalTransactional` çš„æ ¸å¿ƒä½œç”¨ä¸å®šä½
`@GlobalTransactional` æ˜¯ Seata æ¡†æ¶ä¸­ç”¨äº**å£°æ˜å…¨å±€åˆ†å¸ƒå¼äº‹åŠ¡**çš„å…³é”®æ³¨è§£ï¼Œä½œç”¨äº**äº‹åŠ¡å‘èµ·æ–¹ï¼ˆTM è§’è‰²ï¼‰**çš„æ–¹æ³•ä¸Šã€‚å…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š
1. **å¼€å¯å…¨å±€äº‹åŠ¡**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰å‘ Seata æœåŠ¡ç«¯ï¼ˆTCï¼‰æ³¨å†Œå…¨å±€äº‹åŠ¡ï¼Œç”Ÿæˆå…¨å±€å”¯ä¸€çš„ **XID**ï¼ˆäº‹åŠ¡IDï¼‰ï¼Œå¹¶ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡[1,6](@ref)ã€‚
2. **ä¼ æ’­äº‹åŠ¡ä¸Šä¸‹æ–‡**ï¼šåœ¨å¾®æœåŠ¡è°ƒç”¨é“¾ä¸­è‡ªåŠ¨å°† XID é€ä¼ ç»™æ‰€æœ‰å‚ä¸è€…ï¼ˆå¦‚é€šè¿‡ Dubbo çš„ RPC è¿‡æ»¤å™¨ï¼‰[9](@ref)ã€‚
3. **ç»Ÿä¸€æäº¤/å›æ»š**ï¼šæ–¹æ³•æ‰§è¡ŒæˆåŠŸåæäº¤å…¨å±€äº‹åŠ¡ï¼›è‹¥æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™è§¦å‘å…¨å±€å›æ»šï¼Œåè°ƒæ‰€æœ‰å‚ä¸è€…è¿›è¡Œæ•°æ®ä¸€è‡´æ€§è¡¥å¿[3,8](@ref)ã€‚
------
### âš™ï¸ åº•å±‚å·¥ä½œåŸç†ä¸æ‰§è¡Œæµç¨‹
#### **AOP ä»£ç†æœºåˆ¶**
Seata é€šè¿‡ `GlobalTransactionScanner` æ‰«ææ‰€æœ‰æ ‡æ³¨ `@GlobalTransactional` çš„ Beanï¼Œä¸ºå…¶ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚å½“ç›®æ ‡æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯ä»£ç†é€»è¾‘ï¼ˆ`GlobalTransactionalInterceptor`ï¼‰[2,7](@ref)ã€‚
#### **æ ¸å¿ƒæ‰§è¡Œæ­¥éª¤**
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;graph TD
A[è°ƒç”¨@GlobalTransactionalæ–¹æ³•] &amp;ndash;&amp;gt; B[GlobalTransactionalInterceptoræ‹¦æˆª]
B &amp;ndash;&amp;gt; C{äº‹åŠ¡ä¼ æ’­ç­–ç•¥æ£€æŸ¥}
C &amp;ndash;&amp;gt; D[å‘TCæ³¨å†Œå…¨å±€äº‹åŠ¡ï¼Œç”ŸæˆXID]
D &amp;ndash;&amp;gt; E[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]
E &amp;ndash;&amp;gt; F[é€ä¼ XIDè‡³RPCè°ƒç”¨]
F &amp;ndash;&amp;gt; G[å‚ä¸è€…æ³¨å†Œåˆ†æ”¯äº‹åŠ¡]
G &amp;ndash;&amp;gt; H{ä¸šåŠ¡æ˜¯å¦æˆåŠŸï¼Ÿ}
H &amp;ndash;&amp;gt;|æ˜¯| I[TCé€šçŸ¥æäº¤æ‰€æœ‰åˆ†æ”¯äº‹åŠ¡]
H &amp;ndash;&amp;gt;|å¦| J[TCé€šçŸ¥å›æ»šæ‰€æœ‰åˆ†æ”¯äº‹åŠ¡]&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;- **åˆ†æ”¯äº‹åŠ¡æ³¨å†Œ**ï¼šå‚ä¸äº‹åŠ¡çš„å¾®æœåŠ¡ï¼ˆRMï¼‰åœ¨æ‰§è¡Œæœ¬åœ°æ•°æ®åº“æ“ä½œæ—¶ï¼Œé€šè¿‡ Seata çš„ `DataSourceProxy` æ‹¦æˆª SQLï¼Œå‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å¹¶è®°å½• `undo_log`ï¼ˆAT æ¨¡å¼ï¼‰[3,5](@ref)ã€‚
- å…¨å±€äº‹åŠ¡å†³è®®ï¼š
- **æäº¤**ï¼šåˆ é™¤æ‰€æœ‰å‚ä¸è€…çš„ `undo_log`ï¼ˆAT æ¨¡å¼ï¼‰ã€‚
- **å›æ»š**ï¼šæ ¹æ® `undo_log` ç”Ÿæˆåå‘ SQL è¡¥å¿æ•°æ®ï¼ˆéœ€æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§ï¼‰[8](@ref)ã€‚
#### **å…¨å±€äº‹åŠ¡ IDï¼ˆXIDï¼‰ç”Ÿæˆ**
- é‡‡ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆ 64 ä½å…¨å±€ IDï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;0ï¼ˆ1bitï¼‰ + æœºå™¨IDï¼ˆ10bitï¼‰ + æ—¶é—´æˆ³ï¼ˆ41bitï¼‰ + åºåˆ—å·ï¼ˆ12bitï¼‰&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;- è§£å†³æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼šå½“åºåˆ—å·è€—å°½æ—¶é˜»å¡çº¿ç¨‹ 5ms ç­‰å¾…æ—¶é—´æˆ³æ›´æ–°[9](@ref)ã€‚
------
### âš ï¸ ä½¿ç”¨è¦ç‚¹ä¸æœ€ä½³å®è·µ
#### **å¿…é¡»ä¸æœ¬åœ°äº‹åŠ¡æ³¨è§£é…åˆ**
- **
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;@GlobalTransactional&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ä»…ç®¡ç†å…¨å±€äº‹åŠ¡è¾¹ç•Œ**ï¼Œæ¯ä¸ªå‚ä¸è€…çš„æ•°æ®åº“æ“ä½œä»éœ€æ ‡æ³¨ `@Transactional`ï¼Œç¡®ä¿æœ¬åœ°æ“ä½œçš„åŸå­æ€§ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;// äº‹åŠ¡å‘èµ·æ–¹ï¼ˆTMï¼‰
@GlobalTransactional
public void createOrder() {
orderService.insert(); // æœ¬åœ°äº‹åŠ¡
inventoryFeign.reduceStock(); // è¿œç¨‹è°ƒç”¨ï¼ˆå‚ä¸è€…éœ€åŠ @Transactionalï¼‰
}&lt;/p&gt;
&lt;p&gt;// å‚ä¸è€…ï¼ˆRMï¼‰
@Transactional
public void reduceStock() {
stockMapper.update(); // æ“ä½œ1
logMapper.insert(); // æ“ä½œ2ï¼ˆå¤±è´¥åˆ™å›æ»šæ“ä½œ1ï¼‰
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#### **å…³é”®é…ç½®é¡¹**
| **å‚æ•°** | **è¯´æ˜** | **é»˜è®¤å€¼** |
| -------------- | ------------------------------------------------ | ---------- |
| `timeoutMills` | å…¨å±€äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ | 60,000 ms |
| `name` | äº‹åŠ¡åç§°ï¼ˆç”¨äºç›‘æ§ï¼‰ | ç©ºå­—ç¬¦ä¸² |
| `propagation` | äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆä»…æ”¯æŒ `REQUIRED`/`REQUIRES_NEW`ï¼‰ | `REQUIRED` |
#### **ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹**
- **æŒä¹…åŒ–äº‹åŠ¡æ—¥å¿—**ï¼šTC éœ€é…ç½®æ•°æ®åº“å­˜å‚¨æ¨¡å¼ï¼ˆ`store.mode=db`ï¼‰ï¼Œé¿å…é‡å¯åäº‹åŠ¡çŠ¶æ€ä¸¢å¤±[3,5](@ref)ã€‚
- **éš”ç¦»çº§åˆ«**ï¼šé»˜è®¤è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼Œéœ€é€šè¿‡ `SELECT FOR UPDATE` æ˜¾å¼åŠ é”é¿å…è„è¯»[8](@ref)ã€‚
- **é«˜å¯ç”¨éƒ¨ç½²**ï¼šTC é›†ç¾¤åŒ– + Nacos æ³¨å†Œä¸­å¿ƒï¼Œé¿å…å•ç‚¹æ•…éšœ[3](@ref)ã€‚
------
### ğŸ”„ ä¸åŒäº‹åŠ¡æ¨¡å¼ä¸‹çš„è¡Œä¸ºå·®å¼‚
| **æ¨¡å¼** | `@GlobalTransactional` çš„ä½œç”¨ | **é€‚ç”¨åœºæ™¯** |
| -------------- | ------------------------------------------------------------ | ---------------------------- |
| **ATï¼ˆé»˜è®¤ï¼‰** | è‡ªåŠ¨ç”Ÿæˆåå‘ SQL è¡¥å¿æ—¥å¿—ï¼ˆ`undo_log`ï¼‰ | é«˜å¹¶å‘ã€æ— ä¾µå…¥éœ€æ±‚ï¼ˆå¦‚ç”µå•†ï¼‰ |
| **TCC** | éœ€é…åˆ `@TwoPhaseBusinessAction` å®šä¹‰ Try/Confirm/Cancel æ–¹æ³• | å¼ºä¸€è‡´æ€§åœºæ™¯ï¼ˆå¦‚é‡‘èï¼‰ |
| **SAGA** | éœ€é…ç½®çŠ¶æ€æœºå®šä¹‰è¡¥å¿é€»è¾‘ | é•¿äº‹åŠ¡æµç¨‹ï¼ˆå¦‚ç‰©æµè°ƒåº¦ï¼‰ |
------
### ğŸ’ æ€»ç»“ä¸é¿å‘æŒ‡å—
- **æ ¸å¿ƒä»·å€¼**ï¼šé€šè¿‡å£°æ˜å¼æ³¨è§£ç®€åŒ–åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ï¼Œå®ç°è·¨æœåŠ¡æ•°æ®ä¸€è‡´æ€§ã€‚
- **å…¸å‹é”™è¯¯**ï¼š
- å‚ä¸è€…æœªåŠ  `@Transactional` â†’ æœ¬åœ°æ“ä½œæ— æ³•å›æ»š[1](@ref)ã€‚
- TC æœªé…ç½®æŒä¹…åŒ– â†’ é‡å¯åäº‹åŠ¡çŠ¶æ€ä¸¢å¤±ã€‚
- **æœ€ä½³å®è·µ**ï¼š
1. **äº‹åŠ¡å‘èµ·æ–¹**ï¼š`@GlobalTransactional` + è¶…æ—¶æ—¶é—´é…ç½®ã€‚
2. **äº‹åŠ¡å‚ä¸è€…**ï¼š`@Transactional` + Seata çš„ `DataSourceProxy` ä»£ç†æ•°æ®æºã€‚
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šTC é›†ç¾¤ + Nacos æŒä¹…åŒ– + ç›‘æ§å‘Šè­¦ï¼ˆå¦‚ Prometheusï¼‰ã€‚
&amp;gt; é€šè¿‡åˆç†ä½¿ç”¨ `@GlobalTransactional` å’Œæœ¬åœ°äº‹åŠ¡æ³¨è§£ï¼Œç»“åˆ Seata çš„ TC/RM åä½œæœºåˆ¶ï¼Œå¯é«˜æ•ˆè§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡éš¾é¢˜[3,8,9](@ref)ã€‚
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>ã€Springã€‘Concepts</title><link>https://dyhes.github.io/p/springconcepts/</link><pubDate>Fri, 27 Jun 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/springconcepts/</guid><description>&lt;h2 id="spring-ç‰¹æ€§"&gt;Spring ç‰¹æ€§
&lt;/h2&gt;&lt;p&gt;Springæ¡†æ¶æ˜¯Javaä¼ä¸šçº§åº”ç”¨å¼€å‘çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œå…¶è®¾è®¡å“²å­¦ä»¥&lt;strong&gt;è½»é‡çº§ã€éä¾µå…¥å¼ã€æ¨¡å—åŒ–&lt;/strong&gt;ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ç­‰ç‰¹æ€§ç®€åŒ–å¼€å‘æµç¨‹ã€‚ä»¥ä¸‹ä»æ¶æ„è®¾è®¡ã€æ ¸å¿ƒç‰¹æ€§ã€æ‰©å±•èƒ½åŠ›ç­‰ç»´åº¦ç³»ç»Ÿåˆ†æå…¶ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒè®¾è®¡æ€æƒ³ä¸æ¶æ„"&gt;âš™ï¸ æ ¸å¿ƒè®¾è®¡æ€æƒ³ä¸æ¶æ„
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§ä¸éä¾µå…¥å¼è®¾è®¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Springçš„æ ¸å¿ƒåº“ä»…çº¦1MBï¼Œè¿è¡Œæ—¶èµ„æºæ¶ˆè€—ä½ï¼Œä¸”ä¸å¼ºåˆ¶åº”ç”¨ä¾èµ–å…¶APIï¼Œä¸šåŠ¡å¯¹è±¡å¯ç‹¬ç«‹äºæ¡†æ¶å­˜åœ¨&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;strong&gt;æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å®¹å™¨&lt;/strong&gt;ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…ç¡¬ç¼–ç ä¾èµ–ï¼Œé™ä½è€¦åˆåº¦&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚æ¨¡å—åŒ–æ¶æ„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒå®¹å™¨ï¼ˆBeans, Core, Context, SpELï¼‰&lt;/strong&gt;ï¼šæä¾›Beanå·¥å‚ã€èµ„æºåŠ è½½ã€è¡¨è¾¾å¼è¯­è¨€ç­‰åŸºç¡€åŠŸèƒ½&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è®¿é—®å±‚ï¼ˆJDBC, ORM, Transactionsï¼‰&lt;/strong&gt;ï¼šæŠ½è±¡æ•°æ®åº“æ“ä½œï¼Œæ”¯æŒå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆå¦‚å°†SQLå¼‚å¸¸è½¬æ¢ä¸º&lt;code&gt;DataAccessException&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Webå±‚ï¼ˆServlet, WebSocket, Portletï¼‰&lt;/strong&gt;ï¼šé›†æˆMVCæ¡†æ¶ï¼Œæ”¯æŒRESTfulæœåŠ¡å’Œå®æ—¶é€šä¿¡&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AOPä¸åˆ‡é¢æ¨¡å—&lt;/strong&gt;ï¼šåˆ†ç¦»æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€å®‰å…¨ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ§åˆ¶åè½¬iocä¸ä¾èµ–æ³¨å…¥di"&gt;ğŸ”„ æ§åˆ¶åè½¬ï¼ˆIoCï¼‰ä¸ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IoCå®¹å™¨&lt;/strong&gt;ï¼šç”±&lt;code&gt;BeanFactory&lt;/code&gt;å’Œ&lt;code&gt;ApplicationContext&lt;/code&gt;å®ç°ï¼Œè´Ÿè´£Beançš„å®ä¾‹åŒ–ã€é…ç½®åŠä¾èµ–æ³¨å…¥ã€‚å¯¹è±¡ä¸å†ä¸»åŠ¨åˆ›å»ºä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡å®¹å™¨è¢«åŠ¨æ³¨å…¥&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¾èµ–æ³¨å…¥æ–¹å¼ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Setteræ³¨å…¥&lt;/strong&gt;ï¼šé€šè¿‡JavaBeanå±æ€§èµ‹å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼šå¼ºåˆ¶ä¾èµ–åˆå§‹åŒ–ï¼Œé¿å…ç©ºæŒ‡é’ˆ&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£é©±åŠ¨&lt;/strong&gt;ï¼š&lt;code&gt;@Autowired&lt;/code&gt;ã€&lt;code&gt;@Resource&lt;/code&gt;ç­‰ç®€åŒ–é…ç½®ï¼Œå®ç°è‡ªåŠ¨è£…é…&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class UserService {
@Autowired
private UserRepository repository; // å®¹å™¨è‡ªåŠ¨æ³¨å…¥ä¾èµ–
}
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-é¢å‘åˆ‡é¢ç¼–ç¨‹aop"&gt;âœ‚ï¸ é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç›®çš„&lt;/strong&gt;ï¼šè§£è€¦æ¨ªåˆ‡é€»è¾‘ï¼ˆå¦‚äº‹åŠ¡ã€æ—¥å¿—ï¼‰ä¸ä¸šåŠ¡ä»£ç ï¼Œæå‡æ¨¡å—åŒ–&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä»£ç†&lt;/strong&gt;ï¼šå¯¹å®ç°æ¥å£çš„ç±»ä½¿ç”¨JDKä»£ç†ï¼Œå¦åˆ™ç”¨CGLIBå­—èŠ‚ç å¢å¼º&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡é¢å®šä¹‰&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;@Aspect&lt;/code&gt;æ³¨è§£å£°æ˜åˆ‡ç‚¹ï¼ˆPointcutï¼‰å’Œé€šçŸ¥ï¼ˆAdviceï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…¸å‹åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆ&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨æƒé™æ ¡éªŒã€æ€§èƒ½ç›‘æ§&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Aspect
@Component
public class LoggingAspect {
@Before(&amp;#34;execution(* com.example.service.*.*(..))&amp;#34;)
public void logMethodCall() { System.out.println(&amp;#34;Method called&amp;#34;); }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®è®¿é—®ä¸äº‹åŠ¡ç®¡ç†"&gt;ğŸ—ƒï¸ æ•°æ®è®¿é—®ä¸äº‹åŠ¡ç®¡ç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ç»Ÿä¸€æ•°æ®è®¿é—®æŠ½è±¡&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒJDBCï¼ˆ&lt;code&gt;JdbcTemplate&lt;/code&gt;ç®€åŒ–CRUDï¼‰ã€JPAã€Hibernateç­‰ORMæ¡†æ¶ï¼Œæä¾›ä¸€è‡´çš„DAOæ¨¡å¼&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;å£°æ˜å¼äº‹åŠ¡&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡AOPå®ç°ï¼Œæ— éœ€ç¼–ç å³å¯ç®¡ç†äº‹åŠ¡è¾¹ç•Œï¼Œæ”¯æŒä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«é…ç½®&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;å…¼å®¹JTAï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰å’Œå•æ•°æ®æºäº‹åŠ¡&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-spring-mvcä¸webæ”¯æŒ"&gt;ğŸŒ Spring MVCä¸Webæ”¯æŒ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MVCæ¶æ„&lt;/strong&gt;ï¼šåˆ†ç¦»æ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€æ¨¡å‹ï¼ˆModelï¼‰ã€è§†å›¾ï¼ˆViewï¼‰ï¼Œæ”¯æŒå¤šç§è§†å›¾æŠ€æœ¯ï¼ˆJSPã€Thymeleafï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RESTfulæœåŠ¡&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;@RestController&lt;/code&gt;ã€&lt;code&gt;@GetMapping&lt;/code&gt;ç­‰æ³¨è§£ç®€åŒ–APIå¼€å‘&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†æˆèƒ½åŠ›&lt;/strong&gt;ï¼šæ— ç¼æ•´åˆStrutsã€JSFç­‰ç¬¬ä¸‰æ–¹Webæ¡†æ¶&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æµ‹è¯•ä¸é›†æˆæ”¯æŒ"&gt;ğŸ§ª æµ‹è¯•ä¸é›†æˆæ”¯æŒ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•æ¡†æ¶&lt;/strong&gt;ï¼šæä¾›&lt;code&gt;Spring TestContext&lt;/code&gt;æ¨¡å—ï¼Œæ”¯æŒJUnit/TestNGé›†æˆæµ‹è¯•ï¼Œå¯æ¨¡æ‹Ÿå®¹å™¨ç¯å¢ƒ&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡ç”Ÿæ€ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring Boot&lt;/strong&gt;ï¼šè‡ªåŠ¨åŒ–é…ç½®ã€å†…åµŒæœåŠ¡å™¨ï¼Œå¿«é€Ÿå¯åŠ¨åº”ç”¨&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud&lt;/strong&gt;ï¼šæœåŠ¡å‘ç°ï¼ˆEurekaï¼‰ã€é…ç½®ä¸­å¿ƒï¼ˆConfigï¼‰ç­‰å¾®æœåŠ¡ç»„ä»¶&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•ä¸é›†æˆèƒ½åŠ›"&gt;ğŸ”— æ‰©å±•ä¸é›†æˆèƒ½åŠ›
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼ä¸šæœåŠ¡&lt;/strong&gt;ï¼šé›†æˆJavaMailã€å®šæ—¶ä»»åŠ¡ï¼ˆQuartzï¼‰ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆJMS/Kafkaï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼šSpring Securityæä¾›è®¤è¯ã€æˆæƒã€CSRFé˜²æŠ¤ç­‰å…¨å¥—å®‰å…¨æ–¹æ¡ˆ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘åŸç”Ÿæ”¯æŒ&lt;/strong&gt;ï¼šå…¼å®¹Kubernetesã€Dockerï¼Œé€‚åº”äº‘ç¯å¢ƒéƒ¨ç½²&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ¨¡å—åŠŸèƒ½æ¦‚è§ˆ"&gt;æ ¸å¿ƒæ¨¡å—åŠŸèƒ½æ¦‚è§ˆ
&lt;/h3&gt;&lt;p&gt;ä¸‹è¡¨æ€»ç»“äº†Springæ¡†æ¶çš„ä¸»è¦æ¨¡å—åŠå…¶ä½œç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¨¡å—åˆ†ç±»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸»è¦ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒå®¹å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Beans, Core, Context, SpEL&lt;/td&gt;
&lt;td&gt;Beanç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä¾èµ–æ³¨å…¥ã€èµ„æºè®¿é—®ã€è¡¨è¾¾å¼è¯­è¨€æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®è®¿é—®/é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JDBC, ORM, Transactions&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“æ“ä½œæŠ½è±¡ã€ORMæ¡†æ¶é›†æˆã€å£°æ˜å¼äº‹åŠ¡ç®¡ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Webå±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Servlet, WebSocket, MVC&lt;/td&gt;
&lt;td&gt;Webåº”ç”¨å¼€å‘ã€å®æ—¶é€šä¿¡ã€MVCæ¨¡å¼å®ç°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AOPä¸åˆ‡é¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;AOP, Aspects&lt;/td&gt;
&lt;td&gt;æ¨ªåˆ‡å…³æ³¨ç‚¹åˆ†ç¦»ã€åˆ‡é¢ç¼–ç¨‹æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æµ‹è¯•æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Test&lt;/td&gt;
&lt;td&gt;å®¹å™¨ç¯å¢ƒæ¨¡æ‹Ÿã€é›†æˆæµ‹è¯•æ¡†æ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Springæ¡†æ¶çš„æ ¸å¿ƒä»·å€¼åœ¨äºé€šè¿‡&lt;strong&gt;IoC/AOPè§£è€¦ç»„ä»¶&lt;/strong&gt;ï¼Œä»¥&lt;strong&gt;æ¨¡å—åŒ–è®¾è®¡&lt;/strong&gt;è¦†ç›–ä¼ä¸šçº§å¼€å‘å…¨åœºæ™¯ï¼ˆæ•°æ®ã€Webã€å®‰å…¨ç­‰ï¼‰ï¼Œå¹¶é€šè¿‡&lt;strong&gt;å£°æ˜å¼ç¼–ç¨‹&lt;/strong&gt;ï¼ˆå¦‚äº‹åŠ¡ã€åˆ‡é¢ï¼‰å‡å°‘æ ·æ¿ä»£ç ã€‚å…¶è½»é‡çº§ç‰¹æ€§å’Œä¸°å¯Œçš„æ•´åˆèƒ½åŠ›ï¼ˆå¦‚Spring Bootçš„è‡ªåŠ¨åŒ–é…ç½®ï¼‰ä½¿å…¶æˆä¸ºç°ä»£Javaåº”ç”¨çš„åŸºçŸ³ã€‚å¼€å‘è€…å¯çµæ´»é€‰ç”¨å­æ¨¡å—ï¼ˆå¦‚ä»…ç”¨äº‹åŠ¡ç®¡ç†ï¼‰ï¼Œé¿å…â€œå…¨å®¶æ¡¶â€å¼è‡ƒè‚¿&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="aop"&gt;AOP
&lt;/h2&gt;&lt;p&gt;AOPï¼ˆAspect-Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨é€šè¿‡&lt;strong&gt;åˆ†ç¦»æ¨ªåˆ‡å…³æ³¨ç‚¹&lt;/strong&gt;ï¼ˆCross-Cutting Concernsï¼‰æé«˜ä»£ç çš„æ¨¡å—åŒ–ã€å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚ä»¥ä¸‹æ˜¯AOPçš„å…¨é¢è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-aopçš„æ ¸å¿ƒæ€æƒ³ä¸ä»·å€¼"&gt;ğŸ”§ &lt;strong&gt;AOPçš„æ ¸å¿ƒæ€æƒ³ä¸ä»·å€¼&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³OOPçš„å±€é™æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šåœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ä¸­ï¼Œæ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ç­‰é€šç”¨é€»è¾‘ä¼š&lt;strong&gt;é‡å¤åˆ†æ•£&lt;/strong&gt;åœ¨å¤šä¸ªä¸šåŠ¡æ¨¡å—ä¸­ï¼Œå¯¼è‡´ä»£ç å†—ä½™å’Œè€¦åˆ&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;ï¼šAOPå°†è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹æŠ½ç¦»ä¸ºç‹¬ç«‹æ¨¡å—ï¼ˆ&lt;strong&gt;åˆ‡é¢&lt;/strong&gt;ï¼‰ï¼Œé€šè¿‡åŠ¨æ€ç»‡å…¥åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦&lt;/strong&gt;ï¼šä¸šåŠ¡ä»£ç ä»…å…³æ³¨æ ¸å¿ƒé€»è¾‘ï¼Œæ¨ªåˆ‡åŠŸèƒ½ç”±åˆ‡é¢ç»Ÿä¸€ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤ç”¨&lt;/strong&gt;ï¼šé€šç”¨é€»è¾‘ï¼ˆå¦‚æ—¥å¿—ï¼‰åªéœ€ç¼–å†™ä¸€æ¬¡ï¼Œå¤šå¤„å¤ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç»´æŠ¤æ€§&lt;/strong&gt;ï¼šä¿®æ”¹æ¨ªåˆ‡åŠŸèƒ½æ—¶æ— éœ€æ”¹åŠ¨ä¸šåŠ¡ä»£ç &lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-aopæ ¸å¿ƒæ¦‚å¿µè¯¦è§£"&gt;âš™ï¸ &lt;strong&gt;AOPæ ¸å¿ƒæ¦‚å¿µè¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡é¢ï¼ˆAspectï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šå°è£…æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—ï¼ˆå¦‚æ—¥å¿—åˆ‡é¢ã€äº‹åŠ¡åˆ‡é¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°&lt;/strong&gt;ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªç±»ï¼ŒåŒ…å«åˆ‡å…¥ç‚¹å’Œé€šçŸ¥&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šç¨‹åºæ‰§è¡Œä¸­å¯æ’å…¥åˆ‡é¢çš„ç‚¹ï¼ˆå¦‚æ–¹æ³•è°ƒç”¨ã€å¼‚å¸¸æŠ›å‡ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring AOPé™åˆ¶&lt;/strong&gt;ï¼šä»…æ”¯æŒ&lt;strong&gt;æ–¹æ³•æ‰§è¡Œ&lt;/strong&gt;ç±»å‹çš„è¿æ¥ç‚¹&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šçŸ¥ï¼ˆAdviceï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½œç”¨ï¼šå®šä¹‰åˆ‡é¢åœ¨è¿æ¥ç‚¹çš„å…·ä½“è¡Œä¸ºï¼Œåˆ†äº”ç§ç±»å‹ï¼š
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é€šçŸ¥ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ‰§è¡Œæ—¶æœº&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Before&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰&lt;/td&gt;
&lt;td&gt;æƒé™æ£€æŸ¥ã€å‚æ•°æ ¡éªŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@AfterReturning&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡æ–¹æ³•æˆåŠŸè¿”å›å&lt;/td&gt;
&lt;td&gt;ç»“æœæ—¥å¿—è®°å½•ã€æ•°æ®æ ¼å¼åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@AfterThrowing&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸å&lt;/td&gt;
&lt;td&gt;å¼‚å¸¸å¤„ç†ã€äº‹åŠ¡å›æ»š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@After&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡æ–¹æ³•ç»“æŸåï¼ˆæ— è®ºæˆè´¥ï¼‰&lt;/td&gt;
&lt;td&gt;èµ„æºæ¸…ç†ï¼ˆå¦‚å…³é—­è¿æ¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Around&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰å&lt;/td&gt;
&lt;td&gt;æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ã€ç¼“å­˜ &lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šé€šè¿‡è¡¨è¾¾å¼åŒ¹é…ä¸€ç»„è¿æ¥ç‚¹ï¼ˆå¦‚&lt;code&gt;execution(* com.service.*.*(..))&lt;/code&gt;åŒ¹é…åŒ…ä¸‹æ‰€æœ‰æ–¹æ³•ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¡¨è¾¾å¼è¯­æ³•ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;execution(* com.example.service.UserService.*(..)) // åŒ¹é…UserServiceæ‰€æœ‰æ–¹æ³•
@annotation(com.example.Loggable) // åŒ¹é…å¸¦@Loggableæ³¨è§£çš„æ–¹æ³•
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‡å…¥ï¼ˆWeavingï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šå°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†çš„è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;æ—¶æœºï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼–è¯‘æ—¶&lt;/strong&gt;ï¼ˆAspectJï¼‰ï¼šæ€§èƒ½é«˜ä½†éœ€é¢å¤–ç¼–è¯‘å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œæ—¶&lt;/strong&gt;ï¼ˆSpring AOPï¼‰ï¼šé€šè¿‡åŠ¨æ€ä»£ç†å®ç°ï¼Œæ— éœ€ç¼–è¯‘æ”¯æŒ&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-aopçš„å®ç°æœºåˆ¶"&gt;ğŸ› ï¸ &lt;strong&gt;AOPçš„å®ç°æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åŠ¨æ€ä»£ç†
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JDKåŠ¨æ€ä»£ç†&lt;/strong&gt;ï¼šåŸºäºæ¥å£ï¼Œè¦æ±‚ç›®æ ‡ç±»å®ç°æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CGLIBä»£ç†&lt;/strong&gt;ï¼šåŸºäºå­ç±»ç»§æ‰¿ï¼Œå¯ä»£ç†æ— æ¥å£çš„ç±»ï¼ˆSpringé»˜è®¤ä¼˜å…ˆJDKï¼Œæ— æ¥å£åˆ™ç”¨CGLIBï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç†æµç¨‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[è°ƒç”¨è€…] --&amp;gt; B(ä»£ç†å¯¹è±¡)
B --&amp;gt; C{æ‰§è¡Œé€šçŸ¥é€»è¾‘}
C --&amp;gt; D[æ‰§è¡Œç›®æ ‡æ–¹æ³•]
C --&amp;gt; E[è¿”å›ç»“æœ/å¼‚å¸¸]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸ’¡ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—è®°å½•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç»Ÿä¸€è®°å½•æ–¹æ³•å…¥å‚ã€è¿”å›å€¼ã€å¼‚å¸¸ä¿¡æ¯ï¼Œé¿å…ä¸šåŠ¡ä»£ç æ±¡æŸ“&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£è‡ªåŠ¨ç®¡ç†äº‹åŠ¡ï¼ˆå¼€å¯ã€æäº¤ã€å›æ»šï¼‰&lt;a class="link" href="@ref" &gt;5,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™æ ¡éªŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ–¹æ³•æ‰§è¡Œå‰æ£€æŸ¥ç”¨æˆ·æƒé™ï¼Œæ‹¦æˆªéæ³•è®¿é—®&lt;a class="link" href="@ref" &gt;1,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ @Around ç»Ÿè®¡æ–¹æ³•æ‰§è¡Œè€—æ—¶ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Around(&amp;#34;execution(* com.service.*.*(..))&amp;#34;)
public Object monitorTime(ProceedingJoinPoint pjp) throws Throwable {
long start = System.currentTimeMillis();
Object result = pjp.proceed();
long time = System.currentTimeMillis() - start;
log.info(&amp;#34;æ–¹æ³• {} è€—æ—¶ {} ms&amp;#34;, pjp.getSignature(), time);
return result;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡AOPæ‹¦æˆªæŸ¥è¯¢æ–¹æ³•ï¼Œå®ç°ç¼“å­˜é€»è¾‘ä¸ä¸šåŠ¡è§£è€¦&lt;a class="link" href="@ref" &gt;10,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-aopçš„ä¼˜ç¼ºç‚¹"&gt;âš–ï¸ &lt;strong&gt;AOPçš„ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è§£è€¦ä¸šåŠ¡ä¸æ¨ªåˆ‡é€»è¾‘&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;ï¼šä»£ç†è°ƒç”¨å¢åŠ è€—æ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç å¤ç”¨æ€§é«˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è°ƒè¯•å¤æ‚&lt;/strong&gt;ï¼šè°ƒç”¨é“¾è·¯ç”±åˆ‡é¢æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯ç»´æŠ¤æ€§å¼º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;åŠŸèƒ½é™åˆ¶&lt;/strong&gt;ï¼šSpring AOPä»…æ”¯æŒæ–¹æ³•çº§åˆ«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•çµæ´»&lt;/strong&gt;ï¼ˆåŠ¨æ€æ·»åŠ åŠŸèƒ½ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æ›²çº¿&lt;/strong&gt;ï¼šéœ€æŒæ¡è¡¨è¾¾å¼è¯­æ³•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-spring-aop-vs-aspectj"&gt;ğŸŒ &lt;strong&gt;Spring AOP vs AspectJ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Spring AOP&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;AspectJ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿è¡Œæ—¶åŠ¨æ€ä»£ç†&lt;/td&gt;
&lt;td&gt;ç¼–è¯‘æ—¶/ç±»åŠ è½½æ—¶å­—èŠ‚ç å¢å¼º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿è¡Œæ—¶å¼€é”€è¾ƒå¤§&lt;/td&gt;
&lt;td&gt;æ— è¿è¡Œæ—¶å¼€é”€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ”¯æŒç²’åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ–¹æ³•çº§åˆ«&lt;/td&gt;
&lt;td&gt;æ–¹æ³•ã€å­—æ®µã€æ„é€ å™¨ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è½»é‡çº§ï¼Œé›†æˆSpringå®¹å™¨&lt;/td&gt;
&lt;td&gt;éœ€ç‹¬ç«‹ç¼–è¯‘å™¨æˆ–ç»‡å…¥å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤šæ•°ä¼ä¸šåº”ç”¨&lt;/td&gt;
&lt;td&gt;é«˜æ€§èƒ½è¦æ±‚æˆ–å¤æ‚åˆ‡é¢åœºæ™¯ &lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;AOPé€šè¿‡&lt;strong&gt;åŠ¨æ€ä»£ç†æŠ€æœ¯&lt;/strong&gt;å°†æ¨ªåˆ‡å…³æ³¨ç‚¹æ¨¡å—åŒ–ï¼Œæ˜¯OOPçš„é‡è¦è¡¥å……ã€‚å…¶æ ¸å¿ƒåœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº”å¤§æ¦‚å¿µ&lt;/strong&gt;ï¼šåˆ‡é¢ã€è¿æ¥ç‚¹ã€é€šçŸ¥ã€åˆ‡å…¥ç‚¹ã€ç»‡å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ç­‰&lt;strong&gt;é‡å¤æ€§åŠŸèƒ½&lt;/strong&gt;çš„è§£è€¦ã€‚&lt;/li&gt;
&lt;li&gt;é€‰å‹å»ºè®®ï¼š
&lt;ul&gt;
&lt;li&gt;å¸¸è§„Springåº”ç”¨ â†’ &lt;strong&gt;Spring AOP&lt;/strong&gt;ï¼ˆç®€å•æ˜“ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é«˜æ€§èƒ½éœ€æ±‚ â†’ &lt;strong&gt;AspectJ&lt;/strong&gt;ï¼ˆæ— è¿è¡Œæ—¶æŸè€—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨æ³¨è§£å£°æ˜åˆ‡é¢ï¼Œé¿å…è¿‡åº¦AOPå¯¼è‡´è°ƒç”¨é“¾è·¯å¤æ‚åŒ–&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="aspect"&gt;@Aspect
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Aspect&lt;/code&gt; æ˜¯ Spring AOP ä¸­ç”¨äºå®šä¹‰åˆ‡é¢ï¼ˆAspectï¼‰çš„æ ¸å¿ƒæ³¨è§£ï¼Œå®ƒå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ ¡éªŒç­‰ï¼‰æ¨¡å—åŒ–ï¼Œä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼Œæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒä½œç”¨"&gt;ğŸ”§ &lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜åˆ‡é¢ç±»&lt;/strong&gt;
&lt;code&gt;@Aspect&lt;/code&gt; æ ‡è®°çš„ç±»ç§°ä¸ºåˆ‡é¢ç±»ï¼Œç”¨äºå°è£…æ¨ªåˆ‡é€»è¾‘ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Aspect
@Component
public class LoggingAspect { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰åˆ‡å…¥ç‚¹ä¸é€šçŸ¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰&lt;/strong&gt;ï¼šé€šè¿‡è¡¨è¾¾å¼æŒ‡å®šå“ªäº›æ–¹æ³•éœ€è¢«å¢å¼ºï¼ˆå¦‚ &lt;code&gt;execution(* com.example.service.*.*(..))&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šçŸ¥ï¼ˆAdviceï¼‰&lt;/strong&gt;ï¼šå®šä¹‰å¢å¼ºé€»è¾‘çš„æ‰§è¡Œæ—¶æœºï¼ˆå‰ç½®ã€åç½®ã€ç¯ç»•ç­‰ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç»„æˆè¦ç´ "&gt;âš™ï¸ &lt;strong&gt;ç»„æˆè¦ç´ &lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆPointcut Expressionï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;execution&lt;/code&gt;ï¼šæœ€å¸¸ç”¨ï¼ŒåŒ¹é…æ–¹æ³•ç­¾åï¼ˆå¦‚ &lt;code&gt;execution(public * UserService.*(..))&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@annotation&lt;/code&gt;ï¼šåŒ¹é…å¸¦ç‰¹å®šæ³¨è§£çš„æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;@annotation(com.example.RequireAuth)&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–ï¼š&lt;code&gt;within&lt;/code&gt;ï¼ˆç±»/åŒ…åŒ¹é…ï¼‰ã€&lt;code&gt;args&lt;/code&gt;ï¼ˆå‚æ•°ç±»å‹åŒ¹é…ï¼‰ç­‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šçŸ¥ç±»å‹ï¼ˆAdvice Typesï¼‰&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é€šçŸ¥ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ‰§è¡Œæ—¶æœº&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‰ç½®é€šçŸ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Before&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰&lt;/td&gt;
&lt;td&gt;æƒé™æ ¡éªŒã€å‚æ•°éªŒè¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åç½®é€šçŸ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@After&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æ‰§è¡Œåï¼ˆæ— è®ºæˆè´¥ï¼‰&lt;/td&gt;
&lt;td&gt;èµ„æºæ¸…ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›é€šçŸ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@AfterReturning&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æˆåŠŸè¿”å›å&lt;/td&gt;
&lt;td&gt;ç»“æœæ—¥å¿—è®°å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸é€šçŸ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@AfterThrowing&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æŠ›å‡ºå¼‚å¸¸å&lt;/td&gt;
&lt;td&gt;å¼‚å¸¸ç›‘æ§ã€å‘Šè­¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¯ç»•é€šçŸ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Around&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æ‰§è¡Œå‰åï¼ˆå¯æ§åˆ¶æµç¨‹ï¼‰&lt;/td&gt;
&lt;td&gt;æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡ç®¡ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¯ç»•é€šçŸ¥ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Around(&amp;#34;serviceMethods()&amp;#34;)
public Object logTime(ProceedingJoinPoint pjp) throws Throwable {
long start = System.currentTimeMillis();
Object result = pjp.proceed(); // æ‰§è¡Œç›®æ ‡æ–¹æ³•
System.out.println(&amp;#34;è€—æ—¶ï¼š&amp;#34; + (System.currentTimeMillis() - start) + &amp;#34;ms&amp;#34;);
return result;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å®ç°æœºåˆ¶"&gt;ğŸ› ï¸ &lt;strong&gt;å®ç°æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä»£ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JDK åŠ¨æ€ä»£ç†&lt;/strong&gt;ï¼šç›®æ ‡ç±»å®ç°æ¥å£æ—¶ä½¿ç”¨ï¼ˆåŸºäºæ¥å£ä»£ç†ï¼‰&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CGLIB ä»£ç†&lt;/strong&gt;ï¼šç›®æ ‡ç±»æ— æ¥å£æ—¶ä½¿ç”¨ï¼ˆåŸºäºå­ç±»ç»§æ‰¿ï¼‰&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚
Spring é»˜è®¤ä¼˜å…ˆ JDK ä»£ç†ï¼Œè‹¥æ— æ¥å£åˆ™è‡ªåŠ¨åˆ‡æ¢ä¸º CGLIBã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‡å…¥ï¼ˆWeavingï¼‰&lt;/strong&gt;
åœ¨è¿è¡Œæ—¶å°†åˆ‡é¢é€»è¾‘ç»‡å…¥ç›®æ ‡æ–¹æ³•ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡æ›¿ä»£åŸå¯¹è±¡&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨æ­¥éª¤"&gt;ğŸ“ &lt;strong&gt;ä½¿ç”¨æ­¥éª¤&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;
Maven é¡¹ç›®ä¸­å¼•å…¥ Spring AOP ä¾èµ–ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-starter-aop&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºåˆ‡é¢ç±»&lt;/strong&gt;
ä½¿ç”¨ &lt;code&gt;@Aspect&lt;/code&gt; å’Œ &lt;code&gt;@Component&lt;/code&gt; æ³¨è§£æ ‡è®°ç±»ï¼Œå¹¶å®šä¹‰åˆ‡å…¥ç‚¹ä¸é€šçŸ¥&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Aspect
@Component
public class SecurityAspect {
@Pointcut(&amp;#34;@annotation(RequireAuth)&amp;#34;)
public void authPointcut() {}
@Before(&amp;#34;authPointcut()&amp;#34;)
public void checkAuth() { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨ AOP&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Spring Bootï¼šè‡ªåŠ¨æ‰«æ &lt;code&gt;@Aspect&lt;/code&gt; ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ä¼ ç»Ÿ Spring é¡¹ç›®ï¼šéœ€æ·»åŠ  &lt;code&gt;@EnableAspectJAutoProxy&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;ğŸ’¡ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—è®°å½•&lt;/strong&gt;
ç»Ÿä¸€è®°å½•æ–¹æ³•å…¥å‚ã€è¿”å›å€¼åŠå¼‚å¸¸ä¿¡æ¯&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†&lt;/strong&gt;
é€šè¿‡ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£è‡ªåŠ¨ç®¡ç†äº‹åŠ¡è¾¹ç•Œ&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™æ ¡éªŒ&lt;/strong&gt;
æ‹¦æˆªå¸¦ &lt;code&gt;@RequirePermission&lt;/code&gt; æ³¨è§£çš„æ–¹æ³•ï¼ŒéªŒè¯ç”¨æˆ·æƒé™&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;
ä½¿ç”¨ &lt;code&gt;@Around&lt;/code&gt; ç»Ÿè®¡æ–¹æ³•æ‰§è¡Œè€—æ—¶&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å‡†ç¡®æ€§&lt;/strong&gt;
è¡¨è¾¾å¼é”™è¯¯å¯èƒ½å¯¼è‡´åˆ‡é¢æœªç”Ÿæ•ˆï¼ˆå¦‚åŒ…è·¯å¾„æ‹¼å†™é”™è¯¯ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒç±»è°ƒç”¨å¤±æ•ˆ&lt;/strong&gt;
ç±»å†…éƒ¨æ–¹æ³•ç›¸äº’è°ƒç”¨ä¸ä¼šè§¦å‘ä»£ç†ï¼ˆéœ€é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯ç»•é€šçŸ¥å¿…é¡»è°ƒç”¨ &lt;code&gt;proceed()&lt;/code&gt;&lt;/strong&gt;
å¦åˆ™ç›®æ ‡æ–¹æ³•ä¸ä¼šæ‰§è¡Œ&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåºæ§åˆ¶&lt;/strong&gt;
å¤šä¸ªåˆ‡é¢ä½œç”¨äºåŒä¸€æ–¹æ³•æ—¶ï¼Œç”¨ &lt;code&gt;@Order&lt;/code&gt; æŒ‡å®šä¼˜å…ˆçº§&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;
è¿‡å¤šåˆ‡é¢å¯èƒ½å¢åŠ è°ƒç”¨é“¾æ·±åº¦ï¼Œé«˜å¹¶å‘åœºæ™¯éœ€è°¨æ…ä½¿ç”¨&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Aspect&lt;/code&gt; æ˜¯ Spring AOP çš„æ ¸å¿ƒæ³¨è§£ï¼Œé€šè¿‡ &lt;strong&gt;åˆ‡å…¥ç‚¹ + é€šçŸ¥&lt;/strong&gt; çš„å£°æ˜å¼ç»„åˆï¼Œå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–ç®¡ç†ã€‚æŒæ¡å…¶è¡¨è¾¾å¼è¯­æ³•ã€é€šçŸ¥ç±»å‹åŠä»£ç†æœºåˆ¶ï¼Œå¯é«˜æ•ˆåº”ç”¨äºæ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ç­‰åœºæ™¯ï¼Œæ˜¾è‘—æå‡ä»£ç è´¨é‡ã€‚å¼€å‘æ—¶éœ€æ³¨æ„è¡¨è¾¾å¼å‡†ç¡®æ€§ã€ä»£ç†é™åˆ¶åŠæ€§èƒ½ä¼˜åŒ–ï¼Œé¿å…å¸¸è§é™·é˜±&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="joinpoint"&gt;&lt;code&gt;JoinPoint&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring AOP ä¸­ï¼Œ&lt;strong&gt;Adviceï¼ˆé€šçŸ¥ï¼‰çš„å‚æ•°&lt;/strong&gt;ç”¨äºåœ¨åˆ‡é¢é€»è¾‘ä¸­è·å–ç›®æ ‡æ–¹æ³•çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚æ–¹æ³•ç­¾åã€å‚æ•°å€¼ã€è¿”å›å€¼ã€å¼‚å¸¸ç­‰ï¼‰ã€‚å‚æ•°ç±»å‹å’Œå†…å®¹å›  Advice ç±»å‹ï¼ˆ&lt;code&gt;@Before&lt;/code&gt;ã€&lt;code&gt;@After&lt;/code&gt;ã€&lt;code&gt;@Around&lt;/code&gt; ç­‰ï¼‰è€Œå¼‚ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå‚æ•°ç±»å‹"&gt;ğŸ”§ &lt;strong&gt;æ ¸å¿ƒå‚æ•°ç±»å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="joinpoint-1"&gt;&lt;strong&gt;&lt;code&gt;JoinPoint&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨ Advice ç±»å‹&lt;/strong&gt;ï¼š&lt;code&gt;@Before&lt;/code&gt;ã€&lt;code&gt;@AfterReturning&lt;/code&gt;ã€&lt;code&gt;@AfterThrowing&lt;/code&gt;ã€&lt;code&gt;@After&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæä¾›ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–¹æ³•ç­¾åã€å‚æ•°ã€ç›®æ ‡å¯¹è±¡ç­‰&lt;a class="link" href="@ref" &gt;1,6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®æ–¹æ³•ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getArgs()&lt;/code&gt;ï¼šè·å–æ–¹æ³•å‚æ•°å€¼ï¼ˆ&lt;code&gt;Object[]&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;getSignature()&lt;/code&gt;ï¼šè·å–æ–¹æ³•ç­¾åï¼ˆæ–¹æ³•åã€è¿”å›ç±»å‹ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;getTarget()&lt;/code&gt;ï¼šè·å–è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;getThis()&lt;/code&gt;ï¼šè·å– AOP ä»£ç†å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Before(&amp;#34;execution(* com.example.UserService.*(..))&amp;#34;)
public void logBefore(JoinPoint joinPoint) {
System.out.println(&amp;#34;Method: &amp;#34; + joinPoint.getSignature().getName());
System.out.println(&amp;#34;Args: &amp;#34; + Arrays.toString(joinPoint.getArgs()));
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="proceedingjoinpoint"&gt;&lt;strong&gt;&lt;code&gt;ProceedingJoinPoint&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨ Advice ç±»å‹&lt;/strong&gt;ï¼š&lt;code&gt;@Around&lt;/code&gt;ï¼ˆ&lt;strong&gt;å¿…é¡»ä½¿ç”¨&lt;/strong&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç»§æ‰¿ &lt;code&gt;JoinPoint&lt;/code&gt;ï¼Œé¢å¤–æä¾› &lt;code&gt;proceed()&lt;/code&gt; æ–¹æ³•æ§åˆ¶ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®æ–¹æ³•ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;proceed()&lt;/code&gt;ï¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œè¿”å›ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;proceed(Object[] args)&lt;/code&gt;ï¼šä¿®æ”¹å‚æ•°åæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Around(&amp;#34;execution(* com.example.UserService.*(..))&amp;#34;)
public Object aroundAdvice(ProceedingJoinPoint pjp) throws Throwable {
System.out.println(&amp;#34;Before method&amp;#34;);
Object result = pjp.proceed(); // æ‰§è¡Œç›®æ ‡æ–¹æ³•
System.out.println(&amp;#34;After method&amp;#34;);
return result;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç‰¹æ®Šå‚æ•°ç»‘å®šè¿”å›å€¼æˆ–å¼‚å¸¸"&gt;âš™ï¸ &lt;strong&gt;ç‰¹æ®Šå‚æ•°ï¼ˆç»‘å®šè¿”å›å€¼æˆ–å¼‚å¸¸ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è¿”å›å€¼ç»‘å®š"&gt;&lt;strong&gt;è¿”å›å€¼ç»‘å®šï¼ˆ&lt;code&gt;@AfterReturning&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å‚æ•°è¦æ±‚ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;returning&lt;/code&gt; å±æ€§æŒ‡å®šå‚æ•°åã€‚&lt;/li&gt;
&lt;li&gt;å‚æ•°ç±»å‹éœ€åŒ¹é…ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ï¼ˆæˆ–ä½¿ç”¨ &lt;code&gt;Object&lt;/code&gt; é€šç”¨ç±»å‹ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@AfterReturning(value = &amp;#34;execution(* UserService.getUser(..))&amp;#34;, returning = &amp;#34;user&amp;#34;)
public void logReturn(JoinPoint joinPoint, Object user) {
System.out.println(&amp;#34;Returned: &amp;#34; + user);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼‚å¸¸ç»‘å®š"&gt;&lt;strong&gt;å¼‚å¸¸ç»‘å®šï¼ˆ&lt;code&gt;@AfterThrowing&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å‚æ•°è¦æ±‚ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;throwing&lt;/code&gt; å±æ€§æŒ‡å®šå‚æ•°åã€‚&lt;/li&gt;
&lt;li&gt;å‚æ•°ç±»å‹éœ€ä¸º &lt;code&gt;Throwable&lt;/code&gt; æˆ–å…¶å­ç±»&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@AfterThrowing(value = &amp;#34;execution(* UserService.*(..))&amp;#34;, throwing = &amp;#34;ex&amp;#34;)
public void logException(JoinPoint joinPoint, Exception ex) {
System.out.println(&amp;#34;Exception: &amp;#34; + ex.getMessage());
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è‡ªå®šä¹‰å‚æ•°æ³¨å…¥"&gt;ğŸ’¡ &lt;strong&gt;è‡ªå®šä¹‰å‚æ•°æ³¨å…¥&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ³¨è§£å‚æ•°å¦‚"&gt;&lt;strong&gt;æ³¨è§£å‚æ•°ï¼ˆå¦‚ &lt;code&gt;@ModifyRequestParam&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;@Around&lt;/code&gt; ä¸­è·å–è‡ªå®šä¹‰æ³¨è§£çš„å±æ€§å€¼&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Around(&amp;#34;@annotation(modify)&amp;#34;)
public Object modifyParam(ProceedingJoinPoint pjp, ModifyRequestParam modify) {
String key = modify.key(); // è·å–æ³¨è§£å±æ€§
// ... ä¿®æ”¹è¯·æ±‚å‚æ•°é€»è¾‘
return pjp.proceed();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¯·æ±‚ä¸Šä¸‹æ–‡å‚æ•°å¦‚"&gt;&lt;strong&gt;è¯·æ±‚ä¸Šä¸‹æ–‡å‚æ•°ï¼ˆå¦‚ &lt;code&gt;HttpServletRequest&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨ Web åˆ‡é¢ä¸­è·å– HTTP è¯·æ±‚å¯¹è±¡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Before(&amp;#34;webLogPointcut()&amp;#34;)
public void logRequest(JoinPoint joinPoint) {
HttpServletRequest request = ((ServletRequestAttributes)
RequestContextHolder.currentRequestAttributes()).getRequest();
System.out.println(&amp;#34;Request URL: &amp;#34; + request.getRequestURL());
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å‚æ•°æ€»ç»“è¡¨"&gt;ğŸ“Š &lt;strong&gt;å‚æ•°æ€»ç»“è¡¨&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Advice ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒå‚æ•°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é¢å¤–ç»‘å®šå‚æ•°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Before&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JoinPoint&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;æƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@After&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JoinPoint&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;èµ„æºæ¸…ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@AfterReturning&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JoinPoint&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;returning=&amp;quot;è¿”å›å€¼å‚æ•°å&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿”å›å€¼å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@AfterThrowing&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JoinPoint&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;throwing=&amp;quot;å¼‚å¸¸å‚æ•°å&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¼‚å¸¸ç›‘æ§ã€å‘Šè­¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Around&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ProceedingJoinPoint&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰æ³¨è§£ã€è¯·æ±‚å¯¹è±¡ç­‰&lt;/td&gt;
&lt;td&gt;äº‹åŠ¡ç®¡ç†ã€å‚æ•°ä¿®æ”¹ã€æ€§èƒ½ç›‘æ§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å‚æ•°é¡ºåºï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;JoinPoint&lt;/code&gt; æˆ– &lt;code&gt;ProceedingJoinPoint&lt;/code&gt; å¿…é¡»æ˜¯&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°&lt;/strong&gt;ï¼Œå…¶ä»–å‚æ•°æŒ‰éœ€æ·»åŠ &lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç±»å‹åŒ¹é…ï¼š
&lt;ul&gt;
&lt;li&gt;ç»‘å®šè¿”å›å€¼æˆ–å¼‚å¸¸æ—¶ï¼Œå‚æ•°ç±»å‹éœ€ä¸ç›®æ ‡æ–¹æ³•ä¸€è‡´ï¼ˆå¦‚è¿”å›å€¼ç±»å‹ä¸º &lt;code&gt;User&lt;/code&gt;ï¼Œåˆ™å‚æ•°åº”ä¸º &lt;code&gt;User user&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½å½±å“ï¼š
&lt;ul&gt;
&lt;li&gt;é¢‘ç¹æ“ä½œ &lt;code&gt;JoinPoint.getArgs()&lt;/code&gt; å¯èƒ½å½±å“æ€§èƒ½ï¼Œå»ºè®®åœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡çµæ´»ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆå®ç°æ—¥å¿—è®°å½•ã€æƒé™æ§åˆ¶ã€äº‹åŠ¡ç®¡ç†ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæå‡ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§&lt;a class="link" href="@ref" &gt;1,5,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="pointcut"&gt;PointCut
&lt;/h2&gt;&lt;p&gt;Spring AOPä¸­çš„&lt;strong&gt;åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆPointcut Expressionï¼‰&lt;/strong&gt; ç”¨äºç²¾ç¡®æŒ‡å®šå“ªäº›æ–¹æ³•éœ€è¦è¢«åˆ‡é¢é€»è¾‘å¢å¼ºï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ç­‰ï¼‰ã€‚å…¶æ ¸å¿ƒæ˜¯é€šè¿‡è¯­æ³•è§„åˆ™åŒ¹é…ç›®æ ‡æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒè¡¨è¾¾å¼ç±»å‹ä¸è¯­æ³•"&gt;ğŸ”§ &lt;strong&gt;æ ¸å¿ƒè¡¨è¾¾å¼ç±»å‹ä¸è¯­æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="execution"&gt;&lt;strong&gt;&lt;code&gt;execution&lt;/code&gt;ï¼ˆæœ€å¸¸ç”¨ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡æ–¹æ³•ç­¾ååŒ¹é…è¿æ¥ç‚¹ï¼Œè¯­æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;execution([ä¿®é¥°ç¬¦] è¿”å›ç±»å‹ [åŒ….ç±».æ–¹æ³•] (å‚æ•°) [throws å¼‚å¸¸])
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;é€šé…ç¬¦ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;*&lt;/code&gt;ï¼šåŒ¹é…ä»»æ„ç±»å‹æˆ–åç§°ï¼ˆå¦‚è¿”å›å€¼ã€åŒ…ã€ç±»ã€æ–¹æ³•åï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;..&lt;/code&gt;ï¼š&lt;/li&gt;
&lt;li&gt;åœ¨åŒ…è·¯å¾„ä¸­ï¼šåŒ¹é…ä»»æ„å±‚çº§çš„å­åŒ…ï¼ˆå¦‚ &lt;code&gt;com..service.*&lt;/code&gt; åŒ¹é… &lt;code&gt;com&lt;/code&gt; ä¸‹æ‰€æœ‰å­åŒ…ä¸­çš„ &lt;code&gt;service&lt;/code&gt; åŒ…ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;åœ¨å‚æ•°ä¸­ï¼šåŒ¹é…ä»»æ„ä¸ªæ•°ã€ä»»æ„ç±»å‹çš„å‚æ•°ï¼ˆå¦‚ &lt;code&gt;(..)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;execution(public * com.example.service.*.save*(..))
&lt;/code&gt;&lt;/pre&gt;åŒ¹é…
&lt;pre tabindex="0"&gt;&lt;code&gt;com.example.service
&lt;/code&gt;&lt;/pre&gt;åŒ…ä¸‹æ‰€æœ‰ç±»çš„ save å¼€å¤´çš„ public æ–¹æ³•ï¼Œå‚æ•°ä»»æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="within"&gt;&lt;strong&gt;&lt;code&gt;within&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åŒ¹é…ç‰¹å®šç±»æˆ–åŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;within(åŒ…è·¯å¾„æˆ–ç±»å)
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;within(com.example.service.UserService)&lt;/code&gt;ï¼šåŒ¹é… &lt;code&gt;UserService&lt;/code&gt; ç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;within(com.example.service..*)&lt;/code&gt;ï¼šåŒ¹é… &lt;code&gt;service&lt;/code&gt; åŒ…åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰ç±»çš„æ–¹æ³•&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="annotation"&gt;&lt;strong&gt;&lt;code&gt;@annotation&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åŒ¹é…å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@annotation(æ³¨è§£ç±»å‹)
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@annotation(com.example.anno.Log)
&lt;/code&gt;&lt;/pre&gt;åŒ¹é…æ‰€æœ‰æ ‡æ³¨äº† @Log æ³¨è§£çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="args"&gt;&lt;strong&gt;&lt;code&gt;args&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åŒ¹é…æ–¹æ³•å‚æ•°ç±»å‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;args(å‚æ•°ç±»å‹)
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;args(java.lang.String)&lt;/code&gt;ï¼šåŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸º &lt;code&gt;String&lt;/code&gt; çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;args(.., int)&lt;/code&gt;ï¼šåŒ¹é…æœ€åä¸€ä¸ªå‚æ•°ä¸º &lt;code&gt;int&lt;/code&gt; çš„æ–¹æ³•&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="å…¶ä»–è¡¨è¾¾å¼"&gt;&lt;strong&gt;å…¶ä»–è¡¨è¾¾å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è¡¨è¾¾å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@target&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ¹é…ç±»ä¸Šå¸¦æŒ‡å®šæ³¨è§£çš„æ–¹æ³•&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@target(org.springframework.stereotype.Service)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@within&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ &lt;code&gt;@target&lt;/code&gt;ï¼ˆä»£ç†ç±»ç”Ÿæ•ˆï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@within(org.springframework.transaction.annotation.Transactional)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‰ Bean åç§°åŒ¹é…&lt;/td&gt;
&lt;td&gt;&lt;code&gt;bean(userService)&lt;/code&gt; åŒ¹é…åä¸º &lt;code&gt;userService&lt;/code&gt; çš„ Bean çš„æ–¹æ³•&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;this&lt;/code&gt; / &lt;code&gt;target&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŒ¹é…ä»£ç†å¯¹è±¡/ç›®æ ‡å¯¹è±¡çš„ç±»å‹&lt;/td&gt;
&lt;td&gt;&lt;code&gt;this(com.example.Service)&lt;/code&gt; åŒ¹é…ä»£ç†å¯¹è±¡å®ç°è¯¥æ¥å£çš„æ–¹æ³•&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ç»„åˆè¡¨è¾¾å¼ä¸é€»è¾‘è¿ç®—ç¬¦"&gt;âš™ï¸ &lt;strong&gt;ç»„åˆè¡¨è¾¾å¼ä¸é€»è¾‘è¿ç®—ç¬¦&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ”¯æŒ &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt;ï¼ˆä¸ï¼‰ã€&lt;code&gt;||&lt;/code&gt;ï¼ˆæˆ–ï¼‰ã€&lt;code&gt;!&lt;/code&gt;ï¼ˆéï¼‰ç»„åˆå¤šä¸ªè¡¨è¾¾å¼ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Pointcut(&amp;#34;execution(* com.example.service.*.save*(..)) || @annotation(com.example.anno.Audit)&amp;#34;)
public void saveOrAuditMethods() {}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šåŒ¹é…æ‰€æœ‰ &lt;code&gt;save&lt;/code&gt; å¼€å¤´çš„æ–¹æ³• &lt;strong&gt;æˆ–&lt;/strong&gt; å¸¦ &lt;code&gt;@Audit&lt;/code&gt; æ³¨è§£çš„æ–¹æ³•&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–"&gt;ğŸ› ï¸ &lt;strong&gt;æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç²¾ç¡®åŒ¹é…ä¼˜å…ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å…è¿‡åº¦ä½¿ç”¨ &lt;code&gt;..&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;execution(* com..*.*(..))&lt;/code&gt;ï¼‰ï¼Œæ­¤ç±»è¡¨è¾¾å¼ä¼šæ‰«æå…¨åŒ…ï¼Œæ€§èƒ½è¾ƒå·®&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¨èæŒ‰æ¥å£æè¿°åˆ‡å…¥ç‚¹ï¼ˆè€Œéå®ç°ç±»ï¼‰ï¼Œæé«˜æ‰©å±•æ€§ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;execution(* com.example.service.UserService.*(..)) // ä¼˜äºç›´æ¥å†™å®ç°ç±»
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£é©±åŠ¨&lt;/strong&gt;ï¼š
ä½¿ç”¨ &lt;code&gt;@annotation&lt;/code&gt; è§£è€¦ä¸šåŠ¡é€»è¾‘ï¼Œå‡å°‘å¯¹æ–¹æ³•ç­¾åçš„ä¾èµ–&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æå–å…¬å…±è¡¨è¾¾å¼&lt;/strong&gt;ï¼š
ç”¨ &lt;code&gt;@Pointcut&lt;/code&gt; å®šä¹‰å…¬å…±è¡¨è¾¾å¼ï¼Œå¤šå¤„å¤ç”¨ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Aspect
@Component
public class LogAspect {
@Pointcut(&amp;#34;execution(* com.example.service.*.*(..))&amp;#34;)
public void serviceMethods() {}
@Before(&amp;#34;serviceMethods()&amp;#34;)
public void logBefore(JoinPoint jp) { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-2"&gt;ğŸ’ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èè¡¨è¾¾å¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å…¨å±€æ—¥å¿—è®°å½•&lt;/td&gt;
&lt;td&gt;&lt;code&gt;execution(* com.example.service..*(..))&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æƒé™æ ¡éªŒ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@annotation(com.example.anno.RequireAuth)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;äº‹åŠ¡ç®¡ç†&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@annotation(org.springframework.transaction.annotation.Transactional)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å‚æ•°æ ¡éªŒ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;args(javax.validation.Valid, ..)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é¿å‘æŒ‡å—"&gt;âš ï¸ &lt;strong&gt;é¿å‘æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒç±»è°ƒç”¨å¤±æ•ˆ&lt;/strong&gt;ï¼šAOP åŸºäºä»£ç†ï¼Œç±»å†…éƒ¨æ–¹æ³•ç›¸äº’è°ƒç”¨ä¸ä¼šè§¦å‘åˆ‡é¢&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¡¨è¾¾å¼ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šç»„åˆè¡¨è¾¾å¼æ—¶ï¼Œ&lt;code&gt;!&lt;/code&gt; çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œéœ€ç”¨æ‹¬å·æ˜ç¡®é€»è¾‘ï¼ˆå¦‚ &lt;code&gt;!(A &amp;amp;&amp;amp; B)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°ç±»å‹åŒ¹é…&lt;/strong&gt;ï¼š&lt;code&gt;args&lt;/code&gt; ä¸¥æ ¼åŒ¹é…è¿è¡Œæ—¶å‚æ•°ç±»å‹ï¼Œæ³›å‹éœ€è°¨æ…ï¼ˆå¦‚ &lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; ä¼šè¢«è§†ä¸º &lt;code&gt;List&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚
æŒæ¡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼èƒ½ç²¾å‡†æ§åˆ¶AOPå¢å¼ºèŒƒå›´ï¼Œç»“åˆä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚è¡¨è¾¾å¼ï¼Œå¯æ˜¾è‘—æå‡ä»£ç å¯ç»´æŠ¤æ€§ï¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="component--bean"&gt;@Component &amp;amp; @Bean
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring æ¡†æ¶ä¸­ï¼Œ&lt;code&gt;@Component&lt;/code&gt; å’Œ &lt;code&gt;@Bean&lt;/code&gt; éƒ½æ˜¯ç”¨äºå°†å¯¹è±¡æ³¨å†Œä¸º Spring å®¹å™¨ç®¡ç†çš„ Bean çš„æ ¸å¿ƒæ³¨è§£ï¼Œä½†å®ƒä»¬åœ¨è®¾è®¡ç›®çš„ã€ä½¿ç”¨æ–¹å¼å’Œé€‚ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŒºåˆ«æ¦‚è§ˆ"&gt;â­ &lt;strong&gt;æ ¸å¿ƒåŒºåˆ«æ¦‚è§ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Component&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Bean&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨å¯¹è±¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»ï¼ˆClassï¼‰&lt;/td&gt;
&lt;td&gt;æ–¹æ³•ï¼ˆMethodï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨å†Œæœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ç±»è·¯å¾„æ‰«æè‡ªåŠ¨è£…é…&lt;/td&gt;
&lt;td&gt;é€šè¿‡é…ç½®ç±»æ–¹æ³•æ˜¾å¼å®šä¹‰ Bean å®ä¾‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®€å•ç›´æ¥ï¼Œé€‚åˆå›ºå®šé…ç½®&lt;/td&gt;
&lt;td&gt;é«˜çµæ´»æ€§ï¼Œæ”¯æŒåŠ¨æ€é€»è¾‘å’Œæ¡ä»¶åŒ–åˆ›å»º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨å†…éƒ¨è‡ªå®šä¹‰ç»„ä»¶ï¼ˆå¦‚ Serviceã€Controllerï¼‰&lt;/td&gt;
&lt;td&gt;ç¬¬ä¸‰æ–¹åº“é›†æˆã€å¤æ‚åˆå§‹åŒ–é€»è¾‘ã€æ¡ä»¶åŒ– Bean&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–æ³¨å…¥æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨æ³¨å…¥ï¼ˆ&lt;code&gt;@Autowired&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;æ–¹æ³•å†…æ‰‹åŠ¨è°ƒç”¨å…¶ä»– Bean æˆ–é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦æ”¯æŒç¬¬ä¸‰æ–¹åº“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ— æ³•ä¿®æ”¹æºç æ·»åŠ æ³¨è§£&lt;/td&gt;
&lt;td&gt;âœ… å”¯ä¸€è§£å†³æ–¹æ¡ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä½œç”¨å¯¹è±¡ä¸æ³¨å†Œæœºåˆ¶"&gt;ğŸ” &lt;strong&gt;ä½œç”¨å¯¹è±¡ä¸æ³¨å†Œæœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;@Component&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨å¯¹è±¡&lt;/strong&gt;ï¼š&lt;strong&gt;ç±»çº§åˆ«&lt;/strong&gt;çš„æ³¨è§£ï¼Œæ ‡æ³¨åœ¨ç±»å®šä¹‰ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œæœºåˆ¶&lt;/strong&gt;ï¼šä¾èµ–&lt;strong&gt;ç±»è·¯å¾„æ‰«æ&lt;/strong&gt;ï¼ˆ&lt;code&gt;@ComponentScan&lt;/code&gt;ï¼‰ï¼ŒSpring è‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºå•ä¾‹ Beanã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service // æ´¾ç”Ÿè‡ª @Component
public class UserService {
// ä¸šåŠ¡é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Bean&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨å¯¹è±¡&lt;/strong&gt;ï¼š&lt;strong&gt;æ–¹æ³•çº§åˆ«&lt;/strong&gt;çš„æ³¨è§£ï¼Œæ ‡æ³¨åœ¨è¿”å›å¯¹è±¡çš„æ–¹æ³•ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œæœºåˆ¶&lt;/strong&gt;ï¼šéœ€åœ¨ &lt;strong&gt;&lt;code&gt;@Configuration&lt;/code&gt; é…ç½®ç±»&lt;/strong&gt;ä¸­æ˜¾å¼å®šä¹‰ï¼Œæ–¹æ³•ä½“åŒ…å« Bean çš„åˆ›å»ºé€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean
public ThirdPartyLib thirdPartyLib() {
return new ThirdPartyLib(); // æ‰‹åŠ¨æ§åˆ¶å®ä¾‹åŒ–
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-çµæ´»æ€§ä¸æ§åˆ¶ç²’åº¦"&gt;ğŸ› ï¸ &lt;strong&gt;çµæ´»æ€§ä¸æ§åˆ¶ç²’åº¦&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;èƒ½åŠ›&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Component&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Bean&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€é€»è¾‘&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒç®€å•æ„é€ ï¼Œæ— æ³•åµŒå…¥æ¡ä»¶åˆ¤æ–­&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒåˆ†æ”¯é€»è¾‘ï¼ˆå¦‚æ ¹æ®å‚æ•°åˆ›å»ºä¸åŒå®ç°ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸæ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ– &lt;code&gt;@PostConstruct&lt;/code&gt;/&lt;code&gt;@PreDestroy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… ç›´æ¥é€šè¿‡ &lt;code&gt;initMethod&lt;/code&gt;/&lt;code&gt;destroyMethod&lt;/code&gt; å±æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨åŸŸå®šåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;@Scope&lt;/code&gt; æ³¨è§£æŒ‡å®š&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ &lt;code&gt;@Scope&lt;/code&gt;ï¼Œä¸”å¯åŠ¨æ€æŒ‡å®šä½œç”¨åŸŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–å…¶ä»– Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨æ³¨å…¥ï¼ˆ&lt;code&gt;@Autowired&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… æ–¹æ³•å‚æ•°ç”± Spring è‡ªåŠ¨æ³¨å…¥ï¼ˆéšå¼ä¾èµ–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯å¯¹æ¯”&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;@Component å±€é™æ€§&lt;/strong&gt;ï¼šæ— æ³•å®ç°åŠ¨æ€ Bean åˆ›å»ºã€‚
&lt;pre tabindex="0"&gt;&lt;code&gt;// é”™è¯¯ç¤ºä¾‹ï¼š@Component æ— æ³•åµŒå…¥æ¡ä»¶é€»è¾‘
@Component
public class DynamicService {
// æ— æ³•æ ¹æ®çŠ¶æ€è¿”å›ä¸åŒå®ä¾‹ï¼
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Bean çš„çµæ´»æ€§&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class DynamicConfig {
@Bean
@Scope(&amp;#34;prototype&amp;#34;)
public Service selectService(int status) {
switch (status) {
case 1: return new ServiceImpl1();
case 2: return new ServiceImpl2();
default: return new DefaultService();
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯åˆ†æ"&gt;ğŸ§© &lt;strong&gt;é€‚ç”¨åœºæ™¯åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;@Component çš„æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨å†…éƒ¨ç»„ä»¶&lt;/strong&gt;ï¼šå¦‚ä¸šåŠ¡å±‚ Serviceã€æ•°æ®å±‚ Repositoryã€æ§åˆ¶å±‚ Controllerã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–é…ç½®&lt;/strong&gt;ï¼šé…åˆ &lt;code&gt;@ComponentScan&lt;/code&gt; è‡ªåŠ¨è£…é…ï¼Œå‡å°‘æ ·æ¿ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼š&lt;strong&gt;æ— æ³•ç”¨äºç¬¬ä¸‰æ–¹åº“&lt;/strong&gt;ï¼ˆå› æ— æ³•ä¿®æ”¹æºç æ·»åŠ æ³¨è§£ï¼‰&lt;a class="link" href="@ref" &gt;1,3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Bean çš„æ ¸å¿ƒåœºæ™¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é›†æˆç¬¬ä¸‰æ–¹åº“ï¼šå°†å¤–éƒ¨ç±»ï¼ˆå¦‚æ•°æ®åº“é©±åŠ¨ã€å·¥å…·ç±»ï¼‰æ³¨å†Œä¸º Beanã€‚
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public RestTemplate restTemplate() {
return new RestTemplate(); // ç¬¬ä¸‰æ–¹ RestTemplate
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åˆå§‹åŒ–&lt;/strong&gt;ï¼šéœ€è°ƒç”¨å…¶ä»–æ–¹æ³•ã€è®¾ç½®å±æ€§æˆ–æ‰§è¡Œé¢„å¤„ç†çš„ Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶åŒ–è£…é…&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;@Conditional&lt;/code&gt; å®ç°æŒ‰éœ€åˆ›å»º Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£ XML é…ç½®&lt;/strong&gt;ï¼šæ˜¾å¼å®šä¹‰ Bean æ›¿ä»£ä¼ ç»Ÿ &lt;code&gt;&amp;lt;bean&amp;gt;&lt;/code&gt; æ ‡ç­¾&lt;a class="link" href="@ref" &gt;9,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æŠ€æœ¯ç»†èŠ‚å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;æŠ€æœ¯ç»†èŠ‚å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Component&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Bean&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean å‘½å&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤ç±»åé¦–å­—æ¯å°å†™ï¼Œæˆ–é€šè¿‡ &lt;code&gt;value&lt;/code&gt; æŒ‡å®š&lt;/td&gt;
&lt;td&gt;é»˜è®¤æ–¹æ³•åä¸º Bean IDï¼Œæˆ–é€šè¿‡ &lt;code&gt;name&lt;/code&gt; æŒ‡å®š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–å…¶ä»– Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡å­—æ®µ/æ„é€ å™¨è‡ªåŠ¨æ³¨å…¥&lt;/td&gt;
&lt;td&gt;é€šè¿‡æ–¹æ³•å‚æ•°æ³¨å…¥ï¼ˆSpring è‡ªåŠ¨ä¼ é€’ä¾èµ–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•ä¾‹è¡Œä¸º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤å•ä¾‹ï¼Œå¯é€šè¿‡ &lt;code&gt;@Scope&lt;/code&gt; ä¿®æ”¹&lt;/td&gt;
&lt;td&gt;åŒå·¦ï¼Œä½†æ–¹æ³•å¤šæ¬¡è°ƒç”¨è¿”å›åŒä¸€å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸é…ç½®ç±»å…³ç³»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— éœ€ &lt;code&gt;@Configuration&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»å®šä¹‰åœ¨ &lt;code&gt;@Configuration&lt;/code&gt; ç±»ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å¦‚ä½•é€‰æ‹©"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ğŸ‘‰ ä¼˜å…ˆç”¨ &lt;code&gt;@Component&lt;/code&gt;&lt;/strong&gt;ï¼š
é€‚ç”¨äºåº”ç”¨å†…éƒ¨ã€æ— éœ€å¤æ‚åˆå§‹åŒ–çš„ç»„ä»¶ï¼ˆå¦‚ Serviceã€DAOï¼‰ï¼Œåˆ©ç”¨è‡ªåŠ¨æ‰«æç®€åŒ–å¼€å‘&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;**ğŸ‘‰ å¿…é¡»ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @Bean
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;**ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é›†æˆ&lt;strong&gt;æ— æ³•ä¿®æ”¹æºç çš„ç¬¬ä¸‰æ–¹åº“&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;åŠ¨æ€åˆ›å»º Bean&lt;/strong&gt;ï¼ˆå¦‚æ¡ä»¶åˆ†æ”¯ã€è¿è¡Œæ—¶å‚æ•°ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è¦æ±‚&lt;strong&gt;ç²¾ç»†æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼ˆå¦‚è‡ªå®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯é€»è¾‘ï¼‰&lt;a class="link" href="@ref" &gt;2,9,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®æç¤º&lt;/strong&gt;ï¼šä¸¤è€…å¯å…±å­˜ï¼ä¾‹å¦‚ï¼Œåœ¨ &lt;code&gt;@Configuration&lt;/code&gt; ç±»ä¸­åŒæ—¶ä½¿ç”¨ &lt;code&gt;@ComponentScan&lt;/code&gt;ï¼ˆæ‰«æå†…éƒ¨ç»„ä»¶ï¼‰å’Œ &lt;code&gt;@Bean&lt;/code&gt;ï¼ˆé›†æˆå¤–éƒ¨åº“ï¼‰ï¼Œå…¼é¡¾ç®€æ´æ€§ä¸çµæ´»æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="configuration"&gt;@Configuration
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œ&lt;strong&gt;@Configuration æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ @Component&lt;/strong&gt;ï¼Œä½†å®ƒåœ¨è®¾è®¡ç›®çš„ã€å·¥ä½œæœºåˆ¶å’Œä½¿ç”¨åœºæ™¯ä¸Šå­˜åœ¨å…³é”®å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ç»§æ‰¿å…³ç³»æŠ€æœ¯å±‚é¢çš„ç‰¹æ®ŠåŒ–"&gt;ğŸ” &lt;strong&gt;ç»§æ‰¿å…³ç³»ï¼šæŠ€æœ¯å±‚é¢çš„â€œç‰¹æ®ŠåŒ–â€&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ³¨è§£çš„å…ƒæ³¨è§£å…³ç³»&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Configuration&lt;/code&gt; çš„æºç å®šä¹‰ä¸­&lt;strong&gt;ç›´æ¥ä½¿ç”¨äº† &lt;code&gt;@Component&lt;/code&gt; ä½œä¸ºå…ƒæ³¨è§£&lt;/strong&gt;ï¼Œè¿™æ„å‘³ç€ä»æŠ€æœ¯å±‚é¢çœ‹ï¼Œ&lt;code&gt;@Configuration&lt;/code&gt; æ˜¯ &lt;code&gt;@Component&lt;/code&gt; çš„ä¸€ä¸ª&lt;strong&gt;æ´¾ç”Ÿæ³¨è§£&lt;/strong&gt;ï¼ˆç‰¹åŒ–ç‰ˆæœ¬ï¼‰&lt;a class="link" href="@ref" &gt;3,5,8&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;å› æ­¤ï¼ŒSpring çš„ç»„ä»¶æ‰«æï¼ˆ&lt;code&gt;@ComponentScan&lt;/code&gt;ï¼‰ä¼š&lt;strong&gt;åŒæ—¶å¤„ç†&lt;/strong&gt;è¢« &lt;code&gt;@Component&lt;/code&gt; å’Œ &lt;code&gt;@Configuration&lt;/code&gt; æ ‡è®°çš„ç±»ï¼Œå°†å®ƒä»¬çº³å…¥å®¹å™¨ç®¡ç†&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå·®å¼‚ä¸åªæ˜¯ç‰¹æ®Šæ›´æ˜¯å¢å¼º"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒå·®å¼‚ï¼šä¸åªæ˜¯â€œç‰¹æ®Šâ€ï¼Œæ›´æ˜¯â€œå¢å¼ºâ€&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ç»§æ‰¿è‡ª &lt;code&gt;@Component&lt;/code&gt;ï¼Œä½† &lt;code&gt;@Configuration&lt;/code&gt; é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°äº†&lt;strong&gt;åŠŸèƒ½å¼ºåŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Configuration&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Component&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç†æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ï¼Œæ‹¦æˆª &lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³•è°ƒç”¨&lt;/td&gt;
&lt;td&gt;âŒ æ— ä»£ç†ï¼Œ&lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³•æ¯æ¬¡è°ƒç”¨å‡æ‰§è¡Œå®é™…ä»£ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•ä¾‹ä¿è¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… åŒä¸€ &lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³•å¤šæ¬¡è°ƒç”¨è¿”å›&lt;strong&gt;åŒä¸€å®ä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ å¤šæ¬¡è°ƒç”¨åŒä¸€æ–¹æ³•è¿”å›&lt;strong&gt;ä¸åŒå®ä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…éƒ¨ä¾èµ–å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ–¹æ³•é—´è°ƒç”¨è‡ªåŠ¨æ³¨å…¥å®¹å™¨ä¸­å·²å­˜åœ¨çš„ Bean&lt;/td&gt;
&lt;td&gt;âŒ æ–¹æ³•é—´è°ƒç”¨ç›´æ¥æ‰§è¡Œï¼Œå¯¼è‡´é‡å¤åˆ›å»ºå¯¹è±¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ä¸­å¼é…ç½®ç®¡ç†ï¼ˆæ›¿ä»£ XMLï¼‰&lt;/td&gt;
&lt;td&gt;é€šç”¨ç»„ä»¶æ ‡è®°ï¼ˆå¦‚ Serviceã€Controllerï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="ä»£ç†æœºåˆ¶ç¤ºä¾‹"&gt;&lt;strong&gt;ä»£ç†æœºåˆ¶ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// ä½¿ç”¨ @Configurationï¼ˆä»£ç†ç”Ÿæ•ˆï¼‰
@Configuration
public class ConfigA {
@Bean
public Service service() {
return new Service(dependency()); // è°ƒç”¨ dependency() è¿”å›å®¹å™¨ä¸­çš„å•ä¾‹
}
@Bean
public Dependency dependency() {
return new Dependency();
}
}
// ä½¿ç”¨ @Componentï¼ˆæ— ä»£ç†ï¼‰
@Component
public class ConfigB {
@Bean
public Service service() {
return new Service(dependency()); // æ¯æ¬¡è°ƒç”¨ dependency() éƒ½ new æ–°å¯¹è±¡ï¼
}
@Bean
public Dependency dependency() {
return new Dependency();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConfigA&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;code&gt;service()&lt;/code&gt; è°ƒç”¨ &lt;code&gt;dependency()&lt;/code&gt; æ—¶ï¼ŒSpring ä¼š&lt;strong&gt;è¿”å›å®¹å™¨ä¸­å·²å­˜åœ¨çš„ &lt;code&gt;Dependency&lt;/code&gt; å•ä¾‹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConfigB&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;code&gt;service()&lt;/code&gt; è°ƒç”¨ &lt;code&gt;dependency()&lt;/code&gt; ä¼š&lt;strong&gt;ç›´æ¥æ‰§è¡Œæ–¹æ³•ä½“&lt;/strong&gt;ï¼Œæ¯æ¬¡åˆ›å»ºæ–°çš„ &lt;code&gt;Dependency&lt;/code&gt; å®ä¾‹ï¼Œç ´åå•ä¾‹&lt;a class="link" href="@ref" &gt;3,5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨åœºæ™¯ä½•æ—¶ç”¨å“ªç§æ³¨è§£"&gt;ğŸ¯ &lt;strong&gt;ä½¿ç”¨åœºæ™¯ï¼šä½•æ—¶ç”¨å“ªç§æ³¨è§£ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆç”¨ &lt;code&gt;@Configuration&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;é›†ä¸­ç®¡ç†å¤šä¸ª &lt;code&gt;@Bean&lt;/code&gt; å®šä¹‰&lt;/strong&gt;ï¼ˆå¦‚æ•°æ®åº“é…ç½®ã€ç¬¬ä¸‰æ–¹åº“é›†æˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ç¡®ä¿ &lt;strong&gt;&lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³•é—´çš„ä¾èµ–è°ƒç”¨æ»¡è¶³å•ä¾‹è¦æ±‚&lt;/strong&gt;ï¼ˆå¦‚å…±äº«æ•°æ®åº“è¿æ¥æ± ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ç»“åˆ &lt;strong&gt;&lt;code&gt;@Import&lt;/code&gt;ã€&lt;code&gt;@Conditional&lt;/code&gt; ç­‰é«˜çº§é…ç½®åŠŸèƒ½&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆç”¨ &lt;code&gt;@Component&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ ‡è®°&lt;strong&gt;æ™®é€šä¸šåŠ¡ç»„ä»¶&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@Service&lt;/code&gt;ã€&lt;code&gt;@Controller&lt;/code&gt;ï¼‰ï¼Œæ— éœ€å¤æ‚åˆå§‹åŒ–é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;ä»…éœ€&lt;strong&gt;è¢«æ‰«ææ³¨å†Œä¸º Bean&lt;/strong&gt;ï¼Œä¸åŒ…å« &lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³•&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é™åˆ¶ä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;é™åˆ¶ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;**
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
&lt;/code&gt;&lt;/pre&gt;çš„ç±»çº¦æŸ**ï¼š
&lt;ul&gt;
&lt;li&gt;ç±»&lt;strong&gt;ä¸èƒ½æ˜¯ &lt;code&gt;final&lt;/code&gt;&lt;/strong&gt;ï¼ˆéœ€æ”¯æŒ CGLIB å­ç±»ä»£ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åµŒå¥—é…ç½®ç±»å¿…é¡»å£°æ˜ä¸º &lt;strong&gt;&lt;code&gt;static&lt;/code&gt;&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;8,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¿å…æ··ç”¨ï¼š
åœ¨
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
&lt;/code&gt;&lt;/pre&gt;ç±»ä¸­å®šä¹‰
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
&lt;/code&gt;&lt;/pre&gt;æ–¹æ³•æ—¶ï¼Œéœ€
æ˜¾å¼æ³¨å…¥ä¾èµ–
ï¼ˆè€Œéæ–¹æ³•è°ƒç”¨ï¼‰ä»¥ä¿è¯å•ä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ConfigC {
@Autowired private Dependency dependency; // é€šè¿‡æ³¨å…¥è·å–å•ä¾‹
@Bean
public Service service() {
return new Service(dependency); // æ­£ç¡®ï¼šä½¿ç”¨æ³¨å…¥çš„å®ä¾‹
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ç‰¹æ®Šä½†ä¸ç®€å•"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šç‰¹æ®Šä½†ä¸ç®€å•&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ˜¯ç‰¹æ®ŠåŒ–çš„ &lt;code&gt;@Component&lt;/code&gt;&lt;/strong&gt;ï¼šä»æ³¨è§£ç»§æ‰¿å’Œæ‰«ææœºåˆ¶çœ‹ï¼Œ&lt;code&gt;@Configuration&lt;/code&gt; å±äº &lt;code&gt;@Component&lt;/code&gt; çš„ç‰¹ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ˜¯åŠŸèƒ½å¢å¼ºç‰ˆ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;strong&gt;CGLIB ä»£ç†&lt;/strong&gt;è§£å†³äº† &lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³•è°ƒç”¨çš„å•ä¾‹ä¸€è‡´æ€§ï¼Œæˆä¸º&lt;strong&gt;é›†ä¸­å¼ Java é…ç½®çš„æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;3,9,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å®é™…å»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦å®šä¹‰ &lt;code&gt;@Bean&lt;/code&gt; æ–¹æ³• â†’ &lt;strong&gt;å¿…é€‰ &lt;code&gt;@Configuration&lt;/code&gt;&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ä»…éœ€æ ‡è®°æ™®é€šç»„ä»¶ â†’ &lt;strong&gt;ç”¨ &lt;code&gt;@Component&lt;/code&gt; æˆ–å…¶æ´¾ç”Ÿæ³¨è§£&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@Service&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="autowired--resource"&gt;@Autowired &amp;amp; @Resource
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯Springæ¡†æ¶ä¸­&lt;code&gt;@Autowired&lt;/code&gt;ä¸&lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£çš„è¯¦ç»†å¯¹æ¯”ï¼Œç»“åˆæ ¸å¿ƒå·®å¼‚ã€ä½¿ç”¨åœºæ™¯å’Œå®é™…ç¤ºä¾‹è¿›è¡Œè¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå¯¹æ¯”æ¦‚è§ˆ"&gt;ğŸ“Š &lt;strong&gt;æ ¸å¿ƒå¯¹æ¯”æ¦‚è§ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Autowired&lt;/strong&gt; (Spring æä¾›)&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Resource&lt;/strong&gt; (JSR-250 æ ‡å‡†)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;org.springframework.beans.factory.annotation&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,3,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;javax.annotation&lt;/code&gt; (Java EE/Jakarta EE) &lt;a class="link" href="@ref" &gt;1,4,12&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤æ³¨å…¥ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æŒ‰ç±»å‹ (byType)&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;1,3,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æŒ‰åç§° (byName)&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;1,6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–æŸ¥æ‰¾é¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1. æŒ‰ç±»å‹ â†’ 2. æŒ‰åç§°ï¼ˆéœ€é…åˆ &lt;code&gt;@Qualifier&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1. æŒ‰åç§° â†’ 2. æŒ‰ç±»å‹ï¼ˆæœªæŒ‡å®šåç§°æ—¶ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ”¯æŒå‚æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»… &lt;code&gt;required&lt;/code&gt;ï¼ˆæ˜¯å¦å¼ºåˆ¶æ³¨å…¥ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;code&gt;name&lt;/code&gt;ã€&lt;code&gt;type&lt;/code&gt; ç­‰ 7 ä¸ªå‚æ•° &lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨å…¥æ–¹å¼æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… å­—æ®µã€æ„é€ å™¨ã€Setter æ–¹æ³•ã€å‚æ•° &lt;a class="link" href="@ref" &gt;3,11&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ„é€ å™¨æ³¨å…¥ï¼ˆä»…æ”¯æŒå­—æ®µå’Œ Setter æ–¹æ³•ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤š Bean å†²çªè§£å†³&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é…åˆ &lt;code&gt;@Qualifier(&amp;quot;beanName&amp;quot;)&lt;/code&gt; &lt;a class="link" href="@ref" &gt;1,11&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥é€šè¿‡ &lt;code&gt;name&lt;/code&gt; å±æ€§æŒ‡å®šï¼ˆä¾‹ï¼š&lt;code&gt;@Resource(name=&amp;quot;beanA&amp;quot;)&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,12&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨æ¡†æ¶å…¼å®¹æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…é™ Spring ç¯å¢ƒ &lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âœ… å…¼å®¹ Java EE/Jakarta EEï¼ˆå¦‚ Tomcatï¼‰&lt;a class="link" href="@ref" &gt;4,12&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®å·®å¼‚è¯¦è§£"&gt;ğŸ”§ &lt;strong&gt;å…³é”®å·®å¼‚è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä¾èµ–æŸ¥æ‰¾ç­–ç•¥"&gt;&lt;strong&gt;ä¾èµ–æŸ¥æ‰¾ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;@Autowired&lt;/strong&gt;
é»˜è®¤æŒ‰ç±»å‹åŒ¹é…ã€‚è‹¥å­˜åœ¨å¤šä¸ªåŒç±»å‹ Beanï¼Œéœ€ç»“åˆ &lt;code&gt;@Qualifier&lt;/code&gt; æŒ‡å®šåç§°ï¼Œå¦åˆ™æŠ›å‡º &lt;code&gt;NoUniqueBeanDefinitionException&lt;/code&gt; &lt;a class="link" href="@ref" &gt;3,6,11&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
@Qualifier(&amp;#34;mysqlDataSource&amp;#34;)
private DataSource dataSource; // æ˜ç¡®æŒ‡å®šæ³¨å…¥åä¸º mysqlDataSource çš„ Bean
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;@Resource&lt;/strong&gt;
é»˜è®¤æŒ‰å­—æ®µ/æ–¹æ³•ååŒ¹é…ã€‚è‹¥æœªåŒ¹é…åˆ°åç§°ï¼Œåˆ™å›é€€åˆ°æŒ‰ç±»å‹åŒ¹é…ã€‚æ”¯æŒé€šè¿‡ &lt;code&gt;name&lt;/code&gt; æˆ– &lt;code&gt;type&lt;/code&gt; å±æ€§æ˜¾å¼æŒ‡å®šç­–ç•¥ &lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Resource(name = &amp;#34;oracleDataSource&amp;#34;)
private DataSource dataSource; // ç›´æ¥æŒ‰åç§°æ³¨å…¥
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ³¨å…¥æ–¹å¼æ”¯æŒ"&gt;&lt;strong&gt;æ³¨å…¥æ–¹å¼æ”¯æŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;@Autowired&lt;/strong&gt; æ”¯æŒæ›´çµæ´»çš„æ³¨å…¥ä½ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;æ„é€ å™¨æ³¨å…¥
ï¼ˆæ¨èç”¨äºå¼ºåˆ¶ä¾èµ–ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class OrderService {
private final PaymentService paymentService;
@Autowired // Spring 4.3+ å¯çœç•¥
public OrderService(PaymentService paymentService) {
this.paymentService = paymentService;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Setter æ–¹æ³•æ³¨å…¥
ï¼ˆå¯é€‰ä¾èµ–ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired(required = false)
public void setLogger(Logger logger) { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Resource&lt;/strong&gt; &lt;strong&gt;ä¸æ”¯æŒæ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼Œä»…æ”¯æŒå­—æ®µå’Œ Setter æ–¹æ³• &lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Resource
public void setPaymentService(PaymentService ps) { ... } // Setter æ–¹æ³•æ³¨å…¥
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤š-bean-å†²çªè§£å†³"&gt;&lt;strong&gt;å¤š Bean å†²çªè§£å†³&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Autowired æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;@Resource æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒæ¥å£å¤šä¸ªå®ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é…åˆ &lt;code&gt;@Qualifier&lt;/code&gt; æŒ‡å®šåç§° &lt;a class="link" href="@ref" &gt;6,11&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥é€šè¿‡ &lt;code&gt;name&lt;/code&gt; å±æ€§æŒ‡å®š &lt;a class="link" href="@ref" &gt;8,12&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€æ¡ä»¶æ³¨å…¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;code&gt;@Primary&lt;/code&gt; æ ‡è®°é»˜è®¤ Bean &lt;a class="link" href="@ref" &gt;10&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ— ç›´æ¥ç­‰æ•ˆæ–¹æ¡ˆï¼Œéœ€ä¾èµ– &lt;code&gt;name&lt;/code&gt;/&lt;code&gt;type&lt;/code&gt; å±æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯é€‰ä¾èµ–ï¼ˆå…è®¸ nullï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®¾ç½® &lt;code&gt;@Autowired(required = false)&lt;/code&gt; &lt;a class="link" href="@ref" &gt;1,11&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ— åŸç”Ÿæ”¯æŒï¼Œéœ€ç»“åˆå…¶ä»–æœºåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å®é™…å¼€å‘ä¸­çš„é€‰æ‹©å»ºè®®"&gt;&lt;strong&gt;å®é™…å¼€å‘ä¸­çš„é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;âœ… ä¼˜å…ˆç”¨ @Autowired&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®åŸºäº &lt;strong&gt;Spring ç”Ÿæ€&lt;/strong&gt;ï¼ˆå¦‚ Spring Bootï¼‰&lt;a class="link" href="@ref" &gt;3,12&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;éœ€&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;å¼ºåˆ¶ä¾èµ–ï¼ˆæé«˜ä»£ç å¥å£®æ€§ï¼‰&lt;a class="link" href="@ref" &gt;11&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;éœ€é…åˆ &lt;code&gt;@Primary&lt;/code&gt;ã€&lt;code&gt;@Conditional&lt;/code&gt; ç­‰ Spring ç‰¹æ€§ &lt;a class="link" href="@ref" &gt;10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;âœ… ä¼˜å…ˆç”¨ @Resource&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;è·¨æ¡†æ¶å…¼å®¹&lt;/strong&gt;ï¼ˆå¦‚ Java EE åº”ç”¨æœåŠ¡å™¨ï¼‰&lt;a class="link" href="@ref" &gt;4,12&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ˜ç¡®éœ€&lt;strong&gt;æŒ‰åç§°æ³¨å…¥&lt;/strong&gt;ä¸”å¸Œæœ›å‡å°‘æ³¨è§£æ•°é‡ï¼ˆé¿å… &lt;code&gt;@Autowired + @Qualifier&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IDEA è¯¯æŠ¥é—®é¢˜&lt;/strong&gt;ï¼šæ³¨å…¥ MyBatis Mapper æ—¶ï¼Œ&lt;code&gt;@Resource&lt;/code&gt; ä¸ä¼šè§¦å‘ç¼–è¯‘å™¨è­¦å‘Šï¼ˆ&lt;code&gt;@Autowired&lt;/code&gt; å¯èƒ½è¯¯æŠ¥ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“æ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šæ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring ä¸“æœ‰é¡¹ç›®&lt;/strong&gt; â†’ é¦–é€‰ &lt;strong&gt;&lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt;ï¼ŒåŠŸèƒ½ä¸°å¯Œä¸”ä¸å…¶ä»– Spring ç‰¹æ€§ï¼ˆå¦‚ &lt;code&gt;@Qualifier&lt;/code&gt;ã€&lt;code&gt;@Primary&lt;/code&gt;ï¼‰æ— ç¼é›†æˆ&lt;a class="link" href="@ref" &gt;3,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ¡†æ¶å…¼å®¹/æŒ‰åæ³¨å…¥&lt;/strong&gt; â†’ é¦–é€‰ &lt;strong&gt;&lt;code&gt;@Resource&lt;/code&gt;&lt;/strong&gt;ï¼Œå‡å°‘é…ç½®ä¸”é¿å…ç¯å¢ƒè€¦åˆ&lt;a class="link" href="@ref" &gt;4,12&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt; â†’ ä»… &lt;code&gt;@Autowired&lt;/code&gt; æ”¯æŒï¼Œé€‚ç”¨äºå¼ºä¾èµ–åœºæ™¯&lt;a class="link" href="@ref" &gt;3,11&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸‰æ–¹åº“é›†æˆ&lt;/strong&gt; â†’ &lt;code&gt;@Resource&lt;/code&gt; æ›´ç®€æ´ï¼ˆå¦‚æ³¨å…¥ &lt;code&gt;RestTemplate&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;12&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»éªŒæ³•åˆ™&lt;/strong&gt;ï¼š
è‹¥é¡¹ç›®æ·±åº¦ä¾èµ– Springï¼Œç”¨ &lt;code&gt;@Autowired&lt;/code&gt;ï¼›è‹¥éœ€å‡å°‘æ¡†æ¶ç»‘å®šæˆ–ç®€åŒ–æŒ‰åæ³¨å…¥ï¼Œç”¨ &lt;code&gt;@Resource&lt;/code&gt;ã€‚ä¸¤è€…å‡å¯æ··åˆä½¿ç”¨ï¼Œä½†åŒä¸€å­—æ®µé¿å…æ··ç”¨æ³¨è§£ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="autowired-æ³¨å…¥æ–¹å¼"&gt;@Autowired æ³¨å…¥æ–¹å¼
&lt;/h2&gt;&lt;p&gt;åœ¨Springæ¡†æ¶ä¸­ï¼Œ&lt;code&gt;@Autowired&lt;/code&gt;æ³¨è§£æ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œæ¯ç§æ–¹å¼åœ¨å®ç°æœºåˆ¶ã€é€‚ç”¨åœºæ™¯åŠä¼˜ç¼ºç‚¹ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»æŠ€æœ¯å®ç°ã€è®¾è®¡åŸåˆ™å’Œå®é™…åº”ç”¨ç»´åº¦è¿›è¡Œè¯¦ç»†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰ç§æ³¨å…¥æ–¹å¼çš„æ ¸å¿ƒå¯¹æ¯”"&gt;ğŸ”§ &lt;strong&gt;ä¸‰ç§æ³¨å…¥æ–¹å¼çš„æ ¸å¿ƒå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å±æ€§æ³¨å…¥&lt;/strong&gt; (Field Injection)&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Setteræ³¨å…¥&lt;/strong&gt; (Setter Injection)&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt; (Constructor Injection)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯­æ³•ä½ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­—æ®µå£°æ˜å¤„ï¼ˆå¦‚ &lt;code&gt;@Autowired private Service service;&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;Setteræ–¹æ³•ä¸Šï¼ˆå¦‚ &lt;code&gt;@Autowired public void setService(Service s){...}&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;æ„é€ æ–¹æ³•ä¸Šï¼ˆå¯çœç•¥æ³¨è§£ï¼ŒSpring 4.3+æ”¯æŒï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–åˆå§‹åŒ–æ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯¹è±¡å®ä¾‹åŒ–&lt;strong&gt;å&lt;/strong&gt;é€šè¿‡åå°„æ³¨å…¥&lt;/td&gt;
&lt;td&gt;å¯¹è±¡å®ä¾‹åŒ–åè°ƒç”¨Setteræ–¹æ³•æ³¨å…¥&lt;/td&gt;
&lt;td&gt;å¯¹è±¡&lt;strong&gt;å®ä¾‹åŒ–æ—¶&lt;/strong&gt;é€šè¿‡æ„é€ å‚æ•°æ³¨å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸å¯å˜æ€§æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ— æ³•å£°æ˜&lt;code&gt;final&lt;/code&gt;å­—æ®µ&lt;/td&gt;
&lt;td&gt;âŒ æ— æ³•å£°æ˜&lt;code&gt;final&lt;/code&gt;å­—æ®µ&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ&lt;code&gt;final&lt;/code&gt;å­—æ®µï¼ˆä¾èµ–ä¸å¯å˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æœ€ç®€æ´ï¼ˆå‡å°‘æ ·æ¿ä»£ç ï¼‰&lt;/td&gt;
&lt;td&gt;âš ï¸ éœ€é¢å¤–Setteræ–¹æ³•&lt;/td&gt;
&lt;td&gt;âš ï¸ æ„é€ æ–¹æ³•å¯èƒ½å†—é•¿ï¼ˆå¯ç”¨Lombokçš„&lt;code&gt;@RequiredArgsConstructor&lt;/code&gt;ç®€åŒ–&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NPEé£é™©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âš ï¸ æ„é€ å‡½æ•°ä¸­è®¿é—®ä¾èµ–ä¼šæŠ›ç©ºæŒ‡é’ˆï¼ˆä¾èµ–æœªåˆå§‹åŒ–ï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âš ï¸ åˆå§‹åŒ–é€»è¾‘ä¸­è®¿é—®ä¾èµ–å¯èƒ½ä¸ºç©º&lt;/td&gt;
&lt;td&gt;âœ… ä¾èµ–åœ¨å¯¹è±¡åˆ›å»ºå‰å®Œæˆæ³¨å…¥ï¼Œæ— NPEé£é™©&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•å…ƒæµ‹è¯•å‹å¥½åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ éœ€åå°„æˆ–Springå®¹å™¨ï¼ˆå¦‚&lt;code&gt;ReflectionTestUtils&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âœ… å¯ç›´æ¥è°ƒç”¨Setteræ³¨å…¥Mock&lt;/td&gt;
&lt;td&gt;âœ… ç›´æ¥é€šè¿‡æ„é€ å‚æ•°ä¼ å…¥Mockå¯¹è±¡&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¾ªç¯ä¾èµ–å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… Springä¸‰çº§ç¼“å­˜æ”¯æŒï¼ˆè‡ªåŠ¨è§£å†³ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âœ… åŒå±æ€§æ³¨å…¥&lt;/td&gt;
&lt;td&gt;âŒ ç›´æ¥æŠ¥&lt;code&gt;BeanCurrentlyInCreationException&lt;/code&gt;&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡åŸåˆ™éµå¾ª&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ éšè—ä¾èµ–å…³ç³»ï¼Œæ˜“è¿åå•ä¸€èŒè´£åŸåˆ™&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âš ï¸ ä¾èµ–å¯è§æ€§ä¸€èˆ¬&lt;/td&gt;
&lt;td&gt;âœ… æ˜¾å¼å£°æ˜ä¾èµ–ï¼Œå¼ºåˆ¶å…³æ³¨ç±»èŒè´£è¾¹ç•Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å„æ³¨å…¥æ–¹å¼çš„é£é™©ä¸é€‚ç”¨åœºæ™¯"&gt;âš ï¸ &lt;strong&gt;å„æ³¨å…¥æ–¹å¼çš„é£é™©ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å±æ€§æ³¨å…¥çš„éšæ‚£&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç©ºæŒ‡é’ˆé£é™©&lt;/strong&gt;ï¼šè‹¥åœ¨æ„é€ å‡½æ•°æˆ–&lt;code&gt;@PostConstruct&lt;/code&gt;æ–¹æ³•ä¸­ä½¿ç”¨ä¾èµ–å­—æ®µï¼Œå› æ³¨å…¥æœªå®Œæˆè€ŒæŠ›NPE&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•å¤æ‚æ€§&lt;/strong&gt;ï¼šè„±ç¦»Springå®¹å™¨æ—¶éœ€æ‰‹åŠ¨åå°„æ³¨å…¥ï¼Œå¢åŠ æµ‹è¯•ä»£ç é‡&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¿«é€ŸåŸå‹å¼€å‘æˆ–éæ ¸å¿ƒå·¥å…·ç±»ï¼ˆä½†å®˜æ–¹å·²ä¸æ¨è&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Setteræ³¨å…¥çš„çµæ´»æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°ä¾èµ–&lt;/strong&gt;ï¼šå…è®¸è¿è¡Œæ—¶æ›¿æ¢ä¾èµ–ï¼ˆä½†å¯èƒ½ç ´åä¸å˜æ€§ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯é€‰ä¾èµ–æ”¯æŒ&lt;/strong&gt;ï¼šç»“åˆ&lt;code&gt;@Autowired(required = false)&lt;/code&gt;å®ç°&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¯é€‰ä¾èµ–æˆ–éœ€åŠ¨æ€é…ç½®çš„ç»„ä»¶ï¼ˆå¦‚æ’ä»¶å¼æ¶æ„ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥çš„ä¼˜åŠ¿&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¸å˜æ€§ä¿éšœ&lt;/strong&gt;ï¼š&lt;code&gt;final&lt;/code&gt;å­—æ®µç¡®ä¿ä¾èµ–ä¸å¯å˜ï¼Œé¿å…æ„å¤–ä¿®æ”¹&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–å®Œæ•´æ€§æ£€æŸ¥&lt;/strong&gt;ï¼šæ„é€ æ—¶æ ¡éªŒä¾èµ–éç©ºï¼Œé¿å…éƒ¨åˆ†åˆå§‹åŒ–çŠ¶æ€&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Springå®˜æ–¹æ¨è&lt;/strong&gt;ï¼šæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;strong&gt;æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶&lt;/strong&gt;ã€&lt;strong&gt;å¼ºä¾èµ–å…³ç³»&lt;/strong&gt;ï¼ˆå¦‚Serviceã€Controllerï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç‰¹æ®Šåœºæ™¯å¤„ç†"&gt;ğŸ› ï¸ &lt;strong&gt;ç‰¹æ®Šåœºæ™¯å¤„ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é™æ€å­—æ®µæ³¨å…¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼š&lt;code&gt;@Autowired&lt;/code&gt;æ— æ³•ç›´æ¥æ³¨å…¥é™æ€å­—æ®µï¼ˆæ³¨å…¥å€¼ä¸º&lt;code&gt;null&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³æ–¹æ¡ˆï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class UserService {
private static RoleService roleService;
// é€šè¿‡éé™æ€Setter/æ„é€ å™¨æ³¨å…¥é™æ€å­—æ®µ
@Autowired
public void setRoleService(RoleService roleService) {
UserService.roleService = roleService; // èµ‹å€¼ç»™é™æ€å­—æ®µ
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥çš„ç®€åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Lombokåº”ç”¨ï¼šè‡ªåŠ¨ç”Ÿæˆå«
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
&lt;/code&gt;&lt;/pre&gt;çš„æ„é€ å™¨
1,4ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
@RequiredArgsConstructor // ä¸ºfinalå­—æ®µç”Ÿæˆæ„é€ å™¨
public class OrderService {
private final PaymentService paymentService;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“é€‰æ‹©ç­–ç•¥"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šé€‰æ‹©ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶ï¼ˆå¦‚Serviceï¼‰&lt;/td&gt;
&lt;td&gt;âœ… &lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿è¯ä¾èµ–ä¸å¯å˜ã€é¿å…NPEã€æå‡å¯æµ‹è¯•æ€§&lt;a class="link" href="@ref" &gt;4,5,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯é€‰ä¾èµ–æˆ–é…ç½®ç±»&lt;/td&gt;
&lt;td&gt;âš ï¸ &lt;strong&gt;Setteræ³¨å…¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒåŠ¨æ€æ›´æ–°å’Œ&lt;code&gt;required=false&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¿«é€ŸåŸå‹/å·¥å…·ç±»&lt;/td&gt;
&lt;td&gt;âŒ å±æ€§æ³¨å…¥ï¼ˆä¸æ¨èï¼‰&lt;/td&gt;
&lt;td&gt;ä»…ä¸´æ—¶ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒåº”é¿å…&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆæ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼šå°¤å…¶å¯¹å¼ºä¾èµ–ï¼Œç”¨Lombokå‡å°‘ä»£ç é‡&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ…ç”¨å±æ€§æ³¨å…¥&lt;/strong&gt;ï¼šä»…åœ¨ä¸å½±å“æ ¸å¿ƒé€»è¾‘ä¸”æ— æµ‹è¯•éœ€æ±‚æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¾ªç¯ä¾èµ–é‡æ„&lt;/strong&gt;ï¼šå¦‚é‡æ„é€ å™¨å¾ªç¯ä¾èµ–ï¼Œéœ€é€šè¿‡ä»£ç è®¾è®¡è§£è€¦ï¼ˆå¦‚æ‹†åˆ†èŒè´£ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="bean-ç”Ÿå‘½å‘¨æœŸ"&gt;Bean ç”Ÿå‘½å‘¨æœŸ
&lt;/h2&gt;&lt;p&gt;Spring Beançš„ç”Ÿå‘½å‘¨æœŸæ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œæ¶µç›–Beanä»åˆ›å»ºåˆ°é”€æ¯çš„å…¨è¿‡ç¨‹ã€‚ä¸‹é¢ç»“åˆå…³é”®é˜¶æ®µå’Œæ‰©å±•ç‚¹è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿå‘½å‘¨æœŸæ ¸å¿ƒé˜¶æ®µ"&gt;ğŸŒ± &lt;strong&gt;ç”Ÿå‘½å‘¨æœŸæ ¸å¿ƒé˜¶æ®µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®ä¾‹åŒ–instantiation"&gt;&lt;strong&gt;å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;ï¼šSpringå®¹å™¨é€šè¿‡åå°„è°ƒç”¨Beançš„æ„é€ æ–¹æ³•åˆ›å»ºå®ä¾‹ï¼Œæ­¤æ—¶Beanæ˜¯â€œåŠæˆå“â€ï¼Œå±æ€§æœªèµ‹å€¼&lt;a class="link" href="@ref" &gt;1,4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æºç å…¥å£&lt;/strong&gt;ï¼š&lt;code&gt;AbstractAutowireCapableBeanFactory#doCreateBean()&lt;/code&gt; ä¸­çš„ &lt;code&gt;createBeanInstance()&lt;/code&gt; æ–¹æ³•&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å±æ€§èµ‹å€¼population"&gt;&lt;strong&gt;å±æ€§èµ‹å€¼ï¼ˆPopulationï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä¾èµ–æ³¨å…¥ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;@Autowired&lt;/code&gt;ã€&lt;code&gt;@Value&lt;/code&gt; æˆ–XMLé…ç½®æ³¨å…¥å±æ€§å’Œä¾èµ–å¯¹è±¡&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¾ªç¯ä¾èµ–è§£å†³ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸‰çº§ç¼“å­˜æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;singletonFactories&lt;/code&gt;ï¼ˆä¸‰çº§ï¼‰ï¼šå­˜å‚¨æœªåˆå§‹åŒ–çš„Beanå·¥å‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;earlySingletonObjects&lt;/code&gt;ï¼ˆäºŒçº§ï¼‰ï¼šå­˜å‚¨æå‰æš´éœ²çš„Beanå¼•ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;singletonObjects&lt;/code&gt;ï¼ˆä¸€çº§ï¼‰ï¼šå­˜å‚¨å®Œæ•´çš„Bean&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµç¨‹ç¤ºä¾‹&lt;/strong&gt;ï¼šè‹¥Bean Aä¾èµ–Bean Bï¼Œä¸”Bä¾èµ–Aï¼ŒSpringé€šè¿‡ä¸‰çº§ç¼“å­˜é€æ­¥è§£å†³ä¾èµ–é—­ç¯&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åˆå§‹åŒ–initialization"&gt;&lt;strong&gt;åˆå§‹åŒ–ï¼ˆInitializationï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åˆå§‹åŒ–é˜¶æ®µæ˜¯Beanç”Ÿå‘½å‘¨æœŸä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ï¼ŒåŒ…å«å¤šä¸ªæ‰©å±•ç‚¹ï¼š
1.
Awareæ¥å£å›è°ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;BeanNameAware&lt;/code&gt;ï¼šæ³¨å…¥Beançš„IDã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BeanFactoryAware&lt;/code&gt;ï¼šæ³¨å…¥BeanFactoryå®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ApplicationContextAware&lt;/code&gt;ï¼šæ³¨å…¥åº”ç”¨ä¸Šä¸‹æ–‡&lt;a class="link" href="@ref" &gt;1,4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;BeanPostProcessorå‰ç½®å¤„ç†ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;postProcessBeforeInitialization()&lt;/code&gt;ï¼šåœ¨åˆå§‹åŒ–å‰ä¿®æ”¹Beanï¼ˆå¦‚å±æ€§å¢å¼ºï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œ
ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@PostConstruct&lt;/code&gt; æ³¨è§£æ ‡è®°çš„æ–¹æ³•ï¼ˆJSR-250æ ‡å‡†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;InitializingBean#afterPropertiesSet()&lt;/code&gt; æ¥å£æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;XMLæˆ– &lt;code&gt;@Bean(initMethod = &amp;quot;init&amp;quot;)&lt;/code&gt; æŒ‡å®šçš„è‡ªå®šä¹‰æ–¹æ³•&lt;a class="link" href="@ref" &gt;1,8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;BeanPostProcessoråç½®å¤„ç†ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;postProcessAfterInitialization()&lt;/code&gt;ï¼šç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆå¦‚AOPåŠ¨æ€ä»£ç†ï¼‰&lt;a class="link" href="@ref" &gt;1,4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é”€æ¯destruction"&gt;&lt;strong&gt;é”€æ¯ï¼ˆDestructionï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®¹å™¨å…³é—­æ—¶è§¦å‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;@PreDestroy&lt;/code&gt; æ³¨è§£æ ‡è®°çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DisposableBean#destroy()&lt;/code&gt; æ¥å£æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;XMLæˆ– &lt;code&gt;@Bean(destroyMethod = &amp;quot;cleanup&amp;quot;)&lt;/code&gt; æŒ‡å®šçš„è‡ªå®šä¹‰æ–¹æ³•&lt;a class="link" href="@ref" &gt;1,7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ‰©å±•ç‚¹ä¸æœºåˆ¶"&gt;âš™ï¸ &lt;strong&gt;å…³é”®æ‰©å±•ç‚¹ä¸æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="beanpostprocessor"&gt;&lt;strong&gt;BeanPostProcessor&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåœ¨åˆå§‹åŒ–å‰åæ‹¦æˆªæ‰€æœ‰Beanï¼Œå®ç°å…¨å±€å¢å¼ºï¼ˆå¦‚AOPä»£ç†ã€äº‹åŠ¡ç®¡ç†ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åº”ç”¨&lt;/strong&gt;ï¼š&lt;code&gt;@Transactional&lt;/code&gt;ã€&lt;code&gt;@Async&lt;/code&gt; ç­‰æ³¨è§£çš„åº•å±‚æ”¯æŒ&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åˆå§‹åŒ–ä¸é”€æ¯æ–¹æ³•å¯¹æ¯”"&gt;&lt;strong&gt;åˆå§‹åŒ–ä¸é”€æ¯æ–¹æ³•å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åˆå§‹åŒ–æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é”€æ¯æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PostConstruct&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PreDestroy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æœ€é«˜ä¼˜å…ˆçº§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¥å£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;InitializingBean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DisposableBean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¬¡ä¼˜å…ˆçº§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;XML/Javaé…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;init-method&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;destroy-method&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æœ€ä½ä¼˜å…ˆçº§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="ä½œç”¨åŸŸå¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“"&gt;&lt;strong&gt;ä½œç”¨åŸŸå¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•ä¾‹ï¼ˆSingletonï¼‰&lt;/strong&gt;ï¼šç”Ÿå‘½å‘¨æœŸä¸å®¹å™¨ä¸€è‡´ï¼Œåˆå§‹åŒ–åå­˜å…¥ &lt;code&gt;singletonObjects&lt;/code&gt; ç¼“å­˜æ± &lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå‹ï¼ˆPrototypeï¼‰&lt;/strong&gt;ï¼šå®¹å™¨ä¸ç®¡ç†é”€æ¯ï¼Œåˆå§‹åŒ–åç›´æ¥äº¤ç»™è°ƒç”¨æ–¹&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"&gt;ğŸ”§ &lt;strong&gt;å…¸å‹é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¾ªç¯ä¾èµ–"&gt;&lt;strong&gt;å¾ªç¯ä¾èµ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šBean A ä¾èµ– Bean Bï¼ŒåŒæ—¶ Bean B ä¾èµ– Bean Aã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³æ–¹æ¡ˆï¼š
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼šSpringæ— æ³•è§£å†³ï¼Œéœ€é¿å…ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Setter/å­—æ®µæ³¨å…¥&lt;/strong&gt;ï¼šé€šè¿‡ä¸‰çº§ç¼“å­˜é€æ­¥æš´éœ²åŠæˆå“Bean&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰©å±•ç‚¹å†²çª"&gt;&lt;strong&gt;æ‰©å±•ç‚¹å†²çª&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šå¤šä¸ª &lt;code&gt;BeanPostProcessor&lt;/code&gt; æ‰§è¡Œé¡ºåºä¸å¯æ§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šå®ç° &lt;code&gt;Ordered&lt;/code&gt; æ¥å£æˆ–ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt; æ³¨è§£æŒ‡å®šä¼˜å…ˆçº§&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾"&gt;ğŸ’ &lt;strong&gt;ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[å®ä¾‹åŒ–Bean] --&amp;gt; B[å±æ€§èµ‹å€¼ä¸ä¾èµ–æ³¨å…¥]
B --&amp;gt; C[Awareæ¥å£å›è°ƒ]
C --&amp;gt; D[BeanPostProcessor#postProcessBeforeInitialization]
D --&amp;gt; E[åˆå§‹åŒ–æ–¹æ³•ï¼š@PostConstruct â†’ afterPropertiesSet â†’ init-method]
E --&amp;gt; F[BeanPostProcessor#postProcessAfterInitialization]
F --&amp;gt; G[Beanå°±ç»ªï¼Œå­˜å…¥å•ä¾‹æ± ]
G --&amp;gt; H[å®¹å™¨å…³é—­]
H --&amp;gt; I[é”€æ¯ï¼š@PreDestroy â†’ destroy â†’ destroy-method]
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µ"&gt;âš ï¸ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–é€»è¾‘ï¼š
&lt;ul&gt;
&lt;li&gt;è½»é‡çº§æ“ä½œï¼ˆå¦‚ç¼“å­˜åŠ è½½ï¼‰ç”¨ &lt;code&gt;@PostConstruct&lt;/code&gt;ï¼Œèµ„æºå¯†é›†å‹æ“ä½œï¼ˆå¦‚è¿æ¥æ± ï¼‰ç”¨å¼‚æ­¥çº¿ç¨‹&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é”€æ¯é€»è¾‘ï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“è¿æ¥ã€çº¿ç¨‹æ± ç­‰èµ„æºé‡Šæ”¾å†™åœ¨ &lt;code&gt;@PreDestroy&lt;/code&gt; æ–¹æ³•ä¸­&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¿å…é™·é˜±ï¼š
&lt;ul&gt;
&lt;li&gt;åŒç±»æ–¹æ³•è°ƒç”¨ä¸è§¦å‘AOPä»£ç†ï¼ˆéœ€é€šè¿‡å®¹å™¨è·å–Beanï¼‰&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚
é€šè¿‡ç†è§£Beanç”Ÿå‘½å‘¨æœŸçš„é˜¶æ®µä¸æ‰©å±•ç‚¹ï¼Œå¯é«˜æ•ˆåˆ©ç”¨Springçš„IoCå®¹å™¨èƒ½åŠ›ï¼Œå®ç°ä¸šåŠ¡è§£è€¦å’Œèµ„æºä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="æ„é€ å™¨æ³¨å…¥"&gt;æ„é€ å™¨æ³¨å…¥
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring æ¡†æ¶ä¸­ï¼Œ&lt;strong&gt;æ„é€ å™¨æ³¨å…¥çš„ä¾èµ–èµ‹å€¼å‘ç”Ÿåœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯å®ä¾‹åŒ–ä¹‹åã€‚è¿™ä¸è®¾å€¼æ³¨å…¥ï¼ˆSetter Injectionï¼‰å’Œå±æ€§æ³¨å…¥ï¼ˆField Injectionï¼‰çš„æ—¶æœºæœ‰æœ¬è´¨åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ„é€ å™¨æ³¨å…¥çš„æ—¶æœº"&gt;âš™ï¸ &lt;strong&gt;æ„é€ å™¨æ³¨å…¥çš„æ—¶æœº&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®ä¾‹åŒ–ä¸æ³¨å…¥åŒæ­¥å®Œæˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿‡ç¨‹&lt;/strong&gt;ï¼šå½“ Spring å®¹å™¨åˆ›å»º Bean æ—¶ï¼Œä¼š&lt;strong&gt;ç›´æ¥è°ƒç”¨å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•&lt;/strong&gt;ï¼Œæ­¤æ—¶æ„é€ æ–¹æ³•çš„å‚æ•°å€¼ï¼ˆå³ä¾èµ–å¯¹è±¡æˆ–å±æ€§å€¼ï¼‰ç”±å®¹å™¨æä¾›å¹¶ä¼ å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ¬è´¨&lt;/strong&gt;ï¼šä¾èµ–èµ‹å€¼æ˜¯å®ä¾‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹è±¡åœ¨æ„é€ å®Œæˆå&lt;strong&gt;å·²åŒ…å«æ‰€æœ‰å¿…éœ€çš„ä¾èµ–&lt;/strong&gt;ï¼Œæ— éœ€åç»­é¢å¤–æ­¥éª¤&lt;a class="link" href="@ref" &gt;2,4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ä»£ç ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;public class UserService {
private final UserRepository userRepo;
// æ„é€ å™¨æ³¨å…¥ï¼šå®ä¾‹åŒ–æ—¶å³å®Œæˆä¾èµ–èµ‹å€¼
public UserService(UserRepository userRepo) {
this.userRepo = userRepo;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è®¾å€¼æ³¨å…¥çš„å¯¹æ¯”&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¾å€¼æ³¨å…¥&lt;/strong&gt;ï¼šå…ˆé€šè¿‡æ— å‚æ„é€ å™¨å®ä¾‹åŒ–å¯¹è±¡ï¼ˆæ­¤æ—¶ä¾èµ–ä¸º &lt;code&gt;null&lt;/code&gt;ï¼‰ï¼Œå†è°ƒç”¨ setter æ–¹æ³•èµ‹å€¼ï¼ˆå®ä¾‹åŒ–åé˜¶æ®µï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼š&lt;strong&gt;é¿å…å¯¹è±¡å¤„äºâ€œåŠåˆå§‹åŒ–â€çŠ¶æ€&lt;/strong&gt;ï¼Œç¡®ä¿ Bean åœ¨åˆ›å»ºåç«‹å³å¯ç”¨&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-spring-bean-ç”Ÿå‘½å‘¨æœŸä¸­çš„å…³é”®é˜¶æ®µ"&gt;ğŸ” &lt;strong&gt;Spring Bean ç”Ÿå‘½å‘¨æœŸä¸­çš„å…³é”®é˜¶æ®µ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯æ„é€ å™¨æ³¨å…¥åœ¨ Bean ç”Ÿå‘½å‘¨æœŸä¸­çš„å®šä½ï¼ˆç®€åŒ–æµç¨‹ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[å®ä¾‹åŒ– Bean] --&amp;gt; B{æ„é€ å™¨æ³¨å…¥}
B --&amp;gt;|ä¼ å…¥ä¾èµ–å‚æ•°| C[å¯¹è±¡åˆ›å»ºå®Œæˆ]
C --&amp;gt; D[è®¾å€¼æ³¨å…¥/å±æ€§æ³¨å…¥]
D --&amp;gt; E[åˆå§‹åŒ–å›è°ƒ]
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å…³é”®ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é˜¶æ®µ 1&lt;/strong&gt;ï¼šå®ä¾‹åŒ– + æ„é€ å™¨æ³¨å…¥ï¼ˆ&lt;strong&gt;åŒæ­¥å®Œæˆ&lt;/strong&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜¶æ®µ 2&lt;/strong&gt;ï¼šå®ä¾‹åŒ–åï¼Œè¿›è¡Œè®¾å€¼æ³¨å…¥æˆ–å±æ€§æ³¨å…¥ï¼ˆé€šè¿‡åå°„è°ƒç”¨ setter æˆ–ç›´æ¥èµ‹å€¼å­—æ®µï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜¶æ®µ 3&lt;/strong&gt;ï¼šæ‰§è¡Œ &lt;code&gt;@PostConstruct&lt;/code&gt;ã€&lt;code&gt;InitializingBean&lt;/code&gt; ç­‰åˆå§‹åŒ–é€»è¾‘&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ„é€ å™¨æ³¨å…¥-vs-å…¶ä»–æ³¨å…¥æ–¹å¼çš„æ‰§è¡Œé¡ºåº"&gt;âš–ï¸ &lt;strong&gt;æ„é€ å™¨æ³¨å…¥ vs. å…¶ä»–æ³¨å…¥æ–¹å¼çš„æ‰§è¡Œé¡ºåº&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡å®éªŒéªŒè¯ï¼ˆ&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ï¼‰ï¼Œä¸‰ç§æ³¨å…¥æ–¹å¼çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼šæœ€æ—©æ‰§è¡Œï¼Œåœ¨å®ä¾‹åŒ–æ—¶å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾å€¼æ³¨å…¥&lt;/strong&gt;ï¼šåœ¨å®ä¾‹åŒ–åã€åˆå§‹åŒ–å›è°ƒå‰æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±æ€§æ³¨å…¥&lt;/strong&gt;ï¼šä¸è®¾å€¼æ³¨å…¥æ—¶æœºç›¸åŒï¼Œä½†æ‰§è¡Œé¡ºåºå¯èƒ½å—ä»£ç å£°æ˜é¡ºåºå½±å“ã€‚
&lt;strong&gt;å®éªŒæ—¥å¿—ç¤ºä¾‹&lt;/strong&gt;ï¼ˆç®€åŒ–ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;æ„é€ å™¨æ³¨å…¥: UserService å®ä¾‹åŒ–ï¼ˆä¾èµ–å·²æ³¨å…¥ï¼‰
è®¾å€¼æ³¨å…¥: è°ƒç”¨ setRepository()
å±æ€§æ³¨å…¥: ä¸º @Autowired å­—æ®µèµ‹å€¼
@PostConstruct: åˆå§‹åŒ–å›è°ƒ
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ä¸ºä»€ä¹ˆæ„é€ å™¨æ³¨å…¥çš„èµ‹å€¼ä¸åœ¨å®ä¾‹åŒ–ä¹‹å"&gt;ğŸ’¡ &lt;strong&gt;ä¸ºä»€ä¹ˆæ„é€ å™¨æ³¨å…¥çš„èµ‹å€¼ä¸åœ¨å®ä¾‹åŒ–ä¹‹åï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡åŸç†&lt;/strong&gt;ï¼š
æ„é€ å™¨æ³¨å…¥æ˜¯&lt;strong&gt;å¯¹è±¡åˆ›å»ºçš„å¿…è¦æ¡ä»¶&lt;/strong&gt;ã€‚Spring å¿…é¡»åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶æä¾›æ‰€æœ‰å‚æ•°ï¼Œå¦åˆ™æ— æ³•å®ä¾‹åŒ–å¯¹è±¡ã€‚è¿™ä¸è®¾å€¼æ³¨å…¥ï¼ˆå¯¹è±¡å¯å…ˆå­˜åœ¨åä¿®æ”¹ï¼‰æœ‰æœ¬è´¨åŒºåˆ«&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ¿ä½“ç°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¸å˜æ€§&lt;/strong&gt;ï¼šä¾èµ–å¯é€šè¿‡ &lt;code&gt;final&lt;/code&gt; ä¿®é¥°ï¼Œç¡®ä¿å¯¹è±¡ä¸å¯å˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ç©ºæŒ‡é’ˆ&lt;/strong&gt;ï¼šæœç»ä¾èµ–æœªåˆå§‹åŒ–å°±è¢«ä½¿ç”¨çš„é£é™©&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¾ªç¯ä¾èµ–é—®é¢˜&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ„é€ å™¨æ³¨å…¥&lt;strong&gt;æ— æ³•è§£å†³å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼ˆå¦‚ A ä¾èµ– Bï¼ŒB ä¾èµ– Aï¼‰ï¼Œå› ä¸ºåŒæ–¹éƒ½éœ€å¯¹æ–¹å®ä¾‹åŒ–æ‰èƒ½åˆ›å»ºï¼Œå¯¼è‡´æ­»é”ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶éœ€æ”¹ç”¨è®¾å€¼æ³¨å…¥æˆ–å±æ€§æ³¨å…¥&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–è¦†ç›–é£é™©&lt;/strong&gt;ï¼š
è‹¥åŒä¸€ä¸ªå±æ€§åŒæ—¶ç”¨æ„é€ å™¨æ³¨å…¥å’Œè®¾å€¼æ³¨å…¥ï¼Œâ€‹&lt;strong&gt;è®¾å€¼æ³¨å…¥çš„å€¼ä¼šè¦†ç›–æ„é€ å™¨æ³¨å…¥çš„å€¼&lt;/strong&gt;â€‹ï¼ˆå› è®¾å€¼æ³¨å…¥æ‰§è¡Œæ›´æ™šï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring å®˜æ–¹æ¨è&lt;/strong&gt;ï¼š
å¯¹äºå¼ºä¾èµ–çš„ç»„ä»¶ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æ ¸å¿ƒæœåŠ¡ï¼‰ï¼Œâ€‹&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼Œä»¥ä¿éšœä»£ç å¥å£®æ€§å’Œå¯æµ‹è¯•æ€§&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ å™¨æ³¨å…¥&lt;/strong&gt;ï¼šä¾èµ–èµ‹å€¼åœ¨&lt;strong&gt;å®ä¾‹åŒ–é˜¶æ®µåŒæ­¥å®Œæˆ&lt;/strong&gt;ï¼Œæ˜¯å¯¹è±¡åˆ›å»ºçš„å¿…è¦æ­¥éª¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾å€¼æ³¨å…¥/å±æ€§æ³¨å…¥&lt;/strong&gt;ï¼šä¾èµ–èµ‹å€¼åœ¨&lt;strong&gt;å®ä¾‹åŒ–ä¹‹åã€åˆå§‹åŒ–ä¹‹å‰&lt;/strong&gt;å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;æœ€ä½³å®è·µï¼š
&lt;ul&gt;
&lt;li&gt;å…³é”®ä¾èµ– â†’ ç”¨æ„é€ å™¨æ³¨å…¥ï¼ˆä¿è¯ä¸å¯å˜æ€§ã€é¿å…ç©ºæŒ‡é’ˆï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯é€‰ä¾èµ– â†’ ç”¨è®¾å€¼æ³¨å…¥ï¼ˆçµæ´»é…ç½®ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…æ··åˆä½¿ç”¨å¤šç§æ³¨å…¥æ–¹å¼ï¼Œé˜²æ­¢ä¾èµ–è¦†ç›–&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="aware"&gt;Aware
&lt;/h2&gt;&lt;p&gt;Spring Aware æ¥å£æ˜¯ Spring æ¡†æ¶ä¸­ä¸€ç»„&lt;strong&gt;ç”¨äºè®© Bean æ„ŸçŸ¥å®¹å™¨ç¯å¢ƒæˆ–ç‰¹å®šèµ„æº&lt;/strong&gt;çš„æ ¸å¿ƒå›è°ƒæœºåˆ¶ã€‚å®ƒä»¬é€šè¿‡æ ‡è®°æ¥å£ï¼ˆæ— æ–¹æ³•ï¼‰å’Œå­æ¥å£ï¼ˆå« &lt;code&gt;setXxx()&lt;/code&gt; æ–¹æ³•ï¼‰å®ç°ï¼Œä½¿ Bean èƒ½å¤Ÿåœ¨åˆå§‹åŒ–é˜¶æ®µè·å– Spring å®¹å™¨æä¾›çš„ä¸Šä¸‹æ–‡èµ„æºã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¦ç‚¹åŠå·¥ä½œåŸç†ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-aware-æ¥å£çš„ä½œç”¨ä¸è®¾è®¡æ€æƒ³"&gt;âš™ï¸ &lt;strong&gt;Aware æ¥å£çš„ä½œç”¨ä¸è®¾è®¡æ€æƒ³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç›®çš„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è§£å†³ Bean å¯¹å®¹å™¨èµ„æºçš„ä¾èµ–é—®é¢˜ï¼ˆå¦‚è·å– Bean åç§°ã€å®¹å™¨å¼•ç”¨ç­‰ï¼‰ï¼Œé¿å…ç¡¬ç¼–ç ä¾èµ– Spring API&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å›è°ƒæœºåˆ¶æ³¨å…¥èµ„æºï¼Œ&lt;strong&gt;è§£è€¦ä¸šåŠ¡é€»è¾‘ä¸æ¡†æ¶ç»†èŠ‚&lt;/strong&gt;ï¼Œæå‡ä»£ç å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡æ¨¡å¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ‡è®°æ¥å£æ¨¡å¼&lt;/strong&gt;ï¼š&lt;code&gt;Aware&lt;/code&gt; ä½œä¸ºç©ºæ¥å£ï¼Œä»…æ ‡è¯† Bean å…·å¤‡æ„ŸçŸ¥èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›è°ƒæ¨¡å¼&lt;/strong&gt;ï¼šå­æ¥å£å®šä¹‰ &lt;code&gt;setXxx()&lt;/code&gt; æ–¹æ³•ï¼Œç”± Spring å®¹å™¨åœ¨ Bean ç”Ÿå‘½å‘¨æœŸç‰¹å®šé˜¶æ®µè‡ªåŠ¨è°ƒç”¨å¹¶æ³¨å…¥èµ„æº&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒ-aware-æ¥å£åŠç”¨é€”"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒ Aware æ¥å£åŠç”¨é€”&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring å†…ç½®äº†å¤šç§ Aware æ¥å£ï¼ŒæŒ‰åŠŸèƒ½å¯åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p&gt;
&lt;h4 id="bean-åŸºç¡€ä¿¡æ¯æ„ŸçŸ¥ç”±-beanfactory-å¤„ç†"&gt;&lt;strong&gt;Bean åŸºç¡€ä¿¡æ¯æ„ŸçŸ¥&lt;/strong&gt;ï¼ˆç”± &lt;code&gt;BeanFactory&lt;/code&gt; å¤„ç†ï¼‰
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¥å£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ³¨å…¥èµ„æº&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å›è°ƒæ—¶æœº&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BeanNameAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Bean çš„ IDï¼ˆå­—ç¬¦ä¸²ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€è·å–è‡ªèº«åœ¨å®¹å™¨ä¸­çš„åç§°&lt;/td&gt;
&lt;td&gt;åˆå§‹åŒ–å‰ï¼ˆ&lt;code&gt;invokeAwareMethods&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BeanClassLoaderAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç±»åŠ è½½å™¨ï¼ˆ&lt;code&gt;ClassLoader&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€åŠ è½½ç±»æˆ–èµ„æº&lt;/td&gt;
&lt;td&gt;åŒä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BeanFactoryAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BeanFactory&lt;/code&gt; å®¹å™¨&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨è·å–å…¶ä»– Bean æˆ–æ£€æŸ¥å®šä¹‰&lt;/td&gt;
&lt;td&gt;åŒä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å®¹å™¨ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç”±-applicationcontextawareprocessor-å¤„ç†"&gt;&lt;strong&gt;å®¹å™¨ä¸Šä¸‹æ–‡æ„ŸçŸ¥&lt;/strong&gt;ï¼ˆç”± &lt;code&gt;ApplicationContextAwareProcessor&lt;/code&gt; å¤„ç†ï¼‰
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ¥å£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ³¨å…¥èµ„æº&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ApplicationContextAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ApplicationContext&lt;/code&gt; å®¹å™¨&lt;/td&gt;
&lt;td&gt;è®¿é—®æ‰€æœ‰ Beanã€é…ç½®ã€äº‹ä»¶å‘å¸ƒç­‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ApplicationEventPublisherAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;äº‹ä»¶å‘å¸ƒå™¨ï¼ˆ&lt;code&gt;ApplicationEventPublisher&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶ï¼ˆå¦‚ä¸šåŠ¡æ“ä½œæ—¥å¿—ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;EnvironmentAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç¯å¢ƒé…ç½®ï¼ˆ&lt;code&gt;Environment&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;è¯»å–é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ç­‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ResourceLoaderAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;èµ„æºåŠ è½½å™¨ï¼ˆ&lt;code&gt;ResourceLoader&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ è½½ç±»è·¯å¾„/æ–‡ä»¶ç³»ç»Ÿèµ„æºï¼ˆå¦‚æ¨¡æ¿æ–‡ä»¶ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Web ç›¸å…³æ¥å£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServletContextAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ServletContext&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Web åº”ç”¨ä¸­è®¿é—® Servlet ä¸Šä¸‹æ–‡ï¼ˆå¦‚è·¯å¾„ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ServletConfigAware&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ServletConfig&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è·å– Servlet é…ç½®å‚æ•°&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BeanFactory æ„ŸçŸ¥æ¥å£&lt;/strong&gt; ç”± &lt;code&gt;AbstractAutowireCapableBeanFactory.invokeAwareMethods()&lt;/code&gt; ç›´æ¥è°ƒç”¨&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationContext æ„ŸçŸ¥æ¥å£&lt;/strong&gt; é€šè¿‡ &lt;code&gt;ApplicationContextAwareProcessor&lt;/code&gt;ï¼ˆä¸€ç§ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼‰åœ¨åˆå§‹åŒ–å‰å›è°ƒ&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰§è¡Œæ—¶æœºä¸ç”Ÿå‘½å‘¨æœŸ"&gt;â³ &lt;strong&gt;æ‰§è¡Œæ—¶æœºä¸ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Aware æ¥å£çš„å›è°ƒå‘ç”Ÿåœ¨ &lt;strong&gt;Bean åˆå§‹åŒ–é˜¶æ®µ&lt;/strong&gt;ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph TB
A[Bean å®ä¾‹åŒ–] --&amp;gt; B[å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰]
B --&amp;gt; C{BeanFactory æ„ŸçŸ¥æ¥å£å›è°ƒ}
C --&amp;gt;|setBeanName/setBeanFactory ç­‰| D[BeanPostProcessor å‰ç½®å¤„ç†]
D --&amp;gt; E[ApplicationContext æ„ŸçŸ¥æ¥å£å›è°ƒ]
E --&amp;gt; F[åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ï¼ˆ@PostConstructï¼‰]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;BeanFactory æ„ŸçŸ¥æ¥å£&lt;/strong&gt;ï¼š
åœ¨å±æ€§æ³¨å…¥åã€&lt;code&gt;BeanPostProcessor&lt;/code&gt; ä¹‹å‰ï¼Œç”± &lt;code&gt;invokeAwareMethods()&lt;/code&gt; è§¦å‘&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationContext æ„ŸçŸ¥æ¥å£&lt;/strong&gt;ï¼š
åœ¨ &lt;code&gt;BeanPostProcessor.postProcessBeforeInitialization()&lt;/code&gt; ä¸­ï¼Œç”± &lt;code&gt;ApplicationContextAwareProcessor&lt;/code&gt; è§¦å‘&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè‹¥åŒæ—¶å®ç°å¤šä¸ª Aware æ¥å£ï¼Œ&lt;strong&gt;æ‰§è¡Œé¡ºåºä¸å›ºå®š&lt;/strong&gt;ï¼Œéœ€é¿å…æ¥å£é—´çš„ä¾èµ–ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-3"&gt;ğŸ› ï¸ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è·å–å®¹å™¨èµ„æº&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ServiceLocator implements ApplicationContextAware {
private ApplicationContext context;
@Override
public void setApplicationContext(ApplicationContext context) {
this.context = context;
}
public UserService getUserService() {
return context.getBean(UserService.class);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨ç¼–ç¨‹&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class EventPublisher implements ApplicationEventPublisherAware {
private ApplicationEventPublisher publisher;
@Override
public void setApplicationEventPublisher(ApplicationEventPublisher publisher) {
this.publisher = publisher;
}
public void publishEvent(String message) {
publisher.publishEvent(new CustomEvent(this, message));
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒé…ç½®è¯»å–&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ConfigReader implements EnvironmentAware {
private Environment env;
@Override
public void setEnvironment(Environment env) {
this.env = env;
}
public String getDbUrl() {
return env.getProperty(&amp;#34;database.url&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦ä½¿ç”¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆ&lt;code&gt;@Autowired&lt;/code&gt;ï¼‰è€Œé &lt;code&gt;ApplicationContextAware&lt;/code&gt;ï¼Œå‡å°‘ä¸å®¹å™¨è€¦åˆ&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»…åœ¨éœ€è¦åŠ¨æ€è·å– Beanï¼ˆå¦‚å·¥å‚æ¨¡å¼ï¼‰æˆ–è®¿é—®åº•å±‚èµ„æºæ—¶ä½¿ç”¨ Aware æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸæ—¶æœº&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ &lt;code&gt;setXxx()&lt;/code&gt; æ–¹æ³•ä¸­&lt;strong&gt;å‹¿è®¿é—®æœªåˆå§‹åŒ–çš„ä¾èµ–&lt;/strong&gt;ï¼Œå› æ­¤æ—¶å±æ€§æ³¨å…¥å¯èƒ½æœªå®Œæˆ&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å•ä¾‹ä¸åŸå‹ä½œç”¨åŸŸ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Aware æ¥å£å¯¹&lt;strong&gt;å•ä¾‹ Bean ä»…å›è°ƒä¸€æ¬¡&lt;/strong&gt;ï¼Œå¯¹åŸå‹ Bean æ¯æ¬¡åˆ›å»ºå‡å›è°ƒ&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•å¤æ‚æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å®ç° Aware æ¥å£çš„ Bean éœ€åœ¨å•å…ƒæµ‹è¯•ä¸­æ¨¡æ‹Ÿå®¹å™¨ç¯å¢ƒï¼ˆå¦‚ä½¿ç”¨ &lt;code&gt;SpringExtension&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Aware æ¥å£æ˜¯è¿æ¥ &lt;strong&gt;Bean ä¸å®¹å™¨ç¯å¢ƒ&lt;/strong&gt;çš„å…³é”®æ¡¥æ¢ï¼Œé€šè¿‡å›è°ƒæœºåˆ¶ä¸º Bean æ³¨å…¥è¿è¡Œæ—¶èµ„æºï¼ˆå¦‚å®¹å™¨å¼•ç”¨ã€ç±»åŠ è½½å™¨ç­‰ï¼‰ã€‚å…¶è®¾è®¡ä½“ç°äº† Spring çš„&lt;strong&gt;æ§åˆ¶åè½¬ï¼ˆIoCï¼‰æ€æƒ³&lt;/strong&gt;ï¼Œå°†æ¡†æ¶èƒ½åŠ›ä»¥æ— ä¾µå…¥æ–¹å¼èµ‹èƒ½ä¸šåŠ¡ç»„ä»¶ã€‚åˆç†ä½¿ç”¨ Aware æ¥å£èƒ½å¢å¼ºçµæ´»æ€§ï¼Œä½†éœ€è­¦æƒ•è¿‡åº¦ä¾èµ–å¯¼è‡´çš„ä»£ç æ±¡æŸ“ã€‚æ·±å…¥ç†è§£å…¶æ‰§è¡Œæ—¶æœºï¼ˆå±æ€§æ³¨å…¥åã€åˆå§‹åŒ–å‰ï¼‰å’Œåˆ†ç±»ï¼ˆBeanFactory/ApplicationContext æ„ŸçŸ¥ï¼‰ï¼Œæ˜¯é«˜æ•ˆåº”ç”¨çš„å‰æ&lt;a class="link" href="@ref" &gt;1,2,3&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="spring-boot-è‡ªåŠ¨é…ç½®"&gt;Spring Boot è‡ªåŠ¨é…ç½®
&lt;/h2&gt;&lt;p&gt;Spring Boot çš„è‡ªåŠ¨é…ç½®ï¼ˆAuto-Configurationï¼‰æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œé€šè¿‡â€œçº¦å®šä¼˜äºé…ç½®â€çš„åŸåˆ™ï¼Œæå¤§ç®€åŒ–äº†åº”ç”¨çš„åˆå§‹åŒ–æµç¨‹ã€‚å…¶æ ¸å¿ƒåŸç†å¯æ‹†è§£ä¸ºä»¥ä¸‹éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶æ¦‚è¿°"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæœºåˆ¶æ¦‚è¿°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‡ªåŠ¨é…ç½®çš„æœ¬è´¨æ˜¯ &lt;strong&gt;åŸºäºæ¡ä»¶æ³¨è§£çš„åŠ¨æ€è£…é…&lt;/strong&gt;ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–æ‰«æ&lt;/strong&gt;ï¼šå¯åŠ¨æ—¶æ‰«æç±»è·¯å¾„ï¼ˆClasspathï¼‰ä¸­çš„ä¾èµ–åº“ï¼ˆå¦‚ &lt;code&gt;spring-boot-starter-web&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶åŒ¹é…&lt;/strong&gt;ï¼šæ ¹æ®ä¾èµ–å’Œé…ç½®å±æ€§ï¼Œé€šè¿‡æ¡ä»¶æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@ConditionalOnClass&lt;/code&gt;ï¼‰åˆ¤æ–­æ˜¯å¦éœ€è¦å¯ç”¨ç‰¹å®šé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bean æ³¨å†Œ&lt;/strong&gt;ï¼šç¬¦åˆæ¡ä»¶çš„é…ç½®ç±»ä¼šè‡ªåŠ¨æ³¨å†Œ Bean åˆ° Spring å®¹å™¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å…³é”®ç»„ä»¶è§£æ"&gt;ğŸ”‘ &lt;strong&gt;å…³é”®ç»„ä»¶è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="springbootapplication-134"&gt;&lt;strong&gt;&lt;code&gt;@SpringBootApplication&lt;/code&gt; æ³¨è§£&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;1,3,4&lt;/a&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç»„æˆï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@SpringBootConfiguration&lt;/code&gt;ï¼šæ ‡è®°å½“å‰ç±»ä¸ºé…ç½®ç±»ï¼ˆç­‰ä»·äº &lt;code&gt;@Configuration&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ComponentScan&lt;/code&gt;ï¼šæ‰«æå½“å‰åŒ…åŠå­åŒ…ä¸‹çš„ç»„ä»¶ï¼ˆå¦‚ &lt;code&gt;@Service&lt;/code&gt;ã€&lt;code&gt;@Controller&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;strong&gt;è§¦å‘è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ³¨è§£&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="enableautoconfiguration-249"&gt;&lt;strong&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt; çš„å·¥ä½œåŸç†&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;2,4,9&lt;/a&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Import(AutoConfigurationImportSelector.class)&lt;/code&gt;&lt;/strong&gt;ï¼š
é€šè¿‡ &lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt; åŠ è½½æ‰€æœ‰å€™é€‰é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;åŠ è½½æµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;æ‰«ææ‰€æœ‰ &lt;code&gt;META-INF/spring.factories&lt;/code&gt; æ–‡ä»¶ï¼Œè¯»å– &lt;code&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration&lt;/code&gt; é”®ä¸‹çš„é…ç½®ç±»å…¨é™å®šåã€‚&lt;/li&gt;
&lt;li&gt;è¿‡æ»¤æ’é™¤é¡¹ï¼ˆå¦‚é€šè¿‡ &lt;code&gt;exclude&lt;/code&gt; å±æ€§æˆ–é…ç½®æ–‡ä»¶æŒ‡å®šï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨æ¡ä»¶æ³¨è§£ç­›é€‰&lt;/strong&gt;ï¼Œä»…ä¿ç•™ç¬¦åˆæ¡ä»¶çš„é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ¡ä»¶æ³¨è§£conditional-annotations-235"&gt;&lt;strong&gt;æ¡ä»¶æ³¨è§£ï¼ˆConditional Annotationsï¼‰&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;2,3,5&lt;/a&gt;
&lt;/h4&gt;&lt;p&gt;æ¡ä»¶æ³¨è§£æ§åˆ¶é…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆï¼Œå¸¸è§ç±»å‹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç”Ÿæ•ˆæ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç±»è·¯å¾„ä¸­å­˜åœ¨æŒ‡å®šç±»&lt;/td&gt;
&lt;td&gt;å½“å¼•å…¥æ•°æ®åº“é©±åŠ¨æ—¶å¯ç”¨æ•°æ®æºé…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„ Bean&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·æœªè‡ªå®šä¹‰ Bean æ—¶å¯ç”¨é»˜è®¤å®ç°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnProperty&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨æŒ‡å®šå±æ€§ä¸”å€¼åŒ¹é…&lt;/td&gt;
&lt;td&gt;æ ¹æ® &lt;code&gt;spring.datasource.url&lt;/code&gt; å¯ç”¨é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰åº”ç”¨æ˜¯ Web ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;ä»… Web åº”ç”¨ä¸­å¯ç”¨ MVC é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="è‡ªåŠ¨é…ç½®ç±»ä¸-starter-æœºåˆ¶-245"&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®ç±»ä¸ Starter æœºåˆ¶&lt;/strong&gt; &lt;a class="link" href="@ref" &gt;2,4,5&lt;/a&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨é…ç½®ç±»ï¼š
ä»¥&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; DataSourceAutoConfiguration
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºä¾‹ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@ConditionalOnClass(DataSource.class) // å­˜åœ¨ DataSource ç±»æ—¶ç”Ÿæ•ˆ
@EnableConfigurationProperties(DataSourceProperties.class) // ç»‘å®šé…ç½®å±æ€§
public class DataSourceAutoConfiguration {
@Bean
@ConditionalOnMissingBean // ç”¨æˆ·æœªè‡ªå®šä¹‰ DataSource æ—¶ç”Ÿæ•ˆ
public DataSource dataSource(DataSourceProperties properties) {
return properties.initializeDataSourceBuilder().build();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;Starter çš„ä½œç”¨ï¼š
æ¯ä¸ª Starterï¼ˆå¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; spring-boot-starter-data-jpa
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾èµ–åº“é›†åˆï¼ˆ&lt;code&gt;pom.xml&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;META-INF/spring.factories&lt;/code&gt; æ–‡ä»¶ï¼Œå£°æ˜å…³è”çš„è‡ªåŠ¨é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è‡ªåŠ¨é…ç½®æ‰§è¡Œæµç¨‹"&gt;ğŸ”„ &lt;strong&gt;è‡ªåŠ¨é…ç½®æ‰§è¡Œæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯é…ç½®åŠ è½½çš„å®Œæ•´æµç¨‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[å¯åŠ¨ç±» @SpringBootApplication] --&amp;gt; B[@EnableAutoConfiguration]
B --&amp;gt; C[AutoConfigurationImportSelector]
C --&amp;gt; D[åŠ è½½æ‰€æœ‰ META-INF/spring.factories]
D --&amp;gt; E[ç­›é€‰ EnableAutoConfiguration ç±»åˆ—è¡¨]
E --&amp;gt; F[åº”ç”¨æ¡ä»¶æ³¨è§£è¿‡æ»¤]
F --&amp;gt; G[æ³¨å†Œç”Ÿæ•ˆçš„é…ç½®ç±»åˆ°å®¹å™¨]
G --&amp;gt; H[é…ç½®ç±»åˆ›å»º Bean]
&lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨é˜¶æ®µ&lt;/strong&gt;ï¼š
è°ƒç”¨ &lt;code&gt;SpringApplication.run()&lt;/code&gt;ï¼Œåˆå§‹åŒ–ç¯å¢ƒå¹¶åŠ è½½é…ç½® &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ç±»ç­›é€‰&lt;/strong&gt;ï¼š
&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt; è¯»å–æ‰€æœ‰ &lt;code&gt;spring.factories&lt;/code&gt; ä¸­çš„é…ç½®ç±»ï¼Œé€šè¿‡æ¡ä»¶æ³¨è§£è¿‡æ»¤æ— æ•ˆé…ç½® &lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bean æ³¨å†Œ&lt;/strong&gt;ï¼š
ç”Ÿæ•ˆçš„é…ç½®ç±»ä¸­å®šä¹‰çš„ Bean è¢«æ³¨å†Œåˆ° Spring å®¹å™¨ï¼ˆå¦‚è‡ªåŠ¨é…ç½®çš„ &lt;code&gt;DataSource&lt;/code&gt;ã€&lt;code&gt;DispatcherServlet&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±æ€§ç»‘å®š&lt;/strong&gt;ï¼š
é€šè¿‡ &lt;code&gt;@EnableConfigurationProperties&lt;/code&gt; å°† &lt;code&gt;application.properties&lt;/code&gt; ä¸­çš„å±æ€§ç»‘å®šåˆ°é…ç½®ç±»ï¼ˆå¦‚ &lt;code&gt;DataSourceProperties&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•ä¸è‡ªå®šä¹‰æ–¹æ³•"&gt;ğŸ› ï¸ &lt;strong&gt;æ‰©å±•ä¸è‡ªå®šä¹‰æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è¦†ç›–é»˜è®¤é…ç½®"&gt;&lt;strong&gt;è¦†ç›–é»˜è®¤é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰ Bean&lt;/strong&gt;ï¼š
æ˜¾å¼å®šä¹‰ Bean å¯è¦†ç›–è‡ªåŠ¨é…ç½®ï¼ˆå¦‚è‡ªå®šä¹‰ &lt;code&gt;DataSource&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±æ€§è¦†ç›–&lt;/strong&gt;ï¼š
åœ¨ &lt;code&gt;application.properties&lt;/code&gt; ä¸­ä¿®æ”¹é…ç½®ï¼ˆå¦‚ &lt;code&gt;spring.datasource.url=jdbc:mysql:///test&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’é™¤ç‰¹å®šé…ç½®&lt;/strong&gt;ï¼š
ä½¿ç”¨ &lt;code&gt;@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)&lt;/code&gt; æˆ–é…ç½®æ–‡ä»¶æŒ‡å®šæ’é™¤é¡¹ &lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è‡ªå®šä¹‰-starter"&gt;&lt;strong&gt;è‡ªå®šä¹‰ Starter&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»ï¼Œä½¿ç”¨æ¡ä»¶æ³¨è§£æ§åˆ¶é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; src/main/resources/META-INF/spring.factories
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸­å£°æ˜é…ç½®ç±»ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.example.MyAutoConfiguration
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="è°ƒè¯•å·¥å…·"&gt;&lt;strong&gt;è°ƒè¯•å·¥å…·&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¯åŠ¨æ—¶æ·»åŠ  &lt;code&gt;--debug&lt;/code&gt; å‚æ•°ï¼Œè¾“å‡ºè‡ªåŠ¨é…ç½®æŠ¥å‘Šï¼Œæ˜¾ç¤ºæ¡ä»¶åŒ¹é…è¯¦æƒ… &lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;java -jar myapp.jar --debug
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æŠ¥å‘Šç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;CONDITIONS EVALUATION REPORT
Positive matches: // ç”Ÿæ•ˆçš„é…ç½®
DataSourceAutoConfiguration matched:
- @ConditionalOnClass found &amp;#39;javax.sql.DataSource&amp;#39;
Negative matches: // æœªç”Ÿæ•ˆçš„é…ç½®
ActiveMQAutoConfiguration:
- @ConditionalOnClass did not find &amp;#39;javax.jms.ConnectionFactory&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ"&gt;ğŸ’ &lt;strong&gt;åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…¸å‹åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Web åº”ç”¨&lt;/strong&gt;ï¼šå¼•å…¥ &lt;code&gt;spring-boot-starter-web&lt;/code&gt; è‡ªåŠ¨é…ç½® Tomcat + Spring MVCã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“è®¿é—®&lt;/strong&gt;ï¼šå¼•å…¥ &lt;code&gt;spring-boot-starter-data-jpa&lt;/code&gt; è‡ªåŠ¨é…ç½®æ•°æ®æº + JPA äº‹åŠ¡ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/strong&gt;ï¼šå¼•å…¥ &lt;code&gt;spring-boot-starter-amqp&lt;/code&gt; è‡ªåŠ¨é…ç½® RabbitMQ è¿æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨è‡ªåŠ¨é…ç½®&lt;/strong&gt;ï¼šé¿å…é‡å¤é€ è½®å­ï¼Œå‡å°‘æ ·æ¿ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…è¦†ç›–é»˜è®¤é…ç½®&lt;/strong&gt;ï¼šä»…åœ¨æ˜ç¡®éœ€æ±‚æ—¶è‡ªå®šä¹‰ Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è§£æ¡ä»¶æ³¨è§£&lt;/strong&gt;ï¼šé€šè¿‡è°ƒè¯•æŠ¥å‘Šä¼˜åŒ–ä¾èµ–ï¼Œé¿å…åŠ è½½æ— ç”¨é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šè‡ªåŠ¨é…ç½®ç±»ä¹‹é—´çš„ä¾èµ–éœ€é€šè¿‡æ¡ä»¶æ³¨è§£è§£è€¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;âš¡ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Boot è‡ªåŠ¨é…ç½®é€šè¿‡ &lt;strong&gt;æ¡ä»¶æ³¨è§£&lt;/strong&gt; + &lt;strong&gt;&lt;code&gt;spring.factories&lt;/code&gt;&lt;/strong&gt; + &lt;strong&gt;Starter ä¾èµ–&lt;/strong&gt; å®ç°â€œé›¶é…ç½®â€å¯åŠ¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ™ºèƒ½è£…é…&lt;/strong&gt;ï¼šåŸºäºç±»è·¯å¾„ä¾èµ–åŠ¨æ€æ³¨å†Œ Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ‰©å±•&lt;/strong&gt;ï¼šæ”¯æŒå±æ€§è¦†ç›–ã€è‡ªå®šä¹‰ Bean å’Œ Starter å¼€å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆè°ƒè¯•&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;--debug&lt;/code&gt; æŠ¥å‘Šåˆ†æé…ç½®åŠ è½½é€»è¾‘ã€‚
è¿™ä¸€æœºåˆ¶å°†å¼€å‘è€…ä»ç¹ççš„é…ç½®ä¸­è§£æ”¾ï¼ŒçœŸæ­£ä½“ç°äº†â€œçº¦å®šä¼˜äºé…ç½®â€çš„å“²å­¦&lt;a class="link" href="@ref" &gt;3,4,7&lt;/a&gt;ã€‚å¦‚éœ€æ·±å…¥æºç ï¼Œå¯é‡ç‚¹å…³æ³¨ &lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt; å’Œæ¡ä»¶æ³¨è§£çš„è§£ææµç¨‹&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ¡ä»¶é…ç½®"&gt;æ¡ä»¶é…ç½®
&lt;/h2&gt;&lt;p&gt;Conditional Annotationsï¼ˆæ¡ä»¶æ³¨è§£ï¼‰æ˜¯Springæ¡†æ¶ä¸­ç”¨äº&lt;strong&gt;åŠ¨æ€æ§åˆ¶Beanæ³¨å†Œä¸é…ç½®åŠ è½½&lt;/strong&gt;çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé€šè¿‡é¢„è®¾æ¡ä»¶å†³å®šç»„ä»¶æ˜¯å¦ç”Ÿæ•ˆï¼Œæå¤§æå‡äº†é…ç½®çš„çµæ´»æ€§ä¸ç¯å¢ƒé€‚åº”æ€§ã€‚ä»¥ä¸‹ä»åŸç†ã€å®ç°ã€åº”ç”¨ä¸‰ä¸ªç»´åº¦æ·±å…¥è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†ä¸è®¾è®¡æ€æƒ³"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŸç†ä¸è®¾è®¡æ€æƒ³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶åŒ–é…ç½®çš„æœ¬è´¨&lt;/strong&gt;
æ¡ä»¶æ³¨è§£é€šè¿‡&lt;strong&gt;è¿è¡Œæ—¶è¯„ä¼°&lt;/strong&gt;â€‹ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€ç±»è·¯å¾„ã€å±æ€§å€¼ç­‰ï¼‰å†³å®šæ˜¯å¦å°†BeanåŠ å…¥å®¹å™¨ï¼Œå®ç°â€œæŒ‰éœ€åŠ è½½â€ã€‚å…¶è®¾è®¡åŸºäºä¸¤ä¸ªå…³é”®æ¥å£ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Condition&lt;/code&gt;&lt;/strong&gt;ï¼šå®šä¹‰æ¡ä»¶åˆ¤æ–­é€»è¾‘ï¼Œéœ€å®ç°&lt;code&gt;matches()&lt;/code&gt;æ–¹æ³•&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConditionContext&lt;/code&gt;&lt;/strong&gt;ï¼šæä¾›è®¿é—®å®¹å™¨èµ„æºï¼ˆå¦‚&lt;code&gt;Environment&lt;/code&gt;ã€&lt;code&gt;BeanFactory&lt;/code&gt;ï¼‰çš„èƒ½åŠ›&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ&lt;/strong&gt;
æ¡ä»¶æ³¨è§£çš„è§£æå‘ç”Ÿåœ¨ â€‹&lt;strong&gt;Beanå®šä¹‰ï¼ˆBeanDefinitionï¼‰é˜¶æ®µ&lt;/strong&gt;ï¼Œæ—©äºå®ä¾‹åŒ–ã€‚Springåœ¨è§£æé…ç½®ç±»æ—¶ï¼Œé€šè¿‡&lt;code&gt;ConfigurationClassPostProcessor&lt;/code&gt;è°ƒç”¨æ¡ä»¶è¯„ä¼°é€»è¾‘ï¼Œè·³è¿‡ä¸æ»¡è¶³æ¡ä»¶çš„Beanå®šä¹‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å®ç°æ–¹å¼ä¸æ ¸å¿ƒæ³¨è§£"&gt;ğŸ› ï¸ &lt;strong&gt;å®ç°æ–¹å¼ä¸æ ¸å¿ƒæ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è‡ªå®šä¹‰æ¡ä»¶å®ç°"&gt;&lt;strong&gt;è‡ªå®šä¹‰æ¡ä»¶å®ç°&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¼€å‘è€…å¯é€šè¿‡å®ç°&lt;code&gt;Condition&lt;/code&gt;æ¥å£åˆ›å»ºå®šåˆ¶åŒ–æ¡ä»¶ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class EnvCondition implements Condition {
@Override
public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
String env = context.getEnvironment().getProperty(&amp;#34;app.env&amp;#34;);
return &amp;#34;prod&amp;#34;.equals(env); // ä»…ç”Ÿäº§ç¯å¢ƒç”Ÿæ•ˆ
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;@Conditional(EnvCondition.class)&lt;/code&gt;æ ‡æ³¨Beanæˆ–é…ç½®ç±»&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="spring-bootçš„é¢„å®šä¹‰æ¡ä»¶æ³¨è§£"&gt;&lt;strong&gt;Spring Bootçš„é¢„å®šä¹‰æ¡ä»¶æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Spring Bootæ‰©å±•äº†ä¸°å¯Œçš„æ¡ä»¶æ³¨è§£ï¼Œç®€åŒ–å¸¸è§åœºæ™¯ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç±»è·¯å¾„å­˜åœ¨æŒ‡å®šç±»&lt;/td&gt;
&lt;td&gt;å¼•å…¥æ•°æ®åº“é©±åŠ¨æ—¶è‡ªåŠ¨é…ç½®æ•°æ®æº&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„Bean&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·æœªè‡ªå®šä¹‰Beanæ—¶å¯ç”¨é»˜è®¤å®ç°&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnProperty&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®å±æ€§å€¼åŒ¹é…ï¼ˆå¦‚&lt;code&gt;spring.datasource.url&lt;/code&gt;å­˜åœ¨ï¼‰&lt;/td&gt;
&lt;td&gt;æŒ‰é…ç½®å¼€å…³å¯ç”¨åŠŸèƒ½æ¨¡å—&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰ä¸ºWebåº”ç”¨ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;ä»…Webåº”ç”¨ä¸­æ³¨å†ŒMVCç»„ä»¶&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConditionalOnExpression&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;SpELè¡¨è¾¾å¼ç»“æœä¸ºtrue&lt;/td&gt;
&lt;td&gt;å¤æ‚é€»è¾‘åˆ¤æ–­ï¼ˆå¦‚å¤šå±æ€§ç»„åˆï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="æ¡ä»¶æ³¨è§£çš„å…ƒæ³¨è§£åŒ–"&gt;&lt;strong&gt;æ¡ä»¶æ³¨è§£çš„å…ƒæ³¨è§£åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¯å°†å¸¸ç”¨æ¡ä»¶å°è£…ä¸ºè‡ªå®šä¹‰æ³¨è§£ï¼Œæå‡å¯è¯»æ€§ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Conditional(EnvCondition.class) // å…³è”æ¡ä»¶é€»è¾‘
public @interface ConditionalOnProdEnv {}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨æ—¶ç›´æ¥æ ‡æ³¨&lt;code&gt;@ConditionalOnProdEnv&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å…¸å‹åº”ç”¨åœºæ™¯-4"&gt;ğŸŒ &lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¤šç¯å¢ƒé…ç½®&lt;/strong&gt;
é€šè¿‡&lt;code&gt;@Profile&lt;/code&gt;ï¼ˆåº•å±‚åŸºäº&lt;code&gt;@Conditional&lt;/code&gt;ï¼‰æˆ–è‡ªå®šä¹‰æ¡ä»¶åŒºåˆ†å¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œä¾‹å¦‚ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§èƒ½ç›‘æ§Bean&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—åŒ–åŠ è½½&lt;/strong&gt;
æ ¹æ®ç±»è·¯å¾„ä¾èµ–åŠ¨æ€åŠ è½½æ¨¡å—ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@ConditionalOnClass(RedisTemplate.class) // å­˜åœ¨Redisä¾èµ–æ‰ç”Ÿæ•ˆ
public class RedisAutoConfig {
@Bean
public RedisTemplate&amp;lt;String, Object&amp;gt; redisTemplate() { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…Beanå†²çª&lt;/strong&gt;
ä½¿ç”¨&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;ç¡®ä¿ç”¨æˆ·è‡ªå®šä¹‰Beanä¼˜å…ˆäºè‡ªåŠ¨é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
@ConditionalOnMissingBean // ç”¨æˆ·æœªå®šä¹‰DataSourceæ—¶ç”Ÿæ•ˆ
public DataSource defaultDataSource() { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®å¼€å…³æ§åˆ¶&lt;/strong&gt;
åŸºäºé…ç½®æ–‡ä»¶åŠ¨æ€å¯ç”¨åŠŸèƒ½ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
@ConditionalOnProperty(name = &amp;#34;cache.enabled&amp;#34;, havingValue = &amp;#34;true&amp;#34;)
public CacheService cacheService() { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶æ³¨è§£ä¸ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šæ¡ä»¶è¯„ä¼°è¿‡æ—©ï¼Œä¾èµ–çš„Beanå°šæœªæ³¨å†Œ&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šé¿å…åœ¨&lt;code&gt;@Configuration&lt;/code&gt;ç±»ä¸Šç›´æ¥ä½¿ç”¨&lt;code&gt;@ConditionalOnBean&lt;/code&gt;ï¼Œæ”¹ç”¨&lt;code&gt;@ConditionalOnClass&lt;/code&gt;æˆ–å»¶è¿Ÿè¯„ä¼°ï¼ˆå¦‚&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•çº§æ³¨è§£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶æ‰§è¡Œé¡ºåºé—®é¢˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå¤šä¸ªæ¡ä»¶æ³¨è§£å­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆå¦‚Bä¾èµ–Aï¼Œä½†Açš„æ¡ä»¶åæ‰§è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;@AutoConfigureOrder&lt;/code&gt;æ§åˆ¶é…ç½®ç±»é¡ºåºã€‚&lt;/li&gt;
&lt;li&gt;å°†ä¾èµ–æ¡ä»¶åˆå¹¶åˆ°åŒä¸€é…ç½®ç±»ä¸­&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§æŠ€å·§"&gt;ğŸ” &lt;strong&gt;é«˜çº§æŠ€å·§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç»„åˆæ¡ä»¶é€»è¾‘&lt;/strong&gt;
é€šè¿‡&lt;code&gt;AnyNestedCondition&lt;/code&gt;/&lt;code&gt;AllNestedCondition&lt;/code&gt;å®ç°å¤æ‚æ¡ä»¶ç»„åˆï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;public class OnCacheOrQueue extends AnyNestedCondition {
OnCacheOrQueue() { super(ConfigurationPhase.REGISTER_BEAN); }
@ConditionalOnProperty(&amp;#34;cache.enabled&amp;#34;)
static class CacheEnabled {}
@ConditionalOnBean(QueueManager.class)
static class QueueExists {}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶ä¸å±æ€§ç»‘å®šç»“åˆ&lt;/strong&gt;
åœ¨æ¡ä»¶ç±»ä¸­è¯»å–æ³¨è§£å‚æ•°ï¼Œå®ç°åŠ¨æ€æ¡ä»¶ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;public class ThresholdCondition implements Condition {
@Override
public boolean matches(...) {
int threshold = (int) metadata.getAnnotationAttributes(&amp;#34;com.example.OnThreshold&amp;#34;).get(&amp;#34;value&amp;#34;);
return getCurrentLoad() &amp;gt; threshold;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ¡ä»¶æ³¨è§£æ˜¯Spring**â€œçº¦å®šä¼˜äºé…ç½®â€**ç†å¿µçš„æ ¸å¿ƒå®ç°ï¼Œé€šè¿‡å£°æ˜å¼æ¡ä»¶æ§åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦é…ç½®ä¸ç¯å¢ƒ&lt;/strong&gt;ï¼šä½¿åº”ç”¨è‡ªé€‚åº”éƒ¨ç½²ç¯å¢ƒ&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æå‡å¯åŠ¨æ€§èƒ½&lt;/strong&gt;ï¼šé¿å…åŠ è½½æœªä½¿ç”¨çš„Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¢å¼ºæ‰©å±•æ€§&lt;/strong&gt;ï¼šæ”¯æŒè‡ªå®šä¹‰æ¡ä»¶æ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚ã€‚
æ·±å…¥ç†è§£å…¶åŸç†ï¼ˆå¦‚ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ï¼‰å’Œé¢„å®šä¹‰æ³¨è§£ï¼Œå¯æ˜¾è‘—æå‡å¤§å‹é¡¹ç›®çš„é…ç½®ç®¡ç†èƒ½åŠ›ã€‚å®è·µä¸­éœ€è­¦æƒ•æ¡ä»¶è¯„ä¼°é¡ºåºä¸ä¾èµ–é™·é˜±ï¼Œå–„ç”¨&lt;code&gt;--debug&lt;/code&gt;æ¨¡å¼æŸ¥çœ‹æ¡ä»¶åŒ¹é…æŠ¥å‘Š&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="configurationproperties"&gt;@ConfigurationProperties
&lt;/h2&gt;&lt;p&gt;Spring Bootä¸­çš„&lt;code&gt;@ConfigurationProperties&lt;/code&gt;å’Œ&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;æ˜¯å®ç°&lt;strong&gt;ç±»å‹å®‰å…¨é…ç½®ç®¡ç†&lt;/strong&gt;çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…±åŒè§£å†³é…ç½®æ–‡ä»¶çš„å±æ€§ç»‘å®šä¸Beanæ³¨å†Œé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒä½œç”¨ä¸å…³ç³»"&gt;ğŸ”§ &lt;strong&gt;æ ¸å¿ƒä½œç”¨ä¸å…³ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†é…ç½®æ–‡ä»¶ï¼ˆå¦‚&lt;code&gt;application.yml&lt;/code&gt;ï¼‰ä¸­çš„å±æ€§&lt;strong&gt;æŒ‰å‰ç¼€ç»‘å®šåˆ°Javaç±»çš„å­—æ®µ&lt;/strong&gt;ä¸Š&lt;/td&gt;
&lt;td&gt;éœ€é…åˆæ³¨å†Œæœºåˆ¶ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ç”¨é…ç½®ç»‘å®šåŠŸèƒ½&lt;/strong&gt;ï¼Œå°†&lt;code&gt;@ConfigurationProperties&lt;/code&gt;ç±»æ³¨å†Œä¸ºSpring Bean&lt;/td&gt;
&lt;td&gt;ä¾èµ–&lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;ååŒæµç¨‹ï¼š
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;@ConfigurationProperties&lt;/code&gt;å®šä¹‰ç»‘å®šè§„åˆ™ï¼ˆå‰ç¼€ã€å­—æ®µæ˜ å°„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;æ¿€æ´»ç»‘å®šé€»è¾‘å¹¶æ³¨å†ŒBeanåˆ°å®¹å™¨&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹"&gt;ğŸ› ï¸ &lt;strong&gt;ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŸºç¡€ç”¨æ³•å•é…ç½®ç±»ç»‘å®š"&gt;&lt;strong&gt;åŸºç¡€ç”¨æ³•ï¼šå•é…ç½®ç±»ç»‘å®š&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// å®šä¹‰é…ç½®ç±»ï¼ˆæ— éœ€@Componentï¼‰
@ConfigurationProperties(prefix = &amp;#34;app&amp;#34;)
public class AppProperties {
private String name;
private int timeout;
// getters/setters
}
// å¯ç”¨é…ç½®ç»‘å®š
@Configuration
@EnableConfigurationProperties(AppProperties.class)
public class AppConfig { }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;app.name=demo
app.timeout=1000
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å¤šé…ç½®ç±»ç»‘å®š"&gt;&lt;strong&gt;å¤šé…ç½®ç±»ç»‘å®š&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// å¯ç”¨å¤šä¸ªé…ç½®ç±»
@Configuration
@EnableConfigurationProperties({AppProperties.class, DatabaseConfig.class})
public class GlobalConfig { }
// ç¬¬äºŒä¸ªé…ç½®ç±»
@ConfigurationProperties(prefix = &amp;#34;database&amp;#34;)
public class DatabaseConfig {
private String url;
private String username;
// getters/setters
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;database.url=jdbc:mysql://localhost:3306/mydb
database.username=root
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ç¬¬ä¸‰æ–¹åº“é…ç½®ç±»æ³¨å†Œ"&gt;&lt;strong&gt;ç¬¬ä¸‰æ–¹åº“é…ç½®ç±»æ³¨å†Œ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€‚ç”¨äºæ— æ³•æ·»åŠ &lt;code&gt;@Component&lt;/code&gt;çš„ç±»ï¼ˆå¦‚Starterä¸­çš„é…ç½®ç±»ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableConfigurationProperties(ThirdPartyProperties.class)
public class MyApp { }
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-è¿›é˜¶ç‰¹æ€§"&gt;âš™ï¸ &lt;strong&gt;è¿›é˜¶ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®½æ¾ç»‘å®šrelaxed-binding"&gt;&lt;strong&gt;å®½æ¾ç»‘å®šï¼ˆRelaxed Bindingï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å±æ€§åæ”¯æŒ&lt;strong&gt;å¤šç§å‘½åé£æ ¼&lt;/strong&gt;çš„è‡ªåŠ¨è½¬æ¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶ä¸­ï¼š&lt;code&gt;app.db-url&lt;/code&gt;ã€&lt;code&gt;app.dbUrl&lt;/code&gt;ã€&lt;code&gt;app.db_url&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Javaç±»ä¸­ï¼š&lt;code&gt;dbUrl&lt;/code&gt;å­—æ®µå‡å¯æ¥æ”¶&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åµŒå¥—å±æ€§ä¸é›†åˆ"&gt;&lt;strong&gt;åµŒå¥—å±æ€§ä¸é›†åˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;server:
endpoints:
- name: api1
path: /v1
- name: api2
path: /v2
@ConfigurationProperties(prefix = &amp;#34;server&amp;#34;)
public class ServerProperties {
private List&amp;lt;Endpoint&amp;gt; endpoints;
public static class Endpoint {
private String name;
private String path;
// getters/setters
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="é…ç½®éªŒè¯"&gt;&lt;strong&gt;é…ç½®éªŒè¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç»“åˆ&lt;code&gt;@Validated&lt;/code&gt;å®ç°å±æ€§æ ¡éªŒï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@ConfigurationProperties(prefix = &amp;#34;security&amp;#34;)
@Validated
public class SecurityProperties {
@NotBlank
private String apiKey;
@Min(1024)
private int port;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‹¥æ ¡éªŒå¤±è´¥ï¼Œ&lt;strong&gt;åº”ç”¨å¯åŠ¨æ—¶æŠ¥é”™&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ–¹æ³•çº§ç»‘å®š"&gt;&lt;strong&gt;æ–¹æ³•çº§ç»‘å®š&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œå®ç°&lt;strong&gt;å¤šå®ä¾‹é…ç½®&lt;/strong&gt;ï¼ˆå¦‚å¤šæ•°æ®æºï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class DataSourceConfig {
@Bean
@ConfigurationProperties(prefix = &amp;#34;spring.datasource.read&amp;#34;)
public DataSource readDataSource() {
return new DruidDataSource();
}
@Bean
@ConfigurationProperties(prefix = &amp;#34;spring.datasource.write&amp;#34;)
public DataSource writeDataSource() {
return new DruidDataSource();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³-1"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é…ç½®æœªç”Ÿæ•ˆ"&gt;&lt;strong&gt;é…ç½®æœªç”Ÿæ•ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åŸå› ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼ºå°‘&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;æˆ–é…ç½®ç±»æœªæ³¨å†Œã€‚&lt;/li&gt;
&lt;li&gt;å±æ€§å‰ç¼€æ‹¼å†™é”™è¯¯æˆ–å­—æ®µåä¸åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥æ˜¯å¦å¯ç”¨é…ç½®ç»‘å®šã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;--debug&lt;/code&gt;å¯åŠ¨å‚æ•°æŸ¥çœ‹è‡ªåŠ¨é…ç½®æŠ¥å‘Š&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é‡å¤beanæ³¨å†Œ"&gt;&lt;strong&gt;é‡å¤Beanæ³¨å†Œ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåŒæ—¶ä½¿ç”¨&lt;code&gt;@Component&lt;/code&gt;å’Œ&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;æ³¨å†ŒåŒä¸€é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šå®¹å™¨ä¸­å­˜åœ¨&lt;strong&gt;ä¸¤ä¸ªåŒåBean&lt;/strong&gt;å¯¼è‡´æ³¨å…¥å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼š&lt;strong&gt;äºŒé€‰ä¸€æ³¨å†Œæ–¹å¼&lt;/strong&gt;ï¼Œé¿å…æ··åˆä½¿ç”¨&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åµŒå¥—å±æ€§ç»‘å®šå¤±è´¥"&gt;&lt;strong&gt;åµŒå¥—å±æ€§ç»‘å®šå¤±è´¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå†…éƒ¨ç±»æœªæä¾›&lt;strong&gt;é»˜è®¤æ„é€ å‡½æ•°&lt;/strong&gt;æˆ–&lt;strong&gt;Setteræ–¹æ³•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç¡®ä¿åµŒå¥—ç±»ä¸º&lt;code&gt;public static&lt;/code&gt;ä¸”å«Setteræ–¹æ³•&lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µ-1"&gt;ğŸ’ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å†Œæ–¹å¼é€‰æ‹©&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰é…ç½®ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Component&lt;/code&gt; + &lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç®€æ´ç›´è§‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¬¬ä¸‰æ–¹/Starteré…ç½®ç±»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¿å…ä¿®æ”¹æºç &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å—åŒ–æ‹†åˆ†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‰åŠŸèƒ½æ‹†åˆ†é…ç½®ç±»ï¼ˆå¦‚&lt;code&gt;RedisProperties&lt;/code&gt;ã€&lt;code&gt;JpaProperties&lt;/code&gt;ï¼‰ï¼Œæå‡å¯ç»´æŠ¤æ€§&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜ç¡®é…ç½®å‰ç¼€&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä¸šåŠ¡ç›¸å…³å‰ç¼€ï¼ˆå¦‚&lt;code&gt;payment.api&lt;/code&gt;ï¼‰ï¼Œé¿å…ä¸Springå†…ç½®å±æ€§å†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•æ„Ÿä¿¡æ¯åŠ å¯†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆ&lt;code&gt;jasypt&lt;/code&gt;å¯¹å¯†ç ç­‰æ•æ„Ÿé…ç½®åŠ å¯†ï¼Œé¿å…æ˜æ–‡æš´éœ²&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’¡ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/strong&gt;ï¼šå®ç°&lt;strong&gt;é…ç½®â†’Javaå¯¹è±¡&lt;/strong&gt;çš„ç±»å‹å®‰å…¨ç»‘å®šï¼Œæ”¯æŒå¤æ‚ç»“æ„ä¸æ ¡éªŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@EnableConfigurationProperties&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;strong&gt;æ¿€æ´»ç»‘å®šèƒ½åŠ›&lt;/strong&gt;å¹¶æ³¨å†ŒBeanï¼Œé€‚ç”¨äºæ¨¡å—åŒ–é…ç½®ç®¡ç†ã€‚
äºŒè€…åä½œæ˜¾è‘—æå‡é…ç½®ç®¡ç†çš„&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;â€‹ï¼ˆç±»å‹æ£€æŸ¥ï¼‰ä¸&lt;strong&gt;å¯ç»´æŠ¤æ€§&lt;/strong&gt;â€‹ï¼ˆé›†ä¸­ç®¡ç†ï¼‰ï¼Œæ˜¯Spring Bootâ€œçº¦å®šä¼˜äºé…ç½®â€ç†å¿µçš„æ ¸å¿ƒä½“ç°&lt;a class="link" href="@ref" &gt;1,6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="transactional"&gt;@Transactional
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring æ¡†æ¶ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt; å¹¶éå¿…é¡»æ­é… &lt;code&gt;@EnableTransactionManagement&lt;/code&gt; ä½¿ç”¨&lt;/strong&gt;ï¼Œå…·ä½“å–å†³äºé¡¹ç›®ç±»å‹å’Œé…ç½®æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-spring-boot-é¡¹ç›®ä¸­æ— éœ€æ˜¾å¼æ·»åŠ "&gt;âš™ï¸ &lt;strong&gt;Spring Boot é¡¹ç›®ä¸­æ— éœ€æ˜¾å¼æ·»åŠ  &lt;code&gt;@EnableTransactionManagement&lt;/code&gt;&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®æœºåˆ¶&lt;/strong&gt;
Spring Boot é€šè¿‡ &lt;code&gt;TransactionAutoConfiguration&lt;/code&gt; è‡ªåŠ¨å¯ç”¨äº‹åŠ¡ç®¡ç†ã€‚åªè¦é¡¹ç›®ä¸­å¼•å…¥äº†äº‹åŠ¡ç›¸å…³çš„ä¾èµ–ï¼ˆå¦‚ &lt;code&gt;spring-boot-starter-data-jpa&lt;/code&gt;ã€&lt;code&gt;spring-boot-starter-jdbc&lt;/code&gt;ï¼‰ï¼ŒSpring Boot ä¼šé»˜è®¤æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ï¼ˆ&lt;code&gt;PlatformTransactionManager&lt;/code&gt;ï¼‰å¹¶å¼€å¯äº‹åŠ¡ä»£ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ  &lt;code&gt;@EnableTransactionManagement&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯æ–¹å¼&lt;/strong&gt;
æ£€æŸ¥ Spring Boot å¯åŠ¨ç±»ä¸Šçš„ &lt;code&gt;@SpringBootApplication&lt;/code&gt; æ³¨è§£ï¼Œå®ƒç»„åˆäº† &lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;ï¼Œåè€…ä¼šåŠ è½½ &lt;code&gt;META-INF/spring.factories&lt;/code&gt; ä¸­çš„ &lt;code&gt;TransactionAutoConfiguration&lt;/code&gt;ï¼Œè‡ªåŠ¨å®Œæˆäº‹åŠ¡é…ç½®&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¼ ç»Ÿ-spring-é¡¹ç›®ä¸­å¿…é¡»æ˜¾å¼å¯ç”¨äº‹åŠ¡"&gt;âš™ï¸ &lt;strong&gt;ä¼ ç»Ÿ Spring é¡¹ç›®ä¸­å¿…é¡»æ˜¾å¼å¯ç”¨äº‹åŠ¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;éœ€è¦æ‰‹åŠ¨å¯ç”¨
åœ¨é Spring Boot çš„ Spring é¡¹ç›®ä¸­ï¼ˆå¦‚ XML é…ç½®çš„æ—§é¡¹ç›®ï¼‰ï¼Œå¿…é¡»é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€å¯ç”¨äº‹åŠ¡ç®¡ç†ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£é©±åŠ¨&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»æ·»åŠ  &lt;code&gt;@EnableTransactionManagement&lt;/code&gt;&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;XML é…ç½®&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;&amp;lt;tx:annotation-driven /&amp;gt;&lt;/code&gt; æ ‡ç­¾&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½œç”¨åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @EnableTransactionManagement
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¼šæ³¨å†Œå…³é”®ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AutoProxyRegistrar&lt;/code&gt;ï¼šä¸ºç¬¦åˆæ¡ä»¶çš„ Bean åˆ›å»º AOP ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ProxyTransactionManagementConfiguration&lt;/code&gt;ï¼šæ³¨å…¥äº‹åŠ¡æ‹¦æˆªå™¨ï¼ˆ&lt;code&gt;TransactionInterceptor&lt;/code&gt;ï¼‰ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åç®¡ç†äº‹åŠ¡çš„å¼€å¯ã€æäº¤æˆ–å›æ»š&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä½•æ—¶éœ€è¦æ˜¾å¼æ·»åŠ "&gt;âš™ï¸ &lt;strong&gt;ä½•æ—¶éœ€è¦æ˜¾å¼æ·»åŠ  &lt;code&gt;@EnableTransactionManagement&lt;/code&gt;ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å°½ç®¡ Spring Boot é»˜è®¤æ”¯æŒäº‹åŠ¡ï¼Œä½†ä»¥ä¸‹åœºæ™¯éœ€æ‰‹åŠ¨æ·»åŠ ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰äº‹åŠ¡ç®¡ç†å™¨&lt;/strong&gt;
è¦†ç›–é»˜è®¤é…ç½®æ—¶ï¼ˆå¦‚å¤šæ•°æ®æºåœºæ™¯ï¼‰ï¼Œéœ€é€šè¿‡ &lt;code&gt;@EnableTransactionManagement&lt;/code&gt; å…³è”è‡ªå®šä¹‰çš„ &lt;code&gt;PlatformTransactionManager&lt;/code&gt;&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒæ•´ä»£ç†æ¨¡å¼
é»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œè‹¥éœ€å¼ºåˆ¶ä½¿ç”¨ CGLib ä»£ç†ï¼ˆä»£ç†ç±»è€Œéæ¥å£ï¼‰ï¼Œå¯é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableTransactionManagement(proxyTargetClass = true)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶äº‹åŠ¡æ‹¦æˆªé¡ºåº&lt;/strong&gt;
é€šè¿‡ &lt;code&gt;order&lt;/code&gt; å±æ€§è°ƒæ•´äº‹åŠ¡æ‹¦æˆªå™¨åœ¨ AOP é“¾ä¸­çš„ä¼˜å…ˆçº§&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡å¤±æ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸é…ç½®æ— å…³ï¼Œè€Œæ˜¯å› ï¼š - è‡ªè°ƒç”¨ï¼ˆç±»å†…æ–¹æ³•è°ƒç”¨ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt; - é &lt;code&gt;public&lt;/code&gt; æ–¹æ³•&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt; - å¼‚å¸¸è¢«æ•è·æœªæŠ›å‡º&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯¯ä»¥ä¸ºæ³¨è§£æ— æ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ Spring Boot ä¸­çœç•¥ &lt;code&gt;@EnableTransactionManagement&lt;/code&gt; æ˜¯å®‰å…¨çš„ï¼Œå¤±æ•ˆéœ€æ£€æŸ¥å…¶ä»–åŸå› &lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“é…ç½®å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šé…ç½®å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é¡¹ç›®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦éœ€è¦ &lt;code&gt;@EnableTransactionManagement&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring Boot&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸éœ€è¦&lt;/td&gt;
&lt;td&gt;ä¾èµ–è‡ªåŠ¨é…ç½®ï¼Œæ˜¾å¼æ·»åŠ å†—ä½™&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼ ç»Ÿ Spring é¡¹ç›®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… éœ€è¦&lt;/td&gt;
&lt;td&gt;å¿…é¡»æ˜¾å¼å¯ç”¨äº‹åŠ¡ä»£ç†&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‰¹æ®Šåœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âš ï¸ æŒ‰éœ€æ·»åŠ &lt;/td&gt;
&lt;td&gt;å¦‚å¤šæ•°æ®æºã€è‡ªå®šä¹‰ä»£ç†æ¨¡å¼æˆ–è°ƒæ•´æ‹¦æˆªé¡ºåº&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Spring Boot é¡¹ç›®ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥äº‹åŠ¡ä¸ç”Ÿæ•ˆï¼Œä¼˜å…ˆæ’æŸ¥æ–¹æ³•å¯è§æ€§ã€è‡ªè°ƒç”¨æˆ–å¼‚å¸¸å¤„ç†é€»è¾‘&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id="åº•å±‚å®ç°"&gt;åº•å±‚å®ç°
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Transactional&lt;/code&gt; æ˜¯ Spring æ¡†æ¶å®ç°å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶åº•å±‚å®ç°åŸºäº &lt;strong&gt;AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰&lt;/strong&gt; å’Œ&lt;strong&gt;äº‹åŠ¡ç®¡ç†å™¨ï¼ˆ&lt;code&gt;PlatformTransactionManager&lt;/code&gt;ï¼‰&lt;/strong&gt; çš„ååŒå·¥ä½œã€‚ä»¥ä¸‹æ˜¯å…¶åº•å±‚å®ç°çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå®ç°æœºåˆ¶åŠ¨æ€ä»£ç†ä¸æ‹¦æˆªå™¨"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒå®ç°æœºåˆ¶ï¼šåŠ¨æ€ä»£ç†ä¸æ‹¦æˆªå™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†å¯¹è±¡ç”Ÿæˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å½“ Spring å®¹å™¨æ£€æµ‹åˆ° &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£æ—¶ï¼Œä¼šä¸ºç›®æ ‡ Beanï¼ˆå¦‚ Service ç±»ï¼‰åˆ›å»º&lt;strong&gt;ä»£ç†å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç†ç±»å‹ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥ç›®æ ‡ç±»å®ç°äº†æ¥å£ â†’ ä½¿ç”¨ &lt;strong&gt;JDK åŠ¨æ€ä»£ç†&lt;/strong&gt;ï¼ˆåŸºäºæ¥å£ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ç›®æ ‡ç±»æ— æ¥å£ â†’ ä½¿ç”¨ &lt;strong&gt;CGLIB å­—èŠ‚ç å¢å¼º&lt;/strong&gt;ï¼ˆåŸºäºç±»ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç†çš„ä½œç”¨&lt;/strong&gt;ï¼šæ‹¦æˆªç›®æ ‡æ–¹æ³•çš„è°ƒç”¨ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥äº‹åŠ¡ç®¡ç†é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ‹¦æˆªå™¨ï¼ˆ&lt;code&gt;TransactionInterceptor&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œä¼šè§¦å‘ &lt;code&gt;TransactionInterceptor&lt;/code&gt;ï¼Œå®ƒæ˜¯äº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒæ‹¦æˆªå™¨&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œæµç¨‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[å¼€å§‹] --&amp;gt; B[è·å–äº‹åŠ¡å±æ€§]
B --&amp;gt; C{æ˜¯å¦å­˜åœ¨äº‹åŠ¡ï¼Ÿ}
C -- æ˜¯ --&amp;gt; D[åŠ å…¥ç°æœ‰äº‹åŠ¡]
C -- å¦ --&amp;gt; E[åˆ›å»ºæ–°äº‹åŠ¡]
D &amp;amp; E --&amp;gt; F[æ‰§è¡Œä¸šåŠ¡æ–¹æ³•]
F --&amp;gt; G{æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Ÿ}
G -- æ˜¯ --&amp;gt; H[å›æ»šäº‹åŠ¡]
G -- å¦ --&amp;gt; I[æäº¤äº‹åŠ¡]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å…³é”®æ­¥éª¤ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å¯äº‹åŠ¡&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;PlatformTransactionManager&lt;/code&gt; è·å–æ•°æ®åº“è¿æ¥ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼ˆ&lt;code&gt;autoCommit=false&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‘å®šèµ„æº&lt;/strong&gt;ï¼šå°†è¿æ¥ç»‘å®šåˆ°å½“å‰çº¿ç¨‹çš„ &lt;code&gt;ThreadLocal&lt;/code&gt;ï¼ˆé€šè¿‡ &lt;code&gt;TransactionSynchronizationManager&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šè‹¥æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼ˆé»˜è®¤ä»… &lt;code&gt;RuntimeException&lt;/code&gt;ï¼‰ï¼Œå›æ»šäº‹åŠ¡ï¼›å¦åˆ™æäº¤äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº‹åŠ¡ç®¡ç†å™¨"&gt;ğŸ§© &lt;strong&gt;äº‹åŠ¡ç®¡ç†å™¨ï¼ˆ&lt;code&gt;PlatformTransactionManager&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæŠ½è±¡äº‹åŠ¡æ“ä½œï¼ˆå¼€å¯ã€æäº¤ã€å›æ»šï¼‰ï¼Œé€‚é…ä¸åŒæŒä¹…åŒ–æ¡†æ¶ï¼ˆJDBCã€JPA ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¸¸è§å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;DataSourceTransactionManager&lt;/code&gt;ï¼šç”¨äº JDBC æˆ– MyBatisã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;JpaTransactionManager&lt;/code&gt;ï¼šç”¨äº JPA/Hibernateã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;JtaTransactionManager&lt;/code&gt;ï¼šç”¨äºåˆ†å¸ƒå¼äº‹åŠ¡&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡å®šä¹‰ï¼ˆ&lt;code&gt;TransactionDefinition&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼š
å°è£… &lt;code&gt;@Transactional&lt;/code&gt; çš„å±æ€§ï¼ˆä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€è¶…æ—¶æ—¶é—´ç­‰ï¼‰ï¼Œä¼ é€’ç»™äº‹åŠ¡ç®¡ç†å™¨æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äº‹åŠ¡ä¼ æ’­è¡Œä¸ºpropagationçš„å®ç°"&gt;ğŸ”„ &lt;strong&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆPropagationï¼‰çš„å®ç°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¼ æ’­è¡Œä¸ºå†³å®š&lt;strong&gt;åµŒå¥—æ–¹æ³•è°ƒç”¨æ—¶äº‹åŠ¡çš„è¾¹ç•Œ&lt;/strong&gt;ã€‚ä»¥å¸¸è§è¡Œä¸ºä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼ æ’­è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®ç°é€»è¾‘&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;REQUIREDï¼ˆé»˜è®¤ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‹¥å½“å‰æ— äº‹åŠ¡ â†’ æ–°å»ºäº‹åŠ¡ï¼›è‹¥æœ‰äº‹åŠ¡ â†’ åŠ å…¥ç°æœ‰äº‹åŠ¡ã€‚åµŒå¥—æ–¹æ³•å…±ç”¨åŒä¸€è¿æ¥ï¼ŒåŒç”Ÿå…±æ­»&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;REQUIRES_NEW&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— è®ºå½“å‰æ˜¯å¦æœ‰äº‹åŠ¡ â†’ æŒ‚èµ·ç°æœ‰äº‹åŠ¡ï¼ˆè‹¥æœ‰ï¼‰ï¼Œæ–°å»ºç‹¬ç«‹äº‹åŠ¡ã€‚ä½¿ç”¨&lt;strong&gt;æ–°æ•°æ®åº“è¿æ¥&lt;/strong&gt;ï¼Œå†…å±‚äº‹åŠ¡æäº¤/å›æ»šä¸å½±å“å¤–å±‚&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NESTED&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‹¥å½“å‰æœ‰äº‹åŠ¡ â†’ åˆ›å»º&lt;strong&gt;åµŒå¥—äº‹åŠ¡&lt;/strong&gt;ï¼ˆæ•°æ®åº“ Savepointï¼‰ï¼Œå†…å±‚å›æ»šä¸å½±å“å¤–å±‚ï¼ˆéœ€æ•°æ®åº“æ”¯æŒï¼Œå¦‚ MySQL InnoDBï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æŒ‚èµ·äº‹åŠ¡çš„å®ç°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;TransactionSynchronizationManager.unbindResource()&lt;/code&gt; è§£ç»‘å½“å‰è¿æ¥ï¼Œæ–°äº‹åŠ¡ç»‘å®šæ–°è¿æ¥&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§å¤±æ•ˆåœºæ™¯ä¸åº•å±‚åŸå› "&gt;âš ï¸ &lt;strong&gt;å¸¸è§å¤±æ•ˆåœºæ™¯ä¸åº•å±‚åŸå› &lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªè°ƒç”¨é—®é¢˜ï¼ˆç±»å†…æ–¹æ³•è°ƒç”¨ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šç±»å†…æ–¹æ³• &lt;code&gt;A&lt;/code&gt; è°ƒç”¨ &lt;code&gt;B&lt;/code&gt;ï¼ˆ&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰æ—¶ï¼Œ&lt;code&gt;B&lt;/code&gt; é€šè¿‡ &lt;code&gt;this&lt;/code&gt; è°ƒç”¨ï¼ˆéä»£ç†å¯¹è±¡ï¼‰ï¼Œç»•è¿‡äº‹åŠ¡æ‹¦æˆªå™¨&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ä¾èµ–æ³¨å…¥è‡ªèº«ä»£ç†ï¼š&lt;code&gt;self.methodB()&lt;/code&gt;ï¼ˆéœ€å¼€å¯ &lt;code&gt;exposeProxy=true&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;AopContext.currentProxy()&lt;/code&gt; è·å–ä»£ç†å¯¹è±¡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é public æ–¹æ³•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šSpring AOP ä»…ä»£ç† public æ–¹æ³•ï¼Œé public æ–¹æ³•ä¸Šçš„æ³¨è§£è¢«å¿½ç•¥&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸è¢«åæ²¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šé»˜è®¤ä»…å¯¹ &lt;code&gt;RuntimeException&lt;/code&gt; å›æ»šã€‚è‹¥æ•è·å¼‚å¸¸æœªæŠ›å‡ºæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;IOException&lt;/code&gt;ï¼‰ï¼Œäº‹åŠ¡ä¸å›æ»š&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional(rollbackFor = Exception.class) // æŒ‡å®šæ‰€æœ‰å¼‚å¸¸å›æ»š
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸ç¼–ç¨‹å¼äº‹åŠ¡çš„å¯¹æ¯”"&gt;ğŸ”§ &lt;strong&gt;ä¸ç¼–ç¨‹å¼äº‹åŠ¡çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å£°æ˜å¼äº‹åŠ¡ï¼ˆ&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼–ç¨‹å¼äº‹åŠ¡ï¼ˆ&lt;code&gt;TransactionTemplate&lt;/code&gt;ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;AOP åŠ¨æ€ä»£ç†&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨ç¼–å†™äº‹åŠ¡ä»£ç ï¼ˆtry-catch å—ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ä¾µå…¥æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆæ³¨è§£å£°æ˜ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€æ˜¾å¼è°ƒç”¨ &lt;code&gt;commit()&lt;/code&gt;/&lt;code&gt;rollback()&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–é¢„å®šä¹‰å±æ€§ï¼ˆä¼ æ’­è¡Œä¸ºç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;å¯ç²¾ç»†æ§åˆ¶äº‹åŠ¡è¾¹ç•Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤§å¤šæ•°ä¸šåŠ¡æ–¹æ³•&lt;/td&gt;
&lt;td&gt;å¤æ‚äº‹åŠ¡æµï¼ˆå¦‚æ¡ä»¶æäº¤ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“æ ¸å¿ƒæµç¨‹ä¸ç»„ä»¶"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šæ ¸å¿ƒæµç¨‹ä¸ç»„ä»¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æµç¨‹é“¾&lt;/strong&gt;ï¼š
&lt;code&gt;@Transactional&lt;/code&gt; â†’ åŠ¨æ€ä»£ç† â†’ &lt;code&gt;TransactionInterceptor&lt;/code&gt; â†’ &lt;code&gt;PlatformTransactionManager&lt;/code&gt; â†’ æ•°æ®åº“è¿æ¥æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®è®¾è®¡æ€æƒ³ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³æ³¨ç‚¹åˆ†ç¦»&lt;/strong&gt;ï¼šä¸šåŠ¡é€»è¾‘ä¸äº‹åŠ¡ç®¡ç†è§£è€¦ï¼ˆAOP å®ç°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç»‘å®š&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;ThreadLocal&lt;/code&gt; ç¡®ä¿åŒä¸€çº¿ç¨‹å†…äº‹åŠ¡èµ„æºä¸€è‡´&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å…åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œè¿œç¨‹è°ƒç”¨æˆ–å¤æ‚è®¡ç®—ï¼ˆé•¿äº‹åŠ¡é˜»å¡è¿æ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åªè¯»äº‹åŠ¡ï¼ˆ&lt;code&gt;readOnly=true&lt;/code&gt;ï¼‰å¯å¯ç”¨æ•°æ®åº“ä¼˜åŒ–ç­–ç•¥&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ç†è§£åº•å±‚æœºåˆ¶å¯é¿å…äº‹åŠ¡å¤±æ•ˆé—®é¢˜ï¼Œå¹¶ä¼˜åŒ–é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å½“å‰äº‹åŠ¡"&gt;å½“å‰äº‹åŠ¡
&lt;/h2&gt;&lt;p&gt;åœ¨Springçš„&lt;code&gt;@Transactional&lt;/code&gt;äº‹åŠ¡ç®¡ç†ä¸­ï¼Œâ€œå½“å‰æ˜¯å¦æœ‰äº‹åŠ¡â€&lt;strong&gt;ä¸ä»…é™äºåµŒå¥—æ–¹æ³•è°ƒç”¨&lt;/strong&gt;ï¼Œè€Œæ˜¯æŒ‡&lt;strong&gt;å½“å‰æ‰§è¡Œçº¿ç¨‹æ˜¯å¦å·²ç»‘å®šä¸€ä¸ªæ´»è·ƒçš„äº‹åŠ¡ä¸Šä¸‹æ–‡&lt;/strong&gt;ã€‚è¿™ä¸€æ¦‚å¿µçš„æ ¸å¿ƒåœ¨äºäº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼ˆPropagationï¼‰çš„è®¾è®¡ï¼ŒåµŒå¥—è°ƒç”¨åªæ˜¯è§¦å‘ä¼ æ’­è¡Œä¸ºçš„åœºæ™¯ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-"&gt;âš™ï¸ &lt;strong&gt;&amp;ldquo;å½“å‰äº‹åŠ¡&amp;quot;çš„æœ¬è´¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹ç»‘å®šçš„äº‹åŠ¡ä¸Šä¸‹æ–‡&lt;/strong&gt;
Springé€šè¿‡&lt;code&gt;ThreadLocal&lt;/code&gt;å°†äº‹åŠ¡èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥ï¼‰ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ã€‚è‹¥çº¿ç¨‹å·²å­˜åœ¨äº‹åŠ¡ç®¡ç†å™¨åˆ›å»ºçš„æ´»è·ƒäº‹åŠ¡ï¼Œåˆ™è§†ä¸ºâ€œå½“å‰æœ‰äº‹åŠ¡â€&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„è§¦å‘æ¡ä»¶
å½“è°ƒç”¨
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional
&lt;/code&gt;&lt;/pre&gt;æ–¹æ³•æ—¶ï¼ŒSpringä¼šæ£€æŸ¥
å½“å‰çº¿ç¨‹çš„äº‹åŠ¡çŠ¶æ€
ï¼Œè€Œéä»…é™äºåµŒå¥—è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;æ–¹æ³•Aï¼ˆæ— äº‹åŠ¡ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆ&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰â†’ çº¿ç¨‹æ— äº‹åŠ¡ï¼Œæ–¹æ³•Bæ–°å»ºäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•Aï¼ˆæœ‰äº‹åŠ¡ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆ&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰â†’ çº¿ç¨‹æœ‰äº‹åŠ¡ï¼Œæ–¹æ³•Bæ ¹æ®ä¼ æ’­è¡Œä¸ºå†³å®šåŠ å…¥æˆ–æŒ‚èµ·äº‹åŠ¡&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åµŒå¥—è°ƒç”¨ä¸­çš„ä¼ æ’­è¡Œä¸ºç¤ºä¾‹"&gt;ğŸ”„ &lt;strong&gt;åµŒå¥—è°ƒç”¨ä¸­çš„ä¼ æ’­è¡Œä¸ºç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹åœºæ™¯è¯´æ˜â€œå½“å‰äº‹åŠ¡â€å¦‚ä½•å½±å“åµŒå¥—æ–¹æ³•ï¼š&lt;/p&gt;
&lt;h4 id="é»˜è®¤ä¼ æ’­è¡Œä¸º"&gt;&lt;strong&gt;é»˜è®¤ä¼ æ’­è¡Œä¸º &lt;code&gt;REQUIRED&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ–¹æ³•Aï¼ˆæœ‰äº‹åŠ¡ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆ&lt;code&gt;@Transactional(propagation = REQUIRED)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šæ–¹æ³•BåŠ å…¥æ–¹æ³•Açš„äº‹åŠ¡ï¼Œä¸¤è€…å…±äº«åŒä¸€äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚ä»»ä¸€æ–¹æ³•å¼‚å¸¸ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å›æ»š&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šæ­¤æ—¶â€œå½“å‰äº‹åŠ¡â€æŒ‡æ–¹æ³•Aå·²åˆ›å»ºçš„äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç‹¬ç«‹äº‹åŠ¡"&gt;&lt;strong&gt;ç‹¬ç«‹äº‹åŠ¡ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ–¹æ³•Aï¼ˆæœ‰äº‹åŠ¡ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆ&lt;code&gt;@Transactional(propagation = REQUIRES_NEW)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šæ–¹æ³•BæŒ‚èµ·æ–¹æ³•Açš„äº‹åŠ¡ï¼Œåˆ›å»ºæ–°äº‹åŠ¡ã€‚æ–¹æ³•Bçš„æäº¤/å›æ»šä¸å½±å“æ–¹æ³•Aï¼Œä½†æ–¹æ³•Aå¼‚å¸¸ä¸å½±å“æ–¹æ³•Bå·²æäº¤çš„æ•°æ®&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šçº¿ç¨‹ä¸­åŸæœ‰äº‹åŠ¡è¢«æŒ‚èµ·ï¼Œæ–°äº‹åŠ¡æˆä¸ºâ€œå½“å‰äº‹åŠ¡â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åµŒå¥—äº‹åŠ¡"&gt;&lt;strong&gt;åµŒå¥—äº‹åŠ¡ &lt;code&gt;NESTED&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ–¹æ³•Aï¼ˆæœ‰äº‹åŠ¡ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆ&lt;code&gt;@Transactional(propagation = NESTED)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šæ–¹æ³•Båœ¨æ–¹æ³•Açš„äº‹åŠ¡å†…åˆ›å»º&lt;strong&gt;åµŒå¥—å­äº‹åŠ¡&lt;/strong&gt;ï¼ˆæ•°æ®åº“Savepointï¼‰ã€‚æ–¹æ³•Bå¯ç‹¬ç«‹å›æ»šï¼Œä½†æ–¹æ³•Aå›æ»šä¼šè¿å¸¦æ–¹æ³•Bå›æ»š&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§è¯¯è§£æ¾„æ¸…"&gt;âš ï¸ &lt;strong&gt;å¸¸è§è¯¯è§£æ¾„æ¸…&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;éåµŒå¥—è°ƒç”¨ä¹Ÿå¯èƒ½å­˜åœ¨â€œå½“å‰äº‹åŠ¡â€&lt;/strong&gt;
ä¾‹å¦‚ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä¸­å¤šæ¬¡è°ƒç”¨DAOå±‚æ–¹æ³•ï¼Œæ‰€æœ‰æ“ä½œå‡åŠ å…¥åŒä¸€äº‹åŠ¡ï¼Œæ— éœ€åµŒå¥—æ³¨è§£&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨çº¿ç¨‹è°ƒç”¨äº‹åŠ¡å¤±æ•ˆ&lt;/strong&gt;
è‹¥é€šè¿‡æ–°çº¿ç¨‹è°ƒç”¨&lt;code&gt;@Transactional&lt;/code&gt;æ–¹æ³•ï¼Œæ–°çº¿ç¨‹æ— åŸäº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œå³ä½¿åŸçº¿ç¨‹æœ‰äº‹åŠ¡ï¼Œæ–°æ–¹æ³•ä»è§†ä¸ºâ€œæ— å½“å‰äº‹åŠ¡â€&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªè°ƒç”¨é—®é¢˜&lt;/strong&gt;
åŒç±»ä¸­éäº‹åŠ¡æ–¹æ³•Aè°ƒç”¨äº‹åŠ¡æ–¹æ³•Bæ—¶ï¼Œç”±äºæœªé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œæ–¹æ³•Bçš„&lt;code&gt;@Transactional&lt;/code&gt;å¤±æ•ˆ â†’ çº¿ç¨‹å§‹ç»ˆâ€œæ— å½“å‰äº‹åŠ¡â€&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“åˆ¤æ–­å½“å‰äº‹åŠ¡çš„å…³é”®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šåˆ¤æ–­â€œå½“å‰äº‹åŠ¡â€çš„å…³é”®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦æœ‰å½“å‰äº‹åŠ¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å†³å®šå› ç´ &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åµŒå¥—è°ƒç”¨ + ä¼ æ’­è¡Œä¸º&lt;code&gt;REQUIRED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å¤–å±‚æ–¹æ³•æ˜¯å¦å·²å¼€å¯äº‹åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åµŒå¥—è°ƒç”¨ + ä¼ æ’­è¡Œä¸º&lt;code&gt;REQUIRES_NEW&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦ï¼ˆæŒ‚èµ·å¤–å±‚ï¼‰&lt;/td&gt;
&lt;td&gt;ä¼ æ’­è¡Œä¸ºå¼ºåˆ¶æ–°å»ºäº‹åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è·¨çº¿ç¨‹è°ƒç”¨&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;çº¿ç¨‹éš”ç¦»æ€§ï¼ˆ&lt;code&gt;ThreadLocal&lt;/code&gt;ä¸å…±äº«ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªè°ƒç”¨ï¼ˆåŒç±»éä»£ç†è°ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;AOPä»£ç†æœºåˆ¶å¤±æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;å› æ­¤ï¼Œâ€œå½“å‰æ˜¯å¦æœ‰äº‹åŠ¡â€å–å†³äº&lt;strong&gt;çº¿ç¨‹ç»‘å®šçš„äº‹åŠ¡ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼ŒåµŒå¥—è°ƒç”¨ä»…æ˜¯å…¶ä¸­ä¸€ç§è§¦å‘ä¼ æ’­è¡Œä¸ºçš„åœºæ™¯ï¼Œè€Œéå”¯ä¸€æ¡ä»¶&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚å®é™…å¼€å‘ä¸­éœ€ç»“åˆä¼ æ’­è¡Œä¸ºé…ç½®ã€è°ƒç”¨æ–¹å¼åŠçº¿ç¨‹æ¨¡å‹ç»¼åˆåˆ¤æ–­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="transactional-åµŒå¥—"&gt;@Transactional åµŒå¥—
&lt;/h2&gt;&lt;p&gt;åœ¨Springçš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ä¸­ï¼Œ&lt;strong&gt;è¢«è°ƒæ–¹æ³•æ˜¯å¦æ·»åŠ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ä»¥åŠå¤–å±‚æ–¹æ³•çš„æ³¨è§£é…ç½®&lt;/strong&gt;ä¼šç›´æ¥å½±å“äº‹åŠ¡çš„è¾¹ç•Œã€ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»æ€§ã€‚æ˜¯å¦â€œåªéœ€æœ€å¤–å±‚æ³¨è§£â€å–å†³äºä¸šåŠ¡åœºæ™¯å’Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„é…ç½®ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒåŒºåˆ«å’Œé…ç½®ç­–ç•¥çš„åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è¢«è°ƒæ–¹æ³•æœ‰æ— "&gt;âš™ï¸ &lt;strong&gt;è¢«è°ƒæ–¹æ³•æœ‰æ— &lt;code&gt;@Transactional&lt;/code&gt;çš„åŒºåˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ— æ³¨è§£æ—¶çš„äº‹åŠ¡è¡Œä¸º"&gt;&lt;strong&gt;æ— æ³¨è§£æ—¶çš„äº‹åŠ¡è¡Œä¸º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é»˜è®¤åŠ å…¥å¤–å±‚äº‹åŠ¡
è‹¥è¢«è°ƒæ–¹æ³•æ— 
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional
&lt;/code&gt;&lt;/pre&gt;æ³¨è§£ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ä¼ æ’­è¡Œä¸º
&lt;pre tabindex="0"&gt;&lt;code&gt;Propagation.REQUIRED
&lt;/code&gt;&lt;/pre&gt;ï¼Œå³ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥å¤–å±‚æ–¹æ³•æœ‰äº‹åŠ¡ï¼Œåˆ™&lt;strong&gt;åŠ å…¥è¯¥äº‹åŠ¡&lt;/strong&gt;ï¼ˆå…±ç”¨åŒä¸€äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥å¤–å±‚æ— äº‹åŠ¡ï¼Œåˆ™&lt;strong&gt;ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ&lt;/strong&gt;ï¼ˆæ— äº‹åŠ¡ä¿æŠ¤ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é£é™©&lt;/li&gt;
&lt;li&gt;è‹¥è¢«è°ƒæ–¹æ³•éœ€ç‹¬ç«‹äº‹åŠ¡ï¼ˆå¦‚è®°å½•æ—¥å¿—ï¼Œä¸å—ä¸»ä¸šåŠ¡å›æ»šå½±å“ï¼‰ï¼Œåˆ™æ— æ³•å®ç°ã€‚
&lt;ul&gt;
&lt;li&gt;è‹¥è¢«è°ƒæ–¹æ³•æŠ›å¼‚å¸¸ä¸”æœªè¢«æ•è·ï¼Œä¼šå¯¼è‡´æ•´ä¸ªå¤–å±‚äº‹åŠ¡å›æ»š&lt;a class="link" href="@ref" &gt;3,5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æœ‰æ³¨è§£æ—¶çš„äº‹åŠ¡è¡Œä¸º"&gt;&lt;strong&gt;æœ‰æ³¨è§£æ—¶çš„äº‹åŠ¡è¡Œä¸º&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡é…ç½®ä¼ æ’­è¡Œä¸ºï¼ˆ&lt;code&gt;propagation&lt;/code&gt;ï¼‰ï¼Œå¯çµæ´»æ§åˆ¶äº‹åŠ¡è¾¹ç•Œï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼ æ’­è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;REQUIRED&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ å…¥å¤–å±‚äº‹åŠ¡ï¼›è‹¥æ— å¤–å±‚äº‹åŠ¡åˆ™æ–°å»º&lt;/td&gt;
&lt;td&gt;é»˜è®¤åœºæ™¯ï¼ˆå¦‚è®¢å•åˆ›å»º+åº“å­˜æ‰£å‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æŒ‚èµ·å¤–å±‚äº‹åŠ¡&lt;/strong&gt;ï¼Œåˆ›å»ºç‹¬ç«‹æ–°äº‹åŠ¡ã€‚æ–°äº‹åŠ¡æäº¤/å›æ»šä¸å½±å“å¤–å±‚äº‹åŠ¡&lt;/td&gt;
&lt;td&gt;æ—¥å¿—è®°å½•ã€å¼‚æ­¥ä»»åŠ¡&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;NESTED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å¤–å±‚äº‹åŠ¡å†…åˆ›å»ºåµŒå¥—å­äº‹åŠ¡ï¼ˆSavepointï¼‰ï¼Œå­äº‹åŠ¡å¯ç‹¬ç«‹å›æ»šï¼Œå¤–å±‚å›æ»šåˆ™å­äº‹åŠ¡å›æ»š&lt;/td&gt;
&lt;td&gt;éƒ¨åˆ†æ“ä½œéœ€ç‹¬ç«‹å›æ»šï¼ˆå¦‚ä¼˜æƒ åˆ¸ä½¿ç”¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;NOT_SUPPORTED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ŒæŒ‚èµ·å¤–å±‚äº‹åŠ¡&lt;/td&gt;
&lt;td&gt;éæ ¸å¿ƒæ“ä½œï¼ˆå¦‚æ•°æ®ç»Ÿè®¡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class OrderService {
@Transactional
public void createOrder(Order order) {
// ä¸»ä¸šåŠ¡é€»è¾‘ï¼ˆåŒä¸€äº‹åŠ¡ï¼‰
orderDao.save(order);
// è°ƒç”¨éœ€ç‹¬ç«‹äº‹åŠ¡çš„æ–¹æ³•
logService.recordLog(order); // éœ€é…ç½®REQUIRES_NEW
}
}
@Service
public class LogService {
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void recordLog(Order order) {
// ç‹¬ç«‹äº‹åŠ¡ï¼Œå³ä½¿createOrderå›æ»šï¼Œæ—¥å¿—ä»ä¿ç•™
logDao.save(new Log(&amp;#34;Order created&amp;#34;));
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ä»…å¤–å±‚æ·»åŠ "&gt;âš ï¸ &lt;strong&gt;ä»…å¤–å±‚æ·»åŠ &lt;code&gt;@Transactional&lt;/code&gt;çš„å±€é™æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•åŸå­æ“ä½œ&lt;/strong&gt;ï¼šæ‰€æœ‰æ•°æ®åº“æ“ä½œéœ€ä½œä¸ºä¸€ä¸ªæ•´ä½“æäº¤æˆ–å›æ»šï¼ˆå¦‚è½¬è´¦ï¼šæ‰£æ¬¾+å…¥è´¦ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— ç‹¬ç«‹äº‹åŠ¡éœ€æ±‚&lt;/strong&gt;ï¼šæ— éœ€éƒ¨åˆ†æ“ä½œç‹¬ç«‹äºä¸»äº‹åŠ¡æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éœ€éƒ¨åˆ†æ“ä½œç‹¬ç«‹æäº¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æ—¥å¿—è®°å½•éœ€æŒä¹…åŒ–ï¼Œä¸å—ä¸»äº‹åŠ¡å¤±è´¥å½±å“&lt;/td&gt;
&lt;td&gt;å†…å±‚æ–¹æ³•æ·»åŠ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é¿å…é•¿äº‹åŠ¡é”ç«äº‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è€—æ—¶æ“ä½œï¼ˆå¦‚æ–‡ä»¶å¤„ç†ï¼‰é˜»å¡ä¸»äº‹åŠ¡ï¼Œå¢åŠ æ­»é”é£é™©&lt;/td&gt;
&lt;td&gt;å†…å±‚æ–¹æ³•æ·»åŠ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;æˆ–&lt;code&gt;NOT_SUPPORTED&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åµŒå¥—äº‹åŠ¡å›æ»šæ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éƒ¨åˆ†æ“ä½œå¤±è´¥æ—¶åªå›æ»šå­æ“ä½œï¼ˆå¦‚ä¼˜æƒ åˆ¸ä½¿ç”¨å¤±è´¥ï¼Œä½†è®¢å•ä»éœ€åˆ›å»ºï¼‰&lt;/td&gt;
&lt;td&gt;å†…å±‚æ–¹æ³•æ·»åŠ &lt;code&gt;NESTED&lt;/code&gt;ï¼ˆéœ€æ•°æ®åº“æ”¯æŒï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å†…å¤–å±‚ååŒé…ç½®çš„æœ€ä½³å®è·µ"&gt;ğŸ”§ &lt;strong&gt;å†…å¤–å±‚ååŒé…ç½®çš„æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ˜ç¡®ä¼ æ’­è¡Œä¸º"&gt;&lt;strong&gt;æ˜ç¡®ä¼ æ’­è¡Œä¸º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤ç­–ç•¥ï¼ˆ&lt;code&gt;REQUIRED&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šé€‚åˆå¤§å¤šæ•°ä¸šåŠ¡æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼ºåˆ¶ç‹¬ç«‹äº‹åŠ¡ï¼ˆ&lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šç”¨äºè¾…åŠ©æ“ä½œï¼ˆå¦‚æ—¥å¿—ã€æ¶ˆæ¯å‘é€ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åµŒå¥—äº‹åŠ¡ï¼ˆ&lt;code&gt;NESTED&lt;/code&gt;ï¼‰&lt;/strong&gt;ï¼šç”¨äºå¯éƒ¨åˆ†å›æ»šçš„å­æ“ä½œï¼ˆMySQLçš„InnoDBæ”¯æŒSavepointï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é¿å…è‡ªè°ƒç”¨å¤±æ•ˆ"&gt;&lt;strong&gt;é¿å…è‡ªè°ƒç”¨å¤±æ•ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šåŒç±»ä¸­æ–¹æ³•Aï¼ˆæ— äº‹åŠ¡ï¼‰è°ƒç”¨æ–¹æ³•Bï¼ˆæœ‰&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰ï¼ŒBçš„äº‹åŠ¡å¤±æ•ˆ&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;ul&gt;
&lt;li&gt;å°†æ–¹æ³•BæŠ½å–åˆ°å¦ä¸€ä¸ªBeanä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨AOPä»£ç†ï¼š&lt;code&gt;((MyService) AopContext.currentProxy()).methodB()&lt;/code&gt;ï¼ˆéœ€å¼€å¯&lt;code&gt;exposeProxy=true&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼‚å¸¸å¤„ç†è§„èŒƒ"&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†è§„èŒƒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å›æ»šè§„åˆ™ï¼šé»˜è®¤ä»…å›æ»š
&lt;pre tabindex="0"&gt;&lt;code&gt;RuntimeException
&lt;/code&gt;&lt;/pre&gt;å’Œ
&lt;pre tabindex="0"&gt;&lt;code&gt;Error
&lt;/code&gt;&lt;/pre&gt;ã€‚è‹¥éœ€å›æ»šå—æ£€å¼‚å¸¸ï¼ˆå¦‚
&lt;pre tabindex="0"&gt;&lt;code&gt;IOException
&lt;/code&gt;&lt;/pre&gt;ï¼‰ï¼Œéœ€æ˜¾å¼é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional(rollbackFor = Exception.class)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;é¿å…åå¼‚å¸¸ï¼šæ•è·å¼‚å¸¸åéœ€é‡æ–°æŠ›å‡ºæˆ–æ ‡è®°å›æ»šï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;try {
// ...
} catch (Exception e) {
TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
throw e;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä½•æ—¶åªéœ€æœ€å¤–å±‚æ³¨è§£"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šä½•æ—¶åªéœ€æœ€å¤–å±‚æ³¨è§£ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®å»ºè®®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰€æœ‰æ“ä½œéœ€åŸå­æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…å¤–å±‚åŠ &lt;code&gt;@Transactional&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦‚è®¢å•åˆ›å»º+åº“å­˜æ‰£å‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éƒ¨åˆ†æ“ä½œéœ€ç‹¬ç«‹äº‹åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†…å±‚åŠ &lt;code&gt;REQUIRES_NEW&lt;/code&gt;/&lt;code&gt;NESTED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æ—¥å¿—è®°å½•ã€ä¼˜æƒ åˆ¸ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éæ ¸å¿ƒæ“ä½œæ— éœ€äº‹åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†…å±‚åŠ &lt;code&gt;NOT_SUPPORTED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æ•°æ®ç»Ÿè®¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒç±»æ–¹æ³•è°ƒç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…è‡ªè°ƒç”¨ï¼ŒæŠ½å–åˆ°å…¶ä»–Bean&lt;/td&gt;
&lt;td&gt;é˜²æ­¢äº‹åŠ¡å¤±æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸èƒ½ç®€å•è®¤ä¸ºâ€œåªéœ€å¤–å±‚æ³¨è§£â€&lt;/strong&gt;ï¼šæ˜¯å¦æ·»åŠ å†…å±‚æ³¨è§£å–å†³äºä¸šåŠ¡æ˜¯å¦éœ€è¦ç‹¬ç«‹äº‹åŠ¡æ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³é”®é…ç½®åŸåˆ™&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤ç”¨&lt;code&gt;REQUIRED&lt;/code&gt;ä¿è¯åŸå­æ€§ï¼›&lt;/li&gt;
&lt;li&gt;éœ€éš”ç¦»æ“ä½œæ—¶ç”¨&lt;code&gt;REQUIRES_NEW&lt;/code&gt;æˆ–&lt;code&gt;NESTED&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;åŒç±»è°ƒç”¨éœ€é¿å…è‡ªè°ƒç”¨é—®é¢˜&lt;a class="link" href="@ref" &gt;1,4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="å¼‚å¸¸æ•æ‰"&gt;å¼‚å¸¸æ•æ‰
&lt;/h2&gt;&lt;p&gt;åœ¨Springçš„äº‹åŠ¡ç®¡ç†ä¸­ï¼Œå¼‚å¸¸è¢«æ•æ‰æˆ–é‡æŠ›åæ˜¯å¦è§¦å‘äº‹åŠ¡å›æ»šï¼Œå–å†³äº&lt;strong&gt;å¼‚å¸¸ç±»å‹&lt;/strong&gt;ã€&lt;strong&gt;å¤„ç†æ–¹å¼&lt;/strong&gt;ä»¥åŠ&lt;strong&gt;äº‹åŠ¡é…ç½®&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å¼‚å¸¸è¢«æ•è·ä½†æœªé‡æŠ›äº‹åŠ¡ä¸å›æ»š"&gt;âš™ï¸ &lt;strong&gt;å¼‚å¸¸è¢«æ•è·ä½†æœªé‡æŠ›ï¼ˆäº‹åŠ¡ä¸å›æ»šï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸º&lt;/strong&gt;ï¼š
è‹¥åœ¨äº‹åŠ¡æ–¹æ³•å†…éƒ¨ä½¿ç”¨ &lt;code&gt;try-catch&lt;/code&gt; æ•è·å¼‚å¸¸ä¸”æœªé‡æ–°æŠ›å‡ºï¼ŒSpringäº‹åŠ¡ç®¡ç†å™¨æ— æ³•æ„ŸçŸ¥å¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šæ­£å¸¸æäº¤&lt;a class="link" href="@ref" &gt;1,3,8&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional
public void method() {
try {
// ä¸šåŠ¡æ“ä½œï¼ˆå¦‚æ•°æ®åº“æ›´æ–°ï¼‰
throw new RuntimeException(&amp;#34;å¼‚å¸¸&amp;#34;);
} catch (Exception e) {
// ä»…è®°å½•æ—¥å¿—ï¼Œæœªé‡æŠ›å¼‚å¸¸ â†’ äº‹åŠ¡æäº¤ï¼
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨å›æ»šçš„è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
åœ¨ &lt;code&gt;catch&lt;/code&gt; å—ä¸­è°ƒç”¨ &lt;code&gt;TransactionAspectSupport.currentTransactionStatus().setRollbackOnly()&lt;/code&gt; æ˜¾å¼æ ‡è®°å›æ»š&lt;a class="link" href="@ref" &gt;1,4,9&lt;/a&gt;ã€‚
&lt;pre tabindex="0"&gt;&lt;code&gt;catch (Exception e) {
TransactionAspectSupport.currentTransactionStatus().setRollbackOnly(); // æ‰‹åŠ¨å›æ»š
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¼‚å¸¸è¢«æ•è·åé‡æŠ›æ˜¯å¦å›æ»šå–å†³äºå¼‚å¸¸ç±»å‹ä¸é…ç½®"&gt;ğŸ”„ &lt;strong&gt;å¼‚å¸¸è¢«æ•è·åé‡æŠ›ï¼ˆæ˜¯å¦å›æ»šå–å†³äºå¼‚å¸¸ç±»å‹ä¸é…ç½®ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯ä¸€é‡æŠ›"&gt;&lt;strong&gt;åœºæ™¯ä¸€ï¼šé‡æŠ› &lt;code&gt;RuntimeException&lt;/code&gt; æˆ– &lt;code&gt;Error&lt;/code&gt;ï¼ˆé»˜è®¤å›æ»šï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Springé»˜è®¤å¯¹æœªæ•è·çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; RuntimeException
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ–&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Error
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‡ªåŠ¨å›æ»š
1,7,8
ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional
public void method() {
try {
throw new IOException(&amp;#34;å—æ£€å¼‚å¸¸&amp;#34;);
} catch (IOException e) {
throw new RuntimeException(e); // é‡æŠ›ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ â†’ è§¦å‘å›æ»šï¼
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="åœºæ™¯äºŒé‡æŠ›æ£€æŸ¥å‹å¼‚å¸¸é»˜è®¤ä¸å›æ»š"&gt;&lt;strong&gt;åœºæ™¯äºŒï¼šé‡æŠ›æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆé»˜è®¤ä¸å›æ»šï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‹¥é‡æŠ›çš„æ˜¯æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆå¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; IOException
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰ï¼Œ
é»˜è®¤ä¸ä¼šè§¦å‘å›æ»š
ï¼Œé™¤éæ˜¾å¼é…ç½®&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; rollbackFor
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3,8
ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// é»˜è®¤ä¸å›æ»š
@Transactional
public void method() throws IOException {
try {
throw new IOException();
} catch (IOException e) {
throw e; // é‡æŠ›æ£€æŸ¥å‹å¼‚å¸¸ â†’ äº‹åŠ¡æäº¤ï¼
}
}
// é…ç½®åå›æ»š
@Transactional(rollbackFor = IOException.class) // æ˜¾å¼æŒ‡å®šå›æ»š
public void method() throws IOException {
throw new IOException(); // ç›´æ¥æŠ›å‡ºå³å›æ»š
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å½±å“äº‹åŠ¡å›æ»šçš„å…¶ä»–å…³é”®å› ç´ "&gt;âš ï¸ &lt;strong&gt;å½±å“äº‹åŠ¡å›æ»šçš„å…¶ä»–å…³é”®å› ç´ &lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦å›æ»š&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸è¢«å†…éƒ¨æ–¹æ³•åæ‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸å›æ»š&lt;/td&gt;
&lt;td&gt;åµŒå¥—æ–¹æ³•ä¸­æ•è·å¼‚å¸¸æœªæŠ›å‡º/æœªæ ‡è®°å›æ»š â†’ çˆ¶äº‹åŠ¡æ— æ³•æ„ŸçŸ¥&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚éœ€ç¡®ä¿å¼‚å¸¸ä¼ é€’åˆ°äº‹åŠ¡è¾¹ç•Œã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªè°ƒç”¨å¯¼è‡´ä»£ç†å¤±æ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸å›æ»š&lt;/td&gt;
&lt;td&gt;åŒç±»ä¸­éäº‹åŠ¡æ–¹æ³•Aè°ƒç”¨äº‹åŠ¡æ–¹æ³•Bæ—¶ï¼ŒBçš„æ³¨è§£å¤±æ•ˆï¼ˆæœªé€šè¿‡ä»£ç†å¯¹è±¡ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚éœ€æ‹†åˆ†åˆ°ä¸åŒBeanã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šçº¿ç¨‹ç¯å¢ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸å›æ»š&lt;/td&gt;
&lt;td&gt;å­çº¿ç¨‹æŠ›å¼‚å¸¸ä¸å½±å“ä¸»çº¿ç¨‹äº‹åŠ¡ï¼ˆçº¿ç¨‹éš”ç¦»ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚éœ€ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ï¼ˆå¦‚Seataï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®åº“å¼•æ“ä¸æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸å›æ»š&lt;/td&gt;
&lt;td&gt;å¦‚MySQLçš„MyISAMå¼•æ“ä¸æ”¯æŒäº‹åŠ¡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚éœ€åˆ‡æ¢ä¸ºInnoDBå¼•æ“ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“äº‹åŠ¡å›æ»šçš„è§¦å‘æ¡ä»¶"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šäº‹åŠ¡å›æ»šçš„è§¦å‘æ¡ä»¶&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦è§¦å‘å›æ»š&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¿…è¦æ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•è·å¼‚å¸¸ä¸”ä¸å¤„ç†&lt;/td&gt;
&lt;td&gt;âŒ å¦&lt;/td&gt;
&lt;td&gt;é™¤éæ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;setRollbackOnly()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•è·åé‡æŠ› &lt;code&gt;RuntimeException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;é»˜è®¤è¡Œä¸º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•è·åé‡æŠ›æ£€æŸ¥å‹å¼‚å¸¸&lt;/td&gt;
&lt;td&gt;âŒ å¦&lt;/td&gt;
&lt;td&gt;å¿…é¡»é…ç½® &lt;code&gt;@Transactional(rollbackFor = å…·ä½“å¼‚å¸¸.class)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç›´æ¥æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;å¼‚å¸¸éœ€æ˜¯ &lt;code&gt;RuntimeException&lt;/code&gt; æˆ–é…ç½®äº† &lt;code&gt;rollbackFor&lt;/code&gt; çš„å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åæ²¡å¼‚å¸¸&lt;/strong&gt;ï¼šè‹¥éå¿…è¦ä¸åœ¨äº‹åŠ¡æ–¹æ³•å†… &lt;code&gt;try-catch&lt;/code&gt;ï¼›è‹¥éœ€æ•è·ï¼Œå¿…é¡»é‡æŠ›æˆ–æ‰‹åŠ¨å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸é…ç½®&lt;/strong&gt;ï¼šåœ¨å…¨å±€äº‹åŠ¡é…ç½®ä¸­æŒ‡å®š &lt;code&gt;rollbackFor = Exception.class&lt;/code&gt;ï¼Œè¦†ç›–æ‰€æœ‰å¼‚å¸¸ç±»å‹&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—ä¸å›æ»šåˆ†ç¦»&lt;/strong&gt;ï¼šåœ¨äº‹åŠ¡è¾¹ç•Œå¤–å¤„ç†æ—¥å¿—ï¼ˆå¦‚AOPï¼‰ï¼Œç¡®ä¿äº‹åŠ¡å†…å¼‚å¸¸èƒ½ä¼ é€’åˆ°ç®¡ç†å™¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id="repositoryæ–¹æ³•"&gt;@Repositoryæ–¹æ³•
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œ&lt;strong&gt;è‡ªå®šä¹‰çš„ &lt;code&gt;@Repository&lt;/code&gt; æ–¹æ³•é»˜è®¤æ˜¯å¦å…·å¤‡äº‹åŠ¡æ€§ï¼Œå–å†³äºæ–¹æ³•çš„å®ç°ä½ç½®å’Œæ³¨è§£é…ç½®&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é»˜è®¤è¡Œä¸ºç»§æ‰¿è‡ª"&gt;âš™ï¸ &lt;strong&gt;é»˜è®¤è¡Œä¸ºï¼šç»§æ‰¿è‡ª &lt;code&gt;SimpleJpaRepository&lt;/code&gt; çš„æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Data JPA çš„é»˜è®¤å®ç°ç±» &lt;code&gt;SimpleJpaRepository&lt;/code&gt; å·²é€šè¿‡ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£ç®¡ç†äº‹åŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»æ“ä½œ&lt;/strong&gt;ï¼šé»˜è®¤ä½¿ç”¨ &lt;code&gt;@Transactional(readOnly = true)&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;findById()&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™æ“ä½œ&lt;/strong&gt;ï¼šé‡å†™æ–¹æ³•æ—¶é€šè¿‡ &lt;code&gt;@Transactional&lt;/code&gt; è¦†ç›–ä¸ºè¯»å†™äº‹åŠ¡ï¼ˆå¦‚ &lt;code&gt;save()&lt;/code&gt;ã€&lt;code&gt;delete()&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;ç»“è®º&lt;/strong&gt;â€‹ï¼šç›´æ¥ç»§æ‰¿è‡ª &lt;code&gt;CrudRepository&lt;/code&gt; æˆ– &lt;code&gt;JpaRepository&lt;/code&gt; çš„&lt;strong&gt;é¢„å®šä¹‰æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;save&lt;/code&gt;ã€&lt;code&gt;findAll&lt;/code&gt;ï¼‰é»˜è®¤æœ‰äº‹åŠ¡&lt;/strong&gt;ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è‡ªå®šä¹‰æ–¹æ³•çš„å¤„ç†è§„åˆ™"&gt;âš ï¸ &lt;strong&gt;è‡ªå®šä¹‰æ–¹æ³•çš„å¤„ç†è§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-åœ¨-repository-æ¥å£ä¸­å£°æ˜è‡ªå®šä¹‰æ–¹æ³•"&gt;&lt;strong&gt;(1) åœ¨ Repository æ¥å£ä¸­å£°æ˜è‡ªå®šä¹‰æ–¹æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;éœ€æ‰‹åŠ¨æ·»åŠ  &lt;code&gt;@Transactional&lt;/code&gt;&lt;strong&gt;ï¼š
è‹¥åœ¨è‡ªå®šä¹‰çš„ Repository æ¥å£ä¸­æ–°å¢æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;findByCustomCondition&lt;/code&gt;ï¼‰ï¼Œâ€‹&lt;/strong&gt;é»˜è®¤ä¸ç»§æ‰¿äº‹åŠ¡
ï¼Œå¿…é¡»æ˜¾å¼æ ‡æ³¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @Transactional
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ³¨è§£&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface UserRepository extends JpaRepository&amp;lt;User, Long&amp;gt; {
// éœ€æ‰‹åŠ¨æ·»åŠ äº‹åŠ¡æ³¨è§£
@Transactional
List&amp;lt;User&amp;gt; findByActiveStatus(boolean isActive);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-è‡ªå®šä¹‰-repository-å®ç°ç±»"&gt;&lt;strong&gt;(2) è‡ªå®šä¹‰ Repository å®ç°ç±»&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;éœ€æ‰‹åŠ¨æ·»åŠ äº‹åŠ¡ï¼š
è‹¥é€šè¿‡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Impl
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åç¼€ç±»å®ç°è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; UserRepositoryImpl
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰ï¼Œå…¶ä¸­çš„æ–¹æ³•ä¸ä¼šè‡ªåŠ¨ç»§æ‰¿äº‹åŠ¡ï¼Œéœ€æ˜¾å¼æ ‡æ³¨&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @Transactional
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;public class UserRepositoryImpl implements UserCustomRepository {
@PersistenceContext
private EntityManager em;
@Transactional // å¿…é¡»æ‰‹åŠ¨æ·»åŠ 
@Override
public void bulkUpdateStatus(boolean status) {
em.createQuery(&amp;#34;UPDATE User u SET u.active = :status&amp;#34;)
.setParameter(&amp;#34;status&amp;#34;, status)
.executeUpdate();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-ä½¿ç”¨"&gt;&lt;strong&gt;(3) ä½¿ç”¨ &lt;code&gt;@Modifying&lt;/code&gt; çš„æ›´æ–°/åˆ é™¤æ“ä½œ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¼ºåˆ¶è¦æ±‚ &lt;code&gt;@Transactional&lt;/code&gt;&lt;strong&gt;ï¼š
è‡ªå®šä¹‰çš„ JPQL/SQL æ›´æ–°æˆ–åˆ é™¤æ“ä½œï¼ˆé€šè¿‡ &lt;code&gt;@Query&lt;/code&gt; + &lt;code&gt;@Modifying&lt;/code&gt;ï¼‰ï¼Œâ€‹&lt;/strong&gt;å¿…é¡»æ˜¾å¼æ·»åŠ  &lt;code&gt;@Transactional&lt;/code&gt;
ï¼Œå¦åˆ™ä¼šå› é»˜è®¤çš„åªè¯»äº‹åŠ¡é…ç½®è€Œå¤±è´¥
4,6
ã€‚
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface UserRepository extends JpaRepository&amp;lt;User, Long&amp;gt; {
@Modifying
@Transactional // å¿…é¡»æ˜¾å¼æ·»åŠ 
@Query(&amp;#34;DELETE FROM User u WHERE u.active = false&amp;#34;)
void deleteInactiveUsers();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-éœ€è¦æ‰‹åŠ¨é…ç½®äº‹åŠ¡çš„å…¸å‹åœºæ™¯"&gt;ğŸ”§ &lt;strong&gt;éœ€è¦æ‰‹åŠ¨é…ç½®äº‹åŠ¡çš„å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦éœ€æ‰‹åŠ¨æ·»åŠ  &lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Repository æ¥å£æ–°å¢æŸ¥è¯¢æ–¹æ³•&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;é»˜è®¤ä¸ç»§æ‰¿äº‹åŠ¡é…ç½® &lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰ Repository å®ç°ç±»æ–¹æ³•&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;å®ç°ç±»æ–¹æ³•éœ€ç‹¬ç«‹ç®¡ç†äº‹åŠ¡ &lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Modifying&lt;/code&gt; å†™æ“ä½œ&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;éœ€è¦†ç›–é»˜è®¤çš„åªè¯»äº‹åŠ¡ &lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è°ƒæ•´äº‹åŠ¡å±æ€§ï¼ˆè¶…æ—¶ã€éš”ç¦»çº§åˆ«ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;éœ€è¦†ç›–é»˜è®¤é…ç½®ï¼ˆå¦‚ &lt;code&gt;@Transactional(timeout = 10)&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡å±‚è°ƒç”¨å¤šä¸ª Repository æ–¹æ³•&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯ï¼ˆåœ¨ Service å±‚æ·»åŠ ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€ä¿è¯è·¨æ–¹æ³•åŸå­æ€§ &lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ’ &lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åŒºåˆ†è¯»å†™æ“ä½œï¼š
&lt;ul&gt;
&lt;li&gt;åªè¯»æŸ¥è¯¢ï¼šæ˜¾å¼æ ‡æ³¨ &lt;code&gt;@Transactional(readOnly = true)&lt;/code&gt; ä»¥ä¼˜åŒ–æ€§èƒ½&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†™æ“ä½œï¼šä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;ï¼ˆé»˜è®¤ä¼ æ’­è¡Œä¸º &lt;code&gt;REQUIRED&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åœ¨ DAO å±‚å¤„ç†ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;ï¼š
äº‹åŠ¡åº”é›†ä¸­åœ¨ â€‹&lt;strong&gt;Service å±‚&lt;/strong&gt;ï¼ŒRepository ä»…è´Ÿè´£æ•°æ®è®¿é—®&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†å¼‚å¸¸è½¬æ¢&lt;/strong&gt;ï¼š
&lt;code&gt;@Repository&lt;/code&gt; ä¼šå°†åº•å±‚å¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;SQLException&lt;/code&gt;ï¼‰è½¬æ¢ä¸º Spring çš„ &lt;code&gt;DataAccessException&lt;/code&gt;ï¼Œéœ€åœ¨ Service å±‚ç»Ÿä¸€å¤„ç†&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒç±»è°ƒç”¨é—®é¢˜&lt;/strong&gt;ï¼š
è‹¥ Service æ–¹æ³•å†…éƒ¨è°ƒç”¨åŒç±»çš„å…¶ä»–äº‹åŠ¡æ–¹æ³•ï¼Œéœ€é€šè¿‡ä»£ç†å¯¹è±¡ï¼ˆå¦‚ &lt;code&gt;AopContext.currentProxy()&lt;/code&gt;ï¼‰è§¦å‘äº‹åŠ¡ï¼Œå¦åˆ™æ³¨è§£å¤±æ•ˆ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-8"&gt;âœ… &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤é¢„å®šä¹‰æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;save()&lt;/code&gt;ï¼‰å·²æœ‰äº‹åŠ¡&lt;/strong&gt;ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰æ–¹æ³•ï¼ˆæ¥å£å£°æ˜æˆ–å®ç°ç±»ï¼‰å¿…é¡»æ˜¾å¼æ·»åŠ  &lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt;ï¼Œå¦åˆ™æ— äº‹åŠ¡æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Modifying&lt;/code&gt; å†™æ“ä½œå¿…é¡»é…åˆ &lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt; ä»¥è¦†ç›–åªè¯»é»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å§‹ç»ˆé€šè¿‡ Service å±‚ç»„åˆå¤šä¸ª Repository æ“ä½œï¼Œå¹¶ç”¨ &lt;code&gt;@Transactional&lt;/code&gt; ä¿è¯åŸå­æ€§ï¼Œæ˜¯æ›´æ¸…æ™°çš„äº‹åŠ¡ç®¡ç†ç­–ç•¥&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="äº‹åŠ¡åœºæ™¯"&gt;äº‹åŠ¡åœºæ™¯
&lt;/h2&gt;&lt;p&gt;åªè¯»æŸ¥è¯¢å¼€å¯äº‹åŠ¡ï¼ˆå³è®¾ç½® &lt;code&gt;@Transactional(readOnly = true)&lt;/code&gt; æˆ–ç±»ä¼¼é…ç½®ï¼‰åœ¨æ•°æ®åº“æ“ä½œä¸­å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼Œå°¤å…¶åœ¨æ€§èƒ½ä¼˜åŒ–ã€æ•°æ®ä¸€è‡´æ€§å’Œèµ„æºç®¡ç†ç­‰æ–¹é¢ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒå¥½å¤„åŠé€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ€§èƒ½ä¼˜åŒ–"&gt;âš¡ &lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘é”ç«äº‰ä¸å¼€é”€&lt;/strong&gt;
åªè¯»äº‹åŠ¡å‘ŠçŸ¥æ•°æ®åº“æ— éœ€å¯¹æŸ¥è¯¢æ“ä½œåŠ å†™é”ï¼ˆå¦‚è¡Œé”ã€è¡¨é”ï¼‰ï¼Œæ•°æ®åº“å¯è·³è¿‡è„è¯»æ£€æŸ¥ã€å›æ»šæ—¥å¿—è®°å½•ç­‰æœºåˆ¶ï¼Œå‡å°‘é”ç«äº‰å’Œå†…å­˜å¼€é”€ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢ååé‡&lt;a class="link" href="@ref" &gt;1,2,7&lt;/a&gt;ã€‚
&lt;em&gt;ç¤ºä¾‹&lt;/em&gt;ï¼šOracle ç­‰æ•°æ®åº“ä¼šç¦ç”¨å›æ»šæ®µï¼ˆRollback Segmentsï¼‰ï¼Œé¿å…è®°å½•äº‹åŠ¡æ—¥å¿—&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;
æ•°æ®åº“å¼•æ“é’ˆå¯¹åªè¯»æ“ä½œå¯ç”¨ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä½éš”ç¦»çº§åˆ«ï¼ˆå¦‚ &lt;code&gt;READ UNCOMMITTED&lt;/code&gt;ï¼‰ï¼Œå‡å°‘ä¸€è‡´æ€§æ£€æŸ¥&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨ç´¢å¼•æ‰«æè€Œéå…¨è¡¨æ‰«æï¼ˆå› æ•°æ®æ— éœ€ä¿®æ”¹ï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¿æ¥æ± å¤ç”¨åªè¯»è¿æ¥ï¼Œé™ä½åˆ›å»ºæ–°è¿æ¥çš„å¼€é”€&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®ä¸€è‡´æ€§ä¿éšœ"&gt;ğŸ”’ &lt;strong&gt;æ•°æ®ä¸€è‡´æ€§ä¿éšœ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡çº§å¿«ç…§éš”ç¦»&lt;/strong&gt;
åœ¨åªè¯»äº‹åŠ¡å¼€å¯åï¼Œæ•°æ®åº“ä¼šä¸ºå…¶åˆ›å»ºä¸€è‡´æ€§å¿«ç…§ï¼ˆå¦‚ MySQL çš„ MVCC æœºåˆ¶ï¼‰ï¼Œç¡®ä¿å¤šæ¬¡æŸ¥è¯¢ç»“æœä¸€è‡´ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡å¹¶å‘ä¿®æ”¹æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰äº‹åŠ¡çš„è¯»å–ç»“æœ&lt;a class="link" href="@ref" &gt;1,4,6&lt;/a&gt;ã€‚
&lt;em&gt;é€‚ç”¨åœºæ™¯&lt;/em&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆå¤æ‚æŠ¥è¡¨æ—¶éœ€å¤šæ¬¡å…³è”æŸ¥è¯¢ï¼ˆå¦‚ç»Ÿè®¡é”€å”®é¢ï¼‰ï¼Œé¿å…ä¸­é€”æ•°æ®å˜æ›´å¯¼è‡´ç»“æœä¸ä¸€è‡´&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é‡‘èç³»ç»Ÿå¯¹è´¦æˆ·ä½™é¢çš„å¤šæ¬¡æ ¡éªŒéœ€ä¿æŒä¸€è‡´æ€§&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¯¯æ“ä½œå†™å…¥&lt;/strong&gt;
æ˜¾å¼è®¾ç½® &lt;code&gt;readOnly=true&lt;/code&gt; åï¼Œè‹¥ä»£ç ä¸­æ„å¤–æ‰§è¡Œ INSERT/UPDATE/DELETE æ“ä½œï¼Œæ•°æ®åº“ä¼šç«‹å³æŠ›å‡º &lt;code&gt;Connection is read-only&lt;/code&gt; å¼‚å¸¸ï¼Œé˜²æ­¢æ•°æ®è¢«æ„å¤–ä¿®æ”¹&lt;a class="link" href="@ref" &gt;2,3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-orm-æ¡†æ¶çš„ååŒä¼˜åŒ–"&gt;ğŸ› ï¸ &lt;strong&gt;ORM æ¡†æ¶çš„ååŒä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Hibernate/JPA æ€§èƒ½æå‡
åœ¨ Spring + Hibernate ç»„åˆä¸­ï¼Œåªè¯»äº‹åŠ¡ä¼šè§¦å‘ä»¥ä¸‹ä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;è®¾ç½® Flush æ¨¡å¼ä¸º &lt;code&gt;NEVER&lt;/code&gt;ï¼Œç¦æ­¢ Session åŒæ­¥è„æ•°æ®åˆ°æ•°æ®åº“ï¼Œå‡å°‘ä¸å¿…è¦çš„ SQL æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¦ç”¨ä¸€çº§ç¼“å­˜æ›´æ–°ï¼Œé¿å…ç¼“å­˜è†¨èƒ€&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚
&lt;em&gt;ä»£ç ç¤ºä¾‹&lt;/em&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional(readOnly = true)
public List&amp;lt;User&amp;gt; getActiveUsers() {
return userRepository.findByStatus(&amp;#34;ACTIVE&amp;#34;); // Hibernate è·³è¿‡ flush
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-åˆ†å¸ƒå¼æ¶æ„é€‚é…"&gt;ğŸŒ &lt;strong&gt;åˆ†å¸ƒå¼æ¶æ„é€‚é…&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¯»å†™åˆ†ç¦»è·¯ç”±
åœ¨ä¸»ä»æ•°æ®åº“æ¶æ„ä¸­ï¼Œåªè¯»äº‹åŠ¡ä¼šè¢«è‡ªåŠ¨è·¯ç”±åˆ°åªè¯»å‰¯æœ¬ï¼ˆä»åº“ï¼‰ï¼Œåˆ†æ‹…ä¸»åº“å‹åŠ›ï¼Œæå‡ç³»ç»Ÿæ•´ä½“å¹¶å‘èƒ½åŠ›ã€‚
ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional(readOnly = true)
public Product getProduct(Long id) {
return productRepository.findById(id); // è¯·æ±‚è¢«è·¯ç”±åˆ°ä»åº“
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-3"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å•æ¡æŸ¥è¯¢æ— éœ€äº‹åŠ¡&lt;/strong&gt;
è‹¥ä»…æ‰§è¡Œå•æ¡ SELECT è¯­å¥ï¼Œæ•°æ®åº“é»˜è®¤ä¿è¯è¯»ä¸€è‡´æ€§ï¼Œæ— éœ€æ˜¾å¼å¼€å¯äº‹åŠ¡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™æ“ä½œç¦æ­¢æ··å…¥&lt;/strong&gt;
åªè¯»äº‹åŠ¡ä¸­å°è¯•å†™æ“ä½œä¼šè§¦å‘å¼‚å¸¸ï¼Œéœ€ç¡®ä¿æ–¹æ³•å†…æ—  INSERT/UPDATE/DELETE é€»è¾‘&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸ºé™åˆ¶&lt;/strong&gt;
åªè¯»ä¼˜åŒ–ä»…å¯¹éœ€å¯åŠ¨æ–°äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºç”Ÿæ•ˆï¼ˆå¦‚ &lt;code&gt;REQUIRED&lt;/code&gt;ã€&lt;code&gt;REQUIRES_NEW&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“é€‚ç”¨åœºæ™¯"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šé€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ”¶ç›Š&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘æŸ¥è¯¢&lt;/strong&gt;ï¼ˆå¦‚å•†å“åˆ—è¡¨ï¼‰&lt;/td&gt;
&lt;td&gt;å‡å°‘é”ç«äº‰ï¼Œæå‡ååé‡&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŠ¥è¡¨/ç»Ÿè®¡&lt;/strong&gt;ï¼ˆå¦‚é”€å”®åˆ†æï¼‰&lt;/td&gt;
&lt;td&gt;ç¡®ä¿å¤šæ¬¡æŸ¥è¯¢æ•°æ®ä¸€è‡´æ€§&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®å¯¼å‡º/å¤‡ä»½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…è¯¯æ“ä½œå†™å…¥ï¼Œä¼˜åŒ–èµ„æºå ç”¨&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»æ¶æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨è·¯ç”±åˆ°ä»åº“ï¼Œå‡è½»ä¸»åº“å‹åŠ›&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ORM æ¡†æ¶æŸ¥è¯¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¦ç”¨è„æ•°æ®åŒæ­¥ï¼Œå‡å°‘ SQL æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šé€šè¿‡è½»é‡åŒ–çš„äº‹åŠ¡ç®¡ç†ï¼Œåœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–æŸ¥è¯¢æ€§èƒ½ä¸ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ã€‚å¯¹è¯»å¤šå†™å°‘çš„ç³»ç»Ÿï¼ˆå¦‚ç”µå•†ã€é‡‘èå¹³å°ï¼‰å°¤ä¸ºé‡è¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ç¼“å­˜"&gt;ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;Spring Cache æ˜¯ Spring æ¡†æ¶æä¾›çš„&lt;strong&gt;ç¼“å­˜æŠ½è±¡å±‚&lt;/strong&gt;ï¼Œé€šè¿‡å£°æ˜å¼æ³¨è§£ç®€åŒ–ç¼“å­˜é›†æˆï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Caffeineã€Redisã€Ehcacheï¼‰ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒæœºåˆ¶ã€ä½¿ç”¨æ–¹å¼ã€é«˜çº§ç‰¹æ€§åˆ°å®è·µä¼˜åŒ–å±•å¼€è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸å·¥ä½œåŸç†"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæœºåˆ¶ä¸å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜æŠ½è±¡å±‚&lt;/strong&gt;
Spring Cache é€šè¿‡æ¥å£ &lt;code&gt;Cache&lt;/code&gt; å’Œ &lt;code&gt;CacheManager&lt;/code&gt; è§£è€¦å…·ä½“ç¼“å­˜å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Cache&lt;/code&gt;&lt;/strong&gt;ï¼šå®šä¹‰ç¼“å­˜æ“ä½œï¼ˆ&lt;code&gt;get&lt;/code&gt;ã€&lt;code&gt;put&lt;/code&gt;ã€&lt;code&gt;evict&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CacheManager&lt;/code&gt;&lt;/strong&gt;ï¼šç®¡ç†å¤šä¸ª &lt;code&gt;Cache&lt;/code&gt; å®ä¾‹ï¼ˆå¦‚ &lt;code&gt;CaffeineCacheManager&lt;/code&gt;ã€&lt;code&gt;RedisCacheManager&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AOP åŠ¨æ€ä»£ç†&lt;/strong&gt;
åŸºäº Spring AOPï¼Œåœ¨æ ‡æ³¨ç¼“å­˜æ³¨è§£çš„æ–¹æ³•è°ƒç”¨æ—¶æ’å…¥åˆ‡é¢é€»è¾‘ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå‘½ä¸­åˆ™ç›´æ¥è¿”å›ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;æœªå‘½ä¸­æ—¶æ‰§è¡Œæ–¹æ³•ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°ç¼“å­˜&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£é©±åŠ¨&lt;/strong&gt;
æ ¸å¿ƒæ³¨è§£ç®€åŒ–ç¼“å­˜æ“ä½œï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;ï¼šä¼˜å…ˆè¯»ç¼“å­˜ï¼Œæœªå‘½ä¸­æ‰§è¡Œæ–¹æ³•å¹¶ç¼“å­˜ç»“æœï¼ˆç”¨äºæŸ¥è¯¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@CachePut&lt;/code&gt;&lt;/strong&gt;ï¼šå¼ºåˆ¶æ›´æ–°ç¼“å­˜ï¼ˆç”¨äºæ–°å¢/æ›´æ–°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@CacheEvict&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ é™¤ç¼“å­˜ï¼ˆç”¨äºåˆ é™¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;ï¼šç»„åˆå¤šä¸ªç¼“å­˜æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;ï¼šç±»çº§åˆ«å…±äº«ç¼“å­˜é…ç½®&lt;a class="link" href="@ref" &gt;2,5,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨æ­¥éª¤ä¸é…ç½®"&gt;ğŸ› ï¸ &lt;strong&gt;ä½¿ç”¨æ­¥éª¤ä¸é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŸºç¡€é…ç½®"&gt;&lt;strong&gt;åŸºç¡€é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableCaching // å¯ç”¨ç¼“å­˜
public class App {
public static void main(String[] args) {
SpringApplication.run(App.class, args);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="æ³¨è§£ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;æ³¨è§£ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class UserService {
// æŸ¥è¯¢ï¼šç¼“å­˜é”®ä¸º userIdï¼Œæ¡ä»¶ä¸º userId&amp;gt;1000
@Cacheable(value = &amp;#34;users&amp;#34;, key = &amp;#34;#userId&amp;#34;, condition = &amp;#34;#userId &amp;gt; 1000&amp;#34;)
public User getUserById(Long userId) {
return userRepository.findById(userId);
}
// æ›´æ–°ï¼šæ›´æ–°æ•°æ®åº“ååŒæ­¥æ›´æ–°ç¼“å­˜
@CachePut(value = &amp;#34;users&amp;#34;, key = &amp;#34;#user.id&amp;#34;)
public User updateUser(User user) {
return userRepository.save(user);
}
// åˆ é™¤ï¼šæ¸…é™¤æŒ‡å®šç¼“å­˜
@CacheEvict(value = &amp;#34;users&amp;#34;, key = &amp;#34;#userId&amp;#34;)
public void deleteUser(Long userId) {
userRepository.deleteById(userId);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ç¼“å­˜åç«¯é…ç½®"&gt;&lt;strong&gt;ç¼“å­˜åç«¯é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=10s
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Redis ç¼“å­˜ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.cache.type=redis
spring.cache.redis.time-to-live=30000 # 30ç§’è¿‡æœŸ
spring.cache.redis.key-prefix=app_cache: # é”®å‰ç¼€
spring.cache.redis.cache-null-values=true # ç¼“å­˜ç©ºå€¼é˜²ç©¿é€[4,6](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§ç‰¹æ€§ä¸ä¼˜åŒ–æŠ€å·§"&gt;âš¡ &lt;strong&gt;é«˜çº§ç‰¹æ€§ä¸ä¼˜åŒ–æŠ€å·§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰ Key ä¸æ¡ä»¶&lt;/strong&gt;
é€šè¿‡ â€‹&lt;strong&gt;SpEL è¡¨è¾¾å¼&lt;/strong&gt;â€‹ åŠ¨æ€ç”Ÿæˆé”®æˆ–æ§åˆ¶ç¼“å­˜è¡Œä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Cacheable(value=&amp;#34;books&amp;#34;, key=&amp;#34;#isbn + &amp;#39;_&amp;#39; + #lang&amp;#34;, unless=&amp;#34;#result == null&amp;#34;)
public Book findBook(String isbn, String lang) { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;key&lt;/code&gt;ï¼šæ”¯æŒæ–¹æ³•å‚æ•°ï¼ˆå¦‚ &lt;code&gt;#userId&lt;/code&gt;ï¼‰ã€æ–¹æ³•åï¼ˆ&lt;code&gt;#root.methodName&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;condition&lt;/code&gt;/&lt;code&gt;unless&lt;/code&gt;ï¼šæ‰§è¡Œå‰æ¡ä»¶åˆ¤æ–­æˆ–ç»“æœè¿‡æ»¤&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šçº§ç¼“å­˜ä¸ç»„åˆæ“ä½œ&lt;/strong&gt;
ä½¿ç”¨ &lt;code&gt;@Caching&lt;/code&gt; ç»„åˆå¤šä¸ªæ³¨è§£ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Caching(
put = {
@CachePut(value=&amp;#34;user&amp;#34;, key=&amp;#34;#user.id&amp;#34;),
@CachePut(value=&amp;#34;user&amp;#34;, key=&amp;#34;#user.email&amp;#34;)
}
)
public User update(User user) { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜ç©¿é€ä¸å‡»ç©¿é˜²æŠ¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç©¿é€&lt;/strong&gt;ï¼šç¼“å­˜ç©ºå€¼ï¼ˆ&lt;code&gt;spring.cache.redis.cache-null-values=true&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡»ç©¿&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;@Cacheable(sync=true)&lt;/code&gt; åŒæ­¥åŠ è½½ï¼ˆä»…å•çº¿ç¨‹æŸ¥åº“ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿‡æœŸç­–ç•¥ä¸æ·˜æ±°ç®—æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Caffeine é…ç½®&lt;/strong&gt;ï¼šæ”¯æŒ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ã€LFUï¼ˆæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰ã€TTLï¼ˆå›ºå®šè¿‡æœŸæ—¶é—´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Redis è¿‡æœŸ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;time-to-live&lt;/code&gt; å…¨å±€è®¾ç½®&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç¼“å­˜å®ç°å¯¹æ¯”ä¸é€‰å‹"&gt;ğŸ“Š &lt;strong&gt;ç¼“å­˜å®ç°å¯¹æ¯”ä¸é€‰å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç¼“å­˜ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Caffeine&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜é¢‘è¯»ã€ä½å»¶è¿Ÿæœ¬åœ°ç¼“å­˜&lt;/td&gt;
&lt;td&gt;é«˜æ€§èƒ½ï¼Œæ·˜æ±°ç®—æ³•å…ˆè¿›&lt;/td&gt;
&lt;td&gt;å•æœºä½¿ç”¨ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Redis&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ†å¸ƒå¼ç¼“å­˜ã€å…±äº«æ•°æ®&lt;/td&gt;
&lt;td&gt;æŒä¹…åŒ–ã€é«˜å¯ç”¨ã€ä¸°å¯Œæ•°æ®ç±»å‹&lt;/td&gt;
&lt;td&gt;ä¾èµ–ç½‘ç»œï¼Œå»¶è¿Ÿç•¥é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ehcache&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤æ‚æœ¬åœ°ç¼“å­˜ç­–ç•¥&lt;/td&gt;
&lt;td&gt;æ”¯æŒå †å¤–å†…å­˜ã€ç£ç›˜æŒä¹…åŒ–&lt;/td&gt;
&lt;td&gt;é›†ç¾¤åŠŸèƒ½å¼±äº Redis&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;é€‰å‹å»ºè®®&lt;/strong&gt;ï¼šå•æœºåº”ç”¨é€‰ Caffeineï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç”¨ Redis&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µ-2"&gt;ğŸš€ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦ç¼“å­˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»…ç¼“å­˜&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;ã€&lt;strong&gt;è®¡ç®—è€—æ—¶&lt;/strong&gt;çš„æ•°æ®ï¼ˆå¦‚é…ç½®è¡¨ã€é™æ€æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¢‘ç¹æ›´æ–°çš„æ•°æ®ï¼ˆå¦‚å®æ—¶åº“å­˜ï¼‰æ…ç”¨ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸€è‡´æ€§&lt;/strong&gt;
æ•°æ®åº“æ›´æ–°ä¸ç¼“å­˜æ“ä½œéœ€åŸå­æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt; + &lt;code&gt;@CachePut&lt;/code&gt; ç¡®ä¿æ•°æ®ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ›´æ–°ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ä¸è°ƒä¼˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ï¼ˆå¦‚ Redis çš„ &lt;code&gt;INFO stats&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒæ•´ &lt;code&gt;maximumSize&lt;/code&gt; å’Œ TTL é¿å…å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰åºåˆ—åŒ–&lt;/strong&gt;
Redis é»˜è®¤ JDK åºåˆ—åŒ–æ•ˆç‡ä½ï¼Œæ”¹ç”¨ Jacksonï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public RedisCacheConfiguration cacheConfig() {
return RedisCacheConfiguration.defaultCacheConfig()
.serializeValuesWith(RedisSerializationContext.SerializationPair
.fromSerializer(new Jackson2JsonRedisSerializer&amp;lt;&amp;gt;(Object.class)));
}[4](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-9"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Cache é€šè¿‡&lt;strong&gt;å£°æ˜å¼æ³¨è§£&lt;/strong&gt;å’Œ&lt;strong&gt;ç»Ÿä¸€æŠ½è±¡å±‚&lt;/strong&gt;ï¼Œå¤§å¹…ç®€åŒ–ç¼“å­˜é›†æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šæå‡æ€§èƒ½ï¼ˆå‡å°‘ DB è®¿é—®ï¼‰ã€é™ä½ä»£ç ä¾µå…¥æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ­¥éª¤&lt;/strong&gt;ï¼š&lt;code&gt;@EnableCaching&lt;/code&gt; â†’ é…ç½® &lt;code&gt;CacheManager&lt;/code&gt; â†’ ä½¿ç”¨æ³¨è§£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿›é˜¶åœºæ™¯&lt;/strong&gt;ï¼šå¤šçº§ç¼“å­˜ã€é˜²ç©¿é€/å‡»ç©¿ã€åˆ†å¸ƒå¼ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;ï¼šç»“åˆä¸šåŠ¡åœºæ™¯é€‰æ‹©ç¼“å­˜å®ç°ï¼Œä¼˜å…ˆæœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰è½»é‡åŒ–ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç”¨ Redis ç¡®ä¿ä¸€è‡´æ€§ã€‚é€šè¿‡ SpEL å’Œæ¡ä»¶æ³¨è§£ç²¾ç»†æ§åˆ¶ç¼“å­˜é€»è¾‘ï¼Œé¿å…å¸¸è§é™·é˜±ï¼ˆå¦‚ç¼“å­˜é›ªå´©ï¼‰&lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="cachable--caching"&gt;@Cachable &amp;amp; @Caching
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cache ä¸­ï¼Œ&lt;code&gt;@Cacheable&lt;/code&gt; å’Œ &lt;code&gt;@Caching&lt;/code&gt; æ˜¯ä¸¤ä¸ªåŠŸèƒ½äº’è¡¥ä½†å®šä½ä¸åŒçš„æ³¨è§£ï¼Œä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-åŠŸèƒ½å®šä½"&gt;ğŸ”§ &lt;strong&gt;åŠŸèƒ½å®šä½&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;
ç”¨äº&lt;strong&gt;å•ä¸€ç¼“å­˜æ“ä½œ&lt;/strong&gt;ï¼Œè¡¨ç¤ºæ–¹æ³•çš„è¿”å›å€¼å¯è¢«ç¼“å­˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒé€»è¾‘&lt;/strong&gt;ï¼šé¦–æ¬¡è°ƒç”¨æ—¶æ‰§è¡Œæ–¹æ³•å¹¶ç¼“å­˜ç»“æœï¼Œåç»­ç›¸åŒå‚æ•°è°ƒç”¨ç›´æ¥è¿”å›ç¼“å­˜å€¼ï¼ˆä¸æ‰§è¡Œæ–¹æ³•ï¼‰&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;strong&gt;æŸ¥è¯¢æ–¹æ³•&lt;/strong&gt;ï¼ˆå¦‚æ ¹æ® ID æŸ¥è¯¢æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Cacheable(value = &amp;#34;users&amp;#34;, key = &amp;#34;#id&amp;#34;)
public User getUserById(Long id) {
return userRepository.findById(id);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;
æ˜¯&lt;strong&gt;ç»„åˆæ³¨è§£&lt;/strong&gt;ï¼Œç”¨äºåœ¨ &lt;strong&gt;åŒä¸€æ–¹æ³•ä¸Šå®šä¹‰å¤šä¸ªç¼“å­˜æ“ä½œ&lt;/strong&gt;â€‹ï¼ˆå¯åŒ…å«å¤šä¸ª &lt;code&gt;@Cacheable&lt;/code&gt;ã€&lt;code&gt;@CachePut&lt;/code&gt;ã€&lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒé€»è¾‘&lt;/strong&gt;ï¼šè§£å†³å•ä¸€æ³¨è§£æ— æ³•è¦†ç›–çš„å¤æ‚ç¼“å­˜åœºæ™¯ï¼ˆå¦‚åŒæ—¶æ›´æ–°å¤šä¸ªç¼“å­˜ã€æ¸…ç†å…³è”ç¼“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;strong&gt;å¤šç¼“å­˜è”åŠ¨æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚æ›´æ–°ä¸»ç¼“å­˜å¹¶æ¸…ç†ç´¢å¼•ç¼“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Caching(
put = {
@CachePut(value = &amp;#34;users&amp;#34;, key = &amp;#34;#user.id&amp;#34;),
@CachePut(value = &amp;#34;users&amp;#34;, key = &amp;#34;#user.email&amp;#34;)
},
evict = @CacheEvict(value = &amp;#34;user_search_cache&amp;#34;, allEntries = true)
)
public User updateUser(User user) {
return userRepository.save(user);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨åœºæ™¯å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;ä½¿ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œé¿å…é‡å¤æ‰§è¡Œæ–¹æ³•&lt;/td&gt;
&lt;td&gt;ç»„åˆå¤šä¸ªç¼“å­˜æ“ä½œï¼ˆå¢/åˆ /æ”¹/æŸ¥è”åŠ¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦æ‰§è¡Œæ–¹æ³•ä½“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ç¼“å­˜å‘½ä¸­æ—¶è·³è¿‡æ–¹æ³•æ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;âœ… å§‹ç»ˆæ‰§è¡Œæ–¹æ³•ä½“ï¼ˆéœ€é…åˆ &lt;code&gt;@CachePut&lt;/code&gt; ç­‰æ³¨è§£ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;findById&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;æ•°æ®æ›´æ–°ååŒæ­¥å¤šä¸ªç¼“å­˜ï¼ˆå¦‚æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¹¶æ¸…ç†ç´¢å¼•ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦æ”¯æŒå¤šæ“ä½œç»„åˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä»…æ”¯æŒå•ä¸€ç¼“å­˜è¡Œä¸º&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒåŒæ—¶å®šä¹‰ç¼“å­˜æ›´æ–°ã€æ¸…ç†ã€æŸ¥è¯¢&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®å¤æ‚åº¦"&gt;ğŸ› ï¸ &lt;strong&gt;é…ç½®å¤æ‚åº¦&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;
é…ç½®ç®€å•ï¼Œåªéœ€æŒ‡å®š &lt;code&gt;value&lt;/code&gt;ï¼ˆç¼“å­˜åˆ†åŒºï¼‰å’Œ &lt;code&gt;key&lt;/code&gt;ï¼ˆç¼“å­˜é”®ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Cacheable(value = &amp;#34;products&amp;#34;, key = &amp;#34;#id&amp;#34;, condition = &amp;#34;#id &amp;gt; 10&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;
éœ€åµŒå¥—å¤šä¸ªå­æ³¨è§£ï¼Œé…ç½®æ›´å¤æ‚ä½†çµæ´»æ€§é«˜&lt;a class="link" href="@ref" &gt;2,6,8&lt;/a&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Caching(
cacheable = @Cacheable(value = &amp;#34;temp&amp;#34;, key = &amp;#34;#id&amp;#34;),
evict = @CacheEvict(value = &amp;#34;main_cache&amp;#34;, key = &amp;#34;#result.category&amp;#34;)
)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è®¾è®¡æ„ä¹‰"&gt;ğŸ’¡ &lt;strong&gt;è®¾è®¡æ„ä¹‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;
ä¼˜åŒ–&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;åœºæ™¯çš„æ€§èƒ½ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;
è§£å†³&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§&lt;/strong&gt;é—®é¢˜ï¼Œç¡®ä¿å¤šä¸ªç¼“å­˜é—´çš„çŠ¶æ€åŒæ­¥ï¼ˆå¦‚åŒå†™æ¨¡å¼ã€å¤±æ•ˆæ¨¡å¼ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µ-3"&gt;âœ… &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;
ç®€å•æŸ¥è¯¢ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt;ï¼Œé¿å…è¿‡åº¦è®¾è®¡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åœºæ™¯ç”¨ &lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;
å½“éœ€è¦æ›´æ–°å¤šä¸ªç¼“å­˜æˆ–æ¸…ç†å…³è”æ•°æ®æ—¶ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯æ›´æ–°åéœ€åŒæ­¥ &lt;code&gt;id&lt;/code&gt;ã€&lt;code&gt;email&lt;/code&gt; ä¸¤ä¸ªé”®çš„ç¼“å­˜ï¼‰ï¼Œä½¿ç”¨ &lt;code&gt;@Caching&lt;/code&gt; ç»„åˆæ“ä½œ&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å†—ä½™ç»„åˆ&lt;/strong&gt;
&lt;code&gt;@Caching&lt;/code&gt; ä¸­çš„ &lt;code&gt;@Cacheable&lt;/code&gt; å­æ³¨è§£&lt;strong&gt;ä¸ä¼šè·³è¿‡æ–¹æ³•æ‰§è¡Œ&lt;/strong&gt;â€‹ï¼ˆä¸ç‹¬ç«‹ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt; è¡Œä¸ºä¸åŒï¼‰ï¼Œéœ€è°¨æ…è®¾è®¡&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-10"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;`@Cacheable = ç¼“å­˜æŸ¥è¯¢ç»“æœ&lt;/strong&gt;ï¼šç”¨äºåŠ é€Ÿé‡å¤æŸ¥è¯¢ï¼Œå‡å°‘æ–¹æ³•æ‰§è¡Œæ¬¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;`@Caching = ç¼“å­˜æ“ä½œç»„åˆå™¨&lt;/strong&gt;ï¼šè§£å†³å¤šç¼“å­˜è”åŠ¨éœ€æ±‚ï¼Œä¿éšœæ•°æ®ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸¤è€…æœ¬è´¨æ˜¯&lt;strong&gt;åˆ†å·¥å…³ç³»&lt;/strong&gt;ï¼š&lt;code&gt;@Cacheable&lt;/code&gt; è´Ÿè´£åŸºç¡€ç¼“å­˜ï¼Œ&lt;code&gt;@Caching&lt;/code&gt; è´Ÿè´£å¤æ‚åè°ƒã€‚å®é™…å¼€å‘ä¸­ï¼Œ80% çš„åœºæ™¯ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt; å³å¯ï¼Œå‰©ä½™å¤æ‚åœºæ™¯é€šè¿‡ &lt;code&gt;@Caching&lt;/code&gt; æ‰©å±•&lt;a class="link" href="@ref" &gt;2,6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="è¿‡æœŸæ—¶é—´"&gt;è¿‡æœŸæ—¶é—´
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cache æ¡†æ¶ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt; æ³¨è§£æœ¬èº«å¹¶ä¸ç›´æ¥æ”¯æŒ &lt;code&gt;expire&lt;/code&gt; å±æ€§æ¥è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/strong&gt;ï¼Œå…¶é»˜è®¤è¡Œä¸ºå–å†³äºåº•å±‚ä½¿ç”¨çš„ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeineã€Ehcache ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„é»˜è®¤è¿‡æœŸæ—¶é—´è§„åˆ™åŠé…ç½®æ–¹æ³•ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é»˜è®¤è¿‡æœŸæ—¶é—´è§„åˆ™"&gt;âš™ï¸ &lt;strong&gt;é»˜è®¤è¿‡æœŸæ—¶é—´è§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ— è¿‡æœŸæ—¶é—´ï¼ˆæ°¸ä¸è¿‡æœŸï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring å†…ç½®ç¼“å­˜&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;ConcurrentMapCache&lt;/code&gt;ï¼‰é»˜è®¤&lt;strong&gt;æ°¸ä¸è¿‡æœŸ&lt;/strong&gt;ï¼Œéœ€æ‰‹åŠ¨æ¸…é™¤æˆ–é‡å¯åº”ç”¨æ‰èƒ½é‡Šæ”¾ç¼“å­˜&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Redis ç¼“å­˜&lt;/strong&gt;ï¼šè‹¥æœªé…ç½®å…¨å±€ &lt;code&gt;time-to-live&lt;/code&gt;ï¼Œåˆ™é»˜è®¤&lt;strong&gt;æ°¸ä¸è¿‡æœŸ&lt;/strong&gt;ï¼ˆé™¤éå†…å­˜ä¸è¶³è§¦å‘æ·˜æ±°ç­–ç•¥ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Caffeine/Ehcache&lt;/strong&gt;ï¼šéœ€æ˜¾å¼é…ç½®è¿‡æœŸç­–ç•¥ï¼Œå¦åˆ™é»˜è®¤æ°¸ä¸è¿‡æœŸ&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜å®ç°çš„é»˜è®¤è¡Œä¸ºå·®å¼‚&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç¼“å­˜å®ç°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤è¿‡æœŸç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ConcurrentMapCache&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ°¸ä¸è¿‡æœŸ&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨æ¸…é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Redis&lt;/td&gt;
&lt;td&gt;æ°¸ä¸è¿‡æœŸ&lt;/td&gt;
&lt;td&gt;å†…å­˜ä¸è¶³æ—¶è§¦å‘ LRU æ·˜æ±°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Caffeine&lt;/td&gt;
&lt;td&gt;æ°¸ä¸è¿‡æœŸï¼ˆéœ€é…ç½® &lt;code&gt;expireAfterWrite&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;ä¾èµ–æ˜¾å¼é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ehcache&lt;/td&gt;
&lt;td&gt;ç”± &lt;code&gt;ehcache.xml&lt;/code&gt; ä¸­çš„ &lt;code&gt;&amp;lt;defaultCache&amp;gt;&lt;/code&gt; å®šä¹‰&lt;/td&gt;
&lt;td&gt;æœªé…ç½®åˆ™æ°¸ä¸è¿‡æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¦‚ä½•è®¾ç½®è¿‡æœŸæ—¶é—´"&gt;âš¡ &lt;strong&gt;å¦‚ä½•è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…¨å±€ç»Ÿä¸€é…ç½®æ¨è"&gt;&lt;strong&gt;å…¨å±€ç»Ÿä¸€é…ç½®ï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Redis ç¼“å­˜&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;application.yml&lt;/code&gt; ä¸­è®¾ç½®æ‰€æœ‰ç¼“å­˜çš„é»˜è®¤ TTLï¼ˆTime-To-Liveï¼‰&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cache:
redis:
time-to-live: 30000 # å•ä½ï¼šæ¯«ç§’ï¼ˆ30 ç§’ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Caffeine ç¼“å­˜&lt;/strong&gt;ï¼šé…ç½®æœ€å¤§æ¡ç›®æ•°å’Œè¿‡æœŸæ—¶é—´&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cache:
caffeine:
spec: maximumSize=500, expireAfterWrite=60s
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æŒ‰ç¼“å­˜åˆ†åŒºè®¾ç½®ä¸åŒ-ttl"&gt;&lt;strong&gt;æŒ‰ç¼“å­˜åˆ†åŒºè®¾ç½®ä¸åŒ TTL&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Redis ç¤ºä¾‹ï¼šé€šè¿‡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; RedisCacheManager
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºä¸åŒåˆ†åŒºæŒ‡å®šè¿‡æœŸæ—¶é—´
3,4ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public CacheManager cacheManager(RedisConnectionFactory factory) {
Map&amp;lt;String, RedisCacheConfiguration&amp;gt; configMap = new HashMap&amp;lt;&amp;gt;();
configMap.put(&amp;#34;users&amp;#34;, RedisCacheConfiguration.defaultCacheConfig().entryTtl(Duration.ofMinutes(10))); // ç”¨æˆ·ç¼“å­˜10åˆ†é’Ÿ
configMap.put(&amp;#34;products&amp;#34;, RedisCacheConfiguration.defaultCacheConfig().entryTtl(Duration.ofHours(1))); // å•†å“ç¼“å­˜1å°æ—¶
return RedisCacheManager.builder(factory)
.withInitialCacheConfigurations(configMap)
.build();
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="æ‰©å±•æ³¨è§£æ”¯æŒæŒ‰æ–¹æ³•çº§è®¾ç½®-ttl"&gt;&lt;strong&gt;æ‰©å±•æ³¨è§£æ”¯æŒæŒ‰æ–¹æ³•çº§è®¾ç½® TTL&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‡ªå®šä¹‰æ³¨è§£ï¼šé€šè¿‡ AOP è§£ææ³¨è§£ä¸­çš„è¿‡æœŸå‚æ•°
3,4ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Cacheable(value = &amp;#34;users#300&amp;#34;) // 300 ç§’è¿‡æœŸ
public User getUser(Long id) { ... }
&lt;/code&gt;&lt;/pre&gt;å®ç°åŸç†ï¼šé‡å†™&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; RedisCacheManager
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼Œåœ¨&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; createRedisCache()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ–¹æ³•ä¸­è§£æ&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; value
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸­çš„&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; #
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ†éš”ç¬¦ï¼ˆå¦‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; users#300
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰å¹¶åŠ¨æ€è®¾ç½® TTL
3
ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-4"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt; æ— åŸç”Ÿ &lt;code&gt;expire&lt;/code&gt; å±æ€§&lt;/strong&gt;
ç½‘ä¸Šéƒ¨åˆ†ç¤ºä¾‹æåˆ°çš„ &lt;code&gt;@Cacheable(expire=60)&lt;/code&gt; æ˜¯&lt;strong&gt;é”™è¯¯å†™æ³•&lt;/strong&gt;ï¼ŒSpring å®˜æ–¹æœªæä¾›è¯¥å±æ€§&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ç©¿é€ä¸é›ªå´©é˜²æŠ¤&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç©ºå€¼ç¼“å­˜ï¼š&lt;code&gt;spring.cache.redis.cache-null-values=true&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;éšæœºåŒ– TTLï¼šé¿å…æ‰¹é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼ˆå¦‚ &lt;code&gt;time-to-live=${random.int(200,600)}s&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ehcache éœ€å•ç‹¬é…ç½®&lt;/strong&gt;
åœ¨ &lt;code&gt;ehcache.xml&lt;/code&gt; ä¸­ä¸ºæ¯ä¸ªç¼“å­˜åŒºè®¾ç½® &lt;code&gt;timeToLiveSeconds&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;cache name=&amp;#34;users&amp;#34;
maxEntriesLocalHeap=&amp;#34;1000&amp;#34;
timeToLiveSeconds=&amp;#34;300&amp;#34; /&amp;gt; &amp;lt;!-- 5åˆ†é’Ÿè¿‡æœŸ --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-11"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸º&lt;/strong&gt;ï¼šSpring Cache &lt;strong&gt;ä¸å¼ºåˆ¶è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/strong&gt;ï¼Œéœ€ä¾èµ–åº•å±‚ç¼“å­˜å®ç°ï¼ˆRedis/Caffeine/Ehcacheï¼‰çš„æ˜¾å¼é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;æœ€ä½³å®è·µï¼š
&lt;ul&gt;
&lt;li&gt;âœ… &lt;strong&gt;å…¨å±€ TTL&lt;/strong&gt;ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ï¼ˆå¦‚ &lt;code&gt;spring.cache.redis.time-to-live&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;âœ… &lt;strong&gt;åˆ†åŒºçº§ TTL&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;RedisCacheManager&lt;/code&gt; ä¸ºä¸åŒä¸šåŠ¡åœºæ™¯å®šåˆ¶è¿‡æœŸç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;âœ… &lt;strong&gt;æ–¹æ³•çº§ TTL&lt;/strong&gt;ï¼šæ‰©å±• &lt;code&gt;@Cacheable&lt;/code&gt; æ³¨è§£ï¼ˆéœ€è‡ªå®šä¹‰ &lt;code&gt;CacheManager&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é…ç½®ç¤ºä¾‹ä¸åº•å±‚åŸç†å¯å‚è€ƒ &lt;a class="link" href="https://docs.spring.io/spring-framework/reference/integration/cache.html" target="_blank" rel="noopener"
&gt;Spring Cache å®˜æ–¹æ–‡æ¡£&lt;/a&gt; æˆ–å®è·µæ¡ˆä¾‹&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="crossorigin"&gt;@CrossOrigin
&lt;/h2&gt;&lt;p&gt;@CrossOrigin æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºç®€åŒ– &lt;strong&gt;è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰&lt;/strong&gt; é…ç½®çš„æ ¸å¿ƒæ³¨è§£ï¼Œé€šè¿‡å£°æ˜å¼æ–¹å¼æ§åˆ¶æµè§ˆå™¨å¯¹è·¨åŸŸè¯·æ±‚çš„è®¿é—®æƒé™ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§ã€ä½¿ç”¨æ–¹å¼ã€å·¥ä½œåŸç†åŠæœ€ä½³å®è·µç­‰æ–¹é¢å…¨é¢è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½ä¸èƒŒæ™¯"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸èƒŒæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³è·¨åŸŸé—®é¢˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæºç­–ç•¥é™åˆ¶&lt;/strong&gt;ï¼šæµè§ˆå™¨é»˜è®¤ç¦æ­¢é¡µé¢å‘ä¸åŒåè®®ã€åŸŸåæˆ–ç«¯å£çš„æœåŠ¡å‘èµ·è¯·æ±‚ï¼ˆå¦‚ &lt;code&gt;http://a.com&lt;/code&gt; æ— æ³•è®¿é—® &lt;code&gt;http://b.com/api&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CORS æœºåˆ¶&lt;/strong&gt;ï¼šé€šè¿‡ HTTP å“åº”å¤´ï¼ˆå¦‚ &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;ï¼‰å‘ŠçŸ¥æµè§ˆå™¨å…è®¸ç‰¹å®šæºçš„è·¨åŸŸè¯·æ±‚&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”&lt;/strong&gt;ï¼šç›¸æ¯” JSONPï¼ˆä»…æ”¯æŒ GETï¼‰æˆ–ä»£ç†æœåŠ¡å™¨ï¼ŒCORS æ”¯æŒæ‰€æœ‰ HTTP æ–¹æ³•ä¸”å®‰å…¨æ€§æ›´é«˜&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£å®šä½&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½œç”¨äºç±»æˆ–æ–¹æ³•çº§åˆ«ï¼Œä¸º Spring MVC æ§åˆ¶å™¨æä¾›ç»†ç²’åº¦çš„è·¨åŸŸæ§åˆ¶&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½ç‰ˆæœ¬è¦æ±‚&lt;/strong&gt;ï¼šSpring Framework 4.2+ï¼ˆSpring Boot 1.3+ é»˜è®¤æ”¯æŒï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨æ–¹å¼è¯¦è§£"&gt;ğŸ› ï¸ &lt;strong&gt;ä½¿ç”¨æ–¹å¼è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å±€éƒ¨é…ç½®ç±»æ–¹æ³•çº§"&gt;&lt;strong&gt;å±€éƒ¨é…ç½®ï¼ˆç±»/æ–¹æ³•çº§ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»çº§åˆ«&lt;/strong&gt;ï¼šæ§åˆ¶å™¨ä¸‹æ‰€æœ‰æ¥å£å¯ç”¨è·¨åŸŸ
&lt;pre tabindex="0"&gt;&lt;code&gt;@CrossOrigin(origins = &amp;#34;http://example.com&amp;#34;, maxAge = 3600)
@RestController
@RequestMapping(&amp;#34;/api&amp;#34;)
public class MyController {
@GetMapping(&amp;#34;/data&amp;#34;)
public String getData() { ... } // æ‰€æœ‰æ–¹æ³•ç»§æ‰¿ç±»çº§é…ç½®
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•çº§åˆ«&lt;/strong&gt;ï¼šä»…ç‰¹å®šæ¥å£å¯ç”¨è·¨åŸŸ
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController
@RequestMapping(&amp;#34;/api&amp;#34;)
public class MyController {
@CrossOrigin(origins = &amp;#34;http://example.com&amp;#34;)
@GetMapping(&amp;#34;/data&amp;#34;)
public String getData() { ... } // ä»…æ­¤æ–¹æ³•æ”¯æŒè·¨åŸŸ
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®åˆå¹¶è§„åˆ™&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç±»ä¸æ–¹æ³•åŒæ—¶æ³¨è§£æ—¶ï¼Œ&lt;strong&gt;æ–¹æ³•çº§é…ç½®è¦†ç›–ç±»çº§åŒåå±æ€§&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;origins&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…³é”®å‚æ•°è§£æ"&gt;&lt;strong&gt;å…³é”®å‚æ•°è§£æ&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å‚æ•°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;origins&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸çš„è¯·æ±‚æºï¼ˆå¯å¤šä¸ªï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;*&lt;/code&gt;ï¼ˆå…è®¸æ‰€æœ‰æºï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;origins = {&amp;quot;http://a.com&amp;quot;, &amp;quot;http://b.com&amp;quot;}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;methods&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸çš„ HTTP æ–¹æ³•&lt;/td&gt;
&lt;td&gt;åŒ &lt;code&gt;@RequestMapping&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;methods = {RequestMethod.GET, POST}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;allowedHeaders&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸çš„è¯·æ±‚å¤´ï¼ˆå¦‚ &lt;code&gt;Authorization&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;*&lt;/code&gt;ï¼ˆå…è®¸æ‰€æœ‰å¤´ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;allowedHeaders = {&amp;quot;Content-Type&amp;quot;}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;exposedHeaders&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸å®¢æˆ·ç«¯è®¿é—®çš„å“åº”å¤´&lt;/td&gt;
&lt;td&gt;ç©ºï¼ˆä»…æš´éœ²åŸºç¡€å¤´ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;exposedHeaders = {&amp;quot;X-Custom-Header&amp;quot;}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;allowCredentials&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å…è®¸æºå¸¦å‡­è¯ï¼ˆCookie/HTTPè®¤è¯ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;allowCredentials = true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;maxAge&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå‡å°‘é‡å¤é¢„æ£€è¯·æ±‚&lt;/td&gt;
&lt;td&gt;1800ï¼ˆ30åˆ†é’Ÿï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;maxAge = 3600&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;å®‰å…¨æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;allowCredentials = true&lt;/code&gt; æ—¶ï¼Œ&lt;code&gt;origins&lt;/code&gt; ä¸èƒ½ä¸º &lt;code&gt;*&lt;/code&gt;ï¼ˆéœ€æ˜ç¡®æŒ‡å®šåŸŸåï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒé¿å…ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt;ï¼Œé˜²æ­¢ CSRF æ”»å‡»&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-åº•å±‚å·¥ä½œåŸç†"&gt;âš™ï¸ &lt;strong&gt;åº•å±‚å·¥ä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚å¤„ç†æµç¨‹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•è¯·æ±‚&lt;/strong&gt;ï¼ˆGET/POST ä¸”æ— è‡ªå®šä¹‰å¤´ï¼‰ï¼šç›´æ¥å¤„ç†ï¼Œå“åº”å¤´æ·»åŠ  &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢„æ£€è¯·æ±‚&lt;/strong&gt;ï¼ˆOPTIONS æ–¹æ³•ï¼‰ï¼šå…ˆéªŒè¯ &lt;code&gt;allowedMethods&lt;/code&gt;/&lt;code&gt;allowedHeaders&lt;/code&gt;ï¼Œé€šè¿‡åæ‰æ”¾è¡Œå®é™…è¯·æ±‚&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring é›†æˆæœºåˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”± &lt;code&gt;CorsProcessor&lt;/code&gt;ï¼ˆé»˜è®¤ &lt;code&gt;DefaultCorsProcessor&lt;/code&gt;ï¼‰æ‹¦æˆªè¯·æ±‚ï¼Œæ ¹æ®æ³¨è§£ç”Ÿæˆ &lt;code&gt;CorsConfiguration&lt;/code&gt; å¹¶è®¾ç½®å“åº”å¤´&lt;a class="link" href="@ref" &gt;6,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸å…¶ä»–-cors-æ–¹æ¡ˆçš„å¯¹æ¯”"&gt;ğŸ”„ &lt;strong&gt;ä¸å…¶ä»– CORS æ–¹æ¡ˆçš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CrossOrigin&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿«é€Ÿä¸ºå°‘æ•°æ¥å£å¯ç”¨è·¨åŸŸ&lt;/td&gt;
&lt;td&gt;é…ç½®ç®€æ´ï¼Œæ— éœ€å…¨å±€æ”¹åŠ¨&lt;/td&gt;
&lt;td&gt;é‡å¤é…ç½®å¤šæ¥å£æ—¶å†—ä½™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¨å±€é…ç½®ï¼ˆ&lt;code&gt;WebMvcConfigurer&lt;/code&gt;ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ¥å£çš„è·¨åŸŸè§„åˆ™&lt;/td&gt;
&lt;td&gt;ç»´æŠ¤æ–¹ä¾¿ï¼Œæ”¯æŒè·¯å¾„æ¨¡å¼åŒ¹é…&lt;/td&gt;
&lt;td&gt;æ— æ³•é’ˆå¯¹å•ä¸ªæ¥å£å®šåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;CorsFilter&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ç²¾ç»†æ§åˆ¶æˆ–æ•´åˆ Spring Security æ—¶&lt;/td&gt;
&lt;td&gt;å¤„ç†æ›´åº•å±‚ï¼Œä¼˜å…ˆçº§æ›´é«˜&lt;/td&gt;
&lt;td&gt;é…ç½®è¾ƒå¤æ‚&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Nginx ä»£ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒï¼Œå‰ç«¯ä¸åç«¯åˆ†ç¦»éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;è§£è€¦ä¸šåŠ¡ä»£ç ï¼Œæå‡æ€§èƒ½&lt;/td&gt;
&lt;td&gt;éœ€é¢å¤–è¿ç»´æˆæœ¬&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;é€‰æ‹©å»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°‘é‡æ¥å£è·¨åŸŸ â†’ &lt;code&gt;@CrossOrigin&lt;/code&gt;&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…¨é¡¹ç›®è·¨åŸŸ â†’ å…¨å±€é…ç½® &lt;code&gt;WebMvcConfigurer&lt;/code&gt;&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Spring Security é¡¹ç›® â†’ &lt;code&gt;CorsFilter&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£ä¸ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬æ£€æŸ¥&lt;/strong&gt;ï¼šç¡®è®¤ Spring ç‰ˆæœ¬ â‰¥4.2&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•å£°æ˜&lt;/strong&gt;ï¼š&lt;code&gt;@RequestMapping&lt;/code&gt; éœ€æ˜ç¡®æŒ‡å®š HTTP æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;method = RequestMethod.GET&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Security æ•´åˆ&lt;/strong&gt;ï¼šéœ€æ˜¾å¼å¯ç”¨ CORSï¼ˆåœ¨é…ç½®ä¸­è°ƒç”¨ &lt;code&gt;http.cors()&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢„æ£€è¯·æ±‚å¤±è´¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿ &lt;code&gt;allowedHeaders&lt;/code&gt; åŒ…å«è¯·æ±‚ä¸­çš„è‡ªå®šä¹‰å¤´ï¼ˆå¦‚ &lt;code&gt;Authorization&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥ &lt;code&gt;methods&lt;/code&gt; æ˜¯å¦åŒ…å« OPTIONS æ–¹æ³•ï¼ˆSpring è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µæ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æœ€ä½³å®è·µæ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§ä¼˜å…ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é¿å… &lt;code&gt;origins = &amp;quot;*&amp;quot;&lt;/code&gt; + &lt;code&gt;allowCredentials = true&lt;/code&gt; ç»„åˆ&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æŒ‰éœ€å¼€æ”¾æœ€å°æƒé™ï¼ˆå¦‚é™å®šåŸŸåã€æ–¹æ³•ã€è¯·æ±‚å¤´ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ç­–ç•¥å»ºè®®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘ç¯å¢ƒ&lt;/strong&gt;ï¼šä½¿ç”¨å…¨å±€é…ç½®å…è®¸æœ¬åœ°æºï¼ˆå¦‚ &lt;code&gt;http://localhost:3000&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ Nginx è®¾ç½® CORS å¤´éƒ¨ï¼Œå‡å°‘ä¸šåŠ¡ä»£ç ä¾µå…¥&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ•æ„Ÿæ¥å£ï¼ˆå¦‚æ”¯ä»˜ï¼‰ä¸¥æ ¼é™å®šæºå’Œæ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¿«é€ŸåŸå‹éªŒè¯ã€ç¬¬ä¸‰æ–¹ API é›†æˆã€å¾®æœåŠ¡é—´è·¨åŸŸè°ƒç”¨&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†åº”ç”¨ &lt;code&gt;@CrossOrigin&lt;/code&gt;ï¼Œå¼€å‘è€…èƒ½ä»¥æœ€å°æˆæœ¬è§£å†³è·¨åŸŸé—®é¢˜ï¼ŒåŒæ—¶ç»“åˆå…¨å±€é…ç½®æˆ–ä»£ç†æ–¹æ¡ˆï¼Œå¹³è¡¡å®‰å…¨æ€§ä¸å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="nginx-è·¨åŸŸ"&gt;Nginx è·¨åŸŸ
&lt;/h2&gt;&lt;p&gt;åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼Œè·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰æ˜¯å¸¸è§æŒ‘æˆ˜ã€‚ä½¿ç”¨ &lt;strong&gt;Nginx é…ç½®è·¨åŸŸ&lt;/strong&gt; æ˜¯æœ€ä¸»æµä¸”å®‰å…¨çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œä»¥ä¸‹ä¸ºå®Œæ•´æŒ‡å—ï¼Œæ¶µç›–åŸºç¡€é…ç½®ã€è¿›é˜¶æŠ€å·§ã€è°ƒè¯•æ–¹æ³•åŠå¸¸è§é—®é¢˜å¤„ç†ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€é…ç½®è§£å†³90é—®é¢˜"&gt;ğŸ”§ &lt;strong&gt;åŸºç¡€é…ç½®ï¼ˆè§£å†³90%é—®é¢˜ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨ Nginx çš„ &lt;code&gt;server&lt;/code&gt; æˆ– &lt;code&gt;location&lt;/code&gt; å—ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;server {
listen 80;
server_name api.example.com;
location / {
# æ ¸å¿ƒå“åº”å¤´
add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; &amp;#39;*&amp;#39; always;
add_header &amp;#39;Access-Control-Allow-Methods&amp;#39; &amp;#39;GET, POST, PUT, DELETE, OPTIONS&amp;#39; always;
add_header &amp;#39;Access-Control-Allow-Headers&amp;#39; &amp;#39;Content-Type, Authorization, X-Requested-With&amp;#39; always;
# å¤„ç†é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰
if ($request_method = &amp;#39;OPTIONS&amp;#39;) {
add_header &amp;#39;Access-Control-Max-Age&amp;#39; 1728000;
add_header &amp;#39;Content-Length&amp;#39; 0;
return 204;
}
# åå‘ä»£ç†åˆ°åç«¯æœåŠ¡
proxy_pass http://backend-server;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å…³é”®å‚æ•°è¯´æ˜"&gt;&lt;strong&gt;å…³é”®å‚æ•°è¯´æ˜&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å“åº”å¤´&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸è®¿é—®çš„æºï¼ˆåŸŸåï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;*&lt;/code&gt; æˆ– &lt;code&gt;https://your-frontend.com&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Access-Control-Allow-Methods&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸çš„ HTTP æ–¹æ³•&lt;/td&gt;
&lt;td&gt;&lt;code&gt;GET, POST, OPTIONS&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…è®¸çš„è¯·æ±‚å¤´ï¼ˆéœ€æ¶µç›–å‰ç«¯å®é™…ä½¿ç”¨çš„å¤´ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Content-Type, Authorization&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Access-Control-Max-Age&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå‡å°‘é‡å¤ OPTIONS è¯·æ±‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;86400&lt;/code&gt;ï¼ˆ24å°æ—¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;always&lt;/code&gt; å…³é”®å­—&lt;/td&gt;
&lt;td&gt;ç¡®ä¿é 200 å“åº”ï¼ˆå¦‚ 404/500ï¼‰ä¹Ÿè¿”å› CORS å¤´&lt;/td&gt;
&lt;td&gt;å¿…åŠ ï¼Œé¿å…éƒ¨åˆ†è·¨åŸŸå¤±è´¥ &lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-è¿›é˜¶é…ç½®æŠ€å·§"&gt;âš™ï¸ &lt;strong&gt;è¿›é˜¶é…ç½®æŠ€å·§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŠ¨æ€åŸŸåç™½åå•"&gt;&lt;strong&gt;åŠ¨æ€åŸŸåç™½åå•&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å…è®¸å¤šä¸ªæŒ‡å®šåŸŸåè·¨åŸŸï¼Œé¿å…ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt; çš„é€šé…ç¬¦é£é™©ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;location / {
set $cors_origin &amp;#34;&amp;#34;;
if ($http_origin ~* (https?://(www\.)?(example\.com|app\.com))) {
set $cors_origin $http_origin;
}
add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; $cors_origin always;
# å…¶ä»–é…ç½®åŒä¸Š...
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="æ”¯æŒå¸¦å‡­è¯çš„è¯·æ±‚cookieshttpè®¤è¯"&gt;&lt;strong&gt;æ”¯æŒå¸¦å‡­è¯çš„è¯·æ±‚ï¼ˆCookies/HTTPè®¤è¯ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;add_header &amp;#39;Access-Control-Allow-Credentials&amp;#39; &amp;#39;true&amp;#39; always;
add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; &amp;#39;https://your-frontend.com&amp;#39;; # å¿…é¡»æŒ‡å®šå…·ä½“åŸŸåï¼
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå¯ç”¨ &lt;code&gt;Credentials&lt;/code&gt; æ—¶ &lt;strong&gt;ç¦æ­¢&lt;/strong&gt; ä½¿ç”¨ &lt;code&gt;Access-Control-Allow-Origin: *&lt;/code&gt; &lt;a class="link" href="@ref" &gt;1,4,9&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="æš´éœ²è‡ªå®šä¹‰å“åº”å¤´"&gt;&lt;strong&gt;æš´éœ²è‡ªå®šä¹‰å“åº”å¤´&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å…è®¸å‰ç«¯è¯»å–éæ ‡å‡†å“åº”å¤´ï¼ˆå¦‚ &lt;code&gt;X-Token&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;add_header &amp;#39;Access-Control-Expose-Headers&amp;#39; &amp;#39;X-Token, Content-Range&amp;#39; always;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æµ‹è¯•ä¸è°ƒè¯•æ–¹æ³•"&gt;ğŸ› ï¸ &lt;strong&gt;æµ‹è¯•ä¸è°ƒè¯•æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æµè§ˆå™¨å¼€å‘è€…å·¥å…·&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Chrome çš„ Network æ ‡ç­¾ä¸­æ£€æŸ¥å“åº”å¤´æ˜¯å¦åŒ…å« &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt; ç­‰å­—æ®µ&lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;CURL å‘½ä»¤éªŒè¯&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; curl -I -X OPTIONS http://api.example.com
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ£€æŸ¥è¿”å›çš„ HTTP å¤´éƒ¨æ˜¯å¦ç¬¦åˆé¢„æœŸ
2
ã€‚
3. &lt;strong&gt;é”™è¯¯æ—¥å¿—æ’æŸ¥&lt;/strong&gt;
Nginx é”™è¯¯æ—¥å¿—è·¯å¾„ï¼š&lt;code&gt;/var/log/nginx/error.log&lt;/code&gt;ï¼Œæ£€æŸ¥è¯­æ³•é”™è¯¯æˆ–é…ç½®å†²çªã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³-2"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é—®é¢˜ç°è±¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› ä¸è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é…ç½®åä»æŠ¥è·¨åŸŸé”™è¯¯&lt;/td&gt;
&lt;td&gt;1. æ£€æŸ¥é…ç½®æ˜¯å¦åœ¨æ­£ç¡® &lt;code&gt;location&lt;/code&gt; å— 2. ç¡®è®¤å·²é‡å¯ Nginxï¼š&lt;code&gt;nginx -s reload&lt;/code&gt; 3. æ·»åŠ  &lt;code&gt;always&lt;/code&gt; å…³é”®å­— &lt;a class="link" href="@ref" &gt;2,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰è¿”å› 403&lt;/td&gt;
&lt;td&gt;ç¡®ä¿é…ç½®ä¸­æ˜¾å¼å¤„ç† OPTIONS æ–¹æ³•ï¼š&lt;code&gt;if ($request_method = 'OPTIONS') { ... }&lt;/code&gt; &lt;a class="link" href="@ref" &gt;1,10&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å‰ç«¯æºå¸¦ Cookie æ—¶æŠ¥é”™ï¼š&lt;code&gt;Credentials not supported with wildcard origin&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°† &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt; ä» &lt;code&gt;*&lt;/code&gt; æ”¹ä¸ºå…·ä½“åŸŸåï¼Œå¹¶å¯ç”¨ &lt;code&gt;Allow-Credentials: true&lt;/code&gt; &lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤šçº§é…ç½®å†²çª&lt;/td&gt;
&lt;td&gt;é¿å…é‡å¤ &lt;code&gt;add_header&lt;/code&gt;ï¼ŒNginx ä¼šè¦†ç›–åŒåå¤´ï¼›å»ºè®®åœ¨æœ€ç»ˆ &lt;code&gt;location&lt;/code&gt; å—ç»Ÿä¸€é…ç½® &lt;a class="link" href="@ref" &gt;2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ"&gt;ğŸ’ &lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å®‰å…¨ç¬¬ä¸€&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç¦ç”¨ &lt;code&gt;Access-Control-Allow-Origin: *&lt;/code&gt;ï¼Œé€šè¿‡ç™½åå•æ§åˆ¶åŸŸå &lt;a class="link" href="@ref" &gt;5,9&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;é™åˆ¶å…è®¸çš„æ–¹æ³•å’Œå¤´éƒ¨ï¼Œå‡å°‘æ”»å‡»é¢ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;add_header &amp;#39;Access-Control-Allow-Methods&amp;#39; &amp;#39;GET, POST&amp;#39;;
add_header &amp;#39;Access-Control-Allow-Headers&amp;#39; &amp;#39;Content-Type&amp;#39;;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;æ€§èƒ½ä¼˜åŒ–&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®è¾ƒé•¿çš„ &lt;code&gt;Access-Control-Max-Age&lt;/code&gt;ï¼ˆå¦‚ 86400 ç§’ï¼‰ï¼Œå‡å°‘é¢„æ£€è¯·æ±‚æ¬¡æ•° &lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ä¸åå‘ä»£ç†æ•´åˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥åç«¯æ˜¯ Spring Boot ç­‰åº”ç”¨ï¼ŒNginx åº”åŒæ—¶é…ç½® &lt;code&gt;proxy_pass&lt;/code&gt; å’Œ CORSï¼Œé¿å…åç«¯é‡å¤è®¾ç½® &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šé…ç½®ï¼ŒNginx å¯é«˜æ•ˆè§£å†³è·¨åŸŸé—®é¢˜ï¼ŒåŒæ—¶å…¼é¡¾å®‰å…¨æ€§ä¸æ€§èƒ½ã€‚å»ºè®®é€šè¿‡ &lt;a class="link" href="https://nginx.viraptor.info/" target="_blank" rel="noopener"
&gt;åœ¨çº¿Nginxé…ç½®æ£€æµ‹å·¥å…·&lt;/a&gt; éªŒè¯è¯­æ³•ï¼Œå†é‡å¯æœåŠ¡ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="allow-credentials"&gt;Allow-Credentials
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Access-Control-Allow-Credentials&lt;/code&gt; æ˜¯è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰ä¸­çš„å…³é”®å“åº”å¤´å­—æ®µï¼Œç”¨äºæ§åˆ¶æµè§ˆå™¨æ˜¯å¦å…è®¸åœ¨è·¨åŸŸè¯·æ±‚ä¸­æºå¸¦ç”¨æˆ·å‡­è¯ï¼ˆå¦‚ Cookieã€HTTP è®¤è¯ä¿¡æ¯ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒä½œç”¨åŠé…ç½®è¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒä½œç”¨-1"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…è®¸æºå¸¦å‡­è¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å½“æœåŠ¡å™¨è¿”å› &lt;code&gt;Access-Control-Allow-Credentials: true&lt;/code&gt; æ—¶ï¼Œ&lt;strong&gt;æµè§ˆå™¨å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯ä¿¡æ¯&lt;/strong&gt;ï¼ˆå¦‚ Cookieã€Authorization å¤´ç­‰ï¼‰&lt;a class="link" href="@ref" &gt;1,3,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æœªè®¾ç½®æ­¤å­—æ®µæˆ–å€¼ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œæµè§ˆå™¨ä¼š&lt;strong&gt;å±è”½å“åº”ä¸­æºå¸¦å‡­è¯çš„è¯·æ±‚&lt;/strong&gt;ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¸»åŠ¨è¦æ±‚å‘é€å‡­è¯ä¹Ÿä¼šå¤±è´¥&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å‰ç«¯é…ç½®è”åŠ¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»…å½“
å®¢æˆ·ç«¯æ˜¾å¼å¯ç”¨å‡­è¯æ¨¡å¼
ï¼ˆå¦‚ withCredentials: trueï¼‰ä¸”**æœåŠ¡ç«¯è¿”å›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; true
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; ** æ—¶ï¼Œå‡­è¯æ‰èƒ½æˆåŠŸä¼ é€’
3,8
ã€‚ä¾‹å¦‚ï¼š
```
// AJAX ç¤ºä¾‹
xhr.withCredentials = true;
// Fetch API ç¤ºä¾‹
fetch(url, { credentials: 'include' });
```
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®é™åˆ¶"&gt;âš ï¸ &lt;strong&gt;å…³é”®é™åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¦æ­¢ä½¿ç”¨é€šé…ç¬¦ &lt;code&gt;*&lt;/code&gt;&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å¯ç”¨å‡­è¯ï¼ˆ&lt;code&gt;true&lt;/code&gt;ï¼‰ï¼Œ&lt;strong&gt;&lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt; ä¸èƒ½è®¾ä¸º &lt;code&gt;*&lt;/code&gt;&lt;/strong&gt;ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šå…è®¸çš„åŸŸåï¼ˆå¦‚ &lt;code&gt;http://example.com&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™æµè§ˆå™¨ä¼šæŠ¥é”™ï¼š
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;The value of 'Access-Control-Allow-Origin' must not be wildcard when credentials flag is true&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢„æ£€è¯·æ±‚è¦æ±‚&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºéç®€å•è¯·æ±‚ï¼ˆå¦‚å¸¦è‡ªå®šä¹‰å¤´æˆ– JSON å†…å®¹ç±»å‹ï¼‰ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ &lt;strong&gt;OPTIONS é¢„æ£€è¯·æ±‚&lt;/strong&gt;ï¼ŒæœåŠ¡ç«¯éœ€åœ¨é¢„æ£€å“åº”ä¸­ä¹ŸåŒ…å« &lt;code&gt;Access-Control-Allow-Credentials: true&lt;/code&gt;&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®ç¤ºä¾‹"&gt;âš™ï¸ &lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æœåŠ¡ç«¯é…ç½®"&gt;&lt;strong&gt;æœåŠ¡ç«¯é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Nginx&lt;/strong&gt;ï¼ˆåœ¨ &lt;code&gt;location&lt;/code&gt; å—ä¸­æ·»åŠ ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;add_header &amp;#39;Access-Control-Allow-Credentials&amp;#39; &amp;#39;true&amp;#39; always;
add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; &amp;#39;http://your-frontend.com&amp;#39;; # å¿…é¡»å…·ä½“åŸŸåï¼
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Boot&lt;/strong&gt;ï¼ˆå…¨å±€é…ç½®ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public WebMvcConfigurer corsConfigurer() {
return new WebMvcConfigurer() {
@Override
public void addCorsMappings(CorsRegistry registry) {
registry.addMapping(&amp;#34;/**&amp;#34;)
.allowedOrigins(&amp;#34;http://your-frontend.com&amp;#34;)
.allowCredentials(true); // å¯ç”¨å‡­è¯
}
};
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Node.js&lt;/strong&gt;ï¼ˆExpress ä¸­é—´ä»¶ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;app.use((req, res, next) =&amp;gt; {
res.header(&amp;#39;Access-Control-Allow-Credentials&amp;#39;, true);
res.header(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;http://your-frontend.com&amp;#39;);
next();
});
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å‰ç«¯é…ç½®"&gt;&lt;strong&gt;å‰ç«¯é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// Axios
axios.get(url, { withCredentials: true });
// Fetch API
fetch(url, { credentials: &amp;#39;include&amp;#39; });
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³-3"&gt;ğŸ’¥ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è·¨åŸŸè¯·æ±‚ä»è¢«é˜»æ­¢&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šæœåŠ¡ç«¯æœªè¿”å› &lt;code&gt;Access-Control-Allow-Credentials: true&lt;/code&gt; æˆ– &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt; åŒ…å«é€šé…ç¬¦ &lt;code&gt;*&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼šæ£€æŸ¥å“åº”å¤´æ˜¯å¦åŒæ—¶æ»¡è¶³ï¼š
&lt;ul&gt;
&lt;li&gt;æ˜ç¡®åŸŸåï¼ˆé &lt;code&gt;*&lt;/code&gt;ï¼‰ + &lt;code&gt;Allow-Credentials: true&lt;/code&gt; + å®¢æˆ·ç«¯å¯ç”¨ &lt;code&gt;withCredentials&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢„æ£€è¯·æ±‚å¤±è´¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šOPTIONS è¯·æ±‚æœªåŒ…å« &lt;code&gt;Allow-Credentials&lt;/code&gt; å¤´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç¡®ä¿é¢„æ£€å“åº”ä¸­ä¹Ÿè¿”å› &lt;code&gt;Access-Control-Allow-Credentials: true&lt;/code&gt;&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å®‰å…¨æ³¨æ„äº‹é¡¹"&gt;ğŸ”’ &lt;strong&gt;å®‰å…¨æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœ€å°åŒ–ç™½åå•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…å¼€æ”¾è¿‡å¤šåŸŸåï¼ˆå¦‚ &lt;code&gt;*&lt;/code&gt;ï¼‰ï¼Œä»…å…è®¸ä¿¡ä»»çš„å‰ç«¯æºï¼Œé˜²æ­¢ CSRF æ”»å‡»&lt;a class="link" href="@ref" &gt;3,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•æ„Ÿå‡­è¯ä¿æŠ¤&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç”¨å‡­è¯æ—¶ï¼Œç¡®ä¿æ¥å£æœ‰é¢å¤–é‰´æƒï¼ˆå¦‚ JWT éªŒè¯ï¼‰ï¼Œé¿å…ä»…ä¾èµ– Cookie å¯¼è‡´è¶Šæƒ&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-12"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ§åˆ¶è·¨åŸŸè¯·æ±‚æ˜¯å¦å¯æºå¸¦ç”¨æˆ·å‡­è¯ï¼ˆCookie ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¿…è¦æ¡ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯ï¼š&lt;code&gt;Access-Control-Allow-Credentials: true&lt;/code&gt; + æ˜ç¡®åŸŸåï¼ˆé &lt;code&gt;*&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ï¼šå¯ç”¨ &lt;code&gt;withCredentials&lt;/code&gt; æˆ– &lt;code&gt;credentials: 'include'&lt;/code&gt;&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨&lt;/strong&gt;ï¼šä¸¥æ ¼é™åˆ¶åŸŸåç™½åå•ï¼Œç»“åˆå…¶ä»–é‰´æƒæœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é…ç½®æ—¶åŠ¡å¿…æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼Œå¤šæ•°é—®é¢˜æºäºå¤´éƒ¨å†²çªæˆ–é—æ¼&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚
å½“ &lt;code&gt;Access-Control-Allow-Credentials&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt; æ—¶ï¼Œå…è®¸ &lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt; åŒ…å« &lt;code&gt;Authorization&lt;/code&gt; æ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œä¸”æ˜¯å®‰å…¨çš„å¸¸è§é…ç½®ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å¯è¡Œæ€§åˆ†æ"&gt;âœ… &lt;strong&gt;å¯è¡Œæ€§åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®é€»è¾‘æ— å†²çª&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Access-Control-Allow-Credentials: false&lt;/code&gt; è¡¨ç¤º&lt;strong&gt;ç¦æ­¢è·¨åŸŸè¯·æ±‚æºå¸¦ç”¨æˆ·å‡­è¯&lt;/strong&gt;ï¼ˆå¦‚ Cookieã€HTTP è®¤è¯ä¿¡æ¯ï¼‰ï¼Œä½† &lt;strong&gt;&lt;code&gt;Authorization&lt;/code&gt; å¤´æœ¬èº«ä¸æ˜¯æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†çš„å‡­è¯&lt;/strong&gt;ï¼Œè€Œæ˜¯ç”±å®¢æˆ·ç«¯æ˜¾å¼æ·»åŠ çš„é‰´æƒä¿¡æ¯ï¼ˆå¦‚ JWTã€API Keyï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Authorization&lt;/code&gt; å¤´å±äº&lt;strong&gt;è‡ªå®šä¹‰è¯·æ±‚å¤´&lt;/strong&gt;ï¼Œå…¶å…è®¸ä¸å¦ç”± &lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt; æ§åˆ¶ï¼Œä¸ &lt;code&gt;allowCredentials&lt;/code&gt; æ— ç›´æ¥å…³è”&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šé…ç¬¦ &lt;code&gt;\*&lt;/code&gt; çš„æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å½“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; allowCredentials=false
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ—¶ï¼Œ
&lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt;
å¯å®‰å…¨ä½¿ç”¨é€šé…ç¬¦&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; *
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; ï¼ˆå…è®¸æ‰€æœ‰å¤´ï¼‰ï¼ŒåŒ…æ‹¬
&lt;/code&gt;&lt;/pre&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Authorization
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; 1,6
ã€‚
```
# Nginx é…ç½®ç¤ºä¾‹ï¼ˆå…è®¸æ‰€æœ‰å¤´ + æ— å‡­è¯ï¼‰
add_header 'Access-Control-Allow-Headers' '*';
add_header 'Access-Control-Allow-Credentials' 'false';
```
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ &lt;code&gt;allowCredentials=true&lt;/code&gt;ï¼Œåˆ™ &lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt; ä¸èƒ½ä½¿ç”¨ &lt;code&gt;*&lt;/code&gt;ï¼Œéœ€æ˜ç¡®åˆ—å‡ºæ‰€æœ‰å…è®¸çš„å¤´ï¼ˆå¦‚ &lt;code&gt;Authorization&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®ç¤ºä¾‹-1"&gt;âš™ï¸ &lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring Boot&lt;/strong&gt;ï¼ˆå…¨å±€ CORS é…ç½®ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public WebMvcConfigurer corsConfigurer() {
return new WebMvcConfigurer() {
@Override
public void addCorsMappings(CorsRegistry registry) {
registry.addMapping(&amp;#34;/**&amp;#34;)
.allowedOrigins(&amp;#34;https://trusted-domain.com&amp;#34;)
.allowedHeaders(&amp;#34;*&amp;#34;) // å…è®¸ Authorization ç­‰æ‰€æœ‰å¤´
.allowCredentials(false) // ç¦ç”¨å‡­è¯
.allowedMethods(&amp;#34;GET&amp;#34;, &amp;#34;POST&amp;#34;);
}
};
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Nginx&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;location / {
add_header &amp;#39;Access-Control-Allow-Origin&amp;#39; &amp;#39;https://trusted-domain.com&amp;#39;;
add_header &amp;#39;Access-Control-Allow-Headers&amp;#39; &amp;#39;*&amp;#39;; # åŒ…å« Authorization
add_header &amp;#39;Access-Control-Allow-Credentials&amp;#39; &amp;#39;false&amp;#39;;
add_header &amp;#39;Access-Control-Allow-Methods&amp;#39; &amp;#39;GET, POST, OPTIONS&amp;#39;;
if ($request_method = &amp;#39;OPTIONS&amp;#39;) {
return 204;
}
proxy_pass http://backend-server;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®‰å…¨æ€§ä¸ä½¿ç”¨åœºæ™¯"&gt;ğŸ”’ &lt;strong&gt;å®‰å…¨æ€§ä¸ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;API éœ€é€šè¿‡ &lt;code&gt;Authorization&lt;/code&gt; å¤´ä¼ é€’ &lt;strong&gt;JWT æˆ– API Key&lt;/strong&gt;ï¼Œä½†æ— éœ€ä¾èµ– Cookie/Session ç­‰æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†çš„å‡­è¯&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ–¹å¼€æ”¾ APIï¼ˆå¦‚å…¬å…±æ•°æ®æ¥å£ï¼‰ï¼Œå…è®¸ä»»æ„æ¥æºè°ƒç”¨ä½†éœ€é‰´æƒ&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§å»ºè®®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶åŸŸåç™½åå•&lt;/strong&gt;ï¼šé¿å…ä½¿ç”¨ &lt;code&gt;Access-Control-Allow-Origin: *&lt;/code&gt;ï¼Œæ˜ç¡®æŒ‡å®šå¯ä¿¡æ¥æºï¼ˆå¦‚ &lt;code&gt;https://trusted-domain.com&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€å°åŒ–å¤´éƒ¨æƒé™&lt;/strong&gt;ï¼šè‹¥æ— éœ€æ‰€æœ‰å¤´ï¼Œåº”æ˜ç¡®åˆ—å‡ºæ‰€éœ€å¤´ï¼ˆå¦‚ &lt;code&gt;Authorization, Content-Type&lt;/code&gt;ï¼‰ï¼Œè€Œéä½¿ç”¨ &lt;code&gt;*&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…æ•æ„Ÿæ“ä½œ&lt;/strong&gt;ï¼š&lt;code&gt;GET&lt;/code&gt; ç­‰éå¹‚ç­‰æ–¹æ³•è‹¥éœ€é‰´æƒï¼Œåº”ç¡®ä¿æ¥å£ä¸è¿”å›æ•æ„Ÿæ•°æ®ï¼ˆå¦‚ç”¨æˆ·éšç§ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸è§£å†³-4"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢„æ£€è¯·æ±‚å¤±è´¥&lt;/strong&gt;ï¼š
ç¡®ä¿ OPTIONS å“åº”ä¸­åŒæ ·åŒ…å« &lt;code&gt;Access-Control-Allow-Headers: Authorization&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;*&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµè§ˆå™¨æ§åˆ¶å°æŠ¥é”™&lt;/strong&gt;ï¼š
è‹¥å‡ºç° &lt;code&gt;Request header field Authorization is not allowed&lt;/code&gt;ï¼Œæ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦æœªæ­£ç¡®è¿”å› &lt;code&gt;Access-Control-Allow-Headers&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-13"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…è®¸é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;allowCredentials=false&lt;/code&gt; + &lt;code&gt;allowHeaders&lt;/code&gt; åŒ…å« &lt;code&gt;Authorization&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;*&lt;/code&gt;ï¼‰æ˜¯ &lt;strong&gt;å®Œå…¨å¯è¡Œçš„æ ‡å‡†æ–¹æ¡ˆ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨å®è·µ&lt;/strong&gt;ï¼šé€šé…ç¬¦ &lt;code&gt;*&lt;/code&gt; ä»…åœ¨æ— å‡­è¯æ—¶å®‰å…¨ï¼ŒåŒæ—¶éœ€é€šè¿‡åŸŸåç™½åå•å’Œæœ€å°æƒé™åŸåˆ™é™ä½é£é™©&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹ç”¨ä¾‹&lt;/strong&gt;ï¼šå‰åç«¯åˆ†ç¦»é¡¹ç›®ä¸­ï¼Œå‰ç«¯é€šè¿‡ &lt;code&gt;Authorization: Bearer &amp;lt;token&amp;gt;&lt;/code&gt; è°ƒç”¨è·¨åŸŸ API&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="spring-webflux"&gt;Spring Webflux
&lt;/h2&gt;&lt;p&gt;WebFluxä¸HTTPåè®®çš„å…³ç³»å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ç»¼åˆç†è§£ï¼š&lt;/p&gt;
&lt;h3 id="-webfluxçš„æ ¸å¿ƒå®šä½"&gt;âš™ï¸ &lt;strong&gt;WebFluxçš„æ ¸å¿ƒå®šä½&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;WebFluxæ˜¯Spring Framework 5å¼•å…¥çš„&lt;strong&gt;å“åº”å¼Webæ¡†æ¶&lt;/strong&gt;ï¼Œæ—¨åœ¨å¤„ç†é«˜å¹¶å‘ã€éé˜»å¡çš„è¯·æ±‚ã€‚å®ƒæ”¯æŒHTTPåè®®ä½œä¸ºæ ¸å¿ƒé€šä¿¡æ–¹å¼ï¼Œä½†ä¸ä»…é™äºHTTPã€‚å…¶è®¾è®¡ç›®æ ‡æ˜¯é€šè¿‡å¼‚æ­¥éé˜»å¡æ¨¡å‹ï¼ˆåŸºäºReactoråº“ï¼‰æå‡HTTPè¯·æ±‚å¤„ç†çš„ååé‡å’Œèµ„æºåˆ©ç”¨ç‡&lt;a class="link" href="@ref" &gt;1,2,4,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-httpåè®®çš„ç›´æ¥æ”¯æŒ"&gt;ğŸ”§ &lt;strong&gt;HTTPåè®®çš„ç›´æ¥æ”¯æŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;HTTPè¯·æ±‚å¤„ç†ï¼šWebFluxæä¾›å®Œæ•´çš„HTTPæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ”¯æŒï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;RouterFunction&lt;/code&gt;å’Œ&lt;code&gt;HandlerFunction&lt;/code&gt;å®šä¹‰è·¯ç”±ä¸å¤„ç†é€»è¾‘ï¼Œæˆ–ä½¿ç”¨æ³¨è§£ï¼ˆå¦‚&lt;code&gt;@RestController&lt;/code&gt;ï¼‰å¤„ç†HTTPè¯·æ±‚&lt;a class="link" href="@ref" &gt;4,6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯&lt;/strong&gt;ï¼šé€šè¿‡éé˜»å¡çš„&lt;code&gt;WebClient&lt;/code&gt;å‘èµ·HTTPè¯·æ±‚ï¼Œæ”¯æŒå“åº”å¼æµå¤„ç†ï¼ˆå¦‚&lt;code&gt;Mono&lt;/code&gt;/&lt;code&gt;Flux&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åè®®å…¼å®¹æ€§&lt;/strong&gt;ï¼šæ”¯æŒHTTP/1.1ã€HTTP/2ï¼Œä»¥åŠHTTPSåŠ å¯†åè®®&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è¶…è¶Šhttpçš„åè®®æ‰©å±•"&gt;ğŸŒ &lt;strong&gt;è¶…è¶ŠHTTPçš„åè®®æ‰©å±•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å°½ç®¡HTTPæ˜¯ä¸»è¦åº”ç”¨åœºæ™¯ï¼ŒWebFluxè¿˜æ”¯æŒå…¶ä»–åè®®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;WebSocket&lt;/strong&gt;ï¼šç”¨äºåŒå‘å®æ—¶é€šä¿¡ï¼ˆå¦‚èŠå¤©åº”ç”¨ï¼‰ï¼Œé€šè¿‡&lt;code&gt;WebSocketHandler&lt;/code&gt;å¤„ç†ä¼šè¯&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Server-Sent Events (SSE)&lt;/strong&gt;ï¼šæ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€å®æ—¶äº‹ä»¶æµ&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TCP/UDP&lt;/strong&gt;ï¼šé€šè¿‡Reactor Nettyç­‰å®ç°éé˜»å¡çš„åº•å±‚ç½‘ç»œé€šä¿¡&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-httpæ€§èƒ½ä¼˜åŒ–ç‰¹æ€§"&gt;âš¡ï¸ &lt;strong&gt;HTTPæ€§èƒ½ä¼˜åŒ–ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;WebFluxå¯¹HTTPåè®®çš„å¢å¼ºä½“ç°åœ¨å…¶å¼‚æ­¥æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éé˜»å¡I/O&lt;/strong&gt;ï¼šä½¿ç”¨äº‹ä»¶å¾ªç¯ï¼ˆå¦‚Nettyï¼‰å¤„ç†è¯·æ±‚ï¼Œé¿å…çº¿ç¨‹é˜»å¡ï¼Œæ˜¾è‘—æå‡é«˜å¹¶å‘ä¸‹çš„ååé‡&lt;a class="link" href="@ref" &gt;2,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èƒŒå‹æœºåˆ¶ï¼ˆBackpressureï¼‰&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;Flux&lt;/code&gt;/&lt;code&gt;Mono&lt;/code&gt;æ§åˆ¶æ•°æ®æµé€Ÿç‡ï¼Œé˜²æ­¢HTTPè¯·æ±‚è¿‡è½½å¯¼è‡´æ¶ˆè´¹è€…å´©æºƒ&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè·¯å¤ç”¨&lt;/strong&gt;ï¼šHTTP/2æ”¯æŒä¸‹ï¼Œå•è¿æ¥å¯å¹¶è¡Œå¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå‡å°‘å»¶è¿Ÿ&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸ä¼ ç»Ÿhttpå¤„ç†çš„åŒºåˆ«"&gt;ğŸ› ï¸ &lt;strong&gt;ä¸ä¼ ç»ŸHTTPå¤„ç†çš„åŒºåˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¯¹æ¯”Spring MVCï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡ vs éé˜»å¡&lt;/strong&gt;ï¼šSpring MVCåŸºäºServlet APIï¼ˆåŒæ­¥é˜»å¡ï¼‰ï¼Œè€ŒWebFluxä½¿ç”¨éé˜»å¡æ¨¡å‹ï¼Œæ›´é€‚åˆé«˜å¹¶å‘HTTPåœºæ™¯&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;ï¼šWebFluxæ”¯æŒå‡½æ•°å¼è·¯ç”±ï¼Œæä¾›æ›´çµæ´»çš„HTTPç«¯ç‚¹å®šä¹‰æ–¹å¼&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºåˆ©ç”¨&lt;/strong&gt;ï¼šä¼ ç»ŸHTTPæœåŠ¡éœ€ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…çº¿ç¨‹ï¼ŒWebFluxä»¥å°‘é‡çº¿ç¨‹å¤„ç†æ›´å¤šè¯·æ±‚ï¼Œèµ„æºæ¶ˆè€—æ›´ä½&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-14"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;WebFluxçš„æ ¸å¿ƒæ˜¯HTTPåè®®çš„å†…å®¹&lt;/strong&gt;ï¼Œä½†ä½œä¸ºå“åº”å¼æ¡†æ¶ï¼Œå®ƒæ‰©å±•äº†HTTPçš„èƒ½åŠ›ï¼ˆå¦‚å¼‚æ­¥ã€èƒŒå‹ï¼‰ï¼Œå¹¶æ”¯æŒæ›´å¤šå®æ—¶é€šä¿¡åè®®ï¼ˆå¦‚WebSocketï¼‰ã€‚&lt;strong&gt;å…¶ä»·å€¼åœ¨äºé€šè¿‡éé˜»å¡æ¨¡å‹ä¼˜åŒ–HTTPæœåŠ¡æ€§èƒ½ï¼Œè€Œéå®šä¹‰æ–°çš„åè®®æ ‡å‡†&lt;/strong&gt;ã€‚å¯¹äºçº¯HTTPåº”ç”¨ï¼Œéœ€æ ¹æ®å¹¶å‘éœ€æ±‚é€‰æ‹©é˜»å¡ï¼ˆSpring MVCï¼‰æˆ–éé˜»å¡ï¼ˆWebFluxï¼‰æ–¹æ¡ˆ&lt;a class="link" href="@ref" &gt;2,4,8&lt;/a&gt;ã€‚&lt;/p&gt;</description></item><item><title>ã€Spring Cloudã€‘Deployment</title><link>https://dyhes.github.io/p/spring-clouddeployment/</link><pubDate>Sat, 31 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/spring-clouddeployment/</guid><description>&lt;h2 id="spring-cloud-åº”ç”¨"&gt;Spring Cloud åº”ç”¨
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="nl"&gt;plugin:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;//é»˜è®¤è¡Œä¸º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./gradlew clean build
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„å»ºæ™®é€šjaråŒ…ï¼ˆç”¨äºè¢«å…¶ä»–æœåŠ¡ä¾èµ–ï¼‰å’ŒbootJaråŒ…&lt;/p&gt;
&lt;h3 id="dockerfile"&gt;Dockerfile
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# é€‰æ‹©è½»é‡çº§åŸºç¡€é•œåƒï¼ˆæ¨èï¼‰&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;eclipse-temurin:17.0.15_6-jre-ubi9-minimal&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# è®¾ç½®å·¥ä½œç›®å½•&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/app&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# å¤åˆ¶JARæ–‡ä»¶åˆ°å®¹å™¨&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; build/libs/gateway.jar app.jar&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# æš´éœ²æœåŠ¡ç«¯å£ï¼ˆä¸å®é™…ç«¯å£ä¸€è‡´ï¼‰&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;8080&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# å¯åŠ¨å‘½ä»¤&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;ENTRYPOINT&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;java&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;-jar&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;app.jar&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="nginx"&gt;Nginx
&lt;/h2&gt;&lt;p&gt;Dockerfile&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;nginx:stable-alpine&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; rm /etc/nginx/conf.d/default.conf&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; nginx.conf /etc/nginx/conf.d/&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; dist/ /usr/share/nginx/html/&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;80&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;CMD&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;-g&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;daemon off;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;nginx.conf&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-nginx" data-lang="nginx"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;try_files&lt;/span&gt; &lt;span class="nv"&gt;$uri&lt;/span&gt; &lt;span class="nv"&gt;$uri/&lt;/span&gt; &lt;span class="s"&gt;/index.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="minikube"&gt;Minikube
&lt;/h2&gt;&lt;p&gt;å¯èƒ½å­˜åœ¨ç½‘ç»œé—®é¢˜ï¼Œåœ¨ Docker Desktop æå‰æ‹‰å–é•œåƒå&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube start --driver&lt;span class="o"&gt;=&lt;/span&gt;docker &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt;--base-image&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;kicbase/stable:v0.0.45&amp;#34;&lt;/span&gt; --memory&lt;span class="o"&gt;=&lt;/span&gt;7500mb --cpus&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;&lt;/span&gt;kubectl apply -f k8s/namespace.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/volumes/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/config/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/infra/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/backend/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/frontend/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="æŸ¥çœ‹pod"&gt;æŸ¥çœ‹pod
&lt;/h3&gt;&lt;p&gt;kubectl get pods -n postopia&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹deployment"&gt;æŸ¥çœ‹deployment
&lt;/h3&gt;&lt;p&gt;kubectl get deployments -n postopia&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹åŸå› "&gt;æŸ¥çœ‹åŸå› 
&lt;/h3&gt;&lt;p&gt;kubectl describe pod mysql -n postopia
kubectl describe svc nacos -n postopia
kubectl describe pod nacos -n postopia&lt;/p&gt;
&lt;p&gt;kubectl describe pod user-service -n postopia&lt;/p&gt;
&lt;p&gt;kubectl describe pod nacos-5bb4c6c67b-4gp4q -n postopia&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹-logs"&gt;æŸ¥çœ‹ logs
&lt;/h3&gt;&lt;p&gt;kubectl logs -l app=mysql -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -l app=gateway -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -l app=comment-service -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -f comment-service-664bdb7c6d-x4trv -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -f space-service-577f84bfcc-x2vl5 -n postopia
kubectl logs mysql-*&lt;/p&gt;
&lt;p&gt;kubectl logs -f gateway-59bd97c779-x664w -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -n postopia -f user-service-67c8888fc7-7dcvq
æŸ¥çœ‹ä¸Šæ¬¡å´©æºƒå‰æ—¥å¿—
kubectl logs -f mysql-697cc894c9-stzql -n postopia â€”previous&lt;/p&gt;
&lt;p&gt;kubectl logs -f mysql-5656bc586-nktt5 -n postopia &amp;ndash;previous&lt;/p&gt;
&lt;p&gt;kubectl logs -f mysql -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -f nacos-54b76d5dcc-mrgkd -n postopia &amp;ndash;previous&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹ç¯å¢ƒå˜é‡"&gt;æŸ¥çœ‹ç¯å¢ƒå˜é‡
&lt;/h3&gt;&lt;p&gt;kubectl exec -it comment-service-664bdb7c6d-x4trv -n postopia &amp;ndash; env | grep REDIS_HOST&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹ç›®å½•"&gt;æŸ¥çœ‹ç›®å½•
&lt;/h3&gt;&lt;p&gt;kubectl exec -it mysql-697cc894c9-stzql -n postopia &amp;ndash; ls /var/run/mysqld/&lt;/p&gt;
&lt;h3 id="é‡å¯-deployment"&gt;é‡å¯ Deployment
&lt;/h3&gt;&lt;p&gt;kubectl rollout restart -n postopia deployment/&lt;deployment-name&gt;&lt;/p&gt;
&lt;p&gt;kubectl rollout restart deployment/nacos -n postopia&lt;/p&gt;
&lt;p&gt;kubectl rollout restart -n postopia deployment/user-service&lt;/p&gt;
&lt;p&gt;kubectl rollout restart deployment/comment -n postopia&lt;/p&gt;
&lt;h3 id="æ„å»ºé•œåƒ"&gt;æ„å»ºé•œåƒ
&lt;/h3&gt;&lt;p&gt;eval $(minikube docker-env)&lt;/p&gt;
&lt;p&gt;docker build -t postopia-nacos-mysql:latest ./nacos-mysql
docker build -t postopia-es:latest ./elastic-search
&lt;em&gt;# Build application services&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;docker build -t postopia-gateway:latest ./gateway
docker build -t postopia-user:latest ./user-service
docker build -t postopia-space:latest ./space-service
docker build -t postopia-post:latest ./post-service
docker build -t postopia-comment:latest ./comment-service
docker build -t postopia-message:latest ./message-service
docker build -t postopia-vote:latest ./vote-service
docker build -t postopia-opinion:latest ./opinion-service
docker build -t postopia-search:latest ./search-service&lt;/p&gt;
&lt;h3 id="åŠ è½½é•œåƒ"&gt;åŠ è½½é•œåƒ
&lt;/h3&gt;&lt;p&gt;minikube image load&lt;/p&gt;
&lt;h2 id="server"&gt;Server
&lt;/h2&gt;&lt;h2 id="kubernetes"&gt;Kubernetes
&lt;/h2&gt;&lt;p&gt;to be continued&lt;/p&gt;
&lt;p&gt;docker-compose -f compose-test.yaml up -d user-service&lt;/p&gt;
&lt;p&gt;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCutl60XhY0VKswZUESzBt3AdgqvPlNSIxJNbaSODfoUZwTsiioajG3II5mH0k9VKm6H8DYT0qwMrR2AieAVh1DOFJ1XN/vjSNXGOiF5mHkwui/nrU4bE8m6jg3AMKTPW2jpSSBh0zYstMeK50rLVu83Tt3sI7okMfTL9yATIwb+nGTsKyjEOmgG4909R88IrVJ6zuF0X0F/d5k8RoswO2i8BlOoM5jG0Jtla1fOj+w+B1AGNt0m1FXaLVjlk1sBYwM29qbBJzeET3BzHo17Q49kDfgzH/FpgIlEZordyoNc8pGx0WVp6OQtqlvq9+FF2/sYWQjsInjNSh8+PtYdv0upTiVgpG/Bx5xBuJIMrEqFXSTFcSH3sdr+rmZDIfc/V+vWaBa7D564CBH33WXZh2WkizOY+3VFhK7IDp6r3d6XkJPdUHI+orKfGFWUdnEFX/sDMn4jX/6vmE4muYxbwRniFZ1u17vgZCFwnhfNeSIIEOH+6dsQXztP6bN/761KUtOs2ST+LFNpw9mO+RPL4v2cIPqNNaqZ7Dufoy4/RlC2RbMIOGryFG+73JxmKeVwyiK2bFK0IAgV386BVunuhV0GLuBmjODa//c1KWDoKpTR1qJ0tduzlMvGN8uUuOnADZDrupUlmkwh6zx3xUHCdtWk1E917TjwZdy0sq2IqCy3Q== github-actions action@github&lt;/p&gt;</description></item><item><title>ã€Spring Cloud Gatewayã€‘Notes</title><link>https://dyhes.github.io/p/spring-cloud-gatewaynotes/</link><pubDate>Sat, 17 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/spring-cloud-gatewaynotes/</guid><description>&lt;h2 id="flux-vs-mono"&gt;Flux vs. Mono
&lt;/h2&gt;&lt;p&gt;Flux å’Œ Mono æ˜¯ Reactor æ¡†æ¶ä¸­å®ç°å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒç±»å‹ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ•°æ®æµã€‚å®ƒä»¬åŸºäº Reactive Streams è§„èŒƒï¼Œæ”¯æŒéé˜»å¡ã€èƒŒå‹ï¼ˆBackpressureï¼‰ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„å¯¹æ¯”ä¸è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ¦‚å¿µ"&gt;&lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Flux&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šè¡¨ç¤ºä¸€ä¸ª &lt;strong&gt;0åˆ°Nä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—&lt;/strong&gt;ï¼Œæ”¯æŒæ— é™æ•°æ®æµï¼ˆå¦‚å®æ—¶äº‹ä»¶æµï¼‰æˆ–æœ‰é™æ•°æ®é›†ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ç»“æœé›†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿¡å·ç±»å‹&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;onNext&lt;/code&gt; å‘é€å¤šä¸ªå…ƒç´ ï¼Œæœ€ç»ˆä»¥ &lt;code&gt;onComplete&lt;/code&gt; æˆ– &lt;code&gt;onError&lt;/code&gt; ç»ˆæ­¢æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šå¤„ç†å¤šä¸ªæ•°æ®é¡¹ï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€æ‰¹é‡æŸ¥è¯¢ï¼‰æˆ–æŒç»­ç”Ÿæˆçš„äº‹ä»¶æµï¼ˆå¦‚ä¼ æ„Ÿå™¨æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Mono&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šè¡¨ç¤º &lt;strong&gt;0æˆ–1ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—&lt;/strong&gt;ï¼Œç”¨äºå•æ¬¡ç»“æœæ“ä½œï¼ˆå¦‚ HTTP è¯·æ±‚ã€å”¯ä¸€ ID æŸ¥è¯¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿¡å·ç±»å‹&lt;/strong&gt;ï¼šæœ€å¤šè§¦å‘ä¸€æ¬¡ &lt;code&gt;onNext&lt;/code&gt;ï¼Œéšåç«‹å³ç»ˆæ­¢ï¼ˆ&lt;code&gt;onComplete&lt;/code&gt; æˆ– &lt;code&gt;onError&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šè¿”å›å•ä¸ªå¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ã€æ— è¿”å›å€¼çš„å¼‚æ­¥æ“ä½œï¼ˆå¦‚ä¿å­˜æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”"&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;Flux&lt;/th&gt;
&lt;th&gt;Mono&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…ƒç´ æ•°é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0-N ä¸ªï¼Œæ”¯æŒæ— é™æµ&lt;/td&gt;
&lt;td&gt;0æˆ–1ä¸ª&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ“ä½œç¬¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒå¤šå…ƒç´ æ“ä½œï¼ˆå¦‚ &lt;code&gt;buffer&lt;/code&gt;ã€&lt;code&gt;flatMap&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;å•å…ƒç´ æ“ä½œï¼ˆå¦‚ &lt;code&gt;map&lt;/code&gt;ã€&lt;code&gt;flatMap&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆæ‰¹é‡æ•°æ®å¤„ç†ï¼Œå†…å­˜å ç”¨è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;å•ç»“æœå¤„ç†ï¼Œè½»é‡çº§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é”™è¯¯ç»ˆæ­¢æ•´ä¸ªæµ&lt;/td&gt;
&lt;td&gt;ç›´æ¥ä¼ é€’é”™è¯¯ä¿¡å·&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨åœºæ™¯"&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="flux-çš„å…¸å‹åº”ç”¨"&gt;&lt;strong&gt;Flux çš„å…¸å‹åº”ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ•°æ®æŸ¥è¯¢&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findAll&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶äº‹ä»¶æµå¤„ç†&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Event&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;interval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofSeconds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tick&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generateEvent&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¯ç§’ç”Ÿæˆäº‹ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è½¬æ¢ä¸èšåˆ&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;flatMap&lt;/code&gt; å’Œ &lt;code&gt;groupBy&lt;/code&gt; å¯¹å¤šä¸ªæ•°æ®æµè¿›è¡Œåˆå¹¶æˆ–æ‹†åˆ†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="mono-çš„å…¸å‹åº”ç”¨"&gt;&lt;strong&gt;Mono çš„å…¸å‹åº”ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å•æ¬¡æ•°æ®åº“æŸ¥è¯¢&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP è¯·æ±‚å“åº”&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/user/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥æ“ä½œç»“æœå°è£…&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saveOperation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;then&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿å­˜åè¿”å›ç©º&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ“ä½œç¬¦ä¸åŠŸèƒ½"&gt;&lt;strong&gt;æ“ä½œç¬¦ä¸åŠŸèƒ½&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…±æœ‰æ“ä½œç¬¦"&gt;&lt;strong&gt;å…±æœ‰æ“ä½œç¬¦&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½¬æ¢ç±»&lt;/strong&gt;ï¼š&lt;code&gt;map&lt;/code&gt;ï¼ˆå…ƒç´ è½¬æ¢ï¼‰ã€&lt;code&gt;flatMap&lt;/code&gt;ï¼ˆå¼‚æ­¥è½¬æ¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ»¤ç±»&lt;/strong&gt;ï¼š&lt;code&gt;filter&lt;/code&gt;ï¼ˆæ¡ä»¶è¿‡æ»¤ï¼‰ã€&lt;code&gt;take&lt;/code&gt;ï¼ˆé™åˆ¶å…ƒç´ æ•°é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼š&lt;code&gt;onErrorResume&lt;/code&gt;ï¼ˆé”™è¯¯é™çº§ï¼‰ã€&lt;code&gt;retry&lt;/code&gt;ï¼ˆé‡è¯•æœºåˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç‰¹æœ‰æ“ä½œç¬¦"&gt;&lt;strong&gt;ç‰¹æœ‰æ“ä½œç¬¦&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æ“ä½œç¬¦&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Flux&lt;/td&gt;
&lt;td&gt;&lt;code&gt;buffer(10)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†å…ƒç´ æŒ‰æ‰¹æ¬¡æ”¶é›†ï¼ˆå¦‚æ¯10ä¸ªä¸€ç»„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flux&lt;/td&gt;
&lt;td&gt;&lt;code&gt;zipWith(otherFlux)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆå¹¶ä¸¤ä¸ªæµå¹¶æŒ‰å…ƒç´ é…å¯¹å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mono&lt;/td&gt;
&lt;td&gt;&lt;code&gt;defaultIfEmpty()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºå€¼æ—¶è¿”å›é»˜è®¤å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mono&lt;/td&gt;
&lt;td&gt;&lt;code&gt;then(Mono)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰æµå®Œæˆåè§¦å‘å¦ä¸€ä¸ªæµ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä»£ç ç¤ºä¾‹"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="flux-ç¤ºä¾‹"&gt;&lt;strong&gt;Flux ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åˆ›å»ºåŒ…å«å¤šä¸ªå…ƒç´ çš„æµå¹¶è½¬æ¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;numbers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è½¬æ¢ä¸º [2, 4, 6]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿‡æ»¤å‡º [4, 6]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;numbers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;subscribe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="mono-ç¤ºä¾‹"&gt;&lt;strong&gt;Mono ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ¨¡æ‹Ÿå¼‚æ­¥æŸ¥è¯¢ç”¨æˆ·å¹¶å¤„ç†ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userMono&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flatMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toUpperCase&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;onErrorResume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;fallback&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯æ—¶è¿”å›é»˜è®¤ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;userMono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;subscribe&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å¦‚ä½•é€‰æ‹©-flux-æˆ–-mono"&gt;&lt;strong&gt;å¦‚ä½•é€‰æ‹© Flux æˆ– Monoï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®é‡&lt;/strong&gt;ï¼šéœ€è¦å¤„ç†å¤šä¸ªå…ƒç´ æ—¶é€‰ Fluxï¼Œå•ä¸ªæˆ–æ— ç»“æœæ—¶é€‰ Monoã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;ï¼šMono æ›´è½»é‡ï¼Œé€‚åˆé«˜é¢‘å•æ¬¡æ“ä½œï¼›Flux é€‚åˆæ‰¹é‡æˆ–æµå¼å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­ä¹‰æ˜ç¡®æ€§&lt;/strong&gt;ï¼šä½¿ç”¨ Mono å¯å¢å¼ºä»£ç å¯è¯»æ€§ï¼ˆå¦‚æ˜ç¡®è¡¨ç¤ºâ€œå¯èƒ½æœ‰æˆ–æ²¡æœ‰ç»“æœâ€ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Flux å’Œ Mono æ˜¯å“åº”å¼ç¼–ç¨‹çš„åŸºçŸ³ï¼Œåˆ†åˆ«è§£å†³å¤šå…ƒç´ å’Œå•å…ƒç´ å¼‚æ­¥æµå¤„ç†çš„é—®é¢˜ã€‚Flux æ“…é•¿å¤æ‚çš„æ•°æ®æµæ“ä½œï¼ˆå¦‚åˆå¹¶ã€æ‰¹å¤„ç†ï¼‰ï¼Œè€Œ Mono åœ¨å•ç»“æœåœºæ™¯ä¸­æ›´é«˜æ•ˆç›´è§‚ã€‚å®é™…å¼€å‘ä¸­éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ï¼Œä¾‹å¦‚åœ¨ Spring WebFlux ä¸­ï¼ŒController æ–¹æ³•é€šå¸¸è¿”å› Monoï¼ˆå•ç»“æœï¼‰æˆ– Fluxï¼ˆåˆ—è¡¨æˆ–æµï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="serverhttprequestdecorator"&gt;ServerHttpRequestDecorator
&lt;/h2&gt;&lt;p&gt;ServerHttpRequestDecorator æ˜¯ Spring WebFlux æ¡†æ¶ä¸­ç”¨äºå¢å¼ºæˆ–ä¿®æ”¹ HTTP è¯·æ±‚çš„æ ¸å¿ƒå·¥å…·ç±»ï¼ŒåŸºäºè£…é¥°å™¨æ¨¡å¼å®ç°å¯¹è¯·æ±‚çš„æ‹¦æˆªå’ŒåŠ¨æ€å¤„ç†ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ã€ä½¿ç”¨åœºæ™¯åŠç¤ºä¾‹çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ä¿¡æ¯æ‹¦æˆªä¸ä¿®æ”¹&lt;/strong&gt;&lt;br&gt;
ç»§æ‰¿è‡ª &lt;code&gt;ServerHttpRequest&lt;/code&gt;ï¼Œé€šè¿‡é‡å†™ &lt;code&gt;getHeaders()&lt;/code&gt;ã€&lt;code&gt;getBody()&lt;/code&gt; ç­‰æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰å…³é”®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒåŠ¨æ€æ·»åŠ è¯·æ±‚å¤´ã€è§£å¯†è¯·æ±‚å†…å®¹æˆ–ç»Ÿä¸€è¯·æ±‚æ ¼å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è£…é¥°å™¨æ¨¡å¼å®ç°&lt;/strong&gt;&lt;br&gt;
åœ¨ä¸æ”¹å˜åŸå§‹ &lt;code&gt;ServerHttpRequest&lt;/code&gt; å¯¹è±¡çš„åŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨å’Œå¤šå±‚åŒ…è£…ï¼Œé€‚ç”¨äºå¯¹è¯·æ±‚è¿›è¡Œéä¾µå…¥å¼å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;å…³é”®æ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¸¸ç”¨æ–¹æ³•"&gt;&lt;strong&gt;å¸¸ç”¨æ–¹æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;getHeaders()&lt;/code&gt;&lt;br&gt;
é‡å†™æ­¤æ–¹æ³•å¯åŠ¨æ€ä¿®æ”¹è¯·æ±‚å¤´ä¿¡æ¯ï¼ˆå¦‚å¼ºåˆ¶è®¾ç½® &lt;code&gt;Content-Type&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;getBody()&lt;/code&gt;&lt;br&gt;
æ‹¦æˆªè¯·æ±‚ä½“æ•°æ®æµï¼ˆ&lt;code&gt;Flux&amp;lt;DataBuffer&amp;gt;&lt;/code&gt;ï¼‰ï¼Œå…è®¸å¯¹åŸå§‹æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆå¦‚è§£å¯†ã€æ—¥å¿—è®°å½•ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä»£ç ç¤ºä¾‹-1"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;åœºæ™¯ï¼šå¼ºåˆ¶è®¾ç½®è¯·æ±‚å¤´çš„ Content-Type&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ContentRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ContentRequestDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writableHttpHeaders&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setContentType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;APPLICATION_JSON&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼ºåˆ¶è®¾ç½®ä¸º JSON ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åº”ç”¨æ–¹å¼&lt;/strong&gt;&lt;br&gt;
åœ¨è¿‡æ»¤å™¨ä¸­åŒ…è£…åŸå§‹è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WebFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WebFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ContentRequestDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedRequest&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åœºæ™¯ï¼šè§£å¯†è¯·æ±‚ä½“å†…å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DecryptRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;releaseBufferToString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decrypted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AesUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰è§£å¯†é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decrypted&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚å¤´åŠ¨æ€å¤„ç†&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚ç»Ÿä¸€æ·»åŠ è®¤è¯å¤´ï¼ˆå¦‚ &lt;code&gt;Authorization&lt;/code&gt;ï¼‰æˆ–ä¿®å¤å®¢æˆ·ç«¯ç¼ºå¤±çš„ &lt;code&gt;Content-Type&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ä½“å†…å®¹è½¬æ¢&lt;/strong&gt;&lt;br&gt;
è§£å¯†æ•æ„Ÿæ•°æ®ã€å‹ç¼©/è§£å‹ç¼©è¯·æ±‚ä½“ï¼Œæˆ–è®°å½•åŸå§‹è¯·æ±‚å†…å®¹ç”¨äºè°ƒè¯•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åè®®å…¼å®¹æ€§é€‚é…&lt;/strong&gt;&lt;br&gt;
å°†éæ ‡å‡†åè®®ï¼ˆå¦‚è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼ï¼‰è½¬æ¢ä¸ºæ ‡å‡† HTTP è¯·æ±‚ï¼Œæ–¹ä¾¿åç»­å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æ ¼å¼ç»Ÿä¸€&lt;/strong&gt;&lt;br&gt;
å¯¹å¼‚æ„å®¢æˆ·ç«¯å‘é€çš„ XMLã€è¡¨å•æ•°æ®ç­‰ç»Ÿä¸€è½¬æ¢ä¸º JSONï¼Œç®€åŒ–ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…é‡å¤æäº¤&lt;/strong&gt;&lt;br&gt;
è‹¥ç›´æ¥æ“ä½œè¯·æ±‚ä½“æ•°æ®æµï¼Œéœ€ç¡®ä¿æ•°æ®ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œå¦åˆ™ä¼šè§¦å‘ &lt;code&gt;IllegalStateException&lt;/code&gt;ã€‚å¯é€šè¿‡ç¼“å­˜ï¼ˆå¦‚ &lt;code&gt;Flux.cache()&lt;/code&gt;ï¼‰è§£å†³ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
é«˜é¢‘è¯·æ±‚å¤„ç†éœ€æ³¨æ„å†…å­˜ç®¡ç†ï¼Œæ¨èä½¿ç”¨éé˜»å¡å¼æµå¤„ç†ï¼ˆå¦‚ &lt;code&gt;Flux.map&lt;/code&gt; ä»£æ›¿åŒæ­¥å¾ªç¯ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ ServerWebExchange é›†æˆ&lt;/strong&gt;&lt;br&gt;
é€šå¸¸ç»“åˆ &lt;code&gt;ServerWebExchange.mutate()&lt;/code&gt; æ–¹æ³•ï¼Œå°†è£…é¥°åçš„è¯·æ±‚æ³¨å…¥è¿‡æ»¤å™¨é“¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç›¸å…³ç±»å¯¹æ¯”"&gt;&lt;strong&gt;ç›¸å…³ç±»å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServerHttpRequest&lt;/strong&gt;&lt;br&gt;
åŸå§‹è¯·æ±‚æ¥å£ï¼Œæä¾›åŸºç¡€è¯·æ±‚ä¿¡æ¯è®¿é—®èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServletServerHttpRequest&lt;/strong&gt;&lt;br&gt;
é’ˆå¯¹ Servlet å®¹å™¨çš„é€‚é…å™¨ï¼Œå°† &lt;code&gt;HttpServletRequest&lt;/code&gt; è½¬æ¢ä¸ºå“åº”å¼è¯·æ±‚å¯¹è±¡ï¼Œé€šå¸¸ä¸ &lt;code&gt;ServerHttpRequestDecorator&lt;/code&gt; é…åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†åº”ç”¨ &lt;code&gt;ServerHttpRequestDecorator&lt;/code&gt;ï¼Œå¼€å‘è€…èƒ½å¤Ÿçµæ´»æ§åˆ¶è¯·æ±‚å¤„ç†æµç¨‹ï¼Œæ»¡è¶³å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="serverhttpresponsedecorator"&gt;ServerHttpResponseDecorator
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Gateway ä¸­ï¼Œ&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt; æ˜¯ä¸€ä¸ªç”¨äºåŒ…è£…å¹¶å¢å¼º &lt;code&gt;ServerHttpResponse&lt;/code&gt; åŠŸèƒ½çš„å·¥å…·ç±»ï¼Œä¸»è¦ç”¨äºæ‹¦æˆªå’Œä¿®æ”¹ç½‘å…³çš„å“åº”å†…å®¹ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œåº”ç”¨åœºæ™¯çš„è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨-1"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”å†…å®¹æ‹¦æˆªä¸ä¿®æ”¹&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt; ç»§æ‰¿è‡ª &lt;code&gt;ServerHttpResponse&lt;/code&gt;ï¼Œé€šè¿‡é‡å†™ &lt;code&gt;writeWith()&lt;/code&gt; æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å“åº”ä½“å†™å…¥å‰æˆ–å†™å…¥åå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å“åº”å¤´ã€åŠ å¯†å“åº”å†…å®¹æˆ–è®°å½•æ—¥å¿—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è£…é¥°å™¨æ¨¡å¼å®ç°&lt;/strong&gt;&lt;br&gt;
é€šè¿‡è£…é¥°å™¨æ¨¡å¼ï¼Œ&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt; åœ¨ä¸æ”¹å˜åŸå§‹ &lt;code&gt;ServerHttpResponse&lt;/code&gt; å¯¹è±¡çš„åŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨å’Œå¤šé‡åŒ…è£…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…³é”®æ–¹æ³•"&gt;&lt;strong&gt;å…³é”®æ–¹æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;writeWith(Publisher&amp;lt;DataBuffer&amp;gt; body)&lt;/code&gt;&lt;br&gt;
é‡å†™æ­¤æ–¹æ³•ä»¥æ‹¦æˆªåŸå§‹å“åº”ä½“çš„æ•°æ®æµï¼Œå…è®¸å¯¹ &lt;code&gt;DataBuffer&lt;/code&gt; è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼ˆå¦‚å­—ç¬¦ä¸²è½¬æ¢ã€JSON åºåˆ—åŒ–ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;getDelegate()&lt;/code&gt;&lt;br&gt;
è·å–è¢«è£…é¥°çš„åŸå§‹ &lt;code&gt;ServerHttpResponse&lt;/code&gt; å®ä¾‹ï¼Œä¾¿äºç›´æ¥æ“ä½œåº•å±‚å±æ€§ï¼ˆå¦‚çŠ¶æ€ç ã€Cookie ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä»£ç ç¤ºä¾‹-2"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomResponseDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponseDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;CustomResponseDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Publisher&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿®æ”¹å“åº”ä½“å†…å®¹ï¼ˆä¾‹å¦‚æ·»åŠ å‰ç¼€ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;modifiedBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;from&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;releaseBufferToString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Modified: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;modifiedBody&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿‡æ»¤å™¨ä¸­åº”ç”¨è¯¥è£…é¥°å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CustomResponseDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€ä¿®æ”¹å“åº”å¤´&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚æ·»åŠ å®‰å…¨ç›¸å…³çš„ &lt;code&gt;Content-Security-Policy&lt;/code&gt; æˆ–è‡ªå®šä¹‰ä¸šåŠ¡æ ‡è¯†å¤´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€å“åº”æ ¼å¼&lt;/strong&gt;&lt;br&gt;
å¯¹åç«¯æœåŠ¡çš„åŸå§‹å“åº”è¿›è¡Œå°è£…ï¼Œç»Ÿä¸€é”™è¯¯ç æˆ–æ ‡å‡†åŒ–æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—è®°å½•ä¸ç›‘æ§&lt;/strong&gt;&lt;br&gt;
è®°å½•å“åº”è€—æ—¶ã€å“åº”ä½“å¤§å°ç­‰æŒ‡æ ‡ï¼Œé›†æˆç›‘æ§ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•æ„Ÿæ•°æ®è„±æ•&lt;/strong&gt;&lt;br&gt;
åœ¨å“åº”è¿”å›å®¢æˆ·ç«¯å‰ï¼Œå¯¹æ•æ„Ÿå­—æ®µï¼ˆå¦‚æ‰‹æœºå·ã€èº«ä»½è¯å·ï¼‰è¿›è¡Œè„±æ•å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”æäº¤çŠ¶æ€&lt;/strong&gt;&lt;br&gt;
éœ€é€šè¿‡ &lt;code&gt;isCommitted()&lt;/code&gt; æ–¹æ³•åˆ¤æ–­å“åº”æ˜¯å¦å·²æäº¤ï¼Œé¿å…é‡å¤æ“ä½œå¯¼è‡´å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;br&gt;
å“åº”ä½“çš„æ‹¦æˆªå’Œä¿®æ”¹æ¶‰åŠæ•°æ®æµæ“ä½œï¼Œéœ€æ³¨æ„å†…å­˜æ¶ˆè€—å’Œå»¶è¿Ÿï¼Œå»ºè®®ä½¿ç”¨éé˜»å¡å¼å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç›¸å…³ç±»ä¸ä¸Šä¸‹æ–‡"&gt;&lt;strong&gt;ç›¸å…³ç±»ä¸ä¸Šä¸‹æ–‡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerWebExchange&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ç½‘å…³è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒæŒæœ‰ &lt;code&gt;ServerHttpRequest&lt;/code&gt; å’Œ &lt;code&gt;ServerHttpResponse&lt;/code&gt;ï¼Œæ˜¯æ“ä½œè¯·æ±‚å’Œå“åº”çš„å…¥å£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ReactorServerHttpResponse&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ServerHttpResponse&lt;/code&gt; çš„é»˜è®¤å®ç°ç±»ï¼ŒåŸºäº Netty çš„å“åº”å¤„ç†ï¼Œå…¶ &lt;code&gt;HttpHeaders&lt;/code&gt; å¯ç›´æ¥ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†ä½¿ç”¨ &lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt;ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»æ§åˆ¶ç½‘å…³çš„å“åº”è¡Œä¸ºï¼Œæ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;</description></item></channel></rss>