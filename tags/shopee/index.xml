<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Shopee on é£é¸¿è¸é›ªæ³¥</title><link>https://dyhes.github.io/tags/shopee/</link><description>Recent content in Shopee on é£é¸¿è¸é›ªæ³¥</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 30 Sep 2025 19:46:00 +0800</lastBuildDate><atom:link href="https://dyhes.github.io/tags/shopee/index.xml" rel="self" type="application/rss+xml"/><item><title>ã€Shopeeã€‘JavaParser</title><link>https://dyhes.github.io/p/shopeejavaparser/</link><pubDate>Sun, 28 Sep 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeejavaparser/</guid><description>&lt;h2 id="javaparser--antlr"&gt;JavaParser &amp;amp; ANTLR
&lt;/h2&gt;&lt;p&gt;JavaParser å’Œ ANTLR éƒ½æ˜¯ç”¨äºè§£æä»£ç çš„å¼ºå¤§å·¥å…·ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡ã€åº”ç”¨æ–¹å¼å’Œé€‚ç”¨åœºæ™¯æœ‰æ˜¾è‘—åŒºåˆ«ã€‚ä¸ºäº†å¸®ä½ å¿«é€ŸæŠŠæ¡å®ƒä»¬çš„å…³ç³»ä¸æ ¸å¿ƒåŒºåˆ«ï¼Œæˆ‘å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;JavaParser&lt;/th&gt;
&lt;th&gt;ANTLR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®šä½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸“ä¸€å‹&lt;/strong&gt;ï¼Œä¸“æ³¨äº Java è¯­è¨€çš„è§£æåº“&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é€šç”¨å‹&lt;/strong&gt;ï¼Œæ”¯æŒå¤šç§è¯­è¨€çš„è§£æå™¨ç”Ÿæˆå™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›å¼€ç®±å³ç”¨çš„ &lt;strong&gt;Java AST API&lt;/strong&gt;ï¼Œç›´æ¥è§£æ Java ä»£ç &lt;/td&gt;
&lt;td&gt;æ ¹æ®ç”¨æˆ·å®šä¹‰çš„è¯­æ³•è§„åˆ™æ–‡ä»¶ï¼ˆ&lt;code&gt;.g4&lt;/code&gt;ï¼‰ï¼Œ&lt;strong&gt;ç”Ÿæˆ&lt;/strong&gt;ç‰¹å®šè¯­è¨€çš„è¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰å’Œè¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦è¾“å‡º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Java è¯­è¨€çš„ &lt;strong&gt;æŠ½è±¡è¯­æ³•æ ‘ (AST)&lt;/strong&gt;ï¼ŒèŠ‚ç‚¹ç±»å‹é’ˆå¯¹ Java ç»“æ„ï¼ˆå¦‚ &lt;code&gt;CompilationUnit&lt;/code&gt;, &lt;code&gt;MethodDeclaration&lt;/code&gt;ï¼‰é«˜åº¦ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è§£ææ ‘ (Parse Tree)&lt;/strong&gt; æˆ– &lt;strong&gt;CST (å…·ä½“è¯­æ³•æ ‘)&lt;/strong&gt;ï¼Œä¸¥æ ¼åæ˜ è¯­æ³•è§„åˆ™ï¼ŒåŒ…å«æ›´å¤šç»†èŠ‚ï¼ˆå¦‚æ¯ä¸ªæ‹¬å·ã€é€—å·ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜“ç”¨æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸Šæ‰‹å¿«é€Ÿ&lt;/strong&gt;ï¼Œæ·»åŠ ä¾èµ–å³å¯è°ƒç”¨ API è§£æ Java ä»£ç &lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æ›²çº¿è¾ƒé™¡&lt;/strong&gt;ï¼Œéœ€è¦å­¦ä¹ è¯­æ³•æ–‡ä»¶ç¼–å†™ï¼Œå¹¶å¤„ç†ç”Ÿæˆçš„ä»£ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çµæ´»æ€§ç›¸å¯¹è¾ƒä½ï¼Œä¸»è¦æœåŠ¡äº Java è¯­è¨€&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æé«˜&lt;/strong&gt;ï¼Œå¯ç”¨äºä¸ºä»»ä½•è‡ªå®šä¹‰è¯­è¨€æˆ–æ•°æ®æ ¼å¼æ„å»ºè§£æå™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Java ä»£ç é™æ€åˆ†æã€è‡ªåŠ¨åŒ–é‡æ„ã€æ–‡æ¡£ç”Ÿæˆã€IDE åŠŸèƒ½å¢å¼º&lt;/td&gt;
&lt;td&gt;ç¼–è¯‘å™¨/è§£é‡Šå™¨å¼€å‘ã€é¢†åŸŸç‰¹å®šè¯­è¨€ (DSL) è®¾è®¡ã€å¤æ‚æ–‡æœ¬æ ¼å¼è§£æã€å¤šè¯­è¨€å·¥å…·é“¾&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ååŒä¸é€‰æ‹©"&gt;ğŸ”„ ååŒä¸é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å®šä½ä¸åŒï¼Œä½†åœ¨æŠ€æœ¯ç”Ÿæ€ä¸­ï¼ŒJavaParser å’Œ ANTLR å¹¶éå®Œå…¨å‰²è£‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯èƒ½çš„ååŒ&lt;/strong&gt;ï¼šç†è®ºä¸Šï¼Œå¯ä»¥åˆ©ç”¨ ANTLR å¼ºå¤§çš„ Java è¯­æ³•å®šä¹‰ï¼ˆå¦‚å®˜æ–¹ grammars-v4 é¡¹ç›®ä¸­çš„ Java è¯­æ³•æ–‡ä»¶ï¼‰æ¥ç”ŸæˆåŸºç¡€è§£æå™¨ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºåƒ JavaParser è¿™æ ·æ›´æ˜“ç”¨çš„é«˜çº§æŠ½è±¡ã€‚è¿™å°±åƒæ˜¯ ANTLR æä¾›äº†â€œå‘åŠ¨æœºé›¶ä»¶â€ï¼Œè€Œ JavaParser ç»„è£…æˆäº†ä¸€å°â€œå³å¼€å³ç”¨çš„æ±½è½¦â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚ä½•é€‰æ‹©&lt;/strong&gt;ï¼šä½ çš„é€‰æ‹©å®Œå…¨å–å†³äºé¡¹ç›®éœ€æ±‚ã€‚
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ çš„ä»»åŠ¡&lt;strong&gt;ä¸“æ³¨äº Java ä»£ç çš„åˆ†æå’Œå¤„ç†&lt;/strong&gt;ï¼Œå¸Œæœ›å¿«é€Ÿä¸Šæ‰‹ï¼Œé‚£ä¹ˆ &lt;strong&gt;JavaParser&lt;/strong&gt; æ— ç–‘æ˜¯æ›´ç›´æ¥ã€é«˜æ•ˆçš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ éœ€è¦è§£æ &lt;strong&gt;Java ä»¥å¤–çš„è¯­è¨€&lt;/strong&gt;ï¼ˆå¦‚ Pythonã€SQL ç­‰ï¼‰ï¼Œæˆ–æ­£åœ¨&lt;strong&gt;è®¾è®¡ä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€æˆ–æ•°æ®æ ¼å¼&lt;/strong&gt;ï¼Œé‚£ä¹ˆ &lt;strong&gt;ANTLR&lt;/strong&gt; æ˜¯ä½ å¿…é¡»ä½¿ç”¨çš„å¼ºå¤§å·¥å…·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå¯ä»¥å°† JavaParser ç†è§£ä¸ºä¸€æŠŠä¸º Java ä»£ç â€œé‡èº«å®šåˆ¶â€çš„ç²¾å¯†èºä¸åˆ€ï¼Œè€Œ ANTLR åˆ™æ˜¯ä¸€ä¸ªèƒ½åˆ¶é€ å„ç§è§„æ ¼èºä¸åˆ€çš„â€œä¸‡èƒ½å·¥å…·å·¥å‚â€ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ¸…æ™°ç†è§£å®ƒä»¬çš„å…³ç³»ã€‚å¦‚æœä½ æœ‰å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æ‰“ç®—åšå“ªæ–¹é¢çš„ä»£ç åˆ†æï¼Œæˆ–è®¸æˆ‘å¯ä»¥æä¾›æ›´è¿›ä¸€æ­¥çš„å»ºè®®ã€‚&lt;/p&gt;
&lt;h2 id="compilationunit"&gt;CompilationUnit
&lt;/h2&gt;&lt;p&gt;JavaParser ä¸­çš„ &lt;code&gt;CompilationUnit&lt;/code&gt;å¯¹è±¡ä»£è¡¨ä¸€ä¸ª Java æºä»£ç æ–‡ä»¶çš„å®Œæ•´ç»“æ„ï¼Œæ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰çš„æ ¹èŠ‚ç‚¹ã€‚ä¸‹è¡¨æ¦‚æ‹¬äº†å…¶ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç»„æˆéƒ¨åˆ†&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒ…å£°æ˜ (Package Declaration)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºæ–‡ä»¶çš„åŒ…åä¿¡æ¯ï¼ˆå¦‚ &lt;code&gt;package com.example;&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯¼å…¥å£°æ˜ (Imports)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºæ–‡ä»¶çš„å¯¼å…¥è¯­å¥ï¼ˆå¦‚ &lt;code&gt;import java.util.List;&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å‹å£°æ˜ (Type Declarations)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºæ–‡ä»¶ä¸­å®šä¹‰çš„ç±»ã€æ¥å£ã€æšä¸¾æˆ–æ³¨è§£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨é‡Š (Comments)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒ…å«æ–‡ä»¶ä¸­çš„è¡Œæ³¨é‡Šã€å—æ³¨é‡Šå’Œ JavaDoc æ³¨é‡Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é¡¶çº§æ³¨è§£ (Top-level Annotations)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨äºæ•´ä¸ªæ–‡ä»¶æˆ–æ¨¡å—çš„æ³¨è§£&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="æ ¸å¿ƒç»„æˆéƒ¨åˆ†è¯¦è§£"&gt;æ ¸å¿ƒç»„æˆéƒ¨åˆ†è¯¦è§£
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒ…å£°æ˜ (Package Declaration)&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;CompilationUnit&lt;/code&gt;çš„ &lt;code&gt;getPackageDeclaration()&lt;/code&gt;æ–¹æ³•å¯ä»¥è·å–å½“å‰æ–‡ä»¶çš„åŒ…å£°æ˜ä¿¡æ¯ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code&gt;setPackageDeclaration(String packageName)&lt;/code&gt;æ–¹æ³•æ¥è®¾ç½®æˆ–ä¿®æ”¹åŒ…åã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¼å…¥å£°æ˜ (Imports)&lt;/strong&gt;ï¼š&lt;code&gt;CompilationUnit&lt;/code&gt;æä¾› &lt;code&gt;getImports()&lt;/code&gt;æ–¹æ³•æ¥è·å–æ‰€æœ‰å¯¼å…¥å£°æ˜çš„åˆ—è¡¨ï¼Œä»¥åŠ &lt;code&gt;addImport(String importName)&lt;/code&gt;æ–¹æ³•æ¥æ·»åŠ æ–°çš„å¯¼å…¥è¯­å¥ã€‚è¿™åœ¨è‡ªåŠ¨æ·»åŠ ä¾èµ–æ—¶éå¸¸æœ‰ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹å£°æ˜ (Type Declarations)&lt;/strong&gt;ï¼šè¿™æ˜¯ &lt;code&gt;CompilationUnit&lt;/code&gt;ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒåŒ…å«äº†æ–‡ä»¶å†…å®é™…çš„ç±»ã€æ¥å£ã€æšä¸¾æˆ–æ³¨è§£çš„å®šä¹‰ã€‚ä½ å¯ä»¥é€šè¿‡ &lt;code&gt;getTypes()&lt;/code&gt;æ–¹æ³•è·å–æ‰€æœ‰ç±»å‹å£°æ˜çš„åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;addClass(String className)&lt;/code&gt;ç­‰æ–¹æ³•æ¥æ·»åŠ æ–°çš„ç±»å‹å®šä¹‰ã€‚æ¯ä¸ªç±»å‹å£°æ˜æœ¬èº«åˆæ˜¯ä¸€ä¸ªå¤æ‚çš„èŠ‚ç‚¹ï¼ŒåŒ…å«æ–¹æ³•ã€å­—æ®µç­‰å­èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨é‡Š (Comments)&lt;/strong&gt; ä¸ &lt;strong&gt;é¡¶çº§æ³¨è§£&lt;/strong&gt;ï¼š&lt;code&gt;CompilationUnit&lt;/code&gt;ä¹Ÿç®¡ç†ç€æ–‡ä»¶ä¸­çš„å„ç§æ³¨é‡Šå’Œç›´æ¥ä½äºåŒ…å£°æ˜æˆ–å¯¼å…¥è¯­å¥ä¹‹å‰çš„é¡¶çº§æ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="è®¿é—®ä¸æ“ä½œ-ast"&gt;è®¿é—®ä¸æ“ä½œ AST
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;CompilationUnit&lt;/code&gt;ä½œä¸º AST çš„å…¥å£ï¼Œæä¾›äº†å¤šç§æ–¹å¼æ¥éå†å’Œä¿®æ”¹å…¶åŒ…å«çš„èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ Visitor æ¨¡å¼ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€å¼ºå¤§å’Œå®‰å…¨çš„æ–¹å¼ã€‚ä½ å¯ä»¥é€šè¿‡ç»§æ‰¿ &lt;code&gt;VoidVisitorAdapter&lt;/code&gt;æˆ– &lt;code&gt;ModifierVisitor&lt;/code&gt;æ¥åˆ›å»ºè‡ªå®šä¹‰è®¿é—®å™¨ï¼Œç²¾å‡†åœ°è®¿é—®æˆ–ä¿®æ”¹ç‰¹å®šç±»å‹çš„èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰çš„æ–¹æ³•å£°æ˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€’å½’éå†èŠ‚ç‚¹&lt;/strong&gt;ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code&gt;findAll(Class&amp;lt;T&amp;gt; nodeType)&lt;/code&gt;ç­‰æ–¹æ³•æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½†è¿™ç§æ–¹å¼åœ¨å¤æ‚æ“ä½œæ—¶ä¸å¦‚ Visitor æ¨¡å¼çµæ´»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ç¤ºä¾‹ç”Ÿæˆä¸è§£æä»£ç "&gt;ç¤ºä¾‹ï¼šç”Ÿæˆä¸è§£æä»£ç 
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæˆæ–°çš„ Java æ–‡ä»¶&lt;/strong&gt;ï¼šä½ å¯ä»¥ç›´æ¥åˆ›å»º &lt;code&gt;CompilationUnit&lt;/code&gt;å¯¹è±¡ï¼Œå¹¶é€æ­¥æ·»åŠ åŒ…å£°æ˜ã€å¯¼å…¥è¯­å¥å’Œç±»å®šä¹‰ï¼Œæœ€åé€šè¿‡ &lt;code&gt;toString()&lt;/code&gt;æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºæ ¼å¼åŒ–çš„ Java æºä»£ç å­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£æç°æœ‰ä»£ç &lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;StaticJavaParser.parse(String code)&lt;/code&gt;æˆ–é‡è½½æ–¹æ³•ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²ã€æ–‡ä»¶ç­‰è§£æä¸º &lt;code&gt;CompilationUnit&lt;/code&gt;å¯¹è±¡ï¼Œä»è€Œè¿›è¡Œåç»­åˆ†ææˆ–ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„è¯´æ˜èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ JavaParser çš„ &lt;code&gt;CompilationUnit&lt;/code&gt;ã€‚å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“æ“ä½œåœºæ™¯æœ‰è¿›ä¸€æ­¥çš„é—®é¢˜ï¼Œæˆ‘å¯ä»¥æä¾›æ›´æ·±å…¥çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;h2 id="methoddeclaration--resolvedmethoddeclaration"&gt;MethodDeclaration &amp;amp; ResolvedMethodDeclaration
&lt;/h2&gt;&lt;p&gt;åœ¨ JavaParser ä¸­ï¼Œ&lt;code&gt;MethodDeclaration&lt;/code&gt;ã€&lt;code&gt;ResolvedMethodDeclaration&lt;/code&gt;å’Œ &lt;code&gt;JavassistMethodDeclaration&lt;/code&gt;è¿™ä¸‰ä¸ªç±»ä»£è¡¨äº†æ–¹æ³•åœ¨ä¸åŒæŠ½è±¡å±‚çº§å’Œä¸Šä¸‹æ–‡ä¸­çš„å½¢æ€ã€‚ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒåŒºåˆ«ï¼Œä¸‹è¡¨å¯¹å®ƒä»¬è¿›è¡Œäº†æ¸…æ™°çš„å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;MethodDeclaration&lt;/th&gt;
&lt;th&gt;ResolvedMethodDeclaration&lt;/th&gt;
&lt;th&gt;JavassistMethodDeclaration&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰€å±åº“/æ¨¡å—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JavaParser Core&lt;/td&gt;
&lt;td&gt;JavaParser Symbol Solver&lt;/td&gt;
&lt;td&gt;JavaParser Javassist Adapter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºæºç ä¸­&lt;strong&gt;æ–¹æ³•å£°æ˜çš„è¯­æ³•ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºç»è¿‡&lt;strong&gt;è¯­ä¹‰è§£æå&lt;/strong&gt;çš„æ–¹æ³•ä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´çš„ç±»å‹ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;ä½œä¸º &lt;strong&gt;Javassist&lt;/strong&gt; çš„ &lt;code&gt;CtMethod&lt;/code&gt;åœ¨ JavaParser ä¸­çš„&lt;strong&gt;é€‚é…å™¨æˆ–åŒ…è£…å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŠ½è±¡å±‚çº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯­æ³•çº§&lt;/strong&gt;ï¼ˆAST èŠ‚ç‚¹ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯­ä¹‰çº§&lt;/strong&gt;ï¼ˆç¬¦å·è§£æç»“æœï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¡¥æ¥å±‚&lt;/strong&gt;ï¼ˆé€‚é…ä¸åŒæ¨¡å‹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥æ¥è‡ªè§£æçš„&lt;strong&gt;æºä»£ç &lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ç¬¦å·è§£æå™¨ï¼ˆSymbol Solverï¼‰&lt;strong&gt;è®¡ç®—å¾—å‡º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å°è£…è‡ª &lt;strong&gt;Javassist&lt;/strong&gt; çš„ &lt;code&gt;CtMethod&lt;/code&gt;å¯¹è±¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ä¿¡æ¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•åã€å‚æ•°åˆ—è¡¨ï¼ˆè¯­æ³•ï¼‰ã€è¿”å›ç±»å‹ï¼ˆè¯­æ³•ï¼‰ã€ä¿®é¥°ç¬¦ã€æ–¹æ³•ä½“ï¼ˆè¯­å¥ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®Œå…¨è§£æçš„å‚æ•°ç±»å‹&lt;/strong&gt;ã€&lt;strong&gt;å®Œå…¨è§£æçš„è¿”å›ç±»å‹&lt;/strong&gt;ã€å£°æ˜è¯¥æ–¹æ³•çš„&lt;strong&gt;å®Œæ•´ç±»å&lt;/strong&gt;ã€æ³›å‹ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;ä¾èµ–äºåº•å±‚ &lt;code&gt;CtMethod&lt;/code&gt;æ‰€æä¾›çš„ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç»“æ„åˆ†æ&lt;/strong&gt;ã€&lt;strong&gt;ä»£ç ç”Ÿæˆä¸é‡æ„&lt;/strong&gt;ï¼ˆè¯­æ³•å±‚é¢ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜çº§ä»£ç åˆ†æ&lt;/strong&gt;ï¼ˆå¦‚è°ƒç”¨å›¾åˆ†æã€ç±»å‹æ¨å¯¼ï¼‰ã€&lt;strong&gt;åå°„å¼ä¿¡æ¯è·å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨åŒæ—¶ä½¿ç”¨ JavaParser å’Œ Javassist çš„é¡¹ç›®ä¸­ï¼Œ&lt;strong&gt;å®ç°ä¸¤ç§æ¨¡å‹ä¹‹é—´çš„äº¤äº’å’Œè½¬æ¢&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»"&gt;ğŸ’¡ æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»
&lt;/h3&gt;&lt;p&gt;ç†è§£è¿™ä¸‰è€…çš„å…³é”®åœ¨äºæŠŠæ¡å®ƒä»¬æ‰€å¤„çš„ä¸åŒå±‚æ¬¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MethodDeclaration&lt;/code&gt;å…³æ³¨â€œå½¢â€&lt;/strong&gt;ï¼šå®ƒåªå…³å¿ƒä»£ç &lt;strong&gt;çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­&lt;/strong&gt;ï¼Œå³è¯­æ³•ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå®ƒçŸ¥é“æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä½†å…¶ç±»å‹ &lt;code&gt;List&lt;/code&gt;å¯èƒ½åªæ˜¯ä¸€ä¸ªæœªç»è§£æçš„ç¬¦å·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ResolvedMethodDeclaration&lt;/code&gt;å…³æ³¨â€œæ„â€&lt;/strong&gt;ï¼šå®ƒé€šè¿‡ç¬¦å·è§£æï¼Œå¼„æ‡‚äº†ä»£ç &lt;strong&gt;å®é™…å«ä¹‰&lt;/strong&gt;ã€‚å®ƒçŸ¥é“ &lt;code&gt;List&lt;/code&gt;å…·ä½“æŒ‡å‘ &lt;code&gt;java.util.List&lt;/code&gt;ï¼Œå¹¶ä¸”èƒ½è§£æå‡ºæ³›å‹å‚æ•° &lt;code&gt;String&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;JavassistMethodDeclaration&lt;/code&gt;å…³æ³¨â€œæ¡¥æ¥â€&lt;/strong&gt;ï¼šå®ƒæœ¬èº«ä¸å±äº JavaParser çš„æ ¸å¿ƒè¯­ä¹‰æ¨¡å‹ï¼Œè€Œæ˜¯ä¸€ä¸ª&lt;strong&gt;è¾…åŠ©å·¥å…·&lt;/strong&gt;ï¼Œç”¨äºå°† Javassist åº“ä¸­çš„æ–¹æ³•è¡¨ç¤ºæ–¹å¼ï¼ˆ&lt;code&gt;CtMethod&lt;/code&gt;ï¼‰&lt;strong&gt;è½¬æ¢æˆ–é€‚é…&lt;/strong&gt;æˆ JavaParser èƒ½å¤Ÿç†è§£çš„ &lt;code&gt;MethodDeclaration&lt;/code&gt;æ ¼å¼ï¼Œä»è€Œåœ¨æ··åˆä½¿ç”¨ä¸¤ä¸ªåº“æ—¶æä¾›ä¾¿åˆ©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šå¸¸ï¼Œåœ¨ JavaParser çš„å·¥ä½œæµä¸­ï¼Œä½ ä¼šé€šè¿‡è°ƒç”¨ &lt;code&gt;MethodDeclaration&lt;/code&gt;çš„ &lt;code&gt;resolve()&lt;/code&gt;æ–¹æ³•æ¥è·å–å…¶å¯¹åº”çš„ &lt;code&gt;ResolvedMethodDeclaration&lt;/code&gt;ï¼Œä»è€Œè¿›è¡Œæ·±å…¥çš„è¯­ä¹‰åˆ†æã€‚è€Œ &lt;code&gt;JavassistMethodDeclaration&lt;/code&gt;åˆ™åœ¨ç‰¹å®šçš„ã€éœ€è¦ä¸ Javassist å­—èŠ‚ç æ“ä½œåº“ååŒå·¥ä½œçš„åœºæ™¯ä¸‹æ‰ä¼šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ¸…æ™°ç†è§£è¿™ä¸‰ä¸ªæ¦‚å¿µã€‚å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šåœºæ™¯ä¸‹çš„ç”¨æ³•æœ‰è¿›ä¸€æ­¥ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶æå‡ºã€‚&lt;/p&gt;
&lt;h2 id="å…±äº«-typeresolver"&gt;å…±äº« TypeResolver
&lt;/h2&gt;&lt;p&gt;åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è®©æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„ &lt;code&gt;JavaParser&lt;/code&gt;å®ä¾‹å…±äº«æ•´ä¸ªé¡¹ç›®çš„æºç ä¿¡æ¯ï¼Œå…³é”®åœ¨äºæ­£ç¡®é…ç½®å’Œä½¿ç”¨ &lt;strong&gt;&lt;code&gt;TypeSolver&lt;/code&gt;&lt;/strong&gt; ä½“ç³»ã€‚è¿™èƒ½ç¡®ä¿æ‰€æœ‰è§£æå™¨å¯¹é¡¹ç›®ä¸­çš„ç±»ã€æ–¹æ³•ç­‰ç¬¦å·æœ‰ç»Ÿä¸€çš„ç†è§£ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶å…±äº«çš„-typesolver"&gt;ğŸ”§ æ ¸å¿ƒæœºåˆ¶ï¼šå…±äº«çš„ TypeSolver
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;TypeSolver&lt;/code&gt;æ˜¯ JavaParser ç¬¦å·è§£æï¼ˆSymbol Resolutionï¼‰ç»„ä»¶çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£æ ¹æ®ä¸€ä¸ªç±»æˆ–æ–¹æ³•çš„åç§°æ‰¾åˆ°å…¶å®Œæ•´çš„å®šä¹‰ï¼ˆå³ &lt;code&gt;ResolvedType&lt;/code&gt;æˆ– &lt;code&gt;ResolvedMethodDeclaration&lt;/code&gt;ï¼‰ã€‚è¦è®©å¤šä¸ª &lt;code&gt;JavaParser&lt;/code&gt;å®ä¾‹å…±äº«é¡¹ç›®ä¸Šä¸‹æ–‡ï¼Œå°±éœ€è¦ä¸ºå®ƒä»¬é…ç½®ä¸€ä¸ª&lt;strong&gt;å…±äº«çš„ã€åŒ…å«é¡¹ç›®æ‰€æœ‰å¿…è¦æºç è·¯å¾„çš„ &lt;code&gt;TypeSolver&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¸¸ç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ &lt;code&gt;CombinedTypeSolver&lt;/code&gt;ç»„åˆå¤šä¸ªä¸“é—¨ç”¨é€”çš„æ±‚è§£å™¨ï¼Œå¹¶ä¸ºæ‰€æœ‰çº¿ç¨‹çš„ &lt;code&gt;JavaParser&lt;/code&gt;å®ä¾‹é…ç½®æŒ‡å‘è¿™ä¸ªå…±äº«æ±‚è§£å™¨çš„ &lt;code&gt;SymbolResolver&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„æµç¨‹å›¾ç›´è§‚å±•ç¤ºäº†è¿™ä¸€æ¶æ„çš„æ ¸å¿ƒç»„æˆå’Œæ•°æ®æµåŠ¨æ–¹å‘ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[é¡¹ç›®æºç ç›®å½•] --&amp;gt; B[â€œJavaParserTypeSolver&amp;lt;br&amp;gt;(è§£æé¡¹ç›®è‡ªèº«ä»£ç )â€]
C[JDK æ ¸å¿ƒåº“] --&amp;gt; D[â€œReflectionTypeSolver&amp;lt;br&amp;gt;(è§£æJDKç±»)â€]
E[ç¬¬ä¸‰æ–¹ä¾èµ– Jar åŒ…] --&amp;gt; F[â€œJarTypeSolver&amp;lt;br&amp;gt;(è§£æä¾èµ–åº“)â€]
B --&amp;gt; G[CombinedTypeSolver]
D --&amp;gt; G
F --&amp;gt; G
G --&amp;gt; H[â€œå…±äº«çš„&amp;lt;br&amp;gt;JavaSymbolSolverâ€]
H --&amp;gt; I[çº¿ç¨‹1çš„ JavaParser å®ä¾‹]
H --&amp;gt; J[çº¿ç¨‹2çš„ JavaParser å®ä¾‹]
H --&amp;gt; K[çº¿ç¨‹Nçš„ JavaParser å®ä¾‹]
I --&amp;gt; I1[è§£æä»»åŠ¡1]
J --&amp;gt; J1[è§£æä»»åŠ¡2]
K --&amp;gt; K1[è§£æä»»åŠ¡N]
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é…ç½®å…±äº«çš„-typesolver"&gt;ğŸ§© é…ç½®å…±äº«çš„ TypeSolver
&lt;/h3&gt;&lt;p&gt;ä½ éœ€è¦æ ¹æ®é¡¹ç›®çš„ä¾èµ–ç»“æ„ï¼Œç»„åˆä¸åŒçš„ &lt;code&gt;TypeSolver&lt;/code&gt;ã€‚ä¸€ä¸ªå…¸å‹çš„é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.github.javaparser.symbolsolver.JavaSymbolSolver;
import com.github.javaparser.symbolsolver.resolution.typesolvers.*;
// 1. åˆ›å»ºç»„åˆæ±‚è§£å™¨
CombinedTypeSolver combinedTypeSolver = new CombinedTypeSolver();
// 2. æ·»åŠ JDKæ ¸å¿ƒåº“æ±‚è§£å™¨ï¼ˆå¿…é¡»ï¼‰
combinedTypeSolver.add(new ReflectionTypeSolver());
// 3. æ·»åŠ é¡¹ç›®æºç æ ¹ç›®å½•æ±‚è§£å™¨ï¼ˆæ ¸å¿ƒï¼‰
// å‡è®¾ä½ çš„é¡¹ç›®æºç è·¯å¾„æ˜¯ &amp;#34;src/main/java&amp;#34;
combinedTypeSolver.add(new JavaParserTypeSolver(new File(&amp;#34;src/main/java&amp;#34;)));
// 4. ï¼ˆå¯é€‰ï¼‰æ·»åŠ ç¬¬ä¸‰æ–¹ä¾èµ–åº“çš„æ±‚è§£å™¨
// ä¾‹å¦‚ï¼ŒæŒ‡å‘ä¸€ä¸ªåŒ…å«ä¾èµ–åº“çš„ç›®å½•
File jarDir = new File(&amp;#34;lib&amp;#34;);
for (File jarFile : jarDir.listFiles((dir, name) -&amp;gt; name.endsWith(&amp;#34;.jar&amp;#34;))) {
combinedTypeSolver.add(new JarTypeSolver(jarFile));
}
// 5. åˆ›å»ºå…±äº«çš„ç¬¦å·è§£æå™¨
JavaSymbolSolver sharedSymbolSolver = new JavaSymbolSolver(combinedTypeSolver);
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä¸ºå¤šçº¿ç¨‹é…ç½®-javaparser"&gt;ğŸ§µ ä¸ºå¤šçº¿ç¨‹é…ç½® JavaParser
&lt;/h3&gt;&lt;p&gt;åˆ›å»ºå¥½å…±äº«çš„ &lt;code&gt;JavaSymbolSolver&lt;/code&gt;åï¼Œä½ éœ€è¦åœ¨æ¯ä¸ªçº¿ç¨‹åˆ›å»ºè‡ªå·±çš„ &lt;code&gt;JavaParser&lt;/code&gt;å®ä¾‹æ—¶ï¼Œä¸ºå…¶è®¾ç½®ç»Ÿä¸€çš„é…ç½®ï¼ŒæŒ‡å®šä½¿ç”¨è¿™ä¸ªå…±äº«çš„è§£æå™¨ ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// ä½¿ç”¨å…±äº«çš„ç¬¦å·è§£æå™¨åˆ›å»ºå…¨å±€é…ç½®ï¼ˆå¯é€‰ï¼Œæ–¹ä¾¿ä½¿ç”¨ StaticJavaParserï¼‰
ParserConfiguration globalConfig = new ParserConfiguration();
globalConfig.setSymbolResolver(sharedSymbolSolver);
StaticJavaParser.getConfiguration().setSymbolResolver(sharedSymbolSolver);
// æˆ–è€…ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹å†…ç‹¬ç«‹çš„ JavaParser å®ä¾‹è¿›è¡Œé…ç½®
public class MyParsingTask implements Runnable {
private final JavaSymbolSolver symbolSolver; // é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥å…±äº«çš„è§£æå™¨
public MyParsingTask(JavaSymbolSolver symbolSolver) {
this.symbolSolver = symbolSolver;
}
@Override
public void run() {
// æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨è‡ªå·±çš„ JavaParser å®ä¾‹ï¼Œä½†é…ç½®å…±äº«çš„ç¬¦å·è§£æå™¨
ParserConfiguration threadLocalConfig = new ParserConfiguration();
threadLocalConfig.setSymbolResolver(symbolSolver);
JavaParser parser = new JavaParser(threadLocalConfig); // çº¿ç¨‹å®‰å…¨çš„å®ä¾‹
// ... ä½¿ç”¨è¿™ä¸ª parser è¿›è¡Œè§£æå·¥ä½œ
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹"&gt;ğŸ’¡ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¸ç¼“å­˜&lt;/strong&gt;ï¼šé¦–æ¬¡è§£ææ–°ç¬¦å·æ—¶ï¼Œ&lt;code&gt;JavaParserTypeSolver&lt;/code&gt;ä¼šè§£ææºç æ–‡ä»¶ã€‚åç»­è¯·æ±‚ç›¸åŒçš„ç¬¦å·ä¼šä½¿ç”¨ç¼“å­˜ï¼Œå› æ­¤å…±äº«çš„ &lt;code&gt;TypeSolver&lt;/code&gt;èƒ½å—ç›Šäºç¼“å­˜å¸¦æ¥çš„æ€§èƒ½æå‡ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜è€ƒé‡&lt;/strong&gt;ï¼šå¦‚æœé¡¹ç›®éå¸¸å¤§ï¼ŒåŒ…å«æˆåƒä¸Šä¸‡ä¸ªæºæ–‡ä»¶ï¼Œå¤šä¸ª &lt;code&gt;JavaParser&lt;/code&gt;å®ä¾‹å’Œå…±äº«çš„ &lt;code&gt;TypeSolver&lt;/code&gt;å¯èƒ½ä¼šå ç”¨å¯è§‚çš„å†…å­˜ã€‚éœ€è¦ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ä¸€è‡´æ€§&lt;/strong&gt;ï¼šåŠ¡å¿…ç¡®ä¿æ‰€æœ‰çº¿ç¨‹çš„ &lt;code&gt;JavaParser&lt;/code&gt;å®ä¾‹éƒ½é…ç½®äº†&lt;strong&gt;å®Œå…¨ç›¸åŒ&lt;/strong&gt;çš„ &lt;code&gt;TypeSolver&lt;/code&gt;ç»„åˆï¼Œå¦åˆ™ä¸åŒçº¿ç¨‹å¯èƒ½ä¼šå¯¹åŒä¸€ç¬¦å·å¾—å‡ºä¸åŒçš„è§£æç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–åº“å¤„ç†&lt;/strong&gt;ï¼šå¯¹äºå¤æ‚çš„ Maven æˆ– Gradle é¡¹ç›®ï¼Œæ‰‹åŠ¨ç®¡ç†æ‰€æœ‰ä¾èµ–çš„ Jar åŒ…è·¯å¾„å¯èƒ½å¾ˆç¹çã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ &lt;code&gt;MavenResolutionStrategy&lt;/code&gt;ç­‰æ›´é«˜çº§çš„ç­–ç•¥æ¥è‡ªåŒ–å¤„ç†ä¾èµ– ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è¯¦ç»†çš„è§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨å¤šçº¿ç¨‹é¡¹ç›®ä¸­é«˜æ•ˆåœ°ä½¿ç”¨ JavaParserã€‚å¦‚æœä½ åœ¨å…·ä½“å®è·µä¸­é‡åˆ°æ›´ç»†è‡´çš„é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶æå‡ºï¼&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Graph</title><link>https://dyhes.github.io/p/shopeegraph/</link><pubDate>Sat, 27 Sep 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeegraph/</guid><description>&lt;h2 id="louvain"&gt;Louvain
&lt;/h2&gt;&lt;p&gt;Louvainç®—æ³•æ˜¯ä¸€ç§é«˜æ•ˆçš„ç¤¾åŒºå‘ç°ç®—æ³•ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡ç½‘ç»œåˆ†æã€‚ä¸‹é¢è¿™å¼ æµç¨‹å›¾æ¦‚æ‹¬äº†å®ƒçš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼Œå¸®åŠ©ä½ å¿«é€ŸæŠŠæ¡å…¶æ•´ä½“æ¡†æ¶ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[åˆå§‹åŒ–æ¯ä¸ªèŠ‚ç‚¹ä¸ºç‹¬ç«‹ç¤¾åŒº] --&amp;gt; B[æ¨¡å—åº¦ä¼˜åŒ–é˜¶æ®µ&amp;lt;br&amp;gt;èŠ‚ç‚¹ç§»åŠ¨è‡³æ¨¡å—åº¦å¢ç›Šæœ€å¤§çš„ç¤¾åŒº]
B --&amp;gt; C{æ‰€æœ‰èŠ‚ç‚¹ç¤¾åŒº&amp;lt;br&amp;gt;æ˜¯å¦ç¨³å®šï¼Ÿ}
C --&amp;gt;|å¦| B
C --&amp;gt;|æ˜¯| D[ç½‘ç»œå‡èšé˜¶æ®µ&amp;lt;br&amp;gt;åˆå¹¶ç¤¾åŒºä¸ºè¶…çº§èŠ‚ç‚¹]
D --&amp;gt; E{æ¨¡å—åº¦æ˜¯å¦&amp;lt;br&amp;gt;æ˜¾è‘—æå‡ï¼Ÿ}
E --&amp;gt;|æ˜¯| A
E --&amp;gt;|å¦| F[è¾“å‡ºæœ€ç»ˆç¤¾åŒºç»“æ„]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Louvainç®—æ³•çš„å„ä¸ªæ–¹é¢ã€‚&lt;/p&gt;
&lt;h3 id="-ç†è§£æ¨¡å—åº¦"&gt;ğŸ” ç†è§£æ¨¡å—åº¦
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ¨¡å—åº¦&lt;/strong&gt;æ˜¯è¡¡é‡ç¤¾åŒºåˆ’åˆ†å¥½åçš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œå…¶å€¼åŸŸé€šå¸¸ä¸º**[-0.5, 1)&lt;strong&gt;ã€‚å®ƒè¡¡é‡äº†ç¤¾åŒºå†…éƒ¨è¿æ¥çš„ç´§å¯†ç¨‹åº¦ç›¸å¯¹äºéšæœºè¿æ¥æœŸæœ›çš„åç¦»ã€‚ä¸€ä¸ª&lt;/strong&gt;é«˜æ¨¡å—åº¦**å€¼æ„å‘³ç€ç¤¾åŒºå†…éƒ¨è¿æ¥ç´§å¯†ï¼Œç¤¾åŒºä¹‹é—´è¿æ¥ç¨€ç–ï¼Œè¿™æ­£æ˜¯ç†æƒ³çš„ç¤¾åŒºç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;æ¨¡å—åº¦çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Q=2m1i,jâˆ‘[Aijâˆ’2mkikj]Î´(ci,cj)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Aijè¡¨ç¤ºèŠ‚ç‚¹iå’ŒèŠ‚ç‚¹jä¹‹é—´çš„è¾¹æƒé‡ã€‚&lt;/li&gt;
&lt;li&gt;kiå’Œ kjåˆ†åˆ«è¡¨ç¤ºèŠ‚ç‚¹iå’ŒèŠ‚ç‚¹jçš„åº¦ï¼ˆå³ä¸ä¹‹ç›¸è¿çš„æ‰€æœ‰è¾¹çš„æƒé‡ä¹‹å’Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;mæ˜¯ç½‘ç»œä¸­æ‰€æœ‰è¾¹çš„æƒé‡ä¹‹å’Œã€‚&lt;/li&gt;
&lt;li&gt;Î´(ci,cj)æ˜¯æŒ‡ç¤ºå‡½æ•°ï¼Œå½“èŠ‚ç‚¹iå’ŒèŠ‚ç‚¹jå±äºåŒä¸€ç¤¾åŒºæ—¶å€¼ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¬å¼ä¸­çš„ 2mkikjéƒ¨åˆ†è¡¨ç¤ºäº†åœ¨éšæœºè¿æ¥çš„æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹iå’ŒèŠ‚ç‚¹jä¹‹é—´å­˜åœ¨è¾¹çš„æœŸæœ›æƒé‡ã€‚å› æ­¤ï¼Œæ¨¡å—åº¦å®é™…è¡¡é‡çš„æ˜¯ç¤¾åŒºå†…éƒ¨å®é™…è¿æ¥å¼ºåº¦ä¸éšæœºè¿æ¥æœŸæœ›å¼ºåº¦ä¹‹é—´çš„å·®å€¼ã€‚é€šå¸¸ï¼Œæ¨¡å—åº¦åœ¨&lt;strong&gt;0.3åˆ°0.7&lt;/strong&gt;ä¹‹é—´è¡¨æ˜ç¤¾åŒºåˆ’åˆ†æ•ˆæœè¾ƒå¥½ã€‚&lt;/p&gt;
&lt;h3 id="-louvainç®—æ³•çš„å·¥ä½œåŸç†"&gt;âš™ï¸ Louvainç®—æ³•çš„å·¥ä½œåŸç†
&lt;/h3&gt;&lt;p&gt;Louvainç®—æ³•é€šè¿‡è¿­ä»£ä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µæ¥æœ€å¤§åŒ–æ¨¡å—åº¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å—åº¦ä¼˜åŒ–é˜¶æ®µ&lt;/strong&gt;ï¼šç®—æ³•éå†ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œè®¡ç®—å°†å…¶ç§»åŠ¨åˆ°æ¯ä¸ªé‚»å±…èŠ‚ç‚¹æ‰€åœ¨ç¤¾åŒºæ—¶å¸¦æ¥çš„&lt;strong&gt;æ¨¡å—åº¦å¢ç›Š&lt;/strong&gt; Î”Qã€‚èŠ‚ç‚¹å°†è¢«ç§»åŠ¨åˆ°èƒ½å¸¦æ¥&lt;strong&gt;æœ€å¤§æ­£æ¨¡å—åº¦å¢ç›Š&lt;/strong&gt;çš„ç¤¾åŒºä¸­ã€‚è¿™ä¸€è¿‡ç¨‹åå¤è¿›è¡Œï¼Œç›´åˆ°ä»»ä½•èŠ‚ç‚¹çš„ç§»åŠ¨éƒ½ä¸èƒ½å†æé«˜æ¨¡å—åº¦ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;æ¨¡å—åº¦å¢ç›Š Î”Qçš„è®¡ç®—å…¬å¼ï¼ˆå½“å°†èŠ‚ç‚¹iç§»åŠ¨åˆ°ç¤¾åŒºCæ—¶ï¼‰ä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Î”Q=[2mÎ£in+ki,inâˆ’(2mÎ£tot+ki)2]âˆ’[2mÎ£inâˆ’(2mÎ£tot)2âˆ’(2mki)2]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ Î£inæ˜¯ç¤¾åŒºCå†…éƒ¨æ‰€æœ‰è¾¹çš„æƒé‡å’Œï¼ŒÎ£totæ˜¯ä¸ç¤¾åŒºCå†…èŠ‚ç‚¹ç›¸è¿çš„æ‰€æœ‰è¾¹çš„æƒé‡å’Œï¼Œki,inæ˜¯ä»èŠ‚ç‚¹iè¿æ¥åˆ°ç¤¾åŒºCå†…èŠ‚ç‚¹çš„è¾¹çš„æƒé‡å’Œï¼Œkiæ˜¯ä¸èŠ‚ç‚¹iç›¸è¿çš„æ‰€æœ‰è¾¹çš„æƒé‡å’Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œå‡èšé˜¶æ®µ&lt;/strong&gt;ï¼šåœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µå®Œæˆåï¼Œå°†æ¯ä¸ªç¤¾åŒº&lt;strong&gt;åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„è¶…çº§èŠ‚ç‚¹&lt;/strong&gt;ã€‚è¶…çº§èŠ‚ç‚¹ä¹‹é—´çš„è¾¹æƒé‡ä¸ºåŸå§‹ç¤¾åŒºä¹‹é—´æ‰€æœ‰è¾¹çš„æƒé‡ä¹‹å’Œï¼Œè€Œç¤¾åŒºå†…éƒ¨çš„è¾¹æƒé‡åˆ™ä¼šè½¬åŒ–ä¸ºæ–°èŠ‚ç‚¹çš„è‡ªç¯æƒé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šè¿°ä¸¤ä¸ªé˜¶æ®µæ„æˆä¸€æ¬¡è¿­ä»£ã€‚è¿­ä»£è¿‡ç¨‹ä¼šä¸€ç›´è¿›è¡Œï¼Œç›´åˆ°æ•´ä¸ªç½‘ç»œçš„æ¨¡å—åº¦ä¸å†å‘ç”Ÿæ˜¾è‘—å˜åŒ–ä¸ºæ­¢ã€‚è¿™ç§å±‚æ¬¡åŒ–çš„å¤„ç†ä½¿å¾—ç®—æ³•èƒ½å¤Ÿæ­ç¤ºå‡ºç½‘ç»œåœ¨ä¸åŒç²’åº¦ä¸‹çš„ç¤¾åŒºç»“æ„ã€‚&lt;/p&gt;
&lt;h3 id="-ä»£ç å®ç°ä¸åº”ç”¨"&gt;ğŸ’» ä»£ç å®ç°ä¸åº”ç”¨
&lt;/h3&gt;&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç°æœ‰çš„åº“æ¥æ–¹ä¾¿åœ°è°ƒç”¨Louvainç®—æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;python-louvain&lt;/code&gt;åº“ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import community as community_louvain
import networkx as nx
# åŠ è½½ä¸€ä¸ªç¤ºä¾‹å›¾ï¼ˆZacharyç©ºæ‰‹é“ä¿±ä¹éƒ¨ç½‘ç»œï¼‰
G = nx.karate_club_graph()
# ä½¿ç”¨Louvainç®—æ³•æ‰¾åˆ°æœ€ä½³ç¤¾åŒºåˆ’åˆ†
partition = community_louvain.best_partition(G)
# è®¡ç®—åˆ’åˆ†åçš„æ¨¡å—åº¦
modularity = community_louvain.modularity(partition, G)
print(&amp;#34;Modularity:&amp;#34;, modularity)
# æ‰“å°ç¤¾åŒºåˆ’åˆ†ç»“æœ
print(&amp;#34;Community membership:&amp;#34;, partition)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Louvainç®—æ³•åœ¨è®¸å¤šé¢†åŸŸéƒ½æœ‰å¹¿æ³›åº”ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¤¾äº¤ç½‘ç»œåˆ†æ&lt;/strong&gt;ï¼šè¯†åˆ«å…·æœ‰å…±åŒå…´è¶£æˆ–ç´§å¯†è”ç³»çš„ç”¨æˆ·ç¾¤ä½“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿç‰©ä¿¡æ¯å­¦&lt;/strong&gt;ï¼šåˆ†æè›‹ç™½è´¨ç›¸äº’ä½œç”¨ç½‘ç»œï¼Œå‘ç°åŠŸèƒ½ç›¸ä¼¼çš„è›‹ç™½è´¨å¤åˆç‰©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å•ç»†èƒè½¬å½•ç»„å­¦&lt;/strong&gt;ï¼šæ ¹æ®åŸºå› è¡¨è¾¾æ¨¡å¼å¯¹ç»†èƒè¿›è¡Œèšç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èç³»ç»Ÿ&lt;/strong&gt;ï¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºç›¸ä¼¼æ€§è¿›è¡Œç”¨æˆ·åˆ†ç¾¤ï¼Œå®ç°æ›´ç²¾å‡†çš„æ¨èã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ç®—æ³•æ€§èƒ½ä¸ç‰¹ç‚¹"&gt;ğŸ“Š ç®—æ³•æ€§èƒ½ä¸ç‰¹ç‚¹
&lt;/h3&gt;&lt;p&gt;Louvainç®—æ³•æœ‰ä»¥ä¸‹æ˜¾è‘—ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆæ€§&lt;/strong&gt;ï¼šç®—æ³•çš„æ—¶é—´å¤æ‚åº¦çº¦ä¸º O(nlogn)ï¼Œå…¶ä¸­ næ˜¯èŠ‚ç‚¹æ•°é‡ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿå¤„ç†åŒ…å«æ•°ç™¾ä¸‡èŠ‚ç‚¹çš„å¤§è§„æ¨¡ç½‘ç»œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— éœ€é¢„è®¾ç¤¾åŒºæ•°&lt;/strong&gt;ï¼šç®—æ³•è‡ªåŠ¨ç¡®å®šæœ€ç»ˆçš„ç¤¾åŒºæ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±‚æ¬¡åŒ–ç»“æ„&lt;/strong&gt;ï¼šé€šè¿‡å¤šæ¬¡è¿­ä»£ï¼Œèƒ½å¤Ÿæ­ç¤ºç½‘ç»œåœ¨ä¸åŒå°ºåº¦ä¸Šçš„ç¤¾åŒºç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¯èƒ½äº§ç”Ÿè§„æ¨¡è¾ƒå¤§çš„ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;æ¨¡å—åº¦å‡½æ•°å­˜åœ¨åˆ†è¾¨ç‡é™åˆ¶ï¼Œå¯èƒ½æ— æ³•è¯†åˆ«å‡ºè¾ƒå°çš„ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºé‡‡ç”¨è´ªå¿ƒç­–ç•¥ï¼Œç»“æœå¯èƒ½å—èŠ‚ç‚¹éå†é¡ºåºå½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä¸å…¶ä»–ç®—æ³•æ¯”è¾ƒ"&gt;âš–ï¸ ä¸å…¶ä»–ç®—æ³•æ¯”è¾ƒ
&lt;/h3&gt;&lt;p&gt;ä¸å…¶ä»–ç¤¾åŒºå‘ç°ç®—æ³•ç›¸æ¯”ï¼ŒLouvainç®—æ³•æœ‰å…¶ç‹¬ç‰¹ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸Girvan-Newmanç®—æ³•æ¯”è¾ƒ&lt;/strong&gt;ï¼šGirvan-Newmanç®—æ³•åŸºäºè¾¹ä»‹æ•°ï¼Œèƒ½æ‰¾åˆ°æ›´ç²¾ç¡®çš„ç¤¾åŒºç»“æ„ï¼Œä½†æ—¶é—´å¤æ‚åº¦é«˜ï¼ˆO(n3)ï¼‰ï¼Œéš¾ä»¥åº”ç”¨äºå¤§è§„æ¨¡ç½‘ç»œã€‚Louvainç®—æ³•åœ¨æ•ˆç‡å’Œå¯æ‰©å±•æ€§ä¸Šä¼˜åŠ¿æ˜æ˜¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æ ‡ç­¾ä¼ æ’­ç®—æ³•æ¯”è¾ƒ&lt;/strong&gt;ï¼šæ ‡ç­¾ä¼ æ’­ç®—æ³•æ›´ç®€å•é«˜æ•ˆï¼Œä½†å¯¹å™ªå£°æ•æ„Ÿï¼Œç»“æœç¨³å®šæ€§è¾ƒå·®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Infomapç®—æ³•æ¯”è¾ƒ&lt;/strong&gt;ï¼šInfomapç®—æ³•åŸºäºä¿¡æ¯è®ºï¼Œé€‚ç”¨äºæœ‰å‘å›¾ï¼Œä½†æ¦‚å¿µå’Œå®ç°ç›¸å¯¹å¤æ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“ä¸å±•æœ›"&gt;ğŸ’ æ€»ç»“ä¸å±•æœ›
&lt;/h3&gt;&lt;p&gt;Louvainç®—æ³•å› å…¶&lt;strong&gt;é«˜æ•ˆç‡&lt;/strong&gt;å’Œ&lt;strong&gt;è‰¯å¥½çš„ç¤¾åŒºåˆ’åˆ†æ•ˆæœ&lt;/strong&gt;ï¼Œå·²æˆä¸ºç¤¾åŒºå‘ç°é¢†åŸŸæœ€æµè¡Œå’Œå®ç”¨çš„ç®—æ³•ä¹‹ä¸€ã€‚è™½ç„¶å®ƒä¹Ÿå­˜åœ¨ä¸€äº›å±€é™æ€§ï¼ˆå¦‚å¯èƒ½æ— æ³•è¯†åˆ«å°ç¤¾åŒºï¼‰ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å·²è¢«æ›´å…ˆè¿›çš„ç®—æ³•ï¼ˆå¦‚Leidenç®—æ³•ï¼‰æ‰€æ”¹è¿›ï¼Œä½†å®ƒä»ç„¶æ˜¯è®¸å¤šç½‘ç»œåˆ†æä»»åŠ¡çš„é¦–é€‰èµ·ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ å…¨é¢ç†è§£Louvainç®—æ³•ã€‚å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šæ–¹é¢è¿˜æœ‰ç–‘é—®ï¼Œæˆ–è€…æƒ³äº†è§£å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­è°ƒæ•´å‚æ•°ä¼˜åŒ–ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;
&lt;h2 id="leiden"&gt;Leiden
&lt;/h2&gt;&lt;p&gt;Leidenç®—æ³•æ˜¯2019å¹´æå‡ºçš„ä¸€ç§å…ˆè¿›çš„ç¤¾åŒºå‘ç°ç®—æ³•ï¼Œå®ƒæœ‰æ•ˆåœ°è§£å†³äº†ç»å…¸Louvainç®—æ³•å¯èƒ½äº§ç”Ÿè¿é€šæ€§ä¸ä½³çš„ç¤¾åŒºçš„é—®é¢˜ï¼ŒåŒæ—¶åœ¨è¿è¡Œé€Ÿåº¦å’Œç»“æœè´¨é‡ä¸Šéƒ½æœ‰æ˜¾è‘—æå‡ã€‚ä¸‹é¢è¿™å¼ æµç¨‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†å®ƒçš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼Œä½ å¯ä»¥å…ˆé€šè¿‡å®ƒå»ºç«‹ä¸€ä¸ªæ•´ä½“å°è±¡ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[åˆå§‹åŒ–æ¯ä¸ªèŠ‚ç‚¹ä¸ºç‹¬ç«‹ç¤¾åŒº] --&amp;gt; B[å¿«é€Ÿå±€éƒ¨ç§»åŠ¨&amp;lt;br&amp;gt;ä»…å¤„ç†é‚»å±…å˜åŒ–çš„èŠ‚ç‚¹]
B --&amp;gt; C[åˆ†åŒºç»†åŒ–&amp;lt;br&amp;gt;ä¿è¯ç¤¾åŒºå†…éƒ¨è¿é€šæ€§]
C --&amp;gt; D[ç½‘ç»œèšåˆ&amp;lt;br&amp;gt;åŸºäºç»†åŒ–åˆ†åŒºæ„å»ºæ–°ç½‘ç»œ]
D --&amp;gt; E{æ¨¡å—åº¦æ˜¯å¦&amp;lt;br&amp;gt;æ˜¾è‘—æå‡ï¼Ÿ}
E --&amp;gt;|æ˜¯| A
E --&amp;gt;|å¦| F[è¾“å‡ºæœ€ç»ˆç¤¾åŒºç»“æ„]
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ç†è§£leidenç®—æ³•çš„æ ¸å¿ƒæ”¹è¿›"&gt;ğŸ” ç†è§£Leidenç®—æ³•çš„æ ¸å¿ƒæ”¹è¿›
&lt;/h3&gt;&lt;p&gt;è¦ç†è§£Leidençš„å·§å¦™ä¹‹å¤„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹çœ‹å®ƒçš„å‰è¾ˆLouvainç®—æ³•çš„ä¸»è¦ç¼ºé™·ï¼š&lt;strong&gt;å¯èƒ½äº§ç”Ÿå†…éƒ¨è¿é€šæ€§å¾ˆå·®ç”šè‡³å®Œå…¨ä¸è¿é€šçš„ç¤¾åŒº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨ä¸€ä¸ªç¤¾åŒºä¸­ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒèŠ‚ç‚¹ï¼ˆæ¯”å¦‚èŠ‚ç‚¹0ï¼‰åƒä¸€åº§æ¡¥æ¢ï¼Œè¿æ¥ç€ç¤¾åŒºå†…çš„ä¸¤ä¸ªéƒ¨åˆ†ã€‚Louvainç®—æ³•åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå› ä¸ºæ¨¡å—åº¦å¢ç›Šè€Œå°†è¿™åº§â€œæ¡¥â€ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç¤¾åŒºã€‚è¿™ä¼šå¯¼è‡´åŸæ¥çš„ç¤¾åŒºè¢«åˆ†è£‚æˆä¸¤ä¸ªäº’ä¸è¿é€šçš„éƒ¨åˆ†ï¼Œä½†ç”±äºç®—æ³•åªè€ƒè™‘å•ä¸ªèŠ‚ç‚¹çš„ç§»åŠ¨ï¼Œå®ƒæ— æ³•å¯Ÿè§‰è¿™ç§åˆ†è£‚ï¼Œä»è€Œå°†è¿™ä¸¤ä¸ªéƒ¨åˆ†ä»ç„¶è§†ä¸ºä¸€ä¸ªç¤¾åŒºã€‚Leidenç®—æ³•æ­£æ˜¯é€šè¿‡å¼•å…¥&lt;strong&gt;åˆ†åŒºç»†åŒ–é˜¶æ®µ&lt;/strong&gt; æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¿è¯æœ€ç»ˆäº§ç”Ÿçš„æ¯ä¸ªç¤¾åŒºéƒ½æ˜¯å†…éƒ¨è¿é€šçš„ã€‚&lt;/p&gt;
&lt;h3 id="-è¯¦è§£ç®—æ³•çš„ä¸‰ä¸ªé˜¶æ®µ"&gt;âš™ï¸ è¯¦è§£ç®—æ³•çš„ä¸‰ä¸ªé˜¶æ®µ
&lt;/h3&gt;&lt;p&gt;Leidenç®—æ³•çš„æ¯æ¬¡è¿­ä»£éƒ½åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªå…³é”®é˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¿«é€Ÿå±€éƒ¨ç§»åŠ¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­¤é˜¶æ®µçš„ç›®æ ‡æ˜¯åˆæ­¥ä¼˜åŒ–åˆ†åŒºã€‚ä¸Louvainç®—æ³•åå¤éå†æ‰€æœ‰èŠ‚ç‚¹ä¸åŒï¼ŒLeidené‡‡ç”¨äº†ä¸€ç§æ›´é«˜æ•ˆçš„ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–é˜Ÿåˆ—&lt;/strong&gt;ï¼šå°†æ‰€æœ‰èŠ‚ç‚¹éšæœºæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†èŠ‚ç‚¹&lt;/strong&gt;ï¼šä»é˜Ÿåˆ—å‰ç«¯å–å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¡ç®—å°†å…¶ç§»åŠ¨åˆ°ä»»ä¸€é‚»å±…ç¤¾åŒºæ‰€å¸¦æ¥çš„æ¨¡å—åº¦å¢ç›Šã€‚å¦‚æœå­˜åœ¨æ­£å¢ç›Šï¼Œåˆ™å°†å…¶ç§»åŠ¨åˆ°èƒ½å¸¦æ¥&lt;strong&gt;æœ€å¤§å¢ç›Š&lt;/strong&gt;çš„ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°é˜Ÿåˆ—&lt;/strong&gt;ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹è¢«ç§»åŠ¨ï¼Œåˆ™å°†å…¶&lt;strong&gt;ä¸å±äºæ–°ç¤¾åŒºä¸”ä¸åœ¨é˜Ÿåˆ—ä¸­çš„é‚»å±…èŠ‚ç‚¹&lt;/strong&gt;åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ã€‚è¿™ä¸ªè¿‡ç¨‹æŒç»­åˆ°é˜Ÿåˆ—ä¸ºç©ºï¼Œç¡®ä¿åªå¤„ç†é‚£äº›é‚»å±…çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹ï¼Œå¤§å¤§æå‡äº†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†åŒºç»†åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯Leidenç®—æ³•çš„æ ¸å¿ƒåˆ›æ–°ï¼Œæ—¨åœ¨ä¿è¯ç¤¾åŒºçš„è¿é€šæ€§ã€‚å®ƒå¯¹ä¸Šä¸€æ­¥å¾—åˆ°çš„åˆ†åŒºè¿›è¡Œå±€éƒ¨è°ƒæ•´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–ç»†åŒ–åˆ†åŒº&lt;/strong&gt;ï¼šå°†å½“å‰åˆ†åŒºä¸­çš„æ¯ä¸ªç¤¾åŒºå†…çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½è§†ä¸ºç‹¬ç«‹çš„å•èŠ‚ç‚¹ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€éƒ¨åˆå¹¶&lt;/strong&gt;ï¼šå°è¯•å°†è¿™äº›å•èŠ‚ç‚¹ç¤¾åŒºåœ¨&lt;strong&gt;åŸç¤¾åŒºå†…éƒ¨&lt;/strong&gt;è¿›è¡Œåˆå¹¶ã€‚åˆå¹¶å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼šä¸€æ˜¯èƒ½æé«˜è´¨é‡å‡½æ•°ï¼ˆå¦‚æ¨¡å—åº¦ï¼‰ï¼ŒäºŒæ˜¯åˆå¹¶åå¿…é¡»ä¿è¯å­é›†æ˜¯&lt;strong&gt;è‰¯å¥½è¿é€šçš„&lt;/strong&gt;ã€‚åˆå¹¶è¿‡ç¨‹å¼•å…¥äº†ä¸€å®šçš„éšæœºæ€§ï¼Œå¹¶éæ€»æ˜¯é€‰æ‹©æœ€ä¼˜å¢ç›Šï¼Œè¿™æœ‰åŠ©äºæ¢ç´¢æ›´å¹¿é˜”çš„è§£ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œèšåˆ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åŸºäº&lt;strong&gt;ç»†åŒ–åçš„é«˜è´¨é‡åˆ†åŒº&lt;/strong&gt;ï¼Œå°†æ¯ä¸ªç¤¾åŒºå‡èšæˆä¸€ä¸ªæ–°çš„è¶…çº§èŠ‚ç‚¹ï¼Œæ„å»ºå‡ºä¸€ä¸ªè§„æ¨¡æ›´å°çš„æ–°ç½‘ç»œã€‚ç„¶åï¼Œç®—æ³•å°†è¿™ä¸ªæ–°ç½‘ç»œä½œä¸ºè¾“å…¥ï¼Œå¼€å§‹ä¸‹ä¸€æ¬¡è¿­ä»£ï¼Œç›´åˆ°æ¨¡å—åº¦ä¸å†æ˜¾è‘—æå‡ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä¸louvainç®—æ³•çš„å¯¹æ¯”"&gt;ğŸ“Š ä¸Louvainç®—æ³•çš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯¹æ¯”ç»´åº¦&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Louvainç®—æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Leidenç®—æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒä¿è¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿è¯æ²¡æœ‰å•ä¸ªèŠ‚ç‚¹å¯ä»¥ç§»åŠ¨ï¼Œä½†æ²¡æœ‰è¿é€šæ€§ä¿è¯ã€‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¿è¯æ‰€æœ‰ç¤¾åŒºå†…éƒ¨è¿é€š&lt;/strong&gt;ï¼Œä¸”ç¤¾åŒºçš„å­é›†ä¹Ÿæ˜¯å±€éƒ¨æœ€ä¼˜çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¤¾åŒºè´¨é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯èƒ½äº§ç”Ÿè¿é€šæ€§å·®ç”šè‡³ä¸è¿é€šçš„ç¤¾åŒºï¼Œå°¤å…¶åœ¨å¤šæ¬¡è¿­ä»£åã€‚&lt;/td&gt;
&lt;td&gt;ç¤¾åŒºè´¨é‡&lt;strong&gt;æ˜¾è‘—æ›´é«˜&lt;/strong&gt;ï¼Œç»“æ„æ›´åˆç†ï¼Œèƒ½å‘ç°æ›´ç»†å¾®çš„ç¤¾åŒºç»“æ„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿è¡Œæ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è¿­ä»£éœ€éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œç›¸å¯¹è¾ƒä½æ•ˆã€‚&lt;/td&gt;
&lt;td&gt;é‡‡ç”¨å¿«é€Ÿå±€éƒ¨ç§»åŠ¨ï¼Œ&lt;strong&gt;é€Ÿåº¦æ›´å¿«&lt;/strong&gt;ï¼Œå°¤å…¶é€‚åˆå¤§è§„æ¨¡ç½‘ç»œã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç®—æ³•å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›¸å¯¹ç®€å•ã€‚&lt;/td&gt;
&lt;td&gt;å¢åŠ äº†ç»†åŒ–æ­¥éª¤ï¼Œæ›´å¤æ‚ï¼Œä½†èƒ½é¿å…åç»­ä¸å¿…è¦çš„è®¡ç®—ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å®è·µä¸åº”ç”¨"&gt;ğŸ’» å®è·µä¸åº”ç”¨
&lt;/h3&gt;&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç°æœ‰çš„åº“æ¥è½»æ¾è¿è¡ŒLeidenç®—æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨Pythonä¸­ï¼Œç»“åˆ&lt;code&gt;igraph&lt;/code&gt;å’Œ&lt;code&gt;leidenalg&lt;/code&gt;åº“ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import igraph as ig
import leidenalg
# è¯»å–æˆ–åˆ›å»ºä¸€ä¸ªå›¾
# g = ig.Graph.Read_Edgelist(&amp;#34;your_network.edgelist&amp;#34;)
# ä»¥è‘—åçš„Zacharyç©ºæ‰‹é“ä¿±ä¹éƒ¨ç½‘ç»œä¸ºä¾‹
g = ig.Graph.Famous(&amp;#39;Zachary&amp;#39;)
# ä½¿ç”¨Leidenç®—æ³•è¿›è¡Œç¤¾åŒºåˆ’åˆ†ï¼Œä»¥æ¨¡å—åº¦ä¸ºä¼˜åŒ–ç›®æ ‡
partition = leidenalg.find_partition(g, leidenalg.ModularityVertexPartition)
# æŸ¥çœ‹åˆ’åˆ†ç»“æœå’Œæ¨¡å—åº¦å€¼
print(&amp;#34;Community membership:&amp;#34;, list(partition))
print(&amp;#34;Modularity of the partition:&amp;#34;, partition.modularity)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Leidenç®—æ³•å› å…¶é«˜æ•ˆå’Œé«˜è´¨é‡çš„ç»“æœï¼Œå·²è¢«å¹¿æ³›åº”ç”¨äºå¤šä¸ªé¢†åŸŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•ç»†èƒåŸºå› ç»„å­¦&lt;/strong&gt;ï¼šåœ¨åˆ†æå•ç»†èƒRNAæµ‹åºæ•°æ®æ—¶ï¼Œç”¨äºå¯¹ç»†èƒè¿›è¡Œèšç±»ï¼Œè¯†åˆ«ä¸åŒçš„ç»†èƒç±»å‹ã€‚ä¾‹å¦‚ï¼Œåˆ†æå·¥å…·Scanpyå°±å·²ç”¨Leidenæ›¿ä»£äº†Louvainä½œä¸ºé»˜è®¤çš„èšç±»ç®—æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤¾äº¤ç½‘ç»œåˆ†æ&lt;/strong&gt;ï¼šè¯†åˆ«å…·æœ‰ç´§å¯†è”ç³»çš„ç”¨æˆ·ç¾¤ä½“æˆ–å…´è¶£ç¤¾åŒºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿç‰©ä¿¡æ¯å­¦&lt;/strong&gt;ï¼šåœ¨è›‹ç™½è´¨ç›¸äº’ä½œç”¨ç½‘ç»œæˆ–åŸºå› è°ƒæ§ç½‘ç»œä¸­ï¼Œå‘ç°åŠŸèƒ½æ¨¡å—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èç³»ç»Ÿä¸é‡‘èé£æ§&lt;/strong&gt;ï¼šè¯†åˆ«ç”¨æˆ·ç¾¤ä½“æˆ–å‘ç°æ½œåœ¨çš„é£é™©å…³è”å›¢ä¼™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ€»çš„æ¥è¯´ï¼ŒLeidenç®—æ³•é€šè¿‡å¼•å…¥&lt;strong&gt;åˆ†åŒºç»†åŒ–é˜¶æ®µ&lt;/strong&gt;ï¼Œåœ¨ç»§æ‰¿Louvainç®—æ³•é«˜æ•ˆå±‚æ¬¡åŒ–å¤„ç†ä¼˜ç‚¹çš„åŒæ—¶ï¼Œ&lt;strong&gt;ä»æ ¹æœ¬ä¸Šè§£å†³äº†ç¤¾åŒºè¿é€šæ€§é—®é¢˜&lt;/strong&gt;ï¼Œå¹¶å¾€å¾€èƒ½è·å¾—è´¨é‡æ›´é«˜ã€æ›´åˆç†çš„ç¤¾åŒºåˆ’åˆ†ç»“æœã€‚è™½ç„¶å®ƒå¯¹å‚æ•°ï¼ˆå¦‚åˆ†è¾¨ç‡å‚æ•°ï¼‰çš„é€‰æ‹©å¯èƒ½æ¯”è¾ƒæ•æ„Ÿï¼Œä½†æ¯«æ— ç–‘é—®ï¼Œå®ƒå·²æˆä¸ºå½“å‰ç¤¾åŒºå‘ç°é¢†åŸŸ&lt;strong&gt;æ€§èƒ½æ›´ä¼˜è¶Šã€æ›´å€¼å¾—æ¨èçš„æ ‡å‡†ç®—æ³•ä¹‹ä¸€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„ä»‹ç»èƒ½å¸®åŠ©ä½ å…¨é¢ç†è§£Leidenç®—æ³•ã€‚å¦‚æœä½ å¯¹æŸä¸ªæŠ€æœ¯ç»†èŠ‚æˆ–åº”ç”¨åœºæ™¯æœ‰è¿›ä¸€æ­¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘LLM Knowledge</title><link>https://dyhes.github.io/p/shopeellm-knowledge/</link><pubDate>Wed, 17 Sep 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeellm-knowledge/</guid><description>&lt;h2 id="context-length"&gt;Context Length
&lt;/h2&gt;&lt;p&gt;å¤§æ¨¡å‹çš„ &lt;strong&gt;Context Length&lt;/strong&gt;ï¼ˆä¸Šä¸‹æ–‡é•¿åº¦ï¼‰æ˜¯æŒ‡æ¨¡å‹åœ¨å•æ¬¡æ¨ç†è¿‡ç¨‹ä¸­èƒ½å¤Ÿå¤„ç†çš„æ‰€æœ‰ä¿¡æ¯çš„æ€»å®¹é‡ä¸Šé™ï¼Œé€šå¸¸ä»¥ &lt;strong&gt;Token&lt;/strong&gt;ï¼ˆæ–‡æœ¬çš„æœ€å°å¤„ç†å•ä½ï¼‰æ¥è¡¡é‡ã€‚å®ƒå°±åƒæ¨¡å‹çš„ä¸€æ¬¡æ€§â€œå·¥ä½œè®°å¿†åŒºâ€ï¼Œå†³å®šäº†æ¨¡å‹èƒ½åŒæ—¶çœ‹åˆ°å¤šå°‘å†…å®¹æ¥ç”Ÿæˆå›å¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†ä¸Šä¸‹æ–‡é•¿åº¦çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç»„æˆéƒ¨ä½&lt;/th&gt;
&lt;th&gt;åŒ…å«å†…å®¹&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”¨æˆ·è¾“å…¥éƒ¨åˆ†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰çš„æé—®ã€æŒ‡ä»¤&lt;/td&gt;
&lt;td&gt;å³ä½ æœ¬æ¬¡å‘æ¨¡å‹æå‡ºçš„é—®é¢˜æˆ–è¦æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¤šè½®å¯¹è¯çš„å†å²è®°å½• (ä¹‹å‰çš„é—®ç­”äº¤æ›¿)&lt;/td&gt;
&lt;td&gt;ä¸ºäº†è®©æ¨¡å‹ç†è§£ä¸Šä¸‹æ–‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†ä¹‹å‰çš„å¯¹è¯å†…å®¹æ‹¼æ¥èµ·æ¥ä¼ ç»™æ¨¡å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ä¸Šä¼ çš„æ–‡æ¡£ã€æä¾›çš„å‚è€ƒèµ„æ–™æˆ–é™„åŠ è¯´æ˜&lt;/td&gt;
&lt;td&gt;ä¾‹å¦‚è®©æ¨¡å‹åˆ†æä½ ä¸Šä¼ çš„PDFã€TXTç­‰æ–‡ä»¶å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨¡å‹è¾“å‡ºéƒ¨åˆ†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¨¡å‹æ ¹æ®ä¸Šè¿°æ‰€æœ‰è¾“å…¥å†…å®¹ï¼Œæ­£åœ¨ç”Ÿæˆçš„å›ç­”æˆ–ç»­å†™å†…å®¹&lt;/td&gt;
&lt;td&gt;æ¨¡å‹äº§ç”Ÿçš„æ–°çš„æ–‡æœ¬è¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£è¿™äº›éƒ¨åˆ†å¦‚ä½•å…±åŒæ„æˆä¸€æ¬¡å®Œæ•´çš„æ¨¡å‹äº¤äº’ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„æµç¨‹å›¾ï¼Œå®ƒå±•ç¤ºäº†ä¸Šä¸‹æ–‡é•¿åº¦åœ¨å•æ¬¡æ¨ç†ä¸­çš„åŠ¨æ€ä½¿ç”¨è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[ç”¨æˆ·å‘èµ·ä¸€æ¬¡è¯·æ±‚] --&amp;gt; B[æ„æˆæœ¬æ¬¡è¾“å…¥çš„Token&amp;lt;br&amp;gt;ï¼ˆå½“å‰é—®é¢˜ + å†å²å¯¹è¯ + ä¸Šä¼ æ–‡æ¡£ï¼‰]
A --&amp;gt; C[æ¨¡å‹ç”Ÿæˆè¾“å‡ºçš„Token&amp;lt;br&amp;gt;ï¼ˆæ­£åœ¨äº§ç”Ÿçš„å›ç­”ï¼‰]
B --&amp;gt; D[è¾“å…¥Tokenè®¡æ•°]
C --&amp;gt; E[è¾“å‡ºTokenè®¡æ•°]
D --&amp;gt; F[è¾“å…¥Tokenæ•° + è¾“å‡ºTokenæ•°]
E --&amp;gt; F
F --&amp;gt; G{æ€»è®¡ â‰¤ ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ï¼Ÿ}
G -- æ˜¯ --&amp;gt; H[âœ… å¤„ç†æˆåŠŸ&amp;lt;br&amp;gt;æ¨¡å‹æ­£å¸¸ç”Ÿæˆå›ç­”]
G -- å¦ --&amp;gt; I[âŒ å¤„ç†å¤±è´¥&amp;lt;br&amp;gt;è¾“å…¥è¢«æˆªæ–­æˆ–è¾“å‡ºè¢«ä¸­æ–­]
H --&amp;gt; J[è¿›å…¥ä¸‹ä¸€è½®å¯¹è¯å¾ªç¯]
I --&amp;gt; J
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å›¾è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œ&lt;strong&gt;ç”¨æˆ·è¾“å…¥&lt;/strong&gt;å’Œ&lt;strong&gt;æ¨¡å‹è¾“å‡º&lt;/strong&gt;å…±åŒæ¶ˆè€—ç€æœ‰é™çš„ä¸Šä¸‹æ–‡é•¿åº¦é¢„ç®—ã€‚&lt;/p&gt;
&lt;h3 id="-å…³äºtokençš„ç®€å•è¯´æ˜"&gt;ğŸ’¡ å…³äºTokençš„ç®€å•è¯´æ˜
&lt;/h3&gt;&lt;p&gt;Tokenæ˜¯æ¨¡å‹å¤„ç†æ–‡æœ¬çš„åŸºæœ¬å•ä½ï¼Œç†è§£å®ƒæœ‰åŠ©äºä½ æ›´å¥½åœ°æŠŠæ¡ä¸Šä¸‹æ–‡é•¿åº¦çš„æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äº&lt;strong&gt;è‹±æ–‡&lt;/strong&gt;ï¼Œä¸€ä¸ªå•è¯é€šå¸¸çº¦ä¸º1ä¸ªTokenï¼ˆå¦‚ &amp;ldquo;hello&amp;rdquo;ï¼‰ï¼Œä½†é•¿è¯å¯èƒ½è¢«æ‹†åˆ†ï¼ˆå¦‚ &amp;ldquo;chatGPT&amp;rdquo; å¯èƒ½ä¸º2ä¸ªTokenï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº&lt;strong&gt;ä¸­æ–‡&lt;/strong&gt;ï¼Œä¸€ä¸ªæ±‰å­—å¤§è‡´ç›¸å½“äº1ä¸ªTokenï¼ˆå¦‚â€œä½ å¥½â€çº¦ä¸º2ä¸ªTokensï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡ç‚¹ç¬¦å·ã€æ•°å­—å’Œç©ºæ ¼&lt;/strong&gt;ç­‰ä¹Ÿéƒ½è®¡ç®—åœ¨å†…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç²—ç•¥ä¼°ç®—æ—¶ï¼Œå¯ä»¥è®¤ä¸º &lt;strong&gt;1ä¸ªTokençº¦ç­‰äº1ä¸ªæ±‰å­—&lt;/strong&gt;çš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;p&gt;äº†è§£ä»¥ä¸‹å‡ ç‚¹ï¼Œèƒ½å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ä½¿ç”¨æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬æ€§é™åˆ¶ä¸åŠ¨æ€æ¶ˆè€—&lt;/strong&gt;ï¼šä¸Šä¸‹æ–‡é•¿åº¦æ˜¯ä¸€ä¸ª&lt;strong&gt;ç¡¬æ€§ä¸Šé™&lt;/strong&gt;ã€‚å¦‚å›¾è¡¨æ‰€ç¤ºï¼Œå•æ¬¡äº¤äº’ä¸­â€œè¾“å…¥+è¾“å‡ºâ€çš„Tokenæ€»æ•°ç»ä¸èƒ½è¶…è¿‡æ­¤é™åˆ¶ï¼Œå¦åˆ™æœ€æ—©çš„ä¿¡æ¯ä¼šè¢«ä¸¢å¼ƒï¼ˆæˆªæ–­ï¼‰ï¼Œä»¥ç¡®ä¿å¤„ç†æ­£å¸¸è¿›è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè½®å¯¹è¯çš„ç´¯ç§¯æ•ˆåº”&lt;/strong&gt;ï¼šåœ¨å¤šè½®å¯¹è¯ä¸­ï¼Œä¸ºäº†ç»´æŒå¯¹è¯è¿è´¯æ€§ï¼Œ&lt;strong&gt;ä¹‹å‰æ‰€æœ‰è½®æ¬¡çš„å¯¹è¯å†å²ï¼ˆä½ çš„é—®é¢˜å’Œæ¨¡å‹çš„å›ç­”ï¼‰éƒ½ä¼šä½œä¸ºæ–°çš„è¾“å…¥ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ï¼Œè¢«å†æ¬¡ä¼ é€’ç»™æ¨¡å‹&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€å¯¹è¯è½®æ•°è¶Šå¤šï¼Œæ¶ˆè€—çš„ä¸Šä¸‹æ–‡é•¿åº¦å°±è¶Šå¤šï¼Œå¯ç”¨çš„å‰©ä½™ç©ºé—´å°±è¶Šå°‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€å¤§è¾“å‡ºé•¿åº¦çš„çº¦æŸ&lt;/strong&gt;ï¼šé™¤äº†æ€»é•¿åº¦é™åˆ¶ï¼Œæ¨¡å‹é€šå¸¸è¿˜æœ‰ä¸€ä¸ª&lt;strong&gt;æœ€å¤§è¾“å‡ºé•¿åº¦&lt;/strong&gt;ï¼ˆMax Output Tokensï¼‰çš„é™åˆ¶ï¼Œå³å•æ¬¡å›å¤èƒ½ç”Ÿæˆçš„æœ€å¤§Tokenæ•°ã€‚ä¾‹å¦‚ï¼Œå³ä½¿ä¸Šä¸‹æ–‡é•¿åº¦æœ‰128Kï¼Œä½†æ¨¡å‹å•æ¬¡å›ç­”å¯èƒ½è¢«é™åˆ¶ä¸ºåªèƒ½è¾“å‡º4K Tokenã€‚å› æ­¤ï¼Œå®é™…å¯ç”¨è¾“å…¥é•¿åº¦ â‰ˆ ä¸Šä¸‹æ–‡æ€»é•¿åº¦ - æœ€å¤§è¾“å‡ºé•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;â€œå¤±å¿†â€ç°è±¡çš„æ ¹æº&lt;/strong&gt;ï¼šå½“é•¿å¯¹è¯ç´¯ç§¯çš„Tokenæ•°è¶…è¿‡æ¨¡å‹çš„ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶æ—¶ï¼Œç³»ç»Ÿä¼š&lt;strong&gt;ä¸¢å¼ƒæœ€æ—©çš„ä¿¡æ¯&lt;/strong&gt;ï¼ˆé€šå¸¸æ˜¯å¯¹è¯å¼€å¤´éƒ¨åˆ†ï¼‰ä»¥å®¹çº³æ–°è¾“å…¥ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¨¡å‹åœ¨é•¿å¯¹è¯åå¯èƒ½â€œå¿˜è®°â€å¾ˆä¹…ä¹‹å‰è®¨è®ºè¿‡çš„å†…å®¹ï¼Œè¿™å¹¶éæ¨¡å‹æœ¬èº«æ•…éšœï¼Œè€Œæ˜¯å·¥ç¨‹ä¸Šçš„å¤„ç†ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="æ€»ç»“ä¸åº”ç”¨å»ºè®®"&gt;æ€»ç»“ä¸åº”ç”¨å»ºè®®
&lt;/h3&gt;&lt;p&gt;ç†è§£ä¸Šä¸‹æ–‡é•¿åº¦çš„ç»„æˆå’Œé™åˆ¶ï¼Œèƒ½å¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°ä¸å¤§å‹è¯­è¨€æ¨¡å‹äº¤äº’ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†é•¿æ–‡æ¡£&lt;/strong&gt;ï¼šè‹¥éœ€åˆ†æé•¿æ–‡æ¡£ï¼Œå¯å…ˆæå–å…³é”®ç« èŠ‚æˆ–åˆ†æ®µæäº¤ï¼Œä»¥é¿å…è€—å°½ä¸Šä¸‹æ–‡ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®¡ç†é•¿å¯¹è¯&lt;/strong&gt;ï¼šåœ¨é•¿æ—¶é—´ã€å¤šè½®å¯¹è¯ä¸­ï¼Œå¯¹äºé‡è¦çš„å‰æœŸç»“è®ºæˆ–ä¿¡æ¯ï¼Œå¯æœ‰æ„è¯†åœ°&lt;strong&gt;åœ¨åç»­æé—®ä¸­é‡ç”³æˆ–æåŠ&lt;/strong&gt;ï¼Œä»¥é˜²å…¶å› æˆªæ–­è€Œè¢«â€œé—å¿˜â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶è¾“å‡ºé•¿åº¦&lt;/strong&gt;ï¼šè‹¥éœ€è¦æ¨¡å‹ç”Ÿæˆéå¸¸é•¿çš„å†…å®¹ï¼ˆå¦‚é•¿ç¯‡æ–‡ç« ã€æŠ¥å‘Šï¼‰ï¼Œè€Œå®ƒçš„å•æ¬¡è¾“å‡ºé•¿åº¦æœ‰é™ï¼Œå¯ä»¥&lt;strong&gt;å¼•å¯¼å®ƒåˆ†æ­¥éª¤ã€åˆ†ç« èŠ‚åœ°ç”Ÿæˆ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨å¤§æ¨¡å‹ã€‚&lt;/p&gt;
&lt;h2 id="å¸¸ç”¨ä¸Šä¸‹æ–‡"&gt;å¸¸ç”¨ä¸Šä¸‹æ–‡
&lt;/h2&gt;&lt;p&gt;äº†è§£å½“å‰ä¸»æµå¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆContext Lengthï¼‰å¯¹äºé€‰æ‹©åˆé€‚çš„æ¨¡å‹è‡³å…³é‡è¦ã€‚ä¸Šä¸‹æ–‡é•¿åº¦å†³å®šäº†æ¨¡å‹å•æ¬¡å¤„ç†ä¿¡æ¯çš„å®¹é‡ï¼Œç›´æ¥å½±å“åˆ°å¤„ç†é•¿æ–‡æ¡£ã€ç»´æŒé•¿å¯¹è¯å’Œå¤æ‚æ¨ç†çš„èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯æˆªè‡³2025å¹´çš„æµè¡Œå¤§æ¨¡å‹åŠå…¶ä¸Šä¸‹æ–‡é•¿åº¦ä¿¡æ¯ï¼Œä¾›ä½ å‚è€ƒã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹ç³»åˆ—&lt;/th&gt;
&lt;th&gt;æ¨¡å‹åç§° (æˆ–ç‰ˆæœ¬)&lt;/th&gt;
&lt;th&gt;ä¸Šä¸‹æ–‡é•¿åº¦ (Tokens)&lt;/th&gt;
&lt;th&gt;å¤‡æ³¨/ç‰¹ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›½å¤–æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OpenAI&lt;/td&gt;
&lt;td&gt;GPT-4 (8Kç‰ˆ)&lt;/td&gt;
&lt;td&gt;8,192&lt;/td&gt;
&lt;td&gt;æ”¯æŒçº¦8k tokensè¾“å…¥è¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;GPT-4 (32Kç‰ˆ)&lt;/td&gt;
&lt;td&gt;32,768&lt;/td&gt;
&lt;td&gt;å•æ¬¡å¯å¤„ç†çº¦2.5ä¸‡å­—ä¸­æ–‡æˆ–è‹±æ–‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;GPT-5&lt;/td&gt;
&lt;td&gt;1,000,000+&lt;/td&gt;
&lt;td&gt;è¶…é•¿ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›è¾¾1M+ tokens&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Anthropic&lt;/td&gt;
&lt;td&gt;Claude 4&lt;/td&gt;
&lt;td&gt;1,000,000 (1000k)&lt;/td&gt;
&lt;td&gt;è¶…ä½å¹»è§‰ï¼Œé€‚ç”¨äºæ³•å¾‹ã€åŒ»ç–—ç­‰é«˜é£é™©é¢†åŸŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Google DeepMind&lt;/td&gt;
&lt;td&gt;Gemini ç³»åˆ—æ ‡å‡†ç‰ˆ&lt;/td&gt;
&lt;td&gt;~32,768&lt;/td&gt;
&lt;td&gt;æ€§èƒ½æ¥è¿‘GPT-4ï¼Œæœªæ˜ç¡®å…¬å¸ƒå…·ä½“æ•°å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Gemini 1.5 Flash&lt;/td&gt;
&lt;td&gt;1,000,000&lt;/td&gt;
&lt;td&gt;æ”¯æŒç™¾ä¸‡tokenä¸Šä¸‹æ–‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Gemini 1.5 Pro&lt;/td&gt;
&lt;td&gt;2,000,000&lt;/td&gt;
&lt;td&gt;æ”¯æŒä¸¤ç™¾ä¸‡tokenä¸Šä¸‹æ–‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Gemini 2.5 Pro&lt;/td&gt;
&lt;td&gt;1,000,000&lt;/td&gt;
&lt;td&gt;æ¶²æ€ç¥ç»ç½‘ç»œæ¶æ„ï¼Œå“åº”å»¶è¿Ÿä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Meta (Facebook)&lt;/td&gt;
&lt;td&gt;Llama 2&lt;/td&gt;
&lt;td&gt;4,096&lt;/td&gt;
&lt;td&gt;ç›¸æ¯”Llama 1çš„2048 tokensç¿»å€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Llama 4&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;æä¾›ä¸‡äº¿å‚æ•°ç‰ˆæœ¬ï¼Œæ”¯æŒ100+è¯­è¨€ï¼Œæ‰‹æœºç«¯éƒ¨ç½²èƒ½åŠ›å¼º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mistral AI&lt;/td&gt;
&lt;td&gt;Mistral-Next&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¶æ„ï¼Œæ•ˆç‡é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›½å†…æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç™¾åº¦ (Baidu)&lt;/td&gt;
&lt;td&gt;æ–‡å¿ƒå¤§æ¨¡å‹ 5.0 (ERNIE 5.0)&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;äº§ä¸šçº§å¤šæ¨¡æ€èƒ½åŠ›ï¼Œèåˆè¡Œä¸šæ•°æ®åº“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é˜¿é‡Œå·´å·´ (Alibaba)&lt;/td&gt;
&lt;td&gt;é€šä¹‰åƒé—®3.0 (Qwen3)&lt;/td&gt;
&lt;td&gt;500,000&lt;/td&gt;
&lt;td&gt;è¶…é•¿æ–‡æœ¬æ”¯æŒ500k tokensï¼Œç”µå•†ä¼˜åŒ–èƒ½åŠ›çªå‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;é€šä¹‰åƒé—®-Max&lt;/td&gt;
&lt;td&gt;32,000~1,000,000&lt;/td&gt;
&lt;td&gt;é€‚åˆå¤æ‚ä»»åŠ¡ï¼Œæ¨ç†èƒ½åŠ›æœ€å¼º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;é€šä¹‰åƒé—®-Plus&lt;/td&gt;
&lt;td&gt;1,000,000&lt;/td&gt;
&lt;td&gt;æ€§èƒ½å‡è¡¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;é€šä¹‰åƒé—®-Flash&lt;/td&gt;
&lt;td&gt;1,000,000&lt;/td&gt;
&lt;td&gt;é€‚åˆç®€å•ä»»åŠ¡ï¼Œé€Ÿåº¦å¿«ã€æˆæœ¬ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è…¾è®¯ (Tencent)&lt;/td&gt;
&lt;td&gt;æ··å…ƒå¤§æ¨¡å‹3.0 (Hunyuan 3.0)&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;æ¸¸æˆNPCæ™ºèƒ½åŒ–ï¼Œå¾®ä¿¡æ·±åº¦æ•´åˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åä¸º (Huawei)&lt;/td&gt;
&lt;td&gt;ç›˜å¤å¤§æ¨¡å‹4.0&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;è¡Œä¸šä¸“ç”¨å°æ¨¡å‹ï¼Œç«¯ä¾§AI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç§‘å¤§è®¯é£ (iFLYTEK)&lt;/td&gt;
&lt;td&gt;è®¯é£æ˜Ÿç«V4.0 Turbo&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;ä¸­è‹±åŒè¯­å¯¹é½ä¼˜åŒ–ï¼Œæ”¯æŒ202ç§æ–¹è¨€è¯†åˆ«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ·±åº¦æ±‚ç´¢ (DeepSeek)&lt;/td&gt;
&lt;td&gt;DeepSeek-V3&lt;/td&gt;
&lt;td&gt;128,000&lt;/td&gt;
&lt;td&gt;æ··åˆæ¨ç†æ¶æ„ï¼Œæ•°å­¦ä¸ä»£ç èƒ½åŠ›çªå‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœˆä¹‹æš—é¢ (Moonshot)&lt;/td&gt;
&lt;td&gt;Kimi+&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;å¼ºè°ƒ1000ä¸‡å­—ä¸Šä¸‹æ–‡ï¼ˆå…¨çƒæœ€é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ä¹‹ä¸€ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ™ºè°±AI (Zhipu AI)&lt;/td&gt;
&lt;td&gt;GLM-5&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;ä¸­è‹±åŒè¯­å¯¹é½ï¼Œå¼€æºç‰ˆæœ¬å¢å¼º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ğŸ’¡ é‡è¦è¯´æ˜ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Tokenæ¢ç®—å‚è€ƒ&lt;/strong&gt;ï¼šé€šå¸¸ï¼Œ1ä¸ªTokençº¦ç­‰äº1-2ä¸ªæ±‰å­—ï¼ˆä¸­æ–‡ï¼‰æˆ–0.75ä¸ªå•è¯ï¼ˆè‹±æ–‡ï¼‰ã€‚ä¾‹å¦‚ï¼Œ32K tokenså¤§çº¦å¯¹åº”2.4ä¸‡è‡³4.8ä¸‡ä¸ªæ±‰å­—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®é™…é™åˆ¶&lt;/strong&gt;ï¼šæ¨¡å‹å£°ç§°çš„ä¸Šä¸‹æ–‡é•¿åº¦æ˜¯&lt;strong&gt;ç†è®ºæœ€å¤§å€¼&lt;/strong&gt;ã€‚å®é™…ä½¿ç”¨æ—¶ï¼Œ&lt;strong&gt;è¾“å…¥ï¼ˆä½ çš„é—®é¢˜+ä¸Šä¸‹æ–‡ï¼‰å’Œè¾“å‡ºï¼ˆæ¨¡å‹çš„å›ç­”ï¼‰çš„Tokenæ•°ä¹‹å’Œ&lt;/strong&gt;ä¸èƒ½è¶…è¿‡æ­¤é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯å‘å±•&lt;/strong&gt;ï¼šä¸Šä¸‹æ–‡é•¿åº¦æ˜¯å½“å‰å¤§æ¨¡å‹æŠ€æœ¯ç«äº‰çš„ä¸€ä¸ªç„¦ç‚¹ï¼Œæ•°å€¼æ›´æ–°å¾ˆå¿«ã€‚éƒ¨åˆ†æ¨¡å‹ï¼ˆå¦‚GPT-5ã€Claude 4ã€Gemini 1.5/2.5 Proï¼‰å·²æ”¯æŒ&lt;strong&gt;ç™¾ä¸‡çº§ï¼ˆ1M+ï¼‰ç”šè‡³ä¸¤ç™¾ä¸‡ï¼ˆ2Mï¼‰Token&lt;/strong&gt;ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†æ•´æœ¬ä¹¦ã€é•¿ç¯‡è®ºæ–‡æˆ–æå…¶å¤æ‚çš„å¤šè½®å¯¹è¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©å»ºè®®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¤„ç†æ—¥å¸¸é—®ç­”ã€çŸ­æ–‡æ€»ç»“ï¼š&lt;strong&gt;8K-32K&lt;/strong&gt; çš„æ¨¡å‹é€šå¸¸è¶³å¤Ÿã€‚&lt;/li&gt;
&lt;li&gt;åˆ†æé•¿ç¯‡æŠ¥å‘Šã€æŠ€æœ¯æ–‡æ¡£ã€ä»£ç åº“ï¼šå»ºè®®é€‰æ‹© &lt;strong&gt;100Kä»¥ä¸Š&lt;/strong&gt; çš„æ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;è¿›è¡Œè¶…é•¿æ–‡çŒ®è§£æã€ä¹¦ç±å†…å®¹åˆ†ææˆ–æå…¶å¤æ‚çš„å¤šè½®å¯¹è¯ï¼šåº”è€ƒè™‘ &lt;strong&gt;500Kè‡³1M+&lt;/strong&gt; çš„æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½åˆ—è¡¨èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£å½“å‰å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡é•¿åº¦èƒ½åŠ›ã€‚å¦‚æœä½ æœ‰ç‰¹å®šçš„åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥æ®æ­¤é€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Spring Fundamentals</title><link>https://dyhes.github.io/p/shopeespring-fundamentals/</link><pubDate>Mon, 01 Sep 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeespring-fundamentals/</guid><description>&lt;h2 id="restclient--webclient"&gt;&lt;code&gt;RestClient&lt;/code&gt; &amp;amp; &lt;code&gt;WebClient&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;Spring Framework ä¸­çš„ &lt;code&gt;RestClient&lt;/code&gt;å’Œ &lt;code&gt;WebClient&lt;/code&gt;éƒ½æ˜¯ç”¨äºè¿›è¡Œ HTTP è°ƒç”¨çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç†å¿µã€é€‚ç”¨åœºæ™¯å’Œç‰¹æ€§æœ‰æ˜¾è‘—åŒºåˆ«ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ï¼Œä»¥ä¾¿ä½ å¿«é€ŸæŠŠæ¡ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;RestClient&lt;/th&gt;
&lt;th&gt;WebClient&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŒæ­¥/å¼‚æ­¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒæ­¥ (é˜»å¡)&lt;/td&gt;
&lt;td&gt;å¼‚æ­¥ (éé˜»å¡) / æ”¯æŒåŒæ­¥è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ ç»Ÿå‘½ä»¤å¼ã€é˜»å¡å¼&lt;/td&gt;
&lt;td&gt;å“åº”å¼ (Reactive)ï¼ŒåŸºäº Reactor (Mono/Flux)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;API é£æ ¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æµç•…çš„ (Fluent) API&lt;/td&gt;
&lt;td&gt;æµç•…çš„ (Fluent) API&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºå¸¸è§„åŒæ­¥è¯·æ±‚ï¼Œæ€§èƒ½é€‚ä¸­&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ã€éé˜»å¡ I/Oï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œé€‚åˆé«˜ååé‡åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æ›²çº¿&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç›¸å¯¹ç®€å•ï¼Œæ˜“äºä¸Šæ‰‹&lt;/td&gt;
&lt;td&gt;ç›¸å¯¹é™¡å³­ï¼Œéœ€ç†è§£å“åº”å¼ç¼–ç¨‹æ¦‚å¿µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring ç‰ˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring Framework 6.1+ / Spring Boot 3.2+&lt;/td&gt;
&lt;td&gt;Spring Framework 5+&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒé€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ ç»Ÿçš„åŒæ­¥é˜»å¡è°ƒç”¨ã€å¾®æœåŠ¡é—´çš„åŒæ­¥é€šä¿¡ã€ä» &lt;code&gt;RestTemplate&lt;/code&gt;è¿ç§»&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘åº”ç”¨ã€å“åº”å¼ç³»ç»Ÿã€å¾®æœåŠ¡æ¶æ„ã€æµå¼æ•°æ®å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å“ªä¸€ä¸ªï¼Œå–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œé¡¹ç›®ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;RestClient&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®åŸºäº &lt;strong&gt;Spring Boot 3.2 æˆ–æ›´é«˜ç‰ˆæœ¬&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è¿›è¡Œä¼ ç»Ÿçš„ã€&lt;strong&gt;åŒæ­¥é˜»å¡å¼&lt;/strong&gt;çš„ HTTP è°ƒç”¨ ã€‚&lt;/li&gt;
&lt;li&gt;å¸Œæœ›ä»£ç &lt;strong&gt;ç®€æ´æ˜“è¯»&lt;/strong&gt;ï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯• ã€‚&lt;/li&gt;
&lt;li&gt;ä»æ—§çš„ &lt;code&gt;RestTemplate&lt;/code&gt;è¿ç§»ï¼Œå¸Œæœ›æœ‰ä¸€ä¸ªæ›´ç°ä»£çš„åŒæ­¥å®¢æˆ·ç«¯ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;WebClient&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®éœ€è¦&lt;strong&gt;é«˜å¹¶å‘ã€é«˜æ€§èƒ½å’Œéé˜»å¡ I/O&lt;/strong&gt; å¤„ç† ã€‚&lt;/li&gt;
&lt;li&gt;æ•´ä¸ªåº”ç”¨æ ˆé‡‡ç”¨ &lt;strong&gt;å“åº”å¼ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt; (å¦‚ Spring WebFlux) ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤„ç†&lt;strong&gt;æµå¼æ•°æ®&lt;/strong&gt; (å¦‚ Server-Sent Events, å¤§æ•°æ®é‡ä¼ è¾“) ã€‚&lt;/li&gt;
&lt;li&gt;åº”ç”¨è¿è¡Œåœ¨ &lt;strong&gt;Spring 5&lt;/strong&gt; æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Š ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å…³äº-resttemplate"&gt;ğŸ—‚ï¸ å…³äº RestTemplate
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ä½ çš„é—®é¢˜ä¸»è¦é›†ä¸­åœ¨ &lt;code&gt;RestClient&lt;/code&gt;å’Œ &lt;code&gt;WebClient&lt;/code&gt;ï¼Œä½†äº†è§£ä¸€ä¸‹ &lt;code&gt;RestTemplate&lt;/code&gt;ä¹Ÿæœ‰åŠ©äºç†è§£æ¼”è¿›ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RestTemplate&lt;/code&gt;æ˜¯ Spring æ—©æœŸæä¾›çš„&lt;strong&gt;åŒæ­¥é˜»å¡å¼&lt;/strong&gt; HTTP å®¢æˆ·ç«¯ï¼Œé‡‡ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œæä¾›äº†å¤šç§ä¾¿æ·æ–¹æ³• ã€‚&lt;strong&gt;å®ƒåœ¨ Spring 5 ä¹‹åå·²ä¸å†æ¨èç§¯æä½¿ç”¨ï¼Œå¹¶åœ¨ Spring 6 ä¸­è¢«æ ‡è®°ä¸ºè¿‡æ—¶ (deprecated)&lt;/strong&gt;ã€‚&lt;code&gt;RestClient&lt;/code&gt;å¯ä»¥çœ‹ä½œæ˜¯ &lt;code&gt;RestTemplate&lt;/code&gt;çš„ç°ä»£åŒ–æ›¿ä»£å“ ã€‚&lt;/p&gt;
&lt;h3 id="-ç®€è¦æ€»ç»“"&gt;ğŸ’ ç®€è¦æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;RestClient&lt;/code&gt;æ˜¯ &lt;strong&gt;åŒæ­¥è¯·æ±‚çš„ç°ä»£é€‰æ‹©&lt;/strong&gt;ï¼Œæ—¨åœ¨æ›¿ä»£ &lt;code&gt;RestTemplate&lt;/code&gt;ï¼Œæä¾›æ›´æµç•…çš„ API å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒã€‚&lt;code&gt;WebClient&lt;/code&gt;åˆ™æ˜¯ &lt;strong&gt;å“åº”å¼å’Œå¼‚æ­¥ä¸–ç•Œçš„å¼ºå¤§å·¥å…·&lt;/strong&gt;ï¼Œä¸ºé«˜å¹¶å‘å’Œå®æ—¶åº”ç”¨è€Œç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ åšå‡ºæ¸…æ™°çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="æ— ç•Œé˜Ÿåˆ—"&gt;æ— ç•Œé˜Ÿåˆ—
&lt;/h2&gt;&lt;p&gt;ThreadPoolExecutor åœ¨ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ˆå¦‚ &lt;code&gt;LinkedBlockingQueue&lt;/code&gt;é»˜è®¤æ„é€ ï¼‰æ—¶ï¼Œå…¶ &lt;code&gt;maximumPoolSize&lt;/code&gt;å‚æ•°ç¡®å®ä¼šâ€œå¤±æ•ˆâ€ã€‚ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€å¼ å›¾ï¼Œç›´è§‚äº†è§£çº¿ç¨‹æ± çš„ä»»åŠ¡å¤„ç†æµç¨‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[æ–°ä»»åŠ¡æäº¤] --&amp;gt; B{æ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡?}
B -- å¦ --&amp;gt; C[åˆ›å»ºæ–°çš„æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œ]
B -- æ˜¯ --&amp;gt; D{ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡?}
D -- å¦ --&amp;gt; E[ä»»åŠ¡å…¥é˜Ÿç­‰å¾…]
D -- æ˜¯ --&amp;gt; F{çº¿ç¨‹æ•°å°äºmaximumPoolSize?}
F -- æ˜¯ --&amp;gt; G[åˆ›å»ºæ–°çº¿ç¨‹&amp;lt;éæ ¸å¿ƒ&amp;gt;æ‰§è¡Œ]
F -- å¦ --&amp;gt; H[æ‰§è¡Œæ‹’ç»ç­–ç•¥]
E --&amp;gt; I{é˜Ÿåˆ—æ˜¯æ— ç•Œçš„?}
I -- æ˜¯ --&amp;gt; J[âŒ é˜Ÿåˆ—æ°¸è¿œä¸ä¼šæ»¡&amp;lt;br&amp;gt;æµç¨‹ç»ˆæ­¢äºæ­¤]
I -- å¦ --&amp;gt; K[æµç¨‹ç»§ç»­]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ&lt;strong&gt;ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ï¼Œä»»åŠ¡å…¥é˜Ÿçš„ç¯èŠ‚ï¼ˆæ­¥éª¤2ï¼‰æ°¸è¿œä¸ä¼šå¤±è´¥&lt;/strong&gt;ï¼Œå› æ­¤æµç¨‹æ°¸è¿œä¸ä¼šèµ°åˆ°åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºæ–°éæ ¸å¿ƒçº¿ç¨‹ï¼ˆæ­¥éª¤3ï¼‰é‚£ä¸€æ­¥ã€‚&lt;/p&gt;
&lt;h3 id="-è¯¦è§£çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶"&gt;ğŸ” è¯¦è§£çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ThreadPoolExecutor&lt;/code&gt;å¤„ç†æ–°ä»»åŠ¡æ—¶ï¼Œéµå¾ªä¸€ä¸ªå›ºå®šçš„ä¼˜å…ˆçº§é¡ºåºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒçº¿ç¨‹ä¼˜å…ˆ&lt;/strong&gt;ï¼šå¦‚æœå½“å‰è¿è¡Œçº¿ç¨‹æ•°å°äº &lt;code&gt;corePoolSize&lt;/code&gt;ï¼Œå³ä½¿å…¶ä»–çº¿ç¨‹ç©ºé—²ï¼Œä¹Ÿä¼šç«‹å³&lt;strong&gt;åˆ›å»ºæ–°çº¿ç¨‹&lt;/strong&gt;æ¥æ‰§è¡Œæ–°ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¥é˜Ÿç­‰å¾…&lt;/strong&gt;ï¼šå¦‚æœå½“å‰è¿è¡Œçº¿ç¨‹æ•°å·²è¾¾åˆ°æˆ–è¶…è¿‡ &lt;code&gt;corePoolSize&lt;/code&gt;ï¼Œçº¿ç¨‹æ± ä¸ä¼šç«‹å³åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯å°è¯•å°†ä»»åŠ¡&lt;strong&gt;æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—&lt;/strong&gt;ï¼ˆ&lt;code&gt;workQueue&lt;/code&gt;ï¼‰ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹&lt;/strong&gt;ï¼š&lt;strong&gt;åªæœ‰å½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡&lt;/strong&gt;ï¼ˆå³æ— æ³•å…¥é˜Ÿï¼‰ï¼Œä¸”å½“å‰è¿è¡Œçº¿ç¨‹æ•°å°äº &lt;code&gt;maximumPoolSize&lt;/code&gt;æ—¶ï¼Œçº¿ç¨‹æ± æ‰ä¼š&lt;strong&gt;åˆ›å»ºæ–°çº¿ç¨‹&lt;/strong&gt;ï¼ˆéæ ¸å¿ƒçº¿ç¨‹ï¼‰æ¥æ‰§è¡Œæ–°ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‹’ç»ç­–ç•¥&lt;/strong&gt;ï¼šå¦‚æœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰è¿è¡Œçº¿ç¨‹æ•°å·²è¾¾åˆ° &lt;code&gt;maximumPoolSize&lt;/code&gt;ï¼Œé‚£ä¹ˆæ–°ä»»åŠ¡å°†è¢«&lt;strong&gt;æ‹’ç»&lt;/strong&gt;ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼ˆ&lt;code&gt;RejectedExecutionHandler&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ— ç•Œé˜Ÿåˆ—å¦‚ä½•å¯¼è‡´æœ€å¤§çº¿ç¨‹æ•°å¤±æ•ˆ"&gt;âš ï¸ æ— ç•Œé˜Ÿåˆ—å¦‚ä½•å¯¼è‡´æœ€å¤§çº¿ç¨‹æ•°å¤±æ•ˆ
&lt;/h3&gt;&lt;p&gt;æ— ç•Œé˜Ÿåˆ—ï¼ˆå¦‚é»˜è®¤æ„é€ çš„ &lt;code&gt;LinkedBlockingQueue&lt;/code&gt;ï¼‰çš„&lt;strong&gt;ç†è®ºå®¹é‡æ˜¯ &lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;&lt;/strong&gt;ï¼Œçº¦21äº¿ï¼Œåœ¨å®è·µä¸­å¯ä»¥è®¤ä¸ºæ˜¯â€œæ— é™â€çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä»»åŠ¡æäº¤é€Ÿåº¦æŒç»­é«˜äºå¤„ç†é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡ä¼š&lt;strong&gt;æ— é™åœ°å †ç§¯&lt;/strong&gt;åœ¨æ— ç•Œé˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºé˜Ÿåˆ—&lt;strong&gt;æ°¸è¿œä¹Ÿä¸ä¼šâ€œæ»¡â€&lt;/strong&gt;ï¼Œçº¿ç¨‹æ± å°±&lt;strong&gt;æ°¸è¿œæ²¡æœ‰æœºä¼š&lt;/strong&gt;èµ°åˆ°ä¸Šè¿°æµç¨‹çš„ç¬¬3æ­¥ï¼ˆåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å› æ­¤ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æœ€å¤šåªä¼šè¾¾åˆ° &lt;code&gt;corePoolSize&lt;/code&gt;ï¼Œ&lt;strong&gt;&lt;code&gt;maximumPoolSize&lt;/code&gt;è¿™ä¸ªå‚æ•°ä¹Ÿå°±å¤±å»äº†æ„ä¹‰&lt;/strong&gt;ï¼Œæ ¹æœ¬æ²¡æœ‰æœºä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ½œåœ¨é£é™©ä¸å½±å“"&gt;ğŸ”¥ æ½œåœ¨é£é™©ä¸å½±å“
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—å¹¶è®© &lt;code&gt;maximumPoolSize&lt;/code&gt;å¤±æ•ˆä¼šå¸¦æ¥æ˜¾è‘—é£é™©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜è€—å°½ï¼ˆOOMï¼‰&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€å±é™©çš„é—®é¢˜ã€‚å¦‚æœä»»åŠ¡ç”Ÿäº§é€Ÿåº¦æŒç»­è¿œå¤§äºæ¶ˆè´¹é€Ÿåº¦ï¼Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¯¹è±¡ä¼šæ— é™å †ç§¯ï¼Œæœ€ç»ˆè€—å°½ Java å †å†…å­˜ï¼Œå¯¼è‡´ &lt;code&gt;OutOfMemoryError: Java heap space&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å»¶è¿ŸåŠ å‰§&lt;/strong&gt;ï¼šä»»åŠ¡ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¾ˆé•¿æ—¶é—´æ‰èƒ½è¢«å¤„ç†ï¼Œå¯¼è‡´ç³»ç»Ÿå¹³å‡å“åº”æ—¶é—´é£™å‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç®¡ç†å¤±æ§&lt;/strong&gt;ï¼šæ— æ³•é€šè¿‡ &lt;code&gt;maximumPoolSize&lt;/code&gt;æ¥è®¾ç½®çº¿ç¨‹æ•°çš„ç¡¬ä¸Šé™ï¼Œå¤±å»äº†çº¿ç¨‹æ± æ§åˆ¶èµ„æºçš„ä¸€ä¸ªé‡è¦æ‰‹æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•æ­£ç¡®é…ç½®"&gt;ğŸ’¡ å¦‚ä½•æ­£ç¡®é…ç½®
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œé€šå¸¸çš„å»ºè®®æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;ArrayBlockingQueue(int capacity)&lt;/code&gt;æˆ– &lt;code&gt;LinkedBlockingQueue(int capacity)&lt;/code&gt;ï¼Œä¸ºé˜Ÿåˆ—è®¾ç½®ä¸€ä¸ªåˆç†çš„å®¹é‡ä¸Šé™ã€‚è¿™æ˜¯&lt;strong&gt;æœ€é‡è¦çš„åŸåˆ™&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®åˆç†çš„æ‹’ç»ç­–ç•¥&lt;/strong&gt;ï¼šå½“é˜Ÿåˆ—æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œé‡‡å–é€‚å½“çš„ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;CallerRunsPolicy&lt;/code&gt;è®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±è¿è¡Œï¼Œæˆ–è‡ªå®šä¹‰ç­–ç•¥è®°å½•æ—¥å¿—å¹¶ç¨åé‡è¯•ï¼‰ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„æŠ›å‡ºå¼‚å¸¸æˆ–ç›´æ¥ä¸¢å¼ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä¸æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®&lt;/strong&gt;ï¼šæ ¹æ®ä»»åŠ¡ç‰¹æ€§ï¼ˆCPUå¯†é›†å‹ã€IOå¯†é›†å‹ï¼‰è®¾ç½® &lt;code&gt;corePoolSize&lt;/code&gt;å’Œ &lt;code&gt;maximumPoolSize&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£å…¶ä¸­çš„åŸç†å’Œé£é™©ã€‚&lt;/p&gt;
&lt;h2 id="retrymax-attempts"&gt;Retry.max-attempts
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;spring.ai.retry.max-attempts: 1&lt;/code&gt;è¡¨ç¤º&lt;strong&gt;æ€»å…±åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸ä¼šè¿›è¡Œä»»ä½•é‡è¯•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£è¿™ä¸ªé…ç½®ä»¥åŠå…¶ä»–å¸¸è§è®¾ç½®çš„å«ä¹‰ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„è¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ç½®å€¼&lt;/th&gt;
&lt;th&gt;å®é™…é‡è¯•æ¬¡æ•°&lt;/th&gt;
&lt;th&gt;æ€»æ‰§è¡Œæ¬¡æ•°ï¼ˆå«é¦–æ¬¡ï¼‰&lt;/th&gt;
&lt;th&gt;å«ä¹‰è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: 1&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œä¸é‡è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: 2&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡å¤±è´¥åé‡è¯•1æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: 3&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡å¤±è´¥åé‡è¯•2æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;max-attempts: N&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;N-1&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;é¦–æ¬¡å¤±è´¥åé‡è¯•N-1æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ç†è§£-spring-retry-çš„æœºåˆ¶"&gt;ğŸ’¡ ç†è§£ Spring Retry çš„æœºåˆ¶
&lt;/h3&gt;&lt;p&gt;Spring Retry ä¸­çš„ &lt;code&gt;max-attempts&lt;/code&gt;å‚æ•°å®šä¹‰äº†åŒ…æ‹¬åˆå§‹è°ƒç”¨åœ¨å†…çš„&lt;strong&gt;æœ€å¤§å°è¯•æ¬¡æ•°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ &lt;code&gt;max-attempts&lt;/code&gt;è®¾ç½®ä¸º &lt;strong&gt;1&lt;/strong&gt; æ—¶ï¼Œæ„å‘³ç€æ–¹æ³•æœ€å¤šåªå°è¯•&lt;strong&gt;1æ¬¡&lt;/strong&gt;ã€‚å¦‚æœé¦–æ¬¡è°ƒç”¨å°±å¤±è´¥ï¼Œæ“ä½œä¼šç›´æ¥å¤±è´¥ï¼Œ&lt;strong&gt;ä¸ä¼šè§¦å‘ä»»ä½•é‡è¯•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥éœ€åœ¨å¤±è´¥åé‡è¯•ä¸€æ¬¡ï¼Œåˆ™éœ€å°† &lt;code&gt;max-attempts&lt;/code&gt;è®¾ç½®ä¸º &lt;strong&gt;2&lt;/strong&gt;ã€‚è¿™æ ·ï¼Œåˆå§‹è°ƒç”¨åŠ ä¸Šä¸€æ¬¡é‡è¯•ï¼Œæ€»å…±å°è¯•2æ¬¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;p&gt;åœ¨å†³å®šæ˜¯å¦ä»¥åŠå¦‚ä½•é‡è¯•æ—¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼šé‡è¯•æœºåˆ¶è¦æ±‚è¢«é‡è¯•çš„æ“ä½œæ˜¯&lt;strong&gt;å¹‚ç­‰&lt;/strong&gt;çš„ã€‚å³å¤šæ¬¡æ‰§è¡Œè¯¥æ“ä½œä¸æ‰§è¡Œä¸€æ¬¡äº§ç”Ÿçš„ç»“æœç›¸åŒã€‚åœ¨AIæ¥å£è°ƒç”¨ç­‰åœºæ™¯ä¸­ï¼Œéœ€ç‰¹åˆ«æ³¨æ„è¿™ä¸€ç‚¹ï¼Œä¾‹å¦‚é‡å¤æäº¤ç›¸åŒçš„æç¤ºè¯ï¼ˆPromptï¼‰ä¸€èˆ¬ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä½†æŸäº›ç‰¹å®šæ“ä½œå¯èƒ½éœ€è¦è°¨æ…è¯„ä¼°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®çš„ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼š&lt;code&gt;spring.ai.retry.max-attempts&lt;/code&gt;è¿™ä¸ªé…ç½®æ˜¯ç‰¹å®šäº &lt;strong&gt;Spring AI&lt;/strong&gt; æ¡†æ¶çš„ã€‚ä¸åŒçš„åº“æˆ–æ¡†æ¶ï¼ˆå¦‚ Spring Retryã€Resilience4jï¼‰å…¶é‡è¯•é…ç½®é¡¹çš„åç§°å’Œé»˜è®¤å€¼å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†â€œæœ€å¤§å°è¯•æ¬¡æ•°â€é€šå¸¸éƒ½åŒ…å«åˆå§‹è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ç»“è®º"&gt;ğŸ’ ç»“è®º
&lt;/h3&gt;&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœä½ çš„é…ç½®æ˜¯ &lt;code&gt;spring.ai.retry.max-attempts: 1&lt;/code&gt;ï¼Œé‚£ä¹ˆç›¸å…³æ“ä½œåªè¦å¤±è´¥å°±ä¼šç«‹åˆ»åœæ­¢ï¼Œä¸ä¼šè‡ªåŠ¨é‡è¯•ã€‚å¦‚æœéœ€è¦é‡è¯•ï¼Œè¯·æ ¹æ®ä¸Šè¡¨è°ƒæ•´è¿™ä¸ªå‚æ•°çš„å€¼ã€‚&lt;/p&gt;
&lt;h2 id="restcontrolleradvice"&gt;@RestControllerAdvice
&lt;/h2&gt;&lt;p&gt;@RestControllerAdvice æ˜¯ Spring Frameworkï¼ˆ3.2+ï¼‰å’Œ Spring Boot ä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„æ³¨è§£ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ é›†ä¸­å¤„ç† RESTful Web æœåŠ¡ä¸­çš„å¼‚å¸¸ã€æ•°æ®ç»‘å®šå’Œé¢„å¤„ç†é€»è¾‘ï¼Œè®©ä»£ç æ›´æ•´æ´ã€æ›´æ˜“äºç»´æŠ¤ã€‚ä¸‹é¢æˆ‘æ¥ä¸ºä½ è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶ä¸ç‰¹ç‚¹"&gt;ğŸ§  æ ¸å¿ƒæœºåˆ¶ä¸ç‰¹ç‚¹
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice æ˜¯ä¸€ä¸ª&lt;strong&gt;ç»„åˆæ³¨è§£&lt;/strong&gt;ï¼Œå®ƒèåˆäº† &lt;code&gt;@ControllerAdvice&lt;/code&gt;å’Œ &lt;code&gt;@ResponseBody&lt;/code&gt;çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ControllerAdvice&lt;/code&gt;å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªå…¨å±€çš„æ§åˆ¶å™¨å¢å¼ºç±»ï¼Œå¯ä»¥æ•è·æ‰€æœ‰æ§åˆ¶å™¨ï¼ˆ&lt;code&gt;@RestController&lt;/code&gt;ï¼‰æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶å…è®¸è¿›è¡Œå…¨å±€çš„æ•°æ®ç»‘å®šå’Œé¢„å¤„ç†æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ResponseBody&lt;/code&gt;ç¡®ä¿äº†è¯¥ç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„è¿”å›å€¼éƒ½ä¼š&lt;strong&gt;è‡ªåŠ¨è¢«åºåˆ—åŒ–ä¸º JSON æˆ– XML æ ¼å¼&lt;/strong&gt;ï¼Œå¹¶ç›´æ¥å†™å…¥ HTTP å“åº”ä½“ä¸­ï¼Œéå¸¸é€‚åˆæ„å»º RESTful APIã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒä¸ä¼ ç»Ÿ &lt;code&gt;@ControllerAdvice&lt;/code&gt;çš„ä¸€ä¸ªå…³é”®åŒºåˆ«åœ¨äºå“åº”æ ¼å¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;@ControllerAdvice&lt;/th&gt;
&lt;th&gt;@RestControllerAdvice&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å“åº”æ ¼å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯è¿”å›è§†å›¾åç§°æˆ– ModelAndView&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç›´æ¥è¿”å› JSON/XML&lt;/strong&gt; (å†…ç½® &lt;code&gt;@ResponseBody&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ ç»Ÿ MVC è§†å›¾æ¸²æŸ“&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;RESTful API&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›å€¼å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è§†å›¾è§£æå™¨æ¸²æŸ“&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨åºåˆ—åŒ–ä¸ºç»“æ„åŒ–æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä¸»è¦ç”¨é€”"&gt;âš™ï¸ ä¸»è¦ç”¨é€”
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice ä¸»è¦æœ‰ä¸‰å¤§ç”¨é€”ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹æ¥æ•è·å’Œå¤„ç†æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æŠ›å‡ºçš„å„ç§å¼‚å¸¸ï¼Œå¹¶è¿”å›ç»Ÿä¸€çš„ã€å‹å¥½çš„é”™è¯¯ä¿¡æ¯æ ¼å¼ç»™å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç»‘å®šä¸éªŒè¯å¤„ç†&lt;/strong&gt;ï¼šå¯ä»¥ç»Ÿä¸€å¤„ç†å‚æ•°æ ¡éªŒï¼ˆå¦‚ä½¿ç”¨ &lt;code&gt;@Valid&lt;/code&gt;æ³¨è§£ï¼‰å¤±è´¥æ—¶äº§ç”Ÿçš„é”™è¯¯ï¼Œé¿å…åœ¨æ¯ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸­é‡å¤ç¼–å†™æ ¡éªŒé€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æ•°æ®é¢„å¤„ç†&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@InitBinder&lt;/code&gt;æˆ– &lt;code&gt;@ModelAttribute&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼Œå¯ä»¥å¯¹æ‰€æœ‰æ§åˆ¶å™¨æ–¹æ³•çš„è¯·æ±‚å‚æ•°è¿›è¡Œå…¨å±€æ€§çš„å¤„ç†æˆ–ç»‘å®šä¸€äº›å…¬å…±æ•°æ®æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-åŸºæœ¬ä½¿ç”¨æ–¹æ³•"&gt;ğŸ› ï¸ åŸºæœ¬ä½¿ç”¨æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;é€šå¸¸éœ€è¦åˆ›å»ºä¸€ä¸ªç±»å¹¶åŠ ä¸Šè¯¥æ³¨è§£ï¼Œç„¶ååœ¨å…¶ä¸­å®šä¹‰ç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id="å…¨å±€å¼‚å¸¸å¤„ç†ç¤ºä¾‹"&gt;å…¨å±€å¼‚å¸¸å¤„ç†ç¤ºä¾‹
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice // è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå…¨å±€RESTå¼‚å¸¸å¤„ç†ç±»
public class GlobalExceptionHandler {
// å¤„ç†è‡ªå®šä¹‰çš„&amp;#34;èµ„æºæœªæ‰¾åˆ°&amp;#34;å¼‚å¸¸
@ExceptionHandler(ResourceNotFoundException.class)
public ResponseEntity&amp;lt;ErrorResponse&amp;gt; handleResourceNotFound(ResourceNotFoundException ex) {
// åˆ›å»ºè‡ªå®šä¹‰çš„é”™è¯¯å“åº”ä½“
ErrorResponse error = new ErrorResponse(&amp;#34;NOT_FOUND&amp;#34;, ex.getMessage());
// è¿”å›HTTPçŠ¶æ€ç ä¸º404çš„å“åº”
return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
}
// å¤„ç†å‚æ•°éæ³•å¼‚å¸¸
@ExceptionHandler(IllegalArgumentException.class)
public ResponseEntity&amp;lt;ErrorResponse&amp;gt; handleIllegalArgument(IllegalArgumentException ex) {
ErrorResponse error = new ErrorResponse(&amp;#34;BAD_REQUEST&amp;#34;, ex.getMessage());
return ResponseEntity.badRequest().body(error); // HTTP 400
}
// ä½œä¸ºä¸€ä¸ªå…œåº•æ–¹æ¡ˆï¼Œå¤„ç†æ‰€æœ‰å…¶ä»–æœªæ˜ç¡®æ•è·çš„å¼‚å¸¸
@ExceptionHandler(Exception.class)
public ResponseEntity&amp;lt;ErrorResponse&amp;gt; handleGenericException(Exception ex) {
ErrorResponse error = new ErrorResponse(&amp;#34;INTERNAL_SERVER_ERROR&amp;#34;, &amp;#34;æœåŠ¡å™¨å¼€å°å·®äº†ï¼Œè¯·ç¨åå†è¯•&amp;#34;);
return ResponseEntity.internalServerError().body(error); // HTTP 500
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä»£ç è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ExceptionHandler&lt;/code&gt;æ³¨è§£ç”¨äºæ ‡è®°å¤„ç†ç‰¹å®šå¼‚å¸¸çš„æ–¹æ³•ã€‚å½“æ§åˆ¶å™¨ä¸­æŠ›å‡ºç›¸åº”ç±»å‹çš„å¼‚å¸¸æ—¶ï¼ŒSpringä¼šè°ƒç”¨æ­¤æ–¹æ³•æ¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•çš„è¿”å›å€¼é€šå¸¸æ˜¯ä¸€ä¸ª &lt;code&gt;ResponseEntity&lt;/code&gt;å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è®¾ç½®HTTPçŠ¶æ€ç å’Œå“åº”ä½“ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„POJOå¯¹è±¡ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºJSONã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‰€æœ‰ç±»ä¼¼çš„å¼‚å¸¸éƒ½ä¼šä»¥ç»Ÿä¸€çš„JSONæ ¼å¼è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¤§å¤§æå‡äº†APIçš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…¨å±€æ•°æ®ç»‘å®šç¤ºä¾‹"&gt;å…¨å±€æ•°æ®ç»‘å®šç¤ºä¾‹
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice
public class GlobalDataAdvice {
// æ­¤æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰è¢«è°ƒç”¨ï¼Œå¹¶å‘æ¨¡å‹ä¸­æ·»åŠ ä¸€ä¸ªåä¸º&amp;#34;commonData&amp;#34;çš„å±æ€§
@ModelAttribute(&amp;#34;commonData&amp;#34;)
public Map&amp;lt;String, Object&amp;gt; addCommonData() {
Map&amp;lt;String, Object&amp;gt; data = new HashMap&amp;lt;&amp;gt;();
data.put(&amp;#34;appName&amp;#34;, &amp;#34;My Awesome App&amp;#34;);
data.put(&amp;#34;version&amp;#34;, &amp;#34;1.0.0&amp;#34;);
data.put(&amp;#34;company&amp;#34;, &amp;#34;Example Corp&amp;#34;);
return data;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä»£ç è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ModelAttribute&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•å¯ä»¥ç”¨äºå‘æ‰€æœ‰æ§åˆ¶å™¨çš„æ¨¡å‹ä¸­æ·»åŠ å…¬å…±æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·ï¼Œåœ¨æ¯ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡æ¨¡å‹è·å–åˆ°è¿™äº›å…¬å…±æ•°æ®ï¼Œæ— éœ€é‡å¤ç¼–å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ§åˆ¶ä½œç”¨èŒƒå›´"&gt;ğŸ“‹ æ§åˆ¶ä½œç”¨èŒƒå›´
&lt;/h3&gt;&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;æ³¨è§£çš„å‚æ•°æ¥ç²¾ç»†æ§åˆ¶å…¶ç”Ÿæ•ˆçš„æ§åˆ¶å™¨èŒƒå›´ï¼Œé¿å…â€œä¸€åˆ€åˆ‡â€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;basePackages&lt;/code&gt;ï¼šæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…åï¼Œåªæœ‰è¿™äº›åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ§åˆ¶å™¨æ‰ä¼šè¢«è¯¥ advice å¤„ç†ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice(basePackages = &amp;#34;com.example.api.controllers&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;assignableTypes&lt;/code&gt;ï¼šæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ§åˆ¶å™¨ç±»ï¼Œåªæœ‰è¿™äº›ç‰¹å®šçš„æ§åˆ¶å™¨æ‰ä¼šè¢«å¤„ç†ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestControllerAdvice(assignableTypes = {UserController.class, ProductController.class})
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„äº‹é¡¹"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒ…æ‰«æè·¯å¾„&lt;/strong&gt;ï¼šç¡®ä¿ä½ çš„ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;ç±»ä½äº Spring Boot åº”ç”¨ç¨‹åºçš„ç»„ä»¶æ‰«æè·¯å¾„ä¹‹ä¸‹ï¼Œå¦åˆ™ Spring æ— æ³•å‘ç°å¹¶æ³¨å†Œå®ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸åŒ¹é…ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“å¤šä¸ª &lt;code&gt;@ExceptionHandler&lt;/code&gt;æ–¹æ³•éƒ½èƒ½å¤„ç†åŒä¸€ä¸ªå¼‚å¸¸æ—¶ï¼Œ&lt;strong&gt;æœ€å…·ä½“ï¼ˆå¼‚å¸¸ç±»å±‚æ¬¡æœ€æ·±ï¼‰çš„å¤„ç†å™¨ä¼šä¼˜å…ˆæ‰§è¡Œ&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œå¤„ç† &lt;code&gt;IOException&lt;/code&gt;çš„æ–¹æ³•å’Œå¤„ç† &lt;code&gt;FileNotFoundException&lt;/code&gt;ï¼ˆå®ƒæ˜¯&lt;code&gt;IOException&lt;/code&gt;çš„å­ç±»ï¼‰çš„æ–¹æ³•åŒæ—¶å­˜åœ¨æ—¶ï¼Œå¯¹äº&lt;code&gt;FileNotFoundException&lt;/code&gt;ï¼Œä¼šä¼˜å…ˆåŒ¹é…åè€…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä¸ª @RestControllerAdvice ç±»&lt;/strong&gt;ï¼šä½ å¯ä»¥å®šä¹‰å¤šä¸ª &lt;code&gt;@RestControllerAdvice&lt;/code&gt;ç±»æ¥æŒ‰æ¨¡å—æˆ–åŠŸèƒ½åˆ†ç±»å¤„ç†å¼‚å¸¸ã€‚å¯ä»¥é€šè¿‡ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥æŒ‡å®šå®ƒä»¬çš„ä¼˜å…ˆçº§ï¼Œ order å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ä¼ ç»Ÿ MVC çš„åŒºåˆ«&lt;/strong&gt;ï¼šå¦‚æœä½ å¼€å‘çš„æ˜¯ä¼ ç»Ÿçš„ã€éœ€è¦è¿”å›è§†å›¾ï¼ˆå¦‚ JSP, Thymeleafï¼‰çš„ MVC åº”ç”¨ï¼Œå¹¶ä¸”å¼‚å¸¸å¤„ç†éœ€è¦è·³è½¬åˆ°ç‰¹å®šçš„é”™è¯¯é¡µé¢ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ &lt;code&gt;@ControllerAdvice&lt;/code&gt;è€Œä¸æ˜¯ &lt;code&gt;@RestControllerAdvice&lt;/code&gt;ï¼Œå› ä¸ºåè€…ä¼šç›´æ¥å°†è¿”å›å¯¹è±¡å†™å…¥å“åº”ä½“ï¼Œè€Œä¸ä¼šè¿›è¡Œè§†å›¾è§£æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-åº”ç”¨åœºæ™¯"&gt;ğŸ’¡ åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice éå¸¸é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šå¤„ç† &lt;code&gt;IllegalArgumentException&lt;/code&gt;ã€&lt;code&gt;NullPointerException&lt;/code&gt;ç­‰å¸¸è§å¼‚å¸¸ï¼Œè¿”å›æ ‡å‡†é”™è¯¯æ ¼å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•æ„Ÿä¿¡æ¯è¿‡æ»¤&lt;/strong&gt;ï¼šåœ¨å“åº”å‰å¯¹æ•°æ®è¿›è¡Œè„±æ•å¤„ç†ï¼ˆå¦‚éšè—ç”¨æˆ·å¯†ç ï¼‰ï¼Œè¿™é€šå¸¸éœ€è¦é…åˆ &lt;code&gt;ResponseBodyAdvice&lt;/code&gt;æ¥å£æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™æ ¡éªŒ&lt;/strong&gt;ï¼šæ‹¦æˆªæœªæˆæƒè¯·æ±‚ï¼Œè¿”å› 403 å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;API ç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥&lt;/strong&gt;ï¼šä¸ºæ‰€æœ‰å“åº”ä½“è‡ªåŠ¨æ·»åŠ å…¬å…±å­—æ®µï¼Œå¦‚æ¥å£ç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ“š æ€»ç»“
&lt;/h3&gt;&lt;p&gt;@RestControllerAdvice æ˜¯ Spring æ¡†æ¶ä¸º &lt;strong&gt;RESTful API&lt;/strong&gt; è®¾è®¡çš„å…¨å±€å¢å¼ºå·¥å…·ï¼Œé€šè¿‡&lt;strong&gt;é›†ä¸­å¤„ç†å¼‚å¸¸ã€æ•°æ®ç»‘å®šå’Œé¢„å¤„ç†&lt;/strong&gt;ï¼Œå®ƒèƒ½æœ‰æ•ˆåœ°ä½¿ä¸šåŠ¡é€»è¾‘ä¸æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚å¼‚å¸¸å¤„ç†ï¼‰è§£è€¦ï¼Œè®©ä»£ç æ›´åŠ ç®€æ´ã€å¯ç»´æŠ¤ï¼Œç‰¹åˆ«é€‚åˆå¾®æœåŠ¡æ¶æ„æˆ–å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå¸®åŠ©å¼€å‘è€…ç»Ÿä¸€æ¥å£å“åº”æ ¼å¼ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;åªéœ€å®šä¹‰ä¸€ä¸ªç±»å¹¶åŠ ä¸Š &lt;code&gt;@RestControllerAdvice&lt;/code&gt;æ³¨è§£ï¼Œå†é…åˆ &lt;code&gt;@ExceptionHandler&lt;/code&gt;ã€&lt;code&gt;@ModelAttribute&lt;/code&gt;ç­‰æ³¨è§£ï¼Œå°±èƒ½è½»æ¾å®ç°å…¨å±€å¤„ç†é€»è¾‘ã€‚&lt;/p&gt;
&lt;h2 id="å®¡è®¡"&gt;å®¡è®¡
&lt;/h2&gt;&lt;p&gt;Springæ¡†æ¶æä¾›äº†å¤šç§æ³¨è§£æ¥æ”¯æŒæ•°æ®å®¡è®¡åŠŸèƒ½ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§æµæ´¾ï¼š&lt;strong&gt;Spring Data JPAæä¾›çš„åŸºç¡€å®¡è®¡æ³¨è§£&lt;/strong&gt;å’Œ&lt;strong&gt;Hibernate Enversæä¾›çš„å†å²è¿½è¸ªä¸ç‰ˆæœ¬åŒ–å®¡è®¡æ³¨è§£&lt;/strong&gt;ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼å¸®ä½ å¿«é€Ÿäº†è§£å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«å’Œä¸»è¦æ³¨è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;Spring Data JPA åŸºç¡€å®¡è®¡&lt;/th&gt;
&lt;th&gt;Hibernate Envers å†å²å®¡è®¡ (å€ŸåŠ© &lt;code&gt;@Audited&lt;/code&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæ³¨è§£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@CreatedDate&lt;/code&gt;, &lt;code&gt;@LastModifiedDate&lt;/code&gt;, &lt;code&gt;@CreatedBy&lt;/code&gt;, &lt;code&gt;@LastModifiedBy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Audited&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨å¡«å……&lt;/strong&gt;å®ä½“çš„åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹äººç­‰åŸºç¡€å­—æ®µ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®°å½•å®ä½“æ‰€æœ‰å˜æ›´çš„å®Œæ•´å†å²&lt;/strong&gt;ï¼Œå¯è¿½æº¯ä»»ä½•æ—¶é—´ç‚¹çš„æ•°æ®çŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®¡è®¡ä¿¡æ¯å­˜å‚¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸å®ä½“æœ¬èº«å­˜å‚¨åœ¨&lt;strong&gt;åŒä¸€å¼ è¡¨&lt;/strong&gt;çš„é¢å¤–å­—æ®µé‡Œ&lt;/td&gt;
&lt;td&gt;åœ¨&lt;strong&gt;å•ç‹¬çš„å®¡è®¡è¡¨&lt;/strong&gt;ï¼ˆé€šå¸¸ä»¥ &lt;code&gt;_AUD&lt;/code&gt;ç»“å°¾ï¼‰ä¸­åˆ›å»ºå†å²è®°å½•ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®è¿½æº¯èƒ½åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…èƒ½çœ‹åˆ°&lt;strong&gt;å½“å‰çš„æœ€æ–°çŠ¶æ€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯æŸ¥è¯¢&lt;strong&gt;ä»»ä½•å†å²ä¿®è®¢ç‰ˆæœ¬&lt;/strong&gt;ï¼Œæ”¯æŒæŒ‰æ—¶é—´æˆ–ç‰ˆæœ¬å·å›æº¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…³é”®ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;spring-boot-starter-data-jpa&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;hibernate-envers&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•æ•°æ®æ¡ç›®çš„åˆ›å»ºå’Œæ›´æ–°ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;éœ€è¦æ»¡è¶³å¼ºåˆè§„æ€§è¦æ±‚ã€è¿½è¸ªæ•°æ®å®Œæ•´å˜æ›´å†å²ã€å®ç°æ•°æ®ç‰ˆæœ¬æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨è§£&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="-spring-data-jpa-åŸºç¡€å®¡è®¡"&gt;ğŸ“ Spring Data JPA åŸºç¡€å®¡è®¡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨å®¡è®¡&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡è®°å®ä½“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å®ä½“ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨éœ€è¦çš„å­—æ®µä¸Šæ·»åŠ å®¡è®¡æ³¨è§£ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@CreatedDate
@Column(name = &amp;#34;create_time&amp;#34;, updatable = false)
private LocalDateTime createTime;
@LastModifiedDate
@Column(name = &amp;#34;update_time&amp;#34;)
private LocalDateTime updateTime;
@CreatedBy
@Column(name = &amp;#34;creator&amp;#34;, updatable = false)
private String creator;
@LastModifiedBy
@Column(name = &amp;#34;modifier&amp;#34;)
private String modifier;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æä¾›å®¡è®¡è€…ä¿¡æ¯&lt;/strong&gt;ï¼ˆå¦‚æœä½¿ç”¨äº† &lt;code&gt;@CreatedBy&lt;/code&gt;æˆ– &lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼‰ï¼šå®ç° &lt;code&gt;AuditorAware&lt;/code&gt;æ¥å£å¹¶å°†å…¶æ³¨å…¥å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œç»“åˆ Spring Security è·å–å½“å‰ç”¨æˆ·åï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class SpringSecurityAuditorAware implements AuditorAware&amp;lt;String&amp;gt; {
@Override
public Optional&amp;lt;String&amp;gt; getCurrentAuditor() {
// ä»å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è·å–å½“å‰è®¤è¯çš„ç”¨æˆ·å
Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
if (authentication == null || !authentication.isAuthenticated()) {
return Optional.empty();
}
return Optional.ofNullable(authentication.getName());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-hibernate-envers-å†å²å®¡è®¡"&gt;ğŸ” Hibernate Envers å†å²å®¡è®¡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ  Envers ä¾èµ–ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.hibernate&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;hibernate-envers&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡è®°éœ€è¦å†å²å®¡è®¡çš„å®ä½“&lt;/strong&gt;ï¼šåœ¨å®ä½“ç±»ä¸Šæ·»åŠ  &lt;code&gt;@Audited&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Entity
@Audited // å¢åŠ æ­¤æ³¨è§£
public class YourEntity {
// ... å­—æ®µå®šä¹‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢å®¡è®¡å†å²&lt;/strong&gt;ï¼šé€šè¿‡ç»§æ‰¿ &lt;code&gt;RevisionRepository&lt;/code&gt;çš„æ¥å£è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface YourEntityAuditRepository extends RevisionRepository&amp;lt;YourEntity, Long, Integer&amp;gt; {
List&amp;lt;Revision&amp;lt;Integer, YourEntity&amp;gt;&amp;gt; findRevisionsById(Long id);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å®ç”¨å»ºè®®"&gt;ğŸ’¡ å®ç”¨å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºç¡€å®¡è®¡&lt;/strong&gt;é€‚ç”¨äºå¤§å¤šæ•°éœ€è¦ç®€å•è®°å½•åˆ›å»º/æ›´æ–°ä¿¡æ¯çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†å²å®¡è®¡&lt;/strong&gt; (&lt;code&gt;@Audited&lt;/code&gt;) åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†ä¼šç”Ÿæˆé¢å¤–çš„å®¡è®¡è¡¨ï¼Œé€‚åˆå¯¹æ•°æ®å˜æ›´è¿½è¸ªæœ‰ä¸¥æ ¼è¦æ±‚ï¼ˆå¦‚åˆè§„æ€§è¦æ±‚é«˜ï¼‰çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@CreatedBy&lt;/code&gt;å’Œ &lt;code&gt;@LastModifiedBy&lt;/code&gt;æ—¶ï¼Œç¡®ä¿æ­£ç¡®å®ç° &lt;code&gt;AuditorAware&lt;/code&gt;æ¥å£ä»¥æä¾›å½“å‰çš„å®¡è®¡è€…ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å®¡è®¡åŠŸèƒ½å¯¹äº&lt;strong&gt;é—®é¢˜æ’æŸ¥&lt;/strong&gt;ã€&lt;strong&gt;å®‰å…¨åˆ†æ&lt;/strong&gt;å’Œ&lt;strong&gt;æ»¡è¶³åˆè§„æ€§è¦æ±‚&lt;/strong&gt;éå¸¸æœ‰å¸®åŠ©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°åœ¨Springé¡¹ç›®ä¸­åº”ç”¨å®¡è®¡åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id="entitylistener"&gt;@EntityListener
&lt;/h2&gt;&lt;p&gt;@EntityListeners æ˜¯ JPAï¼ˆJava Persistence APIï¼‰ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼Œä¸»è¦ç”¨äº&lt;strong&gt;ç›‘å¬å®ä½“ç±»çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶&lt;/strong&gt;ï¼ˆå¦‚åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€åŠ è½½ç­‰ï¼‰ï¼Œå¹¶åœ¨è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶&lt;strong&gt;è‡ªåŠ¨æ‰§è¡ŒæŒ‡å®šçš„å›è°ƒé€»è¾‘&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿäº†è§£å®ƒæ”¯æŒç›‘å¬å“ªäº›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PrePersist&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢« &lt;code&gt;EntityManager&lt;/code&gt;çš„ &lt;code&gt;persist()&lt;/code&gt;æ–¹æ³•æŒä¹…åŒ–ï¼ˆæ–°å¢ï¼‰&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostPersist&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«æŒä¹…åŒ–ï¼ˆæ–°å¢ï¼‰&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PreUpdate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«æ›´æ–°ï¼ˆUPDATEæ“ä½œï¼‰&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostUpdate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«æ›´æ–°&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PreRemove&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢« &lt;code&gt;EntityManager&lt;/code&gt;çš„ &lt;code&gt;remove()&lt;/code&gt;æ–¹æ³•åˆ é™¤&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostRemove&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“è¢«åˆ é™¤&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@PostLoad&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å®ä½“ä»æ•°æ®åº“è¢«åŠ è½½ï¼ˆSELECTæ“ä½œï¼‰æˆ–åˆ·æ–°ï¼ˆrefreshï¼‰&lt;strong&gt;ä¹‹å&lt;/strong&gt;è°ƒç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•ä½¿ç”¨-entitylisteners"&gt;ğŸ”§ å¦‚ä½•ä½¿ç”¨ @EntityListeners
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ç›‘å¬å™¨ç±»&lt;/strong&gt;ï¼šåˆ›å»ºä¸€ä¸ªç±»ï¼Œåœ¨å…¶ä¸­å®šä¹‰æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ä¸Šè¡¨ä¸­çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ³¨è§£æ¥æŒ‡å®šè¿™äº›æ–¹æ³•åœ¨ä½•æ—¶è§¦å‘ã€‚è¿™äº›æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»ä¸º &lt;code&gt;void&lt;/code&gt;ï¼Œå¹¶ä¸”æ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆå‚æ•°ç±»å‹ä¸ºæ‰€è¦ç›‘å¬çš„å®ä½“ç±»å‹ï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class MyEntityListener {
@PrePersist
public void beforeSave(MyEntity entity) {
System.out.println(&amp;#34;å³å°†ä¿å­˜å®ä½“: &amp;#34; + entity.getId());
// å¯ä»¥åœ¨æ­¤å¤„è®¾ç½®åˆ›å»ºæ—¶é—´ã€åˆå§‹åŒ–çŠ¶æ€ç­‰
}
@PostUpdate
public void afterUpdate(MyEntity entity) {
System.out.println(&amp;#34;å®ä½“å·²æ›´æ–°: &amp;#34; + entity.getId());
// å¯ä»¥è®°å½•æ›´æ–°æ—¥å¿—ã€å‘é€é€šçŸ¥ç­‰
}
// å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å°†ç›‘å¬å™¨å…³è”åˆ°å®ä½“&lt;/strong&gt;ï¼šåœ¨éœ€è¦è¢«ç›‘å¬çš„å®ä½“ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@EntityListeners&lt;/code&gt;æ³¨è§£ï¼Œå¹¶æŒ‡å®šç›‘å¬å™¨ç±»ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Entity
@EntityListeners(MyEntityListener.class) // å¯ä»¥æŒ‡å®šå¤šä¸ªç›‘å¬å™¨ï¼Œå¦‚ {Listener1.class, Listener2.class}
public class MyEntity {
@Id
@GeneratedValue
private Long id;
// ... å…¶ä»–å­—æ®µå’Œæ–¹æ³•
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;(å¯é€‰) å¯ç”¨å®¡è®¡åŠŸèƒ½&lt;/strong&gt;ï¼šå¦‚æœä½ ä½¿ç”¨ Spring Data JPA çš„å®¡è®¡åŠŸèƒ½ï¼ˆå¦‚è‡ªåŠ¨å¡«å…… &lt;code&gt;@CreatedDate&lt;/code&gt;ã€&lt;code&gt;@LastModifiedDate&lt;/code&gt;ã€&lt;code&gt;@CreatedBy&lt;/code&gt;ã€&lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼‰ï¼Œé™¤äº†éœ€è¦ &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt;ï¼Œè¿˜éœ€åœ¨é…ç½®ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ¥å¯ç”¨å®¡è®¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å®ç”¨ç¤ºä¾‹è‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—"&gt;ğŸ’¡ å®ç”¨ç¤ºä¾‹ï¼šè‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·ä¿¡æ¯ï¼ˆUserEntityï¼‰è¢«æ›´æ–°åè‡ªåŠ¨è®°å½•ä¸€æ¡å®¡è®¡æ—¥å¿—ï¼Œå¯ä»¥è¿™æ ·åšï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æ—¥å¿—ç›‘å¬å™¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class UserAuditListener {
private static final Logger log = LoggerFactory.getLogger(UserAuditListener.class);
@PostUpdate
public void auditUserUpdate(UserEntity user) {
log.info(&amp;#34;ç”¨æˆ· {} çš„ä¿¡æ¯äº {} è¢«ä¿®æ”¹&amp;#34;, user.getId(), LocalDateTime.now());
// å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œå¯ä»¥å°†æ—¥å¿—å†™å…¥æ•°æ®åº“çš„å®¡è®¡è¡¨ï¼Œæˆ–å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ç­‰
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ç”¨æˆ·å®ä½“ä¸Šå…³è”ç›‘å¬å™¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Entity
@EntityListeners({AuditingEntityListener.class, UserAuditListener.class}) // å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç›‘å¬å™¨
@Table(name = &amp;#34;user&amp;#34;)
public class UserEntity {
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
private String username;
// ... å…¶ä»–å­—æ®µã€getterå’Œsetter
// å‡è®¾è¿™é‡Œè¿˜æœ‰ @CreatedDate, @LastModifiedDate ç­‰å®¡è®¡å­—æ®µ
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·ï¼Œæ¯å½“ä¸€ä¸ª &lt;code&gt;UserEntity&lt;/code&gt;å®ä¾‹è¢«æ›´æ–°åï¼Œ&lt;code&gt;auditUserUpdate&lt;/code&gt;æ–¹æ³•å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œè®°å½•ä¸‹å®¡è®¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä½¿ç”¨æ³¨æ„"&gt;âš ï¸ ä½¿ç”¨æ³¨æ„
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬å™¨æ–¹æ³•çš„å‚æ•°&lt;/strong&gt;ï¼šç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ­¤å‚æ•°ä»£è¡¨&lt;strong&gt;æ­£åœ¨ç»å†è¯¥ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„å®ä½“å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼šè¿™äº›å›è°ƒæ–¹æ³•é€šå¸¸åœ¨&lt;strong&gt;ä¸å®ä½“æ“ä½œç›¸åŒçš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å½±å“&lt;/strong&gt;ï¼šå¦‚æœåœ¨ &lt;code&gt;@PrePersist&lt;/code&gt;, &lt;code&gt;@PreUpdate&lt;/code&gt;, &lt;code&gt;@PreRemove&lt;/code&gt;ç­‰æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½ä¼š&lt;strong&gt;é˜»æ­¢åç»­æ•°æ®åº“æ“ä½œçš„å‘ç”Ÿ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@EntityListeners&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="enablejpaauditing"&gt;@EnableJpaAuditing
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ³¨è§£æ˜¯ Spring Data JPA å®¡è®¡åŠŸèƒ½çš„&lt;strong&gt;æ€»å¼€å…³&lt;/strong&gt;ğŸ”Œã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯&lt;strong&gt;æ¿€æ´»ä¸€å¥—è‡ªåŠ¨å¡«å……å®ä½“å®¡è®¡å­—æ®µçš„æœºåˆ¶&lt;/strong&gt;ï¼Œè®©ä½ æ— éœ€åœ¨æ¯æ¬¡ä¿å­˜æˆ–æ›´æ–°æ•°æ®æ—¶æ‰‹åŠ¨è®¾ç½®è¯¸å¦‚åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹äººè¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿäº†è§£å®ƒçš„ä¸»è¦åŠŸèƒ½ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åŠŸèƒ½ç»´åº¦&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¿€æ´»å®¡è®¡ç›‘å¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯ç”¨ &lt;code&gt;AuditingEntityListener&lt;/code&gt;ï¼Œä½¿å…¶èƒ½å¤Ÿç›‘å¬å®ä½“ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¦‚ &lt;code&gt;@PrePersist&lt;/code&gt;, &lt;code&gt;@PreUpdate&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨å¡«å…… &lt;code&gt;@CreatedDate&lt;/code&gt;, &lt;code&gt;@LastModifiedDate&lt;/code&gt;ç­‰å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æä¾›å®¡è®¡è€…ä¿¡æ¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;auditorAwareRef&lt;/code&gt;å‚æ•°æŒ‡å®šä¸€ä¸ª &lt;code&gt;AuditorAware&lt;/code&gt;Beanï¼Œä¸º &lt;code&gt;@CreatedBy&lt;/code&gt;å’Œ &lt;code&gt;@LastModifiedBy&lt;/code&gt;æä¾›å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/td&gt;
&lt;td&gt;è®°å½•æ•°æ®æ˜¯ç”±å“ªä¸ªç”¨æˆ·åˆ›å»ºæˆ–ä¿®æ”¹çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰æ—¶é—´æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;dateTimeProviderRef&lt;/code&gt;å‚æ•°æŒ‡å®šä¸€ä¸ª &lt;code&gt;DateTimeProvider&lt;/code&gt;Beanï¼Œè‡ªå®šä¹‰å®¡è®¡æ—¶é—´çš„è·å–æ–¹å¼ï¼ˆå¦‚ç»Ÿä¸€æ—¶åŒºï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;ç¡®ä¿æ‰€æœ‰å®¡è®¡æ—¶é—´éƒ½ä½¿ç”¨ç»Ÿä¸€çš„æ—¶åŒºï¼ˆå¦‚ UTCï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶æ—¥æœŸè®¾ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;setDates&lt;/code&gt;å‚æ•°æ§åˆ¶æ˜¯å¦è‡ªåŠ¨è®¾ç½®æ—¥æœŸå­—æ®µï¼ˆé»˜è®¤ä¸º &lt;code&gt;true&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;æµ‹è¯•æ—¶å¯èƒ½éœ€è¦ä¸´æ—¶å…³é—­æ—¥æœŸè‡ªåŠ¨è®¾ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å…³äºå®ƒå¦‚ä½•å·¥ä½œä»¥åŠå¦‚ä½•é…ç½®çš„è¯¦ç»†è¯´æ˜ã€‚&lt;/p&gt;
&lt;h3 id="-1-æ ¸å¿ƒä½œç”¨ä¸å·¥ä½œåŸç†"&gt;ğŸ“Š 1. æ ¸å¿ƒä½œç”¨ä¸å·¥ä½œåŸç†
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ä¸»è¦ç”¨æ¥&lt;strong&gt;æ¿€æ´» Spring Data JPA çš„å®¡è®¡åŠŸèƒ½&lt;/strong&gt;ã€‚ä¸€æ—¦å¯ç”¨ï¼Œå½“å®ä½“å¯¹è±¡è¢«æŒä¹…åŒ–ï¼ˆæ–°å¢ï¼‰æˆ–æ›´æ–°æ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨å¡«å……æ ‡è®°äº†ç‰¹å®šå®¡è®¡æ³¨è§£çš„å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®æœºåˆ¶ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨å¡«å……å­—æ®µ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@CreatedDate&lt;/code&gt;, &lt;code&gt;@LastModifiedDate&lt;/code&gt;, &lt;code&gt;@CreatedBy&lt;/code&gt;, &lt;code&gt;@LastModifiedBy&lt;/code&gt;ç­‰æ³¨è§£æ ‡è®°çš„å­—æ®µï¼Œå…¶å€¼ä¼šåœ¨æ•°æ®åˆ›å»ºæˆ–æ›´æ–°æ—¶ç”±æ¡†æ¶è‡ªåŠ¨å¡«å……ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬å®ä½“ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼šæ­¤åŠŸèƒ½ä¾èµ–äº &lt;code&gt;AuditingEntityListener&lt;/code&gt;æ¥ç›‘å¬å®ä½“çš„æŒä¹…åŒ–ï¼ˆ&lt;code&gt;@PrePersist&lt;/code&gt;ï¼‰å’Œæ›´æ–°ï¼ˆ&lt;code&gt;@PreUpdate&lt;/code&gt;ï¼‰ç­‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-2-é…ç½®è¯´æ˜"&gt;âš™ï¸ 2. é…ç½®è¯´æ˜
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;é€šå¸¸æ”¾ç½®åœ¨ Spring Boot çš„ä¸»é…ç½®ç±»ä¸Šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableJpaAuditing // å¯ç”¨JPAå®¡è®¡åŠŸèƒ½
public class DemoApplication {
public static void main(String[] args) {
SpringApplication.run(DemoApplication.class, args);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-3-è®°å½•æ“ä½œç”¨æˆ·createdby-lastmodifiedby"&gt;ğŸ‘¤ 3. è®°å½•æ“ä½œç”¨æˆ·ï¼ˆ&lt;code&gt;@CreatedBy&lt;/code&gt;/ &lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥è¦è‡ªåŠ¨è®°å½•æ•°æ®çš„åˆ›å»ºè€…å’Œæœ€åä¿®æ”¹è€…ï¼Œä½ éœ€è¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç° &lt;code&gt;AuditorAware&lt;/code&gt;æ¥å£&lt;/strong&gt;ï¼šæ­¤æ¥å£ç”¨äºè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class SpringSecurityAuditorAware implements AuditorAware&amp;lt;String&amp;gt; {
@Override
public Optional&amp;lt;String&amp;gt; getCurrentAuditor() {
// ä»å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è·å–å½“å‰è®¤è¯çš„ç”¨æˆ·å
Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
if (authentication == null || !authentication.isAuthenticated()) {
return Optional.empty();
}
return Optional.ofNullable(authentication.getName());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ä¸­å¼•ç”¨&lt;/strong&gt;ï¼ˆå¦‚æœéœ€è¦æ˜ç¡®æŒ‡å®š Beanï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableJpaAuditing(auditorAwareRef = &amp;#34;springSecurityAuditorAware&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-4-è‡ªå®šä¹‰æ—¥æœŸä¸æ—¶é—´æä¾›è€…"&gt;ğŸ• 4. è‡ªå®šä¹‰æ—¥æœŸä¸æ—¶é—´æä¾›è€…
&lt;/h3&gt;&lt;p&gt;ä½ å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;DateTimeProvider&lt;/code&gt;æ¥å£æ¥è‡ªå®šä¹‰å®¡è®¡æ—¶é—´çš„æ¥æºï¼Œä¾‹å¦‚ç»Ÿä¸€ä½¿ç”¨ UTC æ—¶é—´æˆ–ç‰¹å®šæ—¶åŒºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class CustomDateTimeProvider implements DateTimeProvider {
@Override
public Optional&amp;lt;TemporalAccessor&amp;gt; getNow() {
// è¿”å›å½“å‰UTCæ—¶é—´
return Optional.of(Instant.now());
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¹¶åœ¨é…ç½®ä¸­æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableJpaAuditing(dateTimeProviderRef = &amp;#34;customDateTimeProvider&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-5-æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜"&gt;ğŸ’¡ 5. æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åŸºç±»ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@MappedSuperclass&lt;/code&gt;åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å®¡è®¡å­—æ®µçš„åŸºç±»ï¼Œè®©å…¶ä»–å®ä½“ç±»ç»§æ‰¿ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ¯ä¸ªå®ä½“ä¸­é‡å¤å®šä¹‰è¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class AuditableEntity {
@CreatedDate
@Column(name = &amp;#34;created_date&amp;#34;, updatable = false)
private LocalDateTime createdDate;
@LastModifiedDate
@Column(name = &amp;#34;last_modified_date&amp;#34;)
private LocalDateTime lastModifiedDate;
// ... å…¶ä»–å®¡è®¡å­—æ®µï¼ˆå¦‚@CreatedBy, @LastModifiedByï¼‰åŠå…¶getter/setter
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¶é—´å­—æ®µç±»å‹&lt;/strong&gt;ï¼šå®¡è®¡æ—¶é—´å­—æ®µæ”¯æŒå¤šç§ç±»å‹ï¼Œå¦‚ &lt;code&gt;Date&lt;/code&gt;ã€&lt;code&gt;Calendar&lt;/code&gt;ã€&lt;code&gt;Long&lt;/code&gt;ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œä»¥åŠ Java 8 çš„ &lt;code&gt;LocalDateTime&lt;/code&gt;ã€&lt;code&gt;Instant&lt;/code&gt;ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸¸è§é—®é¢˜æ’æŸ¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¡è®¡å­—æ®µæœªè‡ªåŠ¨å¡«å……&lt;/strong&gt;ï¼šé¦–å…ˆæ£€æŸ¥æ˜¯å¦æ·»åŠ äº† &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ³¨è§£ï¼Œå®ä½“ç±»æ˜¯å¦ä½¿ç”¨äº† &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt;ï¼Œä»¥åŠå­—æ®µä¸Šçš„å®¡è®¡æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@CreatedDate&lt;/code&gt;ï¼‰æ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶åŒºé—®é¢˜&lt;/strong&gt;ï¼šå¦‚æœé‡åˆ°æ—¶é—´æ—¶åŒºä¸ä¸€è‡´ï¼Œå¯ä»¥è€ƒè™‘å®ç°è‡ªå®šä¹‰çš„ &lt;code&gt;DateTimeProvider&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ“Œ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@EnableJpaAuditing&lt;/code&gt;æ³¨è§£æ˜¯ Spring Data JPA å®¡è®¡åŠŸèƒ½çš„&lt;strong&gt;æ ¸å¿ƒé…ç½®&lt;/strong&gt;ã€‚å®ƒé€šè¿‡&lt;strong&gt;è‡ªåŠ¨å¡«å……&lt;/strong&gt;å®¡è®¡å­—æ®µï¼Œå¤§å¤§ç®€åŒ–äº†å¯¹æ•°æ®åˆ›å»ºå’Œä¿®æ”¹ä¿¡æ¯çš„è·Ÿè¸ªï¼Œæå‡äº†å¼€å‘æ•ˆç‡ï¼Œå¹¶å¢å¼ºäº†æ•°æ®çš„å¯è¿½æº¯æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@EnableJpaAuditing&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="transational"&gt;@Transational
&lt;/h2&gt;&lt;p&gt;Spring Boot ä¸­å¤„ç†æ•°æ®åº“äº‹åŠ¡ï¼Œä¸»è¦ç”¨çš„æ˜¯ &lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt; è¿™ä¸ªæ³¨è§£ã€‚å®ƒé€šå¸¸æ ‡æ³¨åœ¨&lt;strong&gt;æœåŠ¡å±‚ï¼ˆServiceï¼‰&lt;/strong&gt; çš„ç±»æˆ–æ–¹æ³•ä¸Šï¼Œç”¨æ¥å°†ä¸€ç³»åˆ—æ•°æ®åº“æ“ä½œç»‘æˆä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼å¸®ä½ å¿«é€Ÿäº†è§£è¿™äº›æ³¨è§£å’Œå±æ€§ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£/å±æ€§&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨å€¼/ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒäº‹åŠ¡æ³¨è§£&lt;/strong&gt;ï¼Œå¯åº”ç”¨äºç±»æˆ–æ–¹æ³•ä¸Šã€‚æ ‡æ³¨åœ¨ç±»ä¸Šæ—¶ï¼Œè¯¥ç±»æ‰€æœ‰&lt;strong&gt;public&lt;/strong&gt;æ–¹æ³•éƒ½ä¼šå¼€å¯äº‹åŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Transactional&lt;/code&gt; &lt;code&gt;@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;propagation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡ä¼ æ’­è¡Œä¸º&lt;/strong&gt;ï¼Œå®šä¹‰æ–¹æ³•å¦‚ä½•å‚ä¸æˆ–åˆ›å»ºäº‹åŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Propagation.REQUIRED&lt;/code&gt;(é»˜è®¤) &lt;code&gt;Propagation.REQUIRES_NEW&lt;/code&gt; &lt;code&gt;Propagation.NESTED&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isolation&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/strong&gt;ï¼Œæ§åˆ¶äº‹åŠ¡é—´çš„å¯è§æ€§ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Isolation.DEFAULT&lt;/code&gt;(é»˜è®¤) &lt;code&gt;Isolation.READ_COMMITTED&lt;/code&gt; &lt;code&gt;Isolation.REPEATABLE_READ&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;timeout&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡è¶…æ—¶æ—¶é—´&lt;/strong&gt;ï¼ˆç§’ï¼‰ï¼Œè¶…è¿‡è¯¥æ—¶é—´äº‹åŠ¡æœªå®Œæˆåˆ™è‡ªåŠ¨å›æ»šã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;timeout = 5&lt;/code&gt;(5ç§’)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;readOnly&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šäº‹åŠ¡æ˜¯å¦ä¸º&lt;strong&gt;åªè¯»&lt;/strong&gt;ã€‚ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;readOnly = true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;rollbackFor&lt;/code&gt; &lt;code&gt;noRollbackFor&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šå“ªäº›&lt;strong&gt;å¼‚å¸¸è§¦å‘å›æ»š&lt;/strong&gt;æˆ–&lt;strong&gt;ä¸è§¦å‘å›æ»š&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;rollbackFor = Exception.class&lt;/code&gt; &lt;code&gt;noRollbackFor = RuntimeException.class&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@EnableTransactionManagement&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ç”¨æ³¨è§£å¼äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼Œé€šå¸¸æ”¾åœ¨ä¸»é…ç½®ç±»æˆ–å¯åŠ¨ç±»ä¸Šã€‚&lt;strong&gt;Spring Boot é»˜è®¤å·²å¯ç”¨&lt;/strong&gt;ï¼Œé€šå¸¸å¯çœç•¥ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@SpringBootApplication&lt;/code&gt; &lt;code&gt;@EnableTransactionManagement&lt;/code&gt; (æ˜¾å¼æ·»åŠ )&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§  &lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;å…³é”®å±æ€§è¯¦è§£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Transactional&lt;/code&gt;çš„å¼ºå¤§åœ¨äºå…¶ä¸°å¯Œçš„å±æ€§é…ç½®ï¼Œè®©ä½ èƒ½ç²¾ç»†æ§åˆ¶äº‹åŠ¡è¡Œä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;propagation (ä¼ æ’­è¡Œä¸º)&lt;/strong&gt;ï¼šå½“å¤šä¸ªäº‹åŠ¡æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶ï¼Œæ­¤å±æ€§å†³å®šäº†äº‹åŠ¡å¦‚ä½•ä¼ æ’­ã€‚è¿™æ˜¯å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶æœ€å…³é”®çš„æ¦‚å¿µä¹‹ä¸€ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;REQUIRED&lt;/strong&gt; (é»˜è®¤)ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;REQUIRES_NEW&lt;/strong&gt;ï¼šæ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å°†å…¶æŒ‚èµ·ã€‚è¿™æ„å‘³ç€æ–°äº‹åŠ¡ä¸åŸæœ‰äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NESTED&lt;/strong&gt;ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚åµŒå¥—äº‹åŠ¡æ˜¯å¤–éƒ¨äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæäº¤æˆ–å›æ»šä¸å¤–éƒ¨äº‹åŠ¡æœ‰å…³è”ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–å€¼å¦‚ &lt;code&gt;SUPPORTS&lt;/code&gt;, &lt;code&gt;MANDATORY&lt;/code&gt;, &lt;code&gt;NOT_SUPPORTED&lt;/code&gt;, &lt;code&gt;NEVER&lt;/code&gt;åˆ™ç”¨äºæ›´ç‰¹å®šçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rollbackFor / noRollbackFor (å›æ»šè§„åˆ™)&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;@Transactional&lt;/code&gt;åªåœ¨é‡åˆ°&lt;strong&gt;è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰&lt;/strong&gt; å’Œ &lt;strong&gt;Error&lt;/strong&gt; æ—¶å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦åœ¨é‡åˆ°&lt;strong&gt;å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼Œå¦‚ Exception, IOException, SQLExceptionï¼‰&lt;/strong&gt; æ—¶ä¹Ÿå›æ»šäº‹åŠ¡ï¼Œå¿…é¡»ä½¿ç”¨ &lt;code&gt;rollbackFor&lt;/code&gt;å±æ€§æ˜ç¡®æŒ‡å®šï¼Œä¾‹å¦‚ &lt;code&gt;@Transactional(rollbackFor = Exception.class)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;âš¡ &lt;strong&gt;ä½¿ç”¨æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿æ³¨è§£ç”Ÿæ•ˆ&lt;/strong&gt;ï¼š&lt;code&gt;@Transactional&lt;/code&gt;é€šå¸¸åŸºäº Spring AOP ä»£ç†å®ç°ã€‚éœ€æ³¨æ„ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•å¿…é¡»æ˜¯ public&lt;/strong&gt;ï¼šé public æ–¹æ³•ä¸Šçš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ä¼šè¢«å¿½ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åŒç±»è‡ªè°ƒç”¨&lt;/strong&gt;ï¼šä¸€ä¸ªç±»ä¸­çš„ &lt;code&gt;A&lt;/code&gt;æ–¹æ³•ï¼ˆæ— &lt;code&gt;@Transactional&lt;/code&gt;ï¼‰è°ƒç”¨åŒç±»ä¸­çš„ &lt;code&gt;B&lt;/code&gt;æ–¹æ³•ï¼ˆæœ‰&lt;code&gt;@Transactional&lt;/code&gt;ï¼‰ï¼Œ&lt;code&gt;B&lt;/code&gt;æ–¹æ³•çš„äº‹åŠ¡ä¼šå¤±æ•ˆã€‚å› ä¸ºè‡ªè°ƒç”¨ä¸ç»è¿‡ä»£ç†å¯¹è±¡ã€‚è§£å†³æ–¹æ³•æ˜¯å°† &lt;code&gt;B&lt;/code&gt;æ–¹æ³•æ”¾åˆ°å¦ä¸€ä¸ª Service ç±»ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸éœ€æŠ›å‡º&lt;/strong&gt;ï¼šäº‹åŠ¡å›æ»šä¾èµ–äºå¼‚å¸¸è¢«æŠ›å‡ºã€‚å¦‚æœä½ åœ¨æ–¹æ³•å†…ç”¨ &lt;code&gt;try-catch&lt;/code&gt;æ•è·äº†å¼‚å¸¸ä½†æœªé‡æ–°æŠ›å‡ºï¼Œäº‹åŠ¡å°±ä¸ä¼šå›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­£ç¡®è®¾ç½®å›æ»šå¼‚å¸¸&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œæ˜ç¡®é…ç½® &lt;code&gt;rollbackFor&lt;/code&gt;ã€‚è‹¥éœ€æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»šï¼Œå¯è®¾ä¸º &lt;code&gt;rollbackFor = Exception.class&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“å¼•æ“æ”¯æŒäº‹åŠ¡&lt;/strong&gt;ï¼šç¡®ä¿ä½ ä½¿ç”¨çš„æ•°æ®åº“è¡¨ä½¿ç”¨çš„æ˜¯æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼ˆå¦‚ InnoDBï¼‰ã€‚ä¾‹å¦‚ï¼ŒMySQL çš„ MyISAM å¼•æ“å°±ä¸æ”¯æŒäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç»¼åˆä½¿ç”¨äº†å¤šä¸ªå±æ€§çš„æœåŠ¡å±‚æ–¹æ³•ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class OrderService {
@Autowired
private OrderRepository orderRepository;
@Autowired
private InventoryRepository inventoryRepository;
// åœ¨ä¸€ä¸ªæ–°äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œè¶…æ—¶æ—¶é—´5ç§’ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»š
@Transactional(propagation = Propagation.REQUIRES_NEW,
timeout = 5,
rollbackFor = Exception.class)
public void placeOrder(Order order) throws Exception {
// 1. æ‰£å‡åº“å­˜
inventoryRepository.reduceStock(order.getProductId(), order.getQuantity());
// 2. åˆ›å»ºè®¢å•
orderRepository.save(order);
// å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼ˆåŒ…æ‹¬Exceptionï¼‰ï¼Œæ‰€æœ‰æ“ä½œéƒ½å°†å›æ»š
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ğŸ“š &lt;strong&gt;æ€»ç»“&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Spring Boot ä¸­æ•°æ®åº“äº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒæ˜¯ &lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt; æ³¨è§£ã€‚è¦æœ‰æ•ˆä½¿ç”¨å®ƒï¼Œä½ éœ€è¦ç†è§£å…¶&lt;strong&gt;ä¼ æ’­è¡Œä¸º&lt;/strong&gt;ã€&lt;strong&gt;éš”ç¦»çº§åˆ«&lt;/strong&gt;ã€&lt;strong&gt;å›æ»šè§„åˆ™&lt;/strong&gt;ç­‰å…³é”®å±æ€§ï¼Œå¹¶æ³¨æ„é¿å…å¸¸è§çš„å¤±æ•ˆé™·é˜±ï¼Œå¦‚&lt;strong&gt;åŒç±»è‡ªè°ƒç”¨&lt;/strong&gt;å’Œ&lt;strong&gt;å¼‚å¸¸è¢«æ•è·&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°åœ¨ Spring Boot é¡¹ç›®ä¸­åº”ç”¨äº‹åŠ¡ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id="ç±»çº§åˆ«-transactional"&gt;ç±»çº§åˆ« @Transactional
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring ä¸­ï¼Œå½“ä½ å°† &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£åº”ç”¨äºç±»çº§åˆ«æ—¶ï¼Œå®ƒä¼šä¸ºè¯¥ç±»çš„æ‰€æœ‰ &lt;strong&gt;public æ–¹æ³•&lt;/strong&gt;æä¾›ä¸€ä¸ªé»˜è®¤çš„äº‹åŠ¡é…ç½®æ¨¡æ¿ã€‚è¿™æ„å‘³ç€è¿™äº›æ–¹æ³•çš„æ‰§è¡Œéƒ½ä¼šè¢«çº³å…¥äº‹åŠ¡ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿäº†è§£å…¶æ ¸å¿ƒè¦ç‚¹ï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸ªè¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹é¢&lt;/th&gt;
&lt;th&gt;ç±»çº§åˆ« &lt;code&gt;@Transactional&lt;/code&gt;çš„ä½œç”¨&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤äº‹åŠ¡è¡Œä¸º&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»ä¸­æ‰€æœ‰ &lt;strong&gt;public æ–¹æ³•&lt;/strong&gt;åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šè‡ªåŠ¨å¼€å¯å’Œç®¡ç†äº‹åŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;é public æ–¹æ³•ï¼ˆprivate, protectedï¼‰ä¸Šçš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£&lt;strong&gt;ä¸ä¼šç”Ÿæ•ˆ&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•çº§æ³¨è§£è¦†ç›–ç±»çº§é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœæŸä¸ª public æ–¹æ³•ä¸Šä¹Ÿæœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ï¼Œé‚£ä¹ˆ&lt;strong&gt;æ–¹æ³•ä¸Šçš„é…ç½®ä¼šä¼˜å…ˆäºç±»çº§åˆ«çš„é…ç½®&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æä¾›äº†çµæ´»æ€§ï¼Œå…è®¸å¯¹ç‰¹å®šæ–¹æ³•è¿›è¡Œæ›´ç»†è‡´çš„äº‹åŠ¡æ§åˆ¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»Ÿä¸€ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹ä¾¿åœ°ä¸ºæ•´ä¸ªæœåŠ¡ç±»çš„æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•è®¾å®š&lt;strong&gt;ç»Ÿä¸€çš„äº‹åŠ¡å±æ€§&lt;/strong&gt;ï¼ˆå¦‚ä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€åªè¯»ç­‰ï¼‰ï¼Œå‡å°‘é‡å¤é…ç½®ã€‚&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºç±»ä¸­å¤§å¤šæ•°æ–¹æ³•æœ‰ç›¸ä¼¼äº‹åŠ¡éœ€æ±‚çš„æƒ…å†µï¼Œæœ‰åŠ©äºä¿æŒä»£ç æ•´æ´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯èƒ½å¸¦æ¥çš„æ€§èƒ½å½±å“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœç›²ç›®åœ°å°†æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬åªè¯»æŸ¥è¯¢ï¼‰éƒ½ç½®äºäº‹åŠ¡ä¸­ï¼Œå¯èƒ½ä¼šå¸¦æ¥&lt;strong&gt;ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“äº‹åŠ¡æœ¬èº«æœ‰ä¸€å®šå¼€é”€ã€‚å¯¹äºä¸ä¿®æ”¹æ•°æ®çš„çº¯æŸ¥è¯¢æ–¹æ³•ï¼Œè€ƒè™‘ä½¿ç”¨ &lt;code&gt;@Transactional(readOnly = true)&lt;/code&gt;æˆ–ä¸åœ¨ç±»çº§åˆ«è®¾ç½®äº‹åŠ¡ï¼Œè€Œæ˜¯åœ¨æ–¹æ³•çº§åˆ«å•ç‹¬é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;æ–¹æ³•çº§åˆ«è¦†ç›–çš„ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†æ–¹æ³•çº§åˆ«çš„äº‹åŠ¡é…ç½®å¦‚ä½•è¦†ç›–ç±»çº§åˆ«çš„é…ç½®ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class) // ç±»çº§åˆ«ï¼šé»˜è®¤å¿…éœ€äº‹åŠ¡ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»š
public class UserService {
@Autowired
private UserRepository userRepository;
// æ­¤æ–¹æ³•å°†ä½¿ç”¨ç±»çº§åˆ«çš„äº‹åŠ¡é…ç½®ï¼šPropagation.REQUIRED, rollbackFor = Exception.class
public void createUser(User user) {
userRepository.save(user);
}
// æ­¤æ–¹æ³•ä¸Šçš„æ³¨è§£è¦†ç›–äº†ç±»çº§åˆ«çš„é…ç½®ï¼šæ€»æ˜¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶ä¸”åªè¯»
@Transactional(propagation = Propagation.REQUIRES_NEW, readOnly = true)
public User getUserById(Long id) {
return userRepository.findById(id).orElse(null);
}
// æ­¤æ–¹æ³•ä¸Šçš„æ³¨è§£è¦†ç›–äº†ç±»çº§åˆ«çš„é…ç½®ï¼šæŒ‡å®šäº†è¶…æ—¶æ—¶é—´
@Transactional(timeout = 30)
public void updateUserProfile(User user) {
// ... ä¸€äº›è€—æ—¶æ“ä½œ
userRepository.updateUser(user);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ğŸ“‹ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ç±»çº§åˆ« &lt;code&gt;@Transactional&lt;/code&gt;æ—¶ï¼Œæœ‰å‡ ä¸ªé‡è¦çš„åœ°æ–¹éœ€è¦æ³¨æ„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ…ç”¨äºé public æ–¹æ³•&lt;/strong&gt;ï¼šSpring çš„äº‹åŠ¡ç®¡ç†åŸºäº AOPï¼ˆåŠ¨æ€ä»£ç†ï¼‰ï¼Œé public æ–¹æ³•ä¸Šçš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£&lt;strong&gt;ä¼šè¢«å¿½ç•¥&lt;/strong&gt;ï¼Œä¸”é€šå¸¸ä¸ä¼šæœ‰ä»»ä½•æŠ¥é”™ï¼Œè¿™æ˜¯ä¸€å¤„å®¹æ˜“è¸©å‘çš„åœ°æ–¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è‡ªè°ƒç”¨é—®é¢˜&lt;/strong&gt;ï¼šåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸€ä¸ªæ²¡æœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodA&lt;/code&gt;ï¼‰ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªæœ‰ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodB&lt;/code&gt;ï¼‰ï¼Œ&lt;strong&gt;&lt;code&gt;methodB&lt;/code&gt;çš„äº‹åŠ¡æ³¨è§£ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸ºè‡ªè°ƒç”¨ä¸ç»è¿‡ä»£ç†å¯¹è±¡ã€‚è§£å†³æ–¹æ³•æ˜¯å°† &lt;code&gt;methodB&lt;/code&gt;ç§»åˆ°å¦ä¸€ä¸ª Service ç±»ä¸­ï¼Œæˆ–é€šè¿‡æ³¨å…¥è‡ªèº«ä»£ç†ç­‰æ–¹å¼è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®å›æ»šè§„åˆ™&lt;/strong&gt;ï¼šç±»çº§åˆ«è®¾ç½®çš„ &lt;code&gt;rollbackFor&lt;/code&gt;æˆ– &lt;code&gt;noRollbackFor&lt;/code&gt;å±æ€§ä¼šåº”ç”¨äºæ‰€æœ‰æ–¹æ³•ã€‚åŠ¡å¿…æ¸…æ¥šé»˜è®¤å›æ»šçš„æ˜¯ &lt;code&gt;RuntimeException&lt;/code&gt;å’Œ &lt;code&gt;Error&lt;/code&gt;ï¼Œå¦‚æœéœ€è¦æ£€æŸ¥å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ä¹Ÿè§¦å‘å›æ»šï¼Œéœ€è¦åœ¨ç±»æˆ–æ–¹æ³•çº§åˆ«æ˜ç¡®é…ç½® &lt;code&gt;rollbackFor = Exception.class&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“å¼•æ“æ”¯æŒ&lt;/strong&gt;ï¼šç¡®ä¿ä½ ä½¿ç”¨çš„æ•°æ®åº“è¡¨å¼•æ“æ”¯æŒäº‹åŠ¡ï¼ˆå¦‚ MySQL çš„ InnoDBï¼‰ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼ˆå¦‚ MyISAMï¼‰ï¼Œäº‹åŠ¡æ³¨è§£å°†ä¸ä¼šç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ€»ç»“ä¸€ä¸‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;å¯ä»¥&lt;strong&gt;é«˜æ•ˆåœ°ä¸ºæ‰€æœ‰ public æ–¹æ³•æä¾›ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼Œéå¸¸é€‚åˆé‚£äº›å¤§å¤šæ•°æ–¹æ³•éƒ½éœ€è¦ç±»ä¼¼äº‹åŠ¡é…ç½®çš„ Service ç±»ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å®ƒæ˜¯ä¸€æŠŠâ€œåŒåˆƒå‰‘â€ï¼Œéœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šéœ€è¦ç‰¹äº‹ç‰¹åŠçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;è¿›è¡Œè¦†ç›–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…æ€§&lt;/strong&gt;ï¼šé¿å…ç»™ä¸éœ€è¦äº‹åŠ¡çš„åªè¯»æ–¹æ³•å¸¦æ¥é¢å¤–å¼€é”€ï¼Œå¹¶ç•™æ„é public æ–¹æ³•æ³¨è§£å¤±æ•ˆå’Œè‡ªè°ƒç”¨é™·é˜±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ç±»çº§åˆ«çš„ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="spring-security-æƒé™æ³¨è§£"&gt;Spring Security æƒé™æ³¨è§£
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶ï¼Œç‰¹åˆ«æ˜¯å…¶å®‰å…¨æ¨¡å— &lt;strong&gt;Spring Security&lt;/strong&gt;ï¼Œæä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„&lt;strong&gt;æƒé™æ§åˆ¶æ³¨è§£&lt;/strong&gt;ï¼Œå¯ä»¥å¸®åŠ©ä½ è½»æ¾åœ°åœ¨æ–¹æ³•æˆ–ç±»çº§åˆ«å®ç°ç²¾ç»†åŒ–çš„è®¿é—®æ§åˆ¶ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ±‡æ€»è¿™äº›æ ¸å¿ƒæ³¨è§£ï¼Œå¹¶é™„ä¸Šè¯¦ç»†è¯´æ˜å’Œä»£ç ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;åº”ç”¨åœºæ™¯ä¸æè¿°&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨è¡¨è¾¾å¼/ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PreAuthorize&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•&lt;strong&gt;æ‰§è¡Œå‰&lt;/strong&gt;è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œ&lt;strong&gt;æœ€å¸¸ç”¨&lt;/strong&gt;ã€‚æ”¯æŒä¸°å¯Œçš„ SpEL è¡¨è¾¾å¼ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PreAuthorize(&amp;quot;hasRole('ADMIN')&amp;quot;)``@PreAuthorize(&amp;quot;hasAuthority('USER_DELETE')&amp;quot;)``@PreAuthorize(&amp;quot;#id == authentication.principal.id&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PostAuthorize&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•&lt;strong&gt;æ‰§è¡Œå&lt;/strong&gt;è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œé€‚ç”¨äºéœ€è¦&lt;strong&gt;åŸºäºè¿”å›å€¼&lt;/strong&gt;è¿›è¡Œé‰´æƒçš„åœºæ™¯ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PostAuthorize(&amp;quot;returnObject.owner == authentication.name&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@Secured&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¾ƒç®€å•çš„è§’è‰²æ£€æŸ¥ï¼Œ&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt; SpEL è¡¨è¾¾å¼ã€‚è§’è‰²åå¿…é¡»ä»¥ &lt;code&gt;ROLE_&lt;/code&gt;å‰ç¼€å¼€å¤´ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Secured({&amp;quot;ROLE_ADMIN&amp;quot;, &amp;quot;ROLE_USER&amp;quot;})&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@RolesAllowed&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JSR-250 æ ‡å‡†æ³¨è§£ï¼ŒåŠŸèƒ½ä¸ &lt;code&gt;@Secured&lt;/code&gt;ç±»ä¼¼ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@RolesAllowed({&amp;quot;ADMIN&amp;quot;, &amp;quot;USER&amp;quot;})&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PreFilter&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æ‰§è¡Œå‰ï¼Œæ ¹æ®è§„åˆ™&lt;strong&gt;è¿‡æ»¤ä¼ å…¥çš„é›†åˆå‚æ•°&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PreFilter(&amp;quot;filterObject.owner == authentication.name&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@PostFilter&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ–¹æ³•æ‰§è¡Œåï¼Œæ ¹æ®è§„åˆ™&lt;strong&gt;è¿‡æ»¤è¿”å›çš„é›†åˆç»“æœ&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@PostFilter(&amp;quot;filterObject.status == 'PUBLIC' or filterObject.owner == authentication.name&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;è¯¦è§£ä¸ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="-1-preauthorize"&gt;ğŸ”’ 1. @PreAuthorize
&lt;/h3&gt;&lt;p&gt;æ­¤æ³¨è§£ç”¨äºåœ¨æ–¹æ³•è°ƒç”¨&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;æ‰§è¡Œæƒé™æ£€æŸ¥ï¼Œå¦‚æœè¡¨è¾¾å¼è¯„ä¼°ç»“æœä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œæ–¹æ³•å°†ä¸ä¼šæ‰§è¡Œã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@PreAuthorize(&amp;#34;hasRole(&amp;#39;ADMIN&amp;#39;)&amp;#34;) // è¦æ±‚ç”¨æˆ·æ‹¥æœ‰&amp;#39;ROLE_ADMIN&amp;#39;è§’è‰²
public void deleteUser(Long userId) {
// åˆ é™¤ç”¨æˆ·çš„é€»è¾‘
}
@PreAuthorize(&amp;#34;hasAuthority(&amp;#39;USER_DELETE&amp;#39;) and #userId != authentication.principal.id&amp;#34;) // è¦æ±‚æ‹¥æœ‰&amp;#39;USER_DELETE&amp;#39;æƒé™ä¸”ä¸èƒ½åˆ é™¤è‡ªå·±
public void deleteUser(Long userId) {
// åˆ é™¤ç”¨æˆ·çš„é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-2-postauthorize"&gt;ğŸ” 2. @PostAuthorize
&lt;/h3&gt;&lt;p&gt;æ­¤æ³¨è§£åœ¨æ–¹æ³•&lt;strong&gt;æ‰§è¡Œå&lt;/strong&gt;è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œç‰¹åˆ«é€‚åˆè®¿é—®æ§åˆ¶å†³ç­–éœ€è¦ä¾èµ–æ–¹æ³•è¿”å›å€¼çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åªèƒ½è¿”å›å±äºè‡ªå·±çš„ç”¨æˆ·ä¿¡æ¯
@PostAuthorize(&amp;#34;returnObject.username == authentication.principal.name&amp;#34;)
public User getUserById(Long id) {
return userRepository.findById(id).orElse(null);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-3-secured"&gt;ğŸ›¡ï¸ 3. @Secured
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªè¾ƒæ—©æœŸçš„ Spring Security æ³¨è§£ï¼Œä¸»è¦ç”¨äºåŸºäºè§’è‰²çš„ç®€å•æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Secured(&amp;#34;ROLE_ADMIN&amp;#34;) // è¦æ±‚ç”¨æˆ·æ‹¥æœ‰&amp;#39;ROLE_ADMIN&amp;#39;è§’è‰²
public void updateSystemConfig() {
// æ›´æ–°ç³»ç»Ÿé…ç½®çš„é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-4-rolesallowed"&gt;ğŸ“‹ 4. @RolesAllowed
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ JSR-250 æ ‡å‡†æ³¨è§£ï¼Œéœ€è¦å•ç‹¬å¯ç”¨ (&lt;code&gt;jsr250Enabled = true&lt;/code&gt;)ã€‚å…¶ä½œç”¨ä¸ &lt;code&gt;@Secured&lt;/code&gt;ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RolesAllowed({&amp;#34;ADMIN&amp;#34;, &amp;#34;SUPER_USER&amp;#34;}) // å…è®¸æ‹¥æœ‰&amp;#39;ADMIN&amp;#39;æˆ–&amp;#39;SUPER_USER&amp;#39;è§’è‰²çš„ç”¨æˆ·è®¿é—®
public void viewAuditLogs() {
// æŸ¥çœ‹å®¡è®¡æ—¥å¿—çš„é€»è¾‘
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-5-prefilter-ä¸-postfilter"&gt;ğŸ§¹ 5. @PreFilter ä¸ @PostFilter
&lt;/h3&gt;&lt;p&gt;è¿™ä¸¤ä¸ªæ³¨è§£ç”¨äºå¯¹é›†åˆæ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå®ç°æ•°æ®çº§åˆ«çš„æƒé™æ§åˆ¶ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åªèƒ½å¤„ç†å±äºè‡ªå·±çš„ä»»åŠ¡
@PreFilter(&amp;#34;filterObject.assignee == authentication.name&amp;#34;)
public void updateTasks(List&amp;lt;Task&amp;gt; tasks) {
tasks.forEach(taskRepository::save);
}
// åªè¿”å›çŠ¶æ€ä¸ºå…¬å…±æˆ–å±äºè‡ªå·±çš„å¸–å­
@PostFilter(&amp;#34;filterObject.status == &amp;#39;PUBLIC&amp;#39; or filterObject.owner == authentication.name&amp;#34;)
public List&amp;lt;Post&amp;gt; getAllPosts() {
return postRepository.findAll();
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-å¯ç”¨æ³¨è§£æ”¯æŒ"&gt;âš™ï¸ &lt;strong&gt;å¯ç”¨æ³¨è§£æ”¯æŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è¦ä½¿ç”¨ &lt;code&gt;@PreAuthorize&lt;/code&gt;, &lt;code&gt;@PostAuthorize&lt;/code&gt;, &lt;code&gt;@Secured&lt;/code&gt;ç­‰æ³¨è§£ï¼Œä½ å¿…é¡»åœ¨ä½ çš„é…ç½®ç±»ä¸Šæ˜¾å¼å¯ç”¨å®ƒä»¬ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@EnableMethodSecurity(prePostEnabled = true, securedEnabled = true, jsr250Enabled = true)
public class SecurityConfig {
// å…¶ä»–å®‰å…¨é…ç½®...
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;prePostEnabled = true&lt;/code&gt;: å¯ç”¨ &lt;code&gt;@PreAuthorize&lt;/code&gt;å’Œ &lt;code&gt;@PostAuthorize&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;securedEnabled = true&lt;/code&gt;: å¯ç”¨ &lt;code&gt;@Secured&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;jsr250Enabled = true&lt;/code&gt;: å¯ç”¨ &lt;code&gt;@RolesAllowed&lt;/code&gt;(JSR-250)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¡¨è¾¾å¼ä¸­çš„å¯¹è±¡&lt;/strong&gt;ï¼šåœ¨ SpEL è¡¨è¾¾å¼ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;authentication&lt;/code&gt;ã€&lt;code&gt;principal&lt;/code&gt;æ¥è·å–å½“å‰è®¤è¯ä¿¡æ¯å’Œç”¨æˆ·ä¸»ä½“ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;#å‚æ•°å&lt;/code&gt;æ¥å¼•ç”¨æ–¹æ³•çš„å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§’è‰²ä¸æƒé™&lt;/strong&gt;ï¼š&lt;code&gt;hasRole('ADMIN')&lt;/code&gt;ä¼šåœ¨ä¼ å…¥çš„å­—ç¬¦ä¸²å‰è‡ªåŠ¨æ·»åŠ  &lt;code&gt;ROLE_&lt;/code&gt;å‰ç¼€ï¼ˆå³æŸ¥æ‰¾ &lt;code&gt;ROLE_ADMIN&lt;/code&gt;ï¼‰ã€‚è€Œ &lt;code&gt;hasAuthority('USER_DELETE')&lt;/code&gt;åˆ™ä¼šç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸² &amp;lsquo;USER_DELETE&amp;rsquo; è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚æ ¹æ®ä½ çš„æƒé™è®¾è®¡æ–¹å¼é€‰æ‹©ä½¿ç”¨ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•è°ƒç”¨çš„æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼šè¿™äº›åŸºäº AOP çš„æ³¨è§£é€šå¸¸åªåœ¨é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œçš„å¤–éƒ¨æ–¹æ³•è°ƒç”¨æ—¶ç”Ÿæ•ˆã€‚åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ªè¢«æ³¨è§£ä¿®é¥°çš„æ–¹æ³•ï¼Œæ³¨è§£å¯èƒ½ä¼šå¤±æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spring Security çš„æƒé™æ³¨è§£ä¸ºåº”ç”¨å®‰å…¨æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ä¿éšœã€‚æ­£ç¡®ä½¿ç”¨å®ƒä»¬ï¼Œå¯ä»¥è®©ä½ è½»æ¾æ„å»ºå‡ºæƒé™æ§åˆ¶ç²¾ç»†ã€ä»£ç æ¸…æ™°æ˜“ç»´æŠ¤çš„ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id="sentinelresource"&gt;@SentinelResource
&lt;/h2&gt;&lt;p&gt;Sentinel ä¸­å®ç°é™æµçš„æ ¸å¿ƒæ³¨è§£æ˜¯ &lt;code&gt;@SentinelResource&lt;/code&gt;ã€‚å®ƒå…è®¸ä½ å£°æ˜éœ€è¦ä¿æŠ¤çš„ä¸šåŠ¡èµ„æºï¼Œå¹¶æŒ‡å®šé™æµæˆ–é™çº§åçš„å¤„ç†é€»è¾‘ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“å®ƒçš„æ ¸å¿ƒå±æ€§ï¼Œç„¶åè¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£å±æ€§&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;value&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºåç§°&lt;/strong&gt;ï¼Œå¿…å¡«ã€‚Sentinel æ ¹æ®æ­¤åç§°æ¥é…ç½®å’Œç»Ÿè®¡è§„åˆ™ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@SentinelResource(value = &amp;quot;getUserById&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;blockHandler&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é™æµ/ç†”æ–­å¤„ç†æ–¹&lt;/strong&gt;æ³•åã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚è¯¥æ–¹æ³•éœ€ä¸åŸæ–¹æ³•åŒå‚æ•°åˆ—è¡¨ï¼Œå¹¶é¢å¤–åŠ ä¸€ä¸ª &lt;code&gt;BlockException&lt;/code&gt;å‚æ•°ï¼Œä¸”éœ€åŒè¿”å›å€¼ç±»å‹ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;blockHandler = &amp;quot;handleBlock&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;blockHandlerClass&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®š &lt;code&gt;blockHandler&lt;/code&gt;æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚æ­¤æ—¶ &lt;code&gt;blockHandler&lt;/code&gt;æ–¹æ³•å¿…é¡»æ˜¯è¯¥ç±»çš„ &lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;blockHandlerClass = {ExceptionUtil.class}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;fallback&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸šåŠ¡å¼‚å¸¸é™çº§å¤„ç†&lt;/strong&gt;æ–¹æ³•åã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆé &lt;code&gt;BlockException&lt;/code&gt;ï¼‰ã€‚å‚æ•°åˆ—è¡¨éœ€ä¸åŸæ–¹æ³•ä¸€è‡´ï¼Œå¯åŠ ä¸€ä¸ª &lt;code&gt;Throwable&lt;/code&gt;å‚æ•°ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;fallback = &amp;quot;fallbackHandler&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;fallbackClass&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®š &lt;code&gt;fallback&lt;/code&gt;æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚&lt;strong&gt;å¯é€‰&lt;/strong&gt;ã€‚æ­¤æ—¶ &lt;code&gt;fallback&lt;/code&gt;æ–¹æ³•å¿…é¡»æ˜¯è¯¥ç±»çš„ &lt;strong&gt;é™æ€æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;fallbackClass = {ExceptionUtil.class}&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;ä½¿ç”¨æ­¥éª¤&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="1-æ·»åŠ ä¾èµ–"&gt;1. æ·»åŠ ä¾èµ–
&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ  Spring Cloud Alibaba Sentinel ä¾èµ–ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.alibaba.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-alibaba-sentinel&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;2022.0.0.0&amp;lt;/version&amp;gt; &amp;lt;!-- è¯·é€‰æ‹©ä¸ä½ çš„Spring Bootç‰ˆæœ¬åŒ¹é…çš„ç‰ˆæœ¬ --&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="2-é…ç½®-sentinel-æ§åˆ¶å°å¯é€‰ä½†æ¨è"&gt;2. é…ç½® Sentinel æ§åˆ¶å°ï¼ˆå¯é€‰ä½†æ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;code&gt;application.yml&lt;/code&gt;ä¸­é…ç½® Sentinel Dashboard åœ°å€ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
sentinel:
transport:
dashboard: localhost:8080 # Sentinel æ§åˆ¶å°åœ°å€
port: 8719 # åº”ç”¨ä¸Sentinelæ§åˆ¶å°äº¤äº’çš„æœ¬åœ°ç«¯å£
eager: true # å–æ¶ˆæ§åˆ¶å°æ‡’åŠ è½½ï¼Œé¡¹ç›®å¯åŠ¨å³è¿æ¥
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="3-ä½¿ç”¨-sentinelresourceæ³¨è§£"&gt;3. ä½¿ç”¨ &lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£
&lt;/h3&gt;&lt;p&gt;ä½ å¯ä»¥åœ¨ Service æ–¹æ³•æˆ– Controller æ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 1ï¼šåœ¨ Controller ä¸­ä½¿ç”¨ï¼Œ&lt;code&gt;blockHandler&lt;/code&gt;å¤„ç†é™æµ&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.alibaba.csp.sentinel.annotation.SentinelResource;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
@RestController
public class MyController {
@GetMapping(&amp;#34;/test&amp;#34;)
@SentinelResource(value = &amp;#34;testResource&amp;#34;, blockHandler = &amp;#34;handleBlock&amp;#34;)
public String test() {
return &amp;#34;æ­£å¸¸è®¿é—®&amp;#34;;
}
// é™æµé™çº§æ–¹æ³• (éœ€ç¬¦åˆ blockHandler æ–¹æ³•ç­¾åè¦æ±‚)
public String handleBlock(BlockException ex) {
return &amp;#34;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•&amp;#34;; // è§¦å‘é™æµæ—¶è¿”å›æ­¤ä¿¡æ¯
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 2ï¼šä½¿ç”¨ &lt;code&gt;blockHandlerClass&lt;/code&gt;æŒ‡å®šå¤–éƒ¨ç±»å¤„ç†é™æµ&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åœ¨Controlleræˆ–Serviceä¸­
@SentinelResource(value = &amp;#34;getUserById&amp;#34;,
blockHandler = &amp;#34;handleBlock&amp;#34;,
blockHandlerClass = {ExceptionUtil.class})
public User getUserById(String id) {
// ä¸šåŠ¡é€»è¾‘
}
// ç‹¬ç«‹çš„å¼‚å¸¸å¤„ç†å·¥å…·ç±» ExceptionUtil.java
public final class ExceptionUtil {
// å¿…é¡»æ˜¯é™æ€æ–¹æ³•
public static User handleBlock(String id, BlockException ex) {
// è®°å½•æ—¥å¿—æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œ
return new User(&amp;#34;fallback-user&amp;#34;, &amp;#34;è¯·æ±‚è¢«é™æµ&amp;#34;); // è¿”å›é™çº§æ•°æ®
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ 3ï¼šåŒæ—¶ä½¿ç”¨ &lt;code&gt;blockHandler&lt;/code&gt;å’Œ &lt;code&gt;fallback&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SentinelResource(value = &amp;#34;demoService&amp;#34;,
blockHandler = &amp;#34;blockHandler&amp;#34;, // å¤„ç† Sentinel è§„åˆ™æ‹¦æˆªçš„å¼‚å¸¸ï¼ˆå¦‚é™æµã€ç†”æ–­ï¼‰
fallback = &amp;#34;fallbackHandler&amp;#34;) // å¤„ç†ä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„å…¶ä»–å¼‚å¸¸
public String demoService(String input) {
if (&amp;#34;error&amp;#34;.equals(input)) {
throw new RuntimeException(&amp;#34;ä¸šåŠ¡å¼‚å¸¸&amp;#34;);
}
return &amp;#34;å¤„ç†æˆåŠŸ: &amp;#34; + input;
}
// Sentinel BlockException å¤„ç†æ–¹
public String blockHandler(String input, BlockException ex) {
return &amp;#34;è¯·æ±‚è¢«é™æµæˆ–ç†”æ–­ï¼Œè¾“å…¥: &amp;#34; + input;
}
// é€šç”¨ Fallback å¤„ç†æ–¹ (Throwable å¯é€‰)
public String fallbackHandler(String input, Throwable t) {
return &amp;#34;æœåŠ¡é™çº§ï¼ŒåŸå› : &amp;#34; + t.getMessage();
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="4-é…ç½®é™æµè§„åˆ™"&gt;4. é…ç½®é™æµè§„åˆ™
&lt;/h3&gt;&lt;p&gt;é…ç½®è§„åˆ™æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹å¼ä¸€ï¼šé€šè¿‡ Sentinel æ§åˆ¶å°åŠ¨æ€é…ç½®ï¼ˆæ¨èï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯åŠ¨ Sentinel æ§åˆ¶å°ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Jar åŒ…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è®¿é—®æ§åˆ¶å°ï¼ˆé»˜è®¤ç”¨æˆ·åå¯†ç å‡ä¸º &lt;code&gt;sentinel&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;strong&gt;â€œç°‡ç‚¹é“¾è·¯â€&lt;/strong&gt; ä¸­æ‰¾åˆ°ä½ é€šè¿‡ &lt;code&gt;@SentinelResource&lt;/code&gt;æ³¨è§£å®šä¹‰çš„èµ„æºåï¼ˆå¦‚ &lt;code&gt;testResource&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç‚¹å‡» &lt;strong&gt;â€œæµæ§â€&lt;/strong&gt; æŒ‰é’®ï¼Œè®¾ç½® &lt;strong&gt;QPS&lt;/strong&gt; æˆ–&lt;strong&gt;çº¿ç¨‹æ•°&lt;/strong&gt;é˜ˆå€¼ã€æµæ§æ¨¡å¼ï¼ˆç›´æ¥ã€å…³è”ã€é“¾è·¯ï¼‰å’Œæµæ§æ•ˆæœï¼ˆå¿«é€Ÿå¤±è´¥ã€Warm Upã€æ’é˜Ÿç­‰å¾…ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ–¹å¼äºŒï¼šé€šè¿‡ä»£ç åˆå§‹åŒ–è§„åˆ™ï¼ˆé€‚ç”¨äºåˆå§‹é…ç½®æˆ–æµ‹è¯•ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.alibaba.csp.sentinel.slots.block.RuleConstant;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;
import org.springframework.boot.ApplicationRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import java.util.Collections;
@Configuration
public class SentinelConfig {
@Bean
public ApplicationRunner initSentinelRules() {
return args -&amp;gt; {
FlowRule rule = new FlowRule();
rule.setResource(&amp;#34;testResource&amp;#34;); // ä¸ @SentinelResource çš„ value ä¸€è‡´
rule.setGrade(RuleConstant.FLOW_GRADE_QPS); // é™æµé˜ˆå€¼ç±»å‹ (QPS æ¨¡å¼)
rule.setCount(2); // é˜ˆå€¼ (æ¯ç§’æœ€å¤šå…è®¸ 2 æ¬¡è¯·æ±‚)
rule.setLimitApp(&amp;#34;default&amp;#34;);
FlowRuleManager.loadRules(Collections.singletonList(rule));
};
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;è¯·æ³¨æ„ï¼Œä»£ç é…ç½®çš„è§„åˆ™åœ¨åº”ç”¨é‡å¯åé€šå¸¸ä¼šä¸¢å¤±ï¼Œå»ºè®®é€šè¿‡æ§åˆ¶å°é…ç½®æˆ–ç»“åˆ Nacos ç­‰é…ç½®ä¸­å¿ƒè¿›è¡ŒæŒä¹…åŒ–ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h3 id="5-ç»Ÿä¸€å¼‚å¸¸å¤„ç†å¯é€‰"&gt;5. ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆå¯é€‰ï¼‰
&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ æƒ³è‡ªå®šä¹‰è¢«é™æµæ—¶è¿”å›çš„ JSON æ ¼å¼è€Œéç®€å•å­—ç¬¦ä¸²ï¼Œå¯ä»¥å®ç° &lt;code&gt;BlockExceptionHandler&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler;
import org.springframework.stereotype.Component;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
@Component
public class CustomBlockExceptionHandler implements BlockExceptionHandler {
@Override
public void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception {
response.setStatus(429); // Too Many Requests
response.setContentType(&amp;#34;application/json;charset=utf-8&amp;#34;);
response.getWriter().write(&amp;#34;{\&amp;#34;code\&amp;#34;: 429, \&amp;#34;msg\&amp;#34;: \&amp;#34;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\&amp;#34;}&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºåå”¯ä¸€æ€§&lt;/strong&gt;ï¼š&lt;code&gt;value&lt;/code&gt;å®šä¹‰çš„èµ„æºååº”å”¯ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ³•ç­¾å&lt;/strong&gt;ï¼š&lt;code&gt;blockHandler&lt;/code&gt;å’Œ &lt;code&gt;fallback&lt;/code&gt;æ–¹æ³•éœ€è¦ä¸¥æ ¼éµå¾ª&lt;strong&gt;å‚æ•°å’Œè¿”å›å€¼ç±»å‹&lt;/strong&gt;çš„çº¦å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶å°é…ç½®&lt;/strong&gt;ï¼šé€šè¿‡ Sentinel æ§åˆ¶å°é…ç½®è§„åˆ™æ˜¯&lt;strong&gt;åŠ¨æ€ç”Ÿæ•ˆ&lt;/strong&gt;çš„ï¼Œæ— éœ€é‡å¯åº”ç”¨ï¼Œéå¸¸çµæ´»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„åˆ™æŒä¹…åŒ–&lt;/strong&gt;ï¼šé»˜è®¤é…ç½®çš„è§„åˆ™å­˜åœ¨äºå†…å­˜ä¸­ï¼Œåº”ç”¨é‡å¯ä¼šä¸¢å¤±ã€‚å¦‚éœ€æŒä¹…åŒ–ï¼Œå¯é›†æˆ Nacosã€ZooKeeper ç­‰é…ç½®ä¸­å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŸ‹ç‚¹&lt;/strong&gt;ï¼šSentinel é»˜è®¤ä¹Ÿä¼šä¸ºæ‰€æœ‰ HTTP ç«¯ç‚¹ï¼ˆå¦‚ &lt;code&gt;@RequestMapping&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•ï¼‰æä¾›èµ„æºä¿æŠ¤ï¼Œèµ„æºåä¸º URL è·¯å¾„ã€‚ä½ åŒæ ·å¯ä»¥åœ¨æ§åˆ¶å°ä¸ºè¿™äº›è‡ªåŠ¨åŸ‹ç‚¹çš„èµ„æºé…ç½®è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ é¡ºåˆ©åœ°åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Sentinel è¿›è¡Œé™æµã€‚&lt;/p&gt;
&lt;h2 id="spring-retry"&gt;Spring Retry
&lt;/h2&gt;&lt;p&gt;Spring Retry ç»„ä»¶é€šè¿‡å‡ ä¸ªç®€æ´è€Œå¼ºå¤§çš„æ³¨è§£ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›äº†å¤„ç†ä¸´æ—¶æ€§æ•…éšœï¼ˆå¦‚ç½‘ç»œæ³¢åŠ¨ã€æ•°æ®åº“è¿æ¥æš‚æ—¶ä¸å¯ç”¨ç­‰ï¼‰çš„ä¼˜é›…é‡è¯•æœºåˆ¶ã€‚å®ƒèƒ½æœ‰æ•ˆå¢å¼ºç³»ç»Ÿçš„å®¹é”™æ€§å’Œç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ Spring Retry çš„æ ¸å¿ƒæ³¨è§£æ¦‚è§ˆï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¸¸ç”¨å‚æ•°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@EnableRetry&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¯ç”¨é‡è¯•åŠŸèƒ½&lt;/strong&gt;çš„å¼€å…³æ³¨è§£ï¼Œé€šå¸¸æ”¾åœ¨é…ç½®ç±»æˆ–ä¸»å¯åŠ¨ç±»ä¸Šã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Retryable&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è®°&lt;strong&gt;éœ€è¦è¿›è¡Œé‡è¯•çš„æ–¹æ³•&lt;/strong&gt;ã€‚å½“æ–¹æ³•æŠ›å‡ºæŒ‡å®šå¼‚å¸¸æ—¶ï¼ŒSpring Retry ä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;include&lt;/code&gt;, &lt;code&gt;exclude&lt;/code&gt;, &lt;code&gt;maxAttempts&lt;/code&gt;, &lt;code&gt;backoff&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Backoff&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä½œä¸º &lt;code&gt;@Retryable&lt;/code&gt;çš„å‚æ•°ä½¿ç”¨ï¼Œç”¨äº&lt;strong&gt;é…ç½®é‡è¯•çš„å»¶è¿Ÿç­–ç•¥&lt;/strong&gt;ï¼Œå¦‚å›ºå®šé—´éš”ã€æŒ‡æ•°å¢é•¿ç­‰ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;delay&lt;/code&gt;, &lt;code&gt;multiplier&lt;/code&gt;, &lt;code&gt;maxDelay&lt;/code&gt;, &lt;code&gt;random&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Recover&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è®°ä¸€ä¸ªæ–¹æ³•ä½œä¸º&lt;strong&gt;é‡è¯•å…¨éƒ¨å¤±è´¥åçš„â€œå…œåº•â€æ¢å¤æ–¹æ³•&lt;/strong&gt;ã€‚å½“æ‰€æœ‰é‡è¯•å°è¯•éƒ½å¤±è´¥åï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CircuitBreaker&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›&lt;strong&gt;ç†”æ–­å™¨åŠŸèƒ½&lt;/strong&gt;ã€‚åœ¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼åï¼Œç†”æ–­å™¨ä¼šæ‰“å¼€ï¼Œæš‚æ—¶åœæ­¢æ‰€æœ‰é‡è¯•å°è¯•ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åå†è¿›å…¥åŠå¼€çŠ¶æ€å°è¯•æ¢å¤ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;openTimeout&lt;/code&gt;, &lt;code&gt;resetTimeout&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@ConcurrencyLimit&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é™åˆ¶æ–¹æ³•çš„å¹¶å‘æ‰§è¡Œæ•°é‡&lt;/strong&gt;ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;(æœ€å¤§å¹¶å‘æ•°)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•å¯ç”¨é‡è¯•"&gt;ğŸš€ å¦‚ä½•å¯ç”¨é‡è¯•
&lt;/h3&gt;&lt;p&gt;è¦ä½¿ç”¨ Spring Retryï¼Œé¦–å…ˆéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–ã€‚å¦‚æœä½ ä½¿ç”¨ Mavenï¼Œå¯ä»¥åœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.retry&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-retry&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;1.3.1&amp;lt;/version&amp;gt; &amp;lt;!-- è¯·æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ --&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Spring Retry åŸºäºAOPï¼Œå› æ­¤è¿˜éœ€è¦å¼•å…¥AOPä¾èµ– --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-aspects&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åï¼Œåœ¨ä¸€ä¸ªé…ç½®ç±»ï¼ˆä½¿ç”¨ &lt;code&gt;@Configuration&lt;/code&gt;æ³¨è§£ï¼‰æˆ–ä½ çš„ä¸»å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š &lt;code&gt;@EnableRetry&lt;/code&gt;æ³¨è§£æ¥å¯ç”¨é‡è¯•åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@EnableRetry // å°±æ˜¯å®ƒäº†
public class AppConfig {
// ... å…¶ä»–é…ç½®
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é…ç½®é‡è¯•è¡Œä¸º"&gt;âš™ï¸ é…ç½®é‡è¯•è¡Œä¸º
&lt;/h3&gt;&lt;h4 id="1"&gt;&lt;strong&gt;1. &lt;code&gt;@Retryable&lt;/code&gt;- æ ¸å¿ƒé‡è¯•æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£ç”¨äºæ ‡è®°é‚£äº›åœ¨é‡åˆ°ç‰¹å®šå¼‚å¸¸æ—¶éœ€è¦é‡è¯•çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºæœ¬ç”¨æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyService {
@Retryable(value = RuntimeException.class) // é‡åˆ°RuntimeExceptionå°±é‡è¯•
public void serviceMethod() {
// å¯èƒ½å¤±è´¥çš„ä¸šåŠ¡é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸¸ç”¨å‚æ•°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;value&lt;/code&gt;æˆ– &lt;code&gt;include&lt;/code&gt;&lt;/strong&gt;: æŒ‡å®š&lt;strong&gt;éœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;æ•°ç»„ã€‚ä¾‹å¦‚ &lt;code&gt;@Retryable(value = {IOException.class, SQLException.class})&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;exclude&lt;/code&gt;&lt;/strong&gt;: æŒ‡å®š&lt;strong&gt;ä¸è¿›è¡Œé‡è¯•çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;maxAttempts&lt;/code&gt;&lt;/strong&gt;: &lt;strong&gt;æœ€å¤§é‡è¯•æ¬¡æ•°&lt;/strong&gt;ï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼‰ã€‚é»˜è®¤æ˜¯3æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;backoff&lt;/code&gt;&lt;/strong&gt;: é€šè¿‡ &lt;code&gt;@Backoff&lt;/code&gt;æ³¨è§£&lt;strong&gt;é…ç½®é‡è¯•ä¹‹é—´çš„å»¶è¿Ÿç­–ç•¥&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2"&gt;&lt;strong&gt;2. &lt;code&gt;@Backoff&lt;/code&gt;- æ§åˆ¶é‡è¯•é—´éš”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@Backoff&lt;/code&gt;æ³¨è§£ç”¨äºå®šåˆ¶é‡è¯•çš„ç­‰å¾…æ—¶é—´ï¼Œé¿å…ç«‹å³é‡è¯•ç»™ç³»ç»Ÿå¸¦æ¥å‹åŠ›ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›ºå®šé—´éš”é‡è¯•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retryable(
value = {RemoteAccessException.class},
maxAttempts = 5,
backoff = @Backoff(delay = 2000) // æ¯æ¬¡é‡è¯•é—´éš”2ç§’
)
public void callApi() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŒ‡æ•°é€€é¿é‡è¯•&lt;/strong&gt;ï¼ˆå»¶è¿Ÿæ—¶é—´éšé‡è¯•æ¬¡æ•°æŒ‡æ•°å¢é•¿ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retryable(
value = {RemoteAccessException.class},
maxAttempts = 4,
backoff = @Backoff(delay = 1000, multiplier = 2, maxDelay = 5000)
// åˆå§‹å»¶è¿Ÿ1ç§’ï¼Œä¸‹æ¬¡2ç§’ï¼Œå†ä¸‹æ¬¡4ç§’ï¼Œæœ€å¤§ä¸è¶…è¿‡5ç§’
)
public void callApi() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éšæœºå»¶è¿Ÿé‡è¯•&lt;/strong&gt;ï¼ˆé¿å…å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶é‡è¯•å½¢æˆâ€œé‡è¯•é£æš´â€ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Retryable(
value = {RemoteAccessException.class},
maxAttempts = 3,
backoff = @Backoff(delay = 1000, maxDelay = 3000, random = true)
// å»¶è¿Ÿæ—¶é—´åœ¨1ç§’åˆ°3ç§’ä¹‹é—´éšæœº
)
public void callApi() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3"&gt;&lt;strong&gt;3. &lt;code&gt;@Recover&lt;/code&gt;- é‡è¯•å¤±è´¥åçš„é™çº§å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“æ‰€æœ‰é‡è¯•å°è¯•éƒ½å¤±è´¥åï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;@Recover&lt;/code&gt;æ³¨è§£å®šä¹‰ä¸€ä¸ªæ¢å¤æ–¹æ³•æ¥æ‰§è¡Œé™çº§é€»è¾‘ï¼Œå¦‚è®°å½•æ—¥å¿—ã€è¿”å›é»˜è®¤å€¼æˆ–è¿›è¡Œè¡¥å¿æ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æ¢å¤æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyService {
@Retryable(value = IOException.class, maxAttempts = 3)
public String readFile() throws IOException {
// å°è¯•è¯»å–æ–‡ä»¶
}
@Recover // å½“æ‰€æœ‰é‡è¯•å¤±è´¥åï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•
public String recover(IOException e) {
// é™çº§é€»è¾‘ï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªé»˜è®¤å†…å®¹æˆ–è®°å½•å‘Šè­¦
return &amp;#34;Default Content&amp;#34;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯é‡è¯•æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œè¿”å›ç±»å‹åº”ä¸é‡è¯•æ–¹æ³•ä¸€è‡´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4"&gt;&lt;strong&gt;4. &lt;code&gt;@CircuitBreaker&lt;/code&gt;- ç†”æ–­å™¨æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¯¹äºå¯èƒ½é•¿æ—¶é—´ä¸å¯ç”¨çš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;@CircuitBreaker&lt;/code&gt;å®ç°ç†”æ–­æ¨¡å¼ï¼Œé˜²æ­¢æŒç»­é‡è¯•æ¶ˆè€—èµ„æºã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@CircuitBreaker(
value = RemoteAccessException.class,
maxAttempts = 5, // åœ¨ç†”æ–­å‰å°è¯•çš„æ¬¡æ•°
openTimeout = 5000, // ç†”æ–­å™¨æ‰“å¼€åçš„æŒç»­æ—¶é—´(æ¯«ç§’)
resetTimeout = 10000 // ç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€å‰çš„ç­‰å¾…æ—¶é—´(æ¯«ç§’)
)
public void callUnstableService() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç†”æ–­å™¨å·¥ä½œæµç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­ï¼ˆClosedï¼‰&lt;/strong&gt;ï¼šæ­£å¸¸çŠ¶æ€ï¼Œå¤±è´¥æ¬¡æ•°æœªè¾¾é˜ˆå€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰“å¼€ï¼ˆOpenï¼‰&lt;/strong&gt;ï¼šå¤±è´¥æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼Œ&lt;strong&gt;çŸ­æ—¶é—´å†…æ‰€æœ‰è¯·æ±‚ç«‹å³å¤±è´¥ï¼Œä¸å†é‡è¯•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠå¼€ï¼ˆHalf-Openï¼‰&lt;/strong&gt;ï¼šç»è¿‡ &lt;code&gt;resetTimeout&lt;/code&gt;åï¼Œç†”æ–­å™¨å…è®¸å°‘é‡è¯·æ±‚é€šè¿‡ã€‚è‹¥æˆåŠŸåˆ™å…³é—­ç†”æ–­å™¨ï¼Œæ¢å¤å¸¸æ€ï¼›è‹¥å¤±è´¥åˆ™å†æ¬¡æ‰“å¼€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-è¿›é˜¶ç‰¹æ€§ä¸æœ€ä½³å®è·µ"&gt;ğŸ’¡ è¿›é˜¶ç‰¹æ€§ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring Framework 7.0 çš„å†…ç½®æ”¯æŒ&lt;/strong&gt;ï¼šä» Spring Framework 7.0 å¼€å§‹ï¼Œé‡è¯•å’Œå®¹é”™åŠŸèƒ½ï¼ˆåŒ…æ‹¬ &lt;code&gt;@Retryable&lt;/code&gt;å’Œæ–°çš„ &lt;code&gt;@ConcurrencyLimit&lt;/code&gt;ï¼‰å·²&lt;strong&gt;é›†æˆåˆ°æ¡†æ¶æ ¸å¿ƒæ¨¡å—ä¸­&lt;/strong&gt;ï¼Œæ— éœ€å•ç‹¬å¼•å…¥ &lt;code&gt;spring-retry&lt;/code&gt;ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@ConcurrencyLimit&lt;/code&gt;&lt;/strong&gt;ï¼šæ­¤æ³¨è§£å¯ç”¨äº&lt;strong&gt;é™åˆ¶æ–¹æ³•çš„å¹¶å‘è°ƒç”¨æ•°&lt;/strong&gt;ï¼Œé˜²æ­¢è¿‡è½½ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@ConcurrencyLimit(10) // æœ€å¤šå…è®¸10ä¸ªå¹¶å‘è¯·æ±‚
public void handleRequest() {
// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”å¼æ”¯æŒ&lt;/strong&gt;ï¼šSpring Retry ä¹Ÿæ”¯æŒå¯¹ Reactor ç­‰å“åº”å¼æµè¿›è¡Œé‡è¯•è£…é¥°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¢« &lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£çš„æ–¹æ³•å¿…é¡»æ˜¯ &lt;strong&gt;&lt;code&gt;public&lt;/code&gt;&lt;/strong&gt; çš„ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨&lt;strong&gt;åŒä¸€ä¸ªç±»å†…éƒ¨&lt;/strong&gt;è°ƒç”¨é‡è¯•æ–¹æ³•ï¼Œå› ä¸ºåŸºäºAOPçš„ä»£ç†å¯èƒ½ä¸ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;é‡è¯•é€»è¾‘ä¼š&lt;strong&gt;å¢åŠ å“åº”æ—¶é—´å’Œèµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼Œè¯·è°¨æ…è®¾ç½®é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿç­–ç•¥ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶éæ‰€æœ‰å¼‚å¸¸éƒ½é€‚åˆé‡è¯•ï¼ˆå¦‚ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼‰ï¼Œé‡è¯•åº”ä¸»è¦ç”¨äºå¤„ç†&lt;strong&gt;ç¬æ—¶æ•…éšœ&lt;/strong&gt;ï¼ˆç½‘ç»œè¶…æ—¶ã€æ•°æ®åº“è¿æ¥çŸ­æš‚å¤±æ•ˆç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spring Retry é€šè¿‡å£°æ˜å¼çš„æ³¨è§£ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥éå¸¸ç®€æ´å’Œæ¸…æ™°çš„æ–¹å¼ä¸ºæ–¹æ³•å¢æ·» resiliencyï¼ˆå¼¹æ€§ï¼‰èƒ½åŠ›ã€‚æ­£ç¡®é…ç½®å’Œä½¿ç”¨è¿™äº›æ³¨è§£ï¼Œèƒ½æ˜¾è‘—æå‡åº”ç”¨ç¨‹åºåº”å¯¹ä¸å¯é ä¾èµ–å’Œç½‘ç»œæ³¢åŠ¨çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨ Spring Retryã€‚&lt;/p&gt;
&lt;h2 id="recover"&gt;@Recover
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Recover&lt;/code&gt;æ³¨è§£çš„&lt;strong&gt;ç”Ÿæ•ˆèŒƒå›´ç¡®å®ä»…é™äºå®ƒæ‰€åœ¨çš„ç±»&lt;/strong&gt;ã€‚å®ƒåªèƒ½å¤„ç†&lt;strong&gt;åŒä¸€ä¸ªç±»ä¸­&lt;/strong&gt;è¢« &lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£æ ‡è®°çš„æ–¹æ³•åœ¨é‡è¯•å…¨éƒ¨å¤±è´¥åçš„æ¢å¤é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿç†è§£ &lt;code&gt;@Recover&lt;/code&gt;çš„å·¥ä½œè§„åˆ™ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ¦‚æ‹¬å…¶æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;è§„åˆ™è¯´æ˜&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹æˆ–å¤‡æ³¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å†…ç”Ÿæ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•&lt;strong&gt;å¿…é¡»&lt;/strong&gt;ä¸å¯¹åº”çš„ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•åœ¨&lt;strong&gt;åŒä¸€ä¸ªç±»&lt;/strong&gt;ä¸­å®šä¹‰ã€‚&lt;/td&gt;
&lt;td&gt;æ— æ³•æ•è·å’Œå¤„ç†å…¶ä»–ç±»ä¸­æ–¹æ³•çš„é‡è¯•å¤±è´¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸ç±»å‹åŒ¹é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°&lt;/strong&gt;å¿…é¡»æ˜¯ &lt;code&gt;Throwable&lt;/code&gt;ç±»å‹æˆ–å…¶å­ç±»ï¼Œä¸”é€šå¸¸åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•é…ç½®çš„å¼‚å¸¸ç±»å‹ä¸€è‡´æˆ–ä¸ºå…¶çˆ¶ç±»ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Retryable(value = IOException.class)&lt;/code&gt;å¯¹åº” &lt;code&gt;@Recover public void recover(IOException e)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‚æ•°åˆ—è¡¨åŒ¹é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„å‚æ•°ï¼ˆé™¤ç¬¬ä¸€ä¸ªå¼‚å¸¸å‚æ•°å¤–ï¼‰åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•çš„å‚æ•°&lt;strong&gt;ä¿æŒä¸€è‡´&lt;/strong&gt;ï¼ˆåŒ…æ‹¬å‚æ•°ç±»å‹å’Œé¡ºåºï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Retryable(String a, int b)&lt;/code&gt;å¯¹åº” &lt;code&gt;@Recover(...Exception e, String a, int b)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›å€¼åŒ¹é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;è¿”å›å€¼ç±»å‹&lt;/strong&gt;å¿…é¡»ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•çš„è¿”å›å€¼ç±»å‹&lt;strong&gt;å®Œå…¨ç›¸åŒ&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;td&gt;å¦‚æœ &lt;code&gt;@Retryable&lt;/code&gt;è¿”å› &lt;code&gt;String&lt;/code&gt;ï¼Œ&lt;code&gt;@Recover&lt;/code&gt;ä¹Ÿå¿…é¡»è¿”å› &lt;code&gt;String&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ–¹æ³•åŒ¹é…ä¼˜å…ˆçº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å½“æœ‰å¤šä¸ª &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ—¶ï¼ŒSpring Retry ä¼šé€‰æ‹©&lt;strong&gt;å¼‚å¸¸ç±»å‹æœ€å…·ä½“ã€å‚æ•°æœ€å…¼å®¹&lt;/strong&gt;çš„é‚£ä¸ªã€‚&lt;/td&gt;
&lt;td&gt;è‹¥æœ‰ &lt;code&gt;recover(IOException e)&lt;/code&gt;å’Œ &lt;code&gt;recover(Exception e)&lt;/code&gt;ï¼Œå½“æŠ›å‡º &lt;code&gt;IOException&lt;/code&gt;æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‰è€…ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;å¦‚ä½•æ­£ç¡®ä½¿ç”¨ &lt;code&gt;@Recover&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç¡®ä¿ &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æŒ‰é¢„æœŸå·¥ä½œï¼Œéœ€æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç±»å†…å®šä¹‰&lt;/strong&gt;ï¼š&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•å¿…é¡»å’Œå®ƒè¦å¤„ç†çš„ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•åœ¨&lt;strong&gt;åŒä¸€ä¸ªç±»ä¸­&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°åŒ¹é…&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œä¸”åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;ä¸­æŒ‡å®šçš„å¼‚å¸¸ç±»å‹åŒ¹é…æˆ–æ›´é€šç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åç»­å‚æ•°åº”ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´&lt;/strong&gt;ï¼ˆåŒ…æ‹¬ç±»å‹å’Œé¡ºåºï¼‰ã€‚ä½ å¯ä»¥é€‰æ‹©æ¥æ”¶æ‰€æœ‰å‚æ•°ï¼Œæˆ–åªæ¥æ”¶éœ€è¦çš„éƒ¨åˆ†ï¼Œä½†&lt;strong&gt;é¡ºåºå¿…é¡»ä¸€è‡´&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼åŒ¹é…&lt;/strong&gt;ï¼š&lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•çš„&lt;strong&gt;è¿”å›ç±»å‹å¿…é¡»ä¸ &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•å®Œå…¨ç›¸åŒ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ§© &lt;strong&gt;åŒä¸€ç±»ä¸­æœ‰å¤šä¸ª &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ—¶å¦‚ä½•åŒºåˆ†ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ª &lt;code&gt;@Retryable&lt;/code&gt;å’Œ &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ—¶ï¼ŒSpring Retry é€šè¿‡&lt;strong&gt;å¼‚å¸¸ç±»å‹&lt;/strong&gt;å’Œ&lt;strong&gt;æ–¹æ³•å‚æ•°&lt;/strong&gt;æ¥åŒ¹é…ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyService {
@Retryable(value = IOException.class, maxAttempts = 3)
public String methodA(String fileName) throws IOException {
// å°è¯•è¯»å–æ–‡ä»¶ï¼Œå¯èƒ½æŠ›å‡ºIOException
return &amp;#34;Content from &amp;#34; + fileName;
}
@Retryable(value = SQLException.class, maxAttempts = 3)
public void methodB(Integer id) throws SQLException {
// æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½æŠ›å‡ºSQLException
}
// åŒ¹é…methodAçš„æ¢å¤æ–¹æ³•
@Recover
public String recoverForIOException(IOException e, String fileName) {
return &amp;#34;Recovered from IOException for file: &amp;#34; + fileName + &amp;#34;; Error: &amp;#34; + e.getMessage();
}
// åŒ¹é…methodBçš„æ¢å¤æ–¹æ³•
@Recover
public void recoverForSQLException(SQLException e, Integer id) {
// å¤„ç†SQLExceptionçš„æ¢å¤é€»è¾‘ï¼Œè®°å½•æ—¥å¿—ç­‰
System.out.println(&amp;#34;Recovered from SQLException for ID: &amp;#34; + id);
}
// ä¸€ä¸ªæ›´é€šç”¨çš„æ¢å¤æ–¹æ³•ï¼Œå¤„ç†å…¶ä»–æœªæ˜ç¡®æŒ‡å®šçš„å¼‚å¸¸
@Recover
public String genericRecover(Exception e, Object... args) {
// å¤„ç†å…¶ä»–å¼‚å¸¸æˆ–ä½œä¸ºå…œåº•
return &amp;#34;Generic recovery after all retries failed for: &amp;#34; + e.getMessage();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ &lt;code&gt;methodA&lt;/code&gt;é‡è¯•å¤±è´¥åï¼Œä¼šè°ƒç”¨ &lt;code&gt;recoverForIOException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å½“ &lt;code&gt;methodB&lt;/code&gt;é‡è¯•å¤±è´¥åï¼Œä¼šè°ƒç”¨ &lt;code&gt;recoverForSQLException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰ä¸€ä¸ª &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸æœªè¢«å‰ä¸¤ä¸ª &lt;code&gt;@Recover&lt;/code&gt;æ–¹æ³•æ˜ç¡®åŒ¹é…ï¼Œä¸”å…¶å‚æ•°ä¸ &lt;code&gt;genericRecover&lt;/code&gt;å…¼å®¹ï¼ˆæ³¨æ„å®ƒæ˜¯ &lt;code&gt;Object... args&lt;/code&gt;ï¼‰ï¼Œåˆ™å¯èƒ½ä¼šè°ƒç”¨ &lt;code&gt;genericRecover&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è‡ªè°ƒç”¨&lt;/strong&gt;ï¼šç”±äº &lt;code&gt;@Retryable&lt;/code&gt;å’Œ &lt;code&gt;@Recover&lt;/code&gt;åŸºäº &lt;strong&gt;Spring AOP ä»£ç†&lt;/strong&gt;å®ç°ï¼Œæ‰€ä»¥&lt;strong&gt;åœ¨åŒä¸€ä¸ªç±»å†…éƒ¨çš„ä¸€ä¸ªæ–¹æ³•ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ª &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œé‡è¯•å’Œæ¢å¤é€»è¾‘ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚åŠ¡å¿…é€šè¿‡å¤–éƒ¨è°ƒç”¨æˆ–ä»Springå®¹å™¨ä¸­è·å–ä»£ç†åçš„Beanæ¥è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿å¹‚ç­‰æ€§&lt;/strong&gt;ï¼šç”±äºæ–¹æ³•ä¼šè¢«å¤šæ¬¡é‡è¯•ï¼ŒåŠ¡å¿…ä¿è¯ &lt;code&gt;@Retryable&lt;/code&gt;æ ‡è®°çš„æ–¹æ³•çš„&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼Œå³å¤šæ¬¡æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…è®¾ç½®é‡è¯•&lt;/strong&gt;ï¼šé¿å…æ— é™é‡è¯•æˆ–é‡è¯•é—´éš”è¿‡çŸ­ï¼Œä»¥å…å¯¹ä¸‹æ¸¸æœåŠ¡é€ æˆè¿‡å¤§å‹åŠ›ã€‚é‡è¯•é€‚ç”¨äº&lt;strong&gt;ä¸´æ—¶æ€§æ•…éšœ&lt;/strong&gt;ï¼ˆå¦‚ç½‘ç»œæ³¢åŠ¨ã€ç¬æ—¶è¶…æ—¶ï¼‰ï¼Œè€Œéä¸šåŠ¡é€»è¾‘é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@Recover&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="ç±»çº§-retryable"&gt;ç±»çº§ Retryable
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£&lt;strong&gt;å¯ä»¥æ·»åŠ åˆ°ç±»ä¸Š&lt;/strong&gt;ã€‚å½“å®ƒç”¨äºç±»çº§åˆ«æ—¶ï¼Œè¡¨ç¤º&lt;strong&gt;è¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;éƒ½ä¼šæˆä¸ºå¯é‡è¯•çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿäº†è§£ &lt;code&gt;@Retryable&lt;/code&gt;åœ¨æ–¹æ³•çº§åˆ«å’Œç±»çº§åˆ«åº”ç”¨çš„ä¸»è¦åŒºåˆ«ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;æ–¹æ³•çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨èŒƒå›´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…ä½œç”¨äºè¢«æ³¨è§£çš„&lt;strong&gt;å•ä¸ªæ–¹æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½œç”¨äºè¯¥ç±»çš„&lt;strong&gt;æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯ä»¥ä¸º&lt;strong&gt;æ¯ä¸ªæ–¹æ³•å•ç‹¬å®šåˆ¶&lt;/strong&gt;é‡è¯•ç­–ç•¥ï¼ˆå¼‚å¸¸ã€æ¬¡æ•°ã€å»¶è¿Ÿç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸ºè¯¥ç±»æ‰€æœ‰æ–¹æ³•æä¾›&lt;strong&gt;ç»Ÿä¸€çš„é»˜è®¤é‡è¯•ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦ä¸ºä¸åŒæ–¹æ³•è®¾ç½®ä¸åŒé‡è¯•è§„åˆ™æ—¶&lt;/td&gt;
&lt;td&gt;ç±»ä¸­å¤šä¸ªæ–¹æ³•éœ€è¦&lt;strong&gt;å…±äº«ç›¸åŒ&lt;/strong&gt;çš„é‡è¯•ç­–ç•¥æ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶ç²¾åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ï¼Œå¯ç²¾å‡†æ§åˆ¶æ¯ä¸ªæ–¹æ³•çš„è¡Œä¸º&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç›¸å¯¹è¾ƒä½&lt;/strong&gt;ï¼Œä¾èµ–ç±»çº§åˆ«çš„ç»Ÿä¸€é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸ç”¨å±æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;value&lt;/code&gt;, &lt;code&gt;include&lt;/code&gt;, &lt;code&gt;exclude&lt;/code&gt;, &lt;code&gt;maxAttempts&lt;/code&gt;, &lt;code&gt;backoff&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;include&lt;/code&gt;, &lt;code&gt;exclude&lt;/code&gt;, &lt;code&gt;maxAttempts&lt;/code&gt;, &lt;code&gt;delay&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;ç±»çº§åˆ«ä½¿ç”¨ç¤ºä¾‹ä¸è¦ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
@Retryable(maxAttempts = 3, backoff = @Backoff(delay = 1000)) // åº”ç”¨äºæ•´ä¸ªç±»
public class MyService {
// æ­¤æ–¹æ³•ä¼šç»§æ‰¿ç±»çº§åˆ«çš„é‡è¯•é…ç½®ï¼šæœ€å¤šé‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”1ç§’
public void methodOne() {
// ... å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
}
// æ­¤æ–¹æ³•ä¹Ÿä¼šç»§æ‰¿ç±»çº§åˆ«çš„é‡è¯•é…ç½®
public void methodTwo() {
// ... å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
}
// å³ä½¿ç±»çº§åˆ«æœ‰é…ç½®ï¼Œæ–¹æ³•çº§åˆ«çš„æ³¨è§£ä¹Ÿä¼šè¦†ç›–ç±»çº§åˆ«çš„é…ç½®ã€‚æ­¤æ–¹æ³•ä¼šä½¿ç”¨è‡ªå·±çš„é‡è¯•ç­–ç•¥ï¼šæœ€å¤šé‡è¯•5æ¬¡
@Retryable(maxAttempts = 5)
public void methodThree() {
// ... å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;âš¡ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åªå¯¹ public æ–¹æ³•ç”Ÿæ•ˆ&lt;/strong&gt;ï¼šSpring Retry åŸºäº AOP å®ç°ï¼Œå› æ­¤ &lt;code&gt;@Retryable&lt;/code&gt;ï¼ˆæ— è®ºæ˜¯ç±»çº§åˆ«è¿˜æ˜¯æ–¹æ³•çº§åˆ«ï¼‰&lt;strong&gt;åªå¯¹ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•æœ‰æ•ˆ&lt;/strong&gt;ã€‚å¯¹ &lt;code&gt;protected&lt;/code&gt;ã€&lt;code&gt;private&lt;/code&gt;æˆ–é»˜è®¤æƒé™çš„æ–¹æ³•æ— æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åŒç±»è°ƒç”¨&lt;/strong&gt;ï¼šå¦‚æœä¸€ä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodA&lt;/code&gt;ï¼‰&lt;strong&gt;ç›´æ¥è°ƒç”¨&lt;/strong&gt;äº†åŒä¸€ä¸ªç±»ä¸­çš„å¦ä¸€ä¸ª &lt;code&gt;@Retryable&lt;/code&gt;æ–¹æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;methodB&lt;/code&gt;ï¼‰ï¼Œé‚£ä¹ˆ &lt;code&gt;methodB&lt;/code&gt;çš„é‡è¯•é€»è¾‘&lt;strong&gt;ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸º Spring AOP ä»£ç†æœºåˆ¶çš„é™åˆ¶ã€‚è°ƒç”¨å¿…é¡»é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œï¼Œé€šå¸¸æ„å‘³ç€æ–¹æ³•éœ€è¦è¢«å¤–éƒ¨ç±»è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…é…ç½®å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼šåœ¨ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨ &lt;code&gt;include&lt;/code&gt;æˆ– &lt;code&gt;exclude&lt;/code&gt;ç»†åŒ–å¼‚å¸¸ç±»å‹ï¼Œé»˜è®¤å¯èƒ½ä¼šå¯¹è®¸å¤šå¼‚å¸¸è¿›è¡Œé‡è¯•ã€‚å»ºè®®&lt;strong&gt;æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œä½¿ç”¨ &lt;code&gt;include&lt;/code&gt;æˆ– &lt;code&gt;exclude&lt;/code&gt;å±æ€§æ¥æ˜ç¡®æŒ‡å®šéœ€è¦æˆ–ä¸éœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œä»¥é¿å…å¯¹ä¸æœŸæœ›çš„å¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;NullPointerException&lt;/code&gt;ç­‰ä»£ç é”™è¯¯ï¼‰è¿›è¡Œé‡è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å®ç”¨å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«é€šç”¨é…ç½®&lt;/strong&gt;ï¼šå¦‚æœä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ–¹æ³•éœ€è¦&lt;strong&gt;ç›¸åŒçš„é‡è¯•ç­–ç•¥&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨åŒä¸€ä¸ªä¸ç¨³å®šå¤–éƒ¨æœåŠ¡çš„å¤šä¸ªæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆåœ¨ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;éå¸¸æ–¹ä¾¿ï¼Œèƒ½é¿å…é‡å¤é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦ç‰¹ä¾‹æ—¶è¦†å†™&lt;/strong&gt;ï¼šå¦‚æœç±»ä¸­å¤§å¤šæ•°æ–¹æ³•é€‚ç”¨é€šç”¨é‡è¯•ç­–ç•¥ï¼Œä½†å°‘æ•°æ–¹æ³•éœ€è¦ç‰¹æ®Šé…ç½®ï¼Œä½ å¯ä»¥åœ¨ç±»çº§åˆ«å®šä¹‰é€šç”¨è§„åˆ™ï¼Œç„¶ååœ¨é‚£äº›éœ€è¦å®šåˆ¶çš„æ–¹æ³•ä¸Šå•ç‹¬ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;è¿›è¡Œè¦†ç›–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®å¼‚å¸¸èŒƒå›´&lt;/strong&gt;ï¼šåœ¨ç±»çº§åˆ«ä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;æ—¶ï¼Œ&lt;strong&gt;å¼ºçƒˆå»ºè®®é€šè¿‡ &lt;code&gt;include&lt;/code&gt;æˆ– &lt;code&gt;exclude&lt;/code&gt;å±æ€§æ˜ç¡®æŒ‡å®šè¦é‡è¯•æˆ–æ’é™¤çš„å¼‚å¸¸ç±»å‹&lt;/strong&gt;ï¼Œä»¥å¢å¼ºä»£ç çš„å¯æ§æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;@Retryable&lt;/code&gt;æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="ç¼“å­˜"&gt;ç¼“å­˜
&lt;/h2&gt;&lt;h2 id="ç±»çº§ç¼“å­˜"&gt;ç±»çº§ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶çš„ç¼“å­˜æ³¨è§£ä¸­ï¼Œä¸»è¦æœ‰ &lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt; å’Œ &lt;strong&gt;&lt;code&gt;@CachePut&lt;/code&gt;&lt;/strong&gt; è¿™ä¸¤ä¸ªæ³¨è§£æ—¢å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ ‡æ³¨åœ¨ç±»ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿäº†è§£è¿™äº›æ³¨è§£åœ¨ç±»å’Œæ–¹æ³•ä¸Šçš„ä½¿ç”¨ç‰¹ç‚¹ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;ç±»çº§åˆ«ä½¿ç”¨&lt;/th&gt;
&lt;th&gt;æ–¹æ³•çº§åˆ«ä½¿ç”¨&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Cacheable&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥&lt;strong&gt;ç±»æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;çš„æ”¯æŒç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯æ”¯æŒç¼“å­˜çš„ã€‚&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«å¯ä¸ºæ‰€æœ‰æ–¹æ³•æä¾›&lt;strong&gt;é»˜è®¤ç¼“å­˜è¡Œä¸º&lt;/strong&gt;ï¼Œæ–¹æ³•çº§åˆ«æ³¨è§£å¯&lt;strong&gt;è¦†ç›–&lt;/strong&gt;ç±»çº§åˆ«çš„å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CachePut&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥&lt;strong&gt;ç±»æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;çš„æ‰§è¡Œç»“æœéƒ½ä¼šæ›´æ–°ç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºè¯¥æ–¹æ³•çš„æ‰§è¡Œç»“æœä¼šæ›´æ–°ç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«å¯ä¸ºæ‰€æœ‰æ–¹æ³•æä¾›&lt;strong&gt;é»˜è®¤ç¼“å­˜æ›´æ–°è¡Œä¸º&lt;/strong&gt;ï¼Œæ–¹æ³•çº§åˆ«æ³¨è§£å¯&lt;strong&gt;è¦†ç›–&lt;/strong&gt;ç±»çº§åˆ«çš„å®šä¹‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CacheEvict&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ï¼ˆç”±æºç å¯å¾—å¯ç±»çº§åˆ«ï¼‰&lt;/td&gt;
&lt;td&gt;ç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œåï¼ˆæˆ–ä¹‹å‰ï¼‰æ¸…é™¤ç¼“å­˜ã€‚&lt;/td&gt;
&lt;td&gt;é€šå¸¸ç”¨äºæ–¹æ³•çº§åˆ«ï¼Œä»¥ç²¾ç¡®æ§åˆ¶ç¼“å­˜æ¸…é™¤æ“ä½œã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Caching&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ï¼ˆç”±æºç å¯å¾—å¯ç±»çº§åˆ«ï¼‰&lt;/td&gt;
&lt;td&gt;ç”¨äºç»„åˆå¤šä¸ªç¼“å­˜æ“ä½œï¼ˆå¦‚åŒæ—¶ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt;ã€&lt;code&gt;@CachePut&lt;/code&gt;ã€&lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰äºä¸€ä¸ªæ–¹æ³•ã€‚&lt;/td&gt;
&lt;td&gt;é€šå¸¸ç”¨äºæ–¹æ³•çº§åˆ«ï¼Œå¤„ç†å¤æ‚çš„ç¼“å­˜é€»è¾‘ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºç±»çº§åˆ«ï¼Œ&lt;strong&gt;å…±äº«&lt;/strong&gt;ç¼“å­˜é…ç½®ï¼ˆå¦‚ &lt;code&gt;cacheNames&lt;/code&gt;ã€&lt;code&gt;keyGenerator&lt;/code&gt;ï¼‰ï¼Œç®€åŒ–æ–¹æ³•çº§åˆ«æ³¨è§£çš„é…ç½®ã€‚&lt;/td&gt;
&lt;td&gt;ä¸ç›´æ¥ç”¨äºæ–¹æ³•ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯ä¸€ä¸ª&lt;strong&gt;ç±»çº§åˆ«&lt;/strong&gt;çš„é…ç½®æ³¨è§£ï¼Œæ—¨åœ¨å‡å°‘æ–¹æ³•çº§åˆ«æ³¨è§£çš„é‡å¤é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;è¡¥å……è¯´æ˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„&lt;strong&gt;ç±»çº§åˆ«æ³¨è§£&lt;/strong&gt;ï¼Œå®ƒæœ¬èº«ä¸ç›´æ¥è§¦å‘ä»»ä½•ç¼“å­˜æ“ä½œï¼Œè€Œæ˜¯ä¸ºç±»ä¸­çš„å…¶ä»–ç¼“å­˜æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Cacheable&lt;/code&gt;, &lt;code&gt;@CachePut&lt;/code&gt;, &lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰æä¾›&lt;strong&gt;å…±äº«çš„é»˜è®¤é…ç½®&lt;/strong&gt;ï¼Œä»è€Œé¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šé‡å¤ç›¸åŒçš„é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å®ç”¨å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨ç±»çº§åˆ«æ³¨è§£&lt;/strong&gt;ï¼šåœ¨ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt;æˆ– &lt;code&gt;@CachePut&lt;/code&gt;æ„å‘³ç€è¯¥ç±»çš„&lt;strong&gt;æ‰€æœ‰ &lt;code&gt;public&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;éƒ½å°†åº”ç”¨ç¼“å­˜è§„åˆ™ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸€äº›ä¸éœ€è¦ç¼“å­˜çš„æ–¹æ³•ï¼ˆå¦‚ç®€å•æŸ¥è¯¢ã€é¢‘ç¹æ›´æ–°æ–¹æ³•ï¼‰ä¹Ÿè¢«ç¼“å­˜ï¼Œä»è€Œ&lt;strong&gt;æµªè´¹èµ„æºæˆ–äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´&lt;/strong&gt;ã€‚é€šå¸¸å»ºè®®æ ¹æ®å®é™…éœ€æ±‚ï¼Œåœ¨å…·ä½“æ–¹æ³•ä¸Šä½¿ç”¨ç›¸åº”çš„ç¼“å­˜æ³¨è§£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“æ–¹æ³•çº§åˆ«å’Œç±»çº§åˆ«éƒ½æœ‰ç›¸åŒç±»å‹çš„ç¼“å­˜æ³¨è§£æ—¶ï¼Œ&lt;strong&gt;æ–¹æ³•çº§åˆ«çš„æ³¨è§£é…ç½®ä¼šè¦†ç›–ç±»çº§åˆ«çš„é»˜è®¤é…ç½®&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;@CacheConfig&lt;/code&gt;&lt;/strong&gt;ï¼šä¸ºäº†ä¿æŒä»£ç ç®€æ´ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;@CacheConfig&lt;/code&gt;åœ¨ç±»çº§åˆ«å®šä¹‰ä¸€äº›é€šç”¨çš„ç¼“å­˜è®¾ç½®ï¼ˆå¦‚ &lt;code&gt;cacheNames&lt;/code&gt;ï¼‰ï¼Œç„¶ååœ¨æ–¹æ³•çº§åˆ«çš„æ³¨è§£ä¸­åªéœ€æŒ‡å®šå¿…è¦çš„å±æ€§ï¼ˆå¦‚ &lt;code&gt;key&lt;/code&gt;æˆ– &lt;code&gt;condition&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Spring ç¼“å­˜æ³¨è§£ã€‚&lt;/p&gt;
&lt;h2 id="goaway"&gt;GOAWAY
&lt;/h2&gt;&lt;p&gt;å½“ä½ ä½œä¸ºå®¢æˆ·ç«¯è°ƒç”¨å¤§æ¨¡å‹æ¥å£é‡åˆ°æœåŠ¡ç«¯è¿”å› &lt;code&gt;GOAWAY received&lt;/code&gt;é”™è¯¯æ—¶ï¼Œè¿™é€šå¸¸æ˜¯HTTP/2åè®®å±‚é¢è¿æ¥ç®¡ç†çš„è¡Œä¸ºã€‚æˆ‘æ¥ä¸ºä½ è§£é‡ŠåŸå› å’Œåº”å¯¹æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id="-äº†è§£-goaway-å¸§"&gt;ğŸ” äº†è§£ GOAWAY å¸§
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;GOAWAY&lt;/code&gt;å¸§æ˜¯ &lt;strong&gt;HTTP/2 åè®®ä¸­ç”¨äºæ­£å¸¸å…³é—­è¿æ¥çš„ä¿¡å·&lt;/strong&gt; ã€‚æœåŠ¡ç«¯å‘é€å®ƒæ¥å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼šâ€œå½“å‰è¿æ¥å³å°†å…³é—­ï¼Œè¯·åœæ­¢åœ¨æ­¤è¿æ¥ä¸Šå‘èµ·æ–°è¯·æ±‚ï¼Œä½†ä¼šå¤„ç†å®Œå·²å‘å‡ºçš„è¯·æ±‚â€ã€‚è¿™é€šå¸¸æ˜¯&lt;strong&gt;æœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·çš„è¡Œä¸º&lt;/strong&gt;ï¼Œå¸¸è§äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç«¯ç»´æŠ¤æˆ–é‡å¯&lt;/strong&gt;ï¼šæœåŠ¡ç«¯è®¡åˆ’åœæœºå‰ï¼Œå‘é€GOAWAYå¸§é€šçŸ¥å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿å…¶åˆ‡æ¢åˆ°æ–°è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ä¸è¿æ¥ç®¡ç†&lt;/strong&gt;ï¼šæœåŠ¡ç«¯å¯èƒ½ä¸ºäº†è´Ÿè½½å‡è¡¡æˆ–è¿æ¥ç»´æŠ¤ï¼ˆå¦‚å®šæœŸç»ˆæ­¢è¿æ¥ä»¥åˆ·æ–°ï¼‰è€Œå…³é—­è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å™¨ç«¯é™åˆ¶&lt;/strong&gt;ï¼šä¾‹å¦‚ï¼ŒNginx çš„ &lt;code&gt;http2_max_requests&lt;/code&gt;å‚æ•°é»˜è®¤å…è®¸ä¸€ä¸ªè¿æ¥ä¸Šæœ€å¤šå¤„ç†1000ä¸ªè¯·æ±‚ï¼Œä¹‹åä¼šå‘é€GOAWAYå¸§å…³é—­è¿æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å®¢æˆ·ç«¯çš„å¤„ç†ç­–ç•¥"&gt;ğŸ› ï¸ å®¢æˆ·ç«¯çš„å¤„ç†ç­–ç•¥
&lt;/h3&gt;&lt;p&gt;ä½œä¸ºå®¢æˆ·ç«¯ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åº”å¯¹ &lt;code&gt;GOAWAY&lt;/code&gt;é”™è¯¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é‡è¯•è¯·æ±‚&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€ç›´æ¥å’Œå¸¸è§çš„å¤„ç†æ–¹å¼ã€‚å½“æ•è·åˆ°åŒ…å« &amp;ldquo;GOAWAY&amp;rdquo; ä¿¡æ¯çš„ &lt;code&gt;IOException&lt;/code&gt;æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥&lt;strong&gt;è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚&lt;/strong&gt;ã€‚å¯¹äº &lt;strong&gt;å¹‚ç­‰æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚GETè¯·æ±‚ï¼‰ï¼Œé‡è¯•æ˜¯å®‰å…¨çš„ã€‚å¯¹äº&lt;strong&gt;éå¹‚ç­‰æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚POSTï¼‰ï¼Œè™½ç„¶éœ€è°¨æ…ï¼Œä½†è‹¥GOAWAYå¸§è¡¨æ˜è¯·æ±‚æœªè¢«å¤„ç†ï¼Œé‡è¯•é€šå¸¸ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚Java HttpClient ç­‰åº“åœ¨æ”¶åˆ°GOAWAYå¸§æ—¶å¯èƒ½ä¼šæŠ›å‡ºIOExceptionï¼Œå…¶æ¶ˆæ¯å¯èƒ½åŒ…å«&amp;quot;GOAWAY received&amp;quot;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å»ºè¿æ¥&lt;/strong&gt;ï¼šHTTP/2å®¢æˆ·ç«¯åœ¨æ”¶åˆ°GOAWAYå¸§åï¼Œ&lt;strong&gt;åº”ä¸»åŠ¨å»ºç«‹æ–°çš„è¿æ¥&lt;/strong&gt;ä»¥ä¾›åç»­è¯·æ±‚ä½¿ç”¨ã€‚ä¸€äº›HTTP/2å®¢æˆ·ç«¯åº“å¯èƒ½ä¼šè‡ªåŠ¨å¤„ç†æ­¤è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨è¿æ¥æ± å¹¶ç›‘æ§çŠ¶æ€&lt;/strong&gt;ï¼šå¯¹äºé¢‘ç¹è°ƒç”¨æœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œå®ç°&lt;strong&gt;è¿æ¥æ± ç®¡ç†&lt;/strong&gt;æœ‰åŠ©äºä¼˜åŒ–èµ„æºã€‚åŒæ—¶ï¼Œå¯ä»¥&lt;strong&gt;ç›‘æ§è¿æ¥çŠ¶æ€&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼ŒgRPC Javaåº“å…è®¸æŸ¥è¯¢Channelçš„çŠ¶æ€ï¼Œè‹¥è¿æ¥å› GOAWAYè¿›å…¥æ•…éšœçŠ¶æ€ï¼Œå¯æ‰‹åŠ¨è§¦å‘é‡å»ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜é›…é™çº§ä¸è¶…æ—¶æ§åˆ¶&lt;/strong&gt;ï¼šå¦‚æœæœåŠ¡ç«¯é¢‘ç¹å‘é€GOAWAYï¼ˆå¦‚ç”±äºè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰ï¼Œç¡®ä¿å®¢æˆ·ç«¯æœ‰&lt;strong&gt;é‡è¯•æ¬¡æ•°é™åˆ¶&lt;/strong&gt;å’Œ&lt;strong&gt;è¶…æ—¶æœºåˆ¶&lt;/strong&gt;ï¼Œé¿å…æ— é™é‡è¯•æˆ–é•¿æ—¶é—´ç­‰å¾…ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹è¡¨æ±‡æ€»äº†å…³é”®å¤„ç†ç­–ç•¥å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¤„ç†ç­–ç•¥&lt;/th&gt;
&lt;th&gt;å…·ä½“åšæ³•&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨é‡è¯•è¯·æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•è·GOAWAYé”™è¯¯åï¼Œé‡è¯•å¤±è´¥çš„è¯·æ±‚ã€‚&lt;/td&gt;
&lt;td&gt;å¹‚ç­‰æ“ä½œï¼ˆGETï¼‰å¯å®‰å…¨é‡è¯•ï¼›éå¹‚ç­‰æ“ä½œï¼ˆPOSTï¼‰éœ€è°¨æ…ï¼Œç¡®è®¤è¯·æ±‚æœªè¢«å¤„ç†æ–¹å¯é‡è¯•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é‡å»ºè¿æ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;HTTP/2å®¢æˆ·ç«¯æ”¶åˆ°GOAWAYåï¼Œåº”å»ºç«‹æ–°è¿æ¥ä»¥ä¾›åç»­è¯·æ±‚ä½¿ç”¨ã€‚&lt;/td&gt;
&lt;td&gt;æŸäº›HTTP/2å®¢æˆ·ç«¯åº“å¯èƒ½è‡ªåŠ¨å¤„ç†æ­¤è¿‡ç¨‹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½¿ç”¨è¿æ¥æ± ä¸ç›‘æ§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°è¿æ¥æ± ç®¡ç†ï¼›ç›‘æ§è¿æ¥çŠ¶æ€ï¼ˆå¦‚gRPC ChannelçŠ¶æ€ï¼‰ï¼Œè¿æ¥æ•…éšœæ—¶æ‰‹åŠ¨é‡å»ºã€‚&lt;/td&gt;
&lt;td&gt;æœ‰åŠ©äºä¼˜åŒ–èµ„æºå’Œä½¿ç”¨ï¼›éœ€è¦å®¢æˆ·ç«¯å…·å¤‡çŠ¶æ€æŸ¥è¯¢èƒ½åŠ›ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼˜é›…é™çº§ä¸è¶…æ—¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è®¾ç½®é‡è¯•æ¬¡æ•°ä¸Šé™å’Œè¶…æ—¶æ—¶é—´ï¼Œé¿å…æ— é™é‡è¯•æˆ–é•¿æ—¶é—´ç­‰å¾…ã€‚&lt;/td&gt;
&lt;td&gt;é˜²æ­¢å› æœåŠ¡ç«¯æŒç»­GOAWAYå¯¼è‡´å®¢æˆ·ç«¯èµ„æºè€—å°½æˆ–å“åº”ç¼“æ…¢ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ’æŸ¥å…¶ä»–æ½œåœ¨é—®é¢˜"&gt;ğŸ” æ’æŸ¥å…¶ä»–æ½œåœ¨é—®é¢˜
&lt;/h3&gt;&lt;p&gt;å¦‚æœGOAWAYå¸§ä¼´éšç‰¹å®šçš„é”™è¯¯ç ï¼ˆè€Œä¸ä»…ä»…æ˜¯è¿æ¥å…³é—­ï¼‰ï¼Œæˆ–è€…é—®é¢˜æŒç»­å‡ºç°ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥æœåŠ¡å™¨ç«¯é…ç½®ä¸çŠ¶æ€&lt;/strong&gt;ï¼šæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€HTTP/2è¿æ¥çš„ç›¸å…³é…ç½®ï¼ˆå¦‚æœ€å¤§è¯·æ±‚æ•°ã€æœ€å¤§è¿æ¥å¹´é¾„ï¼‰å¯èƒ½è§¦å‘GOAWAYã€‚å…³æ³¨æœåŠ¡ç«¯çš„ç»´æŠ¤å…¬å‘Šæˆ–çŠ¶æ€é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¡æŸ¥è¯·æ±‚å†…å®¹&lt;/strong&gt;ï¼šè™½ç„¶è¾ƒå°‘è§ï¼Œä½†æŸäº›åè®®é”™è¯¯ï¼ˆå¦‚è¯·æ±‚å¤´è¿‡å¤§ï¼‰ä¹Ÿå¯èƒ½å¯¼è‡´æœåŠ¡ç«¯å‘é€é”™è¯¯ç ä¸º&lt;code&gt;PROTOCOL_ERROR&lt;/code&gt;çš„GOAWAYå¸§ã€‚ç¡®ä¿è¯·æ±‚ç¬¦åˆHTTP/2è§„èŒƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ç®€è¦æ€»ç»“-1"&gt;ğŸ’ ç®€è¦æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é‡åˆ° &lt;code&gt;GOAWAY received&lt;/code&gt;é”™è¯¯æ—¶ï¼Œ&lt;strong&gt;å®¢æˆ·ç«¯åº”è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ï¼ˆæ³¨æ„å¹‚ç­‰æ€§ï¼‰ï¼Œå¹¶ç¡®ä¿èƒ½å»ºç«‹æ–°çš„HTTP/2è¿æ¥&lt;/strong&gt;ã€‚å¤šæ•°ç°ä»£HTTPå®¢æˆ·ç«¯åº“èƒ½ä¸€å®šç¨‹åº¦å¤„ç†GOAWAYå¸§ã€‚è‹¥é—®é¢˜é¢‘å‘ï¼Œéœ€æ£€æŸ¥æœåŠ¡ç«¯é…ç½®å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ è§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="synchronized--reentrantlock"&gt;synchronized &amp;amp; ReentrantLock
&lt;/h2&gt;&lt;p&gt;äº†è§£ &lt;code&gt;synchronized&lt;/code&gt;å’Œ &lt;code&gt;ReentrantLock&lt;/code&gt;åœ¨é”å®šä»£ç å—æ—¶çš„åŒºåˆ«ï¼Œå¯¹äºç¼–å†™æ­£ç¡®ã€é«˜æ•ˆçš„å¤šçº¿ç¨‹ç¨‹åºå¾ˆé‡è¦ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;synchronized&lt;/th&gt;
&lt;th&gt;ReentrantLock&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸºæœ¬æ€§è´¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Javaå…³é”®å­—ï¼ŒJVMåŸç”Ÿæ”¯æŒ****&lt;/td&gt;
&lt;td&gt;&lt;code&gt;java.util.concurrent.locks&lt;/code&gt;åŒ…ä¸­çš„ç±»****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é”ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;éšå¼&lt;/strong&gt;ç®¡ç†ï¼Œè¿›å…¥ä»£ç å—è‡ªåŠ¨åŠ é”ï¼Œé€€å‡ºï¼ˆæ­£å¸¸æˆ–å¼‚å¸¸ï¼‰è‡ªåŠ¨é‡Šæ”¾é”****&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¾å¼&lt;/strong&gt;ç®¡ç†ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;lock()&lt;/code&gt;å’Œ &lt;code&gt;unlock()&lt;/code&gt;**ï¼Œ&lt;strong&gt;é€šå¸¸å¿…é¡»åœ¨ &lt;code&gt;finally&lt;/code&gt;å—ä¸­é‡Šæ”¾é”ä»¥é¿å…æ­»é”&lt;/strong&gt;**&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¬å¹³æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒ&lt;strong&gt;éå…¬å¹³&lt;/strong&gt;é”****&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;strong&gt;å…¬å¹³é”&lt;/strong&gt;ï¼ˆ&lt;code&gt;new ReentrantLock(true)&lt;/code&gt;ï¼‰å’Œ&lt;strong&gt;éå…¬å¹³é”&lt;/strong&gt;ï¼ˆé»˜è®¤ï¼Œ&lt;code&gt;new ReentrantLock(false)&lt;/code&gt;ï¼‰****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯ä¸­æ–­æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­å“åº”ä¸­æ–­****&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼ˆ&lt;code&gt;lockInterruptibly()&lt;/code&gt;æ–¹æ³•ï¼‰ï¼Œç­‰å¾…é”çš„çº¿ç¨‹å¯å“åº”ä¸­æ–­ï¼Œé¿å…æ— é™ç­‰å¾…****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¶…æ—¶å°è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;å°è¯•è·å–é”æˆ–è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´****&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼ˆ&lt;code&gt;tryLock(long timeout, TimeUnit unit)&lt;/code&gt;ï¼‰ï¼Œå¯è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ­»é”æˆ–é•¿æœŸé˜»å¡****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¡ä»¶å˜é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;Object&lt;/code&gt;çš„ &lt;code&gt;wait()&lt;/code&gt;, &lt;code&gt;notify()&lt;/code&gt;, &lt;code&gt;notifyAll()&lt;/code&gt;å®ç°ï¼Œ&lt;strong&gt;åªæœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—&lt;/strong&gt;ï¼Œå”¤é†’çº¿ç¨‹ä¸ç²¾ç¡®****&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;strong&gt;å¤šä¸ª &lt;code&gt;Condition&lt;/code&gt;&lt;/strong&gt; å¯¹è±¡ï¼ˆ&lt;code&gt;newCondition()&lt;/code&gt;ï¼‰ï¼Œå¯å®ç°&lt;strong&gt;ç²¾ç¡®å”¤é†’&lt;/strong&gt;ï¼ˆå¦‚ç‹¬ç«‹çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ç­‰å¾…é˜Ÿåˆ—ï¼‰****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JVM å±‚é¢é€šè¿‡ &lt;strong&gt;ç›‘è§†å™¨ï¼ˆMonitorï¼‰&lt;/strong&gt; å’Œå¯¹è±¡å¤´ä¸­çš„ &lt;strong&gt;Mark Word&lt;/strong&gt; å®ç°ï¼Œæ”¯æŒ&lt;strong&gt;é”å‡çº§&lt;/strong&gt;ï¼ˆæ— é”-&amp;gt;åå‘é”-&amp;gt;è½»é‡çº§é”-&amp;gt;é‡é‡çº§é”ï¼‰****&lt;/td&gt;
&lt;td&gt;API å±‚é¢é€šè¿‡ &lt;strong&gt;AQS (AbstractQueuedSynchronizer)&lt;/strong&gt; åŠå…¶ &lt;strong&gt;CLHé˜Ÿåˆ—&lt;/strong&gt; å®ç°****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt; (é«˜ç«äº‰)&lt;/td&gt;
&lt;td&gt;æ—©æœŸç‰ˆæœ¬æ€§èƒ½è¾ƒå·®ï¼Œä½†&lt;strong&gt;JDK 6åŠä¹‹å&lt;/strong&gt;ç‰ˆæœ¬ç»è¿‡å¤§é‡ä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰ï¼Œ&lt;strong&gt;æ€§èƒ½ä¸ ReentrantLock æ¥è¿‘*&lt;/strong&gt;***&lt;/td&gt;
&lt;td&gt;åœ¨é«˜ç«äº‰åœºæ™¯ä¸‹ historically è¡¨ç°æ›´å¥½ï¼Œä½†ç°ä»£JDKç‰ˆæœ¬ä¸­ä¼˜åŠ¿å·²ä¸æ˜æ˜¾****&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ï¼Œä»£ç ä¾µå…¥æ€§ä½ï¼Œä½¿ç”¨ç®€å•****&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™åŠ é”å’Œé‡Šæ”¾é”çš„ä»£ç ï¼Œä½†çµæ´»æ€§æ›´é«˜****&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä»£ç å†™æ³•å·®å¼‚"&gt;ğŸ–¥ï¸ ä»£ç å†™æ³•å·®å¼‚
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;é”å®šä»£ç å—æ—¶ï¼Œä½ åªéœ€è¦ç”¨ &lt;code&gt;synchronized(object)&lt;/code&gt;æ‹¬èµ·éœ€è¦åŒæ­¥çš„ä»£ç å³å¯ï¼Œé”çš„è·å–å’Œé‡Šæ”¾ç”± JVM è‡ªåŠ¨å®Œæˆï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final Object lock = new Object();
public void myMethod() {
// ... å…¶ä»–ä»£ç 
synchronized(lock) { // è‡ªåŠ¨è·å–é”
// ä¸´ç•ŒåŒºä»£ç 
} // è‡ªåŠ¨é‡Šæ”¾é”
// ... å…¶ä»–ä»£ç 
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;åˆ™éœ€è¦ä½ æ˜¾å¼åœ°åˆ›å»ºé”å¯¹è±¡ï¼Œå¹¶æ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;lock()&lt;/code&gt;å’Œ &lt;code&gt;unlock()&lt;/code&gt;&lt;strong&gt;ï¼Œä¸”é‡Šæ”¾é”çš„æ“ä½œé€šå¸¸å¿…é¡»æ”¾åœ¨ &lt;code&gt;finally&lt;/code&gt;å—ä¸­&lt;/strong&gt;ä»¥ç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ä¹Ÿèƒ½é‡Šæ”¾é”ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final ReentrantLock lock = new ReentrantLock();
public void myMethod() {
// ... å…¶ä»–ä»£ç 
lock.lock(); // æ‰‹åŠ¨è·å–é”
try {
// ä¸´ç•ŒåŒºä»£ç 
} finally {
lock.unlock(); // å¿…é¡»åœ¨finallyä¸­æ‰‹åŠ¨é‡Šæ”¾é”
}
// ... å…¶ä»–ä»£ç 
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-åŠŸèƒ½ç‰¹æ€§å·®å¼‚"&gt;âš™ï¸ åŠŸèƒ½ç‰¹æ€§å·®å¼‚
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;çš„åŠŸèƒ½ç›¸å¯¹åŸºç¡€ï¼Œå®ƒ&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­è¢«ä¸­æ–­ï¼Œä¹Ÿ&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;å°è¯•è·å–é”ï¼ˆæ‹¿ä¸åˆ°å°±ä¸€ç›´ç­‰ï¼‰ï¼Œå®ƒé»˜è®¤ä¸”åªèƒ½æ˜¯&lt;strong&gt;éå…¬å¹³é”&lt;/strong&gt;ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ &lt;code&gt;Object&lt;/code&gt;çš„ &lt;code&gt;wait()&lt;/code&gt;å’Œ &lt;code&gt;notify()&lt;/code&gt;/&lt;code&gt;notifyAll()&lt;/code&gt;æ¥å®ç°çº¿ç¨‹é—´çš„åè°ƒï¼Œä½†æ— æ³•ç²¾ç¡®å”¤é†’ç‰¹å®šç±»å‹çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;åˆ™æä¾›äº†æ›´å¤šé«˜çº§åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ä¸­æ–­çš„é”ç­‰å¾…&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;lockInterruptibly()&lt;/code&gt;æ–¹æ³•è·å–é”ï¼Œåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å¯ä»¥å“åº”å…¶ä»–çº¿ç¨‹çš„ä¸­æ–­è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶å°è¯•è·å–é”&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;tryLock(long timeout, TimeUnit unit)&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ— é™æœŸç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¹³é”é€‰æ‹©&lt;/strong&gt;ï¼šå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­é€‰æ‹©åˆ›å»ºå…¬å¹³é”ï¼ˆå…ˆæ¥å…ˆå¾—ï¼‰æˆ–éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼Œååé‡é€šå¸¸æ›´é«˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä¸ªæ¡ä»¶å˜é‡&lt;/strong&gt;ï¼šå¯ä»¥é€šè¿‡ &lt;code&gt;newCondition()&lt;/code&gt;åˆ›å»ºå¤šä¸ª &lt;code&gt;Condition&lt;/code&gt;å¯¹è±¡ï¼Œç”¨äºæ›´ç²¾ç»†çš„çº¿ç¨‹é—´é€šä¿¡ï¼Œä¾‹å¦‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œå¯ä»¥åˆ†åˆ«ç®¡ç†â€œé˜Ÿåˆ—éç©ºâ€å’Œâ€œé˜Ÿåˆ—æœªæ»¡â€ä¸¤ä¸ªæ¡ä»¶ï¼Œå®ç°ç²¾ç¡®å”¤é†’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€§èƒ½å·®å¼‚"&gt;âš¡ æ€§èƒ½å·®å¼‚
&lt;/h3&gt;&lt;p&gt;åœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ&lt;code&gt;synchronized&lt;/code&gt;æ˜¯é‡é‡çº§é”ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œ&lt;code&gt;ReentrantLock&lt;/code&gt;åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ€§èƒ½è¡¨ç°æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½†åœ¨ JDK 6 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œ&lt;code&gt;synchronized&lt;/code&gt;è¿›è¡Œäº†é‡å¤§ä¼˜åŒ–&lt;/strong&gt;ï¼Œå¦‚å¼•å…¥äº†&lt;strong&gt;åå‘é”&lt;/strong&gt;ã€&lt;strong&gt;è½»é‡çº§é”&lt;/strong&gt;ã€&lt;strong&gt;è‡ªæ—‹é”&lt;/strong&gt;ã€&lt;strong&gt;é”æ¶ˆé™¤&lt;/strong&gt;ã€&lt;strong&gt;é”ç²—åŒ–&lt;/strong&gt;ç­‰æœºåˆ¶ã€‚è¿™äº›ä¼˜åŒ–ä½¿å¾— &lt;code&gt;synchronized&lt;/code&gt;åœ¨ä½è‡³ä¸­ç­‰ç«äº‰ç¨‹åº¦çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½å·²ç»ä¸ &lt;code&gt;ReentrantLock&lt;/code&gt;ç›¸å·®æ— å‡ ï¼Œç”šè‡³æœ‰æ—¶æ›´ä¼˜ã€‚å› æ­¤ï¼Œ&lt;strong&gt;æ€§èƒ½å› ç´ åœ¨ç°ä»£ Java ç‰ˆæœ¬ä¸­å·²ä¸å†æ˜¯é¦–è¦è€ƒè™‘ç‚¹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-åº•å±‚å®ç°"&gt;ğŸ”§ åº•å±‚å®ç°
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;çš„é”æœºåˆ¶æ˜¯ &lt;strong&gt;JVM å±‚é¢&lt;/strong&gt;å®ç°çš„ã€‚æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”ï¼Œå…¶é”çŠ¶æ€è®°å½•åœ¨å¯¹è±¡å¤´çš„ &lt;strong&gt;Mark Word&lt;/strong&gt; ä¸­ã€‚JVM ä¼šæ ¹æ®å®é™…ç«äº‰æƒ…å†µï¼Œè‡ªåŠ¨è¿›è¡Œ&lt;strong&gt;é”å‡çº§&lt;/strong&gt;ï¼ˆä»æ— é” -&amp;gt; åå‘é” -&amp;gt; è½»é‡çº§é” -&amp;gt; é‡é‡çº§é”ï¼‰ï¼Œè¿™ä¸ªä¼˜åŒ–è¿‡ç¨‹å¯¹å¼€å‘è€…å®Œå…¨é€æ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;çš„é”æœºåˆ¶æ˜¯ &lt;strong&gt;API å±‚é¢&lt;/strong&gt;ï¼ˆJava ä»£ç ï¼‰å®ç°çš„ï¼Œå…¶æ ¸å¿ƒæ˜¯ &lt;strong&gt;AQS (AbstractQueuedSynchronizer)&lt;/strong&gt;ã€‚AQS å†…éƒ¨é€šè¿‡ä¸€ä¸ª &lt;strong&gt;volatile çš„ state å˜é‡&lt;/strong&gt;ï¼ˆCASæ“ä½œï¼‰æ¥è¡¨ç¤ºé”çŠ¶æ€ï¼Œå¹¶é€šè¿‡ä¸€ä¸ª &lt;strong&gt;FIFO çš„CLHé˜Ÿåˆ—&lt;/strong&gt;æ¥ç®¡ç†æœªèƒ½ç«‹å³è·å–åˆ°é”çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-1"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;äº†è§£äº†å®ƒä»¬çš„åŒºåˆ«åï¼Œå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘ &lt;code&gt;synchronized&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;ç®€å•çš„åŒæ­¥&lt;/strong&gt;ï¼Œä»£ç &lt;strong&gt;ç®€æ´æ€§å’Œæ˜“ç»´æŠ¤æ€§&lt;/strong&gt;æ˜¯é¦–è¦è€ƒè™‘å› ç´ ã€‚&lt;/li&gt;
&lt;li&gt;é”çš„ç«äº‰ç¨‹åº¦&lt;strong&gt;ä¸æ¿€çƒˆ&lt;/strong&gt;ï¼Œæˆ–è€…ä½ å¸Œæœ›ä¾èµ– JVM çš„è‡ªåŠ¨é”ä¼˜åŒ–æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦ &lt;code&gt;ReentrantLock&lt;/code&gt;æä¾›çš„é‚£äº›&lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼ˆå¦‚å¯ä¸­æ–­ã€è¶…æ—¶ã€å…¬å¹³é”ã€å¤šä¸ªæ¡ä»¶å˜é‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦ &lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼Œå¦‚å¯ä¸­æ–­çš„é”è·å–ã€è¶…æ—¶å°è¯•è·å–é”ã€å…¬å¹³é”ç‰¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;å¤æ‚çš„çº¿ç¨‹é—´åè°ƒ&lt;/strong&gt;ï¼Œä½¿ç”¨&lt;strong&gt;å¤šä¸ªæ¡ä»¶å˜é‡&lt;/strong&gt;ï¼ˆ&lt;code&gt;Condition&lt;/code&gt;ï¼‰å¯ä»¥æ›´æ¸…æ™°ã€é«˜æ•ˆåœ°å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ç»å…¸çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å°½ç®¡ç°ä»£ &lt;code&gt;synchronized&lt;/code&gt;æ€§èƒ½å¾ˆå¥½ï¼Œä½†åœ¨æŸäº›&lt;strong&gt;æé«˜ç«äº‰&lt;/strong&gt;çš„ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œç»“åˆ &lt;code&gt;tryLock()&lt;/code&gt;å¯èƒ½ä»æœ‰ä¼˜åŠ¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸€å¥è¯æ€»ç»“ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨æ›´ç®€æ´å®‰å…¨çš„ &lt;code&gt;synchronized&lt;/code&gt;ï¼›åªæœ‰å½“ç¡®å®éœ€è¦ &lt;code&gt;ReentrantLock&lt;/code&gt;æä¾›çš„é‚£äº›é«˜çº§ç‰¹æ€§æ—¶ï¼Œæ‰é€‰æ‹©å®ƒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;h2 id="synchronized-åµŒå¥—"&gt;synchronized åµŒå¥—
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—çš„&lt;strong&gt;åµŒå¥—ä½¿ç”¨éœ€è¦éå¸¸è°¨æ…&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å¯¼è‡´æ­»é”ã€‚è™½ç„¶æŠ€æœ¯ä¸Šå¯ä»¥å®ç°ï¼Œä½†é€šå¸¸æœ‰æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†åµŒå¥—ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;çš„æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹é¢&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å…³é”®æé†’&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»€ä¹ˆæ˜¯åµŒå¥—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ä¸€ä¸ª&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨ï¼Œè°ƒç”¨å¦ä¸€ä¸ª&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•ï¼Œæˆ–å°è¯•è·å–å¦ä¸€ä¸ªå¯¹è±¡çš„é”ã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯é‡å…¥æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Java çš„ &lt;code&gt;synchronized&lt;/code&gt;é”æ˜¯å¯é‡å…¥çš„&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€&lt;strong&gt;åŒä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;å¯ä»¥å¤šæ¬¡è·å–&lt;strong&gt;åŒä¸€ä¸ªé”&lt;/strong&gt;è€Œä¸ä¼šé˜»å¡è‡ªå·±ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯åµŒå¥—èƒ½è¿›è¡Œçš„åŸºç¡€ï¼Œé¿å…äº†çº¿ç¨‹è‡ªå·±å¡æ­»è‡ªå·±çš„æƒ…å†µã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ­»é”é£é™©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜åº¦é£é™©&lt;/strong&gt;ã€‚å½“åµŒå¥—æ¶‰åŠ&lt;strong&gt;å¤šä¸ªé”&lt;/strong&gt;ï¼ˆä¸åŒå¯¹è±¡æˆ–ç±»é”ï¼‰ï¼Œå¹¶ä¸”&lt;strong&gt;å¤šä¸ªçº¿ç¨‹ä»¥ä¸åŒçš„é¡ºåºè¯·æ±‚è¿™äº›é”&lt;/strong&gt;æ—¶ï¼Œææ˜“å‘ç”Ÿæ­»é”ã€‚&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯åµŒå¥—æœ€å¤§çš„é—®é¢˜ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œç›¸å…³çº¿ç¨‹ä¼šæ— é™ç­‰å¾…ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿‡åº¦çš„åŒæ­¥ï¼Œå°¤å…¶æ˜¯åµŒå¥—å’Œç²—ç²’åº¦çš„é”ï¼Œä¼š&lt;strong&gt;æ˜¾è‘—é™ä½ç¨‹åºå¹¶å‘æ€§èƒ½&lt;/strong&gt;ï¼Œå¢åŠ çº¿ç¨‹é˜»å¡æ—¶é—´ã€‚&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨&lt;strong&gt;ç»†ç²’åº¦é”&lt;/strong&gt;ã€&lt;strong&gt;å¹¶å‘å·¥å…·ç±»&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;ReentrantLock&lt;/code&gt;åŠå…¶ &lt;code&gt;tryLock&lt;/code&gt;æ–¹æ³•ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;æ—¨åœ¨å‡å°‘é”çš„æŒæœ‰æ—¶é—´ã€é™ä½æ­»é”æ¦‚ç‡æˆ–æä¾›æ›´çµæ´»çš„é”æœºåˆ¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è°¨æ…åµŒå¥—çš„åŸå› "&gt;âš ï¸ è°¨æ…åµŒå¥—çš„åŸå› 
&lt;/h3&gt;&lt;p&gt;åµŒå¥—ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;æœ€ä¸»è¦çš„é£é™©æ˜¯&lt;strong&gt;æ­»é”ï¼ˆDeadlockï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ­»é”é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼šå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶æŒæœ‰å¤šä¸ªé”ï¼Œä½†&lt;strong&gt;è·å–è¿™äº›é”çš„é¡ºåºä¸ä¸€è‡´&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;çº¿ç¨‹1ï¼šå…ˆè·å–äº†é”Aï¼Œç„¶åå°è¯•è·å–é”Bã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çº¿ç¨‹2ï¼šå…ˆè·å–äº†é”Bï¼Œç„¶åå°è¯•è·å–é”Aã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œçº¿ç¨‹1æŒæœ‰Aç­‰å¾…Bï¼Œçº¿ç¨‹2æŒæœ‰Bç­‰å¾…Aï¼Œä¸¤è€…éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå½¢æˆæ­»é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;ç‰¹æ€§å†³å®šäº†çº¿ç¨‹åœ¨å°è¯•è·å–ä¸€ä¸ªå·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨çš„é”æ—¶ï¼Œä¼š&lt;strong&gt;ä¸€ç›´é˜»å¡ç­‰å¾…&lt;/strong&gt;ï¼Œè‡ªèº«æ— æ³•ä¸­æ–­æˆ–è¶…æ—¶ã€‚è¿™ä½¿å¾—ä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå¾€å¾€éœ€è¦å¤–éƒ¨å¹²é¢„ã€‚&lt;/p&gt;
&lt;h3 id="-å¯é‡å…¥æ€§åµŒå¥—çš„åŸºç¡€"&gt;ğŸ”„ å¯é‡å…¥æ€§ï¼šåµŒå¥—çš„åŸºç¡€
&lt;/h3&gt;&lt;p&gt;Java ä¸­çš„ &lt;code&gt;synchronized&lt;/code&gt;é”æ˜¯&lt;strong&gt;å¯é‡å…¥çš„ï¼ˆReentrantï¼‰&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€&lt;strong&gt;åŒä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;å¯ä»¥å¤šæ¬¡è¿›å…¥ç”±&lt;strong&gt;åŒä¸€ä¸ªé”&lt;/strong&gt;ä¿æŠ¤çš„åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class ReentrantExample {
public synchronized void methodA() {
System.out.println(&amp;#34;Method A&amp;#34;);
methodB(); // åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å†æ¬¡è·å–å½“å‰å¯¹è±¡(this)çš„é”ï¼Œè¿›å…¥methodB
}
public synchronized void methodB() {
System.out.println(&amp;#34;Method B&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;methodA&lt;/code&gt;å’Œ &lt;code&gt;methodB&lt;/code&gt;éƒ½ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;ä¿®é¥°ï¼ˆé”å¯¹è±¡éƒ½æ˜¯ &lt;code&gt;this&lt;/code&gt;ï¼‰ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ &lt;code&gt;methodA&lt;/code&gt;æ—¶ï¼Œå®ƒè·å¾—äº†å½“å‰å¯¹è±¡çš„é”ã€‚åœ¨ &lt;code&gt;methodA&lt;/code&gt;å†…éƒ¨è°ƒç”¨ &lt;code&gt;methodB&lt;/code&gt;ï¼ˆä¹Ÿéœ€è¦è·å–åŒä¸€ä¸ªé”ï¼‰æ—¶ï¼Œç”±äºæ˜¯å¯é‡å…¥é”ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥è¿›å…¥ &lt;code&gt;methodB&lt;/code&gt;ã€‚å¦‚æœæ²¡æœ‰å¯é‡å…¥æ€§ï¼Œè¿™é‡Œå°±ä¼šå‘ç”Ÿæ­»é”ã€‚&lt;/p&gt;
&lt;h3 id="-æ›¿ä»£æ–¹æ¡ˆä¸æœ€ä½³å®è·µ"&gt;ğŸ› ï¸ æ›¿ä»£æ–¹æ¡ˆä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;p&gt;é‰´äºåµŒå¥— &lt;code&gt;synchronized&lt;/code&gt;çš„é£é™©ï¼Œåº”è€ƒè™‘ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆå’Œæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ç»†ç²’åº¦é”ï¼ˆFine-grained Lockingï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€è·¯&lt;/strong&gt;ï¼šä¸è¦ç”¨ä¸€ä¸ªç²—ç²’åº¦çš„é”ï¼ˆå¦‚ç›´æ¥é”æ•´ä¸ªå¯¹è±¡ &lt;code&gt;synchronized(this)&lt;/code&gt;æˆ–ä¸€ä¸ªå¤§çš„åŒæ­¥æ–¹æ³•ï¼‰ä¿æŠ¤æ‰€æœ‰å…±äº«èµ„æºï¼Œè€Œæ˜¯&lt;strong&gt;ä¸ºä¸åŒçš„å…±äº«èµ„æºä½¿ç”¨ä¸åŒçš„ä¸“ç”¨é”å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åšæ³•&lt;/strong&gt;ï¼šåˆ›å»ºå¤šä¸ªä¸“é—¨çš„ final é”å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class FineGrainedExample {
private final Object lockA = new Object();
private final Object lockB = new Object();
private int resourceA;
private int resourceB;
public void updateA() {
synchronized(lockA) { // åªé”ä¸resourceAç›¸å…³çš„æ“ä½œ
// ä¿®æ”¹ resourceA
}
}
public void updateB() {
synchronized(lockB) { // åªé”ä¸resourceBç›¸å…³çš„æ“ä½œ
// ä¿®æ”¹ resourceB
}
}
public void updateBoth() {
synchronized(lockA) { // å…ˆè·å–é”A
synchronized(lockB) { // å†è·å–é”B
// æ“ä½œ resourceA å’Œ resourceB
}
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¥½å¤„&lt;/strong&gt;ï¼š&lt;code&gt;updateA&lt;/code&gt;å’Œ &lt;code&gt;updateB&lt;/code&gt;å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œäº’ä¸é˜»å¡ï¼Œæé«˜äº†å¹¶å‘æ€§ã€‚åœ¨éœ€è¦è·å–å¤šä¸ªé”çš„æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;updateBoth&lt;/code&gt;ï¼‰ä¸­ï¼ŒåŠ¡å¿…&lt;strong&gt;å›ºå®šé”çš„è·å–é¡ºåº&lt;/strong&gt;ï¼ˆä¾‹å¦‚æ€»æ˜¯å…ˆ lockA å lockBï¼‰ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä¸¥æ ¼éµå®ˆæ­¤é¡ºåºï¼Œè¿™æ˜¯é¿å…æ­»é”çš„å…³é”®æŠ€å·§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼©å°åŒæ­¥èŒƒå›´&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°½é‡åªå¯¹&lt;strong&gt;çœŸæ­£éœ€è¦åŒæ­¥çš„ä»£ç å—&lt;/strong&gt;ä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–¹æ³•ã€‚è¿™å‡å°‘äº†é”æŒæœ‰çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ Java å¹¶å‘å·¥å…·åŒ…ï¼ˆjava.util.concurrentï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºå¤æ‚çš„å¹¶å‘åœºæ™¯ï¼Œè€ƒè™‘ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;ã€‚å®ƒæä¾›äº† &lt;code&gt;tryLock()&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥å°è¯•è·å–é”ï¼Œå¦‚æœå¤±è´¥ä¸ä¼šæ— é™é˜»å¡ï¼Œå…è®¸çº¿ç¨‹å›é€€æˆ–é‡è¯•ï¼Œä»è€Œæœ‰æ•ˆé¿å…æ­»é”ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ›´é«˜çº§çš„å¹¶å‘å®¹å™¨ï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼‰å’ŒåŒæ­¥å·¥å…·ï¼ˆå¦‚ &lt;code&gt;CountDownLatch&lt;/code&gt;, &lt;code&gt;CyclicBarrier&lt;/code&gt;, &lt;code&gt;Semaphore&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—å¯ä»¥åµŒå¥—ï¼Œä¸»è¦å¾—ç›Šäºé”çš„&lt;strong&gt;å¯é‡å…¥æ€§&lt;/strong&gt;ã€‚ä½†åµŒå¥—ï¼Œå°¤å…¶æ˜¯æ¶‰åŠ&lt;strong&gt;å¤šä¸ªä¸åŒé”&lt;/strong&gt;çš„åµŒå¥—ï¼Œ&lt;strong&gt;ææ˜“å¯¼è‡´æ­»é”&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°½é‡é¿å…ä¸å¿…è¦çš„åµŒå¥—&lt;/strong&gt;ï¼Œç‰¹åˆ«æ˜¯é”é¡ºåºå¯èƒ½ä¸å›ºå®šçš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆè€ƒè™‘&lt;strong&gt;ç»†ç²’åº¦é”&lt;/strong&gt;å’Œ&lt;strong&gt;å›ºå®šé”è·å–é¡ºåº&lt;/strong&gt;æ¥ç®¡ç†å¯¹å¤šä¸ªèµ„æºçš„è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å¤æ‚åœºæ™¯ä¸‹ï¼Œè¯„ä¼°ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;ç­‰æ›´çµæ´»ã€åŠŸèƒ½æ›´ä¸°å¯Œçš„å¹¶å‘å·¥å…·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°å†³ç­–ã€‚&lt;/p&gt;
&lt;h2 id="value--constants"&gt;@Value &amp;amp; Constants
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring åº”ç”¨ä¸­å®šä¹‰é…ç½®å€¼æ—¶ï¼Œä½¿ç”¨ &lt;code&gt;static final&lt;/code&gt;å¸¸é‡å’Œé€šè¿‡ &lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥æ˜¯ä¸¤ç§å¸¸è§æ–¹å¼ï¼Œå®ƒä»¬å„æœ‰ç‰¹ç‚¹ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ã€‚ä¸‹é¢æˆ‘æ¥ä¸ºä½ è§£é‡Šå®ƒä»¬çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;Static Final å¸¸é‡&lt;/th&gt;
&lt;th&gt;@Value æ³¨å…¥é…ç½®&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸºæœ¬å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç±»çº§åˆ«çš„å¸¸é‡ï¼Œä½¿ç”¨ &lt;code&gt;static final&lt;/code&gt;å…³é”®å­—å£°æ˜&lt;/td&gt;
&lt;td&gt;Spring çš„æ³¨è§£ï¼Œç”¨äºå°†å¤–éƒ¨é…ç½®å€¼æ³¨å…¥åˆ° Bean çš„å®ä¾‹å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰&lt;strong&gt;çœŸæ­£æ’å®š&lt;/strong&gt;ã€ä¸è¿è¡Œç¯å¢ƒæ— å…³çš„å€¼ï¼ˆå¦‚æ•°å­¦å¸¸æ•°ã€æšä¸¾é”®ï¼‰&lt;/td&gt;
&lt;td&gt;æ³¨å…¥&lt;strong&gt;éšç¯å¢ƒå˜åŒ–&lt;/strong&gt;çš„é…ç½®å€¼ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç¬¬ä¸‰æ–¹ API å¯†é’¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å€¼çš„æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œæˆ–é€šè¿‡ç®€å•è®¡ç®—å¾—åˆ°&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.properties&lt;/code&gt;ï¼‰ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸåˆå§‹åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç±»åŠ è½½æ—¶&lt;/strong&gt;åˆå§‹åŒ–ï¼Œæ—©äº Spring å®¹å™¨å¯åŠ¨&lt;/td&gt;
&lt;td&gt;Spring &lt;strong&gt;åˆ›å»º Bean å®ä¾‹æ—¶&lt;/strong&gt;è¿›è¡Œå±æ€§å¡«å……&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®Œå…¨ç”± JVM ç®¡ç†ï¼ŒSpring æ— æ³•å¹²é¢„&lt;/td&gt;
&lt;td&gt;å®Œå…¨ç”± Spring å®¹å™¨ç®¡ç†ï¼Œæ˜¯ Spring IOC çš„ä¸€éƒ¨åˆ†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ï¼Œä¿®æ”¹å€¼éœ€é‡æ–°ç¼–è¯‘ä»£ç &lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ç”Ÿæ•ˆï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°ï¼ˆå¦‚ç»“åˆ &lt;code&gt;@RefreshScope&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸å¯å˜ï¼Œ&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‹¥ Bean æ˜¯å•ä¾‹ä¸”å­—æ®µå¯å˜ï¼Œéœ€æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æµ‹è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®€å•ç›´æ¥&lt;/td&gt;
&lt;td&gt;æ›´æ˜“äºæ¨¡æ‹Ÿå’Œæ›¿æ¢ä¸åŒé…ç½®è¿›è¡Œæµ‹è¯•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä½¿ç”¨-static-final-å¸¸é‡"&gt;ğŸ”§ ä½¿ç”¨ Static Final å¸¸é‡
&lt;/h3&gt;&lt;p&gt;Static Final å¸¸é‡åœ¨&lt;strong&gt;ç±»åŠ è½½æ—¶&lt;/strong&gt;ï¼ˆJVM åŠ è½½è¯¥ç±»æ—¶ï¼‰å°±å¿…é¡»è¢«åˆå§‹åŒ–ï¼Œä¸”ä¸€æ—¦èµ‹å€¼ä¾¿æ— æ³•æ›´æ”¹ã€‚å®ƒå®Œå…¨ç”± JVM ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰çœŸæ­£ä¸å˜çš„å€¼&lt;/strong&gt;ï¼šå¦‚æ•°å­¦å¸¸æ•° Ï€ã€eï¼Œæˆ–è€…é¡¹ç›®ä¸­ä¸€äº›å›ºå®šçš„æšä¸¾é”®ã€çŠ¶æ€ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¿è¡Œç¯å¢ƒæ— å…³çš„å›ºå®šå€¼&lt;/strong&gt;ï¼šè¿™äº›å€¼åœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½ç›¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class Constants {
// ç¼–è¯‘æ—¶å¸¸é‡ï¼Œé€šå¸¸ç›´æ¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
public static final double PI = 3.1415926535;
public static final String APP_NAME = &amp;#34;MY_SPRING_APP&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä½¿ç”¨-value-æ³¨å…¥é…ç½®"&gt;ğŸ”§ ä½¿ç”¨ @Value æ³¨å…¥é…ç½®
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Value&lt;/code&gt;æ˜¯ Spring æä¾›çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œå®ƒåœ¨ Spring &lt;strong&gt;åˆ›å»º Bean å®ä¾‹ã€è¿›è¡Œå±æ€§å¡«å……æ—¶&lt;/strong&gt;æ‰ä¼šå‘ç”Ÿã€‚å…¶å€¼æ¥æºäºå¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;ï¼‰ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦å¤–éƒ¨åŒ–é…ç½®çš„å€¼&lt;/strong&gt;ï¼šå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€ç¬¬ä¸‰æ–¹æœåŠ¡çš„ API å¯†é’¥ã€æœåŠ¡å™¨ç«¯å£å·ç­‰ã€‚è¿™äº›å€¼é€šå¸¸å› ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰è€Œå¼‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯èƒ½éœ€è¦åŠ¨æ€åˆ·æ–°çš„é…ç½®&lt;/strong&gt;ï¼ˆç»“åˆ &lt;code&gt;@RefreshScope&lt;/code&gt;ç­‰æœºåˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ &lt;code&gt;application.properties&lt;/code&gt;ä¸­å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;app.api.url=https://api.example.com
app.thread.pool.size=10
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Bean ä¸­æ³¨å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ApiService {
// æ³¨å…¥é…ç½®å€¼
@Value(&amp;#34;${app.api.url}&amp;#34;)
private String apiUrl;
@Value(&amp;#34;${app.thread.pool.size:5}&amp;#34;) // å†’å·åæŒ‡å®šé»˜è®¤å€¼
private int threadPoolSize;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-é‡è¦çš„æ³¨æ„äº‹é¡¹"&gt;âš ï¸ é‡è¦çš„æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸è¦å°è¯•ç”¨ @Value ç›´æ¥æ³¨å…¥ static å­—æ®µ&lt;/strong&gt;ï¼šSpring çš„ä¾èµ–æ³¨å…¥åŸºäº Bean å®ä¾‹æ“ä½œï¼Œè€Œ &lt;code&gt;static&lt;/code&gt;å­—æ®µå±äºç±»çº§åˆ«ï¼ŒSpring æ— æ³•é€šè¿‡å®ä¾‹ç›´æ¥ä¸ºå…¶æ³¨å…¥å€¼ã€‚ç›´æ¥è¿™æ ·åšä¼šå¯¼è‡´æ³¨å…¥å¤±è´¥ï¼Œå­—æ®µå€¼ä¸º &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Static Final ç»„åˆå­—æ®µæ— æ³•é€šè¿‡ @Value æ³¨å…¥&lt;/strong&gt;ï¼š&lt;code&gt;static final&lt;/code&gt;ç»„åˆå­—æ®µæ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œå¿…é¡»åœ¨ç±»åŠ è½½æ—¶ç¡®å®šå…¶å€¼ï¼Œå› æ­¤æ— æ³•åœ¨è¿è¡Œæ—¶é€šè¿‡ Spring æ³¨å…¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é—´æ¥æ³¨å…¥ Static å˜é‡çš„æ–¹æ³•&lt;/strong&gt;ï¼šå¦‚æœç¡®å®éœ€è¦è®©ä¸€ä¸ªé™æ€å˜é‡æŒæœ‰ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–çš„å€¼ï¼Œå¯ä»¥é€šè¿‡éé™æ€ setter æ–¹æ³•é—´æ¥å®ç°ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ConfigHolder {
private static String staticConfigValue;
@Value(&amp;#34;${some.config}&amp;#34;)
public void setStaticConfigValue(String value) {
ConfigHolder.staticConfigValue = value; // åœ¨setterä¸­ä¸ºé™æ€å˜é‡èµ‹å€¼
}
public static String getStaticConfigValue() {
return staticConfigValue;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@PostConstruct&lt;/code&gt;è¿›è¡Œåˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class ConfigHolder {
private static String staticConfigValue;
@Value(&amp;#34;${some.config}&amp;#34;)
private String injectedValue;
@PostConstruct
public void init() {
staticConfigValue = injectedValue; // åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ä¸ºé™æ€å˜é‡èµ‹å€¼
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-2"&gt;ğŸ’ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é€‰æ‹© &lt;strong&gt;&lt;code&gt;static final&lt;/code&gt;å¸¸é‡&lt;/strong&gt;ï¼šç”¨äºå­˜å‚¨é‚£äº›&lt;strong&gt;çœŸæ­£ä¸å˜&lt;/strong&gt;ã€&lt;strong&gt;ä¸è¿è¡Œç¯å¢ƒæ— å…³&lt;/strong&gt;çš„å›ºå®šå€¼ï¼Œä¾‹å¦‚æ•°å­¦å¸¸æ•°ã€å›ºå®šçš„æšä¸¾é”®ã€çŠ¶æ€ç ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹© &lt;strong&gt;&lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥&lt;/strong&gt;ï¼šç”¨äºé‚£äº›&lt;strong&gt;éœ€è¦å¤–éƒ¨åŒ–&lt;/strong&gt;ã€&lt;strong&gt;å¯èƒ½éšç¯å¢ƒå˜åŒ–&lt;/strong&gt;ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰çš„é…ç½®å€¼ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ã€ç¬¬ä¸‰æ–¹ API å¯†é’¥ã€åŠŸèƒ½å¼€å…³ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚è¿™æ˜¯ Spring Boot å¤–éƒ¨åŒ–é…ç½®å’Œæ¾è€¦åˆç†å¿µçš„ä½“ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;strong&gt;&lt;code&gt;static final&lt;/code&gt;å…³ä¹ä»£ç å†…çš„å›ºå®šä¸å˜ï¼Œ&lt;code&gt;@Value&lt;/code&gt;å…³ä¹è¿è¡Œæ—¶çš„çµæ´»é…ç½®&lt;/strong&gt;ã€‚æ­£ç¡®åŒºåˆ†å’Œä½¿ç”¨å®ƒä»¬ï¼Œèƒ½è®©ä½ çš„åº”ç”¨æ›´å¥å£®ã€æ›´æ˜“ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼ã€‚å¦‚æœä½ æœ‰æ›´å¤šå…³äº Spring é…ç½®ç®¡ç†çš„é—®é¢˜ï¼Œæˆ‘å¾ˆä¹æ„ç»§ç»­ä¸ä½ è®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id="configurationproperties"&gt;@ConfigurationProperties
&lt;/h2&gt;&lt;p&gt;é™¤äº† &lt;code&gt;@Value&lt;/code&gt;ï¼ŒSpring Bootï¼ˆç‰¹åˆ«æ˜¯ 3.3 åŠä»¥åç‰ˆæœ¬ï¼‰æ¨èä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ³¨è§£è¿›è¡Œæ›´&lt;strong&gt;ä¼˜é›…&lt;/strong&gt;ã€&lt;strong&gt;ç±»å‹å®‰å…¨&lt;/strong&gt;ä¸”&lt;strong&gt;é›†ä¸­&lt;/strong&gt;çš„é…ç½®æ³¨å…¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œå¸®ä½ å¿«é€Ÿäº†è§£å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Value&lt;/code&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ³¨è§£&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€ä¸ªæ³¨å…¥å•ä¸ªé…ç½®å€¼&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‰¹é‡ç»‘å®š&lt;/strong&gt;ä¸€ç»„å…·æœ‰ç›¸åŒå‰ç¼€çš„é…ç½®åˆ° Java Bean ä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å‹æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦æ”¯æŒåŸºæœ¬ç±»å‹å’Œç®€å•ç±»å‹è½¬æ¢&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;strong&gt;å¤æ‚ç±»å‹&lt;/strong&gt;ï¼ˆå¦‚å¯¹è±¡ã€åˆ—è¡¨ Listã€Mapï¼‰ã€åµŒå¥—ç»“æ„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç é£æ ¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½®åˆ†æ•£åœ¨å„å¤„ï¼Œè¾ƒå¤šæ³¨è§£æ—¶ä»£ç æ˜¾å†—ä½™&lt;/td&gt;
&lt;td&gt;é…ç½®&lt;strong&gt;é›†ä¸­ç®¡ç†&lt;/strong&gt;ï¼Œä»£ç æ›´ç®€æ´ã€å†…èš&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¾æ•£ç»‘å®š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒã€‚å±æ€§åå¿…é¡»ä¸¥æ ¼åŒ¹é…&lt;/td&gt;
&lt;td&gt;æ”¯æŒã€‚ä¾‹å¦‚é…ç½® &lt;code&gt;my-config.item-name&lt;/code&gt;å¯æ˜ å°„åˆ° &lt;code&gt;myConfig.itemName&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ ¡éªŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;strong&gt;JSR-303&lt;/strong&gt; æ ¡éªŒï¼ˆå¦‚ &lt;code&gt;@NotNull&lt;/code&gt;, &lt;code&gt;@Email&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¡é‡å•ä½æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒè‡ªåŠ¨å•ä½è½¬æ¢&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;strong&gt;Duration&lt;/strong&gt; (å¦‚ &lt;code&gt;10s&lt;/code&gt;, &lt;code&gt;30m&lt;/code&gt;) å’Œ &lt;strong&gt;DataSize&lt;/strong&gt; (å¦‚ &lt;code&gt;10MB&lt;/code&gt;, &lt;code&gt;1GB&lt;/code&gt;) ç­‰å•ä½çš„è‡ªåŠ¨è½¬æ¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨å…¥å°‘é‡ã€ç®€å•ã€ç‹¬ç«‹çš„é…ç½®é¡¹&lt;/td&gt;
&lt;td&gt;æ³¨å…¥ä¸€ç»„&lt;strong&gt;ç›¸å…³çš„&lt;/strong&gt;ã€&lt;strong&gt;ç»“æ„åŒ–&lt;/strong&gt;çš„é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¦‚ä½•é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/strong&gt;ï¼šå½“éœ€è¦æ³¨å…¥ä¸€ç»„&lt;strong&gt;ç›¸å…³çš„é…ç½®&lt;/strong&gt;ï¼ˆä¾‹å¦‚æ•°æ®åº“è¿æ¥å‚æ•°ã€ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®ã€åº”ç”¨ç‰¹æ€§å¼€å…³ç­‰ï¼‰æ—¶ï¼Œè¿™æ˜¯é¦–é€‰æ–¹æ¡ˆï¼Œèƒ½å¸¦æ¥æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Value&lt;/code&gt;ä½œä¸ºè¡¥å……&lt;/strong&gt;ï¼šå½“ä½ åªéœ€è¦æ³¨å…¥&lt;strong&gt;ä¸€ä¸¤ä¸ªç®€å•ä¸”ç‹¬ç«‹&lt;/strong&gt;çš„é…ç½®å€¼æ—¶ï¼Œä½¿ç”¨ &lt;code&gt;@Value&lt;/code&gt;æ›´åŠ ç›´æ¥å’Œæ–¹ä¾¿ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä½¿ç”¨-configurationproperties"&gt;ğŸ› ï¸ ä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;
&lt;/h3&gt;&lt;h4 id="1-åˆ›å»ºé…ç½®ç±»"&gt;1. åˆ›å»ºé…ç½®ç±»
&lt;/h4&gt;&lt;p&gt;å®šä¹‰ä¸€ä¸ª Java ç±»ï¼Œä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ³¨è§£å¹¶æŒ‡å®šé…ç½®å‰ç¼€ï¼ˆ&lt;code&gt;prefix&lt;/code&gt;ï¼‰ã€‚ç±»çš„å­—æ®µååº”ä¸é…ç½®é¡¹å»æ‰å‰ç¼€åçš„åç§°åŒ¹é…ï¼ˆæ”¯æŒæ¾æ•£ç»‘å®šï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;
import jakarta.validation.constraints.NotEmpty;
import jakarta.validation.constraints.NotNull;
import java.time.Duration;
import java.util.List;
@Component
@ConfigurationProperties(prefix = &amp;#34;app&amp;#34;) // æŒ‡å®šé…ç½®å‰ç¼€
public class AppConfig {
@NotNull // æ•°æ®æ ¡éªŒ
private String name;
private String version;
private Duration timeout; // æ”¯æŒæ—¶é—´å•ä½ï¼Œå¦‚ 30s, 5m
private DataSize maxFileSize; // æ”¯æŒæ•°æ®å¤§å°å•ä½ï¼Œå¦‚ 10MB, 1GB
@NotEmpty
private List&amp;lt;String&amp;gt; servers; // æ”¯æŒé›†åˆç±»å‹
// å¿…é¡»æä¾› getter å’Œ setter æ–¹æ³•
public String getName() { return name; }
public void setName(String name) { this.name = name; }
public String getVersion() { return version; }
public void setVersion(String version) { this.version = version; }
public Duration getTimeout() { return timeout; }
public void setTimeout(Duration timeout) { this.timeout = timeout; }
public DataSize getMaxFileSize() { return maxFileSize; }
public void setMaxFileSize(DataSize maxFileSize) { this.maxFileSize = maxFileSize; }
public List&amp;lt;String&amp;gt; getServers() { return servers; }
public void setServers(List&amp;lt;String&amp;gt; servers) { this.servers = servers; }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®-å¦‚-applicationyml"&gt;2. åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½® (å¦‚ &lt;code&gt;application.yml&lt;/code&gt;)
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;app:
name: my-application
version: &amp;#34;1.0.0&amp;#34;
timeout: 30s # æ—¶é—´å•ä½
max-file-size: 10MB # æ•°æ®å¤§å°å•ä½
servers:
- &amp;#34;server1.example.com&amp;#34;
- &amp;#34;server2.example.com&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­æ³¨å…¥å¹¶ä½¿ç”¨"&gt;3. åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­æ³¨å…¥å¹¶ä½¿ç”¨
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
@Service
public class MyService {
private final AppConfig appConfig;
@Autowired // é€šè¿‡æ„é€ å™¨æ³¨å…¥
public MyService(AppConfig appConfig) {
this.appConfig = appConfig;
}
public void doSomething() {
System.out.println(&amp;#34;App Name: &amp;#34; + appConfig.getName());
System.out.println(&amp;#34;Timeout: &amp;#34; + appConfig.getTimeout());
// ä½¿ç”¨å…¶ä»–é…ç½®...
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¿€æ´»é…ç½®ç»‘å®š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šå¸¸ï¼Œç»™é…ç½®ç±»æ·»åŠ  &lt;code&gt;@Component&lt;/code&gt;æ³¨è§£å³å¯å°†å…¶çº³å…¥ Spring å®¹å™¨ç®¡ç† ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº&lt;strong&gt;æ— æ³•ç›´æ¥æ·»åŠ æ³¨è§£çš„ç¬¬ä¸‰æ–¹ç±»&lt;/strong&gt;ï¼Œæˆ–å¸Œæœ›æ›´æ˜¾å¼åœ°ç®¡ç†æ—¶ï¼Œå¯åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ &lt;code&gt;@EnableConfigurationProperties(YourConfigClass.class)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¾æ•£ç»‘å®š (Relaxed Binding)&lt;/strong&gt;ï¼š&lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ”¯æŒå¤šç§å±æ€§åæ ¼å¼ï¼ˆå¦‚é©¼å³°ã€ä¸­åˆ’çº¿ã€ä¸‹åˆ’çº¿ï¼‰çš„è‡ªåŠ¨åŒ¹é…ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ä¸­ &lt;code&gt;max-file-size&lt;/code&gt;å¯è‡ªåŠ¨ç»‘å®šåˆ° Java ç±»ä¸­çš„ &lt;code&gt;maxFileSize&lt;/code&gt;å­—æ®µ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æ ¡éªŒ&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»ä¸Šæ·»åŠ  &lt;code&gt;@Validated&lt;/code&gt;æ³¨è§£ï¼Œå¹¶åœ¨å­—æ®µä¸Šä½¿ç”¨æ ¡éªŒæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@NotNull&lt;/code&gt;, &lt;code&gt;@Email&lt;/code&gt;, &lt;code&gt;@Size&lt;/code&gt;ç­‰ï¼‰ï¼Œå¯åœ¨åº”ç”¨å¯åŠ¨æ—¶å¯¹é…ç½®å€¼è¿›è¡Œæ ¡éªŒï¼Œæ— æ•ˆé…ç½®ä¼šé˜»æ­¢åº”ç”¨å¯åŠ¨ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚ç±»å‹ä¸åµŒå¥—é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;@ConfigurationProperties&lt;/code&gt;å¯ä»¥è½»æ¾å¤„ç†åµŒå¥—å¯¹è±¡ã€åˆ—è¡¨ã€Map ç­‰å¤æ‚æ•°æ®ç»“æ„ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å… YAML é…ç½®ä¸­çš„å…«è¿›åˆ¶é™·é˜±&lt;/strong&gt;ï¼šåœ¨ YAML é…ç½®ä¸­ï¼Œä»¥ &lt;code&gt;0&lt;/code&gt;å¼€å¤´çš„æ•°å­—ï¼ˆå¦‚ &lt;code&gt;0127&lt;/code&gt;ï¼‰ä¼šè¢«è§£æä¸ºå…«è¿›åˆ¶æ•°ã€‚ä¸ºé¿å…æ„å¤–ï¼Œå»ºè®®å¯¹æ•°å­—ç‰¹åˆ«æ˜¯ä»¥ &lt;code&gt;0&lt;/code&gt;å¼€å¤´çš„æ•°å­—ä½¿ç”¨å¼•å·ï¼ˆå¦‚ &lt;code&gt;port: &amp;quot;0127&amp;quot;&lt;/code&gt;ï¼‰å°†å…¶æ˜ç¡®è¡¨ç¤ºä¸ºå­—ç¬¦ä¸² ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ“š æ€»ç»“
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;@Value&lt;/code&gt;åœ¨æ³¨å…¥å°‘é‡ç®€å•é…ç½®æ—¶ä¾ç„¶æ–¹ä¾¿ï¼Œä½† &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æä¾›äº†ä¸€ç§æ›´&lt;strong&gt;ç°ä»£ã€å¥å£®ã€å¯ç»´æŠ¤&lt;/strong&gt;çš„é…ç½®ç®¡ç†æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆäºç®¡ç†å¤§é‡æˆ–ç»“æ„åŒ–çš„é…ç½®ã€‚&lt;strong&gt;å»ºè®®ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@ConfigurationProperties&lt;/code&gt;æ¥ç»„ç»‡ä½ çš„é…ç½®&lt;/strong&gt;ï¼Œè®©ä»£ç æ›´æ¸…æ™°ã€æ›´å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´ä¼˜é›…åœ°ç®¡ç† Spring Boot åº”ç”¨çš„é…ç½®ï¼&lt;/p&gt;
&lt;h2 id="å­è¿›ç¨‹--çº¿ç¨‹"&gt;å­è¿›ç¨‹ &amp;amp; çº¿ç¨‹
&lt;/h2&gt;&lt;p&gt;ç†è§£å­è¿›ç¨‹å’Œçº¿ç¨‹åœ¨å†…å­˜è®¿é—®å’Œèµ„æºç®¡ç†ä¸Šçš„åŒºåˆ«ï¼Œå¯¹è®¾è®¡å¹¶å‘ç¨‹åºå¾ˆé‡è¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œå¸®ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒå·®å¼‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;å­è¿›ç¨‹ (Subprocess)&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ (Thread)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç‹¬ç«‹&lt;/strong&gt;çš„åœ°å€ç©ºé—´ï¼Œ&lt;strong&gt;å¤åˆ¶&lt;/strong&gt;çˆ¶è¿›ç¨‹çš„å †æ ˆæ•°æ®ï¼ˆé€šå¸¸é‡‡ç”¨&lt;strong&gt;å†™æ—¶å¤åˆ¶&lt;/strong&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å…±äº«&lt;/strong&gt;æ‰€å±è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼ˆå †ã€å…¨å±€å˜é‡ï¼‰ï¼Œæ‹¥æœ‰&lt;strong&gt;ç‹¬ç«‹&lt;/strong&gt;çš„æ ˆç©ºé—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºå¼€é”€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒå¤§&lt;/strong&gt;ã€‚åˆ›å»ºéœ€å¤åˆ¶çˆ¶è¿›ç¨‹èµ„æºï¼ˆå¦‚å†…å­˜é¡µè¡¨ï¼‰ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ä¹Ÿè¾ƒå¤§&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒå°&lt;/strong&gt;ã€‚åˆ›å»ºåªéœ€åˆ†é…ç‹¬ç«‹æ ˆå’Œå°‘é‡å¯„å­˜å™¨ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¿«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®å…±äº«ä¸é€šä¿¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é€šè¿‡&lt;strong&gt;è¿›ç¨‹é—´é€šä¿¡ (IPC)&lt;/strong&gt;ï¼Œå¦‚ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ç­‰ï¼Œç›¸å¯¹å¤æ‚&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç›´æ¥å…±äº«&lt;/strong&gt;è¿›ç¨‹çš„å…¨å±€æ•°æ®ã€å †å†…å­˜ï¼Œé€šè¿‡&lt;strong&gt;åŒæ­¥åŸè¯­&lt;/strong&gt;ï¼ˆå¦‚äº’æ–¥é”ï¼‰åè°ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‹¬ç«‹æ€§/éš”ç¦»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼ºéš”ç¦»&lt;/strong&gt;ã€‚ä¸€ä¸ªå­è¿›ç¨‹å´©æºƒ&lt;strong&gt;é€šå¸¸ä¸ä¼š&lt;/strong&gt;å½±å“çˆ¶è¿›ç¨‹æˆ–å…¶ä»–å­è¿›ç¨‹&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼±éš”ç¦»&lt;/strong&gt;ã€‚ä¸€ä¸ªçº¿ç¨‹å´©æºƒ&lt;strong&gt;å¯èƒ½å¯¼è‡´&lt;/strong&gt;æ•´ä¸ªè¿›ç¨‹ç»ˆæ­¢ï¼Œå½±å“åŒè¿›ç¨‹æ‰€æœ‰çº¿ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ›å»ºé€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒæ…¢&lt;/strong&gt;ï¼Œå› ä¸ºéœ€è¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´å’Œèµ„æº&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¾ƒå¿«&lt;/strong&gt;ï¼Œå› ä¸ºå…±äº«è¿›ç¨‹çš„å¤§éƒ¨åˆ†èµ„æºï¼Œåªéœ€åˆ†é…ç‹¬ç«‹çš„æ ˆå’Œå¯„å­˜å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒåº¦ä¸åˆ‡æ¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒåº¦ï¼Œè¿›ç¨‹é—´åˆ‡æ¢æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´åˆ‡æ¢ï¼Œ&lt;strong&gt;å¼€é”€å¤§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒåº¦ï¼ˆå†…æ ¸çº§çº¿ç¨‹ï¼‰ï¼Œçº¿ç¨‹é—´åˆ‡æ¢åªéœ€ä¿å­˜æ¢å¤å¯„å­˜å™¨ã€æ ˆç­‰ï¼Œ&lt;strong&gt;å¼€é”€å°&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®¡ç®—å¯†é›†å‹&lt;/strong&gt;ä»»åŠ¡ã€éœ€è¦&lt;strong&gt;å¼ºéš”ç¦»æ€§&lt;/strong&gt;å’Œ&lt;strong&gt;ç¨³å®šæ€§&lt;/strong&gt;çš„åœºæ™¯ï¼ˆå¦‚å®‰å…¨æ²™ç®±ã€å¾®æœåŠ¡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;I/Oå¯†é›†å‹&lt;/strong&gt;ä»»åŠ¡ã€éœ€è¦&lt;strong&gt;é«˜é¢‘æ•°æ®å…±äº«&lt;/strong&gt;å’Œ&lt;strong&gt;ä½å»¶è¿Ÿé€šä¿¡&lt;/strong&gt;çš„åœºæ™¯ï¼ˆå¦‚WebæœåŠ¡å™¨ã€GUIåº”ç”¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ğŸ§  &lt;strong&gt;æ·±å…¥ç†è§£â€œå†™æ—¶å¤åˆ¶â€ (Copy-On-Write, COW)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å­è¿›ç¨‹å¹¶éåœ¨åˆ›å»ºç¬é—´å°±å®Œæ•´å¤åˆ¶çˆ¶è¿›ç¨‹çš„æ‰€æœ‰å †æ ˆæ•°æ®ã€‚ç°ä»£æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Linuxï¼‰æ™®éé‡‡ç”¨&lt;strong&gt;å†™æ—¶å¤åˆ¶&lt;/strong&gt;æŠ€æœ¯æ¥ä¼˜åŒ–æ€§èƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºæ—¶&lt;/strong&gt;ï¼šå­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜é¡µï¼Œå†…æ ¸ä»…å°†é¡µè¡¨æ ‡è®°ä¸ºåªè¯»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¿®æ”¹æ—¶&lt;/strong&gt;ï¼šå½“çˆ¶æˆ–å­è¿›ç¨‹å°è¯•å†™å…¥æŸé¡µæ—¶ï¼Œå†…æ ¸ä¼š&lt;strong&gt;é€æ˜åœ°&lt;/strong&gt;ä¸ºè¯¥è¿›ç¨‹å¤åˆ¶ä¸€ä¸ªè¯¥é¡µçš„å‰¯æœ¬ä¾›å…¶ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·é¿å…äº†ä¸å¿…è¦çš„å¤åˆ¶ï¼Œå¤§å¤§å‡å°‘äº†è¿›ç¨‹åˆ›å»ºçš„å¼€é”€å’Œåˆå§‹å†…å­˜å ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å¦‚ä½•é€‰æ‹©ï¼šå­è¿›ç¨‹ vs. çº¿ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©çš„å…³é”®å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘å­è¿›ç¨‹çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦é«˜ç¨³å®šæ€§å’Œéš”ç¦»æ€§&lt;/strong&gt;ï¼šå…³é”®ä»»åŠ¡ç»„ä»¶ï¼Œå¸Œæœ›ä¸€ä¸ªå•å…ƒçš„å´©æºƒä¸å½±å“å…¶ä»–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ©ç”¨å¤šæ ¸è¿›è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡&lt;/strong&gt;ï¼šå¦‚ç§‘å­¦è®¡ç®—ã€å›¾åƒæ¸²æŸ“ï¼Œè¿›ç¨‹å¯ç‹¬ç«‹åœ¨ä¸åŒCPUæ ¸å¿ƒè¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½æ¨¡å—éœ€ç‹¬ç«‹éƒ¨ç½²æˆ–ä¼¸ç¼©&lt;/strong&gt;ï¼šç±»ä¼¼å¾®æœåŠ¡æ¶æ„çš„æ€æƒ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘çº¿ç¨‹çš„æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦å¤§é‡å¹¶å‘å¤„ç†I/Oæ“ä½œ&lt;/strong&gt;ï¼šå¦‚ç½‘ç»œæœåŠ¡å™¨å¤„ç†æµ·é‡è¯·æ±‚ï¼Œçº¿ç¨‹é—´åˆ‡æ¢å¼€é”€å°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹é—´éœ€è¦é¢‘ç¹ã€é«˜æ•ˆåœ°å…±äº«å’Œäº¤æ¢æ•°æ®&lt;/strong&gt;ï¼šå¦‚å›¾å½¢ç•Œé¢åº”ç”¨å“åº”äº¤äº’å¹¶å®æ—¶æ›´æ–°æ˜¾ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡å¯åˆ†è§£ä¸ºå¤šä¸ªé¡ºåºæ­¥éª¤å¹¶æµæ°´çº¿åŒ–&lt;/strong&gt;ï¼šå¦‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ¨¡å¼&lt;/strong&gt;ï¼šç°ä»£å¤æ‚ç³»ç»Ÿå¸¸æ··åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤šè¿›ç¨‹çš„WebæœåŠ¡å™¨ï¼ˆå¤šä¸ªWorkerè¿›ç¨‹ï¼‰ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨åˆæ˜¯å¤šçº¿ç¨‹çš„ï¼ˆå¤„ç†å¤šä¸ªè¯·æ±‚ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å­è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;h2 id="meta-inf"&gt;META-INF
&lt;/h2&gt;&lt;p&gt;META-INF å’Œ WEB-INF éƒ½æ˜¯ Java ç›¸å…³é¡¹ç›®ä¸­å¸¸è§çš„ç›®å½•ï¼Œä½†å®ƒä»¬çš„&lt;strong&gt;ç›®çš„ã€ä½ç½®å’Œå†…å®¹&lt;/strong&gt;æœ‰æ˜¾è‘—ä¸åŒã€‚ä¸ºäº†å¸®ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒåŒºåˆ«ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ±‡æ€»ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;META-INF&lt;/th&gt;
&lt;th&gt;WEB-INF&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ &lt;strong&gt;JAR åŒ…/Javaåº”ç”¨çš„å…ƒæ•°æ®&lt;/strong&gt; (Metadata)&lt;/td&gt;
&lt;td&gt;å­˜æ”¾ &lt;strong&gt;Java Web åº”ç”¨çš„é…ç½®å’Œæ ¸å¿ƒèµ„æº&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸è§ä½ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½äº &lt;strong&gt;JAR æ–‡ä»¶&lt;/strong&gt;çš„æ ¹ç›®å½•ä¸‹ï¼Œæˆ–é¡¹ç›®&lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹&lt;/td&gt;
&lt;td&gt;ä½äº &lt;strong&gt;Java Web åº”ç”¨&lt;/strong&gt;çš„æ ¹ç›®å½•ä¸‹ (ä¾‹å¦‚ &lt;code&gt;src/main/webapp/WEB-INF&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯å¦å¯ç›´æ¥é€šè¿‡URLè®¿é—®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸&lt;strong&gt;ä¸èƒ½&lt;/strong&gt;ç›´æ¥é€šè¿‡æµè§ˆå™¨è®¿é—®&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç»å¯¹ä¸èƒ½&lt;/strong&gt;ç›´æ¥é€šè¿‡å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰URLè®¿é—®ï¼Œæ˜¯æœåŠ¡ç«¯å®‰å…¨ç›®å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæ–‡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;MANIFEST.MF&lt;/code&gt;, &lt;code&gt;spring.factories&lt;/code&gt;, æœåŠ¡æä¾›è€…é…ç½®ç­‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;web.xml&lt;/code&gt;, &lt;code&gt;/classes&lt;/code&gt;, &lt;code&gt;/lib&lt;/code&gt;, &lt;code&gt;/jsp&lt;/code&gt;ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ä½œç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸º &lt;strong&gt;JVMã€æ¡†æ¶ã€å®¹å™¨&lt;/strong&gt; æä¾›é…ç½®ä¿¡æ¯ï¼Œç”¨äº&lt;strong&gt;å¼•å¯¼ã€é…ç½®ã€æ‰©å±•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®Webåº”ç”¨&lt;/strong&gt;ï¼ˆServletã€Filterï¼‰ã€&lt;strong&gt;å­˜æ”¾ç¼–è¯‘åçš„ç±»æ–‡ä»¶&lt;/strong&gt;ã€&lt;strong&gt;ç®¡ç†ä¾èµ–åº“&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ·±å…¥äº†è§£-meta-inf"&gt;ğŸ“¦ æ·±å…¥äº†è§£ META-INF
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;META-INF&lt;/code&gt;ç›®å½•ä¸»è¦ç”¨äºå­˜å‚¨ &lt;strong&gt;JAR åŒ…æˆ– Java åº”ç”¨çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰å’Œé…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™äº›ä¿¡æ¯è¢« Java è™šæ‹Ÿæœºã€æ¡†æ¶æˆ–å®¹å™¨è¯†åˆ«å’Œä½¿ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½ç½®&lt;/strong&gt;ï¼šé€šå¸¸ä½äº &lt;strong&gt;JAR æ–‡ä»¶çš„æ ¹ç›®å½•&lt;/strong&gt;ã€‚åœ¨ Maven/Gradle é¡¹ç›®ä¸­ï¼Œä½ é€šå¸¸ä¼šæŠŠéœ€è¦æ‰“åŒ…è¿› JAR çš„ &lt;code&gt;META-INF&lt;/code&gt;èµ„æºæ–‡ä»¶æ”¾åœ¨ &lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ–‡ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MANIFEST.MF&lt;/code&gt;&lt;/strong&gt;ï¼šæœ€é‡è¦çš„æ–‡ä»¶ï¼Œå®šä¹‰äº† JAR åŒ…çš„å…ƒæ•°æ®ï¼Œå¦‚&lt;strong&gt;ä¸»ç±»ï¼ˆMain-Classï¼‰&lt;/strong&gt;ã€&lt;strong&gt;ç±»è·¯å¾„ï¼ˆClass-Pathï¼‰&lt;/strong&gt;ã€ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;spring.factories&lt;/code&gt;&lt;/strong&gt; / &lt;strong&gt;&lt;code&gt;spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports&lt;/code&gt;&lt;/strong&gt;ï¼šSpring Boot ç”¨äº&lt;strong&gt;è‡ªåŠ¨é…ç½®&lt;/strong&gt;çš„å…³é”®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;services/&lt;/code&gt;&lt;/strong&gt; ç›®å½•ï¼šç”¨äº &lt;strong&gt;Java SPIï¼ˆService Provider Interfaceï¼‰&lt;/strong&gt; æœºåˆ¶ï¼Œå­˜æ”¾æœåŠ¡æ¥å£å®ç°ç±»çš„é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;INDEX.LIST&lt;/code&gt;&lt;/strong&gt;ï¼šåŒ…å« JAR ä¸­ç±»å’Œèµ„æºçš„åˆ—è¡¨ï¼Œç”¨äºåŠ é€Ÿç±»åŠ è½½ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–ï¼šå¦‚æ•°å­—ç­¾åæ–‡ä»¶ï¼ˆ&lt;code&gt;.SF&lt;/code&gt;, &lt;code&gt;.DSA&lt;/code&gt;ç­‰ï¼‰ã€&lt;code&gt;persistence.xml&lt;/code&gt;ï¼ˆJPAé…ç½®ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ·±å…¥äº†è§£-web-inf"&gt;ğŸŒ æ·±å…¥äº†è§£ WEB-INF
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;WEB-INF&lt;/code&gt;æ˜¯ &lt;strong&gt;Java Web åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªå®‰å…¨ç›®å½•&lt;/strong&gt;ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶å’Œæ ¸å¿ƒèµ„æºã€‚&lt;strong&gt;å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰æ— æ³•ç›´æ¥é€šè¿‡ URL è®¿é—®è¯¥ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™æ˜¯ Java Web åº”ç”¨å®‰å…¨æ¨¡å‹çš„é‡è¦éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½ç½®&lt;/strong&gt;ï¼šä½äº &lt;strong&gt;Java Web åº”ç”¨çš„æ ¹ç›®å½•&lt;/strong&gt;ä¸‹ã€‚åœ¨æ ‡å‡† Maven Web é¡¹ç›®ä¸­ï¼Œè·¯å¾„é€šå¸¸æ˜¯ &lt;code&gt;src/main/webapp/WEB-INF&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ–‡ä»¶ä¸å­ç›®å½•&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;web.xml&lt;/code&gt;&lt;/strong&gt;ï¼šWeb åº”ç”¨çš„&lt;strong&gt;éƒ¨ç½²æè¿°ç¬¦æ–‡ä»¶&lt;/strong&gt;ï¼Œæ˜¯æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚ç”¨äºå®šä¹‰ Servletã€Filterã€Listenerã€æ¬¢è¿é¡µé¢ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/classes/&lt;/code&gt;&lt;/strong&gt; ç›®å½•ï¼šå­˜æ”¾&lt;strong&gt;ç¼–è¯‘åçš„ Java ç±»æ–‡ä»¶&lt;/strong&gt;ï¼ˆ.classï¼‰ï¼Œä¾‹å¦‚ä½ çš„ Servletsã€å·¥å…·ç±»ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/lib/&lt;/code&gt;&lt;/strong&gt; ç›®å½•ï¼šå­˜æ”¾ Web åº”ç”¨ä¾èµ–çš„&lt;strong&gt;ç¬¬ä¸‰æ–¹ JAR æ–‡ä»¶&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/jsp/&lt;/code&gt;&lt;/strong&gt; æˆ– &lt;strong&gt;&lt;code&gt;/jsp2/&lt;/code&gt;&lt;/strong&gt; ç­‰ç›®å½•ï¼šå¸¸æŒ‰æƒ¯ä¾‹ç”¨äºå­˜æ”¾ &lt;strong&gt;JSP æ–‡ä»¶&lt;/strong&gt;ï¼Œè¿™äº›é¡µé¢ä¹Ÿæ— æ³•è¢«å®¢æˆ·ç«¯ç›´æ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡ Servlet è½¬å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®æ–¹å¼&lt;/strong&gt;ï¼š&lt;code&gt;WEB-INF&lt;/code&gt;ä¸‹çš„èµ„æºï¼ˆå¦‚ä¸€å¼ å›¾ç‰‡æˆ–ä¸€ä¸ªJSPï¼‰è‹¥è¦è¢«å‰ç«¯è®¿é—®ï¼Œ&lt;strong&gt;å¿…é¡»é€šè¿‡æœåŠ¡å™¨ç«¯ç¨‹åºï¼ˆå¦‚ Servletã€Controllerï¼‰è¿›è¡Œä¸­è½¬&lt;/strong&gt;ï¼Œä¾‹å¦‚åœ¨ Servlet ä¸­è¯»å–æ–‡ä»¶æµå¹¶å†™å…¥å“åº”ï¼Œæˆ–é€šè¿‡æ§åˆ¶å™¨è½¬å‘è¯·æ±‚åˆ° JSP é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä¸è®°å¿†æŠ€å·§"&gt;ğŸ’¡ æ€»ç»“ä¸è®°å¿†æŠ€å·§
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;META-INF&lt;/code&gt;&lt;/strong&gt; æ˜¯ &lt;strong&gt;JAR åŒ…çš„â€œè¯´æ˜ä¹¦å’Œæ‰©å±•é…ç½®â€&lt;/strong&gt;ï¼Œç»™ JVM å’Œæ¡†æ¶çœ‹çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;WEB-INF&lt;/code&gt;&lt;/strong&gt; æ˜¯ &lt;strong&gt;Web åº”ç”¨çš„â€œå¿ƒè„å’Œå¤§è„‘â€&lt;/strong&gt;ï¼Œå­˜æ”¾é…ç½®ã€ä»£ç å’Œä¾èµ–ï¼Œå—ä¿æŠ¤ä¸”ä¸å…è®¸ç›´æ¥å¤–éƒ¨è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®°ä½ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼š&lt;strong&gt;&lt;code&gt;WEB-INF&lt;/code&gt;æ˜¯ Web åº”ç”¨ç‰¹æœ‰çš„å®‰å…¨ç›®å½•ï¼Œè€Œ &lt;code&gt;META-INF&lt;/code&gt;åˆ™å¹¿æ³›å­˜åœ¨äºå„ç§ JAR åŒ…ä¸­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id="qualifier"&gt;@Qualifier
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring ä¸­ï¼Œ&lt;code&gt;@Bean @Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;å’Œ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;è¿™ä¸¤ç§æ–¹å¼&lt;strong&gt;æœ€ä¸»è¦çš„åŒºåˆ«&lt;/strong&gt;åœ¨äºï¼š&lt;strong&gt;&lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;ç›´æ¥å®šä¹‰äº† Bean çš„åç§°ï¼ˆæˆ–æ ‡è¯†ç¬¦ï¼‰&lt;/strong&gt;ï¼Œè€Œ &lt;strong&gt;&lt;code&gt;@Bean&lt;/code&gt;é…åˆ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;æ˜¯åœ¨å®šä¹‰ Bean çš„åŒæ—¶ï¼Œä¸ºå…¶æ·»åŠ äº†ä¸€ä¸ªåä¸º &amp;ldquo;backup&amp;rdquo; çš„â€œé™å®šç¬¦â€ï¼ˆQualifierï¼‰&lt;/strong&gt;ï¼Œè¿™ä¸ªé™å®šç¬¦å¯ä»¥ç†è§£ä¸º Bean çš„ä¸€ä¸ª&lt;strong&gt;é¢å¤–æ ‡ç­¾æˆ–å…ƒæ•°æ®&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼èƒ½å¸®ä½ æ›´æ¸…æ™°åœ°ç†è§£å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§å¯¹æ¯”&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@Bean&lt;/code&gt;+ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨è§£æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£ä¸­ç›´æ¥é€šè¿‡ &lt;code&gt;name&lt;/code&gt;æˆ– &lt;code&gt;value&lt;/code&gt;å±æ€§æŒ‡å®šåç§°&lt;/td&gt;
&lt;td&gt;è”åˆä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier&lt;/code&gt;ä¸¤ä¸ªæ³¨è§£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç”¨é€”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®šä¹‰ Bean çš„åç§°ï¼ˆæ ‡è¯†ç¬¦ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸º Bean æ·»åŠ ä¸€ä¸ªâ€œé™å®šç¬¦â€ï¼ˆQualifierï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean çš„åç§°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜ç¡®æŒ‡å®šä¸º &lt;code&gt;&amp;quot;backup&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸º &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•çš„æ–¹æ³•åï¼ˆé™¤éåŒæ—¶ä½¿ç”¨äº† &lt;code&gt;@Bean(name=&amp;quot;...&amp;quot;)&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é™å®šç¬¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆé™¤éé¢å¤–æ·»åŠ äº† &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£ï¼‰&lt;/td&gt;
&lt;td&gt;æ˜ç¡®æ·»åŠ äº† &lt;code&gt;&amp;quot;backup&amp;quot;&lt;/code&gt;è¿™ä¸ªé™å®šç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–æ³¨å…¥æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯é€šè¿‡åç§°åŒ¹é… (å¦‚ &lt;code&gt;@Resource(name=&amp;quot;backup&amp;quot;)&lt;/code&gt;) æˆ– &lt;code&gt;@Qualifier&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šå¸¸éœ€è¦æ˜ç¡®ä½¿ç”¨ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;æ¥æŒ‡å®šæ³¨å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦ç”¨äº&lt;strong&gt;å®šä¹‰ Bean çš„åç§°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»è¦ç”¨äº&lt;strong&gt;ä¸º Bean æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ï¼Œä»¥ä¾¿åœ¨ä¾èµ–æ³¨å…¥æ—¶è¿›è¡Œæ›´ç²¾ç»†çš„åŒºåˆ†å’Œé€‰æ‹©&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ç®€å•æ¥è¯´"&gt;ğŸ’¡ ç®€å•æ¥è¯´
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ åªæ˜¯æƒ³&lt;strong&gt;ç»™è¿™ä¸ª Bean å–ä¸ªç‰¹å®šçš„åå­—&lt;/strong&gt;ï¼Œé‚£ä¹ˆ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;æ›´ç›´æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ å¸Œæœ›ä¸ºè¿™ä¸ª Bean &lt;strong&gt;æ‰“ä¸Šä¸€ä¸ªç‰¹æ®Šçš„â€œæ ‡ç­¾â€&lt;/strong&gt;ï¼Œä»¥ä¾¿åœ¨å…¶ä»–åœ°æ–¹&lt;strong&gt;é€šè¿‡è¿™ä¸ªâ€œæ ‡ç­¾â€æ¥ç²¾ç¡®é€‰æ‹©å®ƒ&lt;/strong&gt;ï¼ˆå°¤å…¶æ˜¯åœ¨æœ‰å¤šä¸ªåŒç±»å‹ Bean éœ€è¦åŒºåˆ†æ—¶ï¼‰ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;é…åˆ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä»£ç ç¤ºä¾‹"&gt;ğŸ› ï¸ ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª &lt;code&gt;MyService&lt;/code&gt;ç±»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼å®šä¹‰çš„ Beanï¼Œå…¶&lt;strong&gt;åç§°&lt;/strong&gt;å°±æ˜¯ &amp;ldquo;backup&amp;rdquo;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean(&amp;#34;backup&amp;#34;) // Bean çš„åç§°è¢«å®šä¹‰ä¸º &amp;#34;backup&amp;#34;
public MyService myService() {
return new MyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ³¨å…¥æ—¶ï¼Œå¯ä»¥é€šè¿‡åç§°åŒ¹é…ï¼ˆå¦‚ &lt;code&gt;@Resource&lt;/code&gt;ï¼‰æˆ–ç»“åˆ &lt;code&gt;@Qualifier&lt;/code&gt;æ¥æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// ä½¿ç”¨ @Resource æŒ‰åç§°æ³¨å…¥
@Resource(name = &amp;#34;backup&amp;#34;)
private MyService backupService;
// æˆ–è€…ä½¿ç”¨ @Autowired å’Œ @Qualifier æŒ‰åç§°æ³¨å…¥
@Autowired
@Qualifier(&amp;#34;backup&amp;#34;)
private MyService backupService;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;2. ä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼å®šä¹‰çš„ Beanï¼Œå…¶&lt;strong&gt;åç§°é»˜è®¤æ˜¯æ–¹æ³•å&lt;/strong&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;myService&lt;/code&gt;ï¼‰ï¼Œä½†åŒæ—¶å®ƒæ‹¥æœ‰ä¸€ä¸ªåä¸º &amp;ldquo;backup&amp;rdquo; çš„&lt;strong&gt;é™å®šç¬¦&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean
@Qualifier(&amp;#34;backup&amp;#34;) // ä¸ºè¿™ä¸ª Bean æ·»åŠ äº†ä¸€ä¸ª &amp;#34;backup&amp;#34; çš„é™å®šç¬¦
public MyService myService() {
return new MyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ³¨å…¥æ—¶ï¼Œ&lt;strong&gt;é€šå¸¸éœ€è¦æ˜ç¡®ä½¿ç”¨ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;&lt;/strong&gt; æ¥æŒ‡å®šè¦æ³¨å…¥çš„æ˜¯å¸¦æœ‰è¿™ä¸ªé™å®šç¬¦çš„ Beanï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// éœ€è¦é…åˆ @Qualifier æ¥æŒ‡å®šæ³¨å…¥å¸¦æœ‰è¯¥é™å®šç¬¦çš„ Bean
@Autowired
@Qualifier(&amp;#34;backup&amp;#34;)
private MyService backupService;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„ç‚¹å’Œå¸¸è§ç–‘é—®"&gt;âš ï¸ æ³¨æ„ç‚¹å’Œå¸¸è§ç–‘é—®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ä»¥ç»„åˆä½¿ç”¨&lt;/strong&gt;ï¼šä½ å®Œå…¨å¯ä»¥åŒæ—¶ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier(&amp;quot;backup&amp;quot;)&lt;/code&gt;ï¼Œè¿™æ · Bean çš„åç§°æ˜¯ &amp;ldquo;backup&amp;rdquo;ï¼ŒåŒæ—¶å®ƒä¹Ÿæœ‰ä¸€ä¸ª &amp;ldquo;backup&amp;rdquo; çš„é™å®šç¬¦ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Bean(&amp;#34;backup&amp;#34;) // æŒ‡å®šBeanåç§°ä¸º&amp;#34;backup&amp;#34;
@Qualifier(&amp;#34;backup&amp;#34;) // åŒæ—¶ä¸ºå…¶æ·»åŠ &amp;#34;backup&amp;#34;é™å®šç¬¦
public MyService myService() {
return new MyService();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™å®šç¬¦çš„å¨åŠ›&lt;/strong&gt;ï¼š&lt;code&gt;@Qualifier&lt;/code&gt;çš„çœŸæ­£å¨åŠ›åœ¨äºå®ƒå¯ä»¥ç”¨äº&lt;strong&gt;åˆ†ç»„&lt;/strong&gt;ã€‚ä½ å¯ä»¥ä¸ºå¤šä¸ªä¸åŒçš„ Bean æ‰“ä¸Š&lt;strong&gt;ç›¸åŒçš„é™å®šç¬¦&lt;/strong&gt;ï¼Œç„¶ååœ¨æ³¨å…¥ç‚¹æ—¶ï¼Œæ³¨å…¥æ‰€æœ‰å¸¦æœ‰è¯¥é™å®šç¬¦çš„ Beanï¼ˆä¾‹å¦‚æ³¨å…¥ä¸€ä¸ª &lt;code&gt;List&amp;lt;MyService&amp;gt;&lt;/code&gt;ï¼‰ã€‚è¿™æ˜¯å•çº¯ä½¿ç”¨ Bean åç§°éš¾ä»¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Primary&lt;/code&gt;çš„ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“åŒæ—¶å­˜åœ¨ &lt;code&gt;@Primary&lt;/code&gt;Bean å’Œä½¿ç”¨äº† &lt;code&gt;@Qualifier&lt;/code&gt;æŒ‡å®šçš„ Bean æ—¶ï¼Œ&lt;strong&gt;&lt;code&gt;@Qualifier&lt;/code&gt;çš„æ¡ä»¶æ›´ä¸¥æ ¼ï¼Œä¼˜å…ˆçº§æ›´é«˜&lt;/strong&gt;ï¼ŒSpring ä¼šä¼˜å…ˆæ³¨å…¥æ»¡è¶³ &lt;code&gt;@Qualifier&lt;/code&gt;æ¡ä»¶çš„ Beanã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å¦‚ä½•é€‰æ‹©"&gt;å¦‚ä½•é€‰æ‹©ï¼Ÿ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœä½ åªæ˜¯æƒ³å‘½åï¼Œ&lt;strong&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;backup&amp;quot;)&lt;/code&gt;å°±è¶³å¤Ÿäº†&lt;/strong&gt;ï¼Œæ›´åŠ ç®€æ´ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ éœ€è¦&lt;strong&gt;åŸºäºæŸç§ç‰¹å¾ï¼ˆè€Œä¸ä»…ä»…æ˜¯åå­—ï¼‰æ¥åŒºåˆ†æˆ–é€‰æ‹© Bean&lt;/strong&gt;æ—¶ï¼Œ&lt;code&gt;@Qualifier&lt;/code&gt;å°±éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰å¤šä¸ªæ•°æ®æºï¼Œå¯ä»¥ç”¨ &lt;code&gt;@Qualifier(&amp;quot;master&amp;quot;)&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier(&amp;quot;slave&amp;quot;)&lt;/code&gt;æ¥æ ‡è®°ä¸»ä»æ•°æ®æºï¼Œä»£ç çš„è¯­ä¹‰ä¼šæ›´æ¸…æ™°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£ä¸¤è€…çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;h2 id="bean-list"&gt;@Bean List
&lt;/h2&gt;&lt;p&gt;å½“ä½ åŒæ—¶å®šä¹‰äº† &lt;code&gt;@Bean&lt;/code&gt;è¿”å› &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;å’Œ &lt;code&gt;@Bean&lt;/code&gt;è¿”å› &lt;code&gt;OpenAiInstance&lt;/code&gt;ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­é€šè¿‡ &lt;code&gt;@Autowired&lt;/code&gt;æ³¨å…¥ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;æ—¶ï¼ŒSpring çš„è¡Œä¸ºæœ‰ä¸€ä¸ªéå¸¸æ˜ç¡®çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒç»“è®º"&gt;âš¡ æ ¸å¿ƒç»“è®º
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;private final List&amp;lt;OpenAiInstance&amp;gt; instances;&lt;/code&gt;&lt;strong&gt;å°†ä¼šæ³¨å…¥ Spring å®¹å™¨ä¸­æ‰€æœ‰ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„ Bean&lt;/strong&gt;ã€‚è¿™åŒ…æ‹¬äº†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é‚£ä¸ªé€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¿”å›çš„&lt;strong&gt;å•ä¸ª &lt;code&gt;OpenAiInstance&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¿”å›çš„ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;&lt;strong&gt;é›†åˆä¸­çš„æ¯ä¸€ä¸ª &lt;code&gt;OpenAiInstance&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼ŒSpring ä¸ä¼šå› ä¸ºä½ å®šä¹‰äº†ä¸€ä¸ªè¿”å› &lt;code&gt;List&lt;/code&gt;çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ï¼Œå°±æŠŠè¿™ä¸ª &lt;code&gt;List&lt;/code&gt;æœ¬èº«å½“ä½œä¸€ä¸ª Bean æ³¨å…¥åˆ° &lt;code&gt;instances&lt;/code&gt;ä¸­ã€‚è€Œæ˜¯ä¼šè¿›è¡Œä¸€ç§ç§°ä¸ºâ€œé›†åˆæ³¨å…¥â€çš„æ“ä½œï¼Œå°†æ‰€æœ‰åŒ¹é…çš„å•ä¸ª Beanâ€œæ‰å¹³åŒ–â€åœ°æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„ &lt;code&gt;List&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è¯¦ç»†åˆ†æä¸ç¤ºä¾‹"&gt;ğŸ” è¯¦ç»†åˆ†æä¸ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä½ æœ‰å¦‚ä¸‹é…ç½®ç±»ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class OpenAiConfig {
// å®šä¹‰ä¸€ä¸ªè¿”å›å•ä¸ªOpenAiInstanceçš„Bean
@Bean
public OpenAiInstance primaryInstance() {
return new OpenAiInstance(&amp;#34;GPT-4o&amp;#34;, &amp;#34;api.key.primary&amp;#34;);
}
// å®šä¹‰ä¸€ä¸ªè¿”å›List&amp;lt;OpenAiInstance&amp;gt;çš„Bean
@Bean
public List&amp;lt;OpenAiInstance&amp;gt; backupInstances() {
return Arrays.asList(
new OpenAiInstance(&amp;#34;GPT-3.5-Turbo&amp;#34;, &amp;#34;api.key.backup1&amp;#34;),
new OpenAiInstance(&amp;#34;Claude-2&amp;#34;, &amp;#34;api.key.backup2&amp;#34;)
);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ä½ çš„æœåŠ¡ä¸­è¿™æ ·æ³¨å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyAIService {
private final List&amp;lt;OpenAiInstance&amp;gt; instances;
// æ„é€ å™¨æ³¨å…¥
public MyAIService(List&amp;lt;OpenAiInstance&amp;gt; instances) {
this.instances = instances;
}
public void useInstances() {
for (OpenAiInstance instance : instances) {
System.out.println(instance.getName());
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æœ€ç»ˆ-instancesåˆ—è¡¨ä¸­çš„å…ƒç´ "&gt;ğŸ’¡ æœ€ç»ˆ &lt;code&gt;instances&lt;/code&gt;åˆ—è¡¨ä¸­çš„å…ƒç´ 
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;MyAIService.instances&lt;/code&gt;è¿™ä¸ªåˆ—è¡¨å°†åŒ…å« &lt;strong&gt;3 ä¸ª&lt;/strong&gt; &lt;code&gt;OpenAiInstance&lt;/code&gt;å¯¹è±¡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¥è‡ª &lt;code&gt;primaryInstance()&lt;/code&gt;æ–¹æ³•è¿”å›çš„ Beanã€‚&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;code&gt;backupInstances()&lt;/code&gt;æ–¹æ³•è¿”å›çš„ List ä¸­çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;code&gt;backupInstances()&lt;/code&gt;æ–¹æ³•è¿”å›çš„ List ä¸­çš„ç¬¬äºŒä¸ªå¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// instances åˆ—è¡¨ä¸­çš„å…ƒç´ å¤§è‡´ç›¸å½“äºï¼š
List&amp;lt;OpenAiInstance&amp;gt; injectedList = List.of(
primaryInstance(), // å•ç‹¬çš„Bean
backupInstances().get(0), // Listä¸­çš„ç¬¬ä¸€ä¸ª
backupInstances().get(1) // Listä¸­çš„ç¬¬äºŒä¸ª
);
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ€»ç»“ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ“Œ æ€»ç»“ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¡Œä¸º&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ³¨å…¥æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring ä¼šå¯¹æ³¨å…¥ç‚¹ï¼ˆå¦‚ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt; instances&lt;/code&gt;ï¼‰è¿›è¡Œ&lt;strong&gt;ç±»å‹åŒ¹é…&lt;/strong&gt;ï¼Œæ”¶é›†å®¹å™¨ä¸­æ‰€æœ‰è¯¥ç±»å‹çš„ Beanï¼Œè€ŒéæŒ‰åç§°åŒ¹é…æŸä¸ªç‰¹å®šçš„ List Beanã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean çš„æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨å…¥çš„ List åŒ…å«äº†æ‰€æœ‰ &lt;code&gt;OpenAiInstance&lt;/code&gt;ç±»å‹çš„ Beanï¼Œæ— è®ºå®ƒä»¬æ˜¯é€šè¿‡å•ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å®šä¹‰ï¼Œè¿˜æ˜¯ä½œä¸ºå¦ä¸€ä¸ª &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•è¿”å›çš„ Collectionï¼ˆList, Set ç­‰ï¼‰ä¸­çš„å…ƒç´ ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é¡ºåºé—®é¢˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†åˆä¸­ Bean çš„æ³¨å…¥é¡ºåºé»˜è®¤æ˜¯ä¸ç¡®å®šçš„ã€‚è‹¥è¦æ§åˆ¶é¡ºåºï¼Œå¯ä»¥åœ¨ Bean å®šä¹‰æˆ–ç±»ä¸Šä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Order&lt;/code&gt;&lt;/strong&gt; æ³¨è§£ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¦‚ä½•æ³¨å…¥ç‰¹å®šçš„ List Bean&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦‚æœä½ å¸Œæœ›æ³¨å…¥çš„æ˜¯ &lt;code&gt;backupInstances()&lt;/code&gt;æ–¹æ³•è¿”å›çš„é‚£ä¸ª&lt;strong&gt;å…·ä½“çš„ List å¯¹è±¡æœ¬èº«&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ‰å¹³åŒ–çš„ &lt;code&gt;OpenAiInstance&lt;/code&gt;Beanï¼Œä½ éœ€è¦ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@Qualifier&lt;/code&gt;&lt;/strong&gt; æ³¨è§£æ¥æŒ‰åç§°æŒ‡å®šï¼š &lt;code&gt;public MyAIService(@Qualifier(&amp;quot;backupInstances&amp;quot;) List&amp;lt;OpenAiInstance&amp;gt; instances)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ› ï¸ æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®æ„å›¾&lt;/strong&gt;ï¼šåœ¨è®¾è®¡æ—¶æƒ³æ¸…æ¥šï¼Œä½ æ˜¯å¸Œæœ›æ”¶é›†æ‰€æœ‰è¯¥ç±»å‹çš„ Beanï¼Œè¿˜æ˜¯åªæƒ³æ³¨å…¥æŸä¸€ä¸ªç‰¹å®šçš„é›†åˆã€‚å‰è€…å¸¸ç”¨äºç­–ç•¥æ¨¡å¼æˆ–å¤„ç†é“¾ï¼Œåè€…åˆ™æ˜¯ä¸€ä¸ªç‰¹å®šçš„é…ç½®é›†åˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;&lt;/strong&gt;ï¼šå½“å­˜åœ¨æ­§ä¹‰æ—¶ï¼ˆæ¯”å¦‚æœ‰å¤šä¸ªåŒç±»å‹çš„ Bean æˆ–å¤šä¸ªè¿”å›é›†åˆçš„ Beanï¼‰ï¼Œ&lt;strong&gt;å§‹ç»ˆä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ¥æ˜ç¡®æŒ‡å®šè¦æ³¨å…¥çš„ Bean çš„åç§°&lt;/strong&gt;ï¼Œè¿™æ˜¯æœ€å®‰å…¨ã€æœ€æ¸…æ™°çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶é¡ºåº&lt;/strong&gt;ï¼šå¦‚æœæ³¨å…¥çš„ List é¡ºåºå¯¹ä¸šåŠ¡é€»è¾‘å¾ˆé‡è¦ï¼ˆä¾‹å¦‚å¤„ç†å™¨çš„æ‰§è¡Œé¡ºåºï¼‰ï¼Œè®°å¾—ä½¿ç”¨ &lt;code&gt;@Order&lt;/code&gt;æ³¨è§£æ¥å®šä¹‰é¡ºåºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ å½»åº•ç†è§£ Spring çš„æ³¨å…¥è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h2 id="é€‰å–-list"&gt;é€‰å– List
&lt;/h2&gt;&lt;p&gt;è¦åœ¨ Spring ä¸­åªæ³¨å…¥ &lt;code&gt;List&amp;lt;OpenAiInstance&amp;gt;&lt;/code&gt;è€Œä¸æ³¨å…¥å•ç‹¬çš„ &lt;code&gt;OpenAiInstance&lt;/code&gt;Beanï¼Œæ ¸å¿ƒæ€è·¯æ˜¯è®© Spring åœ¨è‡ªåŠ¨è£…é…æ—¶ï¼Œèƒ½å¤Ÿæ˜ç¡®åŒºåˆ†ä½ è¦çš„æ˜¯ &lt;strong&gt;ä¸€ä¸ªå…·ä½“çš„ List Bean&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯&lt;strong&gt;æ‰€æœ‰ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„ Bean çš„é›†åˆ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å‡ ç§å®ç°æ–¹æ³•ï¼Œä½ å¯ä»¥æ ¹æ®é¡¹ç›®ç»“æ„é€‰æ‹©æœ€åˆé€‚çš„ä¸€ç§ï¼š&lt;/p&gt;
&lt;h3 id="æ–¹æ³•ä¸€è§ˆè¡¨"&gt;æ–¹æ³•ä¸€è§ˆè¡¨
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒæ€è·¯&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="#%e6%96%b9%e6%b3%95%e4%b8%80-%e4%bd%bf%e7%94%a8-qualifier-%e6%b3%a8%e8%a7%a3" &gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä¸º List Bean æ·»åŠ æ ‡è¯†ï¼Œæ³¨å…¥æ—¶æŒ‡å®šè¯¥æ ‡è¯†&lt;/td&gt;
&lt;td&gt;è¯­ä¹‰æ¸…æ™°ï¼ŒSpring æ ‡å‡†æ–¹å¼&lt;/td&gt;
&lt;td&gt;éœ€ç¡®ä¿æ³¨å…¥æ—¶ &lt;code&gt;@Qualifier&lt;/code&gt;çš„ value ä¸ Bean åç§°æˆ–é™å®šç¬¦ä¸€è‡´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="#%e6%96%b9%e6%b3%95%e4%ba%8c-%e4%bd%bf%e7%94%a8-resource-%e6%b3%a8%e8%a7%a3" &gt;ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£æŒ‰åç§°æ³¨å…¥&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ç›´æ¥æŒ‰ Bean çš„åç§°è¿›è¡Œæ³¨å…¥&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€æ´&lt;/td&gt;
&lt;td&gt;ä¾èµ– Bean çš„åç§°ï¼Œåç§°æ”¹å˜æ—¶éœ€åŒæ­¥ä¿®æ”¹æ³¨å…¥ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class="link" href="#%e8%a1%a5%e5%85%85%e8%af%b4%e6%98%8e-%e7%a1%ae%e4%bf%9d%e6%b2%a1%e6%9c%89%e6%97%a0%e5%85%b3%e7%9a%84%e5%8d%95%e7%8b%ac-bean" &gt;ç¡®ä¿æ²¡æœ‰æ— å…³çš„å•ç‹¬ Bean&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;ä»æºå¤´ä¸Šé¿å…äº§ç”Ÿä¸å¿…è¦çš„ Bean&lt;/td&gt;
&lt;td&gt;ä¸€åŠ³æ°¸é€¸&lt;/td&gt;
&lt;td&gt;å¯èƒ½ä¸é€‚ç”¨äºéœ€è¦å•ç‹¬ Bean çš„å¤æ‚åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ“ä½œæ–¹æ³•è¯¦è§£"&gt;ğŸ› ï¸ æ“ä½œæ–¹æ³•è¯¦è§£
&lt;/h3&gt;&lt;h4 id="æ–¹æ³•ä¸€-ä½¿ç”¨-qualifieræ³¨è§£"&gt;æ–¹æ³•ä¸€: ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£
&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯æœ€æ¨èå’Œå¸¸è§çš„æ–¹å¼ã€‚é€šè¿‡ä¸ºä½ çš„ List Bean æ·»åŠ ä¸€ä¸ªé™å®šç¬¦ï¼ˆQualifierï¼‰ï¼Œå¹¶åœ¨æ³¨å…¥ç‚¹æ˜ç¡®æŒ‡å®šè¿™ä¸ªé™å®šç¬¦ï¼Œæ¥ç²¾ç¡®æ§åˆ¶è¦æ³¨å…¥çš„ Beanã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ List Bean å¹¶æ·»åŠ é™å®šç¬¦&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½ çš„é…ç½®ç±»ä¸­ï¼Œå®šä¹‰è¿”å› List çš„æ–¹æ³•ï¼Œå¹¶ä¸ºå…¶æ·»åŠ  &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£ï¼ˆä¾‹å¦‚ï¼ŒæŒ‡å®šä¸º &lt;code&gt;&amp;quot;openaiInstanceList&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class OpenAiConfig {
@Bean
@Qualifier(&amp;#34;openaiInstanceList&amp;#34;) // ä¸ºè¿™ä¸ªList Beanæ·»åŠ ä¸€ä¸ªé™å®šç¬¦
public List&amp;lt;OpenAiInstance&amp;gt; openAiInstances() {
List&amp;lt;OpenAiInstance&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(new OpenAiInstance(&amp;#34;model-a&amp;#34;, &amp;#34;key-1&amp;#34;));
list.add(new OpenAiInstance(&amp;#34;model-b&amp;#34;, &amp;#34;key-2&amp;#34;));
return list;
}
// é¿å…åœ¨æ­¤é…ç½®ç±»ä¸­å®šä¹‰å•ç‹¬çš„ OpenAiInstance Bean
// æˆ–è€…ç¡®ä¿ä»»ä½•å•ç‹¬çš„ OpenAiInstance Bean æœ‰ä¸åŒçš„é™å®šç¬¦æˆ–åç§°
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å…¥æ—¶æŒ‡å®šé™å®šç¬¦&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½ çš„æœåŠ¡ç±»ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;@Autowired&lt;/code&gt;å’Œ &lt;code&gt;@Qualifier&lt;/code&gt;è¿›è¡Œæ³¨å…¥ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyAIService {
private final List&amp;lt;OpenAiInstance&amp;gt; instances;
// åœ¨æ„é€ å™¨å‚æ•°ä¸Šä½¿ç”¨ @Qualifier
public MyAIService(@Qualifier(&amp;#34;openaiInstanceList&amp;#34;) List&amp;lt;OpenAiInstance&amp;gt; instances) {
this.instances = instances; // è¿™é‡Œæ³¨å…¥çš„å°†åªæ˜¯ä½ ä¸Šé¢å®šä¹‰çš„List
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨å­—æ®µæ³¨å…¥ï¼ˆä½†é€šå¸¸æ›´æ¨èæ„é€ å™¨æ³¨å…¥ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
@Qualifier(&amp;#34;openaiInstanceList&amp;#34;)
private List&amp;lt;OpenAiInstance&amp;gt; instances;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ–¹æ³•äºŒ-ä½¿ç”¨-resourceæ³¨è§£"&gt;æ–¹æ³•äºŒ: ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£é»˜è®¤æŒ‰åç§°è¿›è¡Œæ³¨å…¥ã€‚å¦‚æœä½ ä¸º List Bean æŒ‡å®šäº†åç§°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æ³¨å…¥ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ List Bean å¹¶å‘½å&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;@Bean&lt;/code&gt;æ³¨è§£çš„ &lt;code&gt;name&lt;/code&gt;å±æ€§æˆ–ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Bean(&amp;quot;beanName&amp;quot;)&lt;/code&gt;ä¸º Bean å‘½åã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class OpenAiConfig {
@Bean(&amp;#34;myOpenAiList&amp;#34;) // æŒ‡å®šè¿™ä¸ªList Beançš„åç§°ä¸º &amp;#34;myOpenAiList&amp;#34;
public List&amp;lt;OpenAiInstance&amp;gt; openAiInstances() {
List&amp;lt;OpenAiInstance&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(new OpenAiInstance(&amp;#34;model-a&amp;#34;, &amp;#34;key-1&amp;#34;));
list.add(new OpenAiInstance(&amp;#34;model-b&amp;#34;, &amp;#34;key-2&amp;#34;));
return list;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Resource&lt;/code&gt;æŒ‰åç§°æ³¨å…¥&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Service
public class MyAIService {
@Resource(name = &amp;#34;myOpenAiList&amp;#34;) // æŒ‰åç§°æ³¨å…¥
private List&amp;lt;OpenAiInstance&amp;gt; instances;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="-è¡¥å……è¯´æ˜-ç¡®ä¿æ²¡æœ‰æ— å…³çš„å•ç‹¬-bean"&gt;ğŸ”§ è¡¥å……è¯´æ˜: ç¡®ä¿æ²¡æœ‰æ— å…³çš„å•ç‹¬ Bean
&lt;/h4&gt;&lt;p&gt;Spring ä¼šè‡ªåŠ¨å°†å®¹å™¨ä¸­æ‰€æœ‰ç±»å‹åŒ¹é…çš„ Bean æ³¨å…¥åˆ° &lt;code&gt;@Autowired&lt;/code&gt;å£°æ˜çš„é›†åˆä¸­ã€‚å› æ­¤ï¼Œè¯·æ£€æŸ¥ä½ çš„é¡¹ç›®ï¼Œ&lt;strong&gt;ç¡®ä¿æ²¡æœ‰å…¶ä»–è¢« Spring ç®¡ç†çš„ã€ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„å•ç‹¬ Bean&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥ç‚¹ï¼š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯å¦æœ‰å…¶ä»–ç±»è¢«æ ‡æ³¨äº† &lt;code&gt;@Component&lt;/code&gt;, &lt;code&gt;@Service&lt;/code&gt;, &lt;code&gt;@Repository&lt;/code&gt;ç­‰æ³¨è§£ï¼Œå¹¶ä¸”å…¶ç±»å‹æ˜¯ &lt;code&gt;OpenAiInstance&lt;/code&gt;ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åœ¨å…¶ä»–é…ç½®ç±»ä¸­ï¼Œæ˜¯å¦è¿˜æœ‰è¿”å›ç±»å‹ä¸º &lt;code&gt;OpenAiInstance&lt;/code&gt;çš„ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¿™äº›å•ç‹¬çš„ Bean å¹¶éå¿…è¦ï¼Œ&lt;strong&gt;ç§»é™¤&lt;/strong&gt;å®ƒä»¬çš„ Spring ç®¡ç†æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Component&lt;/code&gt;ï¼‰æˆ– &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿™äº›å•ç‹¬çš„ Bean æ˜¯å¿…éœ€çš„ï¼Œä½†ä¸èƒ½æ³¨å…¥åˆ°è¿™ä¸ªç‰¹å®šçš„ List ä¸­ï¼Œé‚£ä¹ˆä½ å°±å¿…é¡»ä½¿ç”¨ä¸Šè¿°çš„ &lt;code&gt;@Qualifier&lt;/code&gt;æˆ– &lt;code&gt;@Resource&lt;/code&gt;æ–¹æ³•æ¥è¿›è¡Œç²¾ç¡®æ³¨å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ ¸å¿ƒè¦ç‚¹"&gt;ğŸ’ æ ¸å¿ƒè¦ç‚¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜æ ¹æº&lt;/strong&gt;ï¼šSpring çš„ &lt;code&gt;@Autowired&lt;/code&gt;å¯¹é›†åˆçš„é»˜è®¤è¡Œä¸ºæ˜¯â€œæ”¶é›†æ‰€æœ‰ç›¸åŒç±»å‹çš„ Beanâ€ï¼Œè€Œä¸æ˜¯â€œæŒ‰åç§°æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„é›†åˆ Beanâ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³å…³é”®&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Qualifier&lt;/code&gt;æˆ– &lt;code&gt;@Resource&lt;/code&gt;æ³¨è§£ï¼Œå°†æ³¨å…¥ç­–ç•¥ä»â€œæŒ‰ç±»å‹æ”¶é›†â€è½¬å˜ä¸ºâ€œæŒ‰åç§°æŸ¥æ‰¾â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt;æ³¨è§£&lt;/strong&gt;é€šå¸¸æ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒè¯­ä¹‰æ˜ç¡®ï¼Œæ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºå¤„ç†è¿™ç§æ­§ä¹‰çš„æ ‡å‡†æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›æ–¹æ³•èƒ½å¸®åŠ©ä½ è§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="runnablefuture--completablefuture"&gt;RunnableFuture &amp;amp; CompletableFuture
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ &lt;code&gt;RunnableFuture&lt;/code&gt;å’Œ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„åŒºåˆ«å’Œè”ç³»ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°æ ¹æ®ä»»åŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚å·¥å…·ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;RunnableFuture (ä»¥FutureTaskä¸ºä»£è¡¨)&lt;/th&gt;
&lt;th&gt;CompletableFuture&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¥å£ï¼Œä¸»è¦å®ç°ç±»æ˜¯ &lt;code&gt;FutureTask&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…·ä½“çš„ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å°† &lt;code&gt;Runnable&lt;/code&gt;æˆ– &lt;code&gt;Callable&lt;/code&gt;ä»»åŠ¡åŒ…è£…ä¸ºå¯å¼‚æ­¥æ‰§è¡Œä¸”å¯è·å–ç»“æœçš„ &lt;code&gt;Future&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¼ºå¤§çš„&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡ç¼–æ’&lt;/strong&gt;èƒ½åŠ›ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ã€ç»„åˆå¤šä¸ªä»»åŠ¡ã€å¼‚å¸¸å¤„ç†ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼±ã€‚é€šå¸¸éœ€è‡ªè¡Œç®¡ç†å¤šä¸ª &lt;code&gt;Future&lt;/code&gt;çš„ä¾èµ–å’Œç»“æœè·å–&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æå…¶å¼ºå¤§&lt;/strong&gt;ã€‚æä¾› &lt;code&gt;thenApply&lt;/code&gt;/&lt;code&gt;thenAccept&lt;/code&gt;/&lt;code&gt;thenRun&lt;/code&gt;, &lt;code&gt;thenCompose&lt;/code&gt;, &lt;code&gt;thenCombine&lt;/code&gt;, &lt;code&gt;allOf&lt;/code&gt;/&lt;code&gt;anyOf&lt;/code&gt;ç­‰æ–¹æ³•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»“æœè·å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é˜»å¡å¼&lt;/strong&gt;ã€‚é€šè¿‡ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ï¼Œä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;éé˜»å¡å›è°ƒ&lt;/strong&gt;ã€‚å¯é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†ç»“æœï¼Œä¹Ÿæ”¯æŒé˜»å¡å¼çš„ &lt;code&gt;get()&lt;/code&gt;å’Œ &lt;code&gt;join()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ä¼šæŠ›å‡º &lt;code&gt;ExecutionException&lt;/code&gt;ï¼Œéœ€è‡ªè¡Œæ•è·å¤„ç†&lt;/td&gt;
&lt;td&gt;æä¾› &lt;code&gt;exceptionally&lt;/code&gt;, &lt;code&gt;handle&lt;/code&gt;, &lt;code&gt;whenComplete&lt;/code&gt;ç­‰æ–¹æ³•ï¼Œæ”¯æŒåœ¨å›è°ƒé“¾ä¸­ä¼˜é›…å¤„ç†å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚æ­¥æ‰§è¡Œæ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ä¾èµ– &lt;code&gt;ExecutorService&lt;/code&gt;æäº¤æ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;æä¾› &lt;code&gt;supplyAsync&lt;/code&gt;, &lt;code&gt;runAsync&lt;/code&gt;ç­‰é™æ€æ–¹æ³•ï¼Œå¯ç›´æ¥æäº¤å¼‚æ­¥ä»»åŠ¡ï¼ˆå¯æŒ‡å®šæˆ–ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç†å¿µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸ºä¸€ä¸ª&lt;strong&gt;å•ä¸€ä»»åŠ¡&lt;/strong&gt;æä¾›åŸºæœ¬å¼‚æ­¥æ‰§è¡Œå’Œç»“æœè·å–èƒ½åŠ›&lt;/td&gt;
&lt;td&gt;ä¸º&lt;strong&gt;å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„åä½œã€ç»„åˆå’Œç¼–æ’&lt;/strong&gt;è€Œè®¾è®¡ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒè”ç³»"&gt;ğŸ§© æ ¸å¿ƒè”ç³»
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å­˜åœ¨ä¸Šè¿°å·®å¼‚ï¼Œä½†ä¸¤è€…éƒ½è‡´åŠ›äºå®ç°å¼‚æ­¥è®¡ç®—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±åŒåŸºç¡€&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture&lt;/code&gt;å®ç°äº† &lt;code&gt;Future&lt;/code&gt;æ¥å£ï¼Œè€Œ &lt;code&gt;RunnableFuture&lt;/code&gt;ç»§æ‰¿è‡ª &lt;code&gt;Future&lt;/code&gt;ã€‚å› æ­¤ï¼Œ&lt;code&gt;CompletableFuture&lt;/code&gt;ä¹Ÿå…·å¤‡ &lt;code&gt;Future&lt;/code&gt;å®šä¹‰çš„åŸºæœ¬èƒ½åŠ›ï¼Œå¦‚åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆã€å–æ¶ˆä»»åŠ¡ä»¥åŠé€šè¿‡ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•é˜»å¡è·å–ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›®æ ‡ä¸€è‡´&lt;/strong&gt;ï¼šå®ƒä»¬éƒ½ç”¨äºå°†ä»»åŠ¡æäº¤åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼Œæé«˜ç¨‹åºå“åº”æ€§å’Œèµ„æºåˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-3"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å–å†³äºä½ çš„å…·ä½“åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;RunnableFuture&lt;/code&gt;(ä¸»è¦æ˜¯ &lt;code&gt;FutureTask&lt;/code&gt;) å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦ä¸€ä¸ª&lt;strong&gt;ç®€å•ã€å¯æ§&lt;/strong&gt;çš„æœºåˆ¶æ¥æ‰§è¡Œå•ä¸ªå¼‚æ­¥ä»»åŠ¡å¹¶è·å–å…¶ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;ä½ çš„ä»»åŠ¡é€»è¾‘ç›¸å¯¹&lt;strong&gt;ç‹¬ç«‹&lt;/strong&gt;ï¼Œä¸æ¶‰åŠå¤æ‚çš„åç»­ä¾èµ–æˆ–ç»„åˆæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;ä½ æ„¿æ„&lt;strong&gt;è‡ªè¡Œç®¡ç†&lt;/strong&gt;çº¿ç¨‹æ± å’Œä»»åŠ¡çš„æäº¤ã€‚&lt;/li&gt;
&lt;li&gt;ä½ ä¸éœ€è¦å¤æ‚çš„&lt;strong&gt;é“¾å¼å›è°ƒ&lt;/strong&gt;æˆ–&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;CompletableFuture&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦å¤„ç†&lt;strong&gt;å¤šä¸ªå¼‚æ­¥ä»»åŠ¡&lt;/strong&gt;ï¼Œå¹¶ä¸”è¿™äº›ä»»åŠ¡ä¹‹é—´å­˜åœ¨&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼ˆä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ªä»»åŠ¡çš„è¾“å…¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ æƒ³è¦&lt;strong&gt;ç»„åˆå¤šä¸ªä»»åŠ¡&lt;/strong&gt;çš„ç»“æœï¼ˆä¾‹å¦‚ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œæˆ–ç­‰å¾…å…¶ä¸­ä¸€ä¸ªå®Œæˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å¸Œæœ›ä½¿ç”¨&lt;strong&gt;éé˜»å¡çš„å›è°ƒ&lt;/strong&gt;æ–¹å¼å¤„ç†ä»»åŠ¡ç»“æœï¼Œè€Œä¸æ˜¯æ€»æ˜¯è°ƒç”¨é˜»å¡çš„ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å¸Œæœ›æœ‰&lt;strong&gt;æ›´å¼ºå¤§å’Œä¼˜é›…çš„å¼‚å¸¸å¤„ç†&lt;/strong&gt;æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨æ•´ä¸ªå¼‚æ­¥é“¾ä¸­ä¼ æ’­å’Œå¤„ç†å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;ä½ æ­£åœ¨å°è¯•ä»¥&lt;strong&gt;å‡½æ•°å¼ç¼–ç¨‹&lt;/strong&gt;çš„é£æ ¼ç¼–å†™å¼‚æ­¥ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œ&lt;code&gt;RunnableFuture&lt;/code&gt;ï¼ˆåŠå…¶å¸¸è§å®ç° &lt;code&gt;FutureTask&lt;/code&gt;ï¼‰æ˜¯&lt;strong&gt;åŸºç¡€çš„å·¥å…·&lt;/strong&gt;ï¼Œæä¾›äº†å¼‚æ­¥æ‰§è¡Œçš„åŸºæœ¬éª¨æ¶ï¼›è€Œ &lt;code&gt;CompletableFuture&lt;/code&gt;åˆ™æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºçš„&lt;strong&gt;é«˜é˜¶å·¥å…·&lt;/strong&gt;ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œè¯­æ³•ç³–ï¼Œè®©å¤æ‚çš„å¼‚æ­¥ç¼–ç¨‹å˜å¾—æ›´ä¸ºç®€æ´å’Œå¼ºå¤§ã€‚&lt;/p&gt;
&lt;h2 id="executorservicesubmit--completablefuturerunasync"&gt;ExecutorService.submit &amp;amp; CompletableFuture.runAsync
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ &lt;code&gt;CompletableFuture.runAsync()&lt;/code&gt;å’Œ &lt;code&gt;ExecutorService.submit()&lt;/code&gt;çš„åŒºåˆ«ä¸è”ç³»ï¼Œèƒ½å¸®åŠ©ä½ åœ¨ä¸åŒåœºæ™¯ä¸‹åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œè®©ä½ å¿«é€ŸæŠŠæ¡å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ExecutorService.submit()&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;CompletableFuture.runAsync()&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒå®šä½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹æ± ç®¡ç†&lt;/strong&gt;ï¼Œæä¾›åŸºç¡€å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œèƒ½åŠ›&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡ç¼–æ’&lt;/strong&gt;ï¼Œæä¾›å¼ºå¤§çš„é“¾å¼è°ƒç”¨ã€ç»„åˆå’Œå›è°ƒæœºåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Future&amp;lt;?&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯æäº¤ &lt;code&gt;Runnable&lt;/code&gt;æˆ– &lt;code&gt;Callable&lt;/code&gt;ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;ä¸»è¦æäº¤ &lt;code&gt;Runnable&lt;/code&gt;ä»»åŠ¡ï¼ˆæ— è¿”å›å€¼ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»“æœè·å–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é˜»å¡å¼&lt;/strong&gt;ã€‚é€šè¿‡ &lt;code&gt;Future.get()&lt;/code&gt;è·å–ï¼Œä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;éé˜»å¡å›è°ƒ&lt;/strong&gt;ã€‚å¯é€šè¿‡ &lt;code&gt;thenRun()&lt;/code&gt;, &lt;code&gt;thenAccept()&lt;/code&gt;ç­‰å›è°ƒå¤„ç†ï¼Œä¹Ÿæ”¯æŒé˜»å¡å¼çš„ &lt;code&gt;join()&lt;/code&gt;æˆ– &lt;code&gt;get()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼±ã€‚éœ€è‡ªè¡Œç®¡ç†å¤šä¸ª &lt;code&gt;Future&lt;/code&gt;çš„ä¾èµ–å…³ç³»&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¼ºå¤§&lt;/strong&gt;ã€‚æä¾› &lt;code&gt;thenApply&lt;/code&gt;/&lt;code&gt;thenAccept&lt;/code&gt;/&lt;code&gt;thenRun&lt;/code&gt;, &lt;code&gt;thenCompose&lt;/code&gt;, &lt;code&gt;thenCombine&lt;/code&gt;, &lt;code&gt;allOf&lt;/code&gt;/&lt;code&gt;anyOf&lt;/code&gt;ç­‰æ–¹æ³•è¿›è¡Œçµæ´»ç»„åˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Future.get()&lt;/code&gt;ä¼šæŠ›å‡º &lt;code&gt;ExecutionException&lt;/code&gt;ï¼Œéœ€è‡ªè¡Œæ•è·å¤„ç†&lt;/td&gt;
&lt;td&gt;æä¾› &lt;code&gt;exceptionally&lt;/code&gt;, &lt;code&gt;handle&lt;/code&gt;, &lt;code&gt;whenComplete&lt;/code&gt;ç­‰æ–¹æ³•ï¼Œæ”¯æŒåœ¨å›è°ƒé“¾ä¸­ä¼˜é›…å¤„ç†å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤çº¿ç¨‹æ± &lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ˜¾å¼åˆ›å»ºï¼ˆå¦‚ &lt;code&gt;FixedThreadPool&lt;/code&gt;, &lt;code&gt;CachedThreadPool&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;è‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç†å¿µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´å…³æ³¨&lt;strong&gt;ä»»åŠ¡çš„æ‰§è¡Œå’Œçº¿ç¨‹èµ„æºçš„ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´å…³æ³¨&lt;strong&gt;ä»»åŠ¡å®Œæˆåçš„åç»­æ“ä½œã€ä»»åŠ¡ä¹‹é—´çš„ç»„åˆä¸ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å®ƒä»¬çš„è”ç³»"&gt;ğŸ”— å®ƒä»¬çš„è”ç³»
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å­˜åœ¨ä¸Šè¿°åŒºåˆ«ï¼Œä½†ä¸¤è€…éƒ½ç”¨äºå®ç°å¼‚æ­¥è®¡ç®—ï¼Œå¹¶ä¸”å¯ä»¥ååŒå·¥ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…±åŒç›®æ ‡&lt;/strong&gt;ï¼šéƒ½æ˜¯ç”¨æ¥&lt;strong&gt;å¼‚æ­¥æ‰§è¡Œä»»åŠ¡&lt;/strong&gt;ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½è¡”æ¥&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture.runAsync(Runnable runnable, Executor executor)&lt;/code&gt;æ–¹æ³•å¯ä»¥&lt;strong&gt;æ¥æ”¶ä¸€ä¸ª &lt;code&gt;ExecutorService&lt;/code&gt;ä½œä¸ºå‚æ•°&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;ExecutorService&lt;/code&gt;æ¥ç®¡ç†çº¿ç¨‹æ± èµ„æºï¼ŒåŒæ—¶äº«å— &lt;code&gt;CompletableFuture&lt;/code&gt;å¼ºå¤§çš„å¼‚æ­¥ç¼–æ’èƒ½åŠ›ã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„ç»„åˆæ–¹å¼ï¼Œå…¼é¡¾äº†çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-4"&gt;ğŸ¯ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;ExecutorService.submit()&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦&lt;strong&gt;ç²¾ç»†æ§åˆ¶çº¿ç¨‹æ± &lt;/strong&gt;ï¼ˆå¤§å°ã€ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ&lt;strong&gt;ç®€å•çš„ã€ç‹¬ç«‹çš„&lt;/strong&gt;å¼‚æ­¥ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦æäº¤&lt;strong&gt;æœ‰è¿”å›å€¼çš„ &lt;code&gt;Callable&lt;/code&gt;ä»»åŠ¡&lt;/strong&gt;ï¼ˆè™½ç„¶ &lt;code&gt;CompletableFuture.supplyAsync&lt;/code&gt;æ›´æ“…é•¿å¤„ç†å¸¦è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ç¼–æ’ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¡¹ç›®åŸºäºæ—§ç‰ˆ Javaï¼ˆ&amp;lt; 8ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;CompletableFuture.runAsync()&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ éœ€è¦&lt;strong&gt;æ„å»ºå¤æ‚çš„å¼‚æ­¥ä»»åŠ¡é“¾&lt;/strong&gt;ï¼Œä¸€ä¸ªä»»åŠ¡çš„å®Œæˆè§¦å‘ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦&lt;strong&gt;ç»„åˆå¤šä¸ªå¼‚æ­¥æ“ä½œ&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¸Œæœ›ä½¿ç”¨&lt;strong&gt;éé˜»å¡çš„å›è°ƒ&lt;/strong&gt;å¤„ç†ä»»åŠ¡ç»“æœï¼Œé¿å…çº¿ç¨‹ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;æƒ³è¦&lt;strong&gt;æ›´ä¼˜é›…ã€å‡½æ•°å¼çš„å¼‚å¸¸å¤„ç†&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Java 8+ï¼Œå¹¶ä¸”ä»£ç å¯è¯»æ€§å’Œç®€æ´æ€§æ˜¯é‡è¦è€ƒè™‘å› ç´ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•æ¥è¯´ï¼š&lt;/strong&gt; å¦‚æœä½ åªæ˜¯éœ€è¦ä¸€ä¸ªå·¥äººï¼ˆçº¿ç¨‹ï¼‰å»å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Œç”¨ &lt;code&gt;ExecutorService.submit&lt;/code&gt;ã€‚å¦‚æœä½ ä¸ä»…éœ€è¦å·¥äººå®Œæˆä»»åŠ¡ï¼Œè¿˜å¸Œæœ›ä»–å®Œæˆåèƒ½è‡ªåŠ¨é€šçŸ¥ä½ ã€ç»§ç»­åšå…¶ä»–æŒ‡å®šå·¥ä½œã€æˆ–è€…å’Œå…¶ä»–å·¥äººåä½œï¼Œç”¨ &lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;æˆ– &lt;code&gt;supplyAsync&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-3"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç®¡ç†&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;ExecutorService&lt;/code&gt;åï¼Œè®°å¾—åœ¨é€‚å½“æ—¶å€™è°ƒç”¨ &lt;code&gt;shutdown()&lt;/code&gt;æ¥å…³é—­çº¿ç¨‹æ± ï¼Œé¿å…èµ„æºæ³„æ¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡ä¸éé˜»å¡&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture&lt;/code&gt;çš„ &lt;code&gt;get()&lt;/code&gt;å’Œ &lt;code&gt;join()&lt;/code&gt;æ–¹æ³•ä¹Ÿæ˜¯é˜»å¡çš„ã€‚å……åˆ†å‘æŒ¥ &lt;code&gt;CompletableFuture&lt;/code&gt;ä¼˜åŠ¿çš„å…³é”®åœ¨äº&lt;strong&gt;ä½¿ç”¨å…¶å›è°ƒæ–¹æ³•&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;thenAccept&lt;/code&gt;ï¼‰è¿›è¡Œéé˜»å¡å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;Future.get()&lt;/code&gt;æ—¶è¦æ³¨æ„å¤„ç† &lt;code&gt;ExecutionException&lt;/code&gt;ï¼›ä½¿ç”¨ &lt;code&gt;CompletableFuture&lt;/code&gt;æ—¶ï¼Œå»ºè®®åœ¨é“¾ä¸­æ·»åŠ  &lt;code&gt;exceptionally&lt;/code&gt;æˆ– &lt;code&gt;handle&lt;/code&gt;ç­‰æ–¹æ³•ä»¥å¦¥å–„å¤„ç†å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ ¹æ®å…·ä½“åœºæ™¯åšå‡ºæœ€ä½³é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="completablefutureçš„-getå’Œ-join"&gt;CompletableFutureçš„ get()å’Œ join()
&lt;/h2&gt;&lt;p&gt;ã€‚äº†è§£ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„ &lt;code&gt;get()&lt;/code&gt;å’Œ &lt;code&gt;join()&lt;/code&gt;æ–¹æ³•çš„åŒºåˆ«ï¼Œå¯¹äºç¼–å†™æ­£ç¡®ã€é«˜æ•ˆçš„å¼‚æ­¥ä»£ç å¾ˆé‡è¦ã€‚å®ƒä»¬æ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;å’Œ&lt;strong&gt;å—æ£€å¼‚å¸¸&lt;/strong&gt;çš„è¦æ±‚ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;get()&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;join()&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŠ›å‡º &lt;strong&gt;&lt;code&gt;ExecutionException&lt;/code&gt;&lt;/strong&gt;ï¼ˆåŒ…è£…åŸå§‹å¼‚å¸¸ï¼‰å’Œ &lt;strong&gt;&lt;code&gt;InterruptedException&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŠ›å‡º &lt;strong&gt;&lt;code&gt;CompletionException&lt;/code&gt;&lt;/strong&gt;ï¼ˆåŒ…è£…åŸå§‹å¼‚å¸¸ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å—æ£€å¼‚å¸¸&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt;ã€‚å¿…é¡»æ˜¾å¼æ•è·æˆ–å£°æ˜æŠ›å‡º &lt;code&gt;InterruptedException&lt;/code&gt;, &lt;code&gt;ExecutionException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;ã€‚æŠ›å‡ºçš„æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ (&lt;code&gt;CompletionException&lt;/code&gt;)ï¼Œæ— éœ€å¼ºåˆ¶å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ”¯æŒ&lt;/strong&gt;ã€‚æä¾› &lt;code&gt;get(long timeout, TimeUnit unit)&lt;/code&gt;é‡è½½æ–¹æ³•&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸­æ–­å“åº”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt;ã€‚ç­‰å¾…è¿‡ç¨‹ä¸­çº¿ç¨‹è¢«ä¸­æ–­ä¼šæŠ›å‡º &lt;code&gt;InterruptedException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;ã€‚ä¸ç›´æ¥å“åº”ä¸­æ–­ï¼Œè€Œæ˜¯åŒ…è£…è¿› &lt;code&gt;CompletionException&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦&lt;strong&gt;ç²¾ç»†æ§åˆ¶å¼‚å¸¸&lt;/strong&gt;æˆ–&lt;strong&gt;è®¾ç½®è¶…æ—¶&lt;/strong&gt;çš„åœºæ™¯&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;ä¼˜å…ˆï¼Œå¸¸ç”¨äº &lt;code&gt;CompletableFuture&lt;/code&gt;&lt;strong&gt;é“¾å¼è°ƒç”¨&lt;/strong&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-ä¸»è¦åŒºåˆ«è¯´æ˜"&gt;ğŸ“Œ ä¸»è¦åŒºåˆ«è¯´æ˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†ä¸å—æ£€å¼‚å¸¸&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ä¼šæŠ›å‡ºå—æ£€å¼‚å¸¸ &lt;code&gt;ExecutionException&lt;/code&gt;ï¼ˆå½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ï¼‰å’Œ &lt;code&gt;InterruptedException&lt;/code&gt;ï¼ˆå½“çº¿ç¨‹åœ¨ç­‰å¾…ç»“æœæ—¶è¢«ä¸­æ–­æ—¶ï¼‰ã€‚ä½ å¿…é¡»ä½¿ç”¨ &lt;code&gt;try-catch&lt;/code&gt;åŒ…å›´æˆ–æ˜¯åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜æŠ›å‡ºè¿™äº›å¼‚å¸¸ï¼Œå¦åˆ™ä»£ç æ— æ³•ç¼–è¯‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;join()&lt;/code&gt;æ–¹æ³•åœ¨ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸æ—¶ä¼šæŠ›å‡ºéå—æ£€çš„ &lt;code&gt;CompletionException&lt;/code&gt;ã€‚è¿™æ„å‘³ç€ä½ &lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;åœ¨ä»£ç ä¸­å¼ºåˆ¶å¤„ç†å®ƒï¼Œä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥é€‰æ‹©æ•è·å®ƒä»¥è·å¾—æ›´å¥å£®çš„ç¨‹åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•æä¾›äº†ä¸€ä¸ªé‡è½½ç‰ˆæœ¬ &lt;code&gt;get(long timeout, TimeUnit unit)&lt;/code&gt;ï¼Œå…è®¸ä½ è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ— é™æœŸé˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;join()&lt;/code&gt;æ–¹æ³•&lt;strong&gt;æ²¡æœ‰&lt;/strong&gt;æä¾›è¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨å®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä»£ç ç¤ºä¾‹-1"&gt;ğŸ–¥ï¸ ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸¤è€…åœ¨å¼‚å¸¸å¤„ç†å’Œä»£ç ç¼–å†™ä¸Šçš„ä¸åŒï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
public class GetVsJoinExample {
public static void main(String[] args) {
// æ¨¡æ‹Ÿä¸€ä¸ªä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡
CompletableFuture&amp;lt;String&amp;gt; faultyFuture = CompletableFuture.supplyAsync(() -&amp;gt; {
throw new RuntimeException(&amp;#34;Something went wrong!&amp;#34;);
});
// ä½¿ç”¨ get() - å¿…é¡»å¤„ç†å—æ£€å¼‚å¸¸
try {
String resultGet = faultyFuture.get();
System.out.println(&amp;#34;Result with get: &amp;#34; + resultGet);
} catch (InterruptedException | ExecutionException e) {
// ExecutionException åŒ…è£¹äº†åŸå§‹çš„ RuntimeException
System.out.println(&amp;#34;Exception with get: &amp;#34; + e.getCause().getMessage());
}
// ä½¿ç”¨ join() - æ— éœ€å¤„ç†å—æ£€å¼‚å¸¸ï¼Œä½†ä¹Ÿå¯é€‰æ‹©æ•è·
try {
String resultJoin = faultyFuture.join();
System.out.println(&amp;#34;Result with join: &amp;#34; + resultJoin);
} catch (Exception e) { // é€šå¸¸æ•è·çš„æ˜¯ CompletionException
System.out.println(&amp;#34;Exception with join: &amp;#34; + e.getCause().getMessage());
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;è¾“å‡ºç±»ä¼¼ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Exception with get: Something went wrong!
Exception with join: Something went wrong!
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;join()&lt;/code&gt;çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ä¸€äº›ã€‚&lt;/p&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-5"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½•æ—¶ä½¿ç”¨ &lt;code&gt;get()&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å½“ä½ éœ€è¦ä¸ºè·å–ç»“æœ&lt;strong&gt;è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/strong&gt;ï¼Œé˜²æ­¢æ— é™æœŸç­‰å¾…æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ éœ€è¦&lt;strong&gt;ç²¾ç»†åœ°åŒºåˆ†å’Œå¤„ç†&lt;/strong&gt;ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼ˆå¦‚ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ &lt;code&gt;ExecutionException&lt;/code&gt;å’Œçº¿ç¨‹ä¸­æ–­å¼‚å¸¸ &lt;code&gt;InterruptedException&lt;/code&gt;ï¼‰æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½•æ—¶ä½¿ç”¨ &lt;code&gt;join()&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å½“ä½ è¿½æ±‚&lt;strong&gt;ä»£ç çš„ç®€æ´æ€§&lt;/strong&gt;ï¼Œä¸å¸Œæœ›ç¼–å†™å¤§é‡çš„ &lt;code&gt;try-catch&lt;/code&gt;å—æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ åœ¨ &lt;strong&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;é“¾å¼è°ƒç”¨&lt;/strong&gt;çš„æœ«ç«¯ï¼ˆä¾‹å¦‚ç»“åˆ &lt;code&gt;allOf&lt;/code&gt;åä½¿ç”¨ &lt;code&gt;join&lt;/code&gt;ï¼‰è·å–æœ€ç»ˆç»“æœæ—¶ï¼Œè¿™æ˜¯éå¸¸å¸¸è§çš„ç”¨æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-4"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡æ€§&lt;/strong&gt;ï¼šæ— è®ºæ˜¯ &lt;code&gt;get()&lt;/code&gt;è¿˜æ˜¯ &lt;code&gt;join()&lt;/code&gt;ï¼Œå®ƒä»¬éƒ½æ˜¯&lt;strong&gt;é˜»å¡&lt;/strong&gt;æ–¹æ³•ã€‚è°ƒç”¨å®ƒä»¬ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼ˆæˆ–è¶…æ—¶/ä¸­æ–­ï¼‰ã€‚è™½ç„¶ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„å¼ºå¤§åœ¨äºå…¶éé˜»å¡çš„å›è°ƒï¼ˆå¦‚ &lt;code&gt;thenApply&lt;/code&gt;, &lt;code&gt;thenAccept&lt;/code&gt;ï¼‰ï¼Œä½†æœ€ç»ˆè·å–ç»“æœå¾€å¾€ä»éœ€é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸æ¢æŸ¥&lt;/strong&gt;ï¼šæ— è®ºé€‰æ‹©å“ªä¸ªæ–¹æ³•ï¼Œå¦‚æœå¼‚æ­¥ä»»åŠ¡ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡ &lt;code&gt;Throwable.getCause()&lt;/code&gt;æ–¹æ³•æ¥è·å–æœ€åŸå§‹çš„å¼‚å¸¸ä¿¡æ¯ï¼Œè¿™å¯¹äºè°ƒè¯•è‡³å…³é‡è¦ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;CompletableFuture&lt;/code&gt;çš„è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id="supplyasync-å’Œ-runasync"&gt;supplyAsync å’Œ runAsync
&lt;/h2&gt;&lt;p&gt;äº†è§£ &lt;code&gt;supplyAsync&lt;/code&gt;å’Œ &lt;code&gt;runAsync&lt;/code&gt;çš„åŒºåˆ«å¯¹äºç¼–å†™æ­£ç¡®çš„å¼‚æ­¥ä»£ç å¾ˆé‡è¦ã€‚å®ƒä»¬æ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;æ˜¯å¦éœ€è¦è¿”å›ç»“æœ&lt;/strong&gt;ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;supplyAsync&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;runAsync&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›å€¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿”å› &lt;code&gt;CompletableFuture&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œæºå¸¦è®¡ç®—ç»“æœ&lt;/td&gt;
&lt;td&gt;è¿”å› &lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt;ï¼Œ&lt;strong&gt;æ— è®¡ç®—ç»“æœ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‚æ•°æ¥å£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¥å— &lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªç»“æœ&lt;/td&gt;
&lt;td&gt;æ¥å— &lt;code&gt;Runnable&lt;/code&gt;ï¼Œæ‰§è¡Œæ“ä½œï¼Œ&lt;strong&gt;æ— è¿”å›&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é»˜è®¤çº¿ç¨‹æ± &lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“æŸ¥è¯¢ã€è¿œç¨‹è°ƒç”¨ã€è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç­‰&lt;strong&gt;éœ€è¦ç»“æœ&lt;/strong&gt;çš„æ“ä½œ&lt;/td&gt;
&lt;td&gt;è®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ã€æ¸…ç†èµ„æºç­‰&lt;strong&gt;æ— éœ€ç»“æœ&lt;/strong&gt;çš„è¾…åŠ©æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è¯¦ç»†è¯´æ˜"&gt;ğŸ’¡ è¯¦ç»†è¯´æ˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿”å›å€¼ (Return Value)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;supplyAsync&lt;/code&gt;ç”¨äºæ‰§è¡Œ&lt;strong&gt;æœ‰è¿”å›å€¼&lt;/strong&gt;çš„å¼‚æ­¥ä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ª &lt;code&gt;CompletableFuture&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œæœªæ¥å¯ä»¥é€šè¿‡ &lt;code&gt;get()&lt;/code&gt;æˆ– &lt;code&gt;join()&lt;/code&gt;ç­‰æ–¹æ³•è·å–è®¡ç®—ç»“æœ &lt;code&gt;T&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;runAsync&lt;/code&gt;ç”¨äºæ‰§è¡Œ&lt;strong&gt;æ²¡æœ‰è¿”å›å€¼&lt;/strong&gt;çš„å¼‚æ­¥ä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ª &lt;code&gt;CompletableFuture&amp;lt;Void&amp;gt;&lt;/code&gt;ã€‚å®ƒåªè¡¨ç¤ºä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè€Œä¸å…³å¿ƒå…·ä½“ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•° (Parameter)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;supplyAsync&lt;/code&gt;æ¥æ”¶ä¸€ä¸ª &lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;å‡½æ•°å¼æ¥å£ï¼Œå…¶ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªç»“æœ &lt;code&gt;T&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;runAsync&lt;/code&gt;æ¥æ”¶ä¸€ä¸ª &lt;code&gt;Runnable&lt;/code&gt;å‡½æ•°å¼æ¥å£ï¼Œå…¶ &lt;code&gt;run()&lt;/code&gt;æ–¹æ³•æ‰§è¡Œæ“ä½œï¼Œä½†ä¸è¿”å›ä»»ä½•ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ±  (Thread Pool)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤è€…éƒ½æä¾›äº†é‡è½½æ–¹æ³•ï¼Œå…è®¸ä½ é€‰æ‹©ä½¿ç”¨é»˜è®¤çš„ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;æˆ–æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ &lt;code&gt;Executor&lt;/code&gt;ã€‚&lt;strong&gt;å¼ºçƒˆå»ºè®®&lt;/strong&gt;ä¸ºä¸åŒçš„ä¸šåŠ¡ç±»å‹ï¼ˆå¦‚IOå¯†é›†å‹ã€è®¡ç®—å¯†é›†å‹ï¼‰æŒ‡å®šä¸åŒçš„è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä»¥å®ç°èµ„æºéš”ç¦»å’Œé¿å…ç›¸äº’å½±å“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç† (Exception Handling)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;supplyAsync&lt;/code&gt;ï¼Œä»»åŠ¡ä¸­æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«æ•è·å¹¶åŒ…è£…åœ¨ &lt;code&gt;CompletableFuture&lt;/code&gt;ä¸­ï¼Œè°ƒç”¨ &lt;code&gt;get()&lt;/code&gt;æ—¶ä¼šæŠ›å‡º &lt;code&gt;ExecutionException&lt;/code&gt;ï¼Œä½ å¯ä»¥é€šè¿‡ &lt;code&gt;exceptionally&lt;/code&gt;ã€&lt;code&gt;handle&lt;/code&gt;æˆ– &lt;code&gt;whenComplete&lt;/code&gt;ç­‰æ–¹æ³•åœ¨é“¾ä¸­å¤„ç†è¿™äº›å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº &lt;code&gt;runAsync&lt;/code&gt;ï¼Œå¦‚æœä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ä¸”&lt;strong&gt;æ²¡æœ‰&lt;/strong&gt;ä½¿ç”¨ &lt;code&gt;whenComplete&lt;/code&gt;æˆ– &lt;code&gt;handle&lt;/code&gt;ç­‰æ–¹æ³•æ¥æ˜¾å¼å¤„ç†ï¼Œå¼‚å¸¸å¯èƒ½ä¼šè¢«â€œé™é»˜åå™¬â€ï¼Œè¿™ä¼šå¯¼è‡´è°ƒè¯•å›°éš¾ã€‚å› æ­¤ï¼ŒåŠ¡å¿…ä¸º &lt;code&gt;runAsync&lt;/code&gt;æ·»åŠ å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä»£ç ç¤ºä¾‹-2"&gt;ğŸ–¥ï¸ ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
public class SupplyAsyncVsRunAsync {
// æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„æœåŠ¡
static class MyService {
// ä¸€ä¸ªæœ‰è¿”å›å€¼çš„ä»»åŠ¡
String fetchData() {
try {
Thread.sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
} catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
return &amp;#34;Data from server&amp;#34;;
}
// ä¸€ä¸ªæ— è¿”å›å€¼çš„ä»»åŠ¡
void logEvent(String event) {
try {
Thread.sleep(500); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
} catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
System.out.println(&amp;#34;Event logged: &amp;#34; + event);
}
}
public static void main(String[] args) throws ExecutionException, InterruptedException {
MyService service = new MyService();
// ä½¿ç”¨ supplyAsync æ‰§è¡Œæœ‰è¿”å›å€¼çš„ä»»åŠ¡
CompletableFuture&amp;lt;String&amp;gt; dataFuture = CompletableFuture.supplyAsync(() -&amp;gt; service.fetchData());
String result = dataFuture.get(); // é˜»å¡ç­‰å¾…å¹¶è·å–ç»“æœ
System.out.println(&amp;#34;Result: &amp;#34; + result);
// ä½¿ç”¨ runAsync æ‰§è¡Œæ— è¿”å›å€¼çš„ä»»åŠ¡ï¼Œå¹¶æ·»åŠ å¼‚å¸¸å¤„ç†
CompletableFuture&amp;lt;Void&amp;gt; logFuture = CompletableFuture.runAsync(() -&amp;gt; service.logEvent(&amp;#34;User logged in&amp;#34;))
.whenComplete((v, ex) -&amp;gt; { // å¤„ç†å®Œæˆæˆ–å¼‚å¸¸
if (ex != null) {
System.err.println(&amp;#34;Logging failed: &amp;#34; + ex.getMessage());
} else {
System.out.println(&amp;#34;Logging completed successfully.&amp;#34;);
}
});
logFuture.join(); // ç­‰å¾…æ—¥å¿—ä»»åŠ¡å®Œæˆï¼ˆä½†ä¸å…³å¿ƒå…·ä½“ç»“æœï¼‰
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æ³¨æ„äº‹é¡¹-5"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± &lt;/strong&gt;ï¼šé»˜è®¤çš„ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;é€‚ç”¨äºè½»é‡è®¡ç®—ä»»åŠ¡ã€‚å¯¹äºIOå¯†é›†å‹æˆ–ä¸ç¡®å®šè¡Œä¸ºçš„ä»»åŠ¡ï¼Œæœ€å¥½&lt;strong&gt;åˆ›å»ºä¸“ç”¨çš„çº¿ç¨‹æ± &lt;/strong&gt;ï¼Œé¿å…èµ„æºç«äº‰å’Œä¸Šä¸‹æ–‡æ±¡æŸ“é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å… runAsync é™é»˜å¤±è´¥&lt;/strong&gt;ï¼šåŠ¡å¿…ä¸º &lt;code&gt;runAsync&lt;/code&gt;æ·»åŠ  &lt;code&gt;whenComplete&lt;/code&gt;ã€&lt;code&gt;handle&lt;/code&gt;æˆ– &lt;code&gt;exceptionally&lt;/code&gt;ç­‰å¼‚å¸¸å¤„ç†å›è°ƒï¼Œé˜²æ­¢å¼‚å¸¸è¢«åå™¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt;ï¼šå¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œ&lt;code&gt;ThreadLocal&lt;/code&gt;ä¸Šä¸‹æ–‡ï¼ˆå¦‚MDCä¸­çš„traceIdï¼‰ä¼šä¸¢å¤±ã€‚éœ€è¦è€ƒè™‘ä½¿ç”¨è£…é¥°å™¨æˆ–TransmittableThreadLocalç­‰æ–¹æ¡ˆè§£å†³ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é€‰æ‹© &lt;code&gt;supplyAsync&lt;/code&gt;è¿˜æ˜¯ &lt;code&gt;runAsync&lt;/code&gt;ï¼Œä¸»è¦å–å†³äºä½ çš„ä»»åŠ¡æ˜¯å¦éœ€è¦è¿”å›ä¸€ä¸ªç»“æœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ç»“æœï¼Œç”¨ &lt;code&gt;supplyAsync(Supplier&amp;lt;T&amp;gt;)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦ç»“æœï¼Œç”¨ &lt;code&gt;runAsync(Runnable)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ— è®ºé€‰æ‹©å“ªä¸ªï¼Œéƒ½å»ºè®®&lt;strong&gt;æŒ‡å®šåˆé€‚çš„è‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/strong&gt;å¹¶&lt;strong&gt;åšå¥½å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼Œè¿™æ ·æ‰èƒ½æ„å»ºå‡ºå¥å£®çš„å¼‚æ­¥åº”ç”¨ã€‚&lt;/p&gt;
&lt;h2 id="å¼±å¼•ç”¨"&gt;å¼±å¼•ç”¨
&lt;/h2&gt;&lt;p&gt;å¦‚æœä½ å¯¹ &lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;è¿”å›çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡å»ºç«‹äº†å¼±å¼•ç”¨ï¼ˆ&lt;code&gt;WeakReference&lt;/code&gt;ï¼‰å¹¶åŠ å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œ&lt;strong&gt;è¿™ä¸ª &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡æœ¬èº«ä¸ä¼šå› ä¸ºä»»åŠ¡çš„å®Œæˆè€Œè‡ªåŠ¨ä»åˆ—è¡¨ä¸­æ¶ˆå¤±&lt;/strong&gt;ã€‚å®ƒæ˜¯å¦ä¼šä»åˆ—è¡¨ä¸­è¢«ç§»é™¤ï¼Œå–å†³äºä½ æ˜¯å¦ä¸»åŠ¨æ¸…ç†åˆ—è¡¨ä¸­çš„æ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ€»ç»“ä¸åŒæƒ…å†µä¸‹çš„è¡Œä¸ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;&lt;code&gt;WeakReference.get()&lt;/code&gt;è¿”å›å€¼&lt;/th&gt;
&lt;th&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡çŠ¶æ€&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€ä»åˆ—è¡¨ä¸­æ‰‹åŠ¨ç§»é™¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡å®Œæˆï¼Œä½†å­˜åœ¨å…¶ä»–å¼ºå¼•ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸ä¸º &lt;code&gt;null&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¯è¾¾ï¼Œæœªè¢« GC å›æ”¶&lt;/td&gt;
&lt;td&gt;æ˜¯ï¼ˆè‹¥éœ€ç®¡ç†åˆ—è¡¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡å®Œæˆï¼Œä¸”æ— å…¶ä»–å¼ºå¼•ç”¨&lt;/strong&gt;ï¼ˆä»…è¢« &lt;code&gt;WeakReference&lt;/code&gt;å¼•ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å˜ä¸º &lt;code&gt;null&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å·²è¢« GC å›æ”¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ï¼ˆåº”æ¸…ç†&lt;code&gt;get()&lt;/code&gt;è¿”å›&lt;code&gt;null&lt;/code&gt;çš„ &lt;code&gt;WeakReference&lt;/code&gt;æ¡ç›®ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡æœªå®Œæˆï¼Œä¸”æ— å…¶ä»–å¼ºå¼•ç”¨&lt;/strong&gt;ï¼ˆä»…è¢« &lt;code&gt;WeakReference&lt;/code&gt;å¼•ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;å¯èƒ½å˜ä¸º &lt;code&gt;null&lt;/code&gt;(éšæ—¶è¢«GC)&lt;/td&gt;
&lt;td&gt;å·²è¢« GC å›æ”¶ï¼Œä½†ä»»åŠ¡å¯èƒ½ä»åœ¨è¿è¡Œ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ï¼ˆåº”æ¸…ç†&lt;code&gt;get()&lt;/code&gt;è¿”å›&lt;code&gt;null&lt;/code&gt;çš„ &lt;code&gt;WeakReference&lt;/code&gt;æ¡ç›®ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ’¡ æ ¸å¿ƒåŸç†ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼±å¼•ç”¨çš„ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;code&gt;WeakReference&lt;/code&gt;ä¸ä¼šé˜»æ­¢å…¶æŒ‡å‘çš„å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ &lt;code&gt;CompletableFuture&lt;/code&gt;å®ä¾‹ï¼‰è¢«åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ã€‚å½“è¿™ä¸ª &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡&lt;strong&gt;æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æŒ‡å‘å®ƒ&lt;/strong&gt;æ—¶ï¼ŒGC å‘ç”Ÿæ—¶å®ƒå°±ä¼šè¢«å›æ”¶ ã€‚ä¹‹åï¼Œä½ çš„ &lt;code&gt;WeakReference.get()&lt;/code&gt;æ–¹æ³•å°†è¿”å› &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ—è¡¨çš„è¡Œä¸º&lt;/strong&gt;ï¼šä½ åˆ›å»ºçš„ &lt;code&gt;List&lt;/code&gt;ä¿å­˜çš„æ˜¯ &lt;code&gt;WeakReference&lt;/code&gt;å¯¹è±¡æœ¬èº«ï¼ˆè¿™äº›æ˜¯å¼ºå¼•ç”¨ï¼‰ã€‚&lt;code&gt;WeakReference&lt;/code&gt;å¯¹è±¡æœ¬èº«ä¸ä¼šè‡ªåŠ¨ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚å³ä½¿å®ƒæŒ‡å‘çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;è¢«å›æ”¶å¯¼è‡´ &lt;code&gt;get()&lt;/code&gt;è¿”å› &lt;code&gt;null&lt;/code&gt;ï¼Œè¿™ä¸ªâ€œç©ºå£³â€ &lt;code&gt;WeakReference&lt;/code&gt;å¯¹è±¡ä¾ç„¶ä¼šç•™åœ¨åˆ—è¡¨ä¸­ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡æ‰§è¡Œä¸GCå…³ç³»&lt;/strong&gt;ï¼šé‡è¦çš„æ˜¯ï¼Œ&lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡ä»£è¡¨çš„&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆ&lt;/strong&gt;ï¼Œä¸å…¶&lt;strong&gt;å¯¹è±¡æœ¬èº«æ˜¯å¦è¢«GCå›æ”¶æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µ&lt;/strong&gt; ã€‚ä»»åŠ¡ç”±çº¿ç¨‹æ± è°ƒåº¦æ‰§è¡Œï¼Œå³ä½¿ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡è¢«å›æ”¶ï¼Œå·²æäº¤çš„ä»»åŠ¡ä¸€èˆ¬ä»ä¼šç»§ç»­æ‰§è¡Œç›´è‡³å®Œæˆ ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•æ­£ç¡®ç®¡ç†åˆ—è¡¨"&gt;ğŸ› ï¸ å¦‚ä½•æ­£ç¡®ç®¡ç†åˆ—è¡¨
&lt;/h3&gt;&lt;p&gt;æ—¢ç„¶å¼±å¼•ç”¨æ¡ç›®ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä½ éœ€è¦æ‰‹åŠ¨ç®¡ç†è¿™ä¸ªåˆ—è¡¨ï¼Œé¿å…å®ƒæ— é™è†¨èƒ€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šæœŸæ¸…ç†&lt;/strong&gt;ï¼šå®šæœŸéå†è¿™ä¸ª &lt;code&gt;List&amp;lt;WeakReference&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&lt;/code&gt;ï¼Œè°ƒç”¨æ¯ä¸ª &lt;code&gt;WeakReference&lt;/code&gt;çš„ &lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ï¼Œå¦‚æœè¿”å› &lt;code&gt;null&lt;/code&gt;ï¼Œå°±å°†è¿™ä¸ª &lt;code&gt;WeakReference&lt;/code&gt;ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚è¿™å¯ä»¥é˜²æ­¢åˆ—è¡¨ç§¯ç´¯å¤§é‡æ— ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;ReferenceQueue&lt;/code&gt;ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šè¿™æ˜¯æ›´é«˜æ•ˆå’Œè‡ªåŠ¨åŒ–çš„æ–¹å¼ã€‚ä½ å¯ä»¥åœ¨åˆ›å»º &lt;code&gt;WeakReference&lt;/code&gt;æ—¶å…³è”ä¸€ä¸ª &lt;code&gt;ReferenceQueue&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ReferenceQueue&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; queue = new ReferenceQueue&amp;lt;&amp;gt;();
WeakReference&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; weakRef = new WeakReference&amp;lt;&amp;gt;(completableFuture, queue);
list.add(weakRef);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å½“ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡è¢« GC å›æ”¶åï¼Œå¯¹åº”çš„ &lt;code&gt;WeakReference&lt;/code&gt;ä¼šè¢«è‡ªåŠ¨åŠ å…¥åˆ°è¿™ä¸ª &lt;code&gt;queue&lt;/code&gt;ä¸­ã€‚ä½ å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è½®è¯¢æˆ–é˜»å¡è·å–è¿™ä¸ªé˜Ÿåˆ—ä¸­çš„å¼•ç”¨ï¼Œç„¶åä»ä½ çš„åˆ—è¡¨ä¸­ç§»é™¤å®ƒä»¬ï¼Œå®ç°è‡ªåŠ¨æ¸…ç† ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-6"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡å¯èƒ½è¢«æå‰å›æ”¶&lt;/strong&gt;ï¼šå³ä½¿å¼‚æ­¥ä»»åŠ¡è¿˜åœ¨è¿è¡Œï¼Œå¦‚æœä½ çš„ä»£ç å…¶ä»–åœ°æ–¹æ²¡æœ‰ä¿æŒå¯¹ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œå®ƒä¹Ÿå¯èƒ½åœ¨ä»»ä½•æ—¶å€™è¢« GC å›æ”¶ã€‚è¿™ä¸ä¼šå½±å“ä»»åŠ¡çš„æ‰§è¡Œ ï¼Œä½†æ„å‘³ç€ä½ æ— æ³•å†é€šè¿‡è¿™ä¸ª &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡ï¼ˆä¾‹å¦‚è°ƒç”¨ &lt;code&gt;get()&lt;/code&gt;æˆ– &lt;code&gt;join()&lt;/code&gt;ï¼‰æ¥è·å–ä»»åŠ¡çš„ç»“æœæˆ–çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨å¼±å¼•ç”¨&lt;/strong&gt;ï¼šåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½¿ç”¨å¼±å¼•ç”¨ç®¡ç† &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡æœ‰æ—¶å¯èƒ½å¢åŠ å¤æ‚æ€§ã€‚ä½ éœ€è¦ä»”ç»†è¯„ä¼°æ˜¯å¦çœŸçš„éœ€è¦è¿™æ ·åšã€‚é€šå¸¸ï¼Œæ›´ç®€å•çš„åšæ³•æ˜¯ä¸»åŠ¨ç®¡ç†ä¸€ä¸ªæ™®é€šçš„ &lt;code&gt;List&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt;&lt;/code&gt;ï¼Œå¹¶åœ¨ä»»åŠ¡å®Œæˆåï¼ˆä¾‹å¦‚ä½¿ç”¨ &lt;code&gt;thenRun&lt;/code&gt;å›è°ƒï¼‰ä¸»åŠ¨å°†å…¶ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¯¹ &lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;è¿”å›çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;å»ºç«‹å¼±å¼•ç”¨å¹¶åŠ å…¥åˆ—è¡¨åï¼Œ&lt;strong&gt;ä»»åŠ¡å®Œæˆæ—¶ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡æœ¬èº«ä¸ä¼šè‡ªåŠ¨ä»åˆ—è¡¨ä¸­æ¶ˆå¤±&lt;/strong&gt;ã€‚åˆ—è¡¨ä¸­çš„ &lt;code&gt;WeakReference&lt;/code&gt;æ¡ç›®éœ€è¦ä½ &lt;strong&gt;æ‰‹åŠ¨ç®¡ç†&lt;/strong&gt;ï¼ˆå®šæœŸæ¸…ç†æˆ–ä½¿ç”¨ &lt;code&gt;ReferenceQueue&lt;/code&gt;ï¼‰æ¥ç§»é™¤é‚£äº›å…¶å¼•ç”¨çš„ &lt;code&gt;CompletableFuture&lt;/code&gt;å¯¹è±¡å·²è¢« GC å›æ”¶çš„â€œç©ºå£³â€å¼±å¼•ç”¨ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼&lt;/p&gt;
&lt;h2 id="readwritelock"&gt;readWriteLock
&lt;/h2&gt;&lt;p&gt;ç†è§£ JUC ä¸­ &lt;code&gt;ReadWriteLock&lt;/code&gt;ï¼ˆä¸»è¦ä»¥ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;ä¸ºä¾‹ï¼‰çš„è¡Œä¸ºé€»è¾‘å¯¹äºç¼–å†™é«˜æ•ˆã€çº¿ç¨‹å®‰å…¨çš„å¹¶å‘ç¨‹åºå¾ˆé‡è¦ã€‚å®ƒé€šè¿‡åˆ†ç¦»è¯»é”å’Œå†™é”ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹æä¾›äº†æ¯”ç‹¬å é”æ›´å¥½çš„å¹¶å‘æ€§èƒ½ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ€»ç»“å…¶æ ¸å¿ƒè¡Œä¸ºè§„åˆ™ï¼Œç„¶åè¯¦ç»†è§£é‡Šã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é”æ¨¡å¼&lt;/th&gt;
&lt;th&gt;è¯»é”&lt;/th&gt;
&lt;th&gt;å†™é”&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;strong&gt;å…±äº«&lt;/strong&gt;ã€‚å¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è·å–è¯»é”&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚æœ‰è¯»é”æ—¶ï¼Œæ— æ³•è·å–å†™é”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚æœ‰å†™é”æ—¶ï¼Œæ— æ³•è·å–è¯»é”&lt;/td&gt;
&lt;td&gt;âŒ &lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚æœ‰å†™é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–å†™é”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-è¯¦ç»†è¡Œä¸ºé€»è¾‘"&gt;ğŸ“– è¯¦ç»†è¡Œä¸ºé€»è¾‘
&lt;/h3&gt;&lt;h4 id="1-è¯»è¯»å…±äº«-read-read-sharing"&gt;1. è¯»è¯»å…±äº« (Read-Read Sharing)
&lt;/h4&gt;&lt;p&gt;å½“æ²¡æœ‰çº¿ç¨‹æŒæœ‰&lt;strong&gt;å†™é”&lt;/strong&gt;æ—¶ï¼Œ&lt;strong&gt;å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–è¯»é”&lt;/strong&gt;å¹¶æ‰§è¡Œè¯»æ“ä½œã€‚è¿™æå¤§åœ°æé«˜äº†åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹çš„ååé‡ã€‚&lt;/p&gt;
&lt;h4 id="2-è¯»å†™äº’æ–¥-read-write-mutual-exclusion"&gt;2. è¯»å†™äº’æ–¥ (Read-Write Mutual Exclusion)
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ‰è¯»æ— å†™&lt;/strong&gt;ï¼šåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯»é”ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹&lt;strong&gt;éƒ½æ— æ³•è·å–å†™é”&lt;/strong&gt;ã€‚å†™çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰è¯»é”é‡Šæ”¾ã€‚è¿™ä¿è¯äº†è¯»æ“ä½œä¸ä¼šè¯»åˆ°å†™æ“ä½œè¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰å†™æ— è¯»&lt;/strong&gt;ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”æ—¶ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹&lt;strong&gt;éƒ½æ— æ³•è·å–è¯»é”&lt;/strong&gt;ï¼ˆæˆ–å…¶ä»–å†™é”ï¼‰ã€‚è¯»çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å†™é”é‡Šæ”¾ã€‚è¿™ä¿è¯äº†å†™æ“ä½œçš„ç‹¬å æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å†™å†™äº’æ–¥-write-write-mutual-exclusion"&gt;3. å†™å†™äº’æ–¥ (Write-Write Mutual Exclusion)
&lt;/h4&gt;&lt;p&gt;å†™é”æ˜¯&lt;strong&gt;ç‹¬å é”&lt;/strong&gt;ã€‚åŒä¸€æ—¶åˆ»&lt;strong&gt;åªå…è®¸ä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;æŒæœ‰å†™é”ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹å°è¯•è·å–å†™é”ï¼Œå®ƒä»¬å¿…é¡»ä¸²è¡Œæ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3 id="-é‡è¦ç‰¹æ€§"&gt;ğŸ”§ é‡è¦ç‰¹æ€§
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;é™¤äº†éµå®ˆä»¥ä¸ŠåŸºæœ¬è§„åˆ™ï¼Œè¿˜æä¾›äº†ä¸€äº›é‡è¦ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯é‡å…¥æ€§ (Reentrancy)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸&lt;strong&gt;åŒä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;å¤šæ¬¡è·å–åŒä¸€æŠŠè¯»é”æˆ–å†™é”ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰è¯»é”åï¼Œå…¶åŒæ­¥æ–¹æ³•å†…éƒ¨å¯ä»¥å†æ¬¡è·å–è¯»é”è€Œä¸ä¼šé˜»å¡è‡ªèº«ã€‚è¿™å¯¹äºé€’å½’æ“ä½œæˆ–å›è°ƒéå¸¸æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”é™çº§ (Lock Downgrading)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ï¼Œå…è®¸çº¿ç¨‹åœ¨&lt;strong&gt;æŒæœ‰å†™é”&lt;/strong&gt;çš„æƒ…å†µä¸‹ï¼Œè·å–&lt;strong&gt;è¯»é”&lt;/strong&gt;ï¼Œç„¶å&lt;strong&gt;é‡Šæ”¾å†™é”&lt;/strong&gt;çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;writeLock.lock(); // è·å–å†™é”
try {
// ... ä¿®æ”¹æ•°æ® ...
readLock.lock(); // è·å–è¯»é”ï¼ˆé”é™çº§å¼€å§‹ï¼‰
} finally {
writeLock.unlock(); // é‡Šæ”¾å†™é”ï¼ˆé”é™çº§å®Œæˆï¼Œç°åœ¨åªæŒæœ‰è¯»é”ï¼‰
}
try {
// ... è¯»å–æ•°æ® ...ï¼ˆæ­¤æ—¶å…¶ä»–è¯»çº¿ç¨‹ä¹Ÿå¯ä»¥å¹¶å‘è¯»å–äº†ï¼‰
} finally {
readLock.unlock();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é”é™çº§çš„ä»·å€¼&lt;/strong&gt;ï¼šå®ƒä¿è¯äº†ä»â€œå†™â€åˆ°â€œåç»­è¯»â€çš„è¿ç»­æ€§ã€‚åœ¨é‡Šæ”¾å†™é”åã€è·å–è¯»é”å‰ï¼Œå¯èƒ½æœ‰å…¶ä»–å†™çº¿ç¨‹æ’å…¥ä¿®æ”¹æ•°æ®ï¼Œå¯¼è‡´å½“å‰çº¿ç¨‹è¯»å–çš„æ•°æ®ä¸å…¶åˆšæ‰å†™å…¥çš„ä¸ä¸€è‡´ã€‚é”é™çº§é¿å…äº†è¿™ç§ä¸ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¬å¹³æ€§é€‰æ‹© (Fairness)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éå…¬å¹³æ¨¡å¼ (é»˜è®¤)&lt;/strong&gt;ï¼šååé‡æ›´é«˜ï¼Œä½†å¯èƒ½é€ æˆçº¿ç¨‹&lt;strong&gt;é¥¥é¥¿&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œæºæºä¸æ–­çš„è¯»çº¿ç¨‹å¯èƒ½è®©å†™çº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å¹³æ¨¡å¼&lt;/strong&gt;ï¼šä¸¥æ ¼æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºï¼ˆè¿‘ä¼¼FIFOï¼‰åˆ†é…é”ï¼Œå‡å°‘äº†é¥¥é¥¿çš„å¯èƒ½æ€§ï¼Œä½†å¯èƒ½é™ä½æ•´ä½“ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸ä½¿ç”¨åœºæ™¯"&gt;âš ï¸ æ³¨æ„äº‹é¡¹ä¸ä½¿ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReadWriteLock&lt;/code&gt;éå¸¸é€‚ç”¨äº &lt;strong&gt;â€œè¯»å¤šå†™å°‘â€&lt;/strong&gt; çš„åœºæ™¯ï¼Œä¾‹å¦‚ç¼“å­˜ã€é…ç½®ä¿¡æ¯å­˜å‚¨ç­‰ï¼Œå…¶ä¸­è¯»å–æ“ä½œè¿œè¿œå¤šäºå†™å…¥æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™çº¿ç¨‹é¥¥é¥¿ (Starvation)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨éå…¬å¹³æ¨¡å¼ä¸‹ï¼Œå¦‚æœè¯»æ“ä½œéå¸¸é¢‘ç¹ä¸”æŒä¹…ï¼Œ&lt;strong&gt;å†™çº¿ç¨‹å¯èƒ½ä¼šå› ä¸ºä¸€ç›´æ— æ³•è·å–å†™é”è€Œé¥¥é¥¿&lt;/strong&gt;ã€‚å…¬å¹³æ¨¡å¼å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£æ­¤é—®é¢˜ï¼Œä½†éœ€æƒè¡¡ååé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”å‡çº§ (Lock Upgrading)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯»é”ä¸èƒ½ç›´æ¥å‡çº§ä¸ºå†™é”&lt;/strong&gt;ã€‚å¦‚æœå°è¯•åœ¨æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹è·å–å†™é”ï¼Œä¼šå¯¼è‡´&lt;strong&gt;æ­»é”&lt;/strong&gt;ï¼ˆå› ä¸ºå†™é”éœ€è¦ç­‰å¾…è‡ªå·±é‡Šæ”¾è¯»é”ï¼‰ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å…ˆé‡Šæ”¾æ‰€æœ‰è¯»é”ï¼Œç„¶åå†å°è¯•è·å–å†™é”ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯åŸå­çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;ReadWriteLock&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="æ— é”è¯»"&gt;æ— é”è¯»
&lt;/h2&gt;&lt;p&gt;ã€‚ä½¿ç”¨è¯»å†™é”ï¼ˆå¦‚ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;ï¼‰å’Œä»…ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;æ¥é”å†™æ“ä½œï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;å¯¹è¯»æ“ä½œçš„å¤„ç†æ–¹å¼&lt;/strong&gt;ï¼Œè¿™ç›´æ¥å½±å“äº†ç¨‹åºçš„å¹¶å‘æ€§èƒ½å’Œè®¾è®¡æ€è·¯ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†æ ¸å¿ƒåŒºåˆ«ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨è¯»å†™é” (ReentrantReadWriteLock)&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ ReentrantLock (ä»…é”å†™æ“ä½œ)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç†å¿µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;ã€‚è¯»é”å…±äº«ï¼Œå†™é”ç‹¬å &lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å†™æ“ä½œäº’æ–¥&lt;/strong&gt;ã€‚ä¸æ§åˆ¶è¯»æ“ä½œï¼Œéœ€å¦è¾Ÿçº¿ç¨‹å®‰å…¨é€”å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»å¹¶å‘æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt;ã€‚å¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è·å–è¯»é”ï¼Œ&lt;strong&gt;å¹¶è¡Œè¯»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–å®ç°&lt;/strong&gt;ã€‚è‹¥è¯»æ“ä½œæ— é”ä¸”æ•°æ®ç»“æ„éçº¿ç¨‹å®‰å…¨ï¼Œåˆ™å¹¶å‘è¯»ä¸å®‰å…¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™å¹¶å‘æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ã€‚å†™é”ç‹¬å ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt;ã€‚å†™é”ç‹¬å ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;åœºæ™¯ä¸‹æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾&lt;/td&gt;
&lt;td&gt;æ€§èƒ½å–å†³äº&lt;strong&gt;è¯»æ“ä½œçš„å®ç°æ–¹å¼&lt;/strong&gt;å’Œ&lt;strong&gt;æ•°æ®ç«äº‰ç¨‹åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›è¯»é”ã€å†™é”ä¸¤å¥—API&lt;/td&gt;
&lt;td&gt;ä»…æä¾›ä¸€å¥—é”APIï¼Œä½†åŠŸèƒ½ä¸°å¯Œï¼ˆå¯å…¬å¹³ã€å¯ä¸­æ–­ã€å¯è¶…æ—¶ã€æ”¯æŒæ¡ä»¶å˜é‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ½œåœ¨é—®é¢˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°ç›¸å¯¹å¤æ‚ï¼Œå¯èƒ½å­˜åœ¨&lt;strong&gt;å†™çº¿ç¨‹é¥¥é¥¿&lt;/strong&gt;ï¼ˆéå…¬å¹³é”ä¸‹ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€è‡ªè¡Œç¡®ä¿è¯»æ“ä½œçš„çº¿ç¨‹å®‰å…¨ï¼Œå¯èƒ½éœ€é…åˆ&lt;strong&gt;volatile&lt;/strong&gt;æˆ–&lt;strong&gt;åŸå­å˜é‡&lt;/strong&gt;ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é”ç®¡ç†æ›´å¤æ‚ï¼Œéœ€æ­£ç¡®ä½¿ç”¨ä¸¤æŠŠé”&lt;/td&gt;
&lt;td&gt;é”ç®¡ç†ç®€å•ï¼Œä½†&lt;strong&gt;çº¿ç¨‹å®‰å…¨çš„è®¾è®¡è´£ä»»è½¬ç§»åˆ°äº†è¯»æ“ä½œå’Œæ•°æ®ç»“æ„çš„å®ç°ä¸Š&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ æ›´ç›´è§‚åœ°ç†è§£ä¸¤ç§æ–¹å¼åœ¨â€œè¯»å¤šå†™å°‘â€åœºæ™¯ä¸‹çš„æ€§èƒ½å·®å¼‚ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹åŸºäºå…¸å‹æµ‹è¯•çš„æ€§èƒ½å¯¹æ¯”ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;xychart-beta
title &amp;#34;è¯»å¤šå†™å°‘åœºæ™¯ä¸‹é”æ€§èƒ½å¯¹æ¯”ï¼ˆè€—æ—¶è¶Šå°‘è¶Šå¥½ï¼‰&amp;#34;
x-axis [&amp;#34;å†™é”ï¼ˆReentrantLockï¼‰&amp;#34;, &amp;#34;è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰&amp;#34;]
y-axis &amp;#34;è€—æ—¶ï¼ˆmsï¼‰&amp;#34; 0 --&amp;gt; 3500
bar [3124, 1345]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹çœ‹è¿™ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç å’Œè®¾è®¡è€ƒé‡ã€‚&lt;/p&gt;
&lt;h3 id="-ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç "&gt;ğŸ› ï¸ ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç 
&lt;/h3&gt;&lt;h4 id="1-ä½¿ç”¨è¯»å†™é”-reentrantreadwritelock"&gt;1. ä½¿ç”¨è¯»å†™é” (&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;)
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.locks.ReentrantReadWriteLock;
public class ReadWriteLockDemo {
private final ReentrantReadWriteLock rwLock = new ReentrantReadWriteLock();
private Object sharedData;
// è¯»æ“ä½œï¼šè·å–è¯»é”
public Object read() {
rwLock.readLock().lock();
try {
return sharedData;
} finally {
rwLock.readLock().unlock();
}
}
// å†™æ“ä½œï¼šè·å–å†™é”
public void write(Object newData) {
rwLock.writeLock().lock();
try {
sharedData = newData;
} finally {
rwLock.writeLock().unlock();
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»æ“ä½œä½¿ç”¨ &lt;code&gt;readLock()&lt;/code&gt;ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ &lt;code&gt;read()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;å†™æ“ä½œä½¿ç”¨ &lt;code&gt;writeLock()&lt;/code&gt;ï¼Œä¸å…¶ä»–å†™é”å’Œè¯»é”éƒ½äº’æ–¥ï¼Œä¿è¯ç‹¬å ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ä½¿ç”¨-reentrantlockä»…é”å†™æ“ä½œ"&gt;2. ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;(ä»…é”å†™æ“ä½œ)
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.locks.ReentrantLock;
import java.util.concurrent.atomic.AtomicReference; // æˆ–ä½¿ç”¨ volatile é…åˆå…¶ä»–æœºåˆ¶
public class ReentrantLockWriteOnlyDemo {
private final ReentrantLock writeLock = new ReentrantLock();
// ä½¿ç”¨ AtomicReference æˆ– volatile æ¥ä¿è¯å…±äº«æ•°æ®çš„å¯è§æ€§
private AtomicReference&amp;lt;Object&amp;gt; sharedData = new AtomicReference&amp;lt;&amp;gt;();
// è¯»æ“ä½œï¼šæ— é”ï¼Œç›´æ¥è¯»ã€‚ä½†éœ€ä¿è¯sharedDataçš„çº¿ç¨‹å®‰å…¨å‘å¸ƒã€‚
public Object read() {
return sharedData.get();
}
// å†™æ“ä½œï¼šè·å–é”
public void write(Object newData) {
writeLock.lock();
try {
sharedData.set(newData);
} finally {
writeLock.unlock();
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;ä¿è¯äº’æ–¥ã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œ&lt;strong&gt;ä¸åŠ é”&lt;/strong&gt;ï¼Œç›´æ¥è¯»å–ã€‚è¿™æ„å‘³ç€ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€è¦é€‰æ‹©&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;çš„æ–¹å¼æš´éœ²æ•°æ®ï¼ˆå¦‚ &lt;code&gt;AtomicReference&lt;/code&gt;, &lt;code&gt;volatile&lt;/code&gt;å˜é‡ï¼Œæˆ–ä¸å¯å˜å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒ&lt;strong&gt;ä¸èƒ½é˜²æ­¢&lt;/strong&gt;åœ¨è¯»å–è¿‡ç¨‹ä¸­æ•°æ®è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œå¯èƒ½è¯»åˆ°ä¸­é—´çŠ¶æ€æˆ–æ—§å€¼ï¼ˆå–å†³äºå†…å­˜è¯­ä¹‰çš„å®ç°ï¼Œå¦‚ &lt;code&gt;volatile&lt;/code&gt;èƒ½ä¿è¯å¯è§æ€§ä½†éåŸå­æ€§ï¼‰ã€‚è¿™ç§æ¨¡å¼é€šå¸¸é€‚ç”¨äº&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;æˆ–è¯»æ“ä½œéå¸¸å¿«ã€ç®€å•çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-6"&gt;ğŸ’¡ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œåº”ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ çš„åº”ç”¨æ˜¯å…¸å‹çš„ &lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt; ï¼ˆä¾‹å¦‚ 95% è¯»ï¼Œ5% å†™ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œæœ¬èº«&lt;strong&gt;æ¯”è¾ƒè€—æ—¶&lt;/strong&gt;ï¼ˆå¦‚è¯»å–å¤§å¯¹è±¡ã€ç®€å•è®¡ç®—ï¼‰ï¼Œä½ å¸Œæœ›æœ€å¤§åŒ–è¯»çš„å¹¶å‘ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;ä½ æ„¿æ„æ¥å—æ¯” &lt;code&gt;ReentrantLock&lt;/code&gt;ç¨å¤æ‚ä¸€äº›çš„é”ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;(ä»…é”å†™) + æ— é”è¯» å½“&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œé¢‘ç‡è¾ƒé«˜ï¼Œè¯»å†™æ“ä½œç«äº‰æ¿€çƒˆï¼Œæ­¤æ—¶ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;çš„å¤æ‚å¼€é”€å¯èƒ½å¸¦æ¥åæ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œ&lt;strong&gt;éå¸¸å¿«é€Ÿ&lt;/strong&gt;ï¼Œæˆ–è€…æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚å…è®¸è¯»åˆ°æœ€æ–°æ›´æ–°å‰çš„å€¼ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ å¸Œæœ›ä½¿ç”¨ &lt;code&gt;ReentrantLock&lt;/code&gt;æä¾›çš„&lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼Œå¦‚å°è¯•é”ã€å¯ä¸­æ–­é”ã€å…¬å¹³é”æˆ–æ¡ä»¶å˜é‡ï¼ˆ&lt;code&gt;Condition&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½ ä½¿ç”¨çš„&lt;strong&gt;æ•°æ®ç»“æ„æœ¬èº«å°±èƒ½ä¿è¯æ— é”è¯»çš„çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ get æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-7"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†™çº¿ç¨‹é¥¥é¥¿&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;çš„&lt;strong&gt;éå…¬å¹³æ¨¡å¼&lt;/strong&gt;ï¼ˆé»˜è®¤ï¼‰ä¸‹ï¼Œå¦‚æœè¯»çº¿ç¨‹æºæºä¸æ–­ï¼Œå†™çº¿ç¨‹å¯èƒ½ä¼šé•¿æ—¶é—´ç­‰å¾…ï¼Œæ— æ³•è·å–é”ã€‚å¦‚æœå¯¹å†™æ“ä½œçš„å®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨&lt;strong&gt;å…¬å¹³æ¨¡å¼&lt;/strong&gt;ï¼ˆ&lt;code&gt;new ReentrantReadWriteLock(true)&lt;/code&gt;ï¼‰ï¼Œä½†ä¼šä¸€å®šç¨‹åº¦ä¸Šç‰ºç‰²æ•´ä½“ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”å‡çº§&lt;/strong&gt;ï¼š&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;strong&gt;ä¸æ”¯æŒ&lt;/strong&gt;å°†è¯»é”ç›´æ¥å‡çº§ä¸ºå†™é”ã€‚è¯•å›¾åœ¨æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹è·å–å†™é”ä¼šå¯¼è‡´&lt;strong&gt;æ­»é”&lt;/strong&gt;ã€‚ä½ å¿…é¡»å…ˆé‡Šæ”¾è¯»é”ï¼Œç„¶åå†å°è¯•è·å–å†™é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å¯è§æ€§&lt;/strong&gt;ï¼šåœ¨ä½¿ç”¨â€œ&lt;code&gt;ReentrantLock&lt;/code&gt;ä»…é”å†™â€æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¯»æ“ä½œèƒ½çœ‹åˆ°å†™æ“ä½œçš„æœ€æ–°ç»“æœã€‚é€šå¸¸éœ€è¦å€ŸåŠ© &lt;code&gt;volatile&lt;/code&gt;å…³é”®å­—æˆ–åŸå­ç±»ï¼ˆå¦‚ &lt;code&gt;AtomicReference&lt;/code&gt;ï¼‰æ¥ä¿è¯å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ ¹æ®å®é™…åœºæ™¯åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id="concurrenthashmap"&gt;ConcurrentHashMap
&lt;/h2&gt;&lt;p&gt;æ ¹æ®ä½ çš„æè¿°ï¼Œä½ çš„ä½¿ç”¨åœºæ™¯ï¼ˆ&lt;strong&gt;åªæœ‰åœ¨å…ƒç´ ä¸ºç©ºæ—¶æ‰æ‰§è¡Œå†™å…¥æ“ä½œï¼Œå…¶ä»–æ—¶é—´åŸºæœ¬éƒ½æ˜¯è¯»å–&lt;/strong&gt;ï¼‰éå¸¸é€‚åˆä½¿ç”¨ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ã€‚å®ƒåœ¨è¿™ç§â€œè¯»å¤šå†™å°‘â€çš„æ¨¡å¼ä¸‹èƒ½å‘æŒ¥å‡ºæœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å¿«é€ŸæŠŠæ¡æ ¸å¿ƒåŸå› ï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸ªè¡¨æ ¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;ä¸ºä½•é€‚åˆä½ çš„åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»æ“ä½œå®Œå…¨æ— é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¢‘ç¹çš„è¯»å–æ“ä½œï¼ˆè·å–&lt;code&gt;Collection&lt;/code&gt;å¼•ç”¨ï¼‰ä¸ä¼šé˜»å¡ï¼Œå¯ä»¥&lt;strong&gt;æé«˜å¹¶å‘&lt;/strong&gt;åœ°è¿›è¡Œï¼Œè¿™æ˜¯æ€§èƒ½çš„å…³é”®ã€‚&lt;/td&gt;
&lt;td&gt;æ— ã€‚è¿™æ­£æ˜¯ä½ éœ€è¦çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™é”ç²’åº¦æç»†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å³ä½¿å‘ç”Ÿå†™å…¥ï¼ˆç©ºæ’å…¥ï¼‰ï¼Œä¹Ÿ&lt;strong&gt;åªé”å®šå½“å‰æ“ä½œçš„å•ä¸ªæ¡¶ï¼ˆbucketï¼‰&lt;/strong&gt;ï¼Œä¸å½±å“å…¶ä»–æ¡¶çš„è¯»å†™æ“ä½œï¼Œå°†é”çš„ç«äº‰å’Œå½±å“é™åˆ°æœ€ä½ã€‚&lt;/td&gt;
&lt;td&gt;æä½æ¦‚ç‡ä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¦åˆå§‹åŒ–åŒä¸€ä¸ªç©ºæ¡¶ï¼Œå®ƒä»¬ä¼šä¸²è¡Œæ‰§è¡Œï¼Œä½†è¿™ç§æƒ…å†µå¾ˆå°‘è§ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…ç½®åŸå­æ“ä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›äº† &lt;code&gt;putIfAbsent&lt;/code&gt;ã€&lt;code&gt;computeIfAbsent&lt;/code&gt;ç­‰åŸå­æ–¹æ³•ï¼Œ&lt;strong&gt;ä¸€è¡Œä»£ç å°±èƒ½å®Œæˆâ€œæ£€æŸ¥ä¸ºç©ºåˆ™æ’å…¥â€çš„æ“ä½œ&lt;/strong&gt;ï¼Œå®Œç¾åŒ¹é…ä½ çš„éœ€æ±‚ï¼Œä¸”çº¿ç¨‹å®‰å…¨ã€‚&lt;/td&gt;
&lt;td&gt;åŠ¡å¿…ä½¿ç”¨è¿™äº›ç°æˆæ–¹æ³•ï¼Œè€Œä¸æ˜¯è‡ªå·±ç”¨ &lt;code&gt;get&lt;/code&gt;å’Œ &lt;code&gt;put&lt;/code&gt;ç»„åˆï¼Œå¦åˆ™ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜å¯è§æ€§ä¿è¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†…éƒ¨çš„ &lt;code&gt;Node&lt;/code&gt;å€¼ç”¨ &lt;code&gt;volatile&lt;/code&gt;ä¿®é¥°ï¼Œç¡®ä¿ä¸€ä¸ªçº¿ç¨‹æ’å…¥æ–°å€¼åï¼Œå…¶ä»–çº¿ç¨‹èƒ½&lt;strong&gt;ç«‹åˆ»çœ‹åˆ°æœ€æ–°çš„&lt;code&gt;Collection&lt;/code&gt;å¼•ç”¨&lt;/strong&gt;ï¼Œä¸ä¼šè¯»åˆ°è¿‡æœŸçš„ç©ºå€¼ã€‚&lt;/td&gt;
&lt;td&gt;æ— ã€‚è¿™æ­£æ˜¯ä½ éœ€è¦çš„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•å®ç°ä½ çš„éœ€æ±‚"&gt;ğŸ¯ å¦‚ä½•å®ç°ä½ çš„éœ€æ±‚
&lt;/h3&gt;&lt;p&gt;ä½ æè¿°çš„é€»è¾‘â€”â€”â€œå¦‚æœç©ºåˆ™æ’å…¥ï¼Œå¦åˆ™åªè¯»â€â€”â€”éå¸¸é€‚åˆç”¨ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ &lt;code&gt;computeIfAbsent&lt;/code&gt;æ–¹æ³•æ¥å®ç°ã€‚å®ƒèƒ½ä¿è¯åŸå­æ€§ï¼Œå¹¶ä¸”éå¸¸ç®€æ´ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å‡è®¾ä½ çš„ ConcurrentHashMap å®šä¹‰ä¸º
ConcurrentHashMap&amp;lt;String, Collection&amp;lt;Object&amp;gt;&amp;gt; map = new ConcurrentHashMap&amp;lt;&amp;gt;();
String key = &amp;#34;someKey&amp;#34;;
// ä½¿ç”¨ computeIfAbsent æ¥ä¿è¯ï¼šå¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™åŸå­æ€§åœ°è®¡ç®—å¹¶æ”¾å…¥ä¸€ä¸ªæ–°å€¼
Collection&amp;lt;Object&amp;gt; valueCollection = map.computeIfAbsent(key, k -&amp;gt; {
// è¿™ä¸ªæ˜ å°„å‡½æ•°åªåœ¨é”® k ä¸å­˜åœ¨æ—¶æ‰§è¡Œ
// åœ¨è¿™é‡Œåˆ›å»ºå¹¶è¿”å›ä½ çš„æ–° Collectionï¼Œä¾‹å¦‚ï¼š
return Collections.synchronizedList(new ArrayList&amp;lt;&amp;gt;()); // æˆ–è€… new ConcurrentLinkedQueue&amp;lt;&amp;gt;() ç­‰
});
// ä¹‹åï¼Œä½ å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ valueCollection è¿›è¡Œè¯»å–æ“ä½œ
for (Object item : valueCollection) {
// å¤„ç†å…ƒç´ 
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹"&gt;âš ï¸ ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©çº¿ç¨‹å®‰å…¨çš„é›†åˆ (Collection)&lt;/strong&gt;ï¼šä½ æ”¾å…¥ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ &lt;code&gt;Collection&lt;/code&gt;æœ¬èº«ä¹Ÿå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶æ“ä½œè¿™ä¸ªé›†åˆã€‚ä½ å¯ä»¥é€‰æ‹©ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;java.util.concurrent&lt;/code&gt;åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼ˆå¦‚ &lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;, &lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨ &lt;code&gt;Collections.synchronizedCollection()&lt;/code&gt;, &lt;code&gt;Collections.synchronizedList()&lt;/code&gt;ç­‰åŒ…è£…æ–¹æ³•åŒ…è£…ä¸€ä¸ªæ™®é€šé›†åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…é‡å¤é€ è½®å­&lt;/strong&gt;ï¼š&lt;strong&gt;åƒä¸‡ä¸è¦&lt;/strong&gt;è‡ªå·±å†™ä»£ç å…ˆ &lt;code&gt;get(key)&lt;/code&gt;æ£€æŸ¥æ˜¯å¦ä¸º &lt;code&gt;null&lt;/code&gt;ï¼Œç„¶åå† &lt;code&gt;put(key, newValue)&lt;/code&gt;ã€‚è¿™åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä¸¤ä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶æ£€æŸ¥åˆ° &lt;code&gt;null&lt;/code&gt;ï¼Œç„¶åéƒ½æ‰§è¡Œ &lt;code&gt;put&lt;/code&gt;ï¼Œå¯¼è‡´ä¸€ä¸ªè¦†ç›–å¦ä¸€ä¸ªã€‚&lt;strong&gt;å§‹ç»ˆä½¿ç”¨ &lt;code&gt;putIfAbsent&lt;/code&gt;æˆ– &lt;code&gt;computeIfAbsent&lt;/code&gt;è¿™æ ·çš„åŸå­æ–¹æ³•ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼çš„ä½¿ç”¨&lt;/strong&gt;ï¼š&lt;code&gt;computeIfAbsent&lt;/code&gt;çš„è¿”å›å€¼å°±æ˜¯ä½ éœ€è¦çš„ &lt;code&gt;Collection&lt;/code&gt;å¼•ç”¨ï¼ˆæ— è®ºæ˜¯æ–°åˆ›å»ºçš„è¿˜æ˜¯å·²ç»å­˜åœ¨çš„ï¼‰ã€‚ç›´æ¥ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼ï¼Œè€Œä¸æ˜¯å†è°ƒç”¨ä¸€æ¬¡ &lt;code&gt;map.get(key)&lt;/code&gt;ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;éå¸¸é€‚åˆã€‚&lt;/strong&gt; &lt;code&gt;ConcurrentHashMap&lt;/code&gt;å‡ ä¹æ˜¯ä¸ºä½ æè¿°çš„è¿™ç±»åœºæ™¯é‡èº«å®šåšçš„ã€‚å®ƒçš„&lt;strong&gt;æ— é”è¯»&lt;/strong&gt;å’Œ&lt;strong&gt;ç»†ç²’åº¦å†™é”&lt;/strong&gt;å®Œç¾å¥‘åˆäº†ä½ â€œåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè¯»å–æ— æ•°æ¬¡â€çš„éœ€æ±‚ã€‚åªéœ€ä½¿ç”¨å…¶å†…ç½®çš„åŸå­æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;computeIfAbsent&lt;/code&gt;ï¼‰å¹¶ç¡®ä¿å­˜æ”¾çš„é›†åˆæœ¬èº«çº¿ç¨‹å®‰å…¨å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ åšå‡ºå†³ç­–ï¼&lt;/p&gt;
&lt;h2 id="concurrentset"&gt;ConcurrentSet
&lt;/h2&gt;&lt;p&gt;Java æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å«åš &lt;code&gt;ConcurrentHashSet&lt;/code&gt;çš„ç±»ã€‚ä½†æ˜¯ï¼Œä½ å®Œå…¨å¯ä»¥é€šè¿‡ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;æ¥è½»æ¾åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ã€è¡Œä¸ºç±»ä¼¼çš„ Setã€‚è‡ª JDK 8 èµ·ï¼Œ&lt;code&gt;ConcurrentHashMap&lt;/code&gt;æä¾›äº†ä¸¤ä¸ªéå¸¸æ–¹ä¾¿çš„æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„ Setï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;newKeySet()&lt;/code&gt;&lt;/strong&gt;: è¿”å›ä¸€ä¸ªç”± &lt;code&gt;ConcurrentHashMap&lt;/code&gt;æ”¯æŒçš„æ ‡å‡† &lt;code&gt;Set&lt;/code&gt;ï¼Œä½ å¯ä»¥å®‰å…¨åœ°æ·»åŠ ã€åˆ é™¤å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;keySet(defaultValue)&lt;/code&gt;&lt;/strong&gt;: è¿”å›ä¸€ä¸ªä¸ç‰¹å®š &lt;code&gt;ConcurrentHashMap&lt;/code&gt;å®ä¾‹é”®è§†å›¾å…³è”çš„ Setï¼Œå…è®¸åœ¨æ·»åŠ æ–°é”®æ—¶æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„æ˜ å°„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨ &lt;code&gt;newKeySet()&lt;/code&gt;æ–¹æ³•åˆ›å»ºçº¿ç¨‹å®‰å…¨ Set çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;
public class ConcurrentHashSetExample {
public static void main(String[] args) {
// ä½¿ç”¨ ConcurrentHashMap çš„ newKeySet() æ–¹æ³•åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„ Set
Set&amp;lt;String&amp;gt; concurrentSet = ConcurrentHashMap.newKeySet();
concurrentSet.add(&amp;#34;Java&amp;#34;);
concurrentSet.add(&amp;#34;Python&amp;#34;);
concurrentSet.add(&amp;#34;C++&amp;#34;);
System.out.println(&amp;#34;Set: &amp;#34; + concurrentSet); // è¾“å‡º: Set: [Java, Python, C++]
// å®‰å…¨çš„å¹¶å‘æ“ä½œ
boolean containsJava = concurrentSet.contains(&amp;#34;Java&amp;#34;); // true
concurrentSet.remove(&amp;#34;Python&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-å…¶ä»–åˆ›å»ºçº¿ç¨‹å®‰å…¨-set-çš„æ–¹æ³•"&gt;ğŸ’¡ å…¶ä»–åˆ›å»ºçº¿ç¨‹å®‰å…¨ Set çš„æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;é™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼ä¹Ÿèƒ½è·å¾—çº¿ç¨‹å®‰å…¨çš„ Setï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¯ä»¥å°†ä¸€ä¸ªæ™®é€šçš„ &lt;code&gt;HashSet&lt;/code&gt;åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„ Setã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Set&amp;lt;String&amp;gt; syncSet = Collections.synchronizedSet(new HashSet&amp;lt;&amp;gt;());
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¿™ç§æ–¹å¼é€šè¿‡å¯¹æ•´ä¸ªé›†åˆåŠ é”å®ç°çº¿ç¨‹å®‰å…¨ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½å¯èƒ½ä¸å¦‚åŸºäº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ Setã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CopyOnWriteArraySet&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ &lt;code&gt;java.util.concurrent&lt;/code&gt;åŒ…ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨ Set å®ç°ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import java.util.concurrent.CopyOnWriteArraySet;
Set&amp;lt;String&amp;gt; copyOnWriteSet = new CopyOnWriteArraySet&amp;lt;&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šå®ƒé€‚ç”¨äº&lt;strong&gt;è¯»å¤šå†™æå°‘&lt;/strong&gt;çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç›‘å¬å™¨åˆ—è¡¨ï¼‰ã€‚æ¯æ¬¡ä¿®æ”¹ï¼ˆå†™æ“ä½œï¼‰éƒ½ä¼šå¤åˆ¶åº•å±‚æ•°ç»„ï¼Œå› æ­¤å†™æ“ä½œå¼€é”€è¾ƒå¤§ï¼Œä½†è¯»æ“ä½œéå¸¸å¿«ä¸”ä¸éœ€è¦é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-7"&gt;ğŸ“Š å¦‚ä½•é€‰æ‹©ï¼Ÿ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å®ç°æ–¹å¼&lt;/th&gt;
&lt;th&gt;åŸç†&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ConcurrentHashMap.newKeySet()&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼Œä½¿ç”¨ç»†ç²’åº¦é”æˆ– CAS å®ç°é«˜æ€§èƒ½å¹¶å‘&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘è¯»å†™&lt;/strong&gt;ï¼Œéœ€è¦æœ€ä½³æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Collections.synchronizedSet()&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ synchronized å…³é”®å­—å¯¹æ•´ä¸ªé›†åˆåŠ é”&lt;/td&gt;
&lt;td&gt;å¹¶å‘ç«äº‰ä¸é«˜ï¼Œæˆ–è€…éœ€è¦ä¸æ—§ä»£ç å…¼å®¹çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CopyOnWriteArraySet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†™æ—¶å¤åˆ¶ï¼Œè¯»æ“ä½œæ— é”&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¯»å¤šå†™æå°‘&lt;/strong&gt;ï¼Œé›†åˆå¤§å°é€šå¸¸ä¿æŒè¾ƒå°ï¼Œä¸”éå†æ“ä½œè¿œå¤šäºä¿®æ”¹æ“ä½œçš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-8"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„é”®å’Œå€¼ä¸å…è®¸ä¸º &lt;code&gt;null&lt;/code&gt;&lt;/strong&gt;ï¼šå› æ­¤ï¼Œé€šè¿‡ &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;åˆ›å»ºçš„ Set &lt;strong&gt;ä¹Ÿä¸å…è®¸æ”¾å…¥ &lt;code&gt;null&lt;/code&gt;å…ƒç´ &lt;/strong&gt;ã€‚è€Œ &lt;code&gt;HashSet&lt;/code&gt;å…è®¸ä¸€ä¸ª &lt;code&gt;null&lt;/code&gt;å…ƒç´ ï¼Œè¿™æ˜¯å®ƒä»¬çš„ä¸€ä¸ªåŒºåˆ«ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿­ä»£å™¨çš„å¼±ä¸€è‡´æ€§&lt;/strong&gt;ï¼šç”± &lt;code&gt;ConcurrentHashMap&lt;/code&gt;æ”¯æŒçš„ Set æ‰€è¿”å›çš„è¿­ä»£å™¨å…·æœ‰&lt;strong&gt;å¼±ä¸€è‡´æ€§&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€è¿­ä»£å™¨å¯ä»¥å®¹å¿å¹¶å‘ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸ä¼šæŠ›å‡º &lt;code&gt;ConcurrentModificationException&lt;/code&gt;ã€‚ä½†å®ƒä¸ä¿è¯èƒ½åæ˜ å‡ºè¿­ä»£å™¨åˆ›å»ºä¹‹åçš„æ‰€æœ‰ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©å–å†³äºåœºæ™¯&lt;/strong&gt;ï¼šå¦‚æœä½ çš„åœºæ™¯æ˜¯&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;ï¼ˆä¾‹å¦‚ç›‘å¬å™¨åˆ—è¡¨ã€é…ç½®é¡¹ï¼‰ï¼Œ&lt;code&gt;CopyOnWriteArraySet&lt;/code&gt;å¯èƒ½æ›´åˆé€‚ã€‚å¯¹äº&lt;strong&gt;è¯»å†™éƒ½å¾ˆé¢‘ç¹&lt;/strong&gt;çš„é«˜å¹¶å‘åœºæ™¯ï¼ŒåŸºäº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ Set é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ ï¼&lt;/p&gt;
&lt;h2 id="listremoveall"&gt;List.removeAll
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œåœ¨ Java ä¸­ï¼Œå¯¹ &lt;code&gt;List&lt;/code&gt;è°ƒç”¨ &lt;code&gt;removeAll(Collection)&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œå¦‚æœä¼ å…¥çš„ &lt;code&gt;Collection&lt;/code&gt;æ˜¯ä¸€ä¸ª &lt;code&gt;Set&lt;/code&gt;ï¼ˆç‰¹åˆ«æ˜¯ &lt;code&gt;HashSet&lt;/code&gt;ï¼‰æˆ–åŸºäºå“ˆå¸Œçš„æ˜ å°„ï¼Œ&lt;strong&gt;æ•ˆç‡é€šå¸¸ä¼šæ˜¾è‘—é«˜äºä¼ å…¥ä¸€ä¸ª &lt;code&gt;List&lt;/code&gt;&lt;/strong&gt;ã€‚æ€§èƒ½å·®å¼‚ä¸»è¦æºäºä¸åŒæ•°æ®ç»“æ„åœ¨&lt;strong&gt;æŸ¥æ‰¾æ“ä½œï¼ˆ&lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•ï¼‰&lt;/strong&gt; ä¸Šçš„æ•ˆç‡å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼ç›´è§‚å¯¹æ¯”äº†ä¸º &lt;code&gt;removeAll&lt;/code&gt;ä¼ å…¥ &lt;code&gt;HashSet&lt;/code&gt;å’Œ &lt;code&gt;ArrayList&lt;/code&gt;ä½œä¸ºå‚æ•°æ—¶çš„æ ¸å¿ƒæ•ˆç‡å·®å¼‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§/æ“ä½œ&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ &lt;code&gt;HashSet&lt;/code&gt;ä½œä¸ºå‚æ•°&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ &lt;code&gt;ArrayList&lt;/code&gt;ä½œä¸ºå‚æ•°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥æ‰¾æœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºå“ˆå¸Œè¡¨ (HashMap)&lt;/td&gt;
&lt;td&gt;åŸºäºé¡ºåºéå†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;contains() æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¹³å‡ O(1)&lt;/strong&gt; (å¸¸æ•°æ—¶é—´å¤æ‚åº¦ï¼Œæå¿«)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;O(n)&lt;/strong&gt; (çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œéšå…ƒç´ å¢å¤šè€Œå˜æ…¢)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;removeAll æ€»æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é«˜&lt;/strong&gt; (ä»…éœ€éå†å¾…åˆ åˆ—è¡¨ï¼Œæ¯æ¬¡æ£€æŸ¥éƒ½æå¿«)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½&lt;/strong&gt; (æ¯æ¬¡æ£€æŸ¥éƒ½éœ€éå†å‚æ•°åˆ—è¡¨ï¼Œæ•´ä½“å¤æ‚åº¦ O(n*m))&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æµ·é‡æ•°æ®&lt;/strong&gt;æˆ–&lt;strong&gt;é¢‘ç¹æ“ä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®é‡æå°æˆ–ä»…ä½œç®€å•æ¼”ç¤º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ•ˆç‡å·®å¼‚åŸå› "&gt;ğŸ” æ•ˆç‡å·®å¼‚åŸå› 
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ArrayList&lt;/code&gt;çš„ &lt;code&gt;removeAll(Collection&amp;lt;?&amp;gt; c)&lt;/code&gt;æ–¹æ³•å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ƒä¼šéå† &lt;code&gt;ArrayList&lt;/code&gt;æœ¬èº«çš„æ¯ä¸ªå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œå®ƒè°ƒç”¨å‚æ•°é›†åˆ &lt;code&gt;c&lt;/code&gt;çš„ &lt;code&gt;contains(Object o)&lt;/code&gt;æ–¹æ³•ï¼Œåˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆ &lt;code&gt;c&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå­˜åœ¨ï¼Œåˆ™å°†å…¶ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…³é”®åœ¨äºç¬¬2æ­¥ï¼š&lt;strong&gt;&lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•çš„æ•ˆç‡å–å†³äºå‚æ•°é›†åˆ &lt;code&gt;c&lt;/code&gt;çš„ç±»å‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å½“ &lt;code&gt;c&lt;/code&gt;ä¸º &lt;code&gt;List&lt;/code&gt;(å¦‚ &lt;code&gt;ArrayList&lt;/code&gt;)&lt;/strong&gt;: å…¶ &lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•é€šå¸¸éœ€è¦&lt;strong&gt;éå†å†…éƒ¨æ•°ç»„&lt;/strong&gt;ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º &lt;strong&gt;O(n)&lt;/strong&gt; (n ä¸ºåˆ—è¡¨å¤§å°)ã€‚è¿™æ„å‘³ç€å¯¹ &lt;code&gt;ArrayList&lt;/code&gt;çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œæœ€åæƒ…å†µä¸‹å¯èƒ½éœ€è¦éå†æ•´ä¸ªå‚æ•°åˆ—è¡¨ã€‚å¦‚æœä¸¤ä¸ªåˆ—è¡¨éƒ½å¾ˆå¤§ï¼Œæ€»ä½“æ—¶é—´å¤æ‚åº¦å¯èƒ½æ¥è¿‘ &lt;strong&gt;O(n * m)&lt;/strong&gt;ï¼Œæ€§èƒ½ä¼šéå¸¸å·®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å½“ &lt;code&gt;c&lt;/code&gt;ä¸º &lt;code&gt;Set&lt;/code&gt;(å¦‚ &lt;code&gt;HashSet&lt;/code&gt;)&lt;/strong&gt;: å…¶ &lt;code&gt;contains()&lt;/code&gt;æ–¹æ³•åŸºäº&lt;strong&gt;å“ˆå¸Œè¡¨&lt;/strong&gt;å®ç°ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ˆå“ˆå¸Œå†²çªè¾ƒå°‘ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º &lt;strong&gt;O(1)&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€æ— è®ºé›†åˆ &lt;code&gt;c&lt;/code&gt;æœ‰å¤šå¤§ï¼Œæ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨çš„æ—¶é—´å‡ ä¹æ˜¯æ’å®šçš„ã€‚å› æ­¤ï¼Œæ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸»è¦å–å†³äºå¾…æ¸…ç†çš„ &lt;code&gt;ArrayList&lt;/code&gt;çš„å¤§å°ï¼Œå³ &lt;strong&gt;O(n)&lt;/strong&gt;ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è½¬æ¢å‚æ•°ä¸º Set&lt;/strong&gt;ï¼šå¦‚æœè°ƒç”¨ &lt;code&gt;list.removeAll(otherList)&lt;/code&gt;ä¸” &lt;code&gt;otherList&lt;/code&gt;å¾ˆå¤§ï¼Œ&lt;strong&gt;å¼ºçƒˆå»ºè®®&lt;/strong&gt;å…ˆå°† &lt;code&gt;otherList&lt;/code&gt;è½¬æ¢ä¸º &lt;code&gt;HashSet&lt;/code&gt;å†ä¼ å…¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// ä¼˜åŒ–æ–¹æ¡ˆï¼šå°†Listå‚æ•°è½¬æ¢ä¸ºHashSet
list.removeAll(new HashSet&amp;lt;&amp;gt;(otherList));
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·è™½ç„¶åˆ›å»º &lt;code&gt;HashSet&lt;/code&gt;æœ‰ä¸€ç‚¹ç‚¹å¼€é”€ï¼Œä½†ä¸åç»­å·¨å¤§çš„æ€§èƒ½æå‡ç›¸æ¯”ï¼Œè¿™ç‚¹å¼€é”€å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå°¤å…¶æ˜¯åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›´æ¥ä½¿ç”¨ Set ç±»å‹&lt;/strong&gt;ï¼šå¦‚æœä¸šåŠ¡åœºæ™¯å…è®¸ï¼Œå¹¶ä¸”ä½ æ­£åœ¨å¤„ç†å¤§é‡éœ€è¦æ­¤ç±»æ“ä½œçš„é›†åˆï¼Œ&lt;strong&gt;è€ƒè™‘ä»ä¸€å¼€å§‹å°±ä½¿ç”¨ &lt;code&gt;Set&lt;/code&gt;è€Œä¸æ˜¯ &lt;code&gt;List&lt;/code&gt;&lt;/strong&gt; æ¥å­˜å‚¨å…ƒç´ ï¼Œä»¥é¿å…é‡å¤è½¬æ¢å’Œåˆ©ç”¨å…¶å›ºæœ‰çš„é«˜æ€§èƒ½æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„å¯¹è±¡ hashCode å’Œ equals&lt;/strong&gt;ï¼š&lt;code&gt;HashSet&lt;/code&gt;çš„é«˜æ•ˆåŸºäºè‰¯å¥½çš„å“ˆå¸Œåˆ†å¸ƒå’Œæ­£ç¡®çš„ &lt;code&gt;equals&lt;/code&gt;æ–¹æ³•ã€‚ç¡®ä¿è¦ç§»é™¤çš„å…ƒç´ ç±»æ­£ç¡®é‡å†™äº† &lt;code&gt;hashCode()&lt;/code&gt;å’Œ &lt;code&gt;equals(Object obj)&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-ä¸¾ä¸ªä¾‹å­"&gt;ğŸ’¡ ä¸¾ä¸ªä¾‹å­
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å« 10000 ä¸ªå…ƒç´ çš„ &lt;code&gt;ArrayList&lt;/code&gt;(&lt;code&gt;list&lt;/code&gt;)ï¼Œè¦ç§»é™¤å¦ä¸€ä¸ªåŒ…å« 1000 ä¸ªå…ƒç´ çš„é›†åˆ (&lt;code&gt;collectionToRemove&lt;/code&gt;) ä¸­ä¹Ÿå­˜åœ¨çš„å…ƒç´ ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;collectionToRemove&lt;/code&gt;æ˜¯ &lt;code&gt;ArrayList&lt;/code&gt;ï¼Œ&lt;code&gt;list.removeAll(collectionToRemove)&lt;/code&gt;å¯èƒ½éœ€è¦è¿›è¡Œçº¦ 10000 * 1000 = 10,000,000 æ¬¡æ¯”è¾ƒã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;collectionToRemove&lt;/code&gt;æ˜¯ &lt;code&gt;HashSet&lt;/code&gt;ï¼Œ&lt;code&gt;list.removeAll(collectionToRemove)&lt;/code&gt;å¯èƒ½éœ€è¦è¿›è¡Œçº¦ 10000 * 1 = 10,000 æ¬¡å“ˆå¸ŒæŸ¥æ‰¾ï¼ˆå®é™…ä¸Šæ¯æ¬¡æŸ¥æ‰¾çš„æˆæœ¬å¾ˆä½ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-9"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜æƒè¡¡&lt;/strong&gt;ï¼š&lt;code&gt;HashSet&lt;/code&gt;ç›¸æ¯” &lt;code&gt;ArrayList&lt;/code&gt;é€šå¸¸ä¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œå› ä¸ºéœ€è¦ç»´æŠ¤å“ˆå¸Œè¡¨ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…ƒç´ é¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;HashSet&lt;/code&gt;ä¸ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œè€Œ &lt;code&gt;List&lt;/code&gt;é€šå¸¸æ˜¯æœ‰åºçš„ã€‚ä½†è¿™ä¸å½±å“ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œçš„ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°æ•°æ®é‡å·®å¼‚ä¸æ˜æ˜¾&lt;/strong&gt;ï¼šå¦‚æœå‚ä¸æ“ä½œçš„é›†åˆéå¸¸å°ï¼Œæ€§èƒ½å·®å¼‚å¯èƒ½å¾®ä¹å…¶å¾®ï¼Œç”šè‡³å› ä¸ºåˆ›å»º &lt;code&gt;HashSet&lt;/code&gt;çš„å¼€é”€è€Œç¨æ…¢ã€‚ä¼˜åŒ–é€šå¸¸åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶æ•ˆæœæ˜¾è‘—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œ&lt;strong&gt;åœ¨éœ€è¦å¯¹ &lt;code&gt;List&lt;/code&gt;è¿›è¡Œ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œä¸”å‚æ•°é›†åˆè¾ƒå¤§æ—¶ï¼Œå°†å…¶è½¬æ¢ä¸º &lt;code&gt;HashSet&lt;/code&gt;å†ä¼ å…¥æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id="removeall-çº¿ç¨‹å®‰å…¨"&gt;removeAll çº¿ç¨‹å®‰å…¨
&lt;/h2&gt;&lt;p&gt;Java ä¸­ &lt;code&gt;List.removeAll(Collection)&lt;/code&gt;æ–¹æ³•&lt;strong&gt;æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/strong&gt;ã€‚å½“ä¼ å…¥çš„ &lt;code&gt;Collection&lt;/code&gt;å‚æ•°åŠ¨æ€å˜åŒ–æ—¶ï¼Œ&lt;strong&gt;å¾ˆå¯èƒ½å¯¼è‡´é”™è¯¯æˆ–ä¸å¯é¢„çŸ¥çš„è¡Œä¸º&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-ä¸»è¦é£é™©ä¸å…·ä½“è¡¨ç°"&gt;âš ï¸ ä¸»è¦é£é™©ä¸å…·ä½“è¡¨ç°
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¹¶å‘ä¿®æ”¹å¼‚å¸¸ (&lt;code&gt;ConcurrentModificationException&lt;/code&gt;)&lt;/strong&gt;: è¿™æ˜¯æœ€å¸¸è§çš„é”™è¯¯ã€‚å¦‚æœåœ¨éå†å‚æ•°é›†åˆ &lt;code&gt;c&lt;/code&gt;çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†è¯¥é›†åˆï¼ˆå¦‚æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰ï¼Œè¿­ä»£å™¨ä¼šæ£€æµ‹åˆ°è¿™ç§ä¿®æ”¹å¹¶ç«‹å³æŠ›å‡º &lt;code&gt;ConcurrentModificationException&lt;/code&gt;ï¼Œå¯¼è‡´ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œå¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸ä¸€è‡´å’Œæœªå®šä¹‰è¡Œä¸º&lt;/strong&gt;: å³ä½¿æœªæŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨å¹¶å‘ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œ&lt;code&gt;removeAll&lt;/code&gt;çš„æ‰§è¡Œç»“æœä¹Ÿæ˜¯ä¸å¯é¢„æµ‹çš„ã€‚å®ƒå¯èƒ½æ— æ³•ç§»é™¤æ‰€æœ‰é¢„æœŸçš„å…ƒç´ ï¼Œæˆ–è€…ç§»é™¤äº†éé¢„æœŸçš„å…ƒç´ ï¼Œå› ä¸ºå…¶å†…éƒ¨ä½¿ç”¨çš„é›†åˆâ€œå¿«ç…§â€å·²ç»è¿‡æœŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½é—®é¢˜&lt;/strong&gt;: &lt;code&gt;removeAll&lt;/code&gt;æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦é€šå¸¸ä¸º O(n*m)ï¼ˆn æ˜¯åˆ—è¡¨å¤§å°ï¼Œm æ˜¯å‚æ•°é›†åˆå¤§å°ï¼‰ã€‚å¦‚æœå‚æ•°é›†åˆå¾ˆå¤§ä¸”åœ¨æ“ä½œè¿‡ç¨‹ä¸­è¢«é¢‘ç¹ä¿®æ”¹ï¼Œå¯èƒ½ä¼šåŠ å‰§æ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ç§»é™¤"&gt;ğŸ›¡ï¸ å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ç§»é™¤
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨åœ°ä½¿ç”¨ &lt;code&gt;removeAll&lt;/code&gt;æˆ–ç±»ä¼¼åŠŸèƒ½ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åŒæ­¥å— (Synchronization)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ‰§è¡Œ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œå‰åï¼Œä½¿ç”¨åŒæ­¥é”&lt;strong&gt;åŒæ—¶ä¿æŠ¤ç›®æ ‡åˆ—è¡¨å’Œå‚æ•°é›†åˆ&lt;/strong&gt;ï¼Œç¡®ä¿åœ¨æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰å…¶ä»–çº¿ç¨‹èƒ½ä¿®æ”¹è¿™ä¸¤ä¸ªé›†åˆã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å‡è®¾ list å’Œ collectionToRemove æ˜¯éœ€è¦æ“ä½œçš„é›†åˆ
synchronized (list) {
synchronized (collectionToRemove) {
list.removeAll(collectionToRemove);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç®€å•ç›´æ¥ï¼Œé€‚ç”¨äºå„ç§é›†åˆç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šç²’åº¦è¾ƒç²—ï¼Œæ€§èƒ½è¾ƒä½ï¼Œå®¹æ˜“å¯¼è‡´æ­»é”ï¼Œéœ€è°¨æ…è®¾è®¡é”é¡ºåºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±» (Thread-safe Collections)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†ç›®æ ‡ &lt;code&gt;List&lt;/code&gt;æ›¿æ¢ä¸º &lt;strong&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/strong&gt;ã€‚ä½†è¯·æ³¨æ„ï¼Œ&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;çš„ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œä¼šé”å®šæ•´ä¸ªåˆ—è¡¨ï¼Œå¹¶ä¸”å¯èƒ½äº§ç”Ÿè¾ƒå¤§çš„æ•°ç»„æ‹·è´å¼€é”€ï¼Œ&lt;strong&gt;å®ƒæ›´é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®ä¿å‚æ•°é›†åˆä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¾‹å¦‚ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ KeySet&lt;/strong&gt; æˆ– &lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;åŒ…è£…çš„é›†åˆï¼Œå¹¶åœ¨è¿­ä»£æ—¶è¿›è¡Œå¤–éƒ¨åŒæ­¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºå‚æ•°é›†åˆçš„å‰¯æœ¬ (Create a Snapshot Copy)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒç”¨ &lt;code&gt;removeAll&lt;/code&gt;ä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä»½å‚æ•°é›†åˆçš„å‰¯æœ¬ï¼Œç„¶åå¯¹å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚è¿™å¯ä»¥é¿å…åœ¨éå†è¿‡ç¨‹ä¸­åŸé›†åˆè¢«ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;String&amp;gt; snapshotCopy = new ArrayList&amp;lt;&amp;gt;(dynamicCollection); // åˆ›å»ºå¿«ç…§
list.removeAll(snapshotCopy);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå®ç°ç®€å•ï¼Œé¿å…äº†ç›´æ¥æ“ä½œåŠ¨æ€é›†åˆå¸¦æ¥çš„å¹¶å‘é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¦‚æœåŸé›†åˆéå¸¸å¤§ï¼Œåˆ›å»ºå‰¯æœ¬ä¼šæœ‰æ€§èƒ½å’Œå†…å­˜å¼€é”€ã€‚å¹¶ä¸”ï¼Œæ­¤å¿«ç…§æ— æ³•åæ˜ åˆ›å»ºä¹‹ååŸé›†åˆçš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å®ç”¨å»ºè®®-1"&gt;ğŸ’¡ å®ç”¨å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯„ä¼°éœ€æ±‚&lt;/strong&gt;ï¼šé¦–å…ˆç¡®è®¤æ˜¯å¦çœŸçš„éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åŠ¨æ€ä¿®æ”¹ä½œä¸ºå‚æ•°çš„é›†åˆã€‚å¦‚æœèƒ½é€šè¿‡è®¾è®¡é¿å…è¿™ç§æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œæå‰å‡†å¤‡å¥½ä¸€ä¸ªä¸å¯å˜çš„å‚æ•°é›†åˆï¼‰ï¼Œå°†æ˜¯æœ€å¥½å’Œæœ€å®‰å…¨çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;removeAll&lt;/code&gt;æ“ä½œéå¸¸é¢‘ç¹ä¸”é›†åˆå¾ˆå¤§ï¼ŒåŒæ­¥å’Œæ‹·è´æ–¹æ¡ˆéƒ½å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè€ƒè™‘ä½¿ç”¨æ›´é«˜çº§çš„å¹¶å‘æ¨¡å‹æˆ–æ•°æ®ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨å¹¶å‘é›†åˆ&lt;/strong&gt;ï¼šå¯¹äºå…¨æ–°çš„ä»£ç ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ &lt;code&gt;java.util.concurrent&lt;/code&gt;åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼‰ï¼Œå®ƒä»¬ä¸ºå¹¶å‘è®¿é—®è®¾è®¡äº†æ›´ç²¾ç»†çš„é”æœºåˆ¶æˆ–æ— é”ç®—æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œç›´æ¥åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä½¿ç”¨åŠ¨æ€å˜åŒ–çš„ &lt;code&gt;Collection&lt;/code&gt;è°ƒç”¨ &lt;code&gt;List.removeAll&lt;/code&gt;æ˜¯ä¸å®‰å…¨çš„ã€‚åŠ¡å¿…é€šè¿‡åŒæ­¥ã€ä½¿ç”¨çº¿ç¨‹å®‰å…¨é›†åˆæˆ–åˆ›å»ºå‰¯æœ¬ç­‰æ‰‹æ®µæ¥ä¿è¯æ“ä½œçš„æ­£ç¡®æ€§ã€‚&lt;/p&gt;
&lt;h2 id="å¤åˆæ“ä½œ"&gt;å¤åˆæ“ä½œ
&lt;/h2&gt;&lt;p&gt;äº†è§£ä½ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹é›†åˆæ“ä½œçš„è°¨æ…æ€åº¦ã€‚åˆ›å»ºåªè¯»å¿«ç…§ç„¶åæ¸…ç©ºåŸé›†åˆè¿™ä¸€å¤åˆæ“ä½œï¼Œ&lt;strong&gt;æ˜¯å¦éœ€è¦åŠ é”ï¼Œå®Œå…¨å–å†³äºä½ ä½¿ç”¨çš„é›†åˆç±»å‹å’Œä½ çš„çº¿ç¨‹å®‰å…¨è¦æ±‚&lt;/strong&gt;ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†æ ¸å¿ƒç»“è®ºï¼Œå¸®ä½ å¿«é€Ÿåˆ¤æ–­ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ“ä½œåœºæ™¯&lt;/th&gt;
&lt;th&gt;é›†åˆç±»å‹&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€è¦é¢å¤–åŠ é”&lt;/th&gt;
&lt;th&gt;å…³é”®åŸå› &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æ¬¡æ“ä½œ&lt;/strong&gt; (ä»… &lt;code&gt;clear()&lt;/code&gt;æˆ–ä»…åˆ›å»ºå¿«ç…§)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•ä¸ªæ–¹æ³•è°ƒç”¨å†…éƒ¨å·²ä¿è¯åŸå­æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æ¬¡æ“ä½œ&lt;/strong&gt; (ä»… &lt;code&gt;clear()&lt;/code&gt;æˆ–ä»…åˆ›å»ºå¿«ç…§)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•ä¸ªæ–¹æ³•è°ƒç”¨å†…éƒ¨å·²ä¿è¯åŸå­æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤åˆæ“ä½œ&lt;/strong&gt; (åˆ›å»ºå¿«ç…§&lt;strong&gt;åç«‹åˆ»&lt;/strong&gt;æ¸…ç©º)&lt;/td&gt;
&lt;td&gt;ä»»ä½•çº¿ç¨‹å®‰å…¨é›†åˆ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¿è¯ä¸¤ä¸ªç‹¬ç«‹æ“ä½œä¹‹é—´çš„åŸå­æ€§ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹åœ¨é—´éš™ä¿®æ”¹é›†åˆã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•å®ç°å¤åˆæ“ä½œçš„åŸå­æ€§"&gt;ğŸ› ï¸ å¦‚ä½•å®ç°å¤åˆæ“ä½œçš„åŸå­æ€§
&lt;/h3&gt;&lt;p&gt;è‹¥ä½ éœ€è¦â€œåˆ›å»ºå¿«ç…§åç«‹åˆ»æ¸…ç©ºâ€æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•å…ƒï¼Œå¿…é¡»ä½¿ç”¨å¤–éƒ¨åŒæ­¥ï¼ˆå¦‚ &lt;code&gt;synchronized&lt;/code&gt;å—ï¼‰å°†è¿™ä¸¤ä¸ªæ“ä½œæ†ç»‘åœ¨ä¸€èµ·ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å‡è®¾ä½ æœ‰ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Set
Set&amp;lt;String&amp;gt; threadSafeSet = Collections.synchronizedSet(new HashSet&amp;lt;&amp;gt;());
// æˆ– Set&amp;lt;String&amp;gt; threadSafeSet = ConcurrentHashMap.newKeySet();
// ä½¿ç”¨ synchronized å—ç¡®ä¿åˆ›å»ºå¿«ç…§å’Œæ¸…ç©ºçš„åŸå­æ€§
synchronized (threadSafeSet) { // æ³¨æ„ï¼šå¦‚æœä½¿ç”¨ ConcurrentHashMap.newKeySet(), æ­¤å¤„åŒæ­¥å—å¯èƒ½å¤±æ•ˆï¼Œè¯¦è§ä¸‹æ–‡æ³¨æ„äº‹é¡¹
// 1. åˆ›å»ºåªè¯»å¿«ç…§
Set&amp;lt;String&amp;gt; readOnlySnapshot = new HashSet&amp;lt;&amp;gt;(threadSafeSet); // æˆ– Collections.unmodifiableSet(new HashSet&amp;lt;&amp;gt;(threadSafeSet))
// 2. æ¸…ç©ºåŸé›†åˆ
threadSafeSet.clear();
}
// æ­¤æ—¶åŒæ­¥å—ç»“æŸï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­æ“ä½œ
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-é‡è¦æ³¨æ„äº‹é¡¹"&gt;âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;çš„ç‰¹æ®Šæ€§&lt;/strong&gt;ï¼šç”± &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;è¿”å›çš„ Setï¼Œå…¶è¿­ä»£å™¨æ˜¯&lt;strong&gt;å¼±ä¸€è‡´æ€§&lt;/strong&gt;çš„ã€‚ è¿™æ„å‘³ç€åˆ›å»ºå¿«ç…§ï¼ˆå³é€šè¿‡æ„é€ å‡½æ•° &lt;code&gt;new HashSet&amp;lt;&amp;gt;(concurrentSet)&lt;/code&gt;è¿›è¡Œè¿­ä»£ï¼‰æ—¶ï¼Œ&lt;strong&gt;å¯èƒ½æ— æ³•æ•è·åˆ°è¿­ä»£å™¨åˆ›å»ºé‚£ä¸€åˆ»çš„ç»å¯¹ç²¾ç¡®çŠ¶æ€&lt;/strong&gt;ï¼Œä½†èƒ½é¿å…æŠ›å‡º &lt;code&gt;ConcurrentModificationException&lt;/code&gt;ã€‚å¦‚æœä½ éœ€è¦&lt;strong&gt;ç»å¯¹ç²¾ç¡®&lt;/strong&gt;çš„å¿«ç…§ï¼Œåˆ™éœ€é¢å¤–åŒæ­¥ã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹ &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;è¿”å›çš„é›†åˆä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å¤–éƒ¨åŒæ­¥å—&lt;strong&gt;æ— æ³•å®ç°çœŸæ­£çš„äº’æ–¥&lt;/strong&gt;ï¼Œå› ä¸ºå…¶å†…éƒ¨å¹¶æœªä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å®ç°çº¿ç¨‹å®‰å…¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº† CAS ç­‰æœºåˆ¶ã€‚ å¯¹äºéœ€è¦å¼ºä¸€è‡´æ€§å¿«ç…§çš„åœºæ™¯ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘å…¶ä»–æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿­ä»£å™¨çš„æ˜¾å¼åŒæ­¥&lt;/strong&gt;ï¼šå³ä½¿æ˜¯ &lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;è¿”å›çš„é›†åˆï¼Œå…¶è¿­ä»£å™¨ä¹Ÿå¿…é¡»&lt;strong&gt;åœ¨æ‰‹åŠ¨åŒæ­¥å—ä¸­è¿›è¡Œéå†&lt;/strong&gt;ï¼Œå¦åˆ™å¯èƒ½åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å‘ç”Ÿå¹¶å‘ä¿®æ”¹ã€‚ ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œåœ¨ &lt;code&gt;synchronized&lt;/code&gt;å—å†…åˆ›å»ºæ–°é›†åˆï¼ˆå³è¿­ä»£ï¼‰æ˜¯æ­£ç¡®çš„åšæ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;synchronized&lt;/code&gt;å—ä¼š&lt;strong&gt;é˜»å¡å…¶ä»–æ‰€æœ‰çº¿ç¨‹&lt;/strong&gt;å¯¹è¯¥é›†åˆçš„è®¿é—®ã€‚å› æ­¤ï¼Œåº”å°½é‡ç¼©çŸ­åŒæ­¥å—å†…çš„ä»£ç æ‰§è¡Œæ—¶é—´ï¼Œä»¥é¿å…æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šæ ¹æ®ä½ çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ‰æ—¶å¯ä»¥è®¾è®¡ä¸ºä¸è¦æ±‚è¿™ç§ç»å¯¹çš„åŸå­æ€§ã€‚æˆ–è€…ï¼Œåœ¨æŸäº›è¯»è¿œå¤šäºå†™çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ &lt;code&gt;CopyOnWriteArraySet&lt;/code&gt;å¯èƒ½æ˜¯å¦ä¸€ç§é€‰æ‹©ï¼Œä½†å…¶è¿­ä»£å™¨èƒ½åæ˜ åˆ›å»ºæ—¶çš„çŠ¶æ€ï¼Œä¸” &lt;code&gt;clear()&lt;/code&gt;æ“ä½œä¼šå¤åˆ¶æ•°ç»„ï¼Œå¼€é”€è¾ƒå¤§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘å…è®¸â€œåˆ›å»ºå¿«ç…§â€å’Œâ€œæ¸…ç©ºé›†åˆâ€è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨å¾®å°çš„å»¶è¿Ÿ&lt;/strong&gt;ï¼Œå¹¶ä¸”ä½ ä½¿ç”¨çš„é›†åˆæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap.newKeySet()&lt;/code&gt;æˆ– &lt;code&gt;Collections.synchronizedSet()&lt;/code&gt;ï¼‰ï¼Œé‚£ä¹ˆ&lt;strong&gt;ä¸ä¸€å®šéœ€è¦é¢å¤–åŠ é”&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœä½ è¦æ±‚â€œåˆ›å»ºå¿«ç…§â€å’Œâ€œæ¸…ç©ºé›†åˆâ€å¿…é¡»ä½œä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„åŸå­æ“ä½œ&lt;/strong&gt;ï¼Œå³åœ¨å¿«ç…§åˆ›å»ºåæ²¡æœ‰ä»»ä½•å…¶ä»–çº¿ç¨‹èƒ½æ’å…¥æ–°çš„å…ƒç´ ï¼Œé‚£ä¹ˆ&lt;strong&gt;ä½ å¿…é¡»ä½¿ç”¨å¤–éƒ¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ &lt;code&gt;synchronized&lt;/code&gt;å—ï¼‰&lt;/strong&gt; æ¥åŒ…è£¹è¿™ä¸¤ä¸ªæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ ¹æ®å®é™…åœºæ™¯åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ï¼&lt;/p&gt;
&lt;h2 id="synchronized"&gt;synchronized
&lt;/h2&gt;&lt;p&gt;ç†è§£ä½ å…³äº &lt;code&gt;synchronized&lt;/code&gt;é”çš„ç–‘é—®ã€‚ç®€å•æ¥è¯´ï¼Œ&lt;strong&gt;&lt;code&gt;synchronized&lt;/code&gt;é”å®šçš„å¯¹è±¡å¹¶éåœ¨å…¶ä»–ä»»ä½•åœ°æ–¹éƒ½æ— æ³•ä½¿ç”¨&lt;/strong&gt;ã€‚å®ƒåªé˜»æ­¢å…¶ä»–çº¿ç¨‹&lt;strong&gt;è·å–åŒä¸€ä¸ªé”å¯¹è±¡&lt;/strong&gt;æ¥æ‰§è¡Œç›¸åº”çš„åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ï¼Œè€Œå¯¹è±¡çš„å…¶ä»–æ“ä½œé€šå¸¸ä¸å—å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£ï¼Œæˆ‘ç”¨ä¸€ä¸ªæµç¨‹å›¾æ¥å±•ç¤ºå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è®¿é—®è¯¥å¯¹è±¡ä¸åŒéƒ¨åˆ†çš„è¡Œä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[å…¶ä»–çº¿ç¨‹å°è¯•è®¿é—®&amp;lt;br&amp;gt;è¢«synchronizedé”ä½çš„å¯¹è±¡] --&amp;gt; B{è®¿é—®ä»€ä¹ˆ?}
B -- ésynchronizedæ–¹æ³•/ä»£ç å— --&amp;gt; C[âœ… å…è®¸è®¿é—®&amp;lt;br&amp;gt;æ— éœ€è·å–é”]
B -- synchronizedæ–¹æ³•/ä»£ç å—&amp;lt;br&amp;gt;ä¸”éœ€åŒä¸€æŠŠé” --&amp;gt; D{å°è¯•è·å–åŒä¸€å¯¹è±¡é”}
D -- è·å–æˆåŠŸ --&amp;gt; E[âœ… è¿›å…¥åŒæ­¥ä»£ç ]
D -- è·å–å¤±è´¥&amp;lt;br&amp;gt;ï¼ˆé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼‰ --&amp;gt; F[â›” é˜»å¡ç­‰å¾…]
B -- å…¶ä»–å¯¹è±¡çš„&amp;lt;br&amp;gt;synchronizedæ–¹æ³• --&amp;gt; G[âœ… å…è®¸è®¿é—®&amp;lt;br&amp;gt;é”å¯¹è±¡ä¸åŒï¼Œäº’ä¸å¹²æ‰°]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šå›¾ç›´è§‚å±•ç¤ºäº†é”çš„æ ¸å¿ƒè§„åˆ™ï¼š&lt;strong&gt;åŒæ­¥åªå‘ç”Ÿåœ¨ç«äº‰åŒä¸€æŠŠé”çš„çº¿ç¨‹ä¹‹é—´&lt;/strong&gt;ã€‚ä¸‹é¢æˆ‘ä»¬å†æ·±å…¥çœ‹çœ‹è¿™äº›è§„åˆ™å’Œä¸€äº›æ³¨æ„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h3 id="-ç†è§£synchronizedçš„é”è§„åˆ™"&gt;ğŸ”’ ç†è§£synchronizedçš„é”è§„åˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”å¯¹è±¡è€Œéå¯¹è±¡æœ¬èº«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;å…³é”®å­—é”å®šçš„æ˜¯&lt;strong&gt;ä½œä¸ºé”çš„é‚£ä¸ªå¯¹è±¡å®ä¾‹&lt;/strong&gt;ï¼ˆæˆ– Class å¯¹è±¡ï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œã€‚å…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è‡ªç”±è°ƒç”¨è¯¥å¯¹è±¡çš„éåŒæ­¥æ–¹æ³•ï¼ˆ&lt;code&gt;non-synchronized methods&lt;/code&gt;ï¼‰ï¼Œæˆ–è€…è®¿é—®å…¶å­—æ®µï¼ˆé™¤éæœ‰å…¶ä»–åŒæ­¥æªæ–½ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒæ­¥æ–¹æ³• vs éåŒæ­¥æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸€ä¸ªå¯¹è±¡çš„ &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œå®ƒè·å–çš„æ˜¯&lt;strong&gt;è¯¥å¯¹è±¡å®ä¾‹çš„é”&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ­£å¸¸è°ƒç”¨è¯¥å¯¹è±¡çš„&lt;strong&gt;é &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•&lt;/strong&gt;ã€‚å¦‚æœè¿™äº›éåŒæ­¥æ–¹æ³•ç›´æ¥è®¿é—®äº†å…±äº«æ•°æ®ï¼Œå¯èƒ½ä¼šå¼•å‘æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸åŒçš„é”å¯¹è±¡äº’ä¸å¹²æ‰°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯&lt;strong&gt;åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹&lt;/strong&gt;ï¼Œé‚£ä¹ˆå®ƒä»¬æ— æ³•åŒæ—¶è¿›å…¥è¯¥å¯¹è±¡çš„ä¸¤ä¸ªä¸åŒçš„ &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•æˆ–ä»£ç å—ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯&lt;strong&gt;ä¸åŒçš„å¯¹è±¡å®ä¾‹&lt;/strong&gt;ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥åŒæ—¶è¿›å…¥åŒä¸€ &lt;code&gt;synchronized&lt;/code&gt;æ–¹æ³•ï¼Œå› ä¸ºè·å–çš„æ˜¯å„è‡ªå¯¹è±¡çš„é”ï¼Œäº’ä¸å¹²æ‰°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»é” (Class Lock) ä¸å®ä¾‹é” (Instance Lock)&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;synchronized&lt;/code&gt;ä¿®é¥°é™æ€æ–¹æ³•æˆ–æŒ‡å®š &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡æ—¶ï¼Œè·å–çš„æ˜¯&lt;strong&gt;ç±»é”&lt;/strong&gt;ã€‚ç±»é”å’Œå®ä¾‹é”æ˜¯&lt;strong&gt;ä¸åŒçš„é”&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å› æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªå¯¹è±¡çš„å®ä¾‹é”æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–è¯¥ç±»çš„ç±»é”å»æ‰§è¡Œé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸¤è€…ä¸ä¼šäº’æ–¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-10"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡å°‘åŒæ­¥èŒƒå›´&lt;/strong&gt;ï¼šä¸ºäº†æé«˜å¹¶å‘æ€§èƒ½ï¼Œåº”å°½é‡&lt;strong&gt;å‡å°åŒæ­¥ä»£ç å—çš„èŒƒå›´&lt;/strong&gt;ï¼Œåªå¯¹çœŸæ­£éœ€è¦çº¿ç¨‹å®‰å…¨çš„ä»£ç åŠ é”ã€‚é¿å…å°†æ•´ä¸ªæ–¹æ³•æˆ–å¤§é‡æ“ä½œä¸åŠ åŒºåˆ†åœ°åŒæ­¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°¨æ…é€‰æ‹©é”å¯¹è±¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é€šå¸¸ä½¿ç”¨ &lt;code&gt;private final&lt;/code&gt;å¯¹è±¡ä½œä¸ºé”ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final Object lock = new Object();
...
synchronized(lock) { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¿å…ä½¿ç”¨ &lt;code&gt;String&lt;/code&gt;å­—é¢é‡æˆ–å¯èƒ½è¢«é‡ç”¨çš„å¯¹è±¡ä½œä¸ºé”ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åœ¨æœªçŸ¥çš„åœ°æ–¹è¢«å…±äº«ï¼Œå¯¼è‡´æ„å¤–çš„æ­»é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹Ÿ&lt;strong&gt;ä¸å»ºè®®ä½¿ç”¨ &lt;code&gt;synchronized(this)&lt;/code&gt;&lt;/strong&gt;ï¼Œå› ä¸ºè¿™ä¼šå°†å¯¹è±¡å®ä¾‹æœ¬èº«æš´éœ²ä¸ºé”ï¼Œå¤–éƒ¨ä»£ç ä¹Ÿå¯èƒ½åŒæ­¥æ­¤å¯¹è±¡ï¼Œå¯¼è‡´éš¾ä»¥é¢„æ–™å’Œè¯Šæ–­çš„æ­»é”é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-8"&gt;ğŸ’¡ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;synchronized&lt;/code&gt;é”å®šçš„å¯¹è±¡æœ¬èº«&lt;strong&gt;å¹¶éå®Œå…¨æ— æ³•ä½¿ç”¨&lt;/strong&gt;ï¼Œå…¶æ ¸å¿ƒè§„åˆ™æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥åªå‘ç”Ÿåœ¨ç«äº‰åŒä¸€æŠŠé”çš„çº¿ç¨‹ä¹‹é—´&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æŒæœ‰å¯¹è±¡é”æ—¶ï¼Œåªé˜»æ­¢å…¶ä»–çº¿ç¨‹&lt;strong&gt;è·å–åŒä¸€ä¸ªé”å¯¹è±¡&lt;/strong&gt;æ¥æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹è±¡çš„&lt;strong&gt;éåŒæ­¥æ–¹æ³•&lt;/strong&gt;ã€&lt;strong&gt;å…¶ä»–é”ä¿æŠ¤çš„åŒæ­¥æ–¹æ³•&lt;/strong&gt;ä»¥åŠ&lt;strong&gt;å…¶ä»–å®ä¾‹çš„æ–¹æ³•&lt;/strong&gt;é€šå¸¸éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›è§£é‡Šå’Œå›¾è¡¨èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ &lt;code&gt;synchronized&lt;/code&gt;é”çš„è¡Œä¸ºã€‚åœ¨è®¾è®¡å¤šçº¿ç¨‹ç¨‹åºæ—¶ï¼Œè¯·åŠ¡å¿…æ˜ç¡®é”çš„èŒƒå›´å’Œå¯¹è±¡ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨çš„åŒæ—¶é¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚&lt;/p&gt;
&lt;h2 id="synchronized-åŒæ­¥"&gt;synchronized åŒæ­¥
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;classA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ClassB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;a&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;synchronized&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// do something&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;b&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;xxx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®ä½ æä¾›çš„ä»£ç ï¼Œ&lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¸­å¯¹ &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡æˆå‘˜ï¼ˆ&lt;code&gt;cb.xxx = xxx&lt;/code&gt;ï¼‰çš„è®¿é—®&lt;strong&gt;ä¸ä¼šè¢«&lt;/strong&gt; &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„ &lt;code&gt;synchronized(cb)&lt;/code&gt;é”é”å®šã€‚&lt;/p&gt;
&lt;h3 id="-åŸå› åˆ†æ"&gt;ğŸ” åŸå› åˆ†æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;synchronized&lt;/code&gt;æœºåˆ¶çš„æœ¬è´¨&lt;/strong&gt;ï¼š&lt;code&gt;synchronized(obj)&lt;/code&gt;å…³é”®å­—ç”¨äºè·å–æŒ‡å®šå¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ &lt;code&gt;cb&lt;/code&gt;ï¼‰çš„&lt;strong&gt;ç›‘è§†å™¨é”ï¼ˆMonitor Lockï¼‰&lt;/strong&gt;ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¿è¯&lt;strong&gt;åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;èƒ½å¤Ÿè¿›å…¥æ‰€æœ‰ä»¥è¯¥å¯¹è±¡ (&lt;code&gt;cb&lt;/code&gt;) ä½œä¸ºé”çš„&lt;strong&gt;åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•&lt;/strong&gt;ã€‚å®ƒå¹¶ä¸ç›´æ¥é”å®šå¯¹è±¡æœ¬èº«çš„å†…å­˜è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”çš„äº’æ–¥èŒƒå›´&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚çº¿ç¨‹Aï¼‰æ­£åœ¨æ‰§è¡Œ &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„ &lt;code&gt;synchronized(cb)&lt;/code&gt;ä»£ç å—ï¼Œæ„å‘³ç€å®ƒå·²ç»æˆåŠŸè·å–äº† &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„é”ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œå¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚çº¿ç¨‹Bï¼‰è¯•å›¾æ‰§è¡Œ&lt;strong&gt;ä»»ä½•ä¹Ÿä»¥ &lt;code&gt;cb&lt;/code&gt;ä¸ºé”çš„åŒæ­¥ä»£ç å—&lt;/strong&gt;ï¼ˆä¾‹å¦‚å¦ä¸€ä¸ª &lt;code&gt;synchronized(cb)&lt;/code&gt;å—ï¼‰ï¼Œçº¿ç¨‹Bå°†ä¼šè¢«&lt;strong&gt;é˜»å¡&lt;/strong&gt;ï¼Œç›´åˆ°çº¿ç¨‹Aé‡Šæ”¾ &lt;code&gt;cb&lt;/code&gt;çš„é”ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶è€Œï¼Œä½ çš„ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¸­çš„æ“ä½œ (&lt;code&gt;cb.xxx = xxx&lt;/code&gt;) &lt;strong&gt;å¹¶æ²¡æœ‰è¢«ä»»ä½•åŒæ­¥æœºåˆ¶ä¿æŠ¤&lt;/strong&gt;ã€‚å®ƒä¸ä¼šå°è¯•å»è·å– &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„é”ã€‚å› æ­¤ï¼Œå³ä½¿çº¿ç¨‹Aæ­£æŒæœ‰ &lt;code&gt;cb&lt;/code&gt;çš„é”å¹¶åœ¨æ‰§è¡Œ &lt;code&gt;a()&lt;/code&gt;ä¸­çš„åŒæ­¥å—ï¼Œçº¿ç¨‹Bä¾ç„¶å¯ä»¥ç›´æ¥æ‰§è¡Œ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•å¹¶å¯¹ &lt;code&gt;cb&lt;/code&gt;çš„æˆå‘˜è¿›è¡Œèµ‹å€¼ï¼Œ&lt;strong&gt;ä¸ä¼šå‘ç”Ÿé˜»å¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;b()&lt;/code&gt;ä¸­çš„è®¿é—®ä¸ä¼šè¢«é˜»å¡ï¼Œä½†è¿™ç§è®¾è®¡ä¼šå¸¦æ¥ä¸¥é‡çš„&lt;strong&gt;çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„åŒæ­¥å—æ­£åœ¨è¯»å–æˆ–ä¿®æ”¹ &lt;code&gt;cb&lt;/code&gt;çš„æŸäº›çŠ¶æ€ï¼Œè€ŒåŒæ—¶ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¹Ÿåœ¨å¹¶å‘åœ°ä¿®æ”¹ &lt;code&gt;cb&lt;/code&gt;çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™äº›æ“ä½œå¯èƒ½ä¼šäº¤å‰è¿›è¡Œï¼Œå¯¼è‡´æœ€ç»ˆç»“æœä¸å¯é¢„æµ‹ï¼Œç ´åæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§æ€§ï¼ˆVisibilityï¼‰&lt;/strong&gt;ï¼šå³ä½¿ &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•åœ¨åŒæ­¥å—å†…ä¿®æ”¹äº† &lt;code&gt;cb&lt;/code&gt;çš„çŠ¶æ€ï¼Œè¿™äº›ä¿®æ”¹å¯èƒ½ä¸ä¼šç«‹å³å¯¹å…¶ä»–çº¿ç¨‹ï¼ˆä¾‹å¦‚è°ƒç”¨ &lt;code&gt;b()&lt;/code&gt;çš„çº¿ç¨‹ï¼‰å¯è§ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ²¡æœ‰æ­£ç¡®åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å¯èƒ½ä¼šç¼“å­˜å˜é‡çš„å‰¯æœ¬ã€‚&lt;code&gt;synchronized&lt;/code&gt;å…³é”®å­—é™¤äº†ä¿è¯åŸå­æ€§ï¼Œè¿˜èƒ½ä¿è¯å¯è§æ€§â€”â€”å½“çº¿ç¨‹é€€å‡ºåŒæ­¥å—æ—¶ï¼Œä¼šå¼ºåˆ¶å°†å·¥ä½œå†…å­˜ä¸­çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼›å½“çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­ç›¸åº”å˜é‡çš„å€¼ï¼Œä»ä¸»å†…å­˜é‡æ–°è¯»å–ã€‚è€Œ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ç¼ºä¹è¿™ç§ä¿éšœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨"&gt;ğŸ’¡ å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨
&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ éœ€è¦ç¡®ä¿å¯¹ &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„æ‰€æœ‰è®¿é—®éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€é”æœºåˆ¶ï¼ˆæ¨èï¼‰&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;classA&lt;/code&gt;å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª&lt;strong&gt;ä¸“ç”¨çš„ã€æœ€ç»ˆçš„é”å¯¹è±¡&lt;/strong&gt;æ¥ä¿æŠ¤æ‰€æœ‰å¯¹ &lt;code&gt;cb&lt;/code&gt;çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class classA {
private ClassB cb;
private final Object lock = new Object(); // ä¸“ç”¨çš„é”å¯¹è±¡
void a() {
synchronized(lock) { // ä½¿ç”¨ç»Ÿä¸€çš„é”
// å®‰å…¨åœ°æ“ä½œ cb
}
}
void b() {
synchronized(lock) { // ä½¿ç”¨åŒä¸€ä¸ªé”
cb.xxx = xxx; // ç°åœ¨å®‰å…¨äº†
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·ï¼Œæ— è®ºæ˜¯ &lt;code&gt;a()&lt;/code&gt;è¿˜æ˜¯ &lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ï¼Œè¦è®¿é—® &lt;code&gt;cb&lt;/code&gt;éƒ½å¿…é¡»å…ˆè·å¾— &lt;code&gt;lock&lt;/code&gt;è¿™ä¸ªå”¯ä¸€çš„é”ï¼Œä»è€Œå®ç°äº†äº’æ–¥è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®© &lt;code&gt;ClassB&lt;/code&gt;æˆä¸ºçº¿ç¨‹å®‰å…¨ç±»&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;ClassB&lt;/code&gt;çš„å†…éƒ¨å®ç°ä¸­ï¼Œé€šè¿‡åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—æ¥ä¿è¯å…¶è‡ªèº«çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨ã€‚è¿™æ ·ï¼Œå¤–éƒ¨è°ƒç”¨æ—¶å³ä½¿æ²¡æœ‰åŒæ­¥ï¼Œå…¶æ–¹æ³•ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-9"&gt;âœ… æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ä¸€å¥è¯å›ç­”ï¼š&lt;strong&gt;ä¸ä¼šé”å®š&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;b()&lt;/code&gt;æ–¹æ³•ä¸­å¯¹ &lt;code&gt;cb.xxx&lt;/code&gt;çš„èµ‹å€¼æ“ä½œä¸ä¼šå› ä¸º &lt;code&gt;a()&lt;/code&gt;æ–¹æ³•ä¸­çš„ &lt;code&gt;synchronized(cb)&lt;/code&gt;è€Œé˜»å¡ï¼Œå› ä¸ºå®ƒæ ¹æœ¬æ²¡æœ‰å°è¯•å»è·å– &lt;code&gt;cb&lt;/code&gt;å¯¹è±¡çš„é”ã€‚è¿™ç§è®¾è®¡å­˜åœ¨æ•°æ®ç«äº‰å’Œå¯è§æ€§é—®é¢˜ã€‚è‹¥è¦å®ç°çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦å¯¹æ‰€æœ‰è®¿é—® &lt;code&gt;cb&lt;/code&gt;å…±äº«èµ„æºçš„ä»£ç è·¯å¾„è¿›è¡Œé€‚å½“çš„åŒæ­¥ã€‚&lt;/p&gt;
&lt;h2 id="profile-active"&gt;@profile-active@
&lt;/h2&gt;&lt;p&gt;ã€‚åœ¨ä½ æœ¬åœ°è¿è¡Œæ—¶ï¼Œ&lt;code&gt;@profile-active@&lt;/code&gt;è‡ªåŠ¨å˜æˆ &lt;code&gt;local&lt;/code&gt;ï¼Œè¿™é€šå¸¸æ˜¯ &lt;strong&gt;Maven çš„èµ„æºé…ç½®è¿‡æ»¤ï¼ˆResource Filteringï¼‰åŠŸèƒ½&lt;/strong&gt; å’Œ &lt;strong&gt;Spring Boot çš„ Profile æœºåˆ¶&lt;/strong&gt; å…±åŒä½œç”¨çš„ç»“æœã€‚ä¸‹é¢æˆ‘æ¥è§£é‡Šä¸€ä¸‹åŸå› å’Œè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶maven-èµ„æºè¿‡æ»¤"&gt;ğŸ› ï¸ &lt;strong&gt;æ ¸å¿ƒæœºåˆ¶ï¼šMaven èµ„æºè¿‡æ»¤&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Maven åœ¨ç¼–è¯‘é¡¹ç›®æ—¶ï¼ˆä¾‹å¦‚æ‰§è¡Œ &lt;code&gt;mvn compile&lt;/code&gt;æˆ– &lt;code&gt;mvn package&lt;/code&gt;ï¼‰ï¼Œå¦‚æœå¼€å¯äº†èµ„æºè¿‡æ»¤ï¼ˆFilteringï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç† &lt;code&gt;src/main/resources&lt;/code&gt;ç›®å½•ä¸‹çš„æŸäº›æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å ä½ç¬¦ï¼ˆä¾‹å¦‚ &lt;code&gt;@propertyName@&lt;/code&gt;æˆ– &lt;code&gt;${propertyName}&lt;/code&gt;ï¼‰æ›¿æ¢ä¸º POM æ–‡ä»¶ä¸­å®šä¹‰çš„å¯¹åº”å±æ€§çš„å®é™…å€¼ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;POM æ–‡ä»¶ä¸­çš„ Profiles é…ç½®&lt;/strong&gt;ï¼šä½ çš„é¡¹ç›® POM æ–‡ä»¶ï¼ˆ&lt;code&gt;pom.xml&lt;/code&gt;ï¼‰ä¸­å¾ˆå¯èƒ½å®šä¹‰äº†å¤šä¸ª Maven Profilesï¼Œä¾‹å¦‚æœ¬åœ°å¼€å‘ï¼ˆlocalï¼‰ã€æµ‹è¯•ç¯å¢ƒï¼ˆtestï¼‰ã€ç”Ÿäº§ç¯å¢ƒï¼ˆprodï¼‰ç­‰ã€‚è¿™äº› Profiles å¯ä»¥ç”¨æ¥åœ¨æ„å»ºæ—¶æŒ‡å®šä¸åŒçš„é…ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;profiles&amp;gt;
&amp;lt;profile&amp;gt;
&amp;lt;!-- æœ¬åœ°å¼€å‘ç¯å¢ƒ --&amp;gt;
&amp;lt;id&amp;gt;local&amp;lt;/id&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;!-- å®šä¹‰äº†ä¸€ä¸ªåä¸º profiles.active çš„å±æ€§ï¼Œå…¶å€¼ä¸º local --&amp;gt;
&amp;lt;profiles.active&amp;gt;local&amp;lt;/profiles.active&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;activation&amp;gt;
&amp;lt;!-- è®¾ç½®è¯¥ profile ä¸ºé»˜è®¤æ¿€æ´» --&amp;gt;
&amp;lt;activeByDefault&amp;gt;true&amp;lt;/activeByDefault&amp;gt;
&amp;lt;/activation&amp;gt;
&amp;lt;/profile&amp;gt;
&amp;lt;profile&amp;gt;
&amp;lt;!-- æµ‹è¯•ç¯å¢ƒ --&amp;gt;
&amp;lt;id&amp;gt;test&amp;lt;/id&amp;gt;
&amp;lt;properties&amp;gt;
&amp;lt;profiles.active&amp;gt;test&amp;lt;/profiles.active&amp;gt;
&amp;lt;/properties&amp;gt;
&amp;lt;/profile&amp;gt;
&amp;lt;!-- å¯èƒ½è¿˜æœ‰å…¶ä»–ç¯å¢ƒé…ç½® --&amp;gt;
&amp;lt;/profiles&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»æœç´¢ç»“æœæ¥çœ‹ï¼Œ&lt;code&gt;local&lt;/code&gt;Profile é€šå¸¸è¢«è®¾ç½®ä¸º &lt;code&gt;&amp;lt;activeByDefault&amp;gt;true&amp;lt;/activeByDefault&amp;gt;&lt;/code&gt;ï¼Œè¿™æ„å‘³ç€å¦‚æœæ²¡æœ‰é€šè¿‡ &lt;code&gt;-P&lt;/code&gt;å‚æ•°æ˜¾å¼æŒ‡å®šå…¶ä»– Profileï¼ŒMaven å°±ä¼šä½¿ç”¨ &lt;code&gt;local&lt;/code&gt;è¿™ä¸ª Profile çš„é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºè¿‡æ»¤çš„é…ç½®&lt;/strong&gt;ï¼šä¸ºäº†è®© Maven åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ›¿æ¢é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦ï¼Œéœ€è¦åœ¨ POM æ–‡ä»¶çš„ &lt;code&gt;&amp;lt;build&amp;gt;&lt;/code&gt;éƒ¨åˆ†é…ç½®èµ„æºè¿‡æ»¤ï¼Œå¹¶å¼€å¯ &lt;code&gt;filtering&lt;/code&gt;é€‰é¡¹ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;build&amp;gt;
&amp;lt;resources&amp;gt;
&amp;lt;resource&amp;gt;
&amp;lt;directory&amp;gt;src/main/resources&amp;lt;/directory&amp;gt;
&amp;lt;filtering&amp;gt;true&amp;lt;/filtering&amp;gt; &amp;lt;!-- å…³é”®ï¼šå¼€å¯è¿‡æ»¤ --&amp;gt;
&amp;lt;includes&amp;gt;
&amp;lt;include&amp;gt;application.yml&amp;lt;/include&amp;gt; &amp;lt;!-- æŒ‡å®šéœ€è¦è¿‡æ»¤çš„æ–‡ä»¶ --&amp;gt;
&amp;lt;!-- å¯èƒ½è¿˜åŒ…æ‹¬å…¶ä»–é…ç½®æ–‡ä»¶ --&amp;gt;
&amp;lt;/includes&amp;gt;
&amp;lt;/resource&amp;gt;
&amp;lt;/resources&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å ä½ç¬¦çš„åŒ¹é…&lt;/strong&gt;ï¼šä½ çš„ &lt;code&gt;application.yml&lt;/code&gt;æ–‡ä»¶ä¸­åŒ…å«äº† &lt;code&gt;'@profile-active@'&lt;/code&gt;ï¼ˆæœç´¢ç»“æœä¸­å¤šä¸º &lt;code&gt;@profiles.active@&lt;/code&gt;ï¼Œä½†æœºåˆ¶ç›¸åŒï¼‰ã€‚Maven åœ¨å¤„ç†è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šæŸ¥æ‰¾ POM ä¸­å½“å‰æ¿€æ´»çš„ Profile é‡Œå®šä¹‰çš„å±æ€§ã€‚ç”±äºé»˜è®¤æ¿€æ´»çš„æ˜¯ &lt;code&gt;local&lt;/code&gt;Profileï¼Œä¸”è¯¥ Profile å®šä¹‰äº† &lt;code&gt;&amp;lt;profiles.active&amp;gt;local&amp;lt;/profiles.active&amp;gt;&lt;/code&gt;ï¼ŒMaven å°±ä¼šç”¨ &lt;code&gt;local&lt;/code&gt;è¿™ä¸ªå€¼å»æ›¿æ¢ &lt;code&gt;@profile-active@&lt;/code&gt;è¿™ä¸ªå ä½ç¬¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-spring-boot-çš„é…åˆ"&gt;ğŸ”§ &lt;strong&gt;Spring Boot çš„é…åˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Spring Boot åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œä¼šè¯»å– &lt;code&gt;application.yml&lt;/code&gt;ä¸­ &lt;code&gt;spring.profiles.active&lt;/code&gt;çš„å€¼æ¥ç¡®å®šåº”è¯¥æ¿€æ´»å“ªä¸ªæˆ–å“ªäº›Spring Profileã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»è¿‡ Maven èµ„æºè¿‡æ»¤åï¼Œä½ çš„é…ç½®å®é™…ä¸Šå˜æˆäº†ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
profiles:
active: &amp;#39;local&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› æ­¤ï¼ŒSpring Boot åº”ç”¨å°±ä¼šä½¿ç”¨ &lt;code&gt;application-local.yml&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;application-local.properties&lt;/code&gt;ï¼‰ç­‰é’ˆå¯¹æœ¬åœ°ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶åŠ è½½å…¶ä¸­å®šä¹‰çš„å±æ€§ã€Bean ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-ä¸åŒç¯å¢ƒçš„æ„å»ºä¸é…ç½®æ›¿æ¢"&gt;ğŸ“Š &lt;strong&gt;ä¸åŒç¯å¢ƒçš„æ„å»ºä¸é…ç½®æ›¿æ¢&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸‹è¡¨æ¦‚æ‹¬äº†ä¸åŒ Maven Profile å¦‚ä½•å½±å“æœ€ç»ˆçš„ Spring Profileï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Maven Profile (é€šè¿‡ &lt;code&gt;-P&lt;/code&gt;æŒ‡å®š)&lt;/th&gt;
&lt;th&gt;Maven å±æ€§ &lt;code&gt;profiles.active&lt;/code&gt;çš„å€¼&lt;/th&gt;
&lt;th&gt;æœ€ç»ˆ &lt;code&gt;spring.profiles.active&lt;/code&gt;çš„å€¼&lt;/th&gt;
&lt;th&gt;Spring Boot åŠ è½½çš„é…ç½®æ–‡ä»¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;(ä¸æŒ‡å®šï¼Œä½¿ç”¨é»˜è®¤)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local&lt;/code&gt;(ç”± &lt;code&gt;&amp;lt;activeByDefault&amp;gt;&lt;/code&gt;æŒ‡å®š)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;local&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application-local.yml&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-P test&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application-test.yml&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-P prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;prod&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application-prod.yml&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-11"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¡®ä¿èµ„æºè¿‡æ»¤å·²å¼€å¯&lt;/strong&gt;ï¼šæ£€æŸ¥ä½ çš„ &lt;code&gt;pom.xml&lt;/code&gt;ï¼Œç¡®è®¤åœ¨ &lt;code&gt;&amp;lt;build&amp;gt;&amp;lt;resources&amp;gt;&lt;/code&gt;ä¸­ä¸ºåŒ…å« &lt;code&gt;application.yml&lt;/code&gt;çš„ç›®å½•è®¾ç½®äº† &lt;code&gt;&amp;lt;filtering&amp;gt;true&amp;lt;/filtering&amp;gt;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Parent POM çš„ä½¿ç”¨&lt;/strong&gt;ï¼šå¦‚æœä½ çš„é¡¹ç›®ç»§æ‰¿äº† &lt;code&gt;spring-boot-starter-parent&lt;/code&gt;ï¼Œå®ƒå·²ç»é¢„é…ç½®äº†ä¸€äº›èµ„æºè¿‡æ»¤è§„åˆ™ï¼Œè¿™é€šå¸¸ä¼šç®€åŒ–ä½ çš„é…ç½®å¹¶ç¡®ä¿è¿‡æ»¤æ­£å¸¸å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œè¦†ç›–&lt;/strong&gt;ï¼šå³ä½¿åœ¨ &lt;code&gt;pom.xml&lt;/code&gt;ä¸­è®¾ç½®äº†é»˜è®¤å€¼ï¼Œä½ åœ¨é€šè¿‡ &lt;code&gt;mvn&lt;/code&gt;å‘½ä»¤æ‰“åŒ…æ—¶ä»ç„¶å¯ä»¥ä½¿ç”¨ &lt;code&gt;-P&lt;/code&gt;å‚æ•°æ¥è¦†ç›–é»˜è®¤çš„ Profileï¼Œä¾‹å¦‚ &lt;code&gt;mvn clean package -P test&lt;/code&gt;ï¼Œè¿™æ ·æœ€ç»ˆç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¸­ &lt;code&gt;@profile-active@&lt;/code&gt;å°±ä¼šè¢«æ›¿æ¢ä¸º &lt;code&gt;test&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;@profile-active@&lt;/code&gt;è‡ªåŠ¨å˜æˆ &lt;code&gt;local&lt;/code&gt;ï¼Œæ˜¯å› ä¸º Maven åœ¨æ„å»ºæ—¶ï¼Œæ ¹æ®å…¶ POM æ–‡ä»¶ä¸­é»˜è®¤æ¿€æ´»çš„ &lt;code&gt;local&lt;/code&gt;Profile é‡Œå®šä¹‰çš„å±æ€§å€¼ï¼Œå¯¹è¿™ä¸ªå ä½ç¬¦è¿›è¡Œäº†è‡ªåŠ¨æ›¿æ¢ã€‚è¿™æ˜¯å®ç° &lt;strong&gt;ä¸åŒç¯å¢ƒå·®å¼‚åŒ–æ„å»º&lt;/strong&gt; çš„ä¸€ç§å¸¸è§æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id="applicationcontextinitializer"&gt;ApplicationContextInitializer
&lt;/h2&gt;&lt;p&gt;ApplicationContextInitializer æŠ›å‡ºå¼‚å¸¸å¯¼è‡´ç¨‹åºå¯åŠ¨å¤±è´¥ï¼Œæ˜¯å› ä¸ºå®ƒåœ¨ Spring Boot å¯åŠ¨æµç¨‹ä¸­æ‰®æ¼”ç€â€œå¼€è·¯å…ˆé”‹â€çš„è§’è‰²ã€‚å®ƒä¸€æ—¦å‡ºé”™ï¼Œåç»­çš„å®¹å™¨åˆå§‹åŒ–å·¥ä½œå°±æ— æ³•ç»§ç»­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¸®åŠ©ä½ æ›´ç›´è§‚åœ°ç†è§£å®ƒåœ¨æ•´ä¸ªå¯åŠ¨æµç¨‹ä¸­çš„å…³é”®ä½ç½®ï¼Œä»¥åŠä¸ºä½•å®ƒçš„å¼‚å¸¸å¦‚æ­¤è‡´å‘½ï¼Œè¯·çœ‹ä¸‹é¢çš„æµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;flowchart TD
A[SpringApplication.run()] --&amp;gt; B[åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ Context]
B --&amp;gt; C[æ‰§è¡Œ ApplicationContextInitializer&amp;lt;br&amp;gt;ï¼ˆåˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼‰]
C --&amp;gt; D{åˆå§‹åŒ–å™¨æ‰§è¡ŒæˆåŠŸ?}
D -- æ˜¯ --&amp;gt; E[åŠ è½½é…ç½®/Beanå®šä¹‰ç­‰]
E --&amp;gt; F[åˆ·æ–°ä¸Šä¸‹æ–‡&amp;lt;br&amp;gt;ï¼ˆIoCå®¹å™¨åˆå§‹åŒ–ï¼‰]
F --&amp;gt; G[åº”ç”¨å¯åŠ¨æˆåŠŸ]
D -- å¦&amp;lt;br&amp;gt;ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ --&amp;gt; H[å¯åŠ¨æµç¨‹ä¸­æ–­]
H --&amp;gt; I[åº”ç”¨å¯åŠ¨å¤±è´¥]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„æ‰§è¡Œæ˜¯ä¸Šä¸‹æ–‡å‡†å¤‡å°±ç»ªåã€å®¹å™¨åˆ·æ–°å‰çš„ä¸€ä¸ª&lt;strong&gt;å…³é”®æ­¥éª¤&lt;/strong&gt;ã€‚è¿™ä¸ªé˜¶æ®µå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ•´ä¸ªå¯åŠ¨æµç¨‹å°±ä¼šä¸­æ–­ã€‚&lt;/p&gt;
&lt;h3 id="-å¼‚å¸¸å¸¦æ¥çš„å…·ä½“å½±å“"&gt;âš ï¸ å¼‚å¸¸å¸¦æ¥çš„å…·ä½“å½±å“
&lt;/h3&gt;&lt;p&gt;å½“ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„ &lt;code&gt;initialize&lt;/code&gt;æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šäº§ç”Ÿä»¥ä¸‹è¿é”ååº”ï¼Œå¯¼è‡´å¯åŠ¨å¤±è´¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸­æ–­åˆå§‹åŒ–æµç¨‹&lt;/strong&gt;ï¼šSpring Boot çš„å¯åŠ¨è¿‡ç¨‹æ˜¯é¡ºåºçš„ã€ä¸¥æ ¼çš„ã€‚&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„åˆå§‹åŒ–æ˜¯ &lt;code&gt;prepareContext&lt;/code&gt;é˜¶æ®µçš„ä¸€éƒ¨åˆ†ï¼Œæ­¤é˜¶æ®µçš„å¼‚å¸¸ä¼šç›´æ¥å¯¼è‡´åç»­æ›´æ ¸å¿ƒçš„ &lt;code&gt;refreshContext&lt;/code&gt;ï¼ˆåˆ·æ–°å®¹å™¨ï¼‰æ–¹æ³•æ— æ³•æ‰§è¡Œã€‚ æ²¡æœ‰ç»è¿‡æ­£ç¡®åˆ·æ–°å’Œåˆå§‹åŒ–çš„ &lt;code&gt;ApplicationContext&lt;/code&gt;æ˜¯ä¸€ä¸ªä¸å®Œæ•´ã€æ— æ³•ä½¿ç”¨çš„å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç ´åä¸Šä¸‹æ–‡ä¸€è‡´æ€§&lt;/strong&gt;ï¼š&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;çš„æœ¬èŒå·¥ä½œæ˜¯åœ¨å®¹å™¨åˆ·æ–°å‰å¯¹å…¶è¿›è¡Œâ€œä¿®é¥°â€ï¼Œä¾‹å¦‚è®¾ç½®ç¯å¢ƒå˜é‡ã€æ³¨å†Œè‡ªå®šä¹‰çš„ Bean å®šä¹‰æˆ–å±æ€§æºã€‚ å¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¸­é€”å¤±è´¥ï¼Œå¯èƒ½ä¼šä½¿åº”ç”¨ä¸Šä¸‹æ–‡å¤„äºä¸€ä¸ª&lt;strong&gt;ä¸ä¸€è‡´çš„çŠ¶æ€&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼ŒæŸäº›é…ç½®å·²åŠ è½½ï¼Œè€Œå¦ä¸€äº›åˆ™æ²¡æœ‰ï¼‰ã€‚Spring ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¼šé€‰æ‹©è®©å¯åŠ¨å¤±è´¥ï¼Œè€Œä¸æ˜¯å°è¯•æ¢å¤åˆ°ä¸€ä¸ªæœªçŸ¥çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§¦å‘å¯åŠ¨ç›‘å¬å™¨é“¾çš„å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šSpring Boot é€šè¿‡ &lt;code&gt;SpringApplicationRunListener&lt;/code&gt;æ¥å¹¿æ’­å¯åŠ¨è¿‡ç¨‹ä¸­çš„å„ä¸ªäº‹ä»¶ã€‚ å½“ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œ&lt;code&gt;finished&lt;/code&gt;äº‹ä»¶ä¼šæ¥æ”¶åˆ°è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼Œç»§è€Œè§¦å‘æ•´ä¸ªåº”ç”¨çš„å¯åŠ¨å¤±è´¥å¤„ç†é€»è¾‘ï¼Œå¹¶æ‰“å°å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-å¸¸è§çš„å¼‚å¸¸åŸå› åŠæ’æŸ¥å»ºè®®"&gt;ğŸ” å¸¸è§çš„å¼‚å¸¸åŸå› åŠæ’æŸ¥å»ºè®®
&lt;/h3&gt;&lt;p&gt;äº†è§£åŸå› åï¼Œæ’æŸ¥é—®é¢˜å°±æœ‰äº†æ–¹å‘ã€‚&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;ä¸­å¯èƒ½å¼•å‘å¯åŠ¨å¤±è´¥çš„å¼‚å¸¸é€šå¸¸åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®é”™è¯¯ï¼ˆ&lt;code&gt;IllegalStateException&lt;/code&gt;, &lt;code&gt;BeanDefinitionStoreException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨åˆå§‹åŒ–å™¨ä¸­å°è¯•æ³¨å†Œ Bean å®šä¹‰æˆ–è®¿é—®é…ç½®æ—¶ï¼Œé…ç½®ä¿¡æ¯ä¸æ­£ç¡®ã€ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œé”™è¯¯ä¿¡æ¯å¯èƒ½æåŠ &lt;code&gt;Failed to load ApplicationContext&lt;/code&gt;æˆ–å±æ€§é…ç½®é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šä»”ç»†æ£€æŸ¥åˆå§‹åŒ–å™¨ä¸­ä½¿ç”¨çš„æ‰€æœ‰é…ç½®å±æ€§ã€ç±»è·¯å¾„èµ„æºå’Œç¯å¢ƒå˜é‡ã€‚ç¡®ä¿åœ¨åˆå§‹åŒ–å™¨æ‰§è¡Œæ—¶ï¼Œå…¶æ‰€ä¾èµ–çš„å¤–éƒ¨é…ç½®å·²æ­£ç¡®åŠ è½½ä¸”å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç±»åŠ è½½æˆ–ä¾èµ–é—®é¢˜ï¼ˆ&lt;code&gt;NoClassDefFoundError&lt;/code&gt;, &lt;code&gt;ClassNotFoundException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåˆå§‹åŒ–å™¨ä»£ç ä¸­å¼•ç”¨äº†æŸä¸ªç±»ï¼Œä½†è¯¥ç±»åœ¨ç±»è·¯å¾„ä¸­ä¸å­˜åœ¨ï¼Œæˆ–è€…å…¶ä¾èµ–çš„ Jar åŒ…æœªè¢«æ­£ç¡®å¼•å…¥ã€‚è¿™åœ¨é¡¹ç›®å‡çº§æˆ–ä¾èµ–ç‰ˆæœ¬å˜æ›´æ—¶å°¤å…¶å¸¸è§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šç¡®è®¤é¡¹ç›®ä¾èµ–ï¼ˆå¦‚ Maven æˆ– Gradle é…ç½®ï¼‰çš„å®Œæ•´æ€§å’Œç‰ˆæœ¬å…¼å®¹æ€§ã€‚æ£€æŸ¥æ‰“åŒ…åçš„äº§ç‰©ä¸­æ˜¯å¦åŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ Jar åŒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Bean å®šä¹‰æˆ–ä¾èµ–æ³¨å…¥é—®é¢˜ï¼ˆ&lt;code&gt;BeanCreationException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šè™½ç„¶è¾ƒå°‘ç›´æ¥åœ¨ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;ä¸­å‘ç”Ÿï¼Œä½†å¦‚æœåˆå§‹åŒ–å™¨å°è¯•è¿‡æ—©åœ°é€šè¿‡ä¸Šä¸‹æ–‡è·å–ä¸€ä¸ªå°šæœªå®Œæˆé…ç½®æˆ–å­˜åœ¨å¾ªç¯ä¾èµ–ç­‰é—®é¢˜çš„ Beanï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šå®¡è§†åˆå§‹åŒ–å™¨çš„é€»è¾‘ï¼Œé¿å…åœ¨ &lt;code&gt;initialize&lt;/code&gt;æ–¹æ³•ä¸­è¿‡æ—©åœ°è·å– Bean å®ä¾‹ã€‚ç¡®ä¿ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¸…æ™°ï¼Œæ— å¾ªç¯ä¾èµ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¨‹åºé€»è¾‘é”™è¯¯ï¼ˆå„ç§ &lt;code&gt;RuntimeException&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåˆå§‹åŒ–å™¨è‡ªèº«çš„ä»£ç å­˜åœ¨ Bugï¼Œä¾‹å¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ã€æ•°ç»„è¶Šç•Œã€IO å¼‚å¸¸ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥&lt;/strong&gt;ï¼šå¯¹åˆå§‹åŒ–å™¨ä¸­çš„ä»£ç è¿›è¡Œä»”ç»†çš„ä»£ç å®¡æŸ¥å’Œè°ƒè¯•ã€‚æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿è·Ÿè¸ªæ‰§è¡Œæµç¨‹å’Œå˜é‡çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•è°ƒè¯•å’Œå®šä½é—®é¢˜"&gt;ğŸ’¡ å¦‚ä½•è°ƒè¯•å’Œå®šä½é—®é¢˜
&lt;/h3&gt;&lt;p&gt;å½“é‡åˆ°å›  &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;å¯¼è‡´çš„å¯åŠ¨å¤±è´¥æ—¶ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥çœ‹å®Œæ•´å †æ ˆè·Ÿè¸ª&lt;/strong&gt;ï¼šæ§åˆ¶å°è¾“å‡ºçš„å¼‚å¸¸ä¿¡æ¯æ˜¯é¦–è¦çº¿ç´¢ï¼Œå®ƒé€šå¸¸ä¼šæ˜ç¡®æŒ‡å‡ºå¼‚å¸¸ç±»å‹å’Œé¦–æ¬¡å‘ç”Ÿçš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨è°ƒè¯•æ¨¡å¼&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ  &lt;code&gt;--debug&lt;/code&gt;å‚æ•°ï¼Œæˆ–è®¾ç½®æ—¥å¿—çº§åˆ« &lt;code&gt;logging.level.org.springframework=DEBUG&lt;/code&gt;ï¼ŒSpring Boot ä¼šè¾“å‡ºæ›´è¯¦ç»†çš„å†…éƒ¨æ‰§è¡Œä¿¡æ¯ï¼Œå¸®åŠ©ä½ å®šä½é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥åˆå§‹åŒ–å™¨ä»£ç &lt;/strong&gt;ï¼šé‡ç‚¹å…³æ³¨ä½ è‡ªå·±çš„ &lt;code&gt;ApplicationContextInitializer&lt;/code&gt;å®ç°ä¸­çš„ &lt;code&gt;initialize&lt;/code&gt;æ–¹æ³•ï¼Œé€è¡Œæ£€æŸ¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥ä¾èµ–å’Œé…ç½®&lt;/strong&gt;ï¼šç¡®è®¤æ‰€æœ‰ç›¸å…³ä¾èµ–å·²æ­£ç¡®å¼•å…¥ï¼Œä¸”ç‰ˆæœ¬å…¼å®¹ã€‚æ£€æŸ¥ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;ç­‰é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æµ‹è¯•&lt;/strong&gt;ï¼šå¦‚æœå¯èƒ½ï¼Œå°è¯•å°†å¯ç–‘çš„åˆå§‹åŒ–å™¨æš‚æ—¶ç§»é™¤æˆ–æ³¨é‡Šæ‰ï¼Œçœ‹åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸å¯åŠ¨ï¼Œä»¥æ­¤åˆ¤æ–­é—®é¢˜æ˜¯å¦ç”±è¯¥åˆå§‹åŒ–å™¨å¼•èµ·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œ&lt;code&gt;ApplicationContextInitializer&lt;/code&gt;å°±åƒæ˜¯ Spring Boot åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„ä¸€ä¸ª&lt;strong&gt;å…³é”®è´¨æ£€å‘˜&lt;/strong&gt;ï¼Œå®ƒçš„å·¥ä½œå¿…é¡»åœ¨ç”Ÿäº§çº¿ï¼ˆå®¹å™¨åˆ·æ–°ï¼‰å…¨é¢å¯åŠ¨å‰å®Œæˆã€‚ä¸€æ—¦è´¨æ£€å‘˜å‘ç°é‡å¤§é—®é¢˜å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ºäº†æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨ä¸ç¨³å®šï¼Œç”Ÿäº§çº¿å°±ä¸ä¼šè¢«å¯åŠ¨ã€‚&lt;/p&gt;
&lt;h2 id="ping"&gt;ping
&lt;/h2&gt;&lt;p&gt;æ ¹æ®æœç´¢ç»“æœï¼Œæ ‡å‡†çš„ &lt;code&gt;ping&lt;/code&gt;å‘½ä»¤&lt;strong&gt;ä¸èƒ½&lt;/strong&gt;ç”¨äºæ£€æµ‹å•ç‹¬çš„ç«¯å£ã€‚&lt;code&gt;ping&lt;/code&gt;å‘½ä»¤åŸºäº ICMP åè®®å·¥ä½œï¼Œè¯¥åè®®ä½äºç½‘ç»œå±‚ï¼Œåªèƒ½æµ‹è¯•åˆ°ç›®æ ‡IPåœ°å€çš„ç½‘ç»œè¿é€šæ€§ï¼Œè€Œç«¯å£å±äºä¼ è¾“å±‚çš„æ¦‚å¿µï¼Œå› æ­¤ &lt;code&gt;ping&lt;/code&gt;æ— æ³•ç›´æ¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œæœ‰è®¸å¤šå…¶ä»–ä¸“é—¨ç”¨äºæµ‹è¯•ç«¯å£è¿é€šæ€§çš„å·¥å…·å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ä¸‹è¡¨æ±‡æ€»äº†è¿™äº›å¸¸ç”¨çš„æ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å·¥å…·åç§°&lt;/th&gt;
&lt;th&gt;åŸºæœ¬å‘½ä»¤æ ¼å¼&lt;/th&gt;
&lt;th&gt;ä¸»è¦ç‰¹ç‚¹ / è¾“å‡ºè¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;telnet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;telnet &amp;lt;ç›®æ ‡IP&amp;gt; &amp;lt;ç«¯å£å·&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºTCPç«¯å£ã€‚è¿æ¥æˆåŠŸä¼šæ˜¾ç¤º &lt;code&gt;Connected to ...&lt;/code&gt;ï¼›å¤±è´¥åˆ™æ˜¾ç¤º &lt;code&gt;Connection refused&lt;/code&gt;æˆ–è¶…æ—¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;nc (netcat)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;nc -zv &amp;lt;ç›®æ ‡IP&amp;gt; &amp;lt;ç«¯å£å·&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€‚ç”¨äºTCP/UDPç«¯å£ã€‚&lt;code&gt;-z&lt;/code&gt;è¡¨ç¤ºæ‰«æï¼Œ&lt;code&gt;-v&lt;/code&gt;æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚æˆåŠŸè¾“å‡º &lt;code&gt;succeeded!&lt;/code&gt;ï¼›å¤±è´¥è¾“å‡º &lt;code&gt;failed: Connection refused&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;nmap&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;nmap -p &amp;lt;ç«¯å£å·&amp;gt; &amp;lt;ç›®æ ‡IP&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŠŸèƒ½å¼ºå¤§çš„ç«¯å£æ‰«æå™¨ã€‚å¯æ‰«æå•ä¸ªç«¯å£ã€èŒƒå›´æˆ–å…¨éƒ¨ç«¯å£ï¼Œå¹¶æ˜¾ç¤ºçŠ¶æ€ï¼ˆopen, closed, filteredï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Test-NetConnection&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Test-NetConnection &amp;lt;ç›®æ ‡IP&amp;gt; -Port &amp;lt;ç«¯å£å·&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Windows PowerShell è‡ªå¸¦å‘½ä»¤ï¼Œèƒ½æä¾›è¯¦ç»†çš„ç«¯å£æµ‹è¯•ç»“æœã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å·¥å…·é€‰æ‹©ä¸ä½¿ç”¨å»ºè®®"&gt;ğŸ’¡ å·¥å…·é€‰æ‹©ä¸ä½¿ç”¨å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿæ£€æŸ¥å•ä¸ªTCPç«¯å£&lt;/strong&gt;ï¼šåœ¨Linuxæˆ–macOSä¸Šï¼Œ&lt;code&gt;nc&lt;/code&gt;ï¼ˆnetcatï¼‰æˆ– &lt;code&gt;telnet&lt;/code&gt;æ˜¯è½»é‡å¿«æ·çš„é€‰æ‹©ã€‚åœ¨Windowsä¸Šï¼Œå¯ä»¥ä½¿ç”¨PowerShellçš„ &lt;code&gt;Test-NetConnection&lt;/code&gt;æˆ–å®‰è£… &lt;code&gt;telnet&lt;/code&gt;å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦è¯¦ç»†æ‰«æä¿¡æ¯&lt;/strong&gt;ï¼šå¦‚æœä½ éœ€è¦äº†è§£ç«¯å£çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚æœåŠ¡ç‰ˆæœ¬ï¼‰æˆ–è¿›è¡Œæ‰¹é‡ç«¯å£æ‰«æï¼Œ&lt;code&gt;nmap&lt;/code&gt;æ˜¯æœ€ä¸“ä¸šçš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼šä½¿ç”¨è¿™äº›å·¥å…·å‰ï¼Œè¯·ç¡®ä¿ä½ æœ‰æƒé™å¯¹ç›®æ ‡IPè¿›è¡Œç«¯å£æµ‹è¯•ï¼Œä»¥å…è¿åç½‘ç»œå®‰å…¨è§„å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æœ‰æ•ˆåœ°æµ‹è¯•ç«¯å£è¿é€šæ€§ã€‚å¦‚æœä½ æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼ˆä¾‹å¦‚æƒ³æµ‹è¯•æŸä¸ªå…·ä½“æœåŠ¡çš„ç«¯å£ï¼‰ï¼Œæˆ‘å¯ä»¥ä¸ºä½ æä¾›æ›´å…·ä½“çš„å‘½ä»¤ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;h2 id="mvmw"&gt;mvmw
&lt;/h2&gt;&lt;p&gt;Maven é¡¹ç›®&lt;strong&gt;å¹¶éå¤©ç”Ÿå°±è‡ªå¸¦ &lt;code&gt;./mvnw&lt;/code&gt;æ–‡ä»¶&lt;/strong&gt;ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ &lt;strong&gt;Maven Wrapperï¼ˆç®€ç§° mvnwï¼‰&lt;/strong&gt; çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªéœ€è¦é¢å¤–é…ç½®åˆ°é¡¹ç›®ä¸­çš„å·¥å…·ï¼Œç›®çš„æ˜¯ç¡®ä¿æ‰€æœ‰å¼€å‘è€…ï¼ˆåŒ…æ‹¬æŒç»­é›†æˆç¯å¢ƒï¼‰éƒ½ä½¿ç”¨å®Œå…¨ä¸€è‡´çš„ Maven ç‰ˆæœ¬è¿›è¡Œæ„å»ºï¼Œä»è€Œé¿å…å› æœ¬åœ° Maven ç‰ˆæœ¬ä¸åŒè€Œå¯¼è‡´çš„å„ç§é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id="-maven-wrapper-æ˜¯ä»€ä¹ˆ"&gt;ğŸ”§ Maven Wrapper æ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h3&gt;&lt;p&gt;Maven Wrapper ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ–‡ä»¶ç»„æˆï¼Œé€šå¸¸ä½äºé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;mvnw&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äº Linux æˆ– macOS ç³»ç»Ÿçš„ Shell è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;mvnw.cmd&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äº Windows ç³»ç»Ÿçš„æ‰¹å¤„ç†è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;.mvn/wrapper/&lt;/code&gt;ç›®å½•&lt;/strong&gt;ï¼šåŒ…å«é…ç½®æ–‡ä»¶ï¼ˆ&lt;code&gt;maven-wrapper.properties&lt;/code&gt;ï¼‰å’Œæ ¸å¿ƒ JAR æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šå½“ä½ é¦–æ¬¡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ &lt;code&gt;./mvnw clean install&lt;/code&gt;ï¼ˆLinux/macOSï¼‰æˆ– &lt;code&gt;mvnw.cmd clean install&lt;/code&gt;ï¼ˆWindowsï¼‰å‘½ä»¤æ—¶ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶ä¸‹è½½é¡¹ç›®æŒ‡å®šçš„ Maven ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨è¯¥ç‰ˆæœ¬è¿›è¡Œæ„å»ºã€‚&lt;/p&gt;
&lt;h3 id="-å“ªäº›é¡¹ç›®ä¼šè‡ªå¸¦-mvnw"&gt;ğŸ“ å“ªäº›é¡¹ç›®ä¼šè‡ªå¸¦ Mvnwï¼Ÿ
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ Maven Wrapper ä¸æ˜¯æ ‡å‡†é…ç½®ï¼Œä½†ä½ åœ¨ä¸€äº›ç°ä»£æ¡†æ¶ç”Ÿæˆçš„é¡¹ç›®ä¸­ä¼šç»å¸¸çœ‹åˆ°å®ƒï¼Œæœ€å¸¸è§çš„å°±æ˜¯ &lt;strong&gt;Spring Boot&lt;/strong&gt; é¡¹ç›®ã€‚å½“ä½ ä½¿ç”¨ Spring Initializr ç”Ÿæˆä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼Œå®ƒä¼šé»˜è®¤åŒ…å« Maven Wrapper çš„ç›¸å…³æ–‡ä»¶ï¼Œè¿™å·²ç»æˆä¸ºä¸€ç§æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;h3 id="-ä½¿ç”¨-mvnw-ä¸ç³»ç»Ÿ-maven-çš„å¯¹æ¯”"&gt;ğŸ’¡ ä½¿ç”¨ Mvnw ä¸ç³»ç»Ÿ Maven çš„å¯¹æ¯”
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†è®©ä½ æ›´æ¸…æ™°åœ°äº†è§£åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ &lt;code&gt;./mvnw&lt;/code&gt;(Maven Wrapper)&lt;/th&gt;
&lt;th&gt;ä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ &lt;code&gt;mvn&lt;/code&gt;å‘½ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¯å¢ƒè¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åªéœ€å®‰è£… JDKï¼Œæ— éœ€é¢„å…ˆå®‰è£… Maven&lt;/td&gt;
&lt;td&gt;å¿…é¡»æå‰å®‰è£…å¹¶é…ç½®å¥½ Maven&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸¥æ ¼ä¸€è‡´&lt;/strong&gt;ï¼Œä½¿ç”¨é¡¹ç›®é…ç½®ä¸­æŒ‡å®šçš„ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;å–å†³äºæ¯ä½å¼€å‘è€…è‡ªå·±ç”µè„‘ä¸Šçš„ Maven ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›¢é˜Ÿåä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¨è&lt;/strong&gt;ï¼Œèƒ½æœ‰æ•ˆé¿å…â€œåœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘â€çš„é—®é¢˜&lt;/td&gt;
&lt;td&gt;å®¹æ˜“å› ç‰ˆæœ¬å·®å¼‚å¯¼è‡´æ„å»ºå¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CI/CD é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç®€åŒ–é…ç½®&lt;/strong&gt;ï¼ŒCI æœåŠ¡å™¨æ— éœ€é¢„è£…ç‰¹å®šç‰ˆæœ¬ Maven&lt;/td&gt;
&lt;td&gt;éœ€è¦åœ¨ CI ç¯å¢ƒä¸­æ‰‹åŠ¨å®‰è£…å’Œç»´æŠ¤ Maven&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-å¦‚ä½•ä¸ºé¡¹ç›®æ·»åŠ -maven-wrapper"&gt;ğŸ› ï¸ å¦‚ä½•ä¸ºé¡¹ç›®æ·»åŠ  Maven Wrapperï¼Ÿ
&lt;/h3&gt;&lt;p&gt;å¦‚æœä½ çš„é¡¹ç›®è¿˜æ²¡æœ‰ Maven Wrapperï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ·»åŠ ã€‚å‰ææ˜¯ä½ çš„ç”µè„‘ä¸Šå·²ç»å®‰è£…äº†ä¸€ä¸ªå¯ç”¨çš„ Mavenï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;mvn -N io.takari:maven:wrapper
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ–è€…æŒ‡å®šä½ å¸Œæœ›é¡¹ç›®ä½¿ç”¨çš„ Maven ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;mvn -N io.takari:maven:wrapper -Dmaven=3.9.6
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰§è¡ŒæˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ° &lt;code&gt;mvnw&lt;/code&gt;ã€&lt;code&gt;mvnw.cmd&lt;/code&gt;å’Œ &lt;code&gt;.mvn/wrapper&lt;/code&gt;ç›®å½•è¢«åˆ›å»ºå‡ºæ¥ã€‚è¯·åŠ¡å¿…å°†è¿™äº›æ–‡ä»¶**æäº¤åˆ°é¡¹ç›®çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰**ä¸­ï¼Œè¿™æ ·å…¶ä»–å¼€å‘è€…æ‹‰å–ä»£ç åå°±èƒ½ç›´æ¥ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;h3 id="-æ€»ç»“-10"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œ&lt;code&gt;./mvnw&lt;/code&gt;æ˜¯ Maven Wrapper æä¾›çš„è„šæœ¬ï¼Œå®ƒ&lt;strong&gt;ä¸æ˜¯ Maven é¡¹ç›®çš„é»˜è®¤é…ç½®ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ºäº†æå‡å›¢é˜Ÿåä½œå’Œæ„å»ºä¸€è‡´æ€§è€Œå¼•å…¥çš„å¢å¼ºå·¥å…·&lt;/strong&gt;ã€‚å¯¹äºæ–°é¡¹ç›®ï¼Œç‰¹åˆ«æ˜¯å›¢é˜Ÿåˆä½œæˆ–ç”¨äº CI/CD ç¯å¢ƒçš„é¡¹ç›®ï¼Œå¼ºçƒˆå»ºè®®é›†æˆ Maven Wrapperã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ã€‚å¦‚æœä½ å¯¹ç”Ÿæˆ Maven Wrapper çš„å…·ä½“æ­¥éª¤æˆ–è€…é…ç½®æœ‰æ›´å¤šç–‘é—®ï¼Œæˆ‘å¯ä»¥æä¾›æ›´è¯¦ç»†çš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id="properties"&gt;properties
&lt;/h2&gt;&lt;p&gt;æ ¹æ® Spring Boot çš„çº¦å®šï¼Œ&lt;strong&gt;å¯ä»¥æœ‰ç¯å¢ƒåç¼€&lt;/strong&gt;ã€‚åƒ &lt;code&gt;application-local.properties&lt;/code&gt;è¿™æ ·çš„å‘½åæ˜¯å®Œå…¨ç¬¦åˆè§„åˆ™çš„ï¼Œå®ƒæ­£æ˜¯ Spring Boot ç”¨äºæ”¯æŒå¤šç¯å¢ƒé…ç½®çš„æ ¸å¿ƒç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°å±•ç¤ºäº†å¤šç¯å¢ƒé…ç½®æ–‡ä»¶çš„å‘½åè§„åˆ™å’Œä½œç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ç½®æ–‡ä»¶åç§°&lt;/th&gt;
&lt;th&gt;ä½œç”¨è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;application.properties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¸»é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸å­˜æ”¾&lt;strong&gt;é€šç”¨&lt;/strong&gt;æˆ–&lt;strong&gt;é»˜è®¤&lt;/strong&gt;é…ç½®ï¼Œå¹¶æŒ‡å®šå½“å‰æ¿€æ´»çš„ç¯å¢ƒã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;application-{profile}.properties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ &lt;code&gt;{profile}&lt;/code&gt;ä¸ºç¯å¢ƒæ ‡è¯†ï¼ˆå¦‚ &lt;code&gt;dev&lt;/code&gt;, &lt;code&gt;test&lt;/code&gt;, &lt;code&gt;prod&lt;/code&gt;, &lt;code&gt;local&lt;/code&gt;ï¼‰ï¼Œå­˜æ”¾è¯¥ç¯å¢ƒçš„&lt;strong&gt;ç‰¹æœ‰&lt;/strong&gt;é…ç½®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="å¦‚ä½•æ¿€æ´»ç‰¹å®šç¯å¢ƒ"&gt;å¦‚ä½•æ¿€æ´»ç‰¹å®šç¯å¢ƒ
&lt;/h3&gt;&lt;p&gt;è¦è®© Spring Boot åŠ è½½ &lt;code&gt;application-local.properties&lt;/code&gt;ä¸­çš„é…ç½®ï¼Œä½ éœ€è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ä¹‹ä¸€æ¥æ¿€æ´»åä¸º &lt;code&gt;local&lt;/code&gt;çš„ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­è®¾ç½®&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;application.properties&lt;/code&gt;æ–‡ä»¶ä¸­æŒ‡å®šé»˜è®¤æ¿€æ´»çš„ç¯å¢ƒã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.profiles.active=local
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è®¾ç½®&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨åº”ç”¨æ—¶ä½¿ç”¨ &lt;code&gt;--spring.profiles.active&lt;/code&gt;å‚æ•°ï¼Œè¿™ç§æ–¹å¼ä¼˜å…ˆçº§å¾ˆé«˜ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;java -jar your-app.jar --spring.profiles.active=local
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®&lt;/strong&gt;ï¼šè®¾ç½®æ“ä½œç³»ç»Ÿä¸­çš„ &lt;code&gt;SPRING_PROFILES_ACTIVE&lt;/code&gt;ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;export SPRING_PROFILES_ACTIVE=local
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºä¸ä¼˜å…ˆçº§"&gt;é…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºä¸ä¼˜å…ˆçº§
&lt;/h3&gt;&lt;p&gt;ç†è§£é…ç½®çš„åŠ è½½é¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå†³å®šäº†å½“ç›¸åŒé…ç½®é¡¹å‡ºç°åœ¨ä¸åŒæ–‡ä»¶æ—¶ï¼Œå“ªä¸ªä¼šç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring Boot ä¼š&lt;strong&gt;å…ˆåŠ è½½ &lt;code&gt;application.properties&lt;/code&gt;&lt;/strong&gt;ï¼Œç„¶å&lt;strong&gt;å†åŠ è½½å½“å‰æ¿€æ´»çš„ &lt;code&gt;application-{profile}.properties&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶ä¸­å±æ€§ä¼š&lt;strong&gt;è¦†ç›–&lt;/strong&gt;ä¸»é…ç½®æ–‡ä»¶ä¸­çš„ç›¸åŒå±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤–ï¼Œ&lt;code&gt;properties&lt;/code&gt;æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜äº &lt;code&gt;yml&lt;/code&gt;æ ¼å¼ã€‚å‘½ä»¤è¡Œå‚æ•°çš„ä¼˜å…ˆçº§åˆ™é«˜äºæ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å®ç”¨å»ºè®®ä¸-yaml-é…ç½®ç¤ºä¾‹"&gt;å®ç”¨å»ºè®®ä¸ YAML é…ç½®ç¤ºä¾‹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;local&lt;/code&gt;ç¯å¢ƒçš„å…¸å‹ç”¨é€”&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºå¼€å‘è€…ä¸ªäººæœ¬åœ°æœºå™¨ï¼Œé…ç½®å¯èƒ½ä¸å¼€å‘æœåŠ¡å™¨ä¸åŒï¼Œä¾‹å¦‚è¿æ¥æœ¬åœ°æ•°æ®åº“ã€å¼€å¯æ›´è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ YAML æ ¼å¼è¿›è¡Œå¤šç¯å¢ƒé…ç½®&lt;/strong&gt;ï¼šé™¤äº† &lt;code&gt;.properties&lt;/code&gt;æ–‡ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ç®€æ´çš„ &lt;code&gt;.yml&lt;/code&gt;æ–‡ä»¶ã€‚YAML è¿˜æ”¯æŒåœ¨å•ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ &lt;code&gt;---&lt;/code&gt;åˆ†éš”ç¬¦æ¥å®šä¹‰æ‰€æœ‰ç¯å¢ƒé…ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# application.yml ç¤ºä¾‹
spring:
profiles:
active: local # æŒ‡å®šé»˜è®¤æ¿€æ´» local ç¯å¢ƒ
---
spring:
config:
activate:
on-profile: local # å®šä¹‰ local ç¯å¢ƒçš„é…ç½®
server:
port: 8080
database:
url: jdbc:mysql://localhost:3306/myapp
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°é…ç½®æœ¬åœ°å¼€å‘ç¯å¢ƒã€‚å¦‚æœä½ åœ¨å®è·µè¿‡ç¨‹ä¸­é‡åˆ°å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚å¦‚ä½•ç®¡ç†ä¸åŒç¯å¢ƒçš„æ•°æ®åº“è¿æ¥ï¼Œæˆ‘å¾ˆä¹æ„ç»§ç»­æä¾›å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id="beanfactory--applicationcontext"&gt;BeanFactory &amp;amp; ApplicationContext
&lt;/h2&gt;&lt;p&gt;BeanFactory å’Œ ApplicationContext æ˜¯ Spring æ¡†æ¶ä¸­ä¸¤ä¸ªæ ¸å¿ƒçš„å®¹å™¨æ¥å£ï¼Œå®ƒä»¬çš„å…³ç³»å’ŒåŒºåˆ«æ˜¯ç†è§£ Spring IoC å®¹å™¨çš„å…³é”®ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°å¯¹æ¯”äº†å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§ç»´åº¦&lt;/th&gt;
&lt;th&gt;BeanFactory&lt;/th&gt;
&lt;th&gt;ApplicationContext&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¥å£å±‚çº§ä¸å®šä½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºç¡€ã€åº•å±‚çš„ IoC å®¹å™¨&lt;/td&gt;
&lt;td&gt;BeanFactory çš„&lt;strong&gt;å­æ¥å£&lt;/strong&gt;ï¼ŒåŠŸèƒ½å…¨é¢çš„&lt;strong&gt;é«˜çº§å®¹å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bean åŠ è½½æ—¶æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‡’åŠ è½½&lt;/strong&gt;ï¼šä»…åœ¨è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;æ—¶å®ä¾‹åŒ– Bean&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;é¢„åŠ è½½&lt;/strong&gt;ï¼šå®¹å™¨å¯åŠ¨æ—¶å³åˆå§‹åŒ–æ‰€æœ‰å•ä¾‹ Beanï¼ˆéæ‡’åŠ è½½çš„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼ä¸šçº§åŠŸèƒ½æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨é…ç½®ï¼Œä¸æ”¯æŒæˆ–åŸºç¡€æ”¯æŒ&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;åŸç”Ÿé›†æˆ&lt;/strong&gt;ï¼šäº‹ä»¶å‘å¸ƒã€å›½é™…åŒ–ã€èµ„æºä¾¿æ·è®¿é—®ã€AOPã€ç¯å¢ƒæŠ½è±¡ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åå¤„ç†å™¨æ³¨å†Œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ‰‹åŠ¨æ³¨å†Œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨æ³¨å†Œ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;BeanPostProcessor&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®é”™è¯¯æ£€æµ‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å»¶è¿Ÿåˆ°é¦–æ¬¡è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;æ—¶æ‰æš´éœ²&lt;/td&gt;
&lt;td&gt;å®¹å™¨å¯åŠ¨æ—¶å³å¯å‘ç°é…ç½®é”™è¯¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;èµ„æºæåº¦å—é™çš„ç¯å¢ƒï¼ˆå¦‚åµŒå…¥å¼è®¾å¤‡ï¼‰&lt;/td&gt;
&lt;td&gt;ç»å¤§å¤šæ•°ä¼ä¸šçº§åº”ç”¨å’Œ Spring Boot é¡¹ç›®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="-æ ¸å¿ƒåŒºåˆ«æ·±åº¦è§£æ"&gt;ğŸ’¡ æ ¸å¿ƒåŒºåˆ«æ·±åº¦è§£æ
&lt;/h3&gt;&lt;h4 id="1-åŠ è½½ç­–ç•¥ä¸å¯åŠ¨æ€§èƒ½"&gt;1. åŠ è½½ç­–ç•¥ä¸å¯åŠ¨æ€§èƒ½
&lt;/h4&gt;&lt;p&gt;æœ€æ˜¾è‘—çš„åŒºåˆ«åœ¨äºå®ƒä»¬åˆ›å»º Bean çš„æ—¶æœºï¼Œè¿™ç›´æ¥å½±å“äº†åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦å’Œå†…å­˜å ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BeanFactory çš„æ‡’åŠ è½½&lt;/strong&gt;ï¼šBeanFactory åœ¨å¯åŠ¨æ—¶æœ¬èº«å¾ˆå¿«ï¼Œå› ä¸ºå®ƒåªåŠ è½½é…ç½®ä¿¡æ¯ï¼Œä¸åˆ›å»º Bean å®ä¾‹ã€‚Bean çš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ç­‰æ“ä½œä¼šå»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡è¢«è¯·æ±‚æ—¶ï¼ˆå³è°ƒç”¨ &lt;code&gt;getBean()&lt;/code&gt;æ–¹æ³•ï¼‰æ‰è¿›è¡Œã€‚è¿™ç§æ–¹å¼çš„&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;æ˜¯å¯åŠ¨å¿«ï¼ŒèŠ‚çœåˆå§‹å†…å­˜ã€‚ä½†&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;æ˜¯è¿è¡ŒæœŸç¬¬ä¸€æ¬¡è¯·æ±‚å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œå¹¶ä¸”é…ç½®é—®é¢˜ï¼ˆå¦‚æŸä¸ªä¾èµ–æ— æ³•æ³¨å…¥ï¼‰è¦åˆ°ä½¿ç”¨æ—¶æ‰ä¼šæš´éœ²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ApplicationContext çš„é¢„åŠ è½½&lt;/strong&gt;ï¼šApplicationContext åœ¨å¯åŠ¨é˜¶æ®µå°±ä¼šå®Œæˆæ‰€æœ‰å•ä¾‹ Bean çš„åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ã€‚è¿™ç§æ–¹å¼çš„&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;æ˜¯å¯åŠ¨åæœåŠ¡å“åº”è¿…é€Ÿï¼Œä¸”æ‰€æœ‰é…ç½®é—®é¢˜åœ¨å¯åŠ¨æ—¶å°±èƒ½å‘ç°ï¼Œæœ‰åˆ©äºä¿éšœåº”ç”¨ç¨³å®šæ€§ã€‚&lt;strong&gt;ä»£ä»·&lt;/strong&gt;åˆ™æ˜¯å¯åŠ¨æ—¶é—´æ›´é•¿ï¼Œåˆå§‹å†…å­˜å ç”¨æ›´é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ä¼ä¸šçº§åŠŸèƒ½ä»åŸºç¡€åˆ°å…¨æ ˆ"&gt;2. ä¼ä¸šçº§åŠŸèƒ½ï¼šä»â€œåŸºç¡€â€åˆ°â€œå…¨æ ˆâ€
&lt;/h4&gt;&lt;p&gt;ApplicationContext çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒæä¾›äº†å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å¼€å‘æ”¯æŒï¼Œè€Œ BeanFactory ä»…æä¾›æœ€åŸºç¡€çš„ IoC åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶å‘å¸ƒæœºåˆ¶&lt;/strong&gt;ï¼šApplicationContext å†…ç½®äº†åŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„äº‹ä»¶æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;publishEvent()&lt;/code&gt;æ–¹æ³•å‘å¸ƒäº‹ä»¶ï¼Œå¹¶ç”¨ &lt;code&gt;@EventListener&lt;/code&gt;æ³¨è§£æ¥ç›‘å¬äº‹ä»¶ã€‚è¿™å¯¹äºå®ç°åº”ç”¨å†…æ¨¡å—é—´çš„æ¾è€¦åˆé€šä¿¡éå¸¸æœ‰ç”¨ã€‚BeanFactory åˆ™ä¸ç›´æ¥æ”¯æŒæ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›½é™…åŒ–æ”¯æŒ&lt;/strong&gt;ï¼šApplicationContext ç»§æ‰¿äº† &lt;code&gt;MessageSource&lt;/code&gt;æ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è§£å†³å›½é™…åŒ–æ¶ˆæ¯é—®é¢˜ï¼Œè½»æ¾å®ç°å¤šè¯­è¨€æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºè®¿é—®&lt;/strong&gt;ï¼šApplicationContext æä¾›äº†æ›´å¼ºå¤§çš„ &lt;code&gt;ResourceLoader&lt;/code&gt;æ¥å£ï¼Œæ”¯æŒä»¥ç»Ÿä¸€çš„æ–¹å¼ä»ç±»è·¯å¾„ã€æ–‡ä»¶ç³»ç»Ÿã€URLç­‰åœ°æ–¹ä¾¿æ·åœ°åŠ è½½èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æ¡†æ¶æ— ç¼é›†æˆ&lt;/strong&gt;ï¼šApplicationContext åŸç”Ÿæ”¯æŒæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Autowired&lt;/code&gt;ï¼‰ã€AOPã€&lt;code&gt;Environment&lt;/code&gt;æŠ½è±¡ï¼ˆç”¨äºç®¡ç†é…ç½®æ–‡ä»¶å’Œå±æ€§ï¼‰ç­‰ç°ä»£ Spring ç‰¹æ€§ï¼Œè€Œè¿™äº›åœ¨ BeanFactory ä¸­éœ€è¦å¤§é‡æ‰‹åŠ¨é…ç½®æ‰èƒ½å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¦‚ä½•é€‰æ‹©-8"&gt;ğŸ”§ å¦‚ä½•é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;äº†è§£äº†è¿™äº›åŒºåˆ«åï¼Œé€‰æ‹©æ ‡å‡†å°±éå¸¸æ¸…æ™°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯·ç›´æ¥ä½¿ç”¨ ApplicationContext&lt;/strong&gt;ã€‚å®ƒæ˜¯ç°ä»£ Spring åº”ç”¨ï¼ˆåŒ…æ‹¬ Spring Bootï¼‰çš„&lt;strong&gt;æ ‡å‡†ä¸”æ¨è&lt;/strong&gt;çš„é€‰æ‹©ã€‚å…¶é¢„åŠ è½½ç­–ç•¥å¸¦æ¥çš„ç¨³å®šæ€§ä¼˜åŠ¿ï¼Œä»¥åŠå¼€ç®±å³ç”¨çš„ä¼ä¸šçº§åŠŸèƒ½ï¼Œæå¤§åœ°æå‡äº†å¼€å‘æ•ˆç‡å’Œåº”ç”¨çš„å¥å£®æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»…åœ¨èµ„æºæåº¦å—é™çš„ç‰¹å®šåœºæ™¯ä¸‹è€ƒè™‘ BeanFactory&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œåœ¨å†…å­˜å’Œè®¡ç®—èƒ½åŠ›éå¸¸ç´§å¼ çš„åµŒå…¥å¼è®¾å¤‡æˆ–ç§»åŠ¨åº”ç”¨ä¸­ï¼Œä¸ºäº†æè‡´çš„èµ„æºæ§åˆ¶ï¼Œæ‰å¯èƒ½ä½¿ç”¨æ›´è½»é‡çº§çš„ BeanFactoryã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“ä¸å…³ç³»"&gt;ğŸ’ æ€»ç»“ä¸å…³ç³»
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼ŒBeanFactory æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼Œæä¾›äº† IoC æœ€åŸºç¡€çš„èƒ½åŠ›ï¼›è€Œ ApplicationContext æ˜¯æ„å»ºåœ¨å¿ƒè„ä¹‹ä¸Šçš„â€œå®Œæ•´èº¯ä½“â€ï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„ç°ä»£åŒ–å®¹å™¨ã€‚&lt;strong&gt;ApplicationContext å®Œå…¨åŒ…å«äº† BeanFactory çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å¤§é‡æ‰©å±•&lt;/strong&gt;ã€‚å› æ­¤ï¼Œåœ¨å½“ä»Šçš„å¼€å‘ä¸­ï¼ŒApplicationContext æ˜¯ç»å¯¹çš„ä¸»æµã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›è¿™ä»½è¯¦ç»†çš„å¯¹æ¯”èƒ½å¸®åŠ©ä½ é€å½»åœ°ç†è§£ BeanFactory å’Œ ApplicationContextã€‚å¦‚æœä½ å¯¹æŸä¸ªå…·ä½“åŠŸèƒ½ï¼ˆå¦‚äº‹ä»¶æœºåˆ¶ï¼‰çš„å®ç°ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Config Priority</title><link>https://dyhes.github.io/p/shopeeconfig-priority/</link><pubDate>Thu, 21 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeeconfig-priority/</guid><description>&lt;h2 id="é…ç½®ä¼˜å…ˆçº§"&gt;é…ç½®ä¼˜å…ˆçº§
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Bootçš„é…ç½®ä½“ç³»ä¸­ï¼Œ&lt;code&gt;application.yaml&lt;/code&gt;ï¼ˆé»˜è®¤é…ç½®æ–‡ä»¶ï¼‰å’Œ&lt;code&gt;application-{env}.yaml&lt;/code&gt;ï¼ˆç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œå¦‚&lt;code&gt;application-prod.yaml&lt;/code&gt;ï¼‰çš„ä¼˜å…ˆçº§éµå¾ªæ˜ç¡®çš„è§„åˆ™ï¼Œæ ¸å¿ƒåŸåˆ™æ˜¯&lt;strong&gt;ç¯å¢ƒé…ç½®ä¼˜å…ˆäºé»˜è®¤é…ç½®&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-åŸºæœ¬ä¼˜å…ˆçº§è§„åˆ™"&gt;âš™ï¸ &lt;strong&gt;1. åŸºæœ¬ä¼˜å…ˆçº§è§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¯å¢ƒé…ç½®æ–‡ä»¶ &amp;gt; é»˜è®¤é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“é€šè¿‡&lt;code&gt;spring.profiles.active&lt;/code&gt;æ¿€æ´»æŸä¸ªç¯å¢ƒï¼ˆå¦‚&lt;code&gt;prod&lt;/code&gt;ï¼‰æ—¶ï¼Œ&lt;code&gt;application-prod.yaml&lt;/code&gt;ä¸­çš„é…ç½®ä¼šè¦†ç›–&lt;code&gt;application.yaml&lt;/code&gt;ä¸­çš„åŒåé…ç½®é¡¹ã€‚è‹¥é…ç½®é¡¹ä¸åŒï¼Œåˆ™åˆå¹¶ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;application.yaml&lt;/code&gt;è®¾ç½® &lt;code&gt;server.port: 8080&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;application-prod.yaml&lt;/code&gt;è®¾ç½® &lt;code&gt;server.port: 80&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ¿€æ´»&lt;code&gt;prod&lt;/code&gt;ç¯å¢ƒåï¼Œæœ€ç»ˆç«¯å£ä¸º &lt;code&gt;80&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-ç¯å¢ƒé…ç½®çš„æ¿€æ´»æ–¹å¼"&gt;ğŸ”§ &lt;strong&gt;2. ç¯å¢ƒé…ç½®çš„æ¿€æ´»æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç¯å¢ƒé…ç½®æ–‡ä»¶çš„ç”Ÿæ•ˆä¾èµ–äº&lt;strong&gt;æ˜¾å¼æ¿€æ´»ç¯å¢ƒ&lt;/strong&gt;ï¼Œæ–¹å¼åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶æŒ‡å®š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;application.yaml&lt;/code&gt;ä¸­å£°æ˜ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
profiles:
active: prod # æ¿€æ´»prodç¯å¢ƒ
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘½ä»¤è¡Œå‚æ•°&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨æ—¶åŠ¨æ€æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;java -jar app.jar --spring.profiles.active=prod
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‘½ä»¤è¡Œä¼˜å…ˆçº§æœ€é«˜ï¼Œå¯è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„&lt;code&gt;active&lt;/code&gt;è®¾ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡è®¾ç½®ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;export SPRING_PROFILES_ACTIVE=prod
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-3-é…ç½®è¦†ç›–ä¸åˆå¹¶æœºåˆ¶"&gt;ğŸ”„ &lt;strong&gt;3. é…ç½®è¦†ç›–ä¸åˆå¹¶æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒåé…ç½®é¡¹&lt;/strong&gt;ï¼šç¯å¢ƒé…ç½®æ–‡ä»¶ç›´æ¥è¦†ç›–é»˜è®¤é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚åé…ç½®é¡¹&lt;/strong&gt;ï¼šç¯å¢ƒé…ç½®ä¸é»˜è®¤é…ç½®åˆå¹¶ï¼Œå…±åŒç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¾‹å¦‚ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;application.yaml&lt;/code&gt;å®šä¹‰æ•°æ®åº“å…¬å…±å‚æ•°ï¼ˆå¦‚&lt;code&gt;db.url&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;application-prod.yaml&lt;/code&gt;ä»…è¦†ç›–å¯†ç ï¼ˆ&lt;code&gt;db.password&lt;/code&gt;ï¼‰ï¼Œå…¶ä»–å‚æ•°ç»§æ‰¿é»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-å®Œæ•´é…ç½®æºä¼˜å…ˆçº§é“¾æ¡"&gt;ğŸ“Š &lt;strong&gt;4. å®Œæ•´é…ç½®æºä¼˜å…ˆçº§é“¾æ¡&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼ˆ&lt;code&gt;application-{env}.yaml&lt;/code&gt;ï¼‰çš„ä¼˜å…ˆçº§éœ€ç½®äºæ•´ä¸ªé…ç½®ä½“ç³»ä¸­ç†è§£ã€‚&lt;strong&gt;ä»é«˜åˆ°ä½&lt;/strong&gt;çš„å®Œæ•´é¡ºåºä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œå‚æ•°&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;--server.port=8081&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;SPRING_PROFILES_ACTIVE=prod&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼ˆå¦‚JaråŒ…å¤–éƒ¨çš„&lt;code&gt;config/application-prod.yaml&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨ç¯å¢ƒé…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼ˆå¦‚&lt;code&gt;classpath:/application-prod.yaml&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨é»˜è®¤é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼ˆå¦‚&lt;code&gt;classpath:/application.yaml&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@PropertySource&lt;/code&gt;æ³¨è§£æˆ–é»˜è®¤é…ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;å…³é”®ç»“è®º&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;application-{env}.yaml&lt;/code&gt;ä¼˜å…ˆçº§é«˜äº &lt;code&gt;application.yaml&lt;/code&gt;ï¼Œä½†ä½äºå‘½ä»¤è¡Œå‚æ•°ã€ç¯å¢ƒå˜é‡åŠå¤–éƒ¨é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-5-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;5. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–‡ä»¶æ ¼å¼ä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥åŒä¸€ä½ç½®å­˜åœ¨ä¸åŒæ ¼å¼æ–‡ä»¶ï¼ˆå¦‚&lt;code&gt;application-prod.properties&lt;/code&gt;å’Œ&lt;code&gt;application-prod.yaml&lt;/code&gt;ï¼‰ï¼Œ&lt;strong&gt;&lt;code&gt;.properties&lt;/code&gt;ä¼˜å…ˆçº§é«˜äº&lt;code&gt;.yaml&lt;/code&gt;&lt;/strong&gt; ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šç¯å¢ƒé…ç½®å†²çª&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ¿€æ´»å¤šä¸ªç¯å¢ƒæ—¶ï¼ˆå¦‚&lt;code&gt;--spring.profiles.active=dev,prod&lt;/code&gt;ï¼‰ï¼ŒæŒ‰&lt;strong&gt;ä»å·¦åˆ°å³é¡ºåºåŠ è½½&lt;/strong&gt;ï¼Œå³ä¾§è¦†ç›–å·¦ä¾§åŒåé…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Profileåˆ†ç»„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¯é€šè¿‡&lt;code&gt;spring.profiles.group&lt;/code&gt;åˆå¹¶ç¯å¢ƒé…ç½®ç»„ï¼ˆå¦‚&lt;code&gt;production = prod1,prod2&lt;/code&gt;ï¼‰ï¼Œå†ç”¨&lt;code&gt;--spring.profiles.active=production&lt;/code&gt;æ¿€æ´»æ•´ç»„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤è§„åˆ™&lt;/strong&gt;ï¼š&lt;code&gt;application-{env}.yaml&lt;/code&gt;&lt;strong&gt;&amp;gt;&lt;/strong&gt; &lt;code&gt;application.yaml&lt;/code&gt;ï¼ˆéœ€æ˜¾å¼æ¿€æ´»ç¯å¢ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ§åˆ¶&lt;/strong&gt;ï¼šé€šè¿‡å‘½ä»¤è¡Œã€ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶åŠ¨æ€åˆ‡æ¢ç¯å¢ƒï¼Œå®ç°é…ç½®è¦†ç›–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šç”¨é…ç½®ï¼ˆå¦‚æ—¥å¿—çº§åˆ«ï¼‰æ”¾åœ¨&lt;code&gt;application.yaml&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¯å¢ƒå·®å¼‚é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç«¯å£ï¼‰æ”¾åœ¨&lt;code&gt;application-{env}.yaml&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰é€šè¿‡å‘½ä»¤è¡Œæˆ–å¤–éƒ¨é…ç½®æ³¨å…¥ï¼Œé¿å…ç¡¬ç¼–ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å­æ¨¡å—"&gt;å­æ¨¡å—
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Cloudå¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;æ¯ä¸ªå¾®æœåŠ¡é€šå¸¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­æ¨¡å—&lt;/strong&gt;ï¼Œä½†è¿™å¹¶éç»å¯¹è¦æ±‚ï¼Œè€Œæ˜¯å–å†³äºé¡¹ç›®ç»“æ„çš„è®¾è®¡é€‰æ‹©ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-å¾®æœåŠ¡ä½œä¸ºå­æ¨¡å—çš„å¸¸è§å®è·µ"&gt;âœ… &lt;strong&gt;1. å¾®æœåŠ¡ä½œä¸ºå­æ¨¡å—çš„å¸¸è§å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨åŸºäºMavenæˆ–Gradleçš„å¤šæ¨¡å—é¡¹ç›®ä¸­ï¼Œæ¯ä¸ªå¾®æœåŠ¡é€šå¸¸è¢«è®¾è®¡ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å­æ¨¡å—ã€‚è¿™ç§ç»“æ„å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€ä¾èµ–ç®¡ç†&lt;/strong&gt;ï¼šçˆ¶æ¨¡å—ï¼ˆParent Moduleï¼‰ç»Ÿä¸€ç®¡ç†Spring Bootã€Spring Cloudç‰ˆæœ¬åŠå…¬å…±ä¾èµ–ï¼Œé¿å…ç‰ˆæœ¬å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç éš”ç¦»ä¸ç‹¬ç«‹éƒ¨ç½²&lt;/strong&gt;ï¼šæ¯ä¸ªå¾®æœåŠ¡å­æ¨¡å—ï¼ˆå¦‚&lt;code&gt;order-service&lt;/code&gt;ã€&lt;code&gt;user-service&lt;/code&gt;ï¼‰æ‹¥æœ‰ç‹¬ç«‹çš„ä»£ç åº“ã€é…ç½®å’Œå¯åŠ¨ç±»ï¼Œå¯ç‹¬ç«‹ç¼–è¯‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›¢é˜Ÿåä½œå‹å¥½&lt;/strong&gt;ï¼šä¸åŒå›¢é˜Ÿå¯å¹¶è¡Œå¼€å‘å„è‡ªè´Ÿè´£çš„å¾®æœåŠ¡æ¨¡å—ï¼Œå‡å°‘ä»£ç å†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å…¸å‹é¡¹ç›®ç»“æ„ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring-cloud-project/
â”œâ”€â”€ parent-module/ # çˆ¶æ¨¡å—ï¼ˆç»Ÿä¸€ä¾èµ–ç®¡ç†ï¼‰
â”œâ”€â”€ order-service/ # è®¢å•å¾®æœåŠ¡ï¼ˆå­æ¨¡å—ï¼‰
â”‚ â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ pom.xml # ä¸“å±ä¾èµ–é…ç½®
â”œâ”€â”€ user-service/ # ç”¨æˆ·å¾®æœåŠ¡ï¼ˆå­æ¨¡å—ï¼‰
â”‚ â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ pom.xml
â”œâ”€â”€ api-gateway/ # APIç½‘å…³ï¼ˆå­æ¨¡å—ï¼‰
â””â”€â”€ eureka-server/ # æ³¨å†Œä¸­å¿ƒï¼ˆå­æ¨¡å—ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šæ¯ä¸ªå¾®æœåŠ¡å­æ¨¡å—å‡ä¸ºç‹¬ç«‹Spring Bootåº”ç”¨ï¼Œé€šè¿‡çˆ¶æ¨¡å—åè°ƒä¾èµ–ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-2-å¾®æœåŠ¡ä¸ä½œä¸ºå­æ¨¡å—çš„åœºæ™¯"&gt;âš ï¸ &lt;strong&gt;2. å¾®æœåŠ¡ä¸ä½œä¸ºå­æ¨¡å—çš„åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æŸäº›é¡¹ç›®å¯èƒ½é‡‡ç”¨&lt;strong&gt;å®Œå…¨ç‹¬ç«‹çš„ä»£ç ä»“åº“&lt;/strong&gt;ï¼ˆè€Œéå­æ¨¡å—ï¼‰ï¼Œæ­¤æ—¶å¾®æœåŠ¡é—´æ— ç›´æ¥ä»£ç ä¾èµ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯æ ˆå¼‚æ„æ€§&lt;/strong&gt;ï¼šä¸åŒå¾®æœåŠ¡å¯ä½¿ç”¨ä¸åŒè¯­è¨€ï¼ˆå¦‚Java + Goï¼‰æˆ–æ¡†æ¶ï¼Œæ— æ³•é€šè¿‡çˆ¶æ¨¡å—ç»Ÿä¸€ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬ç«‹æ¼”è¿›éœ€æ±‚&lt;/strong&gt;ï¼šå¤§å‹å›¢é˜Ÿä¸­ï¼ŒæœåŠ¡éœ€å®Œå…¨è§£è€¦ï¼Œç‹¬ç«‹ç‰ˆæœ¬å‘å¸ƒï¼ˆå¦‚è®¢å•æœåŠ¡v1.2ï¼Œç”¨æˆ·æœåŠ¡v1.5ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šå­æ¨¡å—é—´è‹¥ç›¸äº’å¼•ç”¨ï¼ˆå¦‚Aä¾èµ–Bï¼ŒBåˆä¾èµ–Aï¼‰ï¼Œä¼šå¯¼è‡´Mavenæ„å»ºå¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç‹¬ç«‹ä»“åº“çš„é€šä¿¡æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡HTTP/RESTã€gRPCæˆ–æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaï¼‰è¿œç¨‹è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¾èµ–æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚Eurekaï¼‰åŠ¨æ€å‘ç°æœåŠ¡å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-å…³é”®è®¾è®¡è€ƒé‡å› ç´ "&gt;ğŸ”§ &lt;strong&gt;3. å…³é”®è®¾è®¡è€ƒé‡å› ç´ &lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å› ç´ &lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œä¸ºå­æ¨¡å—&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‹¬ç«‹ä»“åº“&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çˆ¶æ¨¡å—ç»Ÿä¸€ç®¡ç†ï¼Œå‡å°‘å†²çª&lt;/td&gt;
&lt;td&gt;å„æœåŠ¡ç‹¬ç«‹ç®¡ç†ï¼Œå¯èƒ½ç‰ˆæœ¬ä¸ä¸€è‡´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ„å»ºä¸éƒ¨ç½²&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯æ•´ä½“æ„å»ºï¼Œä½†éœ€ç‹¬ç«‹éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;å®Œå…¨ç‹¬ç«‹æ„å»ºéƒ¨ç½²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›¢é˜Ÿåä½œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆä¸­å°å›¢é˜Ÿï¼Œä¾èµ–åè°ƒç®€å•&lt;/td&gt;
&lt;td&gt;é€‚åˆå¤§å‹å›¢é˜Ÿï¼Œå®Œå…¨è§£è€¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŠ€æœ¯æ ˆçµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å—é™ï¼ˆéœ€å…¼å®¹çˆ¶æ¨¡å—çº¦æŸï¼‰&lt;/td&gt;
&lt;td&gt;è‡ªç”±é€‰æ‹©ä¸åŒæŠ€æœ¯æ ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç å¤ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡å…¬å…±å­æ¨¡å—å…±äº«å·¥å…·ç±»&lt;/td&gt;
&lt;td&gt;éœ€å¤åˆ¶ä»£ç æˆ–å‘å¸ƒå…±äº«åº“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ¨èé€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸­å°å‹é¡¹ç›®&lt;/strong&gt;ï¼šä¼˜å…ˆé‡‡ç”¨å¤šæ¨¡å—ç»“æ„ï¼Œç®€åŒ–ä¾èµ–ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/strong&gt;ï¼šå¾®æœåŠ¡ç‹¬ç«‹ä»“åº“ï¼Œé€šè¿‡APIå¥‘çº¦å’Œæ³¨å†Œä¸­å¿ƒåä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-4-å®ç°å»ºè®®"&gt;ğŸ› ï¸ &lt;strong&gt;4. å®ç°å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥é‡‡ç”¨å­æ¨¡å—æ–¹æ¡ˆï¼Œéœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®æ¨¡å—è¾¹ç•Œ&lt;/strong&gt;ï¼šæŒ‰ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†ï¼ˆå¦‚è®¢å•ã€ç”¨æˆ·ï¼‰ï¼Œé¿å…æ¨¡å—èŒè´£é‡å ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰å…¬å…±æ¨¡å—&lt;/strong&gt;ï¼šæŠ½å–å·¥å…·ç±»ã€DTOã€Feignå®¢æˆ·ç«¯æ¥å£åˆ°ç‹¬ç«‹å­æ¨¡å—ï¼ˆå¦‚&lt;code&gt;common-utils&lt;/code&gt;ï¼‰ï¼Œä¾›å…¶ä»–å¾®æœåŠ¡ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨ç›´æ¥æ•°æ®åº“è®¿é—®&lt;/strong&gt;ï¼šå¾®æœåŠ¡é—´ä»…é€šè¿‡APIé€šä¿¡ï¼Œæ•°æ®åº“ä¸¥æ ¼éš”ç¦»ï¼ˆå¦‚è®¢å•æœåŠ¡ä¸ç›´æ¥æŸ¥è¯¢ç”¨æˆ·åº“ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨Spring Cloudå¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;æ¯ä¸ªå¾®æœåŠ¡é€šå¸¸è®¾è®¡ä¸ºMaven/Gradleå­æ¨¡å—&lt;/strong&gt;ï¼Œä»¥ç®€åŒ–ä¾èµ–ç®¡ç†å’Œé¡¹ç›®ç»“æ„ï¼›ä½†åœ¨éœ€è¦æŠ€æœ¯å¼‚æ„æ€§æˆ–å®Œå…¨è§£è€¦çš„åœºæ™¯ä¸‹ï¼Œ&lt;strong&gt;å¾®æœåŠ¡ä¹Ÿå¯ä½œä¸ºç‹¬ç«‹ä»£ç ä»“åº“å­˜åœ¨&lt;/strong&gt;ã€‚å®é™…é€‰æ‹©éœ€æƒè¡¡é¡¹ç›®è§„æ¨¡ã€å›¢é˜Ÿåä½œå’ŒæŠ€æœ¯éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="jpms"&gt;JPMS
&lt;/h2&gt;&lt;p&gt;Maven/Gradle å­æ¨¡å—å’Œ Java ä¸­çš„ Moduleï¼ˆJPMSï¼‰&lt;strong&gt;ä¸æ˜¯ä¸€å›äº‹&lt;/strong&gt;ã€‚å®ƒä»¬åˆ†åˆ«å±äº&lt;strong&gt;æ„å»ºå·¥å…·çš„é¡¹ç›®ç®¡ç†&lt;/strong&gt;å’Œ &lt;strong&gt;Java è¯­è¨€å±‚é¢çš„è¿è¡Œæ—¶å°è£…&lt;/strong&gt;ä¸¤ä¸ªä¸åŒç»´åº¦ï¼Œè™½æœ‰äº¤é›†ä½†æ ¸å¿ƒç›®æ ‡å’ŒæŠ€æœ¯å®ç°å·®å¼‚æ˜¾è‘—ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-æ ¸å¿ƒæ¦‚å¿µä¸ç›®æ ‡"&gt;ğŸ“¦ &lt;strong&gt;1. æ ¸å¿ƒæ¦‚å¿µä¸ç›®æ ‡&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Maven/Gradle å­æ¨¡å—&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Java Module (JPMS)&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®šä¹‰å±‚çº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ„å»ºå·¥å…·ï¼ˆBuild Toolï¼‰çš„é¡¹ç›®ç®¡ç†å•å…ƒ&lt;/td&gt;
&lt;td&gt;Java è¯­è¨€è§„èŒƒï¼ˆJSR 376ï¼‰çš„è¿è¡Œæ—¶å°è£…å•å…ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»£ç ç»„ç»‡ã€ä¾èµ–å¤ç”¨ã€æ„å»ºæ•ˆç‡ä¼˜åŒ–ï¼ˆå¦‚åˆ†æ¨¡å—ç¼–è¯‘ï¼‰&lt;/td&gt;
&lt;td&gt;å¼ºå°è£…æ€§ã€æ˜¾å¼ä¾èµ–ç®¡ç†ã€è¿è¡Œæ—¶å®‰å…¨éš”ç¦»ï¼ˆè§£å†³ &amp;ldquo;JAR Hell&amp;rdquo;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çˆ¶é¡¹ç›®èšåˆå­æ¨¡å—ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆ&lt;code&gt;pom.xml&lt;/code&gt;/&lt;code&gt;build.gradle&lt;/code&gt;ï¼‰ç®¡ç†ä¾èµ–ä¸æ„å»ºæµç¨‹&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;module-info.java&lt;/code&gt;å£°æ˜æ¨¡å—è¾¹ç•Œã€å¯¼å‡ºåŒ…å’Œä¾èµ–å…³ç³»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨é˜¶æ®µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ„å»ºæ—¶&lt;/strong&gt;ï¼ˆå¼€å‘é˜¶æ®µï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç¼–è¯‘æ—¶ + è¿è¡Œæ—¶&lt;/strong&gt;ï¼ˆå½±å“ç±»åŠ è½½æœºåˆ¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-2-æŠ€æœ¯å®ç°å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;2. æŠ€æœ¯å®ç°å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="mavengradle-å­æ¨¡å—"&gt;&lt;strong&gt;Maven/Gradle å­æ¨¡å—&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Maven&lt;/strong&gt;ï¼šçˆ¶ POM é€šè¿‡ &lt;code&gt;&amp;lt;modules&amp;gt;&lt;/code&gt;å®šä¹‰å­æ¨¡å—ï¼Œå­æ¨¡å—ç»§æ‰¿çˆ¶ä¾èµ–ï¼ˆ&lt;code&gt;&amp;lt;dependencyManagement&amp;gt;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gradle&lt;/strong&gt;ï¼šæ ¹é¡¹ç›®é€šè¿‡ &lt;code&gt;settings.gradle&lt;/code&gt;çš„ &lt;code&gt;include&lt;/code&gt;å£°æ˜å­æ¨¡å—ï¼Œä¾èµ–é€šè¿‡ &lt;code&gt;implementation project(':sub')&lt;/code&gt;å¼•ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ¨¡å—é—´ä»£ç éš”ç¦»ï¼ˆå¦‚å¾®æœåŠ¡çš„ç‹¬ç«‹æœåŠ¡æ¨¡å—ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼ˆé¿å…å†²çªï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¢é‡æ„å»ºï¼ˆä»…ç¼–è¯‘ä¿®æ”¹çš„æ¨¡å—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="java-module-jpms"&gt;&lt;strong&gt;Java Module (JPMS)&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ªæ¨¡å—éœ€å®šä¹‰ &lt;code&gt;module-info.java&lt;/code&gt;ï¼Œå£°æ˜ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;module com.example.core {
requires java.sql; // ä¾èµ–å…¶ä»–æ¨¡å—
exports com.example.api; // å¯¼å‡ºå…¬å…± API
opens com.example.impl; // å…è®¸åå°„è®¿é—®
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºå°è£…&lt;/strong&gt;ï¼šæœªå¯¼å‡ºï¼ˆ&lt;code&gt;exports&lt;/code&gt;ï¼‰çš„åŒ…å¯¹å…¶ä»–æ¨¡å—ä¸å¯è§ï¼ˆå³ä½¿ public ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–æ˜¾å¼åŒ–&lt;/strong&gt;ï¼šç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶ä¼šæ£€æŸ¥ &lt;code&gt;requires&lt;/code&gt;å£°æ˜çš„ä¾èµ–æ˜¯å¦æ»¡è¶³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œæ—¶ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;jlink&lt;/code&gt;ç”Ÿæˆæœ€å°åŒ– JREï¼ˆä»…åŒ…å«æ‰€éœ€æ¨¡å—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-å…³è”æ€§ä¸åä½œåœºæ™¯"&gt;ğŸ”— &lt;strong&gt;3. å…³è”æ€§ä¸åä½œåœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ä¸¤è€…ç‹¬ç«‹ï¼Œä½†åœ¨é¡¹ç›®ä¸­å¯ååŒå·¥ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å­æ¨¡å—ä½œä¸º Java Module&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªæ„å»ºå­æ¨¡å—ï¼ˆå¦‚ &lt;code&gt;user-service&lt;/code&gt;ï¼‰å¯ç‹¬ç«‹å®šä¹‰ä¸º Java Moduleï¼ˆå« &lt;code&gt;module-info.java&lt;/code&gt;ï¼‰ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘çš„è¿è¡Œæ—¶éš”ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–ä¼ é€’çš„å·®å¼‚&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ„å»ºå·¥å…·ä¾èµ–&lt;/strong&gt;ï¼šå­æ¨¡å— A ä¾èµ– Bï¼Œä»…éœ€åœ¨ &lt;code&gt;build.gradle&lt;/code&gt;å£°æ˜ &lt;code&gt;implementation project(':B')&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JPMS ä¾èµ–&lt;/strong&gt;ï¼šæ¨¡å— A éœ€åœ¨ &lt;code&gt;module-info.java&lt;/code&gt;ä¸­æ˜¾å¼å£°æ˜ &lt;code&gt;requires B&lt;/code&gt;ï¼Œå¦åˆ™æ— æ³•è®¿é—® B çš„å¯¼å‡ºåŒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;éæ¨¡å—åŒ– JARï¼ˆå¦‚ä¼ ç»Ÿåº“ï¼‰å¯ä½œä¸º&lt;strong&gt;è‡ªåŠ¨æ¨¡å—&lt;/strong&gt;ï¼ˆAutomatic Moduleï¼‰æˆ–æ”¾å…¥&lt;strong&gt;ç±»è·¯å¾„&lt;/strong&gt;ï¼ˆæœªå‘½åæ¨¡å—ï¼‰ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-4-å…³é”®å·®å¼‚æ€»ç»“"&gt;âš–ï¸ &lt;strong&gt;4. å…³é”®å·®å¼‚æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;Maven/Gradle å­æ¨¡å—&lt;/th&gt;
&lt;th&gt;Java Module&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é—®é¢˜åŸŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¡¹ç›®æ„å»ºç®¡ç†ä¸ç»„ç»‡&lt;/td&gt;
&lt;td&gt;ä»£ç å°è£…ä¸è¿è¡Œæ—¶å®‰å…¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;pom.xml&lt;/code&gt;/ &lt;code&gt;build.gradle&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;module-info.java&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–èŒƒå›´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ„å»ºæœŸ + ç¼–è¯‘æœŸï¼ˆä¼ é€’æ€§ä¾èµ–ï¼‰&lt;/td&gt;
&lt;td&gt;ç¼–è¯‘æœŸ + è¿è¡Œæ—¶ï¼ˆæ˜¾å¼å£°æ˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨æ¨¡å—è®¿é—®æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— å¼ºåˆ¶é™åˆ¶ï¼ˆä»£ç å¯è§å³å¯ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸¥æ ¼é€šè¿‡ &lt;code&gt;exports&lt;/code&gt;/&lt;code&gt;opens&lt;/code&gt;æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å·¥å…·æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Maven/Gradle æ’ä»¶&lt;/td&gt;
&lt;td&gt;JDK å†…ç½®ï¼ˆJava 9+ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-5-å®é™…åº”ç”¨å»ºè®®"&gt;ğŸ’¡ &lt;strong&gt;5. å®é™…åº”ç”¨å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–°é¡¹ç›®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆç”¨ &lt;strong&gt;Gradle/Maven å­æ¨¡å—&lt;/strong&gt;ç®¡ç†ä»£ç ç»“æ„ï¼Œæå‡æ„å»ºæ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒæœåŠ¡æ¨¡å—å¯å¯ç”¨ &lt;strong&gt;JPMS&lt;/strong&gt;ï¼Œå¼ºåŒ–è¾¹ç•Œè®¾è®¡ï¼ˆå¦‚ API æ¨¡å— &lt;code&gt;exports&lt;/code&gt;æ¥å£ï¼Œå®ç°æ¨¡å—éšè—ç»†èŠ‚ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—ç•™ç³»ç»Ÿè¿ç§»&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å…ˆæ‹†åˆ†ä¸ºæ„å»ºå­æ¨¡å—ï¼Œå†é€æ­¥ä¸ºå…³é”®æ¨¡å—æ·»åŠ  &lt;code&gt;module-info.java&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;jdeps&lt;/code&gt;åˆ†æä¾èµ–ï¼Œè§£å†³éæ³•åå°„è®¿é—®ï¼ˆ&lt;code&gt;--add-opens&lt;/code&gt;ä¸´æ—¶ç»•è¿‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹åˆ«æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„å»ºå·¥å…·çš„å­æ¨¡å—æ˜¯&lt;strong&gt;ç‰©ç†å±‚çº§åˆ’åˆ†&lt;/strong&gt;ï¼ˆç›®å½•åˆ†ç¦»ï¼‰ï¼ŒJava Module æ˜¯&lt;strong&gt;é€»è¾‘è¾¹ç•Œå°è£…&lt;/strong&gt;ï¼ˆåŒ…å¯è§æ€§æ§åˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Spring Boot ç­‰æ¡†æ¶éœ€é…åˆ &lt;code&gt;spring-modulith&lt;/code&gt;ç­‰æ–¹æ¡ˆé€‚é… JPMSï¼Œé¿å…åå°„è®¿é—®å¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡å˜æ¸…ä¸¤è€…å®šä½ï¼Œå¯åœ¨é¡¹ç›®ä¸­åˆ†å±‚åº”ç”¨ï¼š&lt;strong&gt;æ„å»ºå·¥å…·è§£å†³å·¥ç¨‹æ•ˆç‡é—®é¢˜ï¼ŒJPMS è§£å†³æ¶æ„æ²»ç†é—®é¢˜&lt;/strong&gt;ï¼Œå…±åŒæ‰“é€ é«˜å†…èšã€ä½è€¦åˆçš„ç°ä»£åŒ– Java åº”ç”¨ã€‚&lt;/p&gt;
&lt;h2 id="åŒºåˆ«"&gt;åŒºåˆ«
&lt;/h2&gt;&lt;p&gt;åœ¨ Java é¡¹ç›®æ¶æ„ä¸­ï¼Œå°† Gradle/Maven å­æ¨¡å—è§†ä¸ºä¸€ä¸ª&lt;strong&gt;é€»è¾‘ä¸Šçš„æ•´ä½“ Java Module&lt;/strong&gt; æ˜¯åˆç†çš„ç†è§£æ–¹å¼ã€‚è¿™ç§é€»è¾‘ç»Ÿä¸€æ€§æºäºé¡¹ç›®è®¾è®¡çš„æ¨¡å—åŒ–ç›®æ ‡ï¼Œä½†éœ€ç»“åˆæ„å»ºå·¥å…·ä¸è¯­è¨€è§„èŒƒçš„å…·ä½“å®ç°æœºåˆ¶æ¥åˆ†å±‚è§£è¯»ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆåˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-é€»è¾‘ç»Ÿä¸€æ€§çš„ä¾æ®"&gt;âœ… &lt;strong&gt;1. é€»è¾‘ç»Ÿä¸€æ€§çš„ä¾æ®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…±åŒç›®æ ‡ä¸è¾¹ç•Œ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¤šä¸ªå­æ¨¡å—ï¼ˆå¦‚ &lt;code&gt;user-service&lt;/code&gt;ã€&lt;code&gt;order-service&lt;/code&gt;ï¼‰æœåŠ¡äºåŒä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œé€šè¿‡&lt;strong&gt;çˆ¶æ¨¡å—ç»Ÿä¸€ç®¡ç†ä¾èµ–å’Œé…ç½®&lt;/strong&gt;ï¼ˆå¦‚ Maven çš„çˆ¶ POM æˆ– Gradle çš„æ ¹æ„å»ºè„šæœ¬ï¼‰ï¼Œå½¢æˆå†…èšçš„ä»£ç å•å…ƒã€‚è¿™ç§è®¾è®¡ç¬¦åˆæ¨¡å—åŒ–â€œé«˜å†…èšã€ä½è€¦åˆâ€çš„æ ¸å¿ƒåŸåˆ™ï¼Œå¯è§†ä¸ºé€»è¾‘æ•´ä½“ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾å¼ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å­æ¨¡å—é—´é€šè¿‡æ„å»ºå·¥å…·å£°æ˜ä¾èµ–ï¼ˆå¦‚ Gradle çš„ &lt;code&gt;implementation project(':module')&lt;/code&gt;æˆ– Maven çš„å­æ¨¡å—åæ ‡å¼•ç”¨ï¼‰ï¼Œæ„æˆ&lt;strong&gt;æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰&lt;/strong&gt;ï¼Œå…±åŒå®ç°ä¸šåŠ¡åŠŸèƒ½ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-ä¸-java-module-jpms-çš„æœ¬è´¨åŒºåˆ«"&gt;âš ï¸ &lt;strong&gt;2. ä¸ Java Module (JPMS) çš„æœ¬è´¨åŒºåˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å­æ¨¡å—åœ¨é€»è¾‘ä¸Šå±äºåŒä¸€é¡¹ç›®ï¼Œä½†&lt;strong&gt;ä¸ç­‰äº JPMS çš„ Module&lt;/strong&gt;ï¼Œå·®å¼‚ä¸»è¦ä½“ç°åœ¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;æ„å»ºå·¥å…·å­æ¨¡å— (Gradle/Maven)&lt;/th&gt;
&lt;th&gt;Java Module (JPMS)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒç›®æ ‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»£ç ç»„ç»‡ã€ä¾èµ–ç®¡ç†ã€æ„å»ºæ•ˆç‡ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;å¼ºå°è£…æ€§ã€è¿è¡Œæ—¶éš”ç¦»ã€æ˜¾å¼ä¾èµ–ç®¡ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;pom.xml&lt;/code&gt;/ &lt;code&gt;build.gradle&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;module-info.java&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä½œç”¨é˜¶æ®µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼€å‘ä¸æ„å»ºæ—¶&lt;/td&gt;
&lt;td&gt;ç¼–è¯‘æ—¶ + è¿è¡Œæ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¿é—®æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— å¼ºåˆ¶å°è£…ï¼ˆä»£ç å¯è§å³å¯ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸¥æ ¼é€šè¿‡ &lt;code&gt;exports&lt;/code&gt;/&lt;code&gt;opens&lt;/code&gt;æ§åˆ¶åŒ…å¯è§æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŠ€æœ¯å®ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‰©ç†ç›®å½•éš”ç¦»&lt;/td&gt;
&lt;td&gt;é€»è¾‘è¾¹ç•Œå°è£…ï¼ˆJVM ç±»åŠ è½½æœºåˆ¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®åŒºåˆ«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­æ¨¡å—æ˜¯&lt;strong&gt;ç‰©ç†å±‚çº§åˆ’åˆ†&lt;/strong&gt;ï¼ˆç›®å½•åˆ†ç¦»ï¼‰ï¼ŒJPMS æ˜¯ &lt;strong&gt;JVM å±‚çº§çš„é€»è¾‘å°è£…&lt;/strong&gt;ï¼ˆåŒ…å¯è§æ€§æ§åˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-3-åä½œåœºæ™¯é€»è¾‘æ•´ä½“æ€§çš„å®ç°æ–¹å¼"&gt;ğŸ”§ &lt;strong&gt;3. åä½œåœºæ™¯ï¼šé€»è¾‘æ•´ä½“æ€§çš„å®ç°æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶æŠ€æœ¯å®ç°åˆ†ç¦»ï¼Œä½†ä¸¤è€…å¯ååŒå¼ºåŒ–æ¨¡å—åŒ–è®¾è®¡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­æ¨¡å—ä½œä¸º JPMS çš„åŸºç¡€å•å…ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ„å»ºå­æ¨¡å—ï¼ˆå¦‚ &lt;code&gt;common-utils&lt;/code&gt;ï¼‰å¯ç‹¬ç«‹å®šä¹‰ä¸º Java Moduleï¼ˆå« &lt;code&gt;module-info.java&lt;/code&gt;ï¼‰ï¼Œå®ç°ä¸šåŠ¡å†…èšä¸è¿è¡Œæ—¶éš”ç¦»çš„åŒé‡ç›®æ ‡ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ä¼ é€’çš„ååŒç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„å»ºå·¥å…·ä¾èµ–&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;build.gradle&lt;/code&gt;ä¸­å£°æ˜ &lt;code&gt;implementation project(':B')&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JPMS ä¾èµ–&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;module-info.java&lt;/code&gt;ä¸­æ˜¾å¼å£°æ˜ &lt;code&gt;requires B&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤è€…å…±åŒç¡®ä¿æ¨¡å—é—´ä¾èµ–çš„æ˜¾å¼åŒ–å’Œä¸€è‡´æ€§ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§„é¿å†²çª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çˆ¶æ¨¡å—ç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼ˆå¦‚ Maven çš„ &lt;code&gt;&amp;lt;dependencyManagement&amp;gt;&lt;/code&gt;ï¼‰ï¼Œé¿å…å­æ¨¡å—é—´æˆ– JPMS çš„ç‰ˆæœ¬å†²çª ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“åˆ†å±‚ç†è§£é€»è¾‘æ•´ä½“æ€§"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šåˆ†å±‚ç†è§£é€»è¾‘æ•´ä½“æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¡¹ç›®æ¶æ„å±‚&lt;/strong&gt;ï¼šâœ… &lt;strong&gt;æ˜¯é€»è¾‘æ•´ä½“&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Gradle/Maven å¤šæ¨¡å—é¡¹ç›®é€šè¿‡çˆ¶æ¨¡å—ç»Ÿä¸€é…ç½®ã€å­æ¨¡å—ååŒå®ç°ä¸šåŠ¡ç›®æ ‡ï¼Œæ„æˆå®Œæ•´çš„åº”ç”¨ç³»ç»Ÿ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯­è¨€è§„èŒƒå±‚&lt;/strong&gt;ï¼šâŒ &lt;strong&gt;ä¸æ˜¯ JPMS Module&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å­æ¨¡å—æ— è¿è¡Œæ—¶å¼ºå°è£…èƒ½åŠ›ï¼Œéœ€é¢å¤–é€šè¿‡ &lt;code&gt;module-info.java&lt;/code&gt;å®ç° JPMS çš„éš”ç¦» ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–°é¡¹ç›®&lt;/strong&gt;ï¼šç”¨æ„å»ºå·¥å…·ç®¡ç†ç‰©ç†ç»“æ„ï¼ˆå­æ¨¡å—ï¼‰ï¼Œä¸ºæ ¸å¿ƒæ¨¡å—æ·»åŠ  JPMS å°è£… ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—ç•™ç³»ç»Ÿ&lt;/strong&gt;ï¼šå…ˆæ‹†åˆ†ä¸ºå­æ¨¡å—ï¼Œå†é€æ­¥å¼•å…¥ JPMS æ²»ç†è¾¹ç•Œ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹å…³ç³»å›¾&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;é€»è¾‘é¡¹ç›® (MyApp)
â”œâ”€â”€ æ„å»ºå­æ¨¡å— [Maven/Gradle]
â”‚ â”œâ”€â”€ user-service (å« module-info.java â†’ JPMS Module)
â”‚ â””â”€â”€ order-service (ä¾èµ– user-service)
â””â”€â”€ çˆ¶æ¨¡å— (ç»Ÿä¸€ä¾èµ–ç®¡ç†)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;é€šè¿‡åˆ†å±‚è®¾è®¡ï¼Œå…¼é¡¾å·¥ç¨‹æ•ˆç‡ä¸æ¶æ„æ²»ç†&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="è®¿é—®æƒé™"&gt;è®¿é—®æƒé™
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œ&lt;code&gt;protected&lt;/code&gt;ã€&lt;code&gt;default&lt;/code&gt;ï¼ˆæ— ä¿®é¥°ç¬¦ï¼‰å’Œ &lt;code&gt;private&lt;/code&gt;æ˜¯ä¸‰ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Œç”¨äºæ§åˆ¶ç±»æˆå‘˜çš„å¯è§æ€§å’Œè®¿é—®èŒƒå›´ã€‚å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;è®¿é—®æƒé™çš„ä¸¥æ ¼ç¨‹åº¦å’Œåº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼Œå…·ä½“å¯¹æ¯”å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è®¿é—®èŒƒå›´å¯¹æ¯”è¡¨"&gt;ğŸ“Š &lt;strong&gt;è®¿é—®èŒƒå›´å¯¹æ¯”è¡¨&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è®¿é—®ä¿®é¥°ç¬¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å½“å‰ç±»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŒä¸€åŒ…å†…&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸åŒåŒ…å­ç±»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¶ä»–åŒ…ï¼ˆéå­ç±»ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;private&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ”&lt;/td&gt;
&lt;td&gt;âœ–&lt;/td&gt;
&lt;td&gt;âœ–&lt;/td&gt;
&lt;td&gt;âœ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;default&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ”&lt;/td&gt;
&lt;td&gt;âœ”&lt;/td&gt;
&lt;td&gt;âœ–&lt;/td&gt;
&lt;td&gt;âœ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;protected&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ”&lt;/td&gt;
&lt;td&gt;âœ”&lt;/td&gt;
&lt;td&gt;âœ”&lt;/td&gt;
&lt;td&gt;âœ–&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼š&lt;code&gt;default&lt;/code&gt;æ˜¯éšå¼ä¿®é¥°ç¬¦ï¼ˆä¸å†™ä»»ä½•å…³é”®å­—ï¼‰ï¼Œ&lt;code&gt;protected&lt;/code&gt;å’Œ &lt;code&gt;private&lt;/code&gt;éœ€æ˜¾å¼å£°æ˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-è¯¦ç»†åŒºåˆ«è§£æ"&gt;ğŸ” &lt;strong&gt;è¯¦ç»†åŒºåˆ«è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;private&lt;/code&gt;ï¼ˆæœ€ä¸¥æ ¼ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¿é—®èŒƒå›´&lt;/strong&gt;ï¼šä»…é™&lt;strong&gt;å½“å‰ç±»å†…éƒ¨&lt;/strong&gt;ï¼Œå…¶ä»–ç±»ï¼ˆåŒ…æ‹¬åŒåŒ…æˆ–å­ç±»ï¼‰å‡ä¸å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°è£…æ•æ„Ÿæ•°æ®ï¼ˆå¦‚å¯†ç ï¼‰ï¼Œé€šè¿‡ &lt;code&gt;getter/setter&lt;/code&gt;æ–¹æ³•é—´æ¥è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;éšè—å·¥å…·æ–¹æ³•ï¼ˆå¦‚å†…éƒ¨è®¡ç®—é€»è¾‘ï¼‰ï¼Œé¿å…å¤–éƒ¨è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class User {
private String password; // ä»…æœ¬ç±»å¯è®¿é—®
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;default&lt;/code&gt;ï¼ˆåŒ…çº§ç§æœ‰ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¿é—®èŒƒå›´&lt;/strong&gt;ï¼š&lt;strong&gt;å½“å‰ç±» + åŒä¸€åŒ…å†…çš„å…¶ä»–ç±»&lt;/strong&gt;ã€‚ä¸åŒåŒ…ä¸­çš„ç±»ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰å‡ä¸å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…±äº«å·¥å…·ç±»æˆ–é…ç½®ç»™åŒåŒ…æ¨¡å—ï¼ˆå¦‚å·¥å…·ç±» &lt;code&gt;StringUtils&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶è·¨åŒ…è®¿é—®ï¼Œå®ç°æ¨¡å—åŒ–å°è£…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class Logger { // é»˜è®¤ä¿®é¥°ç¬¦
void log(String message) { // åŒåŒ…å†…å¯è°ƒç”¨
System.out.println(message);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;protected&lt;/code&gt;ï¼ˆç»§æ‰¿å‹å¥½ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¿é—®èŒƒå›´&lt;/strong&gt;ï¼š&lt;strong&gt;å½“å‰ç±» + åŒä¸€åŒ…å†…ç±» + ä¸åŒåŒ…å­ç±»&lt;/strong&gt;ã€‚éå­ç±»çš„å¤–éƒ¨åŒ…ç±»ä¸å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çˆ¶ç±»å®šä¹‰å¯è¢«å­ç±»é‡å†™çš„æ–¹æ³•ï¼ˆå¦‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å­ç±»éœ€ç›´æ¥è®¿é—®çˆ¶ç±»æˆå‘˜ï¼ˆå¦‚ &lt;code&gt;protected int id;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class Animal {
protected void breathe() { // å­ç±»å¯è®¿é—®
System.out.println(&amp;#34;Breathing...&amp;#34;);
}
}
public class Dog extends Animal {
public void test() {
breathe(); // âœ” å­ç±»è°ƒç”¨çˆ¶ç±»protectedæ–¹æ³•
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç±»ä¿®é¥°ç¬¦çš„é™åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;private&lt;/code&gt;å’Œ &lt;code&gt;protected&lt;/code&gt;&lt;strong&gt;ä¸èƒ½ä¿®é¥°å¤–éƒ¨ç±»&lt;/strong&gt;ï¼ˆä»…èƒ½ä¿®é¥°å†…éƒ¨ç±»ï¼‰ï¼Œå¤–éƒ¨ç±»åªèƒ½ç”¨ &lt;code&gt;public&lt;/code&gt;æˆ– &lt;code&gt;default&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»§æ‰¿ä¸­çš„å¯è§æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å­ç±»å¯è®¿é—®çˆ¶ç±»çš„ &lt;code&gt;protected&lt;/code&gt;æˆå‘˜ï¼Œä½†&lt;strong&gt;ä¸èƒ½è®¿é—® &lt;code&gt;private&lt;/code&gt;æˆå‘˜&lt;/strong&gt;ï¼ˆå³ä½¿ç»§æ‰¿ä¹Ÿéšè—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡åŸåˆ™&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°è£…æ€§ä¼˜å…ˆ&lt;/strong&gt;ï¼šå°½é‡ç”¨ &lt;code&gt;private&lt;/code&gt;ï¼Œå¿…è¦æ—¶é€šè¿‡ &lt;code&gt;protected&lt;/code&gt;å¼€æ”¾ç»™å­ç±»ï¼Œé¿å…æ»¥ç”¨ &lt;code&gt;public&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ…å†…åä½œ&lt;/strong&gt;ï¼šåŒåŒ…æ¨¡å—é—´ç”¨ &lt;code&gt;default&lt;/code&gt;å…±äº«ï¼Œå‡å°‘è·¨åŒ…è€¦åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“é€‰æ‹©ç­–ç•¥"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šé€‰æ‹©ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;private&lt;/code&gt;&lt;/strong&gt;ï¼šéšè—å®ç°ç»†èŠ‚ï¼Œå¼ºåˆ¶é€šè¿‡æ¥å£è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;default&lt;/code&gt;&lt;/strong&gt;ï¼šåŒåŒ…å†…å…±äº«å·¥å…·æˆ–é…ç½®ï¼Œç¦æ­¢è·¨åŒ…è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;protected&lt;/code&gt;&lt;/strong&gt;ï¼šæ”¯æŒè·¨åŒ…ç»§æ‰¿ï¼Œå…è®¸å­ç±»æ‰©å±•çˆ¶ç±»è¡Œä¸ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®é™…å¼€å‘ä¸­ï¼Œ&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©æœ€ä¸¥æ ¼çš„æƒé™&lt;/strong&gt;ï¼ˆå¦‚èƒ½ç”¨ &lt;code&gt;private&lt;/code&gt;åˆ™ä¸ç”¨ &lt;code&gt;default&lt;/code&gt;ï¼‰ï¼Œå†æŒ‰éœ€æ”¾å®½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="order"&gt;@Order
&lt;/h2&gt;&lt;p&gt;åœ¨ Java Spring æ¡†æ¶ä¸­ï¼Œå½“å¤šä¸ªç›¸åŒç±»å‹çš„ &lt;code&gt;@Component&lt;/code&gt;ä¸­éƒ¨åˆ†æŒ‡å®šäº† &lt;code&gt;@Order&lt;/code&gt;å€¼è€Œå…¶ä»–æœªæŒ‡å®šæ—¶ï¼Œå…¶è¡Œä¸ºä¸»è¦ç”±ä»¥ä¸‹è§„åˆ™å†³å®šï¼š&lt;/p&gt;
&lt;h3 id="-1-é»˜è®¤å€¼æœºåˆ¶"&gt;âš™ï¸ 1. &lt;strong&gt;é»˜è®¤å€¼æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœªæŒ‡å®š &lt;code&gt;@Order&lt;/code&gt;çš„ç»„ä»¶&lt;/strong&gt;ï¼šä¼šè¢«éšå¼èµ‹äºˆé»˜è®¤å€¼ &lt;code&gt;Ordered.LOWEST_PRECEDENCE&lt;/code&gt;ï¼ˆå³ &lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;ï¼‰ï¼Œè¡¨ç¤ºæœ€ä½ä¼˜å…ˆçº§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡å®š &lt;code&gt;@Order&lt;/code&gt;çš„ç»„ä»¶&lt;/strong&gt;ï¼šæŒ‰æ³¨è§£å€¼æ’åºï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆä¾‹å¦‚ &lt;code&gt;@Order(1)&lt;/code&gt;ä¼˜å…ˆäº &lt;code&gt;@Order(2)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-2-æ’åºè§„åˆ™ä¸ä½ç½®"&gt;ğŸ”€ 2. &lt;strong&gt;æ’åºè§„åˆ™ä¸ä½ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•´ä½“æ’åºé€»è¾‘&lt;/strong&gt;ï¼šæ‰€æœ‰ç»„ä»¶æŒ‰ä¼˜å…ˆçº§åˆ†ç»„æ’åºï¼š
&lt;ul&gt;
&lt;li&gt;æœ€é«˜ä¼˜å…ˆçº§ï¼šå®ç° &lt;code&gt;PriorityOrdered&lt;/code&gt;æ¥å£çš„ç»„ä»¶ï¼ˆå¦‚æ¡†æ¶å†…éƒ¨æ‰©å±•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸­ç­‰ä¼˜å…ˆçº§ï¼šæ˜¾å¼æŒ‡å®š &lt;code&gt;@Order&lt;/code&gt;æˆ–å®ç° &lt;code&gt;Ordered&lt;/code&gt;æ¥å£çš„ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šæœªæŒ‡å®š &lt;code&gt;@Order&lt;/code&gt;çš„ç»„ä»¶ï¼ˆé»˜è®¤ &lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœªæŒ‡å®šå€¼ç»„ä»¶çš„é¡ºåº&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨æ³¨å…¥é›†åˆï¼ˆå¦‚ &lt;code&gt;List&amp;lt;Service&amp;gt;&lt;/code&gt;ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼š&lt;strong&gt;æ’åœ¨æ‰€æœ‰æœ‰åºç»„ä»¶ä¹‹å&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¤šä¸ªæœªæŒ‡å®šå€¼çš„ç»„ä»¶ä¹‹é—´&lt;strong&gt;é¡ºåºä¸ç¡®å®š&lt;/strong&gt;ï¼ˆå¯èƒ½å—ç±»åŠ è½½é¡ºåºå½±å“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-3-å…¸å‹åœºæ™¯ç¤ºä¾‹"&gt;âš ï¸ 3. &lt;strong&gt;å…¸å‹åœºæ™¯ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é›†åˆæ³¨å…¥é¡ºåº&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component @Order(1) class ServiceA implements MyService {}
@Component @Order(2) class ServiceB implements MyService {}
@Component class ServiceC implements MyService {} // é»˜è®¤ Order=Integer.MAX_VALUE
@Autowired
private List&amp;lt;MyService&amp;gt; services; // é¡ºåºï¼šServiceA â†’ ServiceB â†’ ServiceC
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼šåœ¨åˆ‡é¢ï¼ˆAOPï¼‰ã€è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€äº‹ä»¶ç›‘å¬å™¨ç­‰åœºæ™¯ä¸­ï¼ŒæœªæŒ‡å®šå€¼çš„ç»„ä»¶æœ€åæ‰§è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-4-å†²çªä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ› ï¸ 4. &lt;strong&gt;å†²çªä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›¸åŒ &lt;code&gt;@Order&lt;/code&gt;å€¼&lt;/strong&gt;ï¼šè‹¥å¤šä¸ªç»„ä»¶æŒ‡å®šç›¸åŒå€¼ï¼ˆå¦‚å‡ &lt;code&gt;@Order(1)&lt;/code&gt;ï¼‰ï¼Œå…¶ç›¸å¯¹é¡ºåºä¸ç¡®å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ &lt;code&gt;@Primary&lt;/code&gt;çš„å…³ç³»&lt;/strong&gt;ï¼š&lt;code&gt;@Primary&lt;/code&gt;æ³¨è§£çš„ç»„ä»¶åœ¨å•ç‹¬æ³¨å…¥æ—¶ä¼˜å…ˆï¼Œä½†ä¸å½±å“é›†åˆä¸­çš„æ’åºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;ï¼šå¤§è§„æ¨¡ç»„ä»¶æ’åºå¯èƒ½å¢åŠ å¯åŠ¨å¼€é”€ï¼Œå»ºè®®ä»…å¯¹å¿…è¦ç»„ä»¶æ˜¾å¼æŒ‡å®šé¡ºåºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æœªæŒ‡å®š &lt;code&gt;@Order&lt;/code&gt;çš„ç»„ä»¶ä¼šä»¥æœ€ä½ä¼˜å…ˆçº§ï¼ˆ&lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;ï¼‰å‚ä¸æ’åºï¼Œå§‹ç»ˆä½äºæœ‰åºç»„ä»¶ä¹‹åï¼Œä¸”åŒç±»æœªæŒ‡å®šç»„ä»¶é—´é¡ºåºä¸å¯æ§ã€‚è‹¥éœ€ç²¾ç¡®æ§åˆ¶é¡ºåºï¼Œåº”ä¸ºæ‰€æœ‰ç»„ä»¶æ˜¾å¼èµ‹å€¼å¹¶é¢„ç•™é—´éš”å€¼ï¼ˆå¦‚ &lt;code&gt;@Order(100)&lt;/code&gt;ã€&lt;code&gt;@Order(200)&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šä½¿ç”¨å¸¸é‡ç±»ç®¡ç†é¡ºåºå€¼ï¼ˆå¦‚ &lt;code&gt;OrderConstants.SECURITY_FILTER&lt;/code&gt;ï¼‰ï¼Œå¹¶æ·»åŠ æ–‡æ¡£è¯´æ˜ä¼˜å…ˆçº§é€»è¾‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="loggiglevelroot"&gt;Loggig.level.root
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot ä¸­ï¼Œ&lt;code&gt;logging.level.root&lt;/code&gt;æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ—¥å¿—é…ç½®å±æ€§ï¼Œå®ƒç”¨äºè®¾ç½®&lt;strong&gt;æ ¹æ—¥å¿—è®°å½•å™¨ (Root Logger) çš„æ—¥å¿—çº§åˆ«&lt;/strong&gt;ï¼Œå……å½“æ‰€æœ‰å…¶ä»–æ—¥å¿—è®°å½•å™¨çš„é»˜è®¤çˆ¶çº§å’Œå…¨å±€æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯&lt;strong&gt;ç»Ÿä¸€æ§åˆ¶åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰æœªè¢«ç‰¹å®šåŒ…æˆ–ç±»å•ç‹¬è®¾ç½®çº§åˆ«çš„æ—¥å¿—è¾“å‡º&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="-ç†è§£æ—¥å¿—çº§åˆ«"&gt;ğŸ“Š ç†è§£æ—¥å¿—çº§åˆ«
&lt;/h3&gt;&lt;p&gt;æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜é€šå¸¸åˆ†ä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;TRACE`&amp;lt; `DEBUG`&amp;lt; `INFO`&amp;lt; `WARN`&amp;lt; `ERROR`&amp;lt; `FATAL`/`OFF
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è®¾ç½®æŸä¸€çº§åˆ«åï¼Œåªæœ‰è¯¥çº§åˆ«åŠæ›´é«˜çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ä¼šè¢«è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œè‹¥è®¾ç½® &lt;code&gt;logging.level.root=INFO&lt;/code&gt;ï¼Œåˆ™ &lt;code&gt;INFO&lt;/code&gt;ã€&lt;code&gt;WARN&lt;/code&gt;ã€&lt;code&gt;ERROR&lt;/code&gt;çº§åˆ«çš„æ—¥å¿—ä¼šè¢«è¾“å‡ºï¼Œè€Œ &lt;code&gt;TRACE&lt;/code&gt;å’Œ &lt;code&gt;DEBUG&lt;/code&gt;çº§åˆ«çš„æ—¥å¿—åˆ™ä¸ä¼šè¢«è¾“å‡ºã€‚&lt;/p&gt;
&lt;h3 id="-logginglevelroot-çš„ä½œç”¨ä¸é…ç½®"&gt;ğŸ”§ logging.level.root çš„ä½œç”¨ä¸é…ç½®
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;logging.level.root&lt;/code&gt;ä¸ºæ•´ä¸ªåº”ç”¨æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„æ—¥å¿—çº§åˆ«åŸºå‡†ã€‚è¿™æ„å‘³ç€ä»»ä½•æ²¡æœ‰åœ¨ &lt;code&gt;logging.level.&amp;lt;package-or-class&amp;gt;&lt;/code&gt;ä¸­æ˜ç¡®æŒ‡å®šçº§åˆ«çš„åŒ…æˆ–ç±»ï¼Œéƒ½ä¼šç»§æ‰¿è¿™ä¸ªæ ¹æ—¥å¿—è®°å½•å™¨è®¾ç½®çš„çº§åˆ«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¸¸è§é…ç½®ç¤ºä¾‹ï¼ˆåœ¨ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;ä¸­ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# è®¾ç½®æ ¹æ—¥å¿—çº§åˆ«ä¸º WARN
logging.level.root = WARN
# ä¸ºç‰¹å®šåŒ…æˆ–ç±»è®¾ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«
logging.level.org.springframework.web = DEBUG
logging.level.com.yourcompany.service = INFO
logging.level.com.yourcompany.security = TRACE
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰æœªè¢«æ˜ç¡®è®¾ç½®çš„ç»„ä»¶ï¼ˆåŒ…ã€ç±»ï¼‰çš„æ—¥å¿—çº§åˆ«é»˜è®¤ä¸º &lt;code&gt;WARN&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;org.springframework.web&lt;/code&gt;åŒ…ä¸‹çš„æ—¥å¿—çº§åˆ«è¢«è®¾ç½®ä¸º &lt;code&gt;DEBUG&lt;/code&gt;ï¼ˆé€‚ç”¨äºè°ƒè¯•Webç›¸å…³é—®é¢˜æ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;com.yourcompany.service&lt;/code&gt;åŒ…ä¸‹çš„æ—¥å¿—çº§åˆ«è¢«è®¾ç½®ä¸º &lt;code&gt;INFO&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;com.yourcompany.security&lt;/code&gt;åŒ…ä¸‹çš„æ—¥å¿—çº§åˆ«è¢«è®¾ç½®ä¸º &lt;code&gt;TRACE&lt;/code&gt;ï¼ˆå¯èƒ½ä¼šè¾“å‡ºéå¸¸è¯¦ç»†çš„æµç¨‹ä¿¡æ¯ï¼Œç”¨äºæ·±å…¥è¿½è¸ªå®‰å…¨ç›¸å…³é—®é¢˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-é…ç½®ç¤ºä¾‹ä¸å†™æ³•"&gt;ğŸ“ é…ç½®ç¤ºä¾‹ä¸å†™æ³•
&lt;/h3&gt;&lt;p&gt;æ‚¨å¯ä»¥åœ¨ &lt;code&gt;application.properties&lt;/code&gt;æˆ– &lt;code&gt;application.yml&lt;/code&gt;æ–‡ä»¶ä¸­é…ç½® &lt;code&gt;logging.level.root&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ application.properties ä¸­çš„å†™æ³•ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;logging.level.root=INFO
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;åœ¨ application.yml ä¸­çš„å†™æ³•ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;logging:
level:
root: INFO
org.springframework: WARN
com.example.demo: DEBUG
com.example.demo.service.MyService: ERROR
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹"&gt;ğŸ“Œ æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒåŒºåˆ†&lt;/strong&gt;ï¼šå»ºè®®æ ¹æ®ä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰è®¾ç½®ä¸åŒçš„æ ¹æ—¥å¿—çº§åˆ«ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œä¸ºäº†æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œé€šå¸¸è®¾ç½®ä¸º &lt;code&gt;WARN&lt;/code&gt;æˆ– &lt;code&gt;ERROR&lt;/code&gt;ï¼›åœ¨å¼€å‘ç¯å¢ƒï¼Œä¸ºäº†ä¾¿äºè°ƒè¯•ï¼Œå¯ä»¥è®¾ç½®ä¸º &lt;code&gt;DEBUG&lt;/code&gt;æˆ– &lt;code&gt;TRACE&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…åˆç‰¹å®šè®°å½•å™¨ä½¿ç”¨&lt;/strong&gt;ï¼šåˆ©ç”¨ &lt;code&gt;logging.level.root&lt;/code&gt;è¿›è¡Œå…¨å±€æ§åˆ¶ï¼ŒåŒæ—¶ä½¿ç”¨ &lt;code&gt;logging.level.&amp;lt;name&amp;gt;&lt;/code&gt;ä¸ºå…³é”®æ¨¡å—æˆ–éœ€è¦è¯¦ç»†æ’æŸ¥é—®é¢˜çš„åŒ…/ç±»è®¾ç½®æ›´ä½çš„çº§åˆ«ï¼ˆå¦‚ &lt;code&gt;DEBUG&lt;/code&gt;ï¼‰ï¼Œå®ç°ç²¾ç»†åŒ–çš„æ—¥å¿—æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå½“å­˜åœ¨å¤šä¸ªæ—¥å¿—é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;logback.xml&lt;/code&gt;, &lt;code&gt;application.properties&lt;/code&gt;, &lt;code&gt;logback-spring.xml&lt;/code&gt;ï¼‰æ—¶ï¼ŒååŠ è½½çš„é…ç½®é€šå¸¸ä¼šè¦†ç›–å…ˆåŠ è½½çš„é…ç½®ã€‚Spring Boot æ¨èä½¿ç”¨ &lt;code&gt;logback-spring.xml&lt;/code&gt;è¿›è¡Œæ›´å¤æ‚å’Œçµæ´»çš„æ—¥å¿—é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç•™æ„æ€§èƒ½&lt;/strong&gt;ï¼šè¿‡ä½çš„æ—¥å¿—çº§åˆ«ï¼ˆå¦‚ &lt;code&gt;DEBUG&lt;/code&gt;, &lt;code&gt;TRACE&lt;/code&gt;ï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—è¾“å‡ºï¼Œå¯èƒ½æ¶ˆè€—I/Oèµ„æºå¹¶å½±å“æ€§èƒ½ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;logging.level.root&lt;/code&gt;æ˜¯ Spring Boot æ—¥å¿—é…ç½®çš„åŸºçŸ³ï¼Œå®ƒæä¾›äº†&lt;strong&gt;å…¨å±€é»˜è®¤çš„æ—¥å¿—çº§åˆ«&lt;/strong&gt;ã€‚é€šè¿‡åˆç†è®¾ç½®å®ƒï¼Œå¹¶ç»“åˆä¸ºç‰¹å®šåŒ…æˆ–ç±»è®¾ç½®çº§åˆ«ï¼Œæ‚¨å¯ä»¥æœ‰æ•ˆåœ°å¹³è¡¡æ—¥å¿—ä¿¡æ¯çš„è¯¦ç»†ç¨‹åº¦å’Œç³»ç»Ÿæ€§èƒ½ï¼Œä»è€Œæ›´å¥½åœ°ç›‘æ§ã€è°ƒè¯•å’Œç»´æŠ¤æ‚¨çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›ä»¥ä¸Šä¿¡æ¯èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ &lt;code&gt;logging.level.root&lt;/code&gt;ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Spring Cloud Stream</title><link>https://dyhes.github.io/p/shopeespring-cloud-stream/</link><pubDate>Thu, 21 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeespring-cloud-stream/</guid><description>&lt;h2 id="spring-integration"&gt;Spring Integration
&lt;/h2&gt;&lt;p&gt;Spring Integration æ˜¯ Spring æ¡†æ¶çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œä¸“æ³¨äºå®ç°&lt;strong&gt;ä¼ä¸šé›†æˆæ¨¡å¼ï¼ˆEnterprise Integration Patterns, EIPï¼‰&lt;/strong&gt;ï¼Œæ—¨åœ¨é€šè¿‡æ¶ˆæ¯é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å‹ç®€åŒ–ç³»ç»Ÿé—´é€šä¿¡å’Œé›†æˆã€‚å®ƒæ‰©å±•äº† Spring çš„æ ¸å¿ƒæ¶ˆæ¯å¤„ç†èƒ½åŠ›ï¼ˆ&lt;code&gt;Spring Messaging&lt;/code&gt;ï¼‰ï¼Œæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„ç»„ä»¶å’ŒæŠ½è±¡ï¼Œä»¥æ„å»ºæ¾è€¦åˆã€å¯æ‰©å±•çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒæ¦‚å¿µå’Œç‰¹æ€§çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€æ ¸å¿ƒæ¦‚å¿µä¸ç»„ä»¶"&gt;ğŸ§± ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸ç»„ä»¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯ï¼ˆMessageï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»“æ„&lt;/strong&gt;ï¼šåŒ…å«&lt;strong&gt;æœ‰æ•ˆè´Ÿè½½ï¼ˆPayloadï¼‰&lt;/strong&gt;ï¼ˆå®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå¦‚å¯¹è±¡ã€å­—ç¬¦ä¸²ï¼‰å’Œ&lt;strong&gt;æ ‡å¤´ï¼ˆHeaderï¼‰&lt;/strong&gt;ï¼ˆå…ƒæ•°æ®ï¼Œå¦‚æ¶ˆæ¯IDã€æ—¶é—´æˆ³ã€æ¥æºæ ‡è¯†ç­‰ï¼‰ã€‚æ ‡å¤´å¯ç”¨äºä¼ é€’è·¯ç”±ã€ä¼˜å…ˆçº§ç­‰é™„åŠ ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šä½œä¸ºæ•°æ®è½½ä½“ï¼Œå®ç°ç³»ç»Ÿé—´è§£è€¦é€šä¿¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯é€šé“ï¼ˆMessage Channelï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥é€šé“ï¼ˆDirectChannelï¼‰&lt;/strong&gt;ï¼šç‚¹å¯¹ç‚¹é€šä¿¡ï¼Œé»˜è®¤åŒæ­¥å¤„ç†ï¼Œæ”¯æŒäº‹åŠ¡ä¼ æ’­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘å¸ƒ-è®¢é˜…é€šé“ï¼ˆPublishSubscribeChannelï¼‰&lt;/strong&gt;ï¼šå¹¿æ’­æ¶ˆæ¯è‡³æ‰€æœ‰è®¢é˜…è€…ï¼Œé€‚ç”¨äºäº‹ä»¶é€šçŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜Ÿåˆ—é€šé“ï¼ˆQueueChannelï¼‰&lt;/strong&gt;ï¼šå¼‚æ­¥ç¼“å†²æ¶ˆæ¯ï¼Œæ”¯æŒå®¹é‡é™åˆ¶å’ŒæŒä¹…åŒ–ï¼Œé˜²æ­¢æ¶ˆè´¹è€…è¿‡è½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§é€šé“ï¼ˆPriorityChannelï¼‰&lt;/strong&gt;ï¼šæŒ‰æ¶ˆæ¯ä¼˜å…ˆçº§æ’åºå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¦ä¼šé€šé“ï¼ˆRendezvousChannelï¼‰&lt;/strong&gt;ï¼šå®ç°â€œè¯·æ±‚-å“åº”â€åŒæ­¥äº¤äº’ï¼Œå‘é€æ–¹é˜»å¡ç›´è‡³æ¥æ”¶æ–¹å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯ç«¯ç‚¹ï¼ˆMessage Endpointï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šè¿æ¥é€šé“ä¸ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†æ¶ˆæ¯çš„èµ·ç‚¹æˆ–ç»ˆç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§ç±»å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æ¿€æ´»å™¨ï¼ˆService Activatorï¼‰&lt;/strong&gt;ï¼šè°ƒç”¨ä¸šåŠ¡æ–¹æ³•å¤„ç†æ¶ˆæ¯ï¼ˆå¦‚ &lt;code&gt;@ServiceActivator&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±å™¨ï¼ˆRouterï¼‰&lt;/strong&gt;ï¼šåŸºäºå†…å®¹ï¼ˆå¦‚æ ‡å¤´æˆ–è´Ÿè½½ç±»å‹ï¼‰åŠ¨æ€è·¯ç”±æ¶ˆæ¯è‡³ä¸åŒé€šé“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½¬æ¢å™¨ï¼ˆTransformerï¼‰&lt;/strong&gt;ï¼šä¿®æ”¹æ¶ˆæ¯æ ¼å¼ï¼ˆå¦‚ JSON â†’ å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ»¤å™¨ï¼ˆFilterï¼‰&lt;/strong&gt;ï¼šæ‹¦æˆªä¸ç¬¦åˆæ¡ä»¶çš„æ¶ˆæ¯ï¼ˆå¦‚ç©ºæ¶ˆæ¯ä¸¢å¼ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚é…å™¨ï¼ˆAdapterï¼‰&lt;/strong&gt;ï¼šé›†æˆå¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚æ–‡ä»¶ã€æ•°æ®åº“ã€HTTPï¼‰ï¼Œå®ç°åè®®è½¬æ¢ï¼ˆå¦‚ &lt;code&gt;FileReadingMessageSource&lt;/code&gt;ç›‘å¬æ–‡ä»¶å˜æ›´ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒé›†æˆæ¨¡å¼ä¸åŠŸèƒ½"&gt;ğŸ”§ äºŒã€é›†æˆæ¨¡å¼ä¸åŠŸèƒ½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼ä¸šé›†æˆæ¨¡å¼ï¼ˆEIPï¼‰æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±ï¼ˆRoutingï¼‰&lt;/strong&gt;ï¼šåŠ¨æ€åˆ†å‘æ¶ˆæ¯è‡³ä¸åŒå¤„ç†å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èšåˆï¼ˆAggregationï¼‰&lt;/strong&gt;ï¼šåˆå¹¶å¤šä¸ªç›¸å…³æ¶ˆæ¯ï¼ˆå¦‚è®¢å•åˆ†é¡¹åˆå¹¶ä¸ºæ€»å•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‹†åˆ†ï¼ˆSplittingï¼‰&lt;/strong&gt;ï¼šå°†å¤æ‚æ¶ˆæ¯æ‹†åˆ†ä¸ºå­æ¶ˆæ¯ç‹¬ç«‹å¤„ç†ï¼ˆå¦‚æ‰¹é‡æ•°æ®åˆ†ç‰‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;DirectChannel&lt;/code&gt;æ”¯æŒè·¨é€šé“äº‹åŠ¡ä¸€è‡´æ€§ï¼ˆå¦‚æ•°æ®åº“æ›´æ–°ä¸æ¶ˆæ¯å‘é€åŸå­æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ä¸æµå¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆé˜Ÿåˆ—é€šé“æˆ–æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ RabbitMQã€Kafkaï¼‰ï¼Œå®ç°å‰Šå³°å¡«è°·å’Œå¼‚æ­¥ä»»åŠ¡å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒå®æ—¶æ•°æ®æµå¤„ç†ï¼ˆå¦‚æ—¥å¿—åˆ†æã€ç›‘æ§å‘Šè­¦ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰é…ç½®ä¸æ‰©å±•æ–¹å¼"&gt;âš™ï¸ ä¸‰ã€é…ç½®ä¸æ‰©å±•æ–¹å¼
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®çµæ´»æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;XML é…ç½®&lt;/strong&gt;ï¼šä¼ ç»Ÿæ–¹å¼ï¼Œå£°æ˜å¼å®šä¹‰é€šé“å’Œç«¯ç‚¹ï¼ˆå¦‚ &lt;code&gt;&amp;lt;int:channel id=&amp;quot;inputChannel&amp;quot;/&amp;gt;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Java æ³¨è§£&lt;/strong&gt;ï¼šæ¨èæ–¹å¼ï¼Œä¸ Spring Boot æ— ç¼é›†æˆï¼ˆå¦‚ &lt;code&gt;@EnableIntegration&lt;/code&gt;ã€&lt;code&gt;@Bean&lt;/code&gt;å®šä¹‰é€šé“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
@EnableIntegration
public class IntegrationConfig {
@Bean
public MessageChannel inputChannel() {
return new DirectChannel();
}
@ServiceActivator(inputChannel = &amp;#34;inputChannel&amp;#34;)
public void handleMessage(String payload) {
System.out.println(&amp;#34;Received: &amp;#34; + payload);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚é…å™¨æ‰©å±•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†…ç½®æ”¯æŒæ–‡ä»¶ã€JMSã€HTTPã€Emailã€æ•°æ®åº“ç­‰é€‚é…å™¨ï¼Œç®€åŒ–å¤–éƒ¨ç³»ç»Ÿé›†æˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¤ºä¾‹ï¼šHTTP é€‚é…å™¨ç›‘å¬è¯·æ±‚å¹¶è½¬ä¸ºæ¶ˆæ¯ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;int-http:inbound-channel-adapter
path=&amp;#34;/receive&amp;#34;
channel=&amp;#34;httpInputChannel&amp;#34;
supported-methods=&amp;#34;POST&amp;#34;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››æ ¸å¿ƒä¼˜åŠ¿"&gt;âœ… å››ã€æ ¸å¿ƒä¼˜åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦ä¸å¯æ‰©å±•æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç»„ä»¶é€šè¿‡æ¶ˆæ¯é€šé“é€šä¿¡ï¼Œé¿å…ç›´æ¥ä¾èµ–ï¼Œæ”¯æŒç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ Spring ç”Ÿæ€æ— ç¼é›†æˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¤ç”¨ Spring çš„äº‹åŠ¡ã€å®‰å…¨ã€ç›‘æ§ï¼ˆå¦‚ Actuatorï¼‰èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼å¼€å‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰æˆ–æ³¨è§£ç®€åŒ–é…ç½®ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¹é”™èƒ½åŠ›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰ã€é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯å¯é æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸš€ äº”ã€å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿé›†æˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è¿æ¥å¼‚æ„ç³»ç»Ÿï¼ˆå¦‚æ•°æ®åº“ â†” æ¶ˆæ¯é˜Ÿåˆ— â†” HTTP æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚è®¢å•æ”¯ä»˜åå¼‚æ­¥å‘é€é€šçŸ¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¾®æœåŠ¡é—´é€šè¿‡äº‹ä»¶åä½œï¼ˆå¦‚ç”¨æˆ·æ³¨å†Œè§¦å‘ç§¯åˆ†å‘æ”¾ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ETL æ•°æ®å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æŠ½å–ã€è½¬æ¢ã€åŠ è½½æ•°æ®ï¼ˆå¦‚ä» FTP è¯»å–æ–‡ä»¶ â†’ è½¬æ¢æ ¼å¼ â†’ å­˜å…¥æ•°æ®åº“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æµå¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆ Kafka å¤„ç†æ—¥å¿—æˆ–ç›‘æ§æ•°æ®æµã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Integration æ˜¯æ„å»º&lt;strong&gt;æ¶ˆæ¯é©±åŠ¨å‹åº”ç”¨&lt;/strong&gt;çš„æ ¸å¿ƒæ¡†æ¶ï¼Œé€šè¿‡æ ‡å‡†åŒ–æ¶ˆæ¯æ¨¡å‹ã€é€šé“æœºåˆ¶å’Œ EIP æ¨¡å¼ï¼Œè§£å†³äº†ä¼ä¸šé›†æˆä¸­çš„å¤æ‚æ€§é—®é¢˜ã€‚å…¶ä»·å€¼åœ¨äºå°†å¼€å‘è€…ä»åº•å±‚é€šä¿¡åè®®ä¸­è§£æ”¾ï¼Œæä¾›&lt;strong&gt;å£°æ˜å¼é…ç½®&lt;/strong&gt;ã€&lt;strong&gt;æ— ç¼æ‰©å±•&lt;/strong&gt;åŠ&lt;strong&gt;å¯é æ¶ˆæ¯ä¼ é€’&lt;/strong&gt;èƒ½åŠ›ï¼Œæ˜¯æ„å»ºé«˜å¯ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;h2 id="spring-cloud-stream"&gt;Spring Cloud Stream
&lt;/h2&gt;&lt;p&gt;Spring Cloud Stream æ˜¯ä¸€ä¸ªç”¨äºæ„å»º&lt;strong&gt;æ¶ˆæ¯é©±åŠ¨å‹å¾®æœåŠ¡&lt;/strong&gt;çš„æ¡†æ¶ï¼Œå®ƒåŸºäº Spring Boot å’Œ Spring Integrationï¼Œé€šè¿‡æŠ½è±¡åŒ–æ¶ˆæ¯ä¸­é—´ä»¶çš„åº•å±‚ç»†èŠ‚ï¼Œç®€åŒ–å¾®æœåŠ¡é—´çš„å¼‚æ­¥é€šä¿¡ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„ã€ç¼–ç¨‹æ¨¡å‹åŠä¼˜åŠ¿çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸€æ ¸å¿ƒæ¦‚å¿µ"&gt;ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Binderï¼ˆç»‘å®šå™¨ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šè¿æ¥åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰çš„æ¡¥æ¢ï¼Œå±è”½ä¸åŒä¸­é—´ä»¶çš„å®ç°å·®å¼‚ã€‚å¼€å‘è€…ä»…éœ€é…ç½® Binder ç±»å‹ï¼ˆå¦‚ &lt;code&gt;rabbit&lt;/code&gt;æˆ– &lt;code&gt;kafka&lt;/code&gt;ï¼‰ï¼Œå³å¯åŠ¨æ€åˆ‡æ¢ä¸­é—´ä»¶è€Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°&lt;/strong&gt;ï¼šæ”¯æŒ RabbitMQï¼ˆ&lt;code&gt;spring-cloud-starter-stream-rabbit&lt;/code&gt;ï¼‰å’Œ Kafkaï¼ˆ&lt;code&gt;spring-cloud-stream-binder-kafka&lt;/code&gt;ï¼‰ç­‰ä¸»æµä¸­é—´ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Channelï¼ˆé€šé“ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Input Channel&lt;/code&gt;ï¼šæ¥æ”¶æ¶ˆæ¯çš„é€šé“ï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Output Channel&lt;/code&gt;ï¼šå‘é€æ¶ˆæ¯çš„é€šé“ï¼ˆç”Ÿäº§è€…ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ½è±¡åŒ–&lt;/strong&gt;ï¼šé€šé“ä»£è¡¨æ¶ˆæ¯é˜Ÿåˆ—çš„é€»è¾‘æŠ½è±¡ï¼Œå¼€å‘è€…é€šè¿‡é…ç½®ç»‘å®šåˆ°å…·ä½“ä¸­é—´ä»¶çš„ Topic/Exchangeï¼Œè§£è€¦ä¸šåŠ¡ä»£ç ä¸ä¸­é—´ä»¶ç»†èŠ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯å¤„ç†å™¨ï¼ˆMessage Handlerï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè´£æ¶ˆæ¯çš„è½¬æ¢ã€è·¯ç”±å’Œä¸šåŠ¡å¤„ç†ï¼Œæ”¯æŒè‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒè¯­ä¹‰æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘å¸ƒ-è®¢é˜…&lt;/strong&gt;ï¼šæ¶ˆæ¯å¹¿æ’­è‡³å¤šä¸ªæ¶ˆè´¹è€…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰&lt;/strong&gt;ï¼šåŒç»„å†…ä»…ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹æ¶ˆæ¯ï¼Œé¿å…é‡å¤å¤„ç†ï¼ˆé€šè¿‡ &lt;code&gt;group&lt;/code&gt;é…ç½®å®ç°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†åŒºï¼ˆPartitioningï¼‰&lt;/strong&gt;ï¼šç¡®ä¿ç›¸åŒç‰¹å¾çš„æ¶ˆæ¯ç”±åŒä¸€å®ä¾‹å¤„ç†ï¼Œä¿éšœçŠ¶æ€ä¸€è‡´æ€§ï¼ˆå¦‚æŒ‰ç”¨æˆ· ID åˆ†åŒºï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äºŒæ¶æ„ä¸æ•°æ®æµå‘"&gt;äºŒã€æ¶æ„ä¸æ•°æ®æµå‘
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å±‚æ¶æ„&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨å±‚&lt;/strong&gt;ï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…é€šè¿‡é€šé“æ”¶å‘æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‘å®šå±‚ï¼ˆBinderï¼‰&lt;/strong&gt;ï¼šå°†é€šé“ä¸ä¸­é—´ä»¶è¿æ¥ï¼Œå¤„ç†æ¶ˆæ¯ç¼–è§£ç ã€è·¯ç”±ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯ä¸­é—´ä»¶å±‚&lt;/strong&gt;ï¼šå®é™…çš„æ¶ˆæ¯ä»£ç†ï¼ˆå¦‚ RabbitMQ/Kafkaï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[ç”Ÿäº§è€…] --&amp;gt;|Output Channel| B[Binder]
B --&amp;gt;|æ¶ˆæ¯| C[RabbitMQ/Kafka]
C --&amp;gt;|Input Channel| D[Binder]
D --&amp;gt; E[æ¶ˆè´¹è€…]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æµæ ‡å‡†åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Source&lt;/strong&gt;ï¼šå®šä¹‰è¾“å‡ºé€šé“ï¼ˆ&lt;code&gt;@Output&lt;/code&gt;ï¼‰ï¼Œç”¨äºæ¶ˆæ¯å‘é€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sink&lt;/strong&gt;ï¼šå®šä¹‰è¾“å…¥é€šé“ï¼ˆ&lt;code&gt;@Input&lt;/code&gt;ï¼‰ï¼Œç”¨äºæ¶ˆæ¯æ¥æ”¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Processor&lt;/strong&gt;ï¼šåŒæ—¶åŒ…å«è¾“å…¥å’Œè¾“å‡ºé€šé“ï¼ˆç»§æ‰¿ &lt;code&gt;Source&lt;/code&gt;å’Œ &lt;code&gt;Sink&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸‰ç¼–ç¨‹æ¨¡å‹ä¸å…³é”®æ³¨è§£"&gt;ä¸‰ã€ç¼–ç¨‹æ¨¡å‹ä¸å…³é”®æ³¨è§£
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨ç»‘å®š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@EnableBinding&lt;/code&gt;ï¼šæ ‡è®°åœ¨é…ç½®ç±»ï¼Œå£°æ˜ä½¿ç”¨çš„é€šé“æ¥å£ï¼ˆå¦‚ &lt;code&gt;Source.class&lt;/code&gt;, &lt;code&gt;Processor.class&lt;/code&gt;ï¼‰ï¼Œè§¦å‘ Binder åˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableBinding(Processor.class)
public class MyApp { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“å®šä¹‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è‡ªå®šä¹‰é€šé“æ¥å£ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannel {
String OUTPUT = &amp;#34;customOutput&amp;#34;;
@Output(OUTPUT)
MessageChannel customOutput();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯ç›‘å¬ä¸å‘é€&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@StreamListener&lt;/code&gt;ï¼šç›‘å¬è¾“å…¥é€šé“çš„æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@SendTo&lt;/code&gt;ï¼šå°†å¤„ç†ç»“æœå‘é€è‡³è¾“å‡ºé€šé“ï¼ˆç”¨äºè¯·æ±‚-å“åº”æ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(Processor.INPUT)
@SendTo(Processor.OUTPUT)
public String process(String message) {
return &amp;#34;Processed: &amp;#34; + message;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹ï¼ˆRabbitMQï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
binders:
local_rabbit:
type: rabbit
environment:
spring.rabbitmq.host: localhost
bindings:
input:
destination: orders.topic # RabbitMQ Exchange
binder: local_rabbit
group: orderService # æ¶ˆè´¹ç»„å
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å››æ ¸å¿ƒä¼˜åŠ¿"&gt;å››ã€æ ¸å¿ƒä¼˜åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦ä¸çµæ´»æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡ä¸ä¸­é—´ä»¶è§£è€¦&lt;/strong&gt;ï¼šé€šè¿‡ Binder æŠ½è±¡ï¼Œæ— ç¼åˆ‡æ¢ Kafka/RabbitMQ ç­‰ä¸­é—´ä»¶ï¼Œä»…éœ€ä¿®æ”¹é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•&lt;/strong&gt;ï¼šæ”¯æŒæ°´å¹³æ‰©å±•æ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹ç»„è‡ªåŠ¨åˆ†é…æ¶ˆæ¯åˆ†åŒºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥é€šä¿¡ä¸å¯é æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‰Šå³°å¡«è°·&lt;/strong&gt;ï¼šæ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²é«˜å¹¶å‘è¯·æ±‚ï¼Œé¿å…æœåŠ¡å´©æºƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…åŒ–ä¸é‡è¯•&lt;/strong&gt;ï¼šæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ã€æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰å’Œé‡è¯•æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–å¼€å‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼ç¼–ç¨‹&lt;/strong&gt;ï¼šé€šè¿‡æ³¨è§£é…ç½®é€šé“ä¸ç›‘å¬ï¼Œå‡å°‘æ ·æ¿ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…ç½®ç›‘æ§&lt;/strong&gt;ï¼šé›†æˆ Spring Boot Actuatorï¼Œæä¾›æ¶ˆæ¯æµé‡ã€é”™è¯¯ç‡ç­‰ç›‘æ§æŒ‡æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äº”å…¸å‹åº”ç”¨åœºæ™¯"&gt;äº”ã€å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šè®¢å•æ”¯ä»˜åï¼Œå¼‚æ­¥å‘é€é€šçŸ¥é‚®ä»¶/SMSï¼Œé¿å…é˜»å¡æ ¸å¿ƒæµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šç”¨æˆ·æ³¨å†Œäº‹ä»¶è§¦å‘ç§¯åˆ†å‘æ”¾ã€æ•°æ®åŒæ­¥ç­‰å¤šæœåŠ¡åä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—ä¸æµå¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šå¾®æœåŠ¡æ—¥å¿—å‘é€è‡³ Kafkaï¼Œç”±æµå¤„ç†å¼•æ“å®æ—¶åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿè§£è€¦&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šåº“å­˜æœåŠ¡ç›‘å¬è®¢å•æ¶ˆæ¯æ›´æ–°åº“å­˜ï¼Œæ— éœ€ç›´æ¥è°ƒç”¨è®¢å• APIã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…­æ€»ç»“"&gt;å…­ã€æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Cloud Stream é€šè¿‡ &lt;strong&gt;Binder æŠ½è±¡å±‚&lt;/strong&gt;ã€&lt;strong&gt;æ ‡å‡†åŒ–é€šé“æ¨¡å‹&lt;/strong&gt;å’Œ&lt;strong&gt;å£°æ˜å¼ç¼–ç¨‹&lt;/strong&gt;ï¼Œè§£å†³äº†å¾®æœåŠ¡é—´æ¶ˆæ¯é›†æˆçš„å¤æ‚æ€§ï¼ŒåŒæ—¶æä¾›&lt;strong&gt;åŠ¨æ€æ‰©å±•&lt;/strong&gt;ã€&lt;strong&gt;å¯é é€šä¿¡&lt;/strong&gt;å’Œ&lt;strong&gt;ä¸­é—´ä»¶æ— æ„Ÿåˆ‡æ¢&lt;/strong&gt;èƒ½åŠ›ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºå°†å¼€å‘è€…ä»åº•å±‚æ¶ˆæ¯åè®®ä¸­è§£æ”¾ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘å®ç°ï¼Œæ˜¯æ„å»ºé«˜å¯ç”¨ã€æ¾è€¦åˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„å…³é”®ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h2 id="å•ä½“åº”ç”¨"&gt;å•ä½“åº”ç”¨
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œå•ä½“åº”ç”¨å®Œå…¨å¯ä»¥é›†æˆå¹¶ä½¿ç”¨ &lt;strong&gt;Spring Cloud Stream&lt;/strong&gt;ã€‚å°½ç®¡è¯¥æ¡†æ¶é€šå¸¸ä¸å¾®æœåŠ¡æ¶æ„å…³è”ï¼Œä½†å…¶æ ¸å¿ƒè®¾è®¡å¹¶ä¸é™åˆ¶åº”ç”¨ç±»å‹ï¼Œåªè¦åº”ç”¨åŸºäº &lt;strong&gt;Spring Boot&lt;/strong&gt; å³å¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æåŠä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€æŠ€æœ¯å¯è¡Œæ€§"&gt;âœ… &lt;strong&gt;ä¸€ã€æŠ€æœ¯å¯è¡Œæ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¡†æ¶ç‹¬ç«‹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Spring Cloud Stream çš„æ ¸å¿ƒæ˜¯&lt;strong&gt;æ¶ˆæ¯æŠ½è±¡å±‚&lt;/strong&gt;ï¼Œé€šè¿‡ &lt;code&gt;Binder&lt;/code&gt;å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ RabbitMQã€Kafkaï¼‰çš„å·®å¼‚ã€‚å•ä½“åº”ç”¨åªéœ€å¼•å…¥ç›¸å…³ä¾èµ–å¹¶é…ç½®é€šé“ï¼Œå³å¯åƒå¾®æœåŠ¡ä¸€æ ·æ”¶å‘æ¶ˆæ¯ï¼Œæ— éœ€æ”¹é€ æ¶æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è½»é‡é›†æˆ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å•ä½“åº”ç”¨å¯ä»…å¯ç”¨éƒ¨åˆ†æ¶ˆæ¯é€šé“ï¼ˆå¦‚ä»…ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼‰ï¼Œæ— éœ€å¼ºåˆ¶æ‹†åˆ†æœåŠ¡ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableBinding(Source.class) // ä»…å¯ç”¨æ¶ˆæ¯å‘é€é€šé“
public class MonolithicApp {
public static void main(String[] args) {
SpringApplication.run(MonolithicApp.class, args);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒé€‚ç”¨åœºæ™¯"&gt;âš™ï¸ &lt;strong&gt;äºŒã€é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å—è§£è€¦&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œä¸åŒæ¨¡å—å¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥é€šä¿¡ï¼Œé¿å…ç´§è€¦åˆã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¢å•æ¨¡å—&lt;/strong&gt; â†’ å‘é€è®¢å•æ¶ˆæ¯ â†’ &lt;strong&gt;åº“å­˜æ¨¡å—&lt;/strong&gt;å¼‚æ­¥æ‰£å‡åº“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·æ³¨å†Œ&lt;/strong&gt; â†’ è§¦å‘é‚®ä»¶é€šçŸ¥ â†’ &lt;strong&gt;æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²è¯·æ±‚&lt;/strong&gt;ï¼Œé¿å…é˜»å¡ä¸»æµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è€—æ—¶æ“ä½œï¼ˆå¦‚æ–‡ä»¶å¯¼å‡ºã€æŠ¥è¡¨ç”Ÿæˆï¼‰å¯è½¬ä¸ºæ¶ˆæ¯é©±åŠ¨ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(&amp;#34;task-input&amp;#34;)
public void handleTask(TaskRequest request) {
// å¼‚æ­¥å¤„ç†ä»»åŠ¡
reportService.generateReport(request);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯ç»Ÿä¸€è¿‡æ¸¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥è®¡åˆ’æœªæ¥æ‹†åˆ†ä¸ºå¾®æœåŠ¡ï¼Œå…ˆåœ¨å•ä½“åº”ç”¨ä¸­å¼•å…¥ Spring Cloud Streamï¼Œå¯&lt;strong&gt;æå‰ç»Ÿä¸€æ¶ˆæ¯ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;ï¼Œé™ä½åç»­è¿ç§»æˆæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;ä¸‰ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºå¼€é”€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ RabbitMQ/Kafkaï¼‰éœ€ç‹¬ç«‹éƒ¨ç½²ï¼Œå•ä½“åº”ç”¨éœ€é¢å¤–ç»´æŠ¤ä¸­é—´ä»¶ï¼Œå¯èƒ½å¢åŠ è¿ç»´å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨æ€§è¯„ä¼°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•åœºæ™¯&lt;/strong&gt;ï¼šè‹¥ä»…éœ€æœ¬åœ°å¼‚æ­¥ï¼Œå¯ç›´æ¥ç”¨ &lt;code&gt;@Async&lt;/code&gt;+ çº¿ç¨‹æ± ï¼Œé¿å…å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åœºæ™¯&lt;/strong&gt;ï¼šæ¶‰åŠè·¨æ¨¡å—è§£è€¦ã€å‰Šå³°å¡«è°·ã€å¯é é‡è¯•æ—¶ï¼ŒSpring Cloud Stream æ›´æœ‰ä¼˜åŠ¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç¡®ä¿ &lt;code&gt;pom.xml&lt;/code&gt;å¼•å…¥æ­£ç¡®çš„ Binderï¼ˆå¦‚ RabbitMQ æˆ– Kafkaï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-starter-stream-rabbit&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Cloud Stream &lt;strong&gt;å¹¶éå¾®æœåŠ¡ä¸“å±&lt;/strong&gt;ï¼Œå•ä½“åº”ç”¨å¯é€šè¿‡å®ƒå®ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—é—´å¼‚æ­¥è§£è€¦&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—åŒ–&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€æ¶ˆæ¯æŠ€æœ¯æ ˆä¸ºæœªæ¥æ‹†åˆ†é“ºè·¯&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€æ ¹æ®å®é™…éœ€æ±‚æƒè¡¡ï¼šè‹¥æ¶ˆæ¯é©±åŠ¨çš„æ”¶ç›Šï¼ˆè§£è€¦ã€å¯é æ€§ï¼‰å¤§äºè¿ç»´æˆæœ¬ï¼Œåˆ™å®Œå…¨é€‚ç”¨ï¼›è‹¥ä»…éœ€ç®€å•å¼‚æ­¥ï¼Œå¯é€‰ç”¨æ›´è½»é‡æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="kafka--kafka-stream"&gt;Kafka &amp;amp; Kafka Stream
&lt;/h2&gt;&lt;p&gt;Kafka Stream å’Œ Kafka è™½ç„¶åŒå± Apache Kafka ç”Ÿæ€ç³»ç»Ÿï¼Œä½†å®šä½ã€åŠŸèƒ½å’Œåº”ç”¨åœºæ™¯æœ‰æ˜¾è‘—åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒå·®å¼‚çš„å¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-å®šä½ä¸è§’è‰²"&gt;ğŸ“Œ &lt;strong&gt;1. å®šä½ä¸è§’è‰²&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒå®šä½&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œä¸“æ³¨äº&lt;strong&gt;é«˜ååé‡çš„å®æ—¶æ¶ˆæ¯ä¼ é€’&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸»è¦è§’è‰²&lt;/strong&gt;ï¼šæä¾›æ•°æ®ç®¡é“ï¼ˆç”Ÿäº§è€…â†’Brokerâ†’æ¶ˆè´¹è€…ï¼‰ï¼Œå®ç°æ¶ˆæ¯çš„å‘å¸ƒ/è®¢é˜…ã€æŒä¹…åŒ–å­˜å‚¨å’Œå®¹é”™ä¼ è¾“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Producer&lt;/strong&gt;ï¼šå‘é€æ¶ˆæ¯åˆ° Topicã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Broker&lt;/strong&gt;ï¼šå­˜å‚¨æ¶ˆæ¯çš„æœåŠ¡å™¨èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Consumer&lt;/strong&gt;ï¼šä» Topic æ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka Stream&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒå®šä½&lt;/strong&gt;ï¼šåŸºäº Kafka æ„å»ºçš„&lt;strong&gt;æµå¤„ç†åº“&lt;/strong&gt;ï¼Œç”¨äºå®æ—¶æ•°æ®è½¬æ¢ä¸åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸»è¦è§’è‰²&lt;/strong&gt;ï¼šåœ¨æ¶ˆè´¹ Kafka æ•°æ®çš„åŒæ—¶ï¼Œæ‰§è¡Œå¤æ‚è®¡ç®—ï¼ˆå¦‚è¿‡æ»¤ã€èšåˆã€è¿æ¥ï¼‰å¹¶å°†ç»“æœå†™å› Kafka æˆ–å…¶ä»–ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-åŠŸèƒ½ç‰¹æ€§"&gt;âš™ï¸ &lt;strong&gt;2. åŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;èƒ½åŠ›&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kafka&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kafka Stream&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¶ˆæ¯ä¼ é€’&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹&lt;/td&gt;
&lt;td&gt;âŒ ä¾èµ– Kafka çš„åº•å±‚æ¶ˆæ¯ä¼ é€’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æµå¤„ç†èƒ½åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä»…æ”¯æŒåŸºç¡€æ¶ˆè´¹&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒå¤æ‚æ“ä½œï¼ˆçª—å£èšåˆã€çŠ¶æ€ç®¡ç†ã€Joinï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çŠ¶æ€ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ— å†…ç½®çŠ¶æ€å­˜å‚¨&lt;/td&gt;
&lt;td&gt;âœ… å†…ç½®çŠ¶æ€å­˜å‚¨ï¼ˆå¦‚ RocksDBï¼‰ï¼Œæ”¯æŒå®æ—¶æ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤„ç†è¯­ä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ At-least-once/At-most-once&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ Exactly-onceï¼ˆç²¾ç¡®ä¸€æ¬¡å¤„ç†ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¶é—´å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä»…æ”¯æŒäº‹ä»¶æ—¶é—´æˆ³&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒäº‹ä»¶æ—¶é—´ã€å¤„ç†æ—¶é—´ã€çª—å£æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-3-å¼€å‘å¤æ‚åº¦"&gt;ğŸ› ï¸ &lt;strong&gt;3. å¼€å‘å¤æ‚åº¦&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½çº§åˆ« API&lt;/strong&gt;ï¼šå¼€å‘è€…éœ€æ‰‹åŠ¨ç®¡ç†åˆ†åŒºåˆ†é…ã€åç§»é‡æäº¤ã€æ•…éšœæ¢å¤ç­‰ç»†èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé€‚åˆç®€å•æ•°æ®ä¼ è¾“æˆ–ä¸å…¶ä»–ç³»ç»Ÿï¼ˆå¦‚æ•°æ®åº“ã€Flinkï¼‰é›†æˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka Stream&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜çº§åˆ« API&lt;/strong&gt;ï¼šæä¾›å£°æ˜å¼ DSLï¼ˆå¦‚ &lt;code&gt;map&lt;/code&gt;ã€&lt;code&gt;filter&lt;/code&gt;ã€&lt;code&gt;groupBy&lt;/code&gt;ï¼‰å’Œ Processor APIï¼Œç®€åŒ–æµå¤„ç†é€»è¾‘å¼€å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨å®¹é”™&lt;/strong&gt;ï¼šè‡ªåŠ¨å¤„ç†æ•…éšœè½¬ç§»ã€çŠ¶æ€æ¢å¤å’Œåˆ†åŒºå†å¹³è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-é€‚ç”¨åœºæ™¯"&gt;ğŸ¯ &lt;strong&gt;4. é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kafka&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kafka Stream&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¥å¿—æ”¶é›†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… é«˜æ•ˆæ”¶é›†åˆ†å¸ƒå¼ç³»ç»Ÿæ—¥å¿—&lt;/td&gt;
&lt;td&gt;âŒ ä¸ç›´æ¥é€‚ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… å‰Šå³°å¡«è°·ã€å¼‚æ­¥è§£è€¦&lt;/td&gt;
&lt;td&gt;âŒ éæ ¸å¿ƒåŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®æ—¶æŒ‡æ ‡ç»Ÿè®¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ éœ€é¢å¤–å¼€å‘é€»è¾‘&lt;/td&gt;
&lt;td&gt;âœ… æ»‘åŠ¨çª—å£è®¡ç®—ï¼ˆå¦‚æ¯åˆ†é’Ÿ PV/UVï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤æ‚äº‹ä»¶å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;âœ… å®æ—¶æ£€æµ‹å¼‚å¸¸æ¨¡å¼ï¼ˆå¦‚é‡‘èé£æ§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æµ ETL&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ éœ€ç»“åˆå¤–éƒ¨å·¥å…·&lt;/td&gt;
&lt;td&gt;âœ… å®æ—¶è½¬æ¢å¹¶å†™å…¥ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ ESã€HDFSï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-5-æ¶æ„ä¾èµ–"&gt;ğŸ§© &lt;strong&gt;5. æ¶æ„ä¾èµ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸ºç‹¬ç«‹é›†ç¾¤è¿è¡Œï¼Œä¾èµ– ZooKeeper ç®¡ç†å…ƒæ•°æ®ï¼ˆæ–°ç‰ˆæœ¬é€æ­¥ç§»é™¤ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka Stream&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥&lt;strong&gt;è½»é‡åº“&lt;/strong&gt;å½¢å¼åµŒå…¥ Java åº”ç”¨ï¼Œæ— é¢å¤–ä¸­é—´ä»¶ä¾èµ–ï¼Œç›´æ¥åˆ©ç”¨ Kafka é›†ç¾¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“æŠ€æœ¯é€‰å‹å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šæŠ€æœ¯é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‰ Kafka&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;éœ€è¦æ„å»º&lt;strong&gt;é«˜å¯é æ¶ˆæ¯ç®¡é“&lt;/strong&gt;ï¼ˆå¦‚æ—¥å¿—æ”¶é›†ã€æœåŠ¡è§£è€¦ï¼‰ï¼Œæˆ–ä½œä¸ºå…¶ä»–æµå¤„ç†æ¡†æ¶ï¼ˆå¦‚ Flinkï¼‰çš„æ•°æ®æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‰ Kafka Stream&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;éœ€åœ¨ Kafka ä¸Šç›´æ¥å®ç°&lt;strong&gt;å®æ—¶è®¡ç®—é€»è¾‘&lt;/strong&gt;ï¼ˆå¦‚èšåˆã€çª—å£åˆ†æï¼‰ï¼Œä¸”å¸Œæœ›é¿å…å¼•å…¥é¢å¤–æ¡†æ¶ï¼ˆå¦‚ Flink/Sparkï¼‰çš„å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®å·®å¼‚ä¸€å¥è¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Kafka æ˜¯â€œé«˜é€Ÿå…¬è·¯â€&lt;/strong&gt;ï¼ˆä¼ è¾“æ•°æ®ï¼‰ï¼Œ&lt;strong&gt;Kafka Stream æ˜¯â€œåŠ å·¥å‚â€&lt;/strong&gt;ï¼ˆåœ¨ä¼ è¾“ä¸­å®æ—¶å¤„ç†æ•°æ®ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="binders"&gt;binders
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream ä¸­ï¼Œ&lt;code&gt;spring.cloud.stream.binders&lt;/code&gt;å’Œ &lt;code&gt;spring.cloud.stream.kafka.binder&lt;/code&gt;æ˜¯ä¸¤ç§ä¸åŒç²’åº¦çš„é…ç½®æ–¹å¼ï¼Œåˆ†åˆ«ç”¨äº&lt;strong&gt;å¤šæ¶ˆæ¯ä¸­é—´ä»¶åœºæ™¯&lt;/strong&gt;å’Œ&lt;strong&gt;å•ä¸€ Kafka ç»‘å®šå™¨åœºæ™¯&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒåŒºåˆ«åŠé€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1"&gt;ğŸ“Œ &lt;strong&gt;1. &lt;code&gt;spring.cloud.stream.binders&lt;/code&gt;ï¼ˆå¤šç»‘å®šå™¨é…ç½®ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç”¨äºå®šä¹‰&lt;strong&gt;å¤šä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ç»‘å®šå™¨&lt;/strong&gt;ï¼ˆå¦‚åŒæ—¶ä½¿ç”¨ Kafka å’Œ RabbitMQï¼‰ï¼Œæˆ–&lt;strong&gt;åŒä¸€ç±»å‹ä¸­é—´ä»¶çš„å¤šä¸ªå®ä¾‹&lt;/strong&gt;ï¼ˆå¦‚ä¸¤ä¸ªç‹¬ç«‹çš„ Kafka é›†ç¾¤ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç»“æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä»¥ Map å½¢å¼å£°æ˜ï¼Œæ¯ä¸ªç»‘å®šå™¨éœ€æŒ‡å®šå”¯ä¸€åç§°ã€ç±»å‹ï¼ˆ&lt;code&gt;type&lt;/code&gt;ï¼‰åŠç¯å¢ƒå±æ€§ï¼ˆ&lt;code&gt;environment&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
binders:
kafkaBinder1: # è‡ªå®šä¹‰ç»‘å®šå™¨åç§°
type: kafka
environment:
spring:
kafka:
bootstrap-servers: kafka1:9092
kafkaBinder2: # ç¬¬äºŒä¸ª Kafka ç»‘å®šå™¨
type: kafka
environment:
spring:
kafka:
bootstrap-servers: kafka2:9092
rabbitBinder: # RabbitMQ ç»‘å®šå™¨
type: rabbit
environment:
spring:
rabbitmq:
host: rabbit-host
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨éœ€åŒæ—¶è¿æ¥&lt;strong&gt;å¤šä¸ªæ¶ˆæ¯ä¸­é—´ä»¶&lt;/strong&gt;ï¼ˆå¦‚éƒ¨åˆ†é€šé“ç”¨ Kafkaï¼Œéƒ¨åˆ†ç”¨ RabbitMQï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€åŒºåˆ†&lt;strong&gt;åŒä¸€ä¸­é—´ä»¶çš„ä¸åŒå®ä¾‹&lt;/strong&gt;ï¼ˆå¦‚ç”Ÿäº§ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒçš„ç‹¬ç«‹ Kafka é›†ç¾¤ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2"&gt;ğŸ“Œ &lt;strong&gt;2. &lt;code&gt;spring.cloud.stream.kafka.binder&lt;/code&gt;ï¼ˆå•ç»‘å®šå™¨ç®€åŒ–é…ç½®ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å½“åº”ç”¨&lt;strong&gt;ä»…ä½¿ç”¨ä¸€ä¸ª Kafka ç»‘å®šå™¨&lt;/strong&gt;æ—¶ï¼Œç›´æ¥é…ç½® Kafka ç›¸å…³å‚æ•°ï¼Œæ— éœ€å£°æ˜ç»‘å®šå™¨åç§°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç»“æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç›´æ¥åœ¨ &lt;code&gt;kafka.binder&lt;/code&gt;ä¸‹è®¾ç½® Kafka å®¢æˆ·ç«¯å±æ€§ï¼ˆå¦‚ brokersã€ç”Ÿäº§è€…/æ¶ˆè´¹è€…å‚æ•°ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
kafka:
binder:
brokers: kafka-single:9092 # Kafka é›†ç¾¤åœ°å€
producer-properties:
retries: 3 # ç”Ÿäº§è€…é‡è¯•æ¬¡æ•°
consumer-properties:
auto.offset.reset: earliest
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆå¹¶è§„åˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ­¤é…ç½®ä¼šä¸ Spring Boot çš„ &lt;code&gt;spring.kafka.*&lt;/code&gt;å±æ€§&lt;strong&gt;è‡ªåŠ¨åˆå¹¶&lt;/strong&gt;ï¼Œä¼˜å…ˆçº§é«˜äºåè€…ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;code&gt;spring.cloud.stream.kafka.binder.brokers&lt;/code&gt;ä¼šè¦†ç›– &lt;code&gt;spring.kafka.bootstrap-servers&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-æ ¸å¿ƒåŒºåˆ«æ€»ç»“"&gt;âš–ï¸ &lt;strong&gt;3. æ ¸å¿ƒåŒºåˆ«æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;spring.cloud.stream.binders&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;spring.cloud.stream.kafka.binder&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®ç›®æ ‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤šä¸­é—´ä»¶/å¤šå®ä¾‹åœºæ™¯&lt;/td&gt;
&lt;td&gt;å•ä¸€ Kafka ç»‘å®šå™¨åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Map ç»“æ„ï¼Œéœ€å£°æ˜ç»‘å®šå™¨åç§°å’Œç±»å‹&lt;/td&gt;
&lt;td&gt;æ‰å¹³åŒ–é…ç½®ï¼Œç›´æ¥è®¾ç½® Kafka å‚æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸­é—´ä»¶æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒæ··åˆç±»å‹ï¼ˆKafka + RabbitMQ ç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;ä»… Kafka&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‚æ•°ä½ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ &lt;code&gt;environment&lt;/code&gt;ä¸‹åµŒå¥—ä¸­é—´ä»¶ä¸“å±é…ç½®&lt;/td&gt;
&lt;td&gt;ç›´æ¥é…ç½® &lt;code&gt;binder&lt;/code&gt;å­å±æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸ &lt;code&gt;spring.kafka&lt;/code&gt;åˆå¹¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€åœ¨ &lt;code&gt;environment&lt;/code&gt;ä¸­æ˜¾å¼é…ç½®&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨åˆå¹¶ï¼Œä¼˜å…ˆçº§æ›´é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-4-é…ç½®ç¤ºä¾‹å¯¹æ¯”"&gt;ğŸ› ï¸ &lt;strong&gt;4. é…ç½®ç¤ºä¾‹å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯-1å¤š-kafka-é›†ç¾¤"&gt;&lt;strong&gt;åœºæ™¯ 1ï¼šå¤š Kafka é›†ç¾¤&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
binders:
prodKafka:
type: kafka
environment:
spring:
kafka:
bootstrap-servers: prod-kafka:9092
testKafka:
type: kafka
environment:
spring:
kafka:
bootstrap-servers: test-kafka:9092
bindings:
output:
destination: orders
binder: prodKafka # æŒ‡å®šä½¿ç”¨ prodKafka ç»‘å®šå™¨
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="åœºæ™¯-2å•ä¸€-kafka-é›†ç¾¤"&gt;&lt;strong&gt;åœºæ™¯ 2ï¼šå•ä¸€ Kafka é›†ç¾¤&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
kafka:
binder:
brokers: single-kafka:9092
producer:
retries: 5
bindings:
output:
destination: orders
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ç»“è®º"&gt;ğŸ’ &lt;strong&gt;ç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨ &lt;code&gt;binders&lt;/code&gt;&lt;/strong&gt;ï¼šå½“éœ€è¦&lt;strong&gt;çµæ´»ç®¡ç†å¤šä¸ªæ¶ˆæ¯ä¸­é—´ä»¶æˆ–å®ä¾‹&lt;/strong&gt;æ—¶ï¼ˆå¦‚æ··åˆéƒ¨ç½²æˆ–ç¯å¢ƒéš”ç¦»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”¨ &lt;code&gt;kafka.binder&lt;/code&gt;&lt;/strong&gt;ï¼šå½“&lt;strong&gt;ä»…ä¾èµ–å•ä¸€ Kafka é›†ç¾¤&lt;/strong&gt;ä¸”æ— éœ€å¤æ‚å£°æ˜æ—¶ï¼Œç®€åŒ–é…ç½®å¹¶å¤ç”¨ Spring Boot å±æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;ä¼˜å…ˆçº§å»ºè®®&lt;/strong&gt;ï¼šå¤šæ•°å• Kafka åœºæ™¯æ¨è &lt;code&gt;kafka.binder&lt;/code&gt;ï¼›å¤šä¸­é—´ä»¶åœºæ™¯å¿…é¡»ä½¿ç”¨ &lt;code&gt;binders&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="binder"&gt;Binder
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream ä¸­ï¼Œ&lt;code&gt;binders&lt;/code&gt;çš„é€‰æ‹©ä¸»è¦é€šè¿‡&lt;strong&gt;é…ç½®å£°æ˜&lt;/strong&gt;å’Œ&lt;strong&gt;ç¼–ç¨‹æ³¨è§£&lt;/strong&gt;å®ç°ï¼Œå…·ä½“æ–¹å¼å–å†³äºåº”ç”¨æ˜¯å¦ä½¿ç”¨å¤šæ¶ˆæ¯ä¸­é—´ä»¶æˆ–éœ€åŠ¨æ€ç»‘å®šã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒæ–¹æ³•åŠç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€é…ç½®å£°æ˜å¼é€‰æ‹©æ¨è"&gt;ğŸ”§ ä¸€ã€é…ç½®å£°æ˜å¼é€‰æ‹©ï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;application.yml&lt;/code&gt;æˆ– &lt;code&gt;application.properties&lt;/code&gt;é…ç½®æ–‡ä»¶æŒ‡å®šé€šé“çš„ç»‘å®šå™¨ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚&lt;/p&gt;
&lt;h4 id="1-å•-binder-åœºæ™¯"&gt;&lt;strong&gt;1. å• Binder åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥åº”ç”¨ä»…ä½¿ç”¨ä¸€ä¸ª Binderï¼ˆå¦‚ Kafkaï¼‰ï¼Œç›´æ¥é…ç½®å…¨å±€é»˜è®¤ Binderï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
default-binder: kafka # æ‰€æœ‰é€šé“é»˜è®¤ä½¿ç”¨ Kafka
bindings:
output:
destination: orders
input:
destination: orders
group: order-group
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-å¤š-binder-åœºæ™¯"&gt;&lt;strong&gt;2. å¤š Binder åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“åŒæ—¶è¿æ¥å¤šä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ RabbitMQ å’Œ Kafkaï¼‰æ—¶ï¼Œéœ€æ˜¾å¼æŒ‡å®šæ¯ä¸ªé€šé“çš„ Binderï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
binders:
rabbit1:
type: rabbit
environment:
spring.rabbitmq.host: rabbit-host1
kafka1:
type: kafka
environment:
spring.kafka.bootstrap-servers: kafka-host:9092
bindings:
output: # è¾“å‡ºé€šé“ä½¿ç”¨ RabbitMQ
destination: orders
binder: rabbit1
input: # è¾“å…¥é€šé“ä½¿ç”¨ Kafka
destination: logs
binder: kafka1
group: log-group
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bindings.&amp;lt;channelName&amp;gt;.binder&lt;/code&gt;æŒ‡å®šé€šé“çš„ Binder åç§°ï¼ˆéœ€ä¸ &lt;code&gt;binders&lt;/code&gt;å®šä¹‰çš„åç§°åŒ¹é…ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒç¼–ç¨‹æ³¨è§£å¼é€‰æ‹©"&gt;ğŸ’» äºŒã€ç¼–ç¨‹æ³¨è§£å¼é€‰æ‹©
&lt;/h3&gt;&lt;p&gt;åœ¨ä»£ç ä¸­é€šè¿‡æ³¨è§£åŠ¨æ€å…³è”é€šé“ä¸ Binderã€‚&lt;/p&gt;
&lt;h4 id="1-è‡ªå®šä¹‰é€šé“æ¥å£"&gt;&lt;strong&gt;1. è‡ªå®šä¹‰é€šé“æ¥å£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®šä¹‰é€šé“æ—¶ï¼Œé€šè¿‡ &lt;code&gt;@Input&lt;/code&gt;/&lt;code&gt;@Output&lt;/code&gt;æ³¨è§£å£°æ˜é€»è¾‘é€šé“åï¼Œåç»­åœ¨é…ç½®ä¸­ç»‘å®š Binderï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannels {
@Output(&amp;#34;orderOutput&amp;#34;) // é€»è¾‘é€šé“å
MessageChannel orderOutput();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é…ç½®æ–‡ä»¶ä¸­ç»‘å®š Binderï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
orderOutput: # åŒ¹é…æ³¨è§£ä¸­çš„é€šé“å
destination: orders
binder: rabbit1 # æŒ‡å®š Binder
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-åŠ¨æ€ç»‘å®šè¿è¡Œæ—¶é€‰æ‹©"&gt;&lt;strong&gt;2. åŠ¨æ€ç»‘å®šï¼ˆè¿è¡Œæ—¶é€‰æ‹©ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;BinderAwareChannelResolver&lt;/code&gt;åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹© Binderï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private BinderAwareChannelResolver channelResolver;
public void sendMessage(String binderName, String destination, String payload) {
MessageChannel channel = channelResolver.resolveDestination(destination, binderName);
channel.send(MessageBuilder.withPayload(payload).build());
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘åŠ¨æ€åˆ‡æ¢æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚æŒ‰æ¶ˆæ¯ç±»å‹é€‰æ‹© Kafka æˆ– RabbitMQï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ ä¸‰ã€æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Binder åç§°ä¸€è‡´æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é…ç½®ä¸­çš„ &lt;code&gt;bindings.&amp;lt;channel&amp;gt;.binder&lt;/code&gt;å¿…é¡»ä¸ &lt;code&gt;binders.&amp;lt;binderName&amp;gt;&lt;/code&gt;å®šä¹‰çš„åç§°å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™æŠ›å‡º &lt;code&gt;NoSuchBeanDefinitionException&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤ Binder æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥æœªæ˜¾å¼æŒ‡å®š &lt;code&gt;binder&lt;/code&gt;ï¼Œåˆ™ä½¿ç”¨ &lt;code&gt;spring.cloud.stream.default-binder&lt;/code&gt;çš„å€¼ï¼›è‹¥æœªé…ç½®é»˜è®¤å€¼ä¸”å­˜åœ¨å¤šä¸ª Binderï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç»„ä¸ Binder æ— å…³&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;group&lt;/code&gt;å±æ€§ä»…æ§åˆ¶æ¶ˆè´¹è€…ç»„å†…è´Ÿè½½å‡è¡¡ï¼Œä¸ Binder é€‰æ‹©æ— å…³ã€‚åŒä¸€ç»„å¯è·¨ä¸åŒ Binderï¼ˆä¸æ¨èï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ä¼˜å…ˆçº§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šé“çº§é…ç½®ï¼ˆ&lt;code&gt;bindings.&amp;lt;channel&amp;gt;.binder&lt;/code&gt;ï¼‰ &amp;gt; å…¨å±€é»˜è®¤é…ç½®ï¼ˆ&lt;code&gt;default-binder&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®é©±åŠ¨&lt;/strong&gt;ï¼šå¤šæ•°åœºæ™¯é€šè¿‡ YAML/Properties æ–‡ä»¶é™æ€ç»‘å®š Binderã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼–ç¨‹åŠ¨æ€ç»‘å®š&lt;/strong&gt;ï¼šéœ€è¿è¡Œæ—¶å†³ç­–æ—¶ç”¨ &lt;code&gt;BinderAwareChannelResolver&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…åŒ¿å Binder&lt;/strong&gt;ï¼šå¤š Binder åœºæ™¯å¿…é¡»æ˜¾å¼å‘½åå¹¶å…³è”é€šé“ï¼Œå¦åˆ™å¯åŠ¨æŠ¥é”™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½®ï¼Œå¯æ— ç¼é›†æˆ RabbitMQã€Kafka æˆ–è‡ªå®šä¹‰ Binderï¼Œå®ç°æ¶ˆæ¯ä¸­é—´ä»¶çš„çµæ´»åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="bindings"&gt;bindings
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream çš„é…ç½®ä½“ç³»ä¸­ï¼Œ&lt;code&gt;spring.cloud.stream.bindings&lt;/code&gt;å’Œ &lt;code&gt;spring.cloud.stream.kafka.bindings&lt;/code&gt;å±äºä¸åŒå±‚çº§çš„é…ç½®ï¼Œ&lt;strong&gt;ä¸ä¼šå®Œå…¨ç›¸äº’è¦†ç›–&lt;/strong&gt;ï¼Œè€Œæ˜¯æŒ‰ä¼˜å…ˆçº§äº’è¡¥ä½œç”¨äºä¸åŒåœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®å±‚çº§ä¸ä¼˜å…ˆçº§è§„åˆ™"&gt;âš–ï¸ &lt;strong&gt;é…ç½®å±‚çº§ä¸ä¼˜å…ˆçº§è§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šç”¨é€šé“é…ç½® (&lt;code&gt;spring.cloud.stream.bindings&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨èŒƒå›´&lt;/strong&gt;ï¼šé€‚ç”¨äºæ‰€æœ‰ç»‘å®šå™¨ç±»å‹ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰ï¼Œå®šä¹‰é€šé“çš„åŸºç¡€å±æ€§ï¼ˆå¦‚ç›®æ ‡ä¸»é¢˜ã€æ¶ˆè´¹è€…ç»„ã€åºåˆ—åŒ–ç±»å‹ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
input: # é€šé“é€»è¾‘å
destination: orders-topic # Kafka ä¸»é¢˜å
group: order-group # æ¶ˆè´¹è€…ç»„
contentType: application/json # æ¶ˆæ¯æ ¼å¼
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kafka ä¸“å±é…ç½® (&lt;code&gt;spring.cloud.stream.kafka.bindings&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨èŒƒå›´&lt;/strong&gt;ï¼šä»…é’ˆå¯¹ Kafka ç»‘å®šå™¨ï¼Œç”¨äºé…ç½® Kafka ç‰¹æœ‰çš„é«˜çº§å‚æ•°ï¼ˆå¦‚åˆ†åŒºã€å‰¯æœ¬ã€ç”Ÿäº§è€…/æ¶ˆè´¹è€…å®¢æˆ·ç«¯å±æ€§ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
kafka:
bindings:
input: # é€šé“é€»è¾‘åï¼ˆéœ€ä¸é€šç”¨é…ç½®ä¸€è‡´ï¼‰
consumer:
autoCommitOffset: false # å…³é—­è‡ªåŠ¨æäº¤åç§»é‡
startOffset: earliest # ä»æœ€æ—©åç§»é‡æ¶ˆè´¹
producer:
partitionCount: 4 # åˆ†åŒºæ•°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆçº§è§„åˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka ä¸“å±é…ç½® &amp;gt; é€šç”¨é…ç½®&lt;/strong&gt;ï¼šå½“ä¸¤è€…é…ç½®åŒä¸€é€šé“ï¼ˆå¦‚ &lt;code&gt;input&lt;/code&gt;ï¼‰æ—¶ï¼ŒKafka ä¸“å±é…ç½®ä¼šè¦†ç›–é€šç”¨é…ç½®ä¸­çš„åŒåå±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº’è¡¥è€Œéè¦†ç›–&lt;/strong&gt;ï¼šè‹¥é…ç½®é¡¹ä¸å†²çªï¼ˆä¾‹å¦‚é€šç”¨é…ç½®è®¾ç½® &lt;code&gt;destination&lt;/code&gt;ï¼ŒKafka é…ç½®è®¾ç½® &lt;code&gt;partitionCount&lt;/code&gt;ï¼‰ï¼Œåˆ™ä¸¤è€…åˆå¹¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®å†²çªç¤ºä¾‹ä¸è§£å†³"&gt;ğŸ› ï¸ &lt;strong&gt;é…ç½®å†²çªç¤ºä¾‹ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†²çªåœºæ™¯&lt;/strong&gt;ï¼ˆä»¥æ¶ˆè´¹è€…é‡è¯•æœºåˆ¶ä¸ºä¾‹ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# é€šç”¨é…ç½®ï¼ˆä½œç”¨äºæ‰€æœ‰ç»‘å®šå™¨ï¼‰
spring.cloud.stream.bindings.input.consumer.max-attempts=3
# Kafka ä¸“å±é…ç½®
spring.cloud.stream.kafka.bindings.input.consumer.max-attempts=5
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šKafka æ¶ˆè´¹è€…å®é™…ä½¿ç”¨ &lt;code&gt;max-attempts=5&lt;/code&gt;ï¼ˆKafka ä¸“å±é…ç½®ä¼˜å…ˆçº§æ›´é«˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éå†²çªåœºæ™¯&lt;/strong&gt;ï¼ˆåˆå¹¶ç”Ÿæ•ˆï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# é€šç”¨é…ç½®
spring.cloud.stream.bindings.input.destination=orders-topic
# Kafka ä¸“å±é…ç½®
spring.cloud.stream.kafka.bindings.input.consumer.startOffset=earliest
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šæ¶ˆè´¹è€…è®¢é˜… &lt;code&gt;orders-topic&lt;/code&gt;ä¸»é¢˜ï¼Œå¹¶ä»æœ€æ—©åç§»é‡å¼€å§‹æ¶ˆè´¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å¸¸è§é…ç½®é¡¹å½’å±ä¸ä¼˜å…ˆçº§"&gt;ğŸ“Š &lt;strong&gt;å¸¸è§é…ç½®é¡¹å½’å±ä¸ä¼˜å…ˆçº§&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€šç”¨é…ç½® (&lt;code&gt;bindings&lt;/code&gt;)&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kafka ä¸“å±é…ç½® (&lt;code&gt;kafka.bindings&lt;/code&gt;)&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç”Ÿæ•ˆä¼˜å…ˆçº§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç›®æ ‡ä¸»é¢˜ (&lt;code&gt;destination&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;é€šç”¨é…ç½®ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¶ˆè´¹è€…ç»„ (&lt;code&gt;group&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;é€šç”¨é…ç½®ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¶ˆæ¯æ ¼å¼ (&lt;code&gt;contentType&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;é€šç”¨é…ç½®ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ†åŒºæ•° (&lt;code&gt;partitionCount&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;âœ…ï¼ˆç”Ÿäº§è€…çº§ï¼‰&lt;/td&gt;
&lt;td&gt;âœ…ï¼ˆç”Ÿäº§è€…çº§ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Kafka ä¸“å±&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åç§»é‡ç­–ç•¥ (&lt;code&gt;startOffset&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;âœ…ï¼ˆæ¶ˆè´¹è€…çº§ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Kafka ä¸“å±&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é‡è¯•æ¬¡æ•° (&lt;code&gt;max-attempts&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Kafka ä¸“å±&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šé€šç”¨é…ç½®ä¸­çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…å±æ€§ï¼ˆå¦‚ &lt;code&gt;producer.partitionKeyExpression&lt;/code&gt;ï¼‰å¯èƒ½è¢« Kafka çš„åŒåé…ç½®è¦†ç›–ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ”§ &lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºç¡€å±æ€§ç”¨é€šç”¨é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸»é¢˜åã€æ¶ˆè´¹è€…ç»„ã€åºåˆ—åŒ–ç±»å‹ç­‰ä¸­é—´ä»¶æ— å…³çš„å±æ€§ï¼Œä¼˜å…ˆæ”¾åœ¨ &lt;code&gt;spring.cloud.stream.bindings&lt;/code&gt;ä¸­ï¼Œæå‡é…ç½®å¯ç§»æ¤æ€§ï¼ˆå¦‚åˆ‡æ¢ RabbitMQ æ—¶æ— éœ€ä¿®æ”¹ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kafka ç‰¹æ€§ç”¨ä¸“å±é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åˆ†åŒºã€å‰¯æœ¬ã€åç§»é‡ç­–ç•¥ç­‰ Kafka ä¸“å±å‚æ•°ï¼Œé€šè¿‡ &lt;code&gt;spring.cloud.stream.kafka.bindings&lt;/code&gt;é…ç½®ï¼Œç¡®ä¿ç²¾ç»†æ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…åŒåå±æ€§å†²çª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥éœ€è¦†ç›–é€šç”¨é…ç½®ä¸­çš„å±æ€§ï¼ˆå¦‚é‡è¯•æ¬¡æ•°ï¼‰ï¼Œåœ¨ Kafka ä¸“å±é…ç½®ä¸­æ˜¾å¼å£°æ˜åŒåå±æ€§å³å¯ï¼Œæ— éœ€åˆ é™¤é€šç”¨é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;code&gt;spring.cloud.stream.kafka.bindings&lt;/code&gt;&amp;gt; &lt;code&gt;spring.cloud.stream.bindings&lt;/code&gt;ï¼ˆåŒåå±æ€§å†²çªæ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº’è¡¥æ€§&lt;/strong&gt;ï¼šä¸¤è€…å…±åŒæ„æˆå®Œæ•´é…ç½®ï¼Œéå†²çªé¡¹åˆå¹¶ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ç­–ç•¥&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€šç”¨é…ç½®&lt;/strong&gt; â†’ å®šä¹‰ä¸­é—´ä»¶æ— å…³çš„åŸºç¡€å±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka ä¸“å±é…ç½®&lt;/strong&gt; â†’ å®ç° Kafka ç‰¹æœ‰èƒ½åŠ›çš„ç²¾ç»†è°ƒä¼˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†åˆ†å±‚é…ç½®ï¼Œæ—¢èƒ½ä¿éšœä»£ç å¯ç§»æ¤æ€§ï¼Œåˆèƒ½å……åˆ†å‘æŒ¥ Kafka çš„é«˜çº§ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h2 id="channel"&gt;Channel
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream ä¸­ï¼Œ&lt;code&gt;bindings&lt;/code&gt;ä¸‹çš„æ¯ä¸ªé€šé“ï¼ˆChannelï¼‰é…ç½®ç”¨äºå®šä¹‰æ¶ˆæ¯ç”Ÿäº§æˆ–æ¶ˆè´¹çš„å…·ä½“è¡Œä¸ºï¼ŒåŒ…æ‹¬ç›®æ ‡ä¸»é¢˜ã€åºåˆ—åŒ–æ–¹å¼ã€æ¶ˆè´¹è€…ç»„ã€åˆ†åŒºç­–ç•¥ç­‰ã€‚ä»¥ä¸‹æ˜¯ &lt;strong&gt;å•ä¸ªé€šé“&lt;/strong&gt; çš„é…ç½®è¯¦è§£ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€åŸºç¡€é…ç½®é€šç”¨"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€åŸºç¡€é…ç½®ï¼ˆé€šç”¨ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹é…ç½®åŒæ—¶é€‚ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é€šé“ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;destination&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„ç›®æ ‡åç§°ï¼ˆå¦‚ Kafka çš„ Topicã€RabbitMQ çš„ Exchangeï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;orders-topic&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆå¿…å¡«ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;binder&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡å®šä½¿ç”¨çš„ Binder åç§°ï¼ˆéœ€åœ¨ &lt;code&gt;binders&lt;/code&gt;ä¸­å®šä¹‰ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;kafka-binder1&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;default-binder&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;contentType&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯åºåˆ—åŒ–æ ¼å¼ï¼ˆå¦‚ &lt;code&gt;application/json&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;text/plain&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;application/json&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;group&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç»„å&lt;/strong&gt;ï¼ˆä»…æ¶ˆè´¹è€…æœ‰æ•ˆï¼‰ï¼ŒåŒç»„å†…ä»…ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹æ¶ˆæ¯ï¼Œé¿å…é‡å¤æ¶ˆè´¹&lt;/td&gt;
&lt;td&gt;&lt;code&gt;order-service-group&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;group&lt;/code&gt;æ˜¯é¿å…æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€åœ¨æ¶ˆè´¹è€…é€šé“æ˜¾å¼æŒ‡å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;binder&lt;/code&gt;ä»…åœ¨å¤šæ¶ˆæ¯ä¸­é—´ä»¶åœºæ™¯éœ€è¦ï¼ˆå¦‚åŒæ—¶ç”¨ Kafka + RabbitMQï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒæ¶ˆè´¹è€…ä¸“å±é…ç½®"&gt;ğŸ‘‚ &lt;strong&gt;äºŒã€æ¶ˆè´¹è€…ä¸“å±é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ &lt;code&gt;spring.cloud.stream.bindings.&amp;lt;channel&amp;gt;.consumer.*&lt;/code&gt;ä¸ºå‰ç¼€ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;concurrency&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆè´¹è€…å¹¶å‘çº¿ç¨‹æ•°ï¼ˆå•å®ä¾‹å†…ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;3&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;maxAttempts&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯å¤„ç†å¤±è´¥æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆå«é¦–æ¬¡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;5&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;3&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;backOffInitialInterval&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é‡è¯•åˆå§‹é—´éš”ï¼ˆæ¯«ç§’ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;2000&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1000&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;autoCommitOffset&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦è‡ªåŠ¨æäº¤åç§»é‡ï¼ˆKafka åœºæ™¯ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;partitioned&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦ä»åˆ†åŒºç”Ÿäº§è€…æ¥æ”¶æ•°æ®&lt;/td&gt;
&lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;instanceIndex&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰å®ä¾‹ç´¢å¼•ï¼ˆé…åˆ &lt;code&gt;instanceCount&lt;/code&gt;å®ç°åˆ†åŒºè´Ÿè½½å‡è¡¡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;instanceCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆè´¹è€…å®ä¾‹æ€»æ•°&lt;/td&gt;
&lt;td&gt;&lt;code&gt;3&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kafka åœºæ™¯ä¸‹ï¼Œè‹¥ &lt;code&gt;autoCommitOffset=false&lt;/code&gt;ï¼Œéœ€æ‰‹åŠ¨æäº¤åç§»é‡ï¼ˆå¦‚ &lt;code&gt;Acknowledgment.acknowledge()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;instanceIndex&lt;/code&gt;+ &lt;code&gt;instanceCount&lt;/code&gt;éœ€åœ¨åˆ†å¸ƒå¼éƒ¨ç½²ä¸­æ˜¾å¼é…ç½®ï¼Œç¡®ä¿åˆ†åŒºå‡åŒ€åˆ†é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰ç”Ÿäº§è€…ä¸“å±é…ç½®"&gt;ğŸ“¤ &lt;strong&gt;ä¸‰ã€ç”Ÿäº§è€…ä¸“å±é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ &lt;code&gt;spring.cloud.stream.bindings.&amp;lt;channel&amp;gt;.producer.*&lt;/code&gt;ä¸ºå‰ç¼€ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;partitionKeyExpression&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆ†åŒºé”® SpEL è¡¨è¾¾å¼ï¼ˆå¦‚æŒ‰æ¶ˆæ¯å¤´æˆ–è´Ÿè½½å­—æ®µåˆ†åŒºï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;headers['orderId']&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;partitionCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›®æ ‡åˆ†åŒºæ€»æ•°ï¼ˆä»…å¯¹åˆ†åŒºç”Ÿäº§è€…æœ‰æ•ˆï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;4&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;requiredGroups&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»æ¶ˆè´¹æ­¤æ¶ˆæ¯çš„æ¶ˆè´¹è€…ç»„ï¼ˆç¡®ä¿ç»„å†…æ¶ˆè´¹è€…å°±ç»ªï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;inventory-group,log-group&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;headerMode&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯å¤´å¤„ç†æ¨¡å¼ï¼ˆ&lt;code&gt;none&lt;/code&gt;/&lt;code&gt;embeddedHeaders&lt;/code&gt;/&lt;code&gt;headers&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;embeddedHeaders&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¾ Binder&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;partitionKeyExpression&lt;/code&gt;+ &lt;code&gt;partitionCount&lt;/code&gt;å®ç°æ¶ˆæ¯åˆ†åŒºï¼Œç¡®ä¿ç›¸åŒé”®çš„æ¶ˆæ¯è½å…¥åŒä¸€åˆ†åŒºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;requiredGroups&lt;/code&gt;ä¼šåœ¨æ¶ˆæ¯å‘é€å‰è‡ªåŠ¨åˆ›å»ºæ¶ˆè´¹è€…ç»„é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰æˆ– Topicï¼ˆKafkaï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å››å…¸å‹é…ç½®æ¡ˆä¾‹"&gt;âš™ï¸ &lt;strong&gt;å››ã€å…¸å‹é…ç½®æ¡ˆä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯kafka-ç”Ÿäº§è€…é€šé“å‘é€è®¢å•æ¶ˆæ¯"&gt;åœºæ™¯ï¼šKafka ç”Ÿäº§è€…é€šé“ï¼ˆå‘é€è®¢å•æ¶ˆæ¯ï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
orderOutput: # é€šé“é€»è¾‘å
destination: orders-topic # Kafka Topic
binder: kafka-binder1
contentType: application/json
producer:
partitionKeyExpression: &amp;#34;payload.orderId&amp;#34; # æŒ‰è®¢å•IDåˆ†åŒº
partitionCount: 6 # æ€»åˆ†åŒºæ•°
requiredGroups: payment-group,inventory-group
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="åœºæ™¯kafka-æ¶ˆè´¹è€…é€šé“å¤„ç†è®¢å•"&gt;åœºæ™¯ï¼šKafka æ¶ˆè´¹è€…é€šé“ï¼ˆå¤„ç†è®¢å•ï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
orderInput: # é€šé“é€»è¾‘å
destination: orders-topic
group: order-consumer-group # æ¶ˆè´¹è€…ç»„
consumer:
concurrency: 4 # å¹¶å‘çº¿ç¨‹æ•°
maxAttempts: 5 # æœ€å¤§é‡è¯•æ¬¡æ•°
autoCommitOffset: false # å…³é—­è‡ªåŠ¨æäº¤
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-äº”æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;äº”ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç»„å¿…è¦æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœªé…ç½® &lt;code&gt;group&lt;/code&gt;æ—¶ï¼Œæ¯æ¡æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰æ¶ˆè´¹è€…å®ä¾‹é‡å¤æ¶ˆè´¹ï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒåŠ¡å¿…æŒ‡å®šç»„åã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†åŒºä¸€è‡´æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€… &lt;code&gt;partitionCount&lt;/code&gt;åº”ä¸ Kafka Topic å®é™…åˆ†åŒºæ•°ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½è·¯ç”±å¤±è´¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤š Binder åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥é€šé“éœ€æŒ‡å®šéé»˜è®¤ Binderï¼Œéœ€åŒæ—¶é…ç½® &lt;code&gt;binders&lt;/code&gt;å’Œ &lt;code&gt;binder&lt;/code&gt;å‚æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Spring Cloud Stream â‰¥3.0 æ¨èå‡½æ•°å¼ç¼–ç¨‹ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;Beanï¼‰ï¼Œæ­¤æ—¶é€šé“å‘½åæ ¼å¼ä¸º &lt;code&gt;&amp;lt;functionName&amp;gt;-in-0&lt;/code&gt;/&lt;code&gt;&amp;lt;functionName&amp;gt;-out-0&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½®é€šé“å‚æ•°ï¼Œå¯å®ç°æ¶ˆæ¯é¡ºåºæ€§ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤ç­‰é«˜çº§ç‰¹æ€§ï¼Œæ”¯æ’‘é«˜å¯é æ¶ˆæ¯é©±åŠ¨æ¶æ„ã€‚&lt;/p&gt;
&lt;h2 id="å•å·¥"&gt;å•å·¥
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream åŠå…¶ä»–æ¶ˆæ¯é©±åŠ¨æ¡†æ¶ä¸­ï¼ŒChannelï¼ˆé€šé“ï¼‰è¢«è®¾è®¡ä¸ºå•å‘ï¼ˆä»…æ”¯æŒè¾“å…¥æˆ–è¾“å‡ºï¼‰è€ŒéåŒå‘ï¼Œä¸»è¦åŸºäºä»¥ä¸‹æ ¸å¿ƒè®¾è®¡æ€æƒ³å’Œå®é™…éœ€æ±‚ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€èŒè´£éš”ç¦»ä¸è§£è€¦"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€èŒè´£éš”ç¦»ä¸è§£è€¦&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…èŒè´£åˆ†ç¦»&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…&lt;/strong&gt;ï¼šä»…è´Ÿè´£å‘é€æ¶ˆæ¯ï¼ˆ&lt;code&gt;Output Channel&lt;/code&gt;ï¼‰ï¼Œæ— éœ€å…³å¿ƒæ¶ˆæ¯çš„æ¶ˆè´¹é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…&lt;/strong&gt;ï¼šä»…è´Ÿè´£æ¥æ”¶æ¶ˆæ¯ï¼ˆ&lt;code&gt;Input Channel&lt;/code&gt;ï¼‰ï¼Œæ— éœ€æ„ŸçŸ¥æ¶ˆæ¯çš„ç”Ÿæˆè¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè¿™ç§å•å‘è®¾è®¡å¼ºåˆ¶ç»„ä»¶èŒè´£å•ä¸€åŒ–ï¼Œé¿å…é€»è¾‘æ··æ‚ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§ã€‚ä¾‹å¦‚ï¼Œä¿®æ”¹ç”Ÿäº§è€…é€»è¾‘ä¸ä¼šå½±å“æ¶ˆè´¹è€…å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦æ¶ˆæ¯ä¸­é—´ä»¶å·®å¼‚&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸åŒæ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ RabbitMQ çš„ Exchange å’Œ Kafka çš„ Topicï¼‰åº•å±‚å®ç°å·®å¼‚å¤§ã€‚å•å‘é€šé“é€šè¿‡ç»Ÿä¸€æŠ½è±¡ï¼ˆå¦‚ &lt;code&gt;destination&lt;/code&gt;ï¼‰å±è”½åº•å±‚ç»†èŠ‚ï¼Œä½¿å¼€å‘è€…æ— éœ€å¤„ç†åŒå‘é€‚é…çš„å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒé€šä¿¡æ¨¡å¼åŒ¹é…"&gt;âš™ï¸ &lt;strong&gt;äºŒã€é€šä¿¡æ¨¡å¼åŒ¹é…&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‘å¸ƒ-è®¢é˜…æ¨¡å¼ä¸»å¯¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Spring Cloud Stream çš„æ ¸å¿ƒé€šä¿¡æ¨¡å¼æ˜¯&lt;strong&gt;å‘å¸ƒ-è®¢é˜…&lt;/strong&gt;ï¼ˆPub/Subï¼‰ï¼Œå³ç”Ÿäº§è€…å¹¿æ’­æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ç‹¬ç«‹è®¢é˜…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å•å‘é€šé“å¤©ç„¶å¥‘åˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Output Channel&lt;/code&gt;å¯¹åº”å‘å¸ƒè€…ï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Input Channel&lt;/code&gt;å¯¹åº”è®¢é˜…è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è‹¥è®¾è®¡åŒå‘é€šé“ï¼Œä¼šç ´åå‘å¸ƒ-è®¢é˜…çš„è¯­ä¹‰ï¼Œå¢åŠ æ¶ˆæ¯è·¯ç”±çš„å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯ä¾èµ–é£é™©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åŒå‘é€šé“å¯èƒ½å¯¼è‡´ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç›¸äº’ä¾èµ–ï¼Œå½¢æˆå¾ªç¯è°ƒç”¨ï¼ˆå¦‚ A ç­‰å¾… B çš„å“åº”ï¼ŒB åˆç­‰å¾… A çš„å“åº”ï¼‰ï¼Œæ˜“å¼•å‘æ­»é”æˆ–æ€§èƒ½ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰æ€§èƒ½ä¸èµ„æºä¼˜åŒ–"&gt;ğŸš€ &lt;strong&gt;ä¸‰ã€æ€§èƒ½ä¸èµ„æºä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘èµ„æºç«äº‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å•å‘é€šé“ä»…éœ€å•å‘æ•°æ®æµæ§åˆ¶ï¼ˆå¦‚èƒŒå‹æœºåˆ¶ä½œç”¨äºæ¶ˆè´¹è€…ï¼‰ï¼Œé¿å…åŒå‘é€šä¿¡ä¸­è¯»å†™é”çš„ç«äº‰ï¼Œæå‡ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒKafka çš„åˆ†åŒºè¯»å†™åˆ†ç¦»è®¾è®¡æ­£æ˜¯åŸºäºæ­¤ç†å¿µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–é”™è¯¯å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å•å‘é€šé“çš„å¼‚å¸¸å¤„ç†æ›´æ˜ç¡®ï¼šç”Ÿäº§è€…åªéœ€å…³æ³¨å‘é€å¤±è´¥ï¼ˆå¦‚ç½‘ç»œä¸­æ–­ï¼‰ï¼Œæ¶ˆè´¹è€…åªéœ€å¤„ç†æ¶ˆè´¹å¼‚å¸¸ï¼ˆå¦‚ååºåˆ—åŒ–é”™è¯¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åŒå‘é€šé“éœ€åŒæ—¶å¤„ç†æ”¶å‘é”™è¯¯ï¼Œå¢åŠ äº†çŠ¶æ€ç®¡ç†å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››å®‰å…¨ä¸åˆè§„æ€§"&gt;ğŸ›¡ï¸ &lt;strong&gt;å››ã€å®‰å…¨ä¸åˆè§„æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶æ•°æ®æµå‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å•å‘é€šé“å¤©ç„¶æ”¯æŒ&lt;strong&gt;æ•°æ®å•å‘ä¼ è¾“&lt;/strong&gt;ï¼Œé€‚ç”¨äºå®‰å…¨æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚é‡‘èæ•°æ®å¯¼å‡ºï¼‰ï¼Œé˜²æ­¢æœªæˆæƒçš„åå‘æ•°æ®æ¸—é€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™éš”ç¦»&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯é…ç½®ç‹¬ç«‹æƒé™ï¼ˆå¦‚ RabbitMQ çš„è¯»å†™æƒé™åˆ†ç¦»ï¼‰ï¼Œé¿å…è¶Šæƒæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”æ‰©å±•æ€§ä¸çµæ´»æ€§"&gt;ğŸ”„ &lt;strong&gt;äº”ã€æ‰©å±•æ€§ä¸çµæ´»æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç»„åˆæ›¿ä»£åŒå‘é€šé“&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¯·æ±‚-å“åº”æ¨¡å¼æ—¶ï¼Œå¯é€šè¿‡ç»„åˆå•å‘é€šé“å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ A çš„ &lt;code&gt;Output&lt;/code&gt;â†’ æœåŠ¡ B çš„ &lt;code&gt;Input&lt;/code&gt;â†’ æœåŠ¡ B çš„ &lt;code&gt;Output&lt;/code&gt;â†’ æœåŠ¡ A çš„ &lt;code&gt;Input&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šè®¢å•æœåŠ¡å‘é€è¯·æ±‚ï¼ˆ&lt;code&gt;order-request-out&lt;/code&gt;ï¼‰ï¼Œåº“å­˜æœåŠ¡æ¶ˆè´¹å¹¶è¿”å›å“åº”ï¼ˆ&lt;code&gt;order-response-out&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¯æŒå¼‚æ­¥ä¸åŒæ­¥çµæ´»åˆ‡æ¢&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å•å‘é€šé“é»˜è®¤å¼‚æ­¥é€šä¿¡ï¼ˆéé˜»å¡ï¼‰ï¼Œè‹¥éœ€åŒæ­¥å“åº”å¯é€šè¿‡ &lt;code&gt;@SendTo&lt;/code&gt;æ³¨è§£æˆ–æ¶ˆæ¯å…³è” ID å®ç°ï¼Œè€Œä¸ç ´åé€šé“è®¾è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å•å‘è®¾è®¡çš„æœ¬è´¨ä¼˜åŠ¿"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šå•å‘è®¾è®¡çš„æœ¬è´¨ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å•å‘é€šé“&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŒå‘é€šé“&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èŒè´£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§è€…/æ¶ˆè´¹è€…è§£è€¦ï¼Œå„å¸å…¶èŒ&lt;/td&gt;
&lt;td&gt;é€»è¾‘æ··æ‚ï¼Œæ˜“äº§ç”Ÿå¾ªç¯ä¾èµ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— é”ç«äº‰ï¼Œååé‡é«˜&lt;/td&gt;
&lt;td&gt;éœ€åŒå‘é”ç®¡ç†ï¼Œæ€§èƒ½æŸè€—å¤§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŠ¨æ€ç»„åˆæ”¯æŒå¤æ‚åœºæ™¯&lt;/td&gt;
&lt;td&gt;è€¦åˆåº¦é«˜ï¼Œæ‰©å±•å›°éš¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®æµå‘å¯æ§ï¼Œæƒé™åˆ†ç¦»&lt;/td&gt;
&lt;td&gt;å®‰å…¨è¾¹ç•Œæ¨¡ç³Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸­é—´ä»¶é€‚é…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»Ÿä¸€æŠ½è±¡ï¼Œå±è”½å·®å¼‚&lt;/td&gt;
&lt;td&gt;éœ€é€‚é…ä¸åŒä¸­é—´ä»¶çš„åŒå‘è¯­ä¹‰ï¼Œå®ç°å¤æ‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ¬è´¨&lt;/strong&gt;ï¼šå•å‘é€šé“é€šè¿‡&lt;strong&gt;çº¦æŸåˆ›é€ è‡ªç”±&lt;/strong&gt;â€”â€”ä»¥é™åˆ¶é€šä¿¡æ–¹å‘ä¸ºä»£ä»·ï¼Œæ¢å–äº†ç³»ç»Ÿç»“æ„æ¸…æ™°æ€§ã€æ€§èƒ½å¯é¢„æµ‹æ€§åŠè·¨ä¸­é—´ä»¶å…¼å®¹æ€§ï¼Œæ›´å¥‘åˆåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¾è€¦åˆã€é«˜å†…èšçš„è®¾è®¡åŸåˆ™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å‡½æ•°å¼ç¼–ç¨‹"&gt;å‡½æ•°å¼ç¼–ç¨‹
&lt;/h2&gt;&lt;p&gt;Spring Cloud Stream çš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ï¼ˆåŸºäº &lt;code&gt;Supplier&lt;/code&gt;ã€&lt;code&gt;Consumer&lt;/code&gt;å’Œ &lt;code&gt;Function&lt;/code&gt;æ¥å£ï¼‰æ˜¯è‡ª &lt;strong&gt;3.x ç‰ˆæœ¬&lt;/strong&gt;èµ·å®˜æ–¹æ¨èçš„æ ¸å¿ƒå¼€å‘æ–¹å¼ï¼Œå–ä»£äº†ä¼ ç»Ÿçš„æ³¨è§£é©±åŠ¨æ¨¡å‹ï¼ˆå¦‚ &lt;code&gt;@EnableBinding&lt;/code&gt;ã€&lt;code&gt;@StreamListener&lt;/code&gt;ï¼‰ã€‚è¯¥æ¨¡å‹é€šè¿‡å£°æ˜å¼å‡½æ•°ç®€åŒ–äº†æ¶ˆæ¯çš„ç”Ÿäº§ã€å¤„ç†å’Œæ¶ˆè´¹ï¼Œæå‡äº†ä»£ç çš„ç®€æ´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€æ ¸å¿ƒå‡½æ•°å¼æ¥å£"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€æ ¸å¿ƒå‡½æ•°å¼æ¥å£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-suppliert"&gt;1. &lt;strong&gt;&lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;ï¼ˆç”Ÿäº§è€…ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ— å…¥å‚ï¼Œè¿”å›æ¶ˆæ¯è´Ÿè½½ &lt;code&gt;T&lt;/code&gt;ï¼Œè¡¨ç¤º&lt;strong&gt;æ¶ˆæ¯æº&lt;/strong&gt;ï¼ˆåªå‡ºä¸è¿›ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§¦å‘æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨è§¦å‘&lt;/strong&gt;ï¼šé»˜è®¤æ¯éš” 1 ç§’è°ƒç”¨ä¸€æ¬¡ï¼ˆå¯é€šè¿‡é…ç½®è°ƒæ•´é¢‘ç‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨è§¦å‘&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;StreamBridge&lt;/code&gt;åŠ¨æ€å‘é€æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Supplier&amp;lt;String&amp;gt; messageProducer() {
return () -&amp;gt; &amp;#34;Hello, Spring Cloud Stream!&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®è°ƒæ•´è§¦å‘é¢‘ç‡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
poller:
fixed-delay: 5000 # æ¯5ç§’è§¦å‘ä¸€æ¬¡
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="2-consumert"&gt;2. &lt;strong&gt;&lt;code&gt;Consumer&amp;lt;T&amp;gt;&lt;/code&gt;ï¼ˆæ¶ˆè´¹è€…ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ¥æ”¶æ¶ˆæ¯è´Ÿè½½ &lt;code&gt;T&lt;/code&gt;ï¼Œæ— è¿”å›å€¼ï¼Œè¡¨ç¤º&lt;strong&gt;æ¶ˆæ¯ç»ˆç‚¹&lt;/strong&gt;ï¼ˆåªè¿›ä¸å‡ºï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;ï¼šæ¶ˆæ¯åˆ°è¾¾ç»‘å®šé€šé“æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Consumer&amp;lt;String&amp;gt; messageConsumer() {
return payload -&amp;gt; System.out.println(&amp;#34;Received: &amp;#34; + payload);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="3-functiont-r"&gt;3. &lt;strong&gt;&lt;code&gt;Function&amp;lt;T, R&amp;gt;&lt;/code&gt;ï¼ˆå¤„ç†å™¨ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ¥æ”¶è¾“å…¥ &lt;code&gt;T&lt;/code&gt;ï¼Œè¿”å›è¾“å‡º &lt;code&gt;R&lt;/code&gt;ï¼Œè¡¨ç¤º&lt;strong&gt;æ¶ˆæ¯å¤„ç†ç®¡é“&lt;/strong&gt;ï¼ˆæœ‰è¿›æœ‰å‡ºï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ¶ˆæ¯è½¬æ¢ã€è¿‡æ»¤ã€èšåˆç­‰ä¸­é—´å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; uppercaseProcessor() {
return input -&amp;gt; input.toUpperCase();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒé…ç½®ä¸ç»‘å®šè§„åˆ™"&gt;âš™ï¸ &lt;strong&gt;äºŒã€é…ç½®ä¸ç»‘å®šè§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å‡½æ•°å£°æ˜ä¸æ¿€æ´»"&gt;1. &lt;strong&gt;å‡½æ•°å£°æ˜ä¸æ¿€æ´»&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰å‡½æ•°&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;å£°æ˜ &lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¿€æ´»å‡½æ•°&lt;/strong&gt;ï¼šåœ¨é…ç½®ä¸­åˆ—å‡ºå‡½æ•°åï¼ˆå¤šä¸ªç”¨åˆ†å·åˆ†éš”ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: messageProducer;uppercaseProcessor;messageConsumer # æ¿€æ´»æ‰€æœ‰å‡½æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-é€šé“è‡ªåŠ¨ç»‘å®š"&gt;2. &lt;strong&gt;é€šé“è‡ªåŠ¨ç»‘å®š&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘½åè§„åˆ™&lt;/strong&gt;ï¼šå‡½æ•°å + &lt;code&gt;-in-{index}&lt;/code&gt;/&lt;code&gt;-out-{index}&lt;/code&gt;ï¼ˆ&lt;code&gt;index&lt;/code&gt;ä» 0 å¼€å§‹ï¼‰ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‡½æ•°ç±»å‹&lt;/th&gt;
&lt;th&gt;è¾“å…¥é€šé“&lt;/th&gt;
&lt;th&gt;è¾“å‡ºé€šé“&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;&lt;code&gt;{å‡½æ•°å}-out-0&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Consumer&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;{å‡½æ•°å}-in-0&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Function&amp;lt;T,R&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;{å‡½æ•°å}-in-0&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;{å‡½æ•°å}-out-0&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç»‘å®šç›®æ ‡&lt;/strong&gt;ï¼ˆå¦‚ Kafka Topicï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
messageProducer-out-0: # ç”Ÿäº§è€…é€šé“
destination: orders-topic
uppercaseProcessor-in-0: # å¤„ç†å™¨è¾“å…¥é€šé“
destination: orders-topic
uppercaseProcessor-out-0: # å¤„ç†å™¨è¾“å‡ºé€šé“
destination: processed-orders-topic
messageConsumer-in-0: # æ¶ˆè´¹è€…é€šé“
destination: processed-orders-topic
group: order-group # æ¶ˆè´¹è€…ç»„ï¼ˆé˜²é‡å¤æ¶ˆè´¹ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰é«˜çº§ç‰¹æ€§"&gt;ğŸš€ &lt;strong&gt;ä¸‰ã€é«˜çº§ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-åŠ¨æ€å‘é€æ¶ˆæ¯"&gt;1. &lt;strong&gt;åŠ¨æ€å‘é€æ¶ˆæ¯ï¼ˆ&lt;code&gt;StreamBridge&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šéå‡½æ•°å¼è§¦å‘ï¼ˆå¦‚ HTTP è¯·æ±‚è§¦å‘æ¶ˆæ¯å‘é€ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private StreamBridge streamBridge;
@GetMapping(&amp;#34;/send&amp;#34;)
public String sendOrder(String payload) {
streamBridge.send(&amp;#34;messageProducer-out-0&amp;#34;, payload); // æŒ‡å®šé€šé“åå‘é€
return &amp;#34;Sent!&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å¤šè¾“å…¥è¾“å‡ºé€šé“"&gt;2. &lt;strong&gt;å¤šè¾“å…¥/è¾“å‡ºé€šé“&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåˆå¹¶æˆ–æ‹†åˆ†å¤šä¸ªæ¶ˆæ¯æµï¼ˆå¦‚è®¢å•+åº“å­˜æ•°æ®åˆå¹¶å¤„ç†ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;Tuple&lt;/code&gt;åŒ…è£…å¤šä¸ª &lt;code&gt;Flux&lt;/code&gt;æµï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;Tuple2&amp;lt;Flux&amp;lt;String&amp;gt;, Flux&amp;lt;Integer&amp;gt;&amp;gt;, Flux&amp;lt;String&amp;gt;&amp;gt; mergeStreams() {
return tuple -&amp;gt; {
Flux&amp;lt;String&amp;gt; strings = tuple.getT1();
Flux&amp;lt;String&amp;gt; numbers = tuple.getT2().map(i -&amp;gt; &amp;#34;Num-&amp;#34; + i);
return Flux.merge(strings, numbers); // åˆå¹¶æµ
};
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»‘å®šé…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;bindings:
mergeStreams-in-0: destination: strings-topic
mergeStreams-in-1: destination: numbers-topic
mergeStreams-out-0: destination: merged-topic
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å‡½æ•°ç»„åˆfunction-composition"&gt;3. &lt;strong&gt;å‡½æ•°ç»„åˆï¼ˆFunction Compositionï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šä¸²è”å¤šä¸ªå¤„ç†é€»è¾‘ï¼ˆå¦‚ï¼šè¿‡æ»¤ â†’ è½¬æ¢ â†’ å­˜å‚¨ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: filter;transform;save # ç»„åˆé¡ºåº
stream:
bindings:
filter-in-0: destination: input-topic
save-out-0: destination: output-topic
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯æµå‘ï¼š&lt;code&gt;input-topic&lt;/code&gt;â†’ &lt;code&gt;filter&lt;/code&gt;â†’ &lt;code&gt;transform&lt;/code&gt;â†’ &lt;code&gt;save&lt;/code&gt;â†’ &lt;code&gt;output-topic&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å››æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å››ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring Cloud Stream â‰¥3.1.x ä»…æ”¯æŒå‡½æ•°å¼æ¨¡å‹ï¼Œæ—§æ³¨è§£ï¼ˆ&lt;code&gt;@StreamListener&lt;/code&gt;ï¼‰å·²å¼ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ååº”å¼ç¼–ç¨‹æ”¯æŒ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;Flux&lt;/code&gt;/&lt;code&gt;Mono&lt;/code&gt;å®ç°å¼‚æ­¥æµå¤„ç†ï¼ˆéœ€è¿”å› &lt;code&gt;Supplier&amp;lt;Flux&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt;æˆ– &lt;code&gt;Function&amp;lt;Flux&amp;lt;T&amp;gt;, Flux&amp;lt;R&amp;gt;&amp;gt;&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Supplier&amp;lt;Flux&amp;lt;String&amp;gt;&amp;gt; reactiveProducer() {
return () -&amp;gt; Flux.interval(Duration.ofSeconds(1)).map(i -&amp;gt; &amp;#34;Event-&amp;#34; + i);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç»„ä¸åˆ†åŒº&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;group&lt;/code&gt;é…ç½®æ¶ˆè´¹è€…ç»„é¿å…é‡å¤æ¶ˆè´¹ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;partitionKeyExpression&lt;/code&gt;å®ç°æ¶ˆæ¯åˆ†åŒºï¼ˆç¡®ä¿ç›¸åŒé”®çš„æ¶ˆæ¯ç”±åŒä¸€å®ä¾‹å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;äº”ã€æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç ç®€æ´&lt;/strong&gt;ï¼šæ¶ˆé™¤æ³¨è§£æ ·æ¿ä»£ç ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»ç»„åˆ&lt;/strong&gt;ï¼šé€šè¿‡å‡½æ•°ä¸²è”å®ç°å¤æ‚æµå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•&lt;/strong&gt;ï¼šæ”¯æŒåŠ¨æ€é€šé“ç»‘å®šå’Œæ¶ˆæ¯è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¾®æœåŠ¡é—´å¼‚æ­¥é€šä¿¡ï¼ˆè®¢å•â†’åº“å­˜â†’é€šçŸ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®æ—¶æ•°æ®æµæ°´çº¿ï¼ˆæ—¥å¿—æ”¶é›†â†’è¿‡æ»¤â†’å­˜å‚¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆç”¨æˆ·æ³¨å†Œè§¦å‘å¤šæœåŠ¡åä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¿ç§»å»ºè®®&lt;/strong&gt;ï¼šæ–°é¡¹ç›®ç›´æ¥é‡‡ç”¨å‡½æ•°å¼æ¨¡å‹ï¼›æ—§é¡¹ç›®å‡çº§æ—¶é€æ­¥æ›¿æ¢æ³¨è§£ï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;StreamBridge&lt;/code&gt;è¿‡æ¸¡åŠ¨æ€å‘é€éœ€æ±‚ã€‚é€šè¿‡åˆç†é…ç½®é€šé“ä¸å‡½æ•°ç»‘å®šï¼Œå¯æ— ç¼å¯¹æ¥ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°é«˜æ•ˆè§£è€¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="spring-cloud-function"&gt;Spring Cloud Function
&lt;/h2&gt;&lt;p&gt;Spring Cloud Function æ˜¯ä¸€ä¸ªåŸºäº Spring ç”Ÿæ€çš„å‡½æ•°å¼ç¼–ç¨‹æ¡†æ¶ï¼Œæ—¨åœ¨é€šè¿‡ &lt;strong&gt;ä¸šåŠ¡é€»è¾‘ä¸è¿è¡Œæ—¶è§£è€¦&lt;/strong&gt;ï¼Œç®€åŒ–äº‘åŸç”Ÿåº”ç”¨çš„å¼€å‘ã€‚å®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨æ ‡å‡† Java å‡½æ•°ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;ã€&lt;code&gt;Function&lt;/code&gt;ã€&lt;code&gt;Consumer&lt;/code&gt;ï¼‰æ„å»ºæœåŠ¡ï¼Œå¹¶æ”¯æŒéƒ¨ç½²åˆ°å¤šç§ç¯å¢ƒï¼ˆHTTP æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ— æœåŠ¡å™¨å¹³å°ç­‰ï¼‰ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒæ¦‚å¿µåˆ°åº”ç”¨åœºæ™¯çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸€æ ¸å¿ƒæ¦‚å¿µä¸è®¾è®¡ç›®æ ‡"&gt;ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸è®¾è®¡ç›®æ ‡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¼€å‘è€…åªéœ€ç¼–å†™æ™®é€š Java å‡½æ•°ï¼Œæ¡†æ¶è‡ªåŠ¨é€‚é…ä¸åŒè¿è¡Œç¯å¢ƒï¼ˆHTTPã€æ¶ˆæ¯é˜Ÿåˆ—ã€FaaS å¹³å°ï¼‰ï¼Œå®ç° &lt;strong&gt;â€œä¸€æ¬¡ç¼–å†™ï¼Œå¤šç¯å¢ƒéƒ¨ç½²â€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ¥å£&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;ï¼šæ— è¾“å…¥ï¼Œç”Ÿæˆæ•°æ®ï¼ˆç”Ÿäº§è€…ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Function&amp;lt;T, R&amp;gt;&lt;/code&gt;ï¼šè¾“å…¥ â†’ è¾“å‡ºï¼ˆå¤„ç†å™¨ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Consumer&amp;lt;T&amp;gt;&lt;/code&gt;ï¼šä»…æ¶ˆè´¹è¾“å…¥ï¼Œæ— è¾“å‡ºï¼ˆæ¶ˆè´¹è€…ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ§åˆ¶åè½¬çš„å»¶ä¼¸&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å°† Hollywood åŸåˆ™ï¼ˆâ€œä¸è¦è°ƒç”¨æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä½ â€ï¼‰æ¨è¿›åˆ°æ–°é«˜åº¦ï¼šå¼€å‘è€…èšç„¦ä¸šåŠ¡é€»è¾‘ï¼Œæ¡†æ¶å¤„ç†ä¼ è¾“åè®®ã€åºåˆ—åŒ–ç­‰åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äºŒæ ¸å¿ƒåŠŸèƒ½ä¸æŠ€æœ¯ç»†èŠ‚"&gt;äºŒã€æ ¸å¿ƒåŠŸèƒ½ä¸æŠ€æœ¯ç»†èŠ‚
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°å®šä¹‰ä¸æ³¨å†Œ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;å£°æ˜å‡½æ•°ï¼ŒSpring è‡ªåŠ¨å°†å…¶çº³å…¥ &lt;code&gt;FunctionCatalog&lt;/code&gt;ç®¡ç†ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
public class App {
@Bean
public Function&amp;lt;String, String&amp;gt; uppercase() {
return String::toUpperCase; // ä¸šåŠ¡é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°ç»„åˆä¸è·¯ç”±&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„åˆ&lt;/strong&gt;ï¼šå°†å¤šä¸ªå‡½æ•°ä¸²è”ä¸ºå¤„ç†ç®¡é“ï¼ˆå¦‚ &lt;code&gt;uppercase | reverse&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: uppercase|reverse # ç»„åˆå‡½æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¯ç”±&lt;/strong&gt;ï¼šåŠ¨æ€é€‰æ‹©æ‰§è¡Œå‡½æ•°ï¼ˆå¦‚æ ¹æ®æ¶ˆæ¯å¤´è·¯ç”±ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; router() {
return input -&amp;gt; input.startsWith(&amp;#34;upper:&amp;#34;) ? &amp;#34;uppercase&amp;#34; : &amp;#34;reverse&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ååº”å¼ç¼–ç¨‹æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Reactor çš„ &lt;code&gt;Flux&lt;/code&gt;/&lt;code&gt;Mono&lt;/code&gt;å¤„ç†æµæ•°æ®ï¼Œæ”¯æŒèƒŒå‹å’Œéé˜»å¡ I/Oï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;Flux&amp;lt;String&amp;gt;, Flux&amp;lt;String&amp;gt;&amp;gt; reactiveProcessor() {
return flux -&amp;gt; flux.map(String::toUpperCase);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€æ˜ç±»å‹è½¬æ¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¡†æ¶è‡ªåŠ¨å¤„ç†æ¶ˆæ¯ä¸ Java å¯¹è±¡çš„è½¬æ¢ï¼ˆå¦‚ JSON â†’ &lt;code&gt;Person&lt;/code&gt;ç±»ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨åºåˆ—åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸‰é›†æˆä¸éƒ¨ç½²æ–¹æ¡ˆ"&gt;ä¸‰ã€é›†æˆä¸éƒ¨ç½²æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;HTTP æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ·»åŠ  &lt;code&gt;spring-cloud-function-web&lt;/code&gt;ä¾èµ–ï¼Œå‡½æ•°è‡ªåŠ¨æš´éœ²ä¸º REST ç«¯ç‚¹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;curl -X POST http://localhost:8080/uppercase -d &amp;#34;hello&amp;#34; # è¾“å‡º &amp;#34;HELLO&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯ç³»ç»Ÿé›†æˆï¼ˆSpring Cloud Streamï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç»‘å®š Kafka/RabbitMQï¼Œå‡½æ•°è‡ªåŠ¨å¤„ç†æ¶ˆæ¯ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: processOrder
stream:
bindings:
processOrder-in-0: destination: orders-topic # è¾“å…¥ä¸»é¢˜
processOrder-out-0: destination: processed-topic # è¾“å‡ºä¸»é¢˜
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— æœåŠ¡å™¨å¹³å°éƒ¨ç½²ï¼ˆFaaSï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€‚é… AWS Lambdaã€Azure Functions ç­‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚é…å™¨ä¾èµ–&lt;/strong&gt;ï¼š&lt;code&gt;spring-cloud-function-adapter-aws&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤„ç†å™¨ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class Handler extends SpringBootRequestHandler&amp;lt;String, String&amp;gt; {} // è‡ªåŠ¨è°ƒç”¨å‡½æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å››é«˜çº§ç‰¹æ€§"&gt;å››ã€é«˜çº§ç‰¹æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šè¾“å…¥/è¾“å‡ºæµå¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;Tuple&lt;/code&gt;åˆå¹¶æˆ–æ‹†åˆ†æµï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;Tuple2&amp;lt;Flux&amp;lt;String&amp;gt;, Flux&amp;lt;Integer&amp;gt;&amp;gt;, Flux&amp;lt;String&amp;gt;&amp;gt; mergeStreams() {
return tuple -&amp;gt; Flux.merge(tuple.getT1(), tuple.getT2().map(String::valueOf));
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€å‡½æ•°ç¼–è¯‘&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ”¯æŒå°†å­—ç¬¦ä¸²å½¢å¼çš„ Lambda ç¼–è¯‘ä¸ºå¯æ‰§è¡Œå‡½æ•°ï¼Œä¾¿äºåŠ¨æ€é€»è¾‘æ‰©å±•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éš”ç¦»ç±»åŠ è½½å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…è®¸åŒä¸€ JVM ä¸­éƒ¨ç½²å¤šç‰ˆæœ¬å‡½æ•°ï¼Œé¿å…ä¾èµ–å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äº”ä¼ä¸šçº§åº”ç”¨åœºæ™¯"&gt;äº”ã€ä¼ä¸šçº§åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šè®¢å•å¤„ç†æµæ°´çº¿&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;Flux&amp;lt;Order&amp;gt;, Flux&amp;lt;Void&amp;gt;&amp;gt; orderPipeline() {
return orders -&amp;gt; orders
.filter(order -&amp;gt; order.getAmount() &amp;gt; 100) // è¿‡æ»¤
.map(orderEnricher::enrich) // æ•°æ®å¢å¼º
.doOnNext(notificationService::alert) // å‘é€é€šçŸ¥
.then(Mono.empty());
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹å¤„ç†ä¸ ETL&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹æ‰¹é‡æ•°æ®å¹¶è½¬æ¢åå†™å…¥æ•°æ®åº“æˆ–æ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— æœåŠ¡å™¨å‡½æ•°è®¡ç®—&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ AWS Lambda ç­‰å¹³å°éƒ¨ç½²å‡½æ•°ï¼ŒæŒ‰éœ€æ‰§è¡Œã€æŒ‰é‡è®¡è´¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…­ä¼˜åŠ¿æ€»ç»“"&gt;å…­ã€ä¼˜åŠ¿æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼ ç»Ÿæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Spring Cloud Function&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸šåŠ¡è€¦åˆåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸ä¼ è¾“åè®®å¼ºç»‘å®šï¼ˆå¦‚ HTTP Servletï¼‰&lt;/td&gt;
&lt;td&gt;çº¯å‡½æ•°é€»è¾‘ï¼Œä¸åè®®æ— å…³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éƒ¨ç½²çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¯å¢ƒé€‚é…éœ€ä»£ç æ”¹é€ &lt;/td&gt;
&lt;td&gt;é…ç½®åˆ‡æ¢ç¯å¢ƒï¼ˆHTTPâ†’æ¶ˆæ¯é˜Ÿåˆ—â†’FaaSï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯æµ‹è¯•æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ Mock å¤–éƒ¨ä¾èµ–&lt;/td&gt;
&lt;td&gt;ç›´æ¥å•å…ƒæµ‹è¯•å‡½æ•°é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¸¸é©»è¿›ç¨‹å ç”¨èµ„æº&lt;/td&gt;
&lt;td&gt;æ— æœåŠ¡å™¨ç¯å¢ƒä¸‹æŒ‰éœ€å¯åŠ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ¬è´¨ä»·å€¼&lt;/strong&gt;ï¼šé€šè¿‡ &lt;strong&gt;å‡½æ•°æŠ½è±¡å±‚&lt;/strong&gt; è§£è€¦ä¸šåŠ¡ä¸åŸºç¡€è®¾æ–½ï¼Œä½¿å¼€å‘è€…ä¸“æ³¨æ ¸å¿ƒé€»è¾‘ï¼ŒåŒæ—¶è·å¾— &lt;strong&gt;äº‘åŸç”Ÿå¯ç§»æ¤æ€§&lt;/strong&gt; å’Œ &lt;strong&gt;äº‹ä»¶é©±åŠ¨æ‰©å±•æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ä¾èµ–å…³ç³»"&gt;ä¾èµ–å…³ç³»
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream â‰¥3.0 ä¸­ï¼Œ&lt;strong&gt;å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ï¼‰çš„å®ç°æœ¬è´¨ä¸Šæ˜¯ä¸ Spring Cloud Function æ·±åº¦é›†æˆçš„&lt;/strong&gt;ï¼Œä½†å¼€å‘è€…æ˜¯å¦éœ€è¦æ˜¾å¼å¼•å…¥å…¶ä¾èµ–ï¼Œéœ€æ ¹æ®å…·ä½“åœºæ™¯å’Œç‰ˆæœ¬è¦æ±‚åŒºåˆ†ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒç»“è®º"&gt;âœ… &lt;strong&gt;æ ¸å¿ƒç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºç¡€å‡½æ•°å¼ç¼–ç¨‹æ— éœ€æ˜¾å¼ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Spring Cloud Stream â‰¥3.0 &lt;strong&gt;å†…ç½®äº†å¯¹å‡½æ•°å¼æ¥å£çš„æ”¯æŒ&lt;/strong&gt;ã€‚å¼€å‘è€…ä»…éœ€é€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;å£°æ˜ &lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ç±»å‹çš„ Beanï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨ç»‘å®šæ¶ˆæ¯é€šé“ï¼Œæ— éœ€é¢å¤–æ·»åŠ  &lt;code&gt;spring-cloud-function&lt;/code&gt;ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: myProducer;myProcessor # å£°æ˜å‡½æ•°å
stream:
bindings:
myProducer-out-0: destination: orders-topic # è‡ªåŠ¨ç»‘å®šç”Ÿäº§è€…é€šé“
myProcessor-in-0: destination: orders-topic # ç»‘å®šå¤„ç†å™¨è¾“å…¥
myProcessor-out-0: destination: processed-topic # ç»‘å®šå¤„ç†å™¨è¾“å‡º
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜çº§ç‰¹æ€§éœ€æ˜¾å¼ä¾èµ– Spring Cloud Function&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥éœ€ä½¿ç”¨ä»¥ä¸‹èƒ½åŠ›ï¼Œå¿…é¡»å¼•å…¥ &lt;code&gt;spring-cloud-function&lt;/code&gt;ä¾èµ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°ç»„åˆ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;uppercase|reverse&lt;/code&gt;ï¼‰ï¼Œé€šè¿‡ç®¡é“ä¸²è”å¤šä¸ªå‡½æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è·¯ç”±&lt;/strong&gt;ï¼ˆRouting Functionï¼‰ï¼Œæ ¹æ®æ¶ˆæ¯å†…å®¹åŠ¨æ€é€‰æ‹©å¤„ç†å‡½æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”å¼æµé«˜çº§æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;Flux&lt;/code&gt;çš„çª—å£èšåˆã€èƒŒå‹æ§åˆ¶ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-function-context&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬æ¼”è¿›ä¸å¼ºåˆ¶ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud Stream 3.1+&lt;/strong&gt;ï¼šå®Œå…¨åºŸå¼ƒæ³¨è§£æ¨¡å‹ï¼ˆ&lt;code&gt;@EnableBinding&lt;/code&gt;ï¼‰ï¼Œ&lt;strong&gt;å¼ºåˆ¶ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹&lt;/strong&gt;ï¼Œæ­¤æ—¶æ¡†æ¶åº•å±‚å·²æ·±åº¦æ•´åˆ Spring Cloud Functionï¼Œä½†åŸºç¡€ç”¨æ³•ä»å¯ä¸æ˜¾å¼æ·»åŠ ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud Stream 4.0+&lt;/strong&gt;ï¼šå‡½æ•°å¼ç¼–ç¨‹æˆä¸ºå”¯ä¸€æ¨¡å‹ï¼ŒSpring Cloud Function æˆä¸ºéšå¼æ ¸å¿ƒç»„ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨å»ºè®®"&gt;âš™ï¸ &lt;strong&gt;ä½¿ç”¨å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦éœ€è¦æ˜¾å¼ä¾èµ–&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŸºç¡€æ¶ˆæ¯ç”Ÿäº§/æ¶ˆè´¹&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;ä»…éœ€ &lt;code&gt;spring-cloud-stream&lt;/code&gt;+ Binderï¼ˆå¦‚ &lt;code&gt;spring-cloud-stream-binder-kafka&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å‡½æ•°ç»„åˆã€åŠ¨æ€è·¯ç”±&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;éœ€æ·»åŠ  &lt;code&gt;spring-cloud-function-context&lt;/code&gt;å®ç°å¤æ‚æµå¤„ç†ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å“åº”å¼æµé«˜çº§æ“ä½œ&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;éœ€ Reactor å’Œ Spring Cloud Function ååŒæ”¯æŒã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¿ç§»æ—§ç‰ˆæ³¨è§£æ¨¡å‹&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å‡½æ•°å¼æ¨¡å‹å¯ç›´æ¥æ›¿ä»£ï¼Œæ— éœ€é¢å¤–ä¾èµ–ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æŠ€æœ¯åŸç†"&gt;ğŸ’¡ &lt;strong&gt;æŠ€æœ¯åŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨ç»‘å®šæœºåˆ¶&lt;/strong&gt;ï¼šSpring Cloud Stream é€šè¿‡ &lt;code&gt;FunctionCatalog&lt;/code&gt;è‡ªåŠ¨å‘ç°å‡½æ•° Beanï¼ŒæŒ‰å‘½åè§„åˆ™ï¼ˆå¦‚ &lt;code&gt;å‡½æ•°å-in-0&lt;/code&gt;ï¼‰ç»‘å®šé€šé“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡½æ•°ç»„åˆå®ç°&lt;/strong&gt;ï¼šSpring Cloud Function æä¾› &lt;code&gt;FunctionRegistry&lt;/code&gt;å’Œ &lt;code&gt;FunctionType&lt;/code&gt;ï¼ŒåŠ¨æ€ç»„è£…å‡½æ•°ç®¡é“ï¼ˆå¦‚ &lt;code&gt;f1|f2&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;ï¼šæ— è®ºæ˜¯å¦æ˜¾å¼ä¾èµ–ï¼Œå‡½æ•°å¼ç¼–ç¨‹å‡åŸºäº Spring Cloud Function çš„åº•å±‚æŠ½è±¡ï¼Œä½†æ¡†æ¶å·²å†…ç½®æœ€å°åŒ–æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®ç¤ºä¾‹"&gt;ğŸ”§ &lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ— æ˜¾å¼ä¾èµ–åŸºç¡€åœºæ™¯"&gt;1. æ— æ˜¾å¼ä¾èµ–ï¼ˆåŸºç¡€åœºæ™¯ï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
public class App {
@Bean
public Supplier&amp;lt;String&amp;gt; myProducer() { // è‡ªåŠ¨ç»‘å®šåˆ° myProducer-out-0
return () -&amp;gt; &amp;#34;New order&amp;#34;;
}
@Bean
public Consumer&amp;lt;String&amp;gt; myConsumer() { // è‡ªåŠ¨ç»‘å®šåˆ° myConsumer-in-0
return msg -&amp;gt; System.out.println(&amp;#34;Received: &amp;#34; + msg);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="2-éœ€æ˜¾å¼ä¾èµ–å‡½æ•°ç»„åˆ"&gt;2. éœ€æ˜¾å¼ä¾èµ–ï¼ˆå‡½æ•°ç»„åˆï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# application.yml
spring:
cloud:
function:
definition: validateOrder|processPayment|sendNotification # ç»„åˆå‡½æ•°
stream:
bindings:
validateOrder-in-0: destination: orders-topic
sendNotification-out-0: destination: notifications-topic
&amp;lt;!-- pom.xml éœ€æ˜¾å¼æ·»åŠ  --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-cloud-function-context&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ•°åœºæ™¯æ— éœ€æ˜¾å¼ä¾èµ–&lt;/strong&gt;ï¼šSpring Cloud Stream â‰¥3.0 çš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹å·²å†…ç½®åŸºç¡€æ”¯æŒï¼Œå¯ç›´æ¥ä½¿ç”¨ &lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜çº§åŠŸèƒ½å¼ºåˆ¶ä¾èµ–&lt;/strong&gt;ï¼šå‡½æ•°ç»„åˆã€åŠ¨æ€è·¯ç”±ç­‰éœ€æ˜¾å¼å¼•å…¥ &lt;code&gt;spring-cloud-function&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¼”è¿›æ–¹å‘&lt;/strong&gt;ï¼šéšç€ç‰ˆæœ¬å‡çº§ï¼ŒSpring Cloud Function å·²æˆä¸ºå‡½æ•°å¼æ¶ˆæ¯å¤„ç†çš„&lt;strong&gt;äº‹å®æ ‡å‡†åº•å±‚&lt;/strong&gt;ï¼Œæ˜¾å¼ä¾èµ–ä»…ç”¨äºæ‰©å±•èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ¨èå®è·µ&lt;/strong&gt;ï¼šæ–°é¡¹ç›®å»ºè®®ç›´æ¥æ·»åŠ  &lt;code&gt;spring-cloud-function&lt;/code&gt;ä¾èµ–ä»¥æ”¯æŒæœªæ¥æ‰©å±•ï¼Œé¿å…å› åŠŸèƒ½å‡çº§å¯¼è‡´é‡æ„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="definition"&gt;definition
&lt;/h2&gt;&lt;p&gt;Spring Cloud Function åœ¨ç»‘å®šå‡½æ•°æ—¶ï¼Œå…¶è¡Œä¸ºå–å†³äº &lt;strong&gt;&lt;code&gt;spring.cloud.function.definition&lt;/code&gt;&lt;/strong&gt; é…ç½®å±æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§„åˆ™ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€ç»‘å®šè§„åˆ™"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€ç»‘å®šè§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœªé…ç½® &lt;code&gt;definition&lt;/code&gt;å±æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸º&lt;/strong&gt;ï¼šSpring Cloud Function ä¼šè‡ªåŠ¨ç»‘å®š &lt;strong&gt;æ‰€æœ‰&lt;/strong&gt; å£°æ˜ä¸º &lt;code&gt;@Bean&lt;/code&gt;çš„ &lt;code&gt;Supplier&lt;/code&gt;ã€&lt;code&gt;Function&lt;/code&gt;ã€&lt;code&gt;Consumer&lt;/code&gt;ç±»å‹ç»„ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; uppercase() { ... } // è‡ªåŠ¨ç»‘å®š
@Bean
public Consumer&amp;lt;String&amp;gt; logger() { ... } // è‡ªåŠ¨ç»‘å®š
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“å‘½å&lt;/strong&gt;ï¼šå‡½æ•°å + &lt;code&gt;-in-0&lt;/code&gt;ï¼ˆè¾“å…¥é€šé“ï¼‰æˆ– &lt;code&gt;-out-0&lt;/code&gt;ï¼ˆè¾“å‡ºé€šé“ï¼‰ï¼Œå¦‚ &lt;code&gt;uppercase-in-0&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½® &lt;code&gt;definition&lt;/code&gt;å±æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‰æ‹©æ€§ç»‘å®š&lt;/strong&gt;ï¼šä»…ç»‘å®š &lt;code&gt;definition&lt;/code&gt;ä¸­åˆ—å‡ºçš„å‡½æ•°ï¼ˆå¤šä¸ªå‡½æ•°ç”¨åˆ†å·æˆ–é€—å·åˆ†éš”ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: uppercase;logger # ä»…ç»‘å®š uppercase å’Œ logger
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœªåˆ—å‡ºçš„å‡½æ•°&lt;/strong&gt;ï¼šä¸ä¼šè¢«æ³¨å†Œåˆ° &lt;code&gt;FunctionCatalog&lt;/code&gt;ï¼Œæ— æ³•é€šè¿‡æ¶ˆæ¯æˆ– HTTP è®¿é—® ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒå‡½æ•°ç»„åˆä¸åŠ¨æ€è·¯ç”±"&gt;âš™ï¸ &lt;strong&gt;äºŒã€å‡½æ•°ç»„åˆä¸åŠ¨æ€è·¯ç”±&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°ç»„åˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;definition&lt;/code&gt;å°†å¤šä¸ªå‡½æ•°ä¸²è”ï¼ˆå¦‚ &lt;code&gt;f1|f2&lt;/code&gt;ï¼‰ï¼Œå½¢æˆå¤„ç†ç®¡é“ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: validateOrder|processPayment # ç»„åˆå‡½æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»…ç»„åˆå‡½æ•°ä¼šè¢«ç»‘å®šï¼Œå•å‡½æ•°éœ€æ˜¾å¼åˆ—å‡º ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è·¯ç”±&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;MessageRoutingCallback&lt;/code&gt;æˆ– HTTP å¤´åŠ¨æ€é€‰æ‹©å‡½æ•°ï¼Œä½†è·¯ç”±ç›®æ ‡å‡½æ•°ä»éœ€åœ¨ &lt;code&gt;definition&lt;/code&gt;ä¸­å£°æ˜ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ &lt;strong&gt;ä¸‰ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‡½æ•°å‘½åå†²çª&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å¤šä¸ªå‡½æ•°åŒåï¼Œå¯åŠ¨æ—¶ä¼šæŠ¥ &lt;code&gt;BeanDefinition&lt;/code&gt;å†²çªï¼Œéœ€é€šè¿‡ &lt;code&gt;@Bean(name=&amp;quot;customName&amp;quot;)&lt;/code&gt;æ˜¾å¼å‘½åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååº”å¼å‡½æ•°ç»‘å®š&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ååº”å¼å‡½æ•°ï¼ˆå¦‚ &lt;code&gt;Function&amp;lt;Flux&amp;lt;String&amp;gt;, Flux&amp;lt;String&amp;gt;&amp;gt;&lt;/code&gt;ï¼‰ç»‘å®šè§„åˆ™ä¸å‘½ä»¤å¼ä¸€è‡´ï¼Œä½†éœ€æ³¨æ„è®¢é˜…æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Consumer&amp;lt;Flux&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt;éœ€ä¸»åŠ¨è®¢é˜…ï¼ˆå¦‚ &lt;code&gt;flux.subscribe()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP ç«¯ç‚¹æ˜ å°„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä½¿ç”¨ &lt;code&gt;spring-cloud-function-web&lt;/code&gt;æ—¶ï¼š
&lt;ul&gt;
&lt;li&gt;æœªé…ç½® &lt;code&gt;definition&lt;/code&gt;ï¼šæ‰€æœ‰å‡½æ•°æ˜ å°„ä¸º HTTP ç«¯ç‚¹ï¼ˆå¦‚ &lt;code&gt;/uppercase&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½® &lt;code&gt;definition&lt;/code&gt;ï¼šä»…åˆ—å‡ºçš„å‡½æ•°å¯è®¿é—®ï¼Œæœªåˆ—å‡ºçš„è¿”å› 404 ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››æœ€ä½³å®è·µ"&gt;ğŸ’ &lt;strong&gt;å››ã€æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®å»ºè®®&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç®€å•å¾®æœåŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸é…ç½® &lt;code&gt;definition&lt;/code&gt;ï¼Œè‡ªåŠ¨ç»‘å®šæ‰€æœ‰å‡½æ•°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤æ‚æµå¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é…ç½® &lt;code&gt;definition&lt;/code&gt;ç»„åˆå‡½æ•°ï¼ˆå¦‚ `filter&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®‰å…¨æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;definition&lt;/code&gt;é™åˆ¶æš´éœ²çš„å‡½æ•°ï¼Œé¿å…æœªæˆæƒè®¿é—®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€ç¯å¢ƒéƒ¨ç½²&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»“åˆ &lt;code&gt;FunctionCatalog&lt;/code&gt;ç¼–ç¨‹å¼ç®¡ç†å‡½æ•°ï¼ˆå¦‚åŠ¨æ€åŠ è½½å¤–éƒ¨å‡½æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤ç»‘å®šæ‰€æœ‰&lt;/strong&gt;ï¼šæœªé…ç½® &lt;code&gt;spring.cloud.function.definition&lt;/code&gt;æ—¶ï¼Œæ‰€æœ‰å‡½æ•°å‡è¢«ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‰æ‹©æ€§ç»‘å®š&lt;/strong&gt;ï¼šé…ç½® &lt;code&gt;definition&lt;/code&gt;åï¼Œä»…åˆ—å‡ºçš„å‡½æ•°ä¼šè¢«æ³¨å†Œå’Œæš´éœ²ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½® &lt;code&gt;definition&lt;/code&gt;ï¼Œå¯ç²¾å‡†æ§åˆ¶å‡½æ•°æš´éœ²èŒƒå›´ï¼Œæå‡å®‰å…¨æ€§ä¸å¯ç»´æŠ¤æ€§ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="ç»„åˆå‡½æ•°"&gt;ç»„åˆå‡½æ•°
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Function ä¸­ï¼Œç»„åˆå‡½æ•°ï¼ˆFunction Compositionï¼‰æ˜¯ä¸€ç§å°†å¤šä¸ªç®€å•å‡½æ•°ä¸²è”æˆå¤æ‚å¤„ç†ç®¡é“çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå®ƒé€šè¿‡å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹æ˜¾è‘—æå‡ä»£ç å¤ç”¨æ€§å’Œä¸šåŠ¡é€»è¾‘çš„çµæ´»æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•å’Œæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€ç»„åˆå‡½æ•°çš„æ ¸å¿ƒå®ç°æ–¹å¼"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€ç»„åˆå‡½æ•°çš„æ ¸å¿ƒå®ç°æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-ç¼–ç¨‹å¼ç»„åˆjava-ä»£ç çº§"&gt;&lt;strong&gt;1. ç¼–ç¨‹å¼ç»„åˆï¼ˆJava ä»£ç çº§ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;.andThen()&lt;/code&gt;æˆ– &lt;code&gt;.compose()&lt;/code&gt;æ–¹æ³•åœ¨ä»£ç ä¸­æ˜¾å¼ä¸²è”å‡½æ•°ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; addPrefix() {
return input -&amp;gt; &amp;#34;Hello, &amp;#34; + input;
}
@Bean
public Function&amp;lt;String, String&amp;gt; addSuffix() {
return input -&amp;gt; input + &amp;#34;!&amp;#34;;
}
// ç»„åˆå‡½æ•°ï¼šå…ˆæ·»åŠ å‰ç¼€ï¼Œå†æ·»åŠ åç¼€
@Bean
public Function&amp;lt;String, String&amp;gt; greet() {
return addPrefix().andThen(addSuffix());
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;è¾“å…¥ â†’ addPrefix â†’ addSuffix â†’ è¾“å‡º&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨ç»“æœ&lt;/strong&gt;ï¼š&lt;code&gt;greet.apply(&amp;quot;World&amp;quot;)&lt;/code&gt;è¿”å› &lt;code&gt;&amp;quot;Hello, World!&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="2-å£°æ˜å¼ç»„åˆé…ç½®çº§"&gt;&lt;strong&gt;2. å£°æ˜å¼ç»„åˆï¼ˆé…ç½®çº§ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€ç»„åˆå‡½æ•°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: uppercase|reverse # ç”¨ç«–çº¿ | åˆ†éš”å‡½æ•°å
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼šè¾“å…¥å…ˆç»è¿‡ &lt;code&gt;uppercase&lt;/code&gt;å‡½æ•°å¤„ç†ï¼Œå†ç»è¿‡ &lt;code&gt;reverse&lt;/code&gt;å‡½æ•°å¤„ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®šä¹‰å‡½æ•°ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; uppercase() {
return String::toUpperCase;
}
@Bean
public Function&amp;lt;String, String&amp;gt; reverse() {
return s -&amp;gt; new StringBuilder(s).reverse().toString();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¾“å…¥ &lt;code&gt;&amp;quot;hello&amp;quot;&lt;/code&gt;çš„å¤„ç†æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;quot;hello&amp;quot; â†’ &amp;quot;HELLO&amp;quot;ï¼ˆuppercaseï¼‰ â†’ &amp;quot;OLLEH&amp;quot;ï¼ˆreverseï¼‰&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒç»„åˆå‡½æ•°çš„è¿›é˜¶åº”ç”¨"&gt;âš™ï¸ &lt;strong&gt;äºŒã€ç»„åˆå‡½æ•°çš„è¿›é˜¶åº”ç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ··åˆå‘½ä»¤å¼ä¸å“åº”å¼å‡½æ•°"&gt;&lt;strong&gt;1. æ··åˆå‘½ä»¤å¼ä¸å“åº”å¼å‡½æ•°&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç»„åˆå‡½æ•°å¯åŒæ—¶åŒ…å«åŒæ­¥ï¼ˆå‘½ä»¤å¼ï¼‰å’Œå¼‚æ­¥ï¼ˆå“åº”å¼ï¼‰å¤„ç†é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; syncTask() {
return s -&amp;gt; s.replace(&amp;#34; &amp;#34;, &amp;#34;_&amp;#34;);
}
@Bean
public Function&amp;lt;Flux&amp;lt;String&amp;gt;, Flux&amp;lt;String&amp;gt;&amp;gt; asyncTask() {
return flux -&amp;gt; flux.delayElements(Duration.ofMillis(100));
}
// é…ç½®ç»„åˆï¼šå…ˆåŒæ­¥å¤„ç†ï¼Œå†å¼‚æ­¥æµå¤„ç†
spring:
cloud:
function:
definition: syncTask|asyncTask
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šåŒæ­¥å‡½æ•°å¤„ç†é˜»å¡æ“ä½œï¼ˆå¦‚æ•°æ®æ¸…æ´—ï¼‰ï¼Œå¼‚æ­¥å‡½æ•°å¤„ç†é«˜å¹¶å‘æµï¼ˆå¦‚æ¶ˆæ¯ç¼“å†²ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-æ¡ä»¶è·¯ç”±ç»„åˆ"&gt;&lt;strong&gt;2. æ¡ä»¶è·¯ç”±ç»„åˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡è·¯ç”±å‡½æ•°åŠ¨æ€é€‰æ‹©å¤„ç†åˆ†æ”¯ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; router() {
return input -&amp;gt; {
if (input.startsWith(&amp;#34;A&amp;#34;)) return &amp;#34;uppercase&amp;#34;;
else return &amp;#34;reverse&amp;#34;;
};
}
// é…ç½®ä¸­å£°æ˜ç»„åˆé“¾
spring:
cloud:
function:
definition: router|uppercase,router|reverse # æŒ‰æ¡ä»¶é€‰æ‹©åˆ†æ”¯
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘è§£é‡Š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¾“å…¥ä»¥ &lt;code&gt;&amp;quot;A&amp;quot;&lt;/code&gt;å¼€å¤´ â†’ æ‰§è¡Œ &lt;code&gt;router â†’ uppercase&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…¶ä»–è¾“å…¥ â†’ æ‰§è¡Œ &lt;code&gt;router â†’ reverse&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰ä¼ä¸šçº§åœºæ™¯å®è·µ"&gt;ğŸ› ï¸ &lt;strong&gt;ä¸‰ã€ä¼ä¸šçº§åœºæ™¯å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-è®¢å•å¤„ç†æµæ°´çº¿"&gt;&lt;strong&gt;1. è®¢å•å¤„ç†æµæ°´çº¿&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;Order, Order&amp;gt; validateOrder() {
return order -&amp;gt; {
if (order.getAmount() &amp;lt;= 0) throw new IllegalArgumentException(&amp;#34;é‡‘é¢æ— æ•ˆ&amp;#34;);
return order;
};
}
@Bean
public Function&amp;lt;Order, PaymentRequest&amp;gt; createPayment() {
return order -&amp;gt; new PaymentRequest(order.getId(), order.getAmount());
}
@Bean
public Function&amp;lt;PaymentRequest, String&amp;gt; processPayment() {
return req -&amp;gt; paymentService.execute(req);
}
// é…ç½®ç»„åˆï¼šéªŒè¯ â†’ åˆ›å»ºæ”¯ä»˜ â†’ æ‰§è¡Œæ”¯ä»˜
spring:
cloud:
function:
definition: validateOrder|createPayment|processPayment
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šåœ¨ç»„åˆä¸­åµŒå…¥å¼‚å¸¸æ•è·å‡½æ•°ï¼Œé¿å…ç®¡é“ä¸­æ–­&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å®æ—¶äº‹ä»¶å¤„ç†ç³»ç»Ÿ"&gt;&lt;strong&gt;2. å®æ—¶äº‹ä»¶å¤„ç†ç³»ç»Ÿ&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: filterEvents|enrichMetadata|sendNotification
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å‡½æ•°åˆ†å·¥ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;filterEvents&lt;/code&gt;ï¼šè¿‡æ»¤ä½ä¼˜å…ˆçº§äº‹ä»¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;enrichMetadata&lt;/code&gt;ï¼šæ·»åŠ æ—¶é—´æˆ³ã€æ¥æºç­‰å…ƒæ•°æ®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sendNotification&lt;/code&gt;ï¼šè°ƒç”¨æ¶ˆæ¯æœåŠ¡æ¨é€å‘Šè­¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å››æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ"&gt;âš ï¸ &lt;strong&gt;å››ã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°å‘½åå”¯ä¸€æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç»„åˆä¸­æ¯ä¸ªå‡½æ•°åå¿…é¡»å”¯ä¸€ï¼Œé¿å…å› é‡åå¯¼è‡´è·¯ç”±æ··ä¹±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¾“å…¥/è¾“å‡ºç±»å‹å…¼å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç›¸é‚»å‡½æ•°çš„è¾“å‡ºç±»å‹å¿…é¡»ä¸ä¸‹ä¸€å‡½æ•°çš„è¾“å…¥ç±»å‹åŒ¹é…ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, Integer&amp;gt; strToInt() { ... } // è¾“å‡º Integer
@Bean
public Function&amp;lt;Integer, String&amp;gt; intToHex() { ... } // è¾“å…¥å¿…é¡»ä¸º Integer
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ˜“å‡ºé”™çš„å‡½æ•°ä¸­å†…ç½® &lt;code&gt;try-catch&lt;/code&gt;ï¼Œæˆ–é€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, String&amp;gt; safeFunction() {
return input -&amp;gt; {
try { /* ä¸šåŠ¡é€»è¾‘ */ }
catch (Exception e) { return &amp;#34;Fallback Value&amp;#34;; }
};
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…åœ¨ç»„åˆé“¾ä¸­åµŒå…¥é˜»å¡æ“ä½œï¼ˆå¦‚åŒæ­¥æ•°æ®åº“æŸ¥è¯¢ï¼‰ï¼Œæ”¹ç”¨å“åº”å¼å¼‚æ­¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—ï¼ˆå¦‚ &lt;code&gt;Supplier&lt;/code&gt;æä¾›é™æ€é…ç½®æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç»„åˆå‡½æ•°çš„æ ¸å¿ƒä»·å€¼åœ¨äº&lt;strong&gt;è§£è€¦ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;å’Œ&lt;strong&gt;æå‡å¤ç”¨æ€§&lt;/strong&gt;ã€‚é€šè¿‡ä¸¤ç§æ–¹å¼çµæ´»é€‰æ‹©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼–ç¨‹å¼ç»„åˆ&lt;/strong&gt;ï¼šé€‚åˆé€»è¾‘å›ºå®šã€éœ€å¼ºç±»å‹æ£€æŸ¥çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜å¼ç»„åˆ&lt;/strong&gt;ï¼šé€‚åˆåŠ¨æ€è°ƒæ•´æµç¨‹ã€æ”¯æŒçƒ­æ›´æ–°çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆå¦‚å¾®æœåŠ¡ã€Serverlessï¼‰ä¸­ï¼Œç»„åˆå‡½æ•°å¯æ— ç¼è¡”æ¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka/RabbitMQï¼‰ã€HTTP ç«¯ç‚¹åŠäº‘å‡½æ•°ï¼Œå®ç° &lt;strong&gt;â€œä¸€æ¬¡å¼€å‘ï¼Œå¤šç¯å¢ƒè¿è¡Œâ€&lt;/strong&gt; çš„äº‘åŸç”Ÿæ¶æ„ã€‚&lt;/p&gt;
&lt;h2 id="ç»„åˆé“¾"&gt;ç»„åˆé“¾
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Function çš„å‡½æ•°ç»„åˆæ¨¡å‹ä¸­ï¼Œ&lt;strong&gt;ä¸éœ€è¦ä¸ºæ¯ä¸ªä¸­é—´å‡½æ•°å•ç‹¬å®šä¹‰é€šé“&lt;/strong&gt;ï¼Œåªéœ€è¦ä¸ºæ•´ä¸ªç»„åˆç®¡é“çš„è¾“å…¥ï¼ˆç¬¬ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ï¼‰å’Œè¾“å‡ºï¼ˆæœ€åä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºï¼‰å®šä¹‰é€šé“å³å¯ã€‚ä¸­é—´å‡½æ•°çš„è¿æ¥ç”±æ¡†æ¶è‡ªåŠ¨å¤„ç†ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ç»„åˆå‡½æ•°çš„é€šé“ç»‘å®šè§„åˆ™"&gt;âš™ï¸ &lt;strong&gt;ç»„åˆå‡½æ•°çš„é€šé“ç»‘å®šè§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åªéœ€é¦–å°¾å®šä¹‰é€šé“&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¾“å…¥é€šé“&lt;/strong&gt;ï¼šç»‘å®šåˆ°ç»„åˆç®¡é“ä¸­çš„&lt;strong&gt;ç¬¬ä¸€ä¸ªå‡½æ•°&lt;/strong&gt;çš„è¾“å…¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¾“å‡ºé€šé“&lt;/strong&gt;ï¼šç»‘å®šåˆ°ç»„åˆç®¡é“ä¸­çš„&lt;strong&gt;æœ€åä¸€ä¸ªå‡½æ•°&lt;/strong&gt;çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸­é—´å‡½æ•°&lt;/strong&gt;ï¼šæ— éœ€æ˜¾å¼å®šä¹‰é€šé“ï¼Œæ¡†æ¶è‡ªåŠ¨é€šè¿‡å†…å­˜ä¼ é€’æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: validateOrder|processPayment|sendNotification # ç»„åˆå‡½æ•°é“¾
stream:
bindings:
# ä»…éœ€å®šä¹‰æ•´ä¸ªç®¡é“çš„è¾“å…¥/è¾“å‡ºé€šé“
validateOrder-in-0: destination: orders-topic # ç¬¬ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥
sendNotification-out-0: destination: results # æœ€åä¸€ä¸ªå‡½æ•°çš„è¾“å‡º
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“å‘½åè§„èŒƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¾“å…¥é€šé“ï¼š&lt;code&gt;{ç»„åˆé“¾åç§°}-in-0&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;validateOrder-in-0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è¾“å‡ºé€šé“ï¼š&lt;code&gt;{ç»„åˆé“¾åç§°}-out-0&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;sendNotification-out-0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»„åˆåç§°ç”± &lt;code&gt;definition&lt;/code&gt;ä¸­çš„å‡½æ•°åé€šè¿‡ &lt;code&gt;|&lt;/code&gt;è¿æ¥ï¼ˆå¦‚ &lt;code&gt;validateOrder|processPayment|sendNotification&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®ç¤ºä¾‹ä¸æ•°æ®æµå‘"&gt;ğŸ”§ &lt;strong&gt;é…ç½®ç¤ºä¾‹ä¸æ•°æ®æµå‘&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å‡è®¾ç»„åˆå‡½æ•°é“¾ï¼š&lt;code&gt;filter -&amp;gt; transform -&amp;gt; save&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;YAML é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: filter|transform|save # ç»„åˆå‡½æ•°
stream:
bindings:
filter-in-0: destination: input-data # è¾“å…¥é€šé“ï¼ˆç»‘å®šåˆ° filterï¼‰
save-out-0: destination: output-data # è¾“å‡ºé€šé“ï¼ˆç»‘å®šåˆ° saveï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æµ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[input-data Topic] --&amp;gt; B(filter) --&amp;gt; C(transform) --&amp;gt; D(save) --&amp;gt; E[output-data Topic]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ¶ˆæ¯ä» &lt;code&gt;input-data&lt;/code&gt;ä¸»é¢˜è¿›å…¥ &lt;code&gt;filter&lt;/code&gt;å‡½æ•°ï¼Œç»å†…å­˜ä¼ é€’ä¾æ¬¡æ‰§è¡Œ &lt;code&gt;transform&lt;/code&gt;å’Œ &lt;code&gt;save&lt;/code&gt;ï¼Œæœ€ç»ˆç»“æœå‘é€åˆ° &lt;code&gt;output-data&lt;/code&gt;ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°è¾“å…¥/è¾“å‡ºç±»å‹å¿…é¡»å…¼å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç›¸é‚»å‡½æ•°çš„è¾“å‡ºç±»å‹éœ€ä¸ä¸‹ä¸€å‡½æ•°çš„è¾“å…¥ç±»å‹åŒ¹é…ï¼Œå¦åˆ™è¿è¡Œæ—¶æŠ›å¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Function&amp;lt;String, Integer&amp;gt; strToInt() { ... } // è¾“å‡º Integer
@Bean
public Function&amp;lt;Integer, String&amp;gt; intToStr() { ... } // è¾“å…¥å¿…é¡»ä¸º Integer
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€ç»„åˆéœ€é¿å…å¾ªç¯ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥ç»„åˆé“¾ä¸­å‡½æ•°å­˜åœ¨å¾ªç¯è°ƒç”¨ï¼ˆå¦‚ &lt;code&gt;A -&amp;gt; B -&amp;gt; A&lt;/code&gt;ï¼‰ï¼Œéœ€é€šè¿‡æ¡ä»¶è·¯ç”±æ‹†åˆ†é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“ç»‘å®šçš„è¦†ç›–è§„åˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥æ˜¾å¼ä¸ºä¸­é—´å‡½æ•°å®šä¹‰é€šé“ï¼ˆå¦‚ &lt;code&gt;transform-in-0&lt;/code&gt;ï¼‰ï¼Œè¯¥é…ç½®&lt;strong&gt;æ— æ•ˆ&lt;/strong&gt;ï¼Œå› æ¡†æ¶ä¼šå¿½ç•¥ä¸­é—´å‡½æ•°çš„ç‹¬ç«‹ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿…é¡»é…ç½®&lt;/strong&gt;ï¼šç»„åˆç®¡é“çš„&lt;strong&gt;è¾“å…¥é€šé“&lt;/strong&gt;ï¼ˆé¦–å‡½æ•°è¾“å…¥ï¼‰å’Œ&lt;strong&gt;è¾“å‡ºé€šé“&lt;/strong&gt;ï¼ˆæœ«å‡½æ•°è¾“å‡ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— éœ€é…ç½®&lt;/strong&gt;ï¼šä¸­é—´å‡½æ•°çš„é€šé“ï¼ˆæ¡†æ¶è‡ªåŠ¨è¿æ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;spring.cloud.function.definition&lt;/code&gt;å£°æ˜ç»„åˆé“¾ï¼ˆå¦‚ &lt;code&gt;f1|f2|f3&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä»…é€šè¿‡ &lt;code&gt;bindings.{ç»„åˆé“¾å}-in-0&lt;/code&gt;å’Œ &lt;code&gt;bindings.{ç»„åˆé“¾å}-out-0&lt;/code&gt;å®šä¹‰é€šé“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡å‡½æ•°ç»„åˆï¼Œå¼€å‘è€…å¯èšç„¦ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å…³æ³¨ä¸­é—´ä¼ è¾“ç»†èŠ‚ï¼Œæ˜¾è‘—æå‡ä»£ç ç®€æ´æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="é€šé“ç´¢å¼•"&gt;é€šé“ç´¢å¼•
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Streamï¼ˆå°¤å…¶æ˜¯ 3.x åŠä¹‹åçš„ç‰ˆæœ¬ï¼‰ä¸­ï¼Œ&lt;strong&gt;Bindings åç§°ä¸­çš„ &lt;code&gt;-0&lt;/code&gt;åç¼€æ˜¯å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹å¼•å…¥çš„ç´¢å¼•æ ‡è¯†&lt;/strong&gt;ï¼Œä¸»è¦ç”¨äºè§£å†³å¤šè¾“å…¥/è¾“å‡ºé€šé“çš„å‘½åé—®é¢˜ï¼Œç¡®ä¿ç»‘å®šçš„å”¯ä¸€æ€§å’Œæ˜ç¡®æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› å’Œè®¾è®¡é€»è¾‘ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-æ”¯æŒå¤šè¾“å…¥è¾“å‡ºé€šé“çš„å‡½æ•°"&gt;âš™ï¸ &lt;strong&gt;1. æ”¯æŒå¤šè¾“å…¥/è¾“å‡ºé€šé“çš„å‡½æ•°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªå‡½æ•°å¯èƒ½æœ‰&lt;strong&gt;å¤šä¸ªè¾“å…¥æˆ–è¾“å‡ºé€šé“&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šä¸ªè¾“å…¥&lt;/strong&gt;ï¼š&lt;code&gt;Function&amp;lt;Tuple2&amp;lt;Flux&amp;lt;String&amp;gt;, Flux&amp;lt;Integer&amp;gt;&amp;gt;, Flux&amp;lt;String&amp;gt;&amp;gt;&lt;/code&gt;éœ€è¦ä¸¤ä¸ªè¾“å…¥é€šé“ï¼ˆ&lt;code&gt;in-0&lt;/code&gt;å’Œ &lt;code&gt;in-1&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä¸ªè¾“å‡º&lt;/strong&gt;ï¼š&lt;code&gt;Function&amp;lt;String, Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt;&lt;/code&gt;éœ€è¦ä¸¤ä¸ªè¾“å‡ºé€šé“ï¼ˆ&lt;code&gt;out-0&lt;/code&gt;å’Œ &lt;code&gt;out-1&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;-0&lt;/code&gt;ä¸­çš„æ•°å­—ï¼ˆå¦‚ &lt;code&gt;0&lt;/code&gt;ï¼‰è¡¨ç¤º&lt;strong&gt;é€šé“çš„ç´¢å¼•å·&lt;/strong&gt;ï¼Œç”¨äºåŒºåˆ†åŒä¸€å‡½æ•°çš„å¤šä¸ªè¾“å…¥æˆ–è¾“å‡ºä½ç½®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-2-é€šé“å‘½åè§„èŒƒ"&gt;ğŸ”§ &lt;strong&gt;2. é€šé“å‘½åè§„èŒƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Cloud Stream ä¸ºå‡½æ•°è‡ªåŠ¨ç”Ÿæˆçš„é€šé“åç§°éµå¾ªå›ºå®šæ ¼å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¾“å…¥é€šé“&lt;/strong&gt;ï¼š&lt;code&gt;{å‡½æ•°å}-in-{ç´¢å¼•}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾“å‡ºé€šé“&lt;/strong&gt;ï¼š&lt;code&gt;{å‡½æ•°å}-out-{ç´¢å¼•}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ä» &lt;code&gt;0&lt;/code&gt;å¼€å§‹&lt;/strong&gt;ï¼šé¦–ä¸ªè¾“å…¥/è¾“å‡ºé€šé“çš„ç´¢å¼•ä¸º &lt;code&gt;0&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;myFunction-in-0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;ï¼šè‹¥å‡½æ•°æœ‰ç¬¬äºŒä¸ªè¾“å…¥é€šé“ï¼Œåˆ™å‘½åä¸º &lt;code&gt;myFunction-in-1&lt;/code&gt;ï¼Œä¾æ­¤ç±»æ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
myFunction-in-0: # ç¬¬ä¸€ä¸ªè¾“å…¥é€šé“
destination: input-topic
myFunction-out-0: # ç¬¬ä¸€ä¸ªè¾“å‡ºé€šé“
destination: output-topic
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-3-ä¼ ç»Ÿæ³¨è§£æ¨¡å‹-vs-å‡½æ•°å¼æ¨¡å‹"&gt;âš ï¸ &lt;strong&gt;3. ä¼ ç»Ÿæ³¨è§£æ¨¡å‹ vs å‡½æ•°å¼æ¨¡å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼ ç»Ÿæ³¨è§£æ¨¡å‹&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@Input&lt;/code&gt;/&lt;code&gt;@Output&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;é€šé“åç§°ç”±å¼€å‘è€…è‡ªå®šä¹‰ï¼ˆå¦‚ &lt;code&gt;@Input(&amp;quot;orders&amp;quot;)&lt;/code&gt;ï¼‰ï¼Œæ— éœ€ç´¢å¼•åç¼€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡½æ•°å¼æ¨¡å‹&lt;/strong&gt;ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆå¸¦ç´¢å¼•çš„é€šé“åï¼Œ&lt;strong&gt;å¼ºåˆ¶ç»Ÿä¸€å‘½åè§„åˆ™&lt;/strong&gt;ä»¥é¿å…å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-ä¸ºä½•ç´¢å¼•ä»"&gt;ğŸ’¡ &lt;strong&gt;4. ä¸ºä½•ç´¢å¼•ä» &lt;code&gt;0&lt;/code&gt;å¼€å§‹ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯ä¸€è‡´æ€§&lt;/strong&gt;ï¼šç´¢å¼•ä» &lt;code&gt;0&lt;/code&gt;å¼€å§‹ç¬¦åˆç¼–ç¨‹è¯­è¨€ä¸­æ•°ç»„/é›†åˆçš„é€šç”¨è§„èŒƒï¼ˆå¦‚ Java æ•°ç»„ä¸‹æ ‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–é»˜è®¤åœºæ™¯&lt;/strong&gt;ï¼šå¯¹äºå•è¾“å…¥/è¾“å‡ºçš„å‡½æ•°ï¼ˆå å¤§å¤šæ•°åœºæ™¯ï¼‰ï¼Œåªéœ€ä½¿ç”¨ &lt;code&gt;-in-0&lt;/code&gt;å’Œ &lt;code&gt;-out-0&lt;/code&gt;ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-5-å®é™…é…ç½®è¦æ±‚"&gt;âœ… &lt;strong&gt;5. å®é™…é…ç½®è¦æ±‚&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨é…ç½®æ–‡ä»¶ä¸­å¿…é¡»ä¸¥æ ¼åŒ¹é…å¸¦ç´¢å¼•çš„é€šé“åï¼Œå¦åˆ™ç»‘å®šå¤±è´¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# æ­£ç¡® âœ…
spring.cloud.stream.bindings.myConsumer-in-0.destination=orders
# é”™è¯¯ âŒï¼ˆç¼ºå°‘ç´¢å¼•ï¼‰
spring.cloud.stream.bindings.myConsumer-in.destination=orders
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‹¥æœªæ­£ç¡®æ·»åŠ  &lt;code&gt;-0&lt;/code&gt;ï¼ŒSpring Cloud Stream ä¼šæç¤ºæ— æ³•æ‰¾åˆ°é€šé“ç»‘å®šã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;-0&lt;/code&gt;æ˜¯é€šé“ç´¢å¼•&lt;/strong&gt;ï¼šæ ‡è¯†å‡½æ•°çš„ç¬¬ä¸€è¾“å…¥/è¾“å‡ºä½ç½®ï¼Œæ”¯æŒæ‰©å±•å¤šé€šé“åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼ºåˆ¶å‘½åè§„åˆ™&lt;/strong&gt;ï¼šå‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ä¸­æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆçš„é€šé“åå¿…é¡»åŒ…å«ç´¢å¼•ï¼Œå¼€å‘è€…éœ€åœ¨é…ç½®ä¸­æ˜¾å¼ä½¿ç”¨ &lt;code&gt;{å‡½æ•°å}-in-0&lt;/code&gt;æˆ– &lt;code&gt;{å‡½æ•°å}-out-0&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡ç›®æ ‡&lt;/strong&gt;ï¼šé€šè¿‡æ ‡å‡†åŒ–å‘½åï¼Œç®€åŒ–å¤šé€šé“ç»‘å®šé€»è¾‘ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†åç§°å†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ³¨è§£"&gt;æ³¨è§£
&lt;/h2&gt;&lt;p&gt;Spring Cloud Stream é€šè¿‡ä¸€ç³»åˆ—æ³¨è§£ç®€åŒ–äº†æ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„å¼€å‘ï¼Œä»¥ä¸‹æ˜¯ä¸æ ¸å¿ƒåŠŸèƒ½ç›¸å…³çš„å…³é”®æ³¨è§£åŠå…¶è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€æ ¸å¿ƒç»‘å®šæ³¨è§£"&gt;ğŸ§± &lt;strong&gt;ä¸€ã€æ ¸å¿ƒç»‘å®šæ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableBinding&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæ¿€æ´»é€šé“ç»‘å®šï¼Œå°† Spring åº”ç”¨è½¬æ¢ä¸º Stream åº”ç”¨ã€‚å£°æ˜éœ€ç»‘å®šçš„é€šé“æ¥å£ï¼ˆå¦‚ &lt;code&gt;Source.class&lt;/code&gt;, &lt;code&gt;Sink.class&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šç”¨äºå¯åŠ¨ç±»æˆ–é…ç½®ç±»ï¼Œè§¦å‘ Binder åˆå§‹åŒ–åŠé€šé“ä¸ä¸­é—´ä»¶çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@SpringBootApplication
@EnableBinding(Source.class) // ç»‘å®šå‘é€é€šé“
public class ProducerApp { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Input&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰&lt;strong&gt;è¾“å…¥é€šé“&lt;/strong&gt;ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼Œæ–¹æ³•è¿”å› &lt;code&gt;SubscribableChannel&lt;/code&gt;ç±»å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨è‡ªå®šä¹‰é€šé“æ¥å£ä¸­æ ‡è®°æ¶ˆè´¹æ¶ˆæ¯çš„é€šé“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannel {
@Input(&amp;#34;orderInput&amp;#34;) // é€šé“é€»è¾‘å
SubscribableChannel orderInput();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Output&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰&lt;strong&gt;è¾“å‡ºé€šé“&lt;/strong&gt;ï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œæ–¹æ³•è¿”å› &lt;code&gt;MessageChannel&lt;/code&gt;ç±»å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåœ¨è‡ªå®šä¹‰é€šé“æ¥å£ä¸­æ ‡è®°å‘é€æ¶ˆæ¯çš„é€šé“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannel {
@Output(&amp;#34;notificationOutput&amp;#34;)
MessageChannel notificationOutput();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒæ¶ˆæ¯ç›‘å¬ä¸å‘é€æ³¨è§£"&gt;ğŸ“¨ &lt;strong&gt;äºŒã€æ¶ˆæ¯ç›‘å¬ä¸å‘é€æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@StreamListener&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šç›‘å¬è¾“å…¥é€šé“çš„æ¶ˆæ¯ï¼Œè§¦å‘æŒ‡å®šæ–¹æ³•å¤„ç†æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ›¿ä»£ä¼ ç»Ÿæ¶ˆæ¯ç›‘å¬å™¨ï¼Œç®€åŒ–æ¶ˆè´¹é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(Sink.INPUT)
public void handleMessage(String payload) {
System.out.println(&amp;#34;Received: &amp;#34; + payload);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@SendTo&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå°†æ–¹æ³•è¿”å›å€¼å‘é€åˆ°æŒ‡å®šè¾“å‡ºé€šé“ï¼Œå®ç°è¯·æ±‚-å“åº”æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ¶ˆæ¯å¤„ç†åéœ€å›å¤ç»“æœæ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(Processor.INPUT)
@SendTo(Processor.OUTPUT) // è¿”å›ç»“æœåˆ°è¾“å‡ºé€šé“
public String process(String message) {
return &amp;#34;Processed: &amp;#34; + message;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹æ³¨è§£spring-cloud-stream-20"&gt;ğŸ”„ &lt;strong&gt;ä¸‰ã€å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹æ³¨è§£ï¼ˆSpring Cloud Stream â‰¥2.0ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Bean&lt;/code&gt;+ å‡½æ•°å¼æ¥å£&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šé€šè¿‡å£°æ˜ &lt;code&gt;Supplier&lt;/code&gt;ã€&lt;code&gt;Consumer&lt;/code&gt;æˆ– &lt;code&gt;Function&lt;/code&gt;ç±»å‹çš„ Bean æ›¿ä»£æ³¨è§£ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šç®€åŒ–é…ç½®ï¼Œé¿å…æ˜¾å¼ä½¿ç”¨ &lt;code&gt;@EnableBinding&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public Supplier&amp;lt;String&amp;gt; producer() { // è‡ªåŠ¨ç»‘å®šåˆ° output é€šé“
return () -&amp;gt; &amp;#34;Hello&amp;#34;;
}
@Bean
public Consumer&amp;lt;String&amp;gt; consumer() { // è‡ªåŠ¨ç»‘å®šåˆ° input é€šé“
return msg -&amp;gt; System.out.println(msg);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€å‘é€ï¼š&lt;code&gt;StreamBridge&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éæ³¨è§£&lt;/strong&gt;ï¼šåŠ¨æ€å‘é€æ¶ˆæ¯åˆ°ä»»æ„é€šé“ï¼Œæ— éœ€é¢„å®šä¹‰è¾“å‡ºæ¥å£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private StreamBridge streamBridge;
public void sendNotification(String message) {
streamBridge.send(&amp;#34;notificationOutput&amp;#34;, message); // é€šé“åéœ€åœ¨é…ç½®ä¸­å®šä¹‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››é«˜çº§é…ç½®æ³¨è§£"&gt;âš™ï¸ &lt;strong&gt;å››ã€é«˜çº§é…ç½®æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@ServiceActivator&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šé›†æˆ Spring Integrationï¼Œå¤„ç†é€šé“æ¶ˆæ¯å¹¶æ”¯æŒè‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚é”™è¯¯å¤„ç†ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šéœ€ç²¾ç»†æ§åˆ¶æ¶ˆæ¯å¤„ç†æµç¨‹æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@ServiceActivator(inputChannel = Sink.INPUT)
public void handleError(Message&amp;lt;?&amp;gt; message) {
// å¤„ç†æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Binder&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä¸ºç‰¹å®šé€šé“æ˜¾å¼æŒ‡å®š Binder å®ç°ï¼ˆå¤šä¸­é—´ä»¶åœºæ™¯ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šåŠ¨æ€åˆ‡æ¢ä¸åŒä¸­é—´ä»¶å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®å…³è”&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
orderOutput:
binder: kafkaBinder1 # å¯¹åº” binders é…ç½®ä¸­çš„åç§°
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹"&gt;ğŸ’¡ &lt;strong&gt;äº”ã€ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é€šé“å‘½åä¸€è‡´æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»£ç ä¸­çš„é€šé“åï¼ˆå¦‚ &lt;code&gt;@Input(&amp;quot;orderInput&amp;quot;)&lt;/code&gt;ï¼‰å¿…é¡»ä¸é…ç½®ä¸­çš„ &lt;code&gt;bindings&lt;/code&gt;é”®åï¼ˆ&lt;code&gt;orderInput-in-0&lt;/code&gt;ï¼‰åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–°æ—§æ¨¡å‹å…¼å®¹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å‡½æ•°å¼æ¨¡å‹ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ï¼‰ä¸æ³¨è§£æ¨¡å‹ï¼ˆ&lt;code&gt;@StreamListener&lt;/code&gt;ï¼‰&lt;strong&gt;ä¸å¯æ··ç”¨&lt;/strong&gt;ï¼Œéœ€ç»Ÿä¸€é£æ ¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®è¦†ç›–ä¼˜å…ˆçº§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šé“çº§é…ç½®ï¼ˆ&lt;code&gt;bindings.&amp;lt;channelName&amp;gt;&lt;/code&gt;ï¼‰ &amp;gt; å…¨å±€é»˜è®¤é…ç½®ï¼ˆ&lt;code&gt;default-binder&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“æ³¨è§£é€‰æ‹©å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šæ³¨è§£é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼ ç»Ÿç»‘å®š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@EnableBinding&lt;/code&gt;+ &lt;code&gt;@Input&lt;/code&gt;/&lt;code&gt;@Output&lt;/code&gt;+ &lt;code&gt;@StreamListener&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç®€åŒ–çš„å‡½æ•°å¼ç¼–ç¨‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Bean&lt;/code&gt;+ &lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;+ &lt;code&gt;StreamBridge&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€æ¶ˆæ¯å‘é€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;StreamBridge.send()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šä¸­é—´ä»¶ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Binder&lt;/code&gt;+ å¤š &lt;code&gt;binders&lt;/code&gt;YAML é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¿ç§»æç¤º&lt;/strong&gt;ï¼šæ–°é¡¹ç›®å»ºè®®ä½¿ç”¨å‡½æ•°å¼æ¨¡å‹ï¼ˆSpring Cloud Stream â‰¥3.0ï¼‰ï¼Œå‡å°‘æ ·æ¿ä»£ç ï¼›æ—§é¡¹ç›®å‡çº§æ—¶å¯é€æ­¥æ›¿æ¢ &lt;code&gt;@StreamListener&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="streambridge-hybrid"&gt;StreamBridge Hybrid
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream ä¸­ï¼Œ&lt;code&gt;@Bean&lt;/code&gt;+ &lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ä¸ &lt;code&gt;StreamBridge&lt;/code&gt;çš„ç»“åˆä½¿ç”¨ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯&lt;strong&gt;é¿å… &lt;code&gt;Supplier&lt;/code&gt;çš„å®šæ—¶è§¦å‘æœºåˆ¶&lt;/strong&gt;ï¼Œæ”¹ä¸ºé€šè¿‡å¤–éƒ¨äº‹ä»¶ï¼ˆå¦‚ HTTP è¯·æ±‚ï¼‰åŠ¨æ€å‘é€æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•å’Œé…ç½®æ­¥éª¤ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€æ ¸å¿ƒå®ç°é€»è¾‘"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€æ ¸å¿ƒå®ç°é€»è¾‘&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-ä½¿ç”¨"&gt;&lt;strong&gt;1. ä½¿ç”¨ &lt;code&gt;StreamBridge&lt;/code&gt;æ›¿ä»£ &lt;code&gt;Supplier&lt;/code&gt;çš„è‡ªåŠ¨è§¦å‘&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼š&lt;code&gt;Supplier&amp;lt;T&amp;gt;&lt;/code&gt;é»˜è®¤ä¼šå®šæ—¶è§¦å‘ï¼ˆå‘½ä»¤å¼æ¨¡å¼æ¯ç§’ä¸€æ¬¡ï¼‰ï¼Œæ— æ³•æŒ‰éœ€å‘é€æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼šç”¨ &lt;code&gt;StreamBridge.send()&lt;/code&gt;åŠ¨æ€å‘é€æ¶ˆæ¯ï¼Œæ— éœ€å®šä¹‰ &lt;code&gt;Supplier&lt;/code&gt;Beanã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController
public class MessageController {
@Autowired
private StreamBridge streamBridge; // æ³¨å…¥ StreamBridge
@PostMapping(&amp;#34;/send&amp;#34;)
public String sendMessage(@RequestBody String payload) {
// åŠ¨æ€å‘é€åˆ°æŒ‡å®šé€šé“
boolean success = streamBridge.send(&amp;#34;order-out-0&amp;#34;, payload);
return success ? &amp;#34;Sent!&amp;#34; : &amp;#34;Failed&amp;#34;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒä¿ç•™"&gt;âš™ï¸ &lt;strong&gt;äºŒã€ä¿ç•™ &lt;code&gt;Consumer&lt;/code&gt;çš„å£°æ˜å¼æ¶ˆè´¹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å®šä¹‰"&gt;&lt;strong&gt;1. å®šä¹‰ &lt;code&gt;Consumer&lt;/code&gt;å¤„ç†æ¶ˆæ¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç›‘å¬æ¶ˆæ¯å¹¶å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€è§¦å‘æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class ConsumerConfig {
@Bean
public Consumer&amp;lt;String&amp;gt; orderConsumer() {
return payload -&amp;gt; System.out.println(&amp;#34;Received: &amp;#34; + payload);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-é…ç½®ç»‘å®šå…³ç³»"&gt;&lt;strong&gt;2. é…ç½®ç»‘å®šå…³ç³»&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
function:
definition: orderConsumer # æ¿€æ´» Consumer
stream:
bindings:
orderConsumer-in-0: # è¾“å…¥é€šé“åï¼ˆå‡½æ•°å + -in-0ï¼‰
destination: orders-topic # æ¶ˆæ¯ç›®æ ‡
group: order-group # æ¶ˆè´¹è€…ç»„ï¼ˆé˜²é‡å¤æ¶ˆè´¹ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ä¸‰åŠ¨æ€å‘é€çš„å®Œæ•´æµç¨‹"&gt;ğŸ› ï¸ &lt;strong&gt;ä¸‰ã€åŠ¨æ€å‘é€çš„å®Œæ•´æµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘é€ç«¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;StreamBridge.send(&amp;quot;channel-name&amp;quot;, payload)&lt;/code&gt;å‘é€æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;channel-name&lt;/code&gt;éœ€ä¸é…ç½®ä¸­çš„é€»è¾‘é€šé“åä¸€è‡´ï¼ˆå¦‚ &lt;code&gt;order-out-0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®åŠ¨æ€é€šé“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
# åŠ¨æ€å‘é€é€šé“ï¼ˆæ— éœ€æå‰å£°æ˜ Supplierï¼‰
order-out-0:
destination: orders-topic # å®é™…æ¶ˆæ¯ç›®æ ‡ï¼ˆKafka Topic/RabbitMQ Exchangeï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹ç«¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯è‡ªåŠ¨è·¯ç”±åˆ° &lt;code&gt;orderConsumer-in-0&lt;/code&gt;é€šé“ï¼Œè§¦å‘ &lt;code&gt;orderConsumer&lt;/code&gt;é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››å…³é”®æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å››ã€å…³é”®æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…åŠ¨æ€é€šé“å†…å­˜æº¢å‡º&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é¢‘ç¹åŠ¨æ€åˆ›å»ºé€šé“å¯èƒ½å¯¼è‡´ OOMï¼Œéœ€é™åˆ¶ç¼“å­˜å¤§å°ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
dynamic-destination-cache-size: 10 # é™åˆ¶åŠ¨æ€é€šé“ç¼“å­˜æ•°é‡
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“å‘½åä¸€è‡´æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;StreamBridge.send()&lt;/code&gt;çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»ä¸é…ç½®ä¸­çš„ &lt;code&gt;bindings&lt;/code&gt;é”®åä¸¥æ ¼åŒ¹é…ï¼ˆå¦‚ &lt;code&gt;order-out-0&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯åºåˆ—åŒ–æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤ä½¿ç”¨ JSON åºåˆ—åŒ–ï¼Œå¯é€šè¿‡é…ç½®ä¿®æ”¹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
order-out-0:
content-type: application/avro # æŒ‡å®šåºåˆ—åŒ–æ ¼å¼
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥å‘é€&lt;/strong&gt;ï¼š&lt;code&gt;StreamBridge&lt;/code&gt;é»˜è®¤éé˜»å¡ï¼Œä½†é«˜å¹¶å‘æ—¶éœ€ç›‘æ§èƒŒå‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ”¯æŒ&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;@Transactional&lt;/code&gt;æˆ– Kafka äº‹åŠ¡ ID ä¿éšœç²¾ç¡®ä¸€æ¬¡å‘é€ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”é€‚ç”¨åœºæ™¯"&gt;ğŸ’¡ &lt;strong&gt;äº”ã€é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HTTP è§¦å‘æ¶ˆæ¯&lt;/strong&gt;ï¼šå¦‚ç”¨æˆ·ä¸‹å•åå‘é€è®¢å•æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt;ï¼šæ•°æ®åº“å˜æ›´æ—¶è§¦å‘é€šçŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶æ€§å‘é€&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡çŠ¶æ€é€‰æ‹©ä¸åŒé€šé“ï¼ˆå¦‚ &lt;code&gt;priority-out-0&lt;/code&gt;æˆ– &lt;code&gt;normal-out-0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-8"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ƒç”¨ &lt;code&gt;Supplier&lt;/code&gt;&lt;/strong&gt;ï¼šæ”¹ç”¨ &lt;code&gt;StreamBridge&lt;/code&gt;å®ç°æŒ‰éœ€å‘é€ï¼Œé¿å…å®šæ—¶è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿ç•™ &lt;code&gt;Consumer&lt;/code&gt;&lt;/strong&gt;ï¼šé€šè¿‡å£°æ˜å¼ Bean æ¶ˆè´¹æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ ¸å¿ƒç‚¹&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;åŠ¨æ€é€šé“åï¼ˆå¦‚ &lt;code&gt;order-out-0&lt;/code&gt;ï¼‰ä¸ &lt;code&gt;StreamBridge.send()&lt;/code&gt;åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…ç»„ï¼ˆ&lt;code&gt;group&lt;/code&gt;ï¼‰ä¿éšœæ¶ˆæ¯å¯é æ€§ã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶åŠ¨æ€é€šé“ç¼“å­˜é˜²æº¢å‡ºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè§£è€¦æ¶ˆæ¯å‘é€ä¸ä¸šåŠ¡è§¦å‘ï¼Œå…¼é¡¾çµæ´»æ€§ä¸èµ„æºå¯æ§æ€§ã€‚é€šè¿‡æ­¤æ¨¡å¼ï¼Œå¯æ— ç¼é›†æˆ REST APIã€å®šæ—¶ä»»åŠ¡æˆ–äº‹ä»¶ç›‘å¬å™¨ä½œä¸ºæ¶ˆæ¯ç”Ÿäº§è€… ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="streambridge"&gt;StreamBridge
&lt;/h2&gt;&lt;p&gt;StreamBridge æ˜¯ Spring Cloud Stream æ¡†æ¶ä¸­çš„æ ¸å¿ƒåŠ¨æ€æ¶ˆæ¯å‘é€ç»„ä»¶ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨ä¸é¢„å®šä¹‰ç»‘å®šé…ç½®çš„æƒ…å†µä¸‹ï¼Œ&lt;strong&gt;çµæ´»ã€æŒ‰éœ€åœ°å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰å‘é€æ¶ˆæ¯&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸€æ ¸å¿ƒåŠŸèƒ½ä¸è®¾è®¡ç›®æ ‡"&gt;ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸è®¾è®¡ç›®æ ‡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ¶ˆæ¯å‘é€&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— éœ€é¢„å£°æ˜ç»‘å®š&lt;/strong&gt;ï¼šä¼ ç»Ÿæ–¹å¼éœ€æå‰åœ¨é…ç½®ä¸­å®šä¹‰ &lt;code&gt;@Output&lt;/code&gt;é€šé“ï¼Œè€Œ StreamBridge å¯åœ¨è¿è¡Œæ—¶åŠ¨æ€æŒ‡å®šç›®æ ‡é€šé“ï¼Œé€‚åˆæ¡ä»¶æ€§å‘é€ï¼ˆå¦‚æ ¹æ®ä¸šåŠ¡çŠ¶æ€é€‰æ‹©ä¸åŒ Topicï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–ä»£ç &lt;/strong&gt;ï¼šé¿å…ä¸ºæ¯ä¸ªå‘é€ç›®æ ‡åˆ›å»ºæ¥å£å’Œæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@EnableBinding&lt;/code&gt;ï¼‰ï¼Œå‡å°‘æ ·æ¿ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åè®®æ— å…³æ€§&lt;/strong&gt;ï¼šé€šè¿‡ Binder æŠ½è±¡å±‚ï¼ŒåŒä¸€å¥— API æ”¯æŒ Kafkaã€RabbitMQ ç­‰ä¸­é—´ä»¶ï¼Œåˆ‡æ¢æ—¶æ— éœ€ä¿®æ”¹å‘é€é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åºåˆ—åŒ–&lt;/strong&gt;ï¼šæ”¯æŒå¯¹è±¡ã€å­—ç¬¦ä¸²ç­‰è´Ÿè½½ç±»å‹ï¼Œé»˜è®¤ä½¿ç”¨ JSON åºåˆ—åŒ–ï¼ˆå¯é…ç½®ä¸º Avroã€æ–‡æœ¬ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äºŒåŸºæœ¬ä½¿ç”¨æ–¹å¼"&gt;äºŒã€åŸºæœ¬ä½¿ç”¨æ–¹å¼
&lt;/h3&gt;&lt;h4 id="1-ä¾èµ–æ³¨å…¥ä¸åŸºç¡€å‘é€"&gt;&lt;strong&gt;1. ä¾èµ–æ³¨å…¥ä¸åŸºç¡€å‘é€&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private StreamBridge streamBridge; // æ³¨å…¥ç»„ä»¶
// å‘é€ç®€å•æ¶ˆæ¯
public void sendNotification(String payload) {
boolean success = streamBridge.send(&amp;#34;notification-topic&amp;#34;, payload);
if (!success) {
log.error(&amp;#34;æ¶ˆæ¯å‘é€å¤±è´¥&amp;#34;); // å¤±è´¥å¤„ç†é€»è¾‘
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°è¯´æ˜&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;topic&lt;/code&gt;ï¼šé€»è¾‘é€šé“åï¼ˆå¦‚ &lt;code&gt;&amp;quot;notification-topic&amp;quot;&lt;/code&gt;ï¼‰ï¼Œéœ€åœ¨é…ç½®ä¸­ç»‘å®šå®é™…ä¸­é—´ä»¶ç›®æ ‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;message&lt;/code&gt;ï¼šæ¶ˆæ¯è´Ÿè½½ï¼Œæ”¯æŒä»»æ„å¯¹è±¡ï¼ˆå¦‚ &lt;code&gt;String&lt;/code&gt;ã€&lt;code&gt;Order&lt;/code&gt;å®ä½“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-åŠ¨æ€é€šé“é…ç½®"&gt;&lt;strong&gt;2. åŠ¨æ€é€šé“é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;application.yml&lt;/code&gt;ä¸­ç»‘å®šé€»è¾‘é€šé“ä¸ç‰©ç†ç›®æ ‡ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
cloud:
stream:
bindings:
notification-topic: # é€»è¾‘é€šé“å
destination: orders-exchange # RabbitMQ Exchange æˆ– Kafka Topic
binder: rabbit-binder # æŒ‡å®š Binder
binders:
rabbit-binder:
type: rabbit # ä¸­é—´ä»¶ç±»å‹
environment:
spring.rabbitmq.host: localhost
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šæœªé…ç½®çš„é€šé“åé¦–æ¬¡è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œä½†éœ€é˜²èŒƒå†…å­˜æº¢å‡ºï¼ˆé€šè¿‡ &lt;code&gt;spring.cloud.stream.dynamic-destination-cache-size&lt;/code&gt;é™åˆ¶ç¼“å­˜æ•°é‡ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="ä¸‰é«˜çº§åº”ç”¨æŠ€å·§"&gt;ä¸‰ã€é«˜çº§åº”ç”¨æŠ€å·§
&lt;/h3&gt;&lt;h4 id="1-è‡ªå®šä¹‰æ¶ˆæ¯å¤´"&gt;&lt;strong&gt;1. è‡ªå®šä¹‰æ¶ˆæ¯å¤´&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;MessageBuilder&lt;/code&gt;æ·»åŠ æ¶ˆæ¯å¤´ï¼ˆå¦‚ä¼˜å…ˆçº§ã€å»¶è¿Ÿæ ‡è®°ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Message&amp;lt;String&amp;gt; message = MessageBuilder
.withPayload(&amp;#34;ç´§æ€¥è®¢å•&amp;#34;)
.setHeader(&amp;#34;priority&amp;#34;, &amp;#34;high&amp;#34;)
.setHeader(&amp;#34;x-delay&amp;#34;, 5000) // RabbitMQ å»¶è¿Ÿæ¶ˆæ¯ï¼ˆæ¯«ç§’ï¼‰
.build();
streamBridge.send(&amp;#34;order-topic&amp;#34;, message);
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ¶ˆæ¯è·¯ç”±ã€å»¶è¿ŸæŠ•é€’ã€æ­»ä¿¡æ§åˆ¶ç­‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="2-å¤šç§Ÿæˆ·ä¸åŠ¨æ€è·¯ç”±"&gt;&lt;strong&gt;2. å¤šç§Ÿæˆ·ä¸åŠ¨æ€è·¯ç”±&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æ ¹æ®ä¸šåŠ¡å‚æ•°åŠ¨æ€é€‰æ‹©ç›®æ ‡ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public void sendByTenant(String tenantId, Order order) {
String topic = &amp;#34;orders-&amp;#34; + tenantId; // åŠ¨æ€é€šé“å
streamBridge.send(topic, order);
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®å…³è”&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.cloud.stream.bindings.orders-${tenantId}.destination: orders-${tenantId}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šæ— éœ€ä¸ºæ¯ä¸ªç§Ÿæˆ·å•ç‹¬ç¼–ç ï¼Œé…ç½®é©±åŠ¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="3-æ‹¦æˆªå™¨é›†æˆ"&gt;&lt;strong&gt;3. æ‹¦æˆªå™¨é›†æˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®ç° &lt;code&gt;ChannelInterceptor&lt;/code&gt;æ‹¦æˆªæ¶ˆæ¯å‘é€è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
@GlobalChannelInterceptor(patterns = &amp;#34;*&amp;#34;) // æ‹¦æˆªæ‰€æœ‰é€šé“
public class LoggingInterceptor implements ChannelInterceptor {
@Override
public Message&amp;lt;?&amp;gt; preSend(Message&amp;lt;?&amp;gt; message, MessageChannel channel) {
log.info(&amp;#34;å‘é€æ¶ˆæ¯å¤´: {}&amp;#34;, message.getHeaders());
return message;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šæ—¥å¿—å®¡è®¡ã€æ¶ˆæ¯åŠ å¯†ã€æµé‡ç›‘æ§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="å››æ€§èƒ½ä¸å¯é æ€§ä¿éšœ"&gt;å››ã€æ€§èƒ½ä¸å¯é æ€§ä¿éšœ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ä¸éé˜»å¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤å¼‚æ­¥å‘é€ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œé«˜å¹¶å‘æ—¶éœ€ç›‘æ§èƒŒå‹ï¼ˆå¦‚ RabbitMQ çš„ &lt;code&gt;publisher-confirms&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ¬åœ°äº‹åŠ¡&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;@Transactional&lt;/code&gt;ç¡®ä¿æ•°æ®åº“æ“ä½œä¸æ¶ˆæ¯å‘é€åŸå­æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka äº‹åŠ¡&lt;/strong&gt;ï¼šé…ç½® &lt;code&gt;spring.kafka.producer.transaction-id-prefix&lt;/code&gt;å®ç°ç²¾ç¡®ä¸€æ¬¡æŠ•é€’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤±è´¥å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼æ£€æŸ¥&lt;/strong&gt;ï¼š&lt;code&gt;send()&lt;/code&gt;è¿”å› &lt;code&gt;false&lt;/code&gt;æ—¶éœ€é‡è¯•æˆ–è®°å½•æ­»ä¿¡é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡è¯•æœºåˆ¶&lt;/strong&gt;ï¼šé€šè¿‡ä¸­é—´ä»¶é‡è¯•ï¼ˆå¦‚ Kafka çš„ &lt;code&gt;retries&lt;/code&gt;ï¼‰æˆ–åº”ç”¨å±‚é‡è¯•ï¼ˆå¦‚ Spring Retryï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äº”å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;äº”ã€å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HTTP è§¦å‘æ¶ˆæ¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;REST æ¥å£ä¸­è°ƒç”¨ &lt;code&gt;streamBridge.send()&lt;/code&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®šæ—¶ä»»åŠ¡å‘é€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ &lt;code&gt;@Scheduled&lt;/code&gt;æ–¹æ³•ä¸­åŠ¨æ€å‘é€ï¼ˆæ›¿ä»£ &lt;code&gt;Supplier&lt;/code&gt;çš„å›ºå®šè½®è¯¢ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å˜æ›´ç›‘å¬ï¼ˆå¦‚ &lt;code&gt;EntityListener&lt;/code&gt;ï¼‰è§¦å‘æ¶ˆæ¯é€šçŸ¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šæ­¥éª¤æµç¨‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»„åˆå¤šä¸ªé€šé“å‘é€ï¼ˆå¦‚è®¢å•åˆ›å»º â†’ åº“å­˜æ‰£å‡ â†’ æ”¯ä»˜é€šçŸ¥ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å…­ä¸ä¼ ç»Ÿæ–¹å¼çš„å¯¹æ¯”"&gt;å…­ã€ä¸ä¼ ç»Ÿæ–¹å¼çš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼ ç»Ÿæ³¨è§£æ¨¡å‹ï¼ˆ@Outputï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;StreamBridge&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»‘å®šçµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é¢„å®šä¹‰é€šé“æ¥å£&lt;/td&gt;
&lt;td&gt;åŠ¨æ€æŒ‡å®šé€šé“åï¼Œæ— éœ€é¢„å£°æ˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç å…¥ä¾µæ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ &lt;code&gt;@EnableBinding&lt;/code&gt;å’Œé€šé“æ¥å£&lt;/td&gt;
&lt;td&gt;æ— ä¾µå…¥ï¼Œç›´æ¥æ³¨å…¥ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šç›®æ ‡æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªé€šé“éœ€ç‹¬ç«‹æ¥å£&lt;/td&gt;
&lt;td&gt;å•ç»„ä»¶æ”¯æŒä»»æ„é€šé“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šç›®æ ‡ã€ç»“æ„ç®€å•åœºæ™¯&lt;/td&gt;
&lt;td&gt;åŠ¨æ€è·¯ç”±ã€æ¡ä»¶å‘é€ã€å¤šç§Ÿæˆ·ç­‰å¤æ‚åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;StreamBridge çš„æ ¸å¿ƒä»·å€¼åœ¨äº&lt;strong&gt;è§£è€¦æ¶ˆæ¯å‘é€ä¸ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;ï¼Œé€šè¿‡åŠ¨æ€é€šé“å’Œç®€åŒ– API å®ç°çµæ´»çš„æ¶ˆæ¯æŠ•é€’ã€‚ä½¿ç”¨æ—¶éœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“å‘½åè§„èŒƒ&lt;/strong&gt;ï¼ˆå¦‚ä¸šåŠ¡è¯­ä¹‰åŒ–ï¼‰ï¼Œé¿å…æ··ä¹±ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šé™åˆ¶åŠ¨æ€é€šé“ç¼“å­˜ã€å¯ç”¨ä¸­é—´ä»¶äº‹åŠ¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯å…œåº•&lt;/strong&gt;ï¼šåŠ¡å¿…æ£€æŸ¥è¿”å›å€¼å¹¶è®¾è®¡é‡è¯•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå®ƒå·²æˆä¸ºå¼‚æ­¥é€šä¿¡ã€äº‹ä»¶é©±åŠ¨å’Œå®æ—¶æ•°æ®ç®¡é“çš„é¦–é€‰å·¥å…·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="å››æ³¨è§£"&gt;å››æ³¨è§£
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream ä¸­ï¼Œ&lt;code&gt;@Input&lt;/code&gt;ã€&lt;code&gt;@Output&lt;/code&gt;ã€&lt;code&gt;@StreamListener&lt;/code&gt;å’Œ &lt;code&gt;@SendTo&lt;/code&gt;æ˜¯æ ¸å¿ƒæ³¨è§£ï¼Œåˆ†åˆ«æ‰¿æ‹…&lt;strong&gt;é€šé“å£°æ˜&lt;/strong&gt;ä¸&lt;strong&gt;æ¶ˆæ¯å¤„ç†&lt;/strong&gt;ä¸¤ç±»è§’è‰²ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„åŒºåˆ«ä¸å…³è”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1"&gt;&lt;strong&gt;1. &lt;code&gt;@Input&lt;/code&gt;ä¸ &lt;code&gt;@Output&lt;/code&gt;ï¼ˆé€šé“å£°æ˜ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå£°æ˜æ¶ˆæ¯é€šé“ï¼ˆChannelï¼‰ï¼Œå®šä¹‰æ¶ˆæ¯å…¥å£ï¼ˆæ¶ˆè´¹ï¼‰å’Œå‡ºå£ï¼ˆç”Ÿäº§ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Input&lt;/code&gt;ï¼šæ ‡è®°åœ¨æ¥å£æ–¹æ³•ä¸Šï¼Œå®šä¹‰&lt;strong&gt;è¾“å…¥é€šé“&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;SubscribableChannel&lt;/code&gt;ï¼‰ï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Output&lt;/code&gt;ï¼šæ ‡è®°åœ¨æ¥å£æ–¹æ³•ä¸Šï¼Œå®šä¹‰&lt;strong&gt;è¾“å‡ºé€šé“&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;MessageChannel&lt;/code&gt;ï¼‰ï¼Œç”¨äºå‘é€æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;ï¼šéœ€é…åˆ &lt;code&gt;@EnableBinding&lt;/code&gt;æ¿€æ´»é€šé“æ¥å£ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannels {
@Input(&amp;#34;orderInput&amp;#34;) // å£°æ˜è¾“å…¥é€šé“
SubscribableChannel orderInput();
@Output(&amp;#34;notificationOutput&amp;#34;) // å£°æ˜è¾“å‡ºé€šé“
MessageChannel notificationOutput();
}
@EnableBinding(CustomChannels.class) // æ¿€æ´»é€šé“
public class AppConfig { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬è´¨&lt;/strong&gt;ï¼šåœ¨ Spring å®¹å™¨ä¸­æ³¨å†Œé€šé“ Beanï¼Œä¾›åç»­ç»‘å®šæ¶ˆæ¯ä¸­é—´ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2"&gt;&lt;strong&gt;2. &lt;code&gt;@StreamListener&lt;/code&gt;ï¼ˆæ¶ˆæ¯æ¶ˆè´¹ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ ‡è®°æ¶ˆæ¯å¤„ç†æ–¹æ³•ï¼Œç›‘å¬è¾“å…¥é€šé“çš„æ¶ˆæ¯å¹¶è§¦å‘ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ &lt;strong&gt;SpEL æ¡ä»¶è¿‡æ»¤&lt;/strong&gt;ï¼ˆ&lt;code&gt;condition&lt;/code&gt;å±æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨å¤„ç†æ¶ˆæ¯ååºåˆ—åŒ–ï¼ˆå¦‚ JSON â†’ å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(target = CustomChannels.ORDER_INPUT, condition = &amp;#34;headers[&amp;#39;type&amp;#39;]==&amp;#39;urgent&amp;#39;&amp;#34;)
public void handleUrgentOrder(Order order) {
// å¤„ç†ç´§æ€¥è®¢å•
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»…æ”¯æŒ&lt;strong&gt;æ— è¿”å›å€¼&lt;/strong&gt;æ–¹æ³•ï¼ˆè‹¥æœ‰è¿”å›å€¼éœ€ç”¨ &lt;code&gt;@SendTo&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ–°ç‰ˆæœ¬æ¨èä½¿ç”¨å‡½æ•°å¼æ¨¡å‹ï¼ˆ&lt;code&gt;Consumer&lt;/code&gt;ï¼‰æ›¿ä»£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3"&gt;&lt;strong&gt;3. &lt;code&gt;@SendTo&lt;/code&gt;ï¼ˆæ¶ˆæ¯ç”Ÿäº§ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå°†æ–¹æ³•è¿”å›å€¼å‘é€åˆ°æŒ‡å®šè¾“å‡ºé€šé“ï¼Œå®ç°&lt;strong&gt;è¯·æ±‚-å“åº”&lt;/strong&gt;æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–&lt;/strong&gt;ï¼šå¿…é¡»ä¸ &lt;code&gt;@StreamListener&lt;/code&gt;æ­é…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(Processor.INPUT)
@SendTo(Processor.OUTPUT) // è¿”å›å€¼å‘é€åˆ° OUTPUT é€šé“
public String process(String msg) {
return &amp;#34;Processed: &amp;#34; + msg;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬è´¨&lt;/strong&gt;ï¼šå°†æ–¹æ³•è¿”å›å€¼å°è£…ä¸ºæ¶ˆæ¯ï¼Œè‡ªåŠ¨è·¯ç”±åˆ°ç›®æ ‡é€šé“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å››è€…å¯¹æ¯”æ€»ç»“"&gt;&lt;strong&gt;å››è€…å¯¹æ¯”æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç±»åˆ«&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…¸å‹ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Input&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šé“å£°æ˜&lt;/td&gt;
&lt;td&gt;å®šä¹‰è¾“å…¥é€šé“&lt;/td&gt;
&lt;td&gt;éœ€ &lt;code&gt;@EnableBinding&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜æ¶ˆæ¯å…¥å£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Output&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šé“å£°æ˜&lt;/td&gt;
&lt;td&gt;å®šä¹‰è¾“å‡ºé€šé“&lt;/td&gt;
&lt;td&gt;éœ€ &lt;code&gt;@EnableBinding&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜æ¶ˆæ¯å‡ºå£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@StreamListener&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯å¤„ç†&lt;/td&gt;
&lt;td&gt;ç›‘å¬å¹¶å¤„ç†è¾“å…¥é€šé“æ¶ˆæ¯&lt;/td&gt;
&lt;td&gt;éœ€å·²å£°æ˜ &lt;code&gt;@Input&lt;/code&gt;é€šé“&lt;/td&gt;
&lt;td&gt;æ¶ˆè´¹æ¶ˆæ¯ã€æ¡ä»¶è¿‡æ»¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@SendTo&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯å¤„ç†&lt;/td&gt;
&lt;td&gt;å°†è¿”å›å€¼å‘é€åˆ°è¾“å‡ºé€šé“&lt;/td&gt;
&lt;td&gt;éœ€é…åˆ &lt;code&gt;@StreamListener&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯·æ±‚-å“åº”æ¨¡å¼çš„æ¶ˆæ¯å›å¤&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®å·®å¼‚è¯´æ˜"&gt;&lt;strong&gt;å…³é”®å·®å¼‚è¯´æ˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å£°æ˜ vs è¿è¡Œæ—¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Input&lt;/code&gt;/&lt;code&gt;@Output&lt;/code&gt;&lt;strong&gt;å£°æ˜é€šé“&lt;/strong&gt;ï¼ˆé™æ€é…ç½®ï¼‰ï¼Œè€Œ &lt;code&gt;@StreamListener&lt;/code&gt;/&lt;code&gt;@SendTo&lt;/code&gt;&lt;strong&gt;å¤„ç†æ¶ˆæ¯&lt;/strong&gt;ï¼ˆåŠ¨æ€é€»è¾‘ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡ä»¶è¿‡æ»¤èƒ½åŠ›&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä»… &lt;code&gt;@StreamListener&lt;/code&gt;æ”¯æŒ &lt;code&gt;condition&lt;/code&gt;å®ç°æ¶ˆæ¯åŠ¨æ€è·¯ç”±ï¼ˆå¦‚æŒ‰æ¶ˆæ¯å¤´åˆ†æµï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@SendTo&lt;/code&gt;æ˜¯å”¯ä¸€æ”¯æŒ&lt;strong&gt;è¿”å›æ•°æ®åˆ°é€šé“&lt;/strong&gt;çš„æ³¨è§£ï¼Œä¾èµ–æ–¹æ³•è¿”å›å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬æ¼”è¿›&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;Spring Cloud Stream â‰¥3.x æ¨èå‡½æ•°å¼æ¨¡å‹ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ï¼‰ï¼Œé€æ­¥æ›¿ä»£ &lt;code&gt;@StreamListener&lt;/code&gt;å’Œ &lt;code&gt;@SendTo&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹å·¥ä½œæµç¤ºä¾‹"&gt;&lt;strong&gt;å…¸å‹å·¥ä½œæµç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@EnableBinding(Processor.class) // å£°æ˜é€šé“
public class MessageService {
// ç›‘å¬è¾“å…¥é€šé“ï¼Œæ¡ä»¶è¿‡æ»¤
@StreamListener(
target = Processor.INPUT,
condition = &amp;#34;headers[&amp;#39;priority&amp;#39;]==&amp;#39;high&amp;#39;&amp;#34;
)
@SendTo(Processor.OUTPUT) // è¿”å›ç»“æœåˆ°è¾“å‡ºé€šé“
public String handleHighPriority(String msg) {
return &amp;#34;URGENT: &amp;#34; + msg;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è¾“å…¥æ¶ˆæ¯ â†’ &lt;code&gt;@StreamListener&lt;/code&gt;æ¡ä»¶è¿‡æ»¤ â†’ å¤„ç†é€»è¾‘ â†’ &lt;code&gt;@SendTo&lt;/code&gt;è¿”å›ç»“æœ â†’ è¾“å‡ºé€šé“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†ç»„åˆè¿™äº›æ³¨è§£ï¼Œå¯å®ç°çµæ´»çš„æ¶ˆæ¯è·¯ç”±ã€è¿‡æ»¤ä¸å“åº”æœºåˆ¶ï¼Œä½†æ–°é¡¹ç›®å»ºè®®ä¼˜å…ˆé‡‡ç”¨å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ç®€åŒ–ä»£ç ã€‚&lt;/p&gt;
&lt;h2 id="sendto"&gt;@SendTo
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Stream ä¸­ï¼Œ&lt;code&gt;@SendTo&lt;/code&gt;å¿…é¡»é…åˆ &lt;code&gt;@StreamListener&lt;/code&gt;ä½¿ç”¨ï¼Œ&lt;strong&gt;ä¸èƒ½å•ç‹¬ä½¿ç”¨&lt;/strong&gt;ã€‚è¿™ç§è®¾è®¡æ˜¯ç”±ä¸¤è€…çš„åŠŸèƒ½å®šä½å’Œæ¡†æ¶çš„æ¶ˆæ¯å¤„ç†æœºåˆ¶å…±åŒå†³å®šçš„ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸€æ³¨è§£èŒè´£ä¸åä½œåŸç†"&gt;&lt;strong&gt;ä¸€ã€æ³¨è§£èŒè´£ä¸åä½œåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@StreamListener&lt;/code&gt;çš„æ ¸å¿ƒä½œç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯æ¶ˆè´¹å…¥å£&lt;/strong&gt;ï¼šæ ‡è®°ä¸€ä¸ªæ–¹æ³•ä½œä¸ºæ¶ˆæ¯ç›‘å¬å™¨ï¼Œå£°æ˜è¯¥æ–¹æ³•è´Ÿè´£å¤„ç†æ¥è‡ªæŒ‡å®šè¾“å…¥é€šé“çš„æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§¦å‘æ‰§è¡Œ&lt;/strong&gt;ï¼šå½“æ¶ˆæ¯åˆ°è¾¾ç»‘å®šçš„è¾“å…¥é€šé“æ—¶ï¼Œæ¡†æ¶è‡ªåŠ¨è°ƒç”¨è¢«æ³¨è§£çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡æä¾›&lt;/strong&gt;ï¼šä¸º &lt;code&gt;@SendTo&lt;/code&gt;æä¾›æ–¹æ³•æ‰§è¡Œçš„è¿”å›å€¼ä½œä¸ºå‘é€æ¶ˆæ¯çš„æ¥æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@SendTo&lt;/code&gt;çš„ä¾èµ–å‰æ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿”å›å€¼è·¯ç”±&lt;/strong&gt;ï¼š&lt;code&gt;@SendTo&lt;/code&gt;çš„ä½œç”¨æ˜¯å°†æ–¹æ³•çš„&lt;strong&gt;è¿”å›å€¼&lt;/strong&gt;å‘é€åˆ°æŒ‡å®šçš„è¾“å‡ºé€šé“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— ç‹¬ç«‹è§¦å‘èƒ½åŠ›&lt;/strong&gt;ï¼šå®ƒä¸ç›‘å¬æ¶ˆæ¯ã€ä¸ä¸»åŠ¨æ‰§è¡Œé€»è¾‘ï¼Œä»…ä¾èµ–æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºæ•°æ®æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¡†æ¶åä½œé€»è¾‘&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(Processor.INPUT) // 1. ç›‘å¬è¾“å…¥é€šé“
@SendTo(Processor.OUTPUT) // 2. å°†è¿”å›å€¼è·¯ç”±åˆ°è¾“å‡ºé€šé“
public String process(String msg) {
return &amp;#34;Processed: &amp;#34; + msg; // 3. è¿”å›å€¼æˆä¸ºè¾“å‡ºæ¶ˆæ¯
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‹¥ç¼ºå°‘ &lt;code&gt;@StreamListener&lt;/code&gt;ï¼Œæ¡†æ¶æ— æ³•è¯†åˆ«ä½•æ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œä¹Ÿæ— æ³•è·å–è¿”å›å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äºŒå•ç‹¬ä½¿ç”¨"&gt;&lt;strong&gt;äºŒã€å•ç‹¬ä½¿ç”¨ &lt;code&gt;@SendTo&lt;/code&gt;ä¸ºä½•æ— æ•ˆï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºå°‘æ‰§è¡Œä¸Šä¸‹æ–‡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@SendTo&lt;/code&gt;ä»…å®šä¹‰&lt;strong&gt;æ¶ˆæ¯è·¯ç”±è§„åˆ™&lt;/strong&gt;ï¼ˆå³â€œå‘é€åˆ°å“ªé‡Œâ€ï¼‰ï¼Œä½†æœªå®šä¹‰&lt;strong&gt;ä½•æ—¶å‘é€&lt;/strong&gt;æˆ–&lt;strong&gt;å‘é€ä»€ä¹ˆæ•°æ®&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰ &lt;code&gt;@StreamListener&lt;/code&gt;æä¾›çš„æ–¹æ³•æ‰§è¡Œï¼Œè¿”å›å€¼æ— ä»äº§ç”Ÿï¼Œè·¯ç”±è§„åˆ™æ— æ³•ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡†æ¶çš„è¿è¡Œæ—¶è¡Œä¸º&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Spring Cloud Stream é€šè¿‡ &lt;code&gt;@StreamListener&lt;/code&gt;å°†æ–¹æ³•æ³¨å†Œä¸ºæ¶ˆæ¯ç›‘å¬å™¨ï¼Œé›†æˆåˆ°æ¶ˆæ¯å¤„ç†ç®¡é“ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@SendTo&lt;/code&gt;ä½œä¸ºè¯¥ç®¡é“çš„&lt;strong&gt;åç»­ç¯èŠ‚&lt;/strong&gt;ï¼Œä¾èµ–å‰åºç¯èŠ‚ï¼ˆæ¶ˆæ¯æ¶ˆè´¹+è¿”å›å€¼ç”Ÿæˆï¼‰çš„è¾“å‡ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸‰æ›¿ä»£æ–¹æ¡ˆæ— éœ€"&gt;&lt;strong&gt;ä¸‰ã€æ›¿ä»£æ–¹æ¡ˆï¼šæ— éœ€ &lt;code&gt;@StreamListener&lt;/code&gt;çš„æ¶ˆæ¯å‘é€æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€ç‹¬ç«‹å‘é€æ¶ˆæ¯ï¼ˆä¸ä¾èµ–ç›‘å¬å™¨è¿”å›å€¼ï¼‰ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ›¿ä»£ &lt;code&gt;@SendTo&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;StreamBridge&lt;/code&gt;åŠ¨æ€å‘é€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç›´æ¥æ³¨å…¥ &lt;code&gt;StreamBridge&lt;/code&gt;åŠ¨æ€å‘é€æ¶ˆæ¯åˆ°ä»»æ„é€šé“ï¼Œæ— éœ€é¢„å®šä¹‰è¾“å‡ºæ¥å£ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Autowired
private StreamBridge streamBridge;
public void sendMessage(String payload) {
streamBridge.send(&amp;#34;notificationOutput&amp;#34;, payload); // é€šé“åéœ€åœ¨é…ç½®ä¸­å®šä¹‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é…ç½®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.cloud.stream.bindings.notificationOutput.destination: orders-topic
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¢„å£°æ˜è¾“å‡ºé€šé“&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;@Output&lt;/code&gt;å®šä¹‰é€šé“å¹¶æ‰‹åŠ¨å‘é€ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannels {
@Output(&amp;#34;notificationOutput&amp;#34;)
MessageChannel notificationChannel();
}
@Autowired
private CustomChannels channels;
public void send(String payload) {
channels.notificationChannel().send(MessageBuilder.withPayload(payload).build());
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å››æ³¨è§£åŠŸèƒ½å¯¹æ¯”"&gt;&lt;strong&gt;å››ã€æ³¨è§£åŠŸèƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@StreamListener&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆå¯ç‹¬ç«‹ä½¿ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;ç›‘å¬æ¶ˆæ¯å¹¶è§¦å‘æ–¹æ³•æ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;æ¶ˆè´¹æ¶ˆæ¯ã€æ‰§è¡Œä¸šåŠ¡é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@SendTo&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»é…åˆ &lt;code&gt;@StreamListener&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†æ–¹æ³•è¿”å›å€¼å‘é€åˆ°è¾“å‡ºé€šé“&lt;/td&gt;
&lt;td&gt;è¯·æ±‚-å“åº”æ¨¡å¼çš„æ¶ˆæ¯å›å¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;StreamBridge&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆå¯ç‹¬ç«‹ä½¿ç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€å‘é€æ¶ˆæ¯åˆ°ä»»æ„é€šé“&lt;/td&gt;
&lt;td&gt;æ¡ä»¶æ€§å‘é€ã€éè¿”å›å€¼è§¦å‘çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="äº”æ€»ç»“"&gt;&lt;strong&gt;äº”ã€æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¾èµ–å…³ç³»&lt;/strong&gt;ï¼š&lt;code&gt;@SendTo&lt;/code&gt;æœ¬è´¨æ˜¯ &lt;code&gt;@StreamListener&lt;/code&gt;çš„&lt;strong&gt;æ‰©å±•å¢å¼º&lt;/strong&gt;ï¼Œé€šè¿‡æ–¹æ³•è¿”å›å€¼å®ç°è½»é‡çº§å“åº”å¼æ¶ˆæ¯æµï¼Œä¸¤è€…å…±åŒæ„æˆâ€œ&lt;strong&gt;æ¶ˆè´¹-å¤„ç†-å“åº”&lt;/strong&gt;â€é—­ç¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡æ„å›¾&lt;/strong&gt;ï¼šè¿™ç§è®¾è®¡ç¡®ä¿æ¶ˆæ¯ç”Ÿäº§è¡Œä¸ºç´§å¯†ç»‘å®šåˆ°æ¶ˆè´¹é€»è¾‘ä¸­ï¼Œé¿å…æ— æ¥æºçš„å‘é€åŠ¨ä½œï¼Œç¬¦åˆç®¡é“å¼å¤„ç†çš„æ€æƒ³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ›¿ä»£&lt;/strong&gt;ï¼šè‹¥éœ€è§£è€¦å‘é€åŠ¨ä½œï¼Œä¼˜å…ˆé€‰æ‹© &lt;code&gt;StreamBridge&lt;/code&gt;æˆ–é¢„å®šä¹‰é€šé“çš„æ‰‹åŠ¨å‘é€æ–¹å¼ï¼Œè€Œéå¼ºåˆ¶ç»„åˆæ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="åä½œ"&gt;åä½œ
&lt;/h2&gt;&lt;p&gt;Spring Cloud Stream ä¸­çš„ &lt;code&gt;@Input&lt;/code&gt;/&lt;code&gt;@Output&lt;/code&gt;å’Œ &lt;code&gt;@StreamListener&lt;/code&gt;/&lt;code&gt;@SendTo&lt;/code&gt;å¹¶éä¸åŒç‰ˆæœ¬æ¨å‡ºçš„ç‹¬ç«‹æ³¨è§£ç»„åˆï¼Œè€Œæ˜¯&lt;strong&gt;åŒä¸€æ—¶æœŸï¼ˆæ—©æœŸç‰ˆæœ¬ï¼‰ååŒå·¥ä½œçš„æ³¨è§£&lt;/strong&gt;ï¼Œå…±åŒæ„å»ºäº†æ³¨è§£é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸€æ³¨è§£çš„å®šä½ä¸åä½œå…³ç³»"&gt;&lt;strong&gt;ä¸€ã€æ³¨è§£çš„å®šä½ä¸åä½œå…³ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Input&lt;/code&gt;å’Œ &lt;code&gt;@Output&lt;/code&gt;ï¼ˆé€šé“å£°æ˜å±‚ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå®šä¹‰æ¶ˆæ¯é€šé“çš„æŠ½è±¡æ¥å£ï¼Œæ ‡è¯†æ¶ˆæ¯çš„å…¥å£ï¼ˆè¾“å…¥é€šé“ï¼‰å’Œå‡ºå£ï¼ˆè¾“å‡ºé€šé“ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å£°æ˜é€šé“æ¥å£ï¼ˆå¦‚ &lt;code&gt;Source&lt;/code&gt;ã€&lt;code&gt;Sink&lt;/code&gt;æˆ–è‡ªå®šä¹‰æ¥å£ï¼‰ï¼Œé€šè¿‡ &lt;code&gt;@EnableBinding&lt;/code&gt;æ¿€æ´»ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface CustomChannel {
@Input(&amp;#34;orderInput&amp;#34;)
SubscribableChannel input();
@Output(&amp;#34;notificationOutput&amp;#34;)
MessageChannel output();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬è´¨&lt;/strong&gt;ï¼šåœ¨ Spring å®¹å™¨ä¸­æ³¨å†Œé€šé“ Beanï¼Œè¿æ¥ä¸šåŠ¡ä»£ç ä¸æ¶ˆæ¯ä¸­é—´ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@StreamListener&lt;/code&gt;å’Œ &lt;code&gt;@SendTo&lt;/code&gt;ï¼ˆæ¶ˆæ¯å¤„ç†å±‚ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@StreamListener&lt;/code&gt;ï¼šç›‘å¬è¾“å…¥é€šé“çš„æ¶ˆæ¯ï¼Œè§¦å‘æ¶ˆè´¹é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@SendTo&lt;/code&gt;ï¼šå°†æ–¹æ³•è¿”å›å€¼è·¯ç”±åˆ°è¾“å‡ºé€šé“ï¼ˆéœ€é…åˆ &lt;code&gt;@StreamListener&lt;/code&gt;ä½¿ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@StreamListener&lt;/code&gt;ä¾èµ– &lt;code&gt;@Input&lt;/code&gt;å®šä¹‰çš„é€šé“ï¼ˆå¦‚ &lt;code&gt;Sink.INPUT&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@SendTo&lt;/code&gt;ä¾èµ– &lt;code&gt;@Output&lt;/code&gt;å®šä¹‰çš„é€šé“ï¼ˆå¦‚ &lt;code&gt;Source.OUTPUT&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@StreamListener(Sink.INPUT)
@SendTo(Source.OUTPUT)
public String process(String payload) {
return payload.toUpperCase();
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äºŒç‰ˆæœ¬æ¼”è¿›ä¸å¼ƒç”¨"&gt;&lt;strong&gt;äºŒã€ç‰ˆæœ¬æ¼”è¿›ä¸å¼ƒç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—©æœŸç‰ˆæœ¬ï¼ˆV2-V3.0ï¼‰çš„å®Œæ•´å·¥ä½œæµ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šé“å£°æ˜&lt;/strong&gt;ï¼š&lt;code&gt;@Input&lt;/code&gt;+ &lt;code&gt;@Output&lt;/code&gt;+ &lt;code&gt;@EnableBinding&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯å¤„ç†&lt;/strong&gt;ï¼š&lt;code&gt;@StreamListener&lt;/code&gt;+ &lt;code&gt;@SendTo&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åä½œæµç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[é€šé“å£°æ˜] --&amp;gt; B[æ¶ˆæ¯ç›‘å¬]
B --&amp;gt; C[å¤„ç†æ¶ˆæ¯]
C --&amp;gt; D[å‘é€å“åº”]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¸€ç»„åˆåœ¨ Spring Cloud Stream V2 è‡³ V3.0 æ˜¯ä¸»æµæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;V3.1+ ç‰ˆæœ¬çš„å˜é©&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ƒç”¨æ³¨è§£æ¨¡å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@EnableBinding&lt;/code&gt;ã€&lt;code&gt;@Input&lt;/code&gt;ã€&lt;code&gt;@Output&lt;/code&gt;ã€&lt;code&gt;@StreamListener&lt;/code&gt;å’Œ &lt;code&gt;@SendTo&lt;/code&gt;&lt;strong&gt;å…¨éƒ¨è¢«æ ‡è®°ä¸º &lt;code&gt;@Deprecated&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŸå› ï¼šå‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹ï¼ˆ&lt;code&gt;Supplier&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;/&lt;code&gt;Consumer&lt;/code&gt;ï¼‰æ›´ç®€æ´ä¸”è§£è€¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€šé“ç»‘å®š&lt;/strong&gt;ï¼šé€šè¿‡é…ç½®è‡ªåŠ¨ç”Ÿæˆï¼ˆå¦‚ &lt;code&gt;å‡½æ•°å-in-0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯å¤„ç†&lt;/strong&gt;ï¼šç”¨ &lt;code&gt;StreamBridge&lt;/code&gt;åŠ¨æ€å‘é€ï¼Œæˆ–å£°æ˜ &lt;code&gt;Consumer&lt;/code&gt;/&lt;code&gt;Function&lt;/code&gt;Bean æ¶ˆè´¹æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸‰æ ¸å¿ƒå·®å¼‚æ€»ç»“"&gt;&lt;strong&gt;ä¸‰ã€æ ¸å¿ƒå·®å¼‚æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§’è‰²&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‰ˆæœ¬æ”¯æŒ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Input&lt;/code&gt;/&lt;code&gt;@Output&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰é€šé“æŠ½è±¡&lt;/td&gt;
&lt;td&gt;V2-V3.0ï¼ˆå·²å¼ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;å‡½æ•°å¼æ¨¡å‹ï¼ˆè‡ªåŠ¨ç»‘å®šé€šé“ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@StreamListener&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›‘å¬å¹¶æ¶ˆè´¹æ¶ˆæ¯&lt;/td&gt;
&lt;td&gt;V2-V3.0ï¼ˆå·²å¼ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Consumer&amp;lt;T&amp;gt;&lt;/code&gt;Bean&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@SendTo&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†è¿”å›å€¼å‘é€åˆ°é€šé“&lt;/td&gt;
&lt;td&gt;V2-V3.0ï¼ˆå·²å¼ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Function&amp;lt;T,R&amp;gt;&lt;/code&gt;æˆ– &lt;code&gt;StreamBridge&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å››è¿ç§»å»ºè®®"&gt;&lt;strong&gt;å››ã€è¿ç§»å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ–°é¡¹ç›®ç›´æ¥ä½¿ç”¨å‡½æ•°å¼æ¨¡å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…&lt;/strong&gt;ï¼š&lt;code&gt;StreamBridge.send(&amp;quot;channel-out-0&amp;quot;, payload)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…&lt;/strong&gt;ï¼šå£°æ˜ &lt;code&gt;Consumer&amp;lt;T&amp;gt;&lt;/code&gt;Bean è‡ªåŠ¨ç»‘å®šè¾“å…¥é€šé“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—§é¡¹ç›®è¿ç§»æ­¥éª¤&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç§»é™¤ &lt;code&gt;@EnableBinding&lt;/code&gt;å’Œé€šé“æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;æ›¿æ¢ &lt;code&gt;@StreamListener&lt;/code&gt;ä¸º &lt;code&gt;Consumer&lt;/code&gt;Beanã€‚&lt;/li&gt;
&lt;li&gt;ç”¨ &lt;code&gt;StreamBridge&lt;/code&gt;æ›¿ä»£ &lt;code&gt;@SendTo&lt;/code&gt;çš„æ¶ˆæ¯å‘é€é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ¬è´¨æ¼”è¿›é€»è¾‘&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£æ¨¡å‹&lt;/strong&gt;ï¼šé€šè¿‡åˆ†å±‚æ³¨è§£ï¼ˆé€šé“å£°æ˜ + æ¶ˆæ¯å¤„ç†ï¼‰å®ç°è§£è€¦ï¼Œä½†éœ€æ˜¾å¼å®šä¹‰æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡½æ•°å¼æ¨¡å‹&lt;/strong&gt;ï¼šé€šè¿‡çº¦å®šä¼˜äºé…ç½®ï¼ˆå¦‚é€šé“å‘½åè§„åˆ™ï¼‰å’Œ Lambda è¡¨è¾¾å¼ï¼Œè¿›ä¸€æ­¥å‡å°‘æ ·æ¿ä»£ç ï¼Œæå‡çµæ´»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡ç†è§£æ³¨è§£çš„åä½œä¸æ¼”è¿›ï¼Œå¯æ›´é«˜æ•ˆåœ°æ„å»ºå’Œç»´æŠ¤æ¶ˆæ¯é©±åŠ¨æ¶æ„ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Annotations</title><link>https://dyhes.github.io/p/shopeeannotations/</link><pubDate>Wed, 20 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeeannotations/</guid><description>&lt;h2 id="getmapping"&gt;GetMapping
&lt;/h2&gt;&lt;p&gt;æ ¹æ® Spring æ¡†æ¶çš„è®¾è®¡è§„èŒƒï¼Œ&lt;code&gt;@GetMapping&lt;/code&gt;å¯¹æ‰€åœ¨ç±»æœ‰æ˜ç¡®è¦æ±‚ï¼Œä¸”ç±»å¿…é¡»æ·»åŠ ç‰¹å®šçš„æ³¨è§£æ‰èƒ½ä½¿å…¶ç”Ÿæ•ˆã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒè§„åˆ™å’Œè¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-ç±»å¿…é¡»å£°æ˜ä¸º-spring-æ§åˆ¶å™¨"&gt;âš™ï¸ &lt;strong&gt;1. ç±»å¿…é¡»å£°æ˜ä¸º Spring æ§åˆ¶å™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@GetMapping&lt;/code&gt;æ‰€åœ¨ç±»å¿…é¡»æ·»åŠ ä»¥ä¸‹ä»»ä¸€æ³¨è§£ï¼Œå¦åˆ™ Spring æ— æ³•è¯†åˆ«è¯¥ç±»ä¸ºæ§åˆ¶å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@RestController&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç»„åˆäº† &lt;code&gt;@Controller&lt;/code&gt;å’Œ &lt;code&gt;@ResponseBody&lt;/code&gt;ï¼Œ&lt;strong&gt;æ¨èç”¨äº RESTful API å¼€å‘&lt;/strong&gt;ï¼Œæ–¹æ³•è¿”å›å€¼è‡ªåŠ¨è½¬æ¢ä¸º JSON/XML ç­‰æ•°æ®æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController // âœ… ç±»å¿…é¡»æ·»åŠ æ­¤æ³¨è§£
public class UserController {
@GetMapping(&amp;#34;/user/{id}&amp;#34;)
public User getUser(@PathVariable Long id) { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Controller&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿ MVC æ§åˆ¶å™¨ï¼Œéœ€é…åˆ &lt;code&gt;@ResponseBody&lt;/code&gt;è¿”å›æ•°æ®ï¼ˆè‹¥éœ€è¿”å› JSON è€Œéè§†å›¾ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Controller // âœ… ç±»å£°æ˜ä¸ºæ§åˆ¶å™¨
public class LegacyController {
@GetMapping(&amp;#34;/data&amp;#34;)
@ResponseBody // éœ€æ˜¾å¼æ·»åŠ 
public String getData() { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2"&gt;ğŸ“Œ &lt;strong&gt;2. &lt;code&gt;@RequestMapping&lt;/code&gt;ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¸¸ç”¨äºç»Ÿä¸€è·¯å¾„å‰ç¼€&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»ä¸Šæ— éœ€å¼ºåˆ¶æ·»åŠ  &lt;code&gt;@RequestMapping&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥æ‰€æœ‰æ–¹æ³•è·¯å¾„æ— å…¬å…±å‰ç¼€ï¼Œå¯ç›´æ¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@GetMapping&lt;/code&gt;å®šä¹‰å®Œæ•´è·¯å¾„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»çº§ &lt;code&gt;@RequestMapping&lt;/code&gt;çš„ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¸ºç±»ä¸­æ‰€æœ‰æ–¹æ³•æä¾›ç»Ÿä¸€è·¯å¾„å‰ç¼€ï¼Œç®€åŒ–è·¯å¾„ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController
@RequestMapping(&amp;#34;/api&amp;#34;) // âœ… éå¿…éœ€ï¼Œä½†å¯ç»Ÿä¸€è·¯å¾„
public class ApiController {
@GetMapping(&amp;#34;/users&amp;#34;) // å®Œæ•´è·¯å¾„ï¼š/api/users
public List&amp;lt;User&amp;gt; getUsers() { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;3. å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºå°‘æ§åˆ¶å™¨æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥ç±»æœªæ·»åŠ  &lt;code&gt;@RestController&lt;/code&gt;æˆ– &lt;code&gt;@Controller&lt;/code&gt;ï¼Œ&lt;code&gt;@GetMapping&lt;/code&gt;ä¼šå®Œå…¨å¤±æ•ˆï¼ŒSpring ä¸ä¼šæ³¨å†Œè¯¥æ–¹æ³•çš„è·¯ç”±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··æ·† &lt;code&gt;@RestController&lt;/code&gt;ä¸ &lt;code&gt;@Controller&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@RestController&lt;/code&gt;æ–¹æ³•&lt;strong&gt;è‡ªåŠ¨è¿”å›æ•°æ®&lt;/strong&gt;ï¼ˆæ— éœ€ &lt;code&gt;@ResponseBody&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Controller&lt;/code&gt;æ–¹æ³•é»˜è®¤è¿”å›è§†å›¾åç§°ï¼Œéœ€é¢å¤–æ·»åŠ  &lt;code&gt;@ResponseBody&lt;/code&gt;è¿”å›æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¯å¾„å†²çªé—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åŒç±»æˆ–ä¸åŒç±»ä¸­å®šä¹‰é‡å¤è·¯å¾„çš„ &lt;code&gt;@GetMapping&lt;/code&gt;ï¼Œä¼šå¯¼è‡´ Spring å¯åŠ¨æŠ¥é”™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ç±»æ³¨è§£çš„å¼ºåˆ¶æ€§ä¸é€‰æ‹©å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šç±»æ³¨è§£çš„å¼ºåˆ¶æ€§ä¸é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¿…é¡»æ·»åŠ çš„ç±»æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@RestController&lt;/code&gt;æˆ– &lt;code&gt;@Controller&lt;/code&gt;&lt;strong&gt;äºŒé€‰ä¸€&lt;/strong&gt;ï¼Œå¦åˆ™ &lt;code&gt;@GetMapping&lt;/code&gt;æ— æ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@RequestMapping&lt;/code&gt;çš„ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;éå¿…éœ€ï¼Œä½†æ¨èåœ¨ç±»ä¸Šæ·»åŠ ä»¥ç»Ÿä¸€è·¯å¾„å‰ç¼€ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¸å‹åœºæ™¯é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿”å› JSON/XML æ•°æ®&lt;/strong&gt; â†’ ä¼˜å…ˆç”¨ &lt;code&gt;@RestController&lt;/code&gt;ï¼ˆç®€æ´ä¸”é¿å…é‡å¤æ³¨è§£ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å› HTML è§†å›¾&lt;/strong&gt; â†’ ä½¿ç”¨ &lt;code&gt;@Controller&lt;/code&gt;+ è§†å›¾è§£æå™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¤ºä¾‹å®Œæ•´ä»£ç ç»“æ„ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController // âœ… å¿…éœ€ï¼šå£°æ˜ä¸º REST æ§åˆ¶å™¨
@RequestMapping(&amp;#34;/api&amp;#34;) // å¯é€‰ï¼šç»Ÿä¸€è·¯å¾„å‰ç¼€
public class DemoController {
@GetMapping(&amp;#34;/hello&amp;#34;) // âœ… æ–¹æ³•çº§æ³¨è§£
public String hello() {
return &amp;#34;Hello World&amp;#34;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;h2 id="restcontroller"&gt;RestController
&lt;/h2&gt;&lt;p&gt;æ ¹æ® Spring æ¡†æ¶çš„è®¾è®¡è§„èŒƒï¼Œ&lt;code&gt;@GetMapping&lt;/code&gt;å¯¹æ‰€åœ¨ç±»æœ‰æ˜ç¡®è¦æ±‚ï¼Œä¸”ç±»å¿…é¡»æ·»åŠ ç‰¹å®šçš„æ³¨è§£æ‰èƒ½ä½¿å…¶ç”Ÿæ•ˆã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒè§„åˆ™å’Œè¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-ç±»å¿…é¡»å£°æ˜ä¸º-spring-æ§åˆ¶å™¨-1"&gt;âš™ï¸ &lt;strong&gt;1. ç±»å¿…é¡»å£°æ˜ä¸º Spring æ§åˆ¶å™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@GetMapping&lt;/code&gt;æ‰€åœ¨ç±»å¿…é¡»æ·»åŠ ä»¥ä¸‹ä»»ä¸€æ³¨è§£ï¼Œå¦åˆ™ Spring æ— æ³•è¯†åˆ«è¯¥ç±»ä¸ºæ§åˆ¶å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@RestController&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç»„åˆäº† &lt;code&gt;@Controller&lt;/code&gt;å’Œ &lt;code&gt;@ResponseBody&lt;/code&gt;ï¼Œ&lt;strong&gt;æ¨èç”¨äº RESTful API å¼€å‘&lt;/strong&gt;ï¼Œæ–¹æ³•è¿”å›å€¼è‡ªåŠ¨è½¬æ¢ä¸º JSON/XML ç­‰æ•°æ®æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController // âœ… ç±»å¿…é¡»æ·»åŠ æ­¤æ³¨è§£
public class UserController {
@GetMapping(&amp;#34;/user/{id}&amp;#34;)
public User getUser(@PathVariable Long id) { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Controller&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿ MVC æ§åˆ¶å™¨ï¼Œéœ€é…åˆ &lt;code&gt;@ResponseBody&lt;/code&gt;è¿”å›æ•°æ®ï¼ˆè‹¥éœ€è¿”å› JSON è€Œéè§†å›¾ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Controller // âœ… ç±»å£°æ˜ä¸ºæ§åˆ¶å™¨
public class LegacyController {
@GetMapping(&amp;#34;/data&amp;#34;)
@ResponseBody // éœ€æ˜¾å¼æ·»åŠ 
public String getData() { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-1"&gt;ğŸ“Œ &lt;strong&gt;2. &lt;code&gt;@RequestMapping&lt;/code&gt;ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¸¸ç”¨äºç»Ÿä¸€è·¯å¾„å‰ç¼€&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»ä¸Šæ— éœ€å¼ºåˆ¶æ·»åŠ  &lt;code&gt;@RequestMapping&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥æ‰€æœ‰æ–¹æ³•è·¯å¾„æ— å…¬å…±å‰ç¼€ï¼Œå¯ç›´æ¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@GetMapping&lt;/code&gt;å®šä¹‰å®Œæ•´è·¯å¾„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»çº§ &lt;code&gt;@RequestMapping&lt;/code&gt;çš„ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¸ºç±»ä¸­æ‰€æœ‰æ–¹æ³•æä¾›ç»Ÿä¸€è·¯å¾„å‰ç¼€ï¼Œç®€åŒ–è·¯å¾„ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController
@RequestMapping(&amp;#34;/api&amp;#34;) // âœ… éå¿…éœ€ï¼Œä½†å¯ç»Ÿä¸€è·¯å¾„
public class ApiController {
@GetMapping(&amp;#34;/users&amp;#34;) // å®Œæ•´è·¯å¾„ï¼š/api/users
public List&amp;lt;User&amp;gt; getUsers() { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ &lt;strong&gt;3. å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºå°‘æ§åˆ¶å™¨æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥ç±»æœªæ·»åŠ  &lt;code&gt;@RestController&lt;/code&gt;æˆ– &lt;code&gt;@Controller&lt;/code&gt;ï¼Œ&lt;code&gt;@GetMapping&lt;/code&gt;ä¼šå®Œå…¨å¤±æ•ˆï¼ŒSpring ä¸ä¼šæ³¨å†Œè¯¥æ–¹æ³•çš„è·¯ç”±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··æ·† &lt;code&gt;@RestController&lt;/code&gt;ä¸ &lt;code&gt;@Controller&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@RestController&lt;/code&gt;æ–¹æ³•&lt;strong&gt;è‡ªåŠ¨è¿”å›æ•°æ®&lt;/strong&gt;ï¼ˆæ— éœ€ &lt;code&gt;@ResponseBody&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Controller&lt;/code&gt;æ–¹æ³•é»˜è®¤è¿”å›è§†å›¾åç§°ï¼Œéœ€é¢å¤–æ·»åŠ  &lt;code&gt;@ResponseBody&lt;/code&gt;è¿”å›æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¯å¾„å†²çªé—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åŒç±»æˆ–ä¸åŒç±»ä¸­å®šä¹‰é‡å¤è·¯å¾„çš„ &lt;code&gt;@GetMapping&lt;/code&gt;ï¼Œä¼šå¯¼è‡´ Spring å¯åŠ¨æŠ¥é”™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ç±»æ³¨è§£çš„å¼ºåˆ¶æ€§ä¸é€‰æ‹©å»ºè®®-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šç±»æ³¨è§£çš„å¼ºåˆ¶æ€§ä¸é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¿…é¡»æ·»åŠ çš„ç±»æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@RestController&lt;/code&gt;æˆ– &lt;code&gt;@Controller&lt;/code&gt;&lt;strong&gt;äºŒé€‰ä¸€&lt;/strong&gt;ï¼Œå¦åˆ™ &lt;code&gt;@GetMapping&lt;/code&gt;æ— æ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@RequestMapping&lt;/code&gt;çš„ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;éå¿…éœ€ï¼Œä½†æ¨èåœ¨ç±»ä¸Šæ·»åŠ ä»¥ç»Ÿä¸€è·¯å¾„å‰ç¼€ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¸å‹åœºæ™¯é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿”å› JSON/XML æ•°æ®&lt;/strong&gt; â†’ ä¼˜å…ˆç”¨ &lt;code&gt;@RestController&lt;/code&gt;ï¼ˆç®€æ´ä¸”é¿å…é‡å¤æ³¨è§£ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å› HTML è§†å›¾&lt;/strong&gt; â†’ ä½¿ç”¨ &lt;code&gt;@Controller&lt;/code&gt;+ è§†å›¾è§£æå™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¤ºä¾‹å®Œæ•´ä»£ç ç»“æ„ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController // âœ… å¿…éœ€ï¼šå£°æ˜ä¸º REST æ§åˆ¶å™¨
@RequestMapping(&amp;#34;/api&amp;#34;) // å¯é€‰ï¼šç»Ÿä¸€è·¯å¾„å‰ç¼€
public class DemoController {
@GetMapping(&amp;#34;/hello&amp;#34;) // âœ… æ–¹æ³•çº§æ³¨è§£
public String hello() {
return &amp;#34;Hello World&amp;#34;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;h2 id="requestmapping"&gt;@RequestMapping
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring MVC æ¡†æ¶ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@RequestMapping&lt;/code&gt;æ³¨è§£å¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ª HTTP è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ GET å’Œ POSTï¼‰&lt;/strong&gt;ï¼Œè¿™æ˜¯å…¶æ ¸å¿ƒè®¾è®¡ç‰¹æ€§ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§„åˆ™å’Œå®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-åŒæ—¶å®šä¹‰å¤šæ–¹æ³•çš„è¯­æ³•"&gt;âš™ï¸ &lt;strong&gt;1. åŒæ—¶å®šä¹‰å¤šæ–¹æ³•çš„è¯­æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;method&lt;/code&gt;å±æ€§æŒ‡å®šå¤šä¸ª &lt;code&gt;RequestMethod&lt;/code&gt;æšä¸¾å€¼ï¼Œä»¥æ•°ç»„å½¢å¼å£°æ˜æ”¯æŒçš„è¯·æ±‚æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RequestMapping(
value = &amp;#34;/api/data&amp;#34;,
method = {RequestMethod.GET, RequestMethod.POST} // âœ… åŒæ—¶æ”¯æŒ GET å’Œ POST
)
public String handleData() {
return &amp;#34;Processed for both GET and POST&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å½“å®¢æˆ·ç«¯å‘èµ· &lt;strong&gt;GET è¯·æ±‚&lt;/strong&gt; &lt;code&gt;/api/data&lt;/code&gt;æ—¶ï¼Œè¯¥æ–¹æ³•è¢«è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;å½“å®¢æˆ·ç«¯å‘èµ· &lt;strong&gt;POST è¯·æ±‚&lt;/strong&gt; &lt;code&gt;/api/data&lt;/code&gt;æ—¶ï¼Œè¯¥æ–¹æ³•åŒæ ·è¢«è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-æœªæŒ‡å®š"&gt;âš ï¸ &lt;strong&gt;2. æœªæŒ‡å®š &lt;code&gt;method&lt;/code&gt;å±æ€§çš„é»˜è®¤è¡Œä¸º&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥çœç•¥ &lt;code&gt;method&lt;/code&gt;å±æ€§ï¼Œåˆ™ &lt;strong&gt;&lt;code&gt;@RequestMapping&lt;/code&gt;é»˜è®¤æ”¯æŒæ‰€æœ‰ HTTP è¯·æ±‚æ–¹æ³•&lt;/strong&gt;ï¼ˆåŒ…æ‹¬ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RequestMapping(&amp;#34;/api/data&amp;#34;) // âœ… é»˜è®¤æ”¯æŒæ‰€æœ‰æ–¹æ³•
public String defaultHandler() {
return &amp;#34;Supports any HTTP method&amp;#34;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤å†™æ³•ç­‰åŒäºæ˜¾å¼å£°æ˜ &lt;code&gt;method = {RequestMethod.GET, RequestMethod.POST, ...}&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-3-å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ &lt;strong&gt;3. å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¡ç”Ÿæ³¨è§£çš„é™åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@GetMapping&lt;/code&gt;ã€&lt;code&gt;@PostMapping&lt;/code&gt;ç­‰è¡ç”Ÿæ³¨è§£ä»…æ”¯æŒå•ä¸€ HTTP æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;@GetMapping&lt;/code&gt;ä»…æ”¯æŒ GETï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯ç”¨äºå¤šæ–¹æ³•æ”¯æŒ&lt;/strong&gt;ï¼Œéœ€ç›´æ¥ä½¿ç”¨ &lt;code&gt;@RequestMapping&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯å¾„å†²çªé—®é¢˜&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥åŒä¸€è·¯å¾„å­˜åœ¨å¤šä¸ªå¤„ç†å™¨æ–¹æ³•ï¼ˆå¦‚ä¸€ä¸ªç”¨ &lt;code&gt;@GetMapping&lt;/code&gt;ï¼Œå¦ä¸€ä¸ªç”¨ &lt;code&gt;@PostMapping&lt;/code&gt;ï¼‰ï¼Œæ— å†²çªã€‚&lt;/li&gt;
&lt;li&gt;ä½†è‹¥ä¸¤ä¸ªæ–¹æ³•å‡ç”¨ &lt;code&gt;@RequestMapping&lt;/code&gt;ä¸”è·¯å¾„ç›¸åŒä½†æœªåŒºåˆ† &lt;code&gt;method&lt;/code&gt;ï¼Œå¯åŠ¨æ—¶ä¼šæŠ¥ &lt;code&gt;Ambiguous mapping&lt;/code&gt;é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æ”¯æŒçš„è¯·æ±‚æ–¹æ³•å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥å®¢æˆ·ç«¯ä»¥æœªå£°æ˜çš„æ–¹æ³•è¯·æ±‚ï¼ˆå¦‚å¯¹ä»…æ”¯æŒ GET/POST çš„æ¥å£å‘èµ· PUT è¯·æ±‚ï¼‰ï¼ŒSpring ä¼šè¿”å› &lt;strong&gt;&lt;code&gt;405 Method Not Allowed&lt;/code&gt;&lt;/strong&gt; é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ”¯æŒå¤šæ–¹æ³•&lt;/strong&gt;ï¼š&lt;code&gt;@RequestMapping&lt;/code&gt;å¯é€šè¿‡ &lt;code&gt;method&lt;/code&gt;å±æ€§æ•°ç»„ï¼ˆå¦‚ &lt;code&gt;{GET, POST}&lt;/code&gt;ï¼‰&lt;strong&gt;åŒæ—¶æ”¯æŒå¤šä¸ª HTTP æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸º&lt;/strong&gt;ï¼šæœªæŒ‡å®š &lt;code&gt;method&lt;/code&gt;æ—¶ï¼Œ&lt;strong&gt;é»˜è®¤æ”¯æŒæ‰€æœ‰æ–¹æ³•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šéœ€ä¸¥æ ¼åŒºåˆ†æ–¹æ³•æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨è¡ç”Ÿæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@GetMapping&lt;/code&gt;ã€&lt;code&gt;@PostMapping&lt;/code&gt;ï¼‰ä»¥æé«˜å¯è¯»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹å®Œæ•´ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@RestController
public class MultiMethodController {
// åŒæ—¶æ”¯æŒ GET å’Œ POST
@RequestMapping(value = &amp;#34;/submit&amp;#34;, method = {RequestMethod.GET, RequestMethod.POST})
public String handleSubmit() {
return &amp;#34;Processed for GET or POST&amp;#34;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;h2 id="table"&gt;@Table
&lt;/h2&gt;&lt;p&gt;åœ¨ Java æŒä¹…åŒ–æ¡†æ¶ï¼ˆå¦‚ JPA æˆ– Hibernateï¼‰ä¸­ï¼Œ&lt;strong&gt;å¯ä»¥é€šè¿‡ &lt;code&gt;@Table&lt;/code&gt;æ³¨è§£ç›´æ¥è·å– &lt;code&gt;schema&lt;/code&gt;ä¿¡æ¯&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“æ–¹æ³•åŠæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-ç›´æ¥é€šè¿‡"&gt;âœ… &lt;strong&gt;1. ç›´æ¥é€šè¿‡ &lt;code&gt;@Table.schema()&lt;/code&gt;è·å–&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Table&lt;/code&gt;æ³¨è§£æä¾›äº† &lt;code&gt;schema&lt;/code&gt;å±æ€§ï¼Œç”¨äºæ˜¾å¼æŒ‡å®šæ•°æ®åº“æ¨¡å¼ï¼ˆSchemaï¼‰ã€‚é€šè¿‡åå°„å³å¯è¯»å–è¯¥å€¼ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import javax.persistence.Table;
public class SchemaUtils {
public static String getSchemaName(Class&amp;lt;?&amp;gt; entityClass) {
Table tableAnnotation = entityClass.getAnnotation(Table.class);
if (tableAnnotation != null) {
return tableAnnotation.schema(); // ç›´æ¥è¿”å› schema å±æ€§å€¼
}
return &amp;#34;&amp;#34;; // æœªæ˜¾å¼æŒ‡å®šæ—¶è¿”å›ç©ºå­—ç¬¦ä¸²
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ç”¨æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å®ä½“ç±»å£°æ˜
@Entity
@Table(name = &amp;#34;users&amp;#34;, schema = &amp;#34;public&amp;#34;)
public class User { ... }
// è·å– schema
String schema = SchemaUtils.getSchemaName(User.class);
System.out.println(schema); // è¾“å‡º: public
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-2-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;2. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾å¼å£°æ˜æ‰æœ‰æ•ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä»…å½“å®ä½“ç±»ä¸Šæ˜ç¡®é…ç½®äº† &lt;code&gt;@Table(schema = &amp;quot;xxx&amp;quot;)&lt;/code&gt;æ—¶æ‰èƒ½è·å–åˆ°å€¼ã€‚è‹¥æœªæŒ‡å®šï¼Œ&lt;code&gt;schema()&lt;/code&gt;è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆ&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸º&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥æœªé…ç½® &lt;code&gt;schema&lt;/code&gt;ï¼ŒJPA ä¼šä½¿ç”¨æ•°æ®åº“é»˜è®¤æ¨¡å¼ï¼ˆå¦‚ PostgreSQL çš„ &lt;code&gt;public&lt;/code&gt;ã€MySQL çš„æ•°æ®åº“åï¼‰ï¼Œä½†&lt;strong&gt;æ¡†æ¶ä¸ä¼šå°†é»˜è®¤å€¼å¡«å……åˆ°æ³¨è§£å±æ€§ä¸­&lt;/strong&gt;ï¼Œå› æ­¤åå°„æ— æ³•æ•è·é»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šç§Ÿæˆ·åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨éœ€è¦åŠ¨æ€ Schema çš„åœºæ™¯ï¼ˆå¦‚ SaaS å¤šç§Ÿæˆ·ï¼‰ï¼Œé€šå¸¸éœ€ç»“åˆ &lt;code&gt;Hibernate&lt;/code&gt;çš„ &lt;code&gt;CurrentTenantIdentifierResolver&lt;/code&gt;æˆ– &lt;code&gt;Spring&lt;/code&gt;çš„åŠ¨æ€æ•°æ®æºè·¯ç”±å®ç°ï¼Œè€Œéä¾èµ–æ³¨è§£å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-æ‰©å±•è·å–å…¶ä»–è¡¨ä¿¡æ¯"&gt;ğŸ”§ &lt;strong&gt;3. æ‰©å±•ï¼šè·å–å…¶ä»–è¡¨ä¿¡æ¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Table&lt;/code&gt;æ³¨è§£è¿˜æ”¯æŒä»¥ä¸‹å±æ€§ï¼Œå‡å¯é€šè¿‡åå°„è·å–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;name&lt;/code&gt;&lt;/strong&gt;ï¼šè¡¨åï¼ˆæœ€å¸¸ç”¨ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;catalog&lt;/code&gt;&lt;/strong&gt;ï¼šæ•°æ®åº“ç›®å½•åï¼ˆç±»ä¼¼ Schemaï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;uniqueConstraints&lt;/code&gt;&lt;/strong&gt;ï¼šè¡¨çº§å”¯ä¸€çº¦æŸ&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Table table = entityClass.getAnnotation(Table.class);
String tableName = table.name();
String catalog = table.catalog();
UniqueConstraint[] constraints = table.uniqueConstraints();
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èƒ½å¦è·å– Schema&lt;/strong&gt;ï¼šâœ… èƒ½ï¼Œä½†&lt;strong&gt;å¿…é¡»æ˜¾å¼å£°æ˜&lt;/strong&gt;åœ¨ &lt;code&gt;@Table(schema = &amp;quot;...&amp;quot;)&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœªå£°æ˜æ—¶çš„è¿”å›å€¼&lt;/strong&gt;ï¼šç©ºå­—ç¬¦ä¸²ï¼ˆ&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;ï¼‰ï¼Œè€Œéæ•°æ®åº“å®é™…é»˜è®¤æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;é€‚åˆéœ€è¦å›ºå®š Schema çš„å¸¸è§„é¡¹ç›®ï¼›åŠ¨æ€ Schema éœ€é€šè¿‡ ORM æ¡†æ¶çš„ç§Ÿæˆ·éš”ç¦»æœºåˆ¶å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="schema"&gt;&lt;strong&gt;Schema&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;æ•°æ®åº“ä¸­çš„ &lt;strong&gt;Schemaï¼ˆæ¨¡å¼ï¼‰&lt;/strong&gt; ä¸ &lt;strong&gt;Databaseï¼ˆæ•°æ®åº“ï¼‰&lt;/strong&gt; æ˜¯ä¸åŒå±‚çº§çš„æ¦‚å¿µï¼Œ&lt;strong&gt;Schema å¹¶ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“&lt;/strong&gt;ï¼Œè€Œæ˜¯æ•°æ®åº“å†…éƒ¨çš„é€»è¾‘ç»„ç»‡å•å…ƒã€‚å…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŒºåˆ«"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŒºåˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Databaseï¼ˆæ•°æ®åº“ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯&lt;strong&gt;ç‰©ç†æˆ–é€»è¾‘ä¸Šçš„é¡¶å±‚å®¹å™¨&lt;/strong&gt;ï¼ŒåŒ…å«æ‰€æœ‰æ•°æ®æ–‡ä»¶ã€ç”¨æˆ·æƒé™ã€è¡¨ç©ºé—´ç­‰èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;ä¸åŒæ•°æ®åº“ä¹‹é—´&lt;strong&gt;ç‰©ç†éš”ç¦»&lt;/strong&gt;ï¼ˆå¦‚ PostgreSQL ä¸­æ— æ³•ç›´æ¥è·¨åº“æŸ¥è¯¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šä¸€ä¸ªç”µå•†ç³»ç»Ÿå¯èƒ½åŒ…å« &lt;code&gt;order_db&lt;/code&gt;ï¼ˆè®¢å•åº“ï¼‰ã€&lt;code&gt;user_db&lt;/code&gt;ï¼ˆç”¨æˆ·åº“ï¼‰ç­‰ç‹¬ç«‹æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Schemaï¼ˆæ¨¡å¼ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯æ•°æ®åº“å†…éƒ¨çš„&lt;strong&gt;é€»è¾‘åˆ†ç»„å·¥å…·&lt;/strong&gt;ï¼Œç”¨äºç»„ç»‡è¡¨ã€è§†å›¾ã€ç´¢å¼•ç­‰å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;åŒä¸€æ•°æ®åº“ä¸‹å¯åŒ…å«&lt;strong&gt;å¤šä¸ª Schema&lt;/strong&gt;ï¼Œä¸åŒ Schema å¯å­˜åœ¨åŒåå¯¹è±¡ï¼ˆéœ€ç”¨ &lt;code&gt;schema_name.object_name&lt;/code&gt;è®¿é—®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;order_db&lt;/code&gt;ä¸­å¯åˆ›å»º &lt;code&gt;payment_schema&lt;/code&gt;ï¼ˆæ”¯ä»˜æ¨¡å—ï¼‰ã€&lt;code&gt;logistics_schema&lt;/code&gt;ï¼ˆç‰©æµæ¨¡å—ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸åŒæ•°æ®åº“çš„å®ç°å·®å¼‚"&gt;ğŸ—‚ï¸ &lt;strong&gt;ä¸åŒæ•°æ®åº“çš„å®ç°å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®åº“ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Schema çš„æœ¬è´¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸ Database çš„å…³ç³»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MySQL&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Schema &lt;strong&gt;ç­‰åŒäº Database&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE SCHEMA&lt;/code&gt;= &lt;code&gt;CREATE DATABASE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª Schema æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç‰©ç†æ•°æ®åº“ï¼Œæ— æ³•åœ¨åº“å†…å†åˆ† Schema ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Database &lt;strong&gt;å†…éƒ¨çš„å‘½åç©ºé—´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ª Database â†’ å¤šä¸ª Schema&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;search_path&lt;/code&gt;è®¾ç½®é»˜è®¤ Schemaï¼Œæ”¯æŒè·¨ Schema æŸ¥è¯¢ ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Oracle&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ç”¨æˆ·å³ Schema&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ›å»ºç”¨æˆ·æ—¶è‡ªåŠ¨ç”ŸæˆåŒå Schema&lt;/td&gt;
&lt;td&gt;ç”¨æˆ· &lt;code&gt;scott&lt;/code&gt;çš„ Schema åä¸º &lt;code&gt;scott&lt;/code&gt;ï¼Œè®¿é—®å…¶ä»– Schema éœ€æˆæƒ ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SQL Server&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æƒé™å®¹å™¨ &amp;amp; å‘½åç©ºé—´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸€ä¸ª Database â†’ å¤šä¸ª Schema&lt;/td&gt;
&lt;td&gt;æƒé™å¯æˆäºˆæ•´ä¸ª Schemaï¼ˆå¦‚ &lt;code&gt;GRANT SELECT ON SCHEMA::sales&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®ç»“è®º"&gt;ğŸ” &lt;strong&gt;å…³é”®ç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Schema â‰  æ•°æ®åº“&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Schema æ˜¯&lt;strong&gt;é€»è¾‘ç»“æ„&lt;/strong&gt;ï¼Œç”¨äºç»„ç»‡å¯¹è±¡ï¼›Database æ˜¯&lt;strong&gt;ç‰©ç†/é€»è¾‘å®¹å™¨&lt;/strong&gt;ï¼ŒåŒ…å«æ‰€æœ‰èµ„æº ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš”ç¦»æ€§ä¸åŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Database æä¾›&lt;strong&gt;ç‰©ç†éš”ç¦»&lt;/strong&gt;ï¼ˆå¦‚ç‹¬ç«‹å­˜å‚¨æ–‡ä»¶ï¼‰ï¼›Schema æä¾›&lt;strong&gt;é€»è¾‘éš”ç¦»&lt;/strong&gt;ï¼ˆå¦‚æƒé™æ§åˆ¶ã€å‘½åç©ºé—´ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šç§Ÿæˆ·ç³»ç»Ÿ&lt;/strong&gt;ï¼šç”¨ PostgreSQL/SQL Server çš„ Schema éš”ç¦»ç§Ÿæˆ·æ•°æ®ï¼ˆä¸€ç§Ÿæˆ·ä¸€ Schemaï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¾®æœåŠ¡æ¶æ„&lt;/strong&gt;ï¼šMySQL ä¸­æ¯ä¸ªæœåŠ¡ä½¿ç”¨ç‹¬ç«‹ Databaseï¼ˆå›  Schema æ— æ³•å†åˆ†ç»„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™ç®¡ç†&lt;/strong&gt;ï¼šSQL Server çš„ Schema çº§æˆæƒç®€åŒ–æ‰¹é‡æƒé™åˆ†é… ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€å¥è¯æ€»ç»“"&gt;ğŸ’¡ &lt;strong&gt;ä¸€å¥è¯æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Schema æ˜¯æ•°æ®åº“çš„â€œå­æ–‡ä»¶å¤¹â€ï¼Œç”¨äºé€»è¾‘åˆ†ç»„ï¼›Database æ˜¯â€œæ€»ä»“åº“â€ï¼Œæä¾›ç‰©ç†å­˜å‚¨å’Œå…¨å±€ç®¡ç†ã€‚&lt;strong&gt;Schema ä¸æ˜¯ç‹¬ç«‹æ•°æ®åº“ï¼Œè€Œæ˜¯æ•°æ®åº“å†…éƒ¨çš„é«˜æ•ˆç®¡ç†å·¥å…·&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="mybatis"&gt;MyBatis
&lt;/h2&gt;&lt;p&gt;åœ¨ MyBatis ä¸­ï¼ŒMapper æ¥å£æ˜¯å¦éœ€è¦æ ‡è®°ä¸º &lt;code&gt;@Mapper&lt;/code&gt;æˆ– &lt;code&gt;@Repository&lt;/code&gt;ï¼Œå–å†³äºé¡¹ç›®é…ç½®å’Œéœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç»“è®ºåŠè¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒç»“è®º"&gt;âœ… &lt;strong&gt;æ ¸å¿ƒç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Mapper&lt;/code&gt;æˆ– &lt;code&gt;@MapperScan&lt;/code&gt;å¿…é¡»äºŒé€‰ä¸€&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤è€…éƒ½ä¸åŠ æ—¶ï¼ŒMyBatis æ— æ³•è¯†åˆ« Mapper æ¥å£ï¼Œå¯¼è‡´å¯åŠ¨æŠ¥é”™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Mapper&lt;/code&gt;&lt;/strong&gt;ï¼šéœ€æ ‡æ³¨åœ¨æ¯ä¸ª Mapper æ¥å£ä¸Šï¼ˆé€‚ç”¨äºæ¥å£æ•°é‡å°‘çš„åœºæ™¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@MapperScan&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨ç±»æˆ–é…ç½®ç±»ä¸Šæ ‡æ³¨ï¼ŒæŒ‡å®š Mapper æ¥å£çš„åŒ…è·¯å¾„ï¼ˆ&lt;strong&gt;æ¨è&lt;/strong&gt;ï¼Œé¿å…é‡å¤æ³¨è§£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Repository&lt;/code&gt;æ˜¯å¯é€‰çš„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»è¦ä½œç”¨ï¼šè§£å†³ IDE çš„æ³¨å…¥è­¦å‘Šï¼ˆå¦‚ â€œCould not autowireâ€ï¼‰ï¼Œä¸å½±å“å®é™…è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;è‹¥éœ€æ˜¾å¼å£°æ˜ DAO å±‚ç»„ä»¶æˆ–ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆå°†åŸç”Ÿå¼‚å¸¸è½¬ä¸º Spring &lt;code&gt;DataAccessException&lt;/code&gt;ï¼‰ï¼Œå¯æ·»åŠ æ­¤æ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è¯¦ç»†è§£æ"&gt;âš™ï¸ &lt;strong&gt;è¯¦ç»†è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-mapper"&gt;1. &lt;strong&gt;&lt;code&gt;@Mapper&lt;/code&gt;å’Œ &lt;code&gt;@MapperScan&lt;/code&gt;çš„å¿…è¦æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Mapper&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;MyBatis æ³¨è§£ï¼Œæ ‡è®°æ¥å£ä¸º Mapperï¼Œè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»æ‰§è¡Œ SQLã€‚&lt;/td&gt;
&lt;td&gt;éœ€åœ¨æ¯ä¸ª Mapper æ¥å£ä¸Šå•ç‹¬æ ‡æ³¨ï¼Œé€‚åˆå°å‹é¡¹ç›®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@MapperScan&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Spring æ³¨è§£ï¼Œæ‰«ææŒ‡å®šåŒ…ä¸‹æ‰€æœ‰æ¥å£å¹¶æ³¨å†Œä¸º Mapper Beanï¼ˆè‡ªåŠ¨åº”ç”¨ &lt;code&gt;@Mapper&lt;/code&gt;é€»è¾‘ï¼‰ã€‚&lt;/td&gt;
&lt;td&gt;åœ¨å¯åŠ¨ç±»æ·»åŠ ï¼ˆå¦‚ &lt;code&gt;@MapperScan(&amp;quot;com.mapper&amp;quot;)&lt;/code&gt;ï¼‰ï¼Œé€‚åˆä¸­å¤§å‹é¡¹ç›®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä¸¤è€…å¿…é¡»è‡³å°‘ä½¿ç”¨ä¸€ä¸ªï¼Œå¦åˆ™ MyBatis æ— æ³•åˆ›å»º Mapper ä»£ç†å¯¹è±¡ï¼Œå¯¼è‡´ä¾èµ–æ³¨å…¥å¤±è´¥ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="2-repository"&gt;2. &lt;strong&gt;&lt;code&gt;@Repository&lt;/code&gt;çš„ä½œç”¨ä¸å¯é€‰æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¶ˆé™¤ IDE è­¦å‘Š&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•ç‹¬ä½¿ç”¨ &lt;code&gt;@Mapper&lt;/code&gt;æ—¶ï¼ŒSpring æ— æ³•ç›´æ¥è¯†åˆ« MyBatis ä»£ç† Beanï¼Œå¯¼è‡´ IDE æç¤ºæ³¨å…¥é”™è¯¯ï¼ˆå®é™…è¿è¡Œæ­£å¸¸ï¼‰ã€‚æ·»åŠ  &lt;code&gt;@Repository&lt;/code&gt;ï¼ˆSpring æ³¨è§£ï¼‰å¯æ˜¾å¼æ³¨å†Œ Beanï¼Œæ¶ˆé™¤è­¦å‘Šã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸è½¬æ¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å°† JDBCã€MyBatis ç­‰åŸç”Ÿå¼‚å¸¸ç»Ÿä¸€è½¬æ¢ä¸º Spring &lt;code&gt;DataAccessException&lt;/code&gt;ï¼Œæå‡å¼‚å¸¸å¤„ç†ä¸€è‡´æ€§ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜ç¡®åˆ†å±‚èŒè´£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¬¦åˆ Spring æ¶æ„è§„èŒƒï¼Œæ˜ç¡®æ ‡è¯†è¯¥ç±»ä¸ºæ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰ç»„ä»¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨èç»„åˆ&lt;/strong&gt;ï¼š&lt;code&gt;@MapperScan&lt;/code&gt;+ &lt;code&gt;@Repository&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åŒæ—¶è§£å†³ Bean æ³¨å†Œã€å¼‚å¸¸è½¬æ¢å’Œ IDE è­¦å‘Šé—®é¢˜ï¼Œä»£ç æ›´è§„èŒƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç®€åŒ–æ–¹æ¡ˆ&lt;/strong&gt;ï¼šä»…ç”¨ &lt;code&gt;@MapperScan&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ¥å— IDE è­¦å‘Šï¼ˆå¯é€šè¿‡è®¾ç½®å¿½ç•¥ï¼‰ï¼Œå‡å°‘æ³¨è§£å†—ä½™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®é™…é…ç½®ç¤ºä¾‹"&gt;ğŸ’¡ &lt;strong&gt;å®é™…é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯spring-boot--mybatis-é¡¹ç›®"&gt;åœºæ™¯ï¼šSpring Boot + MyBatis é¡¹ç›®
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// å¯åŠ¨ç±»ï¼šæ‰¹é‡æ‰«æ Mapper åŒ…
@SpringBootApplication
@MapperScan(&amp;#34;com.example.mapper&amp;#34;) // å¿…é¡»äºŒé€‰ä¸€
public class App { ... }
// Mapper æ¥å£ï¼šå¯é€‰æ·»åŠ  @Repository
@Repository // æ¶ˆé™¤è­¦å‘Š + å¼‚å¸¸è½¬æ¢ï¼ˆå¯é€‰ï¼‰
public interface UserMapper {
@Select(&amp;#34;SELECT * FROM user WHERE id = #{id}&amp;#34;)
User getUserById(int id);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="é…ç½®æ–‡ä»¶applicationproperties"&gt;é…ç½®æ–‡ä»¶ï¼ˆ&lt;code&gt;application.properties&lt;/code&gt;ï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# æŒ‡å®š XML æ–‡ä»¶ä½ç½®ï¼ˆè‹¥ä½¿ç”¨ XML è€Œéæ³¨è§£ï¼‰
mybatis.mapper-locations=classpath:mapper/*.xml
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆ &lt;code&gt;@Autowired&lt;/code&gt;æ³¨å…¥ Mapper ä¼šæŠ¥çº¢ï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æœªæ·»åŠ  &lt;code&gt;@Repository&lt;/code&gt;æ—¶ï¼ŒSpring æ— æ³•åœ¨ç¼–è¯‘æœŸè¯†åˆ« MyBatis åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ Beanï¼ˆè¿è¡Œæ—¶æ­£å¸¸ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Repository&lt;/code&gt;æ˜¯å¦å½±å“ MyBatis ä»£ç†ï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä¼šã€‚MyBatis ä¼˜å…ˆé€šè¿‡ &lt;code&gt;@Mapper&lt;/code&gt;/&lt;code&gt;@MapperScan&lt;/code&gt;ç”Ÿæˆä»£ç†ï¼Œ&lt;code&gt;@Repository&lt;/code&gt;ä»…ä½œä¸º Spring Bean æ ‡è¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¯ MyBatis é¡¹ç›®ï¼ˆæ—  Springï¼‰å¦‚ä½•é…ç½®ï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åªéœ€ç”¨ &lt;code&gt;@Mapper&lt;/code&gt;ï¼Œæ— éœ€ &lt;code&gt;@Repository&lt;/code&gt;ï¼ˆåè€…æ˜¯ Spring ç‰¹æœ‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Spring Boot + MyBatis&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@MapperScan&lt;/code&gt;+ &lt;code&gt;@Repository&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¿å…è­¦å‘Šã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€ç¬¦åˆåˆ†å±‚è§„èŒƒã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å°å‹é¡¹ç›®/ç®€åŒ–é…ç½®&lt;/td&gt;
&lt;td&gt;ä»… &lt;code&gt;@MapperScan&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å‡å°‘æ³¨è§£å†—ä½™ï¼Œæ¥å— IDE è­¦å‘Šã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é Spring é¡¹ç›®ï¼ˆçº¯ MyBatisï¼‰&lt;/td&gt;
&lt;td&gt;ä»… &lt;code&gt;@Mapper&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ—  Spring ä¾èµ–ï¼Œè½»é‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åˆç†é€‰æ‹©æ³¨è§£ç»„åˆï¼Œæ—¢èƒ½æå‡å¼€å‘ä½“éªŒï¼Œåˆèƒ½ç¡®ä¿é¡¹ç›®è§„èŒƒæ€§ä¸å¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;h2 id="repository"&gt;@Repository
&lt;/h2&gt;&lt;p&gt;åœ¨ MyBatis ä¸ Spring/Spring Boot æ•´åˆçš„é¡¹ç›®ä¸­ï¼Œ&lt;strong&gt;å¯ä»¥åŒæ—¶ä½¿ç”¨ &lt;code&gt;@Mapper&lt;/code&gt;å’Œ &lt;code&gt;@Repository&lt;/code&gt;æ³¨è§£&lt;/strong&gt;ï¼Œä¸”è¿™ç§ç»„åˆæ˜¯å¸¸è§ä¸”æ¨èçš„å®è·µã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æå’Œä½¿ç”¨å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-äºŒè€…å¯ä»¥å…±å­˜çš„åŸå› "&gt;âœ… 1. &lt;strong&gt;äºŒè€…å¯ä»¥å…±å­˜çš„åŸå› &lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èŒè´£äº’è¡¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Mapper&lt;/code&gt;ï¼ˆMyBatis æä¾›ï¼‰ï¼šæ ‡è¯†æ¥å£ä¸º MyBatis Mapperï¼Œ&lt;strong&gt;åŠ¨æ€ç”Ÿæˆä»£ç†å®ç°ç±»&lt;/strong&gt;ï¼Œæ‰§è¡Œ SQL æ˜ å°„é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Repository&lt;/code&gt;ï¼ˆSpring æä¾›ï¼‰ï¼šå°†æ¥å£å£°æ˜ä¸º Spring Beanï¼Œ&lt;strong&gt;è§£å†³ IDE çš„ä¾èµ–æ³¨å…¥è­¦å‘Š&lt;/strong&gt;ï¼Œå¹¶å¯ç”¨ Spring çš„&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸è½¬æ¢æœºåˆ¶&lt;/strong&gt;ï¼ˆå°† JDBCã€MyBatis ç­‰åŸç”Ÿå¼‚å¸¸è½¬ä¸º &lt;code&gt;DataAccessException&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— å†²çª&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;MyBatis ä¼˜å…ˆé€šè¿‡ &lt;code&gt;@Mapper&lt;/code&gt;ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œ&lt;code&gt;@Repository&lt;/code&gt;ä»…ä½œä¸º Spring Bean çš„æ ‡è¯†ï¼ŒäºŒè€…ååŒå·¥ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-åŒæ—¶ä½¿ç”¨çš„å¥½å¤„"&gt;ğŸ’¡ 2. &lt;strong&gt;åŒæ—¶ä½¿ç”¨çš„å¥½å¤„&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆé™¤ IDE è­¦å‘Š&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä»…ç”¨ &lt;code&gt;@Mapper&lt;/code&gt;æ—¶ï¼ŒSpring åœ¨ç¼–è¯‘æœŸæ— æ³•è¯†åˆ«åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ Beanï¼Œå¯¼è‡´ IDE æç¤ºâ€œæ— æ³•æ³¨å…¥â€çš„çº¢è‰²è­¦å‘Šï¼ˆå¦‚ &lt;code&gt;Could not autowire&lt;/code&gt;ï¼‰ï¼Œä½†å®é™…è¿è¡Œæ­£å¸¸ã€‚æ·»åŠ  &lt;code&gt;@Repository&lt;/code&gt;å¯æ˜¾å¼å£°æ˜ Beanï¼Œæ¶ˆé™¤è­¦å‘Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨å¼‚å¸¸ç»Ÿä¸€å¤„ç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Repository&lt;/code&gt;è§¦å‘ Spring çš„å¼‚å¸¸è½¬æ¢æœºåˆ¶ï¼Œé¿å…ä¸šåŠ¡å±‚ç›´æ¥å¤„ç†åº•å±‚æ•°æ®åº“å¼‚å¸¸ï¼ˆå¦‚ SQLExceptionï¼‰ï¼Œæå‡ä»£ç å¥å£®æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜ç¡®åˆ†å±‚èŒè´£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç¬¦åˆåˆ†å±‚æ¶æ„è§„èŒƒï¼ˆController â†’ Service â†’ Repositoryï¼‰ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-3-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ 3. &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Mapper&lt;/code&gt;æ˜¯å¿…éœ€çš„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥çœç•¥ &lt;code&gt;@Mapper&lt;/code&gt;ï¼ŒMyBatis æ— æ³•è¯†åˆ«æ¥å£ï¼Œå¯¼è‡´ SQL æ˜ å°„å¤±æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ &lt;code&gt;@MapperScan&lt;/code&gt;æ‰¹é‡æ‰«æåŒ…è·¯å¾„ï¼Œé¿å…åœ¨æ¯ä¸ªæ¥å£ä¸Šå•ç‹¬æ·»åŠ  &lt;code&gt;@Mapper&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Repository&lt;/code&gt;éœ€é…åˆç»„ä»¶æ‰«æ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç¡®ä¿ Spring æ‰«æåˆ° Mapper æ¥å£æ‰€åœ¨åŒ…ï¼ˆå¦‚å¯åŠ¨ç±»æ·»åŠ  &lt;code&gt;@ComponentScan&lt;/code&gt;æˆ– &lt;code&gt;@SpringBootApplication&lt;/code&gt;é»˜è®¤æ‰«æå½“å‰åŒ…ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…ç”¨äºå®ç°ç±»&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Repository&lt;/code&gt;åº”æ ‡æ³¨åœ¨ &lt;strong&gt;Mapper æ¥å£&lt;/strong&gt;ä¸Šï¼Œè€Œéå®ç°ç±»ï¼ˆMyBatis åŠ¨æ€ä»£ç†ç”Ÿæˆå®ç°ç±»ï¼Œæ‰‹åŠ¨å®ç°ç±»ä¼šå¯¼è‡´å†²çªï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-4-ä»£ç ç¤ºä¾‹"&gt;ğŸ› ï¸ 4. &lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// Mapper æ¥å£ï¼šåŒæ—¶ä½¿ç”¨ @Mapper + @Repository
@Repository
@Mapper
public interface UserMapper {
@Select(&amp;#34;SELECT * FROM user WHERE id = #{id}&amp;#34;)
User findById(int id);
}
// Service å±‚ï¼šæ³¨å…¥ Mapper
@Service
public class UserService {
@Autowired
private UserMapper userMapper; // æ—  IDE è­¦å‘Šï¼Œä¸”æ”¯æŒå¼‚å¸¸è½¬æ¢
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-5-æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”"&gt;âš–ï¸ 5. &lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;æ˜¯å¦å¿…éœ€&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@Mapper&lt;/code&gt;+ &lt;code&gt;@Repository&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;æ¶ˆé™¤è­¦å‘Šã€å¼‚å¸¸è½¬æ¢ã€åˆ†å±‚æ˜ç¡®&lt;/td&gt;
&lt;td&gt;éœ€æ¯ä¸ªæ¥å£æ ‡æ³¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»… &lt;code&gt;@Mapper&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æœ€å°åŒ–é…ç½®&lt;/td&gt;
&lt;td&gt;IDE è­¦å‘Šï¼ˆè¿è¡Œæ­£å¸¸ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;@MapperScan&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æ‰¹é‡æ‰«æï¼Œé¿å…é‡å¤æ³¨è§£&lt;/td&gt;
&lt;td&gt;ä»å¯èƒ½éœ€ &lt;code&gt;@Repository&lt;/code&gt;æ¶ˆè­¦å‘Š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å»ºè®®-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨èç»„åˆ&lt;/strong&gt;ï¼š&lt;code&gt;@Mapper&lt;/code&gt;+ &lt;code&gt;@Repository&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é€‚ç”¨äºæ‰€æœ‰ Spring + MyBatis é¡¹ç›®ï¼Œå…¼é¡¾åŠŸèƒ½æ€§ä¸å¼€å‘ä½“éªŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç®€åŒ–æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å‹é¡¹ç›®ï¼šä»…ç”¨ &lt;code&gt;@Mapper&lt;/code&gt;ï¼ˆæ¥å— IDE è­¦å‘Šï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸­å¤§å‹é¡¹ç›®ï¼š&lt;code&gt;@MapperScan&lt;/code&gt;+ &lt;code&gt;@Repository&lt;/code&gt;ï¼ˆæ‰¹é‡æ‰«æ + æ¶ˆé™¤è­¦å‘Šï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š&lt;code&gt;@Mapper&lt;/code&gt;ç¡®ä¿ MyBatis åŠŸèƒ½ï¼Œ&lt;code&gt;@Repository&lt;/code&gt;ä¼˜åŒ– Spring æ•´åˆä½“éªŒï¼ŒäºŒè€…ååŒæ— å†²çªä¸”æå‡ä»£ç è´¨é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="mybatis-plus"&gt;MyBatis Plus
&lt;/h2&gt;&lt;p&gt;åœ¨ MyBatisï¼ˆå°¤å…¶æ˜¯å…¶å¢å¼ºæ¡†æ¶ MyBatis-Plusï¼‰ä¸­ï¼Œä¸åŒå±‚çº§çš„ç±»éœ€è¦ç»§æ‰¿ç‰¹å®šæ¥å£ä»¥å®ç°åŸºç¡€åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒæ¥å£çš„ç»§æ‰¿è§„åˆ™åŠä½œç”¨ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-mapper-å±‚æ¥å£dao-å±‚"&gt;ğŸ”§ &lt;strong&gt;1. Mapper å±‚æ¥å£ï¼ˆDAO å±‚ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»§æ‰¿ &lt;code&gt;BaseMapper&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;code&gt;UserMapper extends BaseMapper&amp;lt;User&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šè‡ªåŠ¨è·å¾—å•è¡¨ CRUD æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;selectById&lt;/code&gt;ã€&lt;code&gt;insert&lt;/code&gt;ã€&lt;code&gt;update&lt;/code&gt;ç­‰ï¼‰ï¼Œæ— éœ€ç¼–å†™ SQL æˆ– XML æ˜ å°„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ³›å‹ &lt;code&gt;T&lt;/code&gt;éœ€æŒ‡å®šå¯¹åº”çš„å®ä½“ç±»ï¼ˆå¦‚ &lt;code&gt;User&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Mapper
public interface UserMapper extends BaseMapper&amp;lt;User&amp;gt; {
// å¯æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•
List&amp;lt;User&amp;gt; selectByName(String name);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-service-å±‚æ¥å£ä¸å®ç°ç±»"&gt;âš™ï¸ &lt;strong&gt;2. Service å±‚æ¥å£ä¸å®ç°ç±»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Service æ¥å£&lt;/strong&gt;ï¼š&lt;strong&gt;ç»§æ‰¿ &lt;code&gt;IService&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;code&gt;UserService extends IService&amp;lt;User&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚æ‰¹é‡æ“ä½œã€äº‹åŠ¡ç®¡ç†ï¼‰ï¼Œæä¾›æ›´è¯­ä¹‰åŒ–çš„ APIï¼ˆå¦‚ &lt;code&gt;saveBatch&lt;/code&gt;ã€&lt;code&gt;removeById&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServiceImpl å®ç°ç±»&lt;/strong&gt;ï¼š&lt;strong&gt;ç»§æ‰¿ &lt;code&gt;ServiceImpl&amp;lt;M, T&amp;gt;&lt;/code&gt;å¹¶å®ç° Service æ¥å£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;code&gt;UserServiceImpl extends ServiceImpl&amp;lt;UserMapper, User&amp;gt; implements UserService&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;éœ€ä¼ å…¥ç»§æ‰¿ &lt;code&gt;BaseMapper&amp;lt;T&amp;gt;&lt;/code&gt;çš„ Mapper æ¥å£ï¼ˆå¦‚ &lt;code&gt;UserMapper&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T&lt;/code&gt;ä¸ºå®ä½“ç±»ï¼ˆå¦‚ &lt;code&gt;User&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;ServiceImpl&lt;/code&gt;è‡ªåŠ¨å®ç° &lt;code&gt;IService&lt;/code&gt;ä¸­çš„æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;save()&lt;/code&gt;å†…éƒ¨è°ƒç”¨ &lt;code&gt;baseMapper.insert()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-åŸºç¡€-mybatis-æ¡†æ¶çš„æ‰©å±•"&gt;ğŸ“ &lt;strong&gt;3. åŸºç¡€ MyBatis æ¡†æ¶çš„æ‰©å±•&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è‹¥ä¸ä½¿ç”¨ MyBatis-Plusï¼ŒMapper æ¥å£&lt;strong&gt;æ— éœ€å¼ºåˆ¶ç»§æ‰¿æ¥å£&lt;/strong&gt;ï¼Œä½†éœ€éµå¾ªè§„èŒƒï¼š
&lt;ul&gt;
&lt;li&gt;XML æ–‡ä»¶çš„ &lt;code&gt;namespace&lt;/code&gt;éœ€ä¸ Mapper æ¥å£å…¨é™å®šåä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•åä¸ XML ä¸­ SQL è¯­å¥çš„ &lt;code&gt;id&lt;/code&gt;åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯è‡ªå®šä¹‰åŸºç¡€æ¥å£ï¼ˆå¦‚ &lt;code&gt;BaseMapper&lt;/code&gt;ï¼‰å¤ç”¨é€šç”¨æ–¹æ³•ï¼Œä½†éœ€æ‰‹åŠ¨å®ç° SQL æ˜ å°„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ç»§æ‰¿æ¥å£çš„æ ¸å¿ƒåœºæ™¯"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šç»§æ‰¿æ¥å£çš„æ ¸å¿ƒåœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å±‚çº§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;éœ€ç»§æ‰¿çš„æ¥å£/ç±»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Mapper æ¥å£&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BaseMapper&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨ç”Ÿæˆå•è¡¨ CRUD SQL&lt;/td&gt;
&lt;td&gt;&lt;code&gt;UserMapper extends BaseMapper&amp;lt;User&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service æ¥å£&lt;/td&gt;
&lt;td&gt;&lt;code&gt;IService&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®šä¹‰ä¸šåŠ¡æ–¹æ³•ï¼ˆæ‰¹é‡ã€äº‹åŠ¡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;UserService extends IService&amp;lt;User&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Service å®ç°ç±»&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ServiceImpl&amp;lt;M, T&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å®ç° &lt;code&gt;IService&lt;/code&gt;å¹¶ä»£ç† Mapper æ“ä½œ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;UserServiceImpl extends ServiceImpl&amp;lt;UserMapper, User&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è·¨å±‚è°ƒç”¨&lt;/strong&gt;ï¼šService å±‚åº”å°è£…ä¸šåŠ¡é€»è¾‘ï¼ŒController å±‚ä¸åº”ç›´æ¥è°ƒç”¨ &lt;code&gt;BaseMapper&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰æ‰©å±•&lt;/strong&gt;ï¼šè‹¥éœ€å¤šè¡¨è”æŸ¥æˆ–å¤æ‚ SQLï¼Œå¯åœ¨ Mapper æ¥å£ä¸­å®šä¹‰æ–¹æ³•å¹¶é…åˆ XML/æ³¨è§£å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼šæ¶‰åŠå¤šè¡¨æ“ä½œæ—¶ï¼Œåœ¨ Service å±‚ä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ç»§æ‰¿ä¸Šè¿°æ¥å£ï¼ŒMyBatis-Plus å¯å¤§å¹…å‡å°‘é‡å¤ä»£ç ï¼Œè€ŒåŸç”Ÿ MyBatis éœ€æ›´å¤šæ‰‹åŠ¨é…ç½®ï¼Œä½†çµæ´»æ€§æ›´é«˜ã€‚&lt;/p&gt;
&lt;h2 id="select"&gt;@Select
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@Select&lt;/code&gt;ã€&lt;code&gt;@Insert&lt;/code&gt;ã€&lt;code&gt;@Update&lt;/code&gt;ã€&lt;code&gt;@Delete&lt;/code&gt;ç­‰æ³¨è§£æ˜¯ &lt;strong&gt;MyBatis åŸç”Ÿæä¾›çš„æ³¨è§£&lt;/strong&gt;ï¼Œå¹¶é MyBatis-Plus çš„æ‰©å±•åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å…³é”®åŒºåˆ†ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-æ³¨è§£æ¥æº"&gt;ğŸ§© 1. &lt;strong&gt;æ³¨è§£æ¥æº&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyBatis åŸç”Ÿæ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Select&lt;/code&gt;ã€&lt;code&gt;@Insert&lt;/code&gt;ã€&lt;code&gt;@Update&lt;/code&gt;ã€&lt;code&gt;Delete&lt;/code&gt;ã€&lt;code&gt;@Results&lt;/code&gt;ã€&lt;code&gt;@Result&lt;/code&gt;ã€&lt;code&gt;@Param&lt;/code&gt;ã€&lt;code&gt;@Options&lt;/code&gt;ç­‰å‡å±äº MyBatis æ ¸å¿ƒåŒ… &lt;code&gt;org.apache.ibatis.annotations&lt;/code&gt;ä¸­å®šä¹‰çš„æ³¨è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç”¨äºç›´æ¥åœ¨ Mapper æ¥å£æ–¹æ³•ä¸Šç¼–å†™ SQLï¼Œæ›¿ä»£ XML é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyBatis-Plus æ‰©å±•æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@TableName&lt;/code&gt;ã€&lt;code&gt;@TableId&lt;/code&gt;ã€&lt;code&gt;@TableField&lt;/code&gt;ã€&lt;code&gt;@TableLogic&lt;/code&gt;ã€&lt;code&gt;@Version&lt;/code&gt;ç­‰æ˜¯ MyBatis-Plus ç‰¹æœ‰çš„æ³¨è§£ï¼Œç”¨äºå¢å¼ºå®ä½“ç±»ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„ã€ä¸»é”®ç­–ç•¥ã€é€»è¾‘åˆ é™¤ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-åŠŸèƒ½å®šä½"&gt;âš™ï¸ 2. &lt;strong&gt;åŠŸèƒ½å®šä½&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyBatis åŸç”Ÿæ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æä¾›åŸºç¡€çš„ SQL æ“ä½œèƒ½åŠ›ï¼Œæ”¯æŒè‡ªå®šä¹‰ SQL è¯­å¥ï¼ˆé™æ€æˆ–åŠ¨æ€ï¼‰ï¼Œä½†éœ€æ‰‹åŠ¨ç¼–å†™å®Œæ•´ SQLã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT * FROM user WHERE name = #{name}&amp;#34;)
User findByName(@Param(&amp;#34;name&amp;#34;) String name);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyBatis-Plus æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¸“æ³¨äºç®€åŒ–å¼€å‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@TableName&lt;/code&gt;ï¼šå®ä½“ç±»ä¸è¡¨åæ˜ å°„ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@TableId&lt;/code&gt;ï¼šä¸»é”®ç­–ç•¥ï¼ˆå¦‚è‡ªå¢ã€é›ªèŠ±ç®—æ³•ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@TableField&lt;/code&gt;ï¼šå­—æ®µæ˜ å°„ä¸éè¡¨å­—æ®µæ’é™¤ï¼ˆ&lt;code&gt;exist = false&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@TableLogic&lt;/code&gt;ï¼šé€»è¾‘åˆ é™¤æ ‡è®°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-ååŒä½¿ç”¨åœºæ™¯"&gt;ğŸ”„ 3. &lt;strong&gt;ååŒä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;MyBatis-Plus å…¼å®¹ MyBatis åŸç”Ÿæ³¨è§£ï¼Œå®è·µä¸­å¸¸&lt;strong&gt;ç»„åˆä½¿ç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šMapper æ¥å£ç»§æ‰¿ &lt;code&gt;BaseMapper&lt;/code&gt;ï¼ˆMyBatis-Plusï¼‰çš„åŒæ—¶ï¼Œç”¨ &lt;code&gt;@Select&lt;/code&gt;ç¼–å†™å¤æ‚æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface UserMapper extends BaseMapper&amp;lt;User&amp;gt; {
@Select(&amp;#34;SELECT * FROM user WHERE age &amp;gt; #{age}&amp;#34;)
List&amp;lt;User&amp;gt; selectByAge(@Param(&amp;#34;age&amp;#34;) int age);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤å¤„ &lt;code&gt;BaseMapper&lt;/code&gt;æä¾›é€šç”¨ CRUD æ–¹æ³•ï¼Œ&lt;code&gt;@Select&lt;/code&gt;è¡¥å……è‡ªå®šä¹‰ SQLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-åŠ¨æ€-sql-æ”¯æŒ"&gt;ğŸ’ 4. &lt;strong&gt;åŠ¨æ€ SQL æ”¯æŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyBatis åŸç”Ÿæ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;@SelectProvider&lt;/code&gt;ã€&lt;code&gt;@UpdateProvider&lt;/code&gt;ç­‰å®ç°åŠ¨æ€ SQLï¼ˆéœ€é…åˆå·¥å…·ç±»ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyBatis-Plus æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æä¾› &lt;code&gt;QueryWrapper&lt;/code&gt;/&lt;code&gt;LambdaQueryWrapper&lt;/code&gt;é“¾å¼æ„é€ æ¡ä»¶ï¼Œæ— éœ€æ‰‹å†™ SQLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ€»ç»“"&gt;ğŸ“Š æ ¸å¿ƒæ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;ä»£è¡¨æ³¨è§£&lt;/th&gt;
&lt;th&gt;å½’å±æ¡†æ¶&lt;/th&gt;
&lt;th&gt;ä¸»è¦ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MyBatis åŸç”Ÿ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Select&lt;/code&gt;, &lt;code&gt;@Insert&lt;/code&gt;, &lt;code&gt;@Results&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;MyBatis&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰ SQL ä¸ç»“æœæ˜ å°„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MyBatis-Plus æ‰©å±•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@TableName&lt;/code&gt;, &lt;code&gt;@TableId&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;MyBatis-Plus&lt;/td&gt;
&lt;td&gt;è¡¨/å­—æ®µæ˜ å°„ã€ä¸»é”®ç­–ç•¥ã€é€»è¾‘åˆ é™¤ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Select&lt;/code&gt;ç­‰ SQL æ“ä½œæ³¨è§£å±äº &lt;strong&gt;MyBatis&lt;/strong&gt;ï¼Œè€Œ MyBatis-Plus åœ¨å…¶åŸºç¡€ä¸Šæ‰©å±•äº†å®ä½“æ˜ å°„ä¸è‡ªåŠ¨åŒ–åŠŸèƒ½ã€‚ä¸¤è€…å¯æ— ç¼åä½œï¼Œå…¼é¡¾çµæ´»æ€§ä¸å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å…¨é™å®šå"&gt;å…¨é™å®šå
&lt;/h2&gt;&lt;p&gt;åœ¨Javaä¸­ï¼Œ&lt;strong&gt;ç±»çš„å…¨é™å®šåï¼ˆFully Qualified Nameï¼‰&lt;/strong&gt; æ˜¯å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç±»çš„å®Œæ•´åç§°ï¼Œç”±åŒ…åï¼ˆPackage Nameï¼‰å’Œç±»åï¼ˆClass Nameï¼‰ç»„æˆï¼Œä¸­é—´ç”¨ç‚¹å·&lt;code&gt;.&lt;/code&gt;åˆ†éš”ã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯&lt;strong&gt;é¿å…å‘½åå†²çª&lt;/strong&gt;ï¼Œç¡®ä¿åœ¨å¤æ‚é¡¹ç›®ä¸­å‡†ç¡®å¼•ç”¨ç‰¹å®šç±»ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€å…¨é™å®šåçš„å®šä¹‰ä¸ç»“æ„"&gt;ğŸ“Œ &lt;strong&gt;ä¸€ã€å…¨é™å®šåçš„å®šä¹‰ä¸ç»“æ„&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¼å¼&lt;/strong&gt;ï¼š&lt;code&gt;åŒ…å.ç±»å&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;java.lang.String&lt;/code&gt;ï¼ˆJavaæ ¸å¿ƒå­—ç¬¦ä¸²ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;com.example.model.User&lt;/code&gt;ï¼ˆè‡ªå®šä¹‰ç”¨æˆ·ç±»ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒ…åçš„ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åŒ…åæœ¬è´¨æ˜¯å‘½åç©ºé—´ï¼Œé€šå¸¸æŒ‰&lt;strong&gt;åŸŸååå†™&lt;/strong&gt;ï¼ˆå¦‚&lt;code&gt;com.example&lt;/code&gt;ï¼‰ç»„ç»‡ï¼Œé˜²æ­¢ä¸åŒç»„ç»‡æˆ–é¡¹ç›®çš„ç±»åå†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ç®€å•ç±»åçš„åŒºåˆ«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç®€å•ç±»åï¼ˆå¦‚&lt;code&gt;String&lt;/code&gt;ï¼‰ä»…åŒ…å«ç±»æœ¬èº«åç§°ï¼Œè€Œå…¨é™å®šååŒ…å«å®Œæ•´è·¯å¾„ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒä¸ºä»€ä¹ˆéœ€è¦å…¨é™å®šå"&gt;âš™ï¸ &lt;strong&gt;äºŒã€ä¸ºä»€ä¹ˆéœ€è¦å…¨é™å®šåï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³å‘½åå†²çª&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å½“ä¸åŒåŒ…ä¸­å­˜åœ¨åŒåç±»æ—¶ï¼ˆå¦‚&lt;code&gt;java.util.Date&lt;/code&gt;ä¸&lt;code&gt;java.sql.Date&lt;/code&gt;ï¼‰ï¼Œå…¨é™å®šåå¯æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ï¼Œé¿å…æ­§ä¹‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;java.util.Date utilDate = new java.util.Date(); // æ˜ç¡®ä½¿ç”¨java.utilåŒ…çš„Dateç±»
java.sql.Date sqlDate = new java.sql.Date(); // æ˜ç¡®ä½¿ç”¨java.sqlåŒ…çš„Dateç±»
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ”¯æŒè·¨æ¨¡å—å¼•ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå…¨é™å®šåå…è®¸ä¸åŒæ¨¡å—ç›´æ¥å¼•ç”¨å¤–éƒ¨ç±»ï¼Œæ— éœ€æ‹…å¿ƒåŒ…ç»“æ„é‡å ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»åŠ è½½å™¨çš„ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JVMé€šè¿‡å…¨é™å®šåå®šä½&lt;code&gt;.class&lt;/code&gt;æ–‡ä»¶ã€‚ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æ ¹æ®å…¨é™å®šååœ¨ç±»è·¯å¾„ä¸­æœç´¢å¹¶åŠ è½½ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰å…¨é™å®šåçš„å®é™…åº”ç”¨åœºæ™¯"&gt;ğŸ’¡ &lt;strong&gt;ä¸‰ã€å…¨é™å®šåçš„å®é™…åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾å¼å¼•ç”¨ç±»ï¼ˆæ— importè¯­å¥ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç›´æ¥ä½¿ç”¨å…¨é™å®šåå®ä¾‹åŒ–å¯¹è±¡æˆ–è°ƒç”¨é™æ€æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;com.example.Utils.doSomething(); // ç›´æ¥é€šè¿‡å…¨é™å®šåè°ƒç”¨å·¥å…·ç±»æ–¹æ³•
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åå°„æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åå°„APIï¼ˆå¦‚&lt;code&gt;Class.forName()&lt;/code&gt;ï¼‰å¿…é¡»ä½¿ç”¨å…¨é™å®šååŠ è½½ç±»ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Class&amp;lt;?&amp;gt; clazz = Class.forName(&amp;#34;com.example.model.User&amp;#34;); // æ ¹æ®å…¨é™å®šååŠ è½½ç±»
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶ä¸æ¡†æ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring/MyBatis&lt;/strong&gt;ï¼šåœ¨XMLé…ç½®ä¸­é€šè¿‡å…¨é™å®šåå£°æ˜Beanæˆ–æ˜ å°„ç±»ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;bean class=&amp;#34;com.example.service.UserService&amp;#34;/&amp;gt; &amp;lt;!-- Spring Beané…ç½® --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JDBCé©±åŠ¨æ³¨å†Œ&lt;/strong&gt;ï¼šæ—©æœŸJDBCéœ€ç”¨&lt;code&gt;Class.forName(&amp;quot;com.mysql.jdbc.Driver&amp;quot;)&lt;/code&gt;åŠ è½½é©±åŠ¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…importå†²çª&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ä¸¤ä¸ªç±»åŒåä¸”å‡è¢«&lt;code&gt;import&lt;/code&gt;æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚æ­¤æ—¶éœ€ç”¨å…¨é™å®šåæ˜¾å¼æŒ‡å®šï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import com.library1.Utility;
import com.library2.Utility; // ç¼–è¯‘é”™è¯¯ï¼ç±»åå†²çª
// è§£å†³æ–¹æ¡ˆï¼šæ”¹ç”¨å…¨é™å®šå
com.library1.Utility.runTask();
com.library2.Utility.runTask();
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å››ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…éƒ¨ç±»çš„å…¨é™å®šå&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å†…éƒ¨ç±»çš„å…¨é™å®šåéœ€åŒ…å«å¤–éƒ¨ç±»åï¼Œæ ¼å¼ä¸º&lt;code&gt;å¤–éƒ¨ç±»å…¨é™å®šå$å†…éƒ¨ç±»å&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;com.example.Outer$Inner // å†…éƒ¨ç±»Innerçš„å…¨é™å®šå
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸æ–‡ä»¶è·¯å¾„çš„å…³è”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç±»æ–‡ä»¶åœ¨é¡¹ç›®ä¸­çš„ç‰©ç†è·¯å¾„éœ€ä¸å…¨é™å®šååŒ¹é…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¨é™å®šåï¼š&lt;code&gt;com.example.MyClass&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶è·¯å¾„ï¼š&lt;code&gt;src/main/java/com/example/MyClass.java&lt;/code&gt;ï¼ˆMavenæ ‡å‡†ç›®å½•ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;IDEä¸æ„å»ºå·¥å…·çš„ç®€åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IDE&lt;/strong&gt;ï¼šè‡ªåŠ¨ç®¡ç†&lt;code&gt;import&lt;/code&gt;è¯­å¥ï¼Œå¼€å‘è€…é€šå¸¸åªéœ€å†™ç®€å•ç±»åã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Maven/Gradle&lt;/strong&gt;ï¼šä¾èµ–ç®¡ç†è‡ªåŠ¨å¤„ç†ç±»è·¯å¾„ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å…¨é™å®šåã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç±»çš„å…¨é™å®šåæ˜¯JavaåŒ…æœºåˆ¶çš„æ ¸å¿ƒè®¾è®¡ï¼Œé€šè¿‡**â€œåŒ…å+ç±»åâ€** çš„ç»“æ„ç¡®ä¿ç±»å…¨å±€å”¯ä¸€ã€‚å®ƒåœ¨è§£å†³å‘½åå†²çªã€æ”¯æŒåå°„ã€æ¡†æ¶é…ç½®ç­‰åœºæ™¯ä¸­ä¸å¯æˆ–ç¼ºã€‚å®é™…å¼€å‘ä¸­ï¼Œå°½ç®¡IDEå’Œæ„å»ºå·¥å…·ç®€åŒ–äº†ä½¿ç”¨ï¼Œ&lt;strong&gt;æ·±å…¥ç†è§£å…¨é™å®šåä»æœ‰åŠ©äºè°ƒè¯•ç±»åŠ è½½é—®é¢˜ä¸è·¨æ¨¡å—åä½œ&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œå½“é‡åˆ°&lt;code&gt;ClassNotFoundException&lt;/code&gt;æ—¶ï¼Œä¼˜å…ˆæ£€æŸ¥å…¨é™å®šåæ˜¯å¦ä¸ç±»è·¯å¾„åŒ¹é…ã€‚&lt;/p&gt;
&lt;h2 id="mapper-xml"&gt;Mapper xml
&lt;/h2&gt;&lt;p&gt;è¦åˆ¤æ–­ä¸€ä¸ª XML æ–‡ä»¶æ˜¯å¦æ˜¯ MyBatis Mapper æ–‡ä»¶ï¼Œéœ€æ£€æŸ¥å…¶æ˜¯å¦ç¬¦åˆä»¥ä¸‹æ ¸å¿ƒç‰¹å¾å’Œè§„èŒƒï¼ˆæŒ‰é‡è¦æ€§æ’åºï¼‰ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€å¿…å¤‡ç»“æ„ç‰¹å¾"&gt;ğŸ” &lt;strong&gt;ä¸€ã€å¿…å¤‡ç»“æ„ç‰¹å¾&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¹æ ‡ç­¾ &lt;code&gt;&amp;lt;mapper&amp;gt;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶å¿…é¡»åŒ…å« &lt;code&gt;&amp;lt;mapper&amp;gt;&lt;/code&gt;ä½œä¸ºæ ¹æ ‡ç­¾ï¼Œä¸”å…¶ &lt;code&gt;namespace&lt;/code&gt;å±æ€§éœ€æŒ‡å‘ä¸€ä¸ª Java Mapper æ¥å£çš„&lt;strong&gt;å…¨é™å®šç±»å&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;namespace=&amp;quot;com.example.UserMapper&amp;quot;&lt;/code&gt;ï¼‰ã€‚è¿™æ˜¯ MyBatis ç»‘å®šæ¥å£ä¸ XML çš„å…³é”®æ ‡è¯†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç¤ºä¾‹&lt;/em&gt;ï¼š&lt;code&gt;&amp;lt;mapper namespace=&amp;quot;com.example.mapper.UserMapper&amp;quot;&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SQL æ“ä½œæ ‡ç­¾&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶å†…éœ€åŒ…å«è‡³å°‘ä¸€ä¸ª SQL æ“ä½œæ ‡ç­¾ï¼ˆ&lt;code&gt;&amp;lt;select&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;insert&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;update&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;delete&amp;gt;&lt;/code&gt;ï¼‰ï¼Œä¸”æ¯ä¸ªæ ‡ç­¾å¿…é¡»åŒ…å« &lt;strong&gt;&lt;code&gt;id&lt;/code&gt;å±æ€§&lt;/strong&gt;ï¼Œå…¶å€¼éœ€ä¸ Mapper æ¥å£ä¸­çš„&lt;strong&gt;æ–¹æ³•åå®Œå…¨ä¸€è‡´&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç¤ºä¾‹&lt;/em&gt;ï¼š&lt;code&gt;&amp;lt;select id=&amp;quot;getUserById&amp;quot; resultType=&amp;quot;User&amp;quot;&amp;gt; ... &amp;lt;/select&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DOCTYPE å£°æ˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ–‡ä»¶å¤´éƒ¨éœ€åŒ…å« MyBatis ä¸“ç”¨çš„æ–‡æ¡£ç±»å‹å£°æ˜ï¼ŒæŒ‡å‘å®˜æ–¹ DTD æˆ– XSDï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;!DOCTYPE mapper PUBLIC &amp;#34;-//mybatis.org//DTD Mapper 3.0//EN&amp;#34;
&amp;#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;#34;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤å£°æ˜æ˜¯ MyBatis Mapper æ–‡ä»¶çš„&lt;strong&gt;æ ‡å‡†èº«ä»½æ ‡è¯†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒè¾…åŠ©åˆ¤æ–­ç‰¹å¾"&gt;ğŸ§© &lt;strong&gt;äºŒã€è¾…åŠ©åˆ¤æ–­ç‰¹å¾&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°ä¸ç»“æœç»‘å®šè¯­æ³•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;SQL è¯­å¥ä¸­åº”ä½¿ç”¨ MyBatis ç‰¹æœ‰çš„å‚æ•°å ä½ç¬¦ï¼ˆå¦‚ &lt;code&gt;#{id}&lt;/code&gt;æˆ–åŠ¨æ€ &lt;code&gt;${field}&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»“æœæ˜ å°„å¯èƒ½é€šè¿‡ &lt;code&gt;resultType&lt;/code&gt;ï¼ˆç®€å•ç±»å‹ï¼‰æˆ– &lt;code&gt;resultMap&lt;/code&gt;ï¼ˆå¤æ‚å¯¹è±¡ï¼‰å®šä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ SQL æ ‡ç­¾&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥åŒ…å«å¤æ‚é€»è¾‘ï¼Œæ–‡ä»¶å¯èƒ½ä½¿ç”¨ MyBatis åŠ¨æ€ SQL æ ‡ç­¾ï¼ˆå¦‚ &lt;code&gt;&amp;lt;if&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;foreach&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;choose&amp;gt;&lt;/code&gt;ï¼‰ï¼Œç”¨äºæ¡ä»¶åˆ†æ”¯æˆ–å¾ªç¯æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡ä»¶å‘½åä¸è·¯å¾„è§„èŒƒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶åé€šå¸¸ä¸ Mapper æ¥å£åŒåï¼ˆå¦‚ &lt;code&gt;UserMapper.java&lt;/code&gt;å¯¹åº” &lt;code&gt;UserMapper.xml&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Maven/Gradle é¡¹ç›®ä¸­ï¼Œæ–‡ä»¶éœ€ä½äº &lt;code&gt;src/main/resources&lt;/code&gt;ä¸‹ï¼Œä¸”è·¯å¾„ä¸æ¥å£åŒ…åä¸€è‡´ï¼ˆå¦‚ &lt;code&gt;com/example/mapper/UserMapper.xml&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœæ˜ å°„å®šä¹‰ï¼ˆ&lt;code&gt;&amp;lt;resultMap&amp;gt;&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¤æ‚æŸ¥è¯¢å¯èƒ½åŒ…å« &lt;code&gt;&amp;lt;resultMap&amp;gt;&lt;/code&gt;æ ‡ç­¾ï¼Œå®šä¹‰æ•°æ®åº“åˆ—ä¸ Java å¯¹è±¡å±æ€§çš„æ˜ å°„å…³ç³»ï¼Œå°¤å…¶æ¶‰åŠå…³è”å¯¹è±¡ï¼ˆ&lt;code&gt;&amp;lt;association&amp;gt;&lt;/code&gt;ï¼‰æˆ–é›†åˆï¼ˆ&lt;code&gt;&amp;lt;collection&amp;gt;&lt;/code&gt;ï¼‰æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰å®Œæ•´ç¤ºä¾‹ç»“æ„"&gt;ğŸ“‹ &lt;strong&gt;ä¸‰ã€å®Œæ•´ç¤ºä¾‹ç»“æ„&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;!DOCTYPE mapper PUBLIC &amp;#34;-//mybatis.org//DTD Mapper 3.0//EN&amp;#34;
&amp;#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;#34;&amp;gt;
&amp;lt;mapper namespace=&amp;#34;com.example.mapper.UserMapper&amp;#34;&amp;gt;
&amp;lt;!-- ç®€å•æŸ¥è¯¢ --&amp;gt;
&amp;lt;select id=&amp;#34;getUserById&amp;#34; resultType=&amp;#34;User&amp;#34;&amp;gt;
SELECT * FROM user WHERE id = #{id}
&amp;lt;/select&amp;gt;
&amp;lt;!-- åŠ¨æ€SQL --&amp;gt;
&amp;lt;select id=&amp;#34;findUsers&amp;#34; resultMap=&amp;#34;UserResultMap&amp;#34;&amp;gt;
SELECT * FROM user
&amp;lt;where&amp;gt;
&amp;lt;if test=&amp;#34;name != null&amp;#34;&amp;gt;AND name LIKE #{name}&amp;lt;/if&amp;gt;
&amp;lt;if test=&amp;#34;role != null&amp;#34;&amp;gt;AND role = #{role}&amp;lt;/if&amp;gt;
&amp;lt;/where&amp;gt;
&amp;lt;/select&amp;gt;
&amp;lt;!-- ç»“æœæ˜ å°„ --&amp;gt;
&amp;lt;resultMap id=&amp;#34;UserResultMap&amp;#34; type=&amp;#34;User&amp;#34;&amp;gt;
&amp;lt;id property=&amp;#34;id&amp;#34; column=&amp;#34;id&amp;#34;/&amp;gt;
&amp;lt;result property=&amp;#34;name&amp;#34; column=&amp;#34;name&amp;#34;/&amp;gt;
&amp;lt;collection property=&amp;#34;orders&amp;#34; ofType=&amp;#34;Order&amp;#34; select=&amp;#34;getOrdersByUserId&amp;#34;/&amp;gt;
&amp;lt;/resultMap&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å››å¸¸è§æ’æŸ¥ç‚¹"&gt;âš ï¸ &lt;strong&gt;å››ã€å¸¸è§æ’æŸ¥ç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥æ–‡ä»¶ç¬¦åˆä¸Šè¿°ç‰¹å¾ä½†æœªè¢«è¯†åˆ«ï¼Œéœ€æ£€æŸ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;XML è¯­æ³•é”™è¯¯&lt;/strong&gt;ï¼šå¦‚æ ‡ç­¾æœªé—­åˆã€ç‰¹æ®Šç¬¦å·æœªè½¬ä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯å¾„æˆ–å‘½åä¸ä¸€è‡´&lt;/strong&gt;ï¼šç¡®ä¿ XML æ–‡ä»¶ä¸æ¥å£çš„&lt;strong&gt;åŒ…è·¯å¾„ã€æ–‡ä»¶åã€namespace&lt;/strong&gt; å®Œå…¨åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æœªåŠ è½½&lt;/strong&gt;ï¼šåœ¨ Spring Boot ä¸­éœ€éªŒè¯ &lt;code&gt;mybatis.mapper-locations&lt;/code&gt;æ˜¯å¦åŒ…å«è¯¥æ–‡ä»¶è·¯å¾„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šç‰¹å¾ç»¼åˆåˆ¤æ–­ï¼Œå¯æ˜ç¡®è¯†åˆ« MyBatis Mapper XML æ–‡ä»¶ã€‚å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®ä½¿ç”¨ &lt;strong&gt;MyBatisX æ’ä»¶&lt;/strong&gt;ï¼ˆIDEAï¼‰ï¼Œé€šè¿‡ ğŸ¦ å›¾æ ‡è·³è½¬æ¥å£ä¸ XMLï¼Œè¿›ä¸€æ­¥éªŒè¯å…³è”æ€§ã€‚&lt;/p&gt;
&lt;h2 id="mybatis-å¸¸ç”¨æ³¨è§£"&gt;MyBatis å¸¸ç”¨æ³¨è§£
&lt;/h2&gt;&lt;p&gt;MyBatis æ”¯æŒé€šè¿‡æ³¨è§£æ–¹å¼æ›¿ä»£ XML é…ç½®ï¼Œç®€åŒ– SQL æ˜ å°„çš„å¼€å‘ã€‚ä»¥ä¸‹æ˜¯æ‰€æœ‰æ”¯æŒçš„æ³¨è§£åˆ†ç±»åŠè¯¦ç»†è¯´æ˜ï¼Œç»“åˆåŠŸèƒ½ã€ä½¿ç”¨åœºæ™¯å’Œç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€åŸºç¡€-crud-æ³¨è§£"&gt;ğŸ“Œ &lt;strong&gt;ä¸€ã€åŸºç¡€ CRUD æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Select&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰æŸ¥è¯¢ SQLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT * FROM users WHERE id = #{id}&amp;#34;)
User getUserById(@Param(&amp;#34;id&amp;#34;) Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Insert&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰æ’å…¥ SQLï¼Œæ”¯æŒä¸»é”®å›å¡«ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Insert(&amp;#34;INSERT INTO users(name, age) VALUES(#{name}, #{age})&amp;#34;)
@Options(useGeneratedKeys = true, keyProperty = &amp;#34;id&amp;#34;)
int insertUser(User user);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Update&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰æ›´æ–° SQLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Update(&amp;#34;UPDATE users SET name = #{name} WHERE id = #{id}&amp;#34;)
int updateUser(User user);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Delete&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå®šä¹‰åˆ é™¤ SQLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Delete(&amp;#34;DELETE FROM users WHERE id = #{id}&amp;#34;)
int deleteUserById(@Param(&amp;#34;id&amp;#34;) Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒå‚æ•°ä¸ç»“æœé›†å¤„ç†æ³¨è§£"&gt;ğŸ§© &lt;strong&gt;äºŒã€å‚æ•°ä¸ç»“æœé›†å¤„ç†æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Param&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä¸ºæ–¹æ³•å‚æ•°å‘½åï¼Œç”¨äºå¤šå‚æ•°ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT * FROM users WHERE name = #{name} AND age = #{age}&amp;#34;)
User findUser(@Param(&amp;#34;name&amp;#34;) String name, @Param(&amp;#34;age&amp;#34;) int age);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Results&lt;/code&gt;+ &lt;code&gt;@Result&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šè‡ªå®šä¹‰ç»“æœé›†æ˜ å°„ï¼ˆå­—æ®µåä¸å±æ€§åä¸ä¸€è‡´æ—¶ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT user_id, user_name FROM t_user&amp;#34;)
@Results(id = &amp;#34;userMap&amp;#34;, value = {
@Result(property = &amp;#34;id&amp;#34;, column = &amp;#34;user_id&amp;#34;, id = true),
@Result(property = &amp;#34;name&amp;#34;, column = &amp;#34;user_name&amp;#34;)
})
List&amp;lt;User&amp;gt; getAllUsers();
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@ResultMap&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå¼•ç”¨å·²å®šä¹‰çš„ &lt;code&gt;@Results&lt;/code&gt;æ˜ å°„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT * FROM t_user WHERE id = #{id}&amp;#34;)
@ResultMap(&amp;#34;userMap&amp;#34;)
User getUserById(Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@ConstructorArgs&lt;/code&gt;+ &lt;code&gt;@Arg&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šé€šè¿‡æ„é€ æ–¹æ³•æ˜ å°„ç»“æœé›†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT name, age FROM users WHERE id = #{id}&amp;#34;)
@ConstructorArgs({
@Arg(column = &amp;#34;name&amp;#34;, javaType = String.class),
@Arg(column = &amp;#34;age&amp;#34;, javaType = Integer.class)
})
User getUserById(Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰å…³è”å…³ç³»æ˜ å°„æ³¨è§£"&gt;ğŸ”— &lt;strong&gt;ä¸‰ã€å…³è”å…³ç³»æ˜ å°„æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@One&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä¸€å¯¹ä¸€å…³è”æŸ¥è¯¢ï¼ˆåµŒå¥—å­æŸ¥è¯¢ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT * FROM orders WHERE id = #{id}&amp;#34;)
@Results({
@Result(property = &amp;#34;user&amp;#34;, column = &amp;#34;user_id&amp;#34;,
one = @One(select = &amp;#34;com.example.mapper.UserMapper.getUserById&amp;#34;))
})
Order getOrderWithUser(Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Many&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä¸€å¯¹å¤šå…³è”æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT * FROM users WHERE id = #{id}&amp;#34;)
@Results({
@Result(property = &amp;#34;orders&amp;#34;, column = &amp;#34;id&amp;#34;,
many = @Many(select = &amp;#34;com.example.mapper.OrderMapper.getOrdersByUserId&amp;#34;))
})
User getUserWithOrders(Long id);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››åŠ¨æ€-sql-æä¾›è€…æ³¨è§£"&gt;âš™ï¸ &lt;strong&gt;å››ã€åŠ¨æ€ SQL æä¾›è€…æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@SelectProvider&lt;/code&gt;/ &lt;code&gt;@InsertProvider&lt;/code&gt;/ &lt;code&gt;@UpdateProvider&lt;/code&gt;/ &lt;code&gt;@DeleteProvider&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šé€šè¿‡ Java ç±»åŠ¨æ€ç”Ÿæˆ SQLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class UserSqlProvider {
public String getUserByName(String name) {
return &amp;#34;SELECT * FROM users WHERE name = #{name}&amp;#34;;
}
}
public interface UserMapper {
@SelectProvider(type = UserSqlProvider.class, method = &amp;#34;getUserByName&amp;#34;)
User findUserByName(String name);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”ç¼“å­˜ç®¡ç†æ³¨è§£"&gt;ğŸ’¾ &lt;strong&gt;äº”ã€ç¼“å­˜ç®¡ç†æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@CacheNamespace&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šåœ¨ Mapper æ¥å£å¯ç”¨äºŒçº§ç¼“å­˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@CacheNamespace(implementation = PerpetualCache.class, size = 1024)
public interface UserMapper {
@Select(&amp;#34;SELECT * FROM users WHERE id = #{id}&amp;#34;)
User getUserById(Long id);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@CacheNamespaceRef&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå¼•ç”¨å…¶ä»– Mapper çš„ç¼“å­˜é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@CacheNamespaceRef(UserMapper.class)
public interface OrderMapper { ... }
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…­å…¶ä»–å®ç”¨æ³¨è§£"&gt;âš¡ &lt;strong&gt;å…­ã€å…¶ä»–å®ç”¨æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Options&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šé…ç½® SQL æ‰§è¡Œé€‰é¡¹ï¼ˆå¦‚ä¸»é”®å›å¡«ã€è¶…æ—¶æ—¶é—´ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Insert(&amp;#34;INSERT INTO users(name) VALUES(#{name})&amp;#34;)
@Options(useGeneratedKeys = true, keyProperty = &amp;#34;id&amp;#34;, timeout = 10)
int insertUser(User user);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@SelectKey&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šè‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼ˆå¦‚æ•°æ®åº“åºåˆ—ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Insert(&amp;#34;INSERT INTO users(name) VALUES(#{name})&amp;#34;)
@SelectKey(statement = &amp;#34;SELECT LAST_INSERT_ID()&amp;#34;, keyProperty = &amp;#34;id&amp;#34;,
before = false, resultType = Long.class)
int insertUser(User user);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@MapKey&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå°†æŸ¥è¯¢ç»“æœè½¬ä¸º Mapï¼ŒæŒ‡å®š Key å­—æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Select(&amp;#34;SELECT id, name FROM users&amp;#34;)
@MapKey(&amp;#34;id&amp;#34;)
Map&amp;lt;Integer, User&amp;gt; getUserMap();
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸ƒæ³¨è§£-vs-xml-é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;ğŸ“Š &lt;strong&gt;ä¸ƒã€æ³¨è§£ vs. XML é€‚ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç®€å• CRUD æ“ä½œ&lt;/td&gt;
&lt;td&gt;æ³¨è§£&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€æ´ï¼Œå‡å°‘ XML é…ç½®é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚åŠ¨æ€ SQLï¼ˆå¤šæ¡ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;XML&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;code&gt;&amp;lt;if&amp;gt;&lt;/code&gt;/&lt;code&gt;&amp;lt;foreach&amp;gt;&lt;/code&gt;ç­‰æ ‡ç­¾ï¼Œå¯è¯»æ€§æ›´å¼º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç»“æœé›†å¤ç”¨ï¼ˆå¦‚ ResultMapï¼‰&lt;/td&gt;
&lt;td&gt;XML&lt;/td&gt;
&lt;td&gt;å…¨å±€å¤ç”¨ï¼Œé¿å…æ³¨è§£ä¸­é‡å¤å®šä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…³è”æŸ¥è¯¢ï¼ˆåµŒå¥—ç»“æœï¼‰&lt;/td&gt;
&lt;td&gt;æ³¨è§£ + XML&lt;/td&gt;
&lt;td&gt;ç®€å•å…³è”ç”¨ &lt;code&gt;@One&lt;/code&gt;/&lt;code&gt;@Many&lt;/code&gt;ï¼Œå¤æ‚åµŒå¥—ç”¨ XML&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨æ³¨è§£çš„åœºæ™¯&lt;/strong&gt;ï¼šå•è¡¨ CRUDã€ç®€å•å…³è”æŸ¥è¯¢ã€å°å‹é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ XML çš„åœºæ™¯&lt;/strong&gt;ï¼šå¤æ‚åŠ¨æ€ SQLã€éœ€è¦å¤ç”¨ SQL ç‰‡æ®µæˆ–ç»“æœæ˜ å°„ã€å¤§å‹é¡¹ç›®åä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆä½¿ç”¨å»ºè®®&lt;/strong&gt;ï¼šæ ¸å¿ƒä¸šåŠ¡ç”¨ XML ç»´æŠ¤å¤æ‚ SQLï¼Œè¾…åŠ©åŠŸèƒ½ç”¨æ³¨è§£æå‡æ•ˆç‡ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®Œæ•´æ³¨è§£åˆ—è¡¨å¯å‚è€ƒ &lt;a class="link" href="https://mybatis.org/mybatis-3/zh/java-api.html" target="_blank" rel="noopener"
&gt;MyBatis å®˜æ–¹æ–‡æ¡£&lt;/a&gt;æˆ– &lt;a class="link" href="https://github.com/mybatis/mybatis-3/tree/master/src/main/java/org/apache/ibatis/annotations" target="_blank" rel="noopener"
&gt;MyBatis æ³¨è§£æºç &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="kafkalistener"&gt;@KafkaListener
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Kafkaä¸­ï¼Œé™¤äº†ä¸»æµçš„&lt;code&gt;@KafkaListener&lt;/code&gt;æ³¨è§£ï¼Œå¼€å‘è€…è¿˜å¯ä»¥æ ¹æ®åœºæ™¯éœ€æ±‚é€‰æ‹©å…¶ä»–çµæ´»å®šä¹‰æ¶ˆè´¹è€…çš„æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å››ç§å¸¸è§çš„æ›¿ä»£æ–¹æ¡ˆåŠå…¶é€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-åŸç”Ÿkafkaconsumer-apiè½®è¯¢æ¨¡å¼"&gt;ğŸ“¦ &lt;strong&gt;1. åŸç”ŸKafkaConsumer APIè½®è¯¢æ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;KafkaConsumer&lt;/code&gt;ç±»æ‰‹åŠ¨å®ç°æ¶ˆæ¯æ‹‰å–å¾ªç¯ï¼Œé€‚ç”¨äºéœ€ç²¾ç»†æ§åˆ¶æ¶ˆè´¹é€»è¾‘æˆ–ä¸Springç‰ˆæœ¬å†²çªçš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–&lt;code&gt;KafkaConsumer&lt;/code&gt;å®ä¾‹ï¼Œé…ç½®æœåŠ¡å™¨åœ°å€ã€ååºåˆ—åŒ–å™¨ç­‰å‚æ•°ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;while(true)&lt;/code&gt;å¾ªç¯è°ƒç”¨&lt;code&gt;poll(Duration)&lt;/code&gt;æ‹‰å–æ¶ˆæ¯ï¼Œéå†å¤„ç†&lt;code&gt;ConsumerRecords&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨ç®¡ç†åç§»é‡æäº¤ï¼ˆå¦‚&lt;code&gt;commitSync()&lt;/code&gt;ï¼‰ä¸èµ„æºå…³é—­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç ç‰‡æ®µç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;KafkaConsumer&amp;lt;String, String&amp;gt; consumer = new KafkaConsumer&amp;lt;&amp;gt;(props);
consumer.subscribe(Arrays.asList(&amp;#34;topic&amp;#34;));
while (true) {
ConsumerRecords&amp;lt;String, String&amp;gt; records = consumer.poll(Duration.ofMillis(1000));
for (ConsumerRecord&amp;lt;String, String&amp;gt; record : records) {
System.out.println(&amp;#34;Received: &amp;#34; + record.value());
}
consumer.commitSync(); // æ‰‹åŠ¨æäº¤åç§»é‡
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè„±ç¦»Springæ¡†æ¶çº¦æŸã€éœ€è‡ªå®šä¹‰æ¶ˆè´¹çº¿ç¨‹æˆ–æ‰¹å¤„ç†é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-åŠ¨æ€æ¶ˆè´¹è€…å·¥å‚æ¨¡å¼"&gt;ğŸ§ª &lt;strong&gt;2. åŠ¨æ€æ¶ˆè´¹è€…å·¥å‚æ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç»“åˆ&lt;code&gt;KafkaConsumer&lt;/code&gt;ä¸å®šæ—¶ä»»åŠ¡ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ›å»º/é”€æ¯æ¶ˆè´¹è€…ï¼Œé€‚åˆå‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­æ¶ˆè´¹è€…æ•°é‡ä¸å›ºå®šçš„éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å·¥å‚ç±»&lt;/strong&gt;ï¼šå°è£…&lt;code&gt;KafkaConsumer&lt;/code&gt;åˆ›å»ºé€»è¾‘ï¼Œæ³¨å…¥ç»„IDä¸ä¸»é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ç®¡ç†å™¨&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;ScheduledExecutorService&lt;/code&gt;å®šæ—¶è°ƒåº¦&lt;code&gt;poll&lt;/code&gt;ä»»åŠ¡ï¼Œå­˜å‚¨æ¶ˆè´¹è€…ä¸ä»»åŠ¡å¥æŸ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ§åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;addConsumerTask()&lt;/code&gt;å¯åŠ¨æ–°æ¶ˆè´¹è€…ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;removeConsumerTask()&lt;/code&gt;å…³é—­æŒ‡å®šæ¶ˆè´¹è€…å¹¶é‡Šæ”¾èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé¿å…&lt;code&gt;@KafkaListener&lt;/code&gt;çš„é™æ€ç»‘å®šï¼Œå®ç°æŒ‰éœ€æ‰©ç¼©å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-concurrentmessagelistenercontaineré…ç½®"&gt;âš™ï¸ &lt;strong&gt;3. ConcurrentMessageListenerContaineré…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨Spring Kafkaçš„ä½é˜¶APIæ„å»ºç›‘å¬å®¹å™¨ï¼Œéœ€é…åˆ&lt;code&gt;MessageListener&lt;/code&gt;æ¥å£å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰&lt;code&gt;ConcurrentMessageListenerContainer&lt;/code&gt;å®ä¾‹ï¼Œå…³è”&lt;code&gt;ConsumerFactory&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å®ç°&lt;code&gt;MessageListener&lt;/code&gt;æ¥å£çš„&lt;code&gt;onMessage()&lt;/code&gt;æ–¹æ³•å¤„ç†å•æ¡æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼ˆå¦‚&lt;code&gt;concurrency=3&lt;/code&gt;ï¼‰ä»¥åŒ¹é…åˆ†åŒºæ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç å…³é”®ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public ConcurrentMessageListenerContainer&amp;lt;String, String&amp;gt; container() {
ContainerProperties props = new ContainerProperties(&amp;#34;topic&amp;#34;);
props.setMessageListener((MessageListener&amp;lt;String, String&amp;gt;) record -&amp;gt; {
System.out.println(&amp;#34;Handled: &amp;#34; + record.value());
});
return new ConcurrentMessageListenerContainer&amp;lt;&amp;gt;(consumerFactory(), props);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€ç›´æ¥ç®¡ç†ç›‘å¬å®¹å™¨ç”Ÿå‘½å‘¨æœŸæˆ–æ•´åˆéæ³¨è§£å¼ç›‘å¬å™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-æ‰‹åŠ¨çº¿ç¨‹ç®¡ç†åŸç”Ÿapi--executorservice"&gt;ğŸ”§ &lt;strong&gt;4. æ‰‹åŠ¨çº¿ç¨‹ç®¡ç†ï¼ˆåŸç”ŸAPI + ExecutorServiceï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‡ªä¸»åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹æ± ï¼Œå®ç°é«˜å¹¶å‘æ¶ˆè´¹æˆ–å¤æ‚æµå¤„ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµç¨‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºå¤šä¸ª&lt;code&gt;KafkaConsumer&lt;/code&gt;å®ä¾‹ï¼Œæ¯ä¸ªç»‘å®šç‹¬ç«‹çº¿ç¨‹ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;ExecutorService&lt;/code&gt;æäº¤æ¶ˆè´¹è€…ä»»åŠ¡ï¼Œå¹¶è¡Œæ‰§è¡Œ&lt;code&gt;poll&lt;/code&gt;å¾ªç¯ï¼›&lt;/li&gt;
&lt;li&gt;åè°ƒçº¿ç¨‹é—´åç§»é‡æäº¤ä¸é”™è¯¯æ¢å¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œé¿å…åç§»é‡æäº¤å†²çªï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…æ•°é‡ä¸åº”è¶…è¿‡åˆ†åŒºæ•°ï¼Œå¦åˆ™çº¿ç¨‹é—²ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ§åˆ¶ç²’åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠ¨æ€æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¤æ‚åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŸç”Ÿ&lt;code&gt;KafkaConsumer&lt;/code&gt;è½®è¯¢&lt;/td&gt;
&lt;td&gt;â­â­â­â­&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;ç²¾ç»†æ§åˆ¶ã€è„±ç¦»Springä¾èµ–&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åŠ¨æ€æ¶ˆè´¹è€…å·¥å‚&lt;/td&gt;
&lt;td&gt;â­â­â­â­&lt;/td&gt;
&lt;td&gt;â­â­â­â­&lt;/td&gt;
&lt;td&gt;è¿è¡Œæ—¶åŠ¨æ€å¢åˆ æ¶ˆè´¹è€…&lt;/td&gt;
&lt;td&gt;ä¸­é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ConcurrentMessageListenerContainer&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;â­â­â­&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;Springå®¹å™¨ç®¡ç†ã€éæ³¨è§£ç›‘å¬&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰‹åŠ¨çº¿ç¨‹ç®¡ç†&lt;/td&gt;
&lt;td&gt;â­â­â­â­â­&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ã€è‡ªå®šä¹‰æµå¤„ç†æ¶æ„&lt;/td&gt;
&lt;td&gt;æé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å®è·µå»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜å…ˆé€‰æ‹©&lt;code&gt;@KafkaListener&lt;/code&gt;ç®€åŒ–å¼€å‘ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦åŠ¨æ€æ‰©å±•æ—¶é‡‡ç”¨&lt;strong&gt;åŠ¨æ€å·¥å‚æ¨¡å¼&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹æ€§èƒ½æˆ–æ§åˆ¶æœ‰æè‡´è¦æ±‚æ—¶ä½¿ç”¨&lt;strong&gt;åŸç”ŸAPIè½®è¯¢æˆ–çº¿ç¨‹ç®¡ç†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šé…ç½®ç»†èŠ‚å¯å‚è€ƒå„æ–¹æ¡ˆæ¥æºæ–‡æ¡£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="class-è¡Œä¸º"&gt;Class è¡Œä¸º
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œå½“é€šè¿‡&lt;strong&gt;åŸºç±»å¼•ç”¨ï¼ˆå®é™…æŒ‡å‘å­ç±»å¯¹è±¡ï¼‰è°ƒç”¨ &lt;code&gt;getClass()&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œè¿”å›çš„æ˜¯å­ç±»çš„ &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ï¼Œè€ŒéåŸºç±»çš„ &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡ã€‚è¿™æ˜¯ç”± &lt;code&gt;getClass()&lt;/code&gt;çš„&lt;strong&gt;è¿è¡Œæ—¶ç±»å‹è¯†åˆ«&lt;/strong&gt;ç‰¹æ€§å†³å®šçš„ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŸç†"&gt;ğŸ” &lt;strong&gt;æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;getClass()&lt;/code&gt;çš„è¿è¡Œæ—¶ç‰¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;getClass()&lt;/code&gt;æ˜¯ &lt;code&gt;Object&lt;/code&gt;ç±»ä¸­å®šä¹‰çš„ &lt;code&gt;final&lt;/code&gt;æ–¹æ³•ï¼Œå…¶è¿”å›å€¼å–å†³äºå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„&lt;strong&gt;å®é™…ç±»å‹&lt;/strong&gt;ï¼ˆå³è¿è¡Œæ—¶ç±»å‹ï¼‰ï¼Œä¸ç¼–è¯‘æ—¶çš„å£°æ˜ç±»å‹æ— å…³ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class Animal {}
class Dog extends Animal {}
Animal animal = new Dog(); // åŸºç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡
Class&amp;lt;?&amp;gt; clazz = animal.getClass(); // è¿”å› Dog.class
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤æ—¶ &lt;code&gt;clazz == Dog.class&lt;/code&gt;ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œè€Œé &lt;code&gt;Animal.class&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ€åœºæ™¯ä¸‹çš„è¡Œä¸º&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å³ä½¿æ–¹æ³•åœ¨åŸºç±»ä¸­è¢«è°ƒç”¨ï¼ˆå¦‚åŸºç±»æ„é€ å‡½æ•°æˆ–æ™®é€šæ–¹æ³•ï¼‰ï¼Œ&lt;code&gt;this.getClass()&lt;/code&gt;ä»è¿”å›&lt;strong&gt;å®é™…å­ç±»çš„ &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class Art {
Art() {
System.out.println(this.getClass().getName()); // è¾“å‡ºå­ç±»ç±»å
}
}
class Cartoon extends Art {
public static void main(String[] args) {
new Cartoon(); // è¾“å‡ºï¼šArt â†’ &amp;#34;Cartoon&amp;#34;ï¼›Cartoon â†’ &amp;#34;Cartoon&amp;#34;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ &lt;code&gt;Art&lt;/code&gt;çš„æ„é€ å‡½æ•°ä¸­ï¼Œ&lt;code&gt;this.getClass()&lt;/code&gt;è¿”å› &lt;code&gt;Cartoon.class&lt;/code&gt;ï¼Œè€Œé &lt;code&gt;Art.class&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸ç›¸å…³æ¦‚å¿µçš„å¯¹æ¯”"&gt;âš–ï¸ &lt;strong&gt;ä¸ç›¸å…³æ¦‚å¿µçš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;getClass()&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;ç±»å.class&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;instanceof&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ¤æ–­ä¾æ®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿è¡Œæ—¶å®é™…ç±»å‹&lt;/td&gt;
&lt;td&gt;ç¼–è¯‘æ—¶å£°æ˜ç±»å‹&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å±äºç±»/æ¥å£æˆ–å…¶å­ç±»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šæ€åœºæ™¯ç»“æœ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¿”å›å­ç±» &lt;code&gt;Class&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¿”å›åŸºç±» &lt;code&gt;Class&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;true&lt;/code&gt;ï¼ˆè‹¥ä¸ºå­ç±»å®ä¾‹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;animal.getClass() â†’ Dog.class&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Animal.class â†’ Animal.class&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;animal instanceof Dog â†’ true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;å…³é”®åŒºåˆ«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getClass()&lt;/code&gt;&lt;strong&gt;ä¸¥æ ¼åŒ¹é…è¿è¡Œæ—¶ç±»å‹&lt;/strong&gt;ï¼Œä¸è®¤å¯ç»§æ‰¿å…³ç³»ï¼ˆå¦‚ &lt;code&gt;Dog.class â‰  Animal.class&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;instanceof&lt;/code&gt;&lt;strong&gt;è®¤å¯ç»§æ‰¿å…³ç³»&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;animal instanceof Animal&lt;/code&gt;å¯¹å­ç±»å¯¹è±¡è¿”å› &lt;code&gt;true&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç†å¯¹è±¡çš„å½±å“&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è‹¥å¯¹è±¡æ˜¯åŠ¨æ€ä»£ç†ï¼ˆå¦‚ Spring AOP ç”Ÿæˆï¼‰ï¼Œ&lt;code&gt;getClass()&lt;/code&gt;è¿”å›ä»£ç†ç±»çš„ &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡ï¼Œè€ŒéåŸå§‹å­ç±»ã€‚éœ€é€šè¿‡å·¥å…·ç±»ï¼ˆå¦‚ &lt;code&gt;AopUtils.getTargetClass()&lt;/code&gt;ï¼‰è·å–åŸå§‹ç±»å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ &lt;code&gt;.class&lt;/code&gt;è¯­æ³•åŒºåˆ«&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ç±»å.class&lt;/code&gt;æ˜¯&lt;strong&gt;é™æ€è·å–&lt;/strong&gt;çš„ç¼–è¯‘æ—¶å¸¸é‡ï¼Œå§‹ç»ˆè¿”å›å£°æ˜ç±»å‹çš„ &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;getClass()&lt;/code&gt;&lt;strong&gt;åŠ¨æ€è·å–&lt;/strong&gt;è¿è¡Œæ—¶ç±»å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åŸºç±»å¼•ç”¨è°ƒç”¨ &lt;code&gt;getClass()&lt;/code&gt;&lt;strong&gt;ä¸€å®šè¿”å›å­ç±»çš„ &lt;code&gt;Class&lt;/code&gt;å¯¹è±¡&lt;/strong&gt;ï¼Œè¿™æ˜¯ç”± Java è¿è¡Œæ—¶ç±»å‹è¯†åˆ«æœºåˆ¶å†³å®šçš„ã€‚è‹¥éœ€åˆ¤æ–­å¯¹è±¡æ˜¯å¦å±äºæŸç±»æˆ–å…¶å­ç±»ï¼Œåº”ä½¿ç”¨ &lt;code&gt;instanceof&lt;/code&gt;ï¼›è‹¥éœ€ç²¾ç¡®åŒ¹é…ç±»å‹ï¼Œåˆ™ç”¨ &lt;code&gt;getClass()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="hashmap--reentrantlock"&gt;HashMap + ReentrantLock
&lt;/h2&gt;&lt;p&gt;åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œä½¿ç”¨ &lt;strong&gt;&lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;å¯ä»¥æ›¿ä»£ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;å®ç°çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼Œä½†å…¶é€‚ç”¨æ€§éœ€ç»“åˆå…·ä½“åœºæ™¯è¯„ä¼°ã€‚ä»¥ä¸‹æ˜¯å…³é”®å¯¹æ¯”ä¸åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-æŠ€æœ¯å¯è¡Œæ€§åˆ†æ"&gt;âš™ï¸ &lt;strong&gt;1. æŠ€æœ¯å¯è¡Œæ€§åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é”ç²’åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨æ§åˆ¶é”ï¼ˆå¦‚å…¨å±€é”æˆ–åˆ†æ®µé”ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… å¯è¾¾åˆ°&lt;/td&gt;
&lt;td&gt;ç²—ç²’åº¦ï¼ˆå…¨å±€é”ï¼‰æˆ–ç»†ç²’åº¦ï¼ˆåˆ†æ®µé”ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†…ç½®åˆ†æ®µé”ï¼ˆJDK7ï¼‰æˆ– CAS+synchronizedï¼ˆJDK8+ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… åŸç”Ÿä¿è¯&lt;/td&gt;
&lt;td&gt;æ¡¶çº§é”ï¼ˆJDK8+ï¼Œé”å®šå•ä¸ªå“ˆå¸Œæ¡¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;çš„å±€é™æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€é”æ–¹æ¡ˆ&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨å•ä¸€æŠŠé”ä¿æŠ¤æ•´ä¸ª &lt;code&gt;HashMap&lt;/code&gt;ï¼Œæ‰€æœ‰æ“ä½œï¼ˆå¦‚ &lt;code&gt;put&lt;/code&gt;ã€&lt;code&gt;get&lt;/code&gt;ï¼‰éœ€ä¸²è¡Œæ‰§è¡Œï¼Œ&lt;strong&gt;å¹¶å‘æ€§èƒ½å·®&lt;/strong&gt;ï¼Œé€€åŒ–è¿‘ä¼¼ &lt;code&gt;Hashtable&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†æ®µé”æ–¹æ¡ˆ&lt;/strong&gt;ï¼šéœ€æ‰‹åŠ¨å®ç°åˆ†æ®µç­–ç•¥ï¼ˆå¦‚æŒ‰å“ˆå¸Œå€¼åˆ†æ¡¶ï¼‰ï¼Œä½†å®ç°å¤æ‚ä¸”æ˜“å‡ºé”™ï¼ˆå¦‚æ­»é”é£é™©ï¼‰ï¼Œä¸”å†…å­˜å ç”¨é«˜äº &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é”ç²’åº¦ç»†åŒ–&lt;/strong&gt;ï¼šJDK8+ ä»…é”å®šå•ä¸ªå“ˆå¸Œæ¡¶ï¼ˆæ¡¶å¤´èŠ‚ç‚¹ï¼‰ï¼Œä¸åŒæ¡¶çš„æ“ä½œå¯å¹¶è¡Œæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— é”è¯»ä¼˜åŒ–&lt;/strong&gt;ï¼šè¯»æ“ä½œæ— éœ€åŠ é”ï¼Œä¾èµ– &lt;code&gt;volatile&lt;/code&gt;å˜é‡ä¿è¯å¯è§æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…ç½®åŸå­æ“ä½œ&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;computeIfAbsent()&lt;/code&gt;ã€&lt;code&gt;putIfAbsent()&lt;/code&gt;ç­‰ï¼Œé¿å…æ‰‹åŠ¨åŒæ­¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-æ€§èƒ½å¯¹æ¯”"&gt;âš–ï¸ &lt;strong&gt;2. æ€§èƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;ï¼ˆå…¨å±€é”ï¼‰&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼ˆJDK8+ï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘å†™&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å·®ï¼ˆæ‰€æœ‰å†™æ“ä½œä¸²è¡Œï¼‰&lt;/td&gt;
&lt;td&gt;ä¼˜ï¼ˆæ¡¶çº§é”æ”¯æŒå¹¶è¡Œå†™ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘è¯»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆè¯»æ“ä½œéœ€æŠ¢é”ï¼‰&lt;/td&gt;
&lt;td&gt;ä¼˜ï¼ˆè¯»æ— é”ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»å†™æ··åˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å·®ï¼ˆè¯»å†™äº’æ–¥ï¼‰&lt;/td&gt;
&lt;td&gt;ä¼˜ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’ &lt;strong&gt;å…³é”®ç»“è®º&lt;/strong&gt;ï¼šåœ¨&lt;strong&gt;é«˜å¹¶å‘åœºæ™¯&lt;/strong&gt;ä¸‹ï¼Œ&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„ååé‡æ˜¾è‘—é«˜äºæ‰‹åŠ¨é”æ–¹æ¡ˆï¼Œå°¤å…¶åœ¨è¯»å†™æ··åˆæ“ä½œä¸­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-3-é€‚ç”¨åœºæ™¯ä¸é£é™©"&gt;âš ï¸ &lt;strong&gt;3. é€‚ç”¨åœºæ™¯ä¸é£é™©&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚åˆ &lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;çš„åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½å¹¶å‘ç¯å¢ƒ&lt;/strong&gt;ï¼šçº¿ç¨‹ç«äº‰å°‘ï¼Œé”äº‰ç”¨ä¸æ¿€çƒˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€å®šåˆ¶é”é€»è¾‘&lt;/strong&gt;ï¼šå¦‚è·¨å¤šä¸ªæ•°æ®ç»“æ„éœ€åŸå­æ›´æ–°ï¼ˆå¦‚åŒæ—¶æ“ä½œ &lt;code&gt;HashMap&lt;/code&gt;å’Œ &lt;code&gt;List&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚åˆ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘è¯»å†™&lt;/strong&gt;ï¼šå¦‚ç¼“å­˜ã€å®æ—¶è®¡æ•°å™¨ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–ä»£ç &lt;/strong&gt;ï¼šé¿å…æ‰‹åŠ¨ç®¡ç†é”ï¼Œå‡å°‘ &lt;code&gt;try-finally&lt;/code&gt;æ¨¡æ¿ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£é™©æç¤º&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­»é”é£é™©&lt;/strong&gt;ï¼šæ‰‹åŠ¨åˆ†æ®µé”è‹¥æœªæŒ‰å›ºå®šé¡ºåºåŠ é”ï¼Œå¯èƒ½æ­»é”ï¼ˆ&lt;code&gt;ConcurrentHashMap&lt;/code&gt;å†…éƒ¨é€šè¿‡æ•°ç»„é¡ºåºé¿å…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜ä¸€è‡´æ€§&lt;/strong&gt;ï¼šæ‰‹åŠ¨é”éœ€ç¡®ä¿ &lt;code&gt;happens-before&lt;/code&gt;è§„åˆ™ï¼ˆå¦‚é”é‡Šæ”¾å‰å†™å…¥å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ï¼‰ï¼Œè€Œ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;é€šè¿‡ &lt;code&gt;volatile&lt;/code&gt;å’Œ &lt;code&gt;CAS&lt;/code&gt;è‡ªåŠ¨ä¿éšœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-å®ç°æ–¹æ¡ˆç¤ºä¾‹"&gt;ğŸ› ï¸ &lt;strong&gt;4. å®ç°æ–¹æ¡ˆç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-hashmap--reentrantlockå…¨å±€é”"&gt;(1) &lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;ï¼ˆå…¨å±€é”ï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;public class LockedHashMap&amp;lt;K, V&amp;gt; {
private final Map&amp;lt;K, V&amp;gt; map = new HashMap&amp;lt;&amp;gt;();
private final ReentrantLock lock = new ReentrantLock();
public void put(K key, V value) {
lock.lock();
try {
map.put(key, value);
} finally {
lock.unlock();
}
}
// å…¶ä»–æ–¹æ³•éœ€ç±»ä¼¼åŠ é”
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šæ‰€æœ‰æ“ä½œä¸²è¡ŒåŒ–ï¼Œæ€§èƒ½ç“¶é¢ˆæ˜æ˜¾ã€‚&lt;/p&gt;
&lt;h4 id="2-concurrenthashmapæ¨è"&gt;(2) &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼ˆæ¨èï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;ConcurrentHashMap&amp;lt;String, Integer&amp;gt; safeMap = new ConcurrentHashMap&amp;lt;&amp;gt;();
safeMap.put(&amp;#34;key&amp;#34;, 1); // æ— éœ€æ‰‹åŠ¨åŒæ­¥
safeMap.computeIfAbsent(&amp;#34;key&amp;#34;, k -&amp;gt; 2); // åŸå­æ“ä½œ
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å»ºè®®-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© &lt;code&gt;ConcurrentHashMap&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨ç»å¤§å¤šæ•°å¹¶å‘åœºæ™¯ä¸‹ï¼Œå…¶&lt;strong&gt;å†…ç½®çš„ç»†ç²’åº¦é”æœºåˆ¶å’ŒåŸå­æ“ä½œ&lt;/strong&gt;æ›´é«˜æ•ˆã€å®‰å…¨ï¼Œä¸”ä»£ç ç®€æ´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»…è€ƒè™‘ &lt;code&gt;HashMap + ReentrantLock&lt;/code&gt;å½“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;â‘  éœ€è·¨å¤šä¸ªç»“æ„åŸå­æ›´æ–°ï¼›&lt;/p&gt;
&lt;p&gt;â‘¡ å¹¶å‘æä½ä¸”è¿½æ±‚ä»£ç è½»é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;é¿å…é‡å¤é€ è½®å­&lt;/strong&gt;ï¼š&lt;code&gt;ConcurrentHashMap&lt;/code&gt;ç”± Java å¹¶å‘ä¸“å®¶æ·±åº¦ä¼˜åŒ–ï¼ˆå¦‚çº¢é»‘æ ‘æŠ—å“ˆå¸Œæ”»å‡»ã€æ‰©å®¹åä½œç­‰ï¼‰ï¼Œæ‰‹åŠ¨å®ç°åŒç­‰æ€§èƒ½ä¸ç¨³å®šæ€§æˆæœ¬æé«˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="reentrantlock-å’Œ-reentrantreadwritelock"&gt;ReentrantLock å’Œ ReentrantReadWriteLock
&lt;/h2&gt;&lt;p&gt;ReentrantLock å’Œ ReentrantReadWriteLock æ˜¯ Java å¹¶å‘åŒ…ä¸­ä¸¤ç§ä¸åŒçš„é”æœºåˆ¶ï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äº&lt;strong&gt;é”çš„ç²’åº¦å’Œé€‚ç”¨åœºæ™¯&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-é”ç±»å‹ä¸å¹¶å‘æ€§"&gt;ğŸ”’ &lt;strong&gt;1. é”ç±»å‹ä¸å¹¶å‘æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬å é”ï¼ˆäº’æ–¥é”ï¼‰&lt;/strong&gt;ï¼šåŒä¸€æ—¶é—´ä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹ï¼ˆè¯»æˆ–å†™ï¼‰è®¿é—®èµ„æºï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¯»å†™æ“ä½œé¢‘ç‡æ¥è¿‘ï¼Œæˆ–éœ€è¦ä¸¥æ ¼åŸå­æ€§çš„åœºæ™¯ï¼ˆå¦‚è´¦æˆ·è½¬è´¦ã€è®¢å•æ”¯ä»˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»é”&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»é”ï¼ˆå…±äº«é”ï¼‰&lt;/strong&gt;ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘è¯»å–èµ„æºï¼ˆè¯»è¯»ä¸äº’æ–¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™é”ï¼ˆç‹¬å é”ï¼‰&lt;/strong&gt;ï¼šä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼Œä¸”ä¸è¯»é”/å…¶ä»–å†™é”äº’æ–¥ï¼ˆè¯»å†™ã€å†™å†™äº’æ–¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œçš„åœºæ™¯ï¼ˆå¦‚ç¼“å­˜ã€é…ç½®ç®¡ç†ã€ç»Ÿè®¡æŠ¥è¡¨ï¼‰ï¼Œå…¸å‹è¯»å†™æ¯”ä¾‹å»ºè®® â‰¥ 9:1ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-æ€§èƒ½å¯¹æ¯”-1"&gt;âš–ï¸ &lt;strong&gt;2. æ€§èƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘è¯»&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ‰€æœ‰è¯»æ“ä½œä¸²è¡ŒåŒ–&lt;/td&gt;
&lt;td&gt;âœ… è¯»æ“ä½œå¯å¹¶è¡Œï¼ˆååé‡é«˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘å†™&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… å†™æ“ä½œç«äº‰å¯æ§&lt;/td&gt;
&lt;td&gt;âš ï¸ å†™æ“ä½œç«äº‰æ¿€çƒˆæ—¶æ€§èƒ½ä¸‹é™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯»å†™æ··åˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ è¯»å†™äº’æ–¥å¯¼è‡´é˜»å¡&lt;/td&gt;
&lt;td&gt;âœ… è¯»æ“ä½œä¸é˜»å¡å†™æ“ä½œç­‰å¾…&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;å…³é”®ç»“è®º&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;ï¼ˆå¦‚ç¼“å­˜ï¼‰ï¼š&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;çš„å¹¶å‘æ€§èƒ½æ˜¾è‘—ä¼˜äº &lt;code&gt;ReentrantLock&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™å¤šè¯»å°‘&lt;/strong&gt;ï¼š&lt;code&gt;ReentrantLock&lt;/code&gt;æ›´é«˜æ•ˆï¼ˆé¿å…è¯»å†™é”çš„ç»´æŠ¤å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-3-åŠŸèƒ½ç‰¹æ€§"&gt;âš™ï¸ &lt;strong&gt;3. åŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯é‡å…¥æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ&lt;/td&gt;
&lt;td&gt;âœ… è¯»é”/å†™é”å‡æ”¯æŒé‡å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¬å¹³æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… å¯é…ç½®å…¬å¹³/éå…¬å¹³&lt;/td&gt;
&lt;td&gt;âœ… å¯é…ç½®å…¬å¹³/éå…¬å¹³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é”é™çº§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;âœ… å†™é”å¯é™çº§ä¸ºè¯»é”ï¼ˆä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¡ä»¶å˜é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒå¤šä¸ª &lt;code&gt;Condition&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä»…æ”¯æŒä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¶…æ—¶/ä¸­æ–­&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒ &lt;code&gt;tryLock()&lt;/code&gt;ã€&lt;code&gt;lockInterruptibly()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… è¯»é”/å†™é”å‡æ”¯æŒè¶…æ—¶ä¸ä¸­æ–­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;é”é™çº§ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å…ˆè·å–å†™é” â†’ ä¿®æ”¹æ•°æ® â†’ è·å–è¯»é” â†’ é‡Šæ”¾å†™é” â†’ ç»§ç»­è¯»æ“ä½œï¼ˆé¿å…å…¶ä»–å†™çº¿ç¨‹å¹²æ‰°ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-4-å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸ§© &lt;strong&gt;4. å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;é€‚ç”¨&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œé¢‘ç¹ï¼ˆå¦‚åº“å­˜æ‰£å‡ã€æ”¯ä»˜äº¤æ˜“ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ç²¾ç»†æ§åˆ¶åŒæ­¥ï¼ˆå¦‚è·¨å¤šä¸ªèµ„æºçš„åŸå­æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;é€‚ç”¨&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ç³»ç»Ÿ&lt;/strong&gt;ï¼šé«˜é¢‘è¯»å–é…ç½®æˆ–çƒ­ç‚¹æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«æ–‡æ¡£&lt;/strong&gt;ï¼šå¤šäººååŒç¼–è¾‘ï¼ˆå¤šæ•°äººè¯»ï¼Œå°‘æ•°äººå†™ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡æ•°æ®&lt;/strong&gt;ï¼šå®šæ—¶æ›´æ–°æŠ¥è¡¨ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¯»å–åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å¦‚ä½•é€‰æ‹©"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯ç‰¹å¾&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èé”ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è¯»å†™æ“ä½œå‡è¡¡æˆ–å†™å¤šè¯»å°‘&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¿å…è¯»å†™é”çš„é¢å¤–å¼€é”€ï¼Œç®€åŒ–åŒæ­¥é€»è¾‘ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯»æ“ä½œå æ¯” â‰¥ 90%&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯»å¹¶å‘æ€§èƒ½æå‡æ˜¾è‘—ï¼Œä¸”æ”¯æŒé”é™çº§ä¿è¯ä¸€è‡´æ€§ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éœ€é”é™çº§ï¼ˆå†™åç«‹å³è¯»ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReentrantReadWriteLock&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å”¯ä¸€æ”¯æŒå†™é”é™çº§ä¸ºè¯»é”çš„æœºåˆ¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éœ€å¤šä¸ªæ¡ä»¶å˜é‡æ§åˆ¶çº¿ç¨‹åä½œ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ReentrantLock&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¯åˆ›å»ºå¤šä¸ª &lt;code&gt;Condition&lt;/code&gt;å®ç°ç²¾ç»†ç­‰å¾…/å”¤é†’ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;âš ï¸ æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…æ»¥ç”¨è¯»å†™é”&lt;/strong&gt;ï¼šè‹¥å†™æ“ä½œé¢‘ç¹ï¼Œè¯»å†™é”çš„ç»´æŠ¤å¼€é”€ï¼ˆå¦‚è¯»é”è®¡æ•°ï¼‰å¯èƒ½æŠµæ¶ˆå¹¶å‘ä¼˜åŠ¿ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šæé«˜å¹¶å‘åœºæ™¯å¯è€ƒè™‘ &lt;code&gt;StampedLock&lt;/code&gt;ï¼ˆä¹è§‚è¯»é”ï¼‰æˆ– &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼ˆå†…ç½®åˆ†æ®µé”ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="value"&gt;@Value
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@Value&lt;/code&gt;æ³¨è§£ä¸èƒ½ç›´æ¥åœ¨é &lt;code&gt;@Component&lt;/code&gt;ç±»ï¼ˆå³æœªè¢« Spring å®¹å™¨ç®¡ç†çš„ç±»ï¼‰ä¸­ç”Ÿæ•ˆ&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æå’Œæ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸ºä»€ä¹ˆ"&gt;âš ï¸ &lt;strong&gt;ä¸ºä»€ä¹ˆ &lt;code&gt;@Value&lt;/code&gt;æ³¨è§£å¿…é¡»åœ¨ Spring ç®¡ç†çš„ç±»ä¸­ä½¿ç”¨ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Value&lt;/code&gt;çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ä¾èµ–äº Spring å®¹å™¨ã€‚å½“ç±»æœªè¢« Spring ç®¡ç†ï¼ˆå³æœªæ·»åŠ  &lt;code&gt;@Component&lt;/code&gt;ã€&lt;code&gt;@Service&lt;/code&gt;ç­‰æ³¨è§£ï¼‰æ—¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å…¥å¤±è´¥&lt;/strong&gt;ï¼š&lt;code&gt;@Value&lt;/code&gt;æ ‡æ³¨çš„å­—æ®µä¼šä¿æŒé»˜è®¤å€¼ï¼ˆå¦‚ &lt;code&gt;null&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸç†é™åˆ¶&lt;/strong&gt;ï¼šSpring é€šè¿‡ Bean åç½®å¤„ç†å™¨å¤„ç† &lt;code&gt;@Value&lt;/code&gt;æ³¨è§£ï¼Œè€Œæ™®é€š Java ç±»ä¸ä¼šç»è¿‡æ­¤æµç¨‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class NonSpringClass {
@Value(&amp;#34;${app.name}&amp;#34;)
private String appName; // å€¼å§‹ç»ˆä¸º null
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ›¿ä»£æ–¹æ¡ˆåœ¨é-spring-ç®¡ç†ç±»ä¸­è·å–é…ç½®"&gt;ğŸ”§ &lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆï¼šåœ¨é Spring ç®¡ç†ç±»ä¸­è·å–é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€åœ¨æ™®é€šç±»ä¸­è¯»å–é…ç½®ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š&lt;/p&gt;
&lt;h4 id="1-æ‰‹åŠ¨ä»-spring-ç¯å¢ƒè·å–å±æ€§å€¼"&gt;1. &lt;strong&gt;æ‰‹åŠ¨ä» Spring ç¯å¢ƒè·å–å±æ€§å€¼&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ª Spring ç®¡ç†çš„å·¥å…·ç±»ï¼ˆå¦‚ &lt;code&gt;SpringContextHolder&lt;/code&gt;ï¼‰ï¼Œç”¨äºä¿å­˜ &lt;code&gt;ApplicationContext&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;ApplicationContext&lt;/code&gt;çš„ &lt;code&gt;Environment&lt;/code&gt;è·å–å±æ€§å€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class SpringContextHolder implements ApplicationContextAware {
private static ApplicationContext context;
@Override
public void setApplicationContext(ApplicationContext ctx) {
context = ctx;
}
public static String getProperty(String key) {
return context.getEnvironment().getProperty(key);
}
}
// åœ¨æ™®é€šç±»ä¸­ä½¿ç”¨
public class NonSpringClass {
private String appName = SpringContextHolder.getProperty(&amp;#34;app.name&amp;#34;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å°†ç±»æ”¹ä¸º-spring-ç®¡ç†"&gt;2. &lt;strong&gt;å°†ç±»æ”¹ä¸º Spring ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç›´æ¥æ·»åŠ  &lt;code&gt;@Component&lt;/code&gt;ç­‰æ³¨è§£ï¼Œä½¿ç±»ç”± Spring å®¹å™¨ç®¡ç†ï¼Œä»è€Œæ”¯æŒ &lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¯¹åŸæœ‰ä»£ç æ”¹é€ å½±å“è¾ƒå°çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-é€šè¿‡"&gt;3. &lt;strong&gt;é€šè¿‡ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•æ‰‹åŠ¨æ³¨å…¥å±æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨é…ç½®ç±»ä¸­å®šä¹‰ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•ä¸­ä½¿ç”¨ &lt;code&gt;@Value&lt;/code&gt;è·å–é…ç½®å€¼ï¼Œå†ä¼ é€’ç»™æ™®é€šç±»çš„å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Configuration
public class AppConfig {
@Value(&amp;#34;${app.name}&amp;#34;)
private String appName;
@Bean
public NonSpringClass nonSpringClass() {
return new NonSpringClass(appName); // é€šè¿‡æ„é€ å™¨ä¼ å‚
}
}
public class NonSpringClass {
private String appName;
public NonSpringClass(String appName) {
this.appName = appName;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-java-åŸç”Ÿæ–¹å¼è¯»å–é…ç½®æ–‡ä»¶"&gt;4. &lt;strong&gt;Java åŸç”Ÿæ–¹å¼è¯»å–é…ç½®æ–‡ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç»•è¿‡ Spring æœºåˆ¶ï¼Œç›´æ¥é€šè¿‡ &lt;code&gt;Properties&lt;/code&gt;ç±»æˆ– &lt;code&gt;Yaml&lt;/code&gt;è§£æå·¥å…·è¯»å–é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class ConfigReader {
public static String getProperty(String key) {
Properties props = new Properties();
try (InputStream input = ConfigReader.class.getResourceAsStream(&amp;#34;/application.properties&amp;#34;)) {
props.load(input);
return props.getProperty(key);
} catch (IOException e) {
throw new RuntimeException(&amp;#34;Failed to read config&amp;#34;, e);
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ‰‹åŠ¨è·å–ç¯å¢ƒå±æ€§ï¼ˆæ–¹æ¡ˆ1ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€åœ¨éæ‰˜ç®¡ç±»ä¸­åŠ¨æ€è·å–é…ç½®&lt;/td&gt;
&lt;td&gt;æ— éœ€æ”¹é€ ç±»ç»“æ„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ”¹ä¸º Spring ç®¡ç†ï¼ˆæ–¹æ¡ˆ2ï¼‰&lt;/td&gt;
&lt;td&gt;å…è®¸ä»£ç æ”¹é€ &lt;/td&gt;
&lt;td&gt;åŸç”Ÿæ”¯æŒ &lt;code&gt;@Value&lt;/code&gt;ï¼Œç®€å•ç›´æ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Bean&lt;/code&gt;æ–¹æ³•æ³¨å…¥ï¼ˆæ–¹æ¡ˆ3ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€è§£è€¦é…ç½®ä¸ä¸šåŠ¡é€»è¾‘&lt;/td&gt;
&lt;td&gt;é›†ä¸­ç®¡ç†é…ç½®ï¼Œçµæ´»æ€§é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Java åŸç”Ÿè¯»å–ï¼ˆæ–¹æ¡ˆ4ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸ä¾èµ– Spring çš„ç‹¬ç«‹åº”ç”¨&lt;/td&gt;
&lt;td&gt;å®Œå…¨è„±ç¦»æ¡†æ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èå®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆè€ƒè™‘&lt;strong&gt;å°†ç±»çº³å…¥ Spring ç®¡ç†&lt;/strong&gt;ï¼ˆæ–¹æ¡ˆ2ï¼‰ï¼Œç¡®ä¿ä»£ç ç¬¦åˆä¾èµ–æ³¨å…¥è§„èŒƒã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æ— æ³•ä¿®æ”¹ç±»ç»“æ„ï¼Œä½¿ç”¨ &lt;strong&gt;&lt;code&gt;SpringContextHolder&lt;/code&gt;å·¥å…·ç±»&lt;/strong&gt;ï¼ˆæ–¹æ¡ˆ1ï¼‰æ˜¯æœ€å¸¸è§çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>ã€Shopeeã€‘Thread</title><link>https://dyhes.github.io/p/shopeethread/</link><pubDate>Wed, 20 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeethread/</guid><description>&lt;h2 id="concurrenthashmap"&gt;ConcurrentHashMap
&lt;/h2&gt;&lt;p&gt;æ ¹æ®ä½ çš„ä»£ç å’Œé—®é¢˜åˆ†æï¼Œ&lt;code&gt;ConcurrentHashMap&lt;/code&gt;æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å®ƒ&lt;strong&gt;ä»…èƒ½ä¿è¯è‡ªèº«æ“ä½œçš„åŸå­æ€§ï¼ˆå¦‚ &lt;code&gt;put&lt;/code&gt;ã€&lt;code&gt;get&lt;/code&gt;ç­‰ï¼‰&lt;/strong&gt;ï¼Œè€Œ &lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;ä¸­å­˜å‚¨çš„ &lt;code&gt;List&amp;lt;BaseEdge&amp;gt;&lt;/code&gt;å¯¹è±¡æœ¬èº«å¹¶ä¸è‡ªåŠ¨å…·å¤‡çº¿ç¨‹å®‰å…¨æ€§&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ª &lt;code&gt;List&lt;/code&gt;å®ä¾‹ï¼Œä»ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–å¹¶å‘é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-concurrenthashmap"&gt;1. &lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„çº¿ç¨‹å®‰å…¨æ€§èŒƒå›´&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„çº¿ç¨‹å®‰å…¨æœºåˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;strong&gt;åˆ†æ®µé”ï¼ˆJDK7ï¼‰æˆ– CAS + &lt;code&gt;synchronized&lt;/code&gt;èŠ‚ç‚¹é”ï¼ˆJDK8+ï¼‰&lt;/strong&gt; ä¿è¯å…¶å†…éƒ¨ç»“æ„ï¼ˆå¦‚æ¡¶æ•°ç»„ã€é“¾è¡¨/çº¢é»‘æ ‘ï¼‰çš„çº¿ç¨‹å®‰å…¨ï¼Œç¡®ä¿å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘è¯»å†™ä¸åŒçš„é”®å€¼å¯¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­˜å‚¨å†…å®¹çš„çº¿ç¨‹å®‰å…¨ä¸å—ä¿æŠ¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ConcurrentHashMap&lt;/code&gt;&lt;strong&gt;ä»…ç®¡ç†é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®&lt;/strong&gt;ï¼Œä¸ä¿è¯å…¶å€¼å¯¹è±¡ï¼ˆå¦‚ &lt;code&gt;List&amp;lt;BaseEdge&amp;gt;&lt;/code&gt;ï¼‰çš„å†…éƒ¨æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è‹¥å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ª &lt;code&gt;List&lt;/code&gt;ï¼Œä»éœ€è¦é¢å¤–çš„åŒæ­¥æªæ–½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-listbaseedge"&gt;2. &lt;strong&gt;&lt;code&gt;List&amp;lt;BaseEdge&amp;gt;&lt;/code&gt;çš„çº¿ç¨‹é£é™©åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å‡è®¾ä»¥ä¸‹æ“ä½œå¯èƒ½å‘ç”Ÿï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// çº¿ç¨‹Aï¼šå‘æŸä¸ªClasså¯¹åº”çš„Listä¸­æ·»åŠ è¾¹
List&amp;lt;BaseEdge&amp;gt; edges = buffer.get(EdgeType.class);
edges.add(new BaseEdge()); // éåŸå­æ“ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼
// çº¿ç¨‹Bï¼šåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªList
buffer.get(EdgeType.class).remove(0);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤æ—¶ï¼Œå³ä½¿é€šè¿‡ &lt;code&gt;buffer.get()&lt;/code&gt;è·å– &lt;code&gt;List&lt;/code&gt;çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†åç»­å¯¹ &lt;code&gt;List&lt;/code&gt;çš„ &lt;code&gt;add&lt;/code&gt;ã€&lt;code&gt;remove&lt;/code&gt;ç­‰æ“ä½œ&lt;strong&gt;æœªåŠ é”&lt;/strong&gt;ï¼Œå¯èƒ½å¯¼è‡´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸¢å¤±&lt;/strong&gt;ï¼ˆå¦‚å¹¶å‘æ·»åŠ æ—¶è¦†ç›–ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€ä¸ä¸€è‡´&lt;/strong&gt;ï¼ˆå¦‚éå†æ—¶ç»“æ„è¢«ä¿®æ”¹ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentModificationException&lt;/code&gt;&lt;/strong&gt;ï¼ˆå¹¶å‘ä¿®æ”¹è§¦å‘å¿«é€Ÿå¤±è´¥ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-è§£å†³æ–¹æ¡ˆç¡®ä¿"&gt;3. &lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿ &lt;code&gt;List&lt;/code&gt;çš„çº¿ç¨‹å®‰å…¨&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ–¹æ¡ˆ1ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„-listå®ç°"&gt;æ–¹æ¡ˆ1ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ &lt;code&gt;List&lt;/code&gt;å®ç°
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€‚ç”¨äº&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;çš„åœºæ™¯ã€‚æ¯æ¬¡ä¿®æ”¹æ—¶å¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œä¿è¯éå†çš„ä¸€è‡´æ€§ï¼Œä½†å†™æ“ä½œå¼€é”€è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;buffer.computeIfAbsent(EdgeType.class, k -&amp;gt; new CopyOnWriteArrayList&amp;lt;&amp;gt;())
.add(new BaseEdge()); // çº¿ç¨‹å®‰å…¨
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Collections.synchronizedList()&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;synchronized&lt;/code&gt;åŒ…è£…æ™®é€š &lt;code&gt;List&lt;/code&gt;ï¼Œé€‚åˆ&lt;strong&gt;å†™æ“ä½œé¢‘ç¹&lt;/strong&gt;ä½†éœ€å…¨å±€é”çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;BaseEdge&amp;gt; syncList = Collections.synchronizedList(new ArrayList&amp;lt;&amp;gt;());
buffer.put(EdgeType.class, syncList);
// ä½¿ç”¨æ—¶éœ€æ‰‹åŠ¨åŠ é”ï¼ˆå¦‚éå†æ—¶ï¼‰
synchronized (syncList) {
for (BaseEdge edge : syncList) { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–¹æ¡ˆ2é€šè¿‡-concurrenthashmapçš„åŸå­æ–¹æ³•ç®¡ç†-list"&gt;æ–¹æ¡ˆ2ï¼šé€šè¿‡ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„åŸå­æ–¹æ³•ç®¡ç† &lt;code&gt;List&lt;/code&gt;
&lt;/h4&gt;&lt;p&gt;åˆ©ç”¨ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„åŸå­æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;computeIfAbsent&lt;/code&gt;ã€&lt;code&gt;compute&lt;/code&gt;ï¼‰ç¡®ä¿å¯¹ &lt;code&gt;List&lt;/code&gt;çš„&lt;strong&gt;å•æ¬¡æ“ä½œ&lt;/strong&gt;çº¿ç¨‹å®‰å…¨ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;buffer.computeIfAbsent(EdgeType.class, k -&amp;gt; new ArrayList&amp;lt;&amp;gt;())
.add(new BaseEdge()); // æ³¨æ„ï¼šaddæ“ä½œä»ä¸å®‰å…¨ï¼
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;âš ï¸ æ­¤æ–¹æ³•&lt;strong&gt;ä»…ä¿è¯è·å–æˆ–åˆ›å»º &lt;code&gt;List&lt;/code&gt;çš„åŸå­æ€§&lt;/strong&gt;ï¼Œåç»­å¯¹ &lt;code&gt;List&lt;/code&gt;çš„ä¿®æ”¹ä»éœ€é¢å¤–åŒæ­¥ï¼ˆå¦‚ç»“åˆ &lt;code&gt;synchronized&lt;/code&gt;å—ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="4-æœ€ä½³å®è·µæ€»ç»“"&gt;4. &lt;strong&gt;æœ€ä½³å®è·µæ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯»å¤šå†™å°‘ï¼ˆå¦‚ç¼“å­˜ï¼‰&lt;/td&gt;
&lt;td&gt;è¯»æ“ä½œæ— é”ï¼Œå®‰å…¨ç®€å•&lt;/td&gt;
&lt;td&gt;å†™æ“ä½œæ€§èƒ½ä½ï¼Œå†…å­˜å ç”¨é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;Collections.synchronizedList&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†™æ“ä½œé¢‘ç¹&lt;/td&gt;
&lt;td&gt;å…¼å®¹æ‰€æœ‰ &lt;code&gt;List&lt;/code&gt;å®ç°&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨åŠ é”ï¼Œç²’åº¦è¾ƒç²—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åŸå­æ–¹æ³• + &lt;code&gt;synchronized&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;éœ€è¦ç²¾ç»†æ§åˆ¶&lt;/td&gt;
&lt;td&gt;çµæ´»æ€§é«˜ï¼Œå¯å®šåˆ¶åŒæ­¥é€»è¾‘&lt;/td&gt;
&lt;td&gt;ä»£ç å¤æ‚åº¦é«˜ï¼Œæ˜“å‡ºé”™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èé€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ &lt;code&gt;List&lt;/code&gt;&lt;strong&gt;ä¿®æ”¹ä¸é¢‘ç¹&lt;/strong&gt;ï¼ˆå¦‚é…ç½®åŠ è½½ååªè¯»ï¼‰ï¼Œä¼˜å…ˆç”¨ &lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥éœ€&lt;strong&gt;é«˜é¢‘ä¿®æ”¹&lt;/strong&gt;ï¼Œä¸”éœ€å…¼å®¹æ—§ä»£ç ï¼Œä½¿ç”¨ &lt;code&gt;Collections.synchronizedList()&lt;/code&gt;å¹¶ä¸¥æ ¼åŒæ­¥å†™æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ç›´æ¥æš´éœ² &lt;code&gt;List&lt;/code&gt;ç»™å¤–éƒ¨ä»£ç &lt;/strong&gt;ï¼Œå°è£…ä¿®æ”¹æ–¹æ³•ï¼ˆå¦‚é€šè¿‡æ¥å£é™åˆ¶å¹¶å‘è®¿é—®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®ç»“è®º"&gt;å…³é”®ç»“è®º
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;âœ… &lt;code&gt;ConcurrentHashMap&lt;/code&gt;çš„çº¿ç¨‹å®‰å…¨&lt;strong&gt;ä¸è¦†ç›–å…¶å€¼å¯¹è±¡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;âœ… å­˜å‚¨çš„ &lt;code&gt;List&amp;lt;BaseEdge&amp;gt;&lt;/code&gt;éœ€å•ç‹¬å®ç°çº¿ç¨‹å®‰å…¨ï¼ˆå¦‚ &lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;æˆ–åŒæ­¥åŒ…è£…ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;âœ… è®¾è®¡æ—¶éœ€æ ¹æ®è¯»å†™æ¯”ä¾‹é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼Œå¹¶ä¸¥æ ¼æµ‹è¯•å¹¶å‘åœºæ™¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å¹¶å‘åˆ—è¡¨æˆ–é˜Ÿåˆ—"&gt;å¹¶å‘åˆ—è¡¨æˆ–é˜Ÿåˆ—
&lt;/h2&gt;&lt;p&gt;åœ¨Javaå¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œçº¿ç¨‹å®‰å…¨çš„åˆ—è¡¨ï¼ˆListï¼‰å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰æ˜¯ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œé¿å…å¹¶å‘é—®é¢˜çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯å¸¸è§å®ç°åŠå…¶ç‰¹ç‚¹ï¼Œç»“åˆé€‚ç”¨åœºæ™¯è¿›è¡Œè¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸€çº¿ç¨‹å®‰å…¨åˆ—è¡¨list"&gt;&lt;strong&gt;ä¸€ã€çº¿ç¨‹å®‰å…¨åˆ—è¡¨ï¼ˆListï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Vector&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šæ‰€æœ‰æ–¹æ³•ä½¿ç”¨&lt;code&gt;synchronized&lt;/code&gt;ä¿®é¥°ï¼Œæ•´ä½“åŠ é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šæ€§èƒ½å·®ï¼ˆé”ç²’åº¦ç²—ï¼‰ï¼Œå·²è¿‡æ—¶ï¼Œä»…ç”¨äºå…¼å®¹æ—§ä»£ç ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;String&amp;gt; vector = new Vector&amp;lt;&amp;gt;();
vector.add(&amp;#34;item&amp;#34;);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Collections.synchronizedList()&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šé€šè¿‡åŒæ­¥å—åŒ…è£…ä»»æ„&lt;code&gt;List&lt;/code&gt;ï¼Œæ‰€æœ‰æ“ä½œåŠ é”ï¼ˆé”å¯¹è±¡ä¸ºåŒ…è£…åçš„Listï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¯»å†™æ“ä½œé¢‘ç‡å‡è¡¡çš„ç®€å•åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¿­ä»£æ—¶éœ€æ‰‹åŠ¨åŠ é”ï¼Œå¦åˆ™å¯èƒ½æŠ›å‡º&lt;code&gt;ConcurrentModificationException&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;String&amp;gt; syncList = Collections.synchronizedList(new ArrayList&amp;lt;&amp;gt;());
synchronized (syncList) { // è¿­ä»£æ—¶æ‰‹åŠ¨åŒæ­¥
for (String s : syncList) { ... }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šå†™æ—¶å¤åˆ¶ï¼ˆå†™æ“ä½œå¤åˆ¶æ–°æ•°ç»„ï¼Œæ›¿æ¢å¼•ç”¨ï¼‰ï¼Œè¯»æ“ä½œæ— é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šè¯»æ€§èƒ½æé«˜ï¼Œé€‚åˆ&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;ï¼ˆå¦‚é…ç½®ã€ç¼“å­˜ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå†™æ“ä½œæˆæœ¬é«˜ï¼ˆå¤åˆ¶æ•°ç»„ï¼‰ï¼Œæ•°æ®å®æ—¶æ€§å¼±ï¼ˆè¯»æ“ä½œè®¿é—®æ—§å¿«ç…§ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;String&amp;gt; cowList = new CopyOnWriteArrayList&amp;lt;&amp;gt;();
cowList.add(&amp;#34;item&amp;#34;); // å†™æ“ä½œåŠ é”å¤åˆ¶
String item = cowList.get(0); // è¯»æ“ä½œæ— é”
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äºŒçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—queue"&gt;&lt;strong&gt;äºŒã€çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼ˆQueueï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="éé˜»å¡é˜Ÿåˆ—"&gt;&lt;strong&gt;éé˜»å¡é˜Ÿåˆ—&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåŸºäºCASï¼ˆæ— é”ç®—æ³•ï¼‰çš„é“¾è¡¨é˜Ÿåˆ—ï¼Œæ”¯æŒé«˜å¹¶å‘è¯»å†™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ— ç•Œã€FIFOï¼Œé€‚ç”¨äºé«˜åååœºæ™¯ï¼ˆå¦‚ä»»åŠ¡åˆ†å‘ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Queue&amp;lt;Integer&amp;gt; queue = new ConcurrentLinkedQueue&amp;lt;&amp;gt;();
queue.offer(1); // æ— é˜»å¡
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é˜»å¡é˜Ÿåˆ—å®ç°"&gt;&lt;strong&gt;é˜»å¡é˜Ÿåˆ—ï¼ˆå®ç°&lt;code&gt;BlockingQueue&lt;/code&gt;æ¥å£ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåŸºäºé“¾è¡¨çš„å¯é€‰æœ‰ç•Œé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä½¿ç”¨åˆ†ç¦»é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šé»˜è®¤æ— ç•Œï¼ˆ&lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;ï¼‰ï¼Œå¯æŒ‡å®šå®¹é‡ã€‚&lt;code&gt;put()&lt;/code&gt;å’Œ&lt;code&gt;take()&lt;/code&gt;åœ¨é˜Ÿåˆ—æ»¡/ç©ºæ—¶é˜»å¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼ˆå¦‚çº¿ç¨‹æ± ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;BlockingQueue&amp;lt;String&amp;gt; bq = new LinkedBlockingQueue&amp;lt;&amp;gt;(100);
bq.put(&amp;#34;task&amp;#34;); // é˜Ÿåˆ—æ»¡æ—¶é˜»å¡
String task = bq.take(); // é˜Ÿåˆ—ç©ºæ—¶é˜»å¡
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ArrayBlockingQueue&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜Ÿåˆ—ï¼Œå…¨å±€ä¸€æŠŠé”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šå›ºå®šå®¹é‡ï¼Œæ”¯æŒå…¬å¹³é”ç­–ç•¥ï¼ˆå‡å°‘çº¿ç¨‹é¥¥é¥¿ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;PriorityBlockingQueue&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåŸºäºå †çš„æ— ç•Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå…ƒç´ éœ€å®ç°&lt;code&gt;Comparable&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæŒ‰ä¼˜å…ˆçº§å¤„ç†ä»»åŠ¡ï¼ˆå¦‚ç´§æ€¥ä»»åŠ¡ä¼˜å…ˆï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SynchronousQueue&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šæ— å†…éƒ¨å®¹é‡ï¼Œæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…ç§»é™¤æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šç›´æ¥ä¼ é€’ä»»åŠ¡ï¼Œé€‚ç”¨äºä½å»¶è¿Ÿçº¿ç¨‹åä½œï¼ˆå¦‚&lt;code&gt;Executors.newCachedThreadPool()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸‰é€‰æ‹©å»ºè®®"&gt;&lt;strong&gt;ä¸‰ã€é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®ç°ç±»&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ—è¡¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯»å¤šå†™å°‘ï¼ˆå¦‚é…ç½®ã€ç¼“å­˜ï¼‰&lt;/td&gt;
&lt;td&gt;è¯»æ— é”ï¼Œå†™å¤åˆ¶æ•°ç»„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Collections.synchronizedList&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯»å†™å‡è¡¡&lt;/td&gt;
&lt;td&gt;å…¨æ“ä½œåŠ é”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éé˜»å¡é˜Ÿåˆ—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘è¯»å†™ï¼Œæ— éœ€é˜»å¡&lt;/td&gt;
&lt;td&gt;CASæ— é”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é˜»å¡é˜Ÿåˆ—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹&lt;/td&gt;
&lt;td&gt;åˆ†ç¦»é”ï¼Œååé‡é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ArrayBlockingQueue&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å›ºå®šå®¹é‡ä»»åŠ¡é˜Ÿåˆ—&lt;/td&gt;
&lt;td&gt;å…¨å±€é”ï¼Œå¯é…ç½®å…¬å¹³æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PriorityBlockingQueue&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æŒ‰ä¼˜å…ˆçº§å¤„ç†ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;æ— ç•Œï¼Œå †æ’åº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SynchronousQueue&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;çº¿ç¨‹é—´ç›´æ¥ä¼ é€’ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;æ— ç¼“å†²ï¼Œé…å¯¹æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å››æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;å››ã€æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤åˆæ“ä½œåŸå­æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å³ä½¿ä½¿ç”¨çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¤åˆæ“ä½œï¼ˆå¦‚â€œæ£€æŸ¥-æ›´æ–°â€ï¼‰ä»éœ€é¢å¤–åŒæ­¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;synchronized (list) {
if (!list.contains(x)) list.add(x);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿­ä»£å™¨å®‰å…¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;synchronizedList&lt;/code&gt;è¿­ä»£æ—¶éœ€æ‰‹åŠ¨åŒæ­¥ï¼›&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;è¿­ä»£å™¨ä¸ºå¿«ç…§ï¼Œä¸æ”¯æŒä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é˜Ÿåˆ—é˜»å¡æ§åˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜»å¡é˜Ÿåˆ—çš„&lt;code&gt;put()&lt;/code&gt;/&lt;code&gt;take()&lt;/code&gt;ä¼šæ°¸ä¹…é˜»å¡ï¼Œå¯ä½¿ç”¨&lt;code&gt;offer(e, timeout)&lt;/code&gt;/&lt;code&gt;poll(timeout)&lt;/code&gt;è®¾ç½®è¶…æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¯æ˜¾è‘—æå‡å¤šçº¿ç¨‹ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ã€‚å®é™…å¼€å‘ä¸­éœ€æ ¹æ®è¯»å†™é¢‘ç‡ã€æ•°æ®å®æ—¶æ€§è¦æ±‚åŠå®¹é‡éœ€æ±‚ç»¼åˆæƒè¡¡ã€‚&lt;/p&gt;
&lt;h2 id="æ•°æ®åº“æ‰¹é‡æ’å…¥"&gt;æ•°æ®åº“æ‰¹é‡æ’å…¥
&lt;/h2&gt;&lt;p&gt;åœ¨â€œå†™å¤šè¯»å°‘â€ä¸”éœ€è¦çº¿ç¨‹å®‰å…¨çš„æ•°æ®åº“æ‰¹é‡æ’å…¥åœºæ™¯ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;å¹¶éæœ€åˆé€‚çš„é€‰æ‹©&lt;/strong&gt;ã€‚è™½ç„¶å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„æ— é”é˜Ÿåˆ—ï¼Œä½†å…¶è®¾è®¡æ›´ä¾§é‡äºé«˜å¹¶å‘è¯»å†™å‡è¡¡æˆ–è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œè€Œéçº¯å†™å…¥å¯†é›†å‹ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æå’Œæ›¿ä»£å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-concurrentlinkedqueue-çš„å±€é™æ€§"&gt;âš ï¸ &lt;strong&gt;ConcurrentLinkedQueue çš„å±€é™æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™å¤šè¯»å°‘çš„æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜å ç”¨é«˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªå†™å…¥æ“ä½œéœ€åˆ›å»º &lt;code&gt;Node&lt;/code&gt;å¯¹è±¡ï¼ˆå«æ•°æ®å’ŒæŒ‡é’ˆï¼‰ï¼Œå¤§é‡å†™å…¥æ—¶å¯èƒ½è§¦å‘é¢‘ç¹ GCï¼Œå½±å“ååé‡ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CAS ç«äº‰å¼€é”€&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å†™æ“ä½œä¾èµ– CAS æ›´æ–°å°¾èŠ‚ç‚¹ã€‚è‹¥å†™å…¥çº¿ç¨‹è¿‡å¤šï¼ŒCAS å¤±è´¥é‡è¯•æ¦‚ç‡å¢åŠ ï¼Œå¯¼è‡´ CPU ç©ºè½¬ï¼Œåè€Œé™ä½æ€§èƒ½ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡æ’å…¥çš„é€‚é…æ€§é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— é˜»å¡æœºåˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;ä¸æ”¯æŒé˜»å¡å¼æ‰¹é‡æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…éœ€ä¸»åŠ¨è½®è¯¢ï¼ˆ&lt;code&gt;poll&lt;/code&gt;ï¼‰ï¼Œåœ¨é˜Ÿåˆ—ç©ºæ—¶é€ æˆ CPU æµªè´¹ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼±ä¸€è‡´æ€§å¹²æ‰°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;size()&lt;/code&gt;å’Œ &lt;code&gt;isEmpty()&lt;/code&gt;ç»“æœä¸å‡†ç¡®ï¼Œéš¾ä»¥ç²¾ç¡®è§¦å‘æ‰¹é‡æ’å…¥ï¼ˆä¾‹å¦‚æ¯ç§¯ç´¯ 100 æ¡æ•°æ®å†™å…¥ä¸€æ¬¡ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸æ•°æ®åº“æ‰¹é‡å†™å…¥çš„ååŒæ•ˆç‡ä½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯»æ“ä½œæˆæœ¬&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ‰¹é‡æ’å…¥éœ€éå†é˜Ÿåˆ—å–å‡ºå¤šæ¡æ•°æ®ï¼ˆå¦‚å¾ªç¯ &lt;code&gt;poll&lt;/code&gt;ï¼‰ï¼Œè€Œ &lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;çš„éå†æ•ˆç‡è¾ƒä½ï¼ˆéœ€å¤„ç†å¹¶å‘ä¿®æ”¹çš„å¼±ä¸€è‡´æ€§ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºä¹äº‹åŠ¡æ•´åˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ— æ³•ç›´æ¥å…³è”é˜Ÿåˆ—æ¶ˆè´¹ä¸æ•°æ®åº“äº‹åŠ¡ï¼Œéœ€é¢å¤–å°è£…äº‹åŠ¡è¾¹ç•Œï¼Œå¢åŠ å¤æ‚åº¦ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ›´ä¼˜æ›¿ä»£æ–¹æ¡ˆ"&gt;âœ… &lt;strong&gt;æ›´ä¼˜æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-linkedblockingqueue"&gt;1. &lt;strong&gt;&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;+ æ‰¹é‡æ¶ˆè´¹è€…çº¿ç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¾è®¡åŸç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ‰ç•Œé˜Ÿåˆ—&lt;/strong&gt;ï¼šé™åˆ¶å†…å­˜å ç”¨ï¼Œé¿å… OOMï¼ˆå¦‚è®¾ç½®å®¹é‡ 10,000ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡å¼æ¶ˆè´¹&lt;/strong&gt;ï¼šæ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ &lt;code&gt;take()&lt;/code&gt;åœ¨é˜Ÿåˆ—ç©ºæ—¶è‡ªåŠ¨æŒ‚èµ·ï¼Œå‡å°‘ CPU ç©ºè½¬ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡æ’å…¥å®ç°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// æ¶ˆè´¹è€…çº¿ç¨‹ç¤ºä¾‹
while (true) {
List&amp;lt;Data&amp;gt; buffer = new ArrayList&amp;lt;&amp;gt;(BATCH_SIZE);
// é˜»å¡ç›´åˆ°è·å–ç¬¬ä¸€æ¡æ•°æ®
Data first = queue.take();
buffer.add(first);
// éé˜»å¡è·å–å‰©ä½™æ•°æ®
queue.drainTo(buffer, BATCH_SIZE - 1);
database.batchInsert(buffer); // æ‰¹é‡æ’å…¥
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;drainTo&lt;/code&gt;æ‰¹é‡è½¬ç§»æ•°æ®ï¼Œå‡å°‘é”ç«äº‰ ã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆäº‹åŠ¡æå‡æ’å…¥æ•ˆç‡ï¼ˆå•äº‹åŠ¡æ’å…¥å¤šæ¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-æ‰‹åŠ¨é˜Ÿåˆ—--é”åŒæ­¥"&gt;2. &lt;strong&gt;æ‰‹åŠ¨é˜Ÿåˆ— + é”åŒæ­¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;éœ€æè‡´ä¼˜åŒ–å†™å…¥æ€§èƒ½ï¼ˆå¦‚æ¯ç§’æ•°ä¸‡æ¡ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// è‡ªå®šä¹‰ç¯å½¢ç¼“å†²åŒºï¼ˆRing Bufferï¼‰
public class BatchBuffer {
private final Data[] buffer;
private int count = 0;
private final ReentrantLock lock = new ReentrantLock();
public void add(Data data) {
lock.lock();
try {
buffer[count++] = data;
if (count == BATCH_SIZE) {
database.batchInsert(Arrays.copyOf(buffer, count));
count = 0;
}
} finally {
lock.unlock();
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›¶å†…å­˜åˆ†é…ï¼ˆå¤ç”¨æ•°ç»„ï¼‰ï¼Œé¿å… GC å‹åŠ› ã€‚&lt;/li&gt;
&lt;li&gt;é”ç²’åº¦å¯æ§ï¼Œå‡å°‘ç«äº‰ï¼ˆå¦‚åˆ†æ®µé”ä¼˜åŒ–ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”"&gt;âš–ï¸ &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;+ æ‰¹é‡æ¶ˆè´¹&lt;/th&gt;
&lt;th&gt;æ‰‹åŠ¨é˜Ÿåˆ— + é”&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™å…¥æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆæ— é”ï¼‰ä½† CAS å¯èƒ½ç«äº‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆé”ä¼˜åŒ–åï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆé”ç²’åº¦å¯æ§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— ç•Œï¼Œæ˜“ OOM&lt;/td&gt;
&lt;td&gt;æœ‰ç•Œï¼Œå¯æ§&lt;/td&gt;
&lt;td&gt;å›ºå®šå¤§å°ï¼Œæ— åŠ¨æ€åˆ†é…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰¹é‡æ¶ˆè´¹æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ éœ€æ‰‹åŠ¨è½®è¯¢&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;drainTo&lt;/code&gt;é«˜æ•ˆè½¬ç§»&lt;/td&gt;
&lt;td&gt;âœ… å†…ç½®è§¦å‘æœºåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;CPU åˆ©ç”¨ç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå†™ç«äº‰æ—¶ CPU ç©ºè½¬ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆé˜»å¡å¼ç­‰å¾…ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆé”ç«äº‰å¯æ§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¯»å†™å‡è¡¡çš„é«˜å¹¶å‘ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;å†™å¤šè¯»å°‘çš„æ‰¹é‡æ’å…¥&lt;/td&gt;
&lt;td&gt;è¶…é«˜é¢‘å†™å…¥çš„å®šåˆ¶åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ç»“è®ºä¸å»ºè®®"&gt;ğŸ’ &lt;strong&gt;ç»“è®ºä¸å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…ä½¿ç”¨ &lt;code&gt;ConcurrentLinkedQueue&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨&lt;strong&gt;å†™å¤šè¯»å°‘&lt;/strong&gt;çš„æ•°æ®åº“æ‰¹é‡æ’å…¥ä¸­ï¼Œå…¶æ— ç•Œç‰¹æ€§ã€å†…å­˜å¼€é”€å’Œå¼±ä¸€è‡´æ€§ä¼šæ‹–ç´¯æ€§èƒ½ï¼Œä¸”æ— æ³•ç›´æ¥æ”¯æŒé«˜æ•ˆæ‰¹é‡æ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¦–é€‰ &lt;code&gt;LinkedBlockingQueue&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;strong&gt;æœ‰ç•Œå®¹é‡&lt;/strong&gt; é˜²æ­¢å†…å­˜æº¢å‡ºï¼›&lt;/li&gt;
&lt;li&gt;ç»“åˆ &lt;strong&gt;&lt;code&gt;drainTo&lt;/code&gt;&lt;/strong&gt; å®ç°é›¶æ‹·è´æ‰¹é‡è½¬ç§»ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…çº¿ç¨‹ &lt;strong&gt;é˜»å¡ç­‰å¾…&lt;/strong&gt; èŠ‚çœ CPU ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¶…é«˜æ€§èƒ½åœºæ™¯è€ƒè™‘æ‰‹åŠ¨å®ç°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è‹¥ååé‡è¦æ±‚æé«˜ï¼ˆå¦‚ç™¾ä¸‡çº§/ç§’ï¼‰ï¼Œå¯åŸºäºç¯å½¢ç¼“å†²åŒºå’Œåˆ†æ®µé”å®šåˆ¶é˜Ÿåˆ—ï¼Œæœ€å¤§åŒ–å†™å…¥æ•ˆç‡ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;é™„åŠ ä¼˜åŒ–å»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­å¯ç”¨æ•°æ®åº“äº‹åŠ¡æ‰¹é‡æäº¤ï¼ˆå¦‚æ¯ 1000 æ¡ä¸€æäº¤ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è°ƒæ•´ SQLite WAL æ¨¡å¼æˆ–è¿æ¥æ± å‚æ•°ï¼Œé™ä½å†™å…¥å»¶è¿Ÿ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;</description></item><item><title>ã€Shopeeã€‘Java Parser</title><link>https://dyhes.github.io/p/shopeejava-parser/</link><pubDate>Mon, 18 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeejava-parser/</guid><description>&lt;h2 id="javaparser-æ³¨è§£"&gt;JavaParser æ³¨è§£
&lt;/h2&gt;&lt;p&gt;è¦ä½¿ç”¨ &lt;code&gt;com.github.javaparser.JavaParser&lt;/code&gt;è§£æç‰¹å®šæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@RestController&lt;/code&gt;ï¼‰ï¼Œéœ€é€šè¿‡è§£æ Java æºä»£ç çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰å¹¶éå†ç›®æ ‡å…ƒç´ ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µï¼‰çš„æ³¨è§£åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯å…·ä½“æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-åŸºæœ¬è§£ææµç¨‹"&gt;&lt;strong&gt;1. åŸºæœ¬è§£ææµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ­¥éª¤æ¦‚è¿°"&gt;&lt;strong&gt;æ­¥éª¤æ¦‚è¿°&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£ææºä»£ç &lt;/strong&gt;ï¼šå°† Java æ–‡ä»¶æˆ–å­—ç¬¦ä¸²è§£æä¸º &lt;code&gt;CompilationUnit&lt;/code&gt;ï¼ˆAST çš„æ ¹èŠ‚ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šä½ç›®æ ‡å…ƒç´ &lt;/strong&gt;ï¼šéå† AST æ‰¾åˆ°éœ€è¦æ£€æŸ¥çš„ç±»ã€æ–¹æ³•æˆ–å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥æ³¨è§£&lt;/strong&gt;ï¼šéå†å…ƒç´ çš„æ³¨è§£åˆ—è¡¨ï¼ŒåŒ¹é…ç›®æ ‡æ³¨è§£çš„åç§°æˆ–å‚æ•°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ä»£ç ç¤ºä¾‹"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import com.github.javaparser.StaticJavaParser;
import com.github.javaparser.ast.CompilationUnit;
import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;
import java.io.File;
public class AnnotationParser {
public static void main(String[] args) throws Exception {
// 1. è§£æJavaæ–‡ä»¶
CompilationUnit cu = StaticJavaParser.parse(new File(&amp;#34;YourClass.java&amp;#34;));
// 2. éå†æ‰€æœ‰ç±»å£°æ˜
cu.findAll(ClassOrInterfaceDeclaration.class).forEach(clazz -&amp;gt; {
// 3. æ£€æŸ¥ç±»æ˜¯å¦åŒ…å«@RestControlleræ³¨è§£
boolean hasRestController = clazz.getAnnotations().stream()
.anyMatch(annotation -&amp;gt;
annotation.getNameAsString().equals(&amp;#34;RestController&amp;#34;)
);
System.out.println(&amp;#34;Class has @RestController: &amp;#34; + hasRestController);
});
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="2-è§£ææ³¨è§£çš„ç»†èŠ‚"&gt;&lt;strong&gt;2. è§£ææ³¨è§£çš„ç»†èŠ‚&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ³¨è§£åç§°åŒ¹é…"&gt;&lt;strong&gt;æ³¨è§£åç§°åŒ¹é…&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ³¨è§£åç§°éœ€ä¸æºä»£ç ä¸­çš„å†™æ³•ä¸€è‡´ï¼ˆå¦‚ &lt;code&gt;&amp;quot;RestController&amp;quot;&lt;/code&gt;è€Œéå…¨é™å®šå &lt;code&gt;org.springframework.web.bind.annotation.RestController&lt;/code&gt;ï¼‰ã€‚è‹¥éœ€å¤„ç†å…¨é™å®šåï¼Œéœ€æ£€æŸ¥æ³¨è§£çš„ &lt;code&gt;QualifiedName&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è·å–æ³¨è§£å‚æ•°"&gt;&lt;strong&gt;è·å–æ³¨è§£å‚æ•°&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥æ³¨è§£å¸¦å‚æ•°ï¼ˆå¦‚ &lt;code&gt;@RequestMapping(&amp;quot;/path&amp;quot;)&lt;/code&gt;ï¼‰ï¼Œå¯æå–å‚æ•°å€¼ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;clazz.getAnnotations().forEach(annotation -&amp;gt; {
if (annotation.getNameAsString().equals(&amp;#34;RequestMapping&amp;#34;)) {
annotation.ifSingleMemberValueExpr(expr -&amp;gt; {
String path = expr.toString(); // ä¾‹å¦‚ï¼šè·å– &amp;#34;/path&amp;#34;
System.out.println(&amp;#34;Path: &amp;#34; + path);
});
}
});
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤å¤„ &lt;code&gt;ifSingleMemberValueExpr&lt;/code&gt;é€‚ç”¨äºå•å‚æ•°æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@RequestMapping&lt;/code&gt;ï¼‰ã€‚å¤šå‚æ•°æ³¨è§£éœ€éå†é”®å€¼å¯¹ ã€‚&lt;/p&gt;
&lt;h4 id="è·å–æ³¨è§£ä½ç½®"&gt;&lt;strong&gt;è·å–æ³¨è§£ä½ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;getRange()&lt;/code&gt;è·å–æ³¨è§£åœ¨æºä»£ç ä¸­çš„è¡Œå·ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;annotation.getRange().ifPresent(range -&amp;gt; {
int startLine = range.begin.line;
System.out.println(&amp;#34;Annotation at line: &amp;#34; + startLine);
});
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="3-æ‰©å±•åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;3. æ‰©å±•åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ–¹æ³•å­—æ®µçº§æ³¨è§£"&gt;&lt;strong&gt;æ–¹æ³•/å­—æ®µçº§æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç±»ä¼¼åœ°ï¼Œå¯æ£€æŸ¥æ–¹æ³•æˆ–å­—æ®µçš„æ³¨è§£ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;cu.findAll(MethodDeclaration.class).forEach(method -&amp;gt; {
boolean hasMapping = method.getAnnotations().stream()
.anyMatch(anno -&amp;gt; anno.getNameAsString().equals(&amp;#34;GetMapping&amp;#34;));
System.out.println(&amp;#34;Method has @GetMapping: &amp;#34; + hasMapping);
});
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ä¾èµ–é…ç½®"&gt;&lt;strong&gt;ä¾èµ–é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;éœ€åœ¨é¡¹ç›®ä¸­æ·»åŠ  JavaParser ä¾èµ–ï¼ˆMavenï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.github.javaparser&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;javaparser-core&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;3.28.0&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="4-æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;4. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£åç§°åŒ¹é…&lt;/strong&gt;ï¼šéœ€è€ƒè™‘å¯¼å…¥è¯­å¥ï¼ˆå¦‚ &lt;code&gt;import org.springframework.web.bind.annotation.*;&lt;/code&gt;ï¼‰ï¼Œå¦åˆ™éœ€æ£€æŸ¥å…¨é™å®šåã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åµŒå¥—æ³¨è§£&lt;/strong&gt;ï¼šè‹¥æ³¨è§£åµŒå¥—åœ¨ç»„åˆæ³¨è§£ä¸­ï¼ˆå¦‚ &lt;code&gt;@SpringBootApplication&lt;/code&gt;åŒ…å« &lt;code&gt;@RestController&lt;/code&gt;ï¼‰ï¼Œéœ€é€’å½’è§£æ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°ç±»å‹å¤„ç†&lt;/strong&gt;ï¼šæ³¨è§£å‚æ•°å¯èƒ½æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„æˆ–æšä¸¾ï¼Œéœ€è°ƒç”¨ &lt;code&gt;asStringLiteralExpr()&lt;/code&gt;ã€&lt;code&gt;asArrayInitializerExpr()&lt;/code&gt;ç­‰æ–¹æ³•è½¬æ¢ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯çµæ´»è§£æä»»æ„æ³¨è§£åŠå…¶å±æ€§ï¼Œé€‚ç”¨äºä»£ç å®¡è®¡ã€æ–‡æ¡£ç”Ÿæˆç­‰åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id="visitor"&gt;Visitor
&lt;/h2&gt;&lt;p&gt;è¦å°†ç»™å®šçš„JavaParserä»£ç è½¬æ¢ä¸ºè®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰å½¢å¼ï¼Œéœ€é€šè¿‡å®šä¹‰è‡ªå®šä¹‰è®¿é—®è€…ç±»æ¥è§£è€¦ASTéå†ä¸æ³¨è§£æ£€æŸ¥é€»è¾‘ã€‚ä»¥ä¸‹ä¸ºé‡æ„åçš„ä»£ç åŠæ•ˆç‡åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-é‡æ„ä¸ºè®¿é—®è€…æ¨¡å¼"&gt;&lt;strong&gt;1. é‡æ„ä¸ºè®¿é—®è€…æ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ­¥éª¤è¯´æ˜"&gt;&lt;strong&gt;æ­¥éª¤è¯´æ˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æ³¨è§£è®¿é—®è€…ç±»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç»§æ‰¿&lt;code&gt;VoidVisitorAdapter&lt;/code&gt;ï¼Œé‡å†™&lt;code&gt;visit&lt;/code&gt;æ–¹æ³•å¤„ç†ç‰¹å®šèŠ‚ç‚¹ï¼ˆå¦‚ç±»å£°æ˜ï¼‰çš„æ³¨è§£æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£è€¦éå†ä¸æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å°†æ³¨è§£æ£€æŸ¥é€»è¾‘å°è£…åœ¨è®¿é—®è€…å†…éƒ¨ï¼Œé¿å…åœ¨&lt;code&gt;main&lt;/code&gt;æ–¹æ³•ä¸­æ··åˆéå†ä¸ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŒ–éå†è¿‡ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡è®¿é—®è€…æ¨¡å¼è‡ªåŠ¨é€’å½’éå†ASTï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨&lt;code&gt;findAll&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é‡æ„ä»£ç "&gt;&lt;strong&gt;é‡æ„ä»£ç &lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import com.github.javaparser.StaticJavaParser;
import com.github.javaparser.ast.CompilationUnit;
import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;
import com.github.javaparser.ast.visitor.VoidVisitorAdapter;
import java.io.File;
// è‡ªå®šä¹‰è®¿é—®è€…ï¼šæ£€æŸ¥@RestControlleræ³¨è§£
class RestControllerVisitor extends VoidVisitorAdapter&amp;lt;Void&amp;gt; {
@Override
public void visit(ClassOrInterfaceDeclaration clazz, Void arg) {
super.visit(clazz, arg);
boolean hasRestController = clazz.getAnnotations().stream()
.anyMatch(anno -&amp;gt; anno.getNameAsString().equals(&amp;#34;RestController&amp;#34;));
System.out.println(&amp;#34;Class &amp;#34; + clazz.getName() + &amp;#34; has @RestController: &amp;#34; + hasRestController);
}
}
public class AnnotationParser {
public static void main(String[] args) throws Exception {
CompilationUnit cu = StaticJavaParser.parse(new File(&amp;#34;YourClass.java&amp;#34;));
// ä½¿ç”¨è®¿é—®è€…éå†AST
RestControllerVisitor visitor = new RestControllerVisitor();
visitor.visit(cu, null);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å…³é”®æ”¹è¿›"&gt;&lt;strong&gt;å…³é”®æ”¹è¿›&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³æ³¨ç‚¹åˆ†ç¦»&lt;/strong&gt;ï¼šæ³¨è§£æ£€æŸ¥é€»è¾‘ç‹¬ç«‹å°è£…åœ¨&lt;code&gt;RestControllerVisitor&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éšå¼é€’å½’éå†&lt;/strong&gt;ï¼šè®¿é—®è€…è‡ªåŠ¨å¤„ç†ASTçš„é€’å½’éå†ï¼Œé¿å…æ‰‹åŠ¨è¿­ä»£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;ï¼šæ–°å¢æ“ä½œï¼ˆå¦‚æ–¹æ³•/å­—æ®µæ³¨è§£æ£€æŸ¥ï¼‰åªéœ€æ·»åŠ æ–°è®¿é—®è€…ï¼Œæ— éœ€ä¿®æ”¹åŸæœ‰ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-è®¿é—®è€…æ¨¡å¼çš„æ•ˆç‡åˆ†æ"&gt;&lt;strong&gt;2. è®¿é—®è€…æ¨¡å¼çš„æ•ˆç‡åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä¼˜åŠ¿åœºæ™¯"&gt;&lt;strong&gt;ä¼˜åŠ¿åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤æ‚æ“ä½œä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“éœ€å¯¹ASTè¿›è¡Œ&lt;strong&gt;å¤šç§æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚åŒæ—¶æ£€æŸ¥æ³¨è§£ã€ç»Ÿè®¡æ–¹æ³•æ•°ï¼‰æ—¶ï¼Œè®¿é—®è€…æ¨¡å¼é¿å…é‡å¤éå†ï¼Œæ•ˆç‡æ›´é«˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šåœ¨å•æ¬¡éå†ä¸­ï¼Œå¤šä¸ªè®¿é—®è€…å¯ååŒå¤„ç†ä¸åŒä»»åŠ¡ï¼ˆé€šè¿‡&lt;code&gt;CompositeVisitor&lt;/code&gt;ç»„åˆï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å±€éƒ¨éå†æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è®¿é—®è€…å¯è·³è¿‡æ— å…³èŠ‚ç‚¹ï¼ˆå¦‚å¿½ç•¥æ–¹æ³•å†…éƒ¨ä»£ç ï¼‰ï¼Œå‡å°‘ä¸å¿…è¦çš„å­æ ‘è§£æã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;JavaParserå†…ç½®çš„è®¿é—®è€…å®ç°ï¼ˆå¦‚&lt;code&gt;VoidVisitorAdapter&lt;/code&gt;ï¼‰å·²ä¼˜åŒ–éå†ç®—æ³•ï¼Œå‡å°‘ASTè§£æå¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ½œåœ¨å¼€é”€"&gt;&lt;strong&gt;æ½œåœ¨å¼€é”€&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°è§„æ¨¡æ–‡ä»¶&lt;/strong&gt;ï¼šè‹¥ä»…æ£€æŸ¥å•ä¸ªæ³¨è§£ï¼Œ&lt;strong&gt;è¿‡ç¨‹å¼ä»£ç ï¼ˆåŸä»£ç ï¼‰æ›´è½»é‡&lt;/strong&gt;ï¼Œå› è®¿é—®è€…æ¨¡å¼éœ€åˆ›å»ºé¢å¤–ç±»åŠè°ƒç”¨æ ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•æ“ä½œ&lt;/strong&gt;ï¼šå•ä¸€æ“ä½œï¼ˆå¦‚ä»…æ£€æŸ¥ç±»æ³¨è§£ï¼‰æ—¶ï¼Œè®¿é—®è€…æ¨¡å¼å› åŒåˆ†æ´¾æœºåˆ¶ï¼ˆ&lt;code&gt;accept-visit&lt;/code&gt;è°ƒç”¨é“¾ï¼‰ç•¥æœ‰æ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-ä½•æ—¶ä½¿ç”¨è®¿é—®è€…æ¨¡å¼"&gt;&lt;strong&gt;3. ä½•æ—¶ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å•ä¸€ç®€å•æ“ä½œï¼ˆå¦‚æ£€æŸ¥å•ä¸ªæ³¨è§£ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¿‡ç¨‹å¼éå†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€æ´ï¼Œæ— é¢å¤–ç±»å¼€é”€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚/å¤šæ“ä½œï¼ˆå¦‚ä»£ç å®¡æŸ¥å·¥å…·ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®¿é—®è€…æ¨¡å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…é‡å¤éå†ï¼Œé€»è¾‘è§£è€¦ï¼Œæ‰©å±•æ€§å¼ºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éœ€æ·±åº¦å®šåˆ¶éå†é€»è¾‘&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®¿é—®è€…æ¨¡å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯è¦†ç›–&lt;code&gt;visit&lt;/code&gt;æ–¹æ³•æ§åˆ¶èŠ‚ç‚¹è®¿é—®é¡ºåºï¼ˆå¦‚è·³è¿‡å­èŠ‚ç‚¹ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="4-æ€§èƒ½å¯¹æ¯”ç»“è®º"&gt;&lt;strong&gt;4. æ€§èƒ½å¯¹æ¯”ç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;âœ… &lt;strong&gt;è®¿é—®è€…æ¨¡å¼æ›´é«˜æ•ˆçš„æƒ…å†µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€æ‰§è¡Œ&lt;strong&gt;å¤šä¸ªæ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚åŒæ—¶æ£€æŸ¥æ³¨è§£+ç”Ÿæˆæ–‡æ¡£ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¡¹ç›®&lt;strong&gt;æŒç»­æ‰©å±•&lt;/strong&gt;ï¼ˆéœ€æ–°å¢ASTæ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€&lt;strong&gt;ç²¾ç»†æ§åˆ¶éå†è·¯å¾„&lt;/strong&gt;ï¼ˆå¦‚å¿½ç•¥æŸäº›èŠ‚ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;âŒ &lt;strong&gt;åŸè¿‡ç¨‹å¼ä»£ç æ›´é«˜æ•ˆçš„æƒ…å†µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»…éœ€&lt;strong&gt;ä¸€æ¬¡æ€§ç®€å•æŸ¥è¯¢&lt;/strong&gt;ï¼ˆå¦‚å•æ³¨è§£æ£€æŸ¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç›®æ ‡æ–‡ä»¶&lt;strong&gt;è§„æ¨¡æå°&lt;/strong&gt;ï¼ˆ&amp;lt;100è¡Œä»£ç ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šå¤§å‹é¡¹ç›®æˆ–å¤æ‚å·¥å…·ï¼ˆå¦‚ä»£ç åˆ†æå™¨ï¼‰ä¼˜å…ˆä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼›å°å‹è„šæœ¬å¯ä¿ç•™è¿‡ç¨‹å¼ä»£ç ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="ç»Ÿåˆ"&gt;ç»Ÿåˆ
&lt;/h2&gt;&lt;p&gt;åœ¨è®¿é—®è€…æ¨¡å¼ä¸­å®ç°å¯¹å¤šç§ä¸åŒç±»å‹æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@RestController&lt;/code&gt;å’Œ &lt;code&gt;@GetMapping&lt;/code&gt;ï¼‰çš„æ£€æŸ¥ï¼Œéœ€é€šè¿‡ &lt;strong&gt;åˆ†å±‚è®¿é—®è€…è®¾è®¡&lt;/strong&gt; å’Œ &lt;strong&gt;ç±»å‹åˆ†æ´¾æœºåˆ¶&lt;/strong&gt; å®ç°é«˜æ•ˆä¸”è§£è€¦çš„ä»£ç ç»“æ„ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆå’Œä¼˜åŒ–å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€å¤šæ³¨è§£æ£€æŸ¥çš„è®¿é—®è€…æ¨¡å¼å®ç°"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€å¤šæ³¨è§£æ£€æŸ¥çš„è®¿é—®è€…æ¨¡å¼å®ç°&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ ¸å¿ƒè®¾è®¡æ€è·¯"&gt;&lt;strong&gt;1. æ ¸å¿ƒè®¾è®¡æ€è·¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€è®¿é—®æ¥å£&lt;/strong&gt;ï¼šå®šä¹‰ &lt;code&gt;AnnotationVisitor&lt;/code&gt;æ¥å£ï¼Œå£°æ˜å¯¹ä¸åŒæ³¨è§£çš„è®¿é—®æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…·ä½“è®¿é—®è€…å®ç°&lt;/strong&gt;ï¼šä¸ºæ¯ç±»æ³¨è§£åˆ›å»ºç‹¬ç«‹è®¿é—®è€…ï¼ˆå¦‚ &lt;code&gt;RestControllerVisitor&lt;/code&gt;ã€&lt;code&gt;GetMappingVisitor&lt;/code&gt;ï¼‰ï¼Œå®ç°æ³¨è§£æ£€æŸ¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AST èŠ‚ç‚¹åˆ†æ´¾&lt;/strong&gt;ï¼šåœ¨ç±»/æ–¹æ³•èŠ‚ç‚¹ä¸­è°ƒç”¨è®¿é—®è€…çš„å¯¹åº”æ–¹æ³•ï¼Œå®ç°åŒé‡åˆ†æ´¾ï¼ˆèŠ‚ç‚¹ç±»å‹ + æ³¨è§£ç±»å‹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ä»£ç å®ç°ç¤ºä¾‹"&gt;&lt;strong&gt;2. ä»£ç å®ç°ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import com.github.javaparser.ast.CompilationUnit;
import com.github.javaparser.ast.body.*;
import com.github.javaparser.ast.visitor.VoidVisitorAdapter;
// 1. å®šä¹‰æ³¨è§£è®¿é—®è€…æ¥å£
interface AnnotationVisitor {
void visitRestController(ClassOrInterfaceDeclaration clazz);
void visitGetMapping(MethodDeclaration method);
}
// 2. å®ç°å…·ä½“è®¿é—®è€…ï¼ˆæ£€æŸ¥ @RestControllerï¼‰
class RestControllerVisitorImpl implements AnnotationVisitor {
@Override
public void visitRestController(ClassOrInterfaceDeclaration clazz) {
boolean hasAnnotation = clazz.getAnnotations().stream()
.anyMatch(anno -&amp;gt; anno.getNameAsString().equals(&amp;#34;RestController&amp;#34;));
System.out.println(&amp;#34;Class has @RestController: &amp;#34; + hasAnnotation);
}
@Override
public void visitGetMapping(MethodDeclaration method) {} // æ— éœ€å®ç°
}
// 3. å®ç°å…·ä½“è®¿é—®è€…ï¼ˆæ£€æŸ¥ @GetMappingï¼‰
class GetMappingVisitorImpl implements AnnotationVisitor {
@Override
public void visitRestController(ClassOrInterfaceDeclaration clazz) {} // æ— éœ€å®ç°
@Override
public void visitGetMapping(MethodDeclaration method) {
boolean hasAnnotation = method.getAnnotations().stream()
.anyMatch(anno -&amp;gt; anno.getNameAsString().equals(&amp;#34;GetMapping&amp;#34;));
System.out.println(&amp;#34;Method has @GetMapping: &amp;#34; + hasAnnotation);
}
}
// 4. AST èŠ‚ç‚¹è®¿é—®è€…ï¼ˆåˆ†æ´¾æ³¨è§£æ£€æŸ¥ï¼‰
class AnnotationCheckVisitor extends VoidVisitorAdapter&amp;lt;AnnotationVisitor&amp;gt; {
@Override
public void visit(ClassOrInterfaceDeclaration clazz, AnnotationVisitor visitor) {
super.visit(clazz, visitor);
visitor.visitRestController(clazz); // åˆ†æ´¾åˆ°å…·ä½“æ³¨è§£æ£€æŸ¥
}
@Override
public void visit(MethodDeclaration method, AnnotationVisitor visitor) {
super.visit(method, visitor);
visitor.visitGetMapping(method); // åˆ†æ´¾åˆ°å…·ä½“æ³¨è§£æ£€æŸ¥
}
}
// 5. å®¢æˆ·ç«¯è°ƒç”¨
public class Main {
public static void main(String[] args) {
CompilationUnit cu = StaticJavaParser.parse(&amp;#34;/* æºä»£ç  */&amp;#34;);
AnnotationCheckVisitor dispatcher = new AnnotationCheckVisitor();
// ç»„åˆå¤šä¸ªæ³¨è§£æ£€æŸ¥
AnnotationVisitor[] visitors = {
new RestControllerVisitorImpl(),
new GetMappingVisitorImpl()
};
// å•æ¬¡éå†æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥
for (AnnotationVisitor visitor : visitors) {
cu.accept(dispatcher, visitor);
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-äºŒå…³é”®æŠ€æœ¯ç‚¹è§£æ"&gt;âš™ï¸ &lt;strong&gt;äºŒã€å…³é”®æŠ€æœ¯ç‚¹è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-åŒé‡åˆ†æ´¾æœºåˆ¶"&gt;&lt;strong&gt;1. åŒé‡åˆ†æ´¾æœºåˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€æ¬¡åˆ†æ´¾&lt;/strong&gt;ï¼šAST èŠ‚ç‚¹ï¼ˆå¦‚ &lt;code&gt;ClassOrInterfaceDeclaration&lt;/code&gt;ï¼‰çš„ &lt;code&gt;accept()&lt;/code&gt;æ–¹æ³•è°ƒç”¨è®¿é—®è€…çš„ &lt;code&gt;visit()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬äºŒæ¬¡åˆ†æ´¾&lt;/strong&gt;ï¼šè®¿é—®è€…çš„ &lt;code&gt;visitRestController()&lt;/code&gt;æˆ– &lt;code&gt;visitGetMapping()&lt;/code&gt;å¤„ç†å…·ä½“æ³¨è§£é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-æ³¨è§£å‚æ•°æå–"&gt;&lt;strong&gt;2. æ³¨è§£å‚æ•°æå–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€æ£€æŸ¥æ³¨è§£å‚æ•°ï¼ˆå¦‚ &lt;code&gt;@GetMapping(&amp;quot;/path&amp;quot;)&lt;/code&gt;ï¼‰ï¼Œåœ¨å…·ä½“è®¿é—®è€…ä¸­è§£æ &lt;code&gt;AnnotationExpr&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// åœ¨ GetMappingVisitorImpl ä¸­
@Override
public void visitGetMapping(MethodDeclaration method) {
method.getAnnotations().forEach(anno -&amp;gt; {
if (&amp;#34;GetMapping&amp;#34;.equals(anno.getNameAsString())) {
anno.ifSingleMemberValueExpr(expr -&amp;gt; {
String path = expr.asStringLiteralExpr().asString();
System.out.println(&amp;#34;Path: &amp;#34; + path);
});
}
});
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="3-æ”¯æŒåµŒå¥—æ³¨è§£"&gt;&lt;strong&gt;3. æ”¯æŒåµŒå¥—æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥æ³¨è§£åµŒå¥—ï¼ˆå¦‚ &lt;code&gt;@RequestMapping(method = RequestMethod.GET)&lt;/code&gt;ï¼‰ï¼Œéœ€é€’å½’è§£æï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;anno.getChildNodes().stream()
.filter(node -&amp;gt; node instanceof AnnotationExpr)
.map(node -&amp;gt; (AnnotationExpr) node)
.forEach(nestedAnno -&amp;gt; { /* å¤„ç†åµŒå¥— */ });
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ä¸‰æ€§èƒ½ä¸æ‰©å±•æ€§ä¼˜åŒ–"&gt;ğŸš€ &lt;strong&gt;ä¸‰ã€æ€§èƒ½ä¸æ‰©å±•æ€§ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-é¿å…é‡å¤éå†"&gt;&lt;strong&gt;1. é¿å…é‡å¤éå†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•æ¬¡éå†å¤šæ£€æŸ¥&lt;/strong&gt;ï¼šé€šè¿‡ç»„åˆæ¨¡å¼ï¼Œåœ¨å•æ¬¡ AST éå†ä¸­æ‰§è¡Œæ‰€æœ‰æ³¨è§£æ£€æŸ¥ï¼Œå‡å°‘ I/O å’Œè§£æå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€éƒ¨è§£ææ§åˆ¶&lt;/strong&gt;ï¼šåœ¨è®¿é—®è€…ä¸­è·³è¿‡æ— å…³èŠ‚ç‚¹ï¼ˆå¦‚å­—æ®µå£°æ˜ï¼‰ï¼Œä»…éå†ç±»å’Œæ–¹æ³•èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-åŠ¨æ€æ‰©å±•æ–°æ³¨è§£"&gt;&lt;strong&gt;2. åŠ¨æ€æ‰©å±•æ–°æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æ–°å¢æ³¨è§£æ£€æŸ¥åªéœ€ä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ &lt;code&gt;AnnotationVisitor&lt;/code&gt;æ¥å£æ·»åŠ æ–°æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;visitPostMapping()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æ–°çš„å…·ä½“è®¿é—®è€…ç±»ï¼ˆå¦‚ &lt;code&gt;PostMappingVisitorImpl&lt;/code&gt;ï¼‰ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="3-ç¼“å­˜ä¼˜åŒ–"&gt;&lt;strong&gt;3. ç¼“å­˜ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£åç§°ç¼“å­˜&lt;/strong&gt;ï¼šé¢„åŠ è½½å¸¸ç”¨æ³¨è§£åï¼ˆå¦‚ &lt;code&gt;RestController&lt;/code&gt;ã€&lt;code&gt;GetMapping&lt;/code&gt;ï¼‰ï¼Œé¿å…é‡å¤å­—ç¬¦ä¸²æ¯”è¾ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AST ç¼“å­˜&lt;/strong&gt;ï¼šå¯¹åŒä¸€æ–‡ä»¶å¤šæ¬¡æ£€æŸ¥æ—¶ï¼Œå¤ç”¨ &lt;code&gt;CompilationUnit&lt;/code&gt;å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å››å¯¹æ¯”è¿‡ç¨‹å¼ä»£ç çš„ä¼˜åŠ¿"&gt;âœ… &lt;strong&gt;å››ã€å¯¹æ¯”è¿‡ç¨‹å¼ä»£ç çš„ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è®¿é—®è€…æ¨¡å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¿‡ç¨‹å¼ä»£ç &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤šæ³¨è§£æ£€æŸ¥&lt;/td&gt;
&lt;td&gt;âœ… å•æ¬¡éå†å®Œæˆæ‰€æœ‰æ£€æŸ¥&lt;/td&gt;
&lt;td&gt;âŒ éœ€å¤šæ¬¡éå†æˆ–å¤æ‚æ¡ä»¶åµŒå¥—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ–°å¢æ³¨è§£ç±»å‹&lt;/td&gt;
&lt;td&gt;âœ… æ‰©å±•æ–°ç±»å³å¯ï¼Œç¬¦åˆå¼€é—­åŸåˆ™&lt;/td&gt;
&lt;td&gt;âŒ éœ€ä¿®æ”¹åŸæœ‰é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚ä»£ç ç»“æ„&lt;/td&gt;
&lt;td&gt;âœ… è‡ªåŠ¨å¤„ç†åµŒå¥—ç±»ã€åŒ¿åç±»&lt;/td&gt;
&lt;td&gt;âŒ éœ€æ‰‹åŠ¨é€’å½’éå†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ€§èƒ½ï¼ˆå¤§æ–‡ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;âœ… é€šè¿‡ç»„åˆè®¿é—®è€…ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;âŒ å¤šæ¬¡è§£æå¼€é”€å¤§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-äº”æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;äº”ã€æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨è®¿é—®è€…æ¨¡å¼ä¸­å®ç°å¤šæ³¨è§£æ£€æŸ¥çš„æ ¸å¿ƒæ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚è®¾è®¡&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;AnnotationVisitor&lt;/code&gt;æ¥å£è§£è€¦æ³¨è§£ç±»å‹ä¸æ£€æŸ¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒé‡åˆ†æ´¾&lt;/strong&gt;ï¼šåˆ©ç”¨ AST èŠ‚ç‚¹çš„ &lt;code&gt;accept()&lt;/code&gt;æ–¹æ³•åŠ¨æ€è°ƒç”¨å…·ä½“æ³¨è§£å¤„ç†å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»„åˆä¼˜åŒ–&lt;/strong&gt;ï¼šåœ¨å•æ¬¡éå†ä¸­ç»„åˆå¤šä¸ªè®¿é—®è€…ï¼Œé¿å…é‡å¤è§£æã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ­¤æ–¹æ¡ˆé€‚ç”¨äºé™æ€ä»£ç åˆ†æã€API è·¯ç”±æ‰«æç­‰åœºæ™¯ï¼Œå…¼å…·&lt;strong&gt;é«˜æ‰©å±•æ€§&lt;/strong&gt;ä¸&lt;strong&gt;é«˜æ€§èƒ½&lt;/strong&gt;ï¼Œå°¤å…¶é€‚åˆå¤§å‹é¡¹ç›®ä¸­çš„æ³¨è§£è‡ªåŠ¨åŒ–å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id="é«˜æ•ˆ"&gt;é«˜æ•ˆ
&lt;/h2&gt;&lt;p&gt;é’ˆå¯¹ä»£ç ä¸­å¤šä¸ª &lt;code&gt;ClassOrInterfaceDeclaration&lt;/code&gt;å’Œ &lt;code&gt;MethodDeclaration&lt;/code&gt;çš„é«˜æ•ˆç»„åˆé—®é¢˜ï¼Œå¯é€šè¿‡ä»¥ä¸‹ä¼˜åŒ–ç­–ç•¥æå‡æ€§èƒ½ä¸å¯ç»´æŠ¤æ€§ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€ä¼˜åŒ–æ–¹æ¡ˆç»„åˆè®¿é—®è€…ä¸çŠ¶æ€å…±äº«"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€ä¼˜åŒ–æ–¹æ¡ˆï¼šç»„åˆè®¿é—®è€…ä¸çŠ¶æ€å…±äº«&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å•æ¬¡éå†å¤šæ“ä½œæ ¸å¿ƒä¼˜åŒ–"&gt;1. &lt;strong&gt;å•æ¬¡éå†å¤šæ“ä½œï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šåŸä»£ç å¯¹æ¯ä¸ªè®¿é—®è€…ç‹¬ç«‹éå† ASTï¼Œå¯¼è‡´å¤šæ¬¡è§£æå¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šåˆ›å»º &lt;strong&gt;å¤åˆè®¿é—®è€…&lt;/strong&gt;ï¼Œåœ¨å•æ¬¡éå†ä¸­æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class CompositeAnnotationVisitor implements AnnotationVisitor {
private final List&amp;lt;AnnotationVisitor&amp;gt; visitors = new ArrayList&amp;lt;&amp;gt;();
public void addVisitor(AnnotationVisitor visitor) {
visitors.add(visitor);
}
@Override
public void visitRestController(ClassOrInterfaceDeclaration clazz) {
visitors.forEach(v -&amp;gt; v.visitRestController(clazz));
}
@Override
public void visitGetMapping(MethodDeclaration method) {
visitors.forEach(v -&amp;gt; v.visitGetMapping(method));
}
}
// å®¢æˆ·ç«¯è°ƒç”¨
public static void main(String[] args) {
CompilationUnit cu = StaticJavaParser.parse(&amp;#34;/* æºä»£ç  */&amp;#34;);
AnnotationCheckVisitor dispatcher = new AnnotationCheckVisitor();
CompositeAnnotationVisitor composite = new CompositeAnnotationVisitor();
composite.addVisitor(new RestControllerVisitorImpl());
composite.addVisitor(new GetMappingVisitorImpl());
// ä»…éœ€å•æ¬¡éå†
cu.accept(dispatcher, composite);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;âœ… &lt;strong&gt;é¿å…é‡å¤éå†&lt;/strong&gt;ï¼šAST ä»…è§£æä¸€æ¬¡ï¼Œæ€§èƒ½æå‡æ˜¾è‘—ï¼›&lt;/li&gt;
&lt;li&gt;âœ… &lt;strong&gt;é€»è¾‘è§£è€¦&lt;/strong&gt;ï¼šæ–°å¢æ£€æŸ¥åªéœ€æ·»åŠ è®¿é—®è€…ï¼Œæ— éœ€ä¿®æ”¹éå†é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="2-èŠ‚ç‚¹è®¿é—®ä¼˜åŒ–"&gt;2. &lt;strong&gt;èŠ‚ç‚¹è®¿é—®ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼š&lt;code&gt;AnnotationCheckVisitor&lt;/code&gt;å¯¹æ¯ä¸ªèŠ‚ç‚¹æ— å·®åˆ«åˆ†æ´¾æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼š&lt;strong&gt;æŒ‰éœ€åˆ†æ´¾&lt;/strong&gt;ï¼Œä»…å¯¹ç›®æ ‡èŠ‚ç‚¹è§¦å‘æ“ä½œï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class AnnotationCheckVisitor extends VoidVisitorAdapter&amp;lt;AnnotationVisitor&amp;gt; {
@Override
public void visit(ClassOrInterfaceDeclaration clazz, AnnotationVisitor visitor) {
super.visit(clazz, visitor);
if (visitor instanceof RestControllerVisitorImpl) { // ä»…è§¦å‘ç›¸å…³æ£€æŸ¥
visitor.visitRestController(clazz);
}
}
@Override
public void visit(MethodDeclaration method, AnnotationVisitor visitor) {
super.visit(method, visitor);
if (visitor instanceof GetMappingVisitorImpl) {
visitor.visitGetMapping(method);
}
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;âš¡ï¸ &lt;strong&gt;å‡å°‘å†—ä½™è°ƒç”¨&lt;/strong&gt;ï¼šé¿å…å¯¹éç›®æ ‡è®¿é—®è€…æ‰§è¡Œç©ºæ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="3-çŠ¶æ€å…±äº«ä¸ç»“æœèšåˆ"&gt;3. &lt;strong&gt;çŠ¶æ€å…±äº«ä¸ç»“æœèšåˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šå„è®¿é—®è€…ç‹¬ç«‹è¾“å‡ºç»“æœï¼Œéš¾ä»¥ç»Ÿä¸€å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šå¼•å…¥ &lt;strong&gt;å…±äº«ä¸Šä¸‹æ–‡å¯¹è±¡&lt;/strong&gt; èšåˆç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class AnnotationContext {
public Map&amp;lt;String, Boolean&amp;gt; restControllerResults = new HashMap&amp;lt;&amp;gt;();
public Map&amp;lt;String, Boolean&amp;gt; getMappingResults = new HashMap&amp;lt;&amp;gt;();
}
class RestControllerVisitorImpl implements AnnotationVisitor {
private AnnotationContext context;
public RestControllerVisitorImpl(AnnotationContext context) {
this.context = context;
}
@Override
public void visitRestController(ClassOrInterfaceDeclaration clazz) {
boolean hasAnnotation = ...; // æ£€æŸ¥é€»è¾‘
context.restControllerResults.put(clazz.getNameAsString(), hasAnnotation);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä½¿ç”¨æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;AnnotationContext context = new AnnotationContext();
CompositeAnnotationVisitor composite = new CompositeAnnotationVisitor();
composite.addVisitor(new RestControllerVisitorImpl(context));
composite.addVisitor(new GetMappingVisitorImpl(context));
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ğŸ’¡ &lt;strong&gt;é›†ä¸­ç®¡ç†ç»“æœ&lt;/strong&gt;ï¼šä¾¿äºåç»­ç”ŸæˆæŠ¥å‘Šæˆ–æ‰¹é‡å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒæ€§èƒ½å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯"&gt;âš™ï¸ &lt;strong&gt;äºŒã€æ€§èƒ½å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;æ—¶é—´å¤æ‚åº¦&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ä¼˜åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸæ–¹æ¡ˆï¼ˆå¤šæ¬¡éå†ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;O(nÃ—m)ï¼ˆn=èŠ‚ç‚¹æ•°, m=è®¿é—®è€…æ•°ï¼‰&lt;/td&gt;
&lt;td&gt;ç®€å•æ£€æŸ¥ï¼ŒèŠ‚ç‚¹æ•°å°‘&lt;/td&gt;
&lt;td&gt;å®ç°ç®€å•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤åˆè®¿é—®è€…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;O(n)&lt;/td&gt;
&lt;td&gt;å¤šç±»å‹èŠ‚ç‚¹ã€å¤§è§„æ¨¡ä»£ç &lt;/td&gt;
&lt;td&gt;é¿å…é‡å¤éå†ï¼Œæ€§èƒ½æœ€ä¼˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŒ‰éœ€åˆ†æ´¾&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;O(n)ï¼ˆå‡å°‘ç©ºè°ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;è®¿é—®è€…é€»è¾‘å¤æ‚ä¸”å·®å¼‚å¤§&lt;/td&gt;
&lt;td&gt;å‡å°‘å†—ä½™æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰æ‰©å±•ä¼˜åŒ–å»ºè®®"&gt;ğŸš€ &lt;strong&gt;ä¸‰ã€æ‰©å±•ä¼˜åŒ–å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¹¶è¡Œå¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹ç‹¬ç«‹ç±»å£°æ˜å¯ç”¨å¤šçº¿ç¨‹æ£€æŸ¥ï¼ˆçº¿ç¨‹å®‰å…¨å‰æä¸‹ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;cu.findAll(ClassOrInterfaceDeclaration.class).parallelStream()
.forEach(clazz -&amp;gt; composite.visitRestController(clazz));
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¶…å¤§å‹é¡¹ç›®ï¼ˆç±»æ•°é‡ &amp;gt; 1000ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¢é‡è§£æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»…è§£æå«æ³¨è§£çš„èŠ‚ç‚¹ï¼ˆéœ€ç»“åˆç¬¦å·è§£æï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;cu.getTypes().stream()
.filter(type -&amp;gt; type.getAnnotations().isNonEmpty())
.forEach(type -&amp;gt; type.accept(dispatcher, composite));
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè·³è¿‡æ— æ³¨è§£èŠ‚ç‚¹ï¼Œå‡å°‘ AST éå†æ·±åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¤ç”¨å·²è§£æçš„ AST ç»“æ„ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;// å…¨å±€ç¼“å­˜ CompilationUnit
private static Map&amp;lt;String, CompilationUnit&amp;gt; astCache = new ConcurrentHashMap&amp;lt;&amp;gt;();
CompilationUnit cu = astCache.computeIfAbsent(filePath,
path -&amp;gt; StaticJavaParser.parse(new File(path)));
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¤šæ¬¡åˆ†æåŒä¸€æ–‡ä»¶ï¼ˆå¦‚æŒç»­é›†æˆç¯å¢ƒï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é«˜æ•ˆç»„åˆå¤šç±»ä¸æ–¹æ³•å£°æ˜çš„æ ¸å¿ƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤åˆè®¿é—®è€…æ¨¡å¼&lt;/strong&gt; â†’ å•æ¬¡éå†å®Œæˆå¤šæ£€æŸ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŒ‰éœ€åˆ†æ´¾&lt;/strong&gt; â†’ é¿å…å¯¹éç›®æ ‡è®¿é—®è€…è§¦å‘ç©ºæ“ä½œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…±äº«ä¸Šä¸‹æ–‡&lt;/strong&gt; â†’ ç»Ÿä¸€ç®¡ç†æ£€æŸ¥ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹è¶…å¤§è§„æ¨¡ä»£ç ï¼Œå¯ç»“åˆ &lt;strong&gt;å¹¶è¡Œå¤„ç†&lt;/strong&gt;ã€&lt;strong&gt;å¢é‡è§£æ&lt;/strong&gt; å’Œ &lt;strong&gt;ASTç¼“å­˜&lt;/strong&gt; è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ã€‚æ­¤æ–¹æ¡ˆé€‚ç”¨äºé™æ€åˆ†æå·¥å…·ã€API è·¯ç”±æ‰«æç­‰åœºæ™¯ï¼Œå…¼é¡¾æ•ˆç‡ä¸æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>ã€Shopeeã€‘Concurrent Java</title><link>https://dyhes.github.io/p/shopeeconcurrent-java/</link><pubDate>Mon, 04 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeeconcurrent-java/</guid><description>&lt;h2 id="executorservice"&gt;&lt;code&gt;ExecutorService&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Java 8 ä¹‹å‰ï¼ˆå³ Java 5â€“7ï¼‰ï¼Œ&lt;code&gt;ExecutorService&lt;/code&gt; çš„å®ç°ä¸»è¦é€šè¿‡ &lt;code&gt;java.util.concurrent&lt;/code&gt; åŒ…æä¾›ï¼Œæ ¸å¿ƒç±»åŒ…æ‹¬ &lt;code&gt;ThreadPoolExecutor&lt;/code&gt; å’Œ &lt;code&gt;ScheduledThreadPoolExecutor&lt;/code&gt;ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®å®ç°æ–¹å¼åŠåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-æ ¸å¿ƒå®ç°ç±»"&gt;âš™ï¸ &lt;strong&gt;1. æ ¸å¿ƒå®ç°ç±»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ThreadPoolExecutor&lt;/code&gt;&lt;/strong&gt;
æ˜¯ &lt;code&gt;ExecutorService&lt;/code&gt; çš„ä¸»è¦å®ç°ï¼Œç”¨äºç®¡ç†çº¿ç¨‹æ± ã€‚å…¶æ„é€ å‡½æ•°æ”¯æŒé…ç½®æ ¸å¿ƒå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;corePoolSize&lt;/code&gt;ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆå³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šå›æ”¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maximumPoolSize&lt;/code&gt;ï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼ˆå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡æ—¶åˆ›å»ºæ–°çº¿ç¨‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;keepAliveTime&lt;/code&gt;ï¼šéæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²å­˜æ´»æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;workQueue&lt;/code&gt;ï¼šä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚ &lt;code&gt;LinkedBlockingQueue&lt;/code&gt;ï¼‰ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ExecutorService executor = new ThreadPoolExecutor(
5, 10, 5000, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&amp;lt;&amp;gt;()
);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ScheduledThreadPoolExecutor&lt;/code&gt;&lt;/strong&gt;
æ‰©å±• &lt;code&gt;ThreadPoolExecutor&lt;/code&gt;ï¼Œæ”¯æŒå®šæ—¶ä»»åŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;schedule()&lt;/code&gt;ï¼šå»¶è¿Ÿæ‰§è¡Œå•æ¬¡ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scheduleAtFixedRate()&lt;/code&gt;ï¼šå›ºå®šé¢‘ç‡æ‰§è¡Œä»»åŠ¡ï¼ˆå¿½ç•¥ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scheduleWithFixedDelay()&lt;/code&gt;ï¼šå›ºå®šå»¶è¿Ÿæ‰§è¡Œä»»åŠ¡ï¼ˆä»»åŠ¡ç»“æŸåˆ°ä¸‹ä¸€æ¬¡å¼€å§‹çš„æ—¶é—´é—´éš”ï¼‰ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(2);
scheduler.scheduleAtFixedRate(() -&amp;gt; System.out.println(&amp;#34;Task&amp;#34;), 1, 5, TimeUnit.SECONDS);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-åˆ›å»º"&gt;ğŸ› ï¸ &lt;strong&gt;2. åˆ›å»º &lt;code&gt;ExecutorService&lt;/code&gt; çš„å·¥å‚æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;Executors&lt;/code&gt; å·¥å…·ç±»å¿«é€Ÿåˆ›å»ºçº¿ç¨‹æ± ï¼ˆåº•å±‚ä»è°ƒç”¨ &lt;code&gt;ThreadPoolExecutor&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;newFixedThreadPool(int nThreads)&lt;/code&gt;&lt;/strong&gt;
å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°=æœ€å¤§çº¿ç¨‹æ•°ï¼‰ï¼Œä»»åŠ¡é˜Ÿåˆ—æ— ç•Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;newCachedThreadPool()&lt;/code&gt;&lt;/strong&gt;
å¼¹æ€§çº¿ç¨‹æ± ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°=0ï¼Œæœ€å¤§çº¿ç¨‹æ•°=Integer.MAX_VALUEï¼‰ï¼Œç©ºé—²çº¿ç¨‹60ç§’å›æ”¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;newSingleThreadExecutor()&lt;/code&gt;&lt;/strong&gt;
å•çº¿ç¨‹æ± ï¼ˆä¿è¯ä»»åŠ¡é¡ºåºæ‰§è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;newScheduledThreadPool(int corePoolSize)&lt;/code&gt;&lt;/strong&gt;
å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼ˆåŸºäº &lt;code&gt;ScheduledThreadPoolExecutor&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;code&gt;newCachedThreadPool&lt;/code&gt; å¯èƒ½å› ä»»åŠ¡è¿‡å¤šå¯¼è‡´çº¿ç¨‹æ•°æ¿€å¢ï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-3-ä»»åŠ¡æäº¤ä¸ç›‘æ§"&gt;ğŸ“¨ &lt;strong&gt;3. ä»»åŠ¡æäº¤ä¸ç›‘æ§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;execute(Runnable task)&lt;/code&gt;&lt;/strong&gt;
æäº¤æ— è¿”å›å€¼çš„ä»»åŠ¡ï¼ˆæ— æ³•è·å–çŠ¶æ€æˆ–ç»“æœï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;submit(Callable&amp;lt;T&amp;gt; task)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;**&lt;/p&gt;
&lt;p&gt;è¿”å›&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Future
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯¹è±¡ï¼Œæ”¯æŒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;future.get()&lt;/code&gt;ï¼šé˜»å¡è·å–ç»“æœï¼ˆæˆ–æ•è·å¼‚å¸¸ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;future.get(timeout, unit)&lt;/code&gt;ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆè¶…æ—¶æŠ›å‡º &lt;code&gt;TimeoutException&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;future.cancel(true)&lt;/code&gt;ï¼šä¸­æ–­ä»»åŠ¡ï¼ˆéœ€ä»»åŠ¡å“åº”ä¸­æ–­ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰¹é‡ä»»åŠ¡æ–¹æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;invokeAll()&lt;/code&gt;ï¼šæäº¤æ‰€æœ‰ä»»åŠ¡å¹¶è¿”å› &lt;code&gt;Future&lt;/code&gt; åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;invokeAny()&lt;/code&gt;ï¼šè¿”å›ä»»æ„ä¸€ä¸ªæˆåŠŸä»»åŠ¡çš„ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-å…³é—­çº¿ç¨‹æ± "&gt;ğŸ”š &lt;strong&gt;4. å…³é—­çº¿ç¨‹æ± &lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;shutdown()&lt;/code&gt;&lt;/strong&gt;
åœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œç­‰å¾…å·²æäº¤ä»»åŠ¡å®Œæˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;shutdownNow()&lt;/code&gt;&lt;/strong&gt;
å°è¯•ç«‹å³åœæ­¢æ‰€æœ‰ä»»åŠ¡ï¼ˆè¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨èå…³é—­æµç¨‹&lt;/p&gt;
&lt;p&gt;ï¼ˆé˜²æ­¢èµ„æºæ³„æ¼ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;executor.shutdown();
try {
if (!executor.awaitTermination(5, TimeUnit.SECONDS)) {
executor.shutdownNow(); // è¶…æ—¶åå¼ºåˆ¶å…³é—­
}
} catch (InterruptedException e) {
executor.shutdownNow();
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-5-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;5. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸­æ–­å“åº”&lt;/strong&gt;
ä»»åŠ¡éœ€æ£€æµ‹ &lt;code&gt;Thread.interrupted()&lt;/code&gt; æˆ–å¤„ç† &lt;code&gt;InterruptedException&lt;/code&gt;ï¼Œå¦åˆ™æ— æ³•åŠæ—¶å–æ¶ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºç®¡ç†&lt;/strong&gt;
é¿å…çº¿ç¨‹æ³„æ¼ï¼šç¡®ä¿æœ€ç»ˆè°ƒç”¨ &lt;code&gt;shutdown()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é˜Ÿåˆ—é€‰æ‹©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;ï¼šæ— ç•Œé˜Ÿåˆ—ï¼ˆå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SynchronousQueue&lt;/code&gt;ï¼šç›´æ¥ä¼ é€’ä»»åŠ¡ï¼ˆ&lt;code&gt;newCachedThreadPool&lt;/code&gt; ä½¿ç”¨ï¼Œæ— ç¼“å†²ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Java 5â€“7 çš„ &lt;code&gt;ExecutorService&lt;/code&gt; å®ç°å·²æˆç†Ÿ&lt;/strong&gt;ï¼Œæ ¸å¿ƒåŠŸèƒ½ï¼ˆçº¿ç¨‹æ± ã€ä»»åŠ¡è°ƒåº¦ã€å¼‚æ­¥ç»“æœï¼‰é€šè¿‡ &lt;code&gt;ThreadPoolExecutor&lt;/code&gt; å’Œ &lt;code&gt;ScheduledThreadPoolExecutor&lt;/code&gt; æä¾›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Java 8 æ–°å¢çš„ &lt;code&gt;CompletableFuture&lt;/code&gt; ä¼˜åŒ–äº†å¼‚æ­¥ç¼–ç¨‹&lt;/strong&gt;ï¼Œä½†åº•å±‚ä»ä¾èµ–ä¸Šè¿°å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®å®è·µ&lt;/strong&gt;ï¼šåˆç†é…ç½®çº¿ç¨‹æ± å‚æ•°ã€ä»»åŠ¡éœ€æ”¯æŒä¸­æ–­ã€è§„èŒƒå…³é—­æµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="è¶…æ—¶å–æ¶ˆ"&gt;è¶…æ—¶å–æ¶ˆ
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ä¸ºçº¿ç¨‹æ± æäº¤çš„ä»»åŠ¡è®¾ç½®è¶…æ—¶å¹¶è‡ªåŠ¨å–æ¶ˆï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ç›‘æ§ä»»åŠ¡çŠ¶æ€ï¼Œç»“åˆè¶…æ—¶æ§åˆ¶æœºåˆ¶å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§ä¸»æµæ–¹æ¡ˆï¼Œå‡åŸºäºçº¿ç¨‹æ± ï¼ˆ&lt;code&gt;ExecutorService&lt;/code&gt;ï¼‰å’Œä»»åŠ¡ç»“æœç›‘å¬æœºåˆ¶ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆä¸€ä½¿ç”¨-futureget-è®¾ç½®è¶…æ—¶æ¨è"&gt;â³ æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ &lt;code&gt;Future.get()&lt;/code&gt; è®¾ç½®è¶…æ—¶ï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šæäº¤ä»»åŠ¡åï¼Œé€šè¿‡ &lt;code&gt;Future.get(timeout, unit)&lt;/code&gt; é˜»å¡ç­‰å¾…ç»“æœã€‚è‹¥è¶…æ—¶åˆ™æŠ›å‡º &lt;code&gt;TimeoutException&lt;/code&gt;ï¼Œè§¦å‘ä»»åŠ¡å–æ¶ˆã€‚
â€‹&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºçº¿ç¨‹æ± ï¼ˆå¦‚ &lt;code&gt;FixedThreadPool&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æäº¤ä»»åŠ¡ï¼ˆ&lt;code&gt;Callable&lt;/code&gt; æˆ– &lt;code&gt;Runnable&lt;/code&gt;ï¼‰ï¼Œè·å– &lt;code&gt;Future&lt;/code&gt; å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;future.get(timeout, unit)&lt;/code&gt; è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;æ•è·è¶…æ—¶å¼‚å¸¸åï¼Œè°ƒç”¨ &lt;code&gt;future.cancel(true)&lt;/code&gt; ä¸­æ–­ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ExecutorService executor = Executors.newFixedThreadPool(4);
Callable&amp;lt;String&amp;gt; task = () -&amp;gt; {
Thread.sleep(5000); // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡ï¼ˆ5ç§’ï¼‰
return &amp;#34;Done&amp;#34;;
};
Future&amp;lt;String&amp;gt; future = executor.submit(task);
try {
String result = future.get(1, TimeUnit.SECONDS); // è®¾ç½®1ç§’è¶…æ—¶
System.out.println(result);
} catch (TimeoutException e) {
System.out.println(&amp;#34;ä»»åŠ¡è¶…æ—¶ï¼Œå¼ºåˆ¶å–æ¶ˆ&amp;#34;);
future.cancel(true); // trueï¼šå°è¯•ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
} catch (Exception e) {
e.printStackTrace();
} finally {
executor.shutdown();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;future.cancel(true)&lt;/code&gt; ä¼šå‘ä»»åŠ¡çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·ï¼ˆéœ€ä»»åŠ¡å“åº”ä¸­æ–­æ‰èƒ½é€€å‡ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡éœ€æ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼ˆå¦‚ &lt;code&gt;Thread.interrupted()&lt;/code&gt;ï¼‰ï¼Œå¦åˆ™å¯èƒ½æ— æ³•åŠæ—¶ç»ˆæ­¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆäºŒä½¿ç”¨-completablefuturejava-8"&gt;ğŸ” æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ &lt;code&gt;CompletableFuture&lt;/code&gt;ï¼ˆJava 8+ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;CompletableFuture.supplyAsync()&lt;/code&gt; æäº¤ä»»åŠ¡ï¼Œç”¨ &lt;code&gt;orTimeout()&lt;/code&gt; æˆ– &lt;code&gt;completeOnTimeout()&lt;/code&gt; è®¾ç½®è¶…æ—¶ç­–ç•¥ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;CompletableFuture&amp;lt;String&amp;gt; future = CompletableFuture.supplyAsync(() -&amp;gt; {
try {
Thread.sleep(5000);
} catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
return &amp;#34;Done&amp;#34;;
}).orTimeout(1, TimeUnit.SECONDS) // 1ç§’è¶…æ—¶åæŠ›å‡ºTimeoutException
.exceptionally(ex -&amp;gt; &amp;#34;è¶…æ—¶å¤„ç†ç»“æœ&amp;#34;);
future.thenAccept(System.out::println); // è¾“å‡ºç»“æœæˆ–è¶…æ—¶æç¤º
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é“¾å¼è°ƒç”¨ï¼Œæ— éœ€æ˜¾å¼å…³é—­çº¿ç¨‹æ± ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;completeOnTimeout()&lt;/code&gt; æ”¯æŒè¶…æ—¶è¿”å›é»˜è®¤å€¼ï¼Œé¿å…å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆä¸‰ç»“åˆ-scheduledexecutorservice-ç›‘æ§è¶…æ—¶"&gt;â±ï¸ æ–¹æ¡ˆä¸‰ï¼šç»“åˆ &lt;code&gt;ScheduledExecutorService&lt;/code&gt; ç›‘æ§è¶…æ—¶
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç›‘æ§çº¿ç¨‹ï¼Œè¶…æ—¶åä¸»åŠ¨å–æ¶ˆåŸä»»åŠ¡ã€‚
â€‹&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;â€‹ï¼šéœ€æ›´ç²¾ç»†æ§åˆ¶è¶…æ—¶é€»è¾‘ï¼ˆå¦‚æ‰¹é‡ä»»åŠ¡ç‹¬ç«‹è¶…æ—¶ï¼‰ã€‚
â€‹&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ExecutorService taskExecutor = Executors.newFixedThreadPool(4);
ScheduledExecutorService timeoutExecutor = Executors.newScheduledThreadPool(4);
Callable&amp;lt;String&amp;gt; task = () -&amp;gt; {
Thread.sleep(5000);
return &amp;#34;Done&amp;#34;;
};
Future&amp;lt;String&amp;gt; future = taskExecutor.submit(task);
// è®¾ç½®1ç§’åæ£€æŸ¥ä»»åŠ¡çŠ¶æ€
timeoutExecutor.schedule(() -&amp;gt; {
if (!future.isDone()) {
System.out.println(&amp;#34;ä»»åŠ¡è¶…æ—¶ï¼Œå–æ¶ˆæ‰§è¡Œ&amp;#34;);
future.cancel(true);
}
}, 1, TimeUnit.SECONDS);
try {
String result = future.get(); // é˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–å–æ¶ˆ
} catch (CancellationException e) {
System.out.println(&amp;#34;ä»»åŠ¡å·²è¢«å–æ¶ˆ&amp;#34;);
} finally {
taskExecutor.shutdown();
timeoutExecutor.shutdown();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€ç¡®ä¿ç›‘æ§çº¿ç¨‹æ± å¤§å°è¶³å¤Ÿï¼Œé¿å…ä»»åŠ¡å †ç§¯ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨äºéœ€è¦ç‹¬ç«‹æ§åˆ¶æ¯ä¸ªä»»åŠ¡è¶…æ—¶çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹"&gt;âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸­æ–­å“åº”&lt;/strong&gt;ï¼š
ä»»åŠ¡éœ€æ£€æµ‹ä¸­æ–­ä¿¡å·ï¼ˆå¦‚ &lt;code&gt;Thread.sleep()&lt;/code&gt;ã€&lt;code&gt;Object.wait()&lt;/code&gt; ä¼šæŠ› &lt;code&gt;InterruptedException&lt;/code&gt;ï¼‰ï¼Œå¦åˆ™æ— æ³•åŠæ—¶é€€å‡ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºæ¸…ç†&lt;/strong&gt;ï¼š
è¶…æ—¶åè°ƒç”¨ &lt;code&gt;future.cancel(true)&lt;/code&gt;ï¼Œå¹¶ç¡®ä¿æœ€ç»ˆå…³é—­çº¿ç¨‹æ± ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡ä»»åŠ¡å¤„ç†&lt;/strong&gt;ï¼š
ä½¿ç”¨ &lt;code&gt;invokeAll()&lt;/code&gt; è®¾ç½®ç»Ÿä¸€è¶…æ—¶æ—¶é—´ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;List&amp;lt;Callable&amp;lt;String&amp;gt;&amp;gt; tasks = ...; // ä»»åŠ¡åˆ—è¡¨
List&amp;lt;Future&amp;lt;String&amp;gt;&amp;gt; futures = executor.invokeAll(tasks, 2, TimeUnit.SECONDS);
for (Future&amp;lt;String&amp;gt; f : futures) {
if (!f.isDone()) f.cancel(true);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…ä»»åŠ¡å †ç§¯&lt;/strong&gt;ï¼š
æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©çº¿ç¨‹æ± ç±»å‹ï¼ˆå¦‚ &lt;code&gt;CachedThreadPool&lt;/code&gt; å¯è‡ªåŠ¨å›æ”¶ç©ºé—²çº¿ç¨‹ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å»ºè®®"&gt;æ€»ç»“å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•åœºæ™¯&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;code&gt;Future.get()&lt;/code&gt; + è¶…æ—¶å¼‚å¸¸å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é“¾å¼ç¼–ç¨‹&lt;/strong&gt;ï¼šJava 8+ é¡¹ç›®æ¨è &lt;code&gt;CompletableFuture.orTimeout()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚ç›‘æ§&lt;/strong&gt;ï¼šéœ€è¦ç‹¬ç«‹æ§åˆ¶æ¯ä¸ªä»»åŠ¡è¶…æ—¶æ—¶ï¼Œç”¨ &lt;code&gt;ScheduledExecutorService&lt;/code&gt; è¾…åŠ©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡è®¾è®¡&lt;/strong&gt;ï¼šç¡®ä¿ä»»åŠ¡å¯å“åº”ä¸­æ–­ï¼ˆå¦‚å¾ªç¯å†…æ£€æŸ¥ &lt;code&gt;Thread.interrupted()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="java-åªè¯»"&gt;Java åªè¯»
&lt;/h2&gt;&lt;p&gt;åœ¨Javaä¸­ï¼ŒæŒ‡å®šæ–¹æ³•è¿”å›å€¼ä¸ºâ€œåªè¯»â€ï¼ˆå³è°ƒç”¨æ–¹æ— æ³•ä¿®æ”¹è¿”å›çš„å¯¹è±¡æˆ–æ•°æ®ï¼‰æ˜¯ç¡®ä¿æ•°æ®å°è£…æ€§ã€çº¿ç¨‹å®‰å…¨æ€§å’Œä»£ç å¥å£®æ€§çš„å…³é”®è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯å‡ ç§æ ¸å¿ƒå®ç°æ–¹æ¡ˆï¼Œé™„ä»£ç ç¤ºä¾‹å’Œé€‚ç”¨åœºæ™¯åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-ä½¿ç”¨ä¸å¯å˜å¯¹è±¡immutable-objects"&gt;âš™ï¸ 1. &lt;strong&gt;ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ï¼ˆImmutable Objectsï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€è·¯&lt;/strong&gt;ï¼šé€šè¿‡è®¾è®¡ç±»æœ¬èº«ä¸ºä¸å¯å˜ï¼Œç¡®ä¿æ‰€æœ‰è¿”å›å€¼å¤©ç„¶åªè¯»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°è§„åˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç±»å£°æ˜ä¸º &lt;code&gt;final&lt;/code&gt;é˜²æ­¢ç»§æ‰¿ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰€æœ‰å­—æ®µä¸º &lt;code&gt;private final&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸æä¾› setter æ–¹æ³•ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‹¥å­—æ®µä¸ºå¯å˜å¯¹è±¡ï¼ˆå¦‚é›†åˆï¼‰ï¼Œéœ€æ·±åº¦å¤åˆ¶æˆ–è¿”å›å…¶ä¸å¯å˜è§†å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public final class ImmutablePerson {
private final String name;
private final List&amp;lt;String&amp;gt; hobbies; // å¯å˜å¯¹è±¡å­—æ®µ
public ImmutablePerson(String name, List&amp;lt;String&amp;gt; hobbies) {
this.name = name;
// é˜²å¾¡æ€§å¤åˆ¶ï¼šé¿å…å¤–éƒ¨ä¿®æ”¹å½±å“å†…éƒ¨çŠ¶æ€
this.hobbies = new ArrayList&amp;lt;&amp;gt;(hobbies);
}
// è¿”å›ä¸å¯å˜é›†åˆ
public List&amp;lt;String&amp;gt; getHobbies() {
return Collections.unmodifiableList(hobbies);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šçº¿ç¨‹å®‰å…¨ã€æ— éœ€åŒæ­¥é€»è¾‘ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šéœ€æ‰‹åŠ¨å®ç°æ·±æ‹·è´ï¼Œå¯èƒ½å¢åŠ å†…å­˜å¼€é”€ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-2-è¿”å›ä¸å¯å˜é›†åˆunmodifiable-collections"&gt;ğŸ“¦ 2. &lt;strong&gt;è¿”å›ä¸å¯å˜é›†åˆï¼ˆUnmodifiable Collectionsï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ–¹æ³•è¿”å›é›†åˆç±»å‹ï¼ˆå¦‚ &lt;code&gt;List&lt;/code&gt;ã€&lt;code&gt;Map&lt;/code&gt;ï¼‰æ—¶ï¼Œé˜²æ­¢è°ƒç”¨æ–¹ä¿®æ”¹åŸå§‹é›†åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ–¹æ³•&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;Collections.unmodifiableXXX()&lt;/code&gt;åŒ…è£…åŸå§‹é›†åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class DataService {
private List&amp;lt;String&amp;gt; data = new ArrayList&amp;lt;&amp;gt;();
public List&amp;lt;String&amp;gt; getData() {
return Collections.unmodifiableList(data); // åªè¯»è§†å›¾
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥åŸå§‹é›†åˆè¢«ä¿®æ”¹ï¼Œåªè¯»è§†å›¾ä¼šåŒæ­¥å˜åŒ–ï¼ˆæµ…ä¸å¯å˜ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ–¹å°è¯•ä¿®æ”¹æ—¶ä¼šæŠ›å‡º &lt;code&gt;UnsupportedOperationException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-è¿”å›å‰¯æœ¬defensive-copying"&gt;ğŸ“‘ 3. &lt;strong&gt;è¿”å›å‰¯æœ¬ï¼ˆDefensive Copyingï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€å®Œå…¨éš”ç¦»è¿”å›å¯¹è±¡ä¸åŸå§‹æ•°æ®ï¼Œé¿å…ä»»ä½•å…³è”æ€§ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ–¹æ³•&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;clone()&lt;/code&gt;æˆ–å¤åˆ¶æ„é€ å‡½æ•°åˆ›å»ºæ–°å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class DataHolder {
private int[] values = {1, 2, 3};
public int[] getValues() {
return values.clone(); // è¿”å›æ•°ç»„å‰¯æœ¬
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå½»åº•éš”ç¦»åŸå§‹æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¤åˆ¶å¤§å¯¹è±¡æ—¶æ€§èƒ½è¾ƒå·®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-4-ä½¿ç”¨åªè¯»æ¥å£read-only-interface"&gt;ğŸ§© 4. &lt;strong&gt;ä½¿ç”¨åªè¯»æ¥å£ï¼ˆRead-Only Interfaceï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€è·¯&lt;/strong&gt;ï¼šå®šä¹‰ä»…åŒ…å« getter æ–¹æ³•çš„æ¥å£ï¼Œè¿”å›æ¥å£ç±»å‹è€Œéå…·ä½“ç±»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public interface ReadOnlyPerson {
String getName();
}
public class Person implements ReadOnlyPerson {
private String name;
public String getName() { return name; }
public ReadOnlyPerson asReadOnly() {
return this; // è¿”å›æ¥å£ç±»å‹
}
}
// è°ƒç”¨æ–¹
ReadOnlyPerson person = new Person(&amp;#34;Alice&amp;#34;).asReadOnly();
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç¼–è¯‘æ—¶å¼ºåˆ¶åªè¯»ï¼Œæ— éœ€è¿è¡Œæ—¶æ£€æŸ¥ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šéœ€é¢å¤–å®šä¹‰æ¥å£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-5-ä»£ç†æ¨¡å¼proxy-pattern"&gt;âš¡ 5. &lt;strong&gt;ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåŠ¨æ€æ‹¦æˆªä¿®æ”¹æ“ä½œï¼Œé€‚ç”¨äºå¤æ‚å¯¹è±¡æˆ–éœ€è¿è¡Œæ—¶æ§åˆ¶çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ–¹æ³•&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;InvocationHandler&lt;/code&gt;æ‹¦æˆª setter è°ƒç”¨å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public ReadOnlyPerson createReadOnlyProxy(Person person) {
return (ReadOnlyPerson) Proxy.newProxyInstance(
ReadOnlyPerson.class.getClassLoader(),
new Class[]{ReadOnlyPerson.class},
(proxy, method, args) -&amp;gt; {
if (method.getName().startsWith(&amp;#34;set&amp;#34;))
throw new UnsupportedOperationException(&amp;#34;Read-only object&amp;#34;);
return method.invoke(person, args);
}
);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šçµæ´»æ§åˆ¶æƒé™ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šåå°„è°ƒç”¨æœ‰æ€§èƒ½æŸè€—ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;ğŸ” &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸å¯å˜å¯¹è±¡&lt;/td&gt;
&lt;td&gt;ç®€å•å€¼å¯¹è±¡ã€é«˜é¢‘å¹¶å‘åœºæ™¯&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆè‹¥æ— æ·±æ‹·è´ï¼‰&lt;/td&gt;
&lt;td&gt;â­â­â­â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸å¯å˜é›†åˆ&lt;/td&gt;
&lt;td&gt;è¿”å›é›†åˆç±»æ•°æ®&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;â­â­â­â­ï¼ˆæµ…ä¸å¯å˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¿”å›å‰¯æœ¬&lt;/td&gt;
&lt;td&gt;å°å‹å¯¹è±¡æˆ–æ•°ç»„&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆå¤§å¯¹è±¡å·®ï¼‰&lt;/td&gt;
&lt;td&gt;â­â­â­â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åªè¯»æ¥å£&lt;/td&gt;
&lt;td&gt;éœ€ç¼–è¯‘æ—¶æ£€æŸ¥çš„å¤æ‚å¯¹è±¡&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;â­â­â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä»£ç†æ¨¡å¼&lt;/td&gt;
&lt;td&gt;åŠ¨æ€æ§åˆ¶æƒé™çš„é—ç•™ç³»ç»Ÿé€‚é…&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;â­â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé€‰æ‹© &lt;strong&gt;ä¸å¯å˜å¯¹è±¡&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;String&lt;/code&gt;ã€&lt;code&gt;LocalDateTime&lt;/code&gt;ï¼‰æˆ– &lt;strong&gt;ä¸å¯å˜é›†åˆ&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ•æ„Ÿæ•°æ®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€é…ç½®ï¼‰ä½¿ç”¨ &lt;strong&gt;å‰¯æœ¬&lt;/strong&gt; æˆ– &lt;strong&gt;åªè¯»æ¥å£&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;é¿å…ç›´æ¥è¿”å›åŸå§‹å¼•ç”¨ï¼ˆå¦‚ &lt;code&gt;getHobbies()&lt;/code&gt;åº”è¿”å›ä¸å¯å˜è§†å›¾è€Œé &lt;code&gt;ArrayList&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©ä¸Šè¿°æ–¹æ³•ï¼Œå¯æœ‰æ•ˆç¡®ä¿Javaæ–¹æ³•è¿”å›å€¼çš„åªè¯»æ€§ï¼Œå‡å°‘å‰¯ä½œç”¨å¹¶æå‡ä»£ç ç¨³å®šæ€§ã€‚&lt;/p&gt;</description></item><item><title>ã€Shopeeã€‘Insight Hub</title><link>https://dyhes.github.io/p/shopeeinsight-hub/</link><pubDate>Mon, 04 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeeinsight-hub/</guid><description>&lt;p&gt;&lt;strong&gt;InsightHub&lt;/strong&gt; is an internal tool for automatically extracting knowledge from Java projects and building an AI-assisted project knowledge center.&lt;/p&gt;
&lt;p&gt;It integrates:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring AI + Ollama + LLM&lt;/strong&gt; for understanding and explaining code.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MyBatis + MySQL&lt;/strong&gt; for task tracking and persistent storage.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Milvus&lt;/strong&gt; for storing code embeddings and enabling semantic search.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Redis&lt;/strong&gt; for caching.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="-features"&gt;âœ¨ Features
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Automatic structure extraction (classes, methods, relationships)&lt;/li&gt;
&lt;li&gt;Method-level comment generation via LLM&lt;/li&gt;
&lt;li&gt;Embedding generation + Milvus vector storage&lt;/li&gt;
&lt;li&gt;Project-level semantic search and intelligent Q&amp;amp;A&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="-docker-compose"&gt;ğŸŒ Docker Compose
&lt;/h2&gt;&lt;p&gt;This project includes a preconfigured Docker Compose setup for local development.&lt;/p&gt;
&lt;h3 id="-how-to-start-services"&gt;â™» How to start services
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This will start:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MySQL&lt;/strong&gt; (on port 3306)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Redis&lt;/strong&gt; (on port 6379)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Milvus&lt;/strong&gt; (on port 19530)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Nebula Graph&lt;/strong&gt; (optional)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ollama&lt;/strong&gt; (on port 11434)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-pull-llm-model-for-ollama-eg-codellama"&gt;ğŸ§ Pull LLM model for Ollama (e.g. codellama)
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl http://localhost:11434/api/pull -d &lt;span class="s1"&gt;&amp;#39;{&amp;#34;name&amp;#34;: &amp;#34;codellama:7b&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="-configuration"&gt;âš–ï¸ Configuration
&lt;/h2&gt;&lt;h3 id="application-localyaml"&gt;application-local.yaml
&lt;/h3&gt;&lt;p&gt;Make sure this file exists in &lt;code&gt;src/main/resources/&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;datasource&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;jdbc:mysql://localhost:3306/insighthub&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;username&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;insighthub_user&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;insighthub_pass&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;driver-class-name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;com.mysql.cj.jdbc.Driver&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;redis&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;localhost&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6379&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ai&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;openai&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;base-url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;http://localhost:11434&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;api-key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;dummy&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;chat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;codellama:7b&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;embedding&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;llama-embedding&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;milvus&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;localhost&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;19530&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;database&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;default&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;insighthub_vectors&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="activating-the-profile"&gt;Activating the profile
&lt;/h3&gt;&lt;p&gt;In &lt;code&gt;application.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;profiles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;active&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;local&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Or via command line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./mvnw spring-boot:run -Dspring-boot.run.profiles&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="-local-dev-workflow"&gt;âš™ï¸ Local Dev Workflow
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Start all services via Docker Compose:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;Start the Spring Boot app:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./mvnw spring-boot:run -Dspring-boot.run.profiles&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="3"&gt;
&lt;li&gt;Test endpoint:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X POST http://localhost:8080/api/test/ask &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -d &lt;span class="s2"&gt;&amp;#34;ä½ æ˜¯è°&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="4"&gt;
&lt;li&gt;You should get a natural language answer from the local LLM via Ollama.&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id="-notes"&gt;ğŸ’¡ Notes
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;You can configure different LLMs via Ollama (e.g. &lt;code&gt;llama2&lt;/code&gt;, &lt;code&gt;mistral&lt;/code&gt;, &lt;code&gt;llama3&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Milvus is used to store embeddings for later retrieval (e.g. RAG)&lt;/li&gt;
&lt;li&gt;The project is designed to support agent-based architecture&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="-to-do-next-steps"&gt;â˜‘ï¸ To-do (Next Steps)
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>ã€Shopeeã€‘Local LLM</title><link>https://dyhes.github.io/p/shopeelocal-llm/</link><pubDate>Mon, 04 Aug 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/shopeelocal-llm/</guid><description>&lt;h2 id="gguf"&gt;GGUF
&lt;/h2&gt;&lt;p&gt;GGUFï¼ˆGPT-Generated Unified Formatï¼‰æ˜¯ä¸€ç§ä¸“ä¸º&lt;strong&gt;å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æœ¬åœ°åŒ–éƒ¨ç½²&lt;/strong&gt;è®¾è®¡çš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ï¼Œç”± &lt;code&gt;llama.cpp&lt;/code&gt; é¡¹ç›®çš„åˆ›å§‹äºº Georgi Gerganov æå‡ºï¼Œæ—¨åœ¨è§£å†³å¤§æ¨¡å‹åœ¨å­˜å‚¨ã€åŠ è½½é€Ÿåº¦å’Œè·¨å¹³å°å…¼å®¹æ€§ä¸Šçš„æŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¸åº”ç”¨åœºæ™¯çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€æ ¸å¿ƒè®¾è®¡ç›®æ ‡"&gt;ğŸ”§ &lt;strong&gt;ä¸€ã€æ ¸å¿ƒè®¾è®¡ç›®æ ‡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆå­˜å‚¨ä¸åŠ è½½&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æ”¯æŒ&lt;/strong&gt;ï¼šGGUF æ–‡ä»¶å¯ç›´æ¥æ˜ å°„åˆ°å†…å­˜ï¼Œæ— éœ€å®Œå…¨åŠ è½½åˆ° RAMï¼Œå¤§å¹…å‡å°‘å¯åŠ¨æ—¶é—´å’Œå†…å­˜å ç”¨ï¼ˆå°¤å…¶é€‚åˆèµ„æºå—é™è®¾å¤‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å•æ–‡ä»¶éƒ¨ç½²&lt;/strong&gt;ï¼šæ¨¡å‹æƒé‡ã€é…ç½®å’Œåˆ†è¯å™¨ä¿¡æ¯é›†æˆåœ¨å•ä¸€æ–‡ä»¶ä¸­ï¼Œç®€åŒ–åˆ†å‘ä¸ä½¿ç”¨æµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡åŒ–æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šç§é‡åŒ–ç±»å‹ï¼ˆå¦‚ &lt;code&gt;Q4_K_M&lt;/code&gt;ã€&lt;code&gt;Q5_K_M&lt;/code&gt;ï¼‰ï¼Œé€šè¿‡é™ä½æƒé‡ç²¾åº¦ï¼ˆå¦‚ 4-bit/8-bitï¼‰å‹ç¼©æ¨¡å‹ä½“ç§¯ï¼Œå¹³è¡¡æ€§èƒ½ä¸èµ„æºæ¶ˆè€—ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼š&lt;code&gt;Q4_K_M&lt;/code&gt; è¡¨ç¤º &lt;strong&gt;4-bit ä¸»é‡åŒ–&lt;/strong&gt; + &lt;strong&gt;åˆ†å—ä¼˜åŒ–ï¼ˆKï¼‰&lt;/strong&gt; + &lt;strong&gt;ä¸­ç­‰ç²¾åº¦ï¼ˆMï¼‰&lt;/strong&gt;ï¼Œé€‚åˆ 16GB RAM è®¾å¤‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨å¹³å°å…¼å®¹æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ CPU/GPU åŠ é€Ÿï¼ˆå¦‚ CUDAã€Metalï¼‰ï¼Œå¯åœ¨ Windows/Linux/macOS åŠè¾¹ç¼˜è®¾å¤‡è¿è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒæ–‡ä»¶ç»“æ„"&gt;ğŸ§¬ &lt;strong&gt;äºŒã€æ–‡ä»¶ç»“æ„&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;GGUF æ–‡ä»¶åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ–‡ä»¶å¤´ï¼ˆHeaderï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ‡è¯†æ–‡ä»¶ç±»å‹ï¼ˆ&lt;code&gt;GGUF&lt;/code&gt;ï¼‰ã€ç‰ˆæœ¬å·å’Œå¼ é‡æ•°é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…ƒæ•°æ®æ®µï¼ˆMetadataï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥é”®å€¼å¯¹å­˜å‚¨æ¨¡å‹æ¶æ„ã€è®­ç»ƒå‚æ•°ã€åˆ†è¯å™¨é…ç½®ç­‰å…³é”®ä¿¡æ¯ï¼ˆå¦‚ &lt;code&gt;llama.context_length&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¼ é‡æ•°æ®æ®µï¼ˆTensorsï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨é‡åŒ–åçš„æƒé‡æ•°æ®ï¼ŒæŒ‰åˆ†å—ï¼ˆBlockï¼‰ç»„ç»‡ä»¥ä¼˜åŒ–è¯»å–æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰å‘½åè§„èŒƒ"&gt;ğŸ“› &lt;strong&gt;ä¸‰ã€å‘½åè§„èŒƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;GGUF æ–‡ä»¶åéµå¾ªç»“æ„åŒ–è§„åˆ™ï¼Œä¾¿äºå¿«é€Ÿè¯†åˆ«æ¨¡å‹å±æ€§ï¼š
â€‹**&lt;code&gt;&amp;lt;BaseName&amp;gt;-&amp;lt;SizeLabel&amp;gt;-&amp;lt;FineTune&amp;gt;-&amp;lt;Version&amp;gt;-&amp;lt;Encoding&amp;gt;-&amp;lt;Type&amp;gt;-&amp;lt;Shard&amp;gt;.gguf&lt;/code&gt;**â€‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¤ºä¾‹&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Mixtral-8x7B-v0.1-Q4_K_M.gguf
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Mixtral&lt;/code&gt;ï¼šåŸºç¡€æ¨¡å‹æ¶æ„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;8x7B&lt;/code&gt;ï¼š8 ä¸ªä¸“å®¶æ¨¡å—ï¼Œå…± 70 äº¿å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Q4_K_M&lt;/code&gt;ï¼š4-bit é‡åŒ– + åˆ†å—ä¼˜åŒ– + ä¸­ç­‰ç²¾åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å››æŠ€æœ¯ä¼˜åŠ¿"&gt;âš¡ï¸ &lt;strong&gt;å››ã€æŠ€æœ¯ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€§èƒ½ä¼˜åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®æµ‹ä¸­ï¼ŒGGUF æ ¼å¼çš„æ¨ç†é€Ÿåº¦æ¯” Hugging Face æ ¼å¼å¿« &lt;strong&gt;7.57 å€&lt;/strong&gt;ï¼Œå†…å­˜å ç”¨ä»…ä¸ºå…¶ &lt;strong&gt;4.65%&lt;/strong&gt;ï¼ˆå¦‚ Yuan2.0-2B æ¨¡å‹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çµæ´»æ‰©å±•æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ƒæ•°æ®æ®µæ”¯æŒåŠ¨æ€æ·»åŠ æ–°å­—æ®µï¼Œç¡®ä¿æ–°åŠŸèƒ½ä¸ç ´åæ—§ç‰ˆæœ¬å…¼å®¹æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‡åŒ–åˆ†çº§ç­–ç•¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æä¾›å¤šçº§é‡åŒ–é€‰é¡¹ï¼ˆå¦‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Q2_K
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ°&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Q8_K
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼‰ï¼Œç”¨æˆ·å¯æ ¹æ®ç¡¬ä»¶é€‰æ‹©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Q4_K_M&lt;/code&gt;ï¼šé€šç”¨åœºæ™¯ï¼ˆæ¨èï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Q5_K_S&lt;/code&gt;ï¼šä½å†…å­˜è®¾å¤‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Q8_0&lt;/code&gt;ï¼šæ¥è¿‘åŸç²¾åº¦ï¼ˆéœ€é«˜æ€§èƒ½ç¡¬ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-äº”ä¸å…¶ä»–æ ¼å¼å¯¹æ¯”"&gt;ğŸ†š &lt;strong&gt;äº”ã€ä¸å…¶ä»–æ ¼å¼å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ ¼å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;GGUF&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;CPU ä¼˜åŒ–ã€æ”¯æŒé‡åŒ–ã€ä½å†…å­˜å ç”¨&lt;/td&gt;
&lt;td&gt;æœ¬åœ°éƒ¨ç½²ï¼ˆOllama/llama.cppï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;PyTorch (.pt)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸç”Ÿè®­ç»ƒæ ¼å¼ã€æœªé‡åŒ–ã€ä¾èµ– GPU&lt;/td&gt;
&lt;td&gt;æ¨¡å‹è®­ç»ƒ/å¾®è°ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Safetensors&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®‰å…¨åºåˆ—åŒ–ã€éœ€å®Œæ•´åŠ è½½åˆ°å†…å­˜&lt;/td&gt;
&lt;td&gt;äº‘ç«¯ GPU æ¨ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ONNX&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è·¨æ¡†æ¶é€šç”¨ã€ç¡¬ä»¶åŠ é€Ÿæ”¯æŒæœ‰é™&lt;/td&gt;
&lt;td&gt;è·¨å¹³å°éƒ¨ç½²&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å…­å…¸å‹åº”ç”¨åœºæ™¯"&gt;ğŸ’» &lt;strong&gt;å…­ã€å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬åœ° LLM éƒ¨ç½²&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;llama.cpp&lt;/code&gt; æˆ– &lt;code&gt;Ollama&lt;/code&gt; åœ¨ä¸ªäººç”µè„‘è¿è¡Œç™¾äº¿çº§æ¨¡å‹ï¼ˆå¦‚ LLaMA-3ã€Qwen2ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¾¹ç¼˜è®¡ç®—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ ‘è“æ´¾ç­‰è®¾å¤‡éƒ¨ç½²è½»é‡åŒ–æ¨¡å‹ï¼ˆå¦‚ 0.6B å‚æ•°çš„ &lt;code&gt;Qwen3-Embedding&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;RAG ç³»ç»Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆåµŒå…¥æ¨¡å‹ï¼ˆå¦‚ &lt;code&gt;Qwen3-Embedding-4B&lt;/code&gt;ï¼‰å’Œé‡æ’åºæ¨¡å‹ï¼ˆå¦‚ &lt;code&gt;Qwen3-Reranker&lt;/code&gt;ï¼‰æ„å»ºæœ¬åœ°çŸ¥è¯†åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸ƒæ¨¡å‹è½¬æ¢æ–¹æ³•"&gt;ğŸ”„ &lt;strong&gt;ä¸ƒã€æ¨¡å‹è½¬æ¢æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€å°†å…¶ä»–æ ¼å¼ï¼ˆå¦‚ Hugging Face çš„ &lt;code&gt;safetensors&lt;/code&gt;ï¼‰è½¬ä¸º GGUFï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å·¥å…·é“¾&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;llama.cpp&lt;/code&gt; çš„ &lt;code&gt;convert-hf-to-gguf.py&lt;/code&gt; è„šæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‡åŒ–æ­¥éª¤&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;python convert-hf-to-gguf.py &amp;lt;æ¨¡å‹ç›®å½•&amp;gt; --outfile &amp;lt;è¾“å‡ºæ–‡ä»¶.gguf&amp;gt;
./quantize &amp;lt;è¾“å…¥.gguf&amp;gt; &amp;lt;è¾“å‡º_é‡åŒ–ç‰ˆ.gguf&amp;gt; Q4_K_M
&lt;/code&gt;&lt;/pre&gt;&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;åœ¨çº¿è½¬æ¢&lt;/strong&gt;ï¼šé€šè¿‡ Hugging Face çš„ &lt;code&gt;gguf-my-repo&lt;/code&gt; ç©ºé—´ä¸€é”®è½¬æ¢ç¤¾åŒºæ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;GGUF é€šè¿‡&lt;strong&gt;é«˜æ•ˆå­˜å‚¨è®¾è®¡&lt;/strong&gt;ã€&lt;strong&gt;çµæ´»é‡åŒ–ç­–ç•¥&lt;/strong&gt;å’Œ&lt;strong&gt;è·¨å¹³å°å…¼å®¹æ€§&lt;/strong&gt;ï¼Œæˆä¸ºæœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²çš„&lt;strong&gt;äº‹å®æ ‡å‡†&lt;/strong&gt;ã€‚å…¶å•æ–‡ä»¶ç‰¹æ€§å¤§å¹…é™ä½äº†å¼€å‘è€…ä½¿ç”¨é—¨æ§›ï¼Œè€Œåˆ†å—é‡åŒ–æŠ€æœ¯åˆ™è®©ç™¾äº¿æ¨¡å‹åœ¨æ¶ˆè´¹çº§ç¡¬ä»¶ä¸Šæµç•…è¿è¡Œæˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
&lt;h2 id="q4_k_m"&gt;Q4_K_M
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Q4_K_M&lt;/code&gt; æ˜¯ &lt;strong&gt;GGUF æ¨¡å‹é‡åŒ–æ ¼å¼&lt;/strong&gt;ä¸­çš„ä¸€ç§ç‰¹å®šé‡åŒ–çº§åˆ«ï¼Œä¸“ä¸ºåœ¨èµ„æºå—é™è®¾å¤‡ï¼ˆå¦‚æ™®é€š PC æˆ–ç§»åŠ¨è®¾å¤‡ï¼‰ä¸Šé«˜æ•ˆè¿è¡Œå¤§è¯­è¨€æ¨¡å‹è€Œè®¾è®¡ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒå«ä¹‰çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸€å‘½åæ‹†è§£q4_k_m-çš„ç»“æ„å«ä¹‰"&gt;ğŸ”§ ä¸€ã€å‘½åæ‹†è§£ï¼š&lt;code&gt;Q4_K_M&lt;/code&gt; çš„ç»“æ„å«ä¹‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Q4&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¡¨ç¤ºä¸»é‡åŒ–ä½å®½ä¸º &lt;strong&gt;4 æ¯”ç‰¹&lt;/strong&gt;ï¼ˆå³æ¯ä¸ªæƒé‡å¹³å‡ç”¨ 4 ä½å­˜å‚¨ï¼‰ï¼Œæ˜¾è‘—å‹ç¼©æ¨¡å‹ä½“ç§¯ï¼ˆä¾‹å¦‚ 70 äº¿å‚æ•°æ¨¡å‹å¯å‹ç¼©è‡³çº¦ 4GBï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;K&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æŒ‡&lt;/p&gt;
&lt;p&gt;åˆ†å—é‡åŒ–ï¼ˆBlock-wise Quantizationï¼‰&lt;/p&gt;
&lt;p&gt;æŠ€æœ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æƒé‡çŸ©é˜µåˆ’åˆ†ä¸ºå¤šä¸ªå°å—ï¼ˆå¦‚æ¯ç»„ 32~64 ä¸ªæƒé‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå—ç‹¬ç«‹è®¡ç®—&lt;strong&gt;ç¼©æ”¾å› å­ï¼ˆScaleï¼‰&lt;/strong&gt; å’Œ &lt;strong&gt;é›¶ç‚¹ï¼ˆZero Pointï¼‰&lt;/strong&gt;ï¼Œå‡å°‘æ•´ä½“é‡åŒ–è¯¯å·®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;M&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¡¨ç¤º&lt;/p&gt;
&lt;p&gt;æ··åˆç²¾åº¦ä¼˜åŒ–çº§åˆ«ä¸ºä¸­ç­‰ï¼ˆMediumï¼‰&lt;/p&gt;
&lt;p&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹å…³é”®å±‚ï¼ˆå¦‚æ³¨æ„åŠ›æœºåˆ¶ä¸­çš„ &lt;code&gt;attention.wv&lt;/code&gt; å’Œå‰é¦ˆç½‘ç»œ &lt;code&gt;feed_forward.w2&lt;/code&gt;ï¼‰ä½¿ç”¨æ›´é«˜ç²¾åº¦ï¼ˆå¦‚ 6 æ¯”ç‰¹ï¼‰ï¼Œå…¶ä»–å±‚ç”¨ 4 æ¯”ç‰¹ã€‚&lt;/li&gt;
&lt;li&gt;å¹³è¡¡æ€§èƒ½ä¸èµ„æºå ç”¨ï¼Œæ˜¯ &lt;strong&gt;æ¨èé»˜è®¤é€‰æ‹©&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äºŒæ€§èƒ½ç‰¹ç‚¹å¹³è¡¡ä½“ç§¯é€Ÿåº¦ä¸ç²¾åº¦"&gt;âš–ï¸ äºŒã€æ€§èƒ½ç‰¹ç‚¹ï¼šå¹³è¡¡ä½“ç§¯ã€é€Ÿåº¦ä¸ç²¾åº¦
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Q4_K_M è¡¨ç°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¯¹æ¯”å…¶ä»–é‡åŒ–çº§åˆ«&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜å ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯”åŸæ¨¡å‹å° 70%ï¼ˆå¦‚ 7B æ¨¡å‹é™è‡³ ~4GBï¼‰&lt;/td&gt;
&lt;td&gt;æ¯” &lt;code&gt;Q5_K_M&lt;/code&gt; èŠ‚çœ 15% å†…å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨ç†é€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆCPU ä¸Šçº¦ 20 token/sï¼‰&lt;/td&gt;
&lt;td&gt;æ¯” &lt;code&gt;Q4_0&lt;/code&gt; ç•¥æ…¢ï¼Œä½†ç²¾åº¦æ›´é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç²¾åº¦ä¿æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŸå¤± &amp;lt;5%ï¼ˆåœ¨ WikiText æµ‹è¯•é›†ä¸Š PPL å›°æƒ‘åº¦æ¥è¿‘åŸæ¨¡å‹ï¼‰&lt;/td&gt;
&lt;td&gt;æ˜¾è‘—ä¼˜äº &lt;code&gt;Q4_0&lt;/code&gt;ï¼Œç•¥é€Šäº &lt;code&gt;Q5_K_M&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šç”¨ä»»åŠ¡ï¼ˆæ–‡æœ¬ç”Ÿæˆã€é—®ç­”ï¼‰ã€ä¸­ä½é…ç½®ç¡¬ä»¶ï¼ˆå¦‚ 16GB RAM çš„ç¬”è®°æœ¬ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜é…ç½®è®¾å¤‡å¯é€‰ &lt;code&gt;Q5_K_M&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰æŠ€æœ¯åŸç†å¦‚ä½•å®ç°é«˜æ•ˆå‹ç¼©"&gt;ğŸ› ï¸ ä¸‰ã€æŠ€æœ¯åŸç†ï¼šå¦‚ä½•å®ç°é«˜æ•ˆå‹ç¼©
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆç²¾åº¦ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ¨æ€è¯†åˆ«é‡è¦æƒé‡ï¼ˆå¦‚æ³¨æ„åŠ›å±‚çš„éƒ¨åˆ†å¼ é‡ï¼‰ï¼Œåˆ†é…æ›´é«˜æ¯”ç‰¹ï¼ˆ6-bitï¼‰ï¼Œéå…³é”®éƒ¨åˆ†ç”¨ 4-bitï¼Œæœ€å¤§åŒ–ä¿ç•™æ¨¡å‹èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å—é‡åŒ–ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªå—ç‹¬ç«‹é‡åŒ–ï¼Œé¿å…å…¨å±€è¯¯å·®ç´¯ç§¯ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;å—å†…æƒé‡å…±äº«ç¼©æ”¾å› å­ï¼Œå‡å°‘å­˜å‚¨å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;è¶…å—ï¼ˆSuper Blockï¼‰ç»“æ„è¿›ä¸€æ­¥ç»†åŒ–ç²¾åº¦æ§åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”å®ä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨&lt;/p&gt;
&lt;p&gt;LLaMA-7B&lt;/p&gt;
&lt;p&gt;æµ‹è¯•ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Q4_K_M&lt;/code&gt; çš„ PPLï¼ˆå›°æƒ‘åº¦ï¼‰ä¸º &lt;strong&gt;6.8&lt;/strong&gt;ï¼Œæ¥è¿‘åŸæ¨¡å‹ï¼ˆ6.5ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è€Œ &lt;code&gt;Q4_0&lt;/code&gt; çš„ PPL ä¸º &lt;strong&gt;7.5&lt;/strong&gt;ï¼Œè¯¯å·®æ›´å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å››å®é™…åº”ç”¨å»ºè®®"&gt;ğŸ’¡ å››ã€å®é™…åº”ç”¨å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€š PC æˆ–ç¬”è®°æœ¬ï¼ˆ16GB RAMï¼‰éƒ¨ç½²å¤§æ¨¡å‹ï¼ˆå¦‚é€šä¹‰åƒé—® 4B/7Bï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å¹³è¡¡é€Ÿåº¦ä¸è´¨é‡çš„ RAGã€ä»£ç ç”Ÿæˆç­‰ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èµ„æºæåº¦ç´§å¼ ï¼ˆ&amp;lt;8GB RAMï¼‰â†’ é€‰ &lt;code&gt;Q4_0&lt;/code&gt; æˆ– &lt;code&gt;Q3_K_M&lt;/code&gt;ï¼ˆç‰ºç‰²ç²¾åº¦æ¢é€Ÿåº¦ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è¿½æ±‚æè‡´è´¨é‡ï¼ˆå¦‚å­¦æœ¯ç ”ç©¶ï¼‰â†’ é€‰ &lt;code&gt;Q5_K_M&lt;/code&gt; æˆ– &lt;code&gt;Q6_K&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ç¤ºä¾‹ï¼ˆOllamaï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ollama run qwen:7b-q4_k_m # æ‹‰å–é€šä¹‰åƒé—®7Bçš„Q4_K_Mé‡åŒ–ç‰ˆ
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-äº”æ³¨æ„äº‹é¡¹"&gt;âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é‡åŒ–æœ¬è´¨æœ‰æŸ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æç«¯ä»»åŠ¡ï¼ˆå¦‚é«˜ç²¾åº¦æ•°å­¦è®¡ç®—ï¼‰å¯èƒ½å—å½±å“ï¼Œå»ºè®®ä¼˜å…ˆæµ‹è¯•ä¸šåŠ¡åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡†æ¶å…¼å®¹æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»…é€‚ç”¨äº &lt;code&gt;llama.cpp&lt;/code&gt; æˆ– &lt;code&gt;Ollama&lt;/code&gt; ç­‰æ”¯æŒ GGUF çš„æ¨ç†æ¡†æ¶ï¼Œ&lt;strong&gt;ä¸å…¼å®¹ PyTorch æˆ– vLLM&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Q4_K_M = 4 æ¯”ç‰¹ä¸»é‡åŒ– + åˆ†å—ä¼˜åŒ– + ä¸­ç­‰æ··åˆç²¾åº¦&lt;/strong&gt;ï¼Œæ˜¯ &lt;strong&gt;æ€§ä»·æ¯”æœ€ä¼˜&lt;/strong&gt; çš„é‡åŒ–é€‰æ‹©ä¹‹ä¸€â€”â€”åœ¨å‹ç¼©ç‡ã€é€Ÿåº¦å’Œè´¨é‡é—´å–å¾—å¹³è¡¡ï¼Œé€‚åˆå¤§å¤šæ•°æœ¬åœ°åŒ–éƒ¨ç½²éœ€æ±‚ã€‚è‹¥ä½ æ­£åœ¨æ™®é€šé…ç½®è®¾å¤‡ä¸Šè¿è¡Œ 7B~13B çº§æ¨¡å‹ï¼Œå®ƒé€šå¸¸æ˜¯æœ€ç¨³å¦¥çš„èµ·ç‚¹ ğŸš€ã€‚&lt;/p&gt;</description></item></channel></rss>