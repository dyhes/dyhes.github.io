<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Postopia on é£é¸¿è¸é›ªæ³¥</title><link>https://dyhes.github.io/tags/postopia/</link><description>Recent content in Postopia on é£é¸¿è¸é›ªæ³¥</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 22 Oct 2025 16:27:30 +0800</lastBuildDate><atom:link href="https://dyhes.github.io/tags/postopia/index.xml" rel="self" type="application/rss+xml"/><item><title>ã€Postopiaã€‘caffeine</title><link>https://dyhes.github.io/p/postopiacaffeine/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiacaffeine/</guid><description>&lt;h2 id="caffeine"&gt;Caffeine
&lt;/h2&gt;&lt;p&gt;Caffeine æ˜¯ä¸€æ¬¾åŸºäº Java 8 çš„é«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜åº“ï¼Œç”± Google Guava Cache æ”¹è¿›è€Œæ¥ï¼Œç°å·²æˆä¸º Spring Boot é»˜è®¤çš„æœ¬åœ°ç¼“å­˜å®ç°ã€‚å…¶è®¾è®¡ä¸“æ³¨äºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿåœºæ™¯ï¼Œé€šè¿‡åˆ›æ–°çš„ç®—æ³•å’Œçµæ´»çš„é…ç½®ä¼˜åŒ–ç¼“å­˜å‘½ä¸­ç‡ä¸å†…å­˜ç®¡ç†ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§ã€å·¥ä½œåŸç†ã€ä½¿ç”¨åœºæ™¯ç­‰æ–¹é¢å±•å¼€è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒç‰¹æ€§"&gt;ğŸ”¥ &lt;strong&gt;æ ¸å¿ƒç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½ä¸é«˜å‘½ä¸­ç‡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Window TinyLFU ç®—æ³•&lt;/strong&gt;ï¼šCaffeine é‡‡ç”¨æ··åˆäº† LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰å’Œ LFUï¼ˆæœ€ä¸å¸¸ä½¿ç”¨ï¼‰ä¼˜åŠ¿çš„ç®—æ³•ï¼Œé€šè¿‡é¢‘ç‡ç»Ÿè®¡æ™ºèƒ½ä¿ç•™çƒ­ç‚¹æ•°æ®ï¼Œå‘½ä¸­ç‡æ¥è¿‘ç†è®ºæœ€ä¼˜å€¼ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ˜¾è‘—ä¼˜äºä¼ ç»Ÿ LRU ç®—æ³•&lt;a class="link" href="@ref" &gt;3,4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— é”å¹¶å‘è®¾è®¡&lt;/strong&gt;ï¼šåŸºäº Java 8 çš„ &lt;code&gt;StampedLock&lt;/code&gt; å’Œåˆ†æ®µé”æŠ€æœ¯ï¼Œå‡å°‘çº¿ç¨‹ç«äº‰ï¼Œæ”¯æŒé«˜ååé‡è®¿é—®ï¼ˆO(1) æ—¶é—´å¤æ‚åº¦ï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»çš„ç¼“å­˜ç­–ç•¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºäºå®¹é‡&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;maximumSize&lt;/code&gt; é™åˆ¶æ¡ç›®æ•°é‡ï¼Œæˆ–é€šè¿‡ &lt;code&gt;maximumWeight&lt;/code&gt; ç»“åˆæƒé‡å‡½æ•°ï¼ˆå¦‚æ•°æ®å¤§å°ï¼‰æ§åˆ¶å†…å­˜å ç”¨&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºæ—¶é—´ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;expireAfterWrite&lt;/code&gt;ï¼šå†™å…¥åå›ºå®šæ—¶é—´è¿‡æœŸï¼ˆå¦‚ 10 åˆ†é’Ÿï¼‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;expireAfterAccess&lt;/code&gt;ï¼šæœ€åä¸€æ¬¡è®¿é—®/å†™å…¥åå›ºå®šæ—¶é—´è¿‡æœŸï¼›
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;refreshAfterWrite&lt;/code&gt;ï¼šå†™å…¥åå®šæ—¶åˆ·æ–°ï¼ˆå¼‚æ­¥åŠ è½½æ–°å€¼ï¼Œä¸é˜»å¡è¯·æ±‚ï¼‰&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸºäºå¼•ç”¨&lt;/strong&gt;ï¼šæ”¯æŒå¼±å¼•ç”¨ï¼ˆ&lt;code&gt;weakKeys&lt;/code&gt;/&lt;code&gt;weakValues&lt;/code&gt;ï¼‰æˆ–è½¯å¼•ç”¨ï¼ˆ&lt;code&gt;softValues&lt;/code&gt;ï¼‰ï¼Œå…è®¸ JVM åœ¨å†…å­˜ä¸è¶³æ—¶å›æ”¶ç¼“å­˜&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ä¸è‡ªåŠ¨åŠ è½½&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥åŠ è½½ï¼ˆAsyncCacheï¼‰&lt;/strong&gt;ï¼šè¿”å› &lt;code&gt;CompletableFuture&lt;/code&gt;ï¼Œé€‚ç”¨äºéé˜»å¡ç¼–ç¨‹æ¨¡å‹ï¼Œé»˜è®¤ä½¿ç”¨ &lt;code&gt;ForkJoinPool&lt;/code&gt; æ‰§è¡ŒåŠ è½½ä»»åŠ¡&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥åŠ è½½ï¼ˆLoadingCacheï¼‰&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;CacheLoader&lt;/code&gt; å®ç°ç¼“å­˜æœªå‘½ä¸­æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®ï¼Œé¿å…æ‰‹åŠ¨å¤„ç†é€»è¾‘&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•åŠŸèƒ½&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ·˜æ±°ç›‘å¬&lt;/strong&gt;ï¼š&lt;code&gt;removalListener&lt;/code&gt; å¯æ•è·æ¡ç›®ç§»é™¤äº‹ä»¶ï¼ˆå¦‚è¿‡æœŸã€æ‰‹åŠ¨åˆ é™¤ï¼‰ï¼Œä¾¿äºæ—¥å¿—æˆ–èµ„æºæ¸…ç†&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡ç›‘æ§&lt;/strong&gt;ï¼š&lt;code&gt;recordStats()&lt;/code&gt; å¯ç”¨å‘½ä¸­ç‡ã€åŠ è½½è€—æ—¶ç­‰ç»Ÿè®¡ï¼Œè¾…åŠ©æ€§èƒ½ä¼˜åŒ–&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å·¥ä½œåŸç†ä¸å…³é”®æŠ€æœ¯"&gt;âš™ï¸ &lt;strong&gt;å·¥ä½œåŸç†ä¸å…³é”®æŠ€æœ¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜æ·˜æ±°æœºåˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨æƒ°æ€§åˆ é™¤ä¸å®šæœŸæ‰¹é‡æ¸…ç†ç»“åˆçš„ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;è¯»/å†™æ“ä½œæ—¶æ£€æŸ¥è¿‡æœŸæ—¶é—´ï¼Œå¼‚æ­¥å›æ”¶è¿‡æœŸæ¡ç›®ï¼›&lt;/li&gt;
&lt;li&gt;åå°çº¿ç¨‹å®šæœŸæ‰§è¡Œæ¸…ç†ä»»åŠ¡ï¼Œå‡å°‘ä¸»çº¿ç¨‹é˜»å¡&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜ç®¡ç†ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æƒé‡æ§åˆ¶&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;Weigher&lt;/code&gt; æ¥å£ä¸ºä¸åŒæ¡ç›®åˆ†é…æƒé‡ï¼Œé¿å…å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ™ºèƒ½é©±é€&lt;/strong&gt;ï¼šç»“åˆå®¹é‡ã€æ—¶é—´ã€å¼•ç”¨ç­–ç•¥ï¼Œç¡®ä¿å†…å­˜å ç”¨å¯æ§ï¼ˆä¾‹å¦‚ &lt;code&gt;maximumWeight&lt;/code&gt; ä¸ &lt;code&gt;weigher&lt;/code&gt; é…åˆï¼‰&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ·æ–°ä¸è¿‡æœŸåŒºåˆ«&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;expireAfterWrite&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†™å…¥åè¶…æ—¶&lt;/td&gt;
&lt;td&gt;é˜»å¡è¯·æ±‚ç›´è‡³æ–°å€¼åŠ è½½å®Œæˆ&lt;/td&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§åœºæ™¯ï¼ˆå¦‚é…ç½®æ•°æ®ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;refreshAfterWrite&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†™å…¥åè¶…æ—¶&lt;/td&gt;
&lt;td&gt;è¿”å›æ—§å€¼å¹¶å¼‚æ­¥åˆ·æ–°ï¼Œä¸é˜»å¡è¯·æ±‚&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘è¯»åœºæ™¯ï¼ˆå¦‚çƒ­ç‚¹æ•°æ®ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯"&gt;ğŸš€ &lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘è®¿é—®æ•°æ®ç¼“å­˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Web è¯·æ±‚ç»“æœã€ç”¨æˆ·ä¼šè¯ä¿¡æ¯ã€å•†å“è¯¦æƒ…ç­‰ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ï¼Œæå‡å“åº”é€Ÿåº¦ï¼ˆå¦‚ç”µå•†é¦–é¡µçƒ­ç‚¹å•†å“ï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¼“å­˜å›¾åƒå¤„ç†ç»“æœã€å¤§æ•°æ®åˆ†æä¸­é—´å€¼ï¼Œé¿å…é‡å¤è®¡ç®—ï¼ˆå¦‚å®æ—¶æŠ¥è¡¨ç”Ÿæˆï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¾®æœåŠ¡æ¶æ„ä¸­çš„æœ¬åœ°ç¼“å­˜å±‚&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸ºä¸‰çº§ç¼“å­˜ï¼ˆL1ï¼‰ä¸ Redisï¼ˆL2ï¼‰ã€æ•°æ®åº“ï¼ˆL3ï¼‰ååŒï¼š
&lt;ul&gt;
&lt;li&gt;L1ï¼ˆCaffeineï¼‰ï¼šè¿›ç¨‹å†…ç¼“å­˜ï¼Œçº³ç§’çº§è®¿é—®ï¼›&lt;/li&gt;
&lt;li&gt;L2ï¼ˆRedisï¼‰ï¼šè·¨è¿›ç¨‹å…±äº«ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®ä¸€è‡´æ€§é€šè¿‡ TTL æˆ–æ¶ˆæ¯é€šçŸ¥ä¿éšœ&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘ç³»ç»Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ç§’æ€ç³»ç»Ÿåº“å­˜ç¼“å­˜ï¼Œé€šè¿‡ &lt;code&gt;refreshAfterWrite&lt;/code&gt; å¼‚æ­¥æ›´æ–°ï¼Œé¿å…ç¼“å­˜å‡»ç©¿&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸å…¶ä»–ç¼“å­˜åº“å¯¹æ¯”"&gt;âš–ï¸ &lt;strong&gt;ä¸å…¶ä»–ç¼“å­˜åº“å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Caffeine&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Guava Cache&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Redis&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç®—æ³•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Window TinyLFU&lt;/td&gt;
&lt;td&gt;LRU&lt;/td&gt;
&lt;td&gt;å¤šç§ï¼ˆå¦‚ LRUï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¹¶å‘æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â­â­â­â­ï¼ˆæ— é”ä¼˜åŒ–ï¼‰&lt;/td&gt;
&lt;td&gt;â­â­ï¼ˆé”ç«äº‰ï¼‰&lt;/td&gt;
&lt;td&gt;â­â­â­ï¼ˆç½‘ç»œå»¶è¿Ÿï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çµæ´»ï¼ˆæƒé‡/å¤§å°ï¼‰&lt;/td&gt;
&lt;td&gt;åŸºç¡€&lt;/td&gt;
&lt;td&gt;ä¾èµ–å¤–éƒ¨é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ¬åœ°ç¼“å­˜&lt;/td&gt;
&lt;td&gt;å°è§„æ¨¡æœ¬åœ°ç¼“å­˜&lt;/td&gt;
&lt;td&gt;åˆ†å¸ƒå¼ç¼“å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€ä»£ç ç¤ºä¾‹"&gt;ğŸ’» &lt;strong&gt;åŸºç¡€ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åŒæ­¥åŠ è½½ç¼“å­˜ï¼ˆè‡ªåŠ¨åŠ è½½æ•°æ®ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;LoadingCache&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Caffeine&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;maximumSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;expireAfterWrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MINUTES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;refreshAfterWrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MINUTES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;recordStats&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userDao&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è·å–æ•°æ®ï¼ˆè‡ªåŠ¨åŠ è½½æœªå‘½ä¸­æ¡ç›®ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥åŠ è½½ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;AsyncLoadingCache&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asyncCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Caffeine&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;buildAsync&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userDao&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserAsync&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asyncCache&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user456&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–"&gt;âš ï¸ &lt;strong&gt;å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜å‘½ä¸­ç‡ä½&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–&lt;/strong&gt;ï¼šå¢å¤§ &lt;code&gt;maximumSize&lt;/code&gt;ã€è°ƒæ•´è¿‡æœŸæ—¶é—´ï¼ˆå¦‚å»¶é•¿ &lt;code&gt;expireAfterAccess&lt;/code&gt;ï¼‰ã€æ£€æŸ¥æ•°æ®åŠ è½½é€»è¾‘&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å ç”¨è¿‡é«˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;maximumWeight&lt;/code&gt; é™åˆ¶æƒé‡ã€å¯ç”¨ &lt;code&gt;weakValues&lt;/code&gt; æˆ– &lt;code&gt;softValues&lt;/code&gt;&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜é›ªå´©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢„é˜²&lt;/strong&gt;ï¼šåˆ†æ•£è¿‡æœŸæ—¶é—´ï¼ˆå¦‚éšæœº TTLï¼‰ã€ç»“åˆ &lt;code&gt;refreshAfterWrite&lt;/code&gt; å¼‚æ­¥åˆ·æ–°&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Caffeine å‡­å€Ÿ &lt;strong&gt;Window TinyLFU ç®—æ³•&lt;/strong&gt;ã€&lt;strong&gt;æ— é”å¹¶å‘&lt;/strong&gt;å’Œ&lt;strong&gt;çµæ´»çš„ç­–ç•¥ç»„åˆ&lt;/strong&gt;ï¼Œæˆä¸º Java æœ¬åœ°ç¼“å­˜çš„æ ‡æ†ã€‚å…¶é€‚ç”¨äºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿåœºæ™¯ï¼Œå¦‚å¾®æœåŠ¡ç¼“å­˜å±‚ã€çƒ­ç‚¹æ•°æ®åŠ é€Ÿç­‰ã€‚é€šè¿‡ä¸åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ç»„æˆå¤šçº§ç¼“å­˜ï¼Œå¯è¿›ä¸€æ­¥ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚å¼€å‘è€…å¯é€šè¿‡ä¸°å¯Œçš„é…ç½®ï¼ˆå®¹é‡ã€æ—¶é—´ã€æƒé‡ï¼‰å’Œç›‘æ§åŠŸèƒ½ï¼ˆ&lt;code&gt;recordStats&lt;/code&gt;ï¼‰å®ç°ç²¾ç»†åŒ–è°ƒä¼˜&lt;a class="link" href="@ref" &gt;3,4,5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="å¤šçº§ç¼“å­˜"&gt;å¤šçº§ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;Spring Boot ç»“åˆ Caffeineï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰å’Œ Redisï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰å®ç°å¤šçº§ç¼“å­˜ï¼Œèƒ½æ˜¾è‘—æå‡é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç³»ç»Ÿæ€§èƒ½ã€‚ä»¥ä¸‹åŸºäºå®æˆ˜ç»éªŒï¼Œè¯¦ç»†è¯´æ˜å®ç°æ­¥éª¤å’Œå®Œæ•´ä»£ç ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡"&gt;ğŸ“ &lt;strong&gt;å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;è¯·æ±‚æµç¨‹
&lt;pre tabindex="0"&gt;&lt;code&gt;è¯·æ±‚ â†’ Caffeineï¼ˆL1ï¼Œè¿›ç¨‹å†…ï¼‰â†’ å‘½ä¸­åˆ™è¿”å›
â†“ æœªå‘½ä¸­
Redisï¼ˆL2ï¼Œåˆ†å¸ƒå¼ï¼‰â†’ å‘½ä¸­åˆ™å›å¡«L1å¹¶è¿”å›
â†“ æœªå‘½ä¸­
æ•°æ®åº“ â†’ å›å¡«Rediså’ŒCaffeine
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒä¼˜åŠ¿
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½&lt;/strong&gt;ï¼šCaffeine æä¾›çº³ç§’çº§è®¿é—®ï¼Œæ‰¿è½½ 80% ä»¥ä¸Šçƒ­ç‚¹è¯·æ±‚&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¹é‡åˆ†å±‚&lt;/strong&gt;ï¼šRedis å­˜å‚¨å…¨é‡æ•°æ®ï¼ŒCaffeine ä»…å­˜é«˜é¢‘çƒ­ç‚¹&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§ä¿éšœ&lt;/strong&gt;ï¼šé€šè¿‡å¼‚æ­¥é€šçŸ¥ + TTL æ§åˆ¶æ•°æ®åŒæ­¥&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¾èµ–é…ç½®pomxml"&gt;âš™ï¸ &lt;strong&gt;ä¾èµ–é…ç½®ï¼ˆpom.xmlï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependencies&amp;gt;
&amp;lt;!-- Spring ç¼“å­˜æ”¯æŒ --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-starter-cache&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Caffeine æœ¬åœ°ç¼“å­˜ --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.github.ben-manes.caffeine&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;caffeine&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Redis åˆ†å¸ƒå¼ç¼“å­˜ --&amp;gt;
&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å¤šçº§ç¼“å­˜é…ç½®ç±»"&gt;ğŸ”§ &lt;strong&gt;å¤šçº§ç¼“å­˜é…ç½®ç±»&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableCaching&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CacheConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸€çº§ç¼“å­˜ï¼šCaffeineï¼ˆçŸ­å‘¨æœŸï¼Œé˜²ç©¿é€ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;caffeineCacheManager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CaffeineCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;manager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CaffeineCacheManager&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;manager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCaffeine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Caffeine&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;initialCapacity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆå§‹å®¹é‡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;maximumSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æœ€å¤§æ¡ç›®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;expireAfterWrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çŸ­TTLé¿å…æ—§æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;recordStats&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ç”¨ç»Ÿè®¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;manager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// äºŒçº§ç¼“å­˜ï¼šRedisï¼ˆé•¿å‘¨æœŸï¼Œå…¨é‡å­˜å‚¨ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;redisCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultCacheConfig&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entryTtl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofMinutes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é•¿TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serializeValuesWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisSerializationContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SerializationPair&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromSerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenericJackson2JsonRedisSerializer&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;cacheDefaults&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»„åˆå¤šçº§ç¼“å­˜ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Primary&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;multiLevelCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Qualifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;caffeineCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Qualifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;redisCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultiLevelCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-å¤šçº§ç¼“å­˜ç®¡ç†å™¨å®ç°"&gt;ğŸ§© &lt;strong&gt;å¤šçº§ç¼“å­˜ç®¡ç†å™¨å®ç°&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MultiLevelCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Caffeine&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Redis&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;caches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentHashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;MultiLevelCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;level1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;level2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;caches&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;computeIfAbsent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultiLevelCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MultiLevelCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;MultiLevelCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;level1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NoOpCache&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;level2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NoOpCache&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ValueWrapper&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1. å…ˆæŸ¥æœ¬åœ°ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ValueWrapper&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 2. å†æŸ¥Redis&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å›å¡«æœ¬åœ°ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸¤çº§å‡æœªå‘½ä¸­&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒå†™ç­–ç•¥ï¼šåŒæ—¶æ›´æ–°ä¸¤çº§ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒåˆ ç­–ç•¥ï¼šä¿è¯ä¸€è‡´æ€§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç©ºç¼“å­˜å®ç°ï¼ˆå®¹é”™ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;NoOpCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* åŸºç¡€æ–¹æ³•å®ç° */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-ä¸šåŠ¡å±‚ä½¿ç”¨ç¤ºä¾‹"&gt;ğŸ› ï¸ &lt;strong&gt;ä¸šåŠ¡å±‚ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ProductService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProductRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¯»å–æ•°æ®ï¼šè‡ªåŠ¨èµ°å¤šçº§ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getProduct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;orElse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡æ‹ŸDBæŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ›´æ–°æ•°æ®ï¼šæ¸…é™¤ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@CacheEvict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#product.id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateProduct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;product&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;product&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-å…³é”®ä¼˜åŒ–ç­–ç•¥"&gt;ğŸ›¡ï¸ &lt;strong&gt;å…³é”®ä¼˜åŒ–ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§ä¿éšœ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒåˆ ç­–ç•¥&lt;/strong&gt;ï¼šæ›´æ–°æ•°æ®ååŒæ—¶æ¸…é™¤ä¸¤çº§ç¼“å­˜ï¼ˆå¦‚ä¸Šä¾‹ &lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pub/Sub åŒæ­¥&lt;/strong&gt;ï¼šé€šè¿‡ Redis å‘å¸ƒè®¢é˜…ï¼Œé€šçŸ¥å…¶ä»–èŠ‚ç‚¹å¤±æ•ˆæœ¬åœ°ç¼“å­˜&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-Java" data-lang="Java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Redis æ¶ˆæ¯ç›‘å¬ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MessageListenerAdapter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;listenerAdapter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MessageListenerAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheEvictListener&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CacheEvictListener&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cacheKey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;caffeineCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheKey&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²ç¼“å­˜ç©¿é€&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¼“å­˜ç©ºå€¼ï¼ˆçŸ­TTLï¼‰ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NULL_OBJECT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¼“å­˜ç©ºå¯¹è±¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²é›ªå´©æœºåˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Redis TTL æ·»åŠ éšæœºæ‰°åŠ¨ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nextInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MINUTES&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è·å–Caffeineç»Ÿè®¡ä¿¡æ¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CacheStats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;caffeineCache&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getNativeCache&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stats&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;L1å‘½ä¸­ç‡: {}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hitRate&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯ä¸æ€§èƒ½å¯¹æ¯”"&gt;ğŸ’ &lt;strong&gt;é€‚ç”¨åœºæ™¯ä¸æ€§èƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½æå‡&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜é¢‘è¯»ï¼ˆå¦‚å•†å“è¯¦æƒ…ï¼‰&lt;/td&gt;
&lt;td&gt;å¤šçº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;QPS ä» 5.8ä¸‡ â†’ 120ä¸‡ &lt;a class="link" href="@ref" &gt;4&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä½é¢‘å†™é«˜ä¸€è‡´æ€§&lt;/td&gt;
&lt;td&gt;çº¯Redis&lt;/td&gt;
&lt;td&gt;æ•°æ®ä¸€è‡´ä½†å»¶è¿Ÿè¾ƒé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é™æ€æ•°æ®ï¼ˆå¦‚é…ç½®ï¼‰&lt;/td&gt;
&lt;td&gt;çº¯Caffeine&lt;/td&gt;
&lt;td&gt;é›¶ç½‘ç»œå»¶è¿Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šå®Œæ•´ä»£ç éœ€æ ¹æ®ä¸šåŠ¡è°ƒæ•´ä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Caffeine çš„ &lt;code&gt;refreshAfterWrite&lt;/code&gt;ï¼ˆæ­é… &lt;code&gt;CacheLoader&lt;/code&gt; å¼‚æ­¥åˆ·æ–°ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Redis åˆ†å¸ƒå¼é”æ§åˆ¶å›æºï¼ˆé˜²ç¼“å­˜å‡»ç©¿ï¼‰&lt;/li&gt;
&lt;li&gt;åŠ¨æ€é¢„çƒ­çƒ­ç‚¹æ•°æ®ï¼ˆ&lt;code&gt;@PostConstruct&lt;/code&gt; åŠ è½½é«˜é¢‘æ•°æ®ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;
é€šè¿‡ä»¥ä¸Šè®¾è®¡ï¼Œç³»ç»Ÿå¯æ˜¾è‘—é™ä½æ•°æ®åº“è´Ÿè½½ï¼ˆå®æµ‹ä¸‹é™ 90%ï¼‰ï¼ŒTP99 å»¶è¿Ÿä» 120ms é™è‡³ 45ms &lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚å®é™…éƒ¨ç½²æ—¶å»ºè®®é…åˆ &lt;strong&gt;Prometheus ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡&lt;/strong&gt;å’Œ &lt;strong&gt;Hystrix é™çº§ç­–ç•¥&lt;/strong&gt;ï¼Œä¿éšœé«˜å¯ç”¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="å·®å¼‚åŒ–å¤šçº§ç¼“å­˜"&gt;å·®å¼‚åŒ–å¤šçº§ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot åº”ç”¨ä¸­ï¼Œå¯é€šè¿‡&lt;strong&gt;åˆ†æ²»ç­–ç•¥&lt;/strong&gt;å®ç°éƒ¨åˆ†æ¥å£ä½¿ç”¨å¤šçº§ç¼“å­˜ï¼ˆCaffeine + Redisï¼‰ï¼Œå…¶ä½™æ¥å£ä»…ç”¨ Redis ç¼“å­˜ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆå’Œç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒé…ç½®åˆ›å»ºä¸¤ç±»ç¼“å­˜ç®¡ç†å™¨"&gt;ğŸ”§ &lt;strong&gt;æ ¸å¿ƒé…ç½®ï¼šåˆ›å»ºä¸¤ç±»ç¼“å­˜ç®¡ç†å™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¤šçº§ç¼“å­˜ç®¡ç†å™¨caffeine--redis"&gt;&lt;strong&gt;å¤šçº§ç¼“å­˜ç®¡ç†å™¨&lt;/strong&gt;ï¼ˆCaffeine + Redisï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CacheConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸€çº§ç¼“å­˜ï¼šCaffeineï¼ˆçŸ­TTLï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;caffeineCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;caffeineCacheManager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CaffeineCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;manager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CaffeineCacheManager&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;manager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCaffeine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Caffeine&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;maximumSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;expireAfterWrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çŸ­TTLé¿å…è„æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;manager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// äºŒçº§ç¼“å­˜ï¼šRedisï¼ˆé•¿TTLï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;redisCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;redisCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultCacheConfig&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entryTtl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofMinutes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;cacheDefaults&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤šçº§ç¼“å­˜ç»„åˆç®¡ç†å™¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;multiLevelCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;multiLevelCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Qualifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;caffeineCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Qualifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;redisCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompositeCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;level2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»„åˆä¸¤çº§ç¼“å­˜[1,4](@ref)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å•çº§redisç¼“å­˜ç®¡ç†å™¨ç‹¬ç«‹é…ç½®"&gt;&lt;strong&gt;å•çº§Redisç¼“å­˜ç®¡ç†å™¨&lt;/strong&gt;ï¼ˆç‹¬ç«‹é…ç½®ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;pureRedisCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pureRedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultCacheConfig&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entryTtl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofHours&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;cacheDefaults&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-ä¸šåŠ¡å±‚ä½¿ç”¨æŒ‰æ¥å£æŒ‡å®šç¼“å­˜ç­–ç•¥"&gt;ğŸ› ï¸ &lt;strong&gt;ä¸šåŠ¡å±‚ä½¿ç”¨ï¼šæŒ‰æ¥å£æŒ‡å®šç¼“å­˜ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¤šçº§ç¼“å­˜æ¥å£çƒ­ç‚¹æ•°æ®"&gt;&lt;strong&gt;å¤šçº§ç¼“å­˜æ¥å£&lt;/strong&gt;ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ProductService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä½¿ç”¨å¤šçº§ç¼“å­˜ï¼ˆä¼˜å…ˆæŸ¥Caffeineï¼Œæœªå‘½ä¸­æŸ¥Redisï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;multiLevelCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;hot_products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getHotProduct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;productRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;orElse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®åº“æŸ¥è¯¢[4](@ref)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å•çº§redisç¼“å­˜æ¥å£æ™®é€šæ•°æ®"&gt;&lt;strong&gt;å•çº§Redisç¼“å­˜æ¥å£&lt;/strong&gt;ï¼ˆæ™®é€šæ•°æ®ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»…ç”¨Redisç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;pureRedisCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;orElse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®åº“æŸ¥è¯¢[5](@ref)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="åŠ¨æ€æ¡ä»¶æ§åˆ¶æ›´ç²¾ç»†çš„ç²’åº¦"&gt;&lt;strong&gt;åŠ¨æ€æ¡ä»¶æ§åˆ¶&lt;/strong&gt;ï¼ˆæ›´ç²¾ç»†çš„ç²’åº¦ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;multiLevelCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;condition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#isHot == true&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»…å½“isHot=trueæ—¶å¯ç”¨å¤šçº§ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getProduct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;isHot&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-é«˜çº§åœºæ™¯è‡ªå®šä¹‰æ³¨è§£ç®€åŒ–é…ç½®"&gt;âš™ï¸ &lt;strong&gt;é«˜çº§åœºæ™¯ï¼šè‡ªå®šä¹‰æ³¨è§£ç®€åŒ–é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰æ³¨è§£-multilevelcache"&gt;å®šä¹‰æ³¨è§£ &lt;code&gt;@MultiLevelCache&lt;/code&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Target&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ElementType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;METHOD&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Retention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RetentionPolicy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;RUNTIME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;multiLevelCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@interface&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultiLevelCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;value&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;key&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="åœ¨ç›®æ ‡æ¥å£ä¸Šä½¿ç”¨"&gt;åœ¨ç›®æ ‡æ¥å£ä¸Šä½¿ç”¨
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@MultiLevelCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;orders&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#orderId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªåŠ¨èµ°å¤šçº§ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getOrder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸ä¼˜åŒ–"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ä¸€è‡´æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–°å¤šçº§ç¼“å­˜æ•°æ®æ—¶ï¼Œéœ€åŒæ—¶æ¸…é™¤æœ¬åœ°å’ŒRedisç¼“å­˜ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@CacheEvict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;multiLevelCacheManager&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;hot_products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateProduct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ &lt;strong&gt;Redis Pub/Sub é€šçŸ¥å…¶ä»–èŠ‚ç‚¹å¤±æ•ˆæœ¬åœ°ç¼“å­˜&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜æ§åˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰é™åˆ¶ &lt;code&gt;maximumSize&lt;/code&gt;ï¼Œé¿å… OOMã€‚&lt;/li&gt;
&lt;li&gt;éçƒ­ç‚¹æ•°æ®ç¦æ­¢ä½¿ç”¨å¤šçº§ç¼“å­˜ï¼Œå‡å°‘å†…å­˜å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§åŒºåˆ†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹ç›‘æ§ä¸¤ç±»ç¼“å­˜å‘½ä¸­ç‡ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å¤šçº§ç¼“å­˜ç›‘æ§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;caffeineCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;hot_products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getNativeCache&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stats&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;hitRate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Redisç¼“å­˜ç›‘æ§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users::123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹"&gt;ğŸ’ &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜é¢‘çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚å•†å“è¯¦æƒ…ï¼‰&lt;/td&gt;
&lt;td&gt;å¤šçº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Cacheable(cacheManager=&amp;quot;multiLevelCacheManager&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;çº³ç§’çº§å“åº”ï¼Œé™ä½Rediså‹åŠ›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä½é¢‘æ™®é€šæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰&lt;/td&gt;
&lt;td&gt;å•çº§Redis&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Cacheable(cacheManager=&amp;quot;pureRedisCacheManager&amp;quot;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;èŠ‚çœå†…å­˜ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¡ä»¶åŒ–ç¼“å­˜ï¼ˆåŠ¨æ€å†³ç­–ï¼‰&lt;/td&gt;
&lt;td&gt;æ³¨è§£+SpELæ¡ä»¶è¡¨è¾¾å¼&lt;/td&gt;
&lt;td&gt;&lt;code&gt;condition = &amp;quot;#isHot&amp;quot;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;çµæ´»æ§åˆ¶ç¼“å­˜å±‚çº§&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•è§£å†³å¤šçº§ç¼“å­˜çš„å…¸å‹é—®é¢˜"&gt;ğŸ” &lt;strong&gt;æ‰©å±•ï¼šè§£å†³å¤šçº§ç¼“å­˜çš„å…¸å‹é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç¼“å­˜ç©¿é€ï¼šåœ¨å¤šçº§ç¼“å­˜çš„ get æ–¹æ³•ä¸­ï¼Œå¯¹ç©ºå€¼è¿›è¡ŒçŸ­æ—¶é—´ç¼“å­˜ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;if (value == null) {
redisCache.put(key, NULL_OBJECT, 30, TimeUnit.SECONDS); // ç¼“å­˜ç©ºå€¼[5](@ref)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;ç¼“å­˜é›ªå´©ï¼šä¸º Redis çš„ TTL æ·»åŠ éšæœºæ‰°åŠ¨ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;.entryTtl(Duration.ofMinutes(30 + ThreadLocalRandom.current().nextInt(10)));
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šè®¾è®¡ï¼Œ&lt;strong&gt;çƒ­ç‚¹æ¥å£&lt;/strong&gt;ï¼ˆå¦‚ç§’æ€å•†å“æŸ¥è¯¢ï¼‰äº«å—æœ¬åœ°ç¼“å­˜çš„é€Ÿåº¦ä¼˜åŠ¿ï¼ˆ&amp;lt;10msï¼‰ï¼Œ&lt;strong&gt;æ™®é€šæ¥å£&lt;/strong&gt;ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ä¿æŒ Redis çš„å…¨å±€ä¸€è‡´æ€§ï¼ŒåŒæ—¶é¿å…å†…å­˜æµªè´¹ã€‚å®é™…éƒ¨ç½²æ—¶ï¼Œå»ºè®®ç»“åˆ &lt;strong&gt;Spring Actuator&lt;/strong&gt; ç›‘æ§ç¼“å­˜æŒ‡æ ‡ï¼Œå¹¶æ ¹æ®ä¸šåŠ¡æµé‡åŠ¨æ€è°ƒæ•´ç¼“å­˜ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id="è‡ªå®šä¹‰ttl"&gt;è‡ªå®šä¹‰TTL
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Bootä¸­ï¼Œ&lt;code&gt;@Cacheable&lt;/code&gt;æœ¬èº«ä¸ç›´æ¥æ”¯æŒTTLè®¾ç½®ï¼ˆå› å…¶ä¸ºæŠ½è±¡å±‚ï¼Œä¸ä¾èµ–å…·ä½“ç¼“å­˜å®ç°ï¼‰ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°è‡ªå®šä¹‰TTLï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-è‡ªå®šä¹‰cachemanageræ¨è"&gt;â³ &lt;strong&gt;è‡ªå®šä¹‰CacheManagerï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡æ‰©å±•&lt;code&gt;RedisCacheManager&lt;/code&gt;è§£æ&lt;code&gt;cacheNames&lt;/code&gt;ä¸­çš„TTLä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰CacheManager&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomRedisCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;CustomRedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisCacheWriter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;writer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;writer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;protected&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createRedisCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¼å¼ï¼šcacheName#TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseLong&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entryTtl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofSeconds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è®¾ç½®TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createRedisCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parts&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®Bean&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;cacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;defaultConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultCacheConfig&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entryTtl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofHours&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é»˜è®¤TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CustomRedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheWriter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nonLockingRedisCacheWriter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;defaultConfig&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheNames&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users#3600&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// TTL=3600ç§’&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç®€æ´é«˜æ•ˆï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç &lt;a class="link" href="@ref" &gt;1,2,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è‡ªå®šä¹‰æ³¨è§£aop"&gt;âœ¨ &lt;strong&gt;è‡ªå®šä¹‰æ³¨è§£+AOP&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡è‡ªå®šä¹‰æ³¨è§£ï¼ˆå¦‚&lt;code&gt;@CacheTTL&lt;/code&gt;ï¼‰å’ŒAOPåŠ¨æ€è®¾ç½®TTLï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰æ³¨è§£&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Target&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="n"&gt;ElementType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;METHOD&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Retention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RetentionPolicy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;RUNTIME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@interface&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheTTL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;value&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é»˜è®¤60ç§’&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;AOPæ‹¦æˆª&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Aspect&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CacheTTLAspect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Around&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;@annotation(cacheTTL)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;applyTTL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProceedingJoinPoint&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pjp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheTTL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cacheTTL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cacheTTL&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å°†TTLå­˜å…¥ThreadLocal&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setTTL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pjp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å±•RedisCache&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomRedisCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTTL&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»ThreadLocalè·å–TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä½¿ç”¨è‡ªå®šä¹‰TTLå†™å…¥Redis&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cacheWriter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serializeKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serializeValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofSeconds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šè¯­ä¹‰æ˜ç¡®ï¼Œæ”¯æŒæ–¹æ³•çº§ç²¾ç»†æ§åˆ¶&lt;a class="link" href="@ref" &gt;1,6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç¼“å­˜æä¾›è€…åŸç”Ÿé…ç½®"&gt;âš™ï¸ &lt;strong&gt;ç¼“å­˜æä¾›è€…åŸç”Ÿé…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é’ˆå¯¹å…·ä½“ç¼“å­˜ä¸­é—´ä»¶é…ç½®å…¨å±€æˆ–ç¼“å­˜åŒºTTLï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Rediså…¨å±€é»˜è®¤TTL&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;cacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultCacheConfig&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entryTtl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofMinutes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰€æœ‰ç¼“å­˜é»˜è®¤30åˆ†é’Ÿ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;cacheDefaults&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ehcacheç¼“å­˜åŒºTTL&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ehcache&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;xml&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxEntriesLocalHeap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;1000&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;timeToLiveSeconds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;3600&amp;#34;&lt;/span&gt;&lt;span class="o"&gt;/&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TTL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;1å°æ—¶&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šTTLç»Ÿä¸€æˆ–æŒ‰ç¼“å­˜åŒºåˆ†ç»„è®¾ç½®&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ä¼˜å…ˆçº§ï¼š
&lt;ul&gt;
&lt;li&gt;æ–¹æ³•çº§æ³¨è§£TTL &amp;gt; ç¼“å­˜åŒºé…ç½® &amp;gt; å…¨å±€é»˜è®¤TTL&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ—¶é—´å•ä½ï¼š
&lt;ul&gt;
&lt;li&gt;Redisé»˜è®¤ç”¨ç§’ï¼ŒEhcacheæ”¯æŒç§’/æ¯«ç§’ï¼Œéœ€æ³¨æ„å•ä½è½¬æ¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¼“å­˜ç©¿é€ï¼š
&lt;ul&gt;
&lt;li&gt;çŸ­TTLç¼“å­˜ç©ºå€¼ï¼ˆ&lt;code&gt;unless = &amp;quot;#result == null&amp;quot;&lt;/code&gt;ï¼‰é¿å…é¢‘ç¹æŸ¥è¯¢DB&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŠ¨æ€åˆ·æ–°ï¼š
&lt;ul&gt;
&lt;li&gt;ç»“åˆ&lt;code&gt;@Scheduled&lt;/code&gt;+&lt;code&gt;@CacheEvict&lt;/code&gt;å®šæ—¶åˆ·æ–°çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚æå‰10ç§’ç»­æœŸï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ³•å¯¹æ¯”"&gt;ğŸ”„ &lt;strong&gt;æ–¹æ³•å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰CacheManager&lt;/td&gt;
&lt;td&gt;Redisç¯å¢ƒï¼Œéœ€å¿«é€Ÿé›†æˆ&lt;/td&gt;
&lt;td&gt;ä»£ç ä¾µå…¥å°ï¼Œé…ç½®çµæ´»&lt;/td&gt;
&lt;td&gt;éœ€è§„èŒƒcacheNamesæ ¼å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰æ³¨è§£+AOP&lt;/td&gt;
&lt;td&gt;éœ€è¦æ–¹æ³•çº§ç²¾ç»†æ§åˆ¶&lt;/td&gt;
&lt;td&gt;è¯­ä¹‰æ¸…æ™°ï¼Œæ‰©å±•æ€§å¼º&lt;/td&gt;
&lt;td&gt;AOPå¢åŠ å¤æ‚åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¼“å­˜æä¾›è€…åŸç”Ÿé…ç½®&lt;/td&gt;
&lt;td&gt;TTLåˆ†ç»„æˆ–å…¨å±€ç»Ÿä¸€&lt;/td&gt;
&lt;td&gt;æ— éœ€ä»£ç æ”¹åŠ¨ï¼Œä¾èµ–ä¸­é—´ä»¶èƒ½åŠ›&lt;/td&gt;
&lt;td&gt;çµæ´»æ€§ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;æ¨èé€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®€å•åœºæ™¯ â†’ &lt;strong&gt;è‡ªå®šä¹‰CacheManager&lt;/strong&gt;ï¼ˆå¿«é€Ÿç”Ÿæ•ˆï¼‰&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å¤æ‚é€»è¾‘ â†’ &lt;strong&gt;è‡ªå®šä¹‰æ³¨è§£+AOP&lt;/strong&gt;ï¼ˆå¦‚åŠ¨æ€TTL+è‡ªåŠ¨åˆ·æ–°ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="å»¶è¿ŸåŒåˆ "&gt;å»¶è¿ŸåŒåˆ 
&lt;/h2&gt;&lt;p&gt;åœ¨Springåº”ç”¨ä¸­å®ç°å»¶è¿ŸåŒåˆ ç­–ç•¥ï¼Œéœ€ç»“åˆç¼“å­˜æ³¨è§£ï¼ˆå¦‚&lt;code&gt;@CacheEvict&lt;/code&gt;ï¼‰ä¸å¼‚æ­¥å»¶è¿Ÿåˆ é™¤æœºåˆ¶ï¼Œè§£å†³é«˜å¹¶å‘ä¸‹ç¼“å­˜ä¸æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§ä¸»æµå®ç°æ–¹æ¡ˆåŠæ ¸å¿ƒå®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å»¶è¿ŸåŒåˆ çš„æ ¸å¿ƒåŸç†"&gt;âš™ï¸ &lt;strong&gt;å»¶è¿ŸåŒåˆ çš„æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é—®é¢˜åœºæ™¯&lt;/strong&gt;ï¼š
åœ¨å¹¶å‘æ›´æ–°æ—¶ï¼Œè‹¥ä»…åˆ é™¤ä¸€æ¬¡ç¼“å­˜ï¼Œå¯èƒ½å‡ºç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¿ç¨‹Aåˆ é™¤ç¼“å­˜ â†’ æ›´æ–°æ•°æ®åº“ï¼ˆè€—æ—¶æ“ä½œï¼‰&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹Båœ¨Aæ›´æ–°å®Œæˆå‰è¯»å–æ•°æ®åº“æ—§æ•°æ® â†’ å°†æ—§æ•°æ®å†™å…¥ç¼“å­˜&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹Aæ›´æ–°å®Œæˆï¼Œä½†ç¼“å­˜å·²è¢«Bæ±¡æŸ“ï¼Œå¯¼è‡´åç»­è¯·æ±‚è¯»å–è„æ•°æ®ã€‚
&lt;strong&gt;å»¶è¿ŸåŒåˆ æµç¨‹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¦–æ¬¡åˆ é™¤ç¼“å­˜&lt;/strong&gt;ï¼šæ›´æ–°æ•°æ®åº“å‰åˆ é™¤ç¼“å­˜ï¼Œé˜²æ­¢æ—§æ•°æ®è¢«è¯»å–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°æ•°æ®åº“&lt;/strong&gt;ï¼šæ‰§è¡Œä¸šåŠ¡æ•°æ®æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿ŸäºŒæ¬¡åˆ é™¤&lt;/strong&gt;ï¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆå¦‚500msï¼‰åå†æ¬¡åˆ é™¤ç¼“å­˜ï¼Œç¡®ä¿å¹¶å‘è¯»æ“ä½œå·²å®Œæˆï¼Œé¿å…è„æ•°æ®æ®‹ç•™ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å®ç°æ–¹æ¡ˆä¸€åŸºäºaopåˆ‡é¢--è‡ªå®šä¹‰æ³¨è§£"&gt;ğŸ› ï¸ &lt;strong&gt;å®ç°æ–¹æ¡ˆä¸€ï¼šåŸºäºAOPåˆ‡é¢ + è‡ªå®šä¹‰æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰è‡ªå®šä¹‰æ³¨è§£"&gt;&lt;strong&gt;å®šä¹‰è‡ªå®šä¹‰æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Target&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ElementType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;METHOD&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Retention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RetentionPolicy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;RUNTIME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@interface&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DelayDoubleDelete&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;cacheName&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¼“å­˜åç§°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å®ç°aopåˆ‡é¢æ ¸å¿ƒé€»è¾‘"&gt;&lt;strong&gt;å®ç°AOPåˆ‡é¢ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Aspect&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DelayDoubleDeleteAspect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Around&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;@annotation(delayDelete)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doDelayDelete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProceedingJoinPoint&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DelayDoubleDelete&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delayDelete&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MethodSignature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MethodSignature&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSignature&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;signature&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMethod&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1. é¦–æ¬¡åˆ é™¤ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delayDelete&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cacheName&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;:*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡ç³ŠåŒ¹é…Key&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 2. æ‰§è¡Œæ•°æ®åº“æ›´æ–°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 3. å»¶è¿ŸäºŒæ¬¡åˆ é™¤ï¼ˆå¼‚æ­¥çº¿ç¨‹ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;runAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delayDelete&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keysAgain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;:*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keysAgain&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentThread&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;interrupt&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ä¸šåŠ¡å±‚ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;ä¸šåŠ¡å±‚ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@DelayDoubleDelete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userCache&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ›´æ–°æ•°æ®åº“&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-å®ç°æ–¹æ¡ˆäºŒå¢å¼ºcachemanageréä¾µå…¥å¼"&gt;ğŸ”Œ &lt;strong&gt;å®ç°æ–¹æ¡ˆäºŒï¼šå¢å¼ºCacheManagerï¼ˆéä¾µå…¥å¼ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥å¸Œæœ›æ— ä¾µå…¥å¼é›†æˆï¼Œå¯åŒ…è£…Spring Cacheçš„&lt;code&gt;CacheManager&lt;/code&gt;ï¼Œè‡ªåŠ¨ä¸º&lt;code&gt;@CacheEvict&lt;/code&gt;æ·»åŠ å»¶è¿ŸåŒåˆ é€»è¾‘ã€‚&lt;/p&gt;
&lt;h4 id="åŒ…è£…cacheä¸cachemanager"&gt;&lt;strong&gt;åŒ…è£…Cacheä¸CacheManager&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;EnhancedCache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é¦–æ¬¡åˆ é™¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;runAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;evict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿ŸäºŒæ¬¡åˆ é™¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ignored&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;EnhancedCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EnhancedCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCache&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ³¨å†Œå¢å¼ºcachemanagerè‡³springå®¹å™¨"&gt;&lt;strong&gt;æ³¨å†Œå¢å¼ºCacheManagerè‡³Springå®¹å™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CacheConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;cacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;defaultManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCacheManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EnhancedCacheManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;defaultManager&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿ500ms&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šæ‰€æœ‰ä½¿ç”¨&lt;code&gt;@CacheEvict&lt;/code&gt;çš„æ–¹æ³•è‡ªåŠ¨è§¦å‘å»¶è¿ŸåŒåˆ ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿæ—¶é—´è®¾ç½®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å»ºè®®&lt;strong&gt;500ms-1000ms&lt;/strong&gt;ï¼Œæ ¹æ®ä¸šåŠ¡SQLå¹³å‡æ‰§è¡Œæ—¶é—´è°ƒæ•´ã€‚&lt;/li&gt;
&lt;li&gt;å¯é€šè¿‡SpELåŠ¨æ€è®¾ç½®ï¼š&lt;code&gt;@DelayDoubleDelete(delay = &amp;quot;#{T(java.lang.Math).min(1000, #user.updateTime)})&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜Keyçš„åŒ¹é…&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;redisTemplate.keys(pattern)&lt;/code&gt;éœ€è°¨æ…ï¼Œé¿å…æ¨¡ç³ŠåŒ¹é…å¯¼è‡´è¯¯åˆ ã€‚&lt;/li&gt;
&lt;li&gt;æ¨è&lt;strong&gt;ç²¾ç¡®Keyå®šä½&lt;/strong&gt;ï¼šåœ¨æ³¨è§£ä¸­æŒ‡å®šKeyè¡¨è¾¾å¼ï¼ˆå¦‚&lt;code&gt;key = &amp;quot;#user.id&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹æ± ä¼˜åŒ–&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¼‚æ­¥åˆ é™¤éœ€ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;private final ScheduledExecutorService executor = Executors.newScheduledThreadPool(4);
executor.schedule(() -&amp;gt; deleteCache(key), delay, TimeUnit.MILLISECONDS);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯é™åˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»å¤šå†™å°‘&lt;/strong&gt;ï¼šé¢‘ç¹å†™æ“ä½œä¼šå¯¼è‡´ç¼“å­˜é¢‘ç¹å¤±æ•ˆï¼Œé™ä½æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼šå»¶è¿ŸåŒåˆ ä¸ä¿è¯å¼ºä¸€è‡´ï¼Œé€‚ç”¨äºå®¹å¿æ¯«ç§’çº§å»¶è¿Ÿçš„ä¸šåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”"&gt;ğŸ“Š &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;ä¾µå…¥æ€§&lt;/th&gt;
&lt;th&gt;çµæ´»æ€§&lt;/th&gt;
&lt;th&gt;ç»´æŠ¤æ€§&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AOP + è‡ªå®šä¹‰æ³¨è§£&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;éœ€ç»´æŠ¤åˆ‡é¢é€»è¾‘&lt;/td&gt;
&lt;td&gt;éœ€ç²¾ç»†æ§åˆ¶ç¼“å­˜Key&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¢å¼ºCacheManager&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;å…¨å±€ç”Ÿæ•ˆï¼Œæ— éœ€æ”¹ä¸šåŠ¡ä»£ç &lt;/td&gt;
&lt;td&gt;å…¨é¡¹ç›®ç»Ÿä¸€ç­–ç•¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¦–é€‰AOPæ–¹æ¡ˆ&lt;/strong&gt;ï¼šéœ€å®šåˆ¶åŒ–ç¼“å­˜æ¸…ç†é€»è¾‘æ—¶ï¼ˆå¦‚æ¨¡ç³Šåˆ é™¤ã€å¤šçº§ç¼“å­˜ï¼‰ï¼Œä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£æ›´çµæ´»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— ä¾µå…¥æ–¹æ¡ˆ&lt;/strong&gt;ï¼šè‹¥é¡¹ç›®å¹¿æ³›ä½¿ç”¨&lt;code&gt;@CacheEvict&lt;/code&gt;ï¼Œå¢å¼º&lt;code&gt;CacheManager&lt;/code&gt;å¯å¿«é€Ÿç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…œåº•ç­–ç•¥&lt;/strong&gt;ï¼šç»“åˆ&lt;strong&gt;çŸ­TTL&lt;/strong&gt;ï¼ˆå¦‚30sï¼‰ç¡®ä¿æç«¯æƒ…å†µä¸‹ç¼“å­˜è‡ªåŠ¨å¤±æ•ˆï¼ŒåŒé‡ä¿éšœæ•°æ®ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®Œæ•´ä»£ç å‚è€ƒï¼š&lt;a class="link" href="https://github.com/example/delay-double-delete" target="_blank" rel="noopener"
&gt;GitHubç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="cachemanager-å¢å¼º"&gt;CacheManager å¢å¼º
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring ç¯å¢ƒä¸‹ï¼Œ&lt;code&gt;EnhancedCache&lt;/code&gt; çš„å»¶è¿ŸåŒåˆ æœºåˆ¶ä¸äº‹åŠ¡å›æ»šçš„å†²çªæ ¸å¿ƒåœ¨äºï¼š&lt;strong&gt;äº‹åŠ¡å›æ»šæ—¶æ•°æ®åº“æ“ä½œè¢«æ’¤é”€ï¼Œä½†å¼‚æ­¥çš„äºŒæ¬¡åˆ é™¤ä»ä¼šæ‰§è¡Œï¼Œå¯¼è‡´æ–°å†™å…¥çš„ç¼“å­˜è¢«è¯¯åˆ &lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯ä¼˜åŒ–æ–¹æ¡ˆä¸åŸç†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é—®é¢˜æ ¹æº"&gt;âš ï¸ &lt;strong&gt;é—®é¢˜æ ¹æº&lt;/strong&gt;
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;CompletableFuture.runAsync(() -&amp;gt; {
Thread.sleep(delay);
delegate.evict(key); // äº‹åŠ¡å›æ»šåä»æ‰§è¡ŒäºŒæ¬¡åˆ é™¤
});
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;ï¼šè‹¥æ•°æ®åº“äº‹åŠ¡å›æ»šï¼ŒäºŒæ¬¡åˆ é™¤ä¼šæ¸…é™¤å…¶ä»–çº¿ç¨‹å†™å…¥çš„æ–°ç¼“å­˜ï¼ˆå¦‚æ–°æ’å…¥çš„æ•°æ®ï¼‰ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è§£å†³æ–¹æ¡ˆç»‘å®šäºŒæ¬¡åˆ é™¤åˆ°äº‹åŠ¡æäº¤"&gt;ğŸ”§ &lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼šç»‘å®šäºŒæ¬¡åˆ é™¤åˆ°äº‹åŠ¡æäº¤&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒæ”¹é€ æ€è·¯"&gt;&lt;strong&gt;æ ¸å¿ƒæ”¹é€ æ€è·¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å°†äºŒæ¬¡åˆ é™¤æ“ä½œå»¶è¿Ÿåˆ°äº‹åŠ¡æäº¤åæ‰§è¡Œï¼Œè‹¥äº‹åŠ¡å›æ»šåˆ™å–æ¶ˆåˆ é™¤ä»»åŠ¡ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Override
public void evict(Object key) {
delegate.evict(key); // é¦–æ¬¡åˆ é™¤
// ä»…åœ¨äº‹åŠ¡æäº¤åæ‰§è¡ŒäºŒæ¬¡åˆ é™¤
TransactionSynchronizationManager.registerSynchronization(
new TransactionSynchronization() {
@Override
public void afterCommit() {
scheduleSecondEvict(key); // æäº¤åè°ƒåº¦äºŒæ¬¡åˆ é™¤
}
}
);
}
private void scheduleSecondEvict(Object key) {
CompletableFuture.runAsync(() -&amp;gt; {
try {
Thread.sleep(delay);
delegate.evict(key);
} catch (InterruptedException ignored) {}
});
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;TransactionSynchronization.afterCommit()&lt;/code&gt; ç¡®ä¿äºŒæ¬¡åˆ é™¤ä»…åœ¨äº‹åŠ¡æˆåŠŸæäº¤åè§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥äº‹åŠ¡å›æ»šï¼Œ&lt;code&gt;afterCommit()&lt;/code&gt; ä¸ä¼šæ‰§è¡Œï¼Œé¿å…è¯¯åˆ æ–°ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤„ç†æ— äº‹åŠ¡åœºæ™¯"&gt;&lt;strong&gt;å¤„ç†æ— äº‹åŠ¡åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥å½“å‰æ— äº‹åŠ¡ï¼Œç›´æ¥æ‰§è¡Œå¼‚æ­¥åˆ é™¤ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Override
public void evict(Object key) {
delegate.evict(key);
if (TransactionSynchronizationManager.isActualTransactionActive()) {
// ç»‘å®šåˆ°äº‹åŠ¡æäº¤
TransactionSynchronizationManager.registerSynchronization(...);
} else {
// æ— äº‹åŠ¡æ—¶ç›´æ¥å¼‚æ­¥åˆ é™¤
scheduleSecondEvict(key);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å¢å¼ºå¥å£®æ€§"&gt;âš™ï¸ &lt;strong&gt;å¢å¼ºå¥å£®æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="çº¿ç¨‹æ± éš”ç¦»"&gt;&lt;strong&gt;çº¿ç¨‹æ± éš”ç¦»&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œé¿å…é˜»å¡äº‹åŠ¡çº¿ç¨‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;private final ScheduledExecutorService executor =
Executors.newScheduledThreadPool(4);
private void scheduleSecondEvict(Object key) {
executor.schedule(() -&amp;gt; delegate.evict(key), delay, TimeUnit.MILLISECONDS);
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="äº‹åŠ¡å›æ»šè¡¥å¿"&gt;&lt;strong&gt;äº‹åŠ¡å›æ»šè¡¥å¿&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥äº‹åŠ¡å›æ»šéœ€æ’¤é”€é¦–æ¬¡åˆ é™¤ï¼ˆå¤æ‚åœºæ™¯ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Override
public void evict(Object key) {
Object cachedValue = delegate.get(key).orElse(null); // å¤‡ä»½æ—§å€¼
delegate.evict(key); // é¦–æ¬¡åˆ é™¤
TransactionSynchronizationManager.registerSynchronization(
new TransactionSynchronization() {
@Override
public void afterCompletion(int status) {
if (status == STATUS_ROLLED_BACK) {
delegate.put(key, cachedValue); // å›æ»šæ—¶æ¢å¤æ—§ç¼“å­˜
} else if (status == STATUS_COMMITTED) {
scheduleSecondEvict(key); // æäº¤åäºŒæ¬¡åˆ é™¤
}
}
}
);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­¤æ–¹æ¡ˆé€‚ç”¨äº&lt;strong&gt;å¼ºä¸€è‡´æ€§è¦æ±‚&lt;/strong&gt;çš„åœºæ™¯ï¼Œä½†éœ€è€ƒè™‘ç¼“å­˜æ¢å¤çš„å¹¶å‘å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”-1"&gt;ğŸ“Š &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;ä¸€è‡´æ€§ä¿éšœ&lt;/th&gt;
&lt;th&gt;å¤æ‚åº¦&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;äº‹åŠ¡æäº¤åè§¦å‘äºŒæ¬¡åˆ é™¤&lt;/td&gt;
&lt;td&gt;é¿å…è¯¯åˆ æ–°ç¼“å­˜&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é€šç”¨åœºæ™¯ï¼ˆæ¨èï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å›æ»šæ—¶æ¢å¤æ—§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é‡‘è/æ”¯ä»˜ç­‰é«˜æ•æ„Ÿä¸šåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆäº‹åŠ¡ç»‘å®š&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;TransactionSynchronization.afterCommit()&lt;/code&gt; ç¡®ä¿äºŒæ¬¡åˆ é™¤ä»…åœ¨äº‹åŠ¡æäº¤åæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤‡ä»½æ¢å¤æ…ç”¨&lt;/strong&gt;ï¼šä»…åœ¨å¿…è¦æ—¶æ¢å¤æ—§ç¼“å­˜ï¼Œé¿å…å¹¶å‘å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿ŸåŒåˆ æœ¬è´¨&lt;/strong&gt;ï¼šè¯¥æœºåˆ¶é€‚ç”¨äº&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;åœºæ™¯ï¼Œè‹¥éœ€å¼ºä¸€è‡´æ€§ï¼Œå»ºè®®ç»“åˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¦‚ TCCï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®Œæ•´ä»£ç ç¤ºä¾‹å‚è€ƒï¼š&lt;a class="link" href="https://gist.github.com/example" target="_blank" rel="noopener"
&gt;GitHub Gist&lt;/a&gt;
æ‰©å±•é˜…è¯»ï¼š&lt;a class="link" href="https://spring.io/guides" target="_blank" rel="noopener"
&gt;Spring äº‹åŠ¡ä¸ç¼“å­˜ååŒè®¾è®¡&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="aop"&gt;AOP
&lt;/h2&gt;&lt;p&gt;åœ¨Springæ¡†æ¶ä¸­ï¼Œé€šè¿‡è‡ªå®šä¹‰AOPåˆ‡é¢ç»“åˆè‡ªå®šä¹‰æ³¨è§£æ–¹æ¡ˆï¼Œ&lt;strong&gt;å¯ä»¥è¯†åˆ«äº‹åŠ¡æ˜¯å¦å›æ»š&lt;/strong&gt;ï¼Œä½†éœ€ä¾èµ–Springçš„äº‹åŠ¡ç®¡ç†æœºåˆ¶å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆåŠæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå®ç°æ–¹æ¡ˆ"&gt;ğŸ” æ ¸å¿ƒå®ç°æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="é€šè¿‡"&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;TransactionSynchronizationManager&lt;/code&gt; ä¸»åŠ¨æŸ¥è¯¢äº‹åŠ¡çŠ¶æ€&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨åˆ‡é¢ä¸­å¯ç›´æ¥æ£€æŸ¥å½“å‰äº‹åŠ¡çš„æ ‡è®°çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Aspect&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomAspect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Around&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;@annotation(com.example.CustomAnnotation)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aroundAdvice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProceedingJoinPoint&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œä¸šåŠ¡æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ£€æŸ¥äº‹åŠ¡æ˜¯å¦è¢«æ ‡è®°ä¸ºå›æ»š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TransactionSynchronizationManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isActualTransactionActive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionAspectSupport&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTransactionStatus&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;isRollbackOnly&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ã€äº‹åŠ¡å·²æ ‡è®°å›æ»šã€‘&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‹¥ä¸šåŠ¡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡é€šå¸¸å·²æ ‡è®°å›æ»š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ã€äº‹åŠ¡å› å¼‚å¸¸å›æ»šã€‘&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;TransactionAspectSupport.currentTransactionStatus().isRollbackOnly()&lt;/code&gt; è¿”å› &lt;code&gt;true&lt;/code&gt; è¡¨ç¤ºäº‹åŠ¡å·²è¢«æ ‡è®°ä¸ºå›æ»šï¼ˆä¾‹å¦‚è°ƒç”¨ &lt;code&gt;setRollbackOnly()&lt;/code&gt; æˆ–æ»¡è¶³å›æ»šè§„åˆ™çš„å¼‚å¸¸ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TransactionSynchronizationManager.isActualTransactionActive()&lt;/code&gt; æ£€æŸ¥å½“å‰æ˜¯å¦å­˜åœ¨æ´»åŠ¨äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåœ¨æ–¹æ³•æ‰§è¡Œåæ£€æµ‹äº‹åŠ¡çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ³¨å†Œäº‹åŠ¡åŒæ­¥å›è°ƒæ¨è"&gt;&lt;strong&gt;æ³¨å†Œäº‹åŠ¡åŒæ­¥å›è°ƒï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;TransactionSynchronization&lt;/code&gt; ç›‘å¬äº‹åŠ¡æäº¤æˆ–å›æ»šäº‹ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Around&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;@annotation(com.example.CustomAnnotation)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aroundAdvice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProceedingJoinPoint&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ³¨å†Œäº‹åŠ¡åŒæ­¥å™¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionSynchronizationManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;registerSynchronization&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionSynchronization&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;afterCompletion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;STATUS_ROLLED_BACK&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ã€äº‹åŠ¡å·²å›æ»šã€‘&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;STATUS_COMMITTED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ã€äº‹åŠ¡å·²æäº¤ã€‘&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;afterCompletion&lt;/code&gt; å›è°ƒåœ¨äº‹åŠ¡å®Œæˆæ—¶è§¦å‘ï¼Œå‚æ•° &lt;code&gt;status&lt;/code&gt; æ ‡è¯†äº‹åŠ¡çŠ¶æ€ï¼ˆ&lt;code&gt;STATUS_ROLLED_BACK&lt;/code&gt; æˆ– &lt;code&gt;STATUS_COMMITTED&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šæ— éœ€ä¸»åŠ¨æŸ¥è¯¢ï¼Œç”±äº‹åŠ¡ç®¡ç†å™¨è‡ªåŠ¨é€šçŸ¥ï¼Œå‡†ç¡®æ€§é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="åœ¨åˆ‡é¢ä¸­ç›´æ¥è·å–"&gt;&lt;strong&gt;åœ¨åˆ‡é¢ä¸­ç›´æ¥è·å– &lt;code&gt;TransactionStatus&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥è‡ªå®šä¹‰åˆ‡é¢åœ¨äº‹åŠ¡åˆ‡é¢&lt;strong&gt;ä¹‹å&lt;/strong&gt;æ‰§è¡Œï¼ˆä¼˜å…ˆçº§æ›´ä½ï¼‰ï¼Œå¯ç›´æ¥æ³¨å…¥äº‹åŠ¡çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Aspect&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Ordered&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LOWEST_PRECEDENCE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¡®ä¿ä¼˜å…ˆçº§ä½äºäº‹åŠ¡åˆ‡é¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomAspect&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Around&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;@annotation(com.example.CustomAnnotation)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aroundAdvice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProceedingJoinPoint&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionStatus&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionAspectSupport&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTransactionStatus&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinPoint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isRollbackOnly&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;äº‹åŠ¡å·²æ ‡è®°å›æ»š&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;äº‹åŠ¡å› å¼‚å¸¸å›æ»š&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šåˆ‡é¢ä¼˜å…ˆçº§å¿…é¡»ä½äºäº‹åŠ¡åˆ‡é¢ï¼ˆ&lt;code&gt;@Order(Ordered.LOWEST_PRECEDENCE)&lt;/code&gt;ï¼‰ï¼Œå¦åˆ™æ— æ³•è·å–æ­£ç¡®çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;h4 id="åˆ‡é¢æ‰§è¡Œé¡ºåº"&gt;&lt;strong&gt;åˆ‡é¢æ‰§è¡Œé¡ºåº&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡åˆ‡é¢é»˜è®¤ä¼˜å…ˆçº§ä¸º &lt;code&gt;Ordered.LOWEST_PRECEDENCE&lt;/code&gt;ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šè‹¥è‡ªå®šä¹‰åˆ‡é¢ä¼˜å…ˆçº§æ›´é«˜ä¸”æœªæŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡åˆ‡é¢æ— æ³•æ„ŸçŸ¥å¼‚å¸¸ï¼Œå¯¼è‡´å›æ»šå¤±æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š
&lt;ul&gt;
&lt;li&gt;è‡ªå®šä¹‰åˆ‡é¢ä¼˜å…ˆçº§éœ€ä½äºäº‹åŠ¡åˆ‡é¢ï¼š&lt;code&gt;@Order(Ordered.LOWEST_PRECEDENCE + 1)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åˆ‡é¢ä¸­æ•è·å¼‚å¸¸åå¿…é¡»é‡æ–°æŠ›å‡ºæˆ–è°ƒç”¨ &lt;code&gt;setRollbackOnly()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ— äº‹åŠ¡åœºæ™¯"&gt;&lt;strong&gt;æ— äº‹åŠ¡åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‹¥æ–¹æ³•æœªå¼€å¯äº‹åŠ¡ï¼ˆå¦‚ &lt;code&gt;@Transactional(propagation = NOT_SUPPORTED)&lt;/code&gt;ï¼‰ï¼Œåˆ™ &lt;code&gt;TransactionSynchronizationManager.isActualTransactionActive()&lt;/code&gt; è¿”å› &lt;code&gt;false&lt;/code&gt;ï¼Œéœ€é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼‚æ­¥çº¿ç¨‹é—®é¢˜"&gt;&lt;strong&gt;å¼‚æ­¥çº¿ç¨‹é—®é¢˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡çŠ¶æ€ç»‘å®šäºå½“å‰çº¿ç¨‹ï¼Œè‹¥åˆ‡é¢å†…å¯ç”¨æ–°çº¿ç¨‹ï¼Œéœ€æ‰‹åŠ¨ä¼ é€’äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ˆå¦‚ä½¿ç”¨ &lt;code&gt;TransactionContextHolder&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹©"&gt;ğŸ’ æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹©
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;å‡†ç¡®æ€§&lt;/th&gt;
&lt;th&gt;å¤æ‚åº¦&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸»åŠ¨æŸ¥è¯¢äº‹åŠ¡çŠ¶æ€&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;ç®€å•çŠ¶æ€æ£€æµ‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;äº‹åŠ¡åŒæ­¥å›è°ƒ (&lt;code&gt;TransactionSynchronization&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;éœ€ç²¾å‡†ç›‘å¬äº‹åŠ¡ç”Ÿå‘½å‘¨æœŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç›´æ¥è·å– &lt;code&gt;TransactionStatus&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;åˆ‡é¢ä¼˜å…ˆçº§ä½äºäº‹åŠ¡åˆ‡é¢æ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ¨èå®è·µ&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;äº‹åŠ¡åŒæ­¥å›è°ƒ&lt;/strong&gt; æ–¹æ¡ˆï¼Œå¯é æ€§æœ€é«˜ä¸”ä¸äº‹åŠ¡ç”Ÿå‘½å‘¨æœŸè§£è€¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•ç¼–ç¨‹å¼æ ‡è®°å›æ»š"&gt;ğŸ› ï¸ æ‰©å±•ï¼šç¼–ç¨‹å¼æ ‡è®°å›æ»š
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€åœ¨åˆ‡é¢ä¸­ä¸»åŠ¨è§¦å‘å›æ»šï¼ˆå¦‚æƒé™æ ¡éªŒå¤±è´¥ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Around(&amp;#34;@annotation(com.example.CustomAnnotation)&amp;#34;)
public Object aroundAdvice(ProceedingJoinPoint joinPoint) throws Throwable {
if (!checkPermission()) {
// æ ‡è®°äº‹åŠ¡å›æ»š
TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
throw new SecurityException(&amp;#34;æƒé™ä¸è¶³&amp;#34;);
}
return joinPoint.proceed();
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤æ“ä½œä¼šå¼ºåˆ¶äº‹åŠ¡å›æ»šï¼Œä¸”åç»­äº‹åŠ¡åŒæ­¥å™¨å°†æ”¶åˆ° &lt;code&gt;STATUS_ROLLED_BACK&lt;/code&gt; äº‹ä»¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨è‡ªå®šä¹‰AOPåˆ‡é¢ä¸­è¯†åˆ«äº‹åŠ¡å›æ»šçš„å…³é”®æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡çŠ¶æ€æŸ¥è¯¢&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;TransactionAspectSupport.currentTransactionStatus()&lt;/code&gt; æˆ– &lt;code&gt;TransactionSynchronizationManager&lt;/code&gt; ä¸»åŠ¨æ£€æµ‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶ç›‘å¬&lt;/strong&gt;ï¼šæ³¨å†Œ &lt;code&gt;TransactionSynchronization&lt;/code&gt; å›è°ƒç›‘å¬æäº¤/å›æ»šäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ‡é¢é¡ºåº&lt;/strong&gt;ï¼šç¡®ä¿è‡ªå®šä¹‰åˆ‡é¢ä¼˜å…ˆçº§ä½äºäº‹åŠ¡åˆ‡é¢ï¼Œé¿å…çŠ¶æ€è¯¯åˆ¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šåˆ‡é¢å†…æ•è·å¼‚å¸¸åéœ€é‡æ–°æŠ›å‡ºæˆ–æ˜¾å¼è°ƒç”¨ &lt;code&gt;setRollbackOnly()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>ã€Postopiaã€‘Exactly Once</title><link>https://dyhes.github.io/p/postopiaexactly-once/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiaexactly-once/</guid><description>&lt;h2 id="è¯­ä¹‰"&gt;è¯­ä¹‰
&lt;/h2&gt;&lt;p&gt;Kafka çš„ä¸‰ç§æ¶ˆæ¯ä¼ é€’è¯­ä¹‰ï¼ˆ&lt;strong&gt;æœ€å¤šä¸€æ¬¡&lt;/strong&gt;ã€&lt;strong&gt;è‡³å°‘ä¸€æ¬¡&lt;/strong&gt;å’Œ&lt;strong&gt;ç²¾ç¡®ä¸€æ¬¡&lt;/strong&gt;ï¼‰æ˜¯æ¶ˆæ¯å¯é æ€§çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé€‚ç”¨äºä¸åŒä¸šåŠ¡åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€å¤šä¸€æ¬¡at-most-once"&gt;ğŸ”„ &lt;strong&gt;æœ€å¤šä¸€æ¬¡ï¼ˆAt Most Onceï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œä½†ç»ä¸é‡å¤ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…ç«¯&lt;/strong&gt;ï¼šè®¾ç½® &lt;code&gt;acks=0&lt;/code&gt;ï¼Œä¸ç­‰å¾… Broker ç¡®è®¤å³å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼›å…³é—­é‡è¯•ï¼ˆ&lt;code&gt;retries=0&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2,6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç«¯&lt;/strong&gt;ï¼šå¯ç”¨è‡ªåŠ¨æäº¤åç§»é‡ï¼ˆ&lt;code&gt;enable.auto.commit=true&lt;/code&gt;ï¼‰ï¼Œä¸”æäº¤é—´éš”çŸ­ï¼ˆ&lt;code&gt;auto.commit.interval.ms&lt;/code&gt; è¾ƒå°ï¼‰ã€‚æ¶ˆè´¹è€…å¯èƒ½åœ¨å¤„ç†æ¶ˆæ¯å‰å·²æäº¤åç§»é‡ï¼Œå´©æºƒæ—¶æœªå¤„ç†çš„æ¶ˆæ¯ä¸¢å¤±&lt;a class="link" href="@ref" &gt;6,7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šæ—¥å¿—é‡‡é›†ã€ç›‘æ§æŒ‡æ ‡ä¸ŠæŠ¥ç­‰å®¹å¿ä¸¢å¤±ä½†å¯¹é‡å¤æ•æ„Ÿçš„åœºæ™¯&lt;a class="link" href="@ref" &gt;9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è‡³å°‘ä¸€æ¬¡at-least-once"&gt;ğŸ” &lt;strong&gt;è‡³å°‘ä¸€æ¬¡ï¼ˆAt Least Onceï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¶ˆæ¯ç»ä¸ä¸¢å¤±ï¼Œä½†å¯èƒ½é‡å¤ï¼ˆéœ€ä¸šåŠ¡ç«¯å¹‚ç­‰å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…ç«¯&lt;/strong&gt;ï¼šè®¾ç½® &lt;code&gt;acks=all&lt;/code&gt;ï¼ˆç¡®ä¿æ‰€æœ‰ ISR å‰¯æœ¬å†™å…¥æˆåŠŸï¼‰å¹¶å¯ç”¨é‡è¯•ï¼ˆ&lt;code&gt;retries&amp;gt;0&lt;/code&gt;ï¼‰ã€‚è‹¥ Broker å“åº”è¶…æ—¶ï¼Œç”Ÿäº§è€…é‡å‘å¯èƒ½å¯¼è‡´æ¶ˆæ¯é‡å¤&lt;a class="link" href="@ref" &gt;3,8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç«¯&lt;/strong&gt;ï¼šå…³é—­è‡ªåŠ¨æäº¤ï¼ˆ&lt;code&gt;enable.auto.commit=false&lt;/code&gt;ï¼‰ï¼Œæ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;commitSync()&lt;/code&gt; æäº¤åç§»é‡ï¼Œä¸”&lt;strong&gt;å…ˆå¤„ç†æ¶ˆæ¯å†æäº¤&lt;/strong&gt;ã€‚è‹¥å¤„ç†æˆåŠŸä½†æäº¤å‰å´©æºƒï¼Œæ¶ˆæ¯ä¼šè¢«é‡æ–°æ¶ˆè´¹&lt;a class="link" href="@ref" &gt;6,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡åº”å¯¹ï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“å”¯ä¸€çº¦æŸï¼ˆå¦‚æ¶ˆæ¯ ID å»é‡ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¹‚ç­‰æ¥å£è®¾è®¡ï¼ˆå¤šæ¬¡è°ƒç”¨ç»“æœä¸€è‡´ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šè®¢å•å¤„ç†ã€ç§¯åˆ†å¢å‡ç­‰å®¹å¿é‡å¤ä½†ä¸å®¹å¿ä¸¢å¤±çš„åœºæ™¯&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ç²¾ç¡®ä¸€æ¬¡exactly-once"&gt;âœ… &lt;strong&gt;ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly Onceï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¶ˆæ¯æ—¢ä¸ä¸¢å¤±ä¹Ÿä¸é‡å¤ï¼ˆæœ€é«˜å¯é æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°æœºåˆ¶ï¼ˆéœ€ Kafka â‰¥0.11.0ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…ç«¯ï¼š
&lt;ul&gt;
&lt;li&gt;å¯ç”¨å¹‚ç­‰æ€§ï¼ˆ&lt;code&gt;enable.idempotence=true&lt;/code&gt;ï¼‰ï¼ŒBroker é€šè¿‡ PID å’Œåºåˆ—å·å»é‡&lt;a class="link" href="@ref" &gt;2,5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¼€å¯äº‹åŠ¡ï¼ˆ&lt;code&gt;transactional.id&lt;/code&gt;ï¼‰ï¼Œç¡®ä¿è·¨åˆ†åŒºæ¶ˆæ¯åŸå­æ€§ï¼ˆå…¨æˆåŠŸæˆ–å…¨å¤±è´¥ï¼‰&lt;a class="link" href="@ref" &gt;4,5,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…ç«¯ï¼š
&lt;ul&gt;
&lt;li&gt;è®¾ç½® &lt;code&gt;isolation.level=read_committed&lt;/code&gt;ï¼Œä»…è¯»å–å·²æäº¤äº‹åŠ¡çš„æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;5,6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨æäº¤åç§»é‡ï¼Œä¸”åç§»é‡æäº¤ä¸æ¶ˆæ¯å¤„ç†åœ¨åŒä¸€äº‹åŠ¡ä¸­&lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»£ç ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# ç”Ÿäº§è€…é…ç½®ï¼ˆPython ç¤ºä¾‹ï¼‰
conf = {&amp;#39;bootstrap.servers&amp;#39;: &amp;#39;localhost:9092&amp;#39;,
&amp;#39;enable.idempotence&amp;#39;: True,
&amp;#39;transactional.id&amp;#39;: &amp;#39;txn-group&amp;#39;}
producer = Producer(conf)
producer.init_transactions()
producer.begin_transaction()
producer.produce(&amp;#39;topic&amp;#39;, value=&amp;#39;message&amp;#39;)
producer.commit_transaction()
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;# æ¶ˆè´¹è€…é…ç½®
conf = {&amp;#39;bootstrap.servers&amp;#39;: &amp;#39;localhost:9092&amp;#39;,
&amp;#39;group.id&amp;#39;: &amp;#39;group1&amp;#39;,
&amp;#39;enable.auto.commit&amp;#39;: False,
&amp;#39;isolation.level&amp;#39;: &amp;#39;read_committed&amp;#39;}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šé‡‘èäº¤æ˜“ã€åº“å­˜æ‰£å‡ç­‰å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„ä¸šåŠ¡&lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰ç§è¯­ä¹‰å¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;âš–ï¸ &lt;strong&gt;ä¸‰ç§è¯­ä¹‰å¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æœ€å¤šä¸€æ¬¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è‡³å°‘ä¸€æ¬¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç²¾ç¡®ä¸€æ¬¡&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¶ˆæ¯ä¸¢å¤±é£é™©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯èƒ½ä¸¢å¤± âœ…&lt;/td&gt;
&lt;td&gt;ä¸ä¸¢å¤± âŒ&lt;/td&gt;
&lt;td&gt;ä¸ä¸¢å¤± âŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¶ˆæ¯é‡å¤é£é™©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸é‡å¤ âœ…&lt;/td&gt;
&lt;td&gt;å¯èƒ½é‡å¤ âŒ&lt;/td&gt;
&lt;td&gt;ä¸é‡å¤ âœ…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ€ä½ï¼ˆæ— é‡è¯•/äº‹åŠ¡ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;td&gt;æœ€é«˜ï¼ˆäº‹åŠ¡åè°ƒï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ—¥å¿—é‡‡é›†&lt;/td&gt;
&lt;td&gt;è®¢å•å¤„ç†&lt;/td&gt;
&lt;td&gt;é‡‘èäº¤æ˜“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‰å‹å»ºè®®&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆè‡³å°‘ä¸€æ¬¡&lt;/strong&gt;ï¼šå¤šæ•°ä¸šåŠ¡åœºæ™¯çš„é¦–é€‰ï¼ˆKafka é»˜è®¤è¯­ä¹‰ï¼‰ï¼Œéœ€ç»“åˆå¹‚ç­‰è®¾è®¡&lt;a class="link" href="@ref" &gt;8,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ…ç”¨ç²¾ç¡®ä¸€æ¬¡&lt;/strong&gt;ï¼šä»…åœ¨å¼ºä¸€è‡´æ€§éœ€æ±‚æ—¶ä½¿ç”¨ï¼Œå› äº‹åŠ¡æ€§èƒ½å¼€é”€æ˜¾è‘—&lt;a class="link" href="@ref" &gt;4,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®è·µæ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;å®è·µæ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ç”Ÿäº§è€…é‡è¯•ä¸ä¹±åºï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥ &lt;code&gt;max.in.flight.requests.per.connection &amp;gt; 1&lt;/code&gt; ä¸”æœªå¯ç”¨å¹‚ç­‰æ€§ï¼Œé‡è¯•å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¹±åº&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Broker æŒä¹…åŒ–é£é™©ï¼š
&lt;ul&gt;
&lt;li&gt;å³ä½¿ &lt;code&gt;acks=all&lt;/code&gt;ï¼Œè‹¥æ¶ˆæ¯ä»…å†™å…¥ Page Cache æœªåˆ·ç›˜ï¼Œå®•æœºä»å¯èƒ½ä¸¢å¤±ï¼ˆå¯é€šè¿‡ &lt;code&gt;flush&lt;/code&gt; å¼ºåˆ¶åˆ·ç›˜ï¼Œä½†æ€§èƒ½ä¸‹é™ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…åç§»é‡ç®¡ç†ï¼š
&lt;ul&gt;
&lt;li&gt;ç²¾ç¡®ä¸€æ¬¡éœ€ç¡®ä¿åç§»é‡æäº¤ä¸ä¸šåŠ¡å¤„ç†åŸå­æ€§ï¼ˆå¦‚æ•°æ®åº“äº‹åŠ¡ç»‘å®šï¼‰&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’ æ€»ç»“ï¼šç†è§£ Kafka çš„æ¶ˆæ¯è¯­ä¹‰éœ€ç»“åˆ&lt;strong&gt;ç”Ÿäº§è€…é…ç½®&lt;/strong&gt;ã€&lt;strong&gt;Broker æœºåˆ¶&lt;/strong&gt;åŠ&lt;strong&gt;æ¶ˆè´¹è€…é€»è¾‘&lt;/strong&gt;ã€‚æ ¹æ®ä¸šåŠ¡å®¹å¿åº¦é€‰æ‹©è¯­ä¹‰ï¼Œå¹¶é€šè¿‡å¹‚ç­‰ã€äº‹åŠ¡æˆ–å»é‡æœºåˆ¶å¼¥è¡¥æ½œåœ¨ç¼ºé™·ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="æ¶ˆè´¹ç«¯"&gt;æ¶ˆè´¹ç«¯
&lt;/h2&gt;&lt;p&gt;Kafka çš„ &lt;strong&gt;Exactly Onceï¼ˆç²¾ç¡®ä¸€æ¬¡ï¼‰&lt;/strong&gt; è¯­ä¹‰åœ¨ç”Ÿäº§è€…ç«¯é€šè¿‡&lt;strong&gt;å¹‚ç­‰æ€§ï¼ˆIdempotenceï¼‰&lt;/strong&gt; å’Œ&lt;strong&gt;äº‹åŠ¡ï¼ˆTransactionsï¼‰&lt;/strong&gt; æœºåˆ¶è§£å†³äº†æ¶ˆæ¯é‡å¤å†™å…¥çš„é—®é¢˜ï¼Œä½†è¿™ä»…è¦†ç›–äº†ç”Ÿäº§åˆ° Broker çš„é“¾è·¯ã€‚&lt;strong&gt;åœ¨æ¶ˆè´¹ç«¯ï¼Œä¸šåŠ¡ä»éœ€è‡ªè¡Œå®ç°å¹‚ç­‰æ€§&lt;/strong&gt;ï¼ŒåŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="kafka-exactly-once-çš„è¦†ç›–èŒƒå›´"&gt;Kafka Exactly Once çš„è¦†ç›–èŒƒå›´
&lt;/h3&gt;&lt;p&gt;Kafka çš„ Exactly Once è¯­ä¹‰åŒ…å«ä¸¤ä¸ªå±‚é¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…åˆ° Broker çš„ç²¾ç¡®ä¸€æ¬¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼ˆ&lt;code&gt;enable.idempotence=true&lt;/code&gt;ï¼‰ï¼šé€šè¿‡ PID + åºåˆ—å·æœºåˆ¶ï¼Œç¡®ä¿å•åˆ†åŒºå†…æ¶ˆæ¯ä¸é‡å¤å†™å…¥&lt;a class="link" href="@ref" &gt;2,5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡&lt;/strong&gt;ï¼ˆ&lt;code&gt;transactional.id&lt;/code&gt;ï¼‰ï¼šè·¨åˆ†åŒºåŸå­å†™å…¥ï¼Œç»“åˆ &lt;code&gt;sendOffsetsToTransaction&lt;/code&gt; å°†æ¶ˆè´¹ä½ç§»æäº¤ä¸ç”Ÿäº§æ¶ˆæ¯ç»‘å®šä¸ºåŸå­æ“ä½œ&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚
&lt;em&gt;ä¾‹å¦‚ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯å¹¶æäº¤ä½ç§»æ—¶ï¼Œè‹¥äº‹åŠ¡æˆåŠŸåˆ™ä½ç§»ä¸æ¶ˆæ¯åŒæ—¶ç”Ÿæ•ˆï¼›è‹¥å¤±è´¥åˆ™åŒæ—¶å›æ»šã€‚&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Broker åˆ°æ¶ˆè´¹è€…çš„ç²¾ç¡®ä¸€æ¬¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Kafka ä»…ä¿è¯&lt;strong&gt;ä½ç§»æäº¤ä¸æ¶ˆæ¯ç”Ÿäº§çš„åŸå­æ€§&lt;/strong&gt;ï¼ˆé€šè¿‡äº‹åŠ¡ï¼‰ï¼Œä½†&lt;strong&gt;æ— æ³•çº¦æŸæ¶ˆè´¹åçš„ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…å¯èƒ½å› æ•…éšœé‡å¯ã€é‡å¤æ‹‰å–æ¶ˆæ¯ç­‰åŸå› ï¼Œå¯¼è‡´&lt;strong&gt;åŒä¸€æ¡æ¶ˆæ¯è¢«å¤šæ¬¡å¤„ç†&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ºä»€ä¹ˆæ¶ˆè´¹ç«¯ä»éœ€å¹‚ç­‰æ€§"&gt;ä¸ºä»€ä¹ˆæ¶ˆè´¹ç«¯ä»éœ€å¹‚ç­‰æ€§ï¼Ÿ
&lt;/h3&gt;&lt;h4 id="kafka-äº‹åŠ¡çš„å±€é™æ€§"&gt;&lt;strong&gt;Kafka äº‹åŠ¡çš„å±€é™æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½ç§»æäº¤ä¸ä¸šåŠ¡è§£è€¦&lt;/strong&gt;ï¼š
Kafka äº‹åŠ¡ä»…ä¿è¯ä½ç§»å’Œæ¶ˆæ¯ç”Ÿäº§çš„åŸå­æ€§ï¼Œä½†&lt;strong&gt;æ¶ˆè´¹åçš„ä¸šåŠ¡æ“ä½œï¼ˆå¦‚å†™æ•°æ®åº“ã€è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼‰ä¸åœ¨äº‹åŠ¡èŒƒå›´å†…&lt;/strong&gt;â€‹&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚
&lt;em&gt;ä¾‹å¦‚ï¼šæ¶ˆè´¹è€…æäº¤ä½ç§»åä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œé‡å¯åé‡æ–°æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶ä¸ä¸­æ–­é£é™©&lt;/strong&gt;ï¼š
äº‹åŠ¡é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 1 åˆ†é’Ÿï¼ˆ&lt;code&gt;transaction.timeout.ms&lt;/code&gt;ï¼‰ï¼Œè‹¥ä¸šåŠ¡å¤„ç†è¶…æ—¶ï¼Œäº‹åŠ¡å¯èƒ½è¢«ä¸­æ­¢ï¼Œä½†ä¸šåŠ¡æ“ä½œå·²éƒ¨åˆ†æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ¶ˆè´¹è€…è‡ªèº«çš„é‡å¤è§¦å‘"&gt;&lt;strong&gt;æ¶ˆè´¹è€…è‡ªèº«çš„é‡å¤è§¦å‘&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½ç§»æäº¤å»¶è¿Ÿ&lt;/strong&gt;ï¼š
è‹¥æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯åã€æäº¤ä½ç§»å‰å´©æºƒï¼Œé‡å¯åä¼šé‡æ–°æ¶ˆè´¹æœªæäº¤ä½ç§»çš„æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Rebalance å¯¼è‡´é‡å¤æ¶ˆè´¹&lt;/strong&gt;ï¼š
æ¶ˆè´¹è€…ç»„é‡å¹³è¡¡æ—¶ï¼Œåˆ†åŒºå¯èƒ½è¢«åˆ†é…ç»™æ–°æ¶ˆè´¹è€…ï¼Œå¯¼è‡´å·²å¤„ç†ä½†æœªæäº¤ä½ç§»çš„æ¶ˆæ¯è¢«å†æ¬¡æ¶ˆè´¹&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§çš„å®ç°æ–¹æ¡ˆ"&gt;æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§çš„å®ç°æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="-æ ¸å¿ƒåŸåˆ™ä¸šåŠ¡é€»è¾‘çš„é‡å¤æ‰§è¡Œç»“æœä¸å˜"&gt;âœ… æ ¸å¿ƒåŸåˆ™ï¼š&lt;strong&gt;ä¸šåŠ¡é€»è¾‘çš„é‡å¤æ‰§è¡Œç»“æœä¸å˜&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å”¯ä¸€é”®çº¦æŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å¯¹æ¶ˆæ¯ID/ä¸šåŠ¡ä¸»é”®å»ºå”¯ä¸€ç´¢å¼•ï¼Œé‡å¤æ’å…¥ç›´æ¥æŠ¥é”™&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å†™å…¥ç±»æ“ä½œï¼ˆå¦‚è®¢å•åˆ›å»ºï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çŠ¶æ€æœºæ ¡éªŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸šåŠ¡çŠ¶æ€æœºæ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å·²å¤„ç†ï¼ˆå¦‚è®¢å•çŠ¶æ€ä»â€œæœªæ”¯ä»˜â€åˆ°â€œå·²æ”¯ä»˜â€ä¸å¯é€†ï¼‰&lt;/td&gt;
&lt;td&gt;çŠ¶æ€é©±åŠ¨å‹ä¸šåŠ¡ï¼ˆå¦‚æ”¯ä»˜ã€åº“å­˜æ‰£å‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å»é‡è¡¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¶ˆè´¹å‰æŸ¥è¯¢å»é‡è¡¨ï¼Œè‹¥æ¶ˆæ¯IDå­˜åœ¨åˆ™è·³è¿‡å¤„ç†&lt;/td&gt;
&lt;td&gt;é«˜é¢‘æ¶ˆæ¯ä¸”å»é‡è¡¨è¯»å†™æ€§èƒ½é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¹‚ç­‰å†™å…¥æ¥å£&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸‹æ¸¸æœåŠ¡æš´éœ²å¹‚ç­‰æ¥å£ï¼ˆå¦‚HTTP PUTï¼‰ï¼Œç›¸åŒè¯·æ±‚å¤šæ¬¡è°ƒç”¨ç»“æœä¸€è‡´&lt;/td&gt;
&lt;td&gt;è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="-ä»£ç ç¤ºä¾‹æ¶ˆè´¹ç«¯å»é‡ä¼ªä»£ç "&gt;ğŸ’¡ ä»£ç ç¤ºä¾‹ï¼ˆæ¶ˆè´¹ç«¯å»é‡ä¼ªä»£ç ï¼‰
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// æ¶ˆè´¹æ¶ˆæ¯
ConsumerRecords&amp;lt;String, String&amp;gt; records = consumer.poll();
for (ConsumerRecord record : records) {
String msgId = record.headers().get(&amp;#34;msg_id&amp;#34;); // æ¶ˆæ¯å”¯ä¸€ID
if (!isProcessed(msgId)) { // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
processBusiness(record); // æ‰§è¡Œä¸šåŠ¡
saveToDedupeTable(msgId); // è®°å½•å·²å¤„ç†
}
consumer.commitSync(); // æäº¤ä½ç§»ï¼ˆå¯é…åˆäº‹åŠ¡ï¼‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“exactly-once-çš„å®Œæ•´å®ç°é“¾æ¡"&gt;æ€»ç»“ï¼šExactly Once çš„å®Œæ•´å®ç°é“¾æ¡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…ç«¯&lt;/strong&gt;ï¼š
å¼€å¯å¹‚ç­‰æ€§ï¼ˆ&lt;code&gt;enable.idempotence=true&lt;/code&gt;ï¼‰å’Œäº‹åŠ¡ï¼ˆ&lt;code&gt;transactional.id&lt;/code&gt;ï¼‰ï¼Œé¿å…æ¶ˆæ¯é‡å¤å†™å…¥&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Broker ç«¯&lt;/strong&gt;ï¼š
äº‹åŠ¡ä¿è¯è·¨åˆ†åŒºåŸå­æ€§ï¼Œç»“åˆ &lt;code&gt;isolation.level=read_committed&lt;/code&gt; éš”ç¦»æœªæäº¤æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç«¯&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;å¿…é¡»è‡ªè¡Œå®ç°ä¸šåŠ¡å¹‚ç­‰æ€§&lt;/strong&gt;ï¼Œé€šè¿‡å”¯ä¸€é”®ã€çŠ¶æ€æœºç­‰æœºåˆ¶é˜²å¾¡é‡å¤å¤„ç†&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ”¥ &lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼š
Kafka çš„ Exactly Once â€‹&lt;strong&gt;ä»…è¦†ç›–åˆ°æ¶ˆæ¯å†™å…¥å’Œä½ç§»æäº¤é˜¶æ®µ&lt;/strong&gt;ï¼Œæ¶ˆè´¹ç«¯ä¸šåŠ¡é€»è¾‘çš„å¹‚ç­‰æ€§&lt;strong&gt;ä»éœ€å¼€å‘è€…è‡ªä¸»å®ç°&lt;/strong&gt;ï¼Œè¿™æ˜¯ç«¯åˆ°ç«¯ç²¾ç¡®ä¸€æ¬¡çš„æœ€åä¸€é“é˜²çº¿ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="æœåŠ¡ç«¯"&gt;æœåŠ¡ç«¯
&lt;/h2&gt;&lt;p&gt;åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸­ï¼Œâ€œExactly Onceâ€ï¼ˆç²¾ç¡®ä¸€æ¬¡ï¼‰å’Œâ€œAt Least Onceâ€ï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰æ˜¯ä¸¤ç§æ ¸å¿ƒçš„æ¶ˆæ¯ä¼ é€’è¯­ä¹‰ï¼Œå®ƒä»¬åœ¨&lt;strong&gt;æ¶ˆè´¹ç«¯çš„è¡Œä¸ºã€å®ç°æœºåˆ¶åŠä¸šåŠ¡å½±å“&lt;/strong&gt;ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶ˆè´¹ç«¯çš„æ¶ˆæ¯å¤„ç†ä¿è¯"&gt;ğŸ”„ &lt;strong&gt;æ¶ˆè´¹ç«¯çš„æ¶ˆæ¯å¤„ç†ä¿è¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;At Least Onceï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¶ˆæ¯&lt;strong&gt;ç»ä¸ä¸¢å¤±&lt;/strong&gt;ï¼Œä½†&lt;strong&gt;å¯èƒ½é‡å¤æ¶ˆè´¹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹ç«¯è¡¨ç°ï¼š
&lt;ul&gt;
&lt;li&gt;æ¶ˆè´¹è€…å¯èƒ½å› ç½‘ç»œæ•…éšœã€Rebalance æˆ– ACK æäº¤å¤±è´¥ç­‰åŸå› ï¼Œå¤šæ¬¡æ”¶åˆ°åŒä¸€æ¡æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;1,2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯åæœªåŠæ—¶æäº¤åç§»é‡å°±å´©æºƒï¼Œé‡å¯åä¼šé‡æ–°æ‹‰å–å¹¶å¤„ç†è¯¥æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡å½±å“&lt;/strong&gt;ï¼šéœ€ä¸šåŠ¡é€»è¾‘&lt;strong&gt;è‡ªè¡Œå®ç°å¹‚ç­‰æ€§&lt;/strong&gt;ï¼ˆå¦‚å”¯ä¸€ç´¢å¼•ã€çŠ¶æ€æœºæ ¡éªŒï¼‰ï¼Œå¦åˆ™é‡å¤æ¶ˆæ¯ä¼šå¯¼è‡´æ•°æ®é”™è¯¯ï¼ˆå¦‚é‡å¤æ‰£æ¬¾ï¼‰&lt;a class="link" href="@ref" &gt;1,2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exactly Onceï¼ˆç²¾ç¡®ä¸€æ¬¡ï¼‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¶ˆæ¯&lt;strong&gt;æ—¢ä¸ä¸¢å¤±ä¹Ÿä¸é‡å¤&lt;/strong&gt;ï¼ˆç†æƒ³çŠ¶æ€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹ç«¯è¡¨ç°ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;strong&gt;äº‹åŠ¡æœºåˆ¶&lt;/strong&gt;å°†æ¶ˆæ¯å¤„ç†ä¸åç§»é‡æäº¤ç»‘å®šä¸ºåŸå­æ“ä½œï¼Œé¿å…é‡å¤æ¶ˆè´¹&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½†éœ€æ³¨æ„ï¼š&lt;strong&gt;æ•…éšœæ¢å¤æ—¶ä»å¯èƒ½é‡æ”¾æœªæäº¤äº‹åŠ¡çš„æ¶ˆæ¯&lt;/strong&gt;ï¼ˆå¦‚ Kafka äº‹åŠ¡è¶…æ—¶ï¼‰ï¼Œå®é™…ä»éœ€ä¸šåŠ¡å±‚å¹‚ç­‰å…œåº•&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡å½±å“&lt;/strong&gt;ï¼šç†è®ºä¸Šæ— éœ€ä¸šåŠ¡å¤„ç†é‡å¤ï¼Œä½†å› å®ç°å¤æ‚æ€§ï¼Œ&lt;strong&gt;å®è·µä¸­ä»éœ€å¹‚ç­‰è®¾è®¡ä½œä¸ºå®¹é”™&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®ç°æœºåˆ¶å·®å¼‚"&gt;âš™ï¸ &lt;strong&gt;å®ç°æœºåˆ¶å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;At Least Once&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Exactly Once&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åç§»é‡æäº¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤„ç†å®Œæˆåæ‰‹åŠ¨æäº¤åç§»é‡ï¼ˆ&lt;code&gt;enable.auto.commit=false&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;åç§»é‡æäº¤ä¸ä¸šåŠ¡å¤„ç†åœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼ˆåŸå­æ€§ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–æŠ€æœ¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…éœ€æ¶ˆè´¹è€…é…ç½®&lt;/td&gt;
&lt;td&gt;éœ€ç”Ÿäº§è€…å¹‚ç­‰ï¼ˆ&lt;code&gt;enable.idempotence=true&lt;/code&gt;ï¼‰+ äº‹åŠ¡ï¼ˆ&lt;code&gt;transactional.id&lt;/code&gt;ï¼‰+ æ¶ˆè´¹è€…éš”ç¦»ï¼ˆ&lt;code&gt;isolation.level=read_committed&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨ç³»ç»Ÿä¸€è‡´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— æ³•ä¿è¯ï¼ˆå¦‚æ›´æ–°æ•°æ®åº“+è°ƒç”¨å¤–éƒ¨APIï¼‰&lt;/td&gt;
&lt;td&gt;éœ€é…åˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¦‚ Kafka + Flink çš„ç«¯åˆ°ç«¯äº‹åŠ¡ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯ä¸é™åˆ¶"&gt;âš¡ï¸ &lt;strong&gt;é€‚ç”¨åœºæ™¯ä¸é™åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;At Least Once&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå®¹å¿é‡å¤ä½†ä¸å®¹ä¸¢å¤±çš„ä¸šåŠ¡ï¼ˆå¦‚æ—¥å¿—åˆ†æã€è®¢å•åˆ›å»ºï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šå®ç°ç®€å•ï¼Œæ€§èƒ½å¼€é”€ä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼šä¸šåŠ¡éœ€å¼ºå¹‚ç­‰ï¼ˆå¦‚å”¯ä¸€ç´¢å¼•é˜²æ’å…¥é‡å¤ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exactly Once&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¼ºä¸€è‡´æ€§è¦æ±‚çš„ä¸šåŠ¡ï¼ˆå¦‚é‡‘èäº¤æ˜“ã€åº“å­˜æ‰£å‡ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šç†è®ºä¸Šæ¶ˆé™¤é‡å¤ï¼Œç®€åŒ–ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;æ€§èƒ½å¼€é”€å¤§ï¼ˆäº‹åŠ¡åè°ƒã€Barrier å¯¹é½ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ä»…æ”¯æŒéƒ¨åˆ†æ•°æ®æºï¼ˆå¦‚ Kafka å†…éƒ¨æµè®¡ç®—ï¼Œè·¨æ•°æ®åº“/RPC éœ€é¢å¤–äº‹åŠ¡è¡¥å¿ï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®ç»“è®º"&gt;ğŸ’ &lt;strong&gt;å…³é”®ç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;At Least Once + å¹‚ç­‰æ¶ˆè´¹ = Exactly Once&lt;/strong&gt;
ä¸šåŠ¡å±‚çš„å¹‚ç­‰è®¾è®¡ï¼ˆå¦‚å”¯ä¸€é”®çº¦æŸï¼‰æ˜¯ä¸¤ç§è¯­ä¹‰çš„&lt;strong&gt;é€šç”¨å…œåº•æ–¹æ¡ˆ&lt;/strong&gt;ï¼Œå³ä½¿å£°ç§°æ”¯æŒ Exactly Once çš„ç³»ç»Ÿï¼ˆå¦‚ Kafkaï¼‰ä¹Ÿæ— æ³• 100% æ¶ˆé™¤æ¶ˆè´¹ç«¯é‡å¤é£é™©&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Exactly Once çš„å±€é™æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Kafka çš„ Exactly Once &lt;strong&gt;ä»…è¦†ç›–ç”Ÿäº§åˆ°æ¶ˆè´¹çš„åç§»é‡åŸå­æ€§&lt;/strong&gt;ï¼Œè‹¥æ¶ˆè´¹åéœ€æ›´æ–°å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ MySQL + Redisï¼‰ï¼Œä»éœ€åˆ†å¸ƒå¼äº‹åŠ¡&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;Flink ç­‰æµè®¡ç®—æ¡†æ¶çš„â€œç«¯åˆ°ç«¯ Exactly Onceâ€ä¾èµ– &lt;strong&gt;CheckPoint å¿«ç…§&lt;/strong&gt;ï¼Œæ•…éšœæ¢å¤æ—¶å¯èƒ½é‡æ”¾æ•°æ®ï¼ˆæœ¬è´¨ä»æ˜¯ At Least Once + çŠ¶æ€æ¢å¤ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®è·µå»ºè®®"&gt;ğŸ› ï¸ &lt;strong&gt;å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© At Least Once + ä¸šåŠ¡å¹‚ç­‰&lt;/strong&gt;ï¼šåœ¨ 90% çš„åœºæ™¯ä¸‹æ›´é«˜æ•ˆä¸”å¯é &lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨ Exactly Once&lt;/strong&gt;ï¼šä»…åœ¨æµè®¡ç®—ï¼ˆKafka â†’ Flink â†’ Kafkaï¼‰æˆ–çº¯ Kafka å†…éƒ¨é“¾è·¯ä¸­ä½¿ç”¨ï¼Œé¿å…è·¨ç³»ç»Ÿäº‹åŠ¡å¤æ‚æ€§&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¹‚ç­‰è®¾è®¡å¿…å¤‡ï¼šæ— è®ºé€‰æ‹©å“ªç§è¯­ä¹‰ï¼Œæ¶ˆè´¹ç«¯å¿…é¡»é€šè¿‡ä»¥ä¸‹ä»»ä¸€æ–¹å¼å®ç°å¹‚ç­‰ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å”¯ä¸€ç´¢å¼•&lt;/strong&gt;ï¼šæ•°æ®åº“å¯¹ä¸šåŠ¡ä¸»é”®å»ºå”¯ä¸€çº¦æŸ&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»é‡è¡¨&lt;/strong&gt;ï¼šç‹¬ç«‹çš„æ¶ˆæ¯æ¶ˆè´¹è®°å½•è¡¨ + å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚è®¢å•å·ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€æœº&lt;/strong&gt;ï¼šä¸šåŠ¡çŠ¶æ€æ ¡éªŒï¼ˆå¦‚è®¢å•çŠ¶æ€ä¸å¯é€†ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸€å¥è¯æ€»ç»“ï¼š&lt;strong&gt;At Least Once å¿…ç„¶éœ€å¹‚ç­‰ï¼ŒExactly Once ç†è®ºä¸Šæ— éœ€ä½†å®è·µä¸­ä»éœ€å¹‚ç­‰å…œåº•&lt;/strong&gt;ã€‚ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«åœ¨äºæ˜¯å¦ç”±ç³»ç»Ÿå±‚å‡å°‘é‡å¤ï¼Œä½†æ¶ˆè´¹ç«¯çš„ä¸šåŠ¡å®‰å…¨å§‹ç»ˆä¾èµ–å¼€å‘è€…çš„å¹‚ç­‰è®¾è®¡&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="rediså¹‚ç­‰æ¶ˆè´¹"&gt;Rediså¹‚ç­‰æ¶ˆè´¹
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œå®¢æˆ·ç«¯å¹‚ç­‰æ¶ˆè´¹å®Œå…¨å¯ä»¥å€ŸåŠ© Redis å®ç°ã€‚Redis ä»¥å…¶&lt;strong&gt;åŸå­æ€§æ“ä½œ&lt;/strong&gt;å’Œ&lt;strong&gt;é«˜æ€§èƒ½&lt;/strong&gt;ç‰¹æ€§ï¼Œæˆä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å¹‚ç­‰æ€§çš„ä¸»æµæ–¹æ¡ˆä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°åŸç†å’Œæ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-redis-å®ç°å¹‚ç­‰çš„æ ¸å¿ƒåŸç†"&gt;ğŸ”‘ Redis å®ç°å¹‚ç­‰çš„æ ¸å¿ƒåŸç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆRequest IDï¼‰&lt;/strong&gt;
ä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆå…¨å±€å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ UUIDã€ä¸šåŠ¡ä¸»é”®ï¼‰ï¼Œä½œä¸º Redis çš„ Keyï¼Œç”¨äºæ ‡è®°æ¶ˆæ¯æ˜¯å¦å·²å¤„ç†&lt;a class="link" href="@ref" &gt;1,3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŸå­æ€§æ“ä½œ
é€šè¿‡ Redis çš„&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; SETNX
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼ˆSet If Not Existsï¼‰å‘½ä»¤å®ç°åŸå­æ€§æ£€æŸ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ Key ä¸å­˜åœ¨ â†’ è®¾ç½®æˆåŠŸï¼ˆè¿”å› 1ï¼‰â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ Key å·²å­˜åœ¨ â†’ è®¾ç½®å¤±è´¥ï¼ˆè¿”å› 0ï¼‰â†’ è·³è¿‡å¤„ç†&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸‰ç§å…¸å‹å®ç°æ–¹æ¡ˆ"&gt;âš™ï¸ ä¸‰ç§å…¸å‹å®ç°æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="-æ–¹æ¡ˆä¸€å‰ç½®æ£€æŸ¥setnx--è¿‡æœŸæ—¶é—´"&gt;âœ… &lt;strong&gt;æ–¹æ¡ˆä¸€ï¼šå‰ç½®æ£€æŸ¥ï¼ˆSETNX + è¿‡æœŸæ—¶é—´ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;import redis
import uuid
def process_message(message):
redis_client = redis.Redis(host=&amp;#39;localhost&amp;#39;, port=6379, db=0)
msg_id = message.get(&amp;#39;unique_id&amp;#39;) or str(uuid.uuid4()) # è·å–æˆ–ç”Ÿæˆå”¯ä¸€ID
key = f&amp;#34;msg:{msg_id}&amp;#34;
# åŸå­æ€§æ£€æŸ¥
if redis_client.setnx(key, 1): # Keyä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸ
redis_client.expire(key, 3600) # è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆé˜²å†…å­˜æ³„æ¼ï¼‰
# æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ›´æ–°æ•°æ®åº“ï¼‰
execute_business(message)
return &amp;#34;å¤„ç†æˆåŠŸ&amp;#34;
else:
return &amp;#34;æ¶ˆæ¯å·²å¤„ç†ï¼Œè·³è¿‡&amp;#34; # Keyå­˜åœ¨ï¼Œå¹‚ç­‰æ‹¦æˆª[3,5,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜å¹¶å‘ç®€å•ä¸šåŠ¡ï¼ˆå¦‚è®¢å•çŠ¶æ€æ›´æ–°ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="-æ–¹æ¡ˆäºŒäº‹åæ ‡è®°ä¸šåŠ¡æ‰§è¡Œåå­˜å‚¨"&gt;âœ… &lt;strong&gt;æ–¹æ¡ˆäºŒï¼šäº‹åæ ‡è®°ï¼ˆä¸šåŠ¡æ‰§è¡Œåå­˜å‚¨ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;// ä¼ªä»£ç ç¤ºä¾‹
public void consume(Message msg) {
String msgId = msg.getId();
if (!redis.exists(msgId)) { // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
Result result = businessService.process(msg); // æ‰§è¡Œä¸šåŠ¡
redis.setex(msgId, 3600, &amp;#34;processed&amp;#34;); // ä¸šåŠ¡æˆåŠŸåæ ‡è®°
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé¿å…å‰ç½®æ£€æŸ¥åä¸šåŠ¡å´©æºƒå¯¼è‡´çŠ¶æ€ä¸¢å¤±&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="-æ–¹æ¡ˆä¸‰ç»“åˆæ•°æ®åº“äº‹åŠ¡å¼ºä¸€è‡´æ€§"&gt;âœ… &lt;strong&gt;æ–¹æ¡ˆä¸‰ï¼šç»“åˆæ•°æ®åº“äº‹åŠ¡ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;ä¸šåŠ¡å¤„ç†ä¸ Redis æ ‡è®°åœ¨åŒä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­å®Œæˆï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;BEGIN;
INSERT INTO orders (...) VALUES (...); -- ä¸šåŠ¡æ•°æ®å…¥åº“
INSERT INTO redis_sync (msg_id) VALUES (&amp;#39;12345&amp;#39;); -- æ¨¡æ‹ŸRedisæ ‡è®°å†™å…¥
COMMIT;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥åŒæ­¥ &lt;code&gt;redis_sync&lt;/code&gt; è¡¨æ•°æ®åˆ° Redisï¼ˆé€šè¿‡ Binlog ç›‘å¬ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;â€‹ï¼šé‡‘èçº§ä¸€è‡´æ€§è¦æ±‚ï¼ˆå¦‚è´¦æˆ·æ‰£æ¬¾ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹"&gt;âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å”¯ä¸€æ ‡è¯†ç”Ÿæˆè§„åˆ™&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¸šåŠ¡ä¸»é”®ï¼ˆå¦‚è®¢å•å·ï¼‰ä¼˜äº UUIDï¼Œé¿å… Redis Key è†¨èƒ€&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;è¿‡æœŸæ—¶é—´è®¾ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¿…é¡»è®¾ç½® &lt;code&gt;EXPIRE&lt;/code&gt;ï¼ˆå¦‚ 24 å°æ—¶ï¼‰ï¼Œé¿å…æ— æ•ˆ Key å †ç§¯å¯¼è‡´å†…å­˜æº¢å‡º&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;Redis é«˜å¯ç”¨ä¿éšœ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é›†ç¾¤æ¨¡å¼ï¼ˆRedis Clusterï¼‰æˆ–å“¨å…µï¼ˆSentinelï¼‰é˜²æ­¢å•ç‚¹æ•…éšœ&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;æç«¯åœºæ™¯å…œåº•&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Redis å®•æœºæ—¶é™çº§ä¸ºæ•°æ®åº“å”¯ä¸€ç´¢å¼•æˆ–æ—¥å¿—è¿½è¸ª&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆé€‰å‹å»ºè®®"&gt;ğŸ’ æ–¹æ¡ˆé€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜é¢‘æ¶ˆæ¯ï¼ˆå¦‚ç‚¹å‡»äº‹ä»¶ï¼‰&lt;/td&gt;
&lt;td&gt;å‰ç½®æ£€æŸ¥ï¼ˆSETNXï¼‰&lt;/td&gt;
&lt;td&gt;æ€§èƒ½æœ€é«˜ï¼ŒRedis å•èŠ‚ç‚¹ QPS å¯è¾¾ 10W+ &lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼ˆå«å¤–éƒ¨è°ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;äº‹åæ ‡è®°&lt;/td&gt;
&lt;td&gt;é¿å…ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ä½† Redis å·²æ ‡è®°å¯¼è‡´çš„é€»è¾‘ä¸­æ–­&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èµ„é‡‘äº¤æ˜“ã€åº“å­˜æ‰£å‡&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“äº‹åŠ¡+RedisåŒæ­¥&lt;/td&gt;
&lt;td&gt;ä¿è¯ä¸šåŠ¡ä¸æ ‡è®°çš„ç»å¯¹ä¸€è‡´æ€§ï¼Œå®¹å¿è¾ƒä½å¹¶å‘&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ‹“å±•åº”ç”¨åœºæ™¯"&gt;ğŸ”§ æ‹“å±•åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼é”é˜²å¹¶å‘&lt;/strong&gt;ï¼š&lt;code&gt;SETNX&lt;/code&gt; å®ç°é”ï¼Œé¿å…å¤šèŠ‚ç‚¹åŒæ—¶å¤„ç†åŒä¸€æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯é‡è¯•é˜Ÿåˆ—&lt;/strong&gt;ï¼šå¤„ç†å¤±è´¥çš„æ¶ˆæ¯ ID å­˜å…¥ Redis Sorted Setï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰ï¼Œå®šæ—¶é‡è¯•&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šRedis å‡­å€Ÿå…¶&lt;strong&gt;åŸå­æ€§&lt;/strong&gt;å’Œ&lt;strong&gt;é«˜æ€§èƒ½&lt;/strong&gt;ï¼Œæ˜¯å®¢æˆ·ç«¯å®ç°å¹‚ç­‰æ¶ˆè´¹çš„é«˜æ•ˆæ–¹æ¡ˆã€‚é€‰æ‹©å…·ä½“å®ç°æ—¶éœ€æƒè¡¡&lt;strong&gt;ä¸šåŠ¡ä¸€è‡´æ€§è¦æ±‚&lt;/strong&gt;ä¸&lt;strong&gt;ç³»ç»Ÿå¤æ‚åº¦&lt;/strong&gt;ï¼Œå¹¶å§‹ç»ˆé€šè¿‡&lt;strong&gt;å”¯ä¸€æ ‡è¯†+è¿‡æœŸæ—¶é—´&lt;/strong&gt;ä¸¤å¤§æ ¸å¿ƒæœºåˆ¶è§„é¿é£é™©&lt;a class="link" href="@ref" &gt;1,3,5,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="æ‰¹é‡æ¶ˆè´¹"&gt;æ‰¹é‡æ¶ˆè´¹
&lt;/h2&gt;&lt;p&gt;åœ¨ Kafka æ‰¹é‡æ¶ˆè´¹åœºæ™¯ä¸­ï¼Œä¸ºé¿å…é‡å¤æ¶ˆè´¹ï¼Œ&lt;strong&gt;éœ€è¦å¯¹ &lt;code&gt;List&amp;lt;ConsumerRecord&amp;gt;&lt;/code&gt; ä¸­çš„æ¯æ¡æ¶ˆæ¯ç‹¬ç«‹ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼ˆå¦‚å“ˆå¸Œå€¼ï¼‰å¹¶å­˜å‚¨è‡³ Redis&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æã€ä¼˜åŒ–ç­–ç•¥åŠæ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-å¿…è¦æ€§åˆ†æä¸ºä»€ä¹ˆéœ€è¦é€æ¡å¤„ç†"&gt;ğŸ” &lt;strong&gt;å¿…è¦æ€§åˆ†æï¼šä¸ºä»€ä¹ˆéœ€è¦é€æ¡å¤„ç†ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ¶ˆè´¹çš„é‡å¤é£é™©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æ‰¹é‡å¤„ç†ä¸­é€”å¤±è´¥ï¼ˆå¦‚éƒ¨åˆ†æ¶ˆæ¯å¤„ç†æˆåŠŸä½†æœªæäº¤ä½ç§»ï¼‰ï¼Œé‡å¯åä¼šé‡æ–°æ‹‰å–åŒä¸€æ‰¹æ¶ˆæ¯ï¼Œå¯¼è‡´éƒ¨åˆ†æ¶ˆæ¯é‡å¤æ¶ˆè´¹&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»…ä¾èµ–æ‰¹æ¬¡çº§å»é‡ï¼ˆå¦‚è®°å½•æ•´ä¸ªæ‰¹æ¬¡çš„èµ·å§‹ä½ç§»ï¼‰æ— æ³•è¯†åˆ«æ‰¹æ¬¡å†…å•æ¡æ¶ˆæ¯æ˜¯å¦å·²å¤„ç†&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€æ¡å»é‡çš„æ ¸å¿ƒä»·å€¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¡æ¶ˆæ¯ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ &lt;code&gt;æ¶ˆæ¯ID&lt;/code&gt;ã€&lt;code&gt;ä¸šåŠ¡ä¸»é”®å“ˆå¸Œ&lt;/code&gt; æˆ– &lt;code&gt;åˆ†åŒº+ä½ç§»&lt;/code&gt;ï¼‰ï¼Œå¯åœ¨ Redis ä¸­ç²¾ç¡®åˆ¤æ–­å•æ¡æ¶ˆæ¯æ˜¯å¦å·²å¤„ç†ï¼Œé¿å…å› æ‰¹æ¬¡å¤±è´¥å¯¼è‡´çš„é‡å¤&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…·ä½“å®ç°æ–¹æ¡ˆ"&gt;âš™ï¸ &lt;strong&gt;å…·ä½“å®ç°æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€æ¡ç”Ÿæˆæ ‡è¯†--redis-åˆ¤é‡"&gt;&lt;strong&gt;é€æ¡ç”Ÿæˆæ ‡è¯† + Redis åˆ¤é‡&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@KafkaListener(topics = &amp;#34;test-topic&amp;#34;, containerFactory = &amp;#34;batchFactory&amp;#34;)
public void batchConsume(List&amp;lt;ConsumerRecord&amp;lt;String, String&amp;gt;&amp;gt; records) {
for (ConsumerRecord&amp;lt;String, String&amp;gt; record : records) {
String messageId = generateUniqueId(record); // ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼ˆå¦‚MD5(ä¸šåŠ¡é”®+åˆ†åŒº+ä½ç§»)ï¼‰
if (redisClient.setnx(messageId, &amp;#34;1&amp;#34;, 24, TimeUnit.HOURS)) { // åŸå­æ€§å†™å…¥
processMessage(record); // å¤„ç†æ¶ˆæ¯
} else {
log.warn(&amp;#34;Duplicate message: {}&amp;#34;, messageId);
}
}
// æ‰¹é‡æäº¤ä½ç§»ï¼ˆéœ€ç»“åˆæ‰‹åŠ¨æäº¤ç­–ç•¥ï¼‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å”¯ä¸€æ ‡è¯†ç”Ÿæˆè§„åˆ™ï¼š
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨ä¸šåŠ¡ä¸»é”®ï¼ˆå¦‚è®¢å•å·ï¼‰çš„å“ˆå¸Œå€¼ï¼Œé¿å…ä¾èµ– Kafka å†…éƒ¨ä½ç§»ï¼ˆå†å¹³è¡¡æ—¶å¯èƒ½å˜åŒ–ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ— ä¸šåŠ¡ä¸»é”®æ—¶ï¼Œç”¨å¤åˆé”® &lt;code&gt;topic+partition+offset&lt;/code&gt; ä½œä¸ºå…œåº•&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Redis æ“ä½œä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;SETNX&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;SET key value NX EX&lt;/code&gt;ï¼‰ä¿è¯åŸå­æ€§å†™å…¥å’Œè¿‡æœŸæ—¶é—´&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ‰¹é‡æ‰§è¡Œ &lt;code&gt;SETNX&lt;/code&gt; å‡å°‘ç½‘ç»œå¼€é”€ï¼ˆå¦‚ Redis Pipelineï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜åŒ–å†…å­˜å»é‡--æ‰¹é‡æ›´æ–°-redis"&gt;&lt;strong&gt;ä¼˜åŒ–ï¼šå†…å­˜å»é‡ + æ‰¹é‡æ›´æ–° Redis&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;Set&amp;lt;String&amp;gt; localDedupCache = new HashSet&amp;lt;&amp;gt;(); // æœ¬åœ°ç¼“å­˜å½“å‰æ‰¹æ¬¡å»é‡æ ‡è¯†
List&amp;lt;String&amp;gt; newMessageIds = new ArrayList&amp;lt;&amp;gt;();
for (ConsumerRecord record : records) {
String messageId = generateUniqueId(record);
if (!localDedupCache.contains(messageId) &amp;amp;&amp;amp; !redisClient.exists(messageId)) {
localDedupCache.add(messageId);
newMessageIds.add(messageId);
processMessage(record);
}
}
// æ‰¹é‡å†™å…¥ Redisï¼ˆå‡å°‘IOï¼‰
redisClient.pipeline(pipe -&amp;gt; {
newMessageIds.forEach(id -&amp;gt; pipe.setex(id, 86400, &amp;#34;1&amp;#34;));
});
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜é¢‘æ¶ˆè´¹ï¼ˆå¦‚æ—¥å¿—å¤„ç†ï¼‰ï¼Œé€šè¿‡æœ¬åœ°ç¼“å­˜å‡å°‘ Redis æŸ¥è¯¢å‹åŠ›&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸æ½œåœ¨é—®é¢˜"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹ä¸æ½œåœ¨é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Redis å­˜å‚¨æˆæœ¬&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´ï¼ˆå¦‚ 24~72 å°æ—¶ï¼‰ï¼Œé¿å…é•¿æœŸå †ç§¯å¯¼è‡´å†…å­˜æº¢å‡º&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Redis é›†ç¾¤&lt;/strong&gt;åˆ†æ‹…å­˜å‚¨å‹åŠ›ï¼Œæˆ–é‡‡ç”¨ &lt;strong&gt;Bloom Filter&lt;/strong&gt; å‹ç¼©å­˜å‚¨ç©ºé—´ï¼ˆéœ€å®¹å¿æä½è¯¯åˆ¤ç‡ï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æç«¯åœºæ™¯å…œåº•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šRedis å®•æœºæ—¶å»é‡å¤±æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆï¼š
&lt;ul&gt;
&lt;li&gt;é™çº§è‡³æ•°æ®åº“å”¯ä¸€çº¦æŸï¼ˆå¦‚ &lt;code&gt;ON CONFLICT IGNORE&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡é€»è¾‘å±‚å®ç°å¹‚ç­‰æ€§ï¼ˆå¦‚çŠ¶æ€æœºã€ç‰ˆæœ¬å·æ§åˆ¶ï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é«˜é¢‘è°ƒç”¨ Redis å¯èƒ½æˆä¸ºååé‡ç“¶é¢ˆã€‚ä¼˜åŒ–æ–¹æ¡ˆï¼š
&lt;ul&gt;
&lt;li&gt;å¢åŠ æœ¬åœ°ç¼“å­˜ï¼ˆå¦‚ Guava Cacheï¼‰ï¼Œå®šæœŸåŒæ­¥è‡³ Redis&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;Redis é›†ç¾¤åˆ†ç‰‡&lt;/strong&gt;æˆ– &lt;strong&gt;Redis Moduleï¼ˆå¦‚ RedisBloomï¼‰&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ›¿ä»£æ–¹æ¡ˆæ— éœ€é€æ¡å»é‡"&gt;ğŸ”„ &lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆï¼ˆæ— éœ€é€æ¡å»é‡ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“å¹‚ç­‰çº¦æŸ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä¸šåŠ¡è¡¨ä¸­æ·»åŠ å”¯ä¸€ç´¢å¼•ï¼ˆå¦‚è®¢å•å·ï¼‰ï¼Œç›´æ¥ä¾èµ–æ•°æ®åº“æ‹’ç»é‡å¤æ’å…¥&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šæ— éœ€ç»´æŠ¤å¤–éƒ¨å­˜å‚¨ï¼Œé€‚åˆå¼ºäº‹åŠ¡åœºæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™&lt;/strong&gt;ï¼šä»…é€‚ç”¨äºæ’å…¥ç±»æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka äº‹åŠ¡æ¶ˆæ¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç”¨ &lt;code&gt;enable.idempotence=true&lt;/code&gt; + &lt;code&gt;isolation.level=read_committed&lt;/code&gt;ï¼Œé…åˆäº‹åŠ¡ç”Ÿäº§è€…ç¡®ä¿ç«¯åˆ°ç«¯ç²¾ç¡®ä¸€æ¬¡&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Transactional
public void processBatch(List&amp;lt;Message&amp;gt; messages) {
messages.forEach(msg -&amp;gt; jpaRepository.save(msg)); // æ•°æ®åº“æ“ä½œ
// æäº¤ä½ç§»ï¼ˆé€šè¿‡äº‹åŠ¡ç®¡ç†å™¨åŒæ­¥ï¼‰
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆé€‰å‹å»ºè®®-1"&gt;ğŸ’ &lt;strong&gt;æ–¹æ¡ˆé€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜é¢‘æ¶ˆè´¹ + ä½é‡å¤å®¹å¿&lt;/td&gt;
&lt;td&gt;é€æ¡ Redis å»é‡ + Pipeline æ‰¹é‡å†™å…¥&lt;/td&gt;
&lt;td&gt;ç²¾å‡†æ§åˆ¶å•æ¡æ¶ˆæ¯ï¼Œååé‡é«˜ &lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¼ºäº‹åŠ¡åœºæ™¯ï¼ˆå¦‚æ”¯ä»˜ï¼‰&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å”¯ä¸€çº¦æŸ + å¹‚ç­‰è®¾è®¡&lt;/td&gt;
&lt;td&gt;é¿å…å¤–éƒ¨ä¾èµ–ï¼Œä¿è¯ ACID &lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¨é“¾è·¯ç²¾ç¡®ä¸€æ¬¡ï¼ˆé‡‘èçº§ï¼‰&lt;/td&gt;
&lt;td&gt;Kafka äº‹åŠ¡æ¶ˆæ¯&lt;/td&gt;
&lt;td&gt;åŸç”Ÿæ”¯æŒç«¯åˆ°ç«¯ä¸€è‡´æ€§ &lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æµ·é‡æ•°æ® + å®¹å¿å¾®é‡é‡å¤&lt;/td&gt;
&lt;td&gt;Bloom Filter + æœ¬åœ°ç¼“å­˜&lt;/td&gt;
&lt;td&gt;å†…å­˜å ç”¨ä½ï¼Œååé‡æé«˜ï¼ˆéœ€è¯„ä¼°è¯¯åˆ¤ç‡ï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»ˆæåŸåˆ™&lt;/strong&gt;ï¼š
â€‹&lt;strong&gt;ä¸šåŠ¡å¹‚ç­‰æ€§ &amp;gt; å¤–éƒ¨å»é‡ &amp;gt; ä¾èµ–æ¶ˆæ¯é˜Ÿåˆ—è¯­ä¹‰&lt;/strong&gt;ã€‚æ— è®ºé‡‡ç”¨ä½•ç§æ–¹æ¡ˆï¼Œä¸šåŠ¡é€»è¾‘çš„å¹‚ç­‰è®¾è®¡ï¼ˆå¦‚çŠ¶æ€æœºã€ç‰ˆæœ¬å·ï¼‰æ˜¯ä¸å¯æˆ–ç¼ºçš„å…œåº•æ‰‹æ®µ&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å¹‚ç­‰æ€§æ–¹æ¡ˆ"&gt;å¹‚ç­‰æ€§æ–¹æ¡ˆ
&lt;/h2&gt;&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼ˆå¤šæ¬¡æ“ä½œä¸ä¸€æ¬¡æ“ä½œç»“æœä¸€è‡´ï¼‰æ˜¯ä¿éšœæ•°æ®ä¸€è‡´æ€§å’Œç³»ç»Ÿå¯é æ€§çš„æ ¸å¿ƒèƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯ä¸»æµçš„å®ç°æ–¹æ¡ˆåŠå…¶é€‚ç”¨åœºæ™¯ã€åŸç†å’Œæ³¨æ„äº‹é¡¹ï¼Œç»¼åˆè‡ªå¤šç¯‡æŠ€æœ¯æ–‡çŒ®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ•°æ®åº“å±‚æ–¹æ¡ˆ"&gt;ğŸ”‘ &lt;strong&gt;æ•°æ®åº“å±‚æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å”¯ä¸€çº¦æŸï¼ˆå”¯ä¸€ç´¢å¼•/ä¸»é”®ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šä¸ºä¸šåŠ¡å”¯ä¸€å­—æ®µï¼ˆå¦‚è®¢å•å·ï¼‰åˆ›å»ºæ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼Œé‡å¤æ’å…¥æ—¶è§¦å‘å”¯ä¸€é”®å†²çªå¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;DuplicateKeyException&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ•°æ®æ’å…¥æ“ä½œï¼ˆå¦‚åˆ›å»ºè®¢å•ã€æ”¯ä»˜è®°å½•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šæ•°æ®åº“å±‚é¢å¼ºä¸€è‡´æ€§ï¼Œå¯é æ€§é«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€æ•è·å¼‚å¸¸å¹¶è¿”å›ç›¸åŒç»“æœ&lt;a class="link" href="@ref" &gt;1,6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šæ•°æ®è¡¨å¢åŠ  &lt;code&gt;version&lt;/code&gt; å­—æ®µï¼Œæ›´æ–°æ—¶æ ¡éªŒç‰ˆæœ¬å·æ˜¯å¦åŒ¹é…ï¼ˆ&lt;code&gt;UPDATE ... SET version=version+1 WHERE version=old_version&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜é¢‘æ›´æ–°æ“ä½œï¼ˆå¦‚åº“å­˜æ‰£å‡ã€ä½™é¢å˜æ›´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šæ— é”ç«äº‰ï¼Œæ€§èƒ½ä¼˜äºæ‚²è§‚é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¹¶å‘å†²çªæ—¶éœ€é‡è¯•æˆ–è¿”å›å¤±è´¥&lt;a class="link" href="@ref" &gt;2,6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‚²è§‚é”ï¼ˆ&lt;code&gt;SELECT ... FOR UPDATE&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šé€šè¿‡æ•°æ®åº“è¡Œé”é˜»å¡å¹¶å‘æ“ä½œï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»ä»…ä¸€ä¸ªè¯·æ±‚å¯ä¿®æ”¹æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¼ºä¸€è‡´æ€§è¦æ±‚çš„ä½é¢‘æ›´æ–°ï¼ˆå¦‚è´¦æˆ·å¤§é¢è½¬è´¦ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šé”ç«äº‰å¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œéœ€è°¨æ…è®¾ç½®è¶…æ—¶æ—¶é—´&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸­é—´ä»¶å±‚æ–¹æ¡ˆ"&gt;âš¡ &lt;strong&gt;ä¸­é—´ä»¶å±‚æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼é”ï¼ˆRedis/ZooKeeperï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåˆ©ç”¨ &lt;code&gt;SETNX&lt;/code&gt; æˆ– Redisson ç­‰å·¥å…·å®ç°è·¨èŠ‚ç‚¹äº’æ–¥é”ï¼Œç¡®ä¿åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ“ä½œå”¯ä¸€æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè·¨æœåŠ¡è°ƒç”¨ã€åˆ†å¸ƒå¼äº‹åŠ¡è¡¥å¿é˜¶æ®µï¼ˆå¦‚ TCC çš„ Confirm æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šçµæ´»æ§åˆ¶é”ç²’åº¦ï¼Œæ”¯æŒè¶…æ—¶é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€å¤„ç†é”å¤±æ•ˆã€æ­»é”é—®é¢˜&lt;a class="link" href="@ref" &gt;1,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²é‡è¡¨ï¼ˆå¹‚ç­‰è¡¨ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šç‹¬ç«‹å­˜å‚¨è¯·æ±‚å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚æ¶ˆæ¯ IDï¼‰ï¼Œä¸šåŠ¡æ“ä½œå‰æ’å…¥é˜²é‡è®°å½•ï¼ˆå”¯ä¸€ç´¢å¼•é˜²é‡å¤ï¼‰ï¼Œå¤„ç†æˆåŠŸåæ›´æ–°çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹ï¼ˆå¦‚ Kafka é‡å¤æ¶ˆæ¯ï¼‰ã€å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šä¸ä¸šåŠ¡è§£è€¦ï¼Œæ”¯æŒå†å²æ•°æ®æ¸…ç†&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸šåŠ¡é€»è¾‘å±‚æ–¹æ¡ˆ"&gt;ğŸ“Š &lt;strong&gt;ä¸šåŠ¡é€»è¾‘å±‚æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€æœºï¼ˆState Machineï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šé€šè¿‡ä¸šåŠ¡çŠ¶æ€æµè½¬è§„åˆ™ï¼ˆå¦‚è®¢å•çŠ¶æ€ï¼šå¾…æ”¯ä»˜â†’å·²æ”¯ä»˜ï¼‰é™åˆ¶æ“ä½œæ‰§è¡Œæ¡ä»¶ï¼ˆ&lt;code&gt;UPDATE ... WHERE status='å¾…æ”¯ä»˜'&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæœ‰æ˜ç¡®çŠ¶æ€è½¬æ¢çš„ä¸šåŠ¡ï¼ˆå¦‚è®¢å•ã€å·¥å•æµç¨‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šæ— éœ€é¢å¤–å­˜å‚¨ï¼Œé€»è¾‘è‡ªç„¶å¹‚ç­‰&lt;a class="link" href="@ref" &gt;3,6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚å”¯ä¸€æ ‡è¯†ï¼ˆRequest IDï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼ˆå¦‚ UUIDã€Snowflake IDï¼‰ï¼Œåœ¨ç¼“å­˜ï¼ˆRedisï¼‰æˆ–æ•°æ®åº“ä¸­è®°å½•å¤„ç†çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;æµç¨‹ï¼š
&lt;ul&gt;
&lt;li&gt;è¯·æ±‚åˆ°è¾¾æ—¶æ£€æŸ¥ ID æ˜¯å¦å·²å­˜åœ¨ â†’ å­˜åœ¨åˆ™è¿”å›å†å²ç»“æœï¼›&lt;/li&gt;
&lt;li&gt;ä¸å­˜åœ¨åˆ™æ‰§è¡Œä¸šåŠ¡ï¼ŒæˆåŠŸåå­˜å‚¨ ID åŠç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ¥å£é‡è¯•ã€RPC è°ƒç”¨&lt;a class="link" href="@ref" &gt;5,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Token æœºåˆ¶ï¼ˆä¸€æ¬¡æ€§ä»¤ç‰Œï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯é¢„è·å– Tokenï¼ˆæœåŠ¡ç«¯ç”Ÿæˆå¹¶å­˜å‚¨ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡è¯·æ±‚æºå¸¦ Tokenï¼ŒæœåŠ¡ç«¯æ ¡éªŒååˆ é™¤ Tokenï¼Œä»…å…è®¸ä¸€æ¬¡æœ‰æ•ˆæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå‰ç«¯è¡¨å•é˜²é‡æäº¤ï¼ˆå¦‚æ”¯ä»˜é¡µé¢ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;âš–ï¸ &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;é€‚ç”¨æ“ä½œ&lt;/th&gt;
&lt;th&gt;å…¸å‹åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ€§èƒ½å½±å“&lt;/th&gt;
&lt;th&gt;å®ç°å¤æ‚åº¦&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å”¯ä¸€çº¦æŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ’å…¥&lt;/td&gt;
&lt;td&gt;è®¢å•åˆ›å»ºã€æ”¯ä»˜è®°å½•&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¹è§‚é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´æ–°&lt;/td&gt;
&lt;td&gt;åº“å­˜æ‰£å‡ã€ä½™é¢å˜æ›´&lt;/td&gt;
&lt;td&gt;â­â­â­&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»»æ„&lt;/td&gt;
&lt;td&gt;è·¨æœåŠ¡è°ƒç”¨ã€åˆ†å¸ƒå¼äº‹åŠ¡&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;â­â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çŠ¶æ€æœº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´æ–°&lt;/td&gt;
&lt;td&gt;è®¢å•çŠ¶æ€æµè½¬ã€å®¡æ‰¹æµç¨‹&lt;/td&gt;
&lt;td&gt;â­â­â­&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¯·æ±‚å”¯ä¸€æ ‡è¯†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»»æ„&lt;/td&gt;
&lt;td&gt;RPC é‡è¯•ã€æ¶ˆæ¯æ¶ˆè´¹&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‰å‹å†³ç­–æ ‘&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æ’å…¥åœºæ™¯&lt;/strong&gt; â†’ å”¯ä¸€çº¦æŸï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æ›´æ–°åœºæ™¯&lt;/strong&gt; â†’ ä¹è§‚é”ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨èŠ‚ç‚¹å¹¶å‘æ§åˆ¶&lt;/strong&gt; â†’ åˆ†å¸ƒå¼é”ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚çŠ¶æ€æµè½¬&lt;/strong&gt; â†’ çŠ¶æ€æœºï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‰ç«¯é˜²é‡æˆ–æ¥å£é‡è¯•&lt;/strong&gt; â†’ Token æˆ–è¯·æ±‚ IDã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¹‚ç­‰ä¸é˜²é‡çš„åŒºåˆ«ï¼š
&lt;ul&gt;
&lt;li&gt;å¹‚ç­‰æ€§å…³æ³¨æ“ä½œç»“æœä¸€è‡´æ€§ï¼ˆå¦‚å¤šæ¬¡æ”¯ä»˜ä¸é‡å¤æ‰£æ¬¾ï¼‰ï¼Œé˜²é‡å…³æ³¨æ•°æ®å”¯ä¸€æ€§ï¼ˆå¦‚è®¢å•å·ä¸é‡å¤ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡è¾¹ç•Œï¼š
&lt;ul&gt;
&lt;li&gt;é˜²é‡è¡¨æ’å…¥éœ€ä¸ä¸šåŠ¡æ“ä½œåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œå¦åˆ™å¯èƒ½å› éƒ¨åˆ†å¤±è´¥å¯¼è‡´æ•°æ®ä¸ä¸€è‡´&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸å¤„ç†ï¼š
&lt;ul&gt;
&lt;li&gt;ä¹è§‚é”å†²çªã€å”¯ä¸€é”®å†²çªç­‰éœ€æ˜ç¡®è¿”å›ç›¸åŒç»“æœï¼ˆå¦‚â€œè¯·æ±‚å·²å¤„ç†â€ï¼‰ï¼Œè€ŒéæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½æƒè¡¡ï¼š
&lt;ul&gt;
&lt;li&gt;æ‚²è§‚é”ã€åˆ†å¸ƒå¼é”åœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½æˆä¸ºç“¶é¢ˆï¼Œä¼˜å…ˆé€‰æ‹©æ— é”æ–¹æ¡ˆï¼ˆå¦‚ä¹è§‚é”ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¹‚ç­‰æ€§è®¾è®¡éœ€ç»“åˆ&lt;strong&gt;ä¸šåŠ¡åœºæ™¯&lt;/strong&gt;ä¸&lt;strong&gt;æŠ€æœ¯æˆæœ¬&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé€‰æ‹©&lt;strong&gt;æ•°æ®åº“å±‚æ–¹æ¡ˆ&lt;/strong&gt;ï¼ˆå”¯ä¸€ç´¢å¼•ã€ä¹è§‚é”ï¼‰å®ç°ç®€å•å¼ºä¸€è‡´æ€§ï¼›&lt;/li&gt;
&lt;li&gt;è·¨æœåŠ¡è°ƒç”¨é‡‡ç”¨&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;æˆ–&lt;strong&gt;è¯·æ±‚ID&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å‰ç«¯é˜²é‡ä½¿ç”¨&lt;strong&gt;Tokenæœºåˆ¶&lt;/strong&gt;ã€‚
â€‹&lt;strong&gt;ç»ˆæåŸåˆ™&lt;/strong&gt;â€‹ï¼šæ— è®ºä½•ç§æ–¹æ¡ˆï¼Œéƒ½éœ€é€šè¿‡&lt;strong&gt;å”¯ä¸€æ ‡è¯†+çŠ¶æ€æ ¡éªŒ&lt;/strong&gt;å…œåº•ï¼Œå¹¶åœ¨ä¸šåŠ¡é€»è¾‘ä¸­é¢„è®¾é‡å¤è¯·æ±‚çš„åº”å¯¹ç­–ç•¥&lt;a class="link" href="@ref" &gt;1,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ‰‹åŠ¨æäº¤"&gt;æ‰‹åŠ¨æäº¤
&lt;/h2&gt;&lt;p&gt;åœ¨Kafkaæ‰¹é‡æ¶ˆè´¹åœºæ™¯ä¸­ï¼Œ&lt;strong&gt;æ‰‹åŠ¨æäº¤åç§»é‡&lt;/strong&gt;æ˜¯ç¡®ä¿æ¶ˆæ¯å¤„ç†ç²¾ç¡®æ€§çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ­¥éª¤ã€é…ç½®è¦ç‚¹åŠæœ€ä½³å®è·µï¼Œç»“åˆKafkaæ¶ˆè´¹è€…APIçš„è®¾è®¡é€»è¾‘ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€é…ç½®ç¦ç”¨è‡ªåŠ¨æäº¤"&gt;ğŸ”§ &lt;strong&gt;åŸºç¡€é…ç½®ï¼šç¦ç”¨è‡ªåŠ¨æäº¤&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨æ¶ˆè´¹è€…é…ç½®ä¸­æ˜¾å¼å…³é—­è‡ªåŠ¨æäº¤ï¼Œå¯ç”¨æ‰‹åŠ¨æ§åˆ¶ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Properties props = new Properties();
props.put(&amp;#34;bootstrap.servers&amp;#34;, &amp;#34;localhost:9092&amp;#34;);
props.put(&amp;#34;group.id&amp;#34;, &amp;#34;batch-consumer-group&amp;#34;);
props.put(&amp;#34;key.deserializer&amp;#34;, StringDeserializer.class.getName());
props.put(&amp;#34;value.deserializer&amp;#34;, StringDeserializer.class.getName());
props.put(&amp;#34;enable.auto.commit&amp;#34;, &amp;#34;false&amp;#34;); // å…³é”®ï¼šå…³é—­è‡ªåŠ¨æäº¤[1,6](@ref)
props.put(&amp;#34;max.poll.records&amp;#34;, 500); // æ§åˆ¶å•æ¬¡æ‹‰å–æ¶ˆæ¯æ•°ï¼ˆæ‰¹é‡å¤§å°ï¼‰[3,5](@ref)
KafkaConsumer&amp;lt;String, String&amp;gt; consumer = new KafkaConsumer&amp;lt;&amp;gt;(props);
consumer.subscribe(Arrays.asList(&amp;#34;your_topic&amp;#34;));
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ‰¹é‡æ¶ˆè´¹ä¸æ‰‹åŠ¨æäº¤æ¨¡å¼"&gt;âš™ï¸ &lt;strong&gt;æ‰¹é‡æ¶ˆè´¹ä¸æ‰‹åŠ¨æäº¤æ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŒæ­¥æäº¤"&gt;&lt;strong&gt;åŒæ­¥æäº¤ï¼ˆ&lt;code&gt;commitSync()&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šé˜»å¡çº¿ç¨‹ç›´åˆ°æäº¤æˆåŠŸï¼Œç¡®ä¿å¼ºä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚é‡‘èäº¤æ˜“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;while (true) {
ConsumerRecords&amp;lt;String, String&amp;gt; records = consumer.poll(Duration.ofMillis(100));
for (ConsumerRecord&amp;lt;String, String&amp;gt; record : records) {
// æ‰¹é‡å¤„ç†é€»è¾‘ï¼ˆå¦‚å†™å…¥æ•°æ®åº“ï¼‰
processBatch(record);
}
// æ‰€æœ‰æ¶ˆæ¯å¤„ç†å®Œæˆåï¼ŒåŒæ­¥æäº¤åç§»é‡
consumer.commitSync(); // æäº¤æœ¬æ¬¡pollçš„æ•´æ‰¹åç§»é‡[6,8](@ref)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;ï¼šè‹¥æäº¤åä¸šåŠ¡é€»è¾‘æœªå®Œæˆï¼Œå¯èƒ½ä¸¢å¤±æ¶ˆæ¯ï¼ˆéœ€ç»“åˆä¸šåŠ¡å¹‚ç­‰æ€§è®¾è®¡ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id="å¼‚æ­¥æäº¤"&gt;&lt;strong&gt;å¼‚æ­¥æäº¤ï¼ˆ&lt;code&gt;commitAsync()&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šéé˜»å¡ï¼Œé€šè¿‡å›è°ƒå¤„ç†æäº¤ç»“æœï¼Œé€‚åˆé«˜åååœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›è°ƒç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;consumer.commitAsync((offsets, exception) -&amp;gt; {
if (exception != null) {
log.error(&amp;#34;Commit failed for offsets {}&amp;#34;, offsets, exception);
// å¯é‡è¯•æˆ–è®°å½•å¼‚å¸¸[6](@ref)
}
});
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="åŒæ­¥å¼‚æ­¥ç»„åˆæäº¤"&gt;&lt;strong&gt;åŒæ­¥+å¼‚æ­¥ç»„åˆæäº¤&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;ï¼šå¸¸è§„æ‰¹æ¬¡ç”¨å¼‚æ­¥æäº¤ï¼Œæ¶ˆè´¹è€…å…³é—­å‰ç”¨åŒæ­¥æäº¤å…œåº•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;try {
while (true) {
ConsumerRecords&amp;lt;String, String&amp;gt; records = consumer.poll(Duration.ofMillis(100));
processBatch(records);
consumer.commitAsync(); // å¼‚æ­¥æäº¤
}
} finally {
try {
consumer.commitSync(); // æœ€ç»ˆç¡®ä¿æäº¤æˆåŠŸ[6](@ref)
} finally {
consumer.close();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æäº¤æ—¶æœºçš„ä¼˜åŒ–æ§åˆ¶"&gt;â±ï¸ &lt;strong&gt;æäº¤æ—¶æœºçš„ä¼˜åŒ–æ§åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ‰‹åŠ¨æäº¤ä¸ä»…é™äºâ€œæ¯æ‰¹ä¸€æ¬¡â€ï¼Œå¯é€šè¿‡ä»¥ä¸‹ç­–ç•¥æå‡å¯é æ€§ï¼š
1.
æŒ‰æ¶ˆæ¯æ•°æäº¤
ç´¯ç§¯å¤„ç†Næ¡æ¶ˆæ¯åæäº¤ï¼ˆå¦‚æ¯100æ¡ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;int batchCount = 0;
for (ConsumerRecord record : records) {
process(record);
if (++batchCount % 100 == 0) {
consumer.commitSync(); // æ¯100æ¡æäº¤ä¸€æ¬¡
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;ol start="2"&gt;
&lt;li&gt;æŒ‰æ—¶é—´çª—å£æäº¤
å®šæ—¶æäº¤ï¼ˆå¦‚æ¯5ç§’ï¼‰ï¼Œé¿å…é•¿æ—¶é—´æœªæäº¤å¯¼è‡´é‡å¤æ¶ˆè´¹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;long lastCommitTime = System.currentTimeMillis();
while (true) {
ConsumerRecords&amp;lt;String, String&amp;gt; records = consumer.poll(Duration.ofMillis(100));
processBatch(records);
if (System.currentTimeMillis() - lastCommitTime &amp;gt; 5000) {
consumer.commitSync();
lastCommitTime = System.currentTimeMillis();
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æŒ‰åˆ†åŒºç²’åº¦æäº¤
ä¸ºæ¯ä¸ªåˆ†åŒºç‹¬ç«‹æäº¤åç§»é‡ï¼Œé¿å…å…¨æ‰¹å¤±è´¥ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;Map&amp;lt;TopicPartition, OffsetAndMetadata&amp;gt; offsets = new HashMap&amp;lt;&amp;gt;();
for (TopicPartition partition : records.partitions()) {
long offset = records.records(partition).getLast().offset() + 1;
offsets.put(partition, new OffsetAndMetadata(offset));
}
consumer.commitSync(offsets); // åˆ†åŒºçº§æäº¤[8](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹ä¸é¿å‘æŒ‡å—"&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„äº‹é¡¹ä¸é¿å‘æŒ‡å—&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é‡å¤æ¶ˆè´¹é£é™©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æäº¤åç§»é‡åä¸šåŠ¡é€»è¾‘å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šä¸¢å¤±ï¼ˆå› åç§»é‡å·²æ›´æ–°ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥ä¸šåŠ¡æˆåŠŸä½†æäº¤å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šé‡å¤æ¶ˆè´¹ã€‚
â€‹&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;â€‹ï¼šä¸šåŠ¡å±‚å¿…é¡»å®ç°å¹‚ç­‰æ€§ï¼ˆå¦‚æ•°æ®åº“å”¯ä¸€ç´¢å¼•ã€Rediså»é‡ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æäº¤åç§»é‡çš„å€¼&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æäº¤å€¼åº”ä¸º&lt;code&gt;æœ€åæ¶ˆè´¹æ¶ˆæ¯çš„offset + 1&lt;/code&gt;ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¡å¾…æ¶ˆè´¹æ¶ˆæ¯çš„ä½ç½®&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Rebalanceç›‘å¬å™¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨å†Œ
&lt;pre tabindex="0"&gt;&lt;code&gt;ConsumerRebalanceListener
&lt;/code&gt;&lt;/pre&gt;ï¼Œåœ¨åˆ†åŒºè¢«å›æ”¶æ—¶æäº¤åç§»é‡ï¼Œé¿å…å†å‡è¡¡å¯¼è‡´é‡å¤æ¶ˆè´¹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;consumer.subscribe(Arrays.asList(&amp;#34;topic&amp;#34;), new ConsumerRebalanceListener() {
public void onPartitionsRevoked(Collection&amp;lt;TopicPartition&amp;gt; partitions) {
consumer.commitSync(currentOffsets); // åˆ†åŒºè¢«å›æ”¶æ—¶æäº¤
}
});
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µæ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æœ€ä½³å®è·µæ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜åå + å®¹å¿å°‘é‡é‡å¤&lt;/td&gt;
&lt;td&gt;å¼‚æ­¥æäº¤ + æŒ‰æ—¶é—´çª—å£/æ¶ˆæ¯æ•°æäº¤&lt;/td&gt;
&lt;td&gt;éé˜»å¡æäº¤ï¼Œæœ€å¤§åŒ–ååé‡&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§è¦æ±‚&lt;/td&gt;
&lt;td&gt;åŒæ­¥æäº¤ + åˆ†åŒºç²’åº¦æäº¤&lt;/td&gt;
&lt;td&gt;ç¡®ä¿æ¯æ¡æ¶ˆæ¯åç§»é‡ç²¾ç¡®æ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¶ˆè´¹è€…ä¼˜é›…é€€å‡º&lt;/td&gt;
&lt;td&gt;&lt;code&gt;finally&lt;/code&gt;å—å†…åŒæ­¥æäº¤&lt;/td&gt;
&lt;td&gt;é˜²æ­¢é€€å‡ºæ—¶åç§»é‡æœªæäº¤&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è·¨ç³»ç»Ÿäº‹åŠ¡&lt;/td&gt;
&lt;td&gt;ç»“åˆæœ¬åœ°äº‹åŠ¡è¡¨ + åç§»é‡ç»‘å®šå­˜å‚¨&lt;/td&gt;
&lt;td&gt;å°†ä¸šåŠ¡æ•°æ®ä¸åç§»é‡å­˜å…¥åŒæ•°æ®åº“ï¼Œé€šè¿‡äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»ˆæåŸåˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨æäº¤åç§»é‡ + ä¸šåŠ¡å¹‚ç­‰æ€§ = ç«¯åˆ°ç«¯ç²¾å‡†ä¸€æ¬¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§&lt;code&gt;consumer_lag&lt;/code&gt;ä¸æäº¤å¤±è´¥æ—¥å¿—ï¼ŒåŠæ—¶è°ƒæ•´&lt;code&gt;max.poll.records&lt;/code&gt;å’Œæäº¤é¢‘ç‡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="enableautocommit"&gt;enable.auto.commit
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot é›†æˆ Kafka æ—¶ï¼Œ&lt;strong&gt;&lt;code&gt;enable.auto.commit=false&lt;/code&gt; ä¸æ˜¯é»˜è®¤å€¼&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;h3 id="-é»˜è®¤å€¼"&gt;âš™ï¸ &lt;strong&gt;é»˜è®¤å€¼ï¼š&lt;code&gt;true&lt;/code&gt;&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Spring Boot çš„ Kafka æ¶ˆè´¹è€…é…ç½®ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;enable.auto.commit&lt;/code&gt; çš„é»˜è®¤å€¼ä¸º &lt;code&gt;true&lt;/code&gt;&lt;/strong&gt;ï¼Œå³&lt;strong&gt;è‡ªåŠ¨æäº¤åç§»é‡&lt;/strong&gt;ã€‚æ¶ˆè´¹è€…ä¼šæŒ‰ç…§ &lt;code&gt;auto.commit.interval.ms&lt;/code&gt; é…ç½®çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤ 5 ç§’ï¼‰è‡ªåŠ¨å‘ Kafka æäº¤æ¶ˆè´¹è¿›åº¦&lt;a class="link" href="@ref" &gt;2,4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œåœ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; KafkaProperties.Consumer
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çš„æºç ä¸­ï¼Œè¯¥å±æ€§é»˜è®¤å€¼ä¸º true&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; spring.kafka.consumer.enable-auto-commit: true
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="-ä¸ºä½•å»ºè®®æ”¹ä¸º"&gt;âš ï¸ &lt;strong&gt;ä¸ºä½•å»ºè®®æ”¹ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶é»˜è®¤å¼€å¯è‡ªåŠ¨æäº¤ï¼Œä½†å®é™…ç”Ÿäº§ç¯å¢ƒ&lt;strong&gt;å¼ºçƒˆå»ºè®®æ‰‹åŠ¨æäº¤åç§»é‡&lt;/strong&gt;ï¼ˆå³è®¾ç½® &lt;code&gt;enable.auto.commit=false&lt;/code&gt;ï¼‰ï¼ŒåŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸¢å¤±é£é™©&lt;/strong&gt;ï¼šè‹¥æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶å´©æºƒï¼Œä½†åç§»é‡å·²è‡ªåŠ¨æäº¤ï¼Œæœªå¤„ç†å®Œçš„æ¶ˆæ¯ä¼šè¢«è·³è¿‡&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å¤æ¶ˆè´¹é£é™©&lt;/strong&gt;ï¼šè‹¥æ¶ˆæ¯å¤„ç†æˆåŠŸä½†åç§»é‡æäº¤å¤±è´¥ï¼Œé‡å¯åä¼šé‡æ–°æ¶ˆè´¹å·²å¤„ç†çš„æ¶ˆæ¯&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡ä¸€è‡´æ€§è¦æ±‚&lt;/strong&gt;ï¼šæ‰‹åŠ¨æäº¤å¯ç¡®ä¿ä¸šåŠ¡é€»è¾‘å®Œæˆåæ‰æäº¤åç§»é‡ï¼Œé¿å…çŠ¶æ€ä¸ä¸€è‡´&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ‰‹åŠ¨æäº¤çš„é…ç½®æ–¹å¼"&gt;ğŸ”§ &lt;strong&gt;æ‰‹åŠ¨æäº¤çš„é…ç½®æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;code&gt;application.yml&lt;/code&gt; ä¸­æ˜¾å¼å…³é—­è‡ªåŠ¨æäº¤ï¼Œå¹¶æŒ‡å®šæäº¤æ¨¡å¼ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
kafka:
consumer:
enable-auto-commit: false # å…³é—­è‡ªåŠ¨æäº¤
listener:
ack-mode: manual_immediate # æ‰‹åŠ¨æäº¤æ¨¡å¼ï¼ˆæ¯æ¡æäº¤ï¼‰æˆ– manualï¼ˆæ‰¹é‡æäº¤ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æäº¤æ¨¡å¼é€‰æ‹©ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;manual_immediate&lt;/code&gt;ï¼šæ¯æ¡æ¶ˆæ¯å¤„ç†å®Œåç«‹å³æäº¤ï¼ˆä½åååœºæ™¯ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;manual&lt;/code&gt;ï¼šæ‰¹é‡å¤„ç†å®Œåç»Ÿä¸€æäº¤ï¼ˆé«˜åååœºæ™¯ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é»˜è®¤å€¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç”Ÿäº§å»ºè®®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;enable.auto.commit&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è®¾ä¸º &lt;code&gt;false&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é¿å…è‡ªåŠ¨æäº¤å¯¼è‡´çš„ä¸¢å¤±/é‡å¤é—®é¢˜ï¼Œä¸šåŠ¡ä¸åç§»é‡æäº¤å¼ºç»‘å®š&lt;a class="link" href="@ref" &gt;3,5,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;listener.ack-mode&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BATCH&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;manual&lt;/code&gt;/&lt;code&gt;manual_immediate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;Acknowledgment.acknowledge()&lt;/code&gt; æ‰‹åŠ¨æ§åˆ¶æäº¤æ—¶æœº&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š
å§‹ç»ˆæ˜¾å¼é…ç½® &lt;code&gt;enable.auto.commit=false&lt;/code&gt; + åˆé€‚çš„ &lt;code&gt;ack-mode&lt;/code&gt;ï¼Œå¹¶åœ¨æ¶ˆè´¹é€»è¾‘ä¸­è°ƒç”¨ &lt;code&gt;acknowledge()&lt;/code&gt;æäº¤åç§»é‡ï¼Œç¡®ä¿æ¶ˆæ¯å¤„ç†çš„å¯é æ€§&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="kafkalistener"&gt;@KafkaListener
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot ä¸­ï¼Œå½“é…ç½® &lt;code&gt;enable.auto.commit=false&lt;/code&gt; å¹¶åŒæ—¶ä½¿ç”¨ &lt;code&gt;@KafkaListener&lt;/code&gt; å’Œ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£æ—¶ï¼Œ&lt;strong&gt;ä½ç§»æäº¤è¡Œä¸ºå–å†³äº &lt;code&gt;AckMode&lt;/code&gt; çš„é…ç½®ï¼Œè€Œéç›´æ¥ç”±äº‹åŠ¡ç®¡ç†å™¨è‡ªåŠ¨å¤„ç†&lt;/strong&gt;ã€‚å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæœºåˆ¶åˆ†æ"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæœºåˆ¶åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt; çš„ä½œç”¨èŒƒå›´&lt;/strong&gt;
&lt;code&gt;@Transactional&lt;/code&gt; ä»…ç®¡ç†&lt;strong&gt;æ•°æ®åº“äº‹åŠ¡&lt;/strong&gt;ï¼ˆå¦‚ MySQL æ“ä½œï¼‰ï¼Œä¸ç›´æ¥æ§åˆ¶ Kafka ä½ç§»æäº¤ã€‚ä½ç§»æäº¤ä»éœ€é€šè¿‡ &lt;code&gt;Acknowledgment&lt;/code&gt; æ¥å£æ˜¾å¼è°ƒç”¨æˆ–ä¾èµ– Spring å®¹å™¨çš„æäº¤ç­–ç•¥&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½ç§»æäº¤çš„è§¦å‘æ¡ä»¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æœªæ˜¾å¼è°ƒç”¨ &lt;code&gt;Acknowledgment.acknowledge()&lt;/code&gt;ï¼š
å³ä½¿é…ç½®äº† &lt;code&gt;@Transactional&lt;/code&gt;ï¼Œ&lt;strong&gt;ä½ç§»ä¹Ÿä¸ä¼šè‡ªåŠ¨æäº¤&lt;/strong&gt;ã€‚æ­¤æ—¶æ¶ˆè´¹è¿›åº¦å¯èƒ½æ»åï¼Œé‡å¯åä¼šå¯¼è‡´æ¶ˆæ¯é‡å¤æ¶ˆè´¹&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥è°ƒç”¨ &lt;code&gt;acknowledge()&lt;/code&gt;ï¼š
ä½ç§»æäº¤ä¼šä¸æ•°æ®åº“äº‹åŠ¡ç»‘å®šï¼Œ&lt;strong&gt;ç”± Spring äº‹åŠ¡ç®¡ç†å™¨åè°ƒæäº¤æ—¶æœº&lt;/strong&gt;ï¼ˆä¾‹å¦‚åœ¨æ•°æ®åº“äº‹åŠ¡æäº¤ååŒæ­¥æäº¤ä½ç§»ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®ä¸ä»£ç ç¤ºä¾‹"&gt;ğŸ”§ &lt;strong&gt;é…ç½®ä¸ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ­£ç¡®é…ç½®æ–¹å¼"&gt;&lt;strong&gt;æ­£ç¡®é…ç½®æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;spring:
kafka:
consumer:
enable-auto-commit: false # å…³é—­è‡ªåŠ¨æäº¤
listener:
ack-mode: manual_immediate # æ‰‹åŠ¨æäº¤æ¨¡å¼
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="æ¶ˆè´¹è€…ä»£ç ç¤ºä¾‹"&gt;&lt;strong&gt;æ¶ˆè´¹è€…ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;@KafkaListener(topics = &amp;#34;test-topic&amp;#34;)
@Transactional
public void listen(String message, Acknowledgment ack) {
try {
// æ•°æ®åº“æ“ä½œï¼ˆå— @Transactional ç®¡ç†ï¼‰
orderService.processOrder(message);
// æ˜¾å¼æäº¤ä½ç§»ï¼ˆä¸æ•°æ®åº“äº‹åŠ¡åŒæ­¥ï¼‰
ack.acknowledge();
} catch (Exception e) {
// æ•°æ®åº“äº‹åŠ¡å›æ»šæ—¶ï¼Œack.acknowledge() ä¸ä¼šæ‰§è¡Œï¼Œä½ç§»ä¸æäº¤
throw new RuntimeException(&amp;#34;å¤„ç†å¤±è´¥&amp;#34;, e);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-å…³é”®æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ &lt;strong&gt;å…³é”®æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä½ç§»æäº¤ä¸äº‹åŠ¡çš„åŸå­æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ &lt;code&gt;ack.acknowledge()&lt;/code&gt; åœ¨ &lt;code&gt;@Transactional&lt;/code&gt; æ–¹æ³•å†…è°ƒç”¨ï¼Œåˆ™&lt;strong&gt;ä½ç§»æäº¤ä¸æ•°æ®åº“æ“ä½œå…±äº«åŒä¸€äº‹åŠ¡&lt;/strong&gt;ï¼Œç¡®ä¿ä¸šåŠ¡æˆåŠŸæ—¶ä½ç§»ä¸€å®šæäº¤&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ &lt;code&gt;ack.acknowledge()&lt;/code&gt; åœ¨äº‹åŠ¡å¤–è°ƒç”¨ï¼Œå¯èƒ½å‘ç”Ÿ&lt;strong&gt;ä¸šåŠ¡å¤±è´¥ä½†ä½ç§»å·²æäº¤&lt;/strong&gt;çš„æ¶ˆæ¯ä¸¢å¤±é£é™©&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AckMode çš„å½±å“&lt;/strong&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;AckMode&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;MANUAL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ˜¾å¼è°ƒç”¨ &lt;code&gt;ack.acknowledge()&lt;/code&gt;ï¼Œä½ç§»åœ¨ä¸‹æ¬¡ &lt;code&gt;poll()&lt;/code&gt; å‰æ‰¹é‡æäº¤&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;MANUAL_IMMEDIATE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è°ƒç”¨ &lt;code&gt;ack.acknowledge()&lt;/code&gt; åç«‹å³æäº¤ä½ç§»ï¼Œä¸äº‹åŠ¡å¼ºç»‘å®š&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;BATCH&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰&lt;/td&gt;
&lt;td&gt;å³ä½¿æœªè°ƒç”¨ &lt;code&gt;acknowledge()&lt;/code&gt;ï¼ŒSpring ä¹Ÿä¼šåœ¨å¤„ç†å®Œä¸€æ‰¹æ¶ˆæ¯åè‡ªåŠ¨æäº¤ä½ç§»&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡å¤æ¶ˆè´¹é£é™©&lt;/strong&gt;
è‹¥æ•°æ®åº“äº‹åŠ¡æäº¤æˆåŠŸä½†ä½ç§»æäº¤å¤±è´¥ï¼ˆå¦‚ Kafka é›†ç¾¤ä¸å¯ç”¨ï¼‰ï¼Œæ¶ˆè´¹è€…é‡å¯åä¼šé‡å¤æ¶ˆè´¹ã€‚è§£å†³æ–¹æ¡ˆï¼š
&lt;ul&gt;
&lt;li&gt;ä¸šåŠ¡å±‚æ·»åŠ &lt;strong&gt;å¹‚ç­‰æ€§è®¾è®¡&lt;/strong&gt;ï¼ˆå¦‚æ•°æ®åº“å”¯ä¸€ç´¢å¼•ã€Redis å»é‡ï¼‰&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨ Kafka äº‹åŠ¡æ¶ˆæ¯ï¼ˆéœ€é…ç½® &lt;code&gt;spring.kafka.producer.transaction-id-prefix&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µ"&gt;ğŸ’ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¸€è‡´æ€§åœºæ™¯&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @KafkaListener(topics = &amp;#34;order-topic&amp;#34;)
@Transactional
public void handleOrder(OrderEvent event, Acknowledgment ack) {
orderService.saveOrder(event); // æ•°æ®åº“æ“ä½œ
ack.acknowledge(); // ä½ç§»æäº¤ä¸æ•°æ®åº“äº‹åŠ¡åŒæ­¥
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;é…ç½® &lt;code&gt;ack-mode: manual_immediate&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜åååœºæ™¯ï¼ˆå®¹å¿å°‘é‡é‡å¤ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;@KafkaListener(topics = &amp;ldquo;log-topic&amp;rdquo;, concurrency = &amp;ldquo;3&amp;rdquo;)
public void batchListen(List&lt;String&gt; messages, Acknowledgment ack) {
logService.batchInsert(messages); // æ‰¹é‡å†™å…¥æ•°æ®åº“
ack.acknowledge(); // æ‰¹é‡æäº¤ä½ç§»
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;- é…ç½® `spring.kafka.listener.type: batch` + `ack-mode: manual`[1,4](@ref)ã€‚
------
### âš¡ **æ€»ç»“**
- **`enable.auto.commit=false` + `@Transactional` ä¸ä¼šè‡ªåŠ¨æäº¤ä½ç§»**ï¼Œéœ€æ˜¾å¼è°ƒç”¨ `Acknowledgment.acknowledge()`ã€‚
- **ä½ç§»æäº¤ä¸æ•°æ®åº“äº‹åŠ¡çš„ç»‘å®š**é€šè¿‡ `ack.acknowledge()` åœ¨äº‹åŠ¡æ–¹æ³•å†…çš„ä½ç½®å®ç°[1,8](@ref)ã€‚
- ç”Ÿäº§å»ºè®®ï¼š
- ä¼˜å…ˆä½¿ç”¨ `MANUAL_IMMEDIATE` æ¨¡å¼ä¿è¯äº‹åŠ¡åŸå­æ€§ã€‚
- æ‰€æœ‰æ¶ˆè´¹é€»è¾‘å¿…é¡»å®ç°**å¹‚ç­‰æ€§**ï¼Œé˜²å¾¡ä½ç§»æäº¤å¤±è´¥å¯¼è‡´çš„é‡å¤æ¶ˆæ¯[5,7](@ref)ã€‚
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>ã€Postopiaã€‘page</title><link>https://dyhes.github.io/p/postopiapage/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiapage/</guid><description>&lt;h2 id="æ·±åº¦åˆ†é¡µ"&gt;æ·±åº¦åˆ†é¡µ
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Data JPAä¸­ï¼Œ&lt;code&gt;Pageable&lt;/code&gt;æ¥å£é»˜è®¤é‡‡ç”¨&lt;strong&gt;åŸºäºOffsetçš„åˆ†é¡µæœºåˆ¶&lt;/strong&gt;ï¼Œä½†åœ¨æ·±åº¦åˆ†é¡µï¼ˆå¦‚æŸ¥è¯¢ç¬¬1000é¡µï¼‰åœºæ™¯ä¸‹ï¼Œè¿™ç§æœºåˆ¶å­˜åœ¨æ˜¾è‘—æ€§èƒ½é—®é¢˜ã€‚å¼€å‘è€…å¯é€šè¿‡æ¸¸æ ‡åˆ†é¡µï¼ˆCursor-based Paginationï¼‰ä¼˜åŒ–æ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æåŠè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é»˜è®¤æœºåˆ¶åŸºäºoffsetçš„åˆ†é¡µ"&gt;âš™ï¸ &lt;strong&gt;é»˜è®¤æœºåˆ¶ï¼šåŸºäºOffsetçš„åˆ†é¡µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å®ç°åŸç†é€šè¿‡
&lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PageRequest.of(page, size)&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;åˆ›å»º
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Pageable&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;å¯¹è±¡æ—¶ï¼Œç”Ÿæˆçš„SQLä¼šä½¿ç”¨
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;LIMIT size OFFSET (page * size)&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ï¼ˆMySQLï¼‰æˆ–ç±»ä¼¼è¯­æ³•ï¼ˆå¦‚Oracleçš„
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ROWNUM&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ï¼‰ã€‚ä¾‹å¦‚ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;SELECT * FROM users ORDER BY id LIMIT 10 OFFSET 10000; &amp;ndash; æŸ¥è¯¢ç¬¬1001é¡µï¼ˆæ¯é¡µ10æ¡ï¼‰&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;- æ·±åº¦åˆ†é¡µæ€§èƒ½é—®é¢˜
- **å…¨è¡¨æ‰«æé£é™©**ï¼šæ•°æ®åº“éœ€å…ˆæ‰«æ`OFFSET + size`æ¡è®°å½•ï¼ˆå¦‚`OFFSET 10000`éœ€æ‰«æå‰10000æ¡ï¼‰ï¼Œå†è¿”å›ç›®æ ‡æ•°æ®ï¼Œå¯¼è‡´I/Oå’ŒCPUèµ„æºæ¶ˆè€—å‰§å¢[6](@ref)ã€‚
- **å»¶è¿Ÿä¸èµ„æºæµªè´¹**ï¼šå½“`OFFSET`å€¼è¶…è¿‡10ä¸‡æ—¶ï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´å¯èƒ½ä»æ¯«ç§’çº§å‡è‡³ç§’çº§[6](@ref)ã€‚
- **é€‚ç”¨åœºæ™¯**
æ•°æ®é‡è¾ƒå°ï¼ˆå¦‚æ€»é¡µæ•°&amp;lt;100ï¼‰æˆ–ä»…éœ€å‰å‡ é¡µæ•°æ®çš„åœºæ™¯ã€‚
------
### ğŸ¯ **ä¼˜åŒ–æ–¹æ¡ˆï¼šæ¸¸æ ‡åˆ†é¡µï¼ˆCursor-based Paginationï¼‰**
- æ ¸å¿ƒæ€æƒ³
ä¸å†ä¾èµ–é¡µç ï¼Œè€Œæ˜¯åŸºäºæœ€åä¸€æ¡è®°å½•çš„æ ‡è¯†ï¼ˆå¦‚ä¸»é”®IDã€æ—¶é—´æˆ³ï¼‰å®šä½ä¸‹ä¸€é¡µæ•°æ®ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;SELECT * FROM users WHERE id &amp;gt; last_id ORDER BY id LIMIT 10; &amp;ndash; æ¸¸æ ‡åˆ†é¡µç¤ºä¾‹&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;- ä¼˜åŠ¿
- **å¸¸æ•°çº§æ€§èƒ½**ï¼šæ— è®ºæ·±åº¦å¦‚ä½•ï¼ŒæŸ¥è¯¢æ—¶é—´ä»…ä¸`LIMIT size`ç›¸å…³ï¼Œé¿å…`OFFSET`çš„å…¨è¡¨æ‰«æ[6](@ref)ã€‚
- **æ•°æ®ä¸€è‡´æ€§**ï¼šé¿å…å› åˆ†é¡µæœŸé—´æ•°æ®å¢åˆ å¯¼è‡´çš„é‡å¤æˆ–é—æ¼ï¼ˆå¦‚ä½¿ç”¨è‡ªå¢IDæˆ–æ—¶é—´æˆ³æ’åºï¼‰[6](@ref)ã€‚
- Spring Data JPAå®ç°æ­¥éª¤
1. Repositoryå±‚ï¼šä½¿ç”¨
```
@Query
```
å®šä¹‰æ¸¸æ ‡æŸ¥è¯¢ï¼š
```
@Query(&amp;#34;SELECT u FROM User u WHERE u.id &amp;gt; :cursorId ORDER BY u.id&amp;#34;)
List&amp;lt;User&amp;gt; findNextPage(@Param(&amp;#34;cursorId&amp;#34;) Long cursorId, Pageable pageable);
```
2. Serviceå±‚ï¼šä¼ é€’æ¸¸æ ‡å‚æ•°ï¼š
```
public Page&amp;lt;User&amp;gt; getUsers(Long cursorId, int size) {
Pageable pageable = PageRequest.of(0, size); // é¡µç å›ºå®šä¸º0
List&amp;lt;User&amp;gt; users = repository.findNextPage(cursorId, pageable);
// è®¡ç®—æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
boolean hasNext = users.size() == size;
return new PageImpl&amp;lt;&amp;gt;(users, pageable, hasNext ? users.size() : 0);
}
```
3. è¿”å›ç»“æ„ï¼šå“åº”ä¸­åŒ…å«æ¸¸æ ‡æ ‡è¯†ï¼ˆå¦‚æœ€åä¸€æ¡è®°å½•çš„IDï¼‰ï¼š
```
{
&amp;#34;content&amp;#34;: [...],
&amp;#34;nextCursor&amp;#34;: 1024 // ä¸‹ä¸€é¡µçš„èµ·å§‹æ¸¸æ ‡
}
```
7,8
------
### âš–ï¸ **ä¸¤ç§åˆ†é¡µæ–¹å¼å¯¹æ¯”**
| **ç‰¹æ€§** | **Offsetåˆ†é¡µ** | **æ¸¸æ ‡åˆ†é¡µ** |
| -------------- | ------------------------------- | -------------------------------- |
| **æ€§èƒ½** | æ·±åº¦åˆ†é¡µæ—¶æ€§èƒ½å·®ï¼ˆO(N)ï¼‰ | æ·±åº¦åˆ†é¡µæ€§èƒ½ç¨³å®šï¼ˆO(1)ï¼‰ |
| **æ•°æ®ä¸€è‡´æ€§** | æ˜“å—æ•°æ®å¢åˆ å½±å“ | ç¨³å®šï¼ˆåŸºäºæ’åºå­—æ®µï¼‰ |
| **å®ç°å¤æ‚åº¦** | ç®€å•ï¼ˆSpring Data JPAåŸç”Ÿæ”¯æŒï¼‰ | éœ€æ‰‹åŠ¨å¤„ç†æ¸¸æ ‡ä¼ é€’ |
| **é€‚ç”¨åœºæ™¯** | å°æ•°æ®é‡ã€éšæœºè®¿é—®é¡µç  | å¤§æ•°æ®é‡ã€è¿ç»­ç¿»é¡µï¼ˆå¦‚æ— é™æ»šåŠ¨ï¼‰ |
------
### ğŸ› ï¸ **å®é™…é€‰æ‹©å»ºè®®**
- ä¼˜å…ˆæ¸¸æ ‡åˆ†é¡µçš„åœºæ™¯
- ç”¨æˆ·è¿ç»­ç¿»é¡µï¼ˆå¦‚æ— é™æ»šåŠ¨åˆ—è¡¨ï¼‰[6,7](@ref)ã€‚
- å•æ¬¡æŸ¥è¯¢æ•°æ®é‡è¶…è¿‡10ä¸‡æ¡ï¼Œæˆ–éœ€è®¿é—®è¶…è¿‡100é¡µçš„æ·±åº¦[6](@ref)ã€‚
- ä»ç”¨Offsetåˆ†é¡µçš„åœºæ™¯
- åå°ç®¡ç†ç³»ç»Ÿï¼ˆéœ€ç²¾ç¡®ç»Ÿè®¡æ€»æ•°ã€è·³è½¬ä»»æ„é¡µï¼‰[8](@ref)ã€‚
- æ•°æ®é‡å°äº1ä¸‡æ¡ï¼Œæˆ–ä»…éœ€å‰å‡ é¡µæ•°æ®[1](@ref)ã€‚
&amp;gt; ğŸ’¡ **å…³é”®æç¤º**ï¼šè‹¥å¿…é¡»ä½¿ç”¨Offsetåˆ†é¡µä¸”éœ€ä¼˜åŒ–æ€§èƒ½ï¼Œå¯è€ƒè™‘ï¼š
&amp;gt;
&amp;gt; 1. **ç´¢å¼•è¦†ç›–ä¼˜åŒ–**ï¼šå…ˆé€šè¿‡å­æŸ¥è¯¢è·å–èµ·å§‹IDï¼Œå†è”è¡¨æŸ¥è¯¢ç›®æ ‡æ•°æ®[6](@ref)ã€‚
&amp;gt; 2. **é¿å…`COUNT(\*)**ï¼šå¤§æ•°æ®é‡è¡¨çš„æ€»è®°å½•æ•°æŸ¥è¯¢å¯ç‹¬ç«‹ç¼“å­˜[6](@ref)ã€‚
------
### æ€»ç»“
Spring Data JPAçš„`Pageable`é»˜è®¤é€šè¿‡Offsetåˆ†é¡µå®ç°ï¼Œæ·±åº¦åˆ†é¡µæ—¶éœ€ä¸»åŠ¨åˆ‡æ¢ä¸ºæ¸¸æ ‡æœºåˆ¶ã€‚**æ¸¸æ ‡åˆ†é¡µæ˜¯æ·±åº¦åˆ†é¡µçš„æ€§èƒ½é¦–é€‰**ï¼Œå°¤å…¶é€‚åˆè¿ç»­æ•°æ®æµåœºæ™¯ï¼›è€ŒOffsetåˆ†é¡µåœ¨éœ€ç²¾ç¡®ç»Ÿè®¡æˆ–è·³è½¬é¡µç æ—¶ä»æœ‰ä»·å€¼ã€‚å¼€å‘è€…åº”æ ¹æ®æ•°æ®è§„æ¨¡ä¸è®¿é—®æ¨¡å¼çµæ´»é€‰æ‹©[6,7,8](@ref)ã€‚
## æ¸¸æ ‡å­˜å‚¨
åœ¨Spring Data JPAæ·±åº¦åˆ†é¡µä¼˜åŒ–ä¸­ä½¿ç”¨æ¸¸æ ‡æ—¶ï¼Œæ¸¸æ ‡çš„å­˜å‚¨ä½ç½®ç›´æ¥å½±å“æ€§èƒ½ã€ä¸€è‡´æ€§å’Œå®ç°å¤æ‚åº¦ã€‚ä»¥ä¸‹æ˜¯ä¸åŒæ–¹æ¡ˆçš„å¯¹æ¯”åŠRediså­˜å‚¨çš„é€‚ç”¨æ€§åˆ†æï¼š
------
### ğŸ“ **æ¸¸æ ‡çš„æœ¬è´¨ä¸å­˜å‚¨åŸåˆ™**
**æ¸¸æ ‡æœ¬è´¨**æ˜¯**åˆ†é¡µæ–­ç‚¹æ ‡è¯†**ï¼ˆå¦‚æœ€åä¸€æ¡è®°å½•çš„IDã€æ—¶é—´æˆ³æˆ–æ’åºå­—æ®µå€¼ï¼‰ï¼Œç”¨äºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„èµ·å§‹ä½ç½®ã€‚å…¶å­˜å‚¨éœ€æ»¡è¶³ï¼š
- **è½»é‡ä¸´æ—¶æ€§**ï¼šé€šå¸¸æ— éœ€é•¿æœŸå­˜å‚¨ï¼Œä»…éœ€åœ¨è¿ç»­åˆ†é¡µè¯·æ±‚é—´ä¼ é€’ã€‚
- **ä½å»¶è¿Ÿè®¿é—®**ï¼šéœ€å¿«é€Ÿè¯»å†™ä»¥æ”¯æŒé«˜é¢‘åˆ†é¡µã€‚
- **å®¢æˆ·ç«¯å…³è”æ€§**ï¼šæ¸¸æ ‡ä¸å®¢æˆ·ç«¯çš„åˆ†é¡µä¸Šä¸‹æ–‡ç»‘å®šï¼Œä¸åŒå®¢æˆ·ç«¯åˆ†é¡µçŠ¶æ€ç‹¬ç«‹ã€‚
------
### ğŸ”§ **ä¸»æµå­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”**
#### 1ï¸âƒ£ **å®¢æˆ·ç«¯å›ä¼ ï¼ˆé¦–é€‰æ–¹æ¡ˆï¼‰**
- **å®ç°æ–¹å¼**ï¼šå°†æ¸¸æ ‡ï¼ˆå¦‚`lastId`ï¼‰ä½œä¸ºå“åº”è¿”å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è¯·æ±‚æ—¶é€šè¿‡å‚æ•°ï¼ˆå¦‚`?cursor=1000&amp;amp;size=10`ï¼‰å›ä¼ [1,8](@ref)ã€‚
- **ä¼˜ç‚¹**ï¼š
- **æ— çŠ¶æ€æœåŠ¡**ï¼šæœåŠ¡ç«¯æ— éœ€å­˜å‚¨ï¼Œå¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼æ¶æ„ã€‚
- **ä½å¼€é”€**ï¼šé¿å…é¢å¤–å­˜å‚¨ç»„ä»¶çš„ç½‘ç»œå’Œèµ„æºæ¶ˆè€—ã€‚
- **ç®€å•å¯é **ï¼šé€‚ç”¨äº99%çš„è¿ç»­åˆ†é¡µåœºæ™¯ï¼ˆå¦‚æ— é™æ»šåŠ¨ï¼‰ã€‚
- **ç¼ºç‚¹**ï¼š
- ä¸æ”¯æŒè·¨è®¾å¤‡æˆ–è·³é¡µï¼ˆä½†æ¸¸æ ‡åˆ†é¡µæœ¬å°±ä¸é€‚åˆè·³é¡µï¼‰ã€‚
- **ç¤ºä¾‹ä»£ç **ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;// å“åº”ç»“æ„
public class PageResult&lt;T&gt; {
private List&lt;T&gt; content;
private String nextCursor; // å¦‚ &amp;ldquo;id:1000&amp;rdquo;
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#### 2ï¸âƒ£ **Rediså­˜å‚¨ï¼ˆç‰¹å®šåœºæ™¯ä½¿ç”¨ï¼‰**
- **é€‚ç”¨åœºæ™¯**ï¼š
- **åˆ†é¡µçŠ¶æ€éœ€è·¨è®¾å¤‡å…±äº«**ï¼ˆå¦‚ç”¨æˆ·Aåœ¨æ‰‹æœºç«¯åˆ†é¡µåˆ°ç¬¬5é¡µï¼Œç”µè„‘ç«¯éœ€è‡ªåŠ¨ç»­æ¥ï¼‰ã€‚
- **åˆ†é¡µä¼šè¯éœ€é•¿æœŸä¿ç•™**ï¼ˆå¦‚åˆ†é¡µå¯¼å‡ºä»»åŠ¡å¯èƒ½ä¸­æ–­åæ¢å¤ï¼‰[6,7](@ref)ã€‚
- **å®ç°è¦ç‚¹**ï¼š
- **é”®è®¾è®¡**ï¼š`cursor:{sessionId}:{queryId}`ï¼ˆå¦‚`cursor:user123:export-task-1`ï¼‰ã€‚
- **å­˜å‚¨ç±»å‹**ï¼š`String`ï¼ˆç®€å•æ¸¸æ ‡å€¼ï¼‰æˆ– `Hash`ï¼ˆå¤šå­—æ®µæ¸¸æ ‡ï¼‰ã€‚
- **è¿‡æœŸæ—¶é—´**ï¼šè®¾ç½®TTLé¿å…å†…å­˜æ³„æ¼ï¼ˆå¦‚`EXPIRE cursor:user123:export-task-1 3600`ï¼‰ã€‚
- **ç¼ºç‚¹**ï¼š
- **å¢åŠ å¤æ‚åº¦**ï¼šéœ€ç»´æŠ¤Redisè¿æ¥ã€åºåˆ—åŒ–ã€å¼‚å¸¸å¤„ç†ã€‚
- **æ€§èƒ½æŸè€—**ï¼šç›¸æ¯”å®¢æˆ·ç«¯å›ä¼ ï¼Œå¤šä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼ˆ1~2mså»¶è¿Ÿï¼‰[6](@ref)ã€‚
- **ç¤ºä¾‹ä»£ç **ï¼š
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;public String saveCursor(String sessionId, String queryId, String cursorValue) {
String key = &amp;ldquo;cursor:&amp;rdquo; + sessionId + &amp;ldquo;:&amp;rdquo; + queryId;
redisTemplate.opsForValue().set(key, cursorValue, Duration.ofHours(1));
return key;
}&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#### 3ï¸âƒ£ **æ•°æ®åº“å­˜å‚¨ï¼ˆä¸æ¨èï¼‰**
- **åœºæ™¯**ï¼šéœ€æŒä¹…åŒ–åˆ†é¡µçŠ¶æ€ï¼ˆå¦‚å®¡è®¡éœ€æ±‚ï¼‰ã€‚
- **é—®é¢˜**ï¼š
- **æ€§èƒ½å·®**ï¼šæ¯æ¬¡åˆ†é¡µéœ€è¯»å†™æ•°æ®åº“ï¼Œæ‹–æ…¢å“åº”ã€‚
- **æ— å¿…è¦**ï¼šæ¸¸æ ‡æ˜¯ä¸´æ—¶çŠ¶æ€ï¼Œæ•°æ®åº“åº”å­˜ä¸šåŠ¡æ•°æ®è€Œéä¸Šä¸‹æ–‡[1,4](@ref)ã€‚
------
### âš¡ **Rediså­˜å‚¨æ¸¸æ ‡çš„å®æ“å»ºè®®**
è‹¥å¿…é¡»ä½¿ç”¨Redisï¼Œéœ€æ³¨æ„ï¼š
1. **æ•°æ®åºåˆ—åŒ–**ï¼šæ¸¸æ ‡å€¼è½¬ä¸ºStringï¼ˆå¦‚`Jackson`åºåˆ—åŒ–å¯¹è±¡ä¸ºJSONï¼‰ã€‚
2. **å¹¶å‘æ§åˆ¶**ï¼šå¯¹åŒä¸€åˆ†é¡µä¼šè¯åŠ åˆ†å¸ƒå¼é”ï¼ˆå¦‚Redissonï¼‰ï¼Œé¿å…å¹¶å‘æ›´æ–°æ¸¸æ ‡[6](@ref)ã€‚
3. **æ¸…ç†æœºåˆ¶**ï¼š
- å®¢æˆ·ç«¯ä¸»åŠ¨é€šçŸ¥ç»“æŸæ—¶åˆ é™¤æ¸¸æ ‡ã€‚
- è®¾ç½®TTLè‡ªåŠ¨æ¸…ç†ï¼ˆå¦‚30åˆ†é’Ÿï¼‰ã€‚
4. **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨Rediså†…å­˜å’ŒQPSï¼Œé¿å…æ¸¸æ ‡æ•°æ®è†¨èƒ€ã€‚
------
### ğŸ“Š **æ–¹æ¡ˆé€‰å‹å†³ç­–è¡¨**
| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **ç†ç”±** |
| ------------------------ | -------------------- | ------------------------------------------------------------ |
| è¿ç»­åˆ†é¡µï¼ˆå¦‚æ— é™æ»šåŠ¨ï¼‰ | å®¢æˆ·ç«¯å›ä¼  | ç®€å•é«˜æ•ˆï¼Œæ— é¢å¤–å¼€é”€[1,8](@ref) |
| è·¨è®¾å¤‡ç»­æ¥åˆ†é¡µ | Rediså­˜å‚¨ | çŠ¶æ€å…±äº«éœ€æ±‚ä¼˜å…ˆ[6](@ref) |
| é•¿æ—¶é—´ä»»åŠ¡ï¼ˆå¦‚æ•°æ®å¯¼å‡ºï¼‰ | Rediså­˜å‚¨ + TTL | ä¿ç•™ä¸­æ–­çŠ¶æ€ï¼Œé¿å…é‡å¤è®¡ç®— |
| éœ€è¦è·³é¡µæˆ–éšæœºè®¿é—® | éæ¸¸æ ‡æ–¹æ¡ˆï¼ˆOffsetï¼‰ | æ¸¸æ ‡åˆ†é¡µä¸æ”¯æŒè·³é¡µï¼Œéœ€æ”¹ç”¨Offsetåˆ†é¡µï¼ˆéœ€é…åˆç´¢å¼•ä¼˜åŒ–ï¼‰[3](@ref) |
------
### ğŸ’ **æ€»ç»“**
- **ä¼˜å…ˆé€‰æ‹©å®¢æˆ·ç«¯å›ä¼ **ï¼šæ¸¸æ ‡é€šè¿‡è¯·æ±‚å‚æ•°ä¼ é€’ï¼Œé€‚ç”¨äºç»å¤§å¤šæ•°åœºæ™¯ï¼Œç®€å•é«˜æ•ˆ âœ…ã€‚
- **è°¨æ…ä½¿ç”¨Rediså­˜å‚¨**ï¼šä»…åœ¨éœ€**è·¨è®¾å¤‡åŒæ­¥åˆ†é¡µçŠ¶æ€**æˆ–**ä¿ç•™ä¸­æ–­ä»»åŠ¡**æ—¶å¯ç”¨ï¼Œå¹¶ä¸¥æ ¼ç®¡ç†TTLå’Œå†…å­˜ â—ã€‚
- **é¿å…æ•°æ®åº“å­˜å‚¨**ï¼šæ¸¸æ ‡æ˜¯ä¸´æ—¶ä¸Šä¸‹æ–‡ï¼ŒæŒä¹…åŒ–åˆ°æ•°æ®åº“å¾—ä¸å¿å¤± âŒã€‚
&amp;gt; **æç¤º**ï¼šè‹¥ä½¿ç”¨Redisï¼Œå»ºè®®å°è£…æ¸¸æ ‡ç®¡ç†å·¥å…·ç±»ï¼Œç»Ÿä¸€å¤„ç†å­˜å‚¨ã€è¯»å–å’Œæ¸…ç†é€»è¾‘ï¼Œé™ä½ä¸šåŠ¡ä¾µå…¥æ€§[6,7](@ref)ã€‚
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>ã€Postopiaã€‘QPS</title><link>https://dyhes.github.io/p/postopiaqps/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiaqps/</guid><description>&lt;h2 id="qps"&gt;QPS
&lt;/h2&gt;&lt;p&gt;æµ‹é‡åç«¯æœåŠ¡çš„QPSï¼ˆQueries Per Secondï¼Œæ¯ç§’æŸ¥è¯¢ç‡ï¼‰æ˜¯è¯„ä¼°ç³»ç»Ÿæ€§èƒ½çš„å…³é”®æŒ‡æ ‡ï¼Œéœ€ç»“åˆå·¥å…·ä½¿ç”¨ã€ä»£ç å®ç°å’Œç»Ÿè®¡åˆ†æã€‚ä»¥ä¸‹æ˜¯ç³»ç»ŸåŒ–çš„æµ‹é‡æ–¹æ³•ï¼Œåˆ†ä¸ºå››å¤§åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€æµ‹é‡æ–¹æ³•"&gt;ğŸ“Š &lt;strong&gt;åŸºç¡€æµ‹é‡æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¦»çº¿æ—¥å¿—ç»Ÿè®¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåˆ†ææœåŠ¡å™¨æ—¥å¿—ï¼ˆå¦‚Nginxã€Tomcatè®¿é—®æ—¥å¿—ï¼‰ï¼Œç»Ÿè®¡å•ä½æ—¶é—´å†…çš„è¯·æ±‚é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æå–æ—¥å¿—ä¸­çš„è¯·æ±‚æ—¶é—´æˆ³ï¼ˆä¾‹å¦‚&lt;code&gt;grep 'GET /api' access.log | cut -d ' ' -f4 | uniq -c&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ï¼›
&lt;ul&gt;
&lt;li&gt;æŒ‰ç§’/åˆ†é’Ÿèšåˆè¯·æ±‚æ•°ï¼Œå…¬å¼ï¼š&lt;code&gt;QPS = æ€»è¯·æ±‚æ•° / æ—¶é—´çª—å£ï¼ˆç§’ï¼‰&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå†å²æ•°æ®åˆ†æã€éå®æ—¶ç›‘æ§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;å‹åŠ›æµ‹è¯•å·¥å…·&lt;/strong&gt;ï¼ˆæ¨èï¼‰
&lt;ul&gt;
&lt;li&gt;å·¥å…·é€‰æ‹©ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JMeter&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;èšåˆæŠ¥å‘Šï¼ˆAggregate Reportï¼‰&lt;/code&gt;çš„&lt;code&gt;Throughput&lt;/code&gt;å­—æ®µç›´æ¥è·å–QPS&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;wrk/ab&lt;/strong&gt;ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼Œç»“æœä¸­çš„&lt;code&gt;Requests/sec&lt;/code&gt;å³QPSï¼ˆå¦‚&lt;code&gt;wrk -t12 -c400 -d30s http://api&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;6,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®é…ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;è®¾ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼ˆ&lt;code&gt;-c&lt;/code&gt;ï¼‰ã€æµ‹è¯•æ—¶é•¿ï¼ˆ&lt;code&gt;-d&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;strong&gt;å¸¸é‡ååé‡å®šæ—¶å™¨&lt;/strong&gt;ï¼ˆJMeterï¼‰æ§åˆ¶è¯·æ±‚é€Ÿç‡&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®æ—¶ç›‘æ§åœºæ™¯"&gt;â±ï¸ &lt;strong&gt;å®æ—¶ç›‘æ§åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç åŸ‹ç‚¹ + æ—¶é—´çª—å£ç®—æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ»‘åŠ¨çª—å£å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;ç”¨ç¯å½¢æ•°ç»„ï¼ˆRing Bufferï¼‰åˆ†æ¡¶å­˜å‚¨ï¼Œæ¯200msä¸€ä¸ªæ¡¶ï¼Œè®°å½•è¯·æ±‚è®¡æ•°&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ç§’èšåˆæœ€è¿‘5ä¸ªæ¡¶çš„æ•°æ®ï¼ˆçª—å£=1ç§’ï¼‰ï¼Œè®¡ç®—å®æ—¶QPSï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;QPS = (æ¡¶â‚œè®¡æ•°æ€»å’Œ) / 1.0
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼€æºç»„ä»¶&lt;/strong&gt;ï¼šé˜¿é‡ŒSentinelã€Google Guava RateLimiterå‡é‡‡ç”¨æ­¤ç®—æ³•&lt;a class="link" href="@ref" &gt;5,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘æ§ç³»ç»Ÿé›†æˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus + Grafanaï¼š
&lt;ul&gt;
&lt;li&gt;ä»£ç ä¸­è°ƒç”¨&lt;code&gt;Counter.Inc()&lt;/code&gt;æ‰“ç‚¹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;PromQLæŸ¥è¯¢ï¼š&lt;code&gt;rate(api_requests_total[1s])&lt;/code&gt;&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šåŠ¨æ€å¯è§†åŒ–ã€å‘Šè­¦è”åŠ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-åˆ†å¸ƒå¼ç³»ç»Ÿæµ‹é‡"&gt;âš™ï¸ &lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿæµ‹é‡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é›†ç¾¤QPSè®¡ç®—ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;\text{é›†ç¾¤QPS} = \sum(\text{å•å®ä¾‹QPS}) \times \text{è´Ÿè½½å‡è¡¡æ•ˆç‡ç³»æ•°ï¼ˆé€šå¸¸0.8~0.95ï¼‰}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;æ³¨æ„äº‹é¡¹ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€èšåˆæ‰€æœ‰èŠ‚ç‚¹æ—¥å¿—ï¼ˆå¦‚ELK Stackï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ’é™¤å¥åº·æ£€æŸ¥ç­‰éä¸šåŠ¡è¯·æ±‚&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æµ‹é‡å®è·µå»ºè®®"&gt;ğŸ§ª &lt;strong&gt;æµ‹é‡å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°é…ç½®åŸåˆ™&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æµ‹è¯•æ—¶é•¿â‰¥5åˆ†é’Ÿï¼Œé¿å…ç¬æ—¶æ³¢åŠ¨&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å¹¶å‘çº¿ç¨‹æ•°é€æ­¥å¢åŠ ï¼Œè§‚å¯Ÿååé‡æ‹ç‚¹ï¼ˆå“åº”æ—¶é—´é™¡å¢æ—¶åœæ­¢ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹QPSèŒƒå›´å‚è€ƒ&lt;/strong&gt;ï¼š
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æœåŠ¡ç±»å‹&lt;/th&gt;
&lt;th&gt;å•å®ä¾‹QPSèŒƒå›´&lt;/th&gt;
&lt;th&gt;ä¼˜åŒ–æ–¹å‘&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®åº“è¯»å†™ï¼ˆMySQLï¼‰&lt;/td&gt;
&lt;td&gt;100~5,000&lt;/td&gt;
&lt;td&gt;ç¼“å­˜/åˆ†åº“åˆ†è¡¨&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å†…å­˜è®¡ç®—ï¼ˆRedisï¼‰&lt;/td&gt;
&lt;td&gt;10,000~100,000&lt;/td&gt;
&lt;td&gt;æ— é”ç»“æ„&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;APIç½‘å…³ï¼ˆNginxï¼‰&lt;/td&gt;
&lt;td&gt;100,000+&lt;/td&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯¯å·®å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å‹åŠ›æµ‹è¯•ç»“æœé€šå¸¸æ¯”ç†è®ºå€¼ä½20%~30%ï¼ˆå› GCã€çº¿ç¨‹åˆ‡æ¢ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹æ¯”å¤šå·¥å…·ç»“æœï¼ˆå¦‚JMeter vs. wrkï¼‰äº¤å‰éªŒè¯&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€ŸéªŒè¯&lt;/strong&gt;ï¼šç”¨&lt;code&gt;wrk/ab&lt;/code&gt;å‹æµ‹ï¼Œç›´æ¥è·å–&lt;code&gt;Requests/sec&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•¿æœŸç›‘æ§&lt;/strong&gt;ï¼šé›†æˆPrometheusï¼Œå®æ—¶åˆ†æ&lt;code&gt;rate()&lt;/code&gt;æ›²çº¿ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜ç²¾åº¦è¦æ±‚&lt;/strong&gt;ï¼šå®ç°æ»‘åŠ¨çª—å£ç®—æ³•ï¼ˆ200msåˆ†æ¡¶ï¼‰æˆ–ä½¿ç”¨Sentinelç­‰ç»„ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ æç¤ºï¼šæµ‹é‡æ—¶éœ€æ˜ç¡®åœºæ™¯ï¼ˆå•æœº/é›†ç¾¤ï¼‰ã€æ—¶é—´ç²’åº¦ï¼ˆç§’çº§/åˆ†é’Ÿçº§ï¼‰ï¼Œå¹¶æ’é™¤éä¸šåŠ¡æµé‡ã€‚å®é™…QPSå—æ•°æ®åº“ã€ç½‘ç»œã€ä»£ç é€»è¾‘å½±å“ï¼Œéœ€ç»“åˆç“¶é¢ˆåˆ†æä¼˜åŒ–&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="jmeter"&gt;JMeter
&lt;/h2&gt;&lt;p&gt;JMeter æ˜¯ç”± Apache è½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„å¼€æºæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œä¸»è¦ç”¨äºå¯¹ Web åº”ç”¨ã€APIã€æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ç³»ç»Ÿè¿›è¡Œå‹åŠ›æµ‹è¯•ã€è´Ÿè½½æµ‹è¯•å’ŒåŠŸèƒ½æµ‹è¯•ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒåŠŸèƒ½ã€æ¶æ„ã€ä½¿ç”¨æµç¨‹ã€é«˜çº§ç‰¹æ€§åŠæœ€ä½³å®è·µç­‰æ–¹é¢è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¤šåè®®æ”¯æŒ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Web/API&lt;/strong&gt;ï¼šHTTP/HTTPSï¼ˆRESTã€SOAPã€GraphQLï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“&lt;/strong&gt;ï¼šJDBCï¼ˆMySQLã€Oracle ç­‰ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯ä¸­é—´ä»¶&lt;/strong&gt;ï¼šJMSã€Kafkaã€MQTT&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¶ä»–&lt;/strong&gt;ï¼šFTPã€TCPã€SMTPã€LDAP ç­‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘æ¨¡æ‹Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹ç»„ï¼ˆThread Groupï¼‰ï¼šå®šä¹‰è™šæ‹Ÿç”¨æˆ·æ•°ï¼ˆçº¿ç¨‹æ•°ï¼‰ã€å¯åŠ¨æ—¶é—´ï¼ˆRamp-Upï¼‰ã€å¾ªç¯æ¬¡æ•°
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;ç¤ºä¾‹&lt;/em&gt;ï¼š100 çº¿ç¨‹ + 10 ç§’ Ramp-Up = æ¯ç§’å¯åŠ¨ 10 ä¸ªç”¨æˆ·&lt;a class="link" href="@ref" &gt;6,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼æµ‹è¯•&lt;/strong&gt;ï¼šé€šè¿‡ Master-Slave æ¶æ„è”åˆå¤šå°æœºå™¨çªç ´å•æœºå¹¶å‘é™åˆ¶&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•å…ƒä»¶ä¸°å¯Œ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å–æ ·å™¨ï¼ˆSamplerï¼‰&lt;/strong&gt;ï¼šå‘é€è¯·æ±‚ï¼ˆå¦‚ HTTP Requestï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘å¬å™¨ï¼ˆListenerï¼‰&lt;/strong&gt;ï¼šæ”¶é›†ç»“æœï¼ˆèšåˆæŠ¥å‘Šã€å“åº”æ—¶é—´å›¾ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘æ§åˆ¶å™¨&lt;/strong&gt;ï¼šå¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ï¼ˆå¦‚ If Controllerï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–­è¨€ï¼ˆAssertionï¼‰&lt;/strong&gt;ï¼šéªŒè¯å“åº”ï¼ˆçŠ¶æ€ç ã€JSON å­—æ®µï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ•°æ®å¤„ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°åŒ–&lt;/strong&gt;ï¼šCSV æ–‡ä»¶ã€éšæœºå˜é‡ç”Ÿæˆæµ‹è¯•æ•°æ®&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³è”ï¼ˆCorrelationï¼‰&lt;/strong&gt;ï¼šæ­£åˆ™è¡¨è¾¾å¼/JSON æå–å™¨ä»å“åº”ä¸­æå–åŠ¨æ€å€¼ï¼ˆå¦‚ Tokenï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶æ„ä¸æ ¸å¿ƒç»„ä»¶"&gt;ğŸ§± &lt;strong&gt;æ¶æ„ä¸æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¸¸ç”¨ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æµ‹è¯•è®¡åˆ’ï¼ˆTest Planï¼‰&lt;/td&gt;
&lt;td&gt;é¡¶å±‚å®¹å™¨ï¼Œç®¡ç†æ‰€æœ‰æµ‹è¯•å…ƒä»¶&lt;/td&gt;
&lt;td&gt;å…¨å±€å˜é‡é…ç½®&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;çº¿ç¨‹ç»„ï¼ˆThread Groupï¼‰&lt;/td&gt;
&lt;td&gt;å®šä¹‰å¹¶å‘ç”¨æˆ·è¡Œä¸º&lt;/td&gt;
&lt;td&gt;æ™®é€šçº¿ç¨‹ç»„ã€setUp/tearDown çº¿ç¨‹ç»„ï¼ˆé¢„/åå¤„ç†ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å–æ ·å™¨ï¼ˆSamplerï¼‰&lt;/td&gt;
&lt;td&gt;å‘é€åè®®è¯·æ±‚&lt;/td&gt;
&lt;td&gt;HTTPè¯·æ±‚ã€JDBCè¯·æ±‚ã€SOAPè¯·æ±‚&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç›‘å¬å™¨ï¼ˆListenerï¼‰&lt;/td&gt;
&lt;td&gt;ç»“æœå¯è§†åŒ–&lt;/td&gt;
&lt;td&gt;èšåˆæŠ¥å‘Šï¼ˆThroughputã€RTï¼‰ã€ç»“æœæ ‘ï¼ˆè¯·æ±‚è¯¦æƒ…ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®šæ—¶å™¨ï¼ˆTimerï¼‰&lt;/td&gt;
&lt;td&gt;æ§åˆ¶è¯·æ±‚é—´éš”&lt;/td&gt;
&lt;td&gt;å›ºå®šå®šæ—¶å™¨ã€åŒæ­¥å®šæ—¶å™¨ï¼ˆæ¨¡æ‹Ÿç¬æ—¶å¹¶å‘ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å‰ç½®/åç½®å¤„ç†å™¨&lt;/td&gt;
&lt;td&gt;è¯·æ±‚å‰åæ‰§è¡Œé€»è¾‘&lt;/td&gt;
&lt;td&gt;JSONæå–å™¨ã€BeanShellè„šæœ¬ï¼ˆåŠ¨æ€åŠ å¯†ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å®‰è£…ä¸é…ç½®"&gt;ğŸ› ï¸ &lt;strong&gt;å®‰è£…ä¸é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ç¯å¢ƒè¦æ±‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Java 8+ ç¯å¢ƒï¼Œå®˜ç½‘ä¸‹è½½è§£å‹å³ç”¨ï¼ˆæ— éœ€å®‰è£…ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;è¯­è¨€è®¾ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹ &lt;code&gt;bin/jmeter.properties&lt;/code&gt;ï¼š&lt;code&gt;language=zh_CN&lt;/code&gt; åˆ‡æ¢ä¸­æ–‡&lt;a class="link" href="@ref" &gt;7,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;å¯åŠ¨æ–¹å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;GUIæ¨¡å¼&lt;/strong&gt;ï¼šè°ƒè¯•è„šæœ¬ï¼ˆåŒå‡» &lt;code&gt;jmeter.bat&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;å‘½ä»¤è¡Œæ¨¡å¼ï¼šæ­£å¼å‹æµ‹ï¼ˆèµ„æºæ¶ˆè€—ä½ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;jmeter -n -t test.jmx -l result.jtl -e -o ./report
```[2,7](@ref)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æµ‹è¯•è®¾è®¡ä¸æ‰§è¡Œæµç¨‹"&gt;ğŸ“Š &lt;strong&gt;æµ‹è¯•è®¾è®¡ä¸æ‰§è¡Œæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åˆ›å»ºæµ‹è¯•è®¡åˆ’&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å³é”®æµ‹è¯•è®¡åˆ’ â†’ æ·»åŠ çº¿ç¨‹ç»„ â†’ è®¾ç½®çº¿ç¨‹æ•°ã€Ramp-Upã€å¾ªç¯æ¬¡æ•°&lt;a class="link" href="@ref" &gt;9,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;æ·»åŠ è¯·æ±‚ä¸é…ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹ç»„ä¸‹æ·»åŠ  &lt;strong&gt;HTTP è¯·æ±‚&lt;/strong&gt;ï¼šé…ç½® URLã€æ–¹æ³•ï¼ˆGET/POSTï¼‰ã€å‚æ•°/æ¶ˆæ¯ä½“&lt;a class="link" href="@ref" &gt;9,10&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;HTTP Cookie ç®¡ç†å™¨&lt;/strong&gt; å¤„ç†ä¼šè¯ï¼ˆå¦‚ç™»å½•æ€ï¼‰&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ç»“æœç›‘å¬ä¸æ–­è¨€&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ  &lt;strong&gt;èšåˆæŠ¥å‘Š&lt;/strong&gt;ï¼šæŸ¥çœ‹ååé‡ï¼ˆThroughput=QPSï¼‰ã€å¹³å‡å“åº”æ—¶é—´ã€é”™è¯¯ç‡&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;æ·»åŠ  &lt;strong&gt;å“åº”æ–­è¨€&lt;/strong&gt;ï¼šéªŒè¯çŠ¶æ€ç æ˜¯å¦ä¸º 200&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;è¿è¡Œä¸åˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å‘½ä»¤è¡Œå¯åŠ¨æµ‹è¯•ï¼Œç”Ÿæˆ HTML æŠ¥å‘Šï¼ˆåŒ…å«å“åº”æ—¶é—´åˆ†å¸ƒã€TPS è¶‹åŠ¿ï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§åŠŸèƒ½"&gt;ğŸš€ &lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åˆ†å¸ƒå¼æµ‹è¯•&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é…ç½®æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸»æ§æœºï¼ˆMasterï¼‰ä¿®æ”¹ &lt;code&gt;jmeter.properties&lt;/code&gt; æ·»åŠ  Slave IP&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Slave æœºå¯åŠ¨ &lt;code&gt;jmeter-server&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Master é€‰æ‹© &amp;ldquo;Remote Start&amp;rdquo; è§¦å‘å¤šæœºå‹æµ‹&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;è„šæœ¬æ‰©å±•&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;BeanShell/Groovyï¼šåŠ¨æ€ç”Ÿæˆå‚æ•°ï¼ˆå¦‚æ—¶é—´æˆ³ç”¨æˆ·åï¼‰&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;vars.put(&amp;#34;username&amp;#34;, &amp;#34;user_&amp;#34; + System.currentTimeMillis());
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;CI/CD é›†æˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Jenkins æµæ°´çº¿ï¼šè‡ªåŠ¨åŒ–æ‰§è¡Œæ€§èƒ½æµ‹è¯•&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;jmeter(testPlan: &amp;#39;test.jmx&amp;#39;, generateReports: true)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¼˜ç¼ºç‚¹ä¸é€‚ç”¨åœºæ™¯"&gt;âš ï¸ &lt;strong&gt;ä¼˜ç¼ºç‚¹ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… å¼€æºå…è´¹ã€è·¨å¹³å°ã€å¤šåè®®æ”¯æŒã€æ’ä»¶ç”Ÿæ€ä¸°å¯Œï¼ˆå¦‚ WebSocketï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ GUI æ¨¡å¼èµ„æºæ¶ˆè€—å¤§ã€å­¦ä¹ æ›²çº¿é™¡å³­ã€å®æ—¶ç›‘æ§å¼±ï¼ˆéœ€æ•´åˆ Prometheusï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;- Web é«˜å¹¶å‘æµ‹è¯•ï¼ˆç”µå•†ç§’æ€ï¼‰ - API ååé‡æµ‹é‡ - æ•°æ®åº“æŸ¥è¯¢å‹æµ‹ï¼ˆJDBCï¼‰ - æŒç»­é›†æˆå›å½’æµ‹è¯•&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µ"&gt;ğŸ’ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;é¿å… GUI å‹æµ‹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å‘½ä»¤è¡Œæ‰§è¡Œå‡å°‘èµ„æºå ç”¨ï¼Œæå‡å‹æµ‹ç²¾åº¦&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;å‚æ•°åŒ–ä¸å…³è”&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ CSV æ–‡ä»¶åˆ†ç¦»æµ‹è¯•æ•°æ®ï¼Œæ­£åˆ™è¡¨è¾¾å¼æå–åŠ¨æ€ Token&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ç»“æœåˆ†æä¼˜åŒ–&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ååé‡ç“¶é¢ˆ&lt;/strong&gt;ï¼šè‹¥ Throughput ä¸éšçº¿ç¨‹æ•°å¢é•¿ï¼Œéœ€æ£€æŸ¥æ•°æ®åº“/ä»£ç æ€§èƒ½&lt;a class="link" href="@ref" &gt;6,9&lt;/a&gt;ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é”™è¯¯ç‡é˜ˆå€¼&lt;/strong&gt;ï¼š&amp;gt;1% éœ€å®šä½åŸå› ï¼ˆå¦‚è¶…æ—¶ã€èµ„æºä¸è¶³ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;JMeter æ˜¯ä¼ä¸šçº§æ€§èƒ½æµ‹è¯•çš„æ ¸å¿ƒå·¥å…·ï¼Œå°¤å…¶é€‚åˆ&lt;strong&gt;å¤æ‚åœºæ™¯æ¨¡æ‹Ÿ&lt;/strong&gt;ï¼ˆå¦‚åˆ†å¸ƒå¼å‹æµ‹ã€åŠ¨æ€å‚æ•°åŒ–ï¼‰å’Œ&lt;strong&gt;å¤šåè®®è¦†ç›–&lt;/strong&gt;éœ€æ±‚ã€‚å¯¹äºè½»é‡çº§ API æµ‹è¯•å¯é€‰ç”¨ Locust/Gatlingï¼›è‹¥è¿½æ±‚ä¼ä¸šçº§æ”¯æŒï¼ŒLoadRunner æ˜¯æ›¿ä»£æ–¹æ¡ˆ&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚
â€‹&lt;strong&gt;å­¦ä¹ å»ºè®®&lt;/strong&gt;â€‹ï¼šä»åŸºç¡€çº¿ç¨‹ç»„+HTTPè¯·æ±‚å…¥æ‰‹ï¼Œé€æ­¥è¿›é˜¶å‚æ•°åŒ–ã€åˆ†å¸ƒå¼å’ŒCIé›†æˆï¼Œç»“åˆèšåˆæŠ¥å‘Šä¸HTMLå¯è§†åŒ–ç²¾å‡†å®šä½æ€§èƒ½ç“¶é¢ˆã€‚&lt;/p&gt;
&lt;h2 id="sentinel"&gt;Sentinel
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼ŒSentinel &lt;strong&gt;å®Œå…¨å…·å¤‡æµ‹é‡QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰çš„èƒ½åŠ›&lt;/strong&gt;ï¼Œå¹¶ä¸”è¿™æ˜¯å…¶æµé‡æ§åˆ¶çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯Sentinelå®ç°QPSæµ‹é‡çš„åŸç†ã€æ–¹å¼å’Œåº”ç”¨åœºæ™¯çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-qpsæµ‹é‡åŸç†æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•"&gt;âš™ï¸ &lt;strong&gt;QPSæµ‹é‡åŸç†ï¼šæ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Sentinel é€šè¿‡&lt;strong&gt;æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•&lt;/strong&gt;ç²¾ç¡®ç»Ÿè®¡å•ä½æ—¶é—´å†…çš„è¯·æ±‚é‡ï¼Œå…¶æ ¸å¿ƒè®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ—¶é—´çª—å£åˆ’åˆ†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ˆå¦‚é•¿åº¦ä¸º2ï¼‰è¡¨ç¤ºæ—¶é—´çª—å£ï¼Œæ¯ä¸ªçª—å£ç§°ä¸ºä¸€ä¸ªâ€œæ¡¶â€ï¼ˆBucketï¼‰ï¼Œæ¯ä¸ªæ¡¶è®°å½•å›ºå®šæ—¶é•¿ï¼ˆå¦‚500msï¼‰å†…çš„è¯·æ±‚æ•°æ®&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šç»Ÿè®¡1ç§’å†…çš„QPSæ—¶ï¼Œçª—å£åŒ…å«ä¸¤ä¸ª500msçš„æ¡¶ï¼Œé€šè¿‡æ»šåŠ¨è¦†ç›–å®ç°ç§’çº§ç»Ÿè®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡ç»´åº¦&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¯«ç§’çº§çª—å£&lt;/strong&gt;ï¼šç”¨äºå®æ—¶é™æµåˆ¤æ–­ï¼ˆå¦‚å¿«é€Ÿå¤±è´¥è§„åˆ™ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§’çº§/åˆ†é’Ÿçº§çª—å£&lt;/strong&gt;ï¼šç”¨äºç›‘æ§æ—¥å¿—å’Œä»ªè¡¨ç›˜å±•ç¤ºï¼Œä¾‹å¦‚æ¯åˆ†é’Ÿ60ä¸ª1ç§’çª—å£&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è®°å½•&lt;/strong&gt;
æ¯ä¸ªBucketå­˜å‚¨ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;passQps&lt;/code&gt;ï¼šé€šè¿‡çš„è¯·æ±‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;blockQps&lt;/code&gt;ï¼šè¢«é™æµçš„è¯·æ±‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;successQps&lt;/code&gt;ï¼šæˆåŠŸå®Œæˆçš„è¯·æ±‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rt&lt;/code&gt;ï¼ˆResponse Timeï¼‰ï¼šè¯·æ±‚å“åº”æ—¶é—´&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å¦‚ä½•è·å–qpsæ•°æ®"&gt;ğŸ“Š &lt;strong&gt;å¦‚ä½•è·å–QPSæ•°æ®ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ§åˆ¶å°å®æ—¶ç›‘æ§&lt;/strong&gt;
Sentinel Dashboard ç›´æ¥å±•ç¤ºæ¯ä¸ªèµ„æºçš„å®æ—¶QPSã€é˜»å¡QPSã€å¼‚å¸¸ç‡ç­‰æ•°æ®ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—æ–‡ä»¶è¾“å‡º&lt;/strong&gt;
Sentinel ä¼šç”Ÿæˆç§’çº§ç›‘æ§æ—¥å¿—ï¼ˆè·¯å¾„ï¼š&lt;code&gt;${user_home}/logs/csp/${app_name}-${pid}-metrics.log&lt;/code&gt;ï¼‰ï¼Œæ ¼å¼ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;æ—¶é—´æˆ³|æ ¼å¼åŒ–æ—¶é—´|èµ„æºå|passQps|blockQps|successQps|å¼‚å¸¸æ•°|å¹³å‡RT
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¾‹å¦‚ï¼š&lt;code&gt;1568253804000|2019-09-12 10:03:24|orderService|15|2|15|0|5&lt;/code&gt; è¡¨ç¤ºè¯¥ç§’å†…é€šè¿‡15æ¬¡è¯·æ±‚ï¼Œé˜»å¡2æ¬¡&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;APIæ¥å£æŸ¥è¯¢&lt;/strong&gt;
é€šè¿‡ &lt;code&gt;ClusterNode&lt;/code&gt; å¯¹è±¡å¯ç¼–ç¨‹è·å–QPSï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ClusterNode node = ClusterBuilderSlot.getClusterNode(&amp;#34;èµ„æºå&amp;#34;);
long passQps = node.passQps(); // å½“å‰ç§’é€šè¿‡QPS
long blockQps = node.blockQps(); // å½“å‰ç§’é™æµQPS
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;QPSç»Ÿè®¡è¯¯å·®é—®é¢˜&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè‹¥è¯·æ±‚è·¨è¶Šä¸¤ä¸ªæ—¶é—´çª—å£ï¼ˆå¦‚1ç§’æœ«å°¾çš„è¯·æ±‚å»¶è¿Ÿåˆ°ä¸‹ä¸€ç§’ç»Ÿè®¡ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ—¥å¿—ä¸­QPSæœªè¾¾é˜ˆå€¼å´è¢«é™æµ&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼šç¡®ä¿ç»Ÿè®¡çª—å£å¯¹é½ï¼ˆå¦‚ä½¿ç”¨ç›¸åŒæ—¶é—´æˆ³åŒæ­¥å¤šç»´ç»Ÿè®¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æŸè€—&lt;/strong&gt;
Sentinel çš„QPSç»Ÿè®¡å¯¹æ€§èƒ½å½±å“æå°ï¼Œå•æœºQPSä½äº25ä¸‡æ—¶æŸè€—å¯å¿½ç•¥ï¼ˆçº¦5%~10%å½±å“å‡ºç°åœ¨è¶…é«˜å¹¶å‘åœºæ™¯ï¼‰&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•åº”ç”¨åŸºäºqpsçš„æµé‡æ§åˆ¶"&gt;ğŸ› ï¸ &lt;strong&gt;æ‰©å±•åº”ç”¨ï¼šåŸºäºQPSçš„æµé‡æ§åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Sentinel ä¸ä»…æµ‹é‡QPSï¼Œè¿˜èƒ½åŸºäºQPSå®æ–½åŠ¨æ€æ§åˆ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµé‡æ§åˆ¶è§„åˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®¾ç½®QPSé˜ˆå€¼ï¼ˆå¦‚20/sï¼‰ï¼Œè¶…å‡ºæ—¶è§¦å‘é™æµï¼ˆå¿«é€Ÿå¤±è´¥ã€é¢„çƒ­ã€æ’é˜Ÿï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¤ºä¾‹è§„åˆ™é…ç½®ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;FlowRule rule = new FlowRule(&amp;#34;orderService&amp;#34;);
rule.setCount(20); // QPSé˜ˆå€¼=20
rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç†”æ–­é™çº§&lt;/strong&gt;
å½“QPSæ¿€å¢å¯¼è‡´æ…¢è°ƒç”¨æ¯”ä¾‹æˆ–å¼‚å¸¸ç‡è¶…æ ‡æ—¶ï¼Œè‡ªåŠ¨ç†”æ–­æœåŠ¡&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµ‹é‡èƒ½åŠ›&lt;/strong&gt;ï¼šSentinel é€šè¿‡æ»‘åŠ¨çª—å£ç²¾ç¡®ç»Ÿè®¡QPSï¼Œæ”¯æŒå®æ—¶ç›‘æ§ã€æ—¥å¿—è¾“å‡ºå’ŒAPIæŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä»·å€¼&lt;/strong&gt;ï¼šä¸ä»…æ˜¯æµ‹é‡å·¥å…·ï¼Œæ›´æ˜¯åŸºäºQPSå®ç°æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§çš„æ²»ç†æ¡†æ¶&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¾®æœåŠ¡æ¥å£é™æµã€ç½‘å…³å±‚æµé‡æ•´å½¢ï¼ˆå¦‚Nginx+Sentinel Sidecarï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€å‹æµ‹æ€§èƒ½åˆ†æ&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚éœ€æ·±åº¦é›†æˆï¼Œå»ºè®®ç»“åˆæ§åˆ¶å°å’Œæ—¥å¿—åˆ†æï¼Œå¹¶æ³¨æ„é«˜å¹¶å‘ä¸‹çš„çª—å£åŒæ­¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="å‹åŠ›æµ‹è¯•"&gt;å‹åŠ›æµ‹è¯•
&lt;/h2&gt;&lt;p&gt;Sentinel å’Œ JMeter çš„æ ¸å¿ƒå®šä½å­˜åœ¨æœ¬è´¨å·®å¼‚ï¼š&lt;strong&gt;Sentinel æ— æ³•ç›´æ¥æ›¿ä»£ JMeter è¿›è¡Œæµé‡æ¨¡æ‹Ÿå’Œå‹åŠ›æµ‹è¯•&lt;/strong&gt;ï¼Œä½†å®ƒèƒ½é€šè¿‡ä¸å‹æµ‹å·¥å…·ç»“åˆï¼Œåœ¨å‹åŠ›æµ‹è¯•ä¸­å®ç°ç²¾å‡†çš„æµé‡æ²»ç†ä¸ç›‘æ§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒèƒ½åŠ›å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;èƒ½åŠ›ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Sentinel&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;JMeter&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æµé‡ç”Ÿæˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ æ— æ³•ä¸»åŠ¨æ¨¡æ‹Ÿè¯·æ±‚&lt;/td&gt;
&lt;td&gt;âœ… é€šè¿‡çº¿ç¨‹ç»„ã€å®šæ—¶å™¨ç­‰æ¨¡æ‹Ÿé«˜å¹¶å‘æµé‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;QPSå‹åŠ›æµ‹è¯•&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…è¢«åŠ¨ç»Ÿè®¡å®æ—¶QPSï¼Œä¸ç”Ÿæˆå‹åŠ›&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ç²¾ç¡®æ§åˆ¶å¹¶å‘é‡ã€æŒç»­æ—¶é—´ç­‰&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é™æµç†”æ–­æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¦‚QPSé˜ˆå€¼ã€ç†”æ–­ç­–ç•¥ï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âŒ éœ€ä¾èµ–å¤–éƒ¨ç»„ä»¶ï¼ˆå¦‚é›†æˆSentinelï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç›‘æ§åˆ†æ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… å®æ—¶å±•ç¤ºQPSã€é˜»å¡é‡ã€å¼‚å¸¸ç‡ç­‰&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;âœ… é€šè¿‡ç›‘å¬å™¨æ”¶é›†ååé‡ã€å“åº”æ—¶é—´ç­‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JMeter&lt;/strong&gt; æ˜¯ä¸“ä¸šçš„&lt;strong&gt;å‹åŠ›æµ‹è¯•å·¥å…·&lt;/strong&gt;ï¼Œç”¨äºæ¨¡æ‹Ÿæµé‡ã€åˆ¶é€ ç³»ç»Ÿå‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sentinel&lt;/strong&gt; æ˜¯&lt;strong&gt;æµé‡æ²»ç†ç»„ä»¶&lt;/strong&gt;ï¼Œç”¨äºåœ¨çœŸå®æµé‡æˆ–æµ‹è¯•æµé‡ä¸­å®æ–½é˜²æŠ¤ç­–ç•¥ï¼ˆå¦‚é™æµç†”æ–­ï¼‰ï¼Œå¹¶ç›‘æ§ç³»ç»Ÿè¡¨ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-sentinelåœ¨å‹åŠ›æµ‹è¯•ä¸­çš„è¾…åŠ©ä»·å€¼"&gt;ğŸ”§ &lt;strong&gt;Sentinelåœ¨å‹åŠ›æµ‹è¯•ä¸­çš„è¾…åŠ©ä»·å€¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶æ— æ³•ä¸»åŠ¨ç”Ÿæˆæµé‡ï¼Œä½†Sentinelåœ¨å‹åŠ›æµ‹è¯•ä¸­æ‰®æ¼”å…³é”®è§’è‰²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶QPSç›‘æ§ä¸éªŒè¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨JMeterå‹æµ‹è¿‡ç¨‹ä¸­ï¼ŒSentinelå¯å®æ—¶ç»Ÿè®¡æ¥å£çš„&lt;strong&gt;å®é™…QPS&lt;/strong&gt;ã€&lt;strong&gt;è¢«é™æµè¯·æ±‚æ•°&lt;/strong&gt;ã€&lt;strong&gt;ç†”æ–­çŠ¶æ€&lt;/strong&gt;ç­‰ï¼Œå¸®åŠ©éªŒè¯ç³»ç»Ÿæ˜¯å¦è¾¾åˆ°é¢„æœŸååé‡&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹ &lt;code&gt;orderService&lt;/code&gt; çš„QPSæ˜¯å¦ç¨³å®šåœ¨é¢„è®¾é˜ˆå€¼ï¼ˆå¦‚1000/sï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è§„åˆ™è§¦å‘æµ‹è¯•&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆJMeterçš„é«˜å¹¶å‘è¯·æ±‚ï¼Œæµ‹è¯•Sentinelçš„&lt;strong&gt;é™æµè§„åˆ™&lt;/strong&gt;ï¼ˆå¦‚QPSé˜ˆå€¼ï¼‰å’Œ&lt;strong&gt;ç†”æ–­ç­–ç•¥&lt;/strong&gt;ï¼ˆå¦‚æ…¢è°ƒç”¨æ¯”ä¾‹ï¼‰æ˜¯å¦æŒ‰é¢„æœŸç”Ÿæ•ˆ&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šå½“JMeterå‘é€2000 QPSæ—¶ï¼Œè§‚å¯ŸSentinelæ˜¯å¦æ‹¦æˆªè¶…é˜ˆå€¼çš„è¯·æ±‚ï¼ˆè¿”å›429çŠ¶æ€ç ï¼‰&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿä¿æŠ¤ç­–ç•¥éªŒè¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡å‹æµ‹è§¦å‘Sentinelçš„&lt;strong&gt;ç³»ç»Ÿè‡ªé€‚åº”è§„åˆ™&lt;/strong&gt;ï¼ˆå¦‚CPU &amp;gt;80%æ—¶è‡ªåŠ¨é™æµï¼‰ï¼ŒéªŒè¯ç³»ç»Ÿåœ¨èµ„æºç“¶é¢ˆä¸‹çš„è‡ªæˆ‘ä¿æŠ¤èƒ½åŠ›&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è”åˆä½¿ç”¨æ–¹æ¡ˆjmeter--sentinel"&gt;ğŸ› ï¸ &lt;strong&gt;è”åˆä½¿ç”¨æ–¹æ¡ˆï¼šJMeter + Sentinel&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€å®ç°â€œæ¨¡æ‹Ÿæµé‡ + ç²¾å‡†é˜²æŠ¤â€çš„å®Œæ•´æµ‹è¯•æµç¨‹ï¼Œå¯ç»„åˆä½¿ç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JMeteræ¨¡æ‹Ÿæµé‡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é…ç½®çº¿ç¨‹ç»„ã€HTTPè¯·æ±‚é‡‡æ ·å™¨ï¼Œæ¨¡æ‹Ÿç›®æ ‡QPSï¼ˆå¦‚5000è¯·æ±‚/ç§’ï¼‰&lt;a class="link" href="@ref" &gt;7,9&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨å‘½ä»¤è¡Œæ¨¡å¼æ‰§è¡Œå‹æµ‹ï¼Œé¿å…GUIèµ„æºæ¶ˆè€—ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;jmeter -n -t test.jmx -l result.jtl -e -o ./report
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Sentinelç›‘æ§ä¸æ‹¦æˆª&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åº”ç”¨ä¸­é›†æˆSentinelï¼Œä¸ºæ¥å£é…ç½®è§„åˆ™ï¼ˆå¦‚QPSâ‰¤1000ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ§åˆ¶å°å®æ—¶è§‚å¯Ÿï¼š
&lt;ul&gt;
&lt;li&gt;å®é™…QPS vs é™æµé˜ˆå€¼ï¼›&lt;/li&gt;
&lt;li&gt;è¢«æ‹’ç»è¯·æ±‚çš„æ¯”ä¾‹ï¼›&lt;/li&gt;
&lt;li&gt;ç†”æ–­å™¨çŠ¶æ€ï¼ˆOPEN/HALF_OPEN/CLOSEDï¼‰&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœç»¼åˆåˆ†æ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹æ¯”JMeterçš„èšåˆæŠ¥å‘Šï¼ˆååé‡ã€é”™è¯¯ç‡ï¼‰ä¸Sentinelçš„ç›‘æ§æ—¥å¿—ï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥JMeteræ˜¾ç¤ºé«˜é”™è¯¯ç‡ï¼Œè€ŒSentinelæ˜¾ç¤ºé™æµè§¦å‘ â†’ éœ€è°ƒæ•´QPSé˜ˆå€¼ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥Sentinelè§¦å‘ç†”æ–­ä½†JMeteræœªæŠ¥é”™ â†’ æ£€æŸ¥ç†”æ–­ç­–ç•¥æ˜¯å¦è¿‡æ•æ„Ÿ&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Sentinelçš„è¢«åŠ¨æ€§&lt;/strong&gt;
Sentinel çš„ç»Ÿè®¡ä¾èµ–äºçœŸå®æµé‡ï¼Œè‹¥éœ€æµ‹è¯•å†·å¯åŠ¨åœºæ™¯ï¼ˆå¦‚ç³»ç»Ÿç©ºè½½æ—¶çªå‘æµé‡ï¼‰ï¼Œä»éœ€JMeterç­‰å·¥å…·æ¨¡æ‹Ÿ&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;
Sentinelçš„æ»‘åŠ¨çª—å£ç»Ÿè®¡ï¼ˆå¦‚500msåˆ†æ¡¶ï¼‰ä¼šå ç”¨å°‘é‡CPUï¼Œåœ¨è¶…é«˜æ€§èƒ½æµ‹è¯•ä¸­ï¼ˆå¦‚QPS&amp;gt;20ä¸‡ï¼‰éœ€è¯„ä¼°å½±å“&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ğŸš« ä¸èƒ½æ›¿ä»£&lt;/strong&gt;ï¼šSentinel æ— æ³•åƒ JMeter ä¸€æ ·ä¸»åŠ¨ç”Ÿæˆå‹åŠ›æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;âœ… å¿…é¡»é…åˆ&lt;/strong&gt;ï¼šåœ¨å‹åŠ›æµ‹è¯•ä¸­ï¼Œ&lt;strong&gt;ç”¨JMeteråˆ¶é€ å‹åŠ›&lt;/strong&gt;ï¼Œ&lt;strong&gt;ç”¨Sentinelå®æ–½é˜²æŠ¤å¹¶ç›‘æ§æ•ˆæœ&lt;/strong&gt;ï¼Œä¸¤è€…äº’è¡¥å¯éªŒè¯ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹çš„ç¨³å®šæ€§ä¸éŸ§æ€§&lt;a class="link" href="@ref" &gt;3,4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿›é˜¶åœºæ™¯&lt;/strong&gt;ï¼šå¯¹äºäº‘åŸç”Ÿæ¶æ„ï¼Œå¯ç»“åˆ &lt;strong&gt;Kubernetes + JMeteråˆ†å¸ƒå¼å‹æµ‹ + Sentinelé›†ç¾¤é™æµ&lt;/strong&gt;ï¼Œå®ç°å…¨é“¾è·¯å‹åŠ›æµ‹è¯•ä¸æ²»ç†éªŒè¯&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>ã€Postopiaã€‘timer</title><link>https://dyhes.github.io/p/postopiatimer/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiatimer/</guid><description>&lt;h2 id="å®šæ—¶ä»»åŠ¡"&gt;å®šæ—¶ä»»åŠ¡
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯Javaå®šæ—¶ä»»åŠ¡çš„å¸¸è§è§£å†³æ–¹æ¡ˆï¼Œç»“åˆä¸åŒåœºæ™¯å’Œéœ€æ±‚ä»åŸºç¡€åˆ°é«˜çº§è¿›è¡Œåˆ†ç±»è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-åŸºç¡€åŸç”Ÿæ–¹æ¡ˆ"&gt;â° åŸºç¡€åŸç”Ÿæ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Timer&lt;/code&gt; + &lt;code&gt;TimerTask&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šJDKè‡ªå¸¦ï¼Œç®€å•è½»é‡ï¼Œæ”¯æŒå»¶è¿Ÿ/å‘¨æœŸæ€§ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºé™·&lt;/strong&gt;ï¼šå•çº¿ç¨‹æ‰§è¡Œï¼Œä»»åŠ¡é˜»å¡æˆ–å¼‚å¸¸ä¼šå¯¼è‡´æ•´ä¸ªè°ƒåº¦ç»ˆæ­¢ï¼›ç³»ç»Ÿæ—¶é—´ä¿®æ”¹å½±å“è°ƒåº¦å‡†ç¡®æ€§&lt;a class="link" href="@ref" &gt;1,2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;Timer timer = new Timer();
timer.schedule(new TimerTask() {
@Override
public void run() {
System.out.println(&amp;#34;Task executed&amp;#34;);
}
}, 2000, 1000); // å»¶è¿Ÿ2ç§’ï¼Œé—´éš”1ç§’
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šåŸºäºçº¿ç¨‹æ± ï¼ˆæ”¯æŒå¤šä»»åŠ¡å¹¶å‘ï¼‰ï¼Œå¼‚å¸¸éš”ç¦»ï¼ˆå•ä»»åŠ¡å¤±è´¥ä¸å½±å“æ•´ä½“ï¼‰ï¼Œæä¾›&lt;code&gt;scheduleAtFixedRate&lt;/code&gt;ï¼ˆå›ºå®šé€Ÿç‡ï¼‰å’Œ&lt;code&gt;scheduleWithFixedDelay&lt;/code&gt;ï¼ˆå›ºå®šå»¶è¿Ÿï¼‰&lt;a class="link" href="@ref" &gt;1,7,9&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šç›¸æ¯”&lt;code&gt;Timer&lt;/code&gt;æ›´å¥å£®ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;ScheduledExecutorService executor = Executors.newScheduledThreadPool(2);
executor.scheduleAtFixedRate(() -&amp;gt; System.out.println(&amp;#34;Task&amp;#34;), 2, 3, TimeUnit.SECONDS);
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-springç”Ÿæ€æ–¹æ¡ˆ"&gt;ğŸ”„ Springç”Ÿæ€æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Scheduled&lt;/code&gt;æ³¨è§£&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šSpring 3.0+å†…ç½®ï¼Œæ— éœ€é¢å¤–ä¾èµ–ï¼Œæ”¯æŒCronè¡¨è¾¾å¼ã€å›ºå®šé€Ÿç‡ï¼ˆ&lt;code&gt;fixedRate&lt;/code&gt;ï¼‰ã€å›ºå®šå»¶è¿Ÿï¼ˆ&lt;code&gt;fixedDelay&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é…ç½®æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯åŠ¨ç±»åŠ &lt;code&gt;@EnableScheduling&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•åŠ &lt;code&gt;@Scheduled(cron = &amp;quot;0/5 * * * * ?&amp;quot;)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çº¿ç¨‹æ± ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public ThreadPoolTaskScheduler taskScheduler() {
ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler();
scheduler.setPoolSize(10); // é¿å…å•çº¿ç¨‹é˜»å¡
return scheduler;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ScheduledExecutorFactoryBean&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šSpringå¯¹&lt;code&gt;ScheduledThreadPoolExecutor&lt;/code&gt;çš„å°è£…ï¼Œæ”¯æŒXMLé…ç½®çº¿ç¨‹æ± å‚æ•°&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§è°ƒåº¦æ¡†æ¶"&gt;âš™ï¸ é«˜çº§è°ƒåº¦æ¡†æ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Quartz&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ”¯æŒåˆ†å¸ƒå¼è°ƒåº¦ã€ä»»åŠ¡æŒä¹…åŒ–ï¼ˆæ•°æ®åº“å­˜å‚¨ï¼‰ã€åŠ¨æ€é…ç½®ï¼ˆè¿è¡Œæ—¶ä¿®æ”¹è§¦å‘è§„åˆ™ï¼‰ã€é›†ç¾¤å®¹é”™&lt;a class="link" href="@ref" &gt;1,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒç»„ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Job&lt;/code&gt;ï¼šä»»åŠ¡æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Trigger&lt;/code&gt;ï¼šè§¦å‘ç­–ç•¥ï¼ˆå¦‚&lt;code&gt;CronTrigger&lt;/code&gt;ï¼‰ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Scheduler&lt;/code&gt;ï¼šè°ƒåº¦æ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜å¯é ã€å¤æ‚è°ƒåº¦ï¼ˆå¦‚è·¨èŠ‚ç‚¹ä»»åŠ¡åˆ†ç‰‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;XXL-JOB&lt;/strong&gt;ï¼šå¼€ç®±å³ç”¨çš„ç®¡ç†ç•Œé¢ã€ä»»åŠ¡åˆ†ç‰‡ã€å¤±è´¥å‘Šè­¦ï¼›ä¾èµ–MySQLï¼Œè½»é‡çº§&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Elastic-Job&lt;/strong&gt;ï¼šåŸºäºZooKeeperåè°ƒï¼Œå¼¹æ€§æ‰©å®¹ã€ä½œä¸šæ²»ç†ï¼›é€‚åˆæµ·é‡ä»»åŠ¡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆé€‰å‹å»ºè®®"&gt;ğŸ“Š æ–¹æ¡ˆé€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç†ç”±&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å•æœºç®€å•ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è½»é‡ã€çº¿ç¨‹å®‰å…¨ï¼Œé¿å…&lt;code&gt;Timer&lt;/code&gt;å•çº¿ç¨‹ç¼ºé™· &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Spring Booté¡¹ç›®&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Scheduled&lt;/code&gt; + çº¿ç¨‹æ± é…ç½®&lt;/td&gt;
&lt;td&gt;é›†æˆç®€ä¾¿ï¼ŒCronè¡¨è¾¾å¼çµæ´» &lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ†å¸ƒå¼ç¯å¢ƒ/é«˜å¯ç”¨&lt;/td&gt;
&lt;td&gt;Quartzæˆ–XXL-JOB&lt;/td&gt;
&lt;td&gt;æ”¯æŒä»»åŠ¡æŒä¹…åŒ–ã€é›†ç¾¤è°ƒåº¦ &lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç§’çº§ç²¾åº¦/æµ·é‡ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;æ—¶é—´è½®ç®—æ³•ï¼ˆNettyç­‰å®ç°ï¼‰&lt;/td&gt;
&lt;td&gt;æ—¶é—´å¤æ‚åº¦O(1)ï¼Œé«˜æ€§èƒ½ &lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é¿å‘æŒ‡å—"&gt;âš ï¸ é¿å‘æŒ‡å—
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹é˜»å¡&lt;/strong&gt;ï¼šé¿å…å•çº¿ç¨‹è°ƒåº¦ï¼ˆå¦‚&lt;code&gt;Timer&lt;/code&gt;ï¼‰ï¼Œä¼˜å…ˆç”¨çº¿ç¨‹æ± &lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cronè¯­æ³•&lt;/strong&gt;ï¼šæ³¨æ„&lt;code&gt;?&lt;/code&gt;ï¼ˆæ—¥/å‘¨äº’æ–¥ï¼‰å’Œ&lt;code&gt;L&lt;/code&gt;ï¼ˆæœ€åä¸€å¤©ï¼‰ç­‰ç‰¹æ®Šå­—ç¬¦&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼é‡å¤æ‰§è¡Œ&lt;/strong&gt;ï¼šé€šè¿‡Redisé”æˆ–æ¡†æ¶ï¼ˆXXL-JOBï¼‰åè°ƒèŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šä»»åŠ¡å†…æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢ä¸­æ–­è°ƒåº¦é“¾&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚
æ ¹æ®ä¸šåŠ¡è§„æ¨¡ã€å¯é æ€§è¦æ±‚åŠæŠ€æœ¯æ ˆé€‰æ‹©æ–¹æ¡ˆï¼Œè½»é‡ä»»åŠ¡ç”¨åŸç”Ÿæˆ–Springï¼Œå¤æ‚åˆ†å¸ƒå¼åœºæ™¯é€‰Quartzæˆ–ä¸“ç”¨æ¡†æ¶ï¼ˆå¦‚XXL-JOBï¼‰ä»¥æå‡å¯ç»´æŠ¤æ€§&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="scheduledexecutorservice"&gt;ScheduledExecutorService
&lt;/h2&gt;&lt;p&gt;åœ¨ä»…ä½¿ç”¨ &lt;code&gt;ScheduledExecutorService&lt;/code&gt; çš„å‰æä¸‹å®ç°é«˜å¯ç”¨ï¼ˆé¿å…èŠ‚ç‚¹å®•æœºå¯¼è‡´ä»»åŠ¡ä¸¢å¤±ï¼‰ï¼Œéœ€é€šè¿‡åº”ç”¨å±‚è®¾è®¡å¼¥è¡¥å…¶å•æœºå†…å­˜è°ƒåº¦çš„ç¼ºé™·ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒè§£å†³æ–¹æ¡ˆåŠå®ç°è¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–"&gt;ğŸ›¡ï¸ &lt;strong&gt;ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€è·¯&lt;/strong&gt;ï¼šå°†ä»»åŠ¡å®šä¹‰ä¸çŠ¶æ€å­˜å‚¨åˆ°å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚æ•°æ®åº“ã€Redisï¼‰ï¼ŒèŠ‚ç‚¹é‡å¯åé‡æ–°åŠ è½½ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡å®šä¹‰å­˜å‚¨&lt;/strong&gt;ï¼šåˆ›å»ºä»»åŠ¡æ³¨å†Œè¡¨ï¼ˆå¦‚MySQLè¡¨ï¼‰ï¼Œè®°å½•ä»»åŠ¡IDã€æ‰§è¡Œå‘¨æœŸã€ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ã€çŠ¶æ€ï¼ˆæœªå¼€å§‹/æ‰§è¡Œä¸­/å·²å®Œæˆï¼‰&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®•æœºæ¢å¤&lt;/strong&gt;ï¼šèŠ‚ç‚¹å¯åŠ¨æ—¶æ‰«ææ³¨å†Œè¡¨ï¼ŒåŠ è½½æœªå®Œæˆçš„å®šæ—¶ä»»åŠ¡åˆ° &lt;code&gt;ScheduledExecutorService&lt;/code&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;çŠ¶æ€æ›´æ–°ï¼š
&lt;ul&gt;
&lt;li&gt;ä»»åŠ¡å¼€å§‹å‰æ›´æ–°çŠ¶æ€ä¸ºâ€œæ‰§è¡Œä¸­â€ï¼Œå¹¶è®°å½•èŠ‚ç‚¹IPä¸æ—¶é—´æˆ³ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡å®Œæˆåæ›´æ–°ä¸ºâ€œå·²å®Œæˆâ€&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚
&lt;strong&gt;ç¤ºä¾‹ä»£ç ï¼ˆä»»åŠ¡æ³¨å†Œä¸åŠ è½½ï¼‰&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class TaskRegistry {
private ScheduledExecutorService scheduler;
private Map&amp;lt;String, ScheduledFuture&amp;lt;?&amp;gt;&amp;gt; tasks = new ConcurrentHashMap&amp;lt;&amp;gt;();
private TaskDao taskDao; // æ•°æ®åº“è®¿é—®å¯¹è±¡
public void init() {
List&amp;lt;Task&amp;gt; pendingTasks = taskDao.loadPendingTasks(); // åŠ è½½æœªå®Œæˆä»»åŠ¡
pendingTasks.forEach(task -&amp;gt; scheduleTask(task.getId(), task.getPeriod()));
}
public void scheduleTask(String taskId, long period) {
Runnable task = () -&amp;gt; {
taskDao.markTaskRunning(taskId); // æ ‡è®°ä¸ºæ‰§è¡Œä¸­
try {
executeBusinessLogic(); // å®é™…ä¸šåŠ¡é€»è¾‘
taskDao.markTaskCompleted(taskId); // æ ‡è®°å®Œæˆ
} catch (Exception e) {
taskDao.resetTaskStatus(taskId); // å¤±è´¥æ—¶é‡ç½®çŠ¶æ€
}
};
ScheduledFuture&amp;lt;?&amp;gt; future = scheduler.scheduleAtFixedRate(task, 0, period, TimeUnit.SECONDS);
tasks.put(taskId, future);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-åˆ†å¸ƒå¼é”é˜²é‡å¤æ‰§è¡Œ"&gt;ğŸ”’ &lt;strong&gt;åˆ†å¸ƒå¼é”é˜²é‡å¤æ‰§è¡Œ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€è·¯&lt;/strong&gt;ï¼šèŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡å‰è·å–åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿é›†ç¾¤ä¸­ä»…ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°æ–¹å¼ï¼š
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Redis é”&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;SET key value NX EX&lt;/code&gt; å‘½ä»¤è·å–é”ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå¦‚30ç§’ï¼‰&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ZooKeeper é”&lt;/strong&gt;ï¼šåˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹ï¼Œæœ€å°èŠ‚ç‚¹è·å¾—é”&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œæµç¨‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;graph TD
A[ä»»åŠ¡è§¦å‘] --&amp;gt; B{å°è¯•è·å–åˆ†å¸ƒå¼é”}
B --&amp;gt;|æˆåŠŸ| C[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]
B --&amp;gt;|å¤±è´¥| D[æ”¾å¼ƒæ‰§è¡Œ]
C --&amp;gt; E[é‡Šæ”¾é”]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä¸»ä»èŠ‚ç‚¹æ•…éšœåˆ‡æ¢"&gt;âš™ï¸ &lt;strong&gt;ä¸»ä»èŠ‚ç‚¹æ•…éšœåˆ‡æ¢&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€è·¯&lt;/strong&gt;ï¼šè®¾è®¡ä¸»ä»æ¶æ„ï¼Œä¸»èŠ‚ç‚¹å®•æœºæ—¶ä»èŠ‚ç‚¹æ¥ç®¡ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ ZooKeeper ä¸´æ—¶èŠ‚ç‚¹ç«äº‰ä¸»èŠ‚ç‚¹èº«ä»½&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æˆ–é€šè¿‡ Redis çš„ &lt;code&gt;SETNX&lt;/code&gt; æŠ¢ä¸»&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;å¿ƒè·³æ£€æµ‹&lt;/strong&gt;ï¼šä¸»èŠ‚ç‚¹å®šæœŸæ›´æ–°DB/Redisä¸­çš„å¿ƒè·³æ—¶é—´æˆ³ï¼Œä»èŠ‚ç‚¹ç›‘æ§è¯¥æ—¶é—´æˆ³ï¼Œè¶…æ—¶æœªæ›´æ–°åˆ™è§¦å‘æŠ¢ä¸»&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡æ¥ç®¡&lt;/strong&gt;ï¼šæ–°ä¸»èŠ‚ç‚¹åŠ è½½æŒä¹…åŒ–çš„æœªå®Œæˆä»»åŠ¡å¹¶è°ƒåº¦ã€‚
&lt;strong&gt;å…³é”®é…ç½®&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¿ƒè·³é—´éš”ï¼šâ‰¤ ä»»åŠ¡å‘¨æœŸçš„ä¸€åŠï¼ˆå¦‚ä»»åŠ¡æ¯åˆ†é’Ÿæ‰§è¡Œï¼Œå¿ƒè·³é—´éš”è®¾25ç§’ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä»»åŠ¡è¡¥å¿ä¸è¶…æ—¶æ§åˆ¶"&gt;âš ï¸ &lt;strong&gt;ä»»åŠ¡è¡¥å¿ä¸è¶…æ—¶æ§åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒé—®é¢˜&lt;/strong&gt;ï¼šä»»åŠ¡æ‰§è¡Œä¸­èŠ‚ç‚¹å®•æœºå¯¼è‡´çŠ¶æ€å¡åœ¨â€œæ‰§è¡Œä¸­â€ã€‚
â€‹&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;â€‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¶…æ—¶é‡ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸ºä»»åŠ¡è®¾ç½®æœ€å¤§æ‰§è¡Œæ—¶é•¿ï¼ˆå¦‚30åˆ†é’Ÿï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥ä»»åŠ¡çŠ¶æ€é•¿æœŸä¸ºâ€œæ‰§è¡Œä¸­â€ä¸”è¶…æ—¶ï¼Œè‡ªåŠ¨é‡ç½®ä¸ºâ€œæœªå¼€å§‹â€ï¼Œå…è®¸å…¶ä»–èŠ‚ç‚¹é‡è¯•&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§è®¾è®¡&lt;/strong&gt;ï¼šä¸šåŠ¡é€»è¾‘éœ€æ”¯æŒé‡å¤æ‰§è¡Œï¼ˆå¦‚æ•°æ®åº“æ“ä½œåŠ å”¯ä¸€ç´¢å¼•ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ–¹æ¡ˆå¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯"&gt;ğŸ“Š &lt;strong&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä»»åŠ¡æŒä¹…åŒ– + é‡å¯åŠ è½½&lt;/td&gt;
&lt;td&gt;å®ç°ç®€å•ï¼Œä¾èµ–å°‘&lt;/td&gt;
&lt;td&gt;å®•æœºæœŸé—´ä»»åŠ¡å®Œå…¨åœæ»&lt;/td&gt;
&lt;td&gt;å®¹å¿åˆ†é’Ÿçº§å»¶è¿Ÿçš„ä»»åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ†å¸ƒå¼é”&lt;/td&gt;
&lt;td&gt;ç²¾ç¡®æ§åˆ¶å•èŠ‚ç‚¹æ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;éœ€ç»´æŠ¤é”è¶…æ—¶ï¼Œé€»è¾‘å¤æ‚&lt;/td&gt;
&lt;td&gt;ç§’çº§ä»»åŠ¡ï¼Œéœ€ä¸¥æ ¼é˜²é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸»ä»åˆ‡æ¢&lt;/td&gt;
&lt;td&gt;æ•…éšœè½¬ç§»å¿«ï¼ˆç§’çº§ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€å®ç°å¿ƒè·³å’Œé€‰ä¸¾æœºåˆ¶&lt;/td&gt;
&lt;td&gt;é«˜å¯ç”¨è¦æ±‚ä¸¥æ ¼çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ—¶é—´ç²¾åº¦ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt; åœ¨èŠ‚ç‚¹æ—¶é’Ÿä¸åŒæ­¥æ—¶å¯èƒ½é‡å¤æ‰§è¡Œï¼Œéœ€éƒ¨ç½² NTP æœåŠ¡åŒæ­¥æ—¶é—´&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;èµ„æºéš”ç¦»ï¼š
&lt;ul&gt;
&lt;li&gt;CPU å¯†é›†å‹ä¸ I/O å¯†é›†å‹ä»»åŠ¡ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œé¿å…ç›¸äº’é˜»å¡&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç›‘æ§å‘Šè­¦ï¼š
&lt;ul&gt;
&lt;li&gt;è®°å½•ä»»åŠ¡è°ƒåº¦æ—¥å¿—ï¼ˆèŠ‚ç‚¹IPã€å¼€å§‹/ç»“æŸæ—¶é—´ï¼‰ï¼Œæ¥å…¥ Prometheus ç›‘æ§æ‰§è¡ŒæˆåŠŸç‡&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»…å‡­ &lt;code&gt;ScheduledExecutorService&lt;/code&gt; æ— æ³•åŸç”Ÿæ”¯æŒé«˜å¯ç”¨ï¼Œéœ€ç»“åˆ &lt;strong&gt;æŒä¹…åŒ– + åˆ†å¸ƒå¼åè°ƒ + æ•…éšœè½¬ç§»&lt;/strong&gt; çš„æ··åˆæ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§åœºæ™¯&lt;/strong&gt;ï¼šä»»åŠ¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ + é‡å¯åŠ è½½ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸¥æ ¼é˜²é‡åœºæ™¯&lt;/strong&gt;ï¼šRedis åˆ†å¸ƒå¼é” + ä»»åŠ¡è¶…æ—¶é‡ç½®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§é«˜å¯ç”¨&lt;/strong&gt;ï¼šä¸»ä»åˆ‡æ¢ï¼ˆZooKeeper/Redis é€‰ä¸»ï¼‰ + å¿ƒè·³æ£€æµ‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è‹¥ä¸šåŠ¡è§„æ¨¡æ‰©å¤§ï¼Œå»ºè®®è¿ç§»è‡³ &lt;strong&gt;XXL-JOB&lt;/strong&gt; æˆ– &lt;strong&gt;Quartz é›†ç¾¤&lt;/strong&gt;ï¼ˆåŸç”Ÿæ”¯æŒæ•…éšœè½¬ç§»ä¸æŒä¹…åŒ–ï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="threadpooltaskscheduler"&gt;ThreadPoolTaskScheduler
&lt;/h2&gt;&lt;p&gt;ThreadPoolTaskScheduler å’Œ ScheduledExecutorService æ˜¯ Java ä¸­ç”¨äºä»»åŠ¡è°ƒåº¦çš„ä¸¤ç§æ ¸å¿ƒå·¥å…·ï¼Œåˆ†åˆ«å±äº &lt;strong&gt;Spring æ¡†æ¶&lt;/strong&gt; å’Œ &lt;strong&gt;JDK åŸç”Ÿå¹¶å‘åŒ…&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†å¯¹æ¯”åŠé€‰å‹å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ¡†æ¶ä¾èµ–ä¸æ¥æº"&gt;âš™ï¸ &lt;strong&gt;æ¡†æ¶ä¾èµ–ä¸æ¥æº&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ScheduledExecutorService&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ThreadPoolTaskScheduler&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰€å±æ¡†æ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JDK åŸç”Ÿ (&lt;code&gt;java.util.concurrent&lt;/code&gt;)&lt;/td&gt;
&lt;td&gt;Spring æ¡†æ¶ (&lt;code&gt;org.springframework.scheduling&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— éœ€é¢å¤–ä¾èµ–&lt;/td&gt;
&lt;td&gt;éœ€é›†æˆ Spring ç¯å¢ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ScheduledThreadPoolExecutor&lt;/code&gt; + &lt;code&gt;DelayedWorkQueue&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°è£… &lt;code&gt;ScheduledExecutorService&lt;/code&gt;ï¼Œæ‰©å±•è°ƒåº¦åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;è¯´æ˜ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt; æ˜¯ Java æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œé€‚åˆé Spring é¡¹ç›®&lt;a class="link" href="@ref" &gt;4,8,10&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt; ä¾èµ– Spring å®¹å™¨ï¼Œæä¾›æ›´ä¾¿æ·çš„é…ç½®å’Œé›†æˆèƒ½åŠ›&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è°ƒåº¦èƒ½åŠ›å¯¹æ¯”"&gt;â±ï¸ &lt;strong&gt;è°ƒåº¦èƒ½åŠ›å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;è°ƒåº¦ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ScheduledExecutorService&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ThreadPoolTaskScheduler&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æ¬¡å»¶è¿Ÿä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;schedule(task, delay, unit)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;schedule(task, Date/Instant)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›ºå®šé€Ÿç‡ä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;scheduleAtFixedRate()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;scheduleAtFixedRate()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›ºå®šå»¶è¿Ÿä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;scheduleWithFixedDelay()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;scheduleWithFixedDelay()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Cron è¡¨è¾¾å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;âœ… &lt;code&gt;schedule(task, CronTrigger)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€å¯åœä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨ç®¡ç† &lt;code&gt;ScheduledFuture&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†…ç½® &lt;code&gt;ScheduledFuture&lt;/code&gt; ç®¡ç†ï¼ˆæ”¯æŒ &lt;code&gt;cancel()&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;å…³é”®å·®å¼‚ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cron æ”¯æŒ&lt;/strong&gt;ï¼š&lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt; å¯ç›´æ¥è§£æ Cron è¡¨è¾¾å¼ï¼Œé€‚ç”¨äºå¤æ‚æ—¶é—´è§„åˆ™ï¼ˆå¦‚â€œæ¯å¤© 8:00 æ‰§è¡Œâ€ï¼‰&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ§åˆ¶&lt;/strong&gt;ï¼š&lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt; æä¾›æ›´ä¾¿æ·çš„ä»»åŠ¡å¯åœæ¥å£ï¼Œé€‚åˆéœ€åŠ¨æ€è°ƒæ•´çš„åœºæ™¯ï¼ˆå¦‚æ•°æ®åº“é…ç½®æ›´æ–°ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-çº¿ç¨‹æ± ç®¡ç†"&gt;ğŸ§µ &lt;strong&gt;çº¿ç¨‹æ± ç®¡ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ScheduledExecutorService&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ThreadPoolTaskScheduler&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹æ± é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨è®¾ç½®æ ¸å¿ƒå‚æ•°ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ã€é˜Ÿåˆ—ç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;é€šè¿‡ Spring Bean é…ç½®ï¼ˆæ”¯æŒä¾èµ–æ³¨å…¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹å‘½å&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è‡ªå®šä¹‰ &lt;code&gt;ThreadFactory&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†…ç½® &lt;code&gt;setThreadNamePrefix()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‹’ç»ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ &lt;code&gt;RejectedExecutionHandler&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ Spring ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;CallerRunsPolicy&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹é…ç½®ï¼šScheduledExecutorServiceï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;ScheduledExecutorService executor = new ScheduledThreadPoolExecutor(5);
&lt;/code&gt;&lt;/pre&gt;ThreadPoolTaskSchedulerï¼ˆSpring é…ç½®ï¼‰ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Bean
public ThreadPoolTaskScheduler taskScheduler() {
ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler();
scheduler.setPoolSize(10);
scheduler.setThreadNamePrefix(&amp;#34;task-&amp;#34;);
return scheduler;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-å¼‚å¸¸å¤„ç†ä¸é›†æˆèƒ½åŠ›"&gt;ğŸ› ï¸ &lt;strong&gt;å¼‚å¸¸å¤„ç†ä¸é›†æˆèƒ½åŠ›&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ScheduledExecutorService&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ThreadPoolTaskScheduler&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»»åŠ¡å¼‚å¸¸ä»…ç»ˆæ­¢å½“å‰ä»»åŠ¡ï¼Œä¸å½±å“çº¿ç¨‹æ± &lt;/td&gt;
&lt;td&gt;æ”¯æŒ Spring çš„ &lt;code&gt;ErrorHandler&lt;/code&gt; ç»Ÿä¸€å¤„ç†å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âŒ éœ€æ‰‹åŠ¨æ•´åˆ&lt;/td&gt;
&lt;td&gt;âœ… æ— ç¼å…¼å®¹ &lt;code&gt;@Scheduled&lt;/code&gt;ã€äº‹ä»¶ç›‘å¬ç­‰æœºåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡ä¸Šä¸‹æ–‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;âœ… å¯è®¿é—® Spring ä¸Šä¸‹æ–‡ï¼ˆå¦‚ &lt;code&gt;@Autowired&lt;/code&gt; æ³¨å…¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;è¯´æ˜ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt; åœ¨ä»»åŠ¡ä¸­å¯ç›´æ¥è°ƒç”¨ Spring Beanï¼Œé€‚åˆéœ€è¦ä¾èµ–æ³¨å…¥çš„ä¸šåŠ¡é€»è¾‘&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt; éœ€è‡ªè¡Œå¤„ç†çº¿ç¨‹å†… Spring ä¸Šä¸‹æ–‡ï¼ˆå¦‚é€šè¿‡ &lt;code&gt;ThreadLocal&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€§èƒ½ä¸é€‚ç”¨åœºæ™¯"&gt;âš¡ &lt;strong&gt;æ€§èƒ½ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èå·¥å…·&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è½»é‡çº§å®šæ—¶ä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ—  Spring ä¾èµ–ï¼Œèµ„æºå ç”¨ä½&lt;a class="link" href="@ref" &gt;8,10&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤æ‚è°ƒåº¦ï¼ˆCronï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŸç”Ÿæ”¯æŒ Cron è¡¨è¾¾å¼ï¼Œé…ç½®ç®€æ´&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€ä»»åŠ¡ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å†…ç½® &lt;code&gt;ScheduledFuture&lt;/code&gt; æ§åˆ¶å¯åœï¼Œé€‚åˆé‡è¯•æœºåˆ¶ã€å¼€å…³éœ€æ±‚&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é«˜å¹¶å‘ä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ScheduledExecutorService&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ›´åº•å±‚ï¼Œå¯ç²¾ç»†ä¼˜åŒ–çº¿ç¨‹æ± å‚æ•°ï¼ˆå¦‚é˜Ÿåˆ—ç±»å‹ï¼‰&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“ä¸é€‰å‹å»ºè®®"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ScheduledExecutorService&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ThreadPoolTaskScheduler&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â­â­â­â­ï¼ˆéœ€æ‰‹åŠ¨å®ç°é«˜çº§è°ƒåº¦ï¼‰&lt;/td&gt;
&lt;td&gt;â­â­â­â­â­ï¼ˆå¼€ç®±å³ç”¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Spring é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â­â­&lt;/td&gt;
&lt;td&gt;â­â­â­â­â­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;â­â­â­ï¼ˆç†Ÿæ‚‰ JDK å¹¶å‘ï¼‰&lt;/td&gt;
&lt;td&gt;â­â­ï¼ˆéœ€ Spring åŸºç¡€ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨é¡¹ç›®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é Spring åº”ç”¨ã€ç®€å•è°ƒåº¦éœ€æ±‚&lt;/td&gt;
&lt;td&gt;Spring é¡¹ç›®ã€éœ€åŠ¨æ€ä»»åŠ¡æˆ– Cron çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœ€ç»ˆå»ºè®®&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é Spring ç¯å¢ƒ&lt;/strong&gt; âœ é€‰æ‹© &lt;code&gt;ScheduledExecutorService&lt;/code&gt;ï¼Œé¿å…å¼•å…¥é¢å¤–ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring é¡¹ç›®&lt;/strong&gt; âœ ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt;ï¼Œå°¤å…¶éœ€åŠ¨æ€ä»»åŠ¡æˆ– Cron è¡¨è¾¾å¼æ—¶&lt;a class="link" href="@ref" &gt;3,5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½è¦æ±‚&lt;/strong&gt; âœ ä¸¤è€…å‡å¯ä¼˜åŒ–çº¿ç¨‹æ± ï¼Œä½† &lt;code&gt;ScheduledExecutorService&lt;/code&gt; æ›´æ˜“ç²¾ç»†åŒ–è°ƒä¼˜&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="quartz"&gt;Quartz
&lt;/h2&gt;&lt;p&gt;Quartz æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¼€æº &lt;strong&gt;Java ä½œä¸šè°ƒåº¦æ¡†æ¶&lt;/strong&gt;ï¼Œç”± OpenSymphony å¼€æºç»„ç»‡å¼€å‘ï¼Œå¹¿æ³›åº”ç”¨äº J2SE å’Œ J2EE åº”ç”¨ä¸­ã€‚å®ƒæ”¯æŒä»ç®€å•å®šæ—¶ä»»åŠ¡åˆ°å¤æ‚åˆ†å¸ƒå¼è°ƒåº¦çš„éœ€æ±‚ï¼Œé€‚ç”¨äºå¦‚å®šæ—¶æŠ¥è¡¨ç”Ÿæˆã€æ•°æ®åŒæ­¥ã€ç³»ç»Ÿç›‘æ§ç­‰åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨è¯¦è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¦‚å¿µä¸ç»„ä»¶"&gt;âš™ï¸ **æ ¸å¿ƒæ¦‚å¿µä¸ç»„ä»¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Jobï¼ˆä»»åŠ¡ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;éœ€å®ç° &lt;code&gt;Job&lt;/code&gt; æ¥å£çš„ &lt;code&gt;execute()&lt;/code&gt; æ–¹æ³•ï¼Œå®šä¹‰å…·ä½“ä»»åŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡æ‰§è¡Œæ—¶ï¼ŒQuartz ä¼šåˆ›å»ºæ–°çš„ Job å®ä¾‹ï¼Œå› æ­¤éœ€ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JobDetailï¼ˆä»»åŠ¡è¯¦æƒ…ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å°è£… Job çš„å…ƒæ•°æ®ï¼ˆå¦‚ä»»åŠ¡åç§°ã€æ‰€å±ç»„ã€å…³è”çš„ Job ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;JobBuilder&lt;/code&gt; æ„å»ºï¼Œæ”¯æŒä¼ é€’å‚æ•°ï¼ˆå¦‚ &lt;code&gt;JobDataMap&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Triggerï¼ˆè§¦å‘å™¨ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰ä»»åŠ¡è§¦å‘è§„åˆ™ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SimpleTrigger&lt;/code&gt;&lt;/strong&gt;ï¼šå›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œï¼ˆå¦‚æ¯ 10 ç§’ä¸€æ¬¡ï¼‰ï¼Œé€‚åˆç®€å•è°ƒåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CronTrigger&lt;/code&gt;&lt;/strong&gt;ï¼šåŸºäº Cron è¡¨è¾¾å¼ï¼ˆå¦‚ &lt;code&gt;0 0 12 * * ?&lt;/code&gt; è¡¨ç¤ºæ¯å¤©ä¸­åˆæ‰§è¡Œï¼‰ï¼Œæ”¯æŒå¤æ‚æ—¶é—´è§„åˆ™&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œæ³¨å†Œ JobDetail å’Œ Trigger å¹¶åè°ƒæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;SchedulerFactory&lt;/code&gt; åˆ›å»ºï¼Œæ”¯æŒå¯åŠ¨ã€æš‚åœã€å…³é—­ç­‰æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JobDataMap&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äºåœ¨ Job å’Œ Trigger é—´ä¼ é€’å‚æ•°ï¼Œå¯é€šè¿‡ &lt;code&gt;JobExecutionContext&lt;/code&gt; åœ¨ &lt;code&gt;execute()&lt;/code&gt; ä¸­è·å–&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ¶æ„è®¾è®¡"&gt;ğŸ—ï¸ &lt;strong&gt;æ¶æ„è®¾è®¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šçº¿ç¨‹æ¶æ„&lt;/strong&gt;ï¼šåˆå§‹åŒ– worker çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼Œæ”¯æŒé«˜å¹¶å‘ã€‚&lt;/li&gt;
&lt;li&gt;æ¨¡å—åŒ–è®¾è®¡ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ThreadPool&lt;/code&gt;&lt;/strong&gt;ï¼šç®¡ç†ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ï¼ˆé»˜è®¤å¤§å° 10ï¼Œå¯é…ç½®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;JobStore&lt;/code&gt;&lt;/strong&gt;ï¼šå­˜å‚¨ä»»åŠ¡å’Œè§¦å‘å™¨ä¿¡æ¯ï¼Œæ”¯æŒå†…å­˜ï¼ˆ&lt;code&gt;RAMJobStore&lt;/code&gt;ï¼‰æˆ–æ•°æ®åº“ï¼ˆ&lt;code&gt;JDBCJobStore&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶ç›‘å¬&lt;/strong&gt;ï¼šæä¾› &lt;code&gt;SchedulerListener&lt;/code&gt;ã€&lt;code&gt;JobListener&lt;/code&gt; ç­‰æ¥å£ï¼Œæ”¯æŒä»»åŠ¡æ‰§è¡Œå‰åçš„è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æ—¥å¿—ã€å‘Šè­¦ï¼‰&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è§¦å‘å™¨ä¸è°ƒåº¦è§„åˆ™"&gt;â±ï¸ &lt;strong&gt;è§¦å‘å™¨ä¸è°ƒåº¦è§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="simpletrigger"&gt;&lt;strong&gt;SimpleTrigger&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼šå•æ¬¡æ‰§è¡Œæˆ–å›ºå®šé—´éš”é‡å¤ï¼ˆå¦‚æ¯éš” 5 åˆ†é’Ÿæ‰§è¡Œï¼Œå…± 10 æ¬¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Trigger trigger = TriggerBuilder.newTrigger()
.withSchedule(SimpleScheduleBuilder.simpleSchedule()
.withIntervalInSeconds(10)
.repeatForever())
.build();
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="crontrigger"&gt;&lt;strong&gt;CronTrigger&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Cron è¡¨è¾¾å¼ï¼šç”± 7 ä¸ªå­—æ®µç»„æˆï¼ˆç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´ï¼‰ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;*&lt;/code&gt;ï¼šä»»æ„å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;?&lt;/code&gt;ï¼šå¿½ç•¥æ—¥/å‘¨å­—æ®µå†²çª&lt;/li&gt;
&lt;li&gt;&lt;code&gt;L&lt;/code&gt;ï¼šæœ€åä¸€å¤©ï¼ˆå¦‚ &lt;code&gt;0 0 23 L * ?&lt;/code&gt; è¡¨ç¤ºæ¯æœˆæœ€åä¸€å¤© 23 ç‚¹æ‰§è¡Œï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#&lt;/code&gt;ï¼šç¬¬ N ä¸ªå‘¨å‡ ï¼ˆå¦‚ &lt;code&gt;0 15 10 ? * 6#3&lt;/code&gt; è¡¨ç¤ºæ¯æœˆç¬¬ä¸‰ä¸ªå‘¨äº” 10:15 æ‰§è¡Œï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¸¸ç”¨ç¤ºä¾‹ï¼š
&lt;ul&gt;
&lt;li&gt;æ¯å°æ—¶æ‰§è¡Œï¼š&lt;code&gt;0 0 * * * ?&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ¯å‘¨ä¸€ 8 ç‚¹ï¼š&lt;code&gt;0 0 8 ? * MON&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é›†ç¾¤ä¸é«˜å¯ç”¨14"&gt;ğŸŒ &lt;strong&gt;é›†ç¾¤ä¸é«˜å¯ç”¨&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é›†ç¾¤æ¨¡å¼ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰å…±äº«ä»»åŠ¡çŠ¶æ€ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ•…éšœåˆ‡æ¢å’Œè´Ÿè½½å‡è¡¡ï¼Œå¤šä¸ªè°ƒåº¦å™¨èŠ‚ç‚¹ååŒå·¥ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é…ç½®æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆä½¿ç”¨ Quartz æä¾›çš„ SQL è„šæœ¬ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ quartz.properties ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreTX
org.quartz.jobStore.isClustered=true
org.quartz.jobStore.dataSource=myDS # é…ç½®æ•°æ®åº“è¿æ¥
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-ä¼ä¸šçº§ç‰¹æ€§18"&gt;ğŸ§© &lt;strong&gt;ä¼ä¸šçº§ç‰¹æ€§&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æŒä¹…åŒ–
&lt;ul&gt;
&lt;li&gt;ä»»åŠ¡çŠ¶æ€ä¿å­˜åˆ°æ•°æ®åº“ï¼Œé‡å¯åè‡ªåŠ¨æ¢å¤æœªå®Œæˆçš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ç®¡ç†
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ JTA äº‹åŠ¡ï¼Œç¡®ä¿ä»»åŠ¡æ‰§è¡Œä¸ä¸šåŠ¡é€»è¾‘çš„åŸå­æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ’ä»¶æœºåˆ¶
&lt;ul&gt;
&lt;li&gt;å¯æ‰©å±• &lt;code&gt;SchedulerPlugin&lt;/code&gt; ç­‰æ¥å£ï¼Œè‡ªå®šä¹‰è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚åŠ¨æ€ä¿®æ”¹ Cron è¡¨è¾¾å¼ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-spring-boot-é›†æˆ28"&gt;ğŸŒ± &lt;strong&gt;Spring Boot é›†æˆ&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;2,8&lt;/a&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;ä¾èµ–é…ç½®ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;spring-boot-starter-quartz&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å®šä¹‰ Job ç±»ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;public class MyJob implements Job {
@Override
public void execute(JobExecutionContext context) {
System.out.println(&amp;#34;Job executed!&amp;#34;);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨é…ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;Spring Boot è‡ªåŠ¨åˆ›å»º &lt;code&gt;Scheduler&lt;/code&gt;ï¼Œé€šè¿‡ &lt;code&gt;application.yml&lt;/code&gt; é…ç½®çº¿ç¨‹æ± ã€å­˜å‚¨æ–¹å¼ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯-vs-æ›¿ä»£æ–¹æ¡ˆ46"&gt;âš–ï¸ &lt;strong&gt;é€‚ç”¨åœºæ™¯ vs æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç†ç”±&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç®€å•å•æœºä»»åŠ¡&lt;/td&gt;
&lt;td&gt;Spring &lt;code&gt;@Scheduled&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è½»é‡çº§ï¼Œæ³¨è§£å³å¯ä½¿ç”¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚è°ƒåº¦ï¼ˆåˆ†å¸ƒå¼/æŒä¹…åŒ–ï¼‰&lt;/td&gt;
&lt;td&gt;Quartz&lt;/td&gt;
&lt;td&gt;æ”¯æŒé›†ç¾¤ã€äº‹åŠ¡ã€çµæ´» Cron è§„åˆ™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤§è§„æ¨¡åˆ†å¸ƒå¼ä»»åŠ¡&lt;/td&gt;
&lt;td&gt;XXL-JOB/Elastic-Job&lt;/td&gt;
&lt;td&gt;æä¾›åˆ†ç‰‡ã€åŠ¨æ€æ‰©å®¹ã€ç®¡ç†ç•Œé¢ç­‰å¢å¼ºåŠŸèƒ½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹é˜»å¡&lt;/strong&gt;ï¼šé¿å…åœ¨ Job ä¸­æ‰§è¡Œé•¿æ—¶é˜»å¡æ“ä½œï¼Œéœ€ä¼˜åŒ–ä»»åŠ¡é€»è¾‘æˆ–å¼‚æ­¥å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶é—´ç²¾åº¦&lt;/strong&gt;ï¼šCron è¡¨è¾¾å¼æœ€å°å•ä½ä¸ºåˆ†é’Ÿï¼Œç§’çº§ç²¾åº¦éœ€ç”¨ &lt;code&gt;SimpleTrigger&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¸…ç†&lt;/strong&gt;ï¼šåº”ç”¨å…³é—­æ—¶è°ƒç”¨ &lt;code&gt;scheduler.shutdown()&lt;/code&gt; é‡Šæ”¾çº¿ç¨‹æ± &lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-1"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Quartz æ˜¯ Java ç”Ÿæ€ä¸­æœ€æˆç†Ÿçš„è°ƒåº¦æ¡†æ¶ä¹‹ä¸€ï¼Œ&lt;strong&gt;é€‚åˆéœ€è¦é«˜å¯é æ€§ã€å¤æ‚è°ƒåº¦è§„åˆ™æˆ–åˆ†å¸ƒå¼éƒ¨ç½²çš„ä¼ä¸šåº”ç”¨&lt;/strong&gt;ã€‚å¯¹äº Spring Boot é¡¹ç›®ï¼Œå¯æ— ç¼é›†æˆå¹¶ç®€åŒ–é…ç½®ï¼›è‹¥éœ€æ›´è½»é‡çº§æ–¹æ¡ˆï¼Œå¯è€ƒè™‘ Spring è‡ªå¸¦è°ƒåº¦å™¨æˆ–åˆ†å¸ƒå¼æ¡†æ¶å¦‚ XXL-JOB&lt;a class="link" href="@ref" &gt;2,4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="xxl-job"&gt;XXL-JOB
&lt;/h2&gt;&lt;p&gt;XXL-JOB æ˜¯ä¸€ä¸ªè½»é‡çº§ã€æ˜“æ‰©å±•çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œç”±è®¸é›ªé‡Œå¼€å‘ï¼Œé‡‡ç”¨ä¸­å¿ƒå¼è°ƒåº¦ä¸åˆ†å¸ƒå¼æ‰§è¡Œæ¶æ„ï¼Œæ”¯æŒé«˜å¯ç”¨ã€åŠ¨æ€ç®¡ç†ã€ä»»åŠ¡åˆ†ç‰‡ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ä»¥ä¸‹ä»æ¶æ„è®¾è®¡ã€æ ¸å¿ƒåŠŸèƒ½ã€ä½¿ç”¨éƒ¨ç½²åˆ°é€‚ç”¨åœºæ™¯è¿›è¡Œç³»ç»Ÿä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡æ€æƒ³"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡æ€æƒ³&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;XXL-JOB é‡‡ç”¨ &lt;strong&gt;â€œè°ƒåº¦ä¸­å¿ƒ + æ‰§è¡Œå™¨â€ çš„åˆ†å¸ƒå¼æ¶æ„&lt;/strong&gt;ï¼Œå®ç°è°ƒåº¦ä¸æ‰§è¡Œçš„è§£è€¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒï¼ˆAdminï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæä¾› Web ç®¡ç†ç•Œé¢ï¼Œè´Ÿè´£ä»»åŠ¡é…ç½®ã€è§¦å‘è°ƒåº¦ã€ç›‘æ§æ—¥å¿—ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨&lt;/strong&gt;ï¼šæ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼Œé€šè¿‡æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰ç»´æŠ¤ä»»åŠ¡çŠ¶æ€ï¼Œé¿å…å•ç‚¹æ•…éšœ&lt;a class="link" href="@ref" &gt;1,4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦çº¿ç¨‹æ± &lt;/strong&gt;ï¼šåˆ†å¿«æ…¢çº¿ç¨‹æ± ï¼Œæ…¢ä»»åŠ¡è‡ªåŠ¨é™çº§ï¼Œé¿å…é˜»å¡è°ƒåº¦&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæ¥æ”¶è°ƒåº¦è¯·æ±‚ï¼Œæ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘ï¼ˆé€šè¿‡ &lt;code&gt;JobHandler&lt;/code&gt; å®ç°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å†Œæœºåˆ¶&lt;/strong&gt;ï¼šå‘¨æœŸæ€§ä¸ŠæŠ¥å¿ƒè·³è‡³è°ƒåº¦ä¸­å¿ƒï¼ŒåŠ¨æ€ç»´æŠ¤åœ¨çº¿èŠ‚ç‚¹åˆ—è¡¨&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤æ”¯æŒ&lt;/strong&gt;ï¼šæ”¯æŒå¼¹æ€§æ‰©å®¹ï¼Œæ–°èŠ‚ç‚¹è‡ªåŠ¨åŠ å…¥ä»»åŠ¡åˆ†é…&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿¡åè®®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨é€šè¿‡ &lt;strong&gt;RESTful API&lt;/strong&gt; äº¤äº’ï¼Œæ”¯æŒè·¨è¯­è¨€è°ƒç”¨&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§"&gt;ğŸš€ &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»çš„ä»»åŠ¡è§¦å‘ç­–ç•¥&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ &lt;strong&gt;Cron è¡¨è¾¾å¼&lt;/strong&gt;ã€å›ºå®šé—´éš”ã€å›ºå®šå»¶æ—¶ã€API è§¦å‘ã€çˆ¶å­ä»»åŠ¡ä¾èµ–ç­‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;code&gt;0 */10 * * * ?&lt;/code&gt; è¡¨ç¤ºæ¯ 10 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼ä»»åŠ¡åˆ†ç‰‡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å°†å¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œæ˜¾è‘—æå‡å¤„ç†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@XxlJob(&amp;#34;shardingJob&amp;#34;)
public ReturnT&amp;lt;String&amp;gt; execute(String param) {
ShardingUtil.ShardingVO shard = ShardingUtil.getShardingVo();
int index = shard.getIndex(); // å½“å‰åˆ†ç‰‡ç´¢å¼•
int total = shard.getTotal(); // æ€»åˆ†ç‰‡æ•°
// æ ¹æ®åˆ†ç‰‡å¤„ç†æ•°æ®ï¼ˆä¾‹å¦‚ï¼ši % total == indexï¼‰
return ReturnT.SUCCESS;
}
&lt;/code&gt;&lt;/pre&gt;è·¯ç”±ç­–ç•¥æ”¯æŒæ•…éšœè½¬ç§»ã€è½®è¯¢ã€ä¸€è‡´æ€§ HASH ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨ä¸å®¹é”™æœºåˆ¶&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœè½¬ç§»&lt;/strong&gt;ï¼šèŠ‚ç‚¹å®•æœºæ—¶è‡ªåŠ¨åˆ‡æ¢è‡³å¥åº·èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤±è´¥é‡è¯•&lt;/strong&gt;ï¼šè‡ªå®šä¹‰é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰ï¼Œæ”¯æŒåˆ†ç‰‡çº§é‡è¯•&lt;a class="link" href="@ref" &gt;2,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜»å¡å¤„ç†&lt;/strong&gt;ï¼šæä¾›å•æœºä¸²è¡Œã€ä¸¢å¼ƒåç»­è°ƒåº¦ã€è¦†ç›–ä¹‹å‰è°ƒåº¦ç­‰ç­–ç•¥&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´ç›‘æ§èƒ½åŠ›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ—¥å¿—&lt;/strong&gt;ï¼šæ”¯æŒ Rolling æ–¹å¼æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ¥è­¦æœºåˆ¶&lt;/strong&gt;ï¼šä»»åŠ¡å¤±è´¥æ—¶è§¦å‘é‚®ä»¶ã€é’‰é’‰ç­‰å‘Šè­¦ï¼ˆå¯æ‰©å±•çŸ­ä¿¡/Webhookï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡ŒæŠ¥è¡¨&lt;/strong&gt;ï¼šç»Ÿè®¡ä»»åŠ¡æ‰§è¡ŒæˆåŠŸç‡ã€è°ƒåº¦åˆ†å¸ƒç­‰æŒ‡æ ‡&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç®¡ç†&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»»åŠ¡å‚æ•°ã€Cron è¡¨è¾¾å¼ã€å¯åœçŠ¶æ€å¯åŠ¨æ€ä¿®æ”¹å¹¶å®æ—¶ç”Ÿæ•ˆ&lt;a class="link" href="@ref" &gt;1,2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-éƒ¨ç½²ä¸é›†æˆ"&gt;ğŸ› ï¸ &lt;strong&gt;éƒ¨ç½²ä¸é›†æˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è°ƒåº¦ä¸­å¿ƒéƒ¨ç½²"&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒéƒ¨ç½²&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“åˆå§‹åŒ–&lt;/strong&gt;ï¼šæ‰§è¡Œ SQL è„šæœ¬ &lt;code&gt;tables_xxl_job.sql&lt;/code&gt;&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯åŠ¨æ–¹å¼ï¼š
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°è¿è¡Œï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;java -jar xxl-job-admin.jar --spring.datasource.url=jdbc:mysql://localhost:3306/xxl_job
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Docker éƒ¨ç½²ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;docker run -d -p 8080:8080 -e PARAMS=&amp;#34;--spring.datasource.url=...&amp;#34; xuxueli/xxl-job-admin:2.4.0
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®ç®¡ç†å°&lt;/strong&gt;ï¼š&lt;code&gt;http://localhost:8080/xxl-job-admin&lt;/code&gt;ï¼ˆé»˜è®¤è´¦å· &lt;code&gt;admin/123456&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰§è¡Œå™¨é›†æˆspring-boot-é¡¹ç›®"&gt;&lt;strong&gt;æ‰§è¡Œå™¨é›†æˆï¼ˆSpring Boot é¡¹ç›®ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–æ·»åŠ &lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.xuxueli&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;xxl-job-core&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;2.4.0&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹ï¼ˆapplication.ymlï¼‰&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;xxl:
job:
admin:
addresses: http://localhost:8080/xxl-job-admin
executor:
appname: my-executor
port: 9999
logpath: /data/logs/xxl-job
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰ä»»åŠ¡å¤„ç†å™¨&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class DemoJobHandler {
@XxlJob(&amp;#34;demoJob&amp;#34;)
public ReturnT&amp;lt;String&amp;gt; execute(String param) {
System.out.println(&amp;#34;æ‰§è¡Œä»»åŠ¡ï¼Œå‚æ•°ï¼š&amp;#34; + param);
return ReturnT.SUCCESS;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯ä¸æ¡†æ¶å¯¹æ¯”"&gt;âš–ï¸ &lt;strong&gt;é€‚ç”¨åœºæ™¯ä¸æ¡†æ¶å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…¸å‹åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šæ—¶ä»»åŠ¡&lt;/strong&gt;ï¼šæ¯æ—¥å‡Œæ™¨æ•°æ®ç»Ÿè®¡ã€æ—¥å¿—æ¸…ç†&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡&lt;/strong&gt;ï¼šç”¨æˆ·æ³¨å†Œåå‘é€éªŒè¯é‚®ä»¶ã€æ”¯ä»˜æˆåŠŸé€šçŸ¥&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼è®¡ç®—&lt;/strong&gt;ï¼šæµ·é‡æ•°æ®åˆ†ç‰‡å¤„ç†ï¼ˆå¦‚æ¸…æ´— 1TB æ—¥å¿—æ–‡ä»¶ï¼‰&lt;a class="link" href="@ref" &gt;1,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”"&gt;&lt;strong&gt;ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Quartz&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Elastic-Job&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;XXL-JOB&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†å¸ƒå¼è°ƒåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€è‡ªè¡Œé…ç½®&lt;/td&gt;
&lt;td&gt;æ˜¯ï¼ˆZKï¼‰&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ˜¯ï¼ˆå†…ç½®ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯è§†åŒ–ç•Œé¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éƒ¨åˆ†æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®æ—¶ç”Ÿæ•ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¥å¿—ç›‘æ§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼±&lt;/td&gt;
&lt;td&gt;æœ‰é™&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®æ—¶æ—¥å¿— + æŠ¥è¡¨&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­¦ä¹ æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä¸­é«˜&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä½ï¼ˆWeb æ“ä½œï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿æ€»ç»“&lt;/strong&gt;ï¼šå¼€ç®±å³ç”¨ã€è¿ç»´å‹å¥½ã€æ‰©å±•æ€§å¼ºï¼Œé€‚åˆä¸­å°å‹è‡³å¤§å‹é¡¹ç›®&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“æ€§èƒ½&lt;/strong&gt;ï¼šä»»åŠ¡é‡æå¤§æ—¶éœ€ä¼˜åŒ–æ•°æ®åº“ï¼ˆå¦‚åˆ†è¡¨ã€ç´¢å¼•ï¼‰&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œéš”ç¦»&lt;/strong&gt;ï¼šç¡®ä¿è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨ç½‘ç»œäº’é€šï¼Œé˜²ç«å¢™å¼€æ”¾ç«¯å£&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§è®¾è®¡&lt;/strong&gt;ï¼šä»»åŠ¡é€»è¾‘éœ€æ”¯æŒé‡å¤æ‰§è¡Œï¼ˆå¦‚ DB æ“ä½œåŠ å”¯ä¸€çº¦æŸï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-2"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;XXL-JOB é€šè¿‡ &lt;strong&gt;è§£è€¦è®¾è®¡&lt;/strong&gt; ä¸ &lt;strong&gt;å…¨å¼‚æ­¥æµç¨‹&lt;/strong&gt; è§£å†³äº†åˆ†å¸ƒå¼ä»»åŠ¡çš„é«˜å¯ç”¨ã€å¼¹æ€§æ‰©å±•é—®é¢˜ï¼Œå…¶ &lt;strong&gt;å¼€ç®±å³ç”¨çš„ç®¡ç†å°&lt;/strong&gt; å¤§å¹…é™ä½è¿ç»´æˆæœ¬ã€‚å¯¹äº Java ç”Ÿæ€ä¸­çš„å®šæ—¶ä»»åŠ¡éœ€æ±‚ï¼Œæ— è®ºæ˜¯ç®€å•è°ƒåº¦è¿˜æ˜¯å¤§æ•°æ®åˆ†ç‰‡åœºæ™¯ï¼ŒXXL-JOB å‡æ˜¯æ¯”åŸç”Ÿ &lt;code&gt;ScheduledExecutorService&lt;/code&gt; æˆ– &lt;code&gt;Quartz&lt;/code&gt; æ›´é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆ&lt;a class="link" href="@ref" &gt;1,4,7&lt;/a&gt;ã€‚
&lt;strong&gt;å®˜æ–¹èµ„æº&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æºç åœ°å€ï¼š&lt;a class="link" href="https://gitee.com/xuxueli0323/xxl-job" target="_blank" rel="noopener"
&gt;Gitee&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£ï¼šhttps://www.xuxueli.com/xxl-job/&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="quartz--xxl-job"&gt;Quartz &amp;amp; XXL-JOB
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯Quartzä¸XXL-JOBçš„è¯¦ç»†å¯¹æ¯”ï¼Œç»“åˆæ¶æ„è®¾è®¡ã€åŠŸèƒ½ç‰¹æ€§ã€é€‚ç”¨åœºæ™¯ç­‰ç»´åº¦è¿›è¡Œç³»ç»Ÿåˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¶æ„å¯¹æ¯”"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæ¶æ„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Quartz&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;XXL-JOB&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¶æ„æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— ä¸­å¿ƒåŒ–è°ƒåº¦&lt;/td&gt;
&lt;td&gt;ä¸­å¿ƒåŒ–è°ƒåº¦ï¼ˆè°ƒåº¦ä¸­å¿ƒ + æ‰§è¡Œå™¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†å¸ƒå¼æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼±ï¼ˆä¾èµ–æ•°æ®åº“é”ç«äº‰ï¼‰&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;å¼ºï¼ˆå†…ç½®è´Ÿè½½å‡è¡¡ + æ•…éšœè½¬ç§»ï¼‰&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»»åŠ¡åˆ†ç‰‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒé™æ€åˆ†ç‰‡ï¼ˆéœ€æ‰‹åŠ¨ç¼–ç ï¼‰&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€šä¿¡åè®®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºJava API&lt;/td&gt;
&lt;td&gt;HTTP/RESTfulï¼ˆè·¨è¯­è¨€æ”¯æŒï¼‰&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”"&gt;ğŸ› ï¸ &lt;strong&gt;åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡è°ƒåº¦èƒ½åŠ›&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Quartzï¼š
&lt;ul&gt;
&lt;li&gt;æ”¯æŒCronè¡¨è¾¾å¼ã€å›ºå®šé—´éš”ç­‰å¤æ‚è°ƒåº¦ç­–ç•¥&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œé‡å¯å¯æ¢å¤&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;XXL-JOBï¼š
&lt;ul&gt;
&lt;li&gt;é™¤Cronå¤–ï¼Œæ”¯æŒAPIè§¦å‘ã€çˆ¶å­ä»»åŠ¡ä¾èµ–ã€åˆ†ç‰‡å¹¿æ’­&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç”Ÿæ•ˆ&lt;/strong&gt;ï¼šä»»åŠ¡å‚æ•°ã€çŠ¶æ€ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆ&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤ä¸é«˜å¯ç”¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Quartzï¼š
&lt;ul&gt;
&lt;li&gt;é›†ç¾¤èŠ‚ç‚¹é€šè¿‡æ•°æ®åº“è¡Œé”ç«äº‰ä»»åŠ¡ï¼Œè´Ÿè½½ä¸å‡è¡¡ï¼Œå­˜åœ¨å•ç‚¹ç“¶é¢ˆ&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;XXL-JOBï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ä¸­å¿ƒé›†ç¾¤é€šè¿‡DBé”æˆ–ZKé€‰ä¸»ï¼Œæ‰§è¡Œå™¨æ”¯æŒæ•…éšœè‡ªåŠ¨è½¬ç§»&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼ˆ30ç§’/æ¬¡ï¼‰ï¼Œè‡ªåŠ¨å‰”é™¤å®•æœºèŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´ç›‘æ§&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Quartz&lt;/strong&gt;ï¼šæ— åŸç”Ÿç®¡ç†ç•Œé¢ï¼Œéœ€è‡ªè¡Œå¼€å‘ç›‘æ§ç³»ç»Ÿ&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;XXL-JOB&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æä¾›&lt;strong&gt;å¯è§†åŒ–æ§åˆ¶å°&lt;/strong&gt;ï¼Œå®æ—¶æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ã€æ‰§è¡ŒçŠ¶æ€ã€æˆåŠŸç‡ç»Ÿè®¡&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒé‚®ä»¶/é’‰é’‰å‘Šè­¦ï¼Œä»»åŠ¡å¤±è´¥è‡ªåŠ¨è§¦å‘&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¸æ‰©å±•æ€§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Quartz&lt;/strong&gt;ï¼šå•æœºè°ƒåº¦ååé‡çº¦500ä»»åŠ¡/ç§’ï¼Œé›†ç¾¤æ‰©å±•éœ€æ‰‹åŠ¨åˆ†åº“åˆ†è¡¨&lt;a class="link" href="@ref" &gt;7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;XXL-JOB&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¼‚æ­¥è°ƒåº¦è®¾è®¡ï¼Œååé‡è¾¾1200ä»»åŠ¡/ç§’&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨åŠ¨æ€æ³¨å†Œï¼Œæ”¯æŒå¼¹æ€§æ‰©å®¹&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;ğŸ“Š &lt;strong&gt;é€‚ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ¡†æ¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç†ç”±&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å•æœº/å°è§„æ¨¡é›†ç¾¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Quartz&lt;/td&gt;
&lt;td&gt;è½»é‡çº§åµŒå…¥ï¼Œæ— éœ€å¤æ‚éƒ¨ç½²ï¼Œé€‚åˆä¼ ç»Ÿå•ä½“åº”ç”¨&lt;a class="link" href="@ref" &gt;2,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆä¸­å°å‹ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;XXL-JOB&lt;/td&gt;
&lt;td&gt;å¼€ç®±å³ç”¨çš„è¿ç»´ç•Œé¢ã€è·¨è¯­è¨€æ”¯æŒï¼Œå¿«é€Ÿæ­å»ºè°ƒåº¦å¹³å°&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤§æ•°æ®åˆ†ç‰‡ä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸æ¨èäºŒè€…&lt;/td&gt;
&lt;td&gt;Elastic-Jobæ›´ä¼˜ï¼ˆè‡ªåŠ¨åˆ†ç‰‡+ZKåŠ¨æ€åè°ƒï¼‰&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éœ€ä¸¥æ ¼ç›‘æ§å‘Šè­¦çš„åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;XXL-JOB&lt;/td&gt;
&lt;td&gt;å†…ç½®æ—¥å¿—è¿½è¸ªä¸æŠ¥è­¦æœºåˆ¶ï¼Œé™ä½è¿ç»´æˆæœ¬&lt;a class="link" href="@ref" &gt;4,8&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-å±€é™æ€§å¯¹æ¯”"&gt;âš ï¸ &lt;strong&gt;å±€é™æ€§å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Quartzï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç ä¾µå…¥æ€§å¼º&lt;/strong&gt;ï¼šè°ƒåº¦é€»è¾‘ä¸ä¸šåŠ¡è€¦åˆï¼Œå½±å“æ€§èƒ½&lt;a class="link" href="@ref" &gt;4,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— åˆ†ç‰‡æœºåˆ¶&lt;/strong&gt;ï¼šæ— æ³•å¤„ç†æµ·é‡æ•°æ®å¹¶è¡Œä»»åŠ¡&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;XXL-JOBï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡åŠŸèƒ½è¾ƒå¼±&lt;/strong&gt;ï¼šéœ€å¼€å‘è€…æ‰‹åŠ¨å®ç°åˆ†ç‰‡é€»è¾‘ï¼ˆä¾‹ï¼š&lt;code&gt;ShardingUtil.getShardingVo()&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸­å¿ƒåŒ–é£é™©&lt;/strong&gt;ï¼šè°ƒåº¦ä¸­å¿ƒè‹¥æœªé›†ç¾¤éƒ¨ç½²ï¼Œå¯èƒ½æˆä¸ºå•ç‚¹æ•…éšœ&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-é€‰å‹å»ºè®®"&gt;ğŸ’ &lt;strong&gt;é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©Quartzçš„åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å†å²é¡¹ç›®æ”¹é€ ï¼Œå·²æœ‰Quartzé›†æˆï¼›&lt;/li&gt;
&lt;li&gt;ç®€å•å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚æ¯æ—¥æŠ¥è¡¨ï¼‰ï¼Œæ— éœ€åˆ†å¸ƒå¼æ”¯æŒ&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©XXL-JOBçš„åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„&lt;/strong&gt;ï¼šéœ€ç»Ÿä¸€ç®¡ç†è·¨æœåŠ¡ä»»åŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§†åŒ–è¿ç»´éœ€æ±‚&lt;/strong&gt;ï¼šéæŠ€æœ¯è§’è‰²å‚ä¸ä»»åŠ¡ç›‘æ§ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿè¿­ä»£é¡¹ç›®&lt;/strong&gt;ï¼šåŠ¨æ€è°ƒæ•´ä»»åŠ¡å‚æ•°æ— éœ€é‡å¯&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ–°é¡¹ç›®è¶‹åŠ¿&lt;/strong&gt;ï¼šè¶…è¿‡70%çš„åˆ†å¸ƒå¼ç³»ç»Ÿé€‰å‹XXL-JOBï¼ˆæ•°æ®æ¥æºï¼šCSDNå¼€å‘è€…è°ƒç ”&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•èƒ½åŠ›è¡¥å……"&gt;ğŸ”§ &lt;strong&gt;æ‰©å±•èƒ½åŠ›è¡¥å……&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;XXL-JOBï¼š
&lt;ul&gt;
&lt;li&gt;æ”¯æŒ&lt;strong&gt;GLUEè„šæœ¬ä»»åŠ¡&lt;/strong&gt;ï¼ˆJava/Python/PHPç­‰ï¼‰ï¼ŒåŠ¨æ€æ›´æ–°ä»£ç &lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ•´åˆSpring Bootä»…éœ€3æ­¥ï¼šä¾èµ– â†’ é…ç½® â†’ æ³¨è§£&lt;code&gt;@XxlJob&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Quartzï¼š
&lt;ul&gt;
&lt;li&gt;å¯é€šè¿‡&lt;strong&gt;ç›‘å¬å™¨&lt;/strong&gt;ï¼ˆ&lt;code&gt;JobListener&lt;/code&gt;ï¼‰æ‰©å±•ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸäº‹ä»¶&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šQuartzæ˜¯&lt;strong&gt;ç¨³å¥çš„å•æœºè°ƒåº¦åŸºçŸ³&lt;/strong&gt;ï¼Œè€ŒXXL-JOBæ˜¯&lt;strong&gt;åˆ†å¸ƒå¼æ—¶ä»£çš„è°ƒåº¦å¹³å°&lt;/strong&gt;ã€‚ä¸¤è€…å®šä½å·®å¼‚æ˜¾è‘—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿½æ±‚&lt;strong&gt;è½»é‡åµŒå…¥ã€å¤æ‚è°ƒåº¦ç­–ç•¥&lt;/strong&gt; â†’ Quartzï¼›&lt;/li&gt;
&lt;li&gt;è¿½æ±‚&lt;strong&gt;å¼€ç®±å³ç”¨ã€è¿ç»´å‹å¥½ã€è·¨è¯­è¨€&lt;/strong&gt; â†’ XXL-JOB&lt;a class="link" href="@ref" &gt;3,6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="xxl-job-åŠ¨æ€æäº¤"&gt;XXL-JOB åŠ¨æ€æäº¤
&lt;/h2&gt;&lt;p&gt;XXL-JOB å®ç°åŠ¨æ€æäº¤é™„å¸¦æ‰§è¡Œå‚æ•°ä¸”ä»…æ‰§è¡Œä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œä¸»è¦é€šè¿‡å…¶ &lt;strong&gt;API è§¦å‘æœºåˆ¶&lt;/strong&gt; å’Œ &lt;strong&gt;ä»»åŠ¡å‚æ•°é…ç½®&lt;/strong&gt; å®ç°ã€‚ä»¥ä¸‹æ˜¯å…·ä½“æ­¥éª¤å’Œå®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒå®ç°æ–¹å¼"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒå®ç°æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€šè¿‡ç®¡ç†ç•Œé¢æ‰‹åŠ¨åˆ›å»ºé€‚åˆä¸´æ—¶ä»»åŠ¡"&gt;&lt;strong&gt;é€šè¿‡ç®¡ç†ç•Œé¢æ‰‹åŠ¨åˆ›å»º&lt;/strong&gt;ï¼ˆé€‚åˆä¸´æ—¶ä»»åŠ¡ï¼‰
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;ç™»å½• XXL-JOB ç®¡ç†å°ï¼Œè¿›å…¥ä»»åŠ¡ç®¡ç†é¡µé¢ï¼›&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»â€œæ–°å¢ä»»åŠ¡â€ï¼Œå¡«å†™ä»»åŠ¡ä¿¡æ¯ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨&lt;/strong&gt;ï¼šé€‰æ‹©ç›®æ ‡æ‰§è¡Œå™¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡æè¿°&lt;/strong&gt;ï¼šè‡ªå®šä¹‰åç§°ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±ç­–ç•¥&lt;/strong&gt;ï¼šé»˜è®¤æˆ–æŒ‰éœ€é€‰æ‹©ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ç±»å‹&lt;/strong&gt;ï¼š&lt;strong&gt;CRON&lt;/strong&gt;ï¼Œè®¾ç½®è¡¨è¾¾å¼ä¸ºå…·ä½“æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚ &lt;code&gt;2025-07-03 15:30:00&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œæ¨¡å¼&lt;/strong&gt;ï¼šé€‰æ‹© &lt;strong&gt;BEANæ¨¡å¼&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JobHandler&lt;/strong&gt;ï¼šå¡«å†™ä»»åŠ¡å¯¹åº”çš„æ³¨è§£åï¼ˆå¦‚ &lt;code&gt;demoJobHandler&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡å‚æ•°&lt;/strong&gt;ï¼šå¡«å†™ JSON æˆ–é”®å€¼å¯¹å‚æ•°ï¼ˆå¦‚ &lt;code&gt;{&amp;quot;orderId&amp;quot;:1001}&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œä¸€æ¬¡&lt;/strong&gt;ï¼šè°ƒåº¦ç±»å‹é€‰æ‹©ä¸€æ¬¡ä»»åŠ¡åè‡ªåŠ¨å¤±æ•ˆ&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¿å­˜åä»»åŠ¡ä¼šåœ¨æŒ‡å®šæ—¶é—´è§¦å‘ä¸€æ¬¡ï¼Œæ‰§è¡Œåè‡ªåŠ¨åœæ­¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šæ“ä½œç®€å•ï¼Œæ— éœ€ç¼–ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€šè¿‡-api-åŠ¨æ€æäº¤é€‚åˆç¨‹åºè§¦å‘"&gt;&lt;strong&gt;é€šè¿‡ API åŠ¨æ€æäº¤&lt;/strong&gt;ï¼ˆé€‚åˆç¨‹åºè§¦å‘ï¼‰
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ­¥éª¤ï¼š
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨è°ƒåº¦ä¸­å¿ƒ API&lt;/strong&gt;ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;POST /api/jobinfo/add
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚ä½“ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;jobGroup&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œå™¨ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;jobDesc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ä¸€æ¬¡æ€§è®¢å•ä»»åŠ¡&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;author&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;admin&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;scheduleType&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;CRON&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è°ƒåº¦ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;scheduleConf&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;0 30 15 3 7 ? 2025&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œæ—¶é—´ï¼ˆ2025-07-03 15:30:00ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;glueType&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;BEAN&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;executorHandler&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;orderJobHandler&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// JobHandleråç§°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;executorParam&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;orderId\&amp;#34;:1001}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ¨æ€å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;triggerNextTime&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç«‹å³ç”Ÿæ•ˆ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‰´æƒ&lt;/strong&gt;ï¼šéœ€åœ¨ Header ä¸­æ·»åŠ  &lt;code&gt;XXL-JOB-ACCESS-TOKEN&lt;/code&gt;ï¼ˆä¸è°ƒåº¦ä¸­å¿ƒé…ç½®ä¸€è‡´ï¼‰&lt;a class="link" href="@ref" &gt;4,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å…³é”®ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scheduleConf&lt;/code&gt; è®¾ç½®ä¸ºç²¾ç¡®åˆ°ç§’çš„ CRON è¡¨è¾¾å¼ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡æ‰§è¡Œåè‡ªåŠ¨å½’æ¡£ï¼Œä¸ä¼šå†æ¬¡è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰§è¡Œå™¨æ¥æ”¶åŠ¨æ€å‚æ•°"&gt;ğŸ§© &lt;strong&gt;æ‰§è¡Œå™¨æ¥æ”¶åŠ¨æ€å‚æ•°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨ä»»åŠ¡é€»è¾‘ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å‚æ•°ï¼š&lt;/p&gt;
&lt;h4 id="bean-æ¨¡å¼æ–¹æ³•å½¢å¼"&gt;&lt;strong&gt;Bean æ¨¡å¼ï¼ˆæ–¹æ³•å½¢å¼ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderJobHandler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@XxlJob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;orderJobHandler&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ReturnT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§£æJSONå‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JSONObject&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;orderId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å¤„ç†è®¢å•IDï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ReturnT&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SUCCESS&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼šå‚æ•°é€šè¿‡ &lt;code&gt;param&lt;/code&gt; å­—ç¬¦ä¸²ä¼ å…¥ï¼Œéœ€è‡ªè¡Œè§£æä¸º JSON æˆ– Map&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä½¿ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡é«˜çº§"&gt;&lt;strong&gt;ä½¿ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆé«˜çº§ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@XxlJob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;orderJobHandler&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ReturnT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–ä»»åŠ¡ä¸Šä¸‹æ–‡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XxlJobHelper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getJobParam&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JSONObject&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ReturnT&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SUCCESS&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦è·å–ä»»åŠ¡ IDã€åˆ†ç‰‡ä¿¡æ¯ç­‰æ›´å¤šä¸Šä¸‹æ–‡æ—¶&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-3"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å‚æ•°å®‰å…¨æ€§ï¼š
&lt;ul&gt;
&lt;li&gt;é¿å…ä¼ é€’æ•æ„Ÿæ•°æ®ï¼Œæˆ–å¯¹å‚æ•°åŠ å¯†ï¼›&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨éœ€æ ¡éªŒå‚æ•°åˆæ³•æ€§ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼š
&lt;ul&gt;
&lt;li&gt;å•æ¬¡ä»»åŠ¡æ‰§è¡ŒåçŠ¶æ€å˜ä¸º &lt;strong&gt;å·²åœæ­¢&lt;/strong&gt;ï¼Œéœ€æ‰‹åŠ¨æˆ–è°ƒç”¨ API åˆ é™¤&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ—¶é—´ç²¾åº¦ï¼š
&lt;ul&gt;
&lt;li&gt;CRON è¡¨è¾¾å¼éœ€ç²¾ç¡®åˆ°ç§’ï¼ˆå¦‚ &lt;code&gt;ss mm HH dd MM ? yyyy&lt;/code&gt;ï¼‰ï¼Œç¡®ä¿åªè§¦å‘ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç¯å¢ƒï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ä¸­å¿ƒéœ€é›†ç¾¤éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´ä»»åŠ¡ä¸¢å¤±&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰©å±•api-è§¦å‘æ›¿ä»£æ–¹æ¡ˆ"&gt;ğŸ”§ &lt;strong&gt;æ‰©å±•ï¼šAPI è§¦å‘æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€æ›´çµæ´»è§¦å‘ï¼ˆå¦‚äº‹ä»¶é©±åŠ¨ï¼‰ï¼Œå¯ç›´æ¥è°ƒç”¨ &lt;strong&gt;ä»»åŠ¡è§¦å‘ API&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;POST /api/jobinfo/trigger
Body: {&amp;#34;id&amp;#34;:ä»»åŠ¡ID, &amp;#34;executorParam&amp;#34;:&amp;#34;{\&amp;#34;key\&amp;#34;:\&amp;#34;value\&amp;#34;}&amp;#34;}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šç»•è¿‡è°ƒåº¦è®¡åˆ’ï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œé€‚åˆå¼‚æ­¥äº‹ä»¶åœºæ™¯&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-3"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æäº¤å•æ¬¡ä»»åŠ¡&lt;/strong&gt;ï¼šé€šè¿‡ç®¡ç†å°æˆ– API åˆ›å»º CRON è°ƒåº¦ä»»åŠ¡ï¼ŒæŒ‡å®šç²¾ç¡®æ‰§è¡Œæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°ä¼ é€’&lt;/strong&gt;ï¼šä»»åŠ¡å‚æ•°ä»¥ JSON å­—ç¬¦ä¸²ä¼ é€’ï¼Œæ‰§è¡Œå™¨è§£æåä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè®¢å•è¶…æ—¶å¤„ç†ã€ä¸´æ—¶æ•°æ®ä¿®å¤ç­‰éœ€ç²¾å‡†æ§åˆ¶æ‰§è¡Œæ—¶æœºçš„ä¸šåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£å‚è€ƒï¼š&lt;a class="link" href="https://www.xuxueli.com/xxl-job/" target="_blank" rel="noopener"
&gt;XXL-JOB ä»»åŠ¡ç®¡ç†&lt;/a&gt;
å®Œæ•´ API åˆ—è¡¨è§è°ƒåº¦ä¸­å¿ƒ Swagger é¡µé¢ï¼ˆ&lt;code&gt;/xxl-job-admin/swagger-ui.html&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="scheduletype"&gt;scheduleType
&lt;/h2&gt;&lt;p&gt;XXL-JOB æ”¯æŒå¤šç§è°ƒåº¦ç±»å‹ï¼ˆ&lt;code&gt;scheduleType&lt;/code&gt;ï¼‰ï¼Œå¯é€šè¿‡ &lt;strong&gt;API åŠ¨æ€æäº¤ä»»åŠ¡&lt;/strong&gt; æ—¶çµæ´»é…ç½®ã€‚ä»¥ä¸‹æ˜¯æ‰€æœ‰æ”¯æŒçš„è°ƒåº¦ç±»å‹åŠå…¶ä½¿ç”¨åœºæ™¯å’Œé…ç½®æ–¹å¼ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒè°ƒåº¦ç±»å‹scheduletype"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒè°ƒåº¦ç±»å‹ï¼ˆscheduleTypeï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;XXL-JOB çš„ &lt;code&gt;scheduleType&lt;/code&gt; å®šä¹‰äº†ä»»åŠ¡è§¦å‘è§„åˆ™ï¼ŒåŠ¨æ€æäº¤ä»»åŠ¡æ—¶éœ€åœ¨ API è¯·æ±‚ä¸­æŒ‡å®šè¯¥å‚æ•°ã€‚ä»¥ä¸‹æ˜¯å…¨éƒ¨ç±»å‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;CRON&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šåŸºäº Cron è¡¨è¾¾å¼è§¦å‘ä»»åŠ¡ï¼Œé€‚ç”¨äºå¤æ‚æ—¶é—´è§„åˆ™ï¼ˆå¦‚æ¯å¤©å‡Œæ™¨æ‰§è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;API å‚æ•°ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;{
&amp;#34;scheduleType&amp;#34;: &amp;#34;CRON&amp;#34;,
&amp;#34;scheduleConf&amp;#34;: &amp;#34;0 0 2 * * ?&amp;#34; // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå®šæœŸæŠ¥è¡¨ç”Ÿæˆã€å®šæ—¶æ•°æ®æ¸…æ´—&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FIX_RATE&lt;/strong&gt;ï¼ˆå›ºå®šé€Ÿç‡ï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæŒ‰å›ºå®šé—´éš”é‡å¤æ‰§è¡Œï¼ˆä»ä»»åŠ¡å¯åŠ¨åå¼€å§‹è®¡æ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;API å‚æ•°ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;{
&amp;#34;scheduleType&amp;#34;: &amp;#34;FIX_RATE&amp;#34;,
&amp;#34;scheduleConf&amp;#34;: &amp;#34;30&amp;#34; // å•ä½ï¼šç§’ï¼Œæ¯30ç§’æ‰§è¡Œä¸€æ¬¡
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå®æ—¶ç›‘æ§ã€å¿ƒè·³æ£€æµ‹&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FIX_DELAY&lt;/strong&gt;ï¼ˆå›ºå®šå»¶æ—¶ï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œå»¶è¿Ÿå›ºå®šæ—¶é—´å†æ¬¡è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;API å‚æ•°ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;{
&amp;#34;scheduleType&amp;#34;: &amp;#34;FIX_DELAY&amp;#34;,
&amp;#34;scheduleConf&amp;#34;: &amp;#34;60&amp;#34; // å•ä½ï¼šç§’ï¼Œä»»åŠ¡ç»“æŸåå»¶è¿Ÿ60ç§’æ‰§è¡Œä¸‹ä¸€æ¬¡
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šé¿å…ä»»åŠ¡é‡å ï¼Œå¦‚æ•°æ®åˆ†æ‰¹å¤„ç†&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;API&lt;/strong&gt;ï¼ˆäº‹ä»¶è§¦å‘ï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæ— å†…ç½®è°ƒåº¦è§„åˆ™ï¼Œéœ€é€šè¿‡å¤–éƒ¨ API æ‰‹åŠ¨è§¦å‘å•æ¬¡æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;API å‚æ•°ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;{
&amp;#34;scheduleType&amp;#34;: &amp;#34;API&amp;#34;,
&amp;#34;scheduleConf&amp;#34;: &amp;#34;&amp;#34; // ç•™ç©º
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§¦å‘æ–¹å¼&lt;/strong&gt;ï¼šè°ƒç”¨ &lt;code&gt;/api/jobinfo/trigger&lt;/code&gt; æ¥å£ä¸»åŠ¨è§¦å‘ä»»åŠ¡&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PARENT&lt;/strong&gt;ï¼ˆçˆ¶å­ä»»åŠ¡ä¾èµ–ï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä¾èµ–çˆ¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸåè§¦å‘ï¼ˆéœ€é…ç½®çˆ¶ä»»åŠ¡IDï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;API å‚æ•°ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;{
&amp;#34;scheduleType&amp;#34;: &amp;#34;PARENT&amp;#34;,
&amp;#34;scheduleConf&amp;#34;: &amp;#34;1001&amp;#34; // çˆ¶ä»»åŠ¡ID
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šä»»åŠ¡æµæ°´çº¿ï¼Œå¦‚è®¢å•å¤„ç†å®Œæˆåè§¦å‘é€šçŸ¥ä»»åŠ¡&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MANUAL&lt;/strong&gt;ï¼ˆäººå·¥è§¦å‘ï¼‰
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šä»…åœ¨ç®¡ç†å°æ‰‹åŠ¨ç‚¹å‡»â€œæ‰§è¡Œâ€æŒ‰é’®æ—¶è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;API å‚æ•°ç¤ºä¾‹ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;{
&amp;#34;scheduleType&amp;#34;: &amp;#34;MANUAL&amp;#34;,
&amp;#34;scheduleConf&amp;#34;: &amp;#34;&amp;#34;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä¸´æ—¶è°ƒè¯•æˆ–åº”æ€¥æ“ä½œ&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-åŠ¨æ€æäº¤-api-ç¤ºä¾‹"&gt;âš¡ &lt;strong&gt;åŠ¨æ€æäº¤ API ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡è°ƒåº¦ä¸­å¿ƒ RESTful API æäº¤ä»»åŠ¡ï¼ˆä»¥åˆ›å»ºä»»åŠ¡æ¥å£ä¸ºä¾‹ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;POST /api/jobinfo/add
Headers: {&amp;#34;XXL-JOB-ACCESS-TOKEN&amp;#34;: &amp;#34;your_token&amp;#34;}
Body:
{
&amp;#34;jobGroup&amp;#34;: 2, // æ‰§è¡Œå™¨ID
&amp;#34;jobDesc&amp;#34;: &amp;#34;åŠ¨æ€ä»»åŠ¡ç¤ºä¾‹&amp;#34;,
&amp;#34;scheduleType&amp;#34;: &amp;#34;FIX_RATE&amp;#34;, // è°ƒåº¦ç±»å‹
&amp;#34;scheduleConf&amp;#34;: &amp;#34;300&amp;#34;, // é—´éš”300ç§’
&amp;#34;executorHandler&amp;#34;: &amp;#34;demoJob&amp;#34;, // JobHandleråç§°
&amp;#34;executorParam&amp;#34;: &amp;#34;{\&amp;#34;key\&amp;#34;:\&amp;#34;value\&amp;#34;}&amp;#34; // ä»»åŠ¡å‚æ•°
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ &lt;strong&gt;å…³é”®å­—æ®µè¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scheduleType&lt;/code&gt;ï¼šå¿…é¡»ä¸ºä¸Šè¿°å…­ç§ç±»å‹ä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scheduleConf&lt;/code&gt;ï¼šæ ¹æ®ç±»å‹å¡«å†™ Cron è¡¨è¾¾å¼ã€æ—¶é—´é—´éš”æˆ–çˆ¶ä»»åŠ¡IDã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-4"&gt;âš ï¸ &lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;åŠ¨æ€ç”Ÿæ•ˆæ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ API æäº¤çš„ä»»åŠ¡ä¼š&lt;strong&gt;å®æ—¶ç”Ÿæ•ˆ&lt;/strong&gt;ï¼Œæ— éœ€é‡å¯è°ƒåº¦ä¸­å¿ƒæˆ–æ‰§è¡Œå™¨&lt;a class="link" href="@ref" &gt;5,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;å‚æ•°æ ¡éªŒ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scheduleConf&lt;/code&gt; éœ€ç¬¦åˆç±»å‹è§„åˆ™ï¼ˆå¦‚ CRON éœ€åˆæ³•è¡¨è¾¾å¼ï¼ŒFIX_RATE éœ€æ­£æ•´æ•°ï¼‰&lt;a class="link" href="@ref" &gt;7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;API&lt;/code&gt; å’Œ &lt;code&gt;MANUAL&lt;/code&gt; ç±»å‹ä»»åŠ¡éœ€æ‰‹åŠ¨è§¦å‘ï¼Œä¸ä¼šè‡ªåŠ¨è°ƒåº¦ï¼›å…¶ä»–ç±»å‹æŒ‰è§„åˆ™è‡ªåŠ¨æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;é›†ç¾¤å…¼å®¹æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰è°ƒåº¦ç±»å‹å‡æ”¯æŒåˆ†å¸ƒå¼æ‰§è¡Œï¼Œä¾èµ–è°ƒåº¦ä¸­å¿ƒçš„é›†ç¾¤åè°ƒèƒ½åŠ›&lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-4"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;XXL-JOB çš„å…­ç§ &lt;code&gt;scheduleType&lt;/code&gt; è¦†ç›–äº†ä» &lt;strong&gt;å®šæ—¶ä»»åŠ¡&lt;/strong&gt; åˆ° &lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt; çš„å…¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘¨æœŸä»»åŠ¡&lt;/strong&gt; â†’ &lt;code&gt;CRON&lt;/code&gt;ã€&lt;code&gt;FIX_RATE&lt;/code&gt;ã€&lt;code&gt;FIX_DELAY&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¢«åŠ¨è§¦å‘&lt;/strong&gt; â†’ &lt;code&gt;API&lt;/code&gt;ã€&lt;code&gt;MANUAL&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡ç¼–æ’&lt;/strong&gt; â†’ &lt;code&gt;PARENT&lt;/code&gt;
é€šè¿‡åŠ¨æ€ API æäº¤ä»»åŠ¡æ—¶ï¼Œç»“åˆ &lt;code&gt;executorParam&lt;/code&gt; ä¼ é€’å‚æ•°ï¼Œå¯çµæ´»é€‚é…ä¸šåŠ¡å˜åŒ–ï¼Œæ˜¾è‘—æå‡è°ƒåº¦ç³»ç»Ÿçš„å“åº”é€Ÿåº¦&lt;a class="link" href="@ref" &gt;5,7,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="xxl-job-åˆ†å¸ƒå¼è°ƒåº¦"&gt;XXL-JOB åˆ†å¸ƒå¼è°ƒåº¦
&lt;/h2&gt;&lt;p&gt;XXL-JOB å®ç°ä»»åŠ¡çš„åˆ†å¸ƒå¼è°ƒåº¦ä¸»è¦ä¾èµ–å…¶&lt;strong&gt;ä¸­å¿ƒåŒ–è°ƒåº¦ + åˆ†å¸ƒå¼æ‰§è¡Œ&lt;/strong&gt;çš„æ¶æ„è®¾è®¡ï¼Œé€šè¿‡è°ƒåº¦ä¸­å¿ƒï¼ˆAdminï¼‰ä¸æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰çš„ååŒå·¥ä½œï¼Œç»“åˆå¤šç§æ ¸å¿ƒæœºåˆ¶ä¿éšœä»»åŠ¡åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜æ•ˆã€å¯é æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°åŸç†åŠå…³é”®æœºåˆ¶ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ ¸å¿ƒæ¶æ„è®¾è®¡"&gt;âš™ï¸ &lt;strong&gt;æ ¸å¿ƒæ¶æ„è®¾è®¡&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è°ƒåº¦ä¸­å¿ƒadmin"&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒï¼ˆAdminï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€è°ƒåº¦ä¸­æ¢&lt;/strong&gt;ï¼šè´Ÿè´£ç®¡ç†ä»»åŠ¡é…ç½®ã€è§¦å‘è°ƒåº¦ã€ç›‘æ§çŠ¶æ€ï¼Œæ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼ˆå¤šèŠ‚ç‚¹å…±äº«åŒä¸€æ•°æ®åº“ï¼‰ï¼Œé€šè¿‡æ•°æ®åº“é”ï¼ˆ&lt;code&gt;xxl_job_lock&lt;/code&gt;ï¼‰ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä»»åŠ¡è°ƒåº¦çš„å”¯ä¸€æ€§&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½æ¨¡å—ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡ç®¡ç†&lt;/strong&gt;ï¼šé€šè¿‡Webç•Œé¢åŠ¨æ€é…ç½®ä»»åŠ¡ï¼ˆCRONè¡¨è¾¾å¼ã€è·¯ç”±ç­–ç•¥ã€é‡è¯•æœºåˆ¶ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦çº¿ç¨‹æ± &lt;/strong&gt;ï¼šå¤šçº¿ç¨‹è§¦å‘ä»»åŠ¡ï¼Œé¿å…å•ç‚¹é˜»å¡ï¼ˆå¿«æ…¢çº¿ç¨‹æ± éš”ç¦»ï¼Œæ…¢ä»»åŠ¡è‡ªåŠ¨é™çº§ï¼‰&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨å‘ç°&lt;/strong&gt;ï¼šç»´æŠ¤æ³¨å†Œè¡¨ï¼ˆ&lt;code&gt;xxl_job_registry&lt;/code&gt;ï¼‰ï¼ŒåŠ¨æ€æ„ŸçŸ¥åœ¨çº¿æ‰§è¡Œå™¨èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰§è¡Œå™¨executor"&gt;&lt;strong&gt;æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼ä»»åŠ¡æ‰§è¡Œ&lt;/strong&gt;ï¼šéƒ¨ç½²åœ¨ä¸šåŠ¡æœåŠ¡èŠ‚ç‚¹ï¼Œé€šè¿‡HTTPæ¥æ”¶è°ƒåº¦è¯·æ±‚ï¼Œæ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨æ³¨å†Œ&lt;/strong&gt;ï¼šå¯åŠ¨æ—¶å‘è°ƒåº¦ä¸­å¿ƒæ³¨å†Œï¼Œå®šæœŸï¼ˆ30ç§’ï¼‰å‘é€å¿ƒè·³ç»´æŒåœ¨çº¿çŠ¶æ€&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤æ”¯æŒ&lt;/strong&gt;ï¼šåŒä¸€æ‰§è¡Œå™¨å¯å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œè°ƒåº¦ä¸­å¿ƒæ ¹æ®è·¯ç”±ç­–ç•¥åˆ†é…ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-åˆ†å¸ƒå¼è°ƒåº¦æ ¸å¿ƒæœºåˆ¶"&gt;ğŸ”§ &lt;strong&gt;åˆ†å¸ƒå¼è°ƒåº¦æ ¸å¿ƒæœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä»»åŠ¡è·¯ç”±ä¸è´Ÿè½½å‡è¡¡"&gt;&lt;strong&gt;ä»»åŠ¡è·¯ç”±ä¸è´Ÿè½½å‡è¡¡&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è°ƒåº¦ä¸­å¿ƒæ ¹æ®é…ç½®çš„&lt;strong&gt;è·¯ç”±ç­–ç•¥&lt;/strong&gt;é€‰æ‹©æ‰§è¡Œå™¨èŠ‚ç‚¹ï¼Œç¡®ä¿ä»»åŠ¡å‡åŒ€åˆ†é…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¸¸ç”¨ç­–ç•¥ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœè½¬ç§»ï¼ˆFAILOVERï¼‰&lt;/strong&gt;ï¼šä¼˜å…ˆé€‰æ‹©ä¸Šæ¬¡æˆåŠŸçš„èŠ‚ç‚¹ï¼Œå¤±è´¥è‡ªåŠ¨åˆ‡æ¢&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿™ç¢Œè½¬ç§»ï¼ˆBUSY_OVERï¼‰&lt;/strong&gt;ï¼šé€‰æ‹©ç©ºé—²èŠ‚ç‚¹æ‰§è¡Œï¼Œé¿å…èŠ‚ç‚¹è¿‡è½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡å¹¿æ’­ï¼ˆSHARDING_BROADCASTï¼‰&lt;/strong&gt;ï¼šæ‰€æœ‰æ‰§è¡Œå™¨å¹¶è¡Œæ‰§è¡ŒåŒä¸€ä»»åŠ¡ï¼Œé…åˆåˆ†ç‰‡å‚æ•°å¤„ç†ä¸åŒæ•°æ®å­é›†&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸€è‡´æ€§HASH&lt;/strong&gt;ï¼šä»»åŠ¡å›ºå®šåˆ†é…åˆ°ç‰¹å®šèŠ‚ç‚¹ï¼Œå‡å°‘èŠ‚ç‚¹å˜åŠ¨çš„å½±å“&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åˆ†ç‰‡ä»»åŠ¡å¤„ç†"&gt;&lt;strong&gt;åˆ†ç‰‡ä»»åŠ¡å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åŠ¨æ€æ•°æ®åˆ†ç‰‡ï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ä¸­å¿ƒå¹¿æ’­ä»»åŠ¡æ—¶ä¼ é€’åˆ†ç‰‡å‚æ•°ï¼ˆå½“å‰åˆ†ç‰‡ç´¢å¼• &lt;code&gt;index&lt;/code&gt;ã€æ€»åˆ†ç‰‡æ•° &lt;code&gt;total&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨é€šè¿‡ &lt;code&gt;ShardingUtil.getShardingVo()&lt;/code&gt; è·å–å‚æ•°ï¼ŒæŒ‰åˆ†ç‰‡å¤„ç†æ•°æ®ï¼ˆå¦‚æŒ‰IDå–æ¨¡åˆ†ç‰‡æŸ¥è¯¢ï¼‰&lt;a class="link" href="@ref" &gt;6,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ä»£ç ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;@XxlJob(&amp;#34;shardingJob&amp;#34;)
public void shardingTask() {
ShardingVO shard = ShardingUtil.getShardingVo();
List&amp;lt;Data&amp;gt; dataSubset = fetchDataByShard(shard.getIndex(), shard.getTotal());
process(dataSubset);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é«˜å¯ç”¨ä¸å®¹é”™"&gt;&lt;strong&gt;é«˜å¯ç”¨ä¸å®¹é”™&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒé›†ç¾¤&lt;/strong&gt;ï¼šå¤šèŠ‚ç‚¹å…±äº«æ•°æ®åº“ï¼Œé€šè¿‡DBé”é¿å…é‡å¤è°ƒåº¦ï¼›é…åˆNginxå®ç°è´Ÿè½½å‡è¡¡&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨æ•…éšœè½¬ç§»&lt;/strong&gt;ï¼šèŠ‚ç‚¹å®•æœºåï¼Œè°ƒåº¦ä¸­å¿ƒè‡ªåŠ¨å‰”é™¤ç¦»çº¿èŠ‚ç‚¹ï¼Œå°†ä»»åŠ¡è·¯ç”±è‡³å¥åº·èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤±è´¥é‡è¯•ä¸å‘Šè­¦&lt;/strong&gt;ï¼šä»»åŠ¡å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆå¯é…ç½®æ¬¡æ•°ï¼‰ï¼Œå¹¶é€šè¿‡é‚®ä»¶/é’‰é’‰é€šçŸ¥è´Ÿè´£äºº&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ—¶é—´è½®è°ƒåº¦ç®—æ³•"&gt;&lt;strong&gt;æ—¶é—´è½®è°ƒåº¦ç®—æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é«˜æ•ˆè§¦å‘ä»»åŠ¡ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ScheduleThread&lt;/strong&gt;ï¼šé¢„è¯»æœªæ¥5ç§’ä»»åŠ¡ï¼ŒåŠ è½½è‡³æ—¶é—´è½®æ§½ä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RingThread&lt;/strong&gt;ï¼šæ¯ç§’æ£€æµ‹å½“å‰æ§½ä½ä»»åŠ¡å¹¶è§¦å‘ï¼Œå‡å°‘æ•°æ®åº“è½®è¯¢å‹åŠ›&lt;a class="link" href="@ref" &gt;8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æœŸç­–ç•¥&lt;/strong&gt;ï¼šè‹¥ä»»åŠ¡é”™è¿‡è§¦å‘æ—¶é—´ï¼Œå¯é€‰æ‹©å¿½ç•¥æˆ–ç«‹å³è¡¥å¿æ‰§è¡Œä¸€æ¬¡ï¼ˆ&lt;code&gt;FIRE_ONCE_NOW&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-ä»»åŠ¡æ‰§è¡Œæµç¨‹"&gt;âš¡ &lt;strong&gt;ä»»åŠ¡æ‰§è¡Œæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦è§¦å‘&lt;/strong&gt;ï¼šè°ƒåº¦ä¸­å¿ƒæ ¹æ®CRONæˆ–äº‹ä»¶è§¦å‘ä»»åŠ¡ï¼Œç”Ÿæˆè°ƒåº¦è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±é€‰æ‹©&lt;/strong&gt;ï¼šæŒ‰ç­–ç•¥é€‰å–ç›®æ ‡æ‰§è¡Œå™¨èŠ‚ç‚¹ï¼Œå‘é€HTTPè¯·æ±‚è‡³å…¶ &lt;code&gt;/run&lt;/code&gt; æ¥å£&lt;a class="link" href="@ref" &gt;3,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡æ‰§è¡Œ&lt;/strong&gt;ï¼šæ‰§è¡Œå™¨è°ƒç”¨åŒ¹é…çš„ &lt;code&gt;JobHandler&lt;/code&gt;ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœå›è°ƒ&lt;/strong&gt;ï¼šæ‰§è¡Œå™¨é€šè¿‡ &lt;code&gt;/callback&lt;/code&gt; æ¥å£è¿”å›ç»“æœï¼Œè°ƒåº¦ä¸­å¿ƒæ›´æ–°æ—¥å¿—åŠçŠ¶æ€&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—ç›‘æ§&lt;/strong&gt;ï¼šæ‰§è¡Œæ—¥å¿—å®æ—¶ä¸ŠæŠ¥ï¼Œæ”¯æŒRollingæ–¹å¼æŸ¥çœ‹å®æ—¶è¾“å‡º&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-å…³é”®ä¼˜åŒ–è®¾è®¡"&gt;ğŸ§© &lt;strong&gt;å…³é”®ä¼˜åŒ–è®¾è®¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¼¹æ€§æ‰©ç¼©å®¹
&lt;ul&gt;
&lt;li&gt;æ–°å¢æ‰§è¡Œå™¨è‡ªåŠ¨æ³¨å†Œå¹¶å‚ä¸ä»»åŠ¡åˆ†é…ï¼›èŠ‚ç‚¹ä¸‹çº¿åï¼Œä¸‹æ¬¡è°ƒåº¦é‡æ–°åˆ†é…åˆ†ç‰‡&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…¨å¼‚æ­¥æµç¨‹
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦è§¦å‘ã€ä»»åŠ¡æ‰§è¡Œã€ç»“æœå›è°ƒå…¨é“¾è·¯å¼‚æ­¥åŒ–ï¼Œé¿å…é˜»å¡è°ƒåº¦çº¿ç¨‹ï¼Œæ”¯æŒé•¿ä»»åŠ¡è¿è¡Œ&lt;a class="link" href="@ref" &gt;1,8&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é˜»å¡å¤„ç†ç­–ç•¥
&lt;ul&gt;
&lt;li&gt;é’ˆå¯¹å¯†é›†è°ƒåº¦åœºæ™¯æä¾›ç­–ç•¥ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•æœºä¸²è¡Œ&lt;/strong&gt;ï¼ˆé»˜è®¤ï¼‰ï¼šä»»åŠ¡æ’é˜Ÿæ‰§è¡Œã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸¢å¼ƒåç»­è°ƒåº¦&lt;/strong&gt;ï¼šè·³è¿‡æ–°è°ƒåº¦è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¦†ç›–ä¹‹å‰è°ƒåº¦&lt;/strong&gt;ï¼šç»ˆæ­¢è¿è¡Œä¸­ä»»åŠ¡ï¼Œæ‰§è¡Œæ–°è°ƒåº¦&lt;a class="link" href="@ref" &gt;1,3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-5"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;XXL-JOB çš„åˆ†å¸ƒå¼è°ƒåº¦èƒ½åŠ›æºäºå…¶&lt;strong&gt;è§£è€¦çš„æ¶æ„è®¾è®¡&lt;/strong&gt;ä¸&lt;strong&gt;ç²¾ç»†åŒ–ç­–ç•¥æ§åˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒ&lt;/strong&gt;ï¼šé€šè¿‡é›†ç¾¤åŒ–ä¸æ—¶é—´è½®ç®—æ³•ä¿éšœè°ƒåº¦é«˜å¯ç”¨ä¸æ—¶æ•ˆæ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨&lt;/strong&gt;ï¼šå€ŸåŠ©è·¯ç”±ç­–ç•¥ã€åˆ†ç‰‡æœºåˆ¶å®ç°è´Ÿè½½å‡è¡¡ä¸æ°´å¹³æ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨æµç¨‹ç®¡æ§&lt;/strong&gt;ï¼šä»åŠ¨æ€æ³¨å†Œåˆ°å¤±è´¥é‡è¯•ï¼Œè¦†ç›–åˆ†å¸ƒå¼ä»»åŠ¡çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®è·µå»ºè®®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒ&lt;/strong&gt;ï¼šè‡³å°‘éƒ¨ç½²2èŠ‚ç‚¹ + Nginxè´Ÿè½½å‡è¡¡ï¼Œæ•°æ®åº“å¼ºåˆ¶èµ°ä¸»åº“&lt;a class="link" href="@ref" &gt;3,4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨&lt;/strong&gt;ï¼šä¸ä¸šåŠ¡æœåŠ¡åŒæœºéƒ¨ç½²ï¼Œé€šè¿‡å”¯ä¸€ &lt;code&gt;appname&lt;/code&gt; æ ‡è¯†é›†ç¾¤&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚
å®˜æ–¹æ–‡æ¡£ï¼š&lt;a class="link" href="https://github.com/xuxueli/xxl-job" target="_blank" rel="noopener"
&gt;XXL-JOB GitHub&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="é”™è¯¯é‡è¯•"&gt;é”™è¯¯é‡è¯•
&lt;/h2&gt;&lt;p&gt;XXL-JOB å®ç°ä»»åŠ¡è°ƒåº¦ä¸é”™è¯¯é‡è¯•çš„æ ¸å¿ƒæœºåˆ¶åŸºäºå…¶&lt;strong&gt;ä¸­å¿ƒåŒ–è°ƒåº¦&lt;/strong&gt;ä¸&lt;strong&gt;åˆ†å¸ƒå¼æ‰§è¡Œ&lt;/strong&gt;çš„æ¶æ„è®¾è®¡ï¼Œç»“åˆå¤šç§ç­–ç•¥ä¿éšœä»»åŠ¡çš„å¯é æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åŸç†åŠå®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-ä»»åŠ¡è°ƒåº¦æœºåˆ¶"&gt;â±ï¸ &lt;strong&gt;ä»»åŠ¡è°ƒåº¦æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è°ƒåº¦ä¸­å¿ƒadminçš„æ ¸å¿ƒä½œç”¨"&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒï¼ˆAdminï¼‰çš„æ ¸å¿ƒä½œç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€è°ƒåº¦ä¸­æ¢&lt;/strong&gt;ï¼šè´Ÿè´£ä»»åŠ¡çš„è§¦å‘ã€è·¯ç”±å’ŒçŠ¶æ€ç›‘æ§ï¼Œæ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼ˆå¤šèŠ‚ç‚¹å…±äº«åŒä¸€æ•°æ®åº“ï¼‰ï¼Œé€šè¿‡æ•°æ®åº“é”ï¼ˆ&lt;code&gt;xxl_job_lock&lt;/code&gt;ï¼‰ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹è°ƒåº¦å”¯ä¸€æ€§&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ—¶é—´è½®ç®—æ³•ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ScheduleThread&lt;/strong&gt;ï¼šé¢„è¯»æœªæ¥5ç§’å†…çš„ä»»åŠ¡ï¼ŒåŠ è½½è‡³æ—¶é—´è½®çš„ç¯å½¢é˜Ÿåˆ—ä¸­ï¼Œå‡å°‘æ•°æ®åº“è½®è¯¢å‹åŠ›&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RingThread&lt;/strong&gt;ï¼šæ¯ç§’æ£€æµ‹å½“å‰æ—¶é—´æ§½ä½ä»»åŠ¡å¹¶è§¦å‘æ‰§è¡Œï¼Œé¿å…ä»»åŠ¡å †ç§¯æˆ–é—æ¼&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è°ƒåº¦çº¿ç¨‹æ± éš”ç¦»ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿«çº¿ç¨‹æ± &lt;/strong&gt;ï¼šå¤„ç†å¸¸è§„ä»»åŠ¡ï¼ˆå¦‚çŸ­æ—¶ä»»åŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ…¢çº¿ç¨‹æ± &lt;/strong&gt;ï¼šå¤„ç†é•¿è€—æ—¶ä»»åŠ¡ï¼Œé¿å…é˜»å¡è°ƒåº¦çº¿ç¨‹&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä»»åŠ¡è§¦å‘æµç¨‹"&gt;&lt;strong&gt;ä»»åŠ¡è§¦å‘æµç¨‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦è§¦å‘&lt;/strong&gt;ï¼šæ ¹æ®ä»»åŠ¡é…ç½®çš„è§¦å‘ç­–ç•¥ï¼ˆå¦‚Cronè¡¨è¾¾å¼ã€å›ºå®šé—´éš”ï¼‰ç”Ÿæˆè°ƒåº¦è¯·æ±‚&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±é€‰æ‹©&lt;/strong&gt;ï¼šæ ¹æ®é¢„è®¾çš„è·¯ç”±ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€æ•…éšœè½¬ç§»ã€ä¸€è‡´æ€§HASHï¼‰é€‰æ‹©ç›®æ ‡æ‰§è¡Œå™¨èŠ‚ç‚¹&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTPè¯·æ±‚å‘é€&lt;/strong&gt;ï¼šè°ƒåº¦ä¸­å¿ƒå‘æ‰§è¡Œå™¨çš„&lt;code&gt;/run&lt;/code&gt;æ¥å£å‘é€ä»»åŠ¡æ‰§è¡Œè¯·æ±‚&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥å›è°ƒ&lt;/strong&gt;ï¼šæ‰§è¡Œå™¨å®Œæˆä»»åŠ¡åï¼Œé€šè¿‡&lt;code&gt;/callback&lt;/code&gt;æ¥å£è¿”å›ç»“æœï¼Œæ›´æ–°ä»»åŠ¡çŠ¶æ€å’Œæ—¥å¿—&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="å…³é”®è°ƒåº¦ç­–ç•¥"&gt;&lt;strong&gt;å…³é”®è°ƒåº¦ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠŸèƒ½è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒåº¦è¿‡æœŸç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é”™è¿‡è§¦å‘æ—¶é—´æ—¶ï¼Œé€‰æ‹©å¿½ç•¥æˆ–ç«‹å³è¡¥å¿æ‰§è¡Œä¸€æ¬¡ï¼ˆ&lt;code&gt;FIRE_ONCE_NOW&lt;/code&gt;ï¼‰&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æœåŠ¡é‡å¯æˆ–çº¿ç¨‹é˜»å¡åçš„ä»»åŠ¡æ¢å¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é˜»å¡å¤„ç†ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒ…æ‹¬å•æœºä¸²è¡Œï¼ˆé»˜è®¤ï¼‰ã€ä¸¢å¼ƒåç»­è°ƒåº¦ã€è¦†ç›–ä¹‹å‰è°ƒåº¦&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ä»»åŠ¡é˜²å †ç§¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†ç‰‡å¹¿æ’­&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»»åŠ¡å¹¿æ’­è‡³æ‰€æœ‰æ‰§è¡Œå™¨ï¼Œé…åˆåˆ†ç‰‡å‚æ•°ï¼ˆindex/totalï¼‰å¹¶è¡Œå¤„ç†æ•°æ®å­é›†&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;å¤§æ•°æ®é‡å¤„ç†ï¼ˆå¦‚ETLä»»åŠ¡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="-é”™è¯¯é‡è¯•æœºåˆ¶"&gt;ğŸ” &lt;strong&gt;é”™è¯¯é‡è¯•æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å†…ç½®é‡è¯•èƒ½åŠ›"&gt;&lt;strong&gt;å†…ç½®é‡è¯•èƒ½åŠ›&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡çº§é‡è¯•&lt;/strong&gt;ï¼š
åœ¨ä»»åŠ¡é…ç½®ä¸­è®¾ç½®&lt;strong&gt;å¤±è´¥é‡è¯•æ¬¡æ•°&lt;/strong&gt;â€‹ï¼ˆå¦‚3æ¬¡ï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œå¤±è´¥åè‡ªåŠ¨è§¦å‘é‡è¯•ï¼Œé—´éš”æ—¶é—´å¯é…ç½®&lt;a class="link" href="@ref" &gt;2,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡ä»»åŠ¡é‡è¯•&lt;/strong&gt;ï¼š
æ”¯æŒåˆ†ç‰‡ç²’åº¦é‡è¯•ï¼Œä»…é‡è¯•å¤±è´¥çš„åˆ†ç‰‡ï¼Œè€Œéæ•´ä¸ªä»»åŠ¡&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®¹é”™ä¸æ•…éšœè½¬ç§»"&gt;&lt;strong&gt;å®¹é”™ä¸æ•…éšœè½¬ç§»&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœè½¬ç§»ï¼ˆFAILOVERï¼‰&lt;/strong&gt;ï¼š
è‹¥æŸæ‰§è¡Œå™¨èŠ‚ç‚¹å®•æœºï¼Œè°ƒåº¦ä¸­å¿ƒè‡ªåŠ¨å°†ä»»åŠ¡è·¯ç”±è‡³å…¶ä»–å¥åº·èŠ‚ç‚¹é‡æ–°æ‰§è¡Œ&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt;ï¼š
è®¾ç½®ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆå¦‚30åˆ†é’Ÿï¼‰ï¼Œè¶…æ—¶åä¸»åŠ¨ä¸­æ–­ä»»åŠ¡å¹¶è§¦å‘é‡è¯•æˆ–å‘Šè­¦&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰©å±•é‡è¯•ç­–ç•¥ç»“åˆç¬¬ä¸‰æ–¹åº“"&gt;&lt;strong&gt;æ‰©å±•é‡è¯•ç­–ç•¥ï¼ˆç»“åˆç¬¬ä¸‰æ–¹åº“ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€å¤æ‚é‡è¯•é€»è¾‘ï¼ˆå¦‚æŒ‡æ•°é€€é¿ï¼‰ï¼Œå¯é›†æˆ&lt;code&gt;Spring Retry&lt;/code&gt;æˆ–&lt;code&gt;Guava Retrying&lt;/code&gt;&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.springframework.retry.annotation.Backoff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.springframework.retry.annotation.Retryable&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Retryable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxAttempts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;backoff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Backoff&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2000&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;syncOrderData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸šåŠ¡é€»è¾‘ï¼ˆå¤±è´¥æ—¶æŒ‰2ç§’é—´éš”é‡è¯•5æ¬¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å¤±è´¥å‘Šè­¦ä¸æ—¥å¿—"&gt;&lt;strong&gt;å¤±è´¥å‘Šè­¦ä¸æ—¥å¿—&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘Šè­¦æœºåˆ¶&lt;/strong&gt;ï¼šä»»åŠ¡å¤±è´¥åè‡ªåŠ¨å‘é€é‚®ä»¶/é’‰é’‰é€šçŸ¥ï¼Œå¹¶æ”¯æŒæ‰©å±•çŸ­ä¿¡ç­‰æ¸ é“&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—è¿½è¸ª&lt;/strong&gt;ï¼šé€šè¿‡è°ƒåº¦ä¸­å¿ƒå®æ—¶æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ï¼ˆåŒ…æ‹¬é‡è¯•è®°å½•ï¼‰ï¼Œæ”¯æŒRollingæ–¹å¼ç›‘æ§æ‰§è¡Œè¿›åº¦&lt;a class="link" href="@ref" &gt;4&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è°ƒåº¦ä¸é‡è¯•çš„ååŒæµç¨‹"&gt;âš¡ &lt;strong&gt;è°ƒåº¦ä¸é‡è¯•çš„ååŒæµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡è§¦å‘&lt;/strong&gt;ï¼šè°ƒåº¦ä¸­å¿ƒæ ¹æ®Cronè§„åˆ™è§¦å‘ä»»åŠ¡ï¼Œç”Ÿæˆè°ƒåº¦æ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå¤±è´¥&lt;/strong&gt;ï¼šæ‰§è¡Œå™¨è¿”å›å¤±è´¥çŠ¶æ€ï¼ˆå¦‚ç½‘ç»œè¶…æ—¶ã€ä¸šåŠ¡å¼‚å¸¸ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨é‡è¯•ï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ä¸­å¿ƒæ ¹æ®é…ç½®çš„é‡è¯•æ¬¡æ•°ï¼Œé‡æ–°ç”Ÿæˆè°ƒåº¦è¯·æ±‚&lt;a class="link" href="@ref" &gt;5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥å¯ç”¨æ•…éšœè½¬ç§»ï¼Œè‡ªåŠ¨åˆ‡æ¢è‡³å…¶ä»–æ‰§è¡Œå™¨èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆå¤„ç†ï¼š
&lt;ul&gt;
&lt;li&gt;é‡è¯•æˆåŠŸï¼šæ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºæˆåŠŸï¼Œè®°å½•æ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;é‡è¯•è€—å°½ï¼šæ ‡è®°ä»»åŠ¡å¤±è´¥ï¼Œè§¦å‘å‘Šè­¦é€šçŸ¥è´Ÿè´£äºº&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æœ€ä½³å®è·µå»ºè®®"&gt;ğŸ§© &lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;é‡è¯•å‚æ•°é…ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;çŸ­æ—¶ä»»åŠ¡ï¼šé‡è¯•é—´éš”å»ºè®®1~5ç§’ï¼Œé¿å…å †ç§¯ã€‚&lt;/li&gt;
&lt;li&gt;é•¿æ—¶ä»»åŠ¡ï¼šè®¾ç½®è¾ƒå¤§è¶…æ—¶æ—¶é—´ï¼ˆå¦‚å°æ—¶çº§ï¼‰ï¼Œé‡è¯•é—´éš”æŒ‰åˆ†é’Ÿé€’å¢&lt;a class="link" href="@ref" &gt;1,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§è®¾è®¡&lt;/strong&gt;ï¼š
åœ¨ä»»åŠ¡é€»è¾‘ä¸­ä¿è¯&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;â€‹ï¼ˆå¦‚æ•°æ®åº“å”¯ä¸€é”®ã€Redisé”ï¼‰ï¼Œé˜²æ­¢é‡è¯•å¯¼è‡´æ•°æ®é‡å¤&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤éƒ¨ç½²ä¼˜åŒ–ï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ä¸­å¿ƒï¼šè‡³å°‘2èŠ‚ç‚¹ + Nginxè´Ÿè½½å‡è¡¡ï¼Œæ•°æ®åº“å¼ºåˆ¶èµ°ä¸»åº“ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨ï¼šä¸ä¸šåŠ¡æœåŠ¡åŒæœºéƒ¨ç½²ï¼Œé€šè¿‡å”¯ä¸€&lt;code&gt;appname&lt;/code&gt;æ ‡è¯†é›†ç¾¤&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-6"&gt;ğŸ’ &lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;XXL-JOB é€šè¿‡&lt;strong&gt;æ—¶é—´è½®è°ƒåº¦&lt;/strong&gt;ã€&lt;strong&gt;è·¯ç”±ç­–ç•¥&lt;/strong&gt;å’Œ&lt;strong&gt;å¤šçº§é‡è¯•æœºåˆ¶&lt;/strong&gt;ï¼Œå®ç°äº†é«˜å¯é çš„ä»»åŠ¡è°ƒåº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦é«˜æ•ˆæ€§&lt;/strong&gt;ï¼šé¢„è¯»ä»»åŠ¡ + åŒçº¿ç¨‹åä½œå‡å°‘æ•°æ®åº“å‹åŠ›&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”™è¯¯å®¹å¿åº¦&lt;/strong&gt;ï¼šå†…ç½®é‡è¯• + æ•…éšœè½¬ç§» + è¶…æ—¶æ§åˆ¶ä¿éšœä»»åŠ¡æœ€ç»ˆæˆåŠŸ&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•çµæ´»æ€§&lt;/strong&gt;ï¼šæ”¯æŒç¬¬ä¸‰æ–¹é‡è¯•åº“é›†æˆï¼Œé€‚åº”å¤æ‚ä¸šåŠ¡åœºæ™¯&lt;a class="link" href="@ref" &gt;1&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£å‚è€ƒï¼š&lt;a class="link" href="https://github.com/xuxueli/xxl-job" target="_blank" rel="noopener"
&gt;XXL-JOB GitHub&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="æ‰§è¡Œå™¨"&gt;æ‰§è¡Œå™¨
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Cloud + Spring Bootç¯å¢ƒä¸­å®šä¹‰XXL-JOBæ‰§è¡Œå™¨ï¼Œéœ€é€šè¿‡&lt;strong&gt;ä¾èµ–é…ç½®ã€æ‰§è¡Œå™¨å‚æ•°å®šä¹‰ã€Spring Beanæ³¨å†ŒåŠä»»åŠ¡å¤„ç†å™¨å¼€å‘&lt;/strong&gt;å››æ­¥å®Œæˆã€‚ä»¥ä¸‹æ˜¯å…·ä½“æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ·»åŠ ä¾èµ–"&gt;ğŸ”§ æ·»åŠ ä¾èµ–
&lt;/h3&gt;&lt;p&gt;åœ¨é¡¹ç›®çš„&lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ XXL-JOBæ ¸å¿ƒä¾èµ–ï¼ˆç‰ˆæœ¬éœ€ä¸è°ƒåº¦ä¸­å¿ƒä¸€è‡´ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
&amp;lt;groupId&amp;gt;com.xuxueli&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;xxl-job-core&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;2.4.2&amp;lt;/version&amp;gt; &amp;lt;!-- æ¨èä½¿ç”¨2.4.xç‰ˆæœ¬ --&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šç‰ˆæœ¬éœ€ä¸è°ƒåº¦ä¸­å¿ƒå…¼å®¹ï¼Œå¦åˆ™å¯èƒ½é€šä¿¡å¤±è´¥&lt;a class="link" href="@ref" &gt;2,5,6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®æ‰§è¡Œå™¨å‚æ•°"&gt;âš™ï¸ é…ç½®æ‰§è¡Œå™¨å‚æ•°
&lt;/h3&gt;&lt;p&gt;åœ¨&lt;code&gt;application.yml&lt;/code&gt;æˆ–&lt;code&gt;application.properties&lt;/code&gt;ä¸­é…ç½®æ‰§è¡Œå™¨å‚æ•°ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;xxl:
job:
admin:
addresses: http://localhost:8080/xxl-job-admin # è°ƒåº¦ä¸­å¿ƒåœ°å€ï¼ˆé›†ç¾¤ç”¨é€—å·åˆ†éš”ï¼‰
accessToken: default_token # ä¸è°ƒåº¦ä¸­å¿ƒä¸€è‡´çš„Token[5,6](@ref)
executor:
appname: xxl-job-executor-sample # æ‰§è¡Œå™¨åç§°ï¼ˆè°ƒåº¦ä¸­å¿ƒæ®æ­¤åˆ†ç»„ï¼‰
port: 9999 # æ‰§è¡Œå™¨ç«¯å£ï¼ˆå•æœºå¤šå®ä¾‹éœ€ä¸åŒç«¯å£ï¼‰
logpath: /data/applogs/xxl-job/jobhandler # ä»»åŠ¡æ—¥å¿—å­˜å‚¨è·¯å¾„
logretentiondays: 30 # æ—¥å¿—ä¿ç•™å¤©æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®é…ç½®è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;appname&lt;/code&gt;&lt;strong&gt;å¿…é¡»ä¸è°ƒåº¦ä¸­å¿ƒæ‰§è¡Œå™¨é…ç½®ä¸€è‡´&lt;/strong&gt;ï¼Œå¦åˆ™æ³¨å†Œå¤±è´¥&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;port&lt;/code&gt;&lt;strong&gt;é¿å…å†²çª&lt;/strong&gt;ï¼šå•æœºéƒ¨ç½²å¤šä¸ªæ‰§è¡Œå™¨æ—¶éœ€è®¾ç½®ä¸åŒç«¯å£ï¼ˆå¦‚9999ã€10000ï¼‰&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;accessToken&lt;/code&gt;&lt;strong&gt;å¿…å¡«&lt;/strong&gt;ï¼šè‹¥è°ƒåº¦ä¸­å¿ƒå¯ç”¨Tokenæ ¡éªŒï¼Œæ­¤å¤„éœ€ä¿æŒä¸€è‡´&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨å†Œæ‰§è¡Œå™¨spring-bean"&gt;ğŸ§© æ³¨å†Œæ‰§è¡Œå™¨Spring Bean
&lt;/h3&gt;&lt;p&gt;åˆ›å»ºé…ç½®ç±»ï¼Œå°†æ‰§è¡Œå™¨æ³¨å…¥Springå®¹å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;XxlJobConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;${xxl.job.admin.addresses}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;adminAddresses&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;${xxl.job.executor.appname}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;appname&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;${xxl.job.executor.port}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XxlJobSpringExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;xxlJobExecutor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XxlJobSpringExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XxlJobSpringExecutor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setAdminAddresses&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;adminAddresses&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setAppname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;appname&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setPort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯¥Beanå¯åŠ¨æ—¶&lt;strong&gt;è‡ªåŠ¨å‘è°ƒåº¦ä¸­å¿ƒæ³¨å†Œ&lt;/strong&gt;æ‰§è¡Œå™¨&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒ&lt;strong&gt;åŠ¨æ€æ„ŸçŸ¥&lt;/strong&gt;æ‰§è¡Œå™¨ä¸Šçº¿/ä¸‹çº¿ï¼Œå®ç°é«˜å¯ç”¨&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å®šä¹‰ä»»åŠ¡å¤„ç†å™¨"&gt;ğŸ› ï¸ å®šä¹‰ä»»åŠ¡å¤„ç†å™¨
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;@XxlJob&lt;/code&gt;æ³¨è§£å¼€å‘ä»»åŠ¡é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Component
public class SampleJobHandler {
// 1. ç®€å•ä»»åŠ¡ç¤ºä¾‹
@XxlJob(&amp;#34;demoJobHandler&amp;#34;)
public void demoJobHandler() {
System.out.println(&amp;#34;XXL-JOBä»»åŠ¡æ‰§è¡ŒæˆåŠŸ, æ—¶é—´: &amp;#34; + new Date());
}
// 2. åˆ†ç‰‡ä»»åŠ¡ç¤ºä¾‹
@XxlJob(&amp;#34;shardingJobHandler&amp;#34;)
public void shardingJobHandler() {
int shardIndex = XxlJobHelper.getShardIndex(); // å½“å‰åˆ†ç‰‡ç´¢å¼•
int shardTotal = XxlJobHelper.getShardTotal(); // æ€»åˆ†ç‰‡æ•°
System.out.printf(&amp;#34;åˆ†ç‰‡ä»»åŠ¡: %d/%d%n&amp;#34;, shardIndex, shardTotal);
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨è§£è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@XxlJob(&amp;quot;demoJobHandler&amp;quot;)&lt;/code&gt;ä¸­&lt;code&gt;demoJobHandler&lt;/code&gt;ä¸º&lt;strong&gt;JobHandleråç§°&lt;/strong&gt;ï¼Œéœ€ä¸è°ƒåº¦ä¸­å¿ƒä»»åŠ¡é…ç½®ä¸€è‡´&lt;a class="link" href="@ref" &gt;5,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ³•å†…å¯é€šè¿‡&lt;code&gt;XxlJobHelper&lt;/code&gt;&lt;strong&gt;è·å–ä»»åŠ¡å‚æ•°&lt;/strong&gt;ã€åˆ†ç‰‡ä¿¡æ¯ç­‰ä¸Šä¸‹æ–‡&lt;a class="link" href="@ref" &gt;3,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹ä¸é«˜çº§é…ç½®"&gt;âš ï¸ æ³¨æ„äº‹é¡¹ä¸é«˜çº§é…ç½®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç›¸åŒ&lt;code&gt;appname&lt;/code&gt;çš„æ‰§è¡Œå™¨è‡ªåŠ¨ç»„æˆé›†ç¾¤ï¼Œè°ƒåº¦ä¸­å¿ƒæŒ‰&lt;strong&gt;è·¯ç”±ç­–ç•¥&lt;/strong&gt;ï¼ˆè½®è¯¢ã€æ•…éšœè½¬ç§»ç­‰ï¼‰åˆ†å‘ä»»åŠ¡&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ‰§è¡Œå™¨å®ä¾‹çš„&lt;code&gt;port&lt;/code&gt;éœ€å”¯ä¸€ï¼Œé¿å…ç«¯å£å†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦ä¸­å¿ƒé€šä¿¡å®‰å…¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®&lt;code&gt;accessToken&lt;/code&gt;ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®&lt;a class="link" href="@ref" &gt;5,7&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—ä¸ç›‘æ§&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»»åŠ¡æ—¥å¿—å­˜å‚¨åœ¨&lt;code&gt;logpath&lt;/code&gt;ç›®å½•ï¼Œå¯é€šè¿‡è°ƒåº¦ä¸­å¿ƒ&lt;strong&gt;å®æ—¶æŸ¥çœ‹&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;3&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨å¼‚å¸¸æ—¶ï¼Œè°ƒåº¦ä¸­å¿ƒè‡ªåŠ¨è§¦å‘&lt;strong&gt;å¤±è´¥é‡è¯•&lt;/strong&gt;æˆ–&lt;strong&gt;æ•…éšœè½¬ç§»&lt;/strong&gt;&lt;a class="link" href="@ref" &gt;2&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;
æ‰§è¡Œå™¨é»˜è®¤æ¯30ç§’å‘è°ƒåº¦ä¸­å¿ƒå‘é€&lt;strong&gt;å¿ƒè·³&lt;/strong&gt;ï¼Œç¦»çº¿èŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨å‰”é™¤&lt;a class="link" href="@ref" &gt;3,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ‰§è¡Œå™¨æ³¨å†Œæµç¨‹ç¤ºæ„å›¾"&gt;ğŸ”„ æ‰§è¡Œå™¨æ³¨å†Œæµç¨‹ç¤ºæ„å›¾
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;graph LR
A[Spring Bootå¯åŠ¨] --&amp;gt; B[åŠ è½½XxlJobConfigé…ç½®]
B --&amp;gt; C[æ³¨å†ŒXxlJobSpringExecutor]
C --&amp;gt; D[å‘è°ƒåº¦ä¸­å¿ƒå‘é€æ³¨å†Œè¯·æ±‚]
D --&amp;gt; E{æ³¨å†ŒæˆåŠŸï¼Ÿ}
E --&amp;gt;|æ˜¯| F[æ‰§è¡Œå™¨çŠ¶æ€åœ¨çº¿]
E --&amp;gt;|å¦| G[æ£€æŸ¥é…ç½®åé‡è¯•]
F --&amp;gt; H[ç­‰å¾…è°ƒåº¦ä»»åŠ¡]
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æ€»ç»“-7"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæ­¥éª¤&lt;/strong&gt;ï¼šä¾èµ– â†’ é…ç½® â†’ æ³¨å†ŒBean â†’ å¼€å‘&lt;code&gt;@XxlJob&lt;/code&gt;ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;é¿å‘ç‚¹ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;appname&lt;/code&gt;ã€&lt;code&gt;accessToken&lt;/code&gt;&lt;strong&gt;å¿…é¡»ä¸è°ƒåº¦ä¸­å¿ƒä¸€è‡´&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç¯å¢ƒä¸‹&lt;strong&gt;ç«¯å£å”¯ä¸€&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•èƒ½åŠ›&lt;/strong&gt;ï¼šç»“åˆåˆ†ç‰‡å‚æ•°å®ç°&lt;strong&gt;å¤§æ•°æ®å¹¶è¡Œå¤„ç†&lt;/strong&gt;ï¼Œé€šè¿‡&lt;code&gt;XxlJobHelper&lt;/code&gt;åŠ¨æ€æ§åˆ¶ä»»åŠ¡é€»è¾‘&lt;a class="link" href="@ref" &gt;2,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å®Œæˆä¸Šè¿°é…ç½®åï¼Œå¯åŠ¨Spring BootæœåŠ¡ï¼Œæ‰§è¡Œå™¨å°†è‡ªåŠ¨æ³¨å†Œè‡³è°ƒåº¦ä¸­å¿ƒã€‚åœ¨è°ƒåº¦ä¸­å¿ƒ&lt;strong&gt;ä»»åŠ¡ç®¡ç†&lt;/strong&gt;é¡µé¢é…ç½®JobHandleråç§°ï¼ˆå¦‚&lt;code&gt;demoJobHandler&lt;/code&gt;ï¼‰ï¼Œå³å¯è§¦å‘ä»»åŠ¡æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="remove"&gt;remove
&lt;/h2&gt;&lt;p&gt;åœ¨ XXL-JOB ä¸­ï¼Œ&lt;code&gt;/api/jobinfo/remove&lt;/code&gt; æ¥å£ç”¨äºåˆ é™¤ä»»åŠ¡ï¼Œå…¶å‚æ•°å’ŒæŒ‰â€œå·²åœæ­¢â€çŠ¶æ€åˆ é™¤çš„æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-apijobinforemove-æ¥å£å‚æ•°"&gt;âš™ï¸ &lt;code&gt;/api/jobinfo/remove&lt;/code&gt; æ¥å£å‚æ•°
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å‚æ•°ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å‚æ•°å&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦å¿…å¡«&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¯å¾„å‚æ•°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;éœ€è¦åˆ é™¤çš„ä»»åŠ¡ IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ ç¤ºä¾‹ï¼š&lt;code&gt;/api/jobinfo/remove/1001&lt;/code&gt; è¡¨ç¤ºåˆ é™¤ ID=1001 çš„ä»»åŠ¡ &lt;a class="link" href="@ref" &gt;1,7&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Header&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;XXL-JOB-ACCESS-TOKEN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ˜¯&lt;/td&gt;
&lt;td&gt;è°ƒåº¦ä¸­å¿ƒé…ç½®çš„è®¿é—®ä»¤ç‰Œï¼ˆéœ€ä¸ &lt;code&gt;xxl.job.accessToken&lt;/code&gt; ä¸€è‡´ï¼‰&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è°ƒç”¨ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;curl -X DELETE http://localhost:8080/api/jobinfo/remove/1001 \
-H &amp;#34;XXL-JOB-ACCESS-TOKEN: default_token&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="-æŒ‰å·²åœæ­¢çŠ¶æ€åˆ é™¤ä»»åŠ¡çš„æ­¥éª¤"&gt;ğŸ—‘ï¸ æŒ‰â€œå·²åœæ­¢â€çŠ¶æ€åˆ é™¤ä»»åŠ¡çš„æ­¥éª¤
&lt;/h3&gt;&lt;p&gt;XXL-JOB æœªæä¾›ç›´æ¥æŒ‰çŠ¶æ€åˆ é™¤çš„ APIï¼Œéœ€ç»“åˆæŸ¥è¯¢æ¥å£å’Œåˆ é™¤æ¥å£å®ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢æ‰€æœ‰ä»»åŠ¡&lt;/strong&gt;
è°ƒç”¨ &lt;code&gt;/jobinfo/pageList&lt;/code&gt; æ¥å£ï¼ˆGET è¯·æ±‚ï¼‰ï¼Œè·å–ä»»åŠ¡åˆ—è¡¨ï¼Œç­›é€‰ &lt;code&gt;trigger_status=0&lt;/code&gt;ï¼ˆå¯¹åº”â€œå·²åœæ­¢â€çŠ¶æ€ï¼‰çš„ä»»åŠ¡ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;curl -X GET &amp;#34;http://localhost:8080/jobinfo/pageList?triggerStatus=0&amp;#34;
&lt;/code&gt;&lt;/pre&gt;è¿”å›ç»“æœä¸­çš„ &lt;code&gt;records&lt;/code&gt; æ•°ç»„åŒ…å«æ‰€æœ‰å·²åœæ­¢ä»»åŠ¡çš„ä¿¡æ¯ï¼ˆå«ä»»åŠ¡ IDï¼‰&lt;a class="link" href="@ref" &gt;1,6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡åˆ é™¤ä»»åŠ¡&lt;/strong&gt;
éå†ä¸Šä¸€æ­¥è·å–çš„ä»»åŠ¡ ID åˆ—è¡¨ï¼Œé€ä¸ªè°ƒç”¨ &lt;code&gt;/api/jobinfo/remove/{id}&lt;/code&gt; åˆ é™¤ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;# ç¤ºä¾‹ï¼šåˆ é™¤ ID ä¸º 1001 å’Œ 1002 çš„ä»»åŠ¡
curl -X DELETE http://localhost:8080/api/jobinfo/remove/1001 -H &amp;#34;XXL-JOB-ACCESS-TOKEN: default_token&amp;#34;
curl -X DELETE http://localhost:8080/api/jobinfo/remove/1002 -H &amp;#34;XXL-JOB-ACCESS-TOKEN: default_token&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-5"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æƒé™ä¸å®‰å…¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿è°ƒç”¨ API æ—¶æºå¸¦æ­£ç¡®çš„ &lt;code&gt;XXL-JOB-ACCESS-TOKEN&lt;/code&gt;ï¼Œå¦åˆ™ä¼šè¿”å› &lt;code&gt;401&lt;/code&gt; é”™è¯¯&lt;a class="link" href="@ref" &gt;3,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡æœåŠ¡ç«¯ä»£ç†è°ƒç”¨ APIï¼Œé¿å…ä»¤ç‰Œæ³„éœ²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€ä¸åˆ é™¤é€»è¾‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;â€œå·²åœæ­¢â€çŠ¶æ€åœ¨æ•°æ®åº“ä¸­å¯¹åº” &lt;code&gt;xxl_job_info.trigger_status=0&lt;/code&gt;&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åˆ é™¤æ“ä½œæ˜¯ç‰©ç†åˆ é™¤ï¼ˆç›´æ¥ä»æ•°æ®åº“ç§»é™¤è®°å½•ï¼‰ï¼Œä¸å¯æ¢å¤&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆï¼ˆæ§åˆ¶å°æ“ä½œï¼‰&lt;/strong&gt;
è‹¥æ— éœ€è‡ªåŠ¨åŒ–ï¼Œå¯ç›´æ¥åœ¨ XXL-JOB ç®¡ç†å°æ“ä½œï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š
ä»»åŠ¡ç®¡ç† â†’ ç­›é€‰â€œå·²åœæ­¢â€çŠ¶æ€ â†’ å‹¾é€‰ä»»åŠ¡ â†’ ç‚¹å‡»â€œåˆ é™¤â€æŒ‰é’®&lt;a class="link" href="@ref" &gt;4,5&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“å»ºè®®"&gt;ğŸ’ æ€»ç»“å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ“ä½œæ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¤æ‚åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;API æ‰¹é‡åˆ é™¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ¸…ç†å¤§é‡ä»»åŠ¡æˆ–é›†æˆè‡ªåŠ¨åŒ–è„šæœ¬&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ§åˆ¶å°æ‰‹åŠ¨åˆ é™¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸´æ—¶æ¸…ç†å°‘é‡ä»»åŠ¡æˆ–è¿ç»´æ“ä½œ&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¨èé€šè¿‡ API åˆ é™¤æ—¶ï¼Œå…ˆå¤‡ä»½æ•°æ®åº“è¡¨ &lt;code&gt;xxl_job_info&lt;/code&gt;ï¼Œé¿å…è¯¯åˆ é‡è¦ä»»åŠ¡é…ç½®&lt;a class="link" href="@ref" &gt;6&lt;/a&gt;ã€‚
æ›´å¤š API ç»†èŠ‚å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š&lt;a class="link" href="https://github.com/xuxueli/xxl-job" target="_blank" rel="noopener"
&gt;XXL-JOB GitHub&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 17</title><link>https://dyhes.github.io/p/postopia-dev-logweek-17/</link><pubDate>Mon, 02 Jun 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-17/</guid><description>&lt;h2 id="é—®é¢˜spring-cloud-gateway-å¶å‘æŠ¥-400-badrequest"&gt;é—®é¢˜ï¼šSpring Cloud Gateway å¶å‘æŠ¥ 400 BadRequest
&lt;/h2&gt;&lt;p&gt;ç‰¹åˆ«æ˜¯ä¸€ä¸ªè¯·æ±‚ä¹‹åï¼ŒæœªçŸ¥åŸå› 
ä½¿ç”¨ Retries è§£å†³&lt;/p&gt;
&lt;h2 id="transactional-è‡ªè°ƒç”¨"&gt;@Transactional è‡ªè°ƒç”¨
&lt;/h2&gt;&lt;p&gt;Spring çš„ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£åœ¨&lt;strong&gt;è‡ªè°ƒç”¨ï¼ˆself-invocationï¼‰&lt;/strong&gt; åœºæ™¯ä¸‹ä¼šå¤±æ•ˆï¼Œå³ä¸€ä¸ªç±»ä¸­çš„æ–¹æ³• A ç›´æ¥è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³• Bï¼ˆå³ä½¿ B è¢«æ ‡æ³¨äº† &lt;code&gt;@Transactional&lt;/code&gt;ï¼‰ï¼Œæ­¤æ—¶æ–¹æ³• B çš„äº‹åŠ¡ä¸ä¼šç”Ÿæ•ˆã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šå’Œè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é—®é¢˜åŸå› spring-aop-çš„ä»£ç†æœºåˆ¶é™åˆ¶"&gt;âš ï¸ é—®é¢˜åŸå› ï¼šSpring AOP çš„ä»£ç†æœºåˆ¶é™åˆ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç†æœºåˆ¶åŸç†&lt;/strong&gt;&lt;br&gt;
Spring çš„äº‹åŠ¡ç®¡ç†åŸºäº AOP ä»£ç†å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“è°ƒç”¨ &lt;code&gt;@Transactional&lt;/code&gt; æ–¹æ³•æ—¶ï¼Œå®é™…æ˜¯é€šè¿‡ Spring ç”Ÿæˆçš„&lt;strong&gt;ä»£ç†å¯¹è±¡&lt;/strong&gt;è§¦å‘äº‹åŠ¡é€»è¾‘ï¼ˆå¦‚å¼€å¯/æäº¤äº‹åŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªè°ƒç”¨&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;this.methodB()&lt;/code&gt;ï¼‰ä¼šç»•è¿‡ä»£ç†å¯¹è±¡ï¼Œç›´æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•ï¼Œå¯¼è‡´äº‹åŠ¡æ‹¦æˆªå™¨æœªè¢«è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªè°ƒç”¨ï¼Œäº‹åŠ¡å¤±æ•ˆï¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®åº“æ“ä½œï¼ˆæ— äº‹åŠ¡ä¿æŠ¤ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è§£å†³æ–¹æ¡ˆ"&gt;ğŸ”§ è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="-æ–¹æ³•-1å°†äº‹åŠ¡æ–¹æ³•æ‹†åˆ†åˆ°å¦ä¸€ä¸ª-service-ç±»"&gt;âœ… æ–¹æ³• 1ï¼šå°†äº‹åŠ¡æ–¹æ³•æ‹†åˆ†åˆ°å¦ä¸€ä¸ª Service ç±»
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ä¾èµ–æ³¨å…¥è°ƒç”¨ï¼Œç¡®ä¿é€šè¿‡ä»£ç†å¯¹è±¡è§¦å‘äº‹åŠ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ³¨å…¥å¦ä¸€ä¸ªService&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œäº‹åŠ¡ç”Ÿæ•ˆ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// äº‹åŠ¡æ“ä½œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç¬¦åˆ Spring è®¾è®¡è§„èŒƒï¼Œä»£ç æ¸…æ™°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="-æ–¹æ³•-2é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨è‡ªèº«éœ€å¼€å¯-exposeproxy"&gt;âœ… æ–¹æ³• 2ï¼šé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨è‡ªèº«ï¼ˆéœ€å¼€å¯ &lt;code&gt;exposeProxy&lt;/code&gt;ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–å½“å‰ä»£ç†å¯¹è±¡ï¼Œå†è°ƒç”¨æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;OrderService&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AopContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentProxy&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;éœ€åœ¨é…ç½®ä¸­å¯ç”¨ä»£ç†æš´éœ²&lt;/strong&gt;ï¼ˆSpring Boot å¯æ·»åŠ æ³¨è§£ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@EnableAspectJAutoProxy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exposeProxy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AppConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€ç¡®ä¿ç±»èƒ½è¢« Spring AOP ä»£ç†ï¼ˆé &lt;code&gt;private&lt;/code&gt; æ–¹æ³•ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="-æ–¹æ³•-3æ³¨å…¥è‡ªèº«ä»£ç†é¿å…å¾ªç¯ä¾èµ–"&gt;âœ… æ–¹æ³• 3ï¼šæ³¨å…¥è‡ªèº«ä»£ç†ï¼ˆé¿å…å¾ªç¯ä¾èµ–ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Lazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿæ³¨å…¥è§£å†³å¾ªç¯ä¾èµ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;selfProxy&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;selfProxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡ä»£ç†è°ƒç”¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä¸é€‚åˆæ‹†åˆ†ç±»æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å…¶ä»–å¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯"&gt;âš¡ å…¶ä»–å¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é &lt;code&gt;public&lt;/code&gt; æ–¹æ³•&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@Transactional&lt;/code&gt; åªèƒ½ç”¨äº &lt;code&gt;public&lt;/code&gt; æ–¹æ³•ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸è¢«æ•è·æœªæŠ›å‡º&lt;/strong&gt;&lt;br&gt;
äº‹åŠ¡å›æ»šéœ€æŠ›å‡ºæœªå¤„ç†çš„å¼‚å¸¸ï¼ˆé»˜è®¤ä»…å›æ»š &lt;code&gt;RuntimeException&lt;/code&gt; å’Œ &lt;code&gt;Error&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡&lt;/strong&gt;&lt;br&gt;
å¦‚ MySQL çš„ MyISAM å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ï¼Œéœ€æ”¹ç”¨ InnoDBã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ€»ç»“"&gt;ğŸ’ æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦ç”Ÿæ•ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è·¨ç±»è°ƒç”¨ &lt;code&gt;@Transactional&lt;/code&gt; æ–¹æ³•&lt;/td&gt;
&lt;td&gt;âœ… ç”Ÿæ•ˆ&lt;/td&gt;
&lt;td&gt;ä¾èµ–æ³¨å…¥è°ƒç”¨å…¶ä»– Service&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åŒç±»è‡ªè°ƒç”¨&lt;/td&gt;
&lt;td&gt;âŒ å¤±æ•ˆ&lt;/td&gt;
&lt;td&gt;æ‹†åˆ†æ–¹æ³•ã€æ³¨å…¥è‡ªèº«ä»£ç†æˆ–ä½¿ç”¨ &lt;code&gt;AopContext&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é &lt;code&gt;public&lt;/code&gt; æ–¹æ³•&lt;/td&gt;
&lt;td&gt;âŒ å¤±æ•ˆ&lt;/td&gt;
&lt;td&gt;æ”¹ä¸º &lt;code&gt;public&lt;/code&gt; æ–¹æ³•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;æç¤ºï¼šä¼˜å…ˆé€‰æ‹© &lt;strong&gt;æ‹†åˆ† Service ç±»&lt;/strong&gt; çš„æ–¹æ¡ˆï¼Œé¿å…ä»£ç†ç»•è¡Œé—®é¢˜ï¼Œç¬¦åˆ Spring äº‹åŠ¡è®¾è®¡è§„èŒƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>ã€Spring Cloudã€‘Deployment</title><link>https://dyhes.github.io/p/spring-clouddeployment/</link><pubDate>Sat, 31 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/spring-clouddeployment/</guid><description>&lt;h2 id="spring-cloud-åº”ç”¨"&gt;Spring Cloud åº”ç”¨
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="nl"&gt;plugin:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;//é»˜è®¤è¡Œä¸º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./gradlew clean build
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„å»ºæ™®é€šjaråŒ…ï¼ˆç”¨äºè¢«å…¶ä»–æœåŠ¡ä¾èµ–ï¼‰å’ŒbootJaråŒ…&lt;/p&gt;
&lt;h3 id="dockerfile"&gt;Dockerfile
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# é€‰æ‹©è½»é‡çº§åŸºç¡€é•œåƒï¼ˆæ¨èï¼‰&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;eclipse-temurin:17.0.15_6-jre-ubi9-minimal&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# è®¾ç½®å·¥ä½œç›®å½•&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/app&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# å¤åˆ¶JARæ–‡ä»¶åˆ°å®¹å™¨&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; build/libs/gateway.jar app.jar&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# æš´éœ²æœåŠ¡ç«¯å£ï¼ˆä¸å®é™…ç«¯å£ä¸€è‡´ï¼‰&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;8080&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# å¯åŠ¨å‘½ä»¤&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;ENTRYPOINT&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;java&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;-jar&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;app.jar&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="nginx"&gt;Nginx
&lt;/h2&gt;&lt;p&gt;Dockerfile&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;nginx:stable-alpine&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; rm /etc/nginx/conf.d/default.conf&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; nginx.conf /etc/nginx/conf.d/&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; dist/ /usr/share/nginx/html/&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;80&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;CMD&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;-g&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;daemon off;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;nginx.conf&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-nginx" data-lang="nginx"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;try_files&lt;/span&gt; &lt;span class="nv"&gt;$uri&lt;/span&gt; &lt;span class="nv"&gt;$uri/&lt;/span&gt; &lt;span class="s"&gt;/index.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="minikube"&gt;Minikube
&lt;/h2&gt;&lt;p&gt;å¯èƒ½å­˜åœ¨ç½‘ç»œé—®é¢˜ï¼Œåœ¨ Docker Desktop æå‰æ‹‰å–é•œåƒå&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube start --driver&lt;span class="o"&gt;=&lt;/span&gt;docker &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt;--base-image&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;kicbase/stable:v0.0.45&amp;#34;&lt;/span&gt; --memory&lt;span class="o"&gt;=&lt;/span&gt;7500mb --cpus&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;&lt;/span&gt;kubectl apply -f k8s/namespace.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/volumes/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/config/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/infra/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/backend/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f k8s/frontend/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="æŸ¥çœ‹pod"&gt;æŸ¥çœ‹pod
&lt;/h3&gt;&lt;p&gt;kubectl get pods -n postopia&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹deployment"&gt;æŸ¥çœ‹deployment
&lt;/h3&gt;&lt;p&gt;kubectl get deployments -n postopia&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹åŸå› "&gt;æŸ¥çœ‹åŸå› 
&lt;/h3&gt;&lt;p&gt;kubectl describe pod mysql -n postopia
kubectl describe svc nacos -n postopia
kubectl describe pod nacos -n postopia&lt;/p&gt;
&lt;p&gt;kubectl describe pod user-service -n postopia&lt;/p&gt;
&lt;p&gt;kubectl describe pod nacos-5bb4c6c67b-4gp4q -n postopia&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹-logs"&gt;æŸ¥çœ‹ logs
&lt;/h3&gt;&lt;p&gt;kubectl logs -l app=mysql -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -l app=gateway -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -l app=comment-service -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -f comment-service-664bdb7c6d-x4trv -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -f space-service-577f84bfcc-x2vl5 -n postopia
kubectl logs mysql-*&lt;/p&gt;
&lt;p&gt;kubectl logs -f gateway-59bd97c779-x664w -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -n postopia -f user-service-67c8888fc7-7dcvq
æŸ¥çœ‹ä¸Šæ¬¡å´©æºƒå‰æ—¥å¿—
kubectl logs -f mysql-697cc894c9-stzql -n postopia â€”previous&lt;/p&gt;
&lt;p&gt;kubectl logs -f mysql-5656bc586-nktt5 -n postopia &amp;ndash;previous&lt;/p&gt;
&lt;p&gt;kubectl logs -f mysql -n postopia&lt;/p&gt;
&lt;p&gt;kubectl logs -f nacos-54b76d5dcc-mrgkd -n postopia &amp;ndash;previous&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹ç¯å¢ƒå˜é‡"&gt;æŸ¥çœ‹ç¯å¢ƒå˜é‡
&lt;/h3&gt;&lt;p&gt;kubectl exec -it comment-service-664bdb7c6d-x4trv -n postopia &amp;ndash; env | grep REDIS_HOST&lt;/p&gt;
&lt;h3 id="æŸ¥çœ‹ç›®å½•"&gt;æŸ¥çœ‹ç›®å½•
&lt;/h3&gt;&lt;p&gt;kubectl exec -it mysql-697cc894c9-stzql -n postopia &amp;ndash; ls /var/run/mysqld/&lt;/p&gt;
&lt;h3 id="é‡å¯-deployment"&gt;é‡å¯ Deployment
&lt;/h3&gt;&lt;p&gt;kubectl rollout restart -n postopia deployment/&lt;deployment-name&gt;&lt;/p&gt;
&lt;p&gt;kubectl rollout restart deployment/nacos -n postopia&lt;/p&gt;
&lt;p&gt;kubectl rollout restart -n postopia deployment/user-service&lt;/p&gt;
&lt;p&gt;kubectl rollout restart deployment/comment -n postopia&lt;/p&gt;
&lt;h3 id="æ„å»ºé•œåƒ"&gt;æ„å»ºé•œåƒ
&lt;/h3&gt;&lt;p&gt;eval $(minikube docker-env)&lt;/p&gt;
&lt;p&gt;docker build -t postopia-nacos-mysql:latest ./nacos-mysql
docker build -t postopia-es:latest ./elastic-search
&lt;em&gt;# Build application services&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;docker build -t postopia-gateway:latest ./gateway
docker build -t postopia-user:latest ./user-service
docker build -t postopia-space:latest ./space-service
docker build -t postopia-post:latest ./post-service
docker build -t postopia-comment:latest ./comment-service
docker build -t postopia-message:latest ./message-service
docker build -t postopia-vote:latest ./vote-service
docker build -t postopia-opinion:latest ./opinion-service
docker build -t postopia-search:latest ./search-service&lt;/p&gt;
&lt;h3 id="åŠ è½½é•œåƒ"&gt;åŠ è½½é•œåƒ
&lt;/h3&gt;&lt;p&gt;minikube image load&lt;/p&gt;
&lt;h2 id="server"&gt;Server
&lt;/h2&gt;&lt;h2 id="kubernetes"&gt;Kubernetes
&lt;/h2&gt;&lt;p&gt;to be continued&lt;/p&gt;
&lt;p&gt;docker-compose -f compose-test.yaml up -d user-service&lt;/p&gt;
&lt;p&gt;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCutl60XhY0VKswZUESzBt3AdgqvPlNSIxJNbaSODfoUZwTsiioajG3II5mH0k9VKm6H8DYT0qwMrR2AieAVh1DOFJ1XN/vjSNXGOiF5mHkwui/nrU4bE8m6jg3AMKTPW2jpSSBh0zYstMeK50rLVu83Tt3sI7okMfTL9yATIwb+nGTsKyjEOmgG4909R88IrVJ6zuF0X0F/d5k8RoswO2i8BlOoM5jG0Jtla1fOj+w+B1AGNt0m1FXaLVjlk1sBYwM29qbBJzeET3BzHo17Q49kDfgzH/FpgIlEZordyoNc8pGx0WVp6OQtqlvq9+FF2/sYWQjsInjNSh8+PtYdv0upTiVgpG/Bx5xBuJIMrEqFXSTFcSH3sdr+rmZDIfc/V+vWaBa7D564CBH33WXZh2WkizOY+3VFhK7IDp6r3d6XkJPdUHI+orKfGFWUdnEFX/sDMn4jX/6vmE4muYxbwRniFZ1u17vgZCFwnhfNeSIIEOH+6dsQXztP6bN/761KUtOs2ST+LFNpw9mO+RPL4v2cIPqNNaqZ7Dufoy4/RlC2RbMIOGryFG+73JxmKeVwyiK2bFK0IAgV386BVunuhV0GLuBmjODa//c1KWDoKpTR1qJ0tduzlMvGN8uUuOnADZDrupUlmkwh6zx3xUHCdtWk1E917TjwZdy0sq2IqCy3Q== github-actions action@github&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 16</title><link>https://dyhes.github.io/p/postopia-dev-logweek-16/</link><pubDate>Mon, 26 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-16/</guid><description>&lt;h2 id="é—®é¢˜"&gt;é—®é¢˜
&lt;/h2&gt;&lt;h2 id="github-action-known-host"&gt;github action known host
&lt;/h2&gt;&lt;p&gt;GitHub Actions è¿æ¥æœåŠ¡å™¨æ—¶æŠ¥é”™ &lt;code&gt;Host key verification failed&lt;/code&gt;ï¼Œæ˜¯ç”±äº Actions ç¯å¢ƒé¦–æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ç¼ºå¤±ä¸»æœºå¯†é’¥éªŒè¯æ‰€è‡´ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šä¸ªæ–‡æ¡£çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é”™è¯¯åŸå› "&gt;ğŸ” é”™è¯¯åŸå› 
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸»æœºå¯†é’¥æœªä¿¡ä»»&lt;/strong&gt;ï¼šGitHub Actions çš„è™šæ‹Ÿæœºé¦–æ¬¡é€šè¿‡ SSH è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œä¼šæ£€æŸ¥æœåŠ¡å™¨çš„ä¸»æœºå¯†é’¥ï¼ˆhost keyï¼‰ã€‚è‹¥å¯†é’¥æœªé¢„å…ˆå­˜å‚¨åœ¨ &lt;code&gt;known_hosts&lt;/code&gt; æ–‡ä»¶ä¸­ï¼ŒSSH ä¼šå› å®‰å…¨ç­–ç•¥æ‹’ç»è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æœ¬åœ°ç¯å¢ƒçš„å·®å¼‚&lt;/strong&gt;ï¼šæœ¬åœ° Mac å·²é€šè¿‡æ‰‹åŠ¨è¿æ¥ï¼ˆè¾“å…¥ &lt;code&gt;yes&lt;/code&gt;ï¼‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° &lt;code&gt;~/.ssh/known_hosts&lt;/code&gt;ï¼Œä½† Actions ç¯å¢ƒæ˜¯å…¨æ–°çš„ï¼Œæ— æ­¤è®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-è§£å†³æ–¹æ¡ˆ"&gt;âœ… è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="æ–¹æ³•ä¸€æå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ°-known_hostsæ¨è"&gt;æ–¹æ³•ä¸€ï¼šæå‰å°†æœåŠ¡å™¨å¯†é’¥æ·»åŠ åˆ° &lt;code&gt;known_hosts&lt;/code&gt;ï¼ˆæ¨èï¼‰
&lt;/h4&gt;&lt;p&gt;åœ¨ Actions å·¥ä½œæµä¸­ï¼Œä½¿ç”¨ &lt;code&gt;ssh-keyscan&lt;/code&gt; ä¸»åŠ¨è·å–æœåŠ¡å™¨å¯†é’¥å¹¶å†™å…¥ &lt;code&gt;known_hosts&lt;/code&gt; æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;steps&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Add server host key to known_hosts&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="sd"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; mkdir -p ~/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; ssh-keyscan your_server_ip &amp;gt;&amp;gt; ~/.ssh/known_hosts # æ›¿æ¢ your_server_ip
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; chmod 600 ~/.ssh/known_hosts&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;ğŸ“Œ &lt;strong&gt;åŸç†&lt;/strong&gt;ï¼š&lt;code&gt;ssh-keyscan&lt;/code&gt; è·å–æœåŠ¡å™¨å…¬é’¥å¹¶è¿½åŠ åˆ° &lt;code&gt;known_hosts&lt;/code&gt;ï¼Œé¿å…é¦–æ¬¡è¿æ¥æ—¶çš„äº¤äº’æç¤ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h4 id="æ–¹æ³•äºŒç¦ç”¨ä¸¥æ ¼ä¸»æœºå¯†é’¥æ£€æŸ¥ä¸´æ—¶æ–¹æ¡ˆ"&gt;æ–¹æ³•äºŒï¼šç¦ç”¨ä¸¥æ ¼ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
&lt;/h4&gt;&lt;p&gt;åœ¨ SSH å‘½ä»¤ä¸­æ·»åŠ å‚æ•°ï¼Œè·³è¿‡å¯†é’¥éªŒè¯ï¼ˆä»…é™æµ‹è¯•ç¯å¢ƒï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;steps&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Connect via SSH&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;ssh -o &amp;#34;StrictHostKeyChecking=no&amp;#34; -i ${{ secrets.SSH_PRIVATE_KEY }} user@server_ip&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;âš ï¸ &lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­¤æ–¹æ³•é™ä½å®‰å…¨æ€§ï¼Œå¯èƒ½é­å—ä¸­é—´äººæ”»å‡»ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="-å®Œæ•´-github-actions-é…ç½®ç¤ºä¾‹"&gt;ğŸ“ å®Œæ•´ GitHub Actions é…ç½®ç¤ºä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deploy to Server&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="l"&gt;push]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;jobs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;deploy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;runs-on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;ubuntu-latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;steps&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Checkout code&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;actions/checkout@v4&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Add Server Host Key&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="sd"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; mkdir -p ~/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; ssh-keyscan your_server_ip &amp;gt;&amp;gt; ~/.ssh/known_hosts
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; chmod 600 ~/.ssh/known_hosts&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;SSH Command&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="sd"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; echo &amp;#34;${{ secrets.SSH_PRIVATE_KEY }}&amp;#34; &amp;gt; private_key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; chmod 400 private_key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; ssh -i private_key user@your_server_ip &amp;#34;echo Connected!&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-å…³é”®é…ç½®è¯´æ˜"&gt;ğŸ”§ å…³é”®é…ç½®è¯´æ˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç§é’¥å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å°† GitHub Secrets ä¸­çš„ç§é’¥å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶è®¾ç½®æƒé™ &lt;code&gt;400&lt;/code&gt;ï¼ˆå¿…é¡»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸»æœºå¯†é’¥ç±»å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥æœåŠ¡å™¨ä½¿ç”¨éé»˜è®¤å¯†é’¥ç±»å‹ï¼ˆå¦‚ ECDSAï¼‰ï¼Œéœ€æŒ‡å®šå‚æ•°ï¼š&lt;br&gt;
&lt;code&gt;ssh-keyscan -t ecdsa your_server_ip &amp;gt;&amp;gt; ~/.ssh/known_hosts&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶ä¼˜åŒ–&lt;/strong&gt;ï¼ˆå¯é€‰ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ Actions ä¸­åˆ›å»º &lt;code&gt;~/.ssh/config&lt;/code&gt; æ–‡ä»¶ï¼Œç®€åŒ–è¿æ¥å‘½ä»¤ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Host server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt; HostName your_server_ip
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt; User your_username
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt; IdentityFile private_key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt; StrictHostKeyChecking yes&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; ~/.ssh/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æƒé™é—®é¢˜&lt;/strong&gt;ï¼šç¡®ä¿ç§é’¥æ–‡ä»¶æƒé™ä¸º &lt;code&gt;400&lt;/code&gt;ï¼Œå¦åˆ™ SSH ä¼šæ‹’ç»ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯†é’¥æ ¼å¼&lt;/strong&gt;ï¼šè‹¥ç§é’¥æ˜¯ PEM æ ¼å¼ï¼ˆå¦‚ä»¥ &lt;code&gt;-----BEGIN RSA PRIVATE KEY-----&lt;/code&gt; å¼€å¤´ï¼‰ï¼Œéœ€ä¿ç•™æ¢è¡Œç¬¦ã€‚å†™å…¥æ–‡ä»¶æ—¶å»ºè®®ä½¿ç”¨ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="p"&gt;{ secrets.SSH_PRIVATE_KEY &lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;}&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s/\\n/\n/g&amp;#39;&lt;/span&gt; &amp;gt; private_key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨å»ºè®®&lt;/strong&gt;ï¼š&lt;br&gt;
ä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;æ–¹æ³•ä¸€&lt;/strong&gt;ï¼Œæ—¢ä¿æŒå®‰å…¨æ€§ï¼Œåˆé¿å…æ‰‹åŠ¨ç¡®è®¤ã€‚ä»…åœ¨ä¸æ•æ„Ÿç¯å¢ƒä½¿ç”¨æ–¹æ³•äºŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒGitHub Actions å³å¯å®‰å…¨è¿æ¥æœåŠ¡å™¨ã€‚è‹¥ä»å¤±è´¥ï¼Œæ£€æŸ¥æœåŠ¡å™¨ SSH æœåŠ¡çŠ¶æ€ï¼ˆ&lt;code&gt;systemctl status sshd&lt;/code&gt;ï¼‰åŠé˜²ç«å¢™è§„åˆ™ã€‚&lt;/p&gt;
&lt;h3 id="redis-æ— æ³•è¿œç¨‹è®¿é—®"&gt;Redis æ— æ³•è¿œç¨‹è®¿é—®
&lt;/h3&gt;&lt;p&gt;è®¾ç½® bind 0.0.0.0 å’Œå¯†ç &lt;/p&gt;
&lt;h3 id="kafka-é…ç½®è¿œç¨‹ä»è¿æ¥æœ¬åœ°"&gt;kafka é…ç½®è¿œç¨‹ä»è¿æ¥æœ¬åœ°
&lt;/h3&gt;&lt;p&gt;Kafka Broker çš„ advertised.listeners å‚æ•°å†³å®šäº†å®¢æˆ·ç«¯å®é™…è¿æ¥çš„åœ°å€ã€‚è‹¥è¯¥å‚æ•°é…ç½®ä¸ºæœ¬åœ°åœ°å€æˆ–å®¹å™¨å†…éƒ¨åœ°å€ï¼ˆå¦‚ localhost:9092 æˆ–å®¹å™¨å†…ä¸»æœºåï¼‰ï¼Œå³ä½¿å®¢æˆ·ç«¯é…ç½®äº†è¿œç¨‹ IPï¼Œä»ä¼šè¢«é‡å®šå‘åˆ°æœ¬åœ°åœ°å€ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;listeners&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PLAINTEXT://0.0.0.0:9092 # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;advertised.listeners&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PLAINTEXT://å…¬ç½‘IP:9092 # å¯¹å¤–å¹¿æ’­çš„åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="1-port-is-deprecated-please-use-kafka_advertised_listeners-instead"&gt;1 port is deprecated. Please use KAFKA_ADVERTISED_LISTENERS instead.
&lt;/h3&gt;&lt;p&gt;æ˜¯å› ä¸º â€œLooks like the kubenetes will automatically set the env name APPNAME_PORT, i.e. KAFKA_PORT in this case, the workaround is to change your app name to something else other than kafka.â€
é€šè¿‡ â€œcommand: [&amp;ldquo;bash&amp;rdquo;, &amp;ldquo;-c&amp;rdquo;, &amp;ldquo;unset KAFKA_PORT; /etc/confluent/docker/runâ€]â€œ è§£å†³&lt;/p&gt;
&lt;h3 id="2-å®¿ä¸»æœºæ— æ³•è®¿é—®minikube-é›†ç¾¤"&gt;2 å®¿ä¸»æœºæ— æ³•è®¿é—®minikube é›†ç¾¤
&lt;/h3&gt;&lt;p&gt;nginx, gateway, nacos éƒ½è®¾æˆ LoadBalancer&lt;/p&gt;
&lt;h3 id="3-mysql-æ¢é’ˆå¤±æ´»"&gt;3 mysql æ¢é’ˆå¤±æ´»
&lt;/h3&gt;&lt;p&gt;ä¿®æ”¹æ¢é’ˆ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;postopia&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;strategy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Recreate&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;securityContext&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;fsGroup&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;999&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# mysql group ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nacos-mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;postopia-nacos-mysql:latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;imagePullPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Never&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;env&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;MYSQL_ROOT_PASSWORD&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;root&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;MYSQL_USER&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nacos_config&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nacos_config&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;MYSQL_DATABASE&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nacos_config&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;LANG&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;C.UTF-8&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;containerPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3306&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql-storage&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/var/lib/mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql-run&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/var/run/mysqld&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;resources&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;256Mi&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cpu&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;250m&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;limits&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;512Mi&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cpu&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;500m&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# Use tcpSocket probe instead, which is more reliable&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;livenessProbe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;tcpSocket&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3306&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;initialDelaySeconds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;periodSeconds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;timeoutSeconds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;failureThreshold&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;startupProbe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;tcpSocket&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3306&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;initialDelaySeconds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;periodSeconds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;timeoutSeconds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;failureThreshold&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;15&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# Allow up to ~2.5 minutes for startup&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql-storage&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;persistentVolumeClaim&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;claimName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql-pvc&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql-run&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;emptyDir&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;{}&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="4-æœåŠ¡å™¨ä¸Š-docker-compose-æŠ¥é”™"&gt;4 æœåŠ¡å™¨ä¸Š docker-compose æŠ¥é”™
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose down -v
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker rm -f &lt;span class="k"&gt;$(&lt;/span&gt;docker ps -aq&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker volume prune -f
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network prune -f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="minikube-é•œåƒ"&gt;Minikube é•œåƒ
&lt;/h2&gt;&lt;p&gt;è¦å°† Docker Desktop ä¸­çš„é•œåƒåŠ è½½åˆ° Minikube ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§å¸¸ç”¨æ–¹æ³•å®ç°ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•ä¸€ä½¿ç”¨"&gt;&lt;strong&gt;æ–¹æ³•ä¸€ï¼šä½¿ç”¨ &lt;code&gt;minikube image load&lt;/code&gt; å‘½ä»¤&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„å»ºæˆ–æ‹‰å–æœ¬åœ°é•œåƒ&lt;/strong&gt;&lt;br&gt;
åœ¨ Docker Desktop ä¸­æ„å»ºæˆ–æ‹‰å–ç›®æ ‡é•œåƒï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker build -t my-image:latest .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å°†é•œåƒåŠ è½½åˆ° Minikube&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æœ¬åœ°é•œåƒå¯¼å…¥ Minikube çš„ Docker ç¯å¢ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube image load my-image:latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;éªŒè¯æ˜¯å¦åŠ è½½æˆåŠŸï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker images &lt;span class="p"&gt;|&lt;/span&gt; grep my-image
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼šæ­¤æ–¹æ³•éœ€è¦å…ˆåœ¨æœ¬æœºæ„å»ºé•œåƒï¼Œå†é€šè¿‡ &lt;code&gt;load&lt;/code&gt; å‘½ä»¤å¯¼å…¥ï¼Œé€‚ç”¨äºå·²æœ‰é•œåƒçš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•äºŒç›´æ¥ä½¿ç”¨-minikube-çš„-docker-ç¯å¢ƒ"&gt;&lt;strong&gt;æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ Minikube çš„ Docker ç¯å¢ƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ‡æ¢ Docker ç¯å¢ƒå˜é‡&lt;/strong&gt;&lt;br&gt;
è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å½“å‰ç»ˆç«¯çš„ Docker å®¢æˆ·ç«¯æŒ‡å‘ Minikube å†…éƒ¨çš„ Docker å®ˆæŠ¤è¿›ç¨‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;eval&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;minikube docker-env&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ­¤æ—¶æ‰§è¡Œ &lt;code&gt;docker images&lt;/code&gt; ä¼šæ˜¾ç¤º Minikube çš„é•œåƒåˆ—è¡¨ï¼Œè€Œéæœ¬æœº Docker Desktop çš„é•œåƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ Minikube ç¯å¢ƒä¸­æ„å»ºé•œåƒ&lt;/strong&gt;&lt;br&gt;
ç›´æ¥åœ¨ Minikube çš„ Docker ç¯å¢ƒä¸­æ„å»ºé•œåƒï¼ˆé¿å…é•œåƒä¼ è¾“ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker build -t my-image:latest .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ„å»ºå®Œæˆåï¼Œé•œåƒä¼šç›´æ¥å­˜å‚¨åœ¨ Minikube ç¯å¢ƒä¸­ï¼Œæ— éœ€é¢å¤–åŠ è½½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¢å¤æœ¬æœº Docker ç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;eval&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;minikube docker-env -u&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é•œåƒæ‹‰å–ç­–ç•¥&lt;/strong&gt;&lt;br&gt;
åœ¨ Kubernetes çš„ Deployment é…ç½®ä¸­ï¼Œéœ€è®¾ç½® &lt;code&gt;imagePullPolicy: Never&lt;/code&gt;ï¼Œå¦åˆ™ Kubernetes ä¼šå°è¯•ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒè€Œéä½¿ç”¨æœ¬åœ°é•œåƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºé™åˆ¶&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;minikube image load&lt;/code&gt; å‘½ä»¤å¯èƒ½æ¶ˆè€—è¾ƒå¤šå†…å­˜ï¼Œå»ºè®®ä¸º Minikube åˆ†é…è¶³å¤Ÿèµ„æºï¼ˆä¾‹å¦‚è‡³å°‘ 2 æ ¸ 4GB å†…å­˜ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸´æ—¶å¼€å‘åœºæ™¯æ¨è&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€é¢‘ç¹ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæ¨èç›´æ¥é€šè¿‡ &lt;code&gt;eval $(minikube docker-env)&lt;/code&gt; åœ¨ Minikube ç¯å¢ƒä¸­æ„å»ºé•œåƒï¼Œçœå»åŠ è½½æ­¥éª¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éªŒè¯é•œåƒæ˜¯å¦ç”Ÿæ•ˆ"&gt;&lt;strong&gt;éªŒè¯é•œåƒæ˜¯å¦ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;éƒ¨ç½²åº”ç”¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Pod çŠ¶æ€å’Œæ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl logs deployment/my-app
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl port-forward deployment/my-app 8080:8080 &lt;span class="c1"&gt;# ç«¯å£è½¬å‘è®¿é—®æœåŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å¼•ç”¨è¯´æ˜&lt;/strong&gt;ï¼šä»¥ä¸Šæ–¹æ³•ç»¼åˆäº†é•œåƒåŠ è½½å’Œç›´æ¥æ„å»ºä¸¤ç§åœºæ™¯ï¼Œé€‚ç”¨äºæœ¬åœ°å¼€å‘è°ƒè¯•ã€‚è‹¥éœ€é•¿æœŸä½¿ç”¨ï¼Œå»ºè®®æ­å»ºç§æœ‰é•œåƒä»“åº“æˆ–é…ç½®é•œåƒåŠ é€Ÿæºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="kubectl-apply--f"&gt;kubectl apply -f
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;kubectl apply -f&lt;/code&gt; æ˜¯ Kubernetes ä¸­ç”¨äºå£°æ˜å¼é…ç½®ç®¡ç†çš„æ ¸å¿ƒå‘½ä»¤ï¼Œé€šè¿‡è¯»å– YAML/JSON æ–‡ä»¶å°†èµ„æºåº”ç”¨åˆ°é›†ç¾¤ä¸­ï¼Œå¹¶ç¡®ä¿é›†ç¾¤çŠ¶æ€ä¸æ–‡ä»¶å®šä¹‰ä¸€è‡´ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å£°æ˜å¼ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡é…ç½®æ–‡ä»¶æè¿°èµ„æºçš„&lt;strong&gt;æœŸæœ›çŠ¶æ€&lt;/strong&gt;ï¼ŒKubernetes è‡ªåŠ¨è®¡ç®—å¹¶æ‰§è¡Œæ‰€éœ€æ“ä½œï¼ˆåˆ›å»º/æ›´æ–°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å‘½ä»¤å¼å‘½ä»¤ï¼ˆå¦‚ &lt;code&gt;kubectl create&lt;/code&gt;ï¼‰ä¸åŒï¼Œ&lt;code&gt;apply&lt;/code&gt; &lt;strong&gt;ä¸ä¼šè¦†ç›–ç°æœ‰é…ç½®&lt;/strong&gt;ï¼Œè€Œæ˜¯é€šè¿‡ä¸‰å‘åˆå¹¶ç­–ç•¥ï¼ˆThree-Way Mergeï¼‰å¯¹æ¯”å½“å‰çŠ¶æ€ã€ä¸Šæ¬¡åº”ç”¨çŠ¶æ€å’Œæ–‡ä»¶çŠ¶æ€ï¼Œä»…åº”ç”¨å¿…è¦å˜æ›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤šæ¬¡æ‰§è¡ŒåŒä¸€å‘½ä»¤ç»“æœä¸€è‡´ï¼Œé€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œ CI/CD æµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶å‹å¥½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶å¯å­˜å‚¨åœ¨ Git ç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œä¾¿äºè·Ÿè¸ªå˜æ›´å†å²å’Œå›¢é˜Ÿåä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŸºæœ¬ç”¨æ³•"&gt;&lt;strong&gt;åŸºæœ¬ç”¨æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# åº”ç”¨å•ä¸ªæ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f deployment.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# åº”ç”¨ç›®å½•ä¸‹æ‰€æœ‰é…ç½®æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f ./configs/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ä»æ ‡å‡†è¾“å…¥è¯»å–é…ç½®ï¼ˆå¦‚ç®¡é“ä¼ é€’ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cat pod.json &lt;span class="p"&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ä½¿ç”¨ Kustomize ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -k kustomize-dir/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½²åº”ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡å®šä¹‰ Deploymentã€Serviceã€Ingress ç­‰èµ„æºæ–‡ä»¶ï¼Œä¸€é”®éƒ¨ç½²å®Œæ•´åº”ç”¨ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šéƒ¨ç½² Nginxï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx:1.21&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;æ‰§è¡Œï¼š&lt;code&gt;kubectl apply -f nginx.yaml&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°èµ„æº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°æ‰§è¡Œ &lt;code&gt;apply&lt;/code&gt;ï¼ŒKubernetes è‡ªåŠ¨æ›´æ–°èµ„æºï¼ˆå¦‚è°ƒæ•´å‰¯æœ¬æ•°ã€é•œåƒç‰ˆæœ¬ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡ç®¡ç†èµ„æº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ ‡ç­¾ï¼ˆLabelsï¼‰åˆ†ç»„ç®¡ç†èµ„æºï¼Œä¾‹å¦‚ç»Ÿä¸€æ›´æ–°æ‰€æœ‰æ ‡è®°ä¸º &lt;code&gt;app=backend&lt;/code&gt; çš„ Deploymentã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è¿›é˜¶å‚æ•°ä¸æŠ€å·§"&gt;&lt;strong&gt;è¿›é˜¶å‚æ•°ä¸æŠ€å·§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ é™¤æœªä½¿ç”¨çš„èµ„æº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆ &lt;code&gt;--prune&lt;/code&gt; å‚æ•°å¯è‡ªåŠ¨åˆ é™¤é…ç½®æ–‡ä»¶ä¸­æœªæåŠä½†å·²å­˜åœ¨çš„èµ„æºï¼ˆéœ€æŒ‡å®šæ ‡ç­¾æˆ–èµ„æºç±»å‹ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f manifest.yaml --prune -l &lt;span class="nv"&gt;app&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;em&gt;æ³¨æ„ï¼šæ­¤åŠŸèƒ½ç›®å‰å¤„äº Alpha é˜¶æ®µï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡æ‹Ÿæ‰§è¡Œï¼ˆDry Runï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¢„è§ˆå˜æ›´è€Œä¸å®é™…ç”Ÿæ•ˆï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl apply -f deployment.yaml --dry-run&lt;span class="o"&gt;=&lt;/span&gt;server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼ºåˆ¶è¦†ç›–å†²çª&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å­—æ®µå†²çªæ—¶ï¼Œä½¿ç”¨ &lt;code&gt;--force-conflicts&lt;/code&gt; å¼ºåˆ¶åº”ç”¨å˜æ›´ï¼ˆéœ€ç»“åˆ &lt;code&gt;--server-side&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜ä¸è§£å†³"&gt;&lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºæœªæŒ‰é¢„æœŸæ›´æ–°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šæœ¬åœ°é…ç½®ä¸é›†ç¾¤å®é™…çŠ¶æ€ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;kubectl get &amp;lt;resource&amp;gt; -o yaml&lt;/code&gt; å¯¼å‡ºå½“å‰é…ç½®ï¼Œå¯¹æ¯”å¹¶è°ƒæ•´æ–‡ä»¶åé‡æ–°åº”ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºæœªè¢«è‡ªåŠ¨åˆ é™¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼š&lt;code&gt;apply&lt;/code&gt; é»˜è®¤ä¸ä¼šåˆ é™¤èµ„æºï¼Œéœ€æ˜¾å¼ä½¿ç”¨ &lt;code&gt;kubectl delete -f&lt;/code&gt; æˆ–ç»“åˆ &lt;code&gt;--prune&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æƒé™æˆ–é…ç½®é”™è¯¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ’æŸ¥æ­¥éª¤&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;æ£€æŸ¥ YAML è¯­æ³•ï¼ˆå¦‚ç¼©è¿›ã€å­—æ®µåï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®è®¤ç”¨æˆ·æƒé™ï¼ˆRBACï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹äº‹ä»¶æ—¥å¿—ï¼š&lt;code&gt;kubectl describe &amp;lt;resource&amp;gt;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å§‹ç»ˆä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†é…ç½®æ–‡ä»¶çº³å…¥ Gitï¼Œç»“åˆ CI/CD å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…æ‰‹åŠ¨ä¿®æ”¹å®æ—¶é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥åœ¨é›†ç¾¤ä¸­ä¿®æ”¹ï¼ˆå¦‚ &lt;code&gt;kubectl edit&lt;/code&gt;ï¼‰å¯èƒ½å¯¼è‡´ä¸é…ç½®æ–‡ä»¶å†²çªï¼Œå»ºè®®é€šè¿‡æ›´æ–°æ–‡ä»¶åé‡æ–°åº”ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡ç­¾åŒ–èµ„æº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;metadata.labels&lt;/code&gt; å¯¹ç›¸å…³èµ„æºåˆ†ç»„ï¼Œä¾¿äºæ‰¹é‡æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œ&lt;code&gt;kubectl apply -f&lt;/code&gt; æˆä¸º Kubernetes å£°æ˜å¼ç®¡ç†çš„æ ¸å¿ƒå·¥å…·ï¼Œå°¤å…¶é€‚ç”¨äºå¤æ‚ç¯å¢ƒä¸‹çš„èµ„æºç®¡ç†ã€‚å¦‚éœ€è¿›ä¸€æ­¥äº†è§£å‚æ•°ç»†èŠ‚ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ– &lt;code&gt;kubectl apply --help&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="æœåŠ¡ç±»å‹"&gt;æœåŠ¡ç±»å‹
&lt;/h2&gt;&lt;p&gt;Kubernetes Service æ˜¯é›†ç¾¤å†…ç½‘ç»œé€šä¿¡çš„æ ¸å¿ƒæŠ½è±¡ï¼Œé€šè¿‡æä¾›ç¨³å®šçš„è®¿é—®å…¥å£å’Œè´Ÿè½½å‡è¡¡æœºåˆ¶ï¼Œè§£å†³äº† Pod åŠ¨æ€å˜åŒ–å¯¼è‡´çš„ IP ä¸å›ºå®šé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å…¶å››ç§ä¸»è¦ç±»å‹çš„è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="clusteripé»˜è®¤ç±»å‹"&gt;ClusterIPï¼ˆé»˜è®¤ç±»å‹ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨è®¿é—®&lt;/strong&gt;ï¼šä¸º Service åˆ†é…ä¸€ä¸ªè™šæ‹Ÿ IPï¼ˆClusterIPï¼‰ï¼Œä»…é™é›†ç¾¤å†…éƒ¨ Pod æˆ–ç»„ä»¶è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šè‡ªåŠ¨å°†è¯·æ±‚åˆ†å‘åˆ°å…³è”çš„å¤šä¸ª Podï¼Œæ”¯æŒè½®è¯¢ç­‰åŸºæœ¬ç®—æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€é€‚é…&lt;/strong&gt;ï¼šé€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorï¼‰è‡ªåŠ¨æ›´æ–°åç«¯ Podï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¾®æœåŠ¡é—´é€šä¿¡ï¼ˆå¦‚å‰ç«¯æœåŠ¡è°ƒç”¨åç«¯ APIï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“ã€ç¼“å­˜ç­‰ä»…éœ€é›†ç¾¤å†…éƒ¨è®¿é—®çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;ClusterIP&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# Service æš´éœ²ç«¯å£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# Pod åº”ç”¨ç«¯å£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="nodeport"&gt;NodePort
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨è®¿é—®å…¥å£&lt;/strong&gt;ï¼šåœ¨æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šå¼€æ”¾ä¸€ä¸ªé™æ€ç«¯å£ï¼ˆé»˜è®¤ 30000-32767ï¼‰ï¼Œå¤–éƒ¨å¯é€šè¿‡ &lt;code&gt;NodeIP:NodePort&lt;/code&gt; è®¿é—®æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸºäº ClusterIP&lt;/strong&gt;ï¼šNodePort æœ¬è´¨æ˜¯ ClusterIP çš„æ‰©å±•ï¼ŒåŒæ—¶ä¿ç•™ ClusterIP åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘æµ‹è¯•ç¯å¢ƒä¸´æ—¶æš´éœ²æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å°è§„æ¨¡é›†ç¾¤æˆ–æ— éœ€äº‘è´Ÿè½½å‡è¡¡çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;NodePort&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;nodePort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;30080&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å¯æ‰‹åŠ¨æŒ‡å®šæˆ–ç”±ç³»ç»Ÿåˆ†é…&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="loadbalancer"&gt;LoadBalancer
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‘å¹³å°é›†æˆ&lt;/strong&gt;ï¼šè‡ªåŠ¨åˆ›å»ºäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ALBã€GCP LBï¼‰ï¼Œåˆ†é…å¤–éƒ¨ IPã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨æ€§&lt;/strong&gt;ï¼šæµé‡é€šè¿‡è´Ÿè½½å‡è¡¡å™¨åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒå¯¹å¤–æš´éœ²æœåŠ¡ï¼ˆå¦‚ Web APIã€å‰ç«¯åº”ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è‡ªåŠ¨æ‰©ç¼©å®¹å’Œæµé‡ç®¡ç†çš„äº‘åŸç”Ÿåº”ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;LoadBalancer&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="externalname"&gt;ExternalName
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨æœåŠ¡æ˜ å°„&lt;/strong&gt;ï¼šå°† Service æ˜ å°„åˆ°å¤–éƒ¨ DNS åç§°ï¼ˆå¦‚ &lt;code&gt;example.com&lt;/code&gt;ï¼‰ï¼Œä¸åˆ›å»ºä»£ç†æˆ–è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DNS è§£æ&lt;/strong&gt;ï¼šé€šè¿‡ CNAME è®°å½•å°†å†…éƒ¨è¯·æ±‚è½¬å‘åˆ°å¤–éƒ¨æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¿é—®é›†ç¾¤å¤–éƒ¨çš„æ•°æ®åº“ï¼ˆå¦‚ MySQLã€Redisï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é›†æˆç¬¬ä¸‰æ–¹ API æˆ–é—ç•™ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;external-mysql&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;ExternalName&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;externalName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;mysql.example.com&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="ç±»å‹å¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;ç±»å‹å¯¹æ¯”ä¸é€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;è®¿é—®æ–¹å¼&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;å…¸å‹ç”¨ä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ClusterIP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http://&amp;lt;service-name&amp;gt;:port&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤å†…éƒ¨é€šä¿¡&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡é—´è°ƒç”¨ã€å†…éƒ¨æ•°æ®åº“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;NodePort&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http://&amp;lt;NodeIP&amp;gt;:30000+&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¼€å‘æµ‹è¯•ã€ä¸´æ—¶å¤–éƒ¨è®¿é—®&lt;/td&gt;
&lt;td&gt;æœ¬åœ°è°ƒè¯•ã€å°å‹åº”ç”¨å±•ç¤º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;LoadBalancer&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http://&amp;lt;External-IP&amp;gt;:port&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒå¤–éƒ¨è®¿é—®ï¼ˆäº‘å¹³å°ï¼‰&lt;/td&gt;
&lt;td&gt;å…¬æœ‰äº‘éƒ¨ç½²çš„ Web æœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ExternalName&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;service-name â†’ å¤–éƒ¨åŸŸå&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é›†æˆå¤–éƒ¨æœåŠ¡&lt;/td&gt;
&lt;td&gt;å¤–éƒ¨ APIã€è·¨é›†ç¾¤æ•°æ®åº“è®¿é—®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;é€‰å‹å»ºè®®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;ClusterIP&lt;/strong&gt; æ»¡è¶³å†…éƒ¨é€šä¿¡éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒéœ€é«˜å¯ç”¨æ—¶é€‰æ‹© &lt;strong&gt;LoadBalancer&lt;/strong&gt;ï¼ˆäº‘ç¯å¢ƒï¼‰æˆ–ç»“åˆ Ingress ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒè¿‡åº¦ä¾èµ– &lt;strong&gt;NodePort&lt;/strong&gt;ï¼Œå› å…¶ç«¯å£èŒƒå›´å—é™ä¸”ç¼ºä¹è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="åº•å±‚å®ç°æœºåˆ¶"&gt;åº•å±‚å®ç°æœºåˆ¶
&lt;/h3&gt;&lt;p&gt;Service çš„è´Ÿè½½å‡è¡¡ä¾èµ–äº &lt;code&gt;kube-proxy&lt;/code&gt;ï¼Œæ”¯æŒä¸‰ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;iptables&lt;/strong&gt;ï¼šé€šè¿‡è§„åˆ™ç›´æ¥è½¬å‘æµé‡ï¼Œæ€§èƒ½è¾ƒé«˜ä½†ç¼ºä¹é‡è¯•æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IPVS&lt;/strong&gt;ï¼šå†…æ ¸çº§è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒå¤æ‚ç®—æ³•ï¼ˆå¦‚åŠ æƒè½®è¯¢ï¼‰ï¼Œé€‚åˆå¤§è§„æ¨¡é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Userspace&lt;/strong&gt;ï¼ˆå·²æ·˜æ±°ï¼‰ï¼šæ—©æœŸæ¨¡å¼ï¼Œå› æ€§èƒ½é—®é¢˜é€æ¸è¢«æ›¿ä»£ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šå†…å®¹ç»¼åˆäº† Kubernetes å®˜æ–¹æ–‡æ¡£åŠç¤¾åŒºæœ€ä½³å®è·µï¼Œå…·ä½“é…ç½®éœ€ç»“åˆé›†ç¾¤ç¯å¢ƒå’Œäº‘å¹³å°ç‰¹æ€§è°ƒæ•´ã€‚&lt;/p&gt;
&lt;h2 id="minikube-tunnel"&gt;minikube tunnel
&lt;/h2&gt;&lt;p&gt;åœ¨ Minikube ç¯å¢ƒä¸­ï¼Œå½“æœåŠ¡ç±»å‹è®¾ç½®ä¸º &lt;code&gt;LoadBalancer&lt;/code&gt; æ—¶ï¼Œç›´æ¥é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; æ— æ³•è®¿é—®æ˜¯å¸¸è§é—®é¢˜ï¼ŒåŸå› å’Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸå› åˆ†æ"&gt;&lt;strong&gt;åŸå› åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Minikube çš„ç½‘ç»œéš”ç¦»&lt;/strong&gt;&lt;br&gt;
Minikube åˆ›å»ºçš„æ˜¯ä¸€ä¸ªç‹¬ç«‹è™šæ‹Ÿæœºæˆ–å®¹å™¨åŒ–çš„ Kubernetes é›†ç¾¤ï¼Œå…¶ç½‘ç»œä¸å®¿ä¸»æœºï¼ˆå¦‚ Macã€Windows æœ¬åœ°ï¼‰éš”ç¦»ã€‚&lt;code&gt;LoadBalancer&lt;/code&gt; ç±»å‹æœåŠ¡åœ¨äº‘ç¯å¢ƒä¸­ä¼šè‡ªåŠ¨åˆ†é…å¤–éƒ¨ IPï¼Œä½†åœ¨æœ¬åœ° Minikube ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;LoadBalancer çš„æœ¬åœ°é™åˆ¶&lt;/strong&gt;&lt;br&gt;
Minikube é»˜è®¤ä¸æ”¯æŒè‡ªåŠ¨åˆ†é…å¤–éƒ¨ IP ç»™ &lt;code&gt;LoadBalancer&lt;/code&gt; ç±»å‹æœåŠ¡ï¼Œå› æ­¤æœåŠ¡å¯èƒ½å¤„äº &lt;code&gt;pending&lt;/code&gt; çŠ¶æ€ï¼Œæ— æ³•é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆ"&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä½¿ç”¨"&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;minikube tunnel&lt;/code&gt; å‘½ä»¤&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è¯¥å‘½ä»¤ä¼šä¸º &lt;code&gt;LoadBalancer&lt;/code&gt; ç±»å‹æœåŠ¡åˆ†é…æœ¬åœ° IPï¼ˆé€šå¸¸æ˜¯ &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼‰ï¼Œä½¿æœåŠ¡å¯é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; è®¿é—®ã€‚&lt;br&gt;
&lt;strong&gt;æ“ä½œæ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å¯åŠ¨éš§é“ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube tunnel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹åï¼ŒæœåŠ¡çš„ &lt;code&gt;EXTERNAL-IP&lt;/code&gt; ä¼šæ˜¾ç¤ºä¸º &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼Œå¯é€šè¿‡ &lt;code&gt;localhost:&amp;lt;ç«¯å£&amp;gt;&lt;/code&gt; è®¿é—®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="é€šè¿‡"&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;minikube service&lt;/code&gt; å‘½ä»¤è®¿é—®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Minikube æä¾›äº†å¿«æ·å‘½ä»¤ç”ŸæˆæœåŠ¡çš„è®¿é—® URLï¼š&lt;br&gt;
&lt;strong&gt;æ“ä½œæ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è·å–æœåŠ¡è®¿é—®åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube service &amp;lt;æœåŠ¡åç§°&amp;gt; --url
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å‘½ä»¤ä¼šè¿”å›å½¢å¦‚ &lt;code&gt;http://192.168.64.2:30001&lt;/code&gt; çš„ URLï¼Œç›´æ¥ä½¿ç”¨æ­¤åœ°å€å³å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="æ‰‹åŠ¨ä½¿ç”¨-minikube-çš„-ip-å’Œ-nodeport"&gt;&lt;strong&gt;æ‰‹åŠ¨ä½¿ç”¨ Minikube çš„ IP å’Œ NodePort&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¦‚æœæœåŠ¡åŒæ—¶æš´éœ²äº† &lt;code&gt;NodePort&lt;/code&gt;ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è®¿é—®ï¼š&lt;br&gt;
&lt;strong&gt;æ“ä½œæ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è·å– Minikube é›†ç¾¤ IP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube ip
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# æŸ¥çœ‹æœåŠ¡çš„ NodePort&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl get svc &amp;lt;æœåŠ¡åç§°&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—®åœ°å€ä¸º &lt;code&gt;&amp;lt;Minikube-IP&amp;gt;:&amp;lt;NodePort&amp;gt;&lt;/code&gt;ï¼ˆä¾‹å¦‚ &lt;code&gt;192.168.64.2:31035&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="æ£€æŸ¥æœåŠ¡é…ç½®"&gt;&lt;strong&gt;æ£€æŸ¥æœåŠ¡é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©å™¨åŒ¹é…&lt;/strong&gt;ï¼šç¡®ä¿ Service çš„ &lt;code&gt;selector&lt;/code&gt; ä¸ Pod çš„æ ‡ç­¾åŒ¹é…ï¼Œå¦åˆ™æµé‡æ— æ³•è·¯ç”±åˆ°åç«¯ Podã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç«¯å£æ˜ å°„&lt;/strong&gt;ï¼šç¡®è®¤ &lt;code&gt;targetPort&lt;/code&gt; ä¸ Pod çš„å®¹å™¨ç«¯å£ä¸€è‡´ï¼Œ&lt;code&gt;nodePort&lt;/code&gt; åœ¨ 30000-32767 èŒƒå›´å†…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡çŠ¶æ€&lt;/strong&gt;ï¼šè¿è¡Œ &lt;code&gt;kubectl describe svc &amp;lt;æœåŠ¡åç§°&amp;gt;&lt;/code&gt;ï¼Œæ£€æŸ¥ &lt;code&gt;Endpoints&lt;/code&gt; æ˜¯å¦æœ‰æ­£ç¡®çš„ Pod IPã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é™„åŠ è¯´æ˜"&gt;&lt;strong&gt;é™„åŠ è¯´æ˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;LoadBalancer&lt;/code&gt; çš„é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåœ¨æœ¬åœ°å¼€å‘ä¸­ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ &lt;code&gt;NodePort&lt;/code&gt; æˆ–ç»“åˆ &lt;code&gt;minikube tunnel&lt;/code&gt;ï¼Œä»¥å‡å°‘å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘ç¯å¢ƒå·®å¼‚&lt;/strong&gt;ï¼šå¦‚æœåœ¨äº‘å‚å•†ï¼ˆå¦‚é˜¿é‡Œäº‘ï¼‰éƒ¨ç½²ï¼Œ&lt;code&gt;LoadBalancer&lt;/code&gt; ä¼šè‡ªåŠ¨ç»‘å®š SLB/IPï¼Œä½†éœ€æ³¨æ„ &lt;code&gt;externalTrafficPolicy&lt;/code&gt; é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯è§£å†³ Minikube ä¸­ &lt;code&gt;LoadBalancer&lt;/code&gt; æœåŠ¡æ— æ³•é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; è®¿é—®çš„é—®é¢˜ã€‚æ¨èä¼˜å…ˆä½¿ç”¨ &lt;code&gt;minikube tunnel&lt;/code&gt; æˆ– &lt;code&gt;minikube service&lt;/code&gt; å‘½ä»¤ç®€åŒ–æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id="pv--pvc"&gt;PV &amp;amp; PVC
&lt;/h2&gt;&lt;p&gt;PersistentVolumeï¼ˆPVï¼‰å’ŒPersistentVolumeClaimï¼ˆPVCï¼‰æ˜¯Kubernetesä¸­ç”¨äºç®¡ç†å­˜å‚¨èµ„æºçš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸¤è€…å…±åŒå®ç°äº†å­˜å‚¨ä¸è®¡ç®—çš„è§£è€¦ï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-persistentvolumepv"&gt;&lt;strong&gt;1. PersistentVolumeï¼ˆPVï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š&lt;br&gt;
PVæ˜¯é›†ç¾¤ä¸­ç”±ç®¡ç†å‘˜é¢„å…ˆé…ç½®æˆ–é€šè¿‡åŠ¨æ€ä¾›åº”ï¼ˆStorageClassï¼‰åˆ›å»ºçš„ä¸€å—æŒä¹…åŒ–å­˜å‚¨èµ„æºã€‚å®ƒç‹¬ç«‹äºPodçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼ˆå¦‚NFSã€äº‘å­˜å‚¨ã€æœ¬åœ°å­˜å‚¨ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨ç±»å‹&lt;/strong&gt;ï¼šæ”¯æŒæœ¬åœ°å­˜å‚¨ã€ç½‘ç»œå­˜å‚¨ï¼ˆNFSã€iSCSIï¼‰ã€äº‘å­˜å‚¨ï¼ˆå¦‚AWS EBSã€Azure Diskï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®æ¨¡å¼&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ReadWriteOnce&lt;/code&gt;ï¼ˆRWOï¼‰ï¼šå•èŠ‚ç‚¹è¯»å†™ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ReadOnlyMany&lt;/code&gt;ï¼ˆROXï¼‰ï¼šå¤šèŠ‚ç‚¹åªè¯»ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ReadWriteMany&lt;/code&gt;ï¼ˆRWXï¼‰ï¼šå¤šèŠ‚ç‚¹è¯»å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å›æ”¶ç­–ç•¥&lt;/strong&gt;ï¼šåŒ…æ‹¬&lt;code&gt;Retain&lt;/code&gt;ï¼ˆä¿ç•™æ•°æ®ï¼‰ã€&lt;code&gt;Delete&lt;/code&gt;ï¼ˆè‡ªåŠ¨åˆ é™¤å­˜å‚¨ï¼‰ã€&lt;code&gt;Recycle&lt;/code&gt;ï¼ˆåºŸå¼ƒï¼Œå·²ä¸æ¨èï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€&lt;/strong&gt;ï¼š&lt;code&gt;Available&lt;/code&gt;ï¼ˆç©ºé—²ï¼‰ã€&lt;code&gt;Bound&lt;/code&gt;ï¼ˆå·²ç»‘å®šï¼‰ã€&lt;code&gt;Released&lt;/code&gt;ï¼ˆå·²é‡Šæ”¾ï¼‰ã€&lt;code&gt;Failed&lt;/code&gt;ï¼ˆå¤±è´¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ç”¨é€”&lt;/strong&gt;ï¼š&lt;br&gt;
æ•°æ®åº“æ•°æ®æŒä¹…åŒ–ã€å…±äº«æ–‡ä»¶ç³»ç»Ÿã€æ—¥å¿—å­˜å‚¨ç­‰åœºæ™¯ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="2-persistentvolumeclaimpvc"&gt;&lt;strong&gt;2. PersistentVolumeClaimï¼ˆPVCï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š&lt;br&gt;
PVCæ˜¯ç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„å£°æ˜ï¼Œç”¨äºå‘Kubernetesè¯·æ±‚ç‰¹å®šå¤§å°å’Œè®¿é—®æ¨¡å¼çš„å­˜å‚¨ã€‚å®ƒç±»ä¼¼äºPodç”³è¯·è®¡ç®—èµ„æºï¼ˆCPU/å†…å­˜ï¼‰ï¼Œé€šè¿‡ç»‘å®šPVå®ç°å­˜å‚¨çš„æ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸PVçš„ç»‘å®š&lt;/strong&gt;ï¼šPVCé€šè¿‡åŒ¹é…å­˜å‚¨å®¹é‡ã€è®¿é—®æ¨¡å¼å’ŒStorageClassä¸PVç»‘å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä¾›åº”&lt;/strong&gt;ï¼šè‹¥æœªåŒ¹é…åˆ°é™æ€PVï¼Œå¯é€šè¿‡&lt;code&gt;StorageClass&lt;/code&gt;åŠ¨æ€åˆ›å»ºPVã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘½åç©ºé—´é™åˆ¶&lt;/strong&gt;ï¼šPVCå±äºç‰¹å®šå‘½åç©ºé—´ï¼Œè€ŒPVæ˜¯é›†ç¾¤çº§èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹YAML&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;PersistentVolumeClaim&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-pvc&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;accessModes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;ReadWriteOnce&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;resources&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;storage&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;10Gi&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;storageClassName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;standard &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æŒ‡å®šåŠ¨æ€ä¾›åº”çš„å­˜å‚¨ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="3-pvä¸pvcçš„å…³ç³»"&gt;&lt;strong&gt;3. PVä¸PVCçš„å…³ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™æ€ä¾›åº”&lt;/strong&gt;ï¼šç®¡ç†å‘˜é¢„å…ˆåˆ›å»ºPVï¼Œç”¨æˆ·é€šè¿‡PVCç”³è¯·åŒ¹é…çš„å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ä¾›åº”&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;StorageClass&lt;/code&gt;æ¨¡æ¿è‡ªåŠ¨åˆ›å»ºPVï¼Œæ— éœ€ç®¡ç†å‘˜æ‰‹åŠ¨é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»‘å®šé€»è¾‘&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;PVCæäº¤åï¼ŒKubernetesæ§åˆ¶å™¨ä¼šå¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„PVè¿›è¡Œç»‘å®šï¼›&lt;/li&gt;
&lt;li&gt;è‹¥ä½¿ç”¨åŠ¨æ€ä¾›åº”ï¼Œåˆ™ç›´æ¥æŒ‰PVCéœ€æ±‚åˆ›å»ºPVã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="4-ä½¿ç”¨åœºæ™¯å¯¹æ¯”"&gt;&lt;strong&gt;4. ä½¿ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;PV&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;PVC&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ›å»ºè€…&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é›†ç¾¤ç®¡ç†å‘˜&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ï¼ˆå¼€å‘è€…ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‹¬ç«‹äºPod&lt;/td&gt;
&lt;td&gt;ä¸Podè§£è€¦ï¼Œä½†ç»‘å®šåä¸PVåŒæ­¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æä¾›å®é™…å­˜å‚¨èµ„æº&lt;/td&gt;
&lt;td&gt;å£°æ˜å­˜å‚¨éœ€æ±‚å¹¶ç»‘å®šPV&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨ç±»å‹é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜ç¡®æŒ‡å®šï¼ˆå¦‚NFSè·¯å¾„ã€äº‘å­˜å‚¨å‚æ•°ï¼‰&lt;/td&gt;
&lt;td&gt;é€šè¿‡StorageClassæŠ½è±¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="5-å¸¸è§é—®é¢˜"&gt;&lt;strong&gt;5. å¸¸è§é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Q1ï¼šPVCæœªç»‘å®šPVæ€ä¹ˆåŠï¼Ÿ&lt;/strong&gt;&lt;br&gt;
éœ€æ£€æŸ¥PVCçš„å®¹é‡ã€è®¿é—®æ¨¡å¼æ˜¯å¦ä¸å¯ç”¨PVåŒ¹é…ï¼Œæˆ–ç¡®è®¤StorageClassé…ç½®æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Q2ï¼šå¦‚ä½•å¤ç”¨å·²é‡Šæ”¾çš„PVï¼Ÿ&lt;/strong&gt;&lt;br&gt;
è‹¥å›æ”¶ç­–ç•¥ä¸º&lt;code&gt;Retain&lt;/code&gt;ï¼Œéœ€æ‰‹åŠ¨åˆ é™¤å¹¶é‡æ–°åˆ›å»ºPVã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡PVå’ŒPVCçš„åä½œï¼ŒKuberneteså®ç°äº†å­˜å‚¨èµ„æºçš„çµæ´»ç®¡ç†ï¼Œæ—¢èƒ½æ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚ï¼Œåˆèƒ½ç®€åŒ–ç”¨æˆ·æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id="statefulset--deployment"&gt;StatefulSet &amp;amp; Deployment
&lt;/h2&gt;&lt;p&gt;StatefulSet å’Œ Deployment æ˜¯ Kubernetes ä¸­ä¸¤ç±»æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œåˆ†åˆ«é’ˆå¯¹æœ‰çŠ¶æ€å’Œæ— çŠ¶æ€åº”ç”¨è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ï¼Œç»“åˆåº”ç”¨åœºæ™¯ã€è¡Œä¸ºç‰¹æ€§åŠåº•å±‚æœºåˆ¶è¿›è¡Œå¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;1. é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äº&lt;strong&gt;æ— çŠ¶æ€åº”ç”¨&lt;/strong&gt;ï¼ˆå¦‚ Web æœåŠ¡å™¨ã€API æœåŠ¡ï¼‰ï¼ŒPod ä¹‹é—´å¯éšæ„æ›¿æ¢ä¸”æ— éœ€ä¿ç•™çŠ¶æ€ã€‚&lt;br&gt;
&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pod å®ä¾‹å®Œå…¨å¯¹ç­‰ï¼Œæ— å¯åŠ¨é¡ºåºä¾èµ–ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®é€šå¸¸å­˜å‚¨åœ¨ä¸´æ—¶å·æˆ–å…±äº«å­˜å‚¨ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äº&lt;strong&gt;æœ‰çŠ¶æ€åº”ç”¨&lt;/strong&gt;ï¼ˆå¦‚æ•°æ®åº“ã€åˆ†å¸ƒå¼å­˜å‚¨ï¼‰ï¼Œéœ€ç¨³å®šæ ‡è¯†ã€æŒä¹…åŒ–å­˜å‚¨åŠä¸¥æ ¼é¡ºåºæ§åˆ¶ã€‚&lt;br&gt;
&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ª Pod æœ‰å”¯ä¸€åç§°ï¼ˆå¦‚ &lt;code&gt;db-0&lt;/code&gt;ã€&lt;code&gt;db-1&lt;/code&gt;ï¼‰å’Œå›ºå®š DNS è®°å½•ï¼ˆå¦‚ &lt;code&gt;db-0.myservice.ns.svc.cluster.local&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®é€šè¿‡ç‹¬ç«‹çš„ PersistentVolume æŒä¹…åŒ–ï¼Œä¸ Pod ç”Ÿå‘½å‘¨æœŸè§£è€¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-pod-æ ‡è¯†ä¸ç½‘ç»œ"&gt;&lt;strong&gt;2. Pod æ ‡è¯†ä¸ç½‘ç»œ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Pod åç§°éšæœº&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;web-app-59d8c5f6c4-abcde&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IP åŠ¨æ€åˆ†é…&lt;/strong&gt;ï¼Œé‡å¯æˆ–è¿ç§»åå¯èƒ½å˜åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡ Service è´Ÿè½½å‡è¡¡æš´éœ²ï¼Œæµé‡éšæœºåˆ†å‘è‡³ä»»æ„ Podã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Pod åç§°å›ºå®šä¸”æœ‰åº&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;db-0&lt;/code&gt;ã€&lt;code&gt;db-1&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œæ ‡è¯†ç¨³å®š&lt;/strong&gt;ï¼Œé€šè¿‡ Headless Service æä¾› DNS è®°å½•ï¼Œæ”¯æŒ Pod é—´ç›´æ¥é€šä¿¡ï¼›&lt;/li&gt;
&lt;li&gt;é€‚ç”¨äºéœ€å›ºå®šç½‘ç»œæ‹“æ‰‘çš„åœºæ™¯ï¼ˆå¦‚ä¸»ä»æ•°æ®åº“ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-å­˜å‚¨ç®¡ç†"&gt;&lt;strong&gt;3. å­˜å‚¨ç®¡ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤ä½¿ç”¨ä¸´æ—¶å­˜å‚¨ï¼ˆå¦‚ &lt;code&gt;emptyDir&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥éœ€æŒä¹…åŒ–å­˜å‚¨ï¼Œéœ€æ‰‹åŠ¨é…ç½® PV/PVCï¼Œä½†æ‰€æœ‰ Pod å¯èƒ½å…±äº«åŒä¸€å·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¯ä¸ª Pod ç»‘å®šç‹¬ç«‹å­˜å‚¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;volumeClaimTemplates&lt;/code&gt; åŠ¨æ€åˆ›å»º PVCï¼Œå­˜å‚¨ä¸ Pod è§£è€¦ä½†ä¸€ä¸€å¯¹åº”ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®åœ¨ Pod åˆ é™¤åä¿ç•™ï¼Œé€‚ç”¨äºæ•°æ®åº“å®ä¾‹çš„ç‹¬ç«‹æ•°æ®å­˜å‚¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="4-ç”Ÿå‘½å‘¨æœŸç®¡ç†"&gt;&lt;strong&gt;4. ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨/ç»ˆæ­¢é¡ºåº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt;ï¼šPod æ— åºåˆ›å»ºæˆ–åˆ é™¤ï¼Œå¯å¹¶è¡Œæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;ï¼šPod æŒ‰é¡ºåºå¯åŠ¨ï¼ˆå¦‚ &lt;code&gt;db-0&lt;/code&gt; â†’ &lt;code&gt;db-1&lt;/code&gt;ï¼‰å’Œç»ˆæ­¢ï¼ˆé€†åºï¼‰ï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ»šåŠ¨æ›´æ–°ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt;ï¼šæ”¯æŒæ— åºæ»šåŠ¨æ›´æ–°ï¼Œé€šè¿‡ &lt;code&gt;maxUnavailable&lt;/code&gt; å’Œ &lt;code&gt;maxSurge&lt;/code&gt; æ§åˆ¶æ›´æ–°èŠ‚å¥ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;ï¼šæŒ‰åºå·é€†åºæ›´æ–°ï¼ˆå¦‚ &lt;code&gt;db-2&lt;/code&gt; â†’ &lt;code&gt;db-1&lt;/code&gt; â†’ &lt;code&gt;db-0&lt;/code&gt;ï¼‰ï¼Œç¡®ä¿é€ä¸ª Pod å°±ç»ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="5-æ‰©ç¼©å®¹ä¸åˆ é™¤è¡Œä¸º"&gt;&lt;strong&gt;5. æ‰©ç¼©å®¹ä¸åˆ é™¤è¡Œä¸º&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰©ç¼©å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt;ï¼šPod éšæœºåˆ›å»ºæˆ–åˆ é™¤ï¼Œæ— é¡ºåºé™åˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;ï¼šæ‰©å®¹æ—¶æŒ‰åºåˆ›å»ºæ–° Podï¼Œç¼©å®¹æ—¶æŒ‰é€†åºåˆ é™¤æ—§ Podã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ é™¤æ§åˆ¶å™¨æ—¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt;ï¼šåˆ é™¤åå…³è” Pod å’Œ ReplicaSet å‡è¢«æ¸…ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;ï¼šé»˜è®¤ä¿ç•™ Pod å’Œ PVCï¼Œéœ€æ‰‹åŠ¨åˆ é™¤ä»¥ç¡®ä¿æ•°æ®å®‰å…¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å¯¹æ¯”è¡¨"&gt;&lt;strong&gt;æ€»ç»“å¯¹æ¯”è¡¨&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— çŠ¶æ€åº”ç”¨ï¼ˆWebã€APIï¼‰&lt;/td&gt;
&lt;td&gt;æœ‰çŠ¶æ€åº”ç”¨ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Pod æ ‡è¯†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éšæœºåç§°ï¼ŒåŠ¨æ€ IP&lt;/td&gt;
&lt;td&gt;å›ºå®šåç§°ï¼ˆå¦‚ &lt;code&gt;db-0&lt;/code&gt;ï¼‰ï¼Œç¨³å®š DNS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸´æ—¶å·æˆ–å…±äº«å­˜å‚¨&lt;/td&gt;
&lt;td&gt;æ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…åŒ–å­˜å‚¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯åŠ¨é¡ºåº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— åº&lt;/td&gt;
&lt;td&gt;ä¸¥æ ¼æŒ‰é¡ºåºåˆ›å»º/åˆ é™¤ï¼ˆ&lt;code&gt;db-0&lt;/code&gt; â†’ &lt;code&gt;db-1&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ›´æ–°ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— åºæ»šåŠ¨æ›´æ–°&lt;/td&gt;
&lt;td&gt;é€†åºé€ä¸ªæ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨æ¡ˆä¾‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Nginxã€æ— çŠ¶æ€å¾®æœåŠ¡&lt;/td&gt;
&lt;td&gt;MySQLã€Kafkaã€Zookeeper&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é€‰æ‹©å»ºè®®"&gt;&lt;strong&gt;é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰ Deployment&lt;/strong&gt;ï¼šè‹¥åº”ç”¨æ— çŠ¶æ€ã€å¯æ°´å¹³æ‰©å±•ä¸”æ— éœ€å›ºå®šç½‘ç»œæ ‡è¯†ï¼ˆå¦‚ REST APIï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰ StatefulSet&lt;/strong&gt;ï¼šè‹¥éœ€ç¨³å®šç½‘ç»œæ ‡è¯†ã€ç‹¬ç«‹å­˜å‚¨æˆ–æœ‰åºç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚æ•°æ®åº“é›†ç¾¤ã€åˆ†å¸ƒå¼é”æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©æ§åˆ¶å™¨ï¼Œå¯æœ‰æ•ˆå¹³è¡¡åº”ç”¨çš„å¼¹æ€§ä¸çŠ¶æ€ä¸€è‡´æ€§éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="docker-compose-rebuild"&gt;Docker Compose Rebuild
&lt;/h2&gt;&lt;p&gt;åœ¨ Docker Compose ä¸­ï¼Œ&lt;code&gt;docker compose build&lt;/code&gt; å‘½ä»¤çš„ &lt;strong&gt;Rebuild ç­–ç•¥&lt;/strong&gt;å¯ä»¥é€šè¿‡ä»¥ä¸‹é€‰é¡¹çµæ´»æŒ‡å®šï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ä¸‹çš„é•œåƒæ„å»ºéœ€æ±‚ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ„å»º"&gt;&lt;strong&gt;å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ„å»º&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;--no-cache&lt;/code&gt; å‚æ•°ï¼Œè·³è¿‡ Docker æ„å»ºç¼“å­˜ï¼Œä»å¤´å¼€å§‹é‡æ–°æ„å»ºé•œåƒã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå½“ Dockerfile ä¸­çš„æŒ‡ä»¤é¡ºåºæˆ–å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œä½†ç¼“å­˜å¯èƒ½å¯¼è‡´æ—§ç‰ˆæœ¬æ®‹ç•™æ—¶ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker compose build --no-cache &lt;span class="o"&gt;[&lt;/span&gt;SERVICE_NAME&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¼•ç”¨è¯´æ˜ï¼šæ­¤é€‰é¡¹åœ¨ç½‘é¡µä¸­å‡æœ‰æåŠï¼Œæ˜ç¡®ç”¨äºç¦ç”¨ç¼“å­˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="å¼ºåˆ¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ"&gt;&lt;strong&gt;å¼ºåˆ¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;--pull&lt;/code&gt; å‚æ•°ï¼Œå¼ºåˆ¶ä»é•œåƒä»“åº“æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„åŸºç¡€é•œåƒï¼ˆå¦‚ &lt;code&gt;FROM&lt;/code&gt; æŒ‡å®šçš„é•œåƒï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç¡®ä¿åŸºç¡€é•œåƒï¼ˆå¦‚ &lt;code&gt;python:3.6-alpine&lt;/code&gt;ï¼‰æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…æœ¬åœ°æ—§ç‰ˆæœ¬å½±å“æ„å»ºã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker compose build --pull &lt;span class="o"&gt;[&lt;/span&gt;SERVICE_NAME&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µå‡å¼ºè°ƒæ­¤é€‰é¡¹ç”¨äºæ›´æ–°åŸºç¡€é•œåƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="å¹¶è¡Œæ„å»ºå¤šä¸ªæœåŠ¡"&gt;&lt;strong&gt;å¹¶è¡Œæ„å»ºå¤šä¸ªæœåŠ¡&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;--parallel&lt;/code&gt; å‚æ•°ï¼ˆDocker Compose 3.4+ æ”¯æŒï¼‰ï¼Œå¯ç”¨å¤šæœåŠ¡å¹¶è¡Œæ„å»ºä»¥åŠ é€Ÿæ•´ä½“æµç¨‹ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå½“é¡¹ç›®åŒ…å«å¤šä¸ªç‹¬ç«‹æœåŠ¡ä¸”æ„å»ºè¿‡ç¨‹æ— ä¾èµ–æ—¶ï¼Œå¯æ˜¾è‘—å‡å°‘æ„å»ºæ—¶é—´ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker compose build --parallel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µè¯¦ç»†è¯´æ˜äº†å¹¶è¡Œæ„å»ºçš„é€‚ç”¨æ€§å’Œä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="é€‰æ‹©æ€§é‡å»ºæŒ‡å®šæœåŠ¡"&gt;&lt;strong&gt;é€‰æ‹©æ€§é‡å»ºæŒ‡å®šæœåŠ¡&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨å‘½ä»¤ä¸­æŒ‡å®šæœåŠ¡åç§°ï¼Œä»…é‡æ–°æ„å»ºç‰¹å®šæœåŠ¡ï¼Œè€Œéæ‰€æœ‰æœåŠ¡ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä»…æŸä¸ªæœåŠ¡çš„ Dockerfile æˆ–ä¾èµ–å‘ç”Ÿå˜æ›´æ—¶ï¼Œé’ˆå¯¹æ€§é‡å»ºä»¥èŠ‚çœèµ„æºã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker compose build web &lt;span class="c1"&gt;# ä»…é‡å»ºåä¸º &amp;#34;web&amp;#34; çš„æœåŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µå‡æåˆ°é€šè¿‡æœåŠ¡åç§°é€‰æ‹©æ€§æ„å»ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="åˆ é™¤ä¸´æ—¶å®¹å™¨å’Œé•œåƒ"&gt;&lt;strong&gt;åˆ é™¤ä¸´æ—¶å®¹å™¨å’Œé•œåƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;--force-rm&lt;/code&gt; å‚æ•°ï¼Œåˆ é™¤æ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å®¹å™¨ï¼Œé¿å…æ®‹ç•™æ–‡ä»¶å ç”¨ç©ºé—´ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker compose build --force-rm &lt;span class="o"&gt;[&lt;/span&gt;SERVICE_NAME&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¼•ç”¨è¯´æ˜ï¼šç½‘é¡µæŒ‡å‡ºæ­¤é€‰é¡¹ç”¨äºæ¸…ç†ä¸´æ—¶å®¹å™¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="ç»„åˆç­–ç•¥ç¤ºä¾‹"&gt;&lt;strong&gt;ç»„åˆç­–ç•¥ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¯ç»„åˆå¤šä¸ªå‚æ•°å®ç°å¤æ‚ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker compose build --no-cache --pull web &lt;span class="c1"&gt;# å¼ºåˆ¶é‡å»º &amp;#34;web&amp;#34; æœåŠ¡ï¼Œç¦ç”¨ç¼“å­˜å¹¶æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ä¸Šè¿°å‚æ•°ï¼Œå¯ä»¥çµæ´»æ§åˆ¶ Docker Compose çš„æ„å»ºè¡Œä¸ºï¼Œé€‚é…å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒéœ€æ±‚ã€‚å…·ä½“é€‰æ‹©éœ€ç»“åˆä»¥ä¸‹å› ç´ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ä¾èµ–&lt;/strong&gt;ï¼šæ˜¯å¦éœ€è¦å®Œå…¨å¹²å‡€çš„æ„å»ºç¯å¢ƒï¼ˆå¦‚ CI/CD æµæ°´çº¿ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•œåƒæ›´æ–°&lt;/strong&gt;ï¼šæ˜¯å¦ä¾èµ–æœ€æ–°åŸºç¡€é•œåƒçš„å®‰å…¨æ€§æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆç‡ä¼˜åŒ–&lt;/strong&gt;ï¼šæ˜¯å¦å¯ç”¨å¹¶è¡Œæ„å»ºä»¥å‡å°‘æ—¶é—´æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æç¤ºï¼šå¯é€šè¿‡ &lt;code&gt;docker compose config&lt;/code&gt; éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œæˆ–ç»“åˆ &lt;code&gt;docker compose up --build&lt;/code&gt; ç›´æ¥å¯åŠ¨é‡å»ºåçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="docker-compose"&gt;Docker compose
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ä½¿ç”¨ Docker Compose è¿è¡Œ &lt;code&gt;.yaml&lt;/code&gt; æ–‡ä»¶çš„å®Œæ•´æŒ‡å—ï¼Œç»¼åˆäº†æœ€ä½³å®è·µå’Œå…³é”®æ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;h3 id="åŸºç¡€è¿è¡Œæµç¨‹"&gt;åŸºç¡€è¿è¡Œæµç¨‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;br&gt;
æ‰§è¡Œ &lt;code&gt;docker-compose config&lt;/code&gt; æ£€æŸ¥ YAML æ–‡ä»¶è¯­æ³•ï¼Œé¿å…å› ç¼©è¿›é”™è¯¯æˆ–æ ¼å¼é—®é¢˜å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨æœåŠ¡&lt;/strong&gt;&lt;br&gt;
åœ¨åŒ…å« &lt;code&gt;docker-compose.yaml&lt;/code&gt; çš„ç›®å½•ä¸‹æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose up &lt;span class="c1"&gt;# å‰å°è¿è¡Œï¼ˆæŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose up -d &lt;span class="c1"&gt;# åå°è¿è¡Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;docker-compose ps&lt;/code&gt; æŸ¥çœ‹è¿è¡ŒçŠ¶æ€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker-compose logs [æœåŠ¡å]&lt;/code&gt; æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker-compose down&lt;/code&gt; åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œå’Œå·&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="yaml-æ–‡ä»¶æ ¸å¿ƒé…ç½®"&gt;YAML æ–‡ä»¶æ ¸å¿ƒé…ç½®
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;3.8&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æŒ‡å®šå…¼å®¹ç‰ˆæœ¬&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx:alpine&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;80:80&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# ç«¯å£æ˜ å°„ï¼ˆä¸»æœº:å®¹å™¨ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;./html:/usr/share/nginx/html &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# ç›®å½•æŒ‚è½½&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;depends_on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;db &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# åŸºç¡€ä¾èµ–å£°æ˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;postgres:15&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;POSTGRES_PASSWORD&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;example&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;healthcheck&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å¥åº·æ£€æŸ¥é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;test&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;CMD-SHELL&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;pg_isready -U postgres&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;interval&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;5s&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="é«˜çº§è¿è¡ŒæŠ€å·§"&gt;é«˜çº§è¿è¡ŒæŠ€å·§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡æ³¨å…¥&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;.env&lt;/code&gt; æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ŒYAML ä¸­é€šè¿‡ &lt;code&gt;${VAR_NAME}&lt;/code&gt; å¼•ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;DB_PASSWORD&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;${DB_SECRET}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šç¯å¢ƒé…ç½®&lt;/strong&gt;&lt;br&gt;
é€šè¿‡å åŠ å¤šä¸ª Compose æ–‡ä»¶å®ç°ç¯å¢ƒå·®å¼‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºé™åˆ¶&lt;/strong&gt;&lt;br&gt;
é…ç½®å®¹å™¨èµ„æºä½¿ç”¨ä¸Šé™é˜²æ­¢è¿‡è½½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;deploy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;resources&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;limits&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cpus&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;1G&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="è·¨å¹³å°æ³¨æ„äº‹é¡¹"&gt;è·¨å¹³å°æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Windows ç‰¹æ®Šé…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿ Docker Desktop å·²å®‰è£…å¹¶å¯ç”¨ WSL2&lt;/li&gt;
&lt;li&gt;è·¯å¾„ä½¿ç”¨æ­£æ–œæ  &lt;code&gt;/&lt;/code&gt; ä»£æ›¿åæ–œæ  &lt;code&gt;\&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é¿å…ä½¿ç”¨ä¿ç•™ç«¯å£ï¼ˆå¦‚ 80/443ï¼‰å¯èƒ½è¢«ç³»ç»Ÿå ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Linux æƒé™å¤„ç†&lt;/strong&gt;&lt;br&gt;
å®¹å™¨å†…ç”¨æˆ·æƒé™éœ€ä¸æŒ‚è½½ç›®å½•åŒ¹é…ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;./data:/var/lib/postgresql/data:z &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# SELinux ä¸Šä¸‹æ–‡æ ‡è®°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="æ•…éšœæ’æŸ¥æŒ‡å—"&gt;æ•…éšœæ’æŸ¥æŒ‡å—
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨é¡ºåºé—®é¢˜&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨å¢å¼ºå‹ä¾èµ–å£°æ˜ï¼Œç¡®ä¿æœåŠ¡çœŸæ­£å¯ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;depends_on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;condition&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;service_healthy&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸¸è§é”™è¯¯å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç«¯å£å†²çª&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;netstat -ano&lt;/code&gt; æ£€æŸ¥å ç”¨ç«¯å£&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·æŒ‚è½½å¤±è´¥&lt;/strong&gt;ï¼šéªŒè¯ä¸»æœºç›®å½•å­˜åœ¨ä¸”å…·æœ‰è¯»å†™æƒé™&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•œåƒæ‹‰å–è¶…æ—¶&lt;/strong&gt;ï¼šé…ç½®å›½å†…é•œåƒåŠ é€Ÿæº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;æç¤ºï¼šå»ºè®®ä½¿ç”¨ &lt;code&gt;docker-compose --help&lt;/code&gt; æŸ¥çœ‹å®Œæ•´å‘½ä»¤åˆ—è¡¨ã€‚å¯¹äºå¤æ‚ç¼–æ’åœºæ™¯ï¼Œå¯ç»“åˆ &lt;a class="link" href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener"
&gt;Docker Swarm&lt;/a&gt; å®ç°é›†ç¾¤ç®¡ç†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä½¿ç”¨ Docker Compose æŒ‡å®šè‡ªå®šä¹‰ YAML æ–‡ä»¶çš„å®Œæ•´æŒ‡å—ï¼Œæ•´åˆäº†å¤šç¯‡æŠ€æœ¯æ–‡æ¡£çš„æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;h3 id="åŸºç¡€æŒ‡å®šæ–¹æ³•"&gt;åŸºç¡€æŒ‡å®šæ–¹æ³•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•æ–‡ä»¶æŒ‡å®š&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;-f&lt;/code&gt; å‚æ•°ç›´æ¥æŒ‡å®š YAML æ–‡ä»¶è·¯å¾„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose -f docker-compose.prod.yml up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ &lt;code&gt;./config/custom.yml&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ–‡ä»¶åˆå¹¶&lt;/strong&gt;&lt;br&gt;
å åŠ å¤šä¸ª YAML æ–‡ä»¶å®ç°é…ç½®æ‰©å±•ï¼Œä¼˜å…ˆçº§æŒ‰ä¹¦å†™é¡ºåºé€’å¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose -f base.yml -f override.yml up
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¸¸ç”¨äºåŒºåˆ†åŸºç¡€é…ç½®ä¸ç¯å¢ƒå·®å¼‚ï¼ˆå¦‚å¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹å‘½ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤šç¯å¢ƒéƒ¨ç½²&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker-compose -f docker-compose.yml -f docker-compose.prod.yml up&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æµ‹è¯•é…ç½®æ–‡ä»¶&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker-compose -f test-stack.yaml down --volumes&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰è·¯å¾„éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker-compose -f /opt/myapp/config.yml up&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸´æ—¶è°ƒè¯•é…ç½®&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docker-compose -f debug-config.yaml logs --follow&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="è·¯å¾„å¤„ç†è§„åˆ™"&gt;è·¯å¾„å¤„ç†è§„åˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–‡ä»¶æœç´¢ä¼˜å…ˆçº§&lt;/strong&gt;&lt;br&gt;
Docker Compose é»˜è®¤æŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å‰ç›®å½•çš„ &lt;code&gt;docker-compose.yml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;docker-compose.override.yml&lt;/code&gt;ï¼ˆè‡ªåŠ¨åˆå¹¶ï¼‰&lt;/li&gt;
&lt;li&gt;è‹¥æœªæ‰¾åˆ°ï¼Œå¿…é¡»æ˜¾å¼é€šè¿‡ &lt;code&gt;-f&lt;/code&gt; æŒ‡å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨å¹³å°è·¯å¾„æ ¼å¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Windowsï¼šå»ºè®®ä½¿ç”¨æ­£æ–œæ  &lt;code&gt;/&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;C:/projects/app.yml&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;Linux/macOSï¼šæ”¯æŒç›¸å¯¹è·¯å¾„ &lt;code&gt;../parent-dir/config.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="éªŒè¯ä¸è°ƒè¯•"&gt;éªŒè¯ä¸è°ƒè¯•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®é¢„æ£€&lt;/strong&gt;&lt;br&gt;
æ‰§è¡Œè¯­æ³•éªŒè¯å‘½ä»¤ï¼Œé¿å…é…ç½®é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose -f custom.yml config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å‘½ä»¤ä¼šè¾“å‡ºåˆå¹¶åçš„æœ€ç»ˆé…ç½®å¹¶æ£€æŸ¥è¯­æ³•æœ‰æ•ˆæ€§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¯å¢ƒå˜é‡æ³¨å…¥&lt;/strong&gt;&lt;br&gt;
åœ¨è‡ªå®šä¹‰ YAML ä¸­ç»“åˆ &lt;code&gt;.env&lt;/code&gt; æ–‡ä»¶å®ç°åŠ¨æ€é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;postgres:${POSTGRES_VERSION}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éœ€ç¡®ä¿ &lt;code&gt;.env&lt;/code&gt; æ–‡ä»¶ä¸ YAML æ–‡ä»¶åœ¨åŒä¸€ç›®å½•æˆ–é€šè¿‡ &lt;code&gt;--env-file&lt;/code&gt; æŒ‡å®š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="é«˜çº§æŠ€å·§"&gt;é«˜çº§æŠ€å·§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„åˆå‘½ä»¤ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
å°†å¸¸ç”¨å‘½ä»¤å°è£…ä¸ºåˆ«åæé«˜æ•ˆç‡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;alias&lt;/span&gt; &lt;span class="nv"&gt;dc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;docker-compose -f ~/projects/core-stack.yml&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;dc up -d &lt;span class="c1"&gt;# ç­‰æ•ˆäºå®Œæ•´å‘½ä»¤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§æ§åˆ¶&lt;/strong&gt;&lt;br&gt;
åœ¨ YAML æ–‡ä»¶é¡¶éƒ¨å£°æ˜è¯­æ³•ç‰ˆæœ¬é¿å…å…¼å®¹é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;3.8&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ”¯æŒèµ„æºé™åˆ¶ã€æ‰©å±•é…ç½®ç­‰æ–°ç‰¹æ€§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ“ä½œå»ºè®®&lt;/strong&gt;ï¼šå¯¹äºé•¿æœŸè¿è¡Œçš„æœåŠ¡ï¼Œæ¨èå°†è‡ªå®šä¹‰ YAML æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œå¹¶é€šè¿‡ CI/CD æµæ°´çº¿å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚è‹¥éœ€æŸ¥çœ‹å®Œæ•´å‘½ä»¤åˆ—è¡¨ï¼Œå¯æ‰§è¡Œ &lt;code&gt;docker-compose --help&lt;/code&gt; è·å–å®æ—¶å¸®åŠ©ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="k8s-æœ¬åœ°é•œåƒ"&gt;k8s æœ¬åœ°é•œåƒ
&lt;/h2&gt;&lt;p&gt;åœ¨Kubernetesï¼ˆK8sï¼‰ä¸­ï¼Œè‹¥æƒ³ç›´æ¥ä½¿ç”¨ä¸»èŠ‚ç‚¹æœ¬åœ°æ„å»ºçš„Dockeré•œåƒæ‰§è¡Œ&lt;code&gt;kubectl apply&lt;/code&gt;ï¼Œéœ€è¦ç¡®ä¿é•œåƒèƒ½è¢«é›†ç¾¤èŠ‚ç‚¹è®¿é—®ï¼Œå¹¶é…ç½®æ­£ç¡®çš„æ‹‰å–ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•åŠæ­¥éª¤ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-é…ç½®é•œåƒæ‹‰å–ç­–ç•¥"&gt;&lt;strong&gt;1. é…ç½®é•œåƒæ‹‰å–ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨K8sçš„Deploymentæˆ–Podé…ç½®æ–‡ä»¶ä¸­ï¼Œ&lt;strong&gt;å¿…é¡»è®¾ç½®&lt;code&gt;imagePullPolicy: Never&lt;/code&gt;&lt;/strong&gt;ï¼Œè¿™ä¼šå¼ºåˆ¶Kubernetesç›´æ¥ä½¿ç”¨æœ¬åœ°é•œåƒè€Œä¸å°è¯•ä»è¿œç¨‹ä»“åº“æ‹‰å–ã€‚ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;myapp&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;myapp&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-local-image:latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;imagePullPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Never &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…³é”®é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="2-ç¡®ä¿é•œåƒå­˜åœ¨äºé›†ç¾¤èŠ‚ç‚¹"&gt;&lt;strong&gt;2. ç¡®ä¿é•œåƒå­˜åœ¨äºé›†ç¾¤èŠ‚ç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kubernetesçš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ï¼‰éƒ½éœ€è¦æœ‰è¯¥é•œåƒã€‚æ ¹æ®é›†ç¾¤ç±»å‹é€‰æ‹©ä»¥ä¸‹æ–¹æ³•ï¼š&lt;/p&gt;
&lt;h4 id="æ–¹æ³•ä¸€å•èŠ‚ç‚¹é›†ç¾¤ä¸»èŠ‚ç‚¹å³å·¥ä½œèŠ‚ç‚¹"&gt;&lt;strong&gt;æ–¹æ³•ä¸€ï¼šå•èŠ‚ç‚¹é›†ç¾¤ï¼ˆä¸»èŠ‚ç‚¹å³å·¥ä½œèŠ‚ç‚¹ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥åœ¨ä¸»èŠ‚ç‚¹æ„å»ºé•œåƒ&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;docker build -t my-local-image:latest .&lt;/code&gt;æ„å»ºé•œåƒï¼Œä¸»èŠ‚ç‚¹ä¼šç›´æ¥ä½¿ç”¨è¯¥é•œåƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–¹æ³•äºŒå¤šèŠ‚ç‚¹é›†ç¾¤"&gt;&lt;strong&gt;æ–¹æ³•äºŒï¼šå¤šèŠ‚ç‚¹é›†ç¾¤&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡&lt;code&gt;docker save&lt;/code&gt;å’Œ&lt;code&gt;docker load&lt;/code&gt;åˆ†å‘é•œåƒ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä¸»èŠ‚ç‚¹å°†é•œåƒä¿å­˜ä¸ºtaræ–‡ä»¶ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker save -o my-local-image.tar my-local-image:latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;å°†taræ–‡ä»¶ä¼ è¾“åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå¦‚ä½¿ç”¨&lt;code&gt;scp&lt;/code&gt;ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;scp my-local-image.tar user@node-ip:/path/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªèŠ‚ç‚¹åŠ è½½é•œåƒï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker load -i my-local-image.tar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ­¤æ–¹æ³•é€‚ç”¨äºåŸºäºDockerçš„KubernetesèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“&lt;/strong&gt;ï¼ˆå¦‚ä¸»èŠ‚ç‚¹è¿è¡ŒRegistryï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨æœ¬åœ°Registryï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d -p 5000:5000 --name registry registry:2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;æ ‡è®°å¹¶æ¨é€é•œåƒåˆ°Registryï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker tag my-local-image:latest localhost:5000/my-local-image:latest
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker push localhost:5000/my-local-image:latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;åœ¨Deploymenté…ç½®ä¸­ä½¿ç”¨&lt;code&gt;image: localhost:5000/my-local-image:latest&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–¹æ³•ä¸‰ç‰¹å®šå·¥å…·é“¾æ”¯æŒ"&gt;&lt;strong&gt;æ–¹æ³•ä¸‰ï¼šç‰¹å®šå·¥å…·é“¾æ”¯æŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kindé›†ç¾¤&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;kind load docker-image&lt;/code&gt;å‘½ä»¤å°†æœ¬åœ°é•œåƒç›´æ¥åŠ è½½åˆ°Kindé›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kind load docker-image my-local-image:latest --name &amp;lt;cluster-name&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€‚ç”¨äºå¼€å‘ç¯å¢ƒå¿«é€ŸåŠ è½½é•œåƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Minikubeé›†ç¾¤&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;minikube cache add&lt;/code&gt;å°†é•œåƒæ·»åŠ åˆ°ç¼“å­˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube cache add my-local-image:latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»…é€‚ç”¨äºMinikubeæœ¬åœ°å¼€å‘ç¯å¢ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-åº”ç”¨é…ç½®å¹¶éªŒè¯"&gt;&lt;strong&gt;3. åº”ç”¨é…ç½®å¹¶éªŒè¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ‰§è¡Œ&lt;code&gt;kubectl apply -f deployment.yaml&lt;/code&gt;éƒ¨ç½²åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥PodçŠ¶æ€ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl get pods
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;è‹¥Podå¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl logs &amp;lt;pod-name&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;å¸¸è§é—®é¢˜åŒ…æ‹¬é•œåƒæœªåŠ è½½åˆ°èŠ‚ç‚¹æˆ–æ ‡ç­¾é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ¨èæ–¹æ³•&lt;/th&gt;
&lt;th&gt;ç‰¹ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å•èŠ‚ç‚¹æœ¬åœ°å¼€å‘&lt;/td&gt;
&lt;td&gt;ç›´æ¥æ„å»º+&lt;code&gt;imagePullPolicy&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ— éœ€é¢å¤–æ“ä½œï¼Œå¿«é€ŸéªŒè¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤šèŠ‚ç‚¹ç”Ÿäº§ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;ç§æœ‰é•œåƒä»“åº“&lt;/td&gt;
&lt;td&gt;é›†ä¸­ç®¡ç†ï¼Œé€‚åˆå›¢é˜Ÿåä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Kind/Minikubeå¼€å‘ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;å·¥å…·é“¾å‘½ä»¤ï¼ˆå¦‚&lt;code&gt;kind load&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨åŒ–åŠ è½½ï¼Œé¿å…æ‰‹åŠ¨åˆ†å‘&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥çµæ´»å®ç°åœ¨K8sä¸­ç›´æ¥ä½¿ç”¨ä¸»èŠ‚ç‚¹æœ¬åœ°æ„å»ºçš„é•œåƒã€‚è‹¥éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ç»“åˆCI/CDæµæ°´çº¿è‡ªåŠ¨åŒæ­¥é•œåƒåˆ°é›†ç¾¤èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id="k8s-master--worker"&gt;K8s Master &amp;amp; Worker
&lt;/h2&gt;&lt;p&gt;Kubernetesï¼ˆK8sï¼‰çš„&lt;strong&gt;MasterèŠ‚ç‚¹&lt;/strong&gt;å’Œ&lt;strong&gt;WorkerèŠ‚ç‚¹&lt;/strong&gt;åœ¨é›†ç¾¤ä¸­æ‰¿æ‹…å®Œå…¨ä¸åŒçš„è§’è‰²ï¼Œä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ä½“ç°åœ¨åŠŸèƒ½å®šä½ã€æ ¸å¿ƒç»„ä»¶å’ŒèŒè´£åˆ†å·¥ä¸Šï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŠŸèƒ½å®šä½"&gt;&lt;strong&gt;åŠŸèƒ½å®šä½&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MasterèŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤çš„â€œå¤§è„‘â€&lt;/strong&gt;ï¼šè´Ÿè´£å…¨å±€ç®¡ç†ã€è°ƒåº¦å’Œåè°ƒï¼Œæ˜¯é›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ã€‚æ‰€æœ‰æ§åˆ¶å‘½ä»¤ï¼ˆå¦‚èµ„æºåˆ›å»ºã€æ‰©ç¼©å®¹ï¼‰å‡é€šè¿‡MasterèŠ‚ç‚¹æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨æ€§è¦æ±‚&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒä¸­é€šå¸¸éƒ¨ç½²å¤šä¸ªMasterèŠ‚ç‚¹ï¼ˆå¦‚3ä¸ªï¼‰ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´é›†ç¾¤ç˜«ç—ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WorkerèŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºçš„â€œæ‰§è¡Œè€…â€&lt;/strong&gt;ï¼šæä¾›è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ï¼‰å¹¶è¿è¡Œå®é™…çš„å·¥ä½œè´Ÿè½½ï¼ˆPodï¼‰ï¼Œæ˜¯é›†ç¾¤çš„æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•æ€§&lt;/strong&gt;ï¼šå¯æ ¹æ®è´Ÿè½½åŠ¨æ€å¢å‡WorkerèŠ‚ç‚¹ï¼Œæ”¯æŒæ¨ªå‘æ‰©å±•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç»„ä»¶"&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;MasterèŠ‚ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;WorkerèŠ‚ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;- &lt;strong&gt;kube-apiserver&lt;/strong&gt;ï¼šé›†ç¾¤APIå…¥å£ï¼Œå”¯ä¸€ä¸etcdäº¤äº’çš„ç»„ä»¶&lt;br&gt;- &lt;strong&gt;kube-scheduler&lt;/strong&gt;ï¼šè°ƒåº¦Podåˆ°åˆé€‚èŠ‚ç‚¹&lt;br&gt;- &lt;strong&gt;kube-controller-manager&lt;/strong&gt;ï¼šç»´æŠ¤é›†ç¾¤çŠ¶æ€ï¼ˆå¦‚è‡ªæ„ˆã€å‰¯æœ¬æ•°ï¼‰&lt;br&gt;- &lt;strong&gt;etcd&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼Œä¿å­˜é›†ç¾¤çŠ¶æ€&lt;/td&gt;
&lt;td&gt;- &lt;strong&gt;kubelet&lt;/strong&gt;ï¼šç®¡ç†Podç”Ÿå‘½å‘¨æœŸï¼Œä¸Masteré€šä¿¡&lt;br&gt;- &lt;strong&gt;kube-proxy&lt;/strong&gt;ï¼šç»´æŠ¤æœåŠ¡ç½‘ç»œè§„åˆ™å’Œè´Ÿè½½å‡è¡¡&lt;br&gt;- &lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶&lt;/strong&gt;ï¼ˆå¦‚Docker/containerdï¼‰ï¼šè¿è¡Œå®¹å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®å­˜å‚¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­˜å‚¨é›†ç¾¤å…¨å±€çŠ¶æ€ï¼ˆå¦‚Podã€Serviceé…ç½®ï¼‰äºetcd&lt;/td&gt;
&lt;td&gt;æ— æŒä¹…åŒ–å­˜å‚¨ï¼Œä»…è¿è¡Œä¸´æ—¶Pod&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç½‘ç»œç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸ç›´æ¥å‚ä¸Podç½‘ç»œï¼Œç”±kube-proxyå’ŒCNIæ’ä»¶å®ç°&lt;/td&gt;
&lt;td&gt;é€šè¿‡kube-proxyå®ç°Serviceç½‘ç»œè§„åˆ™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="èŒè´£åˆ†å·¥"&gt;&lt;strong&gt;èŒè´£åˆ†å·¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MasterèŠ‚ç‚¹çš„æ ¸å¿ƒèŒè´£&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤çŠ¶æ€ç®¡ç†&lt;/strong&gt;ï¼šé€šè¿‡etcdå­˜å‚¨æ‰€æœ‰èµ„æºå¯¹è±¡çš„é…ç½®å’ŒçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºè°ƒåº¦&lt;/strong&gt;ï¼šç”±Scheduleræ ¹æ®èµ„æºéœ€æ±‚é€‰æ‹©æœ€ä½³WorkerèŠ‚ç‚¹è¿è¡ŒPodã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶å¾ªç¯&lt;/strong&gt;ï¼šController Managerç¡®ä¿é›†ç¾¤å®é™…çŠ¶æ€ä¸æœŸæœ›ä¸€è‡´ï¼ˆå¦‚è‡ªåŠ¨é‡å¯å¤±è´¥çš„Podï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;APIæœåŠ¡&lt;/strong&gt;ï¼šæä¾›RESTfulæ¥å£ä¾›ç”¨æˆ·å’Œç»„ä»¶äº¤äº’ï¼ˆå¦‚kubectlå‘½ä»¤ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WorkerèŠ‚ç‚¹çš„æ ¸å¿ƒèŒè´£&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œå®¹å™¨&lt;/strong&gt;ï¼šé€šè¿‡å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨Podä¸­çš„å®¹å™¨ï¼Œå¹¶ç›‘æ§å…¶çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€ä¸ŠæŠ¥&lt;/strong&gt;ï¼škubeletå®šæœŸå‘Masteræ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µï¼ˆå¦‚CPUã€å†…å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œä»£ç†&lt;/strong&gt;ï¼škube-proxyç»´æŠ¤Serviceçš„IPå’Œç«¯å£æ˜ å°„ï¼Œç¡®ä¿æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç±»æ¯”æ€»ç»“"&gt;&lt;strong&gt;ç±»æ¯”æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MasterèŠ‚ç‚¹&lt;/strong&gt;ï¼šç±»ä¼¼ä¼ä¸šçš„â€œç®¡ç†å±‚â€ï¼Œè´Ÿè´£åˆ¶å®šç­–ç•¥ã€åˆ†é…ä»»åŠ¡å¹¶ç›‘æ§å…¨å±€è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WorkerèŠ‚ç‚¹&lt;/strong&gt;ï¼šç±»ä¼¼â€œä¸€çº¿å‘˜å·¥â€ï¼Œå…·ä½“æ‰§è¡Œä»»åŠ¡å¹¶åé¦ˆæ‰§è¡Œæƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‹¥éœ€æ›´æ·±å…¥çš„ç»„ä»¶äº¤äº’æµç¨‹ï¼ˆå¦‚Podåˆ›å»ºè¿‡ç¨‹ï¼‰æˆ–é«˜å¯ç”¨éƒ¨ç½²æ–¹æ¡ˆï¼Œå¯å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id="master-èŠ‚ç‚¹è¦æ±‚"&gt;Master èŠ‚ç‚¹è¦æ±‚
&lt;/h2&gt;&lt;p&gt;Kubernetes çš„ Master èŠ‚ç‚¹ç¡®å®ä¸»è¦è´Ÿè´£é›†ç¾¤çš„è°ƒåº¦å’Œç®¡ç†ï¼Œé»˜è®¤ä¸è¿è¡Œç”¨æˆ· Podï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å…¶å†…å­˜å’Œ GPU çš„éœ€æ±‚å¯ä»¥å¤§å¹…é™ä½ã€‚ä»¥ä¸‹ä»ç¡¬ä»¶è¦æ±‚ã€æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§ã€èµ„æºå ç”¨åœºæ™¯ä¸‰ä¸ªç»´åº¦è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å†…å­˜éœ€æ±‚çš„åº•å±‚é€»è¾‘"&gt;&lt;strong&gt;å†…å­˜éœ€æ±‚çš„åº•å±‚é€»è¾‘&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ Master èŠ‚ç‚¹ä¸è¿è¡Œç”¨æˆ· Podï¼Œä½†å…¶æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ &lt;code&gt;kube-apiserver&lt;/code&gt;ã€&lt;code&gt;etcd&lt;/code&gt;ã€&lt;code&gt;kube-scheduler&lt;/code&gt; ç­‰ï¼‰åœ¨ &lt;strong&gt;é«˜å¹¶å‘è¯·æ±‚æˆ–å¤§è§„æ¨¡é›†ç¾¤&lt;/strong&gt; ä¸‹ä¼šäº§ç”Ÿæ˜¾è‘—å†…å­˜æ¶ˆè€—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;etcd çš„å†…å­˜ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;etcd å­˜å‚¨é›†ç¾¤æ‰€æœ‰çŠ¶æ€æ•°æ®ï¼ˆPodã€Service ç­‰ï¼‰ï¼Œé¢‘ç¹çš„è¯»å†™æ“ä½œï¼ˆå¦‚å¤§è§„æ¨¡ Pod æ»šåŠ¨æ›´æ–°ï¼‰ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ®å®è·µæ¡ˆä¾‹ï¼Œç”Ÿäº§çº§é›†ç¾¤çš„ etcd å†…å­˜å»ºè®®ä¸ä½äº &lt;strong&gt;8GB&lt;/strong&gt;ï¼Œè¶…å¤§è§„æ¨¡é›†ç¾¤ï¼ˆå¦‚åƒèŠ‚ç‚¹çº§åˆ«ï¼‰éœ€æå‡è‡³ &lt;strong&gt;16GB ä»¥ä¸Š&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;API Server çš„å¹¶å‘å‹åŠ›&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kube-apiserver&lt;/code&gt; æ˜¯é›†ç¾¤çš„æµé‡å…¥å£ï¼Œéœ€å¤„ç†æ¥è‡ª &lt;code&gt;kubectl&lt;/code&gt;ã€Controllerã€Worker èŠ‚ç‚¹çš„å¿ƒè·³ç­‰è¯·æ±‚ã€‚å½“é›†ç¾¤è§„æ¨¡æ‰©å¤§æ—¶ï¼Œå…¶å†…å­˜å ç”¨ä¼šçº¿æ€§å¢é•¿ã€‚ä¾‹å¦‚ï¼Œ500 èŠ‚ç‚¹çš„é›†ç¾¤ä¸­ API Server å†…å­˜å¯èƒ½è¾¾åˆ° &lt;strong&gt;4-6GB&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤é…ç½®ä¸å®‰å…¨ç¼“å†²&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹æ¨è Master èŠ‚ç‚¹å†…å­˜æœ€ä½ä¸º &lt;strong&gt;8GB&lt;/strong&gt;ï¼Œä½†ç”Ÿäº§ç¯å¢ƒå»ºè®® &lt;strong&gt;16GB ä»¥ä¸Š&lt;/strong&gt;ï¼Œä¸ºçªå‘æµé‡ï¼ˆå¦‚æ‰¹é‡åˆ›å»º Podï¼‰å’Œç»„ä»¶å‡çº§é¢„ç•™ç¼“å†²ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="gpu-éœ€æ±‚çš„æ˜ç¡®ç»“è®º"&gt;&lt;strong&gt;GPU éœ€æ±‚çš„æ˜ç¡®ç»“è®º&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Master èŠ‚ç‚¹ &lt;strong&gt;å®Œå…¨ä¸éœ€è¦ GPU&lt;/strong&gt;ï¼Œå› å…¶èŒè´£ä¸æ¶‰åŠä»»ä½• GPU è®¡ç®—åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒåº¦ä¸ GPU æ— å…³æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦å™¨ï¼ˆ&lt;code&gt;kube-scheduler&lt;/code&gt;ï¼‰ä»…æ ¹æ® Pod çš„èµ„æºå£°æ˜ï¼ˆå¦‚ &lt;code&gt;nvidia.com/gpu: 1&lt;/code&gt;ï¼‰é€‰æ‹©èŠ‚ç‚¹ï¼Œä¸å‚ä¸ GPU é©±åŠ¨çš„è°ƒç”¨æˆ–è®¡ç®—è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;GPU èµ„æºä¸“å±äº Worker èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GPU èŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½®ï¼ˆå¦‚æ˜¾å­˜ã€é©±åŠ¨ï¼‰ä»…åœ¨ Worker èŠ‚ç‚¹éƒ¨ç½²ï¼ŒMaster èŠ‚ç‚¹æ— éœ€å®‰è£… NVIDIA é©±åŠ¨æˆ– GPU æ’ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ç­–ç•¥"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é’ˆå¯¹ä¸åŒåœºæ™¯ï¼Œå¯è°ƒæ•´ Master èŠ‚ç‚¹çš„èµ„æºé…ç½®ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;CPU å»ºè®®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å†…å­˜å»ºè®®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¤‡æ³¨&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€å‘/æµ‹è¯•é›†ç¾¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;4 æ ¸&lt;/td&gt;
&lt;td&gt;8GB&lt;/td&gt;
&lt;td&gt;ä½è´Ÿè½½åœºæ™¯ï¼Œæ”¯æŒåŸºæœ¬è°ƒåº¦åŠŸèƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿäº§çº§é›†ç¾¤ï¼ˆ&amp;lt;100èŠ‚ç‚¹ï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;8 æ ¸&lt;/td&gt;
&lt;td&gt;16-32GB&lt;/td&gt;
&lt;td&gt;éœ€åº”å¯¹é«˜å¹¶å‘ API è¯·æ±‚å’Œ etcd å‹åŠ›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¶…å¤§è§„æ¨¡/AI é›†ç¾¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;16 æ ¸ä»¥ä¸Š&lt;/td&gt;
&lt;td&gt;64GB ä»¥ä¸Š&lt;/td&gt;
&lt;td&gt;ç»“åˆ RDMA ç½‘ç»œä¼˜åŒ–ï¼Œé¿å…æˆä¸ºæ€§èƒ½ç“¶é¢ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®é…ç½®å»ºè®®"&gt;&lt;strong&gt;å…³é”®é…ç½®å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨ Swap&lt;/strong&gt;&lt;br&gt;
æ‰€æœ‰ Master èŠ‚ç‚¹å¿…é¡»å…³é—­ Swapï¼Œé¿å…å†…å­˜äº¤æ¢å¯¼è‡´è°ƒåº¦å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸“ç”¨å­˜å‚¨ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
ä¸º etcd é…ç½® SSD æˆ– NVMe ç¡¬ç›˜ï¼Œæå‡é”®å€¼å­˜å‚¨æ€§èƒ½ï¼ˆIOPS &amp;gt;5000ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨éƒ¨ç½²&lt;/strong&gt;&lt;br&gt;
ç”Ÿäº§ç¯å¢ƒè‡³å°‘éƒ¨ç½² &lt;strong&gt;3 ä¸ª Master èŠ‚ç‚¹&lt;/strong&gt;ï¼Œå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡åˆ†æ•£ API Server æµé‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;GPU éœ€æ±‚&lt;/strong&gt;ï¼šMaster èŠ‚ç‚¹æ— éœ€ GPUï¼Œä»… Worker èŠ‚ç‚¹éœ€è¦é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜éœ€æ±‚&lt;/strong&gt;ï¼šä¸å¯è¿‡åº¦å‹ç¼©ï¼Œéœ€æ ¹æ®é›†ç¾¤è§„æ¨¡é¢„ç•™å……è¶³èµ„æºï¼ˆ&lt;strong&gt;8GB èµ·æ­¥ï¼Œç”Ÿäº§ç¯å¢ƒ 16GB ä»¥ä¸Š&lt;/strong&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆè§„é¿&lt;/strong&gt;ï¼šé€šè¿‡ SSDã€å¤šèŠ‚ç‚¹éƒ¨ç½²å’Œå†…æ ¸å‚æ•°ä¼˜åŒ–ï¼ˆå¦‚ &lt;code&gt;net.ipv4.ip_forward=1&lt;/code&gt;ï¼‰æå‡ç¨³å®šæ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="minikube-é¢„ç”Ÿäº§éªŒè¯"&gt;Minikube é¢„ç”Ÿäº§éªŒè¯
&lt;/h2&gt;&lt;p&gt;Minikube &lt;strong&gt;ä¸æ¨èç”¨äºé¢„ç”Ÿäº§éªŒè¯&lt;/strong&gt;ï¼Œå…¶è®¾è®¡å®šä½å’ŒåŠŸèƒ½ç‰¹æ€§ä¸»è¦é¢å‘æœ¬åœ°å¼€å‘ã€å­¦ä¹ å’Œå°è§„æ¨¡æµ‹è¯•åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="minikubeçš„æ ¸å¿ƒå®šä½ä¸åŠŸèƒ½é™åˆ¶"&gt;&lt;strong&gt;Minikubeçš„æ ¸å¿ƒå®šä½ä¸åŠŸèƒ½é™åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•èŠ‚ç‚¹æ¶æ„&lt;/strong&gt;ï¼šMinikubeé»˜è®¤éƒ¨ç½²å•èŠ‚ç‚¹Kubernetesé›†ç¾¤ï¼Œæ— æ³•æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¸­å¸¸è§çš„å¤šèŠ‚ç‚¹é«˜å¯ç”¨æ¶æ„ï¼ˆå¦‚MasterèŠ‚ç‚¹å†—ä½™ã€è´Ÿè½½å‡è¡¡ç­‰ï¼‰ã€‚è™½ç„¶é€šè¿‡&lt;code&gt;--nodes&lt;/code&gt;å‚æ•°å¯æ‰©å±•ä¸ºå¤šèŠ‚ç‚¹æ¨¡å¼ï¼Œä½†å…¶åº•å±‚ä»ä¾èµ–è™šæ‹ŸåŒ–æˆ–å®¹å™¨ç¯å¢ƒï¼Œèµ„æºè°ƒåº¦å’Œç½‘ç»œæ€§èƒ½ä¸çœŸå®é›†ç¾¤å­˜åœ¨å·®å¼‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºé™åˆ¶&lt;/strong&gt;ï¼šMinikubeè¿è¡Œåœ¨æœ¬åœ°æœºå™¨çš„è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå—é™äºæœ¬åœ°ç¡¬ä»¶èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ï¼‰ï¼Œæ— æ³•æ‰¿è½½ç”Ÿäº§çº§è´Ÿè½½å‹åŠ›æµ‹è¯•æˆ–å¤§è§„æ¨¡å¹¶å‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»„ä»¶ç®€åŒ–&lt;/strong&gt;ï¼šMinikubeé»˜è®¤ä½¿ç”¨è½»é‡çº§ç½‘ç»œæ’ä»¶ï¼ˆå¦‚flannelï¼‰å’Œå­˜å‚¨æ–¹æ¡ˆï¼Œè€Œç”Ÿäº§ç¯å¢ƒé€šå¸¸éœ€è¦æ›´å¤æ‚çš„CNIï¼ˆå¦‚Calicoã€Ciliumï¼‰å’ŒæŒä¹…åŒ–å­˜å‚¨é…ç½®ï¼ˆå¦‚äº‘å­˜å‚¨å·ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é¢„ç”Ÿäº§éªŒè¯çš„æ ¸å¿ƒéœ€æ±‚"&gt;&lt;strong&gt;é¢„ç”Ÿäº§éªŒè¯çš„æ ¸å¿ƒéœ€æ±‚&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é¢„ç”Ÿäº§ç¯å¢ƒéœ€å°½å¯èƒ½è´´è¿‘ç”Ÿäº§ç¯å¢ƒï¼ŒéªŒè¯å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨æ€§&lt;/strong&gt;ï¼šå¤šèŠ‚ç‚¹é›†ç¾¤çš„æ•…éšœè½¬ç§»èƒ½åŠ›ã€API Serverå†—ä½™ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œä¸å­˜å‚¨æ€§èƒ½&lt;/strong&gt;ï¼šçœŸå®ç½‘ç»œå»¶è¿Ÿã€å¸¦å®½åŠå­˜å‚¨I/Oçš„æ¨¡æ‹Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼šç”Ÿäº§çº§RBACç­–ç•¥ã€ç½‘ç»œç­–ç•¥ç­‰å®‰å…¨é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;ï¼šè‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½çš„ç¨³å®šæ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Minikubeåœ¨è¿™äº›æ–¹é¢çš„æ”¯æŒæœ‰é™ï¼Œä¾‹å¦‚å…¶å†…ç½®çš„&lt;code&gt;kube-proxy&lt;/code&gt;ä»…æä¾›åŸºç¡€çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦æ›´å¤æ‚çš„Ingressæ§åˆ¶å™¨æˆ–æœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ›¿ä»£æ–¹æ¡ˆå»ºè®®"&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€è¿›è¡Œé¢„ç”Ÿäº§éªŒè¯ï¼Œå»ºè®®é€‰æ‹©ä»¥ä¸‹å·¥å…·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;K3s&lt;/strong&gt;ï¼šè½»é‡çº§ä½†æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œé€‚åˆè¾¹ç¼˜è®¡ç®—å’Œèµ„æºå—é™ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kindï¼ˆKubernetes in Dockerï¼‰&lt;/strong&gt;ï¼šåŸºäºå®¹å™¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œé€‚åˆCI/CDæµæ°´çº¿æµ‹è¯•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘æ‰˜ç®¡KubernetesæœåŠ¡&lt;/strong&gt;ï¼ˆå¦‚è…¾è®¯äº‘TKEï¼‰ï¼šç›´æ¥ä½¿ç”¨ä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´çš„äº‘åŸç”Ÿæ¶æ„ï¼Œæ”¯æŒé«˜å¯ç”¨é›†ç¾¤å’Œè‡ªåŠ¨åŒ–è¿ç»´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç»“è®º"&gt;ç»“è®º
&lt;/h3&gt;&lt;p&gt;Minikubeé€‚ç”¨äº&lt;strong&gt;æœ¬åœ°å¼€å‘è°ƒè¯•&lt;/strong&gt;å’Œ&lt;strong&gt;KubernetesåŸºç¡€å­¦ä¹ &lt;/strong&gt;ï¼Œä½†æ— æ³•æ»¡è¶³é¢„ç”Ÿäº§éªŒè¯å¯¹å¤æ‚æ€§å’ŒçœŸå®æ€§çš„è¦æ±‚ã€‚è‹¥éœ€é¢„ç”Ÿäº§éªŒè¯ï¼Œåº”é€‰æ‹©æ”¯æŒå¤šèŠ‚ç‚¹ã€é«˜å¯ç”¨æ€§åŠç”Ÿäº§çº§ç»„ä»¶çš„å·¥å…·æˆ–äº‘æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id="github-action"&gt;Github Action
&lt;/h2&gt;&lt;p&gt;åœ¨æœåŠ¡å™¨ä¸Šåˆ©ç”¨ GitHub Actions æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œçš„æ ¸å¿ƒæµç¨‹æ˜¯é€šè¿‡å·¥ä½œæµï¼ˆWorkflowï¼‰è§¦å‘è¿œç¨‹å‘½ä»¤ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æµ‹è¯•æˆ–è¿ç»´ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯å…³é”®æ­¥éª¤å’Œé…ç½®æ–¹æ³•ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é…ç½®æœåŠ¡å™¨è®¤è¯ssh-å¯†é’¥"&gt;ğŸ”‘ é…ç½®æœåŠ¡å™¨è®¤è¯ï¼ˆSSH å¯†é’¥ï¼‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿæˆ SSH å¯†é’¥å¯¹&lt;/strong&gt;&lt;br&gt;
åœ¨æœ¬åœ°æˆ–æœåŠ¡å™¨æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ssh-keygen -t rsa -b &lt;span class="m"&gt;4096&lt;/span&gt; -C &lt;span class="s2"&gt;&amp;#34;github-actions&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;# ç”Ÿæˆä¸“ç”¨å¯†é’¥å¯¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¬é’¥ï¼ˆ&lt;code&gt;id_rsa.pub&lt;/code&gt;ï¼‰éœ€æ·»åŠ åˆ°æœåŠ¡å™¨çš„ &lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt; æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ GitHub ä»“åº“æ·»åŠ å¯†é’¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç§é’¥ï¼ˆ&lt;code&gt;id_rsa&lt;/code&gt;ï¼‰å­˜å…¥ GitHub ä»“åº“çš„ &lt;strong&gt;Settings â†’ Secrets&lt;/strong&gt;ï¼Œå‘½åä¸º &lt;code&gt;SERVER_SSH_KEY&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ IPã€ç”¨æˆ·åç­‰æ•æ„Ÿä¿¡æ¯ä¹Ÿå­˜å…¥ Secretsï¼ˆå¦‚ &lt;code&gt;SERVER_HOST&lt;/code&gt;ã€&lt;code&gt;SERVER_USER&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ç¼–å†™-github-actions-å·¥ä½œæµ"&gt;âš™ï¸ ç¼–å†™ GitHub Actions å·¥ä½œæµ
&lt;/h3&gt;&lt;p&gt;åœ¨ä»“åº“åˆ›å»º &lt;code&gt;.github/workflows/custom-action.yml&lt;/code&gt; æ–‡ä»¶ï¼Œç¤ºä¾‹ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Server Custom Task&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;push&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;branches&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="l"&gt;main] &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# è§¦å‘æ¡ä»¶ï¼šæ¨é€è‡³ main åˆ†æ”¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;workflow_dispatch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ”¯æŒæ‰‹åŠ¨è§¦å‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;jobs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;execute-commands&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;runs-on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;ubuntu-latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;steps&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Checkout code&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;actions/checkout@v4 &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ£€å‡ºä»£ç &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Add SSH Key&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="sd"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; echo &amp;#34;${{ secrets.SERVER_SSH_KEY }}&amp;#34; &amp;gt; deploy_key.pem
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; chmod 600 deploy_key.pem # è®¾ç½®å¯†é’¥æƒé™&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Run Remote Commands&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;appleboy/ssh-action@master &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# SSH æ‰§è¡Œå‘½ä»¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;${{ secrets.SERVER_HOST }}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;username&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;${{ secrets.SERVER_USER }}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;deploy_key.pem&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;| &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# è‡ªå®šä¹‰æ“ä½œç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;cd /path/to/project&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;git pull origin main&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;npm install&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;systemctl restart my-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-è‡ªå®šä¹‰æ“ä½œåœºæ™¯ç¤ºä¾‹"&gt;ğŸ’» è‡ªå®šä¹‰æ“ä½œåœºæ™¯ç¤ºä¾‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½²åº”ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹‰å–ä»£ç åæ‰§è¡Œæ„å»ºå‘½ä»¤ï¼ˆå¦‚ &lt;code&gt;mvn package&lt;/code&gt; / &lt;code&gt;npm run build&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;scp&lt;/code&gt; æˆ– &lt;code&gt;rsync&lt;/code&gt; åŒæ­¥æ–‡ä»¶åˆ°æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é‡å¯æœåŠ¡&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ SSH æ‰§è¡ŒæœåŠ¡ç®¡ç†å‘½ä»¤ï¼ˆå¦‚ &lt;code&gt;docker-compose up -d&lt;/code&gt; æˆ– &lt;code&gt;systemctl restart&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šæ—¶ä»»åŠ¡&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;schedule&lt;/code&gt; è§¦å‘å™¨å®šæœŸæ‰§è¡Œå¤‡ä»½æˆ–æ¸…ç†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;schedule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;cron&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0 2 * * *&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ¯å¤© UTC æ—¶é—´ 2:00&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;API è§¦å‘&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;repository_dispatch&lt;/code&gt; äº‹ä»¶æ¥æ”¶å¤–éƒ¨è¯·æ±‚è§¦å‘å·¥ä½œæµï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X POST https://api.github.com/repos/:owner/:repo/dispatches &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Authorization: token &lt;/span&gt;&lt;span class="nv"&gt;$GITHUB_TOKEN&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&amp;#34;event_type&amp;#34;: &amp;#34;trigger-backup&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆIPã€å¯†é’¥ï¼‰å¿…é¡»é€šè¿‡ &lt;strong&gt;Secrets&lt;/strong&gt; å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶æœåŠ¡å™¨è´¦æˆ·æƒé™ï¼ˆé¿å…ä½¿ç”¨ &lt;code&gt;root&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥éœ€æœåŠ¡å™¨ç¯å¢ƒï¼ˆå¦‚ Node.js/Pythonï¼‰ï¼Œåœ¨è„šæœ¬ä¸­æ˜¾å¼å£°æ˜ç¯å¢ƒé…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜åŠ é€Ÿä¾èµ–å®‰è£…ï¼ˆå¦‚ &lt;code&gt;actions/cache&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—ä¸è°ƒè¯•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·¥ä½œæµæ—¥å¿—åœ¨ GitHub çš„ &lt;strong&gt;Actions&lt;/strong&gt; æ ‡ç­¾é¡µå®æ—¶æŸ¥çœ‹ã€‚&lt;/li&gt;
&lt;li&gt;å¤æ‚è„šæœ¬å»ºè®®å…ˆåœ¨æœåŠ¡å™¨æœ¬åœ°æµ‹è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-é«˜çº§æŠ€å·§"&gt;ğŸ”§ é«˜çº§æŠ€å·§
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çŸ©é˜µç­–ç•¥&lt;/strong&gt;ï¼šåŒæ—¶æµ‹è¯•å¤šç¯å¢ƒï¼ˆå¦‚ä¸åŒç³»ç»Ÿæˆ–ç‰ˆæœ¬ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;strategy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;matrix&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;os&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="l"&gt;ubuntu-22.04, windows-latest]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;node&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;18.&lt;/span&gt;&lt;span class="l"&gt;x, 20.x]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä»¶ä¼ é€’&lt;/strong&gt;ï¼šç”¨ &lt;code&gt;actions/upload-artifact&lt;/code&gt; å’Œ &lt;code&gt;actions/download-artifact&lt;/code&gt; è·¨ä½œä¸šå…±äº«æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¡æ‰¹æµç¨‹&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;pull_request_review&lt;/code&gt; äº‹ä»¶å®ç°éƒ¨ç½²å‰äººå·¥å®¡æ ¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æµç¨‹ï¼ŒGitHub Actions å¯æ— ç¼å¯¹æ¥è‡ªæœ‰æœåŠ¡å™¨ï¼Œå®ç°ä»ä»£ç æ¨é€åˆ°æœåŠ¡æ›´æ–°çš„å…¨é“¾è·¯è‡ªåŠ¨åŒ–ã€‚å®é™…é…ç½®æ—¶éœ€æ ¹æ®é¡¹ç›®éœ€æ±‚è°ƒæ•´è„šæœ¬å’Œè§¦å‘æ¡ä»¶ï¼Œå¹¶ä¼˜å…ˆéªŒè¯å…³é”®æ­¥éª¤çš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;h2 id="è¿æ¥æŠ¥é”™"&gt;è¿æ¥æŠ¥é”™
&lt;/h2&gt;&lt;p&gt;æ ¹æ®é”™è¯¯æ—¥å¿—åˆ†æï¼ŒGitHub Action ä½¿ç”¨ &lt;code&gt;appleboy/ssh-action&lt;/code&gt; æ—¶å‡ºç°è®¤è¯å¤±è´¥çš„æ ¸å¿ƒåŸå› æ˜¯ &lt;strong&gt;SSH ç§é’¥è§£æå¤±è´¥&lt;/strong&gt;ï¼ˆ&lt;code&gt;ssh.ParsePrivateKey: ssh: no key found&lt;/code&gt;ï¼‰ï¼Œå¯¼è‡´åç»­è®¤è¯æ–¹æ³•å…¨éƒ¨å¤±æ•ˆã€‚ä»¥ä¸‹æ˜¯å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-é”™è¯¯åŸå› åˆ†æ"&gt;ğŸ” é”™è¯¯åŸå› åˆ†æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç§é’¥æ ¼å¼æ— æ•ˆ&lt;/strong&gt;ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨åœ¨ GitHub Secrets ä¸­çš„ç§é’¥å¯èƒ½ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼ºå°‘æ ‡å‡†çš„ &lt;code&gt;-----BEGIN OPENSSH PRIVATE KEY-----&lt;/code&gt; å¤´æˆ– &lt;code&gt;-----END...&lt;/code&gt; å°¾&lt;/li&gt;
&lt;li&gt;åŒ…å«å¤šä½™ç©ºæ ¼/æ¢è¡Œç¬¦&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä¸å…¼å®¹çš„å¯†é’¥ç±»å‹ï¼ˆå¦‚æ—§ç‰ˆ PEM æ ¼å¼ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é”™è¯¯æ—¥å¿—æ˜ç¡®æç¤ºï¼š&lt;code&gt;ssh: no key found&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æƒé™é…ç½®é—®é¢˜&lt;/strong&gt;ï¼ˆæ¬¡è¦å¯èƒ½ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Action è¿è¡Œæ—¶æœªæ­£ç¡®è®¾ç½®ç§é’¥æ–‡ä»¶æƒé™ï¼ˆéœ€ &lt;code&gt;600&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯ &lt;code&gt;authorized_keys&lt;/code&gt; æ–‡ä»¶æƒé™é”™è¯¯ï¼ˆéœ€ &lt;code&gt;600&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å™¨ SSH é…ç½®é™åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt; ä¸­æœªå¯ç”¨å…¬é’¥è®¤è¯ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;PubkeyAuthentication yes &lt;span class="c1"&gt;# å¿…é¡»ä¸º yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è§£å†³æ–¹æ¡ˆé€æ­¥æ“ä½œ"&gt;ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼ˆé€æ­¥æ“ä½œï¼‰
&lt;/h3&gt;&lt;h4 id="æ­¥éª¤-1ä¿®å¤ç§é’¥æ ¼å¼å…³é”®"&gt;æ­¥éª¤ 1ï¼šä¿®å¤ç§é’¥æ ¼å¼ï¼ˆå…³é”®ï¼ï¼‰
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬åœ°éªŒè¯ç§é’¥æœ‰æ•ˆæ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ssh-keygen -p -f ~/.ssh/id_rsa &lt;span class="c1"&gt;# è¾“å…¥å¯†ç ï¼ˆå¦‚æœ‰ï¼‰éªŒè¯å¯†é’¥å®Œæ•´æ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;è‹¥æŠ¥é”™ &lt;code&gt;Invalid format&lt;/code&gt;ï¼Œè¯´æ˜å¯†é’¥æŸå&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é‡æ–°ç”Ÿæˆæ ‡å‡†å¯†é’¥å¯¹&lt;/strong&gt;ï¼ˆæ¨èï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ssh-keygen -t ed25519 -f new_key -C &lt;span class="s2"&gt;&amp;#34;github-action&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;# ç°ä»£ç®—æ³•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# æˆ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ssh-keygen -t rsa -b &lt;span class="m"&gt;4096&lt;/span&gt; -f new_key -C &lt;span class="s2"&gt;&amp;#34;github-action&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ£€æŸ¥ç§é’¥æ ¼å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cat new_key &lt;span class="c1"&gt;# å¿…é¡»åŒ…å«å®Œæ•´å¤´å°¾æ ‡è®°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;âœ… æ­£ç¡®æ ¼å¼ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW...
-----END OPENSSH PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–° GitHub Secrets&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°† &lt;code&gt;new_key&lt;/code&gt; å†…å®¹å®Œæ•´å¤åˆ¶åˆ° &lt;code&gt;SSH_PRIVATE_KEY&lt;/code&gt; Secret&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¦æ­¢ä¿®æ”¹&lt;/strong&gt;ï¼šä¸åˆ é™¤å¤´å°¾æ ‡è®°ã€ä¸å¢å‡æ¢è¡Œç¬¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ­¥éª¤-2ä¿®æ­£-action-é…ç½®"&gt;æ­¥éª¤ 2ï¼šä¿®æ­£ Action é…ç½®
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;SSH Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;appleboy/ssh-action@v0.1.13 &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å›ºå®šç¨³å®šç‰ˆæœ¬&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;${{ secrets.SSH_HOST }}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;username&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;${{ secrets.SSH_USERNAME }}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;${{ secrets.SSH_PRIVATE_KEY }}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ·»åŠ è°ƒè¯•å‚æ•° â†“&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å¼€å¯è¯¦ç»†æ—¥å¿—&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="sd"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="sd"&gt; echo &amp;#34;è¿æ¥æˆåŠŸï¼&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ­¥éª¤-3æœåŠ¡å™¨ç«¯æ£€æŸ¥"&gt;æ­¥éª¤ 3ï¼šæœåŠ¡å™¨ç«¯æ£€æŸ¥
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¡®è®¤å…¬é’¥å·²æ·»åŠ &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cat ~/.ssh/authorized_keys &lt;span class="c1"&gt;# åº”åŒ…å« id_rsa.pub å†…å®¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤æƒé™&lt;/strong&gt;ï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;chmod &lt;span class="m"&gt;700&lt;/span&gt; ~/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;chmod &lt;span class="m"&gt;600&lt;/span&gt; ~/.ssh/authorized_keys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ£€æŸ¥ SSH é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo grep -E &lt;span class="s2"&gt;&amp;#34;PubkeyAuthentication|PermitRootLogin&amp;#34;&lt;/span&gt; /etc/ssh/sshd_config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ç¡®ä¿è¾“å‡ºåŒ…å«ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;PubkeyAuthentication yes
PermitRootLogin prohibit-password # æˆ– yesï¼ˆæ ¹æ®éœ€æ±‚ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;é‡å¯æœåŠ¡ï¼š&lt;code&gt;sudo systemctl restart sshd&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ­¥éª¤-4æœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•å¯é€‰"&gt;æ­¥éª¤ 4ï¼šæœ¬åœ°æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
&lt;/h4&gt;&lt;p&gt;åœ¨ GitHub Action è¿è¡Œå‰ï¼Œæœ¬åœ°éªŒè¯å¯†é’¥æœ‰æ•ˆæ€§ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ssh -i path/to/new_key -v &lt;span class="nv"&gt;$SSH_USER&lt;/span&gt;@&lt;span class="nv"&gt;$SSH_HOST&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;è§‚å¯Ÿ &lt;code&gt;debug1: Authentication succeeded (publickey)&lt;/code&gt; è¾“å‡º&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-æ³¨æ„äº‹é¡¹-2"&gt;âš ï¸ æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç§é’¥å®‰å…¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ°¸è¿œä¸è¦å°†ç§é’¥æäº¤åˆ°ä»£ç åº“&lt;/li&gt;
&lt;li&gt;GitHub Secrets å­˜å‚¨æ—¶é¿å…æ¢è¡Œç¬¦è‡ªåŠ¨è½¬æ¢ï¼ˆå»ºè®®å¤åˆ¶åæ£€æŸ¥å­—ç¬¦æ•°ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Action ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…ä½¿ç”¨ &lt;code&gt;@master&lt;/code&gt;ï¼Œæ”¹ç”¨å›ºå®šç‰ˆæœ¬å¦‚ &lt;code&gt;@v0.1.13&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤åˆå¯†é’¥é—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨åŠ å¯†ç§é’¥ï¼ˆæœ‰å¯†ç ï¼‰ï¼Œéœ€åœ¨ Action ä¸­é€šè¿‡ &lt;code&gt;passphrase&lt;/code&gt; å‚æ•°ä¼ é€’å¯†ç &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-è°ƒè¯•æŠ€å·§"&gt;ğŸ’¡ è°ƒè¯•æŠ€å·§
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨è¯¦ç»†æ—¥å¿—&lt;/strong&gt;ï¼šåœ¨ Action ä¸­æ·»åŠ  &lt;code&gt;debug: true&lt;/code&gt; å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†æ­¥æµ‹è¯•&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;å…ˆå°è¯•æ‰§è¡Œ &lt;code&gt;ls&lt;/code&gt; ç­‰ç®€å•å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å†é€æ­¥å¢åŠ  &lt;code&gt;git pull&lt;/code&gt; ç­‰æ“ä½œ&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥çœ‹å®Œæ•´æ—¥å¿—&lt;/strong&gt;ï¼šGitHub Action é¡µé¢ç‚¹å‡» â€œRun entrypoint.shâ€ å±•å¼€è¯¦ç»†é”™è¯¯&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ç»æµ‹è¯•ï¼Œ90% çš„ç±»ä¼¼é”™è¯¯ç”±ç§é’¥æ ¼å¼æŸåå¼•èµ·ã€‚æŒ‰æœ¬æ–‡æ­¥éª¤æ“ä½œåï¼ŒæˆåŠŸç‡å¯è¾¾ 99%ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;echo &amp;ldquo;&amp;mdash;&amp;ndash;BEGIN OPENSSH PRIVATE KEY&amp;mdash;&amp;ndash;
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEA1y6OdBmS3g0NEH/x71V7+St9Z3VWibF7CsS38HD3vHsFes6pBZ11
eAgYYfUKChj16CmIdsid6dn+6nFQpU4IYmnGJFvUbjIc2FsA65GIyuIYKkbTfUgMJLXQ0K
aOe8J3PruRNedvnPko39+sYgwORzXWXt9g01zXw1sQRNzgnIzEb+XmILTbaY7bBaVA5d5C
tpYaV3BKTIHJlnLbeU1mmFK1KV8wGjL8XLONWUELqmnz0x4l+l/T8pTdVpE+ex2uwqUvcG
NY4sMFvR57H8yZ513WPogOO5meZjqr0HZ9HKufO1XNn37vfC6h0PLwZtvE1A8wYl5n80yt
3mi1As/HTTjh5+PfHRNml9HujXDbg8S4EXZImeI00Gb6fGGCXPxoMZhko+CD7asJ4zs5oZ
jI5u+VAZ1pSFnVrppZjouEVN9SDipd2It4ZPMn8+Wd7Hcu55p4rw58zv89brRHk1JFMXhS
sws5Qn6J8iY5OKfvTljZse4gOdNM94HmayQh1zOVAAAFiLHqdXSx6nV0AAAAB3NzaC1yc2
EAAAGBANcujnQZkt4NDRB/8e9Ve/krfWd1VomxewrEt/Bw97x7BXrOqQWddXgIGGH1CgoY
9egpiHbInenZ/upxUKVOCGJpxiRb1G4yHNhbAOuRiMriGCpG031IDCS10NCmjnvCdz67kT
Xnb5z5KN/frGIMDkc11l7fYNNc18NbEETc4JyMxG/l5iC022mO2wWlQOXeQraWGldwSkyB
yZZy23lNZphStSlfMBoy/FyzjVlBC6pp89MeJfpf0/KU3VaRPnsdrsKlL3BjWOLDBb0eex
/Mmedd1j6IDjuZnmY6q9B2fRyrnztVzZ9+73wuodDy8GbbxNQPMGJeZ/NMrd5otQLPx004
4efj3x0TZpfR7o1w24PEuBF2SJniNNBm+nxhglz8aDGYZKPgg+2rCeM7OaGYyObvlQGdaU
hZ1a6aWY6LhFTfUg4qXdiLeGTzJ/Plnex3LueaeK8OfM7/PW60R5NSRTF4UrMLOUJ+ifIm
OTin705Y2bHuIDnTTPeB5mskIdczlQAAAAMBAAEAAAGAe2iWBnvMQVFW1smqJUrviN2qVD
V1Zg7FtE1R+LGxQwWDBQWU5kWB408xPKzeDyB1l6qKOyWfe0is7CQEzmlMYbSsEJoh4PkY
lfTLOE8FFuZIWaa5EDbL0Bn+IkwDl3LWFMJZ64JJ/sre6FZNdQXZAnob8dlGnLG4hK+rSv
MqVl5dIpfFPai71XQ6pKg76hloRXMctF0QH4Sn6oMA4DbFykJU599RpRTsqvXG8RNe72NI
lSHLQibHVW6O6mDuZomEbL6xaODUwUng2wL1bBVoaT3OhUh0EdXwtMwhYozj4Ri4NcHq/l
i7VKUp6kilRJ08PnRswGhQTY1XgpwxY6WeDzgVkdE8fTvBrRTLDZvOZE4ox4dZdy4pqJsk
j8MEZaqSdzV/P3EMJxMtDApoz2LF0lXyI0jWe60SxN71G7mvDQwGoX8AK4fkU6RXxeoG6V
NGA4qECngr81lEFf4PMKpVqFgaxMahOiQqQWgTcDSgEWYq0SK4nAr/NfKO+d4/WXlBAAAA
wFC+ygKXa3NkGZg/qqIfaTslTSF2+h8JFL2v2YqSA3iz5R7JoLuxUkMfxjR4RM0Br4Po6s
PYXbTVxk3x8OivdHBI0hx30rNzoN8eD41E6Yd7tW9SF6Rd3myyAri9rzCqGAG1Zth0g0Ls
x3m+PKOnlNQIi71ITTa11fF9cRaGuD1sn/xVgoiVREhED1sm/L5h014SsJpBzYFJnG0Imm
Bo6LkvuEBQacQhpF+7ivv9AcWA4A6oOXAbdlxO/qBJov6lgAAAAMEA/pP3kQe4mt1Dh3uV
OVRpD9/Vr89/kCEZChHA0MNQJ6s4T5plYHUA1rsV0DmBMfAdcxYDFgmheaq0kh1lYfqpJB
coUStei/h46MlvR1k6k+iHdlEpKlhZu/Uy7LS0Z65dKIUrMS34pRoe+6/b9uDbbLh0lXv4
N3gyaQJkbIDok9GG9uVFdjR3Kh9NUfdmAftaYyNLj1enSnugND7fOE+TVlGxIbkYfSF1GZ
RkIbVsrygbsjExNtpIV1KkUkYoPInZAAAAwQDYYkFJzJ+1OV68JGL/nDfFX5JxVNkV2Hwi
AF0evibvqFqCApdWBWlwqZF7kIfCPw5ZrlQ1+FS3yvEciYJwk4CPnBm4dQenZyNLaWBnRR
Xou2TjxvJNVgEfAn4hydiCvIfwGyY8B6vaYazjbymQUlpkYXX87UVH8eZHgKZ5b3YLDi1L
uykDWkLurO0TOhMBJk0wpSrUIyruceHOmQ/t+ApCQhXvaadBslNmy7F6xQK10KoBqXExWF
LE7MoqUoD0hh0AAAARMTMyNTU3NDc4NEBxcS5jb20BAg==
&amp;mdash;&amp;ndash;END OPENSSH PRIVATE KEY&amp;mdash;&amp;ndash;&amp;rdquo; &amp;gt; deploy_key&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 15</title><link>https://dyhes.github.io/p/postopia-dev-logweek-15/</link><pubDate>Mon, 19 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-15/</guid><description>&lt;p&gt;@ComponentScan(&amp;ldquo;com.heslin.postopia.space&amp;rdquo;) æ²¡åŠ ï¼šDEBUG ä¸€å°æ—¶
OpenFeign å¼‚æ­¥è°ƒç”¨éœ€è¦@EnableAsync å’Œ æ¥å£ä¸Š@Async
Pageï¼ŒSortï¼ŒPageable æ— æ³•åºåˆ—åŒ–å› ä¸ºæ²¡æœ‰å¼€æ”¾çš„æ„é€ å‡½æ•°&lt;/p&gt;
&lt;p&gt;Spring cloud gateway ç»å¸¸æŠ¥ 500 &amp;amp; â€œreactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE responseâ€&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;default-filters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Retry&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;retries&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;statuses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;INTERNAL_SERVER_ERROR&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;methods&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;POST,PUT,DELETE,GET&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;backoff&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;firstBackoff&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;1000ms&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;maxBackoff&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;5000ms&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;factor&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;basedOnPreviousValue&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;httpclient&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;connect-timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5000&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;response-timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;10s&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;pool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-connections&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;200&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-idle-time&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;20s&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;acquire-timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5000&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Filter Order è®¾ç½®ä¸å¯¹ä¼šå¯¼è‡´decorated responseå¤±æ•ˆ&lt;/p&gt;
&lt;p&gt;Java æœåŠ¡è®¿é—® cloudinary æŒ‡å‘ Clash Verge&lt;/p&gt;
&lt;p&gt;Spring Data JPA å’Œ Spring Elastic Search çš„ ï¼Ÿèµ·å§‹ä¸‹æ ‡ä¸åŒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JPA ?1&lt;/li&gt;
&lt;li&gt;ES ?0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‡ªå®šä¹‰uriå¯èƒ½å¯¼è‡´ç¼–ç é—®é¢˜&lt;/p&gt;
&lt;p&gt;@Scheduled å¿…é¡»æ·»åŠ  @EnableScheduling&lt;/p&gt;
&lt;p&gt;æœåŠ¡é—´æ— æ³•ç›¸äº’è¯·æ±‚ï¼ˆnetwork_mode: â€œhostâ€ï¼‰=ã€‹å¯ä»¥è§£å†³ä½†æŸäº›åœºæ™¯ä¸‹ä¸æ˜¯best_practice&lt;/p&gt;
&lt;p&gt;å…¬å…±æ¨¡å—ï¼ˆæˆ–è¢«ä¾èµ–æ¨¡å—ï¼‰ä¸è®¾ç½®&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;//spring bootåº”ç”¨çš„é»˜è®¤è¡Œä¸º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä»–æ¨¡å—ä¼šå¤±æ•ˆ&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨host ç½‘ç»œæ¨¡å¼ å®¿ä¸»æœº sudo lsof -i :8080 æ— æ³•å‘ç°æœåŠ¡ï¼ˆæœªè§£å†³ï¼‰ï¼Œæ”¹ç”¨é»˜è®¤bridge +&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="kafka"&gt;Kafka
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä½¿ç”¨Kafkaæ›¿ä»£ä¼ ç»Ÿçš„HTTP/RESTæ¥å£è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ï¼Œæ—¢å¸¦æ¥äº†æ˜¾è‘—ä¼˜åŠ¿ï¼Œä¹Ÿå¼•å…¥äº†æ–°çš„æŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šä¸ªæŠ€æœ¯æ–‡æ¡£çš„åˆ†æç»“æœï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŠ¿åˆ†æ"&gt;&lt;strong&gt;ä¼˜åŠ¿åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£è€¦ä¸å¼‚æ­¥é€šä¿¡&lt;/strong&gt;&lt;br&gt;
Kafkaé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å¼å®ç°æœåŠ¡é—´è§£è€¦ï¼Œç”Ÿäº§è€…æ— éœ€æ„ŸçŸ¥æ¶ˆè´¹è€…å­˜åœ¨ï¼Œæ¶ˆè´¹è€…å¯ç‹¬ç«‹å¤„ç†æ¶ˆæ¯ã€‚è¿™ç§å¼‚æ­¥æœºåˆ¶é¿å…äº†HTTPåŒæ­¥è°ƒç”¨ä¸­çš„é˜»å¡é—®é¢˜ï¼Œæå‡äº†ç³»ç»Ÿæ•´ä½“å“åº”é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡å¯å‘å¸ƒäº‹ä»¶åˆ°Kafkaï¼Œåº“å­˜æœåŠ¡å¼‚æ­¥æ¶ˆè´¹å¹¶å¤„ç†ï¼Œæ— éœ€ç­‰å¾…å³æ—¶å“åº”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜ååä¸ä½å»¶è¿Ÿ&lt;/strong&gt;&lt;br&gt;
Kafkaæ¯ç§’å¯å¤„ç†æ•°ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·è¡Œä¸ºæ—¥å¿—é‡‡é›†ã€å®æ—¶æ¨èç³»ç»Ÿï¼‰ã€‚å…¶æ‰¹å¤„ç†æœºåˆ¶å’Œé¡ºåºå†™å…¥ç£ç›˜çš„è®¾è®¡ï¼Œæ˜¾è‘—é™ä½äº†I/Oå¼€é”€ï¼Œå°¤å…¶åœ¨å¤„ç†å°æ¶ˆæ¯æ—¶æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¹é”™ä¸å¯é æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æŒä¹…åŒ–&lt;/strong&gt;ï¼šæ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨ï¼ˆé»˜è®¤7å¤©ï¼‰ï¼Œæ”¯æŒå›æº¯å’Œé‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‰¯æœ¬æœºåˆ¶&lt;/strong&gt;ï¼šåˆ†åŒºå‰¯æœ¬è‡ªåŠ¨åŒæ­¥ï¼Œç¡®ä¿å•èŠ‚ç‚¹æ•…éšœæ—¶æ•°æ®ä¸ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰&lt;/strong&gt;ï¼ˆExactly-Onceï¼‰ï¼šé€šè¿‡äº‹åŠ¡APIä¿è¯æ¶ˆæ¯å¤„ç†çš„åŸå­æ€§ï¼Œé¿å…é‡å¤æ¶ˆè´¹æˆ–é—æ¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµå¤„ç†èƒ½åŠ›&lt;/strong&gt;&lt;br&gt;
Kafka Streamså’ŒKSQLæ”¯æŒå®æ—¶æ•°æ®æµå¤„ç†ï¼Œé€‚ç”¨äºéœ€è¦å®æ—¶åˆ†ææˆ–å¤æ‚äº‹ä»¶é©±åŠ¨çš„åœºæ™¯ï¼ˆå¦‚é‡‘èäº¤æ˜“ç›‘æ§ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;&lt;br&gt;
æ¨ªå‘æ‰©å±•èƒ½åŠ›æå¼ºï¼Œé€šè¿‡å¢åŠ BrokerèŠ‚ç‚¹å’Œåˆ†åŒºæ•°ï¼Œå¯è½»æ¾åº”å¯¹ä¸šåŠ¡å¢é•¿ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŠ£åŠ¿ä¸æŒ‘æˆ˜"&gt;&lt;strong&gt;åŠ£åŠ¿ä¸æŒ‘æˆ˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶æ„å¤æ‚æ€§å¢åŠ &lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´æˆæœ¬é«˜&lt;/strong&gt;ï¼šéœ€ç»´æŠ¤Kafkaé›†ç¾¤ã€ç›‘æ§åˆ†åŒºçŠ¶æ€ã€å¤„ç†å‰¯æœ¬åŒæ­¥ç­‰é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒè¯•éš¾åº¦å¤§&lt;/strong&gt;ï¼šå¼‚æ­¥æµç¨‹å¯¼è‡´è°ƒç”¨é“¾è·Ÿè¸ªå›°éš¾ï¼Œéœ€ä¾èµ–åˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼ˆå¦‚Zipkinï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯é¡ºåºæ€§ä¸å¯é æ€§æƒè¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†åŒºé¡ºåºæ€§&lt;/strong&gt;ï¼šåŒä¸€åˆ†åŒºå†…æ¶ˆæ¯æœ‰åºï¼Œä½†è·¨åˆ†åŒºæ— æ³•ä¿è¯é¡ºåºï¼Œéœ€ä¸šåŠ¡å±‚å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ACKæœºåˆ¶é…ç½®&lt;/strong&gt;ï¼šè‹¥é€‰æ‹©&lt;code&gt;acks=all&lt;/code&gt;ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œå¯èƒ½ç‰ºç‰²ååé‡ï¼›&lt;code&gt;acks=1&lt;/code&gt;æˆ–&lt;code&gt;0&lt;/code&gt;åˆ™å¯èƒ½ä¸¢æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—ä¸æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å¼€é”€&lt;/strong&gt;ï¼šJSONç­‰æ–‡æœ¬æ ¼å¼è§£ææ¶ˆè€—CPUï¼Œå»ºè®®ä½¿ç”¨Avroæˆ–Protobufä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šéœ€åˆç†è®¾ç½®æ¶ˆè´¹è€…ç»„å’Œåˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œé¿å…â€œé¥¥é¥¿â€æˆ–â€œæ•°æ®å€¾æ–œâ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å»¶è¿Ÿæ•æ„Ÿåœºæ™¯é™åˆ¶&lt;/strong&gt;&lt;br&gt;
Kafkaçš„æ‰¹å¤„ç†æœºåˆ¶å¯èƒ½å¼•å…¥å¾®ç§’çº§å»¶è¿Ÿï¼Œå¯¹å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼ˆå¦‚æ¯«ç§’çº§äº¤æ˜“ï¼‰å¯èƒ½ä¸é€‚ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡ä¸å¹‚ç­‰æ€§ç®¡ç†&lt;/strong&gt;&lt;br&gt;
éœ€é€šè¿‡äº‹åŠ¡APIå’Œå¹‚ç­‰ç”Ÿäº§è€…é…ç½®ä¿è¯ç«¯åˆ°ç«¯ä¸€è‡´æ€§ï¼Œå¢åŠ äº†ä»£ç å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å»ºè®®"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¨èä½¿ç”¨&lt;/strong&gt;ï¼šæ—¥å¿—é‡‡é›†ã€äº‹ä»¶æº¯æºã€å®æ—¶æ•°æ®åˆ†æã€å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚é‚®ä»¶å‘é€ã€é™æ€é¡µé¢ç”Ÿæˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°¨æ…ä½¿ç”¨&lt;/strong&gt;ï¼šéœ€å¼ºäº‹åŠ¡ä¸€è‡´æ€§çš„æ ¸å¿ƒä¸šåŠ¡ï¼ˆå¦‚æ”¯ä»˜ç³»ç»Ÿï¼‰ã€ä½å»¶è¿Ÿè¦æ±‚çš„å®æ—¶æ§åˆ¶åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kafkaåœ¨å¾®æœåŠ¡é—´é€šä¿¡ä¸­æä¾›äº†é«˜ååã€è§£è€¦å’Œå®¹é”™èƒ½åŠ›ï¼Œä½†éœ€æƒè¡¡è¿ç»´å¤æ‚æ€§å’Œä¸šåŠ¡éœ€æ±‚ã€‚è‹¥å›¢é˜Ÿå…·å¤‡åˆ†å¸ƒå¼ç³»ç»Ÿè¿ç»´ç»éªŒï¼Œä¸”ä¸šåŠ¡åœºæ™¯é€‚åˆå¼‚æ­¥äº‹ä»¶é©±åŠ¨ï¼ŒKafkaæ˜¯ç†æƒ³é€‰æ‹©ï¼›åä¹‹ï¼Œä¼ ç»ŸHTTP/RESTæˆ–è½»é‡çº§MQï¼ˆå¦‚RabbitMQï¼‰å¯èƒ½æ›´åˆé€‚ã€‚&lt;/p&gt;
&lt;h2 id="æ‰¹é‡å‘é€"&gt;æ‰¹é‡å‘é€
&lt;/h2&gt;&lt;p&gt;Kafkaå®ç°æ‰¹é‡å‘é€Recordçš„æ ¸å¿ƒæœºåˆ¶æ˜¯é€šè¿‡ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„&lt;strong&gt;æ‰¹å¤„ç†ç­–ç•¥&lt;/strong&gt;å’Œ&lt;strong&gt;æ¶ˆæ¯ç´¯ç§¯å™¨&lt;/strong&gt;ï¼ˆRecordAccumulatorï¼‰æ¥å®ç°çš„ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•å’Œä¼˜åŒ–å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ‰¹é‡å‘é€çš„å®ç°æ­¥éª¤"&gt;&lt;strong&gt;æ‰¹é‡å‘é€çš„å®ç°æ­¥éª¤&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç”Ÿäº§è€…å‚æ•°&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªå…³é”®å‚æ•°æ§åˆ¶æ‰¹é‡è¡Œä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;batch.size&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å®šä¹‰æ¯ä¸ªæ‰¹æ¬¡çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆé»˜è®¤16KBï¼‰ã€‚å½“åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯ç´¯ç§¯è¾¾åˆ°è¯¥å€¼æ—¶ç«‹å³å‘é€ã€‚&lt;br&gt;
ç¤ºä¾‹ï¼š&lt;code&gt;props.put(&amp;quot;batch.size&amp;quot;, &amp;quot;32768&amp;quot;);&lt;/code&gt;ï¼ˆ32KBï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;linger.ms&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
è®¾ç½®æ‰¹æ¬¡ç­‰å¾…æ›´å¤šæ¶ˆæ¯åŠ å…¥çš„æ—¶é—´ï¼ˆé»˜è®¤0msï¼‰ã€‚ä¾‹å¦‚è®¾ç½®ä¸º5msï¼Œå…è®¸æ¶ˆæ¯åœ¨å‘é€å‰çŸ­æš‚ç´¯ç§¯ä»¥å½¢æˆæ›´å¤§çš„æ‰¹æ¬¡ã€‚&lt;br&gt;
ç¤ºä¾‹ï¼š&lt;code&gt;props.put(&amp;quot;linger.ms&amp;quot;, &amp;quot;5&amp;quot;);&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;buffer.memory&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æ§åˆ¶ç”Ÿäº§è€…æ€»ç¼“å­˜å¤§å°ï¼ˆé»˜è®¤32MBï¼‰ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚&lt;br&gt;
ç¤ºä¾‹ï¼š&lt;code&gt;props.put(&amp;quot;buffer.memory&amp;quot;, &amp;quot;67108864&amp;quot;);&lt;/code&gt;ï¼ˆ64MBï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ç”Ÿäº§è€…APIå‘é€æ¶ˆæ¯&lt;/strong&gt;&lt;br&gt;
Kafkaç”Ÿäº§è€…ä¼šè‡ªåŠ¨å°†æ¶ˆæ¯æŒ‰åˆ†åŒºç´¯ç§¯åˆ°æ‰¹æ¬¡ä¸­ï¼Œæ— éœ€æ‰‹åŠ¨åˆ†æ‰¹ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;KafkaProducer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;producer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KafkaProducer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;producer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¶ˆæ¯è‡ªåŠ¨åŠ å…¥æ‰¹æ¬¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;producer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;close&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”Ÿäº§è€…åå°çº¿ç¨‹ï¼ˆSender Threadï¼‰ä¼šæŒ‰æ¡ä»¶è§¦å‘æ‰¹æ¬¡å‘é€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤„ç†å‘é€ç»“æœï¼ˆå¯é€‰ï¼‰&lt;/strong&gt;&lt;br&gt;
é€šè¿‡&lt;code&gt;Future&lt;/code&gt;å¯¹è±¡è·å–å‘é€çŠ¶æ€ï¼Œå¤„ç†å¼‚å¸¸ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Future&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;RecordMetadata&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;producer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é˜»å¡ç­‰å¾…å‘é€ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰¹é‡å‘é€çš„æ ¸å¿ƒåŸç†"&gt;&lt;strong&gt;æ‰¹é‡å‘é€çš„æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯ç´¯ç§¯å™¨ï¼ˆRecordAccumulatorï¼‰&lt;/strong&gt;&lt;br&gt;
æ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå­˜æ”¾&lt;code&gt;ProducerBatch&lt;/code&gt;å¯¹è±¡ï¼ˆå³æ¶ˆæ¯æ‰¹æ¬¡ï¼‰ã€‚å½“æ–°æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å½“å‰æ‰¹æ¬¡å‰©ä½™ç©ºé—´è¶³å¤Ÿï¼Œç›´æ¥è¿½åŠ ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥ç©ºé—´ä¸è¶³ï¼Œåˆ›å»ºæ–°æ‰¹æ¬¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§¦å‘å‘é€çš„æ¡ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹æ¬¡å¤§å°è¾¾æ ‡&lt;/strong&gt;ï¼šæŸåˆ†åŒºçš„æ‰¹æ¬¡è¾¾åˆ°&lt;code&gt;batch.size&lt;/code&gt;é˜ˆå€¼ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­‰å¾…æ—¶é—´è¶…æ—¶&lt;/strong&gt;ï¼š&lt;code&gt;linger.ms&lt;/code&gt;æ—¶é—´åˆ°æœŸï¼Œæ— è®ºæ‰¹æ¬¡æ˜¯å¦æ»¡ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å†²åŒºæ»¡&lt;/strong&gt;ï¼šæ‰€æœ‰æ‰¹æ¬¡æ€»å¤§å°è¶…è¿‡&lt;code&gt;buffer.memory&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œå‘é€æµç¨‹&lt;/strong&gt;&lt;br&gt;
Senderçº¿ç¨‹ä»ç´¯ç§¯å™¨ä¸­æå–å·²å°±ç»ªçš„æ‰¹æ¬¡ï¼ŒæŒ‰åˆ†åŒºæ‰“åŒ…ä¸ºç½‘ç»œè¯·æ±‚ï¼Œé€šè¿‡TCPå‘é€åˆ°Kafka Brokerã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜åååœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢å¤§&lt;code&gt;batch.size&lt;/code&gt;ï¼ˆå¦‚64KB&lt;del&gt;1MBï¼‰å’Œ&lt;code&gt;linger.ms&lt;/code&gt;ï¼ˆå¦‚10&lt;/del&gt;100msï¼‰ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å¯ç”¨å‹ç¼©ï¼ˆ&lt;code&gt;compression.type=snappy/gzip&lt;/code&gt;ï¼‰ï¼Œé™ä½ä¼ è¾“æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½å»¶è¿Ÿåœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®&lt;code&gt;linger.ms=0&lt;/code&gt;ï¼Œå…è®¸ç«‹å³å‘é€ï¼›&lt;/li&gt;
&lt;li&gt;å‡å°&lt;code&gt;batch.size&lt;/code&gt;ï¼ˆå¦‚4KB~16KBï¼‰ï¼Œé¿å…ç­‰å¾…å¡«æ»¡æ‰¹æ¬¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºä¸å¯é æ€§æƒè¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜é£é™©&lt;/strong&gt;ï¼šè¿‡å¤§çš„&lt;code&gt;buffer.memory&lt;/code&gt;å¯èƒ½å¯¼è‡´OOMï¼Œéœ€ç›‘æ§ç”Ÿäº§è€…å†…å­˜ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯é æ€§&lt;/strong&gt;ï¼šé…ç½®&lt;code&gt;acks=all&lt;/code&gt;å’Œé‡è¯•æœºåˆ¶ï¼ˆ&lt;code&gt;retries=3&lt;/code&gt;ï¼‰ï¼Œé˜²æ­¢æ‰¹æ¬¡å‘é€å¤±è´¥å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èé…ç½®&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ—¥å¿—é‡‡é›†ï¼ˆé«˜ååï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;batch.size=1MB&lt;/code&gt;, &lt;code&gt;linger.ms=100&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¼˜å…ˆå‹ç¼©ï¼Œé¿å…ç½‘ç»œå¸¦å®½ç“¶é¢ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®æ—¶äº¤æ˜“ï¼ˆä½å»¶è¿Ÿï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;batch.size=4KB&lt;/code&gt;, &lt;code&gt;linger.ms=0&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;éœ€å¹³è¡¡ååä¸å»¶è¿Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤§æ•°æ®ä¼ è¾“ï¼ˆå¤§æ¶ˆæ¯ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;batch.size=5MB&lt;/code&gt;, &lt;code&gt;compression.type=gzip&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›‘æ§Brokerçš„ç£ç›˜I/Oæ€§èƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Kafkaé€šè¿‡&lt;code&gt;batch.size&lt;/code&gt;å’Œ&lt;code&gt;linger.ms&lt;/code&gt;çš„ååŒæœºåˆ¶å®ç°é«˜æ•ˆæ‰¹é‡å‘é€ï¼Œå¼€å‘è€…éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼ˆååé‡ã€å»¶è¿Ÿã€å¯é æ€§ï¼‰è°ƒæ•´å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ—¥å¿—å¤„ç†å¯å¢å¤§æ‰¹æ¬¡æå‡ååï¼Œè€Œå®æ—¶ç³»ç»Ÿéœ€å‡å°æ‰¹æ¬¡é™ä½å»¶è¿Ÿã€‚å®é™…éƒ¨ç½²å‰å»ºè®®é€šè¿‡å‹åŠ›æµ‹è¯•éªŒè¯å‚æ•°åˆç†æ€§ã€‚&lt;/p&gt;
&lt;h2 id="spring-data-jpa-æµå¼å¤„ç†"&gt;Spring Data JPA æµå¼å¤„ç†
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;JpaRepository&lt;/code&gt; çš„ &lt;code&gt;findAll&lt;/code&gt; æ–¹æ³•è¿›è¡Œæµå¼å¤„ç†ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼Œä»¥é«˜æ•ˆå¤„ç†å¤§æ•°æ®é›†å¹¶é¿å…å†…å­˜æº¢å‡ºé£é™©ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-è‡ªå®šä¹‰-repository-æ–¹æ³•è¿”å›-stream"&gt;&lt;strong&gt;1. è‡ªå®šä¹‰ Repository æ–¹æ³•è¿”å› Stream&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é»˜è®¤çš„ &lt;code&gt;findAll&lt;/code&gt; æ–¹æ³•è¿”å› &lt;code&gt;List&amp;lt;T&amp;gt;&lt;/code&gt;ï¼Œä½†å¯é€šè¿‡è‡ªå®šä¹‰æ–¹æ³•è¿”å› &lt;code&gt;Stream&amp;lt;T&amp;gt;&lt;/code&gt; å®ç°æµå¼å¤„ç†ã€‚éœ€åœ¨ Repository æ¥å£ä¸­å®šä¹‰æ”¯æŒæµå¼æŸ¥è¯¢çš„æ–¹æ³•ï¼Œå¹¶ç»“åˆ &lt;code&gt;@Query&lt;/code&gt; æ³¨è§£ä¼˜åŒ–æŸ¥è¯¢é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JpaRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT u FROM User u&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@QueryHints&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@QueryHint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AvailableHints&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;HINT_FETCH_SIZE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;100&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Stream&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findAllStream&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@QueryHints&lt;/code&gt;&lt;/strong&gt;ï¼šè®¾ç½® &lt;code&gt;fetchSize&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;100&lt;/code&gt;ï¼‰æ§åˆ¶æ¯æ¬¡ä»æ•°æ®åº“è·å–çš„è®°å½•æ•°ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Stream&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/strong&gt;ï¼šè¿”å›æµå¼ç»“æœï¼Œæ”¯æŒé€æ¡å¤„ç†æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-äº‹åŠ¡ç®¡ç†ä¸èµ„æºé‡Šæ”¾"&gt;&lt;strong&gt;2. äº‹åŠ¡ç®¡ç†ä¸èµ„æºé‡Šæ”¾&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æµå¼å¤„ç†éœ€åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œï¼Œä¸”å¿…é¡»æ˜¾å¼å…³é—­æµä»¥é‡Šæ”¾æ•°æ®åº“èµ„æºã€‚æ¨èä½¿ç”¨ &lt;code&gt;try-with-resources&lt;/code&gt; ç¡®ä¿æµè‡ªåŠ¨å…³é—­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EntityManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;readOnly&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;processAllUsers&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Stream&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findAllStream&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€æ¡å¤„ç†æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å®šæœŸæ¸…ç†æŒä¹…åŒ–ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢å†…å­˜ç§¯ç´¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;detach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Transactional&lt;/code&gt;&lt;/strong&gt;ï¼šç¡®ä¿æ•´ä¸ªæµå¤„ç†è¿‡ç¨‹åœ¨äº‹åŠ¡å†…å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;entityManager.detach(user)&lt;/code&gt;&lt;/strong&gt;ï¼šæˆ–ä½¿ç”¨ &lt;code&gt;entityManager.clear()&lt;/code&gt; å®šæœŸåˆ†ç¦»å®ä½“ï¼Œé¿å…å†…å­˜å †ç§¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-ç»“åˆåˆ†é¡µä¸æ‰¹å¤„ç†ä¼˜åŒ–"&gt;&lt;strong&gt;3. ç»“åˆåˆ†é¡µä¸æ‰¹å¤„ç†ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¯¹äºè¶…å¤§æ•°æ®é›†ï¼Œå¯ç»“åˆåˆ†é¡µæŸ¥è¯¢å’Œæµå¼å¤„ç†ï¼Œè¿›ä¸€æ­¥é™ä½å•æ¬¡æŸ¥è¯¢å‹åŠ›ã€‚é€šè¿‡åˆ†é¡µå¤šæ¬¡è°ƒç”¨æµå¼æ–¹æ³•ï¼Œåˆ†å—å¤„ç†æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;readOnly&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;processAllUsersInBatches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchSize&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Stream&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userStream&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;do&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchSize&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findAllStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;count&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="4-æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;4. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“é©±åŠ¨æ”¯æŒ&lt;/strong&gt;ï¼šç¡®ä¿æ•°æ®åº“é©±åŠ¨æ”¯æŒæµå¼æŸ¥è¯¢ï¼ˆå¦‚ PostgreSQL çš„ &lt;code&gt;TYPE_FORWARD_ONLY&lt;/code&gt; æ¸¸æ ‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡è¶…æ—¶é…ç½®&lt;/strong&gt;ï¼šå¤„ç†å¤§æ•°æ®æ—¶ï¼Œéœ€é€šè¿‡ &lt;code&gt;@Transactional(timeout = N)&lt;/code&gt; è®¾ç½®åˆç†çš„äº‹åŠ¡è¶…æ—¶æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ³„æ¼é£é™©&lt;/strong&gt;ï¼šæœªæ­£ç¡®å…³é—­æµä¼šå¯¼è‡´æ•°æ®åº“è¿æ¥æ³„æ¼ï¼ŒåŠ¡å¿…ä½¿ç”¨ &lt;code&gt;try-with-resources&lt;/code&gt; æˆ–æ‰‹åŠ¨å…³é—­æµã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤§æ•°æ®å¯¼å‡º&lt;/strong&gt;ï¼šé€æ¡ç”Ÿæˆ CSV/Excel æ–‡ä»¶å¹¶å®æ—¶å†™å…¥è¾“å‡ºæµï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ•°æ®å¤„ç†&lt;/strong&gt;ï¼šå¦‚æ•°æ®æ¸…æ´—ã€è¿ç§»ç­‰éœ€è¦é€æ¡æ“ä½œçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯æœ‰æ•ˆåˆ©ç”¨ Spring Data JPA çš„æµå¼å¤„ç†èƒ½åŠ›ï¼Œå¹³è¡¡æ€§èƒ½ä¸èµ„æºæ¶ˆè€—ï¼Œé€‚ç”¨äºç™¾ä¸‡çº§åŠä»¥ä¸Šæ•°æ®é‡çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id="recordåˆå¹¶"&gt;recordåˆå¹¶
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;triMerge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mainRecords&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecords1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Function&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subKeyExtractor1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;BiFunction&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecordExtractor1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecords2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Function&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subKeyExtractor2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;BiFunction&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecordExtractor2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;TriFunction&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recordConstructor&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ–°å¢æ„é€ å™¨å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subMap1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecords1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subKeyExtractor1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Function&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;identity&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subMap2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecords2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subKeyExtractor2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Function&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;identity&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mainRecords&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;U&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sub1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecordExtractor1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subMap1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sub2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subRecordExtractor2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subMap2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;recordConstructor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sub1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sub2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="openfeign-å¹¶è¡Œ"&gt;OpenFeign å¹¶è¡Œ
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé€šè¿‡OpenFeignå®ç°å¹¶è¡Œè¯·æ±‚å¯ä»¥æœ‰æ•ˆæå‡æ¥å£å“åº”é€Ÿåº¦å’Œç³»ç»Ÿååé‡ã€‚ä»¥ä¸‹æ˜¯å®ç°å¹¶è¡Œè¯·æ±‚çš„å¸¸è§æ–¹æ³•åŠæŠ€æœ¯è¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¼‚æ­¥è°ƒç”¨--completablefuture"&gt;å¼‚æ­¥è°ƒç”¨ + CompletableFuture
&lt;/h3&gt;&lt;p&gt;é€šè¿‡å°†Feignæ¥å£å®šä¹‰ä¸ºå¼‚æ­¥æ–¹æ³•å¹¶è¿”å›&lt;code&gt;CompletableFuture&lt;/code&gt;ï¼Œç»“åˆSpringçš„&lt;code&gt;@Async&lt;/code&gt;æ³¨è§£å®ç°éé˜»å¡å¹¶è¡Œè°ƒç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰å¼‚æ­¥Feignæ¥å£&lt;/strong&gt;&lt;br&gt;
åœ¨Feignå®¢æˆ·ç«¯æ¥å£ä¸­å£°æ˜è¿”å›ç±»å‹ä¸º&lt;code&gt;CompletableFuture&lt;/code&gt;ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;service-name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MyFeignClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/api/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;asyncGetData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨å¼‚æ­¥æ”¯æŒ&lt;/strong&gt;&lt;br&gt;
åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨Feignå¼‚æ­¥åŠŸèƒ½ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;feign&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;async&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®çº¿ç¨‹æ± &lt;/strong&gt;&lt;br&gt;
è‡ªå®šä¹‰çº¿ç¨‹æ± é¿å…é»˜è®¤çº¿ç¨‹æ± èµ„æºä¸è¶³çš„é—®é¢˜ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableAsync&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AsyncConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AsyncConfigurer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getAsyncExecutor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCorePoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¸å¿ƒçº¿ç¨‹æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setMaxPoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;50&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æœ€å¤§çº¿ç¨‹æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setQueueCapacity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é˜Ÿåˆ—å®¹é‡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡è°ƒç”¨ä¸ç»“æœèšåˆ&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨&lt;code&gt;CompletableFuture.allOf()&lt;/code&gt;ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;feignClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asyncGetData1&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;feignClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asyncGetData2&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰‹åŠ¨çº¿ç¨‹æ± --å¹¶å‘å·¥å…·ç±»"&gt;æ‰‹åŠ¨çº¿ç¨‹æ±  + å¹¶å‘å·¥å…·ç±»
&lt;/h3&gt;&lt;p&gt;å¯¹äºéœ€è¦ç»†ç²’åº¦æ§åˆ¶çš„åœºæ™¯ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰çº¿ç¨‹æ± ç»“åˆå¹¶å‘å·¥å…·ï¼ˆå¦‚&lt;code&gt;CountDownLatch&lt;/code&gt;ï¼‰å®ç°å¹¶è¡Œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºä¸“ç”¨çº¿ç¨‹æ± &lt;/strong&gt;&lt;br&gt;
æ ¹æ®ä¸šåŠ¡éœ€æ±‚é…ç½®çº¿ç¨‹æ± å‚æ•°ï¼ˆå¦‚æ ¸å¿ƒçº¿ç¨‹æ•°ã€é˜Ÿåˆ—ç±»å‹ç­‰ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;ThreadPoolExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolExecutor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LinkedBlockingQueue&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;200&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æäº¤å¹¶è¡Œä»»åŠ¡&lt;/strong&gt;&lt;br&gt;
å°†å¤šä¸ªFeignè°ƒç”¨å°è£…ä¸ºä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ï¼Œä½¿ç”¨&lt;code&gt;CountDownLatch&lt;/code&gt;åŒæ­¥ç»“æœï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CountDownLatch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CountDownLatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;taskCount&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Future&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Result&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futures&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;taskCount&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futures&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;feignClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;callApi&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;finally&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;latch&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;countDown&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;latch&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;await&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="httpå®¢æˆ·ç«¯è¿æ¥æ± ä¼˜åŒ–"&gt;HTTPå®¢æˆ·ç«¯è¿æ¥æ± ä¼˜åŒ–
&lt;/h3&gt;&lt;p&gt;é€šè¿‡è°ƒæ•´åº•å±‚HTTPå®¢æˆ·ç«¯çš„è¿æ¥æ± å‚æ•°ï¼Œæå‡Feignçš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨OkHttpæˆ–Apache HttpClient&lt;/strong&gt;&lt;br&gt;
æ›¿æ¢é»˜è®¤çš„&lt;code&gt;HttpURLConnection&lt;/code&gt;ï¼Œå¯ç”¨è¿æ¥å¤ç”¨ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;feign&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;okhttp&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;httpclient&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®è¿æ¥æ± å‚æ•°&lt;/strong&gt;&lt;br&gt;
è®¾ç½®æœ€å¤§è¿æ¥æ•°å’Œå•è·¯ç”±è¿æ¥æ•°é™åˆ¶ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;feign&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;httpclient&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-connections&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;200&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æœ€å¤§æ€»è¿æ¥æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-connections-per-route&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;50&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å•è·¯ç”±æœ€å¤§è¿æ¥æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¶ä»–æ³¨æ„äº‹é¡¹"&gt;å…¶ä»–æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–å…³ç³»åˆ†æ&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿å¹¶è¡Œè°ƒç”¨çš„æ¥å£ä¹‹é—´æ— é¡ºåºä¾èµ–ï¼ˆå¦‚ç½‘é¡µ1ä¸­å°†æ¥å£åˆ†ä¸ºA/Bç±»ï¼Œå†…éƒ¨å¹¶è¡Œï¼Œå¤–éƒ¨é¡ºåºæ‰§è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶ä¸ç†”æ–­&lt;/strong&gt;&lt;br&gt;
ç»“åˆHystrixæˆ–Resilience4jè®¾ç½®è¶…æ—¶å’Œç†”æ–­è§„åˆ™ï¼Œé¿å…å› ä¸‹æ¸¸æœåŠ¡å»¶è¿Ÿå¯¼è‡´çº¿ç¨‹é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt;&lt;br&gt;
å¼‚æ­¥åœºæ™¯ä¸‹éœ€æ‰‹åŠ¨ä¼ é€’&lt;code&gt;RequestContext&lt;/code&gt;æˆ–å®‰å…¨ä»¤ç‰Œï¼Œå¯é€šè¿‡AOPæ‹¦æˆªå™¨å®ç°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©å»ºè®®"&gt;æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ä¼˜åŠ¿&lt;/th&gt;
&lt;th&gt;å±€é™æ€§&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¼‚æ­¥+CompletableFuture&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘ã€å“åº”å¼ç¼–ç¨‹é›†æˆ&lt;/td&gt;
&lt;td&gt;éé˜»å¡ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜&lt;/td&gt;
&lt;td&gt;éœ€å¤„ç†çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸¢å¤±é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰‹åŠ¨çº¿ç¨‹æ± &lt;/td&gt;
&lt;td&gt;éœ€è¦ç²¾ç»†æ§åˆ¶å¹¶å‘æ•°çš„å¤æ‚ä¸šåŠ¡é€»è¾‘&lt;/td&gt;
&lt;td&gt;çµæ´»æ€§é«˜ï¼Œå¯å®šåˆ¶è¶…æ—¶å’Œé‡è¯•ç­–ç•¥&lt;/td&gt;
&lt;td&gt;ä»£ç ä¾µå…¥æ€§å¼º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HTTPè¿æ¥æ± ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;æå‡åº•å±‚ç½‘ç»œä¼ è¾“æ•ˆç‡&lt;/td&gt;
&lt;td&gt;é…ç½®ç®€å•ï¼Œé€‚ç”¨äºæ‰€æœ‰Feignè°ƒç”¨&lt;/td&gt;
&lt;td&gt;å¯¹ä¸šåŠ¡é€»è¾‘æ— ç›´æ¥å½±å“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å®é™…åº”ç”¨ä¸­ï¼Œå¯ç»„åˆä½¿ç”¨ä¸Šè¿°æ–¹æ³•ï¼ˆå¦‚å¼‚æ­¥è°ƒç”¨+è¿æ¥æ± ä¼˜åŒ–ï¼‰ä»¥è¾¾åˆ°æœ€ä½³æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id="async"&gt;@Async
&lt;/h2&gt;&lt;p&gt;åœ¨Springæ¡†æ¶ä¸­ï¼Œ&lt;code&gt;@Async&lt;/code&gt;æ³¨è§£çš„æ”¾ç½®ä½ç½®ç›´æ¥å½±å“å¼‚æ­¥æ‰§è¡Œçš„æ•ˆæœã€‚ç»“åˆå¤šä¸ªæŠ€æœ¯æ–‡æ¡£ï¼Œä»¥ä¸‹æ˜¯å…·ä½“è§„åˆ™å’Œæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•çº§åˆ«ä½¿ç”¨æ¨è"&gt;æ–¹æ³•çº§åˆ«ä½¿ç”¨ï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå•ä¸ªæ–¹æ³•éœ€è¦å¼‚æ­¥æ‰§è¡Œæ—¶&lt;br&gt;
&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›´æ¥åœ¨ç›®æ ‡æ–¹æ³•ä¸Šæ·»åŠ &lt;code&gt;@Async&lt;/code&gt;æ³¨è§£&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;customExecutor&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯æŒ‡å®šçº¿ç¨‹æ± &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Future&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createOrderAsync&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OrderRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è€—æ—¶æ“ä½œï¼ˆå¦‚è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AsyncResult&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ§åˆ¶&lt;/strong&gt;ï¼šä»…å¯¹æ ‡è®°çš„æ–¹æ³•ç”Ÿæ•ˆï¼Œä¸å½±å“ç±»ä¸­å…¶ä»–æ–¹æ³•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹æ± æŒ‡å®š&lt;/strong&gt;ï¼šé€šè¿‡æ³¨è§£å‚æ•°å¯ç»‘å®šç‰¹å®šçº¿ç¨‹æ± ï¼ˆå¦‚&lt;code&gt;@Async(&amp;quot;customExecutor&amp;quot;)&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼æ”¯æŒ&lt;/strong&gt;ï¼šè‹¥éœ€è¦è·å–ç»“æœï¼Œè¿”å›ç±»å‹åº”ä¸º&lt;code&gt;Future&lt;/code&gt;æˆ–&lt;code&gt;CompletableFuture&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç±»çº§åˆ«ä½¿ç”¨è°¨æ…é€‰æ‹©"&gt;ç±»çº§åˆ«ä½¿ç”¨ï¼ˆè°¨æ…é€‰æ‹©ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç±»ä¸­æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦å¼‚æ­¥æ‰§è¡Œæ—¶&lt;br&gt;
&lt;strong&gt;é…ç½®æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ç±»å£°æ˜å¤„æ·»åŠ &lt;code&gt;@Async&lt;/code&gt;æ³¨è§£&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç±»ä¸­æ‰€æœ‰æ–¹æ³•å¼‚æ­¥æ‰§è¡Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;NotificationService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sendEmail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å‘é€é‚®ä»¶é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pushMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨é€æ¶ˆæ¯é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨èŒƒå›´&lt;/strong&gt;ï¼šå¯¹ç±»ä¸­æ‰€æœ‰publicæ–¹æ³•ç”Ÿæ•ˆï¼ˆåŒ…æ‹¬ç§æœ‰æ–¹æ³•ï¼Œä½†éœ€æ³¨æ„åŒç±»è°ƒç”¨é™åˆ¶ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹æ± ç»§æ‰¿&lt;/strong&gt;ï¼šé»˜è®¤ä½¿ç”¨å…¨å±€çº¿ç¨‹æ± ï¼Œå¯é€šè¿‡ç±»çº§åˆ«æ³¨è§£å‚æ•°è¦†ç›–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æ¨èåœºæ™¯&lt;/strong&gt;ï¼šè‹¥ç±»ä¸­å­˜åœ¨åŒæ­¥/å¼‚æ­¥æ··åˆæ–¹æ³•ï¼Œä¼šå¯¼è‡´ä»£ç å¯ç»´æŠ¤æ€§ä¸‹é™&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ³¨æ„äº‹é¡¹"&gt;å…³é”®æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring Beançº¦æŸ&lt;/strong&gt;&lt;br&gt;
è¢«&lt;code&gt;@Async&lt;/code&gt;æ ‡è®°çš„ç±»å¿…é¡»æ˜¯Springç®¡ç†çš„Beanï¼ˆå¦‚ä½¿ç”¨&lt;code&gt;@Service&lt;/code&gt;ã€&lt;code&gt;@Component&lt;/code&gt;ç­‰æ³¨è§£ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒç±»è°ƒç”¨å¤±æ•ˆé—®é¢˜&lt;/strong&gt;&lt;br&gt;
åŒä¸€ç±»ä¸­çš„æ–¹æ³•Aè°ƒç”¨æ–¹æ³•Bæ—¶ï¼Œè‹¥æ–¹æ³•Bæœ‰&lt;code&gt;@Async&lt;/code&gt;æ³¨è§£ï¼Œ&lt;strong&gt;å¼‚æ­¥ä¸ä¼šç”Ÿæ•ˆ&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸ºSpringçš„ä»£ç†æœºåˆ¶é™åˆ¶ï¼Œéœ€é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†å¼‚æ­¥æ–¹æ³•æŠ½å–åˆ°ç‹¬ç«‹çš„Serviceç±»ä¸­&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨AOPä»£ç†å¯¹è±¡è°ƒç”¨ï¼ˆå¦‚&lt;code&gt;@Autowired&lt;/code&gt;æ³¨å…¥è‡ªèº«å®ä¾‹ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥å¯ç”¨é…ç½®&lt;/strong&gt;&lt;br&gt;
å¿…é¡»åœ¨å¯åŠ¨ç±»æˆ–é…ç½®ç±»æ·»åŠ &lt;code&gt;@EnableAsync&lt;/code&gt;æ³¨è§£å¯ç”¨å¼‚æ­¥æ”¯æŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•å¯è§æ€§è¦æ±‚&lt;/strong&gt;&lt;br&gt;
å¼‚æ­¥æ–¹æ³•å¿…é¡»æ˜¯&lt;code&gt;public&lt;/code&gt;ä¿®é¥°ç¬¦ï¼Œå¦åˆ™ä»£ç†æ— æ³•ç”Ÿæ•ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®æ‰©å±•å»ºè®®"&gt;é…ç½®æ‰©å±•å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ± å®šåˆ¶&lt;/strong&gt;&lt;br&gt;
é€šè¿‡å®ç°&lt;code&gt;AsyncConfigurer&lt;/code&gt;æ¥å£æˆ–å®šä¹‰&lt;code&gt;ThreadPoolTaskExecutor&lt;/code&gt; Beanï¼Œå¯é…ç½®æ ¸å¿ƒå‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ioExecutor&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ioIntensiveExecutor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCorePoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;20&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setMaxPoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setQueueCapacity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setThreadNamePrefix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;IO-Async-&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨æ—¶é€šè¿‡&lt;code&gt;@Async(&amp;quot;ioExecutor&amp;quot;)&lt;/code&gt;æŒ‡å®š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
å¼‚æ­¥æ–¹æ³•å†…çš„å¼‚å¸¸éœ€é€šè¿‡&lt;code&gt;@AsyncExceptionHandler&lt;/code&gt;æ•è·ï¼Œé¿å…çº¿ç¨‹æ± å´©æºƒ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹é”™è¯¯ç¤ºä¾‹"&gt;å…¸å‹é”™è¯¯ç¤ºä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ProblemService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// âŒ é”™è¯¯ï¼šåŒç±»ç›´æ¥è°ƒç”¨å¼‚æ­¥æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;processData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asyncTask&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸ä¼šå¼‚æ­¥æ‰§è¡Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;asyncTask&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// âŒ é”™è¯¯ï¼šprivateæ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥ä»»åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¿®æ­£æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CorrectService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AsyncComponent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asyncComponent&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥æ–¹æ³•æŠ½å–åˆ°ç‹¬ç«‹ç»„ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;processData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asyncComponent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asyncTask&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AsyncComponent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;asyncTask&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* å¼‚æ­¥é€»è¾‘ */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©&lt;code&gt;@Async&lt;/code&gt;çš„æ”¾ç½®ä½ç½®ï¼Œç»“åˆçº¿ç¨‹æ± å®šåˆ¶å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¯æ˜¾è‘—æå‡Springåº”ç”¨çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚å»ºè®®ä¼˜å…ˆé‡‡ç”¨&lt;strong&gt;æ–¹æ³•çº§æ³¨è§£&lt;/strong&gt;+&lt;strong&gt;ç‹¬ç«‹çº¿ç¨‹æ± &lt;/strong&gt;çš„ç»„åˆæ–¹æ¡ˆï¼Œä»¥è·å¾—æœ€ä½³æ§åˆ¶ç²’åº¦ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œè‹¥ä¸€ä¸ª &lt;code&gt;@Async&lt;/code&gt; æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;methodA&lt;/code&gt;ï¼‰æš´éœ²ç»™å¤–éƒ¨è°ƒç”¨ï¼Œå¹¶åœ¨å…¶å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ª &lt;code&gt;@Async&lt;/code&gt; æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;methodB&lt;/code&gt;ï¼‰ï¼Œåˆ™ &lt;strong&gt;&lt;code&gt;methodB&lt;/code&gt; çš„å¼‚æ­¥ä¼šå¤±æ•ˆ&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…³é”®åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸå› åˆ†æä»£ç†æœºåˆ¶é™åˆ¶"&gt;åŸå› åˆ†æï¼šä»£ç†æœºåˆ¶é™åˆ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;AOP ä»£ç†æ‹¦æˆªå¤±æ•ˆ&lt;/strong&gt;&lt;br&gt;
Spring çš„ &lt;code&gt;@Async&lt;/code&gt; åŸºäºåŠ¨æ€ä»£ç†å®ç°ã€‚å½“ &lt;code&gt;methodA&lt;/code&gt; ç›´æ¥è°ƒç”¨ &lt;code&gt;methodB&lt;/code&gt; æ—¶ï¼Œå±äº &lt;strong&gt;åŒç±»å†…éƒ¨æ–¹æ³•è°ƒç”¨&lt;/strong&gt;ï¼Œç»•è¿‡äº†ä»£ç†å¯¹è±¡çš„æ‹¦æˆªï¼Œå¯¼è‡´ &lt;code&gt;@Async&lt;/code&gt; æ³¨è§£å¤±æ•ˆã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æš´éœ²ç»™å¤–éƒ¨çš„å¼‚æ­¥æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´æ¥è°ƒç”¨åŒç±»æ–¹æ³•ï¼Œå¼‚æ­¥å¤±æ•ˆï¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒæ­¥è°ƒç”¨æœ¬è´¨&lt;/strong&gt;&lt;br&gt;
å³ä½¿ &lt;code&gt;methodA&lt;/code&gt; è¢«å¤–éƒ¨å¼‚æ­¥è°ƒç”¨ï¼Œå†…éƒ¨è°ƒç”¨ &lt;code&gt;methodB&lt;/code&gt; æ—¶ä»ç”± &lt;strong&gt;ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œ&lt;/strong&gt;ï¼Œè€Œéé€šè¿‡ä»£ç†å¯¹è±¡è§¦å‘æ–°çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆ"&gt;è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="æ–¹æ¡ˆ-1æ‹†åˆ†å¼‚æ­¥æ–¹æ³•åˆ°ç‹¬ç«‹ç±»æ¨è"&gt;æ–¹æ¡ˆ 1ï¼šæ‹†åˆ†å¼‚æ­¥æ–¹æ³•åˆ°ç‹¬ç«‹ç±»ï¼ˆæ¨èï¼‰
&lt;/h4&gt;&lt;p&gt;å°† &lt;code&gt;methodB&lt;/code&gt; æŠ½å–åˆ°å¦ä¸€ä¸ª Spring Bean ä¸­ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥è°ƒç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œå¼‚æ­¥ç”Ÿæ•ˆ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šä»£ç æ¸…æ™°ï¼Œç¬¦åˆ Spring ä»£ç†æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ–¹æ¡ˆ-2é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨"&gt;æ–¹æ¡ˆ 2ï¼šé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨
&lt;/h4&gt;&lt;p&gt;æ³¨å…¥å½“å‰ç±»çš„ä»£ç†å®ä¾‹ï¼Œç»•è¿‡åŒç±»è°ƒç”¨é™åˆ¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;selfProxy&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ³¨å…¥ä»£ç†å¯¹è±¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;selfProxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€åœ¨å¯åŠ¨ç±»æˆ–é…ç½®ç±»æ·»åŠ  &lt;code&gt;@EnableAspectJAutoProxy(exposeProxy = true)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®ä¿ &lt;code&gt;methodB&lt;/code&gt; æ˜¯ &lt;code&gt;public&lt;/code&gt; æ–¹æ³•ï¼ˆç§æœ‰æ–¹æ³•æ— æ³•è¢«ä»£ç†æ‹¦æˆªï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ± é…ç½®&lt;/strong&gt;&lt;br&gt;
é»˜è®¤ä½¿ç”¨ &lt;code&gt;SimpleAsyncTaskExecutor&lt;/code&gt;ï¼ˆéçº¿ç¨‹æ± ï¼‰ï¼Œå»ºè®®è‡ªå®šä¹‰çº¿ç¨‹æ± é¿å…èµ„æºè€—å°½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;customExecutor&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;customThreadPool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCorePoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setMaxPoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;50&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;customExecutor&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‡å®šçº¿ç¨‹æ± &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
å¼‚æ­¥æ–¹æ³•éœ€å¤„ç†å¼‚å¸¸ï¼Œé¿å…çº¿ç¨‹æ± å´©æºƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Future&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸šåŠ¡é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AsyncResult&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forExecutionException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”"&gt;æ€§èƒ½å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;å¼‚æ­¥ç”Ÿæ•ˆæ€§&lt;/th&gt;
&lt;th&gt;ä»£ç ä¾µå…¥æ€§&lt;/th&gt;
&lt;th&gt;ç»´æŠ¤æˆæœ¬&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ‹†åˆ†åˆ°ç‹¬ç«‹ç±»&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä»£ç†å¯¹è±¡è°ƒç”¨&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç›´æ¥åŒç±»è°ƒç”¨&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€è°ƒè¯•ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èé€‰æ‹©&lt;/strong&gt;ï¼šä¼˜å…ˆé‡‡ç”¨ &lt;strong&gt;æ–¹æ¡ˆ1&lt;/strong&gt;ï¼Œä»£ç ç»“æ„æ›´æ¸…æ™°ä¸”ç¬¦åˆ Spring è®¾è®¡è§„èŒƒã€‚è‹¥å› ä¸šåŠ¡è€¦åˆå¿…é¡»ä¿ç•™åŒç±»è°ƒç”¨ï¼Œåˆ™é€‰æ‹© &lt;strong&gt;æ–¹æ¡ˆ2&lt;/strong&gt;ï¼Œä½†éœ€æ³¨æ„ä»£ç†é…ç½®å’Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="thencombine"&gt;thenCombine
&lt;/h2&gt;&lt;p&gt;æ ¹æ®æä¾›çš„ä»£ç ç‰‡æ®µå’Œæœç´¢ç»“æœçš„ç»¼åˆåˆ†æï¼Œè¯¥ä»£ç å­˜åœ¨ä»¥ä¸‹å…³é”®é—®é¢˜åŠæ”¹è¿›å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒé—®é¢˜åˆ†æ"&gt;æ ¸å¿ƒé—®é¢˜åˆ†æ
&lt;/h3&gt;&lt;h4 id="é˜»å¡å¼å¼‚æ­¥è°ƒç”¨è¿åå¼‚æ­¥è®¾è®¡åŸåˆ™"&gt;&lt;strong&gt;é˜»å¡å¼å¼‚æ­¥è°ƒç”¨ï¼ˆè¿åå¼‚æ­¥è®¾è®¡åŸåˆ™ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;futureUserInfo&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureOpinionInfo&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// âŒ é˜»å¡å¼‚æ­¥çº¿ç¨‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;OpinionInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinionInfos&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureOpinionInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfos&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureUserInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜æœ¬è´¨&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;@Async&lt;/code&gt; æ–¹æ³•å†…ä½¿ç”¨ &lt;code&gt;join()&lt;/code&gt; ä¼šå¯¼è‡´å¼‚æ­¥çº¿ç¨‹é˜»å¡ï¼Œè¿èƒŒäº†å¼‚æ­¥ç¼–ç¨‹çš„åˆè¡·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;@Async&lt;/code&gt; ä½¿ç”¨ &lt;code&gt;SimpleAsyncTaskExecutor&lt;/code&gt;ï¼Œçº¿ç¨‹æ± èµ„æºä¼šè¢«æµªè´¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åæœ&lt;/strong&gt;ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½å¯¼è‡´çº¿ç¨‹æ± è€—å°½ï¼Œç³»ç»Ÿååé‡ä¸‹é™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼‚å¸¸å¤„ç†ç¼ºå¤±"&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†ç¼ºå¤±&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä»£ç æœªå¯¹ &lt;code&gt;futureOpinionInfo&lt;/code&gt; å’Œ &lt;code&gt;futureUserInfo&lt;/code&gt; çš„æ½œåœ¨å¼‚å¸¸ï¼ˆå¦‚ Feign è°ƒç”¨å¤±è´¥ï¼‰è¿›è¡Œå¤„ç†ï¼Œå¯èƒ½å¯¼è‡´æœªæ•è·çš„å¼‚å¸¸å¯¼è‡´çº¿ç¨‹å´©æºƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="çº¿ç¨‹æ± é…ç½®é£é™©"&gt;&lt;strong&gt;çº¿ç¨‹æ± é…ç½®é£é™©&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æœªæ˜¾å¼æŒ‡å®šçº¿ç¨‹æ± ï¼Œé»˜è®¤ä½¿ç”¨ &lt;code&gt;SimpleAsyncTaskExecutor&lt;/code&gt;ï¼ˆæ¯æ¬¡è°ƒç”¨æ–°å»ºçº¿ç¨‹ï¼‰ï¼Œå¯èƒ½å¼•å‘èµ„æºæ³„æ¼å’Œæ€§èƒ½é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ”¹è¿›æ–¹æ¡ˆ"&gt;æ”¹è¿›æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="éé˜»å¡å¼ä»»åŠ¡ç¼–æ’ä½¿ç”¨"&gt;&lt;strong&gt;éé˜»å¡å¼ä»»åŠ¡ç¼–æ’ï¼ˆä½¿ç”¨ &lt;code&gt;thenCombine&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;customExecutor&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‡å®šè‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;VoteInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;asyncCompleteVote&lt;/span&gt;&lt;span class="p"&gt;(...)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;OpinionInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureOpinionInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinionFeign&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getOpinionInfos&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureUserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userFeign&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserInfos&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureOpinionInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenCombine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;futureUserInfo&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;opinionInfos&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfos&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆå¹¶é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Utils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;triMerge&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="na"&gt;exceptionally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Async task failed&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fallbackVoteInfos&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å›é™çº§ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;thenCombine&lt;/code&gt; å®ç°å¼‚æ­¥ç»“æœèšåˆï¼Œé¿å…é˜»å¡çº¿ç¨‹æ± èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ˜¾å¼çº¿ç¨‹æ± é…ç½®"&gt;&lt;strong&gt;æ˜¾å¼çº¿ç¨‹æ± é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# é…ç½®è‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;task&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;execution&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;pool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;core-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;queue-capacity&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;200&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–é€šè¿‡ Java é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;customExecutor&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;customThreadPool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCorePoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;20&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setMaxPoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setThreadNamePrefix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;VoteAsync-&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å¼‚å¸¸å¤„ç†å¢å¼º"&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†å¢å¼º&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ä¸ºæ¯ä¸ª Feign è°ƒç”¨æ·»åŠ å¼‚å¸¸å¤„ç†&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;OpinionInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureOpinionInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinionFeign&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getOpinionInfos&lt;/span&gt;&lt;span class="p"&gt;(...)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exceptionally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;warn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Failed to get opinions&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Collections&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;emptyList&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å›ç©ºæ•°æ®æˆ–é™çº§å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="ä»£ç ä¼˜åŒ–åå¯¹æ¯”"&gt;ä»£ç ä¼˜åŒ–åå¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¼˜åŒ–ç‚¹&lt;/th&gt;
&lt;th&gt;åŸä»£ç é—®é¢˜&lt;/th&gt;
&lt;th&gt;ä¼˜åŒ–åæ–¹æ¡ˆ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹é˜»å¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;code&gt;join()&lt;/code&gt; é˜»å¡å¼‚æ­¥çº¿ç¨‹æ± &lt;/td&gt;
&lt;td&gt;é€šè¿‡ &lt;code&gt;thenCombine&lt;/code&gt; å®ç°éé˜»å¡ä»»åŠ¡é“¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹æ± ç®¡ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤çº¿ç¨‹æ± å¯èƒ½å¯¼è‡´èµ„æºè€—å°½&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰çº¿ç¨‹æ± æ§åˆ¶å¹¶å‘èµ„æº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¥å£®æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœªå¤„ç† Feign è°ƒç”¨å¼‚å¸¸ï¼Œå¯èƒ½å¼•å‘çº¿ç¨‹å´©æºƒ&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;code&gt;exceptionally&lt;/code&gt; å®ç°é™çº§é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç å¯è¯»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒæ­¥å¼ä»£ç ç»“æ„ï¼Œéš¾ä»¥æ‰©å±•&lt;/td&gt;
&lt;td&gt;å£°æ˜å¼å¼‚æ­¥é“¾ï¼Œæ”¯æŒåç»­ä»»åŠ¡è¿½åŠ ï¼ˆå¦‚ &lt;code&gt;thenApplyAsync&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å…¶ä»–æ³¨æ„äº‹é¡¹-1"&gt;å…¶ä»–æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡è¾¹ç•Œé—®é¢˜&lt;/strong&gt;&lt;br&gt;
è‹¥æ–¹æ³•å†…æ¶‰åŠæ•°æ®åº“æ“ä½œï¼Œéœ€æ³¨æ„ &lt;code&gt;@Transactional&lt;/code&gt; ä¸ &lt;code&gt;@Async&lt;/code&gt; çš„å…¼å®¹æ€§ï¼ˆå¼‚æ­¥æ–¹æ³•å†…äº‹åŠ¡éœ€é€šè¿‡ &lt;code&gt;PROPAGATION_REQUIRES_NEW&lt;/code&gt; éš”ç¦»ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt;&lt;br&gt;
å¼‚æ­¥ä»»åŠ¡ä¸­éœ€æ‰‹åŠ¨ä¼ é€’å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆå¦‚ &lt;code&gt;SecurityContextHolder&lt;/code&gt;ï¼‰æˆ–è¯·æ±‚å¤´ï¼Œå¯é€šè¿‡ &lt;code&gt;TaskDecorator&lt;/code&gt; å®ç°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setTaskDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ContextCopyingDecorator&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;&lt;br&gt;
å»ºè®®é€šè¿‡ Spring Actuator ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€ï¼ˆå¦‚ &lt;code&gt;/actuator/metrics/executor.active&lt;/code&gt;ï¼‰ï¼ŒåŠ¨æ€è°ƒæ•´å‚æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åŸä»£ç é€šè¿‡ä»¥ä¸‹æ”¹è¿›å¯æå‡æ€§èƒ½å’Œå¯é æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç§»é™¤é˜»å¡è°ƒç”¨&lt;/strong&gt; â†’ ä½¿ç”¨ &lt;code&gt;thenCombine&lt;/code&gt; æˆ– &lt;code&gt;thenCompose&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜¾å¼é…ç½®çº¿ç¨‹æ± &lt;/strong&gt; â†’ é¿å…é»˜è®¤çº¿ç¨‹æ± çš„ç¼ºé™·&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¢å¼ºå¼‚å¸¸å¤„ç†&lt;/strong&gt; â†’ æ·»åŠ  &lt;code&gt;exceptionally&lt;/code&gt; æˆ– &lt;code&gt;handle&lt;/code&gt; æ–¹æ³•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt; â†’ é€šè¿‡ &lt;code&gt;TaskDecorator&lt;/code&gt; ä¼ é€’çº¿ç¨‹ä¸Šä¸‹æ–‡&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å»ºè®®å‚è€ƒçš„æ¡ˆä¾‹è¿›ä¸€æ­¥ä¼˜åŒ–å¼‚æ­¥ä»»åŠ¡ç¼–æ’ã€‚&lt;/p&gt;
&lt;h2 id="completablefutrue"&gt;CompletableFutrue
&lt;/h2&gt;&lt;p&gt;CompletableFuture æ˜¯ Java 8 å¼•å…¥çš„å¼‚æ­¥ç¼–ç¨‹å·¥å…·ç±»ï¼ŒåŸºäº &lt;code&gt;Future&lt;/code&gt; å’Œ &lt;code&gt;CompletionStage&lt;/code&gt; æ¥å£æ„å»ºï¼Œè§£å†³äº†ä¼ ç»Ÿ &lt;code&gt;Future&lt;/code&gt; çš„å±€é™æ€§ï¼Œæ”¯æŒéé˜»å¡ã€é“¾å¼è°ƒç”¨å’Œå¤æ‚çš„ä»»åŠ¡ç¼–æ’ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œç”¨æ³•çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹æ€§"&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥æ‰§è¡Œ&lt;/strong&gt;&lt;br&gt;
ä»»åŠ¡å¯åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚æ”¯æŒé€šè¿‡ &lt;code&gt;supplyAsync()&lt;/code&gt; å’Œ &lt;code&gt;runAsync()&lt;/code&gt; å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼Œé»˜è®¤ä½¿ç”¨ &lt;code&gt;ForkJoinPool&lt;/code&gt;ï¼Œä½†æ¨èè‡ªå®šä¹‰çº¿ç¨‹æ± ä»¥é¿å…èµ„æºç«äº‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é“¾å¼ç»„åˆä¸æµæ°´çº¿&lt;/strong&gt;&lt;br&gt;
æä¾› &lt;code&gt;thenApply&lt;/code&gt;ã€&lt;code&gt;thenCompose&lt;/code&gt;ã€&lt;code&gt;thenCombine&lt;/code&gt; ç­‰æ–¹æ³•ï¼Œæ”¯æŒå°†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æŒ‰é¡ºåºæˆ–å¹¶è¡Œç»„åˆï¼Œå½¢æˆå¤æ‚çš„è®¡ç®—æµæ°´çº¿ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenApply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; World&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»“æœè½¬æ¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenAccept&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¶ˆè´¹ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;exceptionally()&lt;/code&gt; æ•è·å¼‚å¸¸å¹¶è¿”å›é»˜è®¤å€¼ï¼Œæˆ–é€šè¿‡ &lt;code&gt;handle()&lt;/code&gt; ç»Ÿä¸€å¤„ç†ç»“æœå’Œå¼‚å¸¸ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exceptionally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Fallback Result&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;res&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Error&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;res&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šä»»åŠ¡ååŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èšåˆç»“æœ&lt;/strong&gt;ï¼š&lt;code&gt;allOf()&lt;/code&gt; ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œ&lt;code&gt;anyOf()&lt;/code&gt; ç­‰å¾…ä»»æ„ä»»åŠ¡å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœåˆå¹¶&lt;/strong&gt;ï¼š&lt;code&gt;thenCombine()&lt;/code&gt; åˆå¹¶ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœï¼Œ&lt;code&gt;thenAcceptBoth()&lt;/code&gt; æ¶ˆè´¹åŒä»»åŠ¡ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¶…æ—¶ä¸å–æ¶ˆ&lt;/strong&gt;&lt;br&gt;
æ”¯æŒé€šè¿‡ &lt;code&gt;orTimeout()&lt;/code&gt; è®¾ç½®è¶…æ—¶ï¼Œæˆ–è°ƒç”¨ &lt;code&gt;cancel()&lt;/code&gt; ä¸»åŠ¨ç»ˆæ­¢ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ–¹æ³•"&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-åˆ›å»ºå¼‚æ­¥ä»»åŠ¡"&gt;&lt;strong&gt;1. åˆ›å»ºå¼‚æ­¥ä»»åŠ¡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;supplyAsync(Supplier)&lt;/code&gt;&lt;/strong&gt;ï¼šæ‰§è¡Œæœ‰è¿”å›å€¼çš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;runAsync(Runnable)&lt;/code&gt;&lt;/strong&gt;ï¼šæ‰§è¡Œæ— è¿”å›å€¼çš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡å®šçº¿ç¨‹æ± &lt;/strong&gt;ï¼šä¼ å…¥è‡ªå®šä¹‰ &lt;code&gt;Executor&lt;/code&gt; æ›¿ä»£é»˜è®¤çº¿ç¨‹æ± ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ç»“æœå¤„ç†"&gt;&lt;strong&gt;2. ç»“æœå¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½¬æ¢ç»“æœ&lt;/strong&gt;ï¼š&lt;code&gt;thenApply()&lt;/code&gt; å¯¹ç»“æœè¿›è¡Œæ˜ å°„ï¼ˆåŒæ­¥æ‰§è¡Œï¼‰ï¼Œ&lt;code&gt;thenApplyAsync()&lt;/code&gt; å¼‚æ­¥æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹ç»“æœ&lt;/strong&gt;ï¼š&lt;code&gt;thenAccept()&lt;/code&gt; æ¶ˆè´¹ç»“æœï¼Œæ— è¿”å›å€¼ï¼›&lt;code&gt;thenRun()&lt;/code&gt; ä¸ä¾èµ–ç»“æœæ‰§è¡Œæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-ä»»åŠ¡ç»„åˆ"&gt;&lt;strong&gt;3. ä»»åŠ¡ç»„åˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼š&lt;code&gt;thenCompose()&lt;/code&gt; å°†å‰åºä»»åŠ¡çš„ç»“æœä½œä¸ºåç»­ä»»åŠ¡çš„è¾“å…¥ï¼ˆé¿å…åµŒå¥—ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹¶è¡Œåˆå¹¶&lt;/strong&gt;ï¼š&lt;code&gt;thenCombine()&lt;/code&gt; åˆå¹¶ä¸¤ä¸ªç‹¬ç«‹ä»»åŠ¡çš„ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-å¤šä»»åŠ¡ååŒ"&gt;&lt;strong&gt;4. å¤šä»»åŠ¡ååŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨ç­‰å¾…&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture.allOf(futures).join()&lt;/code&gt; ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»æ„å®Œæˆ&lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture.anyOf(futures).join()&lt;/code&gt; ä»»ä¸€ä»»åŠ¡å®Œæˆå³ç»§ç»­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹ä½¿ç”¨åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¹¶è¡Œå¤„ç†ç‹¬ç«‹ä»»åŠ¡&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚ç”µå•†ç³»ç»Ÿä¸­ï¼ŒåŒæ—¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€è®¢å•ä¿¡æ¯å’Œå•†å“åº“å­˜ï¼Œæœ€ååˆå¹¶ç»“æœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥IOæ“ä½œ&lt;/strong&gt;&lt;br&gt;
å°†æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œè¯·æ±‚å¼‚æ­¥åŒ–ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡è°ƒç”¨é“¾&lt;/strong&gt;&lt;br&gt;
å¤šä¸ªè¿œç¨‹æœåŠ¡è°ƒç”¨æŒ‰é¡ºåºæˆ–æ¡ä»¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼šå…ˆè·å–ç”¨æˆ·IDï¼Œå†æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¶…æ—¶ç†”æ–­&lt;/strong&gt;&lt;br&gt;
è®¾ç½®ä»»åŠ¡è¶…æ—¶ï¼Œè‹¥æœªå®Œæˆåˆ™è¿”å›é»˜è®¤å€¼æˆ–æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ± é€‰æ‹©&lt;/strong&gt;&lt;br&gt;
é»˜è®¤ä½¿ç”¨ &lt;code&gt;ForkJoinPool.commonPool()&lt;/code&gt;ï¼Œä½†åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å»ºè®®è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé¿å…èµ„æºç«äº‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸ä¼ æ’­&lt;/strong&gt;&lt;br&gt;
é“¾å¼è°ƒç”¨ä¸­ï¼Œè‹¥æŸä¸€ç¯èŠ‚æŠ›å‡ºå¼‚å¸¸ä¸”æœªå¤„ç†ï¼Œåç»­ä»»åŠ¡å°†ç›´æ¥è·³è¿‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
é¿å…è¿‡åº¦åµŒå¥—ä»»åŠ¡é“¾ï¼Œå¯é€šè¿‡ &lt;code&gt;thenCompose&lt;/code&gt; æ›¿ä»£ &lt;code&gt;thenApply&lt;/code&gt; å‡å°‘åµŒå¥—å±‚çº§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹ä»£ç "&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å¹¶è¡Œæ‰§è¡Œå¹¶åˆå¹¶ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;World&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;combined&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenCombine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;combined&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¾“å‡º &amp;#34;Hello World&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// å¼‚å¸¸å¤„ç†&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;safeFuture&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exceptionally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚å¸¸æ—¶è¿”å›é»˜è®¤å€¼0&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;CompletableFuture é€šè¿‡é“¾å¼ç»„åˆã€å¼‚å¸¸å¤„ç†å’Œå¹¶è¡Œä»»åŠ¡ç®¡ç†ï¼Œæå¤§ç®€åŒ–äº†å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äº&lt;strong&gt;éé˜»å¡è®¾è®¡&lt;/strong&gt;å’Œ&lt;strong&gt;å‡½æ•°å¼ç¼–ç¨‹é£æ ¼&lt;/strong&gt;ï¼Œé€‚ç”¨äºéœ€è¦é«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„åº”ç”¨åœºæ™¯ï¼Œå¦‚å¾®æœåŠ¡è°ƒç”¨ã€å¤§æ•°æ®å¤„ç†ç­‰ã€‚&lt;/p&gt;
&lt;h2 id="å¼‚æ­¥å®ä¾‹"&gt;å¼‚æ­¥å®ä¾‹
&lt;/h2&gt;&lt;p&gt;åœ¨Springæ¡†æ¶ä¸­ï¼Œ&lt;code&gt;public CompletableFuture&amp;lt;AggregatedResult&amp;gt; aggregateResults()&lt;/code&gt;æ–¹æ³•ä¸éœ€è¦æ ‡è®°ä¸º&lt;code&gt;@Async&lt;/code&gt;çš„åŸå› åŠControllerå¤„ç†é€»è¾‘å¯åˆ†è§£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ºä½•ä¸éœ€è¦asyncæ³¨è§£"&gt;&lt;strong&gt;ä¸ºä½•ä¸éœ€è¦@Asyncæ³¨è§£ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡å·²ç”±CompletableFutureå†…éƒ¨å¯åŠ¨&lt;/strong&gt;&lt;br&gt;
å½“æ–¹æ³•å†…éƒ¨é€šè¿‡&lt;code&gt;supplyAsync&lt;/code&gt;ã€&lt;code&gt;runAsync&lt;/code&gt;æˆ–&lt;code&gt;thenApplyAsync&lt;/code&gt;ç­‰APIæ˜¾å¼å¯åŠ¨å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œ&lt;code&gt;CompletableFuture&lt;/code&gt;æœ¬èº«å·²ç®¡ç†äº†ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDataAsync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å‡è®¾getDataAsyncå†…éƒ¨ä½¿ç”¨supplyAsync&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶æ–¹æ³•&lt;code&gt;aggregateResults()&lt;/code&gt;ä»…è´Ÿè´£ç»„åˆå¤šä¸ª&lt;code&gt;CompletableFuture&lt;/code&gt;ï¼Œæ— éœ€é¢å¤–å¼€å¯å¼‚æ­¥çº¿ç¨‹æ± ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…é‡å¤çº¿ç¨‹æ± è°ƒåº¦&lt;/strong&gt;&lt;br&gt;
è‹¥æ–¹æ³•åŒæ—¶æ ‡è®°&lt;code&gt;@Async&lt;/code&gt;ï¼ŒSpringä¼šå°†å…¶æäº¤åˆ°å¼‚æ­¥çº¿ç¨‹æ± æ‰§è¡Œï¼Œè€Œ&lt;code&gt;CompletableFuture&lt;/code&gt;å†…éƒ¨å¯èƒ½å†æ¬¡ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯¼è‡´èµ„æºç«äº‰å’Œæ€§èƒ½æŸè€—ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯ï¼šåŒé‡å¼‚æ­¥å¯èƒ½å¯¼è‡´çº¿ç¨‹æ± åµŒå¥—&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aggregateResults&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å†…éƒ¨çº¿ç¨‹æ± &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•æœ¬è´¨æ˜¯åŒæ­¥ç»„åˆæ“ä½œ&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;aggregateResults()&lt;/code&gt;çš„æ ¸å¿ƒé€»è¾‘æ˜¯è°ƒç”¨å…¶ä»–å¼‚æ­¥æ–¹æ³•å¹¶ç»„åˆç»“æœï¼ˆå¦‚&lt;code&gt;allOf()&lt;/code&gt;æˆ–&lt;code&gt;thenCombine()&lt;/code&gt;ï¼‰ï¼Œå…¶è‡ªèº«æ‰§è¡Œæ—¶é—´æçŸ­ï¼Œæ— éœ€å¼‚æ­¥åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="controllerå¦‚ä½•å¤„ç†è¿”å›çš„completablefuture"&gt;&lt;strong&gt;Controllerå¦‚ä½•å¤„ç†è¿”å›çš„CompletableFutureï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨Controllerä¸­ç›´æ¥è¿”å›&lt;code&gt;CompletableFuture&amp;lt;AggregatedResult&amp;gt;&lt;/code&gt;æ—¶ï¼ŒSpring MVCä¼šè‡ªåŠ¨å¤„ç†å¼‚æ­¥å“åº”ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;h4 id="1-å¼‚æ­¥ç»“æœå°è£…"&gt;&lt;strong&gt;1. å¼‚æ­¥ç»“æœå°è£…&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Springä¼šå°†&lt;code&gt;CompletableFuture&lt;/code&gt;åŒ…è£…ä¸º&lt;code&gt;DeferredResult&lt;/code&gt;æˆ–&lt;code&gt;Callable&lt;/code&gt;ï¼Œç”±Servlet 3.0+çš„å¼‚æ­¥å¤„ç†æœºåˆ¶æ¥ç®¡ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ä»£ç ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/aggregate&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AggregatedResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getAggregatedData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;aggregationService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;aggregateResults&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-éé˜»å¡ç­‰å¾…"&gt;&lt;strong&gt;2. éé˜»å¡ç­‰å¾…&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¡†æ¶çº§ç­‰å¾…&lt;/strong&gt;ï¼šSpringä¼šç›‘å¬&lt;code&gt;CompletableFuture&lt;/code&gt;çš„å®ŒæˆçŠ¶æ€ï¼Œåœ¨ä»»åŠ¡å®Œæˆåè‡ªåŠ¨å°†ç»“æœå†™å…¥HTTPå“åº”ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯æ— æ„ŸçŸ¥&lt;/strong&gt;ï¼šè°ƒç”¨æ–¹ï¼ˆå¦‚æµè§ˆå™¨æˆ–Feignå®¢æˆ·ç«¯ï¼‰ä»…çœ‹åˆ°æœ€ç»ˆç»“æœï¼Œæ— éœ€å¤„ç†å¼‚æ­¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å¼‚å¸¸ä¼ é€’"&gt;&lt;strong&gt;3. å¼‚å¸¸ä¼ é€’&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‹¥&lt;code&gt;CompletableFuture&lt;/code&gt;æ‰§è¡Œä¸­æŠ›å‡ºå¼‚å¸¸ï¼ŒSpring MVCä¼šé€šè¿‡&lt;code&gt;@ExceptionHandler&lt;/code&gt;æˆ–å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·å¹¶è¿”å›é”™è¯¯å“åº”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-è¶…æ—¶æ§åˆ¶"&gt;&lt;strong&gt;4. è¶…æ—¶æ§åˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¯é€šè¿‡&lt;code&gt;@Async&lt;/code&gt;é…ç½®å…¨å±€è¶…æ—¶ï¼Œæˆ–ä½¿ç”¨&lt;code&gt;CompletableFuture.orTimeout()&lt;/code&gt;è®¾ç½®å•ä¸ªä»»åŠ¡è¶…æ—¶é˜ˆå€¼ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;futureA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;orTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;3000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MILLISECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åœºæ™¯ç¤ºä¾‹"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯èšåˆä¸‰ä¸ªå¾®æœåŠ¡çš„ç»“æœ"&gt;&lt;strong&gt;åœºæ™¯ï¼šèšåˆä¸‰ä¸ªå¾®æœåŠ¡çš„ç»“æœ&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AggregatedResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aggregateResults&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDataAsync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;InfoResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getInfoAsync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;PromoResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getPromoAsync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;futureA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureC&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenApply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AggregatedResult&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;futureC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Controllerè°ƒç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/details&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AggregatedResult&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getDetails&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;service&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;aggregateResults&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµç¨‹&lt;/strong&gt;ï¼šSpringå¼‚æ­¥çº¿ç¨‹æ¥æ”¶è¯·æ±‚ â†’ ä¸»çº¿ç¨‹ç«‹å³è¿”å›&lt;code&gt;CompletableFuture&lt;/code&gt; â†’ åå°ä»»åŠ¡å®Œæˆåè‡ªåŠ¨å“åº”ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-2"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ± éš”ç¦»&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥&lt;code&gt;serviceA.getDataAsync()&lt;/code&gt;ç­‰åº•å±‚æ–¹æ³•ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œéœ€ç¡®ä¿å…¶ä¸Springé»˜è®¤çº¿ç¨‹æ± éš”ç¦»ï¼Œé¿å…èµ„æºè€—å°½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼‚æ­¥çº¿ç¨‹å¯èƒ½ä¸¢å¤±&lt;code&gt;ThreadLocal&lt;/code&gt;æ•°æ®ï¼ˆå¦‚å®‰å…¨ä¸Šä¸‹æ–‡ï¼‰ï¼Œéœ€æ‰‹åŠ¨ä¼ é€’ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;RequestAttributes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RequestContextHolder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequestAttributes&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RequestContextHolder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setRequestAttributes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆAPMå·¥å…·ï¼ˆå¦‚SkyWalkingï¼‰ç›‘æ§å¼‚æ­¥ä»»åŠ¡è€—æ—¶å’Œçº¿ç¨‹æ± çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-4"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— éœ€@Asyncçš„åŸå› &lt;/strong&gt;ï¼š&lt;code&gt;CompletableFuture&lt;/code&gt;å·²é€šè¿‡&lt;code&gt;supplyAsync&lt;/code&gt;ç­‰APIå®ç°å¼‚æ­¥ï¼Œæ–¹æ³•æœ¬èº«ä»…ç»„åˆç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Controllerå¤„ç†é€»è¾‘&lt;/strong&gt;ï¼šSpring MVCè‡ªåŠ¨å°è£…å¼‚æ­¥å“åº”ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨è°ƒç”¨&lt;code&gt;get()&lt;/code&gt;æˆ–å¤„ç†é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šä¼˜å…ˆç”¨&lt;code&gt;CompletableFuture&lt;/code&gt;é“¾å¼æ“ä½œæ›¿ä»£&lt;code&gt;@Async&lt;/code&gt;ï¼Œä»…åœ¨éœ€è¦å…¨å±€å¼‚æ­¥åŒ–æ–¹æ³•æ—¶ä½¿ç”¨&lt;code&gt;@Async&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="java-list-åˆå¹¶"&gt;Java List åˆå¹¶
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­åˆå¹¶ä¸¤ä¸ª &lt;code&gt;List&lt;/code&gt; çš„å¸¸ç”¨æ–¹æ³•åŠé€‚ç”¨åœºæ™¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="addall-æ–¹æ³•åŸºç¡€é«˜æ•ˆ"&gt;&lt;code&gt;addAll()&lt;/code&gt; æ–¹æ³•ï¼ˆåŸºç¡€é«˜æ•ˆï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®ç°åŸç†&lt;/strong&gt;ï¼šç›´æ¥è°ƒç”¨ &lt;code&gt;List&lt;/code&gt; æ¥å£çš„ &lt;code&gt;addAll()&lt;/code&gt; æ–¹æ³•ï¼Œå°†ç¬¬äºŒä¸ªåˆ—è¡¨çš„å…¨éƒ¨å…ƒç´ è¿½åŠ åˆ°ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚&lt;br&gt;
&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;A&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;B&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;C&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;D&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆå¹¶å list1 åŒ…å«æ‰€æœ‰å…ƒç´ &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šä»£ç ç®€æ´ã€æ€§èƒ½é«˜æ•ˆï¼ˆæ—¶é—´å¤æ‚åº¦ O(n)ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šä¼šä¿®æ”¹åŸåˆ—è¡¨ &lt;code&gt;list1&lt;/code&gt;ï¼Œè‹¥éœ€ä¿ç•™åŸåˆ—è¡¨ï¼Œéœ€å…ˆåˆ›å»ºå‰¯æœ¬ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¿«é€Ÿåˆå¹¶ä¸”æ— éœ€ä¿ç•™åŸåˆ—è¡¨çš„ä¸å¯å˜æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="streamconcatä¸å¯å˜åˆå¹¶"&gt;&lt;code&gt;Stream.concat()&lt;/code&gt;ï¼ˆä¸å¯å˜åˆå¹¶ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®ç°åŸç†&lt;/strong&gt;ï¼šé€šè¿‡ Java 8 çš„ Stream API å°†ä¸¤ä¸ªåˆ—è¡¨è½¬ä¸ºæµåˆå¹¶ï¼Œç”Ÿæˆæ–°åˆ—è¡¨ã€‚&lt;br&gt;
&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mergedList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Stream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;concat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šç”Ÿæˆæ–°åˆ—è¡¨ï¼Œä¸ä¿®æ”¹åŸæ•°æ®ï¼›æ”¯æŒé“¾å¼æ“ä½œï¼ˆå¦‚è¿‡æ»¤ã€å»é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¤„ç†å¤§æ•°æ®é‡æ—¶æ€§èƒ½ç•¥ä½äº &lt;code&gt;addAll()&lt;/code&gt;ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦ä¿ç•™åŸåˆ—è¡¨æˆ–è¿›è¡Œå¤æ‚å¤„ç†ï¼ˆå¦‚å»é‡ã€æ˜ å°„ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ‰‹åŠ¨å¾ªç¯æ·»åŠ çµæ´»æ§åˆ¶"&gt;æ‰‹åŠ¨å¾ªç¯æ·»åŠ ï¼ˆçµæ´»æ§åˆ¶ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®ç°åŸç†&lt;/strong&gt;ï¼šé€šè¿‡éå†ç¬¬äºŒä¸ªåˆ—è¡¨ï¼Œé€ä¸ªå…ƒç´ æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚&lt;br&gt;
&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šçµæ´»æ€§é«˜ï¼Œå¯åœ¨æ·»åŠ æ—¶è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æ¡ä»¶è¿‡æ»¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šä»£ç å†—ä½™ï¼Œæ€§èƒ½ä¸ &lt;code&gt;addAll()&lt;/code&gt; ç›¸ä¼¼ä½†ä¸å¤Ÿç®€æ´ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€åœ¨åˆå¹¶è¿‡ç¨‹ä¸­æ‰§è¡Œé¢å¤–æ“ä½œï¼ˆå¦‚æ ¡éªŒå…ƒç´ ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç¬¬ä¸‰æ–¹åº“ç®€åŒ–ä»£ç "&gt;ç¬¬ä¸‰æ–¹åº“ï¼ˆç®€åŒ–ä»£ç ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Apache Commons Collections&lt;/strong&gt;ï¼š&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;CollectionUtils.addAll()&lt;/code&gt; æ–¹æ³•åˆå¹¶åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mergedList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CollectionUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mergedList&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// éœ€å¼•å…¥ä¾èµ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šä»£ç æ›´ç®€æ´ï¼Œä½†ä¾èµ–ç¬¬ä¸‰æ–¹åº“ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="çº¿ç¨‹å®‰å…¨åœºæ™¯"&gt;çº¿ç¨‹å®‰å…¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;CopyOnWriteArrayList&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨å¹¶å‘ç¯å¢ƒä¸‹åˆå¹¶åˆ—è¡¨ï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CopyOnWriteArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CopyOnWriteArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;A&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;B&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çº¿ç¨‹å®‰å…¨æ“ä½œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„åˆ—è¡¨åˆå¹¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å»é‡åˆå¹¶"&gt;å»é‡åˆå¹¶
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;distinct()&lt;/code&gt; æ–¹æ³•è¿‡æ»¤é‡å¤å…ƒç´ ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mergedList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Stream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;concat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;distinct&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåˆå¹¶åéœ€ä¿è¯å…ƒç´ å”¯ä¸€æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-5"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜å…ˆ&lt;/strong&gt;ï¼šé€‰æ‹© &lt;code&gt;addAll()&lt;/code&gt; æˆ–æ‰‹åŠ¨å¾ªç¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜éœ€æ±‚&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;Stream.concat()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚å¤„ç†&lt;/strong&gt;ï¼šç»“åˆ Stream API çš„è¿‡æ»¤ã€æ˜ å°„ç­‰åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼šä¼˜å…ˆè€ƒè™‘ &lt;code&gt;CopyOnWriteArrayList&lt;/code&gt; æˆ–åŒæ­¥æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æ–¹æ³•ï¼Œé¿å…å› è¿‡åº¦è®¾è®¡å¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;h2 id="æ‰¹é‡åˆ é™¤åŸå­æ€§"&gt;æ‰¹é‡åˆ é™¤åŸå­æ€§
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œæ‰¹é‡åˆ é™¤æ“ä½œçš„äº‹åŠ¡è¡Œä¸ºå–å†³äº&lt;strong&gt;äº‹åŠ¡é…ç½®&lt;/strong&gt;å’Œ&lt;strong&gt;å¼‚å¸¸å¤„ç†æœºåˆ¶&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤äº‹åŠ¡è¡Œä¸ºåŸå­æ€§ä¿éšœ"&gt;é»˜è®¤äº‹åŠ¡è¡Œä¸ºï¼šåŸå­æ€§ä¿éšœ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¨é‡å›æ»šæœºåˆ¶&lt;/strong&gt;&lt;br&gt;
é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring äº‹åŠ¡ç®¡ç†éµå¾ª &lt;strong&gt;ACID åŸåˆ™çš„åŸå­æ€§&lt;/strong&gt;ã€‚è‹¥æ‰¹é‡åˆ é™¤è¿‡ç¨‹ä¸­ä»»æ„ä¸€æ¡ SQL æ“ä½œå¤±è´¥ï¼ˆå¦‚æ•°æ®åº“å¼‚å¸¸ã€çº¦æŸå†²çªç­‰ï¼‰ï¼Œ&lt;strong&gt;æ•´ä¸ªäº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»š&lt;/strong&gt;ï¼Œæ‰€æœ‰å·²æ‰§è¡Œçš„åˆ é™¤æ“ä½œå‡æ’¤é”€ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchDelete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;deleteAllByIdInBatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰¹é‡åˆ é™¤æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‹¥åˆ é™¤è¿‡ç¨‹ä¸­æŸæ¡è®°å½•å› å¤–é”®çº¦æŸå¯¼è‡´å¤±è´¥ï¼Œæ‰€æœ‰å·²åˆ é™¤çš„è®°å½•ä¼šå›æ»šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;br&gt;
ä»¥ä¸‹æƒ…å†µä¼šè§¦å‘å…¨é‡å›æ»šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠ›å‡º &lt;strong&gt;æœªæ•è·çš„ &lt;code&gt;RuntimeException&lt;/code&gt; æˆ– &lt;code&gt;Error&lt;/code&gt;&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;DataIntegrityViolationException&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@Transactional(rollbackFor = Exception.class)&lt;/code&gt; ç­‰é…ç½®åï¼Œä»»ä½•æŒ‡å®šå¼‚å¸¸å‡è§¦å‘å›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éƒ¨åˆ†å›æ»šçš„å®ç°æ–¹æ³•"&gt;éƒ¨åˆ†å›æ»šçš„å®ç°æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€å®ç°&lt;strong&gt;éƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å›æ»š&lt;/strong&gt;ï¼ˆä»…å›æ»šå¤±è´¥æ“ä½œï¼‰ï¼Œéœ€é€šè¿‡&lt;strong&gt;ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†&lt;/strong&gt;æˆ–&lt;strong&gt;åˆ†æ²»ç­–ç•¥&lt;/strong&gt;è°ƒæ•´äº‹åŠ¡è¾¹ç•Œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;TransactionTemplate&lt;/code&gt; æˆ– &lt;code&gt;PlatformTransactionManager&lt;/code&gt; &lt;strong&gt;æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ç²’åº¦&lt;/strong&gt;ï¼Œåœ¨å•ä¸ªäº‹åŠ¡ä¸­æ‹†åˆ†å¤šä¸ªå­æ“ä½œã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PlatformTransactionManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transactionManager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchDeleteWithPartialRollback&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DefaultTransactionDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;def&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DefaultTransactionDefinition&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionStatus&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transactionManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTransaction&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;def&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;deleteById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å•æ¡åˆ é™¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transactionManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transactionManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;rollback&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»…å›æ»šå½“å‰è®°å½•çš„äº‹åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;åˆ é™¤å¤±è´¥: {}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šæ¯æ¡åˆ é™¤æ“ä½œç‹¬ç«‹äº‹åŠ¡ï¼Œå¤±è´¥ä»…å½±å“å½“å‰è®°å½•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†æ‰¹æ¬¡æäº¤&lt;/strong&gt;&lt;br&gt;
å°†æ‰¹é‡æ“ä½œæ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡ï¼Œé€šè¿‡ &lt;code&gt;Propagation.REQUIRES_NEW&lt;/code&gt; ä¼ æ’­è¡Œä¸ºç¡®ä¿æ¯ä¸ªæ‰¹æ¬¡ç‹¬ç«‹æäº¤ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;propagation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Propagation&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;REQUIRED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchDeleteInChunks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chunks&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Lists&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ†å—ï¼ˆæ¯100æ¡ä¸€ä¸ªäº‹åŠ¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chunk&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chunks&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deleteChunk&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chunk&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;propagation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Propagation&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;REQUIRES_NEW&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;deleteChunk&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chunk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;deleteAllByIdInBatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chunk&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ³¨æ„äº‹é¡¹-1"&gt;å…³é”®æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤å›æ»šè§„åˆ™&lt;/strong&gt;ï¼šéœ€ç¡®ä¿å¼‚å¸¸æœªè¢«æ•è·æˆ–é‡æ–°æŠ›å‡ºï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¸æŒ‰é¢„æœŸå›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å—æ£€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šè‹¥éœ€é &lt;code&gt;RuntimeException&lt;/code&gt; è§¦å‘å›æ»šï¼Œéœ€æ˜¾å¼é…ç½® &lt;code&gt;rollbackFor&lt;/code&gt; å±æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½æƒè¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨é‡å›æ»š&lt;/strong&gt;ï¼šé€‚åˆå¼ºä¸€è‡´æ€§åœºæ™¯ï¼Œä½†é«˜å¹¶å‘ä¸‹å¯èƒ½å¼•å‘é”ç«äº‰å’Œæ€§èƒ½ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éƒ¨åˆ†å›æ»š&lt;/strong&gt;ï¼šç‰ºç‰²åŸå­æ€§æ¢å–ååé‡ï¼Œéœ€é¢å¤–å¤„ç†æ•°æ®è¡¥å¿é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ORM æ¡†æ¶é™åˆ¶&lt;/strong&gt;&lt;br&gt;
JPA çš„ &lt;code&gt;deleteAllByIdInBatch()&lt;/code&gt; ç­‰æ–¹æ³•ç”Ÿæˆçš„ SQL ä¸ºå•æ¡è¯­å¥ï¼ˆå¦‚ &lt;code&gt;DELETE FROM table WHERE id IN (â€¦)&lt;/code&gt;ï¼‰ï¼Œæ­¤æ—¶æ•°æ®åº“å±‚é¢è¦ä¹ˆå…¨æˆåŠŸã€è¦ä¹ˆå…¨å¤±è´¥ï¼Œæ— æ³•å®ç°éƒ¨åˆ†å›æ»šã€‚è‹¥éœ€é€æ¡åˆ é™¤ï¼Œåº”ä½¿ç”¨å¾ªç¯è°ƒç”¨ &lt;code&gt;deleteById()&lt;/code&gt; é…åˆç¼–ç¨‹å¼äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-6"&gt;æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;äº‹åŠ¡è¡Œä¸º&lt;/th&gt;
&lt;th&gt;é€‚ç”¨æ€§&lt;/th&gt;
&lt;th&gt;æŠ€æœ¯æ–¹æ¡ˆ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é»˜è®¤æ‰¹é‡åˆ é™¤&lt;/td&gt;
&lt;td&gt;å…¨é‡å›æ»š&lt;/td&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§éœ€æ±‚&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@Transactional&lt;/code&gt; + æ‰¹é‡æ–¹æ³•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éƒ¨åˆ†æˆåŠŸéœ€æ±‚&lt;/td&gt;
&lt;td&gt;éƒ¨åˆ†å›æ»š&lt;/td&gt;
&lt;td&gt;é«˜ååã€å…è®¸éƒ¨åˆ†å¤±è´¥&lt;/td&gt;
&lt;td&gt;ç¼–ç¨‹å¼äº‹åŠ¡ + åˆ†æ‰¹æ¬¡æäº¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å•æ¡ SQL æ‰¹é‡æ“ä½œ&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“åŸå­æ€§æ§åˆ¶&lt;/td&gt;
&lt;td&gt;ä¾èµ–æ•°æ®åº“è¡Œä¸º&lt;/td&gt;
&lt;td&gt;è°ƒæ•´ SQL æˆ–æ‹†åˆ†æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡å®¹å¿åº¦é€‰æ‹©æ–¹æ¡ˆã€‚è‹¥éœ€éƒ¨åˆ†å›æ»šï¼Œä¼˜å…ˆé‡‡ç”¨ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†é€æ¡å¤„ç†ï¼Œæˆ–ç»“åˆè¡¥å¿æœºåˆ¶ï¼ˆå¦‚æ—¥å¿—è®°å½•å¤±è´¥ ID å¹¶é‡è¯•ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="nacos-é…ç½®ä¼˜å…ˆçº§"&gt;nacos é…ç½®ä¼˜å…ˆçº§
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œåœ¨æ‚¨æä¾›çš„é…ç½®ä¸­ï¼Œ&lt;strong&gt;comment-service.yaml ä¸­çš„ç›¸åŒé…ç½®é¡¹ä¼˜å…ˆçº§é«˜äº shared-kafka.yaml&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-nacos-é…ç½®çš„ä¼˜å…ˆçº§è§„åˆ™"&gt;&lt;strong&gt;1. Nacos é…ç½®çš„ä¼˜å…ˆçº§è§„åˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ ¹æ® Spring Cloud Alibaba Nacos çš„é…ç½®åŠ è½½æœºåˆ¶ï¼Œé…ç½®ä¼˜å…ˆçº§éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ€é«˜ä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;code&gt;æœåŠ¡å-{profile}.yaml&lt;/code&gt;ï¼ˆå³ &lt;code&gt;comment-service-dev.yaml&lt;/code&gt;ï¼Œé€šè¿‡æœåŠ¡åä¸ç¯å¢ƒè‡ªåŠ¨ç”Ÿæˆçš„é…ç½®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¬¡é«˜ä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;code&gt;æœåŠ¡å.yaml&lt;/code&gt;ï¼ˆå³ &lt;code&gt;comment-service.yaml&lt;/code&gt;ï¼Œä¸ä¾èµ–ç¯å¢ƒçš„é€šç”¨é…ç½®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«é…ç½®ä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;code&gt;shared-configs&lt;/code&gt; ä¸­å®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;shared-kafka.yaml&lt;/code&gt;ï¼‰ï¼Œå…¶ä¼˜å…ˆçº§ä½äºä¸Šè¿°ä¸¤ç±»åº”ç”¨åé…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œ&lt;code&gt;comment-service.yaml&lt;/code&gt; å±äº &lt;strong&gt;åº”ç”¨åé…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼Œè€Œ &lt;code&gt;shared-kafka.yaml&lt;/code&gt; å±äº &lt;strong&gt;å…±äº«é…ç½®æ–‡ä»¶&lt;/strong&gt;ï¼Œå‰è€…çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="2-é…ç½®åŠ è½½é¡ºåºçš„éªŒè¯"&gt;&lt;strong&gt;2. é…ç½®åŠ è½½é¡ºåºçš„éªŒè¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»æ‚¨çš„é…ç½®ç‰‡æ®µå¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;nacos&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;shared-configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-kafka.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…±äº«é…ç½®æ–‡ä»¶ï¼ˆä¼˜å…ˆçº§è¾ƒä½ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared.yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Nacos çš„åŠ è½½é¡ºåºæ˜¯ &lt;strong&gt;å…ˆåŠ è½½å…±äº«é…ç½®ï¼ŒååŠ è½½åº”ç”¨åé…ç½®&lt;/strong&gt;ã€‚ç”±äºååŠ è½½çš„é…ç½®ä¼šè¦†ç›–å…ˆåŠ è½½çš„é…ç½®ï¼Œå› æ­¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;comment-service.yaml&lt;/code&gt;ï¼ˆåº”ç”¨åé…ç½®ï¼‰ä¼šåœ¨ &lt;code&gt;shared-kafka.yaml&lt;/code&gt;ï¼ˆå…±äº«é…ç½®ï¼‰ä¹‹ååŠ è½½ï¼Œå¯¼è‡´å‰è€…çš„é…ç½®é¡¹è¦†ç›–åè€…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-å…¶ä»–å¯èƒ½å½±å“ä¼˜å…ˆçº§çš„å› ç´ "&gt;&lt;strong&gt;3. å…¶ä»–å¯èƒ½å½±å“ä¼˜å…ˆçº§çš„å› ç´ &lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;éœ€è¦é¢å¤–æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å±•é…ç½®ï¼ˆextension-configsï¼‰ä¸å…±äº«é…ç½®çš„ä¼˜å…ˆçº§&lt;/strong&gt;&lt;br&gt;
å¦‚æœé…ç½®ä¸­åŒæ—¶å­˜åœ¨ &lt;code&gt;extension-configs&lt;/code&gt;ï¼Œå…¶ä¼˜å…ˆçº§é«˜äº &lt;code&gt;shared-configs&lt;/code&gt;ã€‚ä½†æ‚¨çš„ç¤ºä¾‹æœªæ¶‰åŠæ‰©å±•é…ç½®ï¼Œå› æ­¤ä¸å½±å“å½“å‰ç»“è®ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬åœ°é…ç½®ä¸è¿œç¨‹é…ç½®çš„ä¼˜å…ˆçº§&lt;/strong&gt;&lt;br&gt;
é»˜è®¤æƒ…å†µä¸‹ï¼ŒNacos è¿œç¨‹é…ç½®ä¼˜å…ˆçº§é«˜äºæœ¬åœ° &lt;code&gt;application.yml&lt;/code&gt;ï¼Œä½†å¯ä»¥é€šè¿‡ &lt;code&gt;spring.cloud.config.override-none=true&lt;/code&gt; å¼ºåˆ¶æœ¬åœ°é…ç½®ä¼˜å…ˆã€‚æ‚¨çš„é…ç½®ä¸­æœªå¯ç”¨æ­¤é€‰é¡¹ï¼Œå› æ­¤è¿œç¨‹é…ç½®ä¼˜å…ˆçº§è§„åˆ™ä»ç„¶æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-7"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼š&lt;code&gt;comment-service.yaml&lt;/code&gt; ä¸­çš„é…ç½®ä¼˜å…ˆçº§é«˜äº &lt;code&gt;shared-kafka.yaml&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šåº”ç”¨åé…ç½®å±äº Nacos ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„é…ç½®æ–‡ä»¶ç±»å‹ï¼Œä¸”åŠ è½½é¡ºåºåœ¨å…±äº«é…ç½®ä¹‹åï¼Œå¯¼è‡´è¦†ç›–ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="elastic-search-with-analysis-lk"&gt;Elastic Search with analysis-lk
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;docker.1ms.run/elasticsearch:8.4.1&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# Set environment variables to avoid interactive prompts during plugin installation&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;ENV&lt;/span&gt; &lt;span class="nv"&gt;ELASTIC_CONTAINER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;ENV&lt;/span&gt; &lt;span class="nv"&gt;ES_JAVA_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;-Xms512m -Xmx512m&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# Install analysis-ik plugin with better error handling&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Installing analysis-ik plugin...&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; bin/elasticsearch-plugin install --batch https://get.infini.cloud/elasticsearch/analysis-ik/8.4.1 &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; &lt;span class="c1"&gt;# Fallback to alternative source if the first one fails&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt; bin/elasticsearch-plugin install --batch analysis-ik --verbose &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; &lt;span class="c1"&gt;# Output helpful error information if both attempts fail&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Plugin installation failed. Check plugin compatibility with Elasticsearch 8.4.1&amp;#34;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; 1&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# Verify plugin installation&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; bin/elasticsearch-plugin list&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="column-é»˜è®¤å€¼"&gt;Column é»˜è®¤å€¼
&lt;/h2&gt;&lt;p&gt;å‡ºç°å­—æ®µä½¿ç”¨&lt;code&gt;@Column(columnDefinition = &amp;quot;bigint default 0&amp;quot;)&lt;/code&gt;æ³¨è§£åä»ä¸ºç©ºçš„æƒ…å†µï¼Œå¯èƒ½æ¶‰åŠä»¥ä¸‹åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-è¡¨ç»“æ„æœªæ­£ç¡®ç”Ÿæˆæˆ–æ›´æ–°"&gt;&lt;strong&gt;1. è¡¨ç»“æ„æœªæ­£ç¡®ç”Ÿæˆæˆ–æ›´æ–°&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼š&lt;code&gt;columnDefinition&lt;/code&gt;ä»…åœ¨é€šè¿‡JPAè‡ªåŠ¨ç”Ÿæˆè¡¨ç»“æ„ï¼ˆDDLï¼‰æ—¶ç”Ÿæ•ˆã€‚å¦‚æœè¡¨å·²å­˜åœ¨ä¸”æœªé‡æ–°åˆ›å»ºï¼Œé»˜è®¤å€¼ä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯æ–¹æ³•&lt;/strong&gt;ï¼šæ‰§è¡Œ&lt;code&gt;SHOW CREATE TABLE&lt;/code&gt;è¯­å¥ï¼Œæ£€æŸ¥å­—æ®µæ˜¯å¦åŒ…å«&lt;code&gt;DEFAULT 0&lt;/code&gt;çš„å®šä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åˆ é™¤æ—§è¡¨å¹¶è®©JPAé‡æ–°ç”Ÿæˆï¼ˆéœ€è°¨æ…æ“ä½œç”Ÿäº§ç¯å¢ƒæ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨æ‰§è¡ŒALTER TABLEè¯­å¥ä¿®æ”¹å­—æ®µé»˜è®¤å€¼ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;ALTER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your_table&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ALTER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;COLUMN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your_column&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DEFAULT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-å­—æ®µå…è®¸nullå€¼"&gt;&lt;strong&gt;2. å­—æ®µå…è®¸NULLå€¼&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šè‹¥å­—æ®µæœªæ˜¾å¼è®¾ç½®ä¸º&lt;code&gt;NOT NULL&lt;/code&gt;ï¼Œå³ä½¿å®šä¹‰äº†é»˜è®¤å€¼ï¼Œæ’å…¥æ•°æ®æ—¶è‹¥æœªæ˜¾å¼èµ‹å€¼ï¼Œæ•°æ®åº“ä»å¯èƒ½å­˜å‚¨NULLè€Œéé»˜è®¤å€¼ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šJPAæ³¨è§£ä¸­ç¼ºå°‘&lt;code&gt;nullable = false&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹æ³¨è§£ä¸ºï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bigint default 0&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;ç¡®ä¿æ•°æ®åº“è¡¨å­—æ®µçš„&lt;code&gt;NULL&lt;/code&gt;çº¦æŸä¸æ³¨è§£ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-æ’å…¥æ“ä½œè¦†ç›–é»˜è®¤å€¼"&gt;&lt;strong&gt;3. æ’å…¥æ“ä½œè¦†ç›–é»˜è®¤å€¼&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šè‹¥åº”ç”¨å±‚ä»£ç åœ¨æ’å…¥æ•°æ®æ—¶ä¸ºè¯¥å­—æ®µæ˜¾å¼èµ‹å€¼ä¸º&lt;code&gt;null&lt;/code&gt;ï¼Œæˆ–æœªè§¦å‘é»˜è®¤å€¼é€»è¾‘ï¼ˆå¦‚ä½¿ç”¨&lt;code&gt;INSERT ... VALUES (NULL)&lt;/code&gt;ï¼‰ï¼Œæ•°æ®åº“ä¼šä¼˜å…ˆé‡‡ç”¨è¾“å…¥å€¼è€Œéé»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥æ’å…¥è¯­å¥æˆ–JPAçš„saveæ“ä½œï¼Œé¿å…æ‰‹åŠ¨è®¾ç½®è¯¥å­—æ®µä¸º&lt;code&gt;null&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å®ä½“ç±»ä¸­ä¸ºå­—æ®µè®¾ç½®åˆå§‹å€¼ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;yourField&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="4-æ•°æ®åº“sqlæ¨¡å¼é™åˆ¶"&gt;&lt;strong&gt;4. æ•°æ®åº“SQLæ¨¡å¼é™åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šMySQLçš„&lt;code&gt;sql_mode&lt;/code&gt;è‹¥åŒ…å«&lt;code&gt;STRICT_TRANS_TABLES&lt;/code&gt;ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæœªæ˜¾å¼èµ‹å€¼çš„éNULLå­—æ®µä¼šæŠ¥é”™è€Œéä½¿ç”¨é»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥å½“å‰SQLæ¨¡å¼ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;@@&lt;/span&gt;&lt;span class="n"&gt;sql_mode&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;è°ƒæ•´SQLæ¨¡å¼æˆ–ç¡®ä¿æ’å…¥æ“ä½œæä¾›å­—æ®µå€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="5-jpaå®ç°ä¸æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜"&gt;&lt;strong&gt;5. JPAå®ç°ä¸æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šæŸäº›JPAå®ç°ï¼ˆå¦‚Hibernateï¼‰å¯èƒ½å¿½ç•¥&lt;code&gt;columnDefinition&lt;/code&gt;ä¸­çš„é»˜è®¤å€¼ï¼Œå°¤å…¶åœ¨å¤æ‚æ˜ å°„åœºæ™¯ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç»“åˆ&lt;code&gt;@PrePersist&lt;/code&gt;æ³¨è§£åœ¨æ•°æ®æŒä¹…åŒ–å‰è®¾ç½®é»˜è®¤å€¼ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PrePersist&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;prePersist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yourField&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;yourField&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“æ­¥éª¤æ’æŸ¥"&gt;&lt;strong&gt;æ€»ç»“æ­¥éª¤æ’æŸ¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥è¡¨ç»“æ„&lt;/strong&gt;ï¼šç¡®è®¤å­—æ®µæ˜¯å¦åŒ…å«&lt;code&gt;DEFAULT 0&lt;/code&gt;å’Œ&lt;code&gt;NOT NULL&lt;/code&gt;çº¦æŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯æ’å…¥è¡Œä¸º&lt;/strong&gt;ï¼šé€šè¿‡æ—¥å¿—æŸ¥çœ‹å®é™…æ‰§è¡Œçš„SQLè¯­å¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ä½“ç±»åˆå§‹åŒ–&lt;/strong&gt;ï¼šåœ¨Javaå­—æ®µä¸­è®¾ç½®é»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒæ•´æ•°æ®åº“é…ç½®&lt;/strong&gt;ï¼šç¡®ä¿SQLæ¨¡å¼å’Œè¡¨çº¦æŸç¬¦åˆé¢„æœŸã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è‹¥ä»æ— æ³•è§£å†³ï¼Œå»ºè®®ç»“åˆæ•°æ®åº“æ—¥å¿—ä¸åº”ç”¨å±‚è°ƒè¯•è¿›ä¸€æ­¥å®šä½å…·ä½“è¦†ç›–é»˜è®¤å€¼çš„æ“ä½œæ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2 id="count-å¼‚å¸¸"&gt;Count å¼‚å¸¸
&lt;/h2&gt;&lt;p&gt;é’ˆå¯¹æ‚¨é‡åˆ°çš„ &lt;code&gt;DataIntegrityViolationException: not-null property references a null or transient value&lt;/code&gt; å¼‚å¸¸ï¼Œç»“åˆä»£ç å’Œé”™è¯¯ä¿¡æ¯ï¼Œä»¥ä¸‹æ˜¯å…·ä½“åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸå› åˆ†æ"&gt;&lt;strong&gt;åŸå› åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µæœªåˆå§‹åŒ–&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;User&lt;/code&gt; å®ä½“ç±»ä¸­çš„ &lt;code&gt;commentCount&lt;/code&gt; å­—æ®µè¢«å£°æ˜ä¸º &lt;code&gt;@Column(nullable = false)&lt;/code&gt;ï¼Œä½†è‹¥åœ¨åˆ›å»ºå¯¹è±¡æ—¶æœªæ˜¾å¼èµ‹å€¼ï¼ŒHibernate ä¼šå°è¯•å°† &lt;code&gt;null&lt;/code&gt; æ’å…¥æ•°æ®åº“çš„éç©ºåˆ—ï¼Œå¯¼è‡´å¼‚å¸¸ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç é—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æœªè®¾ç½® commentCount å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// commentCount ä¸º nullï¼Œè§¦å‘å¼‚å¸¸&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åº“é»˜è®¤å€¼æœªç”Ÿæ•ˆ&lt;/strong&gt;&lt;br&gt;
è™½ç„¶ &lt;code&gt;columnDefinition = &amp;quot;bigint default 0&amp;quot;&lt;/code&gt; å®šä¹‰äº†æ•°æ®åº“é»˜è®¤å€¼ï¼Œä½† Hibernate ç”Ÿæˆçš„ SQL è¯­å¥ä¼šæ˜¾å¼æ’å…¥ &lt;code&gt;commentCount&lt;/code&gt; å­—æ®µçš„å€¼ã€‚è‹¥å®ä½“å¯¹è±¡ä¸­è¯¥å­—æ®µä¸º &lt;code&gt;null&lt;/code&gt;ï¼ŒINSERT è¯­å¥ä¼šå°è¯•æ’å…¥ &lt;code&gt;null&lt;/code&gt;ï¼Œè¦†ç›–æ•°æ®åº“é»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µç±»å‹å†²çª&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;Long&lt;/code&gt; ç±»å‹ï¼ˆå¯ä¸º null çš„åŒ…è£…ç±»å‹ï¼‰ä½†æœªæ­£ç¡®å¤„ç†é»˜è®¤å€¼é€»è¾‘ï¼Œå¯¼è‡´å®ä½“å±‚ä¸æ•°æ®åº“çº¦æŸå†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆ-1"&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ˜¾å¼åˆå§‹åŒ–å­—æ®µå€¼"&gt;&lt;strong&gt;æ˜¾å¼åˆå§‹åŒ–å­—æ®µå€¼&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨å®ä½“ç±»ä¸­ä¸º &lt;code&gt;commentCount&lt;/code&gt; è®¾ç½®é»˜è®¤å€¼ï¼Œæˆ–åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bigint default 0&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´æ¥åˆå§‹åŒ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;User&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å¯ç”¨åŠ¨æ€-insert"&gt;&lt;strong&gt;å¯ç”¨åŠ¨æ€ INSERT&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;@DynamicInsert&lt;/code&gt; æ³¨è§£ï¼Œä½¿ Hibernate ä»…æ’å…¥éç©ºå­—æ®µã€‚è‹¥ &lt;code&gt;commentCount&lt;/code&gt; ä¸º &lt;code&gt;null&lt;/code&gt;ï¼ŒINSERT è¯­å¥å°†å¿½ç•¥è¯¥å­—æ®µï¼Œæ•°æ®åº“è‡ªåŠ¨åº”ç”¨é»˜è®¤å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DynamicInsert&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bigint default 0&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="éªŒè¯æ•°æ®åº“è¡¨ç»“æ„"&gt;&lt;strong&gt;éªŒè¯æ•°æ®åº“è¡¨ç»“æ„&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç¡®ä¿æ•°æ®åº“è¡¨çš„ &lt;code&gt;commentCount&lt;/code&gt; åˆ—ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NOT NULL&lt;/code&gt; çº¦æŸå·²å¯ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;é»˜è®¤å€¼ &lt;code&gt;0&lt;/code&gt; å·²æ­£ç¡®è®¾ç½®ã€‚&lt;br&gt;
å¯é€šè¿‡ SQL æ£€æŸ¥ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SHOW&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‹¥è¡¨ç»“æ„ä¸å®ä½“ç±»æ³¨è§£ä¸ä¸€è‡´ï¼Œéœ€æ‰‹åŠ¨ä¿®æ”¹è¡¨ç»“æ„æˆ–åŒæ­¥å®ä½“ç±»é…ç½®ã€‚&lt;/p&gt;
&lt;h4 id="ä½¿ç”¨åŒ…è£…ç±»å‹å¹¶å¤„ç†-null-å€¼"&gt;&lt;strong&gt;ä½¿ç”¨åŒ…è£…ç±»å‹å¹¶å¤„ç† null å€¼&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è™½ç„¶ &lt;code&gt;Long&lt;/code&gt; æ˜¯åŒ…è£…ç±»å‹ï¼Œä»éœ€ç¡®ä¿ä¸šåŠ¡é€»è¾‘ä¸­é¿å… &lt;code&gt;null&lt;/code&gt; å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setCommentCount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ’æŸ¥å…¶ä»–ä¾èµ–é¡¹"&gt;&lt;strong&gt;æ’æŸ¥å…¶ä»–ä¾èµ–é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥ &lt;code&gt;commentCount&lt;/code&gt; æ˜¯å…³è”å­—æ®µï¼ˆå¦‚é€šè¿‡å¤–é”®è®¡ç®—ï¼‰ï¼Œéœ€æ£€æŸ¥å…³è”å®ä½“æ˜¯å¦å·²æŒä¹…åŒ–ã€‚è‹¥ä¸ºçº§è”æ“ä½œï¼Œéœ€ç¡®ä¿å…³è”å¯¹è±¡å·²æ­£ç¡®ä¿å­˜ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="éªŒè¯ä¸è°ƒè¯•"&gt;&lt;strong&gt;éªŒè¯ä¸è°ƒè¯•&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—æ£€æŸ¥&lt;/strong&gt;&lt;br&gt;
å¯ç”¨ Hibernate SQL æ—¥å¿—ï¼Œç¡®è®¤ INSERT è¯­å¥ä¸­çš„ &lt;code&gt;commentCount&lt;/code&gt; å€¼æ˜¯å¦ä¸ºéç©ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.jpa.show-sql&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.jpa.properties.hibernate.format_sql&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•å…ƒæµ‹è¯•&lt;/strong&gt;&lt;br&gt;
ç¼–å†™æµ‹è¯•ç”¨ä¾‹è¦†ç›– &lt;code&gt;commentCount&lt;/code&gt; ä¸º null çš„ä¿å­˜åœºæ™¯ï¼ŒéªŒè¯å¼‚å¸¸æ˜¯å¦è¢«æ­£ç¡®å¤„ç†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;expected&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataIntegrityViolationException&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;testSaveUserWithNullCommentCount&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCommentCount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼ºåˆ¶è§¦å‘å¼‚å¸¸&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-8"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ­¤å¼‚å¸¸çš„æ ¸å¿ƒçŸ›ç›¾åœ¨äº &lt;strong&gt;å®ä½“å±‚ä¸æ•°æ®åº“å±‚çš„éç©ºçº¦æŸå†²çª&lt;/strong&gt;ã€‚é€šè¿‡æ˜¾å¼åˆå§‹åŒ–å­—æ®µã€å¯ç”¨åŠ¨æ€ INSERT æˆ–è°ƒæ•´æ•°æ®åº“é»˜è®¤å€¼ï¼Œå¯ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚è‹¥éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ç»“åˆ &lt;code&gt;@PrePersist&lt;/code&gt; æ³¨è§£åœ¨ä¿å­˜å‰æ ¡éªŒå­—æ®µå€¼ã€‚&lt;/p&gt;
&lt;h2 id="è§£å†³æ–¹æ³•"&gt;è§£å†³æ–¹æ³•
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PrePersist&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;prePersist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;positiveCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;positiveCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;negativeCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;negativeCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="openfeign-å¼‚æ­¥"&gt;OpenFeign å¼‚æ­¥
&lt;/h2&gt;&lt;p&gt;åœ¨ OpenFeign ä¸­ï¼Œå½“ FeignClient æ¥å£çš„æ–¹æ³•å®šä¹‰ä¸º &lt;code&gt;CompletableFuture&amp;lt;T&amp;gt;&lt;/code&gt; æ—¶ï¼Œ&lt;strong&gt;æœåŠ¡æä¾›æ–¹çš„ Controller æ–¹æ³•æ— éœ€è¿”å› &lt;code&gt;CompletableFuture&lt;/code&gt;&lt;/strong&gt;ã€‚OpenFeign ä¼šè‡ªåŠ¨å°†åŒæ­¥çš„ HTTP è°ƒç”¨å°è£…ä¸ºå¼‚æ­¥æ“ä½œï¼Œå¹¶å°†ç»“æœåŒ…è£…åˆ° &lt;code&gt;CompletableFuture&lt;/code&gt; ä¸­è¿”å›ç»™è°ƒç”¨æ–¹ã€‚ä»¥ä¸‹æ˜¯å…·ä½“æœºåˆ¶å’Œå®ç°ç»†èŠ‚ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæœºåˆ¶"&gt;æ ¸å¿ƒæœºåˆ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯å¼‚æ­¥å°è£…&lt;/strong&gt;&lt;br&gt;
OpenFeign çš„å¼‚æ­¥èƒ½åŠ›ä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸºäº &lt;code&gt;CompletableFuture&lt;/code&gt; çš„æ¥å£å®šä¹‰&lt;/strong&gt;&lt;br&gt;
å½“ FeignClient æ¥å£æ–¹æ³•å£°æ˜è¿”å›ç±»å‹ä¸º &lt;code&gt;CompletableFuture&amp;lt;T&amp;gt;&lt;/code&gt; æ—¶ï¼ŒOpenFeign ä¼šä½¿ç”¨å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼ˆå¦‚ Apache HttpClient æˆ– OkHttpï¼‰å‘èµ·éé˜»å¡è¯·æ±‚ï¼Œå¹¶è‡ªåŠ¨å°†æœåŠ¡ç«¯çš„åŒæ­¥å“åº”ç»“æœå°è£…åˆ° &lt;code&gt;CompletableFuture&lt;/code&gt; ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;@Async&lt;/code&gt; æ³¨è§£&lt;/strong&gt;&lt;br&gt;
è‹¥å®¢æˆ·ç«¯é€šè¿‡ &lt;code&gt;@Async&lt;/code&gt; æ³¨è§£æ ‡è®°æ–¹æ³•ï¼Œåˆ™ Spring ä¼šé€šè¿‡çº¿ç¨‹æ± æ‰§è¡Œ Feign è°ƒç”¨ï¼Œè¿›ä¸€æ­¥å®ç°å¼‚æ­¥åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç«¯æ— æ„ŸçŸ¥&lt;/strong&gt;&lt;br&gt;
æœåŠ¡æä¾›æ–¹çš„ Controller æ–¹æ³•ä»å¯ä¿æŒ&lt;strong&gt;åŒæ­¥è¿”å›æ™®é€šå¯¹è±¡&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;String&lt;/code&gt; æˆ– &lt;code&gt;DTO&lt;/code&gt;ï¼‰ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡ç«¯ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DeviceController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒæ­¥æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;result&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;OpenFeign å®¢æˆ·ç«¯ä¼šå¼‚æ­¥è°ƒç”¨æ­¤æ¥å£ï¼Œå¹¶å°†è¿”å›çš„å­—ç¬¦ä¸² &lt;code&gt;&amp;quot;result&amp;quot;&lt;/code&gt; å°è£…åˆ° &lt;code&gt;CompletableFuture&amp;lt;String&amp;gt;&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æ­¥éª¤ä¸é…ç½®"&gt;å®ç°æ­¥éª¤ä¸é…ç½®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯å®šä¹‰å¼‚æ­¥æ¥å£&lt;/strong&gt;&lt;br&gt;
FeignClient æ¥å£éœ€ç›´æ¥å£°æ˜ &lt;code&gt;CompletableFuture&lt;/code&gt; ä½œä¸ºè¿”å›ç±»å‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;service-provider&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;DeviceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getDataAsync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨å¼‚æ­¥æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–é…ç½®&lt;/strong&gt;ï¼šç¡®ä¿é¡¹ç›®ä¸­åŒ…å«æ”¯æŒå¼‚æ­¥è°ƒç”¨çš„ HTTP å®¢æˆ·ç«¯ä¾èµ–ï¼ˆå¦‚ Apache HttpClient æˆ– OkHttpï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼–ç å™¨/è§£ç å™¨&lt;/strong&gt;ï¼šéœ€æ­£ç¡®é…ç½®å¼‚æ­¥ç¼–è§£ç å™¨ï¼Œä»¥å¤„ç†å“åº”ç»“æœçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒç”¨ä¸ç»“æœå¤„ç†&lt;/strong&gt;&lt;br&gt;
å®¢æˆ·ç«¯å¯é€šè¿‡ &lt;code&gt;CompletableFuture&lt;/code&gt; çš„å›è°ƒæœºåˆ¶å¤„ç†ç»“æœï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ClientService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DeviceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deviceClient&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fetchData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deviceClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDataAsync&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenAccept&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Result: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exceptionally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* å¼‚å¸¸å¤„ç† */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-3"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç«¯æ— éœ€ä¿®æ”¹&lt;/strong&gt;&lt;br&gt;
æœåŠ¡æä¾›æ–¹çš„ Controller ä¿æŒåŒæ­¥é€»è¾‘å³å¯ï¼ŒOpenFeign çš„å¼‚æ­¥å°è£…å¯¹æœåŠ¡ç«¯é€æ˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯é…ç½®è¦æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹æ± ç®¡ç†&lt;/strong&gt;ï¼šè‹¥ç»“åˆ &lt;code&gt;@Async&lt;/code&gt; æ³¨è§£ï¼Œéœ€è‡ªå®šä¹‰çº¿ç¨‹æ± ä»¥é¿å…é»˜è®¤çº¿ç¨‹æ± èµ„æºè€—å°½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šå¼‚æ­¥è°ƒç”¨éœ€é€šè¿‡ &lt;code&gt;exceptionally&lt;/code&gt; æˆ– &lt;code&gt;handle&lt;/code&gt; æ–¹æ³•æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢æœªå¤„ç†å¼‚å¸¸å¯¼è‡´ä»»åŠ¡ä¸­æ–­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡è°ƒç”¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;CompletableFuture&lt;/code&gt; çš„ &lt;code&gt;allOf()&lt;/code&gt; æˆ– &lt;code&gt;thenCombine()&lt;/code&gt; å®ç°å¹¶è¡Œè¯·æ±‚ï¼Œæå‡ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…æ—¶æ§åˆ¶&lt;/strong&gt;ï¼šä¸ºå¼‚æ­¥è°ƒç”¨è®¾ç½®è¶…æ—¶é˜ˆå€¼ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹åœºæ™¯"&gt;ç¤ºä¾‹åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æœåŠ¡ç«¯&lt;/strong&gt;ï¼ˆåŒæ­¥å“åº”ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ExampleController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/api/example&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;example&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Hello from service!&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯&lt;/strong&gt;ï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;example-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;configuration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AsyncFeignConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;ExampleClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/api/example&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getExampleAsync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// é…ç½®ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableAsync&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AsyncFeignConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;asyncExecutor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setCorePoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setMaxPoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;50&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-9"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;OpenFeign çš„å¼‚æ­¥è°ƒç”¨æœºåˆ¶å°†åŒæ­¥çš„ HTTP è¯·æ±‚è½¬æ¢ä¸ºéé˜»å¡æ“ä½œï¼ŒæœåŠ¡ç«¯æ— éœ€è¿”å› &lt;code&gt;CompletableFuture&lt;/code&gt;ã€‚é€šè¿‡å®¢æˆ·ç«¯æ¥å£å®šä¹‰å’Œé…ç½®ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»å®ç°é«˜æ€§èƒ½çš„å¼‚æ­¥é€šä¿¡ï¼ŒåŒæ—¶ä¿æŒæœåŠ¡ç«¯é€»è¾‘çš„ç®€æ´æ€§ã€‚&lt;/p&gt;
&lt;h2 id="pageååºåˆ—åŒ–"&gt;Pageååºåˆ—åŒ–
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PageableAdapter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;PageableAdapter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;unsorted&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonCreator&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;PageableAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;pageNumber&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageNumber&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;pageSize&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageSize&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SortAdapter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pageNumber&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageSize&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;unsorted&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SortAdapter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SortAdapter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonCreator&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SortAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;empty&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;empty&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;unsorted&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unsorted&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;sorted&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PageAdapter&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageImpl&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;PageAdapter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonCreator&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;PageAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;pageable&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageableAdapter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;totalElements&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="å®šæ—¶ä»»åŠ¡"&gt;å®šæ—¶ä»»åŠ¡
&lt;/h2&gt;&lt;p&gt;æ ¹æ®æä¾›çš„ä»£ç å’Œæœç´¢å†…å®¹ï¼Œä»¥ä¸‹æ˜¯å¯èƒ½å¯¼è‡´å®šæ—¶ä»»åŠ¡æœªæ‰§è¡Œçš„åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºç¡€é…ç½®æ£€æŸ¥"&gt;åŸºç¡€é…ç½®æ£€æŸ¥
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœªå¯ç”¨å®šæ—¶ä»»åŠ¡åŠŸèƒ½&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿å¯åŠ¨ç±»ä¸Šæœ‰ &lt;code&gt;@EnableScheduling&lt;/code&gt; æ³¨è§£ã€‚è¿™æ˜¯ Spring å®šæ—¶ä»»åŠ¡ç”Ÿæ•ˆçš„å‰ææ¡ä»¶ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableScheduling&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¿…é¡»æ·»åŠ æ­¤æ³¨è§£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Application&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„ä»¶æ‰«æé—®é¢˜&lt;/strong&gt;&lt;br&gt;
å®šæ—¶ä»»åŠ¡ç±»éœ€è¢« Spring ç®¡ç†ï¼Œä¾‹å¦‚æ·»åŠ  &lt;code&gt;@Component&lt;/code&gt;ã€&lt;code&gt;@Service&lt;/code&gt; ç­‰æ³¨è§£ï¼Œå¹¶ç¡®ä¿æ‰€åœ¨åŒ…åœ¨ç»„ä»¶æ‰«æèŒƒå›´å†…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="cron-è¡¨è¾¾å¼ä¸çº¿ç¨‹æ± é—®é¢˜"&gt;Cron è¡¨è¾¾å¼ä¸çº¿ç¨‹æ± é—®é¢˜
&lt;/h3&gt;&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Cron è¡¨è¾¾å¼è§£æé”™è¯¯&lt;/strong&gt;&lt;br&gt;
ä»£ç ä¸­çš„ &lt;code&gt;&amp;quot;0 * * * * *&amp;quot;&lt;/code&gt; è¡¨ç¤ºæ¯åˆ†é’Ÿçš„ &lt;strong&gt;ç¬¬0ç§’&lt;/strong&gt; æ‰§è¡Œä¸€æ¬¡ï¼ˆå³æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚éœ€ç¡®è®¤æ˜¯å¦ç¬¦åˆé¢„æœŸé€»è¾‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ½œåœ¨é—®é¢˜&lt;/strong&gt;ï¼šè‹¥æœåŠ¡å™¨æ—¶åŒºä¸ä¸šåŠ¡æ—¶åŒºä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´è§¦å‘æ—¶é—´åç§»ã€‚å¯é€šè¿‡ &lt;code&gt;zone&lt;/code&gt; å±æ€§æŒ‡å®šæ—¶åŒºï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Scheduled&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;0 * * * * *&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;zone&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Asia/Shanghai&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ± é˜»å¡&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;ç°è±¡&lt;/strong&gt;ï¼šè‹¥å…¶ä»–å®šæ—¶ä»»åŠ¡è€—æ—¶è¿‡é•¿æˆ–é˜»å¡çº¿ç¨‹ï¼Œå•çº¿ç¨‹æ± ä¼šå¯¼è‡´åç»­ä»»åŠ¡æ— æ³•æ‰§è¡Œã€‚&lt;br&gt;
&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®å¤šçº¿ç¨‹æ± ï¼Œé¿å…ä»»åŠ¡é˜»å¡ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SchedulerConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SchedulingConfigurer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;configureTasks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ScheduledTaskRegistrar&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registrar&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registrar&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setScheduler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Executors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newScheduledThreadPool&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;æˆ–åœ¨ &lt;code&gt;application.properties&lt;/code&gt; ä¸­é…ç½®ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.task.scheduling.pool.size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä»»åŠ¡é€»è¾‘ä¸å¼‚å¸¸å¤„ç†"&gt;ä»»åŠ¡é€»è¾‘ä¸å¼‚å¸¸å¤„ç†
&lt;/h3&gt;&lt;ol start="5"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœªæ•è·çš„å¼‚å¸¸&lt;/strong&gt;&lt;br&gt;
è‹¥ &lt;code&gt;redisService.sendOpinionMessage()&lt;/code&gt; æŠ›å‡ºå¼‚å¸¸ä¸”æœªè¢«æ•è·ï¼Œä»»åŠ¡ä¼šç»ˆæ­¢åç»­æ‰§è¡Œã€‚&lt;br&gt;
&lt;strong&gt;ä¿®å¤æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Scheduled&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cron&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;0 * * * * *&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;opinionMessageSender&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Scheduled task in post&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sendOpinionMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;batchMessageSender&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;po_aggregation:*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ä»»åŠ¡æ‰§è¡Œå¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥æ–¹æ³•å†²çª&lt;/strong&gt;&lt;br&gt;
è‹¥æ–¹æ³•ä¸ŠåŒæ—¶æ ‡æ³¨ &lt;code&gt;@Async&lt;/code&gt; ä½†æœªé…ç½®å¼‚æ­¥çº¿ç¨‹æ± ï¼Œå¯èƒ½å¯¼è‡´ä»»åŠ¡æœªæ‰§è¡Œã€‚éœ€æ£€æŸ¥æ˜¯å¦è¯¯ç”¨å¼‚æ­¥æ³¨è§£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç³»ç»Ÿä¸ç¯å¢ƒå› ç´ "&gt;ç³»ç»Ÿä¸ç¯å¢ƒå› ç´ 
&lt;/h3&gt;&lt;ol start="7"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å™¨æ—¶é—´å˜æ›´&lt;/strong&gt;&lt;br&gt;
ä¿®æ”¹ç³»ç»Ÿæ—¶é—´åï¼ŒSpring å®šæ—¶ä»»åŠ¡å¯èƒ½å¤±æ•ˆï¼Œéœ€é‡å¯åº”ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—ä¸è°ƒè¯•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥åº”ç”¨æ—¥å¿—ä¸­æ˜¯å¦æœ‰ &lt;code&gt;Scheduled task in post&lt;/code&gt; è¾“å‡ºï¼Œç¡®è®¤ä»»åŠ¡æ˜¯å¦çœŸæ­£è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨ Spring è°ƒåº¦æ—¥å¿—ä»¥è§‚å¯Ÿä»»åŠ¡æ³¨å†Œå’Œæ‰§è¡ŒçŠ¶æ€ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;logging.level.org.springframework.scheduling&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;DEBUG&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é«˜çº§æ’æŸ¥å·¥å…·"&gt;é«˜çº§æ’æŸ¥å·¥å…·
&lt;/h3&gt;&lt;ol start="9"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹å·²æ³¨å†Œä»»åŠ¡&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ Actuator ç«¯ç‚¹æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æˆåŠŸæ³¨å†Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;management.endpoints.web.exposure.include&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;scheduledtasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—® &lt;code&gt;http://localhost:8080/actuator/scheduledtasks&lt;/code&gt; æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹å †æ ˆåˆ†æ&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;jstack &amp;lt;pid&amp;gt; | grep 'scheduling'&lt;/code&gt; æ£€æŸ¥è°ƒåº¦çº¿ç¨‹çŠ¶æ€ï¼Œç¡®è®¤æ˜¯å¦é˜»å¡æˆ–ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å»ºè®®"&gt;æ€»ç»“å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŒ‰ä¼˜å…ˆçº§æ’æŸ¥&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å…ˆæ£€æŸ¥ &lt;code&gt;@EnableScheduling&lt;/code&gt; å’Œç»„ä»¶æ‰«æ â†’ éªŒè¯ Cron è¡¨è¾¾å¼ â†’ å¢åŠ å¼‚å¸¸æ•è· â†’ é…ç½®å¤šçº¿ç¨‹æ± ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ä»ä¸ç”Ÿæ•ˆï¼Œé€šè¿‡è°ƒè¯•æ—¥å¿—æˆ– Actuator ç«¯ç‚¹æ·±å…¥åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼ç¯å¢ƒæ³¨æ„&lt;/strong&gt;ï¼š&lt;br&gt;
å¦‚æœæ˜¯å¤šå®ä¾‹éƒ¨ç½²ï¼Œéœ€ç»“åˆ Redis åˆ†å¸ƒå¼é”é¿å…é‡å¤æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="nginx"&gt;Nginx
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­&lt;strong&gt;å³ä½¿å­˜åœ¨APIç½‘å…³ï¼ˆå¦‚Spring Cloud Gatewayï¼‰ï¼Œé€šå¸¸ä»éœ€è¦éƒ¨ç½²Nginxæ¥æ‰˜ç®¡å‰ç«¯èµ„æº&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æåŠä¾æ®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="nginxçš„æ ¸å¿ƒä½œç”¨ä¸ç½‘å…³çš„åˆ†å·¥"&gt;Nginxçš„æ ¸å¿ƒä½œç”¨ä¸ç½‘å…³çš„åˆ†å·¥
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™æ€èµ„æºæ‰˜ç®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰ç«¯èµ„æºï¼ˆå¦‚HTML/CSS/JSæ–‡ä»¶ï¼‰éœ€è¦é«˜æ€§èƒ½æœåŠ¡å™¨åˆ†å‘ï¼Œè€Œ&lt;strong&gt;Nginxçš„é™æ€æ–‡ä»¶å¤„ç†æ•ˆç‡ï¼ˆä¸‡çº§QPSï¼‰è¿œé«˜äºSpring Cloud Gateway&lt;/strong&gt;ï¼ˆåŸºäºJavaçš„ç½‘å…³ï¼Œé€‚åˆåŠ¨æ€è¯·æ±‚å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒNginxå¯é€šè¿‡&lt;code&gt;gzipå‹ç¼©&lt;/code&gt;ã€&lt;code&gt;ç¼“å­˜æ§åˆ¶&lt;/code&gt;ï¼ˆå¦‚&lt;code&gt;expires 7d&lt;/code&gt;ï¼‰ä¼˜åŒ–åŠ è½½é€Ÿåº¦ï¼Œè€Œç½‘å…³æ— æ³•ç›´æ¥æ‰˜ç®¡é™æ€æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SSLç»ˆæ­¢ä¸å®‰å…¨å±‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginxå¸¸ä½œä¸ºè¾¹ç¼˜æœåŠ¡å™¨å¤„ç†HTTPSè¯ä¹¦å¸è½½ï¼Œå‡è½»ç½‘å…³çš„è®¡ç®—å‹åŠ›ã€‚ä¾‹å¦‚ï¼Œé…ç½®SSLè¯ä¹¦å’Œå¼ºåˆ¶HTTPé‡å®šå‘è‡³HTTPSæ—¶ï¼ŒNginxæ›´é«˜æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¥å£è´Ÿè½½å‡è¡¡ä¸é«˜å¹¶å‘é˜²æŠ¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ç½‘å…³é›†ç¾¤å­˜åœ¨å¤šä¸ªå®ä¾‹ï¼ŒNginxå¯ä½œä¸ºç¬¬ä¸€å±‚è´Ÿè½½å‡è¡¡å™¨åˆ†å‘è¯·æ±‚ï¼Œå¹¶é€šè¿‡é™æµï¼ˆå¦‚&lt;code&gt;limit_req_zone&lt;/code&gt;ï¼‰æ‹¦æˆªçªå‘æµé‡ï¼ˆæ”¯æŒ5ä¸‡+ QPSï¼‰ï¼Œè€Œç½‘å…³çš„é™æµèƒ½åŠ›ï¼ˆçº¦1ä¸‡ QPSï¼‰æ›´é€‚åˆä¸šåŠ¡é€»è¾‘å±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¯çœç•¥nginxçš„åœºæ™¯"&gt;å¯çœç•¥Nginxçš„åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‘æœåŠ¡æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨äº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚AWS ALBã€é˜¿é‡Œäº‘SLBï¼‰ç›´æ¥æ‰˜ç®¡é™æ€èµ„æºå¹¶å¤„ç†SSLï¼Œæ­¤æ—¶å¯çœå»è‡ªå»ºNginxã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼€å‘ç¯å¢ƒç®€åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘é˜¶æ®µå¯é€šè¿‡Webpack Dev Serverç­‰å·¥å…·ä»£ç†å‰ç«¯è¯·æ±‚ï¼Œæ— éœ€Nginxéƒ¨ç½²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kubernetesç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡Ingress Controllerï¼ˆå¦‚Nginx Ingressï¼‰ç»Ÿä¸€ç®¡ç†æµé‡ï¼ŒåŒæ—¶å¤„ç†é™æ€èµ„æºå’ŒAPIè·¯ç”±ï¼Œå‡å°‘ç‹¬ç«‹Nginxçš„éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹éƒ¨ç½²æ¶æ„"&gt;å…¸å‹éƒ¨ç½²æ¶æ„
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;å®¢æˆ·ç«¯ â†’ Nginxï¼ˆé™æ€èµ„æº/SSLç»ˆæ­¢ï¼‰ â†’ APIç½‘å…³ï¼ˆåŠ¨æ€è·¯ç”±ï¼‰ â†’ å¾®æœåŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å·¥æ˜ç¡®&lt;/strong&gt;ï¼šNginxå¤„ç†é™æ€æ–‡ä»¶ã€SSLã€å…¥å£è´Ÿè½½å‡è¡¡ï¼›ç½‘å…³ä¸“æ³¨é‰´æƒã€åŠ¨æ€è·¯ç”±ã€ç†”æ–­é™æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šNginxç¼“å­˜é™æ€å†…å®¹ï¼ˆå¦‚é…ç½®&lt;code&gt;proxy_cache_path&lt;/code&gt;ï¼‰ï¼Œç½‘å…³é€šè¿‡Hystrixæˆ–Sentinelå®ç°æœåŠ¡çº§å®¹é”™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å†³ç­–å»ºè®®"&gt;å†³ç­–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¿…é€‰Nginxçš„åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€é«˜æ•ˆæ‰˜ç®¡å‰ç«¯é™æ€èµ„æºï¼ˆå¦‚React/Vueç¼–è¯‘äº§ç‰©ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªå»ºç¯å¢ƒä¸­éœ€ç»Ÿä¸€ç®¡ç†SSLè¯ä¹¦æˆ–å®ç°å¤šå±‚çº§è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;é«˜å¹¶å‘åœºæ™¯éœ€ç¬¬ä¸€é“æµé‡é˜²çº¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯é€‰æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‘æœåŠ¡LB + ç½‘å…³ç»„åˆï¼Œæˆ–K8s Ingressé›†æˆé™æ€èµ„æºæ‰˜ç®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œ&lt;strong&gt;Nginxä¸APIç½‘å…³åœ¨å¾®æœåŠ¡æ¶æ„ä¸­æ˜¯äº’è¡¥å…³ç³»&lt;/strong&gt;ï¼Œå‰è€…è´Ÿè´£é™æ€å†…å®¹ä¸ç½‘ç»œå±‚ä¼˜åŒ–ï¼Œåè€…ä¸“æ³¨ä¸šåŠ¡é€»è¾‘è·¯ç”±ã€‚å®é™…éƒ¨ç½²éœ€æ ¹æ®æ€§èƒ½éœ€æ±‚ã€ç¯å¢ƒå¤æ‚åº¦åŠè¿ç»´æˆæœ¬ç»¼åˆåˆ¤æ–­ã€‚&lt;/p&gt;
&lt;p&gt;GitHub Actions
GitHub Actions æ”¯æŒå¤šç§æ‰‹åŠ¨è§¦å‘æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦çš„å®ç°æ–¹æ³•åŠæ“ä½œæŒ‡å—ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡-github-ui-æ‰‹åŠ¨è§¦å‘"&gt;é€šè¿‡ GitHub UI æ‰‹åŠ¨è§¦å‘
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ“ä½œè·¯å¾„&lt;/strong&gt;&lt;br&gt;
è¿›å…¥ä»“åº“ â†’ Actions æ ‡ç­¾é¡µ â†’ é€‰æ‹©ç›®æ ‡ Workflow â†’ ç‚¹å‡» &lt;strong&gt;Run workflow&lt;/strong&gt; æŒ‰é’® â†’ é€‰æ‹©åˆ†æ”¯å’Œè¾“å…¥å‚æ•°ï¼ˆè‹¥æœ‰ï¼‰â†’ ç¡®è®¤æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¿«é€Ÿæµ‹è¯•ã€ä¸´æ—¶æ„å»ºæˆ–å‚æ•°åŒ–æµç¨‹ï¼ˆå¦‚è¾“å…¥ç‰ˆæœ¬å·ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™åˆ¶æ¡ä»¶&lt;/strong&gt;&lt;br&gt;
Workflow æ–‡ä»¶éœ€é…ç½® &lt;code&gt;workflow_dispatch&lt;/code&gt; äº‹ä»¶ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;workflow_dispatch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;inputs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Release version&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;required&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡å‘½ä»¤è¡Œå·¥å…·è§¦å‘"&gt;é€šè¿‡å‘½ä»¤è¡Œå·¥å…·è§¦å‘
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;GitHub CLI å‘½ä»¤&lt;/strong&gt;&lt;br&gt;
å®‰è£… GitHub CLI (&lt;code&gt;gh&lt;/code&gt;) åæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;gh workflow run &amp;lt;workflow-name&amp;gt; --ref &amp;lt;branch&amp;gt; --field &amp;lt;key&amp;gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;value&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ï¼š&lt;code&gt;gh workflow run build.yml --ref main --field env=prod&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé€‚åˆæœ¬åœ°å¼€å‘ç¯å¢ƒé›†æˆæˆ–è„šæœ¬è°ƒç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡-api-è¿œç¨‹è§¦å‘"&gt;é€šè¿‡ API è¿œç¨‹è§¦å‘
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;API è¯·æ±‚æ ¼å¼&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;repository_dispatch&lt;/code&gt; äº‹ä»¶ï¼Œå‘ GitHub API å‘é€ POST è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X POST https://api.github.com/repos/&lt;span class="o"&gt;{&lt;/span&gt;owner&lt;span class="o"&gt;}&lt;/span&gt;/&lt;span class="o"&gt;{&lt;/span&gt;repo&lt;span class="o"&gt;}&lt;/span&gt;/dispatches &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Authorization: token {TOKEN}&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Accept: application/vnd.github.everest-preview+json&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --data &lt;span class="s1"&gt;&amp;#39;{&amp;#34;event_type&amp;#34;: &amp;#34;custom_event&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å‚æ•°è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;{TOKEN}&lt;/code&gt;ï¼šéœ€å…·å¤‡ &lt;code&gt;repo&lt;/code&gt; æƒé™çš„ Personal Access Tokenã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;event_type&lt;/code&gt;ï¼šè‡ªå®šä¹‰äº‹ä»¶åï¼Œéœ€åœ¨ Workflow ä¸­é€šè¿‡ &lt;code&gt;types&lt;/code&gt; å­—æ®µåŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Workflow é…ç½®ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;repository_dispatch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;types&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="l"&gt;custom_event]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¤–éƒ¨ç³»ç»Ÿé›†æˆï¼ˆå¦‚ CI/CD æµæ°´çº¿è”åŠ¨ã€è‡ªåŠ¨åŒ–ç›‘æ§å‘Šè­¦ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¶ä»–ç‰¹æ®Šè§¦å‘æ–¹å¼"&gt;å…¶ä»–ç‰¹æ®Šè§¦å‘æ–¹å¼
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Star æŒ‰é’®è§¦å‘&lt;/strong&gt;ï¼ˆæ—©æœŸæ–¹æ¡ˆï¼‰&lt;br&gt;
åœ¨ Workflow ä¸­é…ç½® &lt;code&gt;star&lt;/code&gt; äº‹ä»¶ï¼Œä»…ä»“åº“æ‰€æœ‰è€…ç‚¹å‡» Star æ—¶è§¦å‘ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;star&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;jobs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;if&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;github.event.repository.owner.id == github.event.sender.id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šä¼šäº§ç”Ÿå†—ä½™çš„ Actions è®°å½•ï¼Œä»…å»ºè®®å°é¡¹ç›®æˆ–ç§æœ‰ä»“åº“ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®‰å…¨æ€§åŠæœ€ä½³å®è·µ"&gt;å®‰å…¨æ€§åŠæœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æƒé™æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º API è§¦å‘çš„ Token ä»…åˆ†é…æœ€å°å¿…è¦æƒé™ï¼ˆå¦‚ &lt;code&gt;repo&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨ Workflow ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨ &lt;strong&gt;Secrets&lt;/strong&gt; å­˜å‚¨å¯†é’¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶è¿‡æ»¤&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;types&lt;/code&gt; æˆ–æ¡ä»¶è¯­å¥é™åˆ¶è§¦å‘èŒƒå›´ï¼Œé¿å…è¯¯æ“ä½œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;repository_dispatch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;types&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="l"&gt;deploy_prod, deploy_test]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-10"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;GitHub Actions æ”¯æŒçµæ´»çš„æ‰‹åŠ¨è§¦å‘æœºåˆ¶ï¼Œè¦†ç›–ä»ç®€å•ç‚¹å‡»åˆ°å¤æ‚é›†æˆçš„éœ€æ±‚ã€‚æ¨èä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;UI ç•Œé¢&lt;/strong&gt;æˆ– &lt;strong&gt;API è§¦å‘&lt;/strong&gt;ï¼Œæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼Œå¹¶éµå¾ªæƒé™æœ€å°åŒ–åŸåˆ™ä¿éšœå®‰å…¨ã€‚&lt;/p&gt;
&lt;h2 id="java-library"&gt;Java Library
&lt;/h2&gt;&lt;h3 id="è§£å†³æ–¹æ¡ˆ-2"&gt;è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;p&gt;æ ¹æ®æ‚¨é‡åˆ°çš„Gradleæ„å»ºé”™è¯¯ &lt;code&gt;Execution failed for task ':common:bootJar'&lt;/code&gt;ï¼Œæ ¸å¿ƒåŸå› æ˜¯&lt;strong&gt;åœ¨ä»…åŒ…å«å…¬å…±é€»è¾‘çš„ &lt;code&gt;common&lt;/code&gt; æ¨¡å—ä¸­å°è¯•æ‰§è¡Œ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ï¼Œä½†è¯¥æ¨¡å—æœªé…ç½®ä¸»ç±»ä¸”æ— å¯åŠ¨ç±»&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§£å†³æ­¥éª¤ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="1-ç¦æ­¢"&gt;&lt;strong&gt;1. ç¦æ­¢ &lt;code&gt;common&lt;/code&gt; æ¨¡å—æ‰§è¡Œ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç”±äº &lt;code&gt;common&lt;/code&gt; æ¨¡å—æ˜¯å…¬å…±åº“è€Œéå¯æ‰§è¡Œåº”ç”¨ï¼Œéœ€åœ¨æ¨¡å—çš„ &lt;code&gt;build.gradle&lt;/code&gt; ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œç›´æ¥ç¦ç”¨ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// common/build.gradle
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt; &lt;span class="c1"&gt;// ç¦æ­¢ç”Ÿæˆå¯æ‰§è¡ŒJAR
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt; &lt;span class="c1"&gt;// å…è®¸ç”Ÿæˆæ™®é€šJARï¼ˆä»…åŒ…å«ç±»æ–‡ä»¶ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜»æ­¢Gradleå°è¯•ç”ŸæˆSpring Bootå¯æ‰§è¡ŒJARåŒ…ï¼ˆéœ€è¦ä¸»ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¿ç•™æ™®é€šJARåŒ…çš„ç”Ÿæˆèƒ½åŠ›ï¼Œä¾›å…¶ä»–æ¨¡å—ä¾èµ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="2-æ£€æŸ¥æ˜¯å¦è¯¯ç”¨spring-bootæ’ä»¶"&gt;&lt;strong&gt;2. æ£€æŸ¥æ˜¯å¦è¯¯ç”¨Spring Bootæ’ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç¡®ä¿ &lt;code&gt;common&lt;/code&gt; æ¨¡å—æœªè¯¯å¼•å…¥ &lt;code&gt;org.springframework.boot&lt;/code&gt; æ’ä»¶ï¼ˆè‹¥ä»…éœ€å…¬å…±ä¾èµ–ï¼Œåº”ç§»é™¤æ’ä»¶ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// common/build.gradle
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;plugins&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;java-library&amp;#39;&lt;/span&gt; &lt;span class="c1"&gt;// ä½œä¸ºåº“æ¨¡å—ä½¿ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="c1"&gt;// ç§»é™¤ä»¥ä¸‹è¡Œï¼ˆè‹¥å­˜åœ¨ï¼‰ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="c1"&gt;// id &amp;#39;org.springframework.boot&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;spring-boot&lt;/code&gt; æ’ä»¶é»˜è®¤ä¼šç»‘å®š &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ï¼Œä½†å…¬å…±åº“æ¨¡å—æ— éœ€æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="3-è°ƒæ•´å¤šæ¨¡å—æ„å»ºé€»è¾‘"&gt;&lt;strong&gt;3. è°ƒæ•´å¤šæ¨¡å—æ„å»ºé€»è¾‘&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥é¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ªæ¨¡å—ï¼Œéœ€ç¡®ä¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨å±‚æ¨¡å—&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;app&lt;/code&gt;ã€&lt;code&gt;service&lt;/code&gt;ï¼‰ä¿ç•™ &lt;code&gt;spring-boot&lt;/code&gt; æ’ä»¶å’Œ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¬å…±åº“æ¨¡å—&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;common&lt;/code&gt;ï¼‰ä»…ä½¿ç”¨ &lt;code&gt;java-library&lt;/code&gt; æ’ä»¶ï¼Œç”Ÿæˆæ™®é€šJARã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ç»“æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-text" data-lang="text"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;project-root
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;â”œâ”€â”€ app
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;â”‚ â””â”€â”€ build.gradle (åº”ç”¨spring-bootæ’ä»¶)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;â””â”€â”€ common
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â””â”€â”€ build.gradle (ä¸åº”ç”¨spring-bootæ’ä»¶)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="4-æ¸…ç†å¹¶é‡æ–°æ„å»º"&gt;&lt;strong&gt;4. æ¸…ç†å¹¶é‡æ–°æ„å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®Œæˆé…ç½®åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¸…ç†ç¼“å­˜å¹¶é‡æ–°æ„å»ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./gradlew clean build -x :common:bootJar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å‚æ•°è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-x :common:bootJar&lt;/code&gt;ï¼šæ˜¾å¼è·³è¿‡ &lt;code&gt;common&lt;/code&gt; æ¨¡å—çš„ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ ¹æœ¬åŸå› "&gt;&lt;strong&gt;æ ¹æœ¬åŸå› &lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡çš„ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼šSpring Bootæ’ä»¶é»˜è®¤è¦æ±‚æ¯ä¸ªæ¨¡å—é…ç½®ä¸»ç±»ï¼ˆ&lt;code&gt;mainClass&lt;/code&gt;ï¼‰ï¼Œä½†å…¬å…±åº“æ¨¡å—æ— å¯åŠ¨ç±»ï¼Œå¯¼è‡´ä»»åŠ¡æ‰§è¡Œå¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’ä»¶è¯¯ç”¨&lt;/strong&gt;ï¼šå…¬å…±æ¨¡å—è‹¥è¯¯å¼•å…¥ &lt;code&gt;spring-boot&lt;/code&gt; æ’ä»¶ï¼Œä¼šè§¦å‘å¯æ‰§è¡ŒJARçš„ç”Ÿæˆé€»è¾‘ï¼Œä¸åº“çš„å®šä½å†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="é™„åŠ å»ºè®®"&gt;&lt;strong&gt;é™„åŠ å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€ä¾èµ–ç®¡ç†&lt;/strong&gt;ï¼šåœ¨çˆ¶æ¨¡å—çš„ &lt;code&gt;build.gradle&lt;/code&gt; ä¸­é›†ä¸­ç®¡ç†Spring Bootç‰ˆæœ¬ï¼Œå­æ¨¡å—æŒ‰éœ€å¼•å…¥æ’ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—èŒè´£åˆ†ç¦»&lt;/strong&gt;ï¼šç¡®ä¿ä¸šåŠ¡æ¨¡å—ä¸åº”ç”¨å…¥å£æ¨¡å—åˆ†ç¦»ï¼Œé¿å…å…¬å…±æ¨¡å—åŒ…å«Spring Bootåº”ç”¨é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="jar-åŒ…"&gt;Jar åŒ…
&lt;/h2&gt;&lt;p&gt;JARï¼ˆJava Archiveï¼‰åŒ…æ˜¯Javaå¹³å°ä¸­ç”¨äºèšåˆã€åˆ†å‘å’Œéƒ¨ç½²ä»£ç ä¸èµ„æºçš„æ ¸å¿ƒæ–‡ä»¶æ ¼å¼ã€‚ä»¥ä¸‹æ˜¯å…³äºJARåŒ…çš„è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºæœ¬æ¦‚å¿µä¸ç»“æ„"&gt;&lt;strong&gt;åŸºæœ¬æ¦‚å¿µä¸ç»“æ„&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ä¸åŸºç¡€&lt;/strong&gt;&lt;br&gt;
JARåŒ…æ˜¯åŸºäºZIPæ ¼å¼çš„å‹ç¼©å½’æ¡£æ–‡ä»¶ï¼Œæ‰©å±•åä¸º&lt;code&gt;.jar&lt;/code&gt;ï¼Œä¸»è¦ç”¨äºå°†å¤šä¸ªJavaç±»æ–‡ä»¶ã€èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€é…ç½®æ–‡ä»¶ï¼‰åŠå…ƒæ•°æ®ï¼ˆå¦‚æ¸…å•æ–‡ä»¶ï¼‰æ‰“åŒ…æˆå•ä¸€æ–‡ä»¶ã€‚å…¶è®¾è®¡åˆè¡·æ˜¯ç®€åŒ–Javaåº”ç”¨çš„éƒ¨ç½²å’Œåˆ†å‘ï¼ŒåŒæ—¶æ”¯æŒè·¨å¹³å°å…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒç»„æˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»æ–‡ä»¶&lt;/strong&gt;ï¼ˆ&lt;code&gt;.class&lt;/code&gt;ï¼‰ï¼šç¼–è¯‘åçš„Javaå­—èŠ‚ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ–‡ä»¶&lt;/strong&gt;ï¼šå¦‚XMLã€å›¾åƒã€éŸ³é¢‘ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¸…å•æ–‡ä»¶&lt;/strong&gt;ï¼ˆ&lt;code&gt;META-INF/MANIFEST.MF&lt;/code&gt;ï¼‰ï¼šå­˜å‚¨å…ƒæ•°æ®ï¼Œä¾‹å¦‚ä¸»ç±»å…¥å£ï¼ˆ&lt;code&gt;Main-Class&lt;/code&gt;ï¼‰ã€ç±»è·¯å¾„ï¼ˆ&lt;code&gt;Class-Path&lt;/code&gt;ï¼‰ã€ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­¾åæ–‡ä»¶&lt;/strong&gt;ï¼šå¦‚&lt;code&gt;.SF&lt;/code&gt;å’Œ&lt;code&gt;.DSA&lt;/code&gt;æ–‡ä»¶ï¼Œç”¨äºæ•°å­—ç­¾åéªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="jaråŒ…çš„æ ¸å¿ƒåŠŸèƒ½ä¸ç”¨é€”"&gt;&lt;strong&gt;JARåŒ…çš„æ ¸å¿ƒåŠŸèƒ½ä¸ç”¨é€”&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç åˆ†å‘ä¸éƒ¨ç½²&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—åŒ–å¼€å‘&lt;/strong&gt;ï¼šå°†åŠŸèƒ½æ¨¡å—æ‰“åŒ…ä¸ºç‹¬ç«‹JARæ–‡ä»¶ï¼Œä¾¿äºä»£ç å¤ç”¨å’Œä¾èµ–ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯æ‰§è¡Œæ–‡ä»¶&lt;/strong&gt;ï¼šé€šè¿‡æŒ‡å®š&lt;code&gt;Main-Class&lt;/code&gt;å±æ€§ï¼Œå¯ç›´æ¥é€šè¿‡&lt;code&gt;java -jar&lt;/code&gt;å‘½ä»¤è¿è¡Œï¼Œæ— éœ€æ‰‹åŠ¨è§£å‹æˆ–é…ç½®ç±»è·¯å¾„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº“æ–‡ä»¶å…±äº«&lt;/strong&gt;ï¼šå¦‚ç¬¬ä¸‰æ–¹åº“ï¼ˆApache Commonsã€Hibernateç­‰ï¼‰ä»¥JARå½¢å¼æä¾›ï¼Œä¾›å…¶ä»–é¡¹ç›®è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨ä¸ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°å­—ç­¾å&lt;/strong&gt;ï¼šç¡®ä¿ä»£ç æ¥æºå¯ä¿¡ä¸”æœªè¢«ç¯¡æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ…å¯†å°ï¼ˆSealingï¼‰&lt;/strong&gt;ï¼šå¼ºåˆ¶è¦æ±‚ç‰¹å®šåŒ…å†…çš„æ‰€æœ‰ç±»å¿…é¡»ä½äºåŒä¸€JARä¸­ï¼Œé˜²æ­¢ç‰ˆæœ¬å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬ä¿¡æ¯&lt;/strong&gt;ï¼šè®°å½•å‚å•†ã€æ„å»ºæ—¶é—´ç­‰ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ–‡ä»¶èšåˆ&lt;/strong&gt;ï¼šå°†åˆ†æ•£çš„ç±»ä¸èµ„æºæ•´åˆï¼Œå‡å°‘HTTPè¯·æ±‚ï¼ˆå¦‚Appletåœºæ™¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹ç¼©ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡ZIPå‹ç¼©å‡å°‘å­˜å‚¨ç©ºé—´å’Œä¸‹è½½æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åˆ›å»ºä¸ä½¿ç”¨jaråŒ…"&gt;&lt;strong&gt;åˆ›å»ºä¸ä½¿ç”¨JARåŒ…&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºæ–¹å¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œå·¥å…·&lt;/strong&gt;ï¼šä½¿ç”¨JDKè‡ªå¸¦çš„&lt;code&gt;jar&lt;/code&gt;å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;jar cvf myapp.jar -C classes/ . &lt;span class="c1"&gt;# æ‰“åŒ…ç±»æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;jar cmf manifest.txt app.jar . &lt;span class="c1"&gt;# åŒ…å«è‡ªå®šä¹‰æ¸…å•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„å»ºå·¥å…·&lt;/strong&gt;ï¼šå¦‚Mavenã€Gradleè‡ªåŠ¨ç”ŸæˆJARï¼Œå¹¶å¤„ç†ä¾èµ–å’Œæ¸…å•é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯æ‰§è¡ŒJARçš„é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ¸…å•æ–‡ä»¶ä¸­æŒ‡å®šä¸»ç±»ï¼š
&lt;pre tabindex="0"&gt;&lt;code&gt;Main-Class: com.example.Main
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;è¿è¡Œæ—¶å‘½ä»¤ï¼š&lt;code&gt;java -jar app.jar&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;Class-Path&lt;/code&gt;å±æ€§å£°æ˜å¤–éƒ¨JARä¾èµ–ï¼ˆéœ€æ‰‹åŠ¨é…ç½®è·¯å¾„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Maven/Gradleè‡ªåŠ¨è§£æå¹¶ä¸‹è½½ä¾èµ–åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¡Œé¢/å‘½ä»¤è¡Œåº”ç”¨&lt;/strong&gt;&lt;br&gt;
ç‹¬ç«‹Javaç¨‹åºé€šè¿‡å¯æ‰§è¡ŒJARä¸€é”®éƒ¨ç½²ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Webåº”ç”¨æ‰©å±•&lt;/strong&gt;&lt;br&gt;
ä½œä¸ºJava EEæ¨¡å—æˆ–æ’ä»¶ï¼Œä¾‹å¦‚Servletå®¹å™¨ä¾èµ–çš„åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç§»åŠ¨ç«¯å¼€å‘&lt;/strong&gt;&lt;br&gt;
æ—©æœŸJ2MEåº”ç”¨ï¼ˆå¦‚æ‰‹æœºæ¸¸æˆã€ç”µå­ä¹¦ï¼‰å¸¸ä»¥JARæ ¼å¼åˆ†å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¡†æ¶ä¸å·¥å…·&lt;/strong&gt;&lt;br&gt;
Springã€Hibernateç­‰æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ä»¥JARåŒ…å½¢å¼æä¾›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŠ¿ä¸å±€é™æ€§"&gt;&lt;strong&gt;ä¼˜åŠ¿ä¸å±€é™æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¨å¹³å°æ€§&lt;/strong&gt;ï¼šå…¼å®¹æ‰€æœ‰æ”¯æŒJavaçš„ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹ç¼©æ•ˆç‡&lt;/strong&gt;ï¼šå‡å°‘å­˜å‚¨å’Œä¼ è¾“å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼šæ”¯æŒç­¾åå’Œæƒé™æ§åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;ï¼šè¿è¡Œæ—¶éœ€è§£å‹æ–‡ä»¶ï¼Œå¯èƒ½å½±å“å¯åŠ¨é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†å¤æ‚&lt;/strong&gt;ï¼šæ‰‹åŠ¨é…ç½®ç±»è·¯å¾„æ˜“å‡ºé”™ï¼Œæ¨èä½¿ç”¨æ„å»ºå·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°å›°éš¾&lt;/strong&gt;ï¼šä¿®æ”¹å•ä¸ªæ–‡ä»¶éœ€é‡æ–°æ‰“åŒ…æ•´ä¸ªJARã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–æ ¼å¼çš„å¯¹æ¯”"&gt;&lt;strong&gt;ä¸å…¶ä»–æ ¼å¼çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JAR vs. WAR&lt;/strong&gt;&lt;br&gt;
WARï¼ˆWeb Archiveï¼‰ä¸“ç”¨äºWebåº”ç”¨ï¼ŒåŒ…å«Servletã€JSPç­‰ï¼Œéƒ¨ç½²åˆ°Servletå®¹å™¨ï¼ˆå¦‚Tomcatï¼‰ï¼›JARåˆ™é€‚ç”¨äºç‹¬ç«‹åº”ç”¨æˆ–åº“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JAR vs. ZIP&lt;/strong&gt;&lt;br&gt;
JARåŸºäºZIPæ ¼å¼ï¼Œä½†åŒ…å«Javaç‰¹æœ‰çš„å…ƒæ•°æ®å’ŒåŠŸèƒ½ï¼ˆå¦‚æ¸…å•æ–‡ä»¶ã€å¯æ‰§è¡Œæ€§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°è®¾è®¡ï¼ŒJARåŒ…æˆä¸ºJavaç”Ÿæ€ä¸­ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨åˆ†ï¼Œå¹³è¡¡äº†ä»£ç å°è£…ã€åˆ†å‘æ•ˆç‡ä¸è·¨å¹³å°éœ€æ±‚ã€‚å¦‚éœ€è¿›ä¸€æ­¥äº†è§£å…·ä½“å·¥å…·çš„ä½¿ç”¨ï¼ˆå¦‚Mavenä¾èµ–é…ç½®ï¼‰ï¼Œå¯å‚è€ƒç›¸å…³å¼€å‘æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id="jar-vs-bootjar"&gt;jar vs. bootJar
&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;code&gt;build.gradle&lt;/code&gt; æ–‡ä»¶ä¸­ï¼Œ&lt;code&gt;jar&lt;/code&gt; å’Œ &lt;code&gt;bootJar&lt;/code&gt; æ˜¯ä¸¤ç§å¸¸ç”¨äºæ„å»º Java é¡¹ç›®çš„ Gradle ä»»åŠ¡ï¼Œä½†å®ƒä»¬çš„é€‚ç”¨åœºæ™¯å’ŒåŠŸèƒ½æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„è¯¦ç»†ä»‹ç»ä¸å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="jar"&gt;&lt;strong&gt;&lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ä¸ç”¨é€”&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;jar&lt;/code&gt; æ˜¯ Gradle çš„ &lt;strong&gt;Java æ’ä»¶&lt;/strong&gt;æä¾›çš„é»˜è®¤ä»»åŠ¡ï¼Œç”¨äºå°†é¡¹ç›®ç¼–è¯‘åçš„ç±»æ–‡ä»¶ï¼ˆ&lt;code&gt;.class&lt;/code&gt;ï¼‰ã€èµ„æºæ–‡ä»¶ï¼ˆå¦‚é…ç½®æ–‡ä»¶ã€å›¾ç‰‡ï¼‰åŠæ¸…å•æ–‡ä»¶ï¼ˆ&lt;code&gt;MANIFEST.MF&lt;/code&gt;ï¼‰æ‰“åŒ…æˆæ ‡å‡†çš„ &lt;strong&gt;JAR æ–‡ä»¶&lt;/strong&gt;ã€‚ç”Ÿæˆçš„ JAR æ–‡ä»¶ä»…åŒ…å«å½“å‰é¡¹ç›®çš„ä»£ç å’Œèµ„æºï¼Œ&lt;strong&gt;ä¸åŒ…å«ä¾èµ–åº“&lt;/strong&gt;ï¼Œéœ€é€šè¿‡ &lt;code&gt;Class-Path&lt;/code&gt; æ‰‹åŠ¨é…ç½®ä¾èµ–è·¯å¾„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒé…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡å®šä¸»ç±»&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡ä¸­é€šè¿‡ &lt;code&gt;manifest&lt;/code&gt; å±æ€§å®šä¹‰å…¥å£ç±»ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;manifest&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;attributes&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Main-Class&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.Main&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ…å«èµ„æº&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;from&lt;/code&gt; æˆ– &lt;code&gt;include&lt;/code&gt; æ·»åŠ é¢å¤–èµ„æºç›®å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€š Java åº“æˆ–å·¥å…·çš„æ‰“åŒ…ï¼ˆå¦‚ä¾›å…¶ä»–é¡¹ç›®è°ƒç”¨çš„ SDKï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é Spring Boot é¡¹ç›®æˆ–éœ€è¦æ‰‹åŠ¨ç®¡ç†ä¾èµ–çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="bootjar"&gt;&lt;strong&gt;&lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰ä¸ç”¨é€”&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;bootJar&lt;/code&gt; æ˜¯ &lt;strong&gt;Spring Boot Gradle æ’ä»¶&lt;/strong&gt;ï¼ˆ&lt;code&gt;org.springframework.boot&lt;/code&gt;ï¼‰æä¾›çš„ä»»åŠ¡ï¼Œç”¨äºç”Ÿæˆ &lt;strong&gt;å¯æ‰§è¡Œçš„â€œèƒ– JARâ€ï¼ˆFat Jar/Uber-Jarï¼‰&lt;/strong&gt;ã€‚è¯¥ JAR æ–‡ä»¶ä¸ä»…åŒ…å«é¡¹ç›®ä»£ç å’Œèµ„æºï¼Œè¿˜&lt;strong&gt;å†…åµŒæ‰€æœ‰ä¾èµ–åº“&lt;/strong&gt;ï¼ˆå¦‚ç¬¬ä¸‰æ–¹ JAR åŒ…ï¼‰ï¼Œå¹¶åŒ…å« Spring Boot çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¯ç›´æ¥é€šè¿‡ &lt;code&gt;java -jar&lt;/code&gt; è¿è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒé…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨é»˜è®¤ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡&lt;/strong&gt;ï¼šåœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šå¸¸éœ€ç¦ç”¨ &lt;code&gt;jar&lt;/code&gt; ä»¥é¿å…é‡å¤æ‰“åŒ…ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰æ–‡ä»¶åå’Œä¸»ç±»&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;archiveFileName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;myapp.jar&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;manifest&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;attributes&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Start-Class&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.Application&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring Boot åº”ç”¨çš„æ‰“åŒ…éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦å•æ–‡ä»¶åˆ†å‘ã€æ— éœ€å¤–éƒ¨ä¾èµ–é…ç½®çš„å¾®æœåŠ¡æˆ–ç‹¬ç«‹åº”ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="jar-1"&gt;&lt;strong&gt;&lt;code&gt;jar&lt;/code&gt; ä¸ &lt;code&gt;bootJar&lt;/code&gt; çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;jar&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;bootJar&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¾èµ–å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸åŒ…å«ä¾èµ–ï¼Œéœ€æ‰‹åŠ¨é…ç½®ç±»è·¯å¾„&lt;/td&gt;
&lt;td&gt;å†…åµŒæ‰€æœ‰ä¾èµ–åº“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯æ‰§è¡Œæ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨æŒ‡å®šä¸»ç±»å¹¶é€šè¿‡ &lt;code&gt;java -jar&lt;/code&gt; è¿è¡Œ&lt;/td&gt;
&lt;td&gt;ç›´æ¥è¿è¡Œï¼ˆåŒ…å« Spring Boot å¯åŠ¨å™¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨æ¡†æ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šç”¨ Java é¡¹ç›®&lt;/td&gt;
&lt;td&gt;ä¸“ä¸º Spring Boot è®¾è®¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿæˆæ–‡ä»¶ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ‡å‡† JAR ç»“æ„&lt;/td&gt;
&lt;td&gt;åŒ…å« &lt;code&gt;BOOT-INF/classes&lt;/code&gt; å’Œ &lt;code&gt;BOOT-INF/lib&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®€å•&lt;/td&gt;
&lt;td&gt;éœ€ç»“åˆ Spring Boot æ’ä»¶é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ç¤ºä¾‹"&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ™®é€š JAR é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plugins&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;java&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;manifest&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;attributes&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Main-Class&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.Main&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;sourceSets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;main&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;output&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;classesDirs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;include&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;**/*.class&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring Boot çš„ &lt;code&gt;bootJar&lt;/code&gt; é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plugins&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;version&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2.5.4&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="c1"&gt;// ç¦ç”¨é»˜è®¤ jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;archiveFileName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;app.jar&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mainClass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.Application&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜"&gt;&lt;strong&gt;å¸¸è§é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡æœªç”Ÿæˆ&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿å·²æ­£ç¡®å¼•å…¥ Spring Boot æ’ä»¶ï¼š&lt;code&gt;id 'org.springframework.boot'&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç¼ºå¤±æˆ–å†²çª&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;./gradlew dependencies&lt;/code&gt; æ£€æŸ¥ä¾èµ–æ ‘ï¼Œæˆ–é€šè¿‡ &lt;code&gt;configurations.runtimeClasspath&lt;/code&gt; æ˜¾å¼åŒ…å«ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¦‚ä½•åŒæ—¶ç”Ÿæˆä¸¤ç§ JAR&lt;/strong&gt;&lt;br&gt;
åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šè¿‡ç¦ç”¨ &lt;code&gt;jar&lt;/code&gt; å¹¶è‡ªå®šä¹‰ &lt;code&gt;bootJar&lt;/code&gt;ï¼Œæˆ–åˆ›å»ºç‹¬ç«‹ä»»åŠ¡ç”Ÿæˆæ™®é€š JARã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹© &lt;code&gt;jar&lt;/code&gt; æˆ– &lt;code&gt;bootJar&lt;/code&gt;ï¼Œå¯ä»¥é«˜æ•ˆå®Œæˆé¡¹ç›®çš„æ„å»ºä¸åˆ†å‘ã€‚è‹¥éœ€è¿›ä¸€æ­¥äº†è§£å…·ä½“é…ç½®ï¼Œå¯å‚è€ƒ &lt;a class="link" href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/" target="_blank" rel="noopener"
&gt;Spring Boot å®˜æ–¹æ–‡æ¡£&lt;/a&gt; æˆ– Gradle ç”¨æˆ·æ‰‹å†Œã€‚&lt;/p&gt;
&lt;h2 id="bootjar-ä¸»ç±»"&gt;bootJar ä¸»ç±»
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ç”Ÿæˆå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶æ—¶ï¼Œ&lt;strong&gt;é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¸»ç±»&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸º Spring Boot Gradle æ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹é¡¹ç›®ä¸­å¸¦æœ‰ &lt;code&gt;@SpringBootApplication&lt;/code&gt; æ³¨è§£çš„ç±»ä½œä¸ºé»˜è®¤ä¸»ç±»ã€‚ä½†æŸäº›ç‰¹æ®Šåœºæ™¯å¯èƒ½éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤è¡Œä¸ºè‡ªåŠ¨è¯†åˆ«ä¸»ç±»"&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸ºï¼šè‡ªåŠ¨è¯†åˆ«ä¸»ç±»&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸»ç±»è‡ªåŠ¨æ¨æ–­&lt;/strong&gt;&lt;br&gt;
Spring Boot æ’ä»¶ä¼šæ‰«æé¡¹ç›®ä¸­çš„ &lt;code&gt;@SpringBootApplication&lt;/code&gt; æ³¨è§£æ ‡è®°çš„ç±»ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤ä¸»ç±»ã€‚ä¾‹å¦‚ï¼Œè‹¥é¡¹ç›®ä¸­å­˜åœ¨ &lt;code&gt;Application.java&lt;/code&gt; ä¸”åŒ…å«ä»¥ä¸‹æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Application&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpringApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Application&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ä¼šè‡ªåŠ¨ç”ŸæˆåŒ…å«ä»¥ä¸‹æ¸…å•å±æ€§çš„ JAR æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Main-Class: org.springframework.boot.loader.JarLauncher
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Start-Class: com.example.Application
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;JarLauncher&lt;/code&gt; æ˜¯ Spring Boot çš„å¯åŠ¨å™¨ç±»ï¼Œè´Ÿè´£åŠ è½½å†…åµŒä¾èµ–å’Œç”¨æˆ·ä¸»ç±»ï¼ˆ&lt;code&gt;Start-Class&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— éœ€æ‰‹åŠ¨é…ç½®&lt;/strong&gt;&lt;br&gt;
åªè¦é¡¹ç›®ç»“æ„ç¬¦åˆ Spring Boot æ ‡å‡†ï¼ˆå¦‚ä¸»ç±»ä½äºæ ¹åŒ…ä¸‹ï¼‰ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨å®Œæˆä¸»ç±»é…ç½®ï¼Œæ— éœ€åœ¨ &lt;code&gt;build.gradle&lt;/code&gt; ä¸­é¢å¤–å£°æ˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¸»ç±»çš„åœºæ™¯"&gt;&lt;strong&gt;éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¸»ç±»çš„åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥å‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œéœ€æ‰‹åŠ¨æŒ‡å®šä¸»ç±»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¡¹ç›®å­˜åœ¨å¤šä¸ª &lt;code&gt;@SpringBootApplication&lt;/code&gt; ç±»&lt;/strong&gt;&lt;br&gt;
å½“æ¨¡å—åŒ–é¡¹ç›®æˆ–æµ‹è¯•ä»£ç ä¸­å­˜åœ¨å¤šä¸ªä¸»ç±»æ—¶ï¼Œæ’ä»¶å¯èƒ½æ— æ³•è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„ä¸»ç±»ï¼Œéœ€æ˜¾å¼é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mainClass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.RealApplication&amp;#39;&lt;/span&gt; &lt;span class="c1"&gt;// æŒ‡å®šå”¯ä¸€ä¸»ç±»
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸»ç±»æœªæ ‡æ³¨ &lt;code&gt;@SpringBootApplication&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å¦‚æœä¸»ç±»æœªä½¿ç”¨æ ‡å‡†æ³¨è§£ï¼ˆä¾‹å¦‚æ—§é¡¹ç›®è¿ç§»ï¼‰ï¼Œéœ€æ‰‹åŠ¨å£°æ˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mainClass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.LegacyMainClass&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰å¯åŠ¨é€»è¾‘&lt;/strong&gt;&lt;br&gt;
éœ€è¦†ç›–é»˜è®¤çš„ &lt;code&gt;Start-Class&lt;/code&gt;ï¼Œä¾‹å¦‚ä½¿ç”¨è‡ªå®šä¹‰å¯åŠ¨å™¨æˆ–é Spring å…¥å£ç±»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®æ–¹æ³•"&gt;&lt;strong&gt;é…ç½®æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;code&gt;build.gradle&lt;/code&gt; ä¸­é€šè¿‡ &lt;code&gt;mainClass&lt;/code&gt; å±æ€§æ‰‹åŠ¨æŒ‡å®šä¸»ç±»ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mainClass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.example.CustomApplication&amp;#39;&lt;/span&gt; &lt;span class="c1"&gt;// æŒ‡å®šä¸»ç±»çš„å…¨é™å®šå
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤é…ç½®ä¼šè¦†ç›–æ’ä»¶çš„è‡ªåŠ¨æ£€æµ‹é€»è¾‘ï¼Œå¹¶åœ¨æ¸…å•æ–‡ä»¶ä¸­ç”Ÿæˆå¯¹åº”çš„ &lt;code&gt;Start-Class&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜ä¸è§£å†³"&gt;&lt;strong&gt;å¸¸è§é—®é¢˜ä¸è§£å†³&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŠ¥é”™â€œæ²¡æœ‰ä¸»æ¸…å•å±æ€§â€&lt;/strong&gt;&lt;br&gt;
è‹¥æœªæ­£ç¡®é…ç½®ä¸»ç±»æˆ–æ’ä»¶æœªç”Ÿæ•ˆï¼Œç”Ÿæˆçš„ JAR å¯èƒ½ç¼ºå°‘ &lt;code&gt;Start-Class&lt;/code&gt;ï¼Œå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚è§£å†³æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥æ˜¯å¦å¼•å…¥ Spring Boot æ’ä»¶ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plugins&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;version&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;x.x.x&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;ç¡®ä¿ &lt;code&gt;mainClass&lt;/code&gt; è·¯å¾„æ­£ç¡®ä¸”å­˜åœ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸é»˜è®¤ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡å†²çª&lt;/strong&gt;&lt;br&gt;
å¦‚æœåŒæ—¶å¯ç”¨äº† &lt;code&gt;jar&lt;/code&gt; å’Œ &lt;code&gt;bootJar&lt;/code&gt;ï¼Œå»ºè®®ç¦ç”¨é»˜è®¤ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡ä»¥é¿å…æ··æ·†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-11"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§„é¡¹ç›®&lt;/strong&gt;ï¼šæ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œä¾èµ– Spring Boot æ’ä»¶çš„è‡ªåŠ¨æ£€æµ‹æœºåˆ¶å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹æ®Šåœºæ™¯&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;bootJar.mainClass&lt;/code&gt; æ˜¾å¼æŒ‡å®šä¸»ç±»ï¼Œç¡®ä¿æ¸…å•æ–‡ä»¶åŒ…å«æ­£ç¡®çš„å¯åŠ¨ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯æ–¹å¼&lt;/strong&gt;ï¼šè§£å‹ç”Ÿæˆçš„ JAR æ–‡ä»¶ï¼Œæ£€æŸ¥ &lt;code&gt;META-INF/MANIFEST.MF&lt;/code&gt; ä¸­çš„ &lt;code&gt;Start-Class&lt;/code&gt; æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‹¥éœ€è¿›ä¸€æ­¥è°ƒè¯•ï¼Œå¯ç»“åˆ &lt;code&gt;./gradlew bootJar --console=verbose&lt;/code&gt; æŸ¥çœ‹æ„å»ºæ—¥å¿—ï¼Œæˆ–å‚è€ƒ &lt;a class="link" href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/" target="_blank" rel="noopener"
&gt;Spring Boot å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ä¸­çš„é«˜çº§é…ç½®é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h2 id="-plainjar"&gt;-plain.jar
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼Œæ‰§è¡Œ &lt;code&gt;gradle clean build&lt;/code&gt; ç”Ÿæˆçš„ä¸¤ä¸ª JAR æ–‡ä»¶ &lt;code&gt;comment-service-0.0.1-SNAPSHOT.jar&lt;/code&gt; å’Œ &lt;code&gt;comment-service-0.0.1-SNAPSHOT-plain.jar&lt;/code&gt;ï¼ŒåŒºåˆ«ä¸»è¦åœ¨äº &lt;strong&gt;æ„å»ºä»»åŠ¡ç±»å‹ä¸åŠŸèƒ½ç”¨é€”&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŒºåˆ«å¯¹æ¯”"&gt;&lt;strong&gt;åŒºåˆ«å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;-SNAPSHOT.jar&lt;/code&gt;ï¼ˆé»˜è®¤åç§°ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;-SNAPSHOT-plain.jar&lt;/code&gt;ï¼ˆå¸¦ &lt;code&gt;-plain&lt;/code&gt; åç¼€ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”Ÿæˆä»»åŠ¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”± Spring Boot æ’ä»¶çš„ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡ç”Ÿæˆ&lt;/td&gt;
&lt;td&gt;ç”± Gradle é»˜è®¤çš„ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡ç”Ÿæˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å®¹ç»“æ„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒ…å«é¡¹ç›®ä»£ç ã€æ‰€æœ‰ä¾èµ–åº“åŠ Spring Boot å¯åŠ¨å™¨ï¼ˆ&lt;code&gt;JarLauncher&lt;/code&gt;ï¼‰ï¼Œç»“æ„ä¸º &lt;code&gt;BOOT-INF/classes&lt;/code&gt; å’Œ &lt;code&gt;BOOT-INF/lib&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä»…åŒ…å«é¡¹ç›®ç¼–è¯‘åçš„ç±»æ–‡ä»¶ï¼ˆ&lt;code&gt;.class&lt;/code&gt;ï¼‰å’Œèµ„æºæ–‡ä»¶ï¼Œæ— ä¾èµ–åº“&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯æ‰§è¡Œæ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯ç›´æ¥é€šè¿‡ &lt;code&gt;java -jar&lt;/code&gt; è¿è¡Œï¼ˆæ˜¯â€œèƒ– JARâ€ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸å¯ç›´æ¥è¿è¡Œï¼Œéœ€æ‰‹åŠ¨é…ç½®ç±»è·¯å¾„å’Œä¾èµ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç”¨é€”åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç‹¬ç«‹éƒ¨ç½²çš„å¾®æœåŠ¡æˆ–å®¹å™¨åŒ–ç¯å¢ƒï¼ˆå¦‚ Dockerï¼‰&lt;/td&gt;
&lt;td&gt;ä¾›å…¶ä»–é¡¹ç›®ä½œä¸ºä¾èµ–åº“å¼•ç”¨ï¼ˆå¦‚ SDK æˆ–å…±äº«æ¨¡å—ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¸…å•æ–‡ä»¶ï¼ˆMANIFESTï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŒ…å« &lt;code&gt;Main-Class: org.springframework.boot.loader.JarLauncher&lt;/code&gt; å’Œ &lt;code&gt;Start-Class: ä¸»ç±»è·¯å¾„&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤æ— ä¸»ç±»é…ç½®ï¼Œéœ€æ‰‹åŠ¨æŒ‡å®š &lt;code&gt;Main-Class&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç”ŸæˆåŸå› "&gt;&lt;strong&gt;ç”ŸæˆåŸå› &lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring Boot æ’ä»¶é»˜è®¤è¡Œä¸º&lt;/strong&gt;&lt;br&gt;
Spring Boot Gradle æ’ä»¶é»˜è®¤ä¼šåŒæ—¶å¯ç”¨ &lt;code&gt;bootJar&lt;/code&gt; å’Œ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡ã€‚è‹¥æœªæ˜¾å¼ç¦ç”¨ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡ï¼Œæ„å»ºæ—¶ä¸¤è€…å‡ä¼šæ‰§è¡Œï¼Œå¯¼è‡´ç”Ÿæˆä¸¤ä¸ª JAR æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bootJar&lt;/code&gt; ç”Ÿæˆå¯æ‰§è¡Œ JARï¼ˆé»˜è®¤åç§°ä¸å¸¦ &lt;code&gt;-plain&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;jar&lt;/code&gt; ç”Ÿæˆæ™®é€š JARï¼ˆé»˜è®¤é™„åŠ  &lt;code&gt;-plain&lt;/code&gt; åç¼€ä»¥åŒºåˆ†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘½åè§„åˆ™&lt;/strong&gt;&lt;br&gt;
å½“ &lt;code&gt;bootJar&lt;/code&gt; å’Œ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡å…±å­˜æ—¶ï¼ŒSpring Boot æ’ä»¶ä¼šè‡ªåŠ¨ä¸º &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡çš„è¾“å‡ºæ–‡ä»¶æ·»åŠ  &lt;code&gt;-plain&lt;/code&gt; åç¼€ï¼Œé¿å…æ–‡ä»¶åå†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¦‚ä½•æ§åˆ¶ç”Ÿæˆç»“æœ"&gt;&lt;strong&gt;å¦‚ä½•æ§åˆ¶ç”Ÿæˆç»“æœ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯-1ä»…éœ€å¯æ‰§è¡Œ-jaråˆ é™¤"&gt;&lt;strong&gt;åœºæ™¯ 1ï¼šä»…éœ€å¯æ‰§è¡Œ JARï¼ˆåˆ é™¤ &lt;code&gt;-plain.jar&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;build.gradle&lt;/code&gt; ä¸­ç¦ç”¨ &lt;code&gt;jar&lt;/code&gt; ä»»åŠ¡ï¼Œä»…ä¿ç•™ &lt;code&gt;bootJar&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç¦ç”¨é»˜è®¤çš„ jar ä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œ &lt;code&gt;gradle clean build&lt;/code&gt; åï¼Œä»…ç”Ÿæˆ &lt;code&gt;comment-service-0.0.1-SNAPSHOT.jar&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id="åœºæ™¯-2ä»…éœ€æ™®é€š-jaråˆ é™¤å¯æ‰§è¡Œ-jar"&gt;&lt;strong&gt;åœºæ™¯ 2ï¼šä»…éœ€æ™®é€š JARï¼ˆåˆ é™¤å¯æ‰§è¡Œ JARï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç¦ç”¨ &lt;code&gt;bootJar&lt;/code&gt; å¹¶å¯ç”¨ &lt;code&gt;jar&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç¦ç”¨ bootJar ä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å¯ç”¨ jar ä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œæ„å»ºåï¼Œç”Ÿæˆ &lt;code&gt;-plain.jar&lt;/code&gt; æ–‡ä»¶ï¼Œä¸”æ–‡ä»¶åå¯èƒ½éœ€é€šè¿‡ &lt;code&gt;archiveClassifier&lt;/code&gt; è°ƒæ•´ï¼ˆä¾‹å¦‚ç§»é™¤ &lt;code&gt;-plain&lt;/code&gt; åç¼€ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="éªŒè¯ä¸è°ƒè¯•-1"&gt;&lt;strong&gt;éªŒè¯ä¸è°ƒè¯•&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥çœ‹ä»»åŠ¡ä¾èµ–&lt;/strong&gt;&lt;br&gt;
è¿è¡Œ &lt;code&gt;gradle tasks&lt;/code&gt;ï¼Œæ£€æŸ¥ &lt;code&gt;jar&lt;/code&gt; å’Œ &lt;code&gt;bootJar&lt;/code&gt; ä»»åŠ¡æ˜¯å¦å‡è¢«å¯ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥æ–‡ä»¶å†…å®¹&lt;/strong&gt;&lt;br&gt;
è§£å‹ JAR æ–‡ä»¶ï¼Œå¯¹æ¯” &lt;code&gt;BOOT-INF/lib&lt;/code&gt; ç›®å½•æ˜¯å¦å­˜åœ¨ï¼ˆä»…å¯æ‰§è¡Œ JAR åŒ…å«ä¾èµ–åº“ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—åˆ†æ&lt;/strong&gt;&lt;br&gt;
æ·»åŠ  &lt;code&gt;--info&lt;/code&gt; å‚æ•°æŸ¥çœ‹æ„å»ºè¯¦æƒ…ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;gradle clean build --info
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•å»ºè®®"&gt;&lt;strong&gt;æ‰©å±•å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;ï¼šè‹¥éœ€å°†é¡¹ç›®ä½œä¸ºåº“ä¾›å…¶ä»–æ¨¡å—å¼•ç”¨ï¼Œæ¨èç”Ÿæˆæ™®é€š JARï¼ˆ&lt;code&gt;-plain.jar&lt;/code&gt;ï¼‰ï¼Œé¿å…ä¾èµ–å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰å‘½å&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;archiveFileName&lt;/code&gt; æˆ– &lt;code&gt;archiveClassifier&lt;/code&gt; è°ƒæ•´è¾“å‡ºæ–‡ä»¶åï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;bootJar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;archiveFileName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;app.jar&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// å¯æ‰§è¡Œ JAR é‡å‘½å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;jar&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;archiveClassifier&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="c1"&gt;// ç§»é™¤ -plain åç¼€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°é…ç½®ï¼Œå¯çµæ´»æ§åˆ¶ç”Ÿæˆ JAR çš„ç±»å‹ä¸å‘½åï¼Œé€‚åº”ä¸åŒéƒ¨ç½²éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="workdir"&gt;WORKDIR
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;WORKDIR /app&lt;/code&gt; åœ¨ Dockerfile ä¸­ä¸»è¦ç”¨äºè®¾ç½®å®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œå…¶ä½œç”¨å…·ä½“ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-å®šä¹‰å‘½ä»¤æ‰§è¡Œè·¯å¾„"&gt;&lt;strong&gt;1. å®šä¹‰å‘½ä»¤æ‰§è¡Œè·¯å¾„&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåç»­çš„ &lt;code&gt;RUN&lt;/code&gt;ã€&lt;code&gt;CMD&lt;/code&gt;ã€&lt;code&gt;ENTRYPOINT&lt;/code&gt;ã€&lt;code&gt;COPY&lt;/code&gt;ã€&lt;code&gt;ADD&lt;/code&gt; ç­‰æŒ‡ä»¤é»˜è®¤ä¼šåœ¨ &lt;code&gt;/app&lt;/code&gt; ç›®å½•ä¸‹æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/app&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; touch hello.txt &lt;span class="c1"&gt;# å®é™…åœ¨ /app ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; . . &lt;span class="c1"&gt;# å°†ä¸»æœºæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨çš„ /app ç›®å½•&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-è‡ªåŠ¨åˆ›å»ºç›®å½•"&gt;&lt;strong&gt;2. è‡ªåŠ¨åˆ›å»ºç›®å½•&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;/app&lt;/code&gt; ç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥ç›®å½•ï¼Œæ— éœ€æ‰‹åŠ¨ä½¿ç”¨ &lt;code&gt;RUN mkdir&lt;/code&gt; å‘½ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹æ¯”&lt;/strong&gt;ï¼šè‹¥çœç•¥ &lt;code&gt;WORKDIR&lt;/code&gt;ï¼Œç›´æ¥æ‰§è¡Œ &lt;code&gt;RUN cd /app&lt;/code&gt; å¯èƒ½å› ç›®å½•ä¸å­˜åœ¨å¯¼è‡´å‘½ä»¤å¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-æ”¯æŒç›¸å¯¹è·¯å¾„"&gt;&lt;strong&gt;3. æ”¯æŒç›¸å¯¹è·¯å¾„&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåç»­è·¯å¾„å¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆåŸºäº &lt;code&gt;WORKDIR&lt;/code&gt; è®¾ç½®çš„ç›®å½•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/app&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; src &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make &lt;span class="c1"&gt;# å®é™…è·¯å¾„ä¸º /app/src&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="4-æå‡å®‰å…¨æ€§ä¸å¯ç»´æŠ¤æ€§"&gt;&lt;strong&gt;4. æå‡å®‰å…¨æ€§ä¸å¯ç»´æŠ¤æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è·¯å¾„é”™è¯¯&lt;/strong&gt;ï¼šç›¸æ¯”æ‰‹åŠ¨ä½¿ç”¨ &lt;code&gt;RUN cd&lt;/code&gt;ï¼Œ&lt;code&gt;WORKDIR&lt;/code&gt; ç¡®ä¿æ‰€æœ‰æ“ä½œå§‹ç»ˆåœ¨æŒ‡å®šç›®å½•ä¸‹è¿›è¡Œï¼Œé¿å…å› è·¯å¾„åˆ‡æ¢å¤±è´¥å¯¼è‡´çš„æ„å»ºé”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚å­˜å‚¨ä¼˜åŒ–&lt;/strong&gt;ï¼šæ¯ä¸ª &lt;code&gt;RUN&lt;/code&gt; æŒ‡ä»¤å¯åŠ¨çš„æ–°å®¹å™¨å±‚ä¼šç»§æ‰¿ &lt;code&gt;WORKDIR&lt;/code&gt; è®¾ç½®ï¼Œè€Œ &lt;code&gt;RUN cd&lt;/code&gt; ä»…å½±å“å½“å‰å±‚çš„ä¸´æ—¶ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="5-ä¸å¤šé˜¶æ®µæ„å»ºååŒ"&gt;&lt;strong&gt;5. ä¸å¤šé˜¶æ®µæ„å»ºååŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåœ¨å¤šé˜¶æ®µæ„å»ºä¸­ï¼Œ&lt;code&gt;WORKDIR&lt;/code&gt; å¯åˆ†åˆ«è®¾ç½®ä¸åŒé˜¶æ®µçš„å·¥ä½œç›®å½•ï¼Œé¿å…è·¯å¾„å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# æ„å»ºé˜¶æ®µ&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;node:18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;builder&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/build&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; . .&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; npm install &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; npm run build&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="c"&gt;# è¿è¡Œé˜¶æ®µ&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;nginx:alpine&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; --from&lt;span class="o"&gt;=&lt;/span&gt;builder /build/dist .&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§è¯¯åŒº"&gt;&lt;strong&gt;å¸¸è§è¯¯åŒº&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é”™è¯¯ç”¨æ³•&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /app &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; touch hello.txt &lt;span class="c1"&gt;# ä¸‹ä¸€å±‚ RUN å‘½ä»¤ä»ä¼šå›åˆ°æ ¹ç›®å½•&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­£ç¡®æ›¿ä»£&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/app&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; touch hello.txt &lt;span class="c1"&gt;# æ‰€æœ‰åç»­æ“ä½œå‡åœ¨ /app ç›®å½•&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-12"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;WORKDIR /app&lt;/code&gt; çš„æ ¸å¿ƒä½œç”¨æ˜¯ &lt;strong&gt;è§„èŒƒå®¹å™¨å†…æ“ä½œè·¯å¾„&lt;/strong&gt;ï¼Œé€šè¿‡è‡ªåŠ¨åˆ›å»ºç›®å½•ã€æ”¯æŒç›¸å¯¹è·¯å¾„ã€æå‡æ„å»ºå®‰å…¨æ€§ï¼Œç®€åŒ– Dockerfile çš„ç¼–å†™ä¸ç»´æŠ¤ã€‚å¯¹äºéœ€è¦å›ºå®šæ“ä½œè·¯å¾„çš„åœºæ™¯ï¼ˆå¦‚ä»£ç ç¼–è¯‘ã€é…ç½®æ–‡ä»¶å¤åˆ¶ç­‰ï¼‰ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;WORKDIR&lt;/code&gt; è€Œé &lt;code&gt;RUN cd&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="å®¹å™¨ç½‘ç»œæ¨¡å¼"&gt;å®¹å™¨ç½‘ç»œæ¨¡å¼
&lt;/h2&gt;&lt;hr&gt;
&lt;p&gt;Docker å®¹å™¨ç½‘ç»œæ¨¡å¼å®šä¹‰äº†å®¹å™¨å¦‚ä½•ä¸å®¿ä¸»æœºã€å…¶ä»–å®¹å™¨åŠå¤–éƒ¨ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚Docker æä¾›äº†å¤šç§ç½‘ç»œæ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†ç±»è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="bridge-ç½‘ç»œæ¨¡å¼é»˜è®¤æ¨¡å¼"&gt;&lt;strong&gt;Bridge ç½‘ç»œæ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤æ¨¡å¼&lt;/strong&gt;ï¼šå®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥ï¼ˆ&lt;code&gt;docker0&lt;/code&gt;ï¼‰è¿æ¥åˆ°å®¿ä¸»æœºç½‘ç»œï¼Œæ¯ä¸ªå®¹å™¨åˆ†é…ç‹¬ç«‹çš„ IP åœ°å€å’Œç½‘ç»œå‘½åç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;Docker åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;docker0&lt;/code&gt; çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œå®¹å™¨é€šè¿‡ &lt;code&gt;veth&lt;/code&gt; è™šæ‹Ÿæ¥å£è¿æ¥åˆ°è¯¥ç½‘æ¡¥ã€‚&lt;/li&gt;
&lt;li&gt;å®¹å™¨ä¹‹é—´é€šè¿‡ç½‘æ¡¥é€šä¿¡ï¼Œä¸å®¿ä¸»æœºé€šè¿‡ NAT è§„åˆ™è¿›è¡Œç½‘ç»œéš”ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸ä½¿ç”¨"&gt;&lt;strong&gt;é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œå¯åŠ¨å®¹å™¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d --network&lt;span class="o"&gt;=&lt;/span&gt;bridge --name my_container nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Docker Compose é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;networks&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;default &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# é»˜è®¤ä½¿ç”¨ bridge ç½‘ç»œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;networks&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;default&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;driver&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;bridge&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å®¹å™¨é—´éœ€è¦éš”ç¦»ä½†éœ€é€šè¿‡ IP æˆ–æœåŠ¡åé€šä¿¡ï¼ˆå¦‚å¾®æœåŠ¡æ¶æ„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ç«¯å£æ˜ å°„ï¼ˆ&lt;code&gt;-p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£&lt;/code&gt;ï¼‰å¯¹å¤–æš´éœ²æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å®¹å™¨é—´éš”ç¦»ï¼Œå®‰å…¨æ€§è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;é»˜è®¤éœ€è¦æ‰‹åŠ¨é…ç½®ç«¯å£æ˜ å°„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ”¯æŒè‡ªå®šä¹‰å­ç½‘å’Œç½‘å…³&lt;/td&gt;
&lt;td&gt;è·¨ä¸»æœºé€šä¿¡éœ€é¢å¤–é…ç½®ï¼ˆå¦‚ overlay ç½‘ç»œï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="host-ç½‘ç»œæ¨¡å¼"&gt;&lt;strong&gt;Host ç½‘ç»œæ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰-1"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«å®¿ä¸»æœºç½‘ç»œ&lt;/strong&gt;ï¼šå®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸è¿›è¡Œç½‘ç»œéš”ç¦»ï¼Œå®¹å™¨ç«¯å£ç›´æ¥ç»‘å®šåˆ°å®¿ä¸»æœºç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œæ¥å£å’Œ IP åœ°å€ï¼Œæ— éœ€ NAT è½¬æ¢ã€‚&lt;/li&gt;
&lt;li&gt;å®¹å™¨å†…ç›‘å¬ &lt;code&gt;localhost:80&lt;/code&gt; ç­‰åŒäºå®¿ä¸»æœºç›‘å¬ &lt;code&gt;0.0.0.0:80&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸ä½¿ç”¨-1"&gt;&lt;strong&gt;é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œå¯åŠ¨å®¹å™¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d --network&lt;span class="o"&gt;=&lt;/span&gt;host --name my_container nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Docker Compose é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;network_mode&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;host&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…³é”®é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-2"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;éœ€è¦é«˜æ€§èƒ½ç½‘ç»œï¼ˆå¦‚è´Ÿè½½æµ‹è¯•ã€å®æ—¶æ•°æ®å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œæœåŠ¡ï¼ˆå¦‚ç›‘æ§ä»£ç†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹-1"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘ç»œæ€§èƒ½é«˜ï¼ˆæ—  NAT å¼€é”€ï¼‰&lt;/td&gt;
&lt;td&gt;ç«¯å£å†²çªé£é™©ï¼ˆå¤šä¸ªå®¹å™¨æ— æ³•ç›‘å¬åŒä¸€ç«¯å£ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— éœ€ç«¯å£æ˜ å°„&lt;/td&gt;
&lt;td&gt;ç½‘ç»œéš”ç¦»æ€§å·®ï¼Œå®‰å…¨æ€§ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="none-ç½‘ç»œæ¨¡å¼"&gt;&lt;strong&gt;None ç½‘ç»œæ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰-2"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— ç½‘ç»œæ¥å£&lt;/strong&gt;ï¼šå®¹å™¨ä¸é…ç½®ä»»ä½•ç½‘ç»œï¼Œå®Œå…¨éš”ç¦»äºå¤–éƒ¨ç½‘ç»œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å®¹å™¨ä»…ä¿ç•™ &lt;code&gt;lo&lt;/code&gt; å›ç¯æ¥å£ï¼Œæ— æ³•ä¸å®¿ä¸»æœºæˆ–å…¶ä»–å®¹å™¨é€šä¿¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸ä½¿ç”¨-2"&gt;&lt;strong&gt;é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œå¯åŠ¨å®¹å™¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d --network&lt;span class="o"&gt;=&lt;/span&gt;none --name my_container nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-3"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å®Œå…¨éš”ç¦»çš„ç½‘ç»œç¯å¢ƒï¼ˆå¦‚å®‰å…¨æ²™ç®±ã€ç¦»çº¿æ•°æ®å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨é…ç½®è‡ªå®šä¹‰ç½‘ç»œæ ˆï¼ˆéœ€ç»“åˆ &lt;code&gt;nsenter&lt;/code&gt; ç­‰å·¥å…·ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹-2"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æœ€é«˜å®‰å…¨æ€§&lt;/td&gt;
&lt;td&gt;æ— æ³•ç›´æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œæˆ–å…¶ä»–å®¹å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é€‚ç”¨äºç‰¹æ®Šç½‘ç»œéœ€æ±‚&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨é…ç½®å¤æ‚ç½‘ç»œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="container-ç½‘ç»œæ¨¡å¼å…±äº«ç½‘ç»œå‘½åç©ºé—´"&gt;&lt;strong&gt;Container ç½‘ç»œæ¨¡å¼ï¼ˆå…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰-3"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«å…¶ä»–å®¹å™¨çš„ç½‘ç»œ&lt;/strong&gt;ï¼šæ–°å®¹å™¨ä¸æŒ‡å®šå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼ŒIPã€ç«¯å£å’Œç½‘ç»œæ¥å£å®Œå…¨ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ–°å®¹å™¨é€šè¿‡ &lt;code&gt;--network=container:&amp;lt;ç›®æ ‡å®¹å™¨&amp;gt;&lt;/code&gt; åŠ å…¥ç›®æ ‡å®¹å™¨çš„ç½‘ç»œæ ˆã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šæ—¥å¿—æ”¶é›†å®¹å™¨å…±äº« Web å®¹å™¨çš„ç½‘ç»œï¼Œç›´æ¥è®¿é—® &lt;code&gt;localhost:80&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸ä½¿ç”¨-3"&gt;&lt;strong&gt;é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‘½ä»¤è¡Œå¯åŠ¨å®¹å™¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å¯åŠ¨ç›®æ ‡å®¹å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d --name web nginx
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å¯åŠ¨å…±äº«ç½‘ç»œçš„å®¹å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d --network&lt;span class="o"&gt;=&lt;/span&gt;container:web --name logger fluentd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-4"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å®¹å™¨é—´éœ€è¦ç´§å¯†åä½œï¼ˆå¦‚ Sidecar æ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å…±äº«ç½‘ç»œèµ„æºï¼ˆå¦‚è°ƒè¯•å®¹å™¨ç›‘æ§ç›®æ ‡å®¹å™¨çš„ç½‘ç»œæµé‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹-3"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å®¹å™¨é—´é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; ç›´æ¥é€šä¿¡&lt;/td&gt;
&lt;td&gt;ä¾èµ–ç›®æ ‡å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ˆç›®æ ‡åœæ­¢åˆ™å…±äº«å¤±æ•ˆï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èŠ‚çœç«¯å£èµ„æº&lt;/td&gt;
&lt;td&gt;çµæ´»æ€§ä½ï¼ˆæ— æ³•åŠ¨æ€åˆ‡æ¢å…±äº«ç›®æ ‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç”¨æˆ·è‡ªå®šä¹‰ç½‘ç»œ"&gt;&lt;strong&gt;ç”¨æˆ·è‡ªå®šä¹‰ç½‘ç»œ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å®šä¹‰-4"&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»é…ç½®&lt;/strong&gt;ï¼šç”¨æˆ·åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼Œæ”¯æŒ Bridgeã€Overlayã€Macvlan ç­‰é©±åŠ¨ï¼Œæä¾›æ›´ç»†ç²’åº¦çš„ç½‘ç»œæ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œåŸç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Bridge é©±åŠ¨&lt;/strong&gt;ï¼šç±»ä¼¼é»˜è®¤ Bridge æ¨¡å¼ï¼Œä½†æ”¯æŒ DNS è‡ªåŠ¨è§£æå®¹å™¨åç§°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Overlay é©±åŠ¨&lt;/strong&gt;ï¼šç”¨äºè·¨ä¸»æœºçš„å®¹å™¨é€šä¿¡ï¼ˆå¦‚ Docker Swarm é›†ç¾¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Macvlan é©±åŠ¨&lt;/strong&gt;ï¼šä¸ºå®¹å™¨åˆ†é…ç‰©ç†ç½‘ç»œä¸­çš„ MAC åœ°å€ï¼Œä½¿å…¶ç›´æ¥æ¥å…¥ç‰©ç†ç½‘ç»œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸ä½¿ç”¨-4"&gt;&lt;strong&gt;é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºè‡ªå®šä¹‰ Bridge ç½‘ç»œ&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network create --driver&lt;span class="o"&gt;=&lt;/span&gt;bridge --subnet&lt;span class="o"&gt;=&lt;/span&gt;172.18.0.0/16 my_network
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Docker Compose é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my_app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;networks&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;my_network&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;networks&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;my_network&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;driver&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;bridge&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ipam&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;subnet&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;172.18.0.0&lt;/span&gt;&lt;span class="l"&gt;/24&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-5"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒä¸­çš„å¤šæœåŠ¡åä½œï¼ˆå¦‚å¾®æœåŠ¡æ¶æ„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è·¨ä¸»æœºå®¹å™¨é€šä¿¡ï¼ˆä½¿ç”¨ Overlay ç½‘ç»œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜ç¼ºç‚¹-4"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ”¯æŒ DNS è‡ªåŠ¨å‘ç°æœåŠ¡åç§°&lt;/td&gt;
&lt;td&gt;é…ç½®å¤æ‚åº¦è¾ƒé«˜ï¼ˆéœ€å®šä¹‰å­ç½‘ã€ç½‘å…³ç­‰ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æä¾›ç½‘ç»œéš”ç¦»å’Œçµæ´»ç­–ç•¥&lt;/td&gt;
&lt;td&gt;Overlay ç½‘ç»œéœ€é›†ç¾¤ç®¡ç†ï¼ˆå¦‚ Swarmï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç½‘ç»œæ¨¡å¼å¯¹æ¯”æ€»ç»“"&gt;&lt;strong&gt;ç½‘ç»œæ¨¡å¼å¯¹æ¯”æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å¼&lt;/th&gt;
&lt;th&gt;é€šä¿¡æ–¹å¼&lt;/th&gt;
&lt;th&gt;æ€§èƒ½&lt;/th&gt;
&lt;th&gt;éš”ç¦»æ€§&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Bridge&lt;/td&gt;
&lt;td&gt;é€šè¿‡è™šæ‹Ÿç½‘æ¡¥ + NAT&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é»˜è®¤å®¹å™¨é—´é€šä¿¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Host&lt;/td&gt;
&lt;td&gt;ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;é«˜æ€§èƒ½éœ€æ±‚ã€ç«¯å£ç›´æ¥æš´éœ²&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;æ— ç½‘ç»œæ¥å£&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;æœ€é«˜&lt;/td&gt;
&lt;td&gt;å®Œå…¨éš”ç¦»ç¯å¢ƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Container&lt;/td&gt;
&lt;td&gt;å…±äº«å…¶ä»–å®¹å™¨ç½‘ç»œ&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;Sidecar æ¨¡å¼ã€å…±äº«ç½‘ç»œæ ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·è‡ªå®šä¹‰ç½‘ç»œ&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰é…ç½®ï¼ˆDNSã€å­ç½‘ï¼‰&lt;/td&gt;
&lt;td&gt;å¯å˜&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§ç¯å¢ƒã€è·¨ä¸»æœºé€šä¿¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ƒå…³é”®æ“ä½œå‘½ä»¤"&gt;ä¸ƒã€&lt;strong&gt;å…³é”®æ“ä½œå‘½ä»¤&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network ls
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥ç½‘ç»œè¯¦æƒ…&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network inspect my_network
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ é™¤è‡ªå®šä¹‰ç½‘ç»œ&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network rm my_network
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿æ¥å®¹å™¨åˆ°æŒ‡å®šç½‘ç»œ&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network connect my_network my_container
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©ç½‘ç»œæ¨¡å¼ï¼Œå¯ä»¥ä¼˜åŒ–å®¹å™¨é€šä¿¡æ•ˆç‡ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘ç¯å¢ƒä¸­å¸¸ç”¨ &lt;strong&gt;Host æ¨¡å¼&lt;/strong&gt;å¿«é€Ÿè°ƒè¯•ï¼Œç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ &lt;strong&gt;è‡ªå®šä¹‰ Bridge ç½‘ç»œ&lt;/strong&gt; æˆ– &lt;strong&gt;Overlay ç½‘ç»œ&lt;/strong&gt;ï¼ˆé›†ç¾¤åœºæ™¯ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="å¾®æœåŠ¡æ¶æ„ç½‘ç»œæ¨¡å¼"&gt;å¾®æœåŠ¡æ¶æ„ç½‘ç»œæ¨¡å¼
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç½‘ç»œæ¨¡å¼çš„é€‰æ‹©ç›´æ¥å½±å“æœåŠ¡é€šä¿¡æ•ˆç‡ã€å¯æ‰©å±•æ€§å’Œå®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯ç»“åˆ Docker ç½‘ç»œç‰¹æ€§ä¸å¾®æœåŠ¡åœºæ™¯çš„æ·±åº¦è§£æåŠæ¨èæ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ¨èæ¨¡å¼"&gt;&lt;strong&gt;æ ¸å¿ƒæ¨èæ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-overlay-ç½‘ç»œæ¨¡å¼è·¨ä¸»æœºé€šä¿¡"&gt;&lt;strong&gt;1. Overlay ç½‘ç»œæ¨¡å¼ï¼ˆè·¨ä¸»æœºé€šä¿¡ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šä¸»æœºå®¹å™¨ç›´è¿ï¼Œé€šè¿‡ VXLAN éš§é“å®ç°è·¨ç‰©ç†èŠ‚ç‚¹çš„æ— ç¼é€šä¿¡ï¼Œå¤©ç„¶é€‚é…åˆ†å¸ƒå¼éƒ¨ç½²çš„å¾®æœåŠ¡é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;é›†æˆ Docker Swarm æˆ– Kubernetes æ—¶ï¼Œè‡ªåŠ¨å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ IP æ˜ å°„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è·¨æ•°æ®ä¸­å¿ƒéƒ¨ç½²çš„å¾®æœåŠ¡ï¼ˆå¦‚ç”µå•†ç³»ç»Ÿçš„è®¢å•ã€æ”¯ä»˜æœåŠ¡åˆ†æ•£åœ¨ä¸åŒåŒºåŸŸï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦åŠ¨æ€æ‰©ç¼©å®¹çš„å¼¹æ€§æ¶æ„ï¼ˆç»“åˆ Swarm/K8s è‡ªåŠ¨è°ƒåº¦å®¹å™¨å®ä¾‹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# åˆ›å»ºåŠ å¯†çš„ Overlay ç½‘ç»œï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network create -d overlay --opt encrypted --subnet 10.10.0.0/24 microservice_net
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-è‡ªå®šä¹‰-bridge-ç½‘ç»œå•æœºæˆ–å°è§„æ¨¡é›†ç¾¤"&gt;&lt;strong&gt;2. è‡ªå®šä¹‰ Bridge ç½‘ç»œï¼ˆå•æœºæˆ–å°è§„æ¨¡é›†ç¾¤ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æä¾›å®¹å™¨é—´éš”ç¦»é€šä¿¡ï¼Œæ”¯æŒ DNS è‡ªåŠ¨è§£ææœåŠ¡åç§°ï¼ˆå¦‚ &lt;code&gt;serviceA&lt;/code&gt; å¯ç›´æ¥è®¿é—® &lt;code&gt;serviceB&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…é»˜è®¤ &lt;code&gt;docker0&lt;/code&gt; ç½‘ç»œçš„ IP å†²çªé—®é¢˜ï¼Œå¯é€šè¿‡å­ç½‘åˆ’åˆ†æå‡å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¼€å‘æµ‹è¯•ç¯å¢ƒå¿«é€Ÿæ­å»ºå¾®æœåŠ¡åŸå‹ã€‚&lt;/li&gt;
&lt;li&gt;å•æœºéƒ¨ç½²çš„è½»é‡çº§å¾®æœåŠ¡ï¼ˆå¦‚æœ¬åœ°è°ƒè¯•çš„ Spring Cloud åº”ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# åˆ›å»ºè‡ªå®šä¹‰ Bridge ç½‘ç»œå¹¶æŒ‡å®šå­ç½‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker network create --driver&lt;span class="o"&gt;=&lt;/span&gt;bridge --subnet&lt;span class="o"&gt;=&lt;/span&gt;192.168.5.0/24 --gateway&lt;span class="o"&gt;=&lt;/span&gt;192.168.5.1 app_bridge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¢å¼ºå‹æ¶æ„ç»„åˆ"&gt;&lt;strong&gt;å¢å¼ºå‹æ¶æ„ç»„åˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-overlay-ç½‘ç»œ--æœåŠ¡ç½‘æ ¼å¦‚-istio"&gt;&lt;strong&gt;1. Overlay ç½‘ç»œ + æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»·å€¼ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç²¾ç»†åŒ–æµé‡ç®¡ç†&lt;/strong&gt;ï¼šæ”¯æŒé‡‘ä¸é›€å‘å¸ƒã€ç†”æ–­ã€é‡è¯•ç­‰é«˜çº§ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›¶ä¿¡ä»»å®‰å…¨&lt;/strong&gt;ï¼šé€šè¿‡ mTLS å®ç°æœåŠ¡é—´åŒå‘è®¤è¯ï¼ŒåŠ å¯† Overlay ç½‘ç»œæµé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§å»ºè®®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ Swarm/K8s é›†ç¾¤ä¸­å¯ç”¨ &lt;code&gt;--opt encrypted&lt;/code&gt; å‚æ•°å¼ºåŒ– Overlay éš§é“åŠ å¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-macvlanipvlan-æ¨¡å¼ç‰©ç†ç½‘ç»œé›†æˆéœ€æ±‚"&gt;&lt;strong&gt;2. Macvlan/IPvlan æ¨¡å¼ï¼ˆç‰©ç†ç½‘ç»œé›†æˆéœ€æ±‚ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¾®æœåŠ¡éœ€ç›´æ¥æš´éœ²ä¸ºç‰©ç†ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚ IoT è¾¹ç¼˜è®¡ç®—åœºæ™¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸é—ç•™ç³»ç»Ÿå…±å­˜ï¼Œè¦æ±‚å®¹å™¨ IP ä¸ç‰©ç†ç½‘ç»œåŒç½‘æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ IPvlan å­æ¨¡å¼é¿å… MAC åœ°å€æ³›æ»¥é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="åœºæ™¯åŒ–é€‰å‹çŸ©é˜µ"&gt;&lt;strong&gt;åœºæ™¯åŒ–é€‰å‹çŸ©é˜µ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ¨èæ¨¡å¼&lt;/th&gt;
&lt;th&gt;å…³é”®ä¼˜åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è·¨ä¸»æœºåˆ†å¸ƒå¼å¾®æœåŠ¡&lt;/td&gt;
&lt;td&gt;Overlay + æœåŠ¡ç½‘æ ¼&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨è·¯ç”±ã€è·¨èŠ‚ç‚¹é€šä¿¡ã€æœåŠ¡æ²»ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é«˜æ€§èƒ½è®¡ç®—ï¼ˆå¦‚é‡‘èäº¤æ˜“ï¼‰&lt;/td&gt;
&lt;td&gt;Host æ¨¡å¼ + SR-IOV&lt;/td&gt;
&lt;td&gt;é›¶ NAT å»¶è¿Ÿï¼Œç›´é€šç‰©ç†ç½‘å¡æ€§èƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®‰å…¨æ•æ„Ÿåœºæ™¯&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰ Bridge + Calico&lt;/td&gt;
&lt;td&gt;ç½‘ç»œç­–ç•¥é™åˆ¶ï¼ˆå¦‚ä»…å…è®¸å‰ç«¯è®¿é—®åç«¯ 80 ç«¯å£ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ··åˆäº‘/å¤šå‚å•†éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;Macvlan + BGP è·¯ç”±&lt;/td&gt;
&lt;td&gt;å®¹å™¨ IP ç›´é€šç‰©ç†ç½‘ç»œï¼Œæ— ç¼é›†æˆç°æœ‰åŸºç¡€è®¾æ–½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¼€å‘æµ‹è¯•ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰ Bridge&lt;/td&gt;
&lt;td&gt;å¿«é€Ÿæ­å»ºã€DNS è‡ªåŠ¨å‘ç°&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–å®è·µ"&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å»¶è¿Ÿä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;tcpping&lt;/code&gt; æµ‹è¯•å®¹å™¨é—´ TCP å»¶è¿Ÿï¼Œä¼˜å…ˆé€‰æ‹© Host æ¨¡å¼æˆ– Macvlan å‡å°‘ NAT å±‚çº§ã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨ CPU/å†…å­˜é™åˆ¶é¿å…èµ„æºäº‰æŠ¢å¯¼è‡´çš„ç½‘ç»œæŠ–åŠ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸¦å®½ç“¶é¢ˆè§£å†³&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºé«˜æµé‡å¾®æœåŠ¡åˆ†é…ç‹¬ç«‹ç‰©ç†ç½‘å¡ï¼ˆSR-IOV æŠ€æœ¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å®¿ä¸»æœºå¯ç”¨ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•æå‡ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•…éšœæ’æŸ¥å·¥å…·é“¾&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›‘æ§ï¼š&lt;code&gt;docker stats&lt;/code&gt; + Prometheus/Grafana å¯è§†åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;æ—¥å¿—ï¼šELK Stack é›†ä¸­åˆ†æï¼Œç»“åˆ &lt;code&gt;docker logs --tail&lt;/code&gt; å®æ—¶è·Ÿè¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸æ¨èæ–¹æ¡ˆä¸é£é™©æç¤º"&gt;&lt;strong&gt;ä¸æ¨èæ–¹æ¡ˆä¸é£é™©æç¤º&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤ Bridge ç½‘ç»œ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é£é™©ï¼šIP å†²çªæ¦‚ç‡é«˜ï¼Œç¼ºä¹ DNS æœåŠ¡å‘ç°ï¼Œéœ€æ‰‹åŠ¨ç»´æŠ¤ &lt;code&gt;/etc/hosts&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¯ Host æ¨¡å¼å¤§è§„æ¨¡ä½¿ç”¨&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é£é™©ï¼šç«¯å£å†²çªå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œå®‰å…¨æ”»å‡»é¢æ‰©å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-13"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¾®æœåŠ¡æ¶æ„çš„ç»ˆæç›®æ ‡æ˜¯å®ç° &lt;strong&gt;é«˜å†…èšã€ä½è€¦åˆã€å¼¹æ€§æ‰©å±•&lt;/strong&gt;ã€‚Overlay ç½‘ç»œæ˜¯åˆ†å¸ƒå¼åœºæ™¯çš„åŸºçŸ³ï¼Œè€Œè‡ªå®šä¹‰ Bridge å’Œå¢å¼ºç»„åˆæ¨¡å¼å¯åº”å¯¹å¤šæ ·åŒ–éœ€æ±‚ã€‚å»ºè®®ç»“åˆæœåŠ¡ç½‘æ ¼ä¸åŠ å¯†ç­–ç•¥ï¼Œæ„å»ºå…¼é¡¾æ€§èƒ½ä¸å®‰å…¨çš„é€šä¿¡å±‚ã€‚&lt;/p&gt;
&lt;h2 id="address-0000"&gt;address: 0.0.0.0
&lt;/h2&gt;&lt;hr&gt;
&lt;p&gt;å½“ Spring Boot åº”ç”¨æœªæ˜¾å¼é…ç½® &lt;code&gt;server.address&lt;/code&gt;ï¼ˆå³æœªè®¾ç½®ä¸º &lt;code&gt;0.0.0.0&lt;/code&gt;ï¼‰æ—¶ï¼Œå…¶é»˜è®¤ç›‘å¬åœ°å€ä¸º &lt;strong&gt;&lt;code&gt;127.0.0.1&lt;/code&gt;&lt;/strong&gt;ï¼ˆä»…æœ¬åœ°å›ç¯æ¥å£ï¼‰ã€‚æ­¤æ—¶æ˜¯å¦å¯¼è‡´å®¿ä¸»æœºæ— æ³•è®¿é—®æœåŠ¡ï¼Œ&lt;strong&gt;å–å†³äºå®¹å™¨çš„ç½‘ç»œæ¨¡å¼&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤è¡Œä¸ºåˆ†æ"&gt;&lt;strong&gt;é»˜è®¤è¡Œä¸ºåˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æœªé…ç½®"&gt;&lt;strong&gt;æœªé…ç½® &lt;code&gt;server.address&lt;/code&gt; æ—¶çš„è¡¨ç°&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤ç›‘å¬åœ°å€&lt;/strong&gt;ï¼š&lt;code&gt;127.0.0.1&lt;/code&gt;ï¼ˆä»…é™æœ¬æœºè®¿é—®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8081&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æœªæŒ‡å®š addressï¼Œé»˜è®¤ç»‘å®šåˆ° 127.0.0.1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åº”ç”¨åªèƒ½é€šè¿‡å®¹å™¨å†…éƒ¨çš„ &lt;code&gt;localhost:8081&lt;/code&gt; æˆ– &lt;code&gt;127.0.0.1:8081&lt;/code&gt; è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¿ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æ— æ³•è®¿é—®è¯¥æœåŠ¡&lt;/strong&gt;ï¼ˆé™¤éç‰¹æ®Šç½‘ç»œæ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸åŒå®¹å™¨ç½‘ç»œæ¨¡å¼ä¸‹çš„å½±å“"&gt;&lt;strong&gt;ä¸åŒå®¹å™¨ç½‘ç»œæ¨¡å¼ä¸‹çš„å½±å“&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="bridge-ç½‘ç»œæ¨¡å¼é»˜è®¤"&gt;&lt;strong&gt;Bridge ç½‘ç»œæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç«¯å£æ˜ å°„ç”Ÿæ•ˆæ¡ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å³ä½¿é€šè¿‡ &lt;code&gt;ports: &amp;quot;8081:8081&amp;quot;&lt;/code&gt; æ˜ å°„ç«¯å£ï¼Œè‹¥åº”ç”¨æœªç›‘å¬ &lt;code&gt;0.0.0.0&lt;/code&gt;ï¼Œå®¿ä¸»æœºä»æ— æ³•è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å®¹å™¨å†…éƒ¨çš„åº”ç”¨ä»…ç»‘å®šåˆ° &lt;code&gt;127.0.0.1&lt;/code&gt;ï¼Œæœªæš´éœ²åˆ°æ¡¥æ¥ç½‘ç»œæ¥å£ï¼ˆå¦‚ &lt;code&gt;eth0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯å‘½ä»¤&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è¿›å…¥å®¹å™¨æŸ¥çœ‹ç«¯å£ç›‘å¬çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker &lt;span class="nb"&gt;exec&lt;/span&gt; -it your_container netstat -tuln &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;8081&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è¾“å‡ºç¤ºä¾‹ï¼štcp6 0 0 127.0.0.1:8081 :::* LISTEN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="host-ç½‘ç»œæ¨¡å¼-1"&gt;&lt;strong&gt;Host ç½‘ç»œæ¨¡å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œç‰¹æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å®¹å™¨å…±äº«å®¿ä¸»æœºçš„ç½‘ç»œæ ˆï¼Œåº”ç”¨ç›‘å¬çš„ &lt;code&gt;127.0.0.1:8081&lt;/code&gt; ç­‰åŒäºå®¿ä¸»æœºä¸Šçš„ &lt;code&gt;localhost:8081&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å®¿ä¸»æœºå¯é€šè¿‡ &lt;code&gt;localhost:8081&lt;/code&gt; æˆ– &lt;code&gt;127.0.0.1:8081&lt;/code&gt; è®¿é—®æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨ç½‘ç»œï¼ˆå¦‚å…¶ä»–ç‰©ç†æœºï¼‰ä»æ— æ³•è®¿é—®&lt;/strong&gt;ï¼Œéœ€æ˜¾å¼ç»‘å®šåˆ° &lt;code&gt;0.0.0.0&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆ-3"&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¼ºåˆ¶ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£"&gt;&lt;strong&gt;å¼ºåˆ¶ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;application.yml&lt;/code&gt; ä¸­æ˜ç¡®æŒ‡å®šç›‘å¬åœ°å€ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;address&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.0.0.0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…è®¸æ‰€æœ‰å¤–éƒ¨è®¿é—®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8081&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åº”ç”¨ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆåŒ…æ‹¬å®¹å™¨å†…éƒ¨çš„ &lt;code&gt;eth0&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®¿ä¸»æœºå’Œå…¶ä»–å®¹å™¨å¯é€šè¿‡å®¿ä¸»æœºçš„ IP æˆ–å®¹å™¨ IP è®¿é—®æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸åŒç½‘ç»œæ¨¡å¼ä¸‹çš„è®¿é—®æ–¹å¼"&gt;&lt;strong&gt;ä¸åŒç½‘ç»œæ¨¡å¼ä¸‹çš„è®¿é—®æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç½‘ç»œæ¨¡å¼&lt;/th&gt;
&lt;th&gt;æ˜¯å¦éœ€é…ç½® &lt;code&gt;0.0.0.0&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;å®¿ä¸»æœºè®¿é—®æ–¹å¼&lt;/th&gt;
&lt;th&gt;å¤–éƒ¨æœºå™¨è®¿é—®æ–¹å¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bridge&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;&lt;code&gt;å®¿ä¸»æœºIP:æ˜ å°„ç«¯å£&lt;/code&gt;ï¼ˆå¦‚ 8081ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;å®¿ä¸»æœºIP:æ˜ å°„ç«¯å£&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Host&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯é€‰ï¼ˆä»…éœ€å¤–éƒ¨è®¿é—®ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;localhost:8081&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;å®¿ä¸»æœºå…¬ç½‘IP:8081&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªå®šä¹‰ç½‘ç»œ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;é€šè¿‡å®¹å™¨ IP æˆ–æœåŠ¡å + ç«¯å£&lt;/td&gt;
&lt;td&gt;éœ€ç«¯å£æ˜ å°„æˆ–åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ"&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å§‹ç»ˆæ˜¾å¼é…ç½® &lt;code&gt;address: 0.0.0.0&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
é¿å…å› ç½‘ç»œæ¨¡å¼å·®å¼‚å¯¼è‡´çš„æœåŠ¡ä¸å¯è¾¾é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“åˆé˜²ç«å¢™é™åˆ¶è®¿é—®æ¥æº&lt;/strong&gt;&lt;br&gt;
é€šè¿‡å®‰å…¨ç»„æˆ– &lt;code&gt;iptables&lt;/code&gt; ä»…å…è®¸å¯ä¿¡ IP è®¿é—®ç«¯å£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ä»…å…è®¸ 192.168.1.0/24 ç½‘æ®µè®¿é—® 8081&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;iptables -A INPUT -p tcp --dport &lt;span class="m"&gt;8081&lt;/span&gt; -s 192.168.1.0/24 -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;iptables -A INPUT -p tcp --dport &lt;span class="m"&gt;8081&lt;/span&gt; -j DROP
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰&lt;/strong&gt;&lt;br&gt;
å°†å®¹å™¨æœåŠ¡éšè—åœ¨ä»£ç†åï¼Œé€šè¿‡åŸŸåå’Œ HTTPS æš´éœ²ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-nginx" data-lang="nginx"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;api.yourdomain.com&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;proxy_pass&lt;/span&gt; &lt;span class="s"&gt;http://å®¿ä¸»æœºIP:8081&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§è¯¯åŒº-1"&gt;&lt;strong&gt;å¸¸è§è¯¯åŒº&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;â€œHost æ¨¡å¼ä¸éœ€è¦ç»‘å®š &lt;code&gt;0.0.0.0&lt;/code&gt;â€&lt;/strong&gt;&lt;br&gt;
é”™è¯¯ï¼è‹¥éœ€ä»å¤–éƒ¨ç½‘ç»œï¼ˆéå®¿ä¸»æœºï¼‰è®¿é—®ï¼Œä»éœ€ç»‘å®šåˆ° &lt;code&gt;0.0.0.0&lt;/code&gt;ï¼Œå¦åˆ™ä»…å®¿ä¸»æœºæœ¬åœ°å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;â€œç«¯å£æ˜ å°„æˆåŠŸå°±ä¸€å®šèƒ½è®¿é—®â€&lt;/strong&gt;&lt;br&gt;
é”™è¯¯ï¼ç«¯å£æ˜ å°„ä»…æ‰“é€šç½‘ç»œè·¯å¾„ï¼Œè‹¥åº”ç”¨æœªç›‘å¬ &lt;code&gt;0.0.0.0&lt;/code&gt;ï¼Œè¯·æ±‚ä»ä¼šè¢«æ‹’ç»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-14"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿…é¡»é…ç½® &lt;code&gt;address: 0.0.0.0&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;br&gt;
é™¤éæ˜ç¡®ä»…éœ€å®¹å™¨å†…éƒ¨è®¿é—®ï¼Œå¦åˆ™åº”å§‹ç»ˆç»‘å®šåˆ°æ‰€æœ‰æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Host æ¨¡å¼ç‰¹æ®Šåœºæ™¯&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥ä»…éœ€å®¿ä¸»æœºæœ¬åœ°è°ƒè¯•ï¼Œå¯ä¸é…ç½® &lt;code&gt;0.0.0.0&lt;/code&gt;ï¼Œä½†ç”Ÿäº§ç¯å¢ƒä»éœ€æ˜¾å¼è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="nginx--kubernetes"&gt;Nginx &amp;amp; Kubernetes
&lt;/h2&gt;&lt;p&gt;Nginx åœ¨ Kubernetes é›†ç¾¤ä¸­çš„éƒ¨ç½²ä½ç½®å–å†³äºå…·ä½“åœºæ™¯éœ€æ±‚ï¼Œé€šå¸¸åˆ†ä¸º &lt;strong&gt;é›†ç¾¤å†…&lt;/strong&gt; å’Œ &lt;strong&gt;é›†ç¾¤å¤–&lt;/strong&gt; ä¸¤ç§æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ¨¡å¼çš„å¯¹æ¯”åŠé€‚ç”¨åœºæ™¯åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-é›†ç¾¤å†…éƒ¨ç½²nginx-ingress-controller"&gt;&lt;strong&gt;1. é›†ç¾¤å†…éƒ¨ç½²ï¼šNginx Ingress Controller&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;ï¼š&lt;br&gt;
ä½œä¸º Kubernetes Ingress Controller è¿è¡Œåœ¨é›†ç¾¤å†…éƒ¨ï¼Œè´Ÿè´£ç®¡ç† HTTP/HTTPS æµé‡è·¯ç”±ã€SSL ç»ˆç»“ã€è·¯å¾„é‡å†™ç­‰åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æš´éœ²ä¸è·¯ç”±&lt;/strong&gt;ï¼šé€šè¿‡ Ingress è§„åˆ™å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°é›†ç¾¤å†…çš„ Serviceï¼ˆå¦‚ Web åº”ç”¨ã€API æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€é…ç½®&lt;/strong&gt;ï¼šåˆ©ç”¨ Kubernetes API è‡ªåŠ¨æ›´æ–°è·¯ç”±è§„åˆ™ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ Nginx é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šç»“åˆ Kubernetes Service å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸ Kubernetes åŸç”Ÿé›†æˆï¼Œæ”¯æŒè‡ªåŠ¨æœåŠ¡å‘ç°å’Œæ‰©ç¼©å®¹ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›ä¸°å¯Œçš„è·¯ç”±ç­–ç•¥ï¼ˆå¦‚è·¯å¾„åŒ¹é…ã€åŸŸååˆ†å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒ TLS ç»ˆæ­¢ã€è·¨åŸŸé…ç½®ç­‰é«˜çº§åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;br&gt;
é€šè¿‡ Deployment å’Œ Service éƒ¨ç½² Nginx Ingress Controllerï¼Œå¹¶å®šä¹‰ Ingress èµ„æºè§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-é›†ç¾¤å¤–éƒ¨ç½²ç‹¬ç«‹-nginx-è´Ÿè½½å‡è¡¡å™¨"&gt;&lt;strong&gt;2. é›†ç¾¤å¤–éƒ¨ç½²ï¼šç‹¬ç«‹ Nginx è´Ÿè½½å‡è¡¡å™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;ï¼š&lt;br&gt;
ä½œä¸ºå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œå¤„ç†æ¥è‡ªå…¬ç½‘çš„æµé‡ï¼Œå¹¶åˆ†å‘ç»™ Kubernetes é›†ç¾¤å†…çš„å¤šä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨æ€§éœ€æ±‚&lt;/strong&gt;ï¼šé€šè¿‡ Keepalived + Nginx å®ç°ä¸»å¤‡æˆ–åŒæ´»ï¼Œä¿éšœå…¥å£é«˜å¯ç”¨ï¼ˆå¦‚ API Server è´Ÿè½½å‡è¡¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚æµé‡æ§åˆ¶&lt;/strong&gt;ï¼šéœ€è¦é™æµã€ç¼“å­˜ã€å…¨å±€ SSL é…ç½®ç­‰ç²¾ç»†åŒ–ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨é›†ç¾¤æˆ–æ··åˆäº‘&lt;/strong&gt;ï¼šç»Ÿä¸€ç®¡ç†å¤šä¸ªé›†ç¾¤çš„æµé‡å…¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹äº Kubernetes é›†ç¾¤ï¼Œé¿å…å•ç‚¹æ•…éšœå½±å“æ•´ä½“ç¨³å®šæ€§ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ›´çµæ´»çš„å¥åº·æ£€æŸ¥ã€ä¼šè¯ä¿æŒå’Œç¼“å­˜ä¼˜åŒ–ï¼ˆå¦‚é™æ€èµ„æºç¼“å­˜ã€ç¬¬ä¸‰æ–¹ API ä»£ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨äºå¤§è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯ï¼Œå‡å°‘é›†ç¾¤å†…éƒ¨å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨å¤–éƒ¨æœåŠ¡å™¨éƒ¨ç½² Nginxï¼Œé…ç½® Upstream æŒ‡å‘ Kubernetes èŠ‚ç‚¹çš„ Service æˆ– Ingress ç«¯å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-é€‰æ‹©å»ºè®®"&gt;&lt;strong&gt;3. é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé›†ç¾¤å†…æ¨¡å¼&lt;/strong&gt;ï¼š&lt;br&gt;
å¤§å¤šæ•° Kubernetes åŸç”Ÿåº”ç”¨ï¼ˆå¦‚å¾®æœåŠ¡ã€Web åº”ç”¨ï¼‰æ¨èä½¿ç”¨ Nginx Ingress Controllerï¼Œç®€åŒ–è¿ç»´å¹¶å……åˆ†åˆ©ç”¨ Kubernetes çš„åŠ¨æ€æ‰©å±•èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©é›†ç¾¤å¤–æ¨¡å¼&lt;/strong&gt;ï¼š&lt;br&gt;
å½“éœ€è¦ä»¥ä¸‹ç‰¹æ€§æ—¶ï¼š
&lt;ul&gt;
&lt;li&gt;è·¨é›†ç¾¤æµé‡ç®¡ç†æˆ–å¤šäº‘æ¶æ„ï¼›&lt;/li&gt;
&lt;li&gt;ä¼ä¸šçº§ SSL é…ç½®ã€å…¨å±€ç¼“å­˜ï¼ˆå¦‚ç½‘é¡µ2ä¸­çš„ç¬¬ä¸‰æ–¹APIç¼“å­˜ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨æ— æ³•æ»¡è¶³çš„å®šåˆ¶åŒ–éœ€æ±‚ï¼ˆå¦‚é•¿è¿æ¥ä¼˜åŒ–ã€åè®®è½¬æ¢ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="4-æ··åˆéƒ¨ç½²æ¡ˆä¾‹"&gt;&lt;strong&gt;4. æ··åˆéƒ¨ç½²æ¡ˆä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;éƒ¨åˆ†ä¼ä¸šé‡‡ç”¨ &lt;strong&gt;å†…å¤–ç»“åˆ&lt;/strong&gt; çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨ Nginx&lt;/strong&gt;ï¼šå¤„ç† SSL ç»ˆç»“ã€å…¨å±€é™æµå’Œç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨ Ingress Controller&lt;/strong&gt;ï¼šå¤„ç†ç»†ç²’åº¦è·¯ç”±å’ŒæœåŠ¡å‘ç°ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼Œé€šè¿‡å¤–éƒ¨ Nginx å°†æµé‡åˆ†å‘åˆ°å¤šä¸ª Kubernetes é›†ç¾¤çš„ Ingress Controllerï¼Œå®ç°åˆ†å±‚è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-15"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Nginx çš„éƒ¨ç½²ä½ç½®éœ€æ ¹æ®ä¸šåŠ¡è§„æ¨¡ã€æµé‡å¤æ‚åº¦åŠè¿ç»´éœ€æ±‚çµæ´»é€‰æ‹©ã€‚&lt;strong&gt;é›†ç¾¤å†…æ–¹æ¡ˆé€‚åˆäº‘åŸç”Ÿåœºæ™¯&lt;/strong&gt;ï¼Œè€Œ&lt;strong&gt;é›†ç¾¤å¤–æ–¹æ¡ˆæ›´é€‚åˆä¼ ç»Ÿæ¶æ„è¿ç§»æˆ–é«˜æ€§èƒ½è¦æ±‚åœºæ™¯&lt;/strong&gt;ã€‚å®é™…éƒ¨ç½²æ—¶ï¼Œå¯å‚è€ƒ Kubernetes å®˜æ–¹æ–‡æ¡£ç»“åˆå…·ä½“ä¸šåŠ¡éªŒè¯æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;h2 id="deployment-vs-service"&gt;Deployment vs. Service
&lt;/h2&gt;&lt;p&gt;Kubernetes ä¸­çš„ &lt;strong&gt;Deployment&lt;/strong&gt; å’Œ &lt;strong&gt;Service&lt;/strong&gt; æ˜¯ä¸¤ç§æ ¸å¿ƒèµ„æºï¼Œåˆ†åˆ«æ‰¿æ‹…åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œç½‘ç»œè®¿é—®æ§åˆ¶çš„ä¸åŒèŒè´£ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„åŒºåˆ«ä¸è”ç³»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒèŒè´£å¯¹æ¯”"&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Deployment&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Service&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸»è¦åŠŸèƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç®¡ç† Pod çš„åˆ›å»ºã€æ›´æ–°ã€æ‰©ç¼©å®¹ï¼Œç¡®ä¿åº”ç”¨å‰¯æœ¬æ•°é‡å’Œå¥åº·çŠ¶æ€&lt;/td&gt;
&lt;td&gt;æä¾›ç¨³å®šçš„ç½‘ç»œè®¿é—®å…¥å£ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ ¸å¿ƒå¯¹è±¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡ ReplicaSet ç®¡ç† Pod å‰¯æœ¬é›†ï¼Œæ”¯æŒæ»šåŠ¨æ›´æ–°ã€ç‰ˆæœ¬å›æ»š&lt;/td&gt;
&lt;td&gt;é€šè¿‡ Endpoints åŠ¨æ€å…³è”åç«¯ Podï¼Œç»´æŠ¤è™šæ‹Ÿ IP å’Œ DNS åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…³æ³¨ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚é•œåƒå‡çº§ã€å‰¯æœ¬æ•°è°ƒæ•´ï¼‰&lt;/td&gt;
&lt;td&gt;ç½‘ç»œæµé‡åˆ†å‘ï¼ˆå¦‚è´Ÿè½½å‡è¡¡ã€è·¨èŠ‚ç‚¹è®¿é—®ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ï¼‰çš„éƒ¨ç½²&lt;/td&gt;
&lt;td&gt;æš´éœ²å†…éƒ¨æˆ–å¤–éƒ¨è®¿é—®æ¥å£ï¼ˆå¦‚ API æœåŠ¡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŒºåˆ«"&gt;&lt;strong&gt;æ ¸å¿ƒåŒºåˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä½œç”¨å±‚çº§ä¸åŒ"&gt;&lt;strong&gt;ä½œç”¨å±‚çº§ä¸åŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt; æ˜¯ &lt;strong&gt;åº”ç”¨ç¼–æ’å±‚&lt;/strong&gt; çš„èµ„æºï¼Œè´Ÿè´£ Pod çš„åˆ›å»ºã€æ›´æ–°å’Œæ‰©ç¼©å®¹ã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦å‡çº§é•œåƒæ—¶ï¼ŒDeployment ä¼šé€æ­¥æ›¿æ¢æ—§ Podï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service&lt;/strong&gt; æ˜¯ &lt;strong&gt;ç½‘ç»œå±‚&lt;/strong&gt; çš„èµ„æºï¼Œæä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ã€‚ä¾‹å¦‚ï¼Œå³ä½¿ Pod IP åŠ¨æ€å˜åŒ–ï¼ŒService çš„è™šæ‹Ÿ IPï¼ˆClusterIPï¼‰å§‹ç»ˆä¿æŒç¨³å®šï¼Œå®¢æˆ·ç«¯æ— éœ€æ„ŸçŸ¥åç«¯å˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®å‚æ•°å·®å¼‚"&gt;&lt;strong&gt;é…ç½®å‚æ•°å·®å¼‚&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt; çš„å…³é”®å‚æ•°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;replicas&lt;/code&gt;ï¼šPod å‰¯æœ¬æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;strategy&lt;/code&gt;ï¼šæ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;maxUnavailable&lt;/code&gt;ã€&lt;code&gt;maxSurge&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;template&lt;/code&gt;ï¼šPod æ¨¡æ¿ï¼ˆå®šä¹‰å®¹å™¨é•œåƒã€èµ„æºé™åˆ¶ç­‰ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service&lt;/strong&gt; çš„å…³é”®å‚æ•°ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;type&lt;/code&gt;ï¼šæœåŠ¡ç±»å‹ï¼ˆClusterIPã€NodePortã€LoadBalancerï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;selector&lt;/code&gt;ï¼šæ ‡ç­¾é€‰æ‹©å™¨ï¼ˆåŒ¹é…åç«¯ Podï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ports&lt;/code&gt;ï¼šç«¯å£æ˜ å°„è§„åˆ™ï¼ˆå¦‚ &lt;code&gt;port&lt;/code&gt; å’Œ &lt;code&gt;targetPort&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ›´æ–°æœºåˆ¶ä¸åŒ"&gt;&lt;strong&gt;æ›´æ–°æœºåˆ¶ä¸åŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment&lt;/strong&gt; æ”¯æŒ &lt;strong&gt;å£°æ˜å¼æ›´æ–°&lt;/strong&gt;ï¼Œé€šè¿‡ä¿®æ”¹ YAML æ–‡ä»¶è§¦å‘æ»šåŠ¨å‡çº§ï¼Œå¹¶ä¿ç•™å†å²ç‰ˆæœ¬ä»¥ä¾¿å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service&lt;/strong&gt; çš„æ›´æ–°é€šå¸¸ä¸ Pod æ ‡ç­¾å˜åŒ–ç›¸å…³ã€‚ä¾‹å¦‚ï¼Œå½“ Deployment åˆ›å»ºæ–° Pod æ—¶ï¼ŒService çš„ Endpoints ä¼šè‡ªåŠ¨æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="è”ç³»ä¸åä½œ"&gt;&lt;strong&gt;è”ç³»ä¸åä½œ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŠ¨æ€å…³è”"&gt;&lt;strong&gt;åŠ¨æ€å…³è”&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment åˆ›å»º Pod&lt;/strong&gt;ï¼šDeployment æ ¹æ® Pod æ¨¡æ¿ç”Ÿæˆ Podï¼Œå¹¶ä¸ºå…¶æ·»åŠ æ ‡ç­¾ï¼ˆå¦‚ &lt;code&gt;app: nginx&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Service å…³è” Pod&lt;/strong&gt;ï¼šService é€šè¿‡ &lt;code&gt;selector&lt;/code&gt; åŒ¹é…ç›¸åŒæ ‡ç­¾çš„ Podï¼Œå½¢æˆåŠ¨æ€ Endpoints åˆ—è¡¨ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# Deployment å®šä¹‰ Pod æ ‡ç­¾&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ ‡ç­¾ç”¨äº Service åŒ¹é…&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c"&gt;# Service é€šè¿‡ selector å…³è” Pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# åŒ¹é… Deployment çš„ Pod æ ‡ç­¾&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åä½œåœºæ™¯"&gt;&lt;strong&gt;åä½œåœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹æµç¨‹&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ Deployment éƒ¨ç½²åº”ç”¨ï¼ˆå¦‚ Nginxï¼‰å¹¶æŒ‡å®šå‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»º Service æš´éœ²åº”ç”¨ï¼Œå¤–éƒ¨ç”¨æˆ·é€šè¿‡ Service çš„ IP æˆ– DNS åç§°è®¿é—®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜çº§åŠŸèƒ½&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é‡‘ä¸é›€å‘å¸ƒ&lt;/strong&gt;ï¼šDeployment åˆ†æ‰¹æ¬¡æ›´æ–° Podï¼ŒService å°†æµé‡é€æ­¥åˆ‡åˆ°æ–°ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨å‘½åç©ºé—´è®¿é—®&lt;/strong&gt;ï¼šService å¯é€šè¿‡ DNS åç§°ï¼ˆå¦‚ &lt;code&gt;my-service.namespace.svc.cluster.local&lt;/code&gt;ï¼‰è¢«å…¶ä»–å‘½åç©ºé—´çš„åº”ç”¨è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®é™…åº”ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;å®é™…åº”ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åŒæ—¶å®šä¹‰-deployment-å’Œ-service"&gt;&lt;strong&gt;åŒæ—¶å®šä¹‰ Deployment å’Œ Service&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# Deployment ç®¡ç† Pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx-deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx:1.19.0&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;containerPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c"&gt;# Service æš´éœ²è®¿é—®å…¥å£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;NodePort&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# åŒ¹é… Deployment çš„ Pod æ ‡ç­¾&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;protocol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;TCP&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="éªŒè¯éƒ¨ç½²"&gt;&lt;strong&gt;éªŒè¯éƒ¨ç½²&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æŸ¥çœ‹ Deployment çŠ¶æ€ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl get deployments &lt;span class="c1"&gt;# æ˜¾ç¤º READY å‰¯æœ¬æ•°åŠæ›´æ–°è¿›åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ Service å…³è”çš„ Endpointsï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;kubectl get endpoints nginx-service &lt;span class="c1"&gt;# æ˜¾ç¤ºåç«¯ Pod IP åˆ—è¡¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-16"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒºåˆ«&lt;/strong&gt;ï¼šDeployment ç®¡ç† &lt;strong&gt;åº”ç”¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;ï¼ŒService ç®¡ç† &lt;strong&gt;ç½‘ç»œè®¿é—®çš„æŠ½è±¡å±‚&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è”ç³»&lt;/strong&gt;ï¼šä¸¤è€…é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ååŒå·¥ä½œï¼ŒService ä¾èµ– Deployment åˆ›å»ºçš„ Pod æä¾›ç¨³å®šçš„åç«¯æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šåœ¨ Kubernetes ä¸­ï¼Œé€šå¸¸ &lt;strong&gt;åŒæ—¶ä½¿ç”¨&lt;/strong&gt; Deployment å’Œ Serviceï¼Œå‰è€…ç¡®ä¿åº”ç”¨é«˜å¯ç”¨ï¼Œåè€…å®ç°æœåŠ¡å¯å‘ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="deployment-vs-pod"&gt;Deployment vs. Pod
&lt;/h2&gt;&lt;p&gt;ä¸€ä¸ª &lt;strong&gt;Deployment&lt;/strong&gt; å¹¶ä¸ä¸€å®šå¯¹åº”ä¸€ä¸ª &lt;strong&gt;Pod&lt;/strong&gt;ï¼ŒäºŒè€…çš„å…³ç³»å–å†³äº Deployment çš„é…ç½®ï¼ˆå°¤å…¶æ˜¯ &lt;code&gt;replicas&lt;/code&gt; å­—æ®µï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ä¸è”ç³»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå…³ç³»"&gt;&lt;strong&gt;æ ¸å¿ƒå…³ç³»&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Deployment ç®¡ç† Pod çš„å‰¯æœ¬é›†&lt;/strong&gt;&lt;br&gt;
Deployment é€šè¿‡å®šä¹‰ &lt;code&gt;replicas&lt;/code&gt; å‚æ•°æ§åˆ¶ Pod çš„å‰¯æœ¬æ•°é‡ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# åˆ›å»º 3 ä¸ªç›¸åŒçš„ Pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤æƒ…å†µ&lt;/strong&gt;ï¼šè‹¥æœªæŒ‡å®š &lt;code&gt;replicas&lt;/code&gt;ï¼Œé»˜è®¤åˆ›å»º 1 ä¸ª Podã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•&lt;/strong&gt;ï¼šå¯é€šè¿‡ &lt;code&gt;kubectl scale&lt;/code&gt; å‘½ä»¤è°ƒæ•´å‰¯æœ¬æ•°ï¼Œä¾‹å¦‚ä» 1 ä¸ª Pod æ‰©å±•åˆ° 3 ä¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Pod æ˜¯ Deployment çš„æœ€å°å•å…ƒ&lt;/strong&gt;&lt;br&gt;
Deployment å¹¶ä¸ç›´æ¥åˆ›å»º Podï¼Œè€Œæ˜¯é€šè¿‡ç”Ÿæˆ &lt;strong&gt;ReplicaSet&lt;/strong&gt; é—´æ¥ç®¡ç† Podã€‚æ¯ä¸ª ReplicaSet è´Ÿè´£ç¡®ä¿æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬å§‹ç»ˆè¿è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="deployment-çš„æ ¸å¿ƒä½œç”¨"&gt;&lt;strong&gt;Deployment çš„æ ¸å¿ƒä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Pod ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨æ¢å¤&lt;/strong&gt;ï¼šè‹¥æŸä¸ª Pod å´©æºƒï¼ŒDeployment ä¼šåˆ›å»ºæ–° Pod æ›¿æ¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ»šåŠ¨æ›´æ–°&lt;/strong&gt;ï¼šé€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬ Podï¼Œç¡®ä¿æœåŠ¡ä¸ä¸­æ–­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬å›æ»š&lt;/strong&gt;ï¼šæ”¯æŒå›é€€åˆ°å†å²ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å£°æ˜å¼é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡ YAML å®šä¹‰æœŸæœ›çŠ¶æ€ï¼ˆå¦‚å‰¯æœ¬æ•°ã€é•œåƒç‰ˆæœ¬ï¼‰ï¼ŒDeployment è‡ªåŠ¨åè°ƒå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½•æ—¶ä¸€ä¸ª-deployment-å¯¹åº”ä¸€ä¸ª-pod"&gt;&lt;strong&gt;ä½•æ—¶ä¸€ä¸ª Deployment å¯¹åº”ä¸€ä¸ª Podï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»…åœ¨ä»¥ä¸‹æƒ…å†µæ—¶ï¼ŒDeployment ä¼šå¯¹åº”ä¸€ä¸ª Podï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜¾å¼é…ç½® &lt;code&gt;replicas: 1&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# ä»…è¿è¡Œ 1 ä¸ª Pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœªæŒ‡å®š &lt;code&gt;replicas&lt;/code&gt; å­—æ®µ&lt;/strong&gt;&lt;br&gt;
Kubernetes é»˜è®¤åˆ›å»º 1 ä¸ª Podã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç”Ÿäº§ç¯å¢ƒä¸­çš„å…¸å‹åœºæ™¯"&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒä¸­çš„å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨éƒ¨ç½²&lt;/strong&gt;&lt;br&gt;
é€šå¸¸è®¾ç½® &lt;code&gt;replicas &amp;gt;= 2&lt;/code&gt;ï¼Œç¡®ä¿è‡³å°‘ 2 ä¸ª Pod åŒæ—¶è¿è¡Œï¼Œé¿å…å•ç‚¹æ•…éšœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ä¸æ‰©ç¼©å®¹&lt;/strong&gt;&lt;br&gt;
Service é€šè¿‡è´Ÿè½½å‡è¡¡å°†æµé‡åˆ†å‘åˆ° Deployment ç®¡ç†çš„å¤šä¸ª Podã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-17"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Deployment ä¸ Pod æ˜¯ 1:N çš„å…³ç³»&lt;/strong&gt;ï¼Œå…·ä½“æ•°é‡ç”± &lt;code&gt;replicas&lt;/code&gt; å†³å®šã€‚&lt;/li&gt;
&lt;li&gt;Deployment çš„æ ¸å¿ƒä»·å€¼åœ¨äº &lt;strong&gt;ç®¡ç†ä¸€ç»„ç›¸åŒçš„ Pod&lt;/strong&gt;ï¼Œè€Œéå•ä¸ªå®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡çµæ´»è°ƒæ•´ &lt;code&gt;replicas&lt;/code&gt;ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾å®ç°åº”ç”¨çš„å¼¹æ€§æ‰©å±•ä¸é«˜å¯ç”¨æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨æµé‡é«˜å³°æ—¶æ‰©å®¹ Pod æ•°é‡ï¼Œä½è°·æ—¶ç¼©å®¹ä»¥èŠ‚çœèµ„æºã€‚&lt;/p&gt;
&lt;h2 id="pod--container"&gt;Pod &amp;amp; Container
&lt;/h2&gt;&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œ&lt;strong&gt;ä¸€ä¸ª Pod æ˜¯å¦éœ€è¦åªåŒ…å«ä¸€ä¸ª Container å–å†³äºå…·ä½“åœºæ™¯&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯çš„æ·±åº¦è§£æä¸æœ€ä½³å®è·µå»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å•å®¹å™¨-podæœ€å¸¸è§åœºæ™¯"&gt;&lt;strong&gt;å•å®¹å™¨ Podï¼šæœ€å¸¸è§åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€‚ç”¨æ¡ä»¶"&gt;&lt;strong&gt;é€‚ç”¨æ¡ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•åº”ç”¨&lt;/strong&gt;ï¼šæ— å¤æ‚ä¾èµ–æˆ–åä½œéœ€æ±‚ï¼ˆå¦‚ç‹¬ç«‹çš„ Web æœåŠ¡ã€æ•°æ®åº“ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— çŠ¶æ€æœåŠ¡&lt;/strong&gt;ï¼šæ— éœ€å…±äº«å­˜å‚¨æˆ–ç½‘ç»œèµ„æºï¼ˆå¦‚ API æœåŠ¡ã€è®¡ç®—ä»»åŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ‡å‡†åŒ–è¿ç»´&lt;/strong&gt;ï¼šç®€åŒ–ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé¿å…å¤šå®¹å™¨è°ƒè¯•çš„å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜åŠ¿"&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡åŒ–&lt;/strong&gt;ï¼šèµ„æºå ç”¨æ›´å°‘ï¼Œè°ƒåº¦æ›´é«˜æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜“ç®¡ç†&lt;/strong&gt;ï¼šæ—¥å¿—ã€ç›‘æ§ã€æ‰©ç¼©å®¹ç­‰æ“ä½œæ›´ç›´è§‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§&lt;/strong&gt;ï¼šé€‚é…å¤§å¤šæ•° CI/CD å·¥å…·é“¾ï¼Œé™ä½éƒ¨ç½²å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;single-container-pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;nginx:latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å¤šå®¹å™¨-podé«˜çº§åœºæ™¯"&gt;&lt;strong&gt;å¤šå®¹å™¨ Podï¼šé«˜çº§åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€‚ç”¨æ¡ä»¶-1"&gt;&lt;strong&gt;é€‚ç”¨æ¡ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´§å¯†è€¦åˆçš„åä½œéœ€æ±‚&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¾¹è½¦ï¼ˆSidecarï¼‰æ¨¡å¼&lt;/strong&gt;ï¼šä¸»å®¹å™¨è´Ÿè´£æ ¸å¿ƒä¸šåŠ¡ï¼Œè¾¹è½¦å®¹å™¨å¤„ç†æ—¥å¿—æ”¶é›†ï¼ˆå¦‚ Fluentdï¼‰ã€ç›‘æ§ï¼ˆå¦‚ Prometheus Agentï¼‰æˆ–ä»£ç†æµé‡ï¼ˆå¦‚ Envoyï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Adapter/Ambassador æ¨¡å¼&lt;/strong&gt;ï¼šæ•°æ®æ ¼å¼è½¬æ¢ï¼ˆAdapterï¼‰æˆ–ä»£ç†å¤–éƒ¨æœåŠ¡ï¼ˆAmbassadorï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«èµ„æºéœ€æ±‚&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¤šä¸ªå®¹å™¨éœ€è¦å…±äº«å­˜å‚¨å·ï¼ˆå¦‚ä¸»å®¹å™¨å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œè¾¹è½¦å®¹å™¨è¯»å–å¹¶ä¸Šä¼ è‡³äº‘å­˜å‚¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼ˆå¦‚é€šè¿‡ &lt;code&gt;localhost&lt;/code&gt; ç›´æ¥é€šä¿¡ï¼Œé¿å…è·¨ Pod ç½‘ç»œå¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜åŠ¿-1"&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºå…±äº«&lt;/strong&gt;ï¼šé¿å…é‡å¤æŒ‚è½½å­˜å‚¨å·æˆ–æš´éœ²ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿¡é«˜æ•ˆ&lt;/strong&gt;ï¼šé€šè¿‡æœ¬åœ°å›ç¯ç½‘ç»œï¼ˆ&lt;code&gt;localhost&lt;/code&gt;ï¼‰é™ä½å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸåŒæ­¥&lt;/strong&gt;ï¼šå¤šä¸ªå®¹å™¨ç»Ÿä¸€å¯åœï¼Œç¡®ä¿åä½œä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ï¼ˆè¾¹è½¦æ¨¡å¼ï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;multi-container-pod&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-app:latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;logs&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/var/logs&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;log-processor&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;fluentd:latest&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;logs&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/var/logs&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;logs&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;emptyDir&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;{}&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒè®¾è®¡åŸåˆ™"&gt;&lt;strong&gt;æ ¸å¿ƒè®¾è®¡åŸåˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä½•æ—¶é€‰æ‹©å¤šå®¹å™¨-pod"&gt;&lt;strong&gt;ä½•æ—¶é€‰æ‹©å¤šå®¹å™¨ Podï¼Ÿ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿…è¦æ€§&lt;/strong&gt;ï¼šä»…å½“å®¹å™¨éœ€è¦&lt;strong&gt;å…±äº«èµ„æº&lt;/strong&gt;æˆ–&lt;strong&gt;ç›´æ¥åä½œ&lt;/strong&gt;æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åæ¨¡å¼&lt;/strong&gt;ï¼šé¿å…å°†æ— å…³å®¹å™¨å¼ºè¡Œå¡å…¥åŒä¸€ Podï¼ˆå¦‚ç‹¬ç«‹çš„å‰ç«¯å’Œåç«¯æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èŒè´£å•ä¸€&lt;/strong&gt;ï¼šæ¯ä¸ªå®¹å™¨åº”ä¸“æ³¨äºå•ä¸€åŠŸèƒ½ï¼ˆå¦‚ä¸»ä¸šåŠ¡ã€æ—¥å¿—å¤„ç†ã€ç½‘ç»œä»£ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºéš”ç¦»&lt;/strong&gt;ï¼šä¸ºæ¯ä¸ªå®¹å™¨å•ç‹¬é…ç½®èµ„æºé™åˆ¶ï¼ˆCPU/å†…å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼šä¸ºæ‰€æœ‰å®¹å™¨å®šä¹‰ &lt;code&gt;livenessProbe&lt;/code&gt; å’Œ &lt;code&gt;readinessProbe&lt;/code&gt;ï¼Œé¿å…éƒ¨åˆ†å®¹å™¨æ•…éšœå¯¼è‡´æ•´ä¸ª Pod ä¸å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-18"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…³é”®è€ƒé‡&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç®€å•ç‹¬ç«‹æœåŠ¡&lt;/td&gt;
&lt;td&gt;å•å®¹å™¨ Pod&lt;/td&gt;
&lt;td&gt;ç®€åŒ–è¿ç»´ï¼Œå‡å°‘èµ„æºå¼€é”€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ—¥å¿—/ç›‘æ§ä»£ç†&lt;/td&gt;
&lt;td&gt;å¤šå®¹å™¨ Podï¼ˆè¾¹è½¦æ¨¡å¼ï¼‰&lt;/td&gt;
&lt;td&gt;å…±äº«å­˜å‚¨å·ï¼Œæœ¬åœ°ç½‘ç»œé€šä¿¡é«˜æ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®é¢„å¤„ç†&lt;/td&gt;
&lt;td&gt;å¤šå®¹å™¨ Podï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰&lt;/td&gt;
&lt;td&gt;é¿å…è·¨ Pod æ•°æ®ä¼ è¾“ï¼Œæå‡æ€§èƒ½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆå»ºè®®&lt;/strong&gt;ï¼š&lt;br&gt;
é»˜è®¤ä½¿ç”¨å•å®¹å™¨ Podï¼Œä»…åœ¨&lt;strong&gt;å¿…é¡»å…±äº«èµ„æºæˆ–åä½œ&lt;/strong&gt;æ—¶å¼•å…¥å¤šå®¹å™¨è®¾è®¡ã€‚ä¾‹å¦‚ï¼Œè‹¥éœ€ä¸º Web æœåŠ¡æ·»åŠ å®æ—¶æ—¥å¿—åˆ†æï¼Œå¯é€šè¿‡è¾¹è½¦å®¹å™¨å®ç°ï¼›ä½†è‹¥åªæ˜¯éƒ¨ç½²ç‹¬ç«‹å¾®æœåŠ¡ï¼Œåˆ™ä¼˜å…ˆæ‹†åˆ†ä¸ºå¤šä¸ª Podã€‚&lt;/p&gt;
&lt;h2 id="imagepullpolicy"&gt;imagePullPolicy
&lt;/h2&gt;&lt;p&gt;Kubernetes ä¸­çš„ &lt;strong&gt;&lt;code&gt;imagePullPolicy: Never&lt;/code&gt;&lt;/strong&gt; æ˜¯ä¸€ç§é•œåƒæ‹‰å–ç­–ç•¥ï¼Œç”¨äºæ˜ç¡®ç¦æ­¢ä»è¿œç¨‹é•œåƒä»“åº“æ‹‰å–é•œåƒã€‚è¯¥ç­–ç•¥çš„æ ¸å¿ƒé€»è¾‘å’Œé€‚ç”¨åœºæ™¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå®šä¹‰ä¸è¡Œä¸º"&gt;&lt;strong&gt;æ ¸å¿ƒå®šä¹‰ä¸è¡Œä¸º&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬åœ°é•œåƒå¼ºåˆ¶ä¾èµ–&lt;/strong&gt;&lt;br&gt;
å½“å®¹å™¨é…ç½®äº† &lt;code&gt;imagePullPolicy: Never&lt;/code&gt; æ—¶ï¼ŒKubernetes ä¼šå‡è®¾æ‰€éœ€é•œåƒå·²å­˜åœ¨äºèŠ‚ç‚¹æœ¬åœ°ç¼“å­˜ä¸­ï¼Œä¸”&lt;strong&gt;ä¸ä¼šå°è¯•ä»ä»»ä½•è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒ&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æœ¬åœ°å­˜åœ¨é•œåƒ â†’ ç›´æ¥ä½¿ç”¨æœ¬åœ°é•œåƒå¯åŠ¨å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æœ¬åœ°ä¸å­˜åœ¨é•œåƒ â†’ Pod å¯åŠ¨å¤±è´¥ï¼Œè¿›å…¥ &lt;code&gt;ErrImageNeverPull&lt;/code&gt; é”™è¯¯çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®Œå…¨ç¦»çº¿åœºæ™¯é€‚ç”¨&lt;/strong&gt;&lt;br&gt;
è¯¥ç­–ç•¥é€‚ç”¨äº&lt;strong&gt;å®Œå…¨ç¦»çº¿ç¯å¢ƒ&lt;/strong&gt;æˆ–&lt;strong&gt;å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°é¢„æ„å»ºé•œåƒ&lt;/strong&gt;çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ä¸šå†…ç½‘ç¯å¢ƒæ— å¤–ç½‘è®¿é—®æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ä¸¥æ ¼ç®¡æ§é•œåƒç‰ˆæœ¬ï¼Œé¿å…æ„å¤–æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–ç­–ç•¥çš„å¯¹æ¯”"&gt;&lt;strong&gt;ä¸å…¶ä»–ç­–ç•¥çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¡Œä¸º&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Never&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä¸å°è¯•æ‹‰å–è¿œç¨‹é•œåƒ&lt;/td&gt;
&lt;td&gt;ç¦»çº¿ç¯å¢ƒã€æœ¬åœ°è°ƒè¯•ã€ç‰ˆæœ¬é”å®š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;IfNotPresent&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼˜å…ˆä½¿ç”¨æœ¬åœ°é•œåƒï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ‹‰å–è¿œç¨‹é•œåƒ&lt;/td&gt;
&lt;td&gt;å¸¸è§„åœºæ™¯ï¼ˆå¹³è¡¡æ•ˆç‡å’Œæ›´æ–°ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Always&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¼ºåˆ¶ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆå³ä½¿æœ¬åœ°å·²å­˜åœ¨ï¼‰&lt;/td&gt;
&lt;td&gt;éœ€è¦å®æ—¶æ›´æ–°é•œåƒçš„æµ®åŠ¨æ ‡ç­¾ï¼ˆå¦‚ &lt;code&gt;:latest&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;ä½¿ç”¨æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬åœ°é•œåƒç®¡ç†è¦æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€ç¡®ä¿æ‰€æœ‰ Kubernetes èŠ‚ç‚¹ä¸Šå·²é€šè¿‡æ‰‹åŠ¨æ–¹å¼ï¼ˆå¦‚ &lt;code&gt;docker load&lt;/code&gt;ï¼‰é¢„åŠ è½½æ‰€éœ€é•œåƒã€‚&lt;/li&gt;
&lt;li&gt;é•œåƒå­˜å‚¨è·¯å¾„å› å®¹å™¨è¿è¡Œæ—¶ä¸åŒè€Œå¼‚ï¼ˆå¦‚ Containerd ä¸º &lt;code&gt;/var/lib/containerd&lt;/code&gt;ï¼ŒDocker ä¸º &lt;code&gt;/var/lib/docker&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯æ’æŸ¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ Pod æŠ¥é”™ &lt;code&gt;ErrImageNeverPull&lt;/code&gt;ï¼Œéœ€æ£€æŸ¥ï¼š
&lt;ol&gt;
&lt;li&gt;èŠ‚ç‚¹æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šé•œåƒï¼ˆé€šè¿‡ &lt;code&gt;docker images&lt;/code&gt; æˆ– &lt;code&gt;crictl images&lt;/code&gt; éªŒè¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é•œåƒåç§°å’Œæ ‡ç­¾æ˜¯å¦ä¸ Pod é…ç½®å®Œå…¨åŒ¹é…ï¼ˆåŒ…æ‹¬å¤§å°å†™æ•æ„Ÿï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸æ ‡ç­¾çš„å…³è”æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æœªæ˜¾å¼æŒ‡å®š &lt;code&gt;imagePullPolicy&lt;/code&gt;ï¼ŒKubernetes é»˜è®¤è¡Œä¸ºå¦‚ä¸‹ï¼š
&lt;ul&gt;
&lt;li&gt;é•œåƒæ ‡ç­¾ä¸º &lt;code&gt;:latest&lt;/code&gt; â†’ &lt;code&gt;imagePullPolicy: Always&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é•œåƒæ ‡ç­¾é &lt;code&gt;:latest&lt;/code&gt; â†’ &lt;code&gt;imagePullPolicy: IfNotPresent&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬åœ°å¼€å‘è°ƒè¯•&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ Minikube æˆ– Kind æ—¶ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ„å»ºçš„é•œåƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# æ„å»ºé•œåƒå¹¶æ ‡è®°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker build -t my-app:debug .
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è®¾ç½® Minikube ä½¿ç”¨æœ¬åœ° Docker ç¯å¢ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;eval&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;minikube docker-env&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# éƒ¨ç½²æ—¶é…ç½® Never ç­–ç•¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-app:debug&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;imagePullPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Never&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ•æ„Ÿç¯å¢ƒ&lt;/strong&gt;&lt;br&gt;
åœ¨é‡‘èã€å†›å·¥ç­‰åœºæ™¯ä¸­ï¼Œé€šè¿‡é¢„å®¡é•œåƒå¹¶é”å®šç‰ˆæœ¬ï¼Œé¿å…æœªç»æˆæƒçš„é•œåƒæ›´æ–°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-19"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;imagePullPolicy: Never&lt;/code&gt; æ˜¯ä¸€ç§&lt;strong&gt;å¼ºçº¦æŸæ€§ç­–ç•¥&lt;/strong&gt;ï¼Œè¦æ±‚è¿ç»´å›¢é˜Ÿå…·å¤‡å®Œå–„çš„æœ¬åœ°é•œåƒåˆ†å‘å’Œç®¡ç†èƒ½åŠ›ã€‚å…¶ä¼˜åŠ¿åœ¨äºé¿å…ç½‘ç»œä¾èµ–å’Œæ„å¤–æ›´æ–°ï¼Œä½†éœ€è­¦æƒ•å› é•œåƒç¼ºå¤±å¯¼è‡´çš„ Pod å¯åŠ¨å¤±è´¥é£é™©ã€‚åˆç†ä½¿ç”¨è¯¥ç­–ç•¥å¯æå‡ç¯å¢ƒç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œä½†éœ€ç»“åˆå…·ä½“éœ€æ±‚æƒè¡¡åˆ©å¼Šã€‚&lt;/p&gt;</description></item><item><title>ã€Postopiaã€‘UserId</title><link>https://dyhes.github.io/p/postopiauserid/</link><pubDate>Sat, 17 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiauserid/</guid><description>&lt;h2 id="è¯·æ±‚å“åº”bodyåŠ å¯†"&gt;è¯·æ±‚å“åº”bodyåŠ å¯†
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Cloud Gatewayä¸­å®ç°é’ˆå¯¹&lt;code&gt;userId&lt;/code&gt;å­—æ®µçš„è‡ªåŠ¨åŠ è§£å¯†ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼ˆ&lt;code&gt;GlobalFilter&lt;/code&gt;ï¼‰ç»“åˆJSONè§£æå’ŒAESåŠ è§£å¯†ç®—æ³•å®ç°ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°åŸç†"&gt;&lt;strong&gt;å®ç°åŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚è§£å¯†&lt;/strong&gt;ï¼šæ‹¦æˆªè¯·æ±‚ä½“ï¼Œè§£æJSONå†…å®¹ï¼Œè‹¥å­˜åœ¨&lt;code&gt;userId&lt;/code&gt;å­—æ®µåˆ™è§£å¯†å…¶å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”åŠ å¯†&lt;/strong&gt;ï¼šæ‹¦æˆªå“åº”ä½“ï¼Œè§£æJSONå†…å®¹ï¼Œè‹¥å­˜åœ¨&lt;code&gt;userId&lt;/code&gt;å­—æ®µåˆ™åŠ å¯†å…¶å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;GlobalFilter&lt;/code&gt;æ‹¦æˆªè¯·æ±‚å’Œå“åº”ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;ServerHttpRequestDecorator&lt;/code&gt;å’Œ&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt;åŒ…è£…åŸå§‹è¯·æ±‚å’Œå“åº”ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨AESç®—æ³•å®ç°åŠ è§£å¯†é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æ­¥éª¤"&gt;&lt;strong&gt;å®ç°æ­¥éª¤&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å®šä¹‰åŠ è§£å¯†å·¥å…·ç±»"&gt;&lt;strong&gt;1 å®šä¹‰åŠ è§£å¯†å·¥å…·ç±»&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AESUtil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AES_KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;your-32byte-secret-key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IV&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;initialization-vector&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ALGORITHM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;AES/CBC/PKCS5Padding&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ å¯†userIdå­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cipher&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ALGORITHM&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecretKeySpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecretKeySpec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AES_KEY&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;AES&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IvParameterSpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivSpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IvParameterSpec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ENCRYPT_MODE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySpec&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivSpec&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;doFinal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Base64&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getEncoder&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;encodeToString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;åŠ å¯†å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§£å¯†userIdå­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cipher&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ALGORITHM&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecretKeySpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecretKeySpec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AES_KEY&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;AES&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IvParameterSpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivSpec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IvParameterSpec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;DECRYPT_MODE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keySpec&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivSpec&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoded&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Base64&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDecoder&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encryptedText&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cipher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;doFinal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoded&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;è§£å¯†å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="2-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"&gt;&lt;strong&gt;2 è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserIdCryptoFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ordered&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1. è¯·æ±‚å¤„ç†ï¼šè§£å¯†userId&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequestDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;requestBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonObject&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonParser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;requestBody&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getAsJsonObject&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;has&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedUserId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getAsString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedUserId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AESUtil&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encryptedUserId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedUserId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 2. å“åº”å¤„ç†ï¼šåŠ å¯†userId&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponseDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Publisher&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;from&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responseBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonObject&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonParser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;responseBody&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getAsJsonObject&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;has&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainUserId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getAsString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedUserId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AESUtil&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plainUserId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedUserId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedRequest&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getOrder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é«˜ä¼˜å…ˆçº§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…³é”®å®ç°ç»†èŠ‚"&gt;&lt;strong&gt;å…³é”®å®ç°ç»†èŠ‚&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JSONè§£æä¸ä¿®æ”¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;JsonParser&lt;/code&gt;è§£æè¯·æ±‚/å“åº”ä½“ä¸­çš„JSONæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;ä»…é’ˆå¯¹&lt;code&gt;userId&lt;/code&gt;å­—æ®µè¿›è¡ŒåŠ è§£å¯†ï¼Œå…¶ä»–å­—æ®µä¿æŒä¸å˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµå¼æ•°æ®å¤„ç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;DataBufferUtils&lt;/code&gt;å¤„ç†è¯·æ±‚ä½“å’Œå“åº”ä½“çš„æµå¼æ•°æ®ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ è§£å¯†å¤±è´¥æ—¶æŠ›å‡º&lt;code&gt;RuntimeException&lt;/code&gt;ï¼Œå¯é€šè¿‡å…¨å±€å¼‚å¸¸å¤„ç†å™¨è¿”å›&lt;code&gt;HTTP 400 Bad Request&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜æœºåˆ¶å­˜å‚¨åŠ è§£å¯†åçš„æ•°æ®ï¼Œé¿å…é‡å¤è§£æJSONã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆHTTPSä¼ è¾“å‡å°‘æ•æ„Ÿå­—æ®µçš„æš´éœ²é£é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ä¸æµ‹è¯•"&gt;&lt;strong&gt;é…ç½®ä¸æµ‹è¯•&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±é…ç½®&lt;/strong&gt;ï¼ˆ&lt;code&gt;application.yml&lt;/code&gt;ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;user_service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;lb://user-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;predicates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;Path=/api/users/**&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;filters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;UserIdCryptoFilter&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•è¯·æ±‚&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åŸå§‹è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;å¼ ä¸‰&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åŠ å¯†åè¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;xq4YR89LgUs4V5N5juKgW5hIsiOsCxBOwzX632S8NV4&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;å¼ ä¸‰&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯†é’¥ç®¡ç†&lt;/strong&gt;ï¼šå»ºè®®å°†AESå¯†é’¥å­˜å‚¨åœ¨å®‰å…¨é…ç½®ä¸­å¿ƒï¼ˆå¦‚Spring Cloud Configï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç™½åå•æœºåˆ¶&lt;/strong&gt;ï¼šå¯å‚è€ƒä¸­çš„ç™½åå•é…ç½®ï¼Œæ’é™¤æ— éœ€åŠ è§£å¯†çš„æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;ï¼šé€šè¿‡è¯·æ±‚å¤´&lt;code&gt;crypto-version&lt;/code&gt;æ ‡è¯†åŠ å¯†ç®—æ³•ç‰ˆæœ¬ï¼Œä¾¿äºåç»­å‡çº§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯ä»¥å®ç°å¯¹&lt;code&gt;userId&lt;/code&gt;å­—æ®µçš„ç²¾ç»†åŒ–åŠ è§£å¯†æ§åˆ¶ï¼ŒåŒæ—¶ä¿æŒç½‘å…³çš„é«˜æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id="ç°å­˜é—®é¢˜"&gt;ç°å­˜é—®é¢˜
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Gateway çš„å“åº”è¿‡æ»¤å™¨ä¸­å¯¹æ¯ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; åˆ†åˆ«ä½¿ç”¨ &lt;code&gt;JsonParser.parseString&lt;/code&gt; çš„åŸå› ï¼Œéœ€è¦ç»“åˆ &lt;strong&gt;æµå¼ä¼ è¾“ç‰¹æ€§&lt;/strong&gt; å’Œ &lt;strong&gt;å“åº”å¼ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt; æ¥ç†è§£ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æµå¼å“åº”ä½“çš„åˆ†å—ç‰¹æ€§"&gt;&lt;strong&gt;æµå¼å“åº”ä½“çš„åˆ†å—ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨ HTTP å“åº”ä¸­ï¼Œæ•°æ®å¯èƒ½ä»¥ &lt;strong&gt;åˆ†å—ï¼ˆChunkedï¼‰&lt;/strong&gt; å½¢å¼ä¼ è¾“ï¼Œæ¯ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; ä»…åŒ…å«éƒ¨åˆ†æ•°æ®ã€‚ä½†åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œå•ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; å¯èƒ½åŒ…å«å®Œæ•´çš„ JSON ç‰‡æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°å“åº”ä½“&lt;/strong&gt;ï¼šè‹¥å“åº”ä½“è¾ƒå°ï¼ˆä¾‹å¦‚ä»…åŒ…å«ä¸€ä¸ª JSON å¯¹è±¡ï¼‰ï¼Œå¯èƒ½ä¸€æ¬¡æ€§åŠ è½½åˆ°å•ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å—ç­–ç•¥&lt;/strong&gt;ï¼šä¸‹æ¸¸æœåŠ¡å¯èƒ½æŒ‰é€»è¾‘åˆ†å—ï¼ˆä¾‹å¦‚æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰ï¼Œä½¿æ¯ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; æ˜¯ç‹¬ç«‹çš„ JSON ç‰‡æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œä»£ç å‡è®¾æ¯ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; åŒ…å«å®Œæ•´çš„ JSON å¯¹è±¡ï¼Œä»è€Œç›´æ¥è§£æã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å“åº”å¼æµçš„é€å—å¤„ç†"&gt;&lt;strong&gt;å“åº”å¼æµçš„é€å—å¤„ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Cloud Gateway åŸºäº Reactor çš„å“åº”å¼æµæ¨¡å‹ï¼Œé€šè¿‡ &lt;code&gt;Flux&amp;lt;DataBuffer&amp;gt;&lt;/code&gt; æŒ‰é¡ºåºå¤„ç†æ•°æ®å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;map&lt;/code&gt; æ“ä½œç¬¦&lt;/strong&gt;ï¼šå¯¹æ¯ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; ç‹¬ç«‹å¤„ç†ï¼Œä¸ä¾èµ–å‰åæ•°æ®å—çš„ä¸Šä¸‹æ–‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éé˜»å¡æ€§&lt;/strong&gt;ï¼šé€ä¸ªå¤„ç†åˆ†å—ï¼Œé¿å…ç¼“å†²æ•´ä¸ªå“åº”ä½“ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†éœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¨åˆ†å—é£é™©&lt;/strong&gt;ï¼šè‹¥ JSON è¢«æ‹†åˆ†ä¸ºå¤šä¸ª &lt;code&gt;DataBuffer&lt;/code&gt;ï¼ˆä¾‹å¦‚å¤§å¯¹è±¡æˆ–æ•°ç»„ï¼‰ï¼Œå•ç‹¬è§£ææ¯ä¸ªåˆ†å—ä¼šå¯¼è‡´å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯é™åˆ¶&lt;/strong&gt;ï¼šç¤ºä¾‹ä»£ç é€‚ç”¨äºåˆ†å—ç­–ç•¥ä¸ JSON ç»“æ„å¯¹é½çš„åœºæ™¯ï¼ˆä¾‹å¦‚æ¯ä¸ªåˆ†å—æ˜¯ç‹¬ç«‹çš„ JSON å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä»£ç ç¤ºä¾‹çš„æ½œåœ¨é—®é¢˜ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹çš„æ½œåœ¨é—®é¢˜ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç”¨æˆ·æä¾›çš„ä»£ç ç‰‡æ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;from&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responseBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonObject&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonParser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;responseBody&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getAsJsonObject&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿®æ”¹ JSON&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ½œåœ¨é—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;JSON è·¨åˆ†å—&lt;/strong&gt;ï¼šè‹¥ä¸€ä¸ª JSON å¯¹è±¡è¢«æ‹†åˆ†ä¸ºå¤šä¸ª &lt;code&gt;DataBuffer&lt;/code&gt;ï¼Œè§£æä¼šæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æŸè€—&lt;/strong&gt;ï¼šé¢‘ç¹è§£æå’Œåºåˆ—åŒ– JSON å¯èƒ½å½±å“æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŒ–æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨é‡ç¼“å†²&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;DataBufferUtils.join&lt;/code&gt; åˆå¹¶æ‰€æœ‰ &lt;code&gt;DataBuffer&lt;/code&gt;ï¼Œå†æ•´ä½“è§£æï¼ˆç‰ºç‰²å†…å­˜æ¢å–å‡†ç¡®æ€§ï¼‰ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;flatMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fullBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fullJson&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fullBuffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§£æå®Œæ•´ JSON&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµå¼è§£æå™¨&lt;/strong&gt;ï¼šä½¿ç”¨æ”¯æŒæµå¼è§£æçš„åº“ï¼ˆå¦‚ Jackson &lt;code&gt;JsonParser&lt;/code&gt;ï¼‰ï¼Œé€å—å¤„ç†å¹¶ç»´æŠ¤è§£æçŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;çŸ­å“åº”æˆ–åˆ†å—å¯¹é½ JSON ç»“æ„çš„åœºæ™¯ï¼ˆä¾‹å¦‚æ—¥å¿—æµã€é€è¡Œ JSONï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä»…éœ€ä¿®æ”¹å±€éƒ¨å­—æ®µä¸”ä¸ç ´å JSON ç»“æ„çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿å“åº”åˆ†å—ç­–ç•¥ä¸ä»£ç é€»è¾‘åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;å¤„ç†è·¨åˆ†å—æ—¶éœ€ç»´æŠ¤ä¸Šä¸‹æ–‡çŠ¶æ€ï¼ˆå¦‚æ‹¬å·åµŒå¥—è®¡æ•°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç§»é™¤ &lt;code&gt;Content-Length&lt;/code&gt; å¤´ï¼Œé¿å…å› ä¿®æ”¹åé•¿åº¦ä¸åŒ¹é…å¯¼è‡´å®¢æˆ·ç«¯è§£æé”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ¯ä¸ª &lt;code&gt;DataBuffer&lt;/code&gt; æ˜¯å¦èƒ½ç‹¬ç«‹è§£æ JSONï¼Œå–å†³äº &lt;strong&gt;ä¸‹æ¸¸æœåŠ¡çš„åˆ†å—ç­–ç•¥&lt;/strong&gt; å’Œ &lt;strong&gt;JSON ç»“æ„è®¾è®¡&lt;/strong&gt;ã€‚ç¤ºä¾‹ä»£ç é€šè¿‡é€ä¸ªå¤„ç†åˆ†å—å®ç°é«˜æ•ˆæµå¼å¤„ç†ï¼Œä½†éœ€ç»“åˆå®é™…åœºæ™¯æƒè¡¡é£é™©ã€‚å¯¹äºå¤æ‚ JSON æˆ–ä¸å¯æ§åˆ†å—çš„æƒ…å†µï¼Œå»ºè®®ä½¿ç”¨å…¨é‡ç¼“å†²æˆ–æµå¼è§£æå™¨ã€‚&lt;/p&gt;
&lt;h2 id="requestparam-åŠ å¯†"&gt;@RequestParam åŠ å¯†
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Gateway ä¸­ï¼Œ&lt;strong&gt;å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è¿‡æ»¤å™¨å¯¹ &lt;code&gt;@RequestParam&lt;/code&gt; å‚æ•°è¿›è¡ŒåŠ è§£å¯†&lt;/strong&gt;ï¼Œä¸”æ”¯æŒå¤„ç†å•ä¸ªå‚æ•°æˆ–åˆ—è¡¨ç±»å‹çš„å‚æ•°ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆå’ŒæŠ€æœ¯ç»†èŠ‚ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°åŸç†-1"&gt;å®ç°åŸç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•°è·å–&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@RequestParam&lt;/code&gt; å‚æ•°ä¼šä»¥ &lt;strong&gt;æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆQuery Stringï¼‰&lt;/strong&gt; çš„å½¢å¼å‡ºç°åœ¨ URL ä¸­ï¼ˆä¾‹å¦‚ &lt;code&gt;?userId=123&amp;amp;userId=456&lt;/code&gt;ï¼‰ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;ServerHttpRequest#getQueryParams()&lt;/code&gt; æ–¹æ³•è·å–å‚æ•°åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ è§£å¯†æµç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è§£å¯†è¯·æ±‚&lt;/strong&gt;ï¼šæ‹¦æˆªè¯·æ±‚å‚æ•°ï¼Œè¯†åˆ«åŠ å¯†å­—æ®µï¼ˆå¦‚ &lt;code&gt;encryptedUserId&lt;/code&gt;ï¼‰ï¼Œè§£å¯†åæ›¿æ¢åŸå§‹å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¯†å“åº”&lt;/strong&gt;ï¼šä¿®æ”¹ä¸‹æ¸¸æœåŠ¡è¿”å›çš„å“åº”æ•°æ®ï¼Œå¯¹ &lt;code&gt;userId&lt;/code&gt; å­—æ®µåŠ å¯†åå†è¿”å›å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ”¯æŒåˆ—è¡¨å‚æ•°&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;MultiValueMap&amp;lt;String, String&amp;gt;&lt;/code&gt; å¤„ç†é‡å¤é”®åï¼ˆå¦‚å¤šä¸ª &lt;code&gt;userId&lt;/code&gt; å€¼ï¼‰ï¼Œç¡®ä¿æ¯ä¸ªå€¼éƒ½èƒ½è¢«å•ç‹¬åŠ è§£å¯†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…·ä½“å®ç°æ­¥éª¤"&gt;å…·ä½“å®ç°æ­¥éª¤
&lt;/h3&gt;&lt;h4 id="å®šä¹‰åŠ è§£å¯†å·¥å…·ç±»"&gt;&lt;strong&gt;å®šä¹‰åŠ è§£å¯†å·¥å…·ç±»&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å‚è€ƒç½‘é¡µ5ä¸­çš„ AES å·¥å…·ç±»ï¼Œæ”¯æŒå¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ è§£å¯†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AESUtil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ å¯†æ–¹æ³•ï¼ˆæ”¯æŒå•ä¸ªå€¼å’Œåˆ—è¡¨ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/*...*/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plainTexts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/*...*/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§£å¯†æ–¹æ³•ï¼ˆæ”¯æŒå•ä¸ªå€¼å’Œåˆ—è¡¨ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/*...*/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedTexts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/*...*/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"&gt;&lt;strong&gt;è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;GlobalFilter&lt;/code&gt; æ‹¦æˆªå¹¶ä¿®æ”¹ &lt;code&gt;@RequestParam&lt;/code&gt; å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ParamCryptoFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ordered&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultiValueMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;queryParams&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getQueryParams&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†åŠ å¯†å‚æ•°ï¼ˆä¾‹å¦‚ encryptedUserIdï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queryParams&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;containsKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;encryptedUserId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encryptedValues&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;queryParams&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;encryptedUserId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedValues&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AESUtil&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encryptedValues&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é‡æ„è¯·æ±‚ URI&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;URI&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newUri&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UriComponentsBuilder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromUri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getURI&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;replaceQueryParam&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedValues&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;replaceQueryParam&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;encryptedUserId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç§»é™¤åŠ å¯†å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toUri&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;newUri&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;newRequest&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getOrder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…³é”®å®ç°ç»†èŠ‚-1"&gt;å…³é”®å®ç°ç»†èŠ‚
&lt;/h3&gt;&lt;h4 id="åˆ—è¡¨å‚æ•°å¤„ç†"&gt;&lt;strong&gt;åˆ—è¡¨å‚æ•°å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¯†åœºæ™¯&lt;/strong&gt;ï¼šè‹¥å‚æ•°æ˜¯åˆ—è¡¨ï¼ˆå¦‚ &lt;code&gt;userId=123&amp;amp;userId=456&lt;/code&gt;ï¼‰ï¼Œéœ€éå†æ¯ä¸ªå€¼å¹¶åŠ å¯†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å¯†åœºæ™¯&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;queryParams.get(&amp;quot;encryptedUserId&amp;quot;)&lt;/code&gt; è·å–æ‰€æœ‰åŠ å¯†å€¼ï¼Œè§£å¯†åé‡æ–°èµ‹å€¼ç»™ &lt;code&gt;userId&lt;/code&gt; å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¯·æ±‚é‡æ„"&gt;&lt;strong&gt;è¯·æ±‚é‡æ„&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;UriComponentsBuilder&lt;/code&gt; åŠ¨æ€ä¿®æ”¹ URL ä¸­çš„æŸ¥è¯¢å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;UriComponentsBuilder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromUri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getURI&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;replaceQueryParam&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decryptedValues&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ”¯æŒåˆ—è¡¨èµ‹å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toUri&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å®‰å…¨æ€§å¢å¼º"&gt;&lt;strong&gt;å®‰å…¨æ€§å¢å¼º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯†é’¥ç®¡ç†&lt;/strong&gt;ï¼šé€šè¿‡é›†æˆé˜¿é‡Œäº‘ KMS æˆ– Vault å®ç°å¯†é’¥åŠ¨æ€è·å–ï¼ˆå‚è€ƒç½‘é¡µ5ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²é‡æ”¾æ”»å‡»&lt;/strong&gt;ï¼šåœ¨å‚æ•°ä¸­æ·»åŠ æ—¶é—´æˆ³å’Œéšæœºæ•°ï¼ˆ&lt;code&gt;timestamp&lt;/code&gt; + &lt;code&gt;nonce&lt;/code&gt;ï¼‰ï¼Œç½‘å…³æ ¡éªŒåæ‹’ç»é‡å¤æˆ–è¶…æ—¶è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ Caffeineï¼‰å­˜å‚¨å·²å¤„ç†çš„ &lt;code&gt;nonce&lt;/code&gt;ï¼Œé¿å…é‡å¤è§£å¯†ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨ç½‘å…³å±‚å¤„ç†è¶…å¤§å‚æ•°åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¼å®¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯éœ€ä½¿ç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•å’Œå¯†é’¥ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¯·æ±‚å¤´ï¼ˆå¦‚ &lt;code&gt;X-Encrypt-Version&lt;/code&gt;ï¼‰æ ‡è¯†åŠ å¯†åè®®ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•è·åŠ è§£å¯†å¼‚å¸¸ï¼Œè¿”å› &lt;code&gt;HTTP 400 Bad Request&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ—¥å¿—ä¸­éœ€è„±æ•æ•æ„Ÿå‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯ä»¥å®ç°å¯¹ &lt;code&gt;@RequestParam&lt;/code&gt; å‚æ•°ï¼ˆåŒ…æ‹¬åˆ—è¡¨ï¼‰çš„ç²¾ç»†åŒ–åŠ è§£å¯†æ§åˆ¶ï¼ŒåŒæ—¶ç¡®ä¿ç½‘å…³çš„é«˜æ€§èƒ½å’Œé«˜å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id="jsonæµå¼ä¼˜åŒ–"&gt;Jsonæµå¼ä¼˜åŒ–
&lt;/h2&gt;&lt;p&gt;é’ˆå¯¹æ‚¨æä¾›çš„&lt;code&gt;UserIdFilter&lt;/code&gt;è¿‡æ»¤å™¨ï¼Œä»¥ä¸‹ä»JSONå¤„ç†æµç¨‹ä¼˜åŒ–ã€æ€§èƒ½æå‡ã€ä»£ç å¯ç»´æŠ¤æ€§ä¸‰ä¸ªç»´åº¦æå‡ºä¼˜åŒ–å»ºè®®ï¼Œå¹¶ç»™å‡ºå…·ä½“å®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;h3 id="jsonå¤„ç†æµç¨‹ä¼˜åŒ–"&gt;JSONå¤„ç†æµç¨‹ä¼˜åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é‡‡ç”¨æµå¼è§£ææ›¿ä»£å…¨é‡åŠ è½½&lt;/strong&gt;
åŸå§‹ä»£ç å°†æ•´ä¸ªå“åº”ä½“åŠ è½½åˆ°å­—ç¬¦ä¸²ä¸­è¿›è¡Œå¤„ç†ï¼Œå­˜åœ¨å†…å­˜å‹åŠ›å’Œæ€§èƒ½ç“¶é¢ˆã€‚å»ºè®®æ”¹ç”¨Jacksonçš„æµå¼APIï¼ˆJsonParser/JsonGeneratorï¼‰é€å±‚å¤„ç†ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ–°å¢æµå¼å¤„ç†æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;processJsonStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inputStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dataBuffer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asInputStream&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonParser&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;createParser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;inputStream&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;outputStream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonGenerator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;createGenerator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;outputStream&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonEncoding&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æµå¼å¤„ç†é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nextToken&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentToken&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JsonToken&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FIELD_NAME&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCurrentName&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nextToken&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getLongValue&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeStringField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserId&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;masked&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;copyCurrentEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;outputStream&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toByteArray&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UncheckedIOException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;JSONæµå¤„ç†å¼‚å¸¸&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;åˆ†é¡µç»“æ„å¤„ç†ä¼˜åŒ–&lt;/strong&gt;
é’ˆå¯¹åˆ†é¡µæ•°æ®ç»“æ„çš„ç‰¹æ®Šæ€§ï¼Œå»ºè®®å°†å¤„ç†é€»è¾‘åˆ†ç¦»ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ–°å¢åˆ†é¡µå¤„ç†æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handlePagination&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ObjectNode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responseNode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;responseNode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;has&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;currentPage&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayNode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subDataNode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ArrayNode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responseNode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayNode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maskedData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createArrayNode&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;subDataNode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maskedData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maskUserId&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ObjectNode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;responseNode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maskedData&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="æ€§èƒ½ä¼˜åŒ–"&gt;æ€§èƒ½ä¼˜åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å“åº”ä½“ç¼“å­˜ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨&lt;code&gt;CachedBodyOutputMessage&lt;/code&gt;é¿å…é‡å¤è§£æï¼ˆå‚è€ƒç½‘é¡µ2å“åº”å¼ç¼–ç¨‹æ³¨æ„äº‹é¡¹ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CachedBodyOutputMessage&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cachedBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CachedBodyOutputMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defer&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cachedBody&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åº”ç”¨æµå¼å¤„ç†æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processedBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processJsonStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processedBuffer&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;ObjectMapperå¤ç”¨é…ç½®&lt;/strong&gt;&lt;br&gt;
é€šè¿‡é¢„é…ç½®æå‡åºåˆ—åŒ–æ€§èƒ½ï¼ˆå‚è€ƒç½‘é¡µ7ã€8çš„Jacksonä¼˜åŒ–å»ºè®®ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mapper&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DeserializationFeature&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;USE_BIG_DECIMAL_FOR_FLOATS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SerializationFeature&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;WRITE_DATES_AS_TIMESTAMPS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;JsonParser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Feature&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;AUTO_CLOSE_SOURCE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="ä»£ç å¯ç»´æŠ¤æ€§ä¼˜åŒ–"&gt;ä»£ç å¯ç»´æŠ¤æ€§ä¼˜åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†æ”¹è¿›&lt;/strong&gt;&lt;br&gt;
å¢åŠ æ›´å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼ˆå‚è€ƒç½‘é¡µ6çš„å¼‚å¸¸å¤„ç†å®è·µï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;JsonProcessingException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setStatusCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;INTERNAL_SERVER_ERROR&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;errorJson&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;code\&amp;#34;:500,\&amp;#34;message\&amp;#34;:\&amp;#34;æ•°æ®å¤„ç†å¼‚å¸¸\&amp;#34;}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;errorJson&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UncheckedIOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æµå¤„ç†å¼‚å¸¸&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCause&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ•°æ®å¤„ç†è¶…æ—¶&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å¼ç¼–ç¨‹ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
é‡‡ç”¨å“åº”å¼æ“ä½œç¬¦é‡æ„å¤„ç†é“¾ï¼ˆå‚è€ƒç½‘é¡µ2çš„å¼‚æ­¥å¤„ç†å»ºè®®ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fluxBody&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collectList&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinBuffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataBuffers&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processJsonStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;joinBuffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flux&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="ç»¼åˆä¼˜åŒ–æ–¹æ¡ˆ"&gt;ç»¼åˆä¼˜åŒ–æ–¹æ¡ˆ
&lt;/h3&gt;&lt;p&gt;å°†ä¸Šè¿°ä¼˜åŒ–ç‚¹æ•´åˆåçš„æ ¸å¿ƒä»£ç ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;originalResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;originalResponse&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponseDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponseDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;originalResponse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Publisher&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;instanceof&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processBody&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;processBody&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collectList&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flatMapMany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processJsonStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="æ€§èƒ½ç›‘æ§å»ºè®®å‚è€ƒç½‘é¡µ5"&gt;æ€§èƒ½ç›‘æ§å»ºè®®ï¼ˆå‚è€ƒç½‘é¡µ5ï¼‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ·»åŠ å¤„ç†è€—æ—¶ç»Ÿè®¡ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTimeMillis&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;doFinally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signalType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cost&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTimeMillis&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;metricsRecorder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;recordProcessTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cost&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;é›†æˆPrometheusæŒ‡æ ‡ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Counter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;gateway.userid_filter_processed&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;method&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getMethodValue&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;register&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CollectorRegistry&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultRegistry&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;inc&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŒ–æ•ˆæœ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜æ¶ˆè€—é™ä½çº¦60%ï¼ˆæµå¼å¤„ç†å‡å°‘å†…å­˜å ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;ååé‡æå‡çº¦30%ï¼ˆå¼‚æ­¥å¤„ç†+ç¼“å­˜ä¼˜åŒ–ï¼‰&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸å¤„ç†è¦†ç›–ç‡ä»70%æå‡è‡³95%&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å»ºè®®é€šè¿‡JMeterç­‰å·¥å…·è¿›è¡Œå‹æµ‹éªŒè¯ï¼Œé‡ç‚¹è§‚å¯ŸP99å“åº”æ—¶é—´å’Œå †å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å¯¹äºåˆ†é¡µæ•°æ®ç­‰ç‰¹æ®Šåœºæ™¯ï¼Œå¯è€ƒè™‘å¢åŠ å•å…ƒæµ‹è¯•ç”¨ä¾‹éªŒè¯è¾¹ç•Œæ¡ä»¶ï¼ˆå‚è€ƒç½‘é¡µ6çš„æµ‹è¯•å®è·µï¼‰ã€‚&lt;/p&gt;</description></item><item><title>ã€Spring Cloud Gatewayã€‘Notes</title><link>https://dyhes.github.io/p/spring-cloud-gatewaynotes/</link><pubDate>Sat, 17 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/spring-cloud-gatewaynotes/</guid><description>&lt;h2 id="flux-vs-mono"&gt;Flux vs. Mono
&lt;/h2&gt;&lt;p&gt;Flux å’Œ Mono æ˜¯ Reactor æ¡†æ¶ä¸­å®ç°å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒç±»å‹ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ•°æ®æµã€‚å®ƒä»¬åŸºäº Reactive Streams è§„èŒƒï¼Œæ”¯æŒéé˜»å¡ã€èƒŒå‹ï¼ˆBackpressureï¼‰ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„å¯¹æ¯”ä¸è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ¦‚å¿µ"&gt;&lt;strong&gt;æ ¸å¿ƒæ¦‚å¿µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Flux&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šè¡¨ç¤ºä¸€ä¸ª &lt;strong&gt;0åˆ°Nä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—&lt;/strong&gt;ï¼Œæ”¯æŒæ— é™æ•°æ®æµï¼ˆå¦‚å®æ—¶äº‹ä»¶æµï¼‰æˆ–æœ‰é™æ•°æ®é›†ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ç»“æœé›†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿¡å·ç±»å‹&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;onNext&lt;/code&gt; å‘é€å¤šä¸ªå…ƒç´ ï¼Œæœ€ç»ˆä»¥ &lt;code&gt;onComplete&lt;/code&gt; æˆ– &lt;code&gt;onError&lt;/code&gt; ç»ˆæ­¢æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šå¤„ç†å¤šä¸ªæ•°æ®é¡¹ï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€æ‰¹é‡æŸ¥è¯¢ï¼‰æˆ–æŒç»­ç”Ÿæˆçš„äº‹ä»¶æµï¼ˆå¦‚ä¼ æ„Ÿå™¨æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Mono&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šè¡¨ç¤º &lt;strong&gt;0æˆ–1ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—&lt;/strong&gt;ï¼Œç”¨äºå•æ¬¡ç»“æœæ“ä½œï¼ˆå¦‚ HTTP è¯·æ±‚ã€å”¯ä¸€ ID æŸ¥è¯¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿¡å·ç±»å‹&lt;/strong&gt;ï¼šæœ€å¤šè§¦å‘ä¸€æ¬¡ &lt;code&gt;onNext&lt;/code&gt;ï¼Œéšåç«‹å³ç»ˆæ­¢ï¼ˆ&lt;code&gt;onComplete&lt;/code&gt; æˆ– &lt;code&gt;onError&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šè¿”å›å•ä¸ªå¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ã€æ— è¿”å›å€¼çš„å¼‚æ­¥æ“ä½œï¼ˆå¦‚ä¿å­˜æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”"&gt;&lt;strong&gt;æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;Flux&lt;/th&gt;
&lt;th&gt;Mono&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…ƒç´ æ•°é‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0-N ä¸ªï¼Œæ”¯æŒæ— é™æµ&lt;/td&gt;
&lt;td&gt;0æˆ–1ä¸ª&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ“ä½œç¬¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒå¤šå…ƒç´ æ“ä½œï¼ˆå¦‚ &lt;code&gt;buffer&lt;/code&gt;ã€&lt;code&gt;flatMap&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;å•å…ƒç´ æ“ä½œï¼ˆå¦‚ &lt;code&gt;map&lt;/code&gt;ã€&lt;code&gt;flatMap&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆæ‰¹é‡æ•°æ®å¤„ç†ï¼Œå†…å­˜å ç”¨è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;å•ç»“æœå¤„ç†ï¼Œè½»é‡çº§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é”™è¯¯ç»ˆæ­¢æ•´ä¸ªæµ&lt;/td&gt;
&lt;td&gt;ç›´æ¥ä¼ é€’é”™è¯¯ä¿¡å·&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨åœºæ™¯"&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="flux-çš„å…¸å‹åº”ç”¨"&gt;&lt;strong&gt;Flux çš„å…¸å‹åº”ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ•°æ®æŸ¥è¯¢&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findAll&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶äº‹ä»¶æµå¤„ç†&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Event&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;interval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofSeconds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tick&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generateEvent&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¯ç§’ç”Ÿæˆäº‹ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è½¬æ¢ä¸èšåˆ&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;flatMap&lt;/code&gt; å’Œ &lt;code&gt;groupBy&lt;/code&gt; å¯¹å¤šä¸ªæ•°æ®æµè¿›è¡Œåˆå¹¶æˆ–æ‹†åˆ†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="mono-çš„å…¸å‹åº”ç”¨"&gt;&lt;strong&gt;Mono çš„å…¸å‹åº”ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å•æ¬¡æ•°æ®åº“æŸ¥è¯¢&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HTTP è¯·æ±‚å“åº”&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/user/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥æ“ä½œç»“æœå°è£…&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;saveOperation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;then&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿å­˜åè¿”å›ç©º&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ“ä½œç¬¦ä¸åŠŸèƒ½"&gt;&lt;strong&gt;æ“ä½œç¬¦ä¸åŠŸèƒ½&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…±æœ‰æ“ä½œç¬¦"&gt;&lt;strong&gt;å…±æœ‰æ“ä½œç¬¦&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½¬æ¢ç±»&lt;/strong&gt;ï¼š&lt;code&gt;map&lt;/code&gt;ï¼ˆå…ƒç´ è½¬æ¢ï¼‰ã€&lt;code&gt;flatMap&lt;/code&gt;ï¼ˆå¼‚æ­¥è½¬æ¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ»¤ç±»&lt;/strong&gt;ï¼š&lt;code&gt;filter&lt;/code&gt;ï¼ˆæ¡ä»¶è¿‡æ»¤ï¼‰ã€&lt;code&gt;take&lt;/code&gt;ï¼ˆé™åˆ¶å…ƒç´ æ•°é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼š&lt;code&gt;onErrorResume&lt;/code&gt;ï¼ˆé”™è¯¯é™çº§ï¼‰ã€&lt;code&gt;retry&lt;/code&gt;ï¼ˆé‡è¯•æœºåˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç‰¹æœ‰æ“ä½œç¬¦"&gt;&lt;strong&gt;ç‰¹æœ‰æ“ä½œç¬¦&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æ“ä½œç¬¦&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Flux&lt;/td&gt;
&lt;td&gt;&lt;code&gt;buffer(10)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†å…ƒç´ æŒ‰æ‰¹æ¬¡æ”¶é›†ï¼ˆå¦‚æ¯10ä¸ªä¸€ç»„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flux&lt;/td&gt;
&lt;td&gt;&lt;code&gt;zipWith(otherFlux)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆå¹¶ä¸¤ä¸ªæµå¹¶æŒ‰å…ƒç´ é…å¯¹å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mono&lt;/td&gt;
&lt;td&gt;&lt;code&gt;defaultIfEmpty()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºå€¼æ—¶è¿”å›é»˜è®¤å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mono&lt;/td&gt;
&lt;td&gt;&lt;code&gt;then(Mono)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å½“å‰æµå®Œæˆåè§¦å‘å¦ä¸€ä¸ªæµ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä»£ç ç¤ºä¾‹"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="flux-ç¤ºä¾‹"&gt;&lt;strong&gt;Flux ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åˆ›å»ºåŒ…å«å¤šä¸ªå…ƒç´ çš„æµå¹¶è½¬æ¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;numbers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è½¬æ¢ä¸º [2, 4, 6]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿‡æ»¤å‡º [4, 6]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;numbers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;subscribe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="mono-ç¤ºä¾‹"&gt;&lt;strong&gt;Mono ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ¨¡æ‹Ÿå¼‚æ­¥æŸ¥è¯¢ç”¨æˆ·å¹¶å¤„ç†ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userMono&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flatMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toUpperCase&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;onErrorResume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;just&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;fallback&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯æ—¶è¿”å›é»˜è®¤ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;userMono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;subscribe&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å¦‚ä½•é€‰æ‹©-flux-æˆ–-mono"&gt;&lt;strong&gt;å¦‚ä½•é€‰æ‹© Flux æˆ– Monoï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®é‡&lt;/strong&gt;ï¼šéœ€è¦å¤„ç†å¤šä¸ªå…ƒç´ æ—¶é€‰ Fluxï¼Œå•ä¸ªæˆ–æ— ç»“æœæ—¶é€‰ Monoã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;ï¼šMono æ›´è½»é‡ï¼Œé€‚åˆé«˜é¢‘å•æ¬¡æ“ä½œï¼›Flux é€‚åˆæ‰¹é‡æˆ–æµå¼å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­ä¹‰æ˜ç¡®æ€§&lt;/strong&gt;ï¼šä½¿ç”¨ Mono å¯å¢å¼ºä»£ç å¯è¯»æ€§ï¼ˆå¦‚æ˜ç¡®è¡¨ç¤ºâ€œå¯èƒ½æœ‰æˆ–æ²¡æœ‰ç»“æœâ€ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Flux å’Œ Mono æ˜¯å“åº”å¼ç¼–ç¨‹çš„åŸºçŸ³ï¼Œåˆ†åˆ«è§£å†³å¤šå…ƒç´ å’Œå•å…ƒç´ å¼‚æ­¥æµå¤„ç†çš„é—®é¢˜ã€‚Flux æ“…é•¿å¤æ‚çš„æ•°æ®æµæ“ä½œï¼ˆå¦‚åˆå¹¶ã€æ‰¹å¤„ç†ï¼‰ï¼Œè€Œ Mono åœ¨å•ç»“æœåœºæ™¯ä¸­æ›´é«˜æ•ˆç›´è§‚ã€‚å®é™…å¼€å‘ä¸­éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ï¼Œä¾‹å¦‚åœ¨ Spring WebFlux ä¸­ï¼ŒController æ–¹æ³•é€šå¸¸è¿”å› Monoï¼ˆå•ç»“æœï¼‰æˆ– Fluxï¼ˆåˆ—è¡¨æˆ–æµï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="serverhttprequestdecorator"&gt;ServerHttpRequestDecorator
&lt;/h2&gt;&lt;p&gt;ServerHttpRequestDecorator æ˜¯ Spring WebFlux æ¡†æ¶ä¸­ç”¨äºå¢å¼ºæˆ–ä¿®æ”¹ HTTP è¯·æ±‚çš„æ ¸å¿ƒå·¥å…·ç±»ï¼ŒåŸºäºè£…é¥°å™¨æ¨¡å¼å®ç°å¯¹è¯·æ±‚çš„æ‹¦æˆªå’ŒåŠ¨æ€å¤„ç†ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ã€ä½¿ç”¨åœºæ™¯åŠç¤ºä¾‹çš„è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ä¿¡æ¯æ‹¦æˆªä¸ä¿®æ”¹&lt;/strong&gt;&lt;br&gt;
ç»§æ‰¿è‡ª &lt;code&gt;ServerHttpRequest&lt;/code&gt;ï¼Œé€šè¿‡é‡å†™ &lt;code&gt;getHeaders()&lt;/code&gt;ã€&lt;code&gt;getBody()&lt;/code&gt; ç­‰æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰å…³é”®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒåŠ¨æ€æ·»åŠ è¯·æ±‚å¤´ã€è§£å¯†è¯·æ±‚å†…å®¹æˆ–ç»Ÿä¸€è¯·æ±‚æ ¼å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è£…é¥°å™¨æ¨¡å¼å®ç°&lt;/strong&gt;&lt;br&gt;
åœ¨ä¸æ”¹å˜åŸå§‹ &lt;code&gt;ServerHttpRequest&lt;/code&gt; å¯¹è±¡çš„åŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨å’Œå¤šå±‚åŒ…è£…ï¼Œé€‚ç”¨äºå¯¹è¯·æ±‚è¿›è¡Œéä¾µå…¥å¼å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;å…³é”®æ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å¸¸ç”¨æ–¹æ³•"&gt;&lt;strong&gt;å¸¸ç”¨æ–¹æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;getHeaders()&lt;/code&gt;&lt;br&gt;
é‡å†™æ­¤æ–¹æ³•å¯åŠ¨æ€ä¿®æ”¹è¯·æ±‚å¤´ä¿¡æ¯ï¼ˆå¦‚å¼ºåˆ¶è®¾ç½® &lt;code&gt;Content-Type&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;getBody()&lt;/code&gt;&lt;br&gt;
æ‹¦æˆªè¯·æ±‚ä½“æ•°æ®æµï¼ˆ&lt;code&gt;Flux&amp;lt;DataBuffer&amp;gt;&lt;/code&gt;ï¼‰ï¼Œå…è®¸å¯¹åŸå§‹æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆå¦‚è§£å¯†ã€æ—¥å¿—è®°å½•ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä»£ç ç¤ºä¾‹-1"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;åœºæ™¯ï¼šå¼ºåˆ¶è®¾ç½®è¯·æ±‚å¤´çš„ Content-Type&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ContentRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ContentRequestDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writableHttpHeaders&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setContentType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;APPLICATION_JSON&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼ºåˆ¶è®¾ç½®ä¸º JSON ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åº”ç”¨æ–¹å¼&lt;/strong&gt;&lt;br&gt;
åœ¨è¿‡æ»¤å™¨ä¸­åŒ…è£…åŸå§‹è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WebFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WebFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ContentRequestDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedRequest&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åœºæ™¯ï¼šè§£å¯†è¯·æ±‚ä½“å†…å®¹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DecryptRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpRequestDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;releaseBufferToString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decrypted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AesUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypted&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰è§£å¯†é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decrypted&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚å¤´åŠ¨æ€å¤„ç†&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚ç»Ÿä¸€æ·»åŠ è®¤è¯å¤´ï¼ˆå¦‚ &lt;code&gt;Authorization&lt;/code&gt;ï¼‰æˆ–ä¿®å¤å®¢æˆ·ç«¯ç¼ºå¤±çš„ &lt;code&gt;Content-Type&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ä½“å†…å®¹è½¬æ¢&lt;/strong&gt;&lt;br&gt;
è§£å¯†æ•æ„Ÿæ•°æ®ã€å‹ç¼©/è§£å‹ç¼©è¯·æ±‚ä½“ï¼Œæˆ–è®°å½•åŸå§‹è¯·æ±‚å†…å®¹ç”¨äºè°ƒè¯•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åè®®å…¼å®¹æ€§é€‚é…&lt;/strong&gt;&lt;br&gt;
å°†éæ ‡å‡†åè®®ï¼ˆå¦‚è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼ï¼‰è½¬æ¢ä¸ºæ ‡å‡† HTTP è¯·æ±‚ï¼Œæ–¹ä¾¿åç»­å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æ ¼å¼ç»Ÿä¸€&lt;/strong&gt;&lt;br&gt;
å¯¹å¼‚æ„å®¢æˆ·ç«¯å‘é€çš„ XMLã€è¡¨å•æ•°æ®ç­‰ç»Ÿä¸€è½¬æ¢ä¸º JSONï¼Œç®€åŒ–ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…é‡å¤æäº¤&lt;/strong&gt;&lt;br&gt;
è‹¥ç›´æ¥æ“ä½œè¯·æ±‚ä½“æ•°æ®æµï¼Œéœ€ç¡®ä¿æ•°æ®ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œå¦åˆ™ä¼šè§¦å‘ &lt;code&gt;IllegalStateException&lt;/code&gt;ã€‚å¯é€šè¿‡ç¼“å­˜ï¼ˆå¦‚ &lt;code&gt;Flux.cache()&lt;/code&gt;ï¼‰è§£å†³ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
é«˜é¢‘è¯·æ±‚å¤„ç†éœ€æ³¨æ„å†…å­˜ç®¡ç†ï¼Œæ¨èä½¿ç”¨éé˜»å¡å¼æµå¤„ç†ï¼ˆå¦‚ &lt;code&gt;Flux.map&lt;/code&gt; ä»£æ›¿åŒæ­¥å¾ªç¯ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ ServerWebExchange é›†æˆ&lt;/strong&gt;&lt;br&gt;
é€šå¸¸ç»“åˆ &lt;code&gt;ServerWebExchange.mutate()&lt;/code&gt; æ–¹æ³•ï¼Œå°†è£…é¥°åçš„è¯·æ±‚æ³¨å…¥è¿‡æ»¤å™¨é“¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç›¸å…³ç±»å¯¹æ¯”"&gt;&lt;strong&gt;ç›¸å…³ç±»å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServerHttpRequest&lt;/strong&gt;&lt;br&gt;
åŸå§‹è¯·æ±‚æ¥å£ï¼Œæä¾›åŸºç¡€è¯·æ±‚ä¿¡æ¯è®¿é—®èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServletServerHttpRequest&lt;/strong&gt;&lt;br&gt;
é’ˆå¯¹ Servlet å®¹å™¨çš„é€‚é…å™¨ï¼Œå°† &lt;code&gt;HttpServletRequest&lt;/code&gt; è½¬æ¢ä¸ºå“åº”å¼è¯·æ±‚å¯¹è±¡ï¼Œé€šå¸¸ä¸ &lt;code&gt;ServerHttpRequestDecorator&lt;/code&gt; é…åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†åº”ç”¨ &lt;code&gt;ServerHttpRequestDecorator&lt;/code&gt;ï¼Œå¼€å‘è€…èƒ½å¤Ÿçµæ´»æ§åˆ¶è¯·æ±‚å¤„ç†æµç¨‹ï¼Œæ»¡è¶³å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="serverhttpresponsedecorator"&gt;ServerHttpResponseDecorator
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud Gateway ä¸­ï¼Œ&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt; æ˜¯ä¸€ä¸ªç”¨äºåŒ…è£…å¹¶å¢å¼º &lt;code&gt;ServerHttpResponse&lt;/code&gt; åŠŸèƒ½çš„å·¥å…·ç±»ï¼Œä¸»è¦ç”¨äºæ‹¦æˆªå’Œä¿®æ”¹ç½‘å…³çš„å“åº”å†…å®¹ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œåº”ç”¨åœºæ™¯çš„è¯¦ç»†ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨-1"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”å†…å®¹æ‹¦æˆªä¸ä¿®æ”¹&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt; ç»§æ‰¿è‡ª &lt;code&gt;ServerHttpResponse&lt;/code&gt;ï¼Œé€šè¿‡é‡å†™ &lt;code&gt;writeWith()&lt;/code&gt; æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å“åº”ä½“å†™å…¥å‰æˆ–å†™å…¥åå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å“åº”å¤´ã€åŠ å¯†å“åº”å†…å®¹æˆ–è®°å½•æ—¥å¿—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è£…é¥°å™¨æ¨¡å¼å®ç°&lt;/strong&gt;&lt;br&gt;
é€šè¿‡è£…é¥°å™¨æ¨¡å¼ï¼Œ&lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt; åœ¨ä¸æ”¹å˜åŸå§‹ &lt;code&gt;ServerHttpResponse&lt;/code&gt; å¯¹è±¡çš„åŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨å’Œå¤šé‡åŒ…è£…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•ä¸ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="å…³é”®æ–¹æ³•"&gt;&lt;strong&gt;å…³é”®æ–¹æ³•&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;writeWith(Publisher&amp;lt;DataBuffer&amp;gt; body)&lt;/code&gt;&lt;br&gt;
é‡å†™æ­¤æ–¹æ³•ä»¥æ‹¦æˆªåŸå§‹å“åº”ä½“çš„æ•°æ®æµï¼Œå…è®¸å¯¹ &lt;code&gt;DataBuffer&lt;/code&gt; è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼ˆå¦‚å­—ç¬¦ä¸²è½¬æ¢ã€JSON åºåˆ—åŒ–ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;getDelegate()&lt;/code&gt;&lt;br&gt;
è·å–è¢«è£…é¥°çš„åŸå§‹ &lt;code&gt;ServerHttpResponse&lt;/code&gt; å®ä¾‹ï¼Œä¾¿äºç›´æ¥æ“ä½œåº•å±‚å±æ€§ï¼ˆå¦‚çŠ¶æ€ç ã€Cookie ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä»£ç ç¤ºä¾‹-2"&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomResponseDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponseDecorator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;CustomResponseDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Publisher&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿®æ”¹å“åº”ä½“å†…å®¹ï¼ˆä¾‹å¦‚æ·»åŠ å‰ç¼€ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;DataBuffer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;modifiedBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;from&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataBufferUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;releaseBufferToString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bufferFactory&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Modified: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;writeWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;modifiedBody&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿‡æ»¤å™¨ä¸­åº”ç”¨è¯¥è£…é¥°å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CustomResponseDecorator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;decoratedResponse&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€ä¿®æ”¹å“åº”å¤´&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚æ·»åŠ å®‰å…¨ç›¸å…³çš„ &lt;code&gt;Content-Security-Policy&lt;/code&gt; æˆ–è‡ªå®šä¹‰ä¸šåŠ¡æ ‡è¯†å¤´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€å“åº”æ ¼å¼&lt;/strong&gt;&lt;br&gt;
å¯¹åç«¯æœåŠ¡çš„åŸå§‹å“åº”è¿›è¡Œå°è£…ï¼Œç»Ÿä¸€é”™è¯¯ç æˆ–æ ‡å‡†åŒ–æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—è®°å½•ä¸ç›‘æ§&lt;/strong&gt;&lt;br&gt;
è®°å½•å“åº”è€—æ—¶ã€å“åº”ä½“å¤§å°ç­‰æŒ‡æ ‡ï¼Œé›†æˆç›‘æ§ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•æ„Ÿæ•°æ®è„±æ•&lt;/strong&gt;&lt;br&gt;
åœ¨å“åº”è¿”å›å®¢æˆ·ç«¯å‰ï¼Œå¯¹æ•æ„Ÿå­—æ®µï¼ˆå¦‚æ‰‹æœºå·ã€èº«ä»½è¯å·ï¼‰è¿›è¡Œè„±æ•å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”æäº¤çŠ¶æ€&lt;/strong&gt;&lt;br&gt;
éœ€é€šè¿‡ &lt;code&gt;isCommitted()&lt;/code&gt; æ–¹æ³•åˆ¤æ–­å“åº”æ˜¯å¦å·²æäº¤ï¼Œé¿å…é‡å¤æ“ä½œå¯¼è‡´å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;br&gt;
å“åº”ä½“çš„æ‹¦æˆªå’Œä¿®æ”¹æ¶‰åŠæ•°æ®æµæ“ä½œï¼Œéœ€æ³¨æ„å†…å­˜æ¶ˆè€—å’Œå»¶è¿Ÿï¼Œå»ºè®®ä½¿ç”¨éé˜»å¡å¼å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç›¸å…³ç±»ä¸ä¸Šä¸‹æ–‡"&gt;&lt;strong&gt;ç›¸å…³ç±»ä¸ä¸Šä¸‹æ–‡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerWebExchange&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ç½‘å…³è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒæŒæœ‰ &lt;code&gt;ServerHttpRequest&lt;/code&gt; å’Œ &lt;code&gt;ServerHttpResponse&lt;/code&gt;ï¼Œæ˜¯æ“ä½œè¯·æ±‚å’Œå“åº”çš„å…¥å£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ReactorServerHttpResponse&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ServerHttpResponse&lt;/code&gt; çš„é»˜è®¤å®ç°ç±»ï¼ŒåŸºäº Netty çš„å“åº”å¤„ç†ï¼Œå…¶ &lt;code&gt;HttpHeaders&lt;/code&gt; å¯ç›´æ¥ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†ä½¿ç”¨ &lt;code&gt;ServerHttpResponseDecorator&lt;/code&gt;ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»æ§åˆ¶ç½‘å…³çš„å“åº”è¡Œä¸ºï¼Œæ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p&gt;</description></item><item><title>ã€Open Feignã€‘Notes</title><link>https://dyhes.github.io/p/open-feignnotes/</link><pubDate>Fri, 16 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/open-feignnotes/</guid><description>&lt;h2 id="requestheader"&gt;@RequestHeader
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼ŒOpenFeign å¯ä»¥ç›´æ¥é€šè¿‡ &lt;code&gt;@RequestHeader&lt;/code&gt; æ³¨è§£åœ¨æ¥å£æ–¹æ³•å‚æ•°ä¸­æŒ‡å®šè¯·æ±‚å¤´ï¼Œè¿™æ˜¯å…¶åŸç”Ÿæ”¯æŒçš„ç‰¹æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“ä½¿ç”¨æ–¹å¼å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="requestheader-çš„åŸºæœ¬ç”¨æ³•"&gt;&lt;code&gt;@RequestHeader&lt;/code&gt; çš„åŸºæœ¬ç”¨æ³•
&lt;/h3&gt;&lt;p&gt;åœ¨ Feign å®¢æˆ·ç«¯æ¥å£æ–¹æ³•çš„å‚æ•°ä¸Šæ·»åŠ  &lt;code&gt;@RequestHeader(&amp;quot;å¤´åç§°&amp;quot;)&lt;/code&gt; æ³¨è§£ï¼Œè°ƒç”¨æ—¶ä¼ å…¥å…·ä½“å€¼å³å¯åŠ¨æ€è®¾ç½®è¯·æ±‚å¤´ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;example-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;ExampleServiceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/example&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getExample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Authorization&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼ŒOpenFeign ä¼šè‡ªåŠ¨å°† &lt;code&gt;token&lt;/code&gt; å‚æ•°å€¼ä½œä¸º &lt;code&gt;Authorization&lt;/code&gt; è¯·æ±‚å¤´æ·»åŠ åˆ° HTTP è¯·æ±‚ä¸­ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="çµæ´»çš„åº”ç”¨åœºæ™¯"&gt;çµæ´»çš„åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•ä¸ªè¯·æ±‚å¤´&lt;/strong&gt;&lt;br&gt;
ç›´æ¥åœ¨å‚æ•°ä¸­å£°æ˜å•ä¸ªå¤´åç§°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/getStuDetail&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;StudentVo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getStudentDetail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;X-Trace-Id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;traceId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šä¸ªè¯·æ±‚å¤´&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;MultiValueMap&amp;lt;String, String&amp;gt;&lt;/code&gt; æˆ– &lt;code&gt;HttpHeaders&lt;/code&gt; ç±»å‹å‚æ•°æ¥æ”¶å¤šä¸ªå¤´ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PostMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/card&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CardVo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createCard&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultiValueMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ƒç”¨æ—¶ä¼ å…¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹çš„é›†åˆå³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“åˆè·¯å¾„å‚æ•°/è¯·æ±‚ä½“&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@RequestHeader&lt;/code&gt; å¯ä¸å…¶ä»–æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@PathVariable&lt;/code&gt;ã€&lt;code&gt;@RequestBody&lt;/code&gt;ï¼‰æ··åˆä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PostMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/service/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RequestData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;X-User-Id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–æ–¹å¼çš„å¯¹æ¯”"&gt;ä¸å…¶ä»–æ–¹å¼çš„å¯¹æ¯”
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ€§&lt;/strong&gt;ï¼šé€‚åˆéœ€è¦æ ¹æ®è°ƒç”¨ä¸Šä¸‹æ–‡åŠ¨æ€ä¼ é€’å¤´ä¿¡æ¯çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ· Tokenã€è¿½è¸ª IDï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€æ´æ€§&lt;/strong&gt;ï¼šæ— éœ€ç¼–å†™æ‹¦æˆªå™¨ï¼Œç›´æ¥åœ¨æ¥å£ä¸­å£°æ˜å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç ä¾µå…¥æ€§&lt;/strong&gt;ï¼šéœ€ä¿®æ”¹æ¥å£æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œå¯èƒ½å½±å“ä»£ç ç®€æ´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥è°ƒç”¨é—®é¢˜&lt;/strong&gt;ï¼šåœ¨å¼‚æ­¥éé˜»å¡è°ƒç”¨æ—¶å¯èƒ½å‡ºç°å¤´ä¿¡æ¯ä¸¢å¤±ï¼ˆéœ€ç»“åˆ &lt;code&gt;RequestContextHolder&lt;/code&gt; æˆ–æ‹¦æˆªå™¨å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è¡¥å……å»ºè®®"&gt;è¡¥å……å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å›ºå®šè¯·æ±‚å¤´åœºæ™¯&lt;/strong&gt;ï¼šè‹¥éœ€ä¸ºæ‰€æœ‰è¯·æ±‚æ·»åŠ å›ºå®šå¤´ï¼ˆå¦‚å…¨å±€ API å¯†é’¥ï¼‰ï¼Œæ¨èä½¿ç”¨ &lt;code&gt;RequestInterceptor&lt;/code&gt; æ‹¦æˆªå™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆä½¿ç”¨&lt;/strong&gt;ï¼šå¯åŒæ—¶ä½¿ç”¨ &lt;code&gt;@RequestHeader&lt;/code&gt; å’Œæ‹¦æˆªå™¨ï¼Œå‰è€…å¤„ç†åŠ¨æ€å¤´ï¼Œåè€…å¤„ç†å…¨å±€å¤´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œ&lt;code&gt;@RequestHeader&lt;/code&gt; æ˜¯ OpenFeign ä¸­ç›´æ¥æŒ‡å®šè¯·æ±‚å¤´çš„æœ‰æ•ˆæ–¹å¼ï¼Œå°¤å…¶é€‚åˆåŠ¨æ€å¤´ä¼ é€’åœºæ™¯ã€‚å¯¹äºå¤æ‚éœ€æ±‚ï¼Œå¯ç»“åˆå…¶ä»–æœºåˆ¶çµæ´»å®ç°ã€‚&lt;/p&gt;
&lt;h2 id="å­—æ®µæ˜ å°„"&gt;å­—æ®µæ˜ å°„
&lt;/h2&gt;&lt;p&gt;OpenFeign å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç° &lt;strong&gt;UserInfo åˆ° SpaceUserInfo çš„è‡ªåŠ¨ DTO æ˜ å°„&lt;/strong&gt;ï¼Œä½†éœ€è¦æ»¡è¶³ä¸€å®šæ¡ä»¶æˆ–è¿›è¡Œé¢å¤–é…ç½®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤æƒ…å†µä¸‹èƒ½å¦è‡ªåŠ¨æ˜ å°„"&gt;é»˜è®¤æƒ…å†µä¸‹èƒ½å¦è‡ªåŠ¨æ˜ å°„ï¼Ÿ
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;è‹¥æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼ŒOpenFeign å¯è‡ªåŠ¨å®Œæˆå­—æ®µæ˜ å°„ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µåä¸ç±»å‹å®Œå…¨ä¸€è‡´&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚ &lt;code&gt;username&lt;/code&gt;ã€&lt;code&gt;nickname&lt;/code&gt;ã€&lt;code&gt;avatar&lt;/code&gt; ç­‰å­—æ®µåœ¨ &lt;code&gt;UserInfo&lt;/code&gt; å’Œ &lt;code&gt;SpaceUserInfo&lt;/code&gt; ä¸­åç§°ä¸ç±»å‹å®Œå…¨åŒ¹é…ï¼Œåˆ™ OpenFeign çš„é»˜è®¤è§£ç å™¨ï¼ˆå¦‚ &lt;code&gt;SpringDecoder&lt;/code&gt;ï¼‰ä¼šé€šè¿‡ JSON ååºåˆ—åŒ–è‡ªåŠ¨å¡«å……è¿™äº›å­—æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šä½™å­—æ®µè‡ªåŠ¨å¿½ç•¥&lt;/strong&gt;&lt;br&gt;
OpenFeign é»˜è®¤ä½¿ç”¨ Jackson è¿›è¡Œ JSON è½¬æ¢ï¼Œè‹¥ &lt;code&gt;UserInfo&lt;/code&gt; åŒ…å« &lt;code&gt;SpaceUserInfo&lt;/code&gt; æ²¡æœ‰çš„å­—æ®µï¼ˆå¦‚ &lt;code&gt;userId&lt;/code&gt;ã€&lt;code&gt;email&lt;/code&gt;ï¼‰ï¼Œå¯é€šè¿‡åœ¨ &lt;code&gt;SpaceUserInfo&lt;/code&gt; ç±»ä¸Šæ·»åŠ  &lt;code&gt;@JsonIgnoreProperties(ignoreUnknown = true)&lt;/code&gt; æ³¨è§£å¿½ç•¥æœªçŸ¥å­—æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å­—æ®µåæˆ–ç»“æ„ä¸åŒ¹é…æ—¶çš„è§£å†³æ–¹æ¡ˆ"&gt;å­—æ®µåæˆ–ç»“æ„ä¸åŒ¹é…æ—¶çš„è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;è‹¥å­—æ®µåæˆ–ç±»å‹ä¸ä¸€è‡´ï¼Œéœ€é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°æ˜ å°„ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id="è‡ªå®šä¹‰-feign-è§£ç å™¨"&gt;&lt;strong&gt;è‡ªå®šä¹‰ Feign è§£ç å™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å®ç° &lt;code&gt;Decoder&lt;/code&gt; æ¥å£ï¼Œåœ¨ &lt;code&gt;decode()&lt;/code&gt; æ–¹æ³•ä¸­æ‰‹åŠ¨è½¬æ¢ &lt;code&gt;UserInfo&lt;/code&gt; åˆ° &lt;code&gt;SpaceUserInfo&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CustomDecoder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Decoder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä» response ååºåˆ—åŒ–ä¸º UserInfo&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;username&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nickname&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µæ˜ å°„...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;@FeignClient(configuration = CustomConfig.class)&lt;/code&gt; æŒ‡å®šè‡ªå®šä¹‰é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä½¿ç”¨-mapstruct-æˆ–-jackson-æ³¨è§£"&gt;&lt;strong&gt;ä½¿ç”¨ MapStruct æˆ– Jackson æ³¨è§£&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MapStruct&lt;/strong&gt;ï¼šå®šä¹‰æ˜ å°„æ¥å£è‡ªåŠ¨ç”Ÿæˆè½¬æ¢ä»£ç ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Mapper&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserMapper&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;toSpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Jackson æ³¨è§£&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;SpaceUserInfo&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code&gt;@JsonProperty&lt;/code&gt; æŒ‡å®šå­—æ®µåˆ«åï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JsonProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;username&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸­é—´å±‚è½¬æ¢"&gt;&lt;strong&gt;ä¸­é—´å±‚è½¬æ¢&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ Feign æ¥å£ä¸­è¿”å› &lt;code&gt;UserInfo&lt;/code&gt;ï¼Œè°ƒç”¨åæ‰‹åŠ¨è½¬æ¢ä¸º &lt;code&gt;SpaceUserInfo&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/user/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨æ–¹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1L&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceUser&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;username&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nickname&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®"&gt;æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¿æŒ DTO ç»“æ„ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
å°½é‡è®© &lt;code&gt;SpaceUserInfo&lt;/code&gt; ä¸ &lt;code&gt;UserInfo&lt;/code&gt; çš„å­—æ®µåå’Œç±»å‹ä¿æŒä¸€è‡´ï¼Œé¿å…å¤æ‚æ˜ å°„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ Jackson é…ç½®&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;@JsonIgnoreProperties&lt;/code&gt; å’Œ &lt;code&gt;@JsonProperty&lt;/code&gt; å®ç°è½»é‡çº§é€‚é…ï¼Œæ— éœ€ä¾µå…¥ä»£ç é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤æ‚åœºæ™¯é€‰æ‹©è‡ªå®šä¹‰è§£ç å™¨&lt;/strong&gt;&lt;br&gt;
è‹¥æ¶‰åŠå­—æ®µç±»å‹è½¬æ¢ï¼ˆå¦‚ &lt;code&gt;Long&lt;/code&gt; è½¬ &lt;code&gt;String&lt;/code&gt;ï¼‰æˆ–é€»è¾‘å¤„ç†ï¼Œè‡ªå®šä¹‰ &lt;code&gt;Decoder&lt;/code&gt; æ›´çµæ´»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Feign é»˜è®¤ä¾èµ– Jackson&lt;/strong&gt;ï¼šç¡®ä¿æœåŠ¡æä¾›æ–¹ï¼ˆ&lt;code&gt;@RestController&lt;/code&gt;ï¼‰è¿”å›çš„ &lt;code&gt;UserInfo&lt;/code&gt; æ˜¯ JSON æ ¼å¼ï¼Œä¸”æ¶ˆè´¹æ–¹å·²å¼•å…¥ Jackson ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨ Java Record ç±»å‹ï¼Œéœ€ç¡®è®¤ Spring Cloud å’Œ OpenFeign ç‰ˆæœ¬æ”¯æŒ Record çš„ååºåˆ—åŒ–ï¼ˆå»ºè®® Spring Cloud 2021.0+ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼ŒOpenFeign å¯ä»¥çµæ´»å®ç°ä¸åŒ DTO ä¹‹é—´çš„æ˜ å°„ï¼Œæ»¡è¶³æ¥å£éš”ç¦»ä¸æ•°æ®è£å‰ªçš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="æ–¹æ¡ˆé€‰æ‹©"&gt;æ–¹æ¡ˆé€‰æ‹©
&lt;/h2&gt;&lt;p&gt;åœ¨ OpenFeign ä¸­å®ç° &lt;strong&gt;UserInfo åˆ° SpaceUserInfo çš„ DTO è‡ªåŠ¨æ˜ å°„&lt;/strong&gt;æ˜¯å¦ä¼šäº§ç”Ÿæ€§èƒ½å¼€é”€ï¼Œä»¥åŠæ˜¯å¦éœ€è¦é¢å¤–æ¥å£ä¼˜åŒ–ï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯æƒè¡¡ã€‚ä»¥ä¸‹æ˜¯å…³é”®åˆ†æåŠå»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¼€é”€åˆ†æ"&gt;æ€§èƒ½å¼€é”€åˆ†æ
&lt;/h3&gt;&lt;h4 id="é»˜è®¤åºåˆ—åŒ–ååºåˆ—åŒ–çš„å¼€é”€"&gt;&lt;strong&gt;é»˜è®¤åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¼€é”€&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨æ˜ å°„çš„åº•å±‚æœºåˆ¶&lt;/strong&gt;ï¼šOpenFeign é»˜è®¤ä½¿ç”¨ Jackson è¿›è¡Œ JSON è½¬æ¢ã€‚è‹¥ &lt;code&gt;UserInfo&lt;/code&gt; å’Œ &lt;code&gt;SpaceUserInfo&lt;/code&gt; çš„å­—æ®µåå’Œç±»å‹å®Œå…¨åŒ¹é…ï¼Œååºåˆ—åŒ–ä¼šç›´æ¥å¡«å……å¯¹åº”å­—æ®µï¼Œæ€§èƒ½æŸè€—æä½ï¼ˆä»…åœ¨åå°„è§£æ JSON æ—¶äº§ç”Ÿå¾®ç§’çº§è€—æ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µå†—ä½™çš„å½±å“&lt;/strong&gt;ï¼šè‹¥ &lt;code&gt;UserInfo&lt;/code&gt; åŒ…å« &lt;code&gt;SpaceUserInfo&lt;/code&gt; æ²¡æœ‰çš„å­—æ®µï¼ˆå¦‚ &lt;code&gt;userId&lt;/code&gt;ã€&lt;code&gt;email&lt;/code&gt;ï¼‰ï¼Œååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨å¿½ç•¥å¤šä½™å­—æ®µï¼Œä¸ä¼šæ˜¾è‘—å¢åŠ å¤„ç†æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ‰‹åŠ¨æ˜ å°„çš„å¼€é”€"&gt;&lt;strong&gt;æ‰‹åŠ¨æ˜ å°„çš„å¼€é”€&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰è§£ç å™¨ï¼ˆDecoderï¼‰&lt;/strong&gt;ï¼šè‹¥é€šè¿‡è‡ªå®šä¹‰ &lt;code&gt;Decoder&lt;/code&gt; å®ç°å­—æ®µè£å‰ªï¼ˆå¦‚ä»…æå– &lt;code&gt;username&lt;/code&gt;ã€&lt;code&gt;avatar&lt;/code&gt; ç­‰å­—æ®µï¼‰ï¼Œéœ€æ‰‹åŠ¨è§£æ JSON æˆ–åå°„æ“ä½œï¼Œå¯èƒ½å¼•å…¥ 1-5ms çš„é¢å¤–è€—æ—¶ï¼ˆå–å†³äºå­—æ®µå¤æ‚åº¦ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MapStruct ç­‰å·¥å…·&lt;/strong&gt;ï¼šç¼–è¯‘æœŸç”Ÿæˆæ˜ å°„ä»£ç çš„å·¥å…·ï¼ˆå¦‚ MapStructï¼‰æ€§èƒ½æ¥è¿‘åŸç”Ÿä»£ç ï¼Œå‡ ä¹æ— é¢å¤–å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç½‘ç»œä¼ è¾“å¼€é”€"&gt;&lt;strong&gt;ç½‘ç»œä¼ è¾“å¼€é”€&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¼ è¾“é‡&lt;/strong&gt;ï¼šè‹¥ &lt;code&gt;UserInfo&lt;/code&gt; åŒ…å«å¤§é‡æ— ç”¨å­—æ®µï¼ˆå¦‚ &lt;code&gt;postCount&lt;/code&gt;ã€&lt;code&gt;commentCount&lt;/code&gt;ï¼‰ï¼Œè¿”å›å®Œæ•´ &lt;code&gt;UserInfo&lt;/code&gt; å†è£å‰ªä¸º &lt;code&gt;SpaceUserInfo&lt;/code&gt; ä¼šå¢åŠ ç½‘ç»œä¼ è¾“æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå¤šä¼ è¾“ 10 ä¸ªå­—æ®µå¯èƒ½å¢åŠ  1-2KB æ•°æ®é‡ï¼Œå¯¹é«˜å¹¶å‘åœºæ™¯å½±å“è¾ƒå¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ˜¯å¦éœ€è¦é¢å¤–æ¥å£ä¼˜åŒ–"&gt;æ˜¯å¦éœ€è¦é¢å¤–æ¥å£ä¼˜åŒ–ï¼Ÿ
&lt;/h3&gt;&lt;h4 id="ç›´æ¥å¤ç”¨ç°æœ‰æ¥å£çš„ä¼˜ç¼ºç‚¹"&gt;&lt;strong&gt;ç›´æ¥å¤ç”¨ç°æœ‰æ¥å£çš„ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç ç®€æ´&lt;/strong&gt;ï¼šæ— éœ€æ–°å¢æ¥å£ï¼Œå‡å°‘æœåŠ¡ç«¯ç»´æŠ¤æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§&lt;/strong&gt;ï¼šé€‚ç”¨äºå­—æ®µå·®å¼‚å°ã€æ€§èƒ½ä¸æ•æ„Ÿçš„åœºæ™¯ï¼ˆå¦‚ä½é¢‘è°ƒç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†—ä½™æ•°æ®ä¼ è¾“&lt;/strong&gt;ï¼šé«˜é¢‘è°ƒç”¨æˆ–å­—æ®µå·®å¼‚å¤§æ—¶ï¼Œæµªè´¹å¸¦å®½å’Œåºåˆ—åŒ–èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ½œåœ¨è€¦åˆé£é™©&lt;/strong&gt;ï¼šè‹¥æœåŠ¡ç«¯ &lt;code&gt;UserInfo&lt;/code&gt; ç»“æ„å˜æ›´ï¼Œå®¢æˆ·ç«¯å¯èƒ½å› å­—æ®µè£å‰ªä¸å½»åº•è€ŒæŠ¥é”™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–°å¢ä¸“ç”¨æ¥å£çš„ä¼˜ç¼ºç‚¹"&gt;&lt;strong&gt;æ–°å¢ä¸“ç”¨æ¥å£çš„ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç²¾å‡†ä¼ è¾“&lt;/strong&gt;ï¼šä»…è¿”å› &lt;code&gt;SpaceUserInfo&lt;/code&gt; æ‰€éœ€å­—æ®µï¼Œå‡å°‘ç½‘ç»œå’Œåºåˆ—åŒ–å¼€é”€ï¼ˆå°¤å…¶é€‚åˆç§»åŠ¨ç«¯æˆ–å¼±ç½‘ç¯å¢ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£è€¦æ€§&lt;/strong&gt;ï¼šæœåŠ¡ç«¯å­—æ®µå˜æ›´ä¸å½±å“å®¢æˆ·ç«¯æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘æˆæœ¬&lt;/strong&gt;ï¼šéœ€æ–°å¢æ¥å£å¹¶ç»´æŠ¤ä¸¤å¥— DTOï¼Œå¢åŠ ä»£ç é‡å’Œæµ‹è¯•è´Ÿæ‹…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¥å£çˆ†ç‚¸&lt;/strong&gt;ï¼šè‹¥å­˜åœ¨å¤šä¸ªç±»ä¼¼åœºæ™¯ï¼ˆå¦‚ &lt;code&gt;SimpleUserInfo&lt;/code&gt;ã€&lt;code&gt;AdminUserInfo&lt;/code&gt;ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ¥å£æ•°é‡æ¿€å¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–å»ºè®®"&gt;ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;h4 id="ä¼˜å…ˆé€‰æ‹©ç°æœ‰æ¥å£çš„åœºæ™¯"&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©ç°æœ‰æ¥å£çš„åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µå·®å¼‚å°&lt;/strong&gt;ï¼šä¾‹å¦‚ä»…ç¼ºå°‘ 1-2 ä¸ªå­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½é¢‘è°ƒç”¨&lt;/strong&gt;ï¼šå¦‚æ¯æ—¥è°ƒç”¨é‡ä½äº 1 ä¸‡æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æœåŠ¡ç«¯è¿”å› UserInfoï¼Œå®¢æˆ·ç«¯é€šè¿‡ @JsonIgnoreProperties å¿½ç•¥å¤šä½™å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@JsonIgnoreProperties&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ignoreUnknown&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nickname&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ¨èæ–°å¢æ¥å£çš„åœºæ™¯"&gt;&lt;strong&gt;æ¨èæ–°å¢æ¥å£çš„åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘è°ƒç”¨&lt;/strong&gt;ï¼šå¦‚æ¯ç§’æ•°ç™¾æ¬¡è¯·æ±‚ï¼Œéœ€æè‡´ä¼˜åŒ–ç½‘ç»œå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µå·®å¼‚å¤§&lt;/strong&gt;ï¼šä¾‹å¦‚ &lt;code&gt;UserInfo&lt;/code&gt; åŒ…å« 20 ä¸ªå­—æ®µï¼Œè€Œ &lt;code&gt;SpaceUserInfo&lt;/code&gt; ä»…éœ€ 5 ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æœåŠ¡ç«¯æ–°å¢æ¥å£ï¼Œä»…è¿”å›å¿…è¦å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/space-user/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getSpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æŠ˜ä¸­æ–¹æ¡ˆè‡ªå®šä¹‰è§£ç å™¨"&gt;&lt;strong&gt;æŠ˜ä¸­æ–¹æ¡ˆï¼šè‡ªå®šä¹‰è§£ç å™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€åŠ¨æ€è£å‰ªå­—æ®µä½†ä¸æ„¿æ–°å¢æ¥å£æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SpaceUserInfoDecoder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Decoder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deserialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ååºåˆ—åŒ–ä¸º UserInfo&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpaceUserInfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;username&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nickname&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šç»“åˆç¼“å­˜ï¼ˆå¦‚ Guava Cacheï¼‰å¤ç”¨ååºåˆ—åŒ–ç»“æœï¼Œå‡å°‘é‡å¤è§£æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½æ•°æ®å‚è€ƒ"&gt;æ€§èƒ½æ•°æ®å‚è€ƒ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;å¹³å‡è€—æ—¶ï¼ˆå•æ¬¡è¯·æ±‚ï¼‰&lt;/th&gt;
&lt;th&gt;ç½‘ç»œä¼ è¾“é‡ï¼ˆKBï¼‰&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤ç”¨ç°æœ‰æ¥å£&lt;/td&gt;
&lt;td&gt;15ms&lt;/td&gt;
&lt;td&gt;5KB&lt;/td&gt;
&lt;td&gt;ä½é¢‘ã€å­—æ®µå·®å¼‚å°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ–°å¢ä¸“ç”¨æ¥å£&lt;/td&gt;
&lt;td&gt;10ms&lt;/td&gt;
&lt;td&gt;2KB&lt;/td&gt;
&lt;td&gt;é«˜é¢‘ã€å­—æ®µå·®å¼‚å¤§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰è§£ç å™¨&lt;/td&gt;
&lt;td&gt;18ms&lt;/td&gt;
&lt;td&gt;5KB&lt;/td&gt;
&lt;td&gt;åŠ¨æ€è£å‰ªã€æ‹’ç»æ¥å£çˆ†ç‚¸&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æ•æ„Ÿåœºæ™¯&lt;/strong&gt;ï¼šä¼˜å…ˆæ–°å¢ä¸“ç”¨æ¥å£ï¼Œå‡å°‘å†—ä½™æ•°æ®ä¼ è¾“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘ç»´æŠ¤ä¼˜å…ˆ&lt;/strong&gt;ï¼šé€‰æ‹©ç°æœ‰æ¥å£ + åŠ¨æ€æ˜ å°„ï¼Œå¹³è¡¡æ€§èƒ½ä¸ä»£ç ç®€æ´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ˜ä¸­æ–¹æ¡ˆ&lt;/strong&gt;ï¼šè‡ªå®šä¹‰è§£ç å™¨ + ç¼“å­˜ï¼Œé€‚ç”¨äºä¸­ç­‰è§„æ¨¡ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€ç»ˆå†³ç­–éœ€ç»“åˆå›¢é˜Ÿèµ„æºã€æ€§èƒ½è¦æ±‚å’ŒæœåŠ¡è§„æ¨¡ç»¼åˆåˆ¤æ–­ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopiaã€‘Micro-services</title><link>https://dyhes.github.io/p/postopiamicro-services/</link><pubDate>Wed, 14 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiamicro-services/</guid><description>&lt;h2 id="æœåŠ¡åˆ’åˆ†"&gt;æœåŠ¡åˆ’åˆ†
&lt;/h2&gt;&lt;p&gt;é’ˆå¯¹ä»¥â€œç©ºé—´-å¸–å­-è¯„è®ºâ€ä¸ºæ ¸å¿ƒå†…å®¹ä½“ç³»çš„å¾®æœåŠ¡è®ºå›åº”ç”¨ï¼ŒæœåŠ¡åˆ’åˆ†éœ€éµå¾ª&lt;strong&gt;ä¸šåŠ¡è¾¹ç•Œã€æ•°æ®ç‹¬ç«‹æ€§ã€é«˜å†…èšä½è€¦åˆ&lt;/strong&gt;ç­‰åŸåˆ™ï¼Œå¹¶ç»“åˆå›¢é˜Ÿç»„ç»‡ä¸äº‹åŠ¡ä¸€è‡´æ€§è¦æ±‚ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ’åˆ†å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒä¸šåŠ¡æœåŠ¡åˆ’åˆ†"&gt;æ ¸å¿ƒä¸šåŠ¡æœåŠ¡åˆ’åˆ†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æˆ·æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†ã€ä¸ªäººèµ„æ–™ç»´æŠ¤ï¼ˆå¦‚å¤´åƒã€æ˜µç§°ï¼‰åŠç”¨æˆ·å…³ç³»ï¼ˆå…³æ³¨/ç²‰ä¸ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç‹¬ç«‹&lt;/strong&gt;ï¼šç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼ˆIDã€å¯†ç å“ˆå¸Œã€æ³¨å†Œæ—¶é—´ï¼‰ã€æƒé™è§’è‰²è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ6çš„ç”¨æˆ·æ¨¡å—è®¾è®¡ä¸ç½‘é¡µ10çš„ç”¨æˆ·è¡¨è®¾è®¡å‡å¼ºè°ƒç”¨æˆ·ç‹¬ç«‹ç®¡ç†ï¼Œé¿å…ä¸å…¶ä»–æœåŠ¡è€¦åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç©ºé—´æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šç©ºé—´åˆ›å»ºã€æƒé™é…ç½®ï¼ˆå…¬å¼€/ç§å¯†ï¼‰ã€æˆå‘˜ç®¡ç†ï¼ˆå¦‚ç®¡ç†å‘˜è®¾ç½®ï¼‰ã€ç©ºé—´ç»Ÿè®¡ï¼ˆå¸–å­æ•°ã€æ´»è·ƒåº¦ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç‹¬ç«‹&lt;/strong&gt;ï¼šç©ºé—´å…ƒæ•°æ®ï¼ˆIDã€åç§°ã€æè¿°ï¼‰ã€æˆå‘˜å…³ç³»è¡¨ã€æƒé™è§„åˆ™è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç±»ä¼¼ç½‘é¡µ9ä¸­â€œè®ºå›ç‰ˆå—â€çš„ç‹¬ç«‹ç®¡ç†é€»è¾‘ï¼Œéœ€ä¸ç”¨æˆ·æƒé™ç»“åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸–å­æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå¸–å­å‘å¸ƒ/ç¼–è¾‘/åˆ é™¤ã€å†…å®¹å®¡æ ¸ï¼ˆå¦‚æ•æ„Ÿè¯è¿‡æ»¤ï¼‰ã€å¸–å­åˆ†ç±»ï¼ˆå¦‚ç½®é¡¶ã€ç²¾åï¼‰ã€æµè§ˆé‡ç»Ÿè®¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç‹¬ç«‹&lt;/strong&gt;ï¼šå¸–å­å†…å®¹è¡¨ï¼ˆIDã€æ ‡é¢˜ã€æ­£æ–‡ã€ä½œè€…IDã€ç©ºé—´IDï¼‰ã€åˆ†ç±»æ ‡ç­¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ11çš„å‰å°å¸–å­åŠŸèƒ½è®¾è®¡ä¸ç½‘é¡µ10çš„å¸–å­è¡¨ç»“æ„å‡å¼ºè°ƒå¸–å­çš„æ ¸å¿ƒä¸šåŠ¡ç‹¬ç«‹æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯„è®ºæœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šè¯„è®ºå‘å¸ƒ/å›å¤ã€ç‚¹èµ/ä¸¾æŠ¥ã€è¯„è®ºæ ‘å½¢ç»“æ„å±•ç¤ºã€å¼‚æ­¥å®¡æ ¸ï¼ˆå¦‚ååƒåœ¾æœºåˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç‹¬ç«‹&lt;/strong&gt;ï¼šè¯„è®ºå†…å®¹è¡¨ï¼ˆIDã€å¸–å­IDã€çˆ¶è¯„è®ºIDã€ç”¨æˆ·IDï¼‰ã€äº’åŠ¨è®¡æ•°è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ12çš„è¯„è®ºæœåŠ¡æ¡ˆä¾‹ä¸ç½‘é¡µ13çš„è¯„è®ºå¾®æœåŠ¡è®¾è®¡ï¼Œéœ€é€šè¿‡äº‹ä»¶é©±åŠ¨ä¸å¸–å­æœåŠ¡è§£è€¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ”¯æ’‘æ€§æœåŠ¡åˆ’åˆ†"&gt;æ”¯æ’‘æ€§æœåŠ¡åˆ’åˆ†
&lt;/h3&gt;&lt;ol start="5"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šçŸ¥æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šç³»ç»Ÿæ¶ˆæ¯ï¼ˆå¦‚è¯„è®ºå›å¤æé†’ï¼‰ã€ç”¨æˆ·é—´ç§ä¿¡ã€å…¨å±€å…¬å‘Šæ¨é€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯å®ç°&lt;/strong&gt;ï¼šç»“åˆæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaï¼‰å¼‚æ­¥å¤„ç†ï¼Œé¿å…é˜»å¡æ ¸å¿ƒä¸šåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ6çš„æ¶ˆæ¯æ¨¡å—ä¸ç½‘é¡µ4çš„ç«™å†…ä¿¡åŠŸèƒ½å‡éœ€ç‹¬ç«‹å¤„ç†é€šçŸ¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœç´¢æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå…¨æ–‡æ£€ç´¢ï¼ˆå¸–å­/è¯„è®ºå†…å®¹ï¼‰ã€çƒ­é—¨æ ‡ç­¾æ¨èã€æœç´¢ç»“æœæ’åºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯é€‰å‹&lt;/strong&gt;ï¼šé‡‡ç”¨Elasticsearchæˆ–åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ8çš„Elasticsearchæ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆä¸ç½‘é¡µ6çš„æœç´¢æ¨¡å—è®¾è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡ç­¾ä¸åˆ†ç±»æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæ ‡ç­¾ç®¡ç†ï¼ˆåˆ›å»º/åˆå¹¶ï¼‰ã€åˆ†ç±»è§„åˆ™é…ç½®ï¼ˆå¦‚æŒ‰ä¸»é¢˜æˆ–çƒ­åº¦ï¼‰ã€æ ‡ç­¾å…³è”ç»Ÿè®¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç‹¬ç«‹&lt;/strong&gt;ï¼šæ ‡ç­¾å…ƒæ•°æ®è¡¨ã€æ ‡ç­¾-å†…å®¹å…³è”è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ9ä¸­åˆ†ç±»ä¸æ ‡ç­¾çš„ç‹¬ç«‹å»ºæ¨¡å»ºè®®ï¼Œé¿å…ä¸å¸–å­æœåŠ¡å¼ºè€¦åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŸºç¡€è®¾æ–½æœåŠ¡åˆ’åˆ†"&gt;åŸºç¡€è®¾æ–½æœåŠ¡åˆ’åˆ†
&lt;/h3&gt;&lt;ol start="8"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¤è¯ä¸æˆæƒæœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šOAuth2/JWTé‰´æƒã€APIè®¿é—®æ§åˆ¶ã€è§’è‰²æƒé™åŠ¨æ€é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯å®ç°&lt;/strong&gt;ï¼šç»“åˆç½‘å…³ï¼ˆå¦‚Zuulæˆ–Spring Cloud Gatewayï¼‰ç»Ÿä¸€æ‹¦æˆªè¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘æ§ä¸æ—¥å¿—æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šæœåŠ¡å¥åº·çŠ¶æ€ç›‘æµ‹ã€æ€§èƒ½æŒ‡æ ‡æ”¶é›†ï¼ˆå¦‚å“åº”æ—¶é—´ï¼‰ã€æ—¥å¿—èšåˆä¸åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯é€‰å‹&lt;/strong&gt;ï¼šPrometheus+Grafanaç›‘æ§ã€ELKæ—¥å¿—ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–‡ä»¶å­˜å‚¨æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šå›¾ç‰‡/è§†é¢‘ä¸Šä¼ ã€CDNåˆ†å‘ã€ç¼©ç•¥å›¾ç”Ÿæˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç‹¬ç«‹&lt;/strong&gt;ï¼šæ–‡ä»¶å…ƒæ•°æ®è¡¨ã€å­˜å‚¨è·¯å¾„æ˜ å°„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚è€ƒä¾æ®&lt;/strong&gt;ï¼šç½‘é¡µ3çš„é™„ä»¶ä¸Šä¼ åŠŸèƒ½ä¸ç½‘é¡µ6çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè®¾è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®è®¾è®¡åŸåˆ™"&gt;å…³é”®è®¾è®¡åŸåˆ™
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸€è‡´æ€§&lt;/strong&gt;ï¼šé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹ï¼ˆå¦‚é€šè¿‡äº‹ä»¶é©±åŠ¨ï¼‰ï¼Œä¾‹å¦‚è¯„è®ºæœåŠ¡å¼‚æ­¥æ›´æ–°å¸–å­è®¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›¢é˜Ÿæ˜ å°„&lt;/strong&gt;ï¼šæŒ‰â€œæµåŠ¨å‹å›¢é˜Ÿâ€åˆ’åˆ†ï¼ˆå¦‚ç”¨æˆ·å›¢é˜Ÿã€å¸–å­å›¢é˜Ÿï¼‰ï¼Œæ¯ä¸ªæœåŠ¡ç”±5-9äººè´Ÿè´£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è¾¹ç•Œ&lt;/strong&gt;ï¼šé¿å…è·¨æœåŠ¡ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€šè¿‡APIæˆ–äº‹ä»¶é€šä¿¡ï¼ˆå¦‚ç©ºé—´æœåŠ¡ç»Ÿè®¡å¸–å­æ•°æ—¶è°ƒç”¨å¸–å­æœåŠ¡APIï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šé«˜é¢‘è¯»æ“ä½œï¼ˆå¦‚çƒ­é—¨å¸–å­åˆ—è¡¨ï¼‰ä½¿ç”¨Redisç¼“å­˜ï¼›å†™æ“ä½œï¼ˆå¦‚è¯„è®ºå‘å¸ƒï¼‰é€šè¿‡åˆ†åº“åˆ†è¡¨æå‡å¹¶å‘èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹è°ƒç”¨æµç¨‹ç¤ºä¾‹"&gt;å…¸å‹è°ƒç”¨æµç¨‹ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç”¨æˆ·å‘å¸ƒå¸–å­å¹¶æ”¶åˆ°è¯„è®ºé€šçŸ¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡&lt;strong&gt;è®¤è¯æœåŠ¡&lt;/strong&gt;é‰´æƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸–å­æœåŠ¡&lt;/strong&gt;å¤„ç†å‘å¸ƒè¯·æ±‚ï¼Œå†™å…¥æ•°æ®åº“å¹¶å‘é€â€œå¸–å­åˆ›å»ºâ€äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æœåŠ¡&lt;/strong&gt;è®¢é˜…äº‹ä»¶ï¼Œæ›´æ–°ç©ºé—´ç»Ÿè®¡ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–ç”¨æˆ·å‘è¡¨è¯„è®ºæ—¶ï¼Œ&lt;strong&gt;è¯„è®ºæœåŠ¡&lt;/strong&gt;å¤„ç†å¹¶è§¦å‘â€œè¯„è®ºæ–°å¢â€äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šçŸ¥æœåŠ¡&lt;/strong&gt;è®¢é˜…äº‹ä»¶ï¼Œæ¨é€æ¶ˆæ¯è‡³ç”¨æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šåˆ’åˆ†ï¼Œç³»ç»Ÿå¯å…¼é¡¾ä¸šåŠ¡çµæ´»æ€§ä¸æŠ€æœ¯æ‰©å±•æ€§ï¼ŒåŒæ—¶é™ä½è·¨å›¢é˜Ÿåä½œæˆæœ¬ã€‚å…·ä½“å®æ–½æ—¶å¯ç»“åˆDDDçš„é™ç•Œä¸Šä¸‹æ–‡ï¼ˆå¦‚åŒºåˆ†â€œå¸–å­å†…å®¹â€ä¸â€œè¯„è®ºäº’åŠ¨â€ä¸Šä¸‹æ–‡ï¼‰è¿›ä¸€æ­¥ç»†åŒ–ã€‚&lt;/p&gt;
&lt;h2 id="å¾ªç¯ä¾èµ–"&gt;å¾ªç¯ä¾èµ–
&lt;/h2&gt;&lt;p&gt;å¾®æœåŠ¡æ¶æ„ä¸­&lt;strong&gt;ä¸å…è®¸æœåŠ¡ä¹‹é—´å½¢æˆå¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼Œè¿™ä¼šä¸¥é‡ç ´åå¾®æœåŠ¡çš„æ ¸å¿ƒä»·å€¼ï¼ˆç‹¬ç«‹æ€§ã€å¯æ‰©å±•æ€§ï¼‰ï¼Œå¹¶å¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¾ªç¯ä¾èµ–çš„å±å®³"&gt;å¾ªç¯ä¾èµ–çš„å±å®³
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç ´åæœåŠ¡è‡ªæ²»æ€§&lt;/strong&gt;&lt;br&gt;
å¾ªç¯ä¾èµ–ä¼šå¯¼è‡´æœåŠ¡æ— æ³•ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡ä¸å®¢æˆ·æœåŠ¡ç›¸äº’è°ƒç”¨æ—¶ï¼Œä¿®æ”¹ä»»æ„ä¸€æ–¹éƒ½éœ€è¦åè°ƒå¦ä¸€æ–¹åŒæ­¥æ›´æ–°ï¼Œè¿èƒŒå¾®æœåŠ¡ã€Œç‹¬ç«‹è¿­ä»£ã€åŸåˆ™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼•å‘åˆ†å¸ƒå¼æ­»é”é£é™©&lt;/strong&gt;&lt;br&gt;
è‹¥æœåŠ¡Aè°ƒç”¨æœåŠ¡Bçš„åŒæ—¶ï¼ŒæœåŠ¡Båˆåå‘è°ƒç”¨æœåŠ¡Aï¼Œå¯èƒ½å› è¶…æ—¶æˆ–èµ„æºç«äº‰å¯¼è‡´ç³»ç»Ÿçº§æ­»é”ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·æœåŠ¡æ›´æ–°æ—¶è§¦å‘è®¢å•æœåŠ¡è°ƒç”¨ï¼Œè€Œè®¢å•æœåŠ¡åˆéœ€å›æŸ¥å®¢æˆ·ä¿¡æ¯ï¼Œå½¢æˆé˜»å¡é“¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¢åŠ ç³»ç»Ÿå¤æ‚æ€§&lt;/strong&gt;&lt;br&gt;
å¾ªç¯ä¾èµ–ä¼šå½¢æˆç½‘çŠ¶è°ƒç”¨å…³ç³»ï¼Œä½¿æ•…éšœæ’æŸ¥ã€æ€§èƒ½ä¼˜åŒ–å’Œä»£ç ç»´æŠ¤æˆæœ¬æ¿€å¢ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ5çš„æ¡ˆä¾‹ä¸­ï¼Œå•†å“æœåŠ¡ä¸å®¢æˆ·æœåŠ¡ç›¸äº’è°ƒç”¨å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œéœ€é€šè¿‡å¤æ‚æ’é™¤æ‰‹æ®µå®šä½é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¾ªç¯ä¾èµ–çš„å…¸å‹æˆå› "&gt;å¾ªç¯ä¾èµ–çš„å…¸å‹æˆå› 
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®å†—ä½™è®¾è®¡ä¸å½“&lt;/strong&gt;&lt;br&gt;
å¦‚è®¢å•æœåŠ¡å†—ä½™å®¢æˆ·å§“åå­—æ®µï¼Œå½“å®¢æˆ·ä¿¡æ¯å˜æ›´æ—¶ï¼Œéœ€åå‘è°ƒç”¨è®¢å•æœåŠ¡æ›´æ–°å†—ä½™æ•°æ®ï¼Œå½¢æˆåŒå‘ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡è¾¹ç•Œåˆ’åˆ†æ¨¡ç³Š&lt;/strong&gt;&lt;br&gt;
æœªéµå¾ªDDDé™ç•Œä¸Šä¸‹æ–‡åŸåˆ™ï¼Œå°†æœ¬åº”å†…èšçš„é€»è¾‘æ‹†åˆ†åˆ°ä¸åŒæœåŠ¡ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—å®¢æˆ·çŠ¶æ€éœ€è¦ä¾èµ–è®¢å•æœåŠ¡çš„æŸ¥è¯¢ç»“æœï¼Œè€Œéåœ¨å®¢æˆ·æœåŠ¡å†…å®šä¹‰çŠ¶æ€å­—æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ»¥ç”¨åŒæ­¥è°ƒç”¨&lt;/strong&gt;&lt;br&gt;
ä¸ºè¿½æ±‚å®ç°ç®€ä¾¿æ€§ï¼Œç›´æ¥é€šè¿‡HTTPåŒæ­¥è°ƒç”¨å…¶ä»–æœåŠ¡ï¼Œè€Œéé‡‡ç”¨äº‹ä»¶é©±åŠ¨ç­‰è§£è€¦æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆä¸æœ€ä½³å®è·µ"&gt;è§£å†³æ–¹æ¡ˆä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é‡æ„æœåŠ¡è¾¹ç•Œ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šç§»ç­–ç•¥&lt;/strong&gt;ï¼šå°†å…¬å…±é€»è¾‘æŠ½è±¡ä¸ºæ–°æœåŠ¡ï¼ˆå¦‚æ”¯ä»˜ä¸­ä»‹æœåŠ¡ï¼‰ï¼Œæ‰“ç ´è®¢å•ä¸å®¢æˆ·æœåŠ¡çš„ç›´æ¥ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸‹ç§»ç­–ç•¥&lt;/strong&gt;ï¼šå°†äº¤å‰é€»è¾‘ä¸‹æ²‰åˆ°ä¸‹å±‚åŸºç¡€æœåŠ¡ï¼ˆå¦‚å…ƒæ•°æ®æœåŠ¡ï¼‰ï¼Œç¡®ä¿ä¸Šå±‚æœåŠ¡å•å‘è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥äº‹ä»¶é©±åŠ¨&lt;/strong&gt;&lt;br&gt;
é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaï¼‰å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ä¿¡æ¯å˜æ›´æ—¶å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼Œè®¢å•æœåŠ¡è®¢é˜…è¯¥äº‹ä»¶å¼‚æ­¥æ›´æ–°å†—ä½™æ•°æ®ï¼Œé¿å…åŒæ­¥è°ƒç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼•å…¥BFFå±‚ï¼ˆBackend for Frontendï¼‰&lt;/strong&gt;&lt;br&gt;
å°†èšåˆå¤šä¸ªæœåŠ¡æ•°æ®çš„é€»è¾‘å‰ç½®åˆ°BFFå±‚ï¼Œè€Œéè®©æœåŠ¡ç›´æ¥äº’ç›¸è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·è½¨è¿¹é¡µé¢éœ€è¦çš„è®¢å•æ•°æ®ç”±BFFå±‚åˆ†åˆ«è°ƒç”¨å®¢æˆ·æœåŠ¡å’Œè®¢å•æœåŠ¡åç»„åˆè¿”å›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æ²»ç†åŸåˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»¥IDå…³è”æ›¿ä»£æ•°æ®å†—ä½™&lt;/strong&gt;ï¼šä»…å­˜å‚¨å…³è”IDè€Œéå®Œæ•´å­—æ®µï¼Œå¦‚è®¢å•ä¸­ä»…å­˜å®¢æˆ·IDï¼Œå‰ç«¯å±•ç¤ºæ—¶å†æŒ‰éœ€æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰è‡ªæ´½çš„ä¸šåŠ¡çŠ¶æ€&lt;/strong&gt;ï¼šåœ¨æœåŠ¡å†…éƒ¨å°è£…å®Œæ•´çŠ¶æ€æœºï¼Œé¿å…ä¾èµ–å¤–éƒ¨æœåŠ¡è®¡ç®—çŠ¶æ€ï¼ˆå¦‚å®¢æˆ·æœåŠ¡è‡ªè¡Œç»´æŠ¤ã€Œæ´»è·ƒçŠ¶æ€ã€å­—æ®µï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é¢„é˜²æ€§è®¾è®¡åŸåˆ™"&gt;é¢„é˜²æ€§è®¾è®¡åŸåˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å±‚ä¾èµ–è§„åˆ™&lt;/strong&gt;&lt;br&gt;
è®¾å®šä¸¥æ ¼çš„è°ƒç”¨å±‚çº§ï¼ˆå¦‚åŸºç¡€è®¾æ–½å±‚â†’é¢†åŸŸæœåŠ¡å±‚â†’èšåˆå±‚ï¼‰ï¼Œç¦æ­¢ä¸‹å±‚æœåŠ¡è°ƒç”¨ä¸Šå±‚æœåŠ¡ï¼ŒåŒçº§æœåŠ¡ç¦æ­¢ç›´æ¥è°ƒç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–å…³ç³»å¯è§†åŒ–&lt;/strong&gt;&lt;br&gt;
é€šè¿‡é“¾è·¯è¿½è¸ªå·¥å…·ï¼ˆå¦‚Zipkinï¼‰å®šæœŸç”ŸæˆæœåŠ¡ä¾èµ–å›¾è°±ï¼Œä¸»åŠ¨è¯†åˆ«æ½œåœ¨å¾ªç¯ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶æ„è¯„å®¡æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
åœ¨éœ€æ±‚è®¾è®¡é˜¶æ®µå¼ºåˆ¶è¿›è¡Œä¾èµ–å…³ç³»å®¡æŸ¥ï¼Œå°¤å…¶æ˜¯è·¨å›¢é˜Ÿåä½œæ—¶ï¼Œç¡®ä¿æ–°å¢æ¥å£ç¬¦åˆå•å‘è°ƒç”¨è§„èŒƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¾®æœåŠ¡é—´çš„å¾ªç¯ä¾èµ–æ˜¯å…¸å‹çš„ã€Œæ¶æ„åå‘³é“ã€ï¼Œå¿…é¡»é€šè¿‡&lt;strong&gt;ä¸šåŠ¡é‡æ„ã€å¼‚æ­¥è§£è€¦å’ŒæŠ€æœ¯çº¦æŸ&lt;/strong&gt;ç­‰æ‰‹æ®µæ ¹æ²»ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š&lt;strong&gt;ç¡®ä¿æœåŠ¡è°ƒç”¨é“¾è·¯å§‹ç»ˆä¸ºå•å‘æ ‘çŠ¶ç»“æ„ï¼Œè€Œéç¯å½¢æˆ–ç½‘çŠ¶&lt;/strong&gt;ã€‚å¯¹äºå·²å­˜åœ¨çš„å¾ªç¯ä¾èµ–ï¼Œå¯å‚è€ƒç½‘é¡µ4æå‡ºçš„ã€Œäº‹ä»¶é£æš´åˆ†ææ³•ã€ï¼Œé€šè¿‡é¢†åŸŸäº‹ä»¶å»ºæ¨¡é€æ­¥é‡æ„ã€‚&lt;/p&gt;
&lt;h2 id="ä¸åŒæœåŠ¡ç›´æ¥æ“ä½œåŒä¸€å¼ æ•°æ®åº“è¡¨"&gt;&lt;strong&gt;ä¸åŒæœåŠ¡ç›´æ¥æ“ä½œåŒä¸€å¼ æ•°æ®åº“è¡¨&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;ä¸åŒæœåŠ¡ç›´æ¥æ“ä½œåŒä¸€å¼ æ•°æ®åº“è¡¨æ˜¯è¿åè®¾è®¡åŸåˆ™çš„&lt;/strong&gt;ï¼Œä½†å¯é€šè¿‡ç‰¹å®šç­–ç•¥å®ç°æ•°æ®å…±äº«ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç›´æ¥å…±äº«è¡¨çš„å¼Šç«¯ä¸æ¨è"&gt;ç›´æ¥å…±äº«è¡¨çš„å¼Šç«¯ï¼ˆä¸æ¨èï¼‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç ´åæœåŠ¡è‡ªæ²»æ€§&lt;/strong&gt;&lt;br&gt;
è‹¥PostæœåŠ¡ï¼ˆå†™æ“ä½œï¼‰ä¸SearchæœåŠ¡ï¼ˆè¯»æ“ä½œï¼‰ç›´æ¥æ“ä½œåŒä¸€å¼ è¡¨ï¼Œä¼šå¯¼è‡´ä¸¤è€…&lt;strong&gt;å¼ºè€¦åˆ&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼ŒPostè¡¨ç»“æ„å˜æ›´éœ€åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªæœåŠ¡ï¼Œè¿èƒŒå¾®æœåŠ¡ç‹¬ç«‹æ¼”è¿›çš„æ ¸å¿ƒç†å¿µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§é£é™©&lt;/strong&gt;&lt;br&gt;
å¹¶å‘å†™å…¥å¯èƒ½å¼•å‘æ•°æ®ç«äº‰ã€‚ä¾‹å¦‚ï¼ŒPostæœåŠ¡æ›´æ–°å¸–å­å†…å®¹æ—¶ï¼ŒSearchæœåŠ¡è‹¥åŒæ—¶æ›´æ–°æœç´¢ç´¢å¼•å­—æ®µï¼Œå¯èƒ½å¯¼è‡´éƒ¨åˆ†æ›´æ–°ä¸¢å¤±æˆ–çŠ¶æ€ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆä¸æ‰©å±•é™åˆ¶&lt;/strong&gt;&lt;br&gt;
é«˜é¢‘è¯»å†™æ“ä½œé›†ä¸­åœ¨åŒä¸€å¼ è¡¨æ—¶ï¼Œéš¾ä»¥é’ˆå¯¹ä¸åŒè´Ÿè½½ç‰¹æ€§ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼ŒSearchæœåŠ¡éœ€è¦å…¨æ–‡ç´¢å¼•åŠ é€ŸæŸ¥è¯¢ï¼Œè€ŒPostæœåŠ¡éœ€äº‹åŠ¡æ”¯æŒï¼Œå•ä¸€è¡¨ç»“æ„æ— æ³•å…¼é¡¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ›¿ä»£æ–¹æ¡ˆä¸æœ€ä½³å®è·µ"&gt;æ›¿ä»£æ–¹æ¡ˆä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="æ–¹æ¡ˆ1æœåŠ¡é—´è§£è€¦--æ•°æ®åŒæ­¥"&gt;æ–¹æ¡ˆ1ï¼šæœåŠ¡é—´è§£è€¦ + æ•°æ®åŒæ­¥
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èŒè´£åˆ†ç¦»&lt;/strong&gt;&lt;br&gt;
PostæœåŠ¡&lt;strong&gt;ç‹¬å å†™æƒé™&lt;/strong&gt;ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨ï¼ˆå¦‚Kafkaï¼‰å‘å¸ƒæ•°æ®å˜æ›´äº‹ä»¶ï¼›SearchæœåŠ¡è®¢é˜…äº‹ä»¶ï¼Œå¼‚æ­¥æ„å»ºç‹¬ç«‹çš„æœç´¢ç´¢å¼•è¡¨ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè§£è€¦æœåŠ¡ï¼Œå…è®¸SearchæœåŠ¡è‡ªç”±é€‰æ‹©å­˜å‚¨å¼•æ“ï¼ˆå¦‚Elasticsearchï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# PostæœåŠ¡å‘å¸ƒäº‹ä»¶ï¼ˆDjangoç¤ºä¾‹ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.db&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;transaction&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django_events&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;emit_event&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;update_post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;transaction&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;atomic&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;emit_event&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;post_updated&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;post_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# SearchæœåŠ¡æ¶ˆè´¹äº‹ä»¶ï¼ˆPythonæ¶ˆè´¹è€…ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;kafka&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;KafkaConsumer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;consumer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;KafkaConsumer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;post_events&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;consumer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;post_updated&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;update_search_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;post_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;content&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–¹æ¡ˆ2cqrsæ¨¡å¼å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»"&gt;æ–¹æ¡ˆ2ï¼šCQRSæ¨¡å¼ï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»è®¾è®¡&lt;/strong&gt;&lt;br&gt;
PostæœåŠ¡ä½œä¸ºâ€œå‘½ä»¤ç«¯â€å¤„ç†å†™æ“ä½œï¼ŒSearchæœåŠ¡ä½œä¸ºâ€œæŸ¥è¯¢ç«¯â€ç»´æŠ¤åªè¯»å‰¯æœ¬ã€‚é€šè¿‡ç‰©åŒ–è§†å›¾æˆ–ç¼“å­˜ï¼ˆå¦‚Redisï¼‰åŒæ­¥æ•°æ®ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜åŒ–ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹SearchæœåŠ¡å¯ç”¨&lt;strong&gt;åˆ†åŒºè¡¨&lt;/strong&gt;ï¼ˆæŒ‰æ—¶é—´æˆ–ç”¨æˆ·IDï¼‰ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨PostgreSQLçš„&lt;strong&gt;JSONBå­—æ®µ+ GINç´¢å¼•&lt;/strong&gt;ï¼Œå…¼é¡¾çµæ´»æŸ¥è¯¢ä¸é«˜æ•ˆå­˜å‚¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–¹æ¡ˆ3apiç½‘å…³èšåˆ"&gt;æ–¹æ¡ˆ3ï¼šAPIç½‘å…³èšåˆ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‰ç«¯æ•°æ®æ•´åˆ&lt;/strong&gt;&lt;br&gt;
é€šè¿‡BFFï¼ˆBackend for Frontendï¼‰å±‚èšåˆå¤šä¸ªæœåŠ¡çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¯·æ±‚å¸–å­è¯¦æƒ…æ—¶ï¼Œç½‘å…³å¹¶è¡Œè°ƒç”¨PostæœåŠ¡å’ŒSearchæœåŠ¡ï¼Œåˆå¹¶è¿”å›ç»“æœã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¯»å¤šå†™å°‘ã€å®æ—¶æ€§è¦æ±‚ä½çš„åœºæ™¯ï¼Œå¦‚å±•ç¤ºå¸–å­åŸºç¡€ä¿¡æ¯åŠå…³è”çš„æœç´¢å…³é”®è¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸ä¸€è‡´æ€§æƒè¡¡"&gt;æ€§èƒ½ä¸ä¸€è‡´æ€§æƒè¡¡
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ¨èæ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;ä¸€è‡´æ€§æ¨¡å‹&lt;/th&gt;
&lt;th&gt;æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜å¹¶å‘å†™å…¥&lt;/td&gt;
&lt;td&gt;äº‹ä»¶é©±åŠ¨ + å¼‚æ­¥ç´¢å¼•&lt;/td&gt;
&lt;td&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/td&gt;
&lt;td&gt;Kafkaåˆ†åŒº + æ‰¹é‡æ¶ˆè´¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;CQRS + ç‰©åŒ–è§†å›¾&lt;/td&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§&lt;/td&gt;
&lt;td&gt;PostgreSQLçª—å£å‡½æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®æ—¶æœç´¢&lt;/td&gt;
&lt;td&gt;ç‹¬ç«‹æœç´¢å¼•æ“&lt;/td&gt;
&lt;td&gt;è¿‘å®æ—¶&lt;/td&gt;
&lt;td&gt;Elasticsearchå€’æ’ç´¢å¼•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é¿å…ä¸åŒæœåŠ¡ç›´æ¥æ“ä½œåŒä¸€å¼ è¡¨&lt;/strong&gt;ï¼Œä¼˜å…ˆé‡‡ç”¨äº‹ä»¶é©±åŠ¨ã€CQRSæˆ–APIèšåˆç­‰è§£è€¦æ–¹æ¡ˆã€‚è‹¥å› å†å²é—ç•™ç³»ç»Ÿå¿…é¡»å…±äº«è¡¨ï¼Œéœ€é€šè¿‡ä»¥ä¸‹æªæ–½é™ä½é£é™©ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®šä¹‰æ¸…æ™°çš„&lt;strong&gt;æ•°æ®æ“ä½œè¾¹ç•Œ&lt;/strong&gt;ï¼ˆå¦‚å­˜å‚¨è¿‡ç¨‹å°è£…å†™æ“ä½œï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºä¸åŒæœåŠ¡å»ºç«‹&lt;strong&gt;ç‹¬ç«‹è¯»å†™å‰¯æœ¬&lt;/strong&gt;ï¼Œé€šè¿‡è§¦å‘å™¨æˆ–CDCï¼ˆChange Data Captureï¼‰åŒæ­¥ï¼›&lt;/li&gt;
&lt;li&gt;å¼•å…¥&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;ï¼ˆå¦‚Redis Redlockï¼‰æ§åˆ¶å¹¶å‘å†™å…¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="kafkaçš„producer--consumer"&gt;Kafkaçš„Producer &amp;amp; Consumer
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒKafkaçš„Producerå’ŒConsumerçš„éƒ¨ç½²ç­–ç•¥éœ€æ ¹æ®&lt;strong&gt;ä¸šåŠ¡åœºæ™¯ã€æ€§èƒ½éœ€æ±‚ã€ç»´æŠ¤æˆæœ¬&lt;/strong&gt;è¿›è¡Œæƒè¡¡ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆåˆ†æä¸å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤æ–¹æ¡ˆåµŒå…¥å¯¹åº”æœåŠ¡æ¨èå¤šæ•°åœºæ™¯"&gt;é»˜è®¤æ–¹æ¡ˆï¼šåµŒå…¥å¯¹åº”æœåŠ¡ï¼ˆæ¨èå¤šæ•°åœºæ™¯ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å°†Producer/Consumerä½œä¸ºå¾®æœåŠ¡å†…éƒ¨ç»„ä»¶&lt;/strong&gt;ï¼Œä¸æœåŠ¡ä¸šåŠ¡é€»è¾‘æ·±åº¦ç»‘å®šï¼Œé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡é€»è¾‘å¼ºå…³è”&lt;/strong&gt;&lt;br&gt;
å½“æ¶ˆæ¯ç”Ÿäº§/æ¶ˆè´¹ä¸å…·ä½“ä¸šåŠ¡ç´§å¯†è€¦åˆæ—¶ï¼ˆå¦‚è®¢å•æœåŠ¡ç”Ÿäº§è®¢å•åˆ›å»ºäº‹ä»¶ï¼Œåº“å­˜æœåŠ¡æ¶ˆè´¹è¯¥äº‹ä»¶æ‰£å‡åº“å­˜ï¼‰ï¼Œåº”ç›´æ¥åµŒå…¥æœåŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šä»£ç å†…èšï¼Œé¿å…è·¨æœåŠ¡è°ƒç”¨ï¼›ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼ˆå¦‚è®¢å•æœåŠ¡ä»…å…³æ³¨è®¢å•é¢†åŸŸï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°ç¤ºä¾‹&lt;/strong&gt;ï¼šè®¢å•æœåŠ¡å†…éƒ¨è°ƒç”¨KafkaProducerå‘é€æ¶ˆæ¯ï¼Œåº“å­˜æœåŠ¡é€šè¿‡@KafkaListeneræ³¨è§£æ¶ˆè´¹æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºéš”ç¦»ä¸å¼¹æ€§æ‰©å±•&lt;/strong&gt;&lt;br&gt;
å„æœåŠ¡å¯ç‹¬ç«‹è°ƒæ•´ç”Ÿäº§/æ¶ˆè´¹é€Ÿç‡ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çªå‘æµé‡æ—¶ï¼Œè®¢å•æœåŠ¡å¯ç‹¬ç«‹æ‰©å®¹Producerå®ä¾‹ï¼Œè€Œæ”¯ä»˜æœåŠ¡å•ç‹¬æ‰©å±•Consumerå®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰æœºåˆ¶è‡ªåŠ¨åˆ†é…åˆ†åŒºï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿ç»´ç®€åŒ–&lt;/strong&gt;&lt;br&gt;
æœåŠ¡ä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é…ç½®ï¼ˆå¦‚Topicã€åºåˆ—åŒ–æ–¹å¼ï¼‰é›†ä¸­ç®¡ç†ï¼Œé™ä½è·¨å›¢é˜Ÿåè°ƒæˆæœ¬ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Spring Kafkaæ—¶ï¼Œé€šè¿‡&lt;code&gt;application.yml&lt;/code&gt;ç»Ÿä¸€é…ç½®bootstrap serverså’Œååºåˆ—åŒ–å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŠ½å–ä¸ºç‹¬ç«‹æœåŠ¡ç‰¹å®šåœºæ™¯é€‚ç”¨"&gt;æŠ½å–ä¸ºç‹¬ç«‹æœåŠ¡ï¼ˆç‰¹å®šåœºæ™¯é€‚ç”¨ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å°†Producer/ConsumeræŠ½å–ä¸ºå•ç‹¬æœåŠ¡&lt;/strong&gt;ï¼Œé€‚ç”¨äºä»¥ä¸‹ç‰¹æ®Šéœ€æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨æœåŠ¡æ¶ˆæ¯å¤ç”¨&lt;/strong&gt;&lt;br&gt;
å½“å¤šä¸ªæœåŠ¡éœ€è¦æ¶ˆè´¹åŒä¸€Topicä¸”å¤„ç†é€»è¾‘é«˜åº¦ç›¸ä¼¼æ—¶ï¼Œå¯æŠ½å–å…¬å…±ConsumeræœåŠ¡ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¥å¿—å®¡è®¡æœåŠ¡ç»Ÿä¸€æ¶ˆè´¹æ‰€æœ‰ä¸šåŠ¡Topicï¼Œè¿›è¡Œç»Ÿä¸€å­˜å‚¨å’Œåˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼šç‹¬ç«‹æœåŠ¡è®¢é˜…å¤šä¸ªTopicï¼Œé€šè¿‡è·¯ç”±é€»è¾‘åˆ†å‘åˆ°ä¸åŒå¤„ç†æ¨¡å—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¶…é«˜ååé‡åœºæ™¯&lt;/strong&gt;&lt;br&gt;
è‹¥å•æœåŠ¡æ— æ³•æ‰¿è½½æ¶ˆæ¯å¤„ç†å‹åŠ›ï¼ˆå¦‚ç§’æ€ç³»ç»Ÿï¼‰ï¼Œå¯æ‹†åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬ç«‹Produceré›†ç¾¤&lt;/strong&gt;ï¼šé›†ä¸­å¤„ç†æ¶ˆæ¯åºåˆ—åŒ–ã€æ‰¹é‡å‘é€ï¼ˆ&lt;code&gt;linger.ms&lt;/code&gt;å’Œ&lt;code&gt;batch.size&lt;/code&gt;ä¼˜åŒ–ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬ç«‹Consumeré›†ç¾¤&lt;/strong&gt;ï¼šé€šè¿‡å¹¶è¡Œæ¶ˆè´¹ï¼ˆå¢åŠ åˆ†åŒºæ•°+æ¶ˆè´¹è€…å®ä¾‹ï¼‰æå‡ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯æ ˆå¼‚æ„&lt;/strong&gt;&lt;br&gt;
å½“éƒ¨åˆ†æœåŠ¡éœ€ä½¿ç”¨ç‰¹å®šè¯­è¨€æˆ–æ¡†æ¶ï¼ˆå¦‚GolangæœåŠ¡è°ƒç”¨Javaå®ç°çš„å¤æ‚åºåˆ—åŒ–é€»è¾‘ï¼‰ï¼Œå¯å°è£…ä¸ºç‹¬ç«‹æœåŠ¡æä¾›ç»Ÿä¸€APIã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å†³ç­–å…³é”®æŒ‡æ ‡å¯¹æ¯”"&gt;å†³ç­–å…³é”®æŒ‡æ ‡å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç»´åº¦&lt;/th&gt;
&lt;th&gt;åµŒå…¥æœåŠ¡æ–¹æ¡ˆä¼˜åŠ¿&lt;/th&gt;
&lt;th&gt;ç‹¬ç«‹æœåŠ¡æ–¹æ¡ˆé€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è€¦åˆåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆä¸šåŠ¡ä¸æ¶ˆæ¯å¤„ç†é€»è¾‘å†…èšï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€å®šä¹‰ç»Ÿä¸€æ¶ˆæ¯åè®®ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½å»¶è¿Ÿï¼ˆæ— è·¨æœåŠ¡è°ƒç”¨ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ååï¼ˆä¸“ç”¨èµ„æºä¼˜åŒ–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‰ä¸šåŠ¡ç»´åº¦ç‹¬ç«‹æ‰©å±•&lt;/td&gt;
&lt;td&gt;æŒ‰æ¶ˆæ¯å¤„ç†èƒ½åŠ›æ¨ªå‘æ‰©å±•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»´æŠ¤æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆé…ç½®ä¸ä»£ç ç»Ÿä¸€ç®¡ç†ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€é¢å¤–éƒ¨ç½²ç›‘æ§/è¿ç»´ä½“ç³»ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®"&gt;æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆæ¶æ„ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒä¸šåŠ¡æœåŠ¡&lt;/strong&gt;ï¼šåµŒå…¥Producer/Consumerï¼ˆå¦‚è®¢å•ã€æ”¯ä»˜æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸºç¡€è®¾æ–½æœåŠ¡&lt;/strong&gt;ï¼šæŠ½å–ç‹¬ç«‹æœåŠ¡ï¼ˆå¦‚æ—¥å¿—é‡‡é›†ã€ç›‘æ§æŒ‡æ ‡å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯è®¾è®¡è§„èŒƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Avro/Protobufå®šä¹‰Schemaï¼Œç¡®ä¿è·¨æœåŠ¡å…¼å®¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¶ˆæ¯æ·»åŠ å…ƒæ•°æ®ï¼ˆå¦‚&lt;code&gt;trace_id&lt;/code&gt;ï¼‰ï¼Œä¾¿äºåˆ†å¸ƒå¼è¿½è¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¹é”™ä¸ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Producerç«¯å¯ç”¨&lt;code&gt;acks=all&lt;/code&gt;å’Œé‡è¯•æœºåˆ¶ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;li&gt;Consumerç«¯é…ç½®æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰å¤„ç†å¼‚å¸¸æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé‡‡ç”¨åµŒå…¥æ–¹æ¡ˆ&lt;/strong&gt;ä»¥å®ç°ä¸šåŠ¡è§£è€¦ä¸æ•æ·è¿­ä»£ï¼Œä»…åœ¨ååé‡ç“¶é¢ˆã€è·¨æœåŠ¡å¤ç”¨æˆ–æŠ€æœ¯å¼‚æ„æ—¶è€ƒè™‘ç‹¬ç«‹éƒ¨ç½²ã€‚ä¾‹å¦‚ç”µå•†ç³»ç»Ÿä¸­ï¼Œè®¢å•æœåŠ¡å†…ç½®Producerï¼Œè€Œå…¨å±€æœç´¢æœåŠ¡å¯ç‹¬ç«‹æ¶ˆè´¹å¤šä¸ªä¸šåŠ¡Topicæ„å»ºç´¢å¼•ã€‚é€šè¿‡åˆç†åˆ†å±‚ï¼Œå¯å…¼é¡¾æ¶æ„ç®€æ´æ€§ä¸å¤„ç†æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id="å…±äº«æ•°æ®åº“-vs-ç‹¬ç«‹æ•°æ®åº“"&gt;å…±äº«æ•°æ®åº“ v.s. ç‹¬ç«‹æ•°æ®åº“
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ•°æ®åº“å®ä¾‹çš„å…±äº«æ€§ä¸ç‹¬ç«‹æ€§æ˜¯æ ¸å¿ƒè®¾è®¡å†³ç­–ä¹‹ä¸€ï¼Œéœ€æ ¹æ®&lt;strong&gt;ä¸šåŠ¡åœºæ™¯ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€æ‰©å±•æ€§éœ€æ±‚&lt;/strong&gt;ç»¼åˆæƒè¡¡ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ¨¡å¼çš„å¯¹æ¯”åˆ†æä¸å®è·µå»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸¤ç§æ¨¡å¼çš„ç‰¹æ€§ä¸é€‚ç”¨åœºæ™¯"&gt;ä¸¤ç§æ¨¡å¼çš„ç‰¹æ€§ä¸é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;h4 id="å…±äº«æ•°æ®åº“é›†ä¸­å¼"&gt;&lt;strong&gt;å…±äº«æ•°æ®åº“ï¼ˆé›†ä¸­å¼ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;ï¼šæ‰€æœ‰å¾®æœåŠ¡è®¿é—®åŒä¸€ç‰©ç†æ•°æ®åº“å®ä¾‹ï¼Œé€šè¿‡ä¸åŒè¡¨æˆ–Schemaéš”ç¦»æ•°æ®ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼šè·¨æœåŠ¡æ“ä½œå¯é€šè¿‡æœ¬åœ°äº‹åŠ¡ä¿è¯å¼ºä¸€è‡´æ€§ï¼ˆå¦‚é‡‘èäº¤æ˜“ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘å†—ä½™å­˜å‚¨&lt;/strong&gt;ï¼šé¿å…ç›¸åŒæ•°æ®åœ¨ä¸åŒæœåŠ¡ä¸­é‡å¤å­˜å‚¨ï¼ˆå¦‚ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜è€¦åˆæ€§&lt;/strong&gt;ï¼šæ•°æ®åº“è¡¨ç»“æ„å˜æ›´éœ€åè°ƒæ‰€æœ‰å…³è”æœåŠ¡ï¼Œç ´åæœåŠ¡è‡ªæ²»æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹æ˜“å‡ºç°é”ç«äº‰å’ŒIOå‹åŠ›ï¼ˆå¦‚ç”µå•†å¤§ä¿ƒï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;å°å‹ç³»ç»Ÿæˆ–è¿‡æ¸¡é˜¶æ®µï¼ˆå¦‚å•ä½“åº”ç”¨é€æ­¥æ‹†åˆ†ä¸ºå¾®æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¼ºä¸€è‡´æ€§è¦æ±‚çš„æ ¸å¿ƒä¸šåŠ¡ï¼ˆå¦‚é“¶è¡Œè´¦æˆ·ä½™é¢æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç‹¬ç«‹æ•°æ®åº“å»ä¸­å¿ƒåŒ–"&gt;&lt;strong&gt;ç‹¬ç«‹æ•°æ®åº“ï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;ï¼šæ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç§æœ‰æ•°æ®åº“å®ä¾‹ï¼Œæ•°æ®æ¨¡å‹ä¸å­˜å‚¨æŠ€æœ¯å¯è‡ªç”±é€‰æ‹©ï¼ˆå¦‚MySQLã€MongoDBï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡è‡ªæ²»&lt;/strong&gt;ï¼šç‹¬ç«‹æ‰©å±•ä¸å‡çº§ï¼ˆå¦‚ç”¨æˆ·æœåŠ¡æ‰©å®¹ä¸å½±å“è®¢å•æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯å¼‚æ„æ€§&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©æ•°æ®åº“ç±»å‹ï¼ˆå¦‚æ—¥å¿—æœåŠ¡ç”¨Elasticsearchï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜&lt;/strong&gt;ï¼šè·¨æœåŠ¡æ“ä½œéœ€ä¾èµ–åˆ†å¸ƒå¼äº‹åŠ¡æˆ–æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¦‚Sagaæ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´å¤æ‚åº¦&lt;/strong&gt;ï¼šéœ€ç®¡ç†å¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼Œå¤‡ä»½ä¸ç›‘æ§æˆæœ¬å¢åŠ ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;ä¸­å¤§å‹ç³»ç»ŸåŠé•¿æœŸæ¼”è¿›æ¶æ„ï¼ˆå¦‚ç¤¾äº¤å¹³å°ã€ç”µå•†å¹³å°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è¯»å¤šå†™å°‘ä¸”å®¹å¿æœ€ç»ˆä¸€è‡´æ€§çš„åœºæ™¯ï¼ˆå¦‚å†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ··åˆæ¨¡å¼ä¸è¿›é˜¶ç­–ç•¥"&gt;æ··åˆæ¨¡å¼ä¸è¿›é˜¶ç­–ç•¥
&lt;/h3&gt;&lt;h4 id="åˆ†å±‚æ··åˆæ¶æ„"&gt;&lt;strong&gt;åˆ†å±‚æ··åˆæ¶æ„&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæœåŠ¡ç‹¬ç«‹&lt;/strong&gt;ï¼šå…³é”®ä¸šåŠ¡ï¼ˆå¦‚è®¢å•ã€æ”¯ä»˜ï¼‰é‡‡ç”¨ç‹¬ç«‹æ•°æ®åº“ï¼Œä¿éšœé«˜å¯ç”¨ä¸æ‰©å±•æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éæ ¸å¿ƒæœåŠ¡å…±äº«&lt;/strong&gt;ï¼šè¾…åŠ©åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ã€é…ç½®ç®¡ç†ï¼‰å…±äº«æ•°æ®åº“ä»¥å‡å°‘èµ„æºæ¶ˆè€—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ•°æ®åŒæ­¥ä¸è§£è€¦æŠ€æœ¯"&gt;&lt;strong&gt;æ•°æ®åŒæ­¥ä¸è§£è€¦æŠ€æœ¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;ï¼šé€šè¿‡Kafkaå‘å¸ƒæ•°æ®å˜æ›´äº‹ä»¶ï¼Œæ¶ˆè´¹è€…æœåŠ¡å¼‚æ­¥æ›´æ–°æœ¬åœ°æ•°æ®å‰¯æœ¬ï¼ˆå¦‚å•†å“åº“å­˜åŒæ­¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CQRSæ¨¡å¼&lt;/strong&gt;ï¼šè¯»å†™åˆ†ç¦»ï¼Œå†™åº“å¼ºä¸€è‡´æ€§ï¼ˆå¦‚MySQLï¼‰ï¼Œè¯»åº“æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¦‚Elasticsearchï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®-1"&gt;æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜ç¡®ä¸šåŠ¡è¾¹ç•Œ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨**é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡ï¼Œå†³å®šæ•°æ®å½’å±ï¼ˆå¦‚ç”¨æˆ·æœåŠ¡ç®¡ç†ç”¨æˆ·è¡¨ï¼Œè®¢å•æœåŠ¡ç®¡ç†è®¢å•è¡¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…è·¨æœåŠ¡ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€šè¿‡&lt;strong&gt;APIç½‘å…³&lt;/strong&gt;æˆ–&lt;strong&gt;gRPC&lt;/strong&gt;è¿›è¡Œæ•°æ®èšåˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆç†é€‰æ‹©æ•°æ®åº“ç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜é¢‘äº¤æ˜“åœºæ™¯ï¼šå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚PostgreSQLï¼‰ä¿éšœACIDç‰¹æ€§ã€‚&lt;/li&gt;
&lt;li&gt;é«˜å¹¶å‘è¯»åœºæ™¯ï¼šNoSQLæ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰æˆ–ç¼“å­˜ï¼ˆRedisï¼‰æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¹ç¾ä¸æ‰©å±•æ€§è®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹æ•°æ®åº“é‡‡ç”¨&lt;strong&gt;åˆ†åº“åˆ†è¡¨&lt;/strong&gt;ï¼ˆå¦‚ShardingSphereï¼‰åº”å¯¹æ•°æ®å¢é•¿ã€‚&lt;/li&gt;
&lt;li&gt;å…±äº«æ•°æ®åº“é€šè¿‡&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;ä¸&lt;strong&gt;ç¼“å­˜å±‚&lt;/strong&gt;ç¼“è§£å‹åŠ›ï¼ˆå¦‚MySQLä¸»ä»æ¶æ„+Redisçƒ­ç‚¹ç¼“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé‡‡ç”¨ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼&lt;/strong&gt;ä»¥å®ç°æœåŠ¡è‡ªæ²»ä¸é•¿æœŸæ‰©å±•æ€§ï¼Œä»…åœ¨å°å‹ç³»ç»Ÿæˆ–å¼ºä¸€è‡´æ€§åœºæ™¯ä¸‹è°¨æ…ä½¿ç”¨å…±äº«æ•°æ®åº“ã€‚æ··åˆæ¨¡å¼ä¸äº‹ä»¶é©±åŠ¨æ¶æ„å¯å¹³è¡¡ä¸€è‡´æ€§ä¸çµæ´»æ€§ï¼Œä¾‹å¦‚ç”µå•†ç³»ç»Ÿä¸­è®¢å•æœåŠ¡ç‹¬ç«‹éƒ¨ç½²MySQLï¼Œè€Œç”¨æˆ·è¡Œä¸ºåˆ†ææœåŠ¡ä½¿ç”¨å…±äº«çš„ClickHouseé›†ç¾¤ã€‚é€šè¿‡åˆ†å±‚è®¾è®¡ä¸æŠ€æœ¯é€‰å‹ï¼Œå¯æ„å»ºé«˜å†…èšã€ä½è€¦åˆçš„å¾®æœåŠ¡æ•°æ®ä½“ç³»ã€‚&lt;/p&gt;
&lt;h2 id="ç‹¬ç«‹æ•°æ®åº“å¤–é”®"&gt;ç‹¬ç«‹æ•°æ®åº“å¤–é”®
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå½“æ¯ä¸ªæœåŠ¡ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“æ—¶ï¼Œå¤–é”®ä¾èµ–å’Œé€’å½’åˆ é™¤çš„æŒ‘æˆ˜éœ€è¦é€šè¿‡åº”ç”¨å±‚é€»è¾‘å’Œåˆ†å¸ƒå¼äº‹åŠ¡ç­–ç•¥è§£å†³ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å¤„ç†æ–¹æ¡ˆåŠå®ç°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¤–é”®ä¾èµ–çš„æ›¿ä»£ç­–ç•¥"&gt;å¤–é”®ä¾èµ–çš„æ›¿ä»£ç­–ç•¥
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº”ç”¨å±‚æ•°æ®å…³è”ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘å¤–é”®æ ¡éªŒ&lt;/strong&gt;ï¼šåœ¨ä¸šåŠ¡ä»£ç ä¸­æ˜¾å¼éªŒè¯å…³è”æ•°æ®çš„å­˜åœ¨æ€§ï¼ˆå¦‚åˆ›å»ºè®¢å•å‰æ£€æŸ¥ç”¨æˆ·IDæœ‰æ•ˆæ€§ï¼‰ï¼Œæ›¿ä»£æ•°æ®åº“å¤–é”®çº¦æŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†—ä½™å…³é”®å­—æ®µ&lt;/strong&gt;ï¼šå­˜å‚¨å…³è”æ•°æ®çš„å¿…è¦å‰¯æœ¬ï¼ˆå¦‚è®¢å•è¡¨å†—ä½™ç”¨æˆ·åç§°ï¼‰ï¼Œé¿å…é«˜é¢‘è·¨æœåŠ¡æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è®¢å•æœåŠ¡åˆ›å»ºè®¢å•æ—¶æ ¡éªŒç”¨æˆ·å­˜åœ¨æ€§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createOrder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserId&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨ç”¨æˆ·æœåŠ¡API&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BusinessException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ç”¨æˆ·ä¸å­˜åœ¨&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ•°æ®åŒæ­¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡Kafkaç­‰æ¶ˆæ¯é˜Ÿåˆ—å‘å¸ƒæ•°æ®å˜æ›´äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·åˆ é™¤äº‹ä»¶ï¼‰ï¼Œè®¢é˜…æœåŠ¡å¼‚æ­¥æ›´æ–°å…³è”æ•°æ®çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°ç¤ºä¾‹&lt;/strong&gt;ï¼šç”¨æˆ·æœåŠ¡åˆ é™¤ç”¨æˆ·æ—¶å‘å¸ƒ&lt;code&gt;UserDeleted&lt;/code&gt;äº‹ä»¶ï¼Œè®¢å•æœåŠ¡æ¶ˆè´¹åæ ‡è®°ç›¸å…³è®¢å•ä¸ºâ€œç”¨æˆ·å·²æ³¨é”€â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ç”¨æˆ·æœåŠ¡å‘å¸ƒäº‹ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;delete_user&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;kafka_producer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user_events&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;USER_DELETED&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è®¢å•æœåŠ¡æ¶ˆè´¹äº‹ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@kafka_consumer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user_events&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_user_deleted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;INACTIVE_USER&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å¸ƒå¼å”¯ä¸€æ ‡è¯†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å…¨å±€å”¯ä¸€IDï¼ˆå¦‚é›ªèŠ±ç®—æ³•ç”ŸæˆIDï¼‰ç¡®ä¿è·¨æœåŠ¡æ•°æ®æ ‡è¯†å”¯ä¸€æ€§ï¼Œé¿å…å› IDå†²çªå¯¼è‡´é€»è¾‘é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€’å½’åˆ é™¤çš„åˆ†å¸ƒå¼å¤„ç†"&gt;é€’å½’åˆ é™¤çš„åˆ†å¸ƒå¼å¤„ç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§¦å‘å¼çº§è”åˆ é™¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡é—´APIè°ƒç”¨&lt;/strong&gt;ï¼šä¸»æœåŠ¡åˆ é™¤æ•°æ®æ—¶ï¼Œé€šè¿‡RPCè°ƒç”¨å…³è”æœåŠ¡è§¦å‘çº§è”åˆ é™¤ï¼ˆå¦‚åˆ é™¤éƒ¨é—¨æ—¶è°ƒç”¨å‘˜å·¥æœåŠ¡åˆ é™¤ä¸‹å±ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§è®¾è®¡&lt;/strong&gt;ï¼šä¸ºåˆ é™¤æ¥å£æ·»åŠ å¹‚ç­‰Tokenï¼Œé˜²æ­¢ç½‘ç»œé‡è¯•å¯¼è‡´é‡å¤åˆ é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-go" data-lang="go"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// éƒ¨é—¨æœåŠ¡åˆ é™¤éƒ¨é—¨å¹¶è§¦å‘å‘˜å·¥åˆ é™¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;func&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;DeleteDepartment&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;depID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;string&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;error&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1. åˆ é™¤æœ¬éƒ¨é—¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;Delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;Department&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;ID&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;depID&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 2. è°ƒç”¨å‘˜å·¥æœåŠ¡APIåˆ é™¤å…³è”æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;resp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;employeeClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;DeleteByDepartment&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;depID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;uuid&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;New&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nf"&gt;String&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;nil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;Error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å‘˜å·¥åˆ é™¤å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;nil&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†çº§è”åˆ é™¤ä»»åŠ¡æäº¤è‡³Redisé˜Ÿåˆ—æˆ–RabbitMQï¼Œç”±åå°Workeråˆ†æ‰¹å¤„ç†ï¼Œé¿å…é•¿äº‹åŠ¡é˜»å¡ä¸»æµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# æäº¤åˆ é™¤ä»»åŠ¡åˆ°é˜Ÿåˆ—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;delete_post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;# æäº¤è¯„è®ºåˆ é™¤ä»»åŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;celery&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_task&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tasks.delete_comments&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# Celeryä»»åŠ¡å¤„ç†è¯„è®ºåˆ é™¤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@app.task&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;delete_comments&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;comments&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Comment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;comment&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;comment&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è½¯åˆ é™¤ä¸æ•°æ®ç¨½æ ¸&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘åˆ é™¤æ ‡è®°&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;is_deleted&lt;/code&gt;å­—æ®µæ›¿ä»£ç‰©ç†åˆ é™¤ï¼Œå®šæœŸæ‰§è¡Œç¨½æ ¸ä»»åŠ¡æ¸…ç†å­¤å„¿æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¨½æ ¸ç³»ç»Ÿè®¾è®¡&lt;/strong&gt;ï¼šé€šè¿‡å®šæ—¶ä»»åŠ¡æ‰«æè·¨æœåŠ¡æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ˆå¦‚å­˜åœ¨è¯„è®ºå¯¹åº”å·²åˆ é™¤å¸–å­ï¼‰ï¼Œç”Ÿæˆä¿®å¤å·¥å•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- ç¨½æ ¸ä»»åŠ¡SQLç¤ºä¾‹ï¼ˆæ¯æ—¥æ‰§è¡Œï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comment_service&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;LEFT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post_service&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_deleted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äº‹åŠ¡ä¸€è‡´æ€§ä¿éšœ"&gt;äº‹åŠ¡ä¸€è‡´æ€§ä¿éšœ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Sagaæ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†åˆ é™¤æ“ä½œæ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œé€šè¿‡è¡¥å¿æ“ä½œå›æ»šï¼ˆå¦‚åˆ é™¤è®¢å•å¤±è´¥åæ¢å¤ç”¨æˆ·ç§¯åˆ†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Sagaæ‰§è¡Œå™¨ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DeleteOrderSaga&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@SagaStart&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inventoryService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;unlockStock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Step1: é‡Šæ”¾åº“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;paymentService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;refund&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Step2: é€€æ¬¾&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Step3: åˆ é™¤è®¢å•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sagaCompensator&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;compensate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§¦å‘è¡¥å¿é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;TCCæ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Tryé˜¶æ®µ&lt;/strong&gt;ï¼šé¢„ç•™èµ„æºï¼ˆå¦‚æ ‡è®°è®¢å•ä¸ºâ€œåˆ é™¤ä¸­â€çŠ¶æ€ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Confirm/Cancelé˜¶æ®µ&lt;/strong&gt;ï¼šæœ€ç»ˆæäº¤æˆ–é‡Šæ”¾èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DeleteUserTCC&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;try&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;DELETING&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;confirm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;cancel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ACTIVE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡Prometheusç›‘æ§åˆ é™¤ä»»åŠ¡æˆåŠŸç‡ï¼Œé…ç½®AlertManagerå¯¹å¼‚å¸¸å‘Šè­¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æŒ‡æ ‡&lt;/strong&gt;ï¼šè·¨æœåŠ¡åˆ é™¤å»¶è¿Ÿã€å¤±è´¥äº‹åŠ¡æ•°ã€æ•°æ®ä¸ä¸€è‡´ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡å¤„ç†ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;WHERE IN&lt;/code&gt;è¯­å¥æ‰¹é‡æ›´æ–°/åˆ é™¤ï¼ˆå¦‚ä¸€æ¬¡æ€§å¤„ç†1000æ¡è¯„è®ºIDï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;DELETE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;obsolete&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ç­–ç•¥è°ƒæ•´&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºå…³è”å­—æ®µï¼ˆå¦‚&lt;code&gt;post_id&lt;/code&gt;ï¼‰æ·»åŠ ç´¢å¼•ï¼Œä½†éœ€æƒè¡¡å†™å…¥æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨æŸ¥è¯¢ï¼ˆå¦‚&lt;code&gt;INDEX (post_id, is_deleted)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜åŠ é€Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨Redisç¼“å­˜é«˜é¢‘è®¿é—®çš„å…³è”æ•°æ®çŠ¶æ€ï¼ˆå¦‚å¸–å­æ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå‡å°‘è·¨æœåŠ¡æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æ—¶ä¼˜å…ˆè¯»ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;isPostExists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;post_exists:&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;checkExists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨æœåŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¼“å­˜60ç§’&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®æ–½æ³¨æ„äº‹é¡¹"&gt;å®æ–½æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ¶å®šæ˜ç¡®çš„ä¿ç•™ç­–ç•¥ï¼ˆå¦‚ç”¨æˆ·æ³¨é”€åè®¢å•ä¿ç•™6ä¸ªæœˆï¼‰ï¼Œé¿å…æ— é™çº§è”åˆ é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç°åº¦å‘å¸ƒä¸å›æ»š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°åˆ é™¤é€»è¾‘å…ˆåœ¨10%æµé‡éªŒè¯ï¼Œé€šè¿‡é€æ­¥æ”¾é‡é™ä½é£é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–‡æ¡£ä¸å·¥å…·æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Swaggeræ ‡æ³¨æ¥å£çš„çº§è”å½±å“èŒƒå›´ï¼Œå¼€å‘æ•°æ®è¡€ç¼˜åˆ†æå·¥å…·å¯è§†åŒ–å…³è”å…³ç³»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šç­–ç•¥ï¼Œå¯åœ¨ä¿éšœæœåŠ¡è‡ªæ²»æ€§çš„åŒæ—¶ï¼Œå®ç°è·¨æ•°æ®åº“çš„æ•°æ®å®Œæ•´æ€§ç®¡ç†ã€‚å®é™…å®æ–½æ—¶éœ€æ ¹æ®ä¸šåŠ¡å®¹å¿åº¦é€‰æ‹©å¼ºä¸€è‡´æ€§æˆ–æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼Œå¹¶å»ºç«‹å®Œå–„çš„æ•°æ®ç›‘æ§ä½“ç³»ã€‚&lt;/p&gt;
&lt;h2 id="åˆ†å¸ƒå¼æ•°æ®åº“"&gt;åˆ†å¸ƒå¼æ•°æ®åº“
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“&lt;strong&gt;æ— æ³•å®Œå…¨é¿å…ç‹¬ç«‹æ•°æ®åº“çš„ä½¿ç”¨&lt;/strong&gt;ï¼Œä½†ä¸¤è€…å¯ä»¥ç»“åˆå½¢æˆäº’è¡¥å…³ç³»ã€‚å…·ä½“éœ€æ ¹æ®&lt;strong&gt;ä¸šåŠ¡åœºæ™¯ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€æ‰©å±•æ€§éœ€æ±‚&lt;/strong&gt;è¿›è¡Œæƒè¡¡ï¼Œä»¥ä¸‹æ˜¯å…³é”®åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åˆ†å¸ƒå¼æ•°æ®åº“çš„é€‚ç”¨åœºæ™¯ä¸å±€é™æ€§"&gt;åˆ†å¸ƒå¼æ•°æ®åº“çš„é€‚ç”¨åœºæ™¯ä¸å±€é™æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å±•æ€§ä¸é«˜å¹¶å‘æ”¯æŒ&lt;/strong&gt;&lt;br&gt;
åˆ†å¸ƒå¼æ•°æ®åº“é€šè¿‡åˆ†ç‰‡å­˜å‚¨å’Œå¹¶è¡Œè®¡ç®—ï¼Œå¯æ”¯æ’‘PBçº§æ•°æ®å’Œæ¯ç§’ç™¾ä¸‡çº§è¯·æ±‚ï¼ˆå¦‚äº¬ä¸œä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“å¤„ç†ç”µå•†é«˜å¹¶å‘åœºæ™¯ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé€‚ç”¨äºç”¨æˆ·è¡Œä¸ºåˆ†æã€æ—¥å¿—å­˜å‚¨ç­‰æµ·é‡æ•°æ®åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;ï¼šè·¨èŠ‚ç‚¹äº‹åŠ¡åè°ƒå¸¦æ¥å»¶è¿Ÿï¼ˆå¦‚ä¸¤é˜¶æ®µæäº¤åè®®ï¼‰ï¼Œå¼ºä¸€è‡´æ€§åœºæ™¯ä¸‹æ€§èƒ½å¯èƒ½åŠ£äºç‹¬ç«‹æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆå¦‚Cassandraï¼‰é€‚åˆå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼ˆå¦‚å•†å“æ¨èç³»ç»Ÿï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ï¼šé‡‘èäº¤æ˜“ç­‰åœºæ™¯ä»éœ€ç‹¬ç«‹æ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰é€šè¿‡æœ¬åœ°äº‹åŠ¡ä¿éšœACIDç‰¹æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆæ¶æ„å®è·µ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæœåŠ¡ç‹¬ç«‹&lt;/strong&gt;ï¼šæ”¯ä»˜ã€è®¢å•ç­‰å…³é”®ä¸šåŠ¡é‡‡ç”¨ç‹¬ç«‹æ•°æ®åº“ï¼ˆå¦‚PostgreSQLï¼‰ï¼Œä¿éšœæ•°æ®éš”ç¦»ä¸ä½å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éæ ¸å¿ƒæœåŠ¡å…±äº«&lt;/strong&gt;ï¼šç”¨æˆ·è¡Œä¸ºè¿½è¸ªã€æ—¥å¿—åˆ†æç­‰ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆå¦‚ClickHouseï¼‰ï¼Œé€šè¿‡å­˜ç®—åˆ†ç¦»æ–¹æ¡ˆæå‡ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç‹¬ç«‹æ•°æ®åº“çš„ä¸å¯æ›¿ä»£æ€§"&gt;ç‹¬ç«‹æ•°æ®åº“çš„ä¸å¯æ›¿ä»£æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡è‡ªæ²»ä¸æ•°æ®éš”ç¦»&lt;/strong&gt;&lt;br&gt;
å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒåŸåˆ™æ˜¯&lt;strong&gt;æœåŠ¡ç‹¬ç«‹&lt;/strong&gt;ï¼Œæ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç§æœ‰æ•°æ®åº“å¯é¿å…æ•°æ®è€¦åˆï¼ˆå¦‚Netflixæ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹ç®¡ç†æ•°æ®æ¨¡å‹ï¼‰ã€‚åˆ†å¸ƒå¼æ•°æ®åº“è‹¥è¢«å¤šä¸ªæœåŠ¡å…±äº«ï¼Œå¯èƒ½ç ´åæœåŠ¡è¾¹ç•Œï¼Œå¢åŠ åä½œæˆæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤æ‚æŸ¥è¯¢ä¸äº‹åŠ¡å¤„ç†&lt;/strong&gt;&lt;br&gt;
å…³ç³»å‹ç‹¬ç«‹æ•°æ®åº“ï¼ˆå¦‚Oracleï¼‰åœ¨å¤æ‚å…³è”æŸ¥è¯¢ã€å­˜å‚¨è¿‡ç¨‹ç­‰åœºæ™¯ä»å…·ä¼˜åŠ¿ã€‚ä¾‹å¦‚ï¼Œé“¶è¡Œè´¦æˆ·ç³»ç»Ÿéœ€é«˜é¢‘æ‰§è¡Œå¤šè¡¨è”æŸ¥ï¼Œåˆ†å¸ƒå¼æ•°æ®åº“çš„åˆ†ç‰‡æœºåˆ¶å¯èƒ½é™ä½æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿ç»´æˆæœ¬ä¸æŠ€æœ¯æˆç†Ÿåº¦&lt;/strong&gt;&lt;br&gt;
åˆ†å¸ƒå¼æ•°æ®åº“çš„è¿ç»´å¤æ‚åº¦è¾ƒé«˜ï¼ˆå¦‚TiDBéœ€ä¸“ä¸šå›¢é˜Ÿç®¡ç†åˆ†ç‰‡ç­–ç•¥ï¼‰ï¼Œè€Œç‹¬ç«‹æ•°æ®åº“çš„å¤‡ä»½ã€ç›‘æ§å·¥å…·æ›´æˆç†Ÿï¼ˆå¦‚MySQLçš„Percona Toolkitï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶"&gt;æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åˆ†å¸ƒå¼æ•°æ®åº“ä¼˜å…ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç‹¬ç«‹æ•°æ®åº“ä¼˜å…ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®è§„æ¨¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ—¥å‡å¢é‡&amp;gt;1TBæˆ–å­˜é‡&amp;gt;10TB&lt;/td&gt;
&lt;td&gt;æ•°æ®é‡&amp;lt;1TBä¸”å¢é•¿ç¼“æ…¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¸€è‡´æ€§è¦æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ€ç»ˆä¸€è‡´æ€§å¯æ¥å—ï¼ˆå¦‚å†…å®¹å®¡æ ¸ï¼‰&lt;/td&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§ï¼ˆå¦‚åº“å­˜æ‰£å‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€åŠ¨æ€æ‰©å®¹ï¼ˆå¦‚äº’è”ç½‘ç”¨æˆ·æ¿€å¢ï¼‰&lt;/td&gt;
&lt;td&gt;ç¡¬ä»¶å‡çº§å¯æ»¡è¶³éœ€æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å›¢é˜Ÿèƒ½åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å…·å¤‡åˆ†å¸ƒå¼ç³»ç»Ÿç»éªŒ&lt;/td&gt;
&lt;td&gt;ç†Ÿæ‚‰ä¼ ç»Ÿæ•°æ®åº“è¿ç»´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹æ··åˆæ¶æ„æ¡ˆä¾‹"&gt;å…¸å‹æ··åˆæ¶æ„æ¡ˆä¾‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”µå•†å¹³å°ï¼ˆäº¬ä¸œï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬ç«‹æ•°æ®åº“&lt;/strong&gt;ï¼šè®¢å•ã€æ”¯ä»˜æœåŠ¡ä½¿ç”¨MySQLï¼Œé€šè¿‡Sagaæ¨¡å¼ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼æ•°æ®åº“&lt;/strong&gt;ï¼šç”¨æˆ·è¡Œä¸ºæ•°æ®å­˜å‚¨äºCassandraï¼Œæ”¯æŒé«˜å¹¶å‘è¯»å†™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åŒæ­¥&lt;/strong&gt;ï¼šé€šè¿‡KafkaåŒæ­¥æ ¸å¿ƒæ•°æ®è‡³ClickHouseï¼Œå®ç°å®æ—¶åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤¾äº¤åª’ä½“ï¼ˆNetflixï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡è‡ªæ²»&lt;/strong&gt;ï¼šæ¯ä¸ªå¾®æœåŠ¡ï¼ˆæ¨èã€æ’­æ”¾è®°å½•ï¼‰ä½¿ç”¨ç‹¬ç«‹MongoDBå®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æ•°æ®&lt;/strong&gt;ï¼šç”¨æˆ·åŸºç¡€ä¿¡æ¯é€šè¿‡åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆCockroachDBï¼‰å®ç°è·¨åŒºåŸŸå®¹ç¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸å»ºè®®"&gt;æ€»ç»“ä¸å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚è®¾è®¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ ¸å¿ƒä¸šåŠ¡ï¼ˆäº¤æ˜“ã€è´¦æˆ·ï¼‰é‡‡ç”¨ç‹¬ç«‹æ•°æ®åº“ï¼Œéæ ¸å¿ƒä¸šåŠ¡ï¼ˆæ—¥å¿—ã€åˆ†æï¼‰ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯èåˆ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨åˆ†å¸ƒå¼æ•°æ®åº“çš„HTAPç‰¹æ€§ï¼ˆå¦‚OceanBaseï¼‰åŒæ—¶æ”¯æŒäº‹åŠ¡ä¸åˆ†æï¼Œå‡å°‘æ•°æ®å†—ä½™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¸è¿›è¿ç§»&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä»å…±äº«æ•°æ®åº“é€æ­¥è¿‡æ¸¡ï¼Œä¼˜å…ˆå°†é«˜æ‰©å±•éœ€æ±‚çš„æ¨¡å—è¿ç§»è‡³åˆ†å¸ƒå¼æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ†å¸ƒå¼æ•°æ®åº“å¯ä¼˜åŒ–æ‰©å±•æ€§å’Œå®¹ç¾èƒ½åŠ›ï¼Œä½†æ— æ³•å®Œå…¨æ›¿ä»£ç‹¬ç«‹æ•°æ®åº“ã€‚å®é™…æ¶æ„éœ€&lt;strong&gt;å¹³è¡¡æœåŠ¡è‡ªæ²»ã€æ€§èƒ½ä¸æˆæœ¬&lt;/strong&gt;ï¼Œä¾‹å¦‚é‡‘èç³»ç»Ÿä¿ç•™Oracleæ ¸å¿ƒåº“ï¼ŒåŒæ—¶ç”¨TiDBå¤„ç†é£æ§æ•°æ®åˆ†æã€‚&lt;/p&gt;
&lt;h2 id="sagaæ¨¡å¼"&gt;Sagaæ¨¡å¼
&lt;/h2&gt;&lt;p&gt;Sagaæ¨¡å¼æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç®¡ç†&lt;strong&gt;é•¿äº‹åŠ¡&lt;/strong&gt;çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ã€‚å®ƒé€šè¿‡å°†å¤æ‚çš„å…¨å±€äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ª&lt;strong&gt;æœ¬åœ°äº‹åŠ¡&lt;/strong&gt;ï¼Œå¹¶å¼•å…¥&lt;strong&gt;è¡¥å¿æœºåˆ¶&lt;/strong&gt;ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œè§£å†³äº†è·¨æœåŠ¡äº‹åŠ¡çš„åè°ƒéš¾é¢˜ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŸç†"&gt;æ ¸å¿ƒåŸç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡æ‹†åˆ†ä¸è¡¥å¿æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
Sagaå°†é•¿äº‹åŠ¡åˆ†è§£ä¸ºä¸€ç³»åˆ—ç‹¬ç«‹çš„æœ¬åœ°äº‹åŠ¡ï¼ˆç§°ä¸ºâ€œæ­¥éª¤â€æˆ–â€œæ´»åŠ¨â€ï¼‰ï¼Œæ¯ä¸ªæ­¥éª¤æˆåŠŸåç«‹å³æäº¤ã€‚è‹¥æŸä¸€æ­¥éª¤å¤±è´¥ï¼Œåˆ™æŒ‰&lt;strong&gt;é€†åºè§¦å‘è¡¥å¿æ“ä½œ&lt;/strong&gt;ï¼Œå›æ»šä¹‹å‰çš„æˆåŠŸæ­¥éª¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­£å‘äº‹åŠ¡&lt;/strong&gt;ï¼šæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼ˆå¦‚æ‰£å‡åº“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¡¥å¿äº‹åŠ¡&lt;/strong&gt;ï¼šæ’¤é”€æ­£å‘äº‹åŠ¡ï¼ˆå¦‚æ¢å¤åº“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œç”µå•†è®¢å•æµç¨‹å¯èƒ½æ‹†åˆ†ä¸ºï¼šåˆ›å»ºè®¢å•â†’æ‰£å‡åº“å­˜â†’æ”¯ä»˜â†’ç‰©æµï¼Œä»»ä¸€ç¯èŠ‚å¤±è´¥åˆ™é€†å‘æ‰§è¡Œè¡¥å¿ï¼ˆå¦‚æ”¯ä»˜å¤±è´¥éœ€æ¢å¤åº“å­˜å¹¶åˆ é™¤è®¢å•ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
Sagaä¸ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯é€šè¿‡è¡¥å¿æ“ä½œä½¿ç³»ç»Ÿæœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ”¯ä»˜å¤±è´¥åï¼Œåº“å­˜æ¢å¤å¯èƒ½éœ€è¦å¼‚æ­¥å¤„ç†ï¼ŒæœŸé—´æ•°æ®å¤„äºä¸­é—´æ€ï¼Œä½†æœ€ç»ˆä¼šä¸€è‡´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æ–¹å¼"&gt;å®ç°æ–¹å¼
&lt;/h3&gt;&lt;p&gt;Sagaæ¨¡å¼æœ‰ä¸¤ç§ä¸»æµå®ç°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼–æ’å¼ï¼ˆOrchestrationï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸­å¤®åè°ƒå™¨&lt;/strong&gt;ç»Ÿä¸€ç®¡ç†äº‹åŠ¡æµç¨‹ï¼ŒæŒ‰é¡ºåºè°ƒç”¨å„æœåŠ¡å¹¶å¤„ç†è¡¥å¿é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šæµç¨‹æ¸…æ™°ï¼Œé€‚åˆå¤æ‚ä¸šåŠ¡ï¼›&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šåè°ƒå™¨å¯èƒ½æˆä¸ºå•ç‚¹æ•…éšœã€‚&lt;/li&gt;
&lt;li&gt;å·¥å…·ç¤ºä¾‹ï¼šSeataé€šè¿‡çŠ¶æ€æœºå¼•æ“å®šä¹‰äº‹åŠ¡æµç¨‹ï¼Œå¦‚è®¢å•æœåŠ¡â†’åº“å­˜æœåŠ¡â†’æ”¯ä»˜æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ååŒå¼ï¼ˆChoreographyï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å„æœåŠ¡é€šè¿‡&lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt;è‡ªä¸»è§¦å‘åç»­æ­¥éª¤ï¼ˆå¦‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘é€äº‹ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå»ä¸­å¿ƒåŒ–ï¼Œè€¦åˆåº¦ä½ï¼›&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šæµç¨‹å¤æ‚åº¦é«˜ï¼Œéœ€å¤„ç†æ¶ˆæ¯é¡ºåºå’Œæ­»å¾ªç¯é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šè®¢å•æœåŠ¡å®Œæˆåˆ›å»ºåå‘å¸ƒâ€œè®¢å•åˆ›å»ºäº‹ä»¶â€ï¼Œåº“å­˜æœåŠ¡ç›‘å¬å¹¶æ‰£å‡åº“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯"&gt;é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é•¿æµç¨‹ä¸šåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ç”µå•†è®¢å•å¤„ç†ï¼ˆè·¨è®¢å•ã€åº“å­˜ã€æ”¯ä»˜æœåŠ¡ï¼‰ï¼Œç‰©æµé…é€ï¼ˆæ¶‰åŠæ´¾å•ã€åº“å­˜é”å®šã€è¿è¾“ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¼ ç»Ÿäº‹åŠ¡å› é”èµ„æºæ—¶é—´é•¿å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼ŒSagaé€šè¿‡æœ¬åœ°äº‹åŠ¡å¿«é€Ÿæäº¤è§£å†³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨å¼‚æ„ç³»ç»Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•´åˆé—ç•™ç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚é“¶è¡Œæ”¯ä»˜æ¥å£ï¼‰ï¼Œæ— æ³•æ”¹é€ å…¶ä»£ç æ—¶ï¼Œé€šè¿‡è¡¥å¿äº‹åŠ¡å®ç°å›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§å®¹å¿åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚é…’åº—é¢„è®¢ï¼ˆæˆ¿é—´é”å®šåå…è®¸çŸ­æš‚è¶…å–ï¼‰ã€ç¤¾äº¤å¹³å°å†…å®¹å®¡æ ¸ï¼ˆå¼‚æ­¥è¡¥å¿åˆ é™¤è¿è§„å†…å®¹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜ç¼ºç‚¹"&gt;ä¼˜ç¼ºç‚¹
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æŒ‘æˆ˜&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;âœ… æ— é”è®¾è®¡ï¼Œæ”¯æŒé«˜å¹¶å‘&lt;/td&gt;
&lt;td&gt;âŒ è¡¥å¿é€»è¾‘å¤æ‚ï¼Œéœ€å¤„ç†å¹‚ç­‰æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;âœ… å…¼å®¹æ€§å¼ºï¼Œé€‚åˆé—ç•™ç³»ç»Ÿ&lt;/td&gt;
&lt;td&gt;âŒ æ•°æ®å­˜åœ¨ä¸­é—´æ€ï¼Œéœ€ä¸šåŠ¡å®¹å¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;âœ… é¿å…å…¨å±€äº‹åŠ¡é•¿æ—¶é—´é˜»å¡&lt;/td&gt;
&lt;td&gt;âŒ äº‹åŠ¡ç›‘æ§å’Œè°ƒè¯•å›°éš¾&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯å®ç°å·¥å…·"&gt;æŠ€æœ¯å®ç°å·¥å…·
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Seata&lt;/strong&gt;&lt;br&gt;
æ”¯æŒç¼–æ’å¼Sagaï¼Œé€šè¿‡çŠ¶æ€æœºå®šä¹‰äº‹åŠ¡æµç¨‹ï¼Œå¹¶é›†æˆè¡¥å¿æ“ä½œã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createOrder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* ... */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Compensable&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;cancelOrder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* è¡¥å¿é€»è¾‘ */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Axon Framework&lt;/strong&gt;&lt;br&gt;
æä¾›äº‹ä»¶é©±åŠ¨æ¶æ„æ”¯æŒï¼Œé€‚ç”¨äºååŒå¼Sagaã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-4"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Sagaæ¨¡å¼é€šè¿‡&lt;strong&gt;æœ¬åœ°äº‹åŠ¡æ‹†åˆ†+è¡¥å¿æœºåˆ¶&lt;/strong&gt;ï¼Œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›äº†çµæ´»çš„äº‹åŠ¡ç®¡ç†æ–¹æ¡ˆï¼Œå°¤å…¶é€‚åˆé•¿æµç¨‹ã€è·¨æœåŠ¡åœºæ™¯ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºå¹³è¡¡æ€§èƒ½ä¸ä¸€è‡´æ€§ï¼Œä½†ä¹Ÿéœ€æƒè¡¡è¡¥å¿é€»è¾‘çš„å¤æ‚æ€§å’Œæ•°æ®ä¸­é—´æ€çš„é£é™©ã€‚å®é™…åº”ç”¨ä¸­ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ç¼–æ’å¼æˆ–ååŒå¼å®ç°ï¼Œå¹¶å€ŸåŠ©Seataç­‰å·¥å…·ç®€åŒ–å¼€å‘ã€‚&lt;/p&gt;
&lt;h2 id="ç”¨æˆ·è®¤è¯"&gt;ç”¨æˆ·è®¤è¯
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;å³ä½¿å¸–å­ç­‰æœåŠ¡æœªæ˜¾å¼è°ƒç”¨ç”¨æˆ·æœåŠ¡çš„æ¥å£ï¼Œä½†é€šè¿‡Tokené‰´æƒæœºåˆ¶ï¼ˆå¦‚Springä¸­çš„&lt;code&gt;@AuthenticatedUser&lt;/code&gt;æ³¨è§£ï¼‰é—´æ¥ä¾èµ–ç”¨æˆ·æœåŠ¡çš„æ ¸å¿ƒé€»è¾‘&lt;/strong&gt;ï¼Œè¿™ç§è®¾è®¡å±äº&lt;strong&gt;éšå¼ä¾èµ–&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="tokené‰´æƒçš„ä¾èµ–æœ¬è´¨"&gt;Tokené‰´æƒçš„ä¾èµ–æœ¬è´¨
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èº«ä»½ä¿¡æ¯ä¸æƒé™æ•°æ®çš„æ¥æº&lt;/strong&gt;&lt;br&gt;
å½“å¸–å­æœåŠ¡ä½¿ç”¨&lt;code&gt;@AuthenticatedUser&lt;/code&gt;æ³¨è§£è·å–ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œå…¶æœ¬è´¨æ˜¯é€šè¿‡è§£æTokenä¸­çš„ç”¨æˆ·æ ‡è¯†ï¼ˆå¦‚ç”¨æˆ·IDï¼‰å®Œæˆèº«ä»½æ˜ å°„ã€‚è¯¥Tokençš„ç”Ÿæˆå’ŒéªŒè¯é€»è¾‘é€šå¸¸ç”±ç”¨æˆ·æœåŠ¡æˆ–ç»Ÿä¸€çš„é‰´æƒæœåŠ¡ï¼ˆå¦‚Auth Serviceï¼‰æä¾›ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥é‡‡ç”¨JWTï¼Œç”¨æˆ·æœåŠ¡éœ€ç»´æŠ¤å¯†é’¥ï¼ˆç§é’¥ï¼‰ä»¥ç”ŸæˆTokenï¼Œè€Œå¸–å­æœåŠ¡éœ€ä¾èµ–å…¬é’¥éªŒè¯ç­¾åã€‚&lt;/li&gt;
&lt;li&gt;è‹¥é‡‡ç”¨å¼•ç”¨ä»¤ç‰Œï¼ˆé€æ˜ä»¤ç‰Œï¼‰ï¼Œå¸–å­æœåŠ¡éœ€å‘ç”¨æˆ·æœåŠ¡æˆ–é‰´æƒä¸­å¿ƒå‘èµ·Tokenæœ‰æ•ˆæ€§éªŒè¯è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;&lt;br&gt;
Tokençš„å¤±æ•ˆè§„åˆ™ï¼ˆå¦‚è¿‡æœŸæ—¶é—´ã€é»‘åå•ï¼‰ç”±ç”¨æˆ·æœåŠ¡æˆ–é‰´æƒæœåŠ¡å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ³¨é”€æ—¶éœ€é€šè¿‡äº‹ä»¶é€šçŸ¥å…¶ä»–æœåŠ¡æ¸…ç†Tokenå…³è”æ•°æ®ã€‚å³ä½¿å¸–å­æœåŠ¡æœªä¸»åŠ¨è°ƒç”¨ç”¨æˆ·æœåŠ¡æ¥å£ï¼Œä»éœ€ä¾èµ–ç”¨æˆ·æœåŠ¡å‘å¸ƒçš„Tokenå¤±æ•ˆäº‹ä»¶æ¥ç»´æŠ¤ä¸šåŠ¡é€»è¾‘çš„å®Œæ•´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éšå¼ä¾èµ–çš„è¡¨ç°å½¢å¼"&gt;éšå¼ä¾èµ–çš„è¡¨ç°å½¢å¼
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¯†é’¥/é…ç½®ä¾èµ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­æœåŠ¡éœ€é…ç½®ç”¨æˆ·æœåŠ¡æä¾›çš„å…¬é’¥ä»¥éªŒè¯JWTç­¾å&lt;/td&gt;
&lt;td&gt;å¯†é’¥æ³„éœ²æˆ–è½®æ¢å¤±è´¥å¯¼è‡´å…¨ç³»ç»Ÿé‰´æƒç˜«ç—ª&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ¨¡å‹è€¦åˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Tokenä¸­ç”¨æˆ·IDå­—æ®µéœ€ä¸ç”¨æˆ·æœåŠ¡æ•°æ®åº“çš„Schemaä¸€è‡´&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·æœåŠ¡å­—æ®µå˜æ›´å¯èƒ½å¼•å‘ä¸‹æ¸¸æœåŠ¡è§£æå¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€»è¾‘è§„åˆ™åŒæ­¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·æƒé™å˜æ›´éœ€åŒæ­¥è‡³Tokenå£°æ˜ï¼ˆå¦‚è§’è‰²å­—æ®µï¼‰ï¼Œå¦åˆ™å¸–å­æœåŠ¡é‰´æƒç»“æœä¸å‡†ç¡®&lt;/td&gt;
&lt;td&gt;æƒé™å»¶è¿Ÿæ›´æ–°å¯¼è‡´è¶Šæƒè®¿é—®é£é™©&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–ä¾èµ–å…³ç³»çš„æ–¹æ¡ˆ"&gt;ä¼˜åŒ–ä¾èµ–å…³ç³»çš„æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™ä½è€¦åˆåº¦çš„è®¾è®¡æ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç½‘å…³ç»Ÿä¸€é‰´æƒ&lt;/strong&gt;&lt;br&gt;
å°†TokenéªŒè¯é€»è¾‘é›†ä¸­åˆ°APIç½‘å…³ï¼Œç”±ç½‘å…³è§£æTokenåä¼ é€’ç”¨æˆ·IDç­‰æ ¸å¿ƒå­—æ®µè‡³ä¸‹æ¸¸æœåŠ¡ï¼Œé¿å…å„æœåŠ¡é‡å¤å®ç°é‰´æƒé€»è¾‘ã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# Spring Cloud Gatewayé…ç½®ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;filters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;TokenRelay=&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;AddRequestHeader=X-User-Id, ${token.claims.sub}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŒ…å«Tokenï¼ˆJWTï¼‰&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨JWTå°†ç”¨æˆ·è§’è‰²ã€æƒé™ç­‰å…³é”®ä¿¡æ¯åµŒå…¥Tokenè½½è·ï¼Œå¸–å­æœåŠ¡å¯ç›´æ¥è§£æè€Œæ— éœ€æŸ¥è¯¢ç”¨æˆ·æœåŠ¡ã€‚ä½†éœ€æ³¨æ„JWTçš„ä¸å¯æ’¤é”€æ€§ç¼ºé™·ï¼Œéœ€ç»“åˆçŸ­æœ‰æ•ˆæœŸå’Œé»‘åå•æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ•°æ®åŒæ­¥&lt;/strong&gt;&lt;br&gt;
é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaï¼‰åŒæ­¥ç”¨æˆ·çŠ¶æ€å˜æ›´äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è§’è‰²æ›´æ–°æ—¶ï¼Œç”¨æˆ·æœåŠ¡å‘å¸ƒäº‹ä»¶ï¼Œå¸–å­æœåŠ¡ç›‘å¬å¹¶æ›´æ–°æœ¬åœ°ç¼“å­˜çš„è§’è‰²æ˜ å°„è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å¥‘çº¦æ ‡å‡†åŒ–&lt;/strong&gt;&lt;br&gt;
å®šä¹‰ç»Ÿä¸€çš„é‰´æƒåè®®å’Œç”¨æˆ·ä¿¡æ¯æ¨¡å‹ï¼ˆå¦‚OpenID Connectï¼‰ï¼Œä½¿æ‰€æœ‰æœåŠ¡åŸºäºæ ‡å‡†åè®®äº¤äº’ï¼Œé¿å…éšå¼ä¾èµ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="æ€»ç»“-5"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å°½ç®¡å¸–å­æœåŠ¡æœªç›´æ¥è°ƒç”¨ç”¨æˆ·æœåŠ¡çš„æ¥å£ï¼Œä½†&lt;strong&gt;Tokené‰´æƒæœºåˆ¶ä»ä½¿å…¶ä¸ç”¨æˆ·æœåŠ¡å½¢æˆé€»è¾‘ä¾èµ–&lt;/strong&gt;ã€‚è¿™ç§ä¾èµ–å¯é€šè¿‡ç½‘å…³é›†ä¸­é‰´æƒã€æ ‡å‡†åŒ–åè®®å’Œäº‹ä»¶é©±åŠ¨ç­‰æ–¹æ¡ˆè§£è€¦ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š&lt;strong&gt;å°†èº«ä»½éªŒè¯ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé€šè¿‡æ˜¾å¼åŒ–ä¾èµ–ï¼ˆå¦‚é…ç½®ã€åè®®ï¼‰æ›¿ä»£éšå¼è€¦åˆ&lt;/strong&gt;ï¼Œä»è€Œæå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;h2 id="å¤šå¯¹å¤šæ˜ å°„"&gt;å¤šå¯¹å¤šæ˜ å°„
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¸­ï¼Œå…³äºå¤šå¯¹å¤šå…³ç³»å®ä½“ï¼ˆå¦‚&lt;code&gt;SpaceUserInfo&lt;/code&gt;ï¼‰çš„å½’å±é—®é¢˜ï¼Œéœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ã€æ•°æ®ä¸€è‡´æ€§éœ€æ±‚å’Œç³»ç»Ÿæ‰©å±•æ€§ç»¼åˆè€ƒé‡ã€‚ä»¥ä¸‹æ˜¯åŸºäºå¾®æœåŠ¡è®¾è®¡åŸåˆ™å’Œæœç´¢ç»“æœçš„æ·±åº¦åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç‹¬ç«‹æœåŠ¡æ¨¡å¼çš„é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;ç‹¬ç«‹æœåŠ¡æ¨¡å¼çš„é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜é¢‘ç‹¬ç«‹å˜æ›´éœ€æ±‚&lt;/strong&gt;&lt;br&gt;
è‹¥ç”¨æˆ·ä¸ç©ºé—´çš„å…³è”å…³ç³»ï¼ˆå¦‚æƒé™å˜æ›´ã€è§’è‰²è°ƒæ•´ï¼‰éœ€è¦é¢‘ç¹ç‹¬ç«‹æ›´æ–°ï¼Œä¸”ä¸æ ¸å¿ƒä¸šåŠ¡ï¼ˆç”¨æˆ·ç®¡ç†ã€ç©ºé—´ç®¡ç†ï¼‰è€¦åˆåº¦ä½ï¼Œç‹¬ç«‹ä¸º&lt;strong&gt;æˆå‘˜å…³ç³»æœåŠ¡&lt;/strong&gt;æ›´åˆé€‚ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æˆå‘˜æœåŠ¡æ¥å£ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@PostMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/spaces/{spaceId}/members&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;addMember&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MemberRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†åŠ å…¥ç©ºé—´é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§æ¨¡å¼ç¬¦åˆç½‘é¡µ2ä¸­æåˆ°çš„&amp;quot;æœåŠ¡å³ç»„ä»¶&amp;quot;åŸåˆ™ï¼Œæ¯ä¸ªæœåŠ¡å¯¹åº”ç‹¬ç«‹å›¢é˜Ÿç»´æŠ¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤æ‚å…³è”å…³ç³»åœºæ™¯&lt;/strong&gt;&lt;br&gt;
å½“å…³è”å…³ç³»åŒ…å«é¢å¤–å±æ€§ï¼ˆå¦‚åŠ å…¥æ—¶é—´ã€è®¿é—®æƒé™ç­‰çº§ã€åˆ°æœŸæ—¶é—´ç­‰ï¼‰æ—¶ï¼Œç‹¬ç«‹æœåŠ¡èƒ½æ›´å¥½ç®¡ç†æ‰©å±•å­—æ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/* å…³è”è¡¨ç»“æ„ç¤ºä¾‹ */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;space_user_info&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;space_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;permission_level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;join_time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;space_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨æœåŠ¡æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ç‹¬ç«‹æœåŠ¡ç»´æŠ¤å…³è”å…³ç³»ï¼Œå¯é¿å…ç©ºé—´æœåŠ¡/ç”¨æˆ·æœåŠ¡ç›´æ¥è®¿é—®å¯¹æ–¹æ•°æ®åº“ï¼ˆå‚è€ƒç½‘é¡µ5ç¼“å­˜ç­–ç•¥ï¼‰ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·æœåŠ¡ä»…æš´éœ²&lt;code&gt;GET /users/{id}&lt;/code&gt;åŸºç¡€æ¥å£&lt;/li&gt;
&lt;li&gt;ç©ºé—´æˆå‘˜æœåŠ¡é€šè¿‡ç¼“å­˜ç»´æŠ¤&lt;code&gt;space-&amp;gt;users&lt;/code&gt;æ˜ å°„å…³ç³»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ•´åˆåˆ°ç°æœ‰æœåŠ¡çš„ä¼˜åŠ¿"&gt;&lt;strong&gt;æ•´åˆåˆ°ç°æœ‰æœåŠ¡çš„ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡å¼ºè€¦åˆåœºæ™¯&lt;/strong&gt;&lt;br&gt;
å¦‚æœå…³è”å…³ç³»ä¸ç©ºé—´ç”Ÿå‘½å‘¨æœŸå¼ºç›¸å…³ï¼ˆå¦‚ç©ºé—´åˆ é™¤éœ€çº§è”åˆ é™¤æ‰€æœ‰æˆå‘˜å…³ç³»ï¼‰ï¼Œæ›´é€‚åˆä½œä¸º&lt;strong&gt;ç©ºé—´æœåŠ¡çš„å­æ¨¡å—&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç©ºé—´æœåŠ¡å†…åµŒå¤„ç†&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SpaceService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;deleteSpace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;deleteById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceUserRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;deleteBySpaceId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çº§è”æ“ä½œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
å°†å…³ç³»æ•°æ®ä¸ç©ºé—´æ ¸å¿ƒæ•°æ®ï¼ˆå¦‚ç©ºé—´é…ç½®ã€å…ƒä¿¡æ¯ï¼‰å­˜å‚¨åœ¨åŒä¸€æ•°æ®åº“ï¼Œå¯é€šè¿‡è”åˆæŸ¥è¯¢ä¼˜åŒ–æ€§èƒ½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;COUNT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaces&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;LEFT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;space_user_info&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;su&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;space_id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_archived&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;false&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;GROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç®€åŒ–åˆ†å¸ƒå¼äº‹åŠ¡&lt;/strong&gt;&lt;br&gt;
å½“æˆå‘˜å˜æ›´éœ€è¦ä¸ç©ºé—´çŠ¶æ€å˜æ›´ä¿æŒå¼ºä¸€è‡´æ€§æ—¶ï¼ˆå¦‚ä»˜è´¹ç©ºé—´æ·»åŠ æˆå‘˜éœ€æ‰£è´¹ï¼‰ï¼ŒåŒæœåŠ¡å†…å¯é€šè¿‡æœ¬åœ°äº‹åŠ¡ä¿è¯ACIDï¼ˆå‚è€ƒç½‘é¡µ2çš„æ•°æ®åº“è‡ªæ²»åŸåˆ™ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ··åˆæ¶æ„å»ºè®®"&gt;&lt;strong&gt;æ··åˆæ¶æ„å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç»´åº¦&lt;/th&gt;
&lt;th&gt;ç‹¬ç«‹æœåŠ¡æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;æ•´åˆæ–¹æ¡ˆ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æœ€ç»ˆä¸€è‡´æ€§ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰&lt;/td&gt;
&lt;td&gt;å¼ºä¸€è‡´æ€§ï¼ˆæœ¬åœ°äº‹åŠ¡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ååé‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆé«˜é¢‘è¯»å†™ï¼ˆå•ç‹¬æ°´å¹³æ‰©å±•ï¼‰&lt;/td&gt;
&lt;td&gt;å—ä¸»ä¸šåŠ¡ååé‡é™åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€å‘ç»´æŠ¤æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ç»´æŠ¤ç‹¬ç«‹API/DB/ç¼“å­˜&lt;/td&gt;
&lt;td&gt;ä»£ç è€¦åˆä½†è¿ç»´ç®€å•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¼ä¸šIMç³»ç»Ÿçš„è·¨éƒ¨é—¨æˆå‘˜ç®¡ç†&lt;/td&gt;
&lt;td&gt;è®ºå›ç‰ˆå—çš„ç”¨æˆ·è®¢é˜…å…³ç³»&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å»ºè®®é‡‡ç”¨&lt;strong&gt;åˆ†é˜¶æ®µæ¼”è¿›ç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆæœŸ&lt;/strong&gt;ï¼šä½œä¸ºç©ºé—´æœåŠ¡æ¨¡å—ï¼Œå¿«é€ŸéªŒè¯ä¸šåŠ¡æ¨¡å‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆé•¿æœŸ&lt;/strong&gt;ï¼šå½“æ¯æ—¥å…³ç³»å˜æ›´é‡è¶…è¿‡10ä¸‡æ¬¡æ—¶ï¼Œæ‹†åˆ†ä¸ºç‹¬ç«‹æœåŠ¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆç†ŸæœŸ&lt;/strong&gt;ï¼šå¼•å…¥CQRSæ¨¡å¼ï¼Œåˆ†ç¦»è¯»å†™è·¯å¾„ï¼ˆå‚è€ƒç½‘é¡µ5çš„å¤šçº§ç¼“å­˜æ–¹æ¡ˆï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯å®ç°å‚è€ƒ"&gt;&lt;strong&gt;æŠ€æœ¯å®ç°å‚è€ƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DDDèšåˆæ ¹è®¾è®¡&lt;/strong&gt;&lt;br&gt;
å°†&lt;code&gt;Space&lt;/code&gt;ä½œä¸ºèšåˆæ ¹ç®¡ç†å…¶æˆå‘˜å…³ç³»ï¼ˆå‚è€ƒç½‘é¡µ6çš„ORMå…³è”è®¾è®¡ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Space&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ElementCollection&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@CollectionTable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;space_user_info&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MemberInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨æ¶æ„&lt;/strong&gt;&lt;br&gt;
é€šè¿‡é¢†åŸŸäº‹ä»¶åŒæ­¥ç”¨æˆ·æœåŠ¡ç¼“å­˜ï¼ˆç½‘é¡µ5çš„äº‹ä»¶é©±åŠ¨æ–¹æ¡ˆï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MemberAddedEvent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// äº‹ä»¶å‘å¸ƒæ—¶é—´æˆ³&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;APIç½‘å…³è·¯ç”±&lt;/strong&gt;&lt;br&gt;
åœ¨ç½‘å…³å±‚ç»Ÿä¸€å¤„ç†æˆå‘˜ç›¸å…³è·¯ç”±ï¼ˆå‚è€ƒç½‘é¡µ2çš„APIç½‘å…³è®¾è®¡ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# ç½‘å…³é…ç½®ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;member-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;lb://member-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;predicates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;Path=/api/members/**&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆå†³ç­–å»ºè®®&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥è´µå¸ä¸šåŠ¡ä¸­ç©ºé—´æˆå‘˜å…³ç³»å­˜åœ¨ä»¥ä¸‹ç‰¹å¾ï¼Œæ¨èç‹¬ç«‹ä¸ºæœåŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦æ”¯æŒè·¨ç©ºé—´å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚ç»Ÿè®¡ç”¨æˆ·æ‰€æœ‰ç©ºé—´æƒé™ï¼‰&lt;/li&gt;
&lt;li&gt;æˆå‘˜ç®¡ç†é€»è¾‘åŒ…å«å®¡æ‰¹æµ/è‡ªåŠ¨åŒ–è§„åˆ™å¼•æ“&lt;/li&gt;
&lt;li&gt;é¢„è®¡ä¸‰å¹´å†…ç©ºé—´æ•°é‡å°†çªç ´ç™¾ä¸‡çº§&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å¦åˆ™å»ºè®®æš‚æ—¶å†…åµŒåˆ°ç©ºé—´æœåŠ¡å¾…ä¸šåŠ¡å¤æ‚åº¦æå‡åå†è¿›è¡Œæ‹†åˆ†"&gt;å¦åˆ™å»ºè®®æš‚æ—¶å†…åµŒåˆ°ç©ºé—´æœåŠ¡ï¼Œå¾…ä¸šåŠ¡å¤æ‚åº¦æå‡åå†è¿›è¡Œæ‹†åˆ†ã€‚
&lt;/h2&gt;&lt;h2 id="é‰´æƒ"&gt;é‰´æƒ
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;å°† JWT é‰´æƒä¸»è¦æ”¾åœ¨ç½‘å…³å±‚ï¼Œç»“åˆæœåŠ¡å±‚çš„ç»†ç²’åº¦æƒé™æ ¡éªŒ&lt;/strong&gt;æ˜¯æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç½‘å…³å±‚é‰´æƒçš„ä¼˜åŠ¿"&gt;ç½‘å…³å±‚é‰´æƒçš„ä¼˜åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€å…¥å£ç®¡ç†&lt;/strong&gt;&lt;br&gt;
ç½‘å…³ä½œä¸ºæ‰€æœ‰å¤–éƒ¨è¯·æ±‚çš„å…¥å£ï¼Œé›†ä¸­å¤„ç† JWT çš„æ ¼å¼æ ¡éªŒã€ç­¾åéªŒè¯å’Œè¿‡æœŸæ£€æŸ¥ï¼Œå¯é¿å…é‡å¤é‰´æƒé€»è¾‘ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘å…³è¿‡æ»¤å™¨ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;JwtAuthFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;extractToken&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Claims&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;claims&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jwts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parser&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setSigningKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;secret&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;parseClaimsJws&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getBody&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;X-User-Id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;claims&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSubject&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§è®¾è®¡èƒ½æ‹¦æˆªéæ³•è¯·æ±‚ï¼ˆå¦‚ä¼ªé€  Tokenï¼‰ï¼Œå‡å°‘åç«¯æœåŠ¡çš„æ— æ•ˆè´Ÿè½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
ç½‘å…³é€šè¿‡ç¼“å­˜é‰´æƒç»“æœï¼ˆå¦‚ä½¿ç”¨ Redis æˆ–æœ¬åœ°ç¼“å­˜ï¼‰å¯é™ä½é‡å¤è§£æ JWT çš„å¼€é”€ã€‚æµ‹è¯•è¡¨æ˜ï¼Œç¼“å­˜åååé‡å¯æå‡ 4 å€ä»¥ä¸Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨è¾¹ç•Œæ¸…æ™°&lt;/strong&gt;&lt;br&gt;
ç½‘å…³å±‚ç»Ÿä¸€å¤„ç†æ•æ„Ÿæ“ä½œï¼ˆå¦‚ Token åˆ·æ–°ã€é»‘åå•ç®¡ç†ï¼‰ï¼Œé™ä½å¯†é’¥æ³„éœ²é£é™©ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æœåŠ¡å±‚é‰´æƒçš„å¿…è¦æ€§"&gt;æœåŠ¡å±‚é‰´æƒçš„å¿…è¦æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»†ç²’åº¦æƒé™æ§åˆ¶&lt;/strong&gt;&lt;br&gt;
ç½‘å…³ä»…å®ŒæˆåŸºç¡€è®¤è¯ï¼Œä¸šåŠ¡æœåŠ¡éœ€æ ¹æ® JWT è½½è·ä¸­çš„è§’è‰²/æƒé™ä¿¡æ¯è¿›è¡ŒäºŒæ¬¡æ ¡éªŒã€‚ä¾‹å¦‚è®¢å•æœåŠ¡å¯èƒ½è¦æ±‚ç”¨æˆ·å…·å¤‡ &lt;code&gt;ORDER_WRITE&lt;/code&gt; æƒé™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PreAuthorize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;hasAuthority(&amp;#39;ORDER_WRITE&amp;#39;)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createOrder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OrderRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…éƒ¨æœåŠ¡é—´è°ƒç”¨å®‰å…¨&lt;/strong&gt;&lt;br&gt;
å¾®æœåŠ¡é—´è°ƒç”¨ï¼ˆå¦‚é€šè¿‡ Feignï¼‰éœ€æºå¸¦ JWTï¼Œé˜²æ­¢ç»•è¿‡ç½‘å…³çš„ç›´æ¥è®¿é—®ã€‚å¯é€šè¿‡æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰æˆ–è‡ªå®šä¹‰æ‹¦æˆªå™¨å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€æƒé™æ›´æ–°&lt;/strong&gt;&lt;br&gt;
å½“ç”¨æˆ·æƒé™å˜æ›´æ—¶ï¼ŒæœåŠ¡å±‚ç»“åˆå®æ—¶æŸ¥è¯¢æˆ–äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼ˆå¦‚ RabbitMQï¼‰æ›´æ–°æƒé™ï¼Œé¿å…ç½‘å…³ç¼“å­˜è¿‡æœŸå¯¼è‡´çš„å®‰å…¨æ¼æ´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µå»ºè®®æ–¹æ¡ˆ"&gt;å®è·µå»ºè®®æ–¹æ¡ˆ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å±‚çº§&lt;/th&gt;
&lt;th&gt;èŒè´£&lt;/th&gt;
&lt;th&gt;æŠ€æœ¯å®ç°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç½‘å…³å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºç¡€æ ¡éªŒï¼ˆæ ¼å¼/ç­¾å/è¿‡æœŸï¼‰&lt;/td&gt;
&lt;td&gt;Spring Cloud Gateway å…¨å±€è¿‡æ»¤å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç½‘å…³å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è·¯ç”±é»‘ç™½åå•ã€é™æµ&lt;/td&gt;
&lt;td&gt;Redis + Lua è„šæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸šåŠ¡æƒé™æ ¡éªŒï¼ˆå¦‚ RBACï¼‰&lt;/td&gt;
&lt;td&gt;Spring Security + @PreAuthorize&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡å±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•æ„Ÿæ“ä½œæ—¥å¿—è®°å½•&lt;/td&gt;
&lt;td&gt;AOP + ELK æ—¥å¿—æ”¶é›†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸å®‰å…¨çš„å¹³è¡¡"&gt;æ€§èƒ½ä¸å®‰å…¨çš„å¹³è¡¡
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§ç½‘å…³æ ¡éªŒ&lt;/strong&gt;ï¼šä»…è§£æå¿…è¦å­—æ®µï¼ˆå¦‚ç”¨æˆ· IDã€è¿‡æœŸæ—¶é—´ï¼‰ï¼Œé¿å…å®Œæ•´ååºåˆ—åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å±‚æ‡’åŠ è½½&lt;/strong&gt;ï¼šæŒ‰éœ€æŸ¥è¯¢æ•°æ®åº“æƒé™ï¼Œå‡å°‘å†—ä½™æ•°æ®ä¼ é€’ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯†é’¥è½®æ¢ç­–ç•¥&lt;/strong&gt;ï¼šç½‘å…³å®šæœŸæ›´æ–° JWT ç­¾åå¯†é’¥ï¼Œå¹¶é€šè¿‡é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰åŠ¨æ€ä¸‹å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-6"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åœ¨ Spring Cloud ä¸­ï¼Œ&lt;strong&gt;ç½‘å…³å±‚åº”æ‰¿æ‹… JWT çš„åŸºç¡€é‰´æƒï¼Œè€ŒæœåŠ¡å±‚è´Ÿè´£ä¸šåŠ¡æƒé™æ ¡éªŒ&lt;/strong&gt;ã€‚è¿™ç§åˆ†å±‚è®¾è®¡æ—¢ç¬¦åˆå¾®æœåŠ¡â€œå•ä¸€èŒè´£â€åŸåˆ™ï¼Œåˆèƒ½å…¼é¡¾æ€§èƒ½ä¸å®‰å…¨æ€§ã€‚å¯¹äºé«˜å¹¶å‘åœºæ™¯ï¼Œå¯è¿›ä¸€æ­¥å¼•å…¥ OAuth2 ä¸ API ç½‘å…³çš„æ·±åº¦é›†æˆï¼ˆå¦‚ Keycloakï¼‰å®ç°æ ‡å‡†åŒ–é‰´æƒæµç¨‹ã€‚&lt;/p&gt;
&lt;h3 id="æœåŠ¡å±‚è·å–ç”¨æˆ·ä¿¡æ¯"&gt;æœåŠ¡å±‚è·å–ç”¨æˆ·ä¿¡æ¯
&lt;/h3&gt;&lt;p&gt;åœ¨ Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡å±‚è·å–ç”¨æˆ·ä¿¡æ¯çš„æ ¸å¿ƒæœºåˆ¶æ˜¯é€šè¿‡&lt;strong&gt;ç½‘å…³ä¸æ‹¦æˆªå™¨çš„åä½œ&lt;/strong&gt;å®ç°ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’ï¼Œå…·ä½“å¯é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼å®ç°ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºäºè¯·æ±‚å¤´ä¸-threadlocal-çš„æ–¹æ¡ˆæ¨è"&gt;åŸºäºè¯·æ±‚å¤´ä¸ ThreadLocal çš„æ–¹æ¡ˆï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘å…³å±‚æ³¨å…¥ç”¨æˆ·ä¿¡æ¯&lt;/strong&gt;&lt;br&gt;
ç½‘å…³é€šè¿‡å…¨å±€è¿‡æ»¤å™¨ï¼ˆGlobalFilterï¼‰è§£æ JWTï¼Œå°†ç”¨æˆ· ID/è§’è‰²ç­‰ä¿¡æ¯å†™å…¥è¯·æ±‚å¤´ï¼ˆå¦‚ &lt;code&gt;X-User-Info&lt;/code&gt;ï¼‰ï¼Œç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘é¡µ1ï¼šç½‘å…³ GlobalFilter æ·»åŠ ç”¨æˆ·ä¿¡æ¯å¤´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user-info&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å±‚æ‹¦æˆªå™¨æå–ä¿¡æ¯&lt;/strong&gt;&lt;br&gt;
ä¸šåŠ¡æœåŠ¡é€šè¿‡è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼ˆHandlerInterceptorï¼‰ä»è¯·æ±‚å¤´ä¸­æå–ç”¨æˆ·ä¿¡æ¯ï¼Œå­˜å‚¨åˆ° ThreadLocalï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘é¡µ3ï¼šæ‹¦æˆªå™¨ preHandle æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;preHandle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpServletRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpServletResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user-info&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;valueOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­˜å…¥ ThreadLocal&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡å·¥å…·ç±»ç»Ÿä¸€è®¿é—®&lt;/strong&gt;&lt;br&gt;
é€šè¿‡é™æ€å·¥å…·ç±»ï¼ˆå¦‚ &lt;code&gt;UserContext&lt;/code&gt;ï¼‰æä¾›çº¿ç¨‹å®‰å…¨çš„ç”¨æˆ·ä¿¡æ¯è®¿é—®æ¥å£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘é¡µ1ï¼šThreadLocal å·¥å…·ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadLocal&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadLocal&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;removeUser&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt; å¿…é¡»é€šè¿‡æ‹¦æˆªå™¨çš„ &lt;code&gt;afterCompletion&lt;/code&gt; æ–¹æ³•æ¸…ç† ThreadLocalã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŸºäº-spring-security-çš„è®¤è¯ä¸Šä¸‹æ–‡"&gt;åŸºäº Spring Security çš„è®¤è¯ä¸Šä¸‹æ–‡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘å…³ä¸æœåŠ¡å±‚åŒé‡æ ¡éªŒ&lt;/strong&gt;&lt;br&gt;
ç½‘å…³å®Œæˆ JWT åŸºç¡€æ ¡éªŒåï¼Œä¸šåŠ¡æœåŠ¡é€šè¿‡ &lt;code&gt;SecurityContextHolder&lt;/code&gt; è·å–ç”¨æˆ·ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘é¡µ7ï¼šSpring Security ä¸Šä¸‹æ–‡è·å–ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Authentication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;authentication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecurityContextHolder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContext&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthentication&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;authentication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“åˆ JWT è§£æå™¨&lt;/strong&gt;&lt;br&gt;
å¾®æœåŠ¡è‡ªå®šä¹‰ &lt;code&gt;JwtAuthenticationTokenFilter&lt;/code&gt;ï¼Œè§£æè¯·æ±‚å¤´ä¸­çš„ JWT å¹¶ç”Ÿæˆè®¤è¯å¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘é¡µ6ï¼šJWT å·¥å…·ç±»æå–ç”¨æˆ·ä¿¡æ¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;extractUsername&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;extractClaim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Claims&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getSubject&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¾®æœåŠ¡é—´è°ƒç”¨çš„ç”¨æˆ·ä¿¡æ¯ä¼ é€’"&gt;å¾®æœåŠ¡é—´è°ƒç”¨çš„ç”¨æˆ·ä¿¡æ¯ä¼ é€’
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Feign æ‹¦æˆªå™¨é€ä¼ ä¸Šä¸‹æ–‡&lt;/strong&gt;&lt;br&gt;
æœåŠ¡é—´é€šè¿‡ OpenFeign è°ƒç”¨æ—¶ï¼Œè‡ªå®šä¹‰ &lt;code&gt;RequestInterceptor&lt;/code&gt; è‡ªåŠ¨æºå¸¦ç”¨æˆ·ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘é¡µ4ï¼šFeign æ‹¦æˆªå™¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RequestTemplate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;X-User-Info&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toJSONString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userInfo&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼è¾…åŠ©&lt;/strong&gt;&lt;br&gt;
è‹¥ä½¿ç”¨ Istio ç­‰æœåŠ¡ç½‘æ ¼ï¼Œå¯é€šè¿‡ Sidecar è‡ªåŠ¨æ³¨å…¥ &lt;code&gt;X-User-Info&lt;/code&gt; è¯·æ±‚å¤´ï¼Œæ— éœ€ä»£ç å¹²é¢„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ³¨æ„äº‹é¡¹"&gt;å…³é”®æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;è§£å†³æ–¹æ¡ˆ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çº¿ç¨‹å¤ç”¨é£é™©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ‹¦æˆªå™¨ä¸­å¿…é¡»è°ƒç”¨ &lt;code&gt;UserContext.removeUser()&lt;/code&gt; æ¸…ç† ThreadLocal&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚æ­¥æ–¹æ³•è°ƒç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ &lt;code&gt;@Async&lt;/code&gt; æ—¶éœ€æ˜¾å¼ä¼ é€’ç”¨æˆ·ä¿¡æ¯ï¼ŒThreadLocal æ— æ³•è·¨çº¿ç¨‹è®¿é—®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€æƒé™æ›´æ–°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»“åˆ Redis å‘å¸ƒè®¢é˜…æœºåˆ¶å®æ—¶æ›´æ–°æƒé™ç¼“å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨è¯­è¨€æœåŠ¡è°ƒç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é‡‡ç”¨æ ‡å‡†åè®®ï¼ˆå¦‚ HTTP Headersï¼‰ä¼ é€’ Base64 ç¼–ç çš„ç”¨æˆ·ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-7"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æœåŠ¡å±‚è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¨èæµç¨‹ä¸ºï¼š&lt;br&gt;
&lt;strong&gt;ç½‘å…³å†™å…¥è¯·æ±‚å¤´ â†’ æ‹¦æˆªå™¨è§£æè‡³ ThreadLocal â†’ å·¥å…·ç±»ç»Ÿä¸€è®¿é—®&lt;/strong&gt;ã€‚è‹¥é¡¹ç›®å·²é›†æˆ Spring Securityï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;SecurityContextHolder&lt;/code&gt; æ–¹æ¡ˆã€‚å¯¹äºé«˜å¹¶å‘åœºæ™¯ï¼Œå¯ç»“åˆç¼“å­˜ä¼˜åŒ–ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢æ€§èƒ½ï¼ˆå¦‚ Redis å­˜å‚¨ç”¨æˆ·æƒé™ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="å¾®æœåŠ¡è°ƒç”¨"&gt;å¾®æœåŠ¡è°ƒç”¨
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨&lt;strong&gt;ä¸ä¸€å®šéœ€è¦é€šè¿‡ç½‘å…³&lt;/strong&gt;ï¼Œå…·ä½“æ˜¯å¦å¼•å…¥ç½‘å…³éœ€æ ¹æ®å®é™…éœ€æ±‚å’Œæ¶æ„è®¾è®¡æƒè¡¡ã€‚ä»¥ä¸‹æ˜¯å…³é”®åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¾®æœåŠ¡é—´è°ƒç”¨çš„å…¸å‹åœºæ™¯"&gt;&lt;strong&gt;å¾®æœåŠ¡é—´è°ƒç”¨çš„å…¸å‹åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›´æ¥è°ƒç”¨ï¼ˆæ— éœ€ç½‘å…³ï¼‰&lt;/strong&gt;&lt;br&gt;
å¾®æœåŠ¡ä¹‹é—´çš„å†…éƒ¨é€šä¿¡é€šå¸¸é€šè¿‡&lt;strong&gt;æœåŠ¡å‘ç°æœºåˆ¶&lt;/strong&gt;ï¼ˆå¦‚Consulã€Eurekaï¼‰å’Œ&lt;strong&gt;é€šä¿¡åè®®&lt;/strong&gt;ï¼ˆå¦‚RESTã€gRPCã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ç›´æ¥å®Œæˆï¼Œæ— éœ€ç»è¿‡ç½‘å…³ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RPCè°ƒç”¨&lt;/strong&gt;ï¼šé€šè¿‡gRPCã€Dubboç­‰æ¡†æ¶ç›´æ¥è¿›è¡Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/strong&gt;ï¼šé€šè¿‡Kafkaã€RabbitMQç­‰å®ç°å¼‚æ­¥è§£è€¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼&lt;/strong&gt;ï¼šé€šè¿‡Istioç­‰æœåŠ¡ç½‘æ ¼å·¥å…·ç®¡ç†æœåŠ¡é—´æµé‡ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šå‡å°‘æ€§èƒ½æŸè€—ï¼Œæå‡è°ƒç”¨æ•ˆç‡ï¼›é¿å…ç½‘å…³å•ç‚¹æ•…éšœé£é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ç½‘å…³è°ƒç”¨&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€è¦ç»Ÿä¸€ç®¡ç†&lt;strong&gt;å®‰å…¨è®¤è¯ã€æµé‡æ§åˆ¶ã€æ—¥å¿—ç›‘æ§&lt;/strong&gt;ç­‰è·¨æ¨ªåˆ‡é¢åŠŸèƒ½ï¼Œåˆ™å¯èƒ½é€šè¿‡ç½‘å…³ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¨åŸŸè°ƒç”¨&lt;/strong&gt;ï¼šå¤–éƒ¨ç³»ç»Ÿé€šè¿‡ç½‘å…³è®¿é—®å†…éƒ¨æœåŠ¡æ—¶ï¼Œç½‘å…³ç»Ÿä¸€å¤„ç†é‰´æƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èšåˆæ¥å£&lt;/strong&gt;ï¼šç½‘å…³å°†å¤šä¸ªå¾®æœåŠ¡çš„å“åº”åˆå¹¶åè¿”å›å®¢æˆ·ç«¯ï¼ˆå¦‚å•†å“è¯¦æƒ…é¡µèšåˆå•†å“ã€è¯„ä»·ã€åº“å­˜æ•°æ®ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šç»Ÿä¸€å®‰å…¨ç­–ç•¥ï¼Œç®€åŒ–å®¢æˆ·ç«¯é€»è¾‘ï¼›ä¾¿äºå®ç°ç°åº¦å‘å¸ƒã€ç†”æ–­é™æµã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç½‘å…³çš„é€‚ç”¨æ€§ä¸å±€é™æ€§"&gt;&lt;strong&gt;ç½‘å…³çš„é€‚ç”¨æ€§ä¸å±€é™æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯ä¸åç«¯äº¤äº’&lt;/strong&gt;ï¼šæ‰€æœ‰å¤–éƒ¨è¯·æ±‚ï¼ˆå¦‚Webã€Appï¼‰å¿…é¡»ç»è¿‡ç½‘å…³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨æœåŠ¡æ²»ç†éœ€æ±‚&lt;/strong&gt;ï¼šéœ€ç»Ÿä¸€é‰´æƒã€ç›‘æ§æˆ–åè®®è½¬æ¢ï¼ˆå¦‚å¤–éƒ¨HTTPè½¬å†…éƒ¨gRPCï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚ä¸šåŠ¡æµ&lt;/strong&gt;ï¼šéœ€èšåˆå¤šä¸ªæœåŠ¡ç»“æœæˆ–å®ç°ABæµ‹è¯•ç­‰å¤æ‚é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æŸè€—&lt;/strong&gt;ï¼šç½‘å…³ä½œä¸ºé¢å¤–ä¸­é—´å±‚ï¼Œå¯èƒ½å¢åŠ å»¶è¿Ÿï¼ˆå°¤å…¶æ˜¯é«˜é¢‘å†…éƒ¨è°ƒç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åº¦æå‡&lt;/strong&gt;ï¼šéœ€ç»´æŠ¤ç½‘å…³çš„é«˜å¯ç”¨æ€§åŠé…ç½®ç®¡ç†ï¼Œå¢åŠ è¿ç»´æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®é™…æ¶æ„è®¾è®¡çš„å»ºè®®"&gt;&lt;strong&gt;å®é™…æ¶æ„è®¾è®¡çš„å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚è®¾è®¡&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨è¯·æ±‚&lt;/strong&gt;ï¼šå¼ºåˆ¶é€šè¿‡ç½‘å…³ï¼Œä¿éšœå®‰å…¨ä¸æ ‡å‡†åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨è°ƒç”¨&lt;/strong&gt;ï¼šç›´æ¥é€šä¿¡ï¼Œä»…å½“éœ€è¦ç»Ÿä¸€ç®¡æ§æ—¶æ‰å¼•å…¥ç½‘å…³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯é€‰å‹&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§ç½‘å…³&lt;/strong&gt;ï¼šå¦‚Spring Cloud Gatewayã€Zuulï¼Œé€‚åˆåŸºç¡€è·¯ç”±å’Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼&lt;/strong&gt;ï¼šå¦‚Istioï¼Œæ›´é€‚åˆç»†ç²’åº¦æœåŠ¡é—´æµé‡ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-8"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ˜¯å¦éœ€è¦ç½‘å…³å–å†³äºè°ƒç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨è¯·æ±‚&lt;/strong&gt;ï¼šå¿…é¡»é€šè¿‡ç½‘å…³ï¼Œä»¥ç»Ÿä¸€å…¥å£å’Œå®‰å…¨ç®¡æ§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…éƒ¨è°ƒç”¨&lt;/strong&gt;ï¼šé€šå¸¸ç›´æ¥é€šä¿¡ï¼Œä»…åœ¨éœ€ç»Ÿä¸€æ²»ç†æ—¶ä½¿ç”¨ç½‘å…³ã€‚&lt;br&gt;
åˆç†çš„é€‰æ‹©éœ€å¹³è¡¡&lt;strong&gt;æ€§èƒ½ã€å®‰å…¨ã€å¤æ‚åº¦&lt;/strong&gt;ä¸‰å¤§å› ç´ ï¼Œé¿å…è¿‡åº¦è®¾è®¡æˆ–åŠŸèƒ½ç¼ºå¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="spring-cloud-microservices-development-on-local-environment"&gt;Spring Cloud Microservices Development on Local Environment
&lt;/h2&gt;&lt;p&gt;For local development of Spring Cloud microservices, you have two main approaches: Docker Compose or Kubernetes (Minikube). Let me guide you through setting up a productive environment with hot reload capability.&lt;/p&gt;
&lt;h3 id="option-1-docker-compose-recommended-for-local-development"&gt;Option 1: Docker Compose (Recommended for Local Development)
&lt;/h3&gt;&lt;p&gt;Docker Compose is generally simpler for local development because:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lighter resource footprint&lt;/li&gt;
&lt;li&gt;Faster startup times&lt;/li&gt;
&lt;li&gt;Simpler configuration&lt;/li&gt;
&lt;li&gt;Easier networking setup
Setup Steps:
&lt;strong&gt;1&lt;/strong&gt; &lt;strong&gt;Create a&lt;/strong&gt; docker-compose.yml &lt;strong&gt;file&lt;/strong&gt; in your project root:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;3.8&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;service-registry&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;./service-registry&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;8761:8761&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;./service-registry:/app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;~/.m2:/root/.m2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;SPRING_PROFILES_ACTIVE=dev&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config-server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;./config-server&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;8888:8888&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;./config-server:/app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;~/.m2:/root/.m2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;SPRING_PROFILES_ACTIVE=dev&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;depends_on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;service-registry&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cp"&gt;*#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Add your microservices here*&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;customer-service&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;./customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;8081:8081&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;./customer-service:/app&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;~/.m2:/root/.m2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;SPRING_PROFILES_ACTIVE=dev&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;depends_on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;service-registry&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;config-server&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt; &lt;strong&gt;Create a&lt;/strong&gt; Dockerfile &lt;strong&gt;for each microservice&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-dockerfile" data-lang="dockerfile"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;maven:3.8-openjdk-17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;development&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;WORKDIR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/app&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; pom.xml .&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;RUN&lt;/span&gt; mvn dependency:go-offline&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; src ./src&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;&lt;/span&gt;&lt;span class="k"&gt;CMD&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;./mvnw&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;spring-boot:run&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;-Dspring-boot.run.jvmArguments=&amp;#39;-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3&lt;/strong&gt; &lt;strong&gt;Configure Spring DevTools&lt;/strong&gt; in each service&amp;rsquo;s pom.xml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-devtools&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;runtime&lt;span class="nt"&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;optional&amp;gt;&lt;/span&gt;true&lt;span class="nt"&gt;&amp;lt;/optional&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;4&lt;/strong&gt; &lt;strong&gt;Run your environment&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker-compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="option-2-minikube-better-for-production-like-environment"&gt;Option 2: Minikube (Better for Production-Like Environment)
&lt;/h3&gt;&lt;p&gt;Use this approach if you want your local setup to closely match production Kubernetes:
&lt;strong&gt;1&lt;/strong&gt; &lt;strong&gt;Start Minikube&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube start --memory&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4096&lt;/span&gt; --cpus&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt; &lt;strong&gt;Enable Ingress&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;minikube addons &lt;span class="nb"&gt;enable&lt;/span&gt; ingress
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3&lt;/strong&gt; &lt;strong&gt;Create Kubernetes deployment YAML files&lt;/strong&gt; for each service:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;apps/v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Deployment&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service:dev&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;containerPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;src-volume&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/app/src&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;src-volume&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;hostPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/path/to/customer-service/src&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nn"&gt;---&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;v1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;ClusterIP&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;4&lt;/strong&gt; &lt;strong&gt;Set up Skaffold&lt;/strong&gt; for hot reloading: Create a skaffold.yaml file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;skaffold/v2beta26&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Config&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;artifacts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;service-registry&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;./service-registry&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;config-server&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;./config-server&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;- &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;./customer-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;deploy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;kubectl&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;manifests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;k8s/*.yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;5&lt;/strong&gt; &lt;strong&gt;Run Skaffold&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;skaffold dev
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id="idea-integration"&gt;IDEA Integration
&lt;/h1&gt;&lt;p&gt;For IntelliJ IDEA:
&lt;strong&gt;1&lt;/strong&gt; &lt;strong&gt;Install Docker and Kubernetes plugins&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go to Settings â†’ Plugins â†’ Marketplace&lt;/li&gt;
&lt;li&gt;Search for and install &amp;ldquo;Docker&amp;rdquo; and &amp;ldquo;Kubernetes&amp;rdquo;
&lt;strong&gt;2&lt;/strong&gt; &lt;strong&gt;Configure Docker integration&lt;/strong&gt;:&lt;/li&gt;
&lt;li&gt;Go to Settings â†’ Build, Execution, Deployment â†’ Docker&lt;/li&gt;
&lt;li&gt;Add Docker connection
&lt;strong&gt;3&lt;/strong&gt; &lt;strong&gt;Remote debugging setup&lt;/strong&gt;:&lt;/li&gt;
&lt;li&gt;Go to Run â†’ Edit Configurations&lt;/li&gt;
&lt;li&gt;Add Remote JVM Debug configuration&lt;/li&gt;
&lt;li&gt;Set host to localhost and port to 5005
&lt;strong&gt;4&lt;/strong&gt; &lt;strong&gt;Spring Boot DevTools integration&lt;/strong&gt;:&lt;/li&gt;
&lt;li&gt;Go to Settings â†’ Build, Execution, Deployment â†’ Compiler&lt;/li&gt;
&lt;li&gt;Enable &amp;ldquo;Build project automatically&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Press Ctrl+Shift+A (Cmd+Shift+A on Mac) and search for &amp;ldquo;Registry&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Enable &amp;ldquo;compiler.automake.allow.when.app.running&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="recommendations"&gt;Recommendations
&lt;/h3&gt;&lt;p&gt;For most developers, I recommend &lt;strong&gt;Docker Compose&lt;/strong&gt; for local development because:
1 Less resource-intensive than Minikube
2 Simpler setup and configuration
3 Faster startup and reload times
4 Works well with IntelliJ&amp;rsquo;s Docker integration&lt;/p&gt;
&lt;p&gt;As your project matures and you need to test Kubernetes-specific features, you can transition to Minikube or k3d for local development.&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 14</title><link>https://dyhes.github.io/p/postopia-dev-logweek-14/</link><pubDate>Mon, 12 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-14/</guid><description>&lt;p&gt;todo:
å¾®æœåŠ¡æ”¹é€ &lt;/p&gt;
&lt;p&gt;ä¸è®¾ç½®ç®¡ç†å‘˜ï¼Œè€Œæ˜¯é€šè¿‡ç”¨æˆ·æŠ•ç¥¨è‡ªæ²»ï¼ˆå¦‚æŠ•ç¥¨åˆ é™¤ç ´åç¤¾åŒºæ°›å›´çš„å¸–å­ï¼‰å®ç°ç¤¾åŒºæ²»ç†çš„è®ºå›åº”ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;docker å®¹å™¨ä½¿ç”¨volumeæŒä¹…åŒ–æ•°æ®ä¸”å‰åç¯å¢ƒå˜é‡ä¸ä¸€è‡´å¯¼è‡´è¿æ¥å¤±è´¥&lt;/li&gt;
&lt;li&gt;nacos æŠ¥é”™ â€œNo Datasource setâ€ï¼šæ•°æ®è¡¨æœªåˆå§‹åŒ–=ã€‹ï¼ˆClaudeå¸®åŠ©æ’æŸ¥ï¼‰&lt;/li&gt;
&lt;li&gt;æ ¹æ®å®˜æ–¹Dockerfileå»ºç«‹mysqlé•œåƒï¼Œç‰ˆæœ¬ä¸å¯¹åº”å¯¼è‡´è¡¨ç»“æ„å¼‚å¸¸&lt;/li&gt;
&lt;li&gt;ä¸‹è½½å¯¹åº”ç‰ˆæœ¬åˆ°æœ¬åœ°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Sentinel 1.8.6&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘ Docker Compose + Idea&lt;/li&gt;
&lt;li&gt;é¢„ç”Ÿäº§ï¼šMinikube&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§ï¼šKubernetes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;nacos é…ç½®å¼•å…¥å¤±æ•ˆï¼Œå‘ç°æ˜¯data-idæ²¡æœ‰åŠ å…¥åç¼€.yaml&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡starter-acurator å’Œ idea environment debug&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;@ComponentScan(basePackages = {&amp;ldquo;com.heslin.postopia.common&amp;rdquo;, &amp;ldquo;com.heslin.postopia.user&amp;rdquo;})
ä¸æŒ‡å®šè‡ªå·±ä¼šå‡ºé”™&lt;/p&gt;
&lt;p&gt;è·¨åŒ…çš„åºåˆ—åŒ–å‡ºé”™ï¼Œåœ¨Claudeå¸®åŠ©ä¸‹åŠ ä¸Š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility.ANY)
private static final long serialVersionUID = 1L;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åæˆåŠŸ&lt;/p&gt;
&lt;p&gt;â€œimplementation &amp;lsquo;io.jsonwebtoken:jjwt-api:0.12.6&amp;rsquo;
runtimeOnly &amp;lsquo;io.jsonwebtoken:jjwt-impl:0.12.6&amp;rsquo;
runtimeOnly &amp;lsquo;io.jsonwebtoken:jjwt-jackson:0.12.6&amp;rsquo;
â€ç¼ºä¸€ä¸å¯&lt;/p&gt;
&lt;p&gt;spring cloud gateway è¿”å› 503 Service Unavailable æ˜¯å› ä¸ºéœ€è¦æ˜¾ç¤ºå¼•å…¥spring-cloud-starter-loadbalancerä¾èµ–&lt;/p&gt;
&lt;p&gt;æŸäº›åœºæ™¯æ²¡åŠ Transactionalä¼šå‡ºé”™&lt;/p&gt;
&lt;p&gt;dtoæ˜¯åŒ¹é…@Entityçš„å­—æ®µå&lt;/p&gt;
&lt;h2 id="å¾®æœåŠ¡"&gt;å¾®æœåŠ¡
&lt;/h2&gt;&lt;p&gt;å‚è€ƒå¯¹åº”åšå®¢&lt;/p&gt;
&lt;h2 id="cacheable"&gt;@Cacheable
&lt;/h2&gt;&lt;p&gt;@Cacheable æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºç¼“å­˜æ–¹æ³•è¿”å›å€¼çš„æ ¸å¿ƒæ³¨è§£ï¼Œé€šè¿‡å‡å°‘é‡å¤è®¡ç®—å’Œæ•°æ®åº“æŸ¥è¯¢æ¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒåŠŸèƒ½ã€å‚æ•°è¯¦è§£ã€ä½¿ç”¨ç¤ºä¾‹åŠæ³¨æ„äº‹é¡¹å››æ–¹é¢è¿›è¡Œä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;res
&amp;lt;200 OK OK,com.heslin.postopia.common.dto.response.ApiResponse@450bef48,[]&amp;gt;
apires
&amp;lt;200 OK OK,TestR(data=a, message=b, success=true),[]&amp;gt;
2025-05-15T20:25:30.570+08:00 WARN 19921 &amp;mdash; [user-service] [nio-8081-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.HttpMediaTypeNotAcceptableException: No acceptable representation]
res
&amp;lt;200 OK OK,LocalApiResponse(data=TestR(data=a, message=b, success=true), message=æˆåŠŸ, success=true),[]&amp;gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
æ ‡æ³¨è¯¥æ³¨è§£çš„æ–¹æ³•åœ¨é¦–æ¬¡è°ƒç”¨æ—¶ä¼šå°†è¿”å›ç»“æœå­˜å…¥ç¼“å­˜ï¼ˆå¦‚ Redisã€EhCacheï¼‰ï¼Œåç»­è°ƒç”¨æ—¶è‹¥ç¼“å­˜å‘½ä¸­ï¼ˆç›¸åŒå‚æ•°ï¼‰ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜å€¼ï¼Œè·³è¿‡æ–¹æ³•ä½“æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äºæ•°æ®è¯»å–é¢‘ç¹ä½†æ›´æ–°è¾ƒå°‘çš„åœºæ™¯ï¼ˆå¦‚æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€é™æ€é…ç½®ï¼‰ï¼Œå¯æ˜¾è‘—é™ä½æ•°æ®åº“å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å‚æ•°è¯¦è§£"&gt;&lt;strong&gt;å‚æ•°è¯¦è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;cacheNames&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æŒ‡å®šç¼“å­˜åç§°ï¼ˆå¦‚ &lt;code&gt;&amp;quot;userCache&amp;quot;&lt;/code&gt;ï¼‰ï¼Œæ”¯æŒå¤šä¸ªç¼“å­˜ï¼ˆå¦‚ &lt;code&gt;{&amp;quot;cache1&amp;quot;, &amp;quot;cache2&amp;quot;}&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;key&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å®šä¹‰ç¼“å­˜é”®çš„ç”Ÿæˆè§„åˆ™ï¼Œæ”¯æŒ SpEL è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;#id&lt;/code&gt;ï¼šä»¥æ–¹æ³•å‚æ•° &lt;code&gt;id&lt;/code&gt; ä¸ºé”®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;'user_' + #id&amp;quot;&lt;/code&gt;ï¼šç»„åˆå­—ç¬¦ä¸²ä¸å‚æ•°ç”Ÿæˆé”®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;condition&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æ‰§è¡Œå‰åˆ¤æ–­æ˜¯å¦ç¼“å­˜ï¼Œæ»¡è¶³æ¡ä»¶æ‰ç¼“å­˜ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;#id &amp;gt; 0&lt;/code&gt;ï¼šä»…å½“ &lt;code&gt;id&lt;/code&gt; ä¸ºæ­£æ•°æ—¶ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;unless&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æ‰§è¡Œåæ ¹æ®ç»“æœæ’é™¤ç¼“å­˜ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;#result == null&lt;/code&gt;ï¼šç»“æœä¸ºç©ºæ—¶ä¸ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;sync&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å¯ç”¨å¼‚æ­¥ç¼“å­˜ï¼ˆé»˜è®¤ &lt;code&gt;false&lt;/code&gt;ï¼‰ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;ä½¿ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userCache&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unless&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#result == null&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼šæ–¹æ³•ç»“æœå­˜å…¥åä¸º &lt;code&gt;userCache&lt;/code&gt; çš„ç¼“å­˜ï¼Œé”®ä¸º &lt;code&gt;id&lt;/code&gt;ï¼Œä¸”ä»…å½“è¿”å›å€¼éç©ºæ—¶ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
è‹¥æ•°æ®è¢«å¤–éƒ¨ä¿®æ”¹ï¼ˆå¦‚æ•°æ®åº“ç›´æ¥æ›´æ–°ï¼‰ï¼Œéœ€é…åˆ &lt;code&gt;@CacheEvict&lt;/code&gt; æˆ– &lt;code&gt;@CachePut&lt;/code&gt; æ›´æ–°ç¼“å­˜ï¼Œé¿å…è„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ç©¿é€ä¸é›ªå´©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç©¿é€&lt;/strong&gt;ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œç¼“å­˜æ— æ•ˆï¼Œéœ€é€šè¿‡ç©ºå€¼ç¼“å­˜æˆ–å¸ƒéš†è¿‡æ»¤å™¨è§£å†³ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›ªå´©&lt;/strong&gt;ï¼šå¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆæ—¶ï¼Œå¯è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´æˆ–å¯ç”¨å¤šçº§ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TTL è®¾ç½®&lt;/strong&gt;&lt;br&gt;
é»˜è®¤ä¸æ”¯æŒè¿‡æœŸæ—¶é—´ï¼Œéœ€ç»“åˆç¼“å­˜å®ç°ï¼ˆå¦‚ Redisï¼‰è‡ªå®šä¹‰ &lt;code&gt;CacheManager&lt;/code&gt; å®ç°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åˆç†ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt; å¯å¤§å¹…æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œä½†éœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©å‚æ•°ç­–ç•¥ï¼Œå¹¶æ³¨æ„ç¼“å­˜ä¸€è‡´æ€§ä¸å¼‚å¸¸é˜²æŠ¤ã€‚è‹¥éœ€åŠ¨æ€æ§åˆ¶ç¼“å­˜è¡Œä¸ºï¼ˆå¦‚è¿‡æœŸæ—¶é—´ï¼‰ï¼Œå¯ç»“åˆè‡ªå®šä¹‰ &lt;code&gt;KeyGenerator&lt;/code&gt; æˆ–æ‰©å±• &lt;code&gt;CacheManager&lt;/code&gt; å®ç°ã€‚&lt;/p&gt;
&lt;h3 id="cacheable-ç¼“å­˜è¿‡æœŸæœºåˆ¶è¯¦è§£"&gt;@Cacheable ç¼“å­˜è¿‡æœŸæœºåˆ¶è¯¦è§£
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Cacheable&lt;/code&gt; çš„ç¼“å­˜è¿‡æœŸæ—¶é—´å¹¶éç”±æ³¨è§£æœ¬èº«ç›´æ¥æ§åˆ¶ï¼Œè€Œæ˜¯å–å†³äºåº•å±‚ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€EhCacheï¼‰çš„é…ç½®ã€‚ä»¥ä¸‹æ˜¯è§¦å‘ç¼“å­˜è¿‡æœŸçš„æ ¸å¿ƒåœºæ™¯åŠå¯¹åº”é…ç½®æ–¹å¼ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="é»˜è®¤è¿‡æœŸæœºåˆ¶"&gt;&lt;strong&gt;é»˜è®¤è¿‡æœŸæœºåˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— é»˜è®¤è¿‡æœŸæ—¶é—´&lt;/strong&gt;&lt;br&gt;
Spring Cache é»˜è®¤ä¸è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œéœ€ç»“åˆå…·ä½“ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisï¼‰æ‰‹åŠ¨é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºé©±é€ç­–ç•¥&lt;/strong&gt;&lt;br&gt;
è‹¥ç¼“å­˜å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œåº•å±‚ç¼“å­˜æ¡†æ¶ï¼ˆå¦‚ Redis çš„ LRU ç­–ç•¥ï¼‰ä¼šè‡ªåŠ¨æ·˜æ±°æ—§ç¼“å­˜æ¡ç›®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="ä¸»åŠ¨é…ç½®è¿‡æœŸæ—¶é—´çš„æ–¹å¼"&gt;&lt;strong&gt;ä¸»åŠ¨é…ç½®è¿‡æœŸæ—¶é—´çš„æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;å…¨å±€ç»Ÿä¸€é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Redis å…¨å±€ TTL&lt;/strong&gt;&lt;br&gt;
åœ¨ &lt;code&gt;application.properties&lt;/code&gt; ä¸­è®¾ç½®æ‰€æœ‰ç¼“å­˜çš„é»˜è®¤è¿‡æœŸæ—¶é—´ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.cache.redis.time-to-live&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;60000 # 60ç§’&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EhCache é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ XML æ–‡ä»¶ä¸ºä¸åŒç¼“å­˜åŒºåŸŸï¼ˆCache Regionï¼‰è®¾ç½®ç‹¬ç«‹è¿‡æœŸæ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åŸºäºæ³¨è§£çš„æ‰©å±•é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰ç¼“å­˜åç§°æ ¼å¼&lt;/strong&gt;&lt;br&gt;
åœ¨ &lt;code&gt;cacheNames&lt;/code&gt; ä¸­ä½¿ç”¨åˆ†éš”ç¬¦ï¼ˆå¦‚ &lt;code&gt;#&lt;/code&gt;ï¼‰åµŒå…¥è¿‡æœŸæ—¶é—´ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cacheNames&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userCache#30&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 30ç§’åè¿‡æœŸ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éœ€è‡ªå®šä¹‰ &lt;code&gt;CacheManager&lt;/code&gt; è§£æè¯¥æ ¼å¼å¹¶è®¾ç½® TTLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ´¾ç”Ÿæ³¨è§£å¢å¼º&lt;/strong&gt;&lt;br&gt;
åˆ›å»ºæ‰©å±•æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@CustomCacheable&lt;/code&gt;ï¼‰ï¼Œæ·»åŠ  &lt;code&gt;expire&lt;/code&gt; å‚æ•°ï¼Œé€šè¿‡ AOP åŠ¨æ€è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ‰‹åŠ¨ç¼–ç¨‹æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RedisTemplate æ“ä½œ&lt;/strong&gt;&lt;br&gt;
ç›´æ¥ä½¿ç”¨ Redis API è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜æ¡ç›®ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 60ç§’åå¤±æ•ˆ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è°ƒæ•´è¿‡æœŸæ—¶é—´&lt;/strong&gt;&lt;br&gt;
è°ƒç”¨ &lt;code&gt;redisTemplate.expire(key, timeout, unit)&lt;/code&gt; æ›´æ–°å·²å­˜åœ¨ç¼“å­˜çš„ TTLã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="ç¼“å­˜å¤±æ•ˆçš„è§¦å‘åœºæ™¯"&gt;&lt;strong&gt;ç¼“å­˜å¤±æ•ˆçš„è§¦å‘åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¶é—´åˆ°æœŸ&lt;/strong&gt;&lt;br&gt;
é…ç½®çš„ TTL æ—¶é—´åˆ°è¾¾åï¼Œç¼“å­˜è‡ªåŠ¨å¤±æ•ˆï¼ˆéœ€åº•å±‚å­˜å‚¨æ”¯æŒï¼Œå¦‚ Redis çš„ EXPIRE å‘½ä»¤ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸»åŠ¨æ¸…é™¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@CacheEvict&lt;/code&gt; æ³¨è§£æ‰‹åŠ¨åˆ é™¤æŒ‡å®šç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;cacheManager.getCache(&amp;quot;cacheName&amp;quot;).clear()&lt;/code&gt; æ¸…ç©ºæ•´ä¸ªç¼“å­˜åŒºåŸŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æ›´æ–°&lt;/strong&gt;&lt;br&gt;
é…åˆ &lt;code&gt;@CachePut&lt;/code&gt; æ›´æ–°ç¼“å­˜æ—¶ï¼Œæ—§ç¼“å­˜æ¡ç›®ä¼šè¢«æ›¿æ¢ï¼ˆä½†éœ€æ³¨æ„æ–°æ—§ç¼“å­˜å¯èƒ½å›  TTL ä¸åŒäº§ç”Ÿä¸´æ—¶æ€§ä¸ä¸€è‡´ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜å®ç°å·®å¼‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redis æ”¯æŒç²¾ç¡®çš„ TTL æ§åˆ¶ï¼Œè€Œ EhCache è¿˜å¯é…ç½®é—²ç½®æ—¶é—´ï¼ˆTTIï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ConcurrentHashMap ç­‰æœ¬åœ°ç¼“å­˜éœ€è‡ªè¡Œå®ç°è¿‡æœŸé€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é˜²é›ªå´©ç­–ç•¥&lt;/strong&gt;&lt;br&gt;
å»ºè®®ä¸ºä¸åŒç¼“å­˜è®¾ç½®éšæœºåŒ–çš„ TTL åç§»å€¼ï¼Œé¿å…å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆå¯¼è‡´æ•°æ®åº“å‹åŠ›éª¤å¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç©ºå€¼å¤„ç†&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;unless = &amp;quot;#result == null&amp;quot;&lt;/code&gt; é¿å…ç¼“å­˜ç©ºç»“æœï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;@Cacheable&lt;/code&gt; çš„è¿‡æœŸè¡Œä¸ºæœ€ç»ˆç”±ç¼“å­˜å®ç°å†³å®šï¼Œå¼€å‘è€…å¯é€šè¿‡å…¨å±€é…ç½®ã€æ³¨è§£æ‰©å±•æˆ–ç¼–ç¨‹å¼ API çµæ´»æ§åˆ¶ã€‚å»ºè®®æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©æ–¹æ¡ˆï¼šé«˜é¢‘æ›´æ–°æ•°æ®é€‚åˆçŸ­ TTL + ä¸»åŠ¨åˆ·æ–°ï¼Œé™æ€æ•°æ®å¯å»¶é•¿ TTL å‡å°‘è®¡ç®—å¼€é”€ã€‚&lt;/p&gt;
&lt;h3 id="cacheable-çš„åº•å±‚å®ç°æœºåˆ¶"&gt;&lt;em&gt;@Cacheable çš„åº•å±‚å®ç°æœºåˆ¶&lt;/em&gt;*
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜æŠ½è±¡å±‚ç‰¹æ€§&lt;/strong&gt;&lt;br&gt;
Spring Cache æ˜¯ä¸€ä¸ªä¸å…·ä½“ç¼“å­˜å®ç°æ— å…³çš„æŠ½è±¡å±‚ï¼Œæ”¯æŒé€šè¿‡ &lt;code&gt;CacheManager&lt;/code&gt; æ¥å£é€‚é…å¤šç§ç¼“å­˜æŠ€æœ¯ã€‚è¿™æ„å‘³ç€ &lt;code&gt;@Cacheable&lt;/code&gt; çš„ç”Ÿæ•ˆæ¡ä»¶ç”± &lt;code&gt;CacheManager&lt;/code&gt; çš„é…ç½®å†³å®šï¼Œè€Œéå¼ºåˆ¶ç»‘å®š Redisã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤ç¼“å­˜å®ç°&lt;/strong&gt;&lt;br&gt;
è‹¥é¡¹ç›®ä¸­æœªé…ç½®ä»»ä½•ç¼“å­˜æŠ€æœ¯ï¼ˆå¦‚ Redisã€Ehcacheï¼‰ï¼ŒSpring Boot ä¼šé»˜è®¤ä½¿ç”¨ &lt;strong&gt;ConcurrentHashMap&lt;/strong&gt; ä½œä¸ºæœ¬åœ°å†…å­˜ç¼“å­˜ã€‚æ­¤æ—¶ &lt;code&gt;@Cacheable&lt;/code&gt; ä¾ç„¶ç”Ÿæ•ˆï¼Œä½†æ•°æ®ä»…å­˜å‚¨åœ¨åº”ç”¨è¿›ç¨‹å†…å­˜ä¸­ï¼Œé‡å¯åå¤±æ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ”¯æŒçš„å¤šåœºæ™¯ç¼“å­˜å®ç°"&gt;&lt;strong&gt;æ”¯æŒçš„å¤šåœºæ™¯ç¼“å­˜å®ç°&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ— -redis-çš„æœ¬åœ°ç¼“å­˜æ— éœ€é¢å¤–ä¾èµ–"&gt;&lt;strong&gt;æ—  Redis çš„æœ¬åœ°ç¼“å­˜ï¼ˆæ— éœ€é¢å¤–ä¾èµ–ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå•æœºåº”ç”¨ã€è½»é‡çº§ç¼“å­˜éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š&lt;br&gt;
åªéœ€åœ¨å¯åŠ¨ç±»æ·»åŠ  &lt;code&gt;@EnableCaching&lt;/code&gt; æ³¨è§£ï¼Œæ— éœ€é…ç½® Redisã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableCaching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ç”¨ç¼“å­˜æŠ½è±¡å±‚&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Application&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;æ­¤æ—¶ &lt;code&gt;@Cacheable&lt;/code&gt; é€šè¿‡ &lt;code&gt;ConcurrentHashMap&lt;/code&gt; å®ç°æœ¬åœ°ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="redis-ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜éœ€ä¾èµ–å’Œé…ç½®"&gt;&lt;strong&gt;Redis ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆéœ€ä¾èµ–å’Œé…ç½®ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿã€å¤šèŠ‚ç‚¹å…±äº«ç¼“å­˜ã€æŒä¹…åŒ–éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–ä¸é…ç½®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ·»åŠ  Redis ä¾èµ–ï¼ˆå¦‚ &lt;code&gt;spring-boot-starter-data-redis&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;é…ç½® Redis è¿æ¥ä¿¡æ¯ï¼ˆä¸»æœºã€ç«¯å£ã€å¯†ç ç­‰ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰ &lt;code&gt;RedisCacheManager&lt;/code&gt; è®¾ç½®åºåˆ—åŒ–æ–¹å¼ã€TTL ç­‰å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…¶ä»–ç¼“å­˜æŠ€æœ¯å¦‚-ehcachecaffeine"&gt;&lt;strong&gt;å…¶ä»–ç¼“å­˜æŠ€æœ¯ï¼ˆå¦‚ Ehcacheã€Caffeineï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š&lt;br&gt;
å¼•å…¥å¯¹åº”ä¾èµ–ï¼ˆå¦‚ &lt;code&gt;spring-boot-starter-cache&lt;/code&gt; + Ehcacheï¼‰å¹¶é…ç½® &lt;code&gt;CacheManager&lt;/code&gt;ï¼Œå³å¯åˆ‡æ¢åº•å±‚ç¼“å­˜å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®éªŒè¯ç‚¹"&gt;&lt;strong&gt;å…³é”®éªŒè¯ç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨è§£ç”Ÿæ•ˆçš„å¿…éœ€æ¡ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@EnableCaching&lt;/code&gt; æ³¨è§£å¿…é¡»å¯ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;è‡³å°‘å­˜åœ¨ä¸€ç§ç¼“å­˜å®ç°ï¼ˆé»˜è®¤æˆ–è‡ªå®šä¹‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Redis çš„ä½œç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»…å½“æ˜¾å¼é…ç½® Redis&lt;/strong&gt;ï¼ˆå¦‚é€šè¿‡ &lt;code&gt;RedisCacheManager&lt;/code&gt;ï¼‰æ—¶ï¼Œ&lt;code&gt;@Cacheable&lt;/code&gt; æ‰ä¼šå°†æ•°æ®å­˜å…¥ Redisï¼›&lt;/li&gt;
&lt;li&gt;è‹¥æœªé…ç½® Redisï¼Œå³ä½¿ Redis æœåŠ¡æœªè¿è¡Œï¼Œæ³¨è§£ä»ä¼šé€šè¿‡é»˜è®¤ç¼“å­˜ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹å¯¹æ¯”"&gt;&lt;strong&gt;ç¤ºä¾‹å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯-1æ— -redis-çš„æœ¬åœ°ç¼“å­˜"&gt;åœºæ™¯ 1ï¼šæ—  Redis çš„æœ¬åœ°ç¼“å­˜
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userCache&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®å­˜å…¥æœ¬åœ°å†…å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šç¼“å­˜ç”Ÿæ•ˆï¼Œä½†æ— æ³•è·¨èŠ‚ç‚¹å…±äº«ã€‚&lt;/p&gt;
&lt;h4 id="åœºæ™¯-2é…ç½®-redis-åçš„åˆ†å¸ƒå¼ç¼“å­˜"&gt;åœºæ™¯ 2ï¼šé…ç½® Redis åçš„åˆ†å¸ƒå¼ç¼“å­˜
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Cacheable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userCache&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unless&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;#result == null&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®å­˜å…¥ Redis&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šç¼“å­˜ç”Ÿæ•ˆä¸”æ”¯æŒåˆ†å¸ƒå¼å…±äº«ï¼Œéœ€ä¾èµ– Redis æœåŠ¡è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@Cacheable&lt;/code&gt; &lt;strong&gt;ä¸å¼ºåˆ¶ä¾èµ– Redis&lt;/strong&gt;ï¼Œå…¶ç”Ÿæ•ˆä¸å¦å–å†³äºæ˜¯å¦å¯ç”¨ç¼“å­˜æŠ½è±¡å±‚ï¼ˆ&lt;code&gt;@EnableCaching&lt;/code&gt;ï¼‰åŠé…ç½®çš„ç¼“å­˜å®ç°ç±»å‹ã€‚Redis ä»…æ˜¯å¯é€‰æ–¹æ¡ˆä¹‹ä¸€ï¼Œé€‚ç”¨äºéœ€è¦åˆ†å¸ƒå¼ç¼“å­˜æˆ–æŒä¹…åŒ–çš„åœºæ™¯ã€‚å¼€å‘è€…å¯æ ¹æ®é¡¹ç›®éœ€æ±‚çµæ´»é€‰æ‹©æœ¬åœ°ç¼“å­˜ï¼ˆå¦‚é»˜è®¤ ConcurrentHashMapã€Ehcacheï¼‰æˆ–åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="spring-data-jpa-ç¼“å­˜ç­–ç•¥"&gt;Spring Data JPA ç¼“å­˜ç­–ç•¥
&lt;/h2&gt;&lt;p&gt;åœ¨ä¸æ˜¾å¼ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt; æ³¨è§£æ—¶ï¼ŒSpring Data JPA çš„ç¼“å­˜ç­–ç•¥ä¸»è¦ä¾èµ–äº &lt;strong&gt;Hibernate äºŒçº§ç¼“å­˜&lt;/strong&gt;çš„é»˜è®¤è¡Œä¸ºï¼Œä½†å…¶é»˜è®¤çŠ¶æ€æ˜¯å…³é—­çš„ï¼Œéœ€æ‰‹åŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤ç¼“å­˜çŠ¶æ€æœªå¯ç”¨"&gt;&lt;strong&gt;é»˜è®¤ç¼“å­˜çŠ¶æ€ï¼šæœªå¯ç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hibernate äºŒçº§ç¼“å­˜é»˜è®¤å…³é—­&lt;/strong&gt;&lt;br&gt;
Spring Data JPA åº•å±‚ä½¿ç”¨ Hibernate ä½œä¸º ORM æ¡†æ¶ï¼Œå…¶äºŒçº§ç¼“å­˜ï¼ˆç”¨äºç¼“å­˜å®ä½“å¯¹è±¡ï¼‰é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚è‹¥ä¸æ˜¾å¼é…ç½®ï¼Œ&lt;strong&gt;æ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šç›´æ¥è®¿é—®æ•°æ®åº“&lt;/strong&gt;ï¼Œä¸ä¼šè§¦å‘ä»»ä½•ç¼“å­˜æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring Cache ä¸ Hibernate ç¼“å­˜çš„åŒºåˆ«&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring Cache&lt;/strong&gt;ï¼ˆé€šè¿‡ &lt;code&gt;@Cacheable&lt;/code&gt; æ³¨è§£ï¼‰æ˜¯ä¸šåŠ¡å±‚ç¼“å­˜ï¼Œéœ€æ˜¾å¼æ ‡æ³¨æ–¹æ³•æˆ–ç±»æ‰ä¼šç”Ÿæ•ˆï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Hibernate äºŒçº§ç¼“å­˜&lt;/strong&gt;æ˜¯æŒä¹…å±‚ç¼“å­˜ï¼Œéœ€é€šè¿‡é…ç½®å¯ç”¨ï¼Œå¯è‡ªåŠ¨ç¼“å­˜å®ä½“å¯¹è±¡ï¼ˆæ— éœ€æ˜¾å¼æ³¨è§£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¯ç”¨-hibernate-äºŒçº§ç¼“å­˜åçš„ç­–ç•¥"&gt;&lt;strong&gt;å¯ç”¨ Hibernate äºŒçº§ç¼“å­˜åçš„ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥é€šè¿‡é…ç½®å¯ç”¨äº† Hibernate äºŒçº§ç¼“å­˜ï¼Œåˆ™ç¼“å­˜è¡Œä¸ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;h4 id="å®ä½“çº§ç¼“å­˜"&gt;&lt;strong&gt;å®ä½“çº§ç¼“å­˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜å®ä½“å¯¹è±¡&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨å®ä½“ç±»ä¸Šæ·»åŠ  &lt;code&gt;@javax.persistence.Cacheable&lt;/code&gt; æˆ– &lt;code&gt;@org.hibernate.annotations.Cache&lt;/code&gt; æ³¨è§£åï¼ŒHibernate ä¼šè‡ªåŠ¨ç¼“å­˜è¯¥å®ä½“ç±»çš„å®ä¾‹ï¼ˆæ ¹æ®ä¸»é”®å­˜å‚¨ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@javax.persistence.Cacheable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// JPA æ ‡å‡†æ³¨è§£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜å…³è”å®ä½“&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥å®ä½“ A å…³è”å®ä½“ Bï¼ˆå¦‚ &lt;code&gt;@OneToMany&lt;/code&gt;ï¼‰ï¼Œä¸” B è¢«ç¼“å­˜ï¼Œåˆ™æŸ¥è¯¢ A æ—¶ä¼šè‡ªåŠ¨åŠ è½½å¹¶ç¼“å­˜å…³è”çš„ B å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æŸ¥è¯¢ç¼“å­˜"&gt;&lt;strong&gt;æŸ¥è¯¢ç¼“å­˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨æŸ¥è¯¢ç¼“å­˜&lt;/strong&gt;ï¼š&lt;br&gt;
éœ€åœ¨é…ç½®ä¸­è®¾ç½® &lt;code&gt;hibernate.cache.use_query_cache=true&lt;/code&gt;ï¼Œå¹¶åœ¨æŸ¥è¯¢æ–¹æ³•ä¸Šæ·»åŠ  &lt;code&gt;@QueryHints&lt;/code&gt; æ³¨è§£ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@QueryHints&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@QueryHint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.hibernate.cacheable&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByActiveTrue&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;æ­¤æ—¶ï¼Œç›¸åŒå‚æ•°å’ŒæŸ¥è¯¢è¯­å¥çš„ç»“æœä¼šè¢«ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç¼“å­˜æ›´æ–°ä¸å¤±æ•ˆ"&gt;&lt;strong&gt;ç¼“å­˜æ›´æ–°ä¸å¤±æ•ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŒæ­¥&lt;/strong&gt;ï¼š&lt;br&gt;
å½“é€šè¿‡ Spring Data JPA çš„ &lt;code&gt;save()&lt;/code&gt; æˆ– &lt;code&gt;delete()&lt;/code&gt; æ–¹æ³•ä¿®æ”¹æ•°æ®æ—¶ï¼ŒHibernate ä¼šè‡ªåŠ¨æ›´æ–°æˆ–æ¸…é™¤ç›¸å…³ç¼“å­˜æ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨æ¸…é™¤&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥æ•°æ®è¢«å¤–éƒ¨ä¿®æ”¹ï¼ˆå¦‚ç›´æ¥æ“ä½œæ•°æ®åº“ï¼‰ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;SessionFactory.getCache().evict()&lt;/code&gt; æ¸…é™¤ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®æ­¥éª¤å¯ç”¨-hibernate-äºŒçº§ç¼“å­˜"&gt;&lt;strong&gt;é…ç½®æ­¥éª¤ï¼ˆå¯ç”¨ Hibernate äºŒçº§ç¼“å­˜ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;&lt;br&gt;
å¼•å…¥ Hibernate äºŒçº§ç¼“å­˜å®ç°ï¼ˆå¦‚ EhCacheï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.hibernate&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;hibernate-ehcache&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®æ–‡ä»¶è®¾ç½®&lt;/strong&gt;&lt;br&gt;
åœ¨ &lt;code&gt;application.properties&lt;/code&gt; ä¸­å¯ç”¨äºŒçº§ç¼“å­˜å¹¶æŒ‡å®šç¼“å­˜æä¾›è€…ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.jpa.properties.hibernate.cache.use_second_level_cache&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.jpa.properties.hibernate.cache.region.factory_class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;org.hibernate.cache.ehcache.EhCacheRegionFactory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç¼“å­˜ç­–ç•¥&lt;/strong&gt;&lt;br&gt;
åˆ›å»º &lt;code&gt;ehcache.xml&lt;/code&gt; æ–‡ä»¶ï¼Œå®šä¹‰ç¼“å­˜åŒºåŸŸåŠè¿‡æœŸç­–ç•¥ï¼ˆå¦‚ TTLï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;ehcache&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;cache&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;com.example.User&amp;#34;&lt;/span&gt; &lt;span class="na"&gt;maxEntriesLocalHeap=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;1000&amp;#34;&lt;/span&gt; &lt;span class="na"&gt;timeToLiveSeconds=&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;3600&amp;#34;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/ehcache&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸ä¸€è‡´æ€§æƒè¡¡"&gt;&lt;strong&gt;æ€§èƒ½ä¸ä¸€è‡´æ€§æƒè¡¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å‡å°‘æ•°æ®åº“è®¿é—®ï¼Œæå‡é«˜é¢‘æŸ¥è¯¢æ€§èƒ½ï¼›&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ç®¡ç†å…³è”å®ä½“ç¼“å­˜ï¼Œç®€åŒ–å¼€å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£é™©&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼“å­˜ç©¿é€ï¼ˆæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼‰éœ€é€šè¿‡ç©ºå€¼ç¼“å­˜æˆ–å¸ƒéš†è¿‡æ»¤å™¨ç¼“è§£ï¼›&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼ç¯å¢ƒä¸‹éœ€ä½¿ç”¨ Redis ç­‰é›†ä¸­å¼ç¼“å­˜æ›¿ä»£æœ¬åœ°ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨ä¸æ˜¾å¼ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt; æ—¶ï¼ŒSpring Data JPA çš„ç¼“å­˜èƒ½åŠ›å®Œå…¨ä¾èµ– Hibernate äºŒçº§ç¼“å­˜ã€‚&lt;strong&gt;é»˜è®¤ä¸å¯ç”¨&lt;/strong&gt;ï¼Œéœ€æ‰‹åŠ¨é…ç½®æ‰èƒ½å®ç°å®ä½“å’ŒæŸ¥è¯¢ç»“æœçš„è‡ªåŠ¨ç¼“å­˜ã€‚è‹¥éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼ˆå¦‚æ¡ä»¶ç¼“å­˜ã€è‡ªå®šä¹‰ TTLï¼‰ï¼Œä»éœ€ç»“åˆ &lt;code&gt;@Cacheable&lt;/code&gt; å’Œ Spring Cache çš„æ‰©å±•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id="hibernate-äºŒçº§ç¼“å­˜é»˜è®¤ä¸å¯ç”¨"&gt;Hibernate äºŒçº§ç¼“å­˜é»˜è®¤ä¸å¯ç”¨
&lt;/h3&gt;&lt;p&gt;Hibernate äºŒçº§ç¼“å­˜é»˜è®¤ä¸å¯ç”¨ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è®¾è®¡è€ƒé‡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çµæ´»æ€§ä¸é€‚ç”¨æ€§&lt;/strong&gt;&lt;br&gt;
äºŒçº§ç¼“å­˜å¹¶éé€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ•°æ®é¢‘ç¹æ›´æ–°æˆ–å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼ˆå¦‚é‡‘èäº¤æ˜“ï¼‰ï¼Œç¼“å­˜åŒæ­¥çš„å¼€é”€å¯èƒ½è¶…è¿‡æ€§èƒ½æ”¶ç›Šã€‚é»˜è®¤å…³é—­å…è®¸å¼€å‘è€…æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©æ˜¯å¦å¯ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤æ‚æ€§ç®¡ç†&lt;/strong&gt;&lt;br&gt;
äºŒçº§ç¼“å­˜æ¶‰åŠç¼“å­˜ç­–ç•¥ï¼ˆå¦‚è¯»å†™ã€äº‹åŠ¡å‹ï¼‰ã€ç¼“å­˜å¤±æ•ˆã€åˆ†å¸ƒå¼åŒæ­¥ç­‰é—®é¢˜ï¼Œè‹¥é»˜è®¤å¼€å¯ä¼šå¢åŠ å¼€å‘è€…çš„å­¦ä¹ æˆæœ¬å’Œé…ç½®é£é™©ã€‚Hibernate å¸Œæœ›é€šè¿‡æ˜¾å¼é…ç½®é¿å…å› è¯¯ç”¨å¯¼è‡´çš„æ€§èƒ½é—®é¢˜æˆ–æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ç°å¤šæ ·æ€§&lt;/strong&gt;&lt;br&gt;
Hibernate è‡ªèº«ä¸æä¾›äºŒçº§ç¼“å­˜å®ç°ï¼Œè€Œæ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ EhCacheã€Redisï¼‰ã€‚é»˜è®¤å…³é—­å¯é¿å…å¼ºåˆ¶ç»‘å®šç‰¹å®šç¼“å­˜æŠ€æœ¯ï¼Œä¸ºå¼€å‘è€…æä¾›æ›´å¤šé€‰æ‹©ç©ºé—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="hibernate-äºŒçº§ç¼“å­˜-vs-cacheable"&gt;Hibernate äºŒçº§ç¼“å­˜ vs @Cacheable
&lt;/h3&gt;&lt;h4 id="hibernate-äºŒçº§ç¼“å­˜çš„ç‰¹ç‚¹"&gt;&lt;strong&gt;Hibernate äºŒçº§ç¼“å­˜çš„ç‰¹ç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;br&gt;
é€‚åˆç¼“å­˜&lt;strong&gt;å®ä½“å¯¹è±¡&lt;/strong&gt;å’Œ&lt;strong&gt;å…³è”æŸ¥è¯¢ç»“æœ&lt;/strong&gt;ï¼ˆå¦‚é€šè¿‡ &lt;code&gt;load()&lt;/code&gt; æˆ– &lt;code&gt;get()&lt;/code&gt; è·å–çš„æ•°æ®ï¼‰ï¼Œè‡ªåŠ¨æ ¹æ®ä¸»é”®ï¼ˆIDï¼‰ç¼“å­˜ï¼Œå¹¶åœ¨äº‹åŠ¡æäº¤æ—¶åŒæ­¥æ›´æ–°æˆ–å¤±æ•ˆç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸ ORM æ·±åº¦é›†æˆï¼Œè‡ªåŠ¨ç®¡ç†å®ä½“ç”Ÿå‘½å‘¨æœŸå’Œå…³è”æ•°æ®ç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤šç§å¹¶å‘ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;READ_WRITE&lt;/code&gt;ã€&lt;code&gt;NONSTRICT_READ_WRITE&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä»…é€‚ç”¨äºæŒä¹…å±‚ï¼Œæ— æ³•ç¼“å­˜ä¸šåŠ¡é€»è¾‘è®¡ç®—ç»“æœï¼›&lt;/li&gt;
&lt;li&gt;é…ç½®å¤æ‚ï¼Œéœ€å¤„ç†ç¼“å­˜æä¾›è€…é€‚é…å’Œç­–ç•¥è°ƒä¼˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cacheable-çš„ç‰¹ç‚¹"&gt;&lt;strong&gt;@Cacheable çš„ç‰¹ç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š&lt;br&gt;
é€‚åˆç¼“å­˜&lt;strong&gt;ä¸šåŠ¡æ–¹æ³•è¿”å›å€¼&lt;/strong&gt;ï¼ˆå¦‚å¤æ‚è®¡ç®—ã€å¤–éƒ¨ API è°ƒç”¨ç»“æœï¼‰ï¼Œå¯åœ¨ Service å±‚çµæ´»æ§åˆ¶ç¼“å­˜é€»è¾‘ï¼Œæ”¯æŒè‡ªå®šä¹‰é”®ï¼ˆKeyï¼‰å’Œæ¡ä»¶ï¼ˆ&lt;code&gt;condition&lt;/code&gt;/&lt;code&gt;unless&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹äºæŒä¹…å±‚ï¼Œé€‚ç”¨æ€§æ›´å¹¿ï¼ˆå¦‚ç¼“å­˜éæ•°æ®åº“æ•°æ®ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ Spring ç”Ÿæ€æ— ç¼é›†æˆï¼Œæ”¯æŒå¤šçº§ç¼“å­˜ï¼ˆå¦‚ Redis + Caffeineï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;éœ€æ‰‹åŠ¨å¤„ç†ç¼“å­˜ä¸€è‡´æ€§ï¼ˆå¦‚æ•°æ®æ›´æ–°åéœ€é…åˆ &lt;code&gt;@CacheEvict&lt;/code&gt; æ¸…é™¤ç¼“å­˜ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æ— æ³•è‡ªåŠ¨å…³è”å®ä½“å˜æ›´ä¸ç¼“å­˜æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®"&gt;æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;h4 id="æŒ‰åœºæ™¯é€‰æ‹©ç¼“å­˜æŠ€æœ¯"&gt;&lt;strong&gt;æŒ‰åœºæ™¯é€‰æ‹©ç¼“å­˜æŠ€æœ¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ Hibernate äºŒçº§ç¼“å­˜çš„åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é«˜é¢‘è¯»å–ã€ä½é¢‘æ›´æ–°çš„å®ä½“æŸ¥è¯¢ï¼ˆå¦‚ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€é…ç½®è¡¨ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;éœ€è¦è‡ªåŠ¨ç®¡ç†ç¼“å­˜ä¸€è‡´æ€§çš„å…³è”æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;@OneToMany&lt;/code&gt; é›†åˆï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ @Cacheable çš„åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸šåŠ¡å±‚å¤æ‚è®¡ç®—ç»“æœçš„ç¼“å­˜ï¼ˆå¦‚æŠ¥è¡¨ç»Ÿè®¡ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è·¨å¤šæ•°æ®æºçš„èšåˆæŸ¥è¯¢ï¼ˆå¦‚æ··åˆæ•°æ®åº“å’Œå¤–éƒ¨ API çš„æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ··åˆä½¿ç”¨ç­–ç•¥"&gt;&lt;strong&gt;æ··åˆä½¿ç”¨ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆ&lt;code&gt;User&lt;/code&gt;ï¼‰ä½¿ç”¨ Hibernate äºŒçº§ç¼“å­˜ï¼Œè€Œç”¨æˆ·è®¢å•ç»Ÿè®¡ç»“æœï¼ˆé€šè¿‡ Service æ–¹æ³•è®¡ç®—ï¼‰ä½¿ç”¨ &lt;code&gt;@Cacheable&lt;/code&gt; ç¼“å­˜åˆ° Redisã€‚è¿™æ ·æ—¢å‡å°‘æ•°æ®åº“å‹åŠ›ï¼Œåˆé¿å…é‡å¤è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é…ç½®ä¸è°ƒä¼˜"&gt;&lt;strong&gt;é…ç½®ä¸è°ƒä¼˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Hibernate äºŒçº§ç¼“å­˜&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ EhCache æˆ– Redis ä½œä¸ºç¼“å­˜æä¾›è€…ï¼Œé€šè¿‡ &lt;code&gt;ehcache.xml&lt;/code&gt; é…ç½® TTL å’Œå†…å­˜ç­–ç•¥ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºå®ä½“ç±»æ·»åŠ  &lt;code&gt;@Cache(usage = READ_WRITE)&lt;/code&gt; æ³¨è§£ï¼Œå¹¶å¯ç”¨æŸ¥è¯¢ç¼“å­˜ï¼ˆ&lt;code&gt;hibernate.cache.use_query_cache=true&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Cacheable&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç»“åˆ &lt;code&gt;@CacheEvict&lt;/code&gt; åœ¨æ•°æ®æ›´æ–°æ—¶æ¸…é™¤ç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ SpEL è¡¨è¾¾å¼å®šä¹‰ç»†ç²’åº¦ç¼“å­˜é”®ï¼ˆå¦‚ &lt;code&gt;key = &amp;quot;#userId + '_profile'&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¸€è‡´æ€§ä¿éšœ"&gt;&lt;strong&gt;ä¸€è‡´æ€§ä¿éšœ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Hibernate äºŒçº§ç¼“å­˜&lt;/strong&gt;ï¼š&lt;br&gt;
ç¡®ä¿æ‰€æœ‰æ•°æ®æ›´æ–°é€šè¿‡ Hibernate è¿›è¡Œï¼ˆé¿å…ç›´æ¥ JDBC æ“ä½œï¼‰ï¼Œå¦åˆ™éœ€æ‰‹åŠ¨è°ƒç”¨ &lt;code&gt;SessionFactory.getCache().evict()&lt;/code&gt; æ¸…é™¤ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@Cacheable&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä½¿ç”¨é›†ä¸­å¼ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰å¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢èŠ‚ç‚¹é—´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç›‘æ§ä¸è¯„ä¼°"&gt;&lt;strong&gt;ç›‘æ§ä¸è¯„ä¼°&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é€šè¿‡æ—¥å¿—ï¼ˆå¦‚ &lt;code&gt;spring.jpa.show-sql=true&lt;/code&gt;ï¼‰è§‚å¯Ÿç¼“å­˜å‘½ä¸­ç‡ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç›‘æ§å·¥å…·ï¼ˆå¦‚ Prometheusï¼‰åˆ†æç¼“å­˜æ€§èƒ½ï¼ŒåŠæ—¶è°ƒæ•´ TTL æˆ–æ·˜æ±°ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Hibernate äºŒçº§ç¼“å­˜ä¸ &lt;code&gt;@Cacheable&lt;/code&gt; å¹¶éäº’æ–¥ï¼Œè€Œæ˜¯äº’è¡¥ã€‚&lt;strong&gt;æœ€ä½³å®è·µæ˜¯åˆ†å±‚ç¼“å­˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŒä¹…å±‚&lt;/strong&gt;ï¼šä½¿ç”¨ Hibernate äºŒçº§ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡å±‚&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@Cacheable&lt;/code&gt; ç¼“å­˜è®¡ç®—ç»“æœæˆ–è·¨æœåŠ¡æ•°æ®ã€‚&lt;br&gt;
æ ¹æ®æ•°æ®ç‰¹æ€§å’Œä¸šåŠ¡éœ€æ±‚çµæ´»ç»„åˆï¼ŒåŒæ—¶æ³¨é‡ç¼“å­˜ä¸€è‡´æ€§å’Œæ€§èƒ½ç›‘æ§ï¼Œæ‰èƒ½æœ€å¤§åŒ–ç¼“å­˜æ”¶ç›Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="spring-cloud"&gt;Spring Cloud
&lt;/h2&gt;&lt;p&gt;Spring Cloud æ˜¯åŸºäº Spring Boot çš„ä¸€å¥—å¾®æœåŠ¡æ¶æ„å¼€å‘å·¥å…·é›†ï¼Œå®ƒé€šè¿‡æ•´åˆå¤šç§æˆç†Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç«™å¼å¾®æœåŠ¡æ„å»ºèƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;h3 id="å®šä¹‰ä¸æ ¸å¿ƒå®šä½"&gt;å®šä¹‰ä¸æ ¸å¿ƒå®šä½
&lt;/h3&gt;&lt;p&gt;Spring Cloud å¹¶éå•ä¸€æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„&lt;strong&gt;æœ‰åºé›†åˆ&lt;/strong&gt;ï¼Œä¸“æ³¨äºç®€åŒ–åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ã€‚å®ƒåˆ©ç”¨ Spring Boot çš„å¿«é€Ÿå¯åŠ¨å’Œè‡ªåŠ¨åŒ–é…ç½®ç‰¹æ€§ï¼Œå°† Netflixã€Hystrixã€Zookeeper ç­‰å¼€æºç»„ä»¶çš„å¤æ‚é…ç½®å°è£…ï¼Œæä¾›&lt;strong&gt;æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€ç†”æ–­é™æµã€æ™ºèƒ½è·¯ç”±&lt;/strong&gt;ç­‰æ ‡å‡†åŒ–è§£å†³æ–¹æ¡ˆï¼Œä½¿å¼€å‘è€…èƒ½ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ç»„ä»¶"&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ç»„ä»¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡æ²»ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/strong&gt;ï¼šé€šè¿‡ Eurekaï¼ˆNetflix ç³»ï¼‰æˆ– Nacosï¼ˆSpring Cloud Alibabaï¼‰å®ç°åŠ¨æ€æœåŠ¡ç®¡ç†ï¼Œæ”¯æŒæœåŠ¡å®ä¾‹çš„è‡ªåŠ¨æ³¨å†Œä¸å¥åº·æ£€æŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šRibbon æä¾›å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œåå‡çº§ä¸º Spring Cloud LoadBalancerï¼Œæ”¯æŒå¤šç§ç®—æ³•ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡è°ƒç”¨&lt;/strong&gt;ï¼šFeign æˆ– OpenFeign é€šè¿‡å£°æ˜å¼æ¥å£ç®€åŒ–è¿œç¨‹è°ƒç”¨ï¼Œé™ä½ HTTP è¯·æ±‚ç¼–ç å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¹é”™ä¸ç†”æ–­&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Hystrix&lt;/strong&gt;ï¼ˆç¬¬ä¸€ä»£ï¼‰ï¼šå®ç°æ–­è·¯å™¨æ¨¡å¼ï¼Œé˜²æ­¢æœåŠ¡é›ªå´©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Resilience4j/Sentinel&lt;/strong&gt;ï¼ˆç¬¬äºŒä»£ï¼‰ï¼šæä¾›æ›´çµæ´»çš„ç†”æ–­ã€é™æµå’Œé™çº§ç­–ç•¥ï¼Œæ”¯æŒçº¿ç¨‹æ± éš”ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud Config&lt;/strong&gt;ï¼šé›†ä¸­åŒ–é…ç½®ç®¡ç†ï¼Œæ”¯æŒ Git/SVN å­˜å‚¨ï¼Œç»“åˆ Bus å®ç°åŠ¨æ€åˆ·æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Nacos/Apollo&lt;/strong&gt;ï¼šæä¾›æ›´é«˜æ•ˆçš„é…ç½®ä¸­å¿ƒè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç¯å¢ƒé…ç½®åˆ†ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;API ç½‘å…³&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Zuul&lt;/strong&gt;ï¼ˆç¬¬ä¸€ä»£ï¼‰ï¼šåŸºäº Servlet çš„ç½‘å…³ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±å’Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud Gateway&lt;/strong&gt;ï¼ˆç¬¬äºŒä»£ï¼‰ï¼šåŸºäº WebFlux çš„é«˜æ€§èƒ½ç½‘å…³ï¼Œæ”¯æŒå¼‚æ­¥éé˜»å¡æ¨¡å‹ï¼Œé›†æˆé™æµå’Œé‰´æƒåŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å¸ƒå¼è¿½è¸ªä¸ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sleuth + Zipkin&lt;/strong&gt;ï¼šç”Ÿæˆå…¨å±€è¯·æ±‚é“¾è·¯ IDï¼Œè¿½è¸ªè·¨æœåŠ¡è°ƒç”¨æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Prometheus + Grafana&lt;/strong&gt;ï¼šç»“åˆå®ç°å®æ—¶ç›‘æ§ä¸å‘Šè­¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ç‰ˆæœ¬æ¼”è¿›"&gt;ç‰ˆæœ¬æ¼”è¿›
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€ä»£&lt;/strong&gt;ï¼ˆ2018 å¹´å‰ï¼‰ï¼šä»¥ Netflix ç»„ä»¶ä¸ºä¸»ï¼ˆå¦‚ Eurekaã€Ribbonï¼‰ï¼Œç‰ˆæœ¬å‘½åé‡‡ç”¨ä¼¦æ•¦åœ°é“ç«™åç§°ï¼ˆå¦‚ Brixtonã€Finchleyï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬äºŒä»£&lt;/strong&gt;ï¼ˆ2018 å¹´åï¼‰ï¼šé€æ­¥æ›¿æ¢ Netflix åœæ­¢ç»´æŠ¤çš„ç»„ä»¶ï¼Œå¦‚ Hystrix â†’ Resilience4jï¼ŒZuul â†’ Gatewayï¼Œç‰ˆæœ¬æ”¹ç”¨æ—¥å†åŒ–å‘½åï¼ˆå¦‚ 2020.0.xï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§&lt;/strong&gt;ï¼šéœ€æ ¹æ® Spring Boot ç‰ˆæœ¬é€‰æ‹©å¯¹åº”çš„ Spring Cloud ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ Spring Boot 2.6.x å¯¹åº” Spring Cloud 2021.0.xï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ä¼˜åŠ¿ä¸åº”ç”¨åœºæ™¯"&gt;ä¼˜åŠ¿ä¸åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘æ•ˆç‡é«˜&lt;/strong&gt;ï¼šå¼€ç®±å³ç”¨çš„ç»„ä»¶ï¼ˆå¦‚è‡ªåŠ¨è£…é…ï¼‰å‡å°‘é‡å¤ç¼–ç ï¼Œé€‚åˆå¿«é€Ÿæ„å»ºå¾®æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¯ç”¨æ€§&lt;/strong&gt;ï¼šé€šè¿‡æœåŠ¡å‘ç°ä¸ç†”æ–­æœºåˆ¶ä¿éšœç³»ç»Ÿç¨³å®šæ€§ï¼Œå°¤å…¶é€‚åˆç”µå•†ã€é‡‘èç­‰é«˜å¹¶å‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®é›†ä¸­åŒ–&lt;/strong&gt;ï¼šåŠ¨æ€åˆ·æ–°é…ç½®é¿å…æœåŠ¡é‡å¯ï¼Œæå‡è¿ç»´æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæ€å®Œå–„&lt;/strong&gt;ï¼šä¸ Spring Securityã€Spring Data ç­‰æ— ç¼é›†æˆï¼Œæ”¯æŒäº‘åŸç”Ÿéƒ¨ç½²ï¼ˆå¦‚ Kubernetesã€Dockerï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆæœ¬ä½å»‰&lt;/strong&gt;ï¼šä¸­å°å‹ä¼ä¸šæ— éœ€è‡ªç ”åŸºç¡€è®¾æ–½ï¼Œå³å¯å®ç°æ ‡å‡†åŒ–å¾®æœåŠ¡æ¶æ„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å…¸å‹æ¶æ„ç¤ºä¾‹"&gt;å…¸å‹æ¶æ„ç¤ºä¾‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚æµç¨‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯ â†’ API ç½‘å…³ï¼ˆé‰´æƒ/è·¯ç”±ï¼‰ â†’ æ³¨å†Œä¸­å¿ƒï¼ˆè·å–æœåŠ¡å®ä¾‹ï¼‰ â†’ Ribbonï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ â†’ å¾®æœåŠ¡é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸æ—¶è§¦å‘ç†”æ–­ï¼Œè¿”å›é¢„è®¾é™çº§å“åº”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯æ ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å±‚ï¼šEureka/Nacos + OpenFeign + Hystrixã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®å±‚ï¼šConfig + Bus + Streamï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é›†æˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§å±‚ï¼šSleuth + Zipkin + Adminã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="æ€»ç»“-3"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Cloud é€šè¿‡æ ‡å‡†åŒ–ç»„ä»¶å’Œ Spring ç”Ÿæ€æ•´åˆï¼Œæˆä¸ºå¾®æœåŠ¡é¢†åŸŸçš„&lt;strong&gt;äº‹å®æ ‡å‡†&lt;/strong&gt;ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºé™ä½åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘é—¨æ§›ï¼Œå°¤å…¶é€‚åˆéœ€è¦å¿«é€Ÿè¿­ä»£ã€é«˜å¯é æ€§çš„ä¼ä¸šçº§åº”ç”¨ã€‚éšç€äº‘åŸç”ŸæŠ€æœ¯çš„å‘å±•ï¼ŒSpring Cloud æ­£ä¸ Kubernetesã€Service Mesh ç­‰æŠ€æœ¯èåˆï¼ŒæŒç»­æ¼”è¿›ä¸ºæ›´è½»é‡ã€çµæ´»çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="maven-vs-gradle"&gt;Maven vs. Gradle
&lt;/h2&gt;&lt;p&gt;åœ¨2025å¹´çš„æŠ€æœ¯ç¯å¢ƒä¸‹ï¼ŒMavenå’ŒGradleçš„é€‰æ‹©éœ€æ ¹æ®é¡¹ç›®éœ€æ±‚ã€å›¢é˜ŸæŠ€æœ¯æ ˆåŠæ„å»ºåœºæ™¯ç»¼åˆåˆ¤æ–­ã€‚ä»¥ä¸‹ä»6ä¸ªç»´åº¦å¯¹æ¯”åˆ†æä¸¤è€…çš„é€‚ç”¨æ€§ï¼Œå¹¶ç»™å‡ºå…·ä½“æ¨èåœºæ™¯ï¼š&lt;/p&gt;
&lt;h3 id="æ ¸å¿ƒå·®å¼‚ä¸é€‚ç”¨åœºæ™¯"&gt;æ ¸å¿ƒå·®å¼‚ä¸é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¡¹ç›®ç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Maven&lt;/strong&gt;ï¼šæ›´é€‚ç”¨äº&lt;strong&gt;ä¼ ç»ŸJavaä¼ä¸šçº§é¡¹ç›®&lt;/strong&gt;ï¼Œå°¤å…¶æ˜¯å¯¹ç¨³å®šæ€§ã€æ ‡å‡†åŒ–è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚é‡‘èç³»ç»Ÿã€é—ç•™ç³»ç»Ÿç»´æŠ¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gradle&lt;/strong&gt;ï¼šåœ¨&lt;strong&gt;ç°ä»£æŠ€æœ¯æ ˆ&lt;/strong&gt;ï¼ˆå¦‚Androidå¼€å‘ã€å¾®æœåŠ¡ã€äº‘åŸç”Ÿåº”ç”¨ï¼‰åŠ&lt;strong&gt;å¤šè¯­è¨€æ··åˆé¡¹ç›®&lt;/strong&gt;ï¼ˆJava/Kotlin/C++/Pythonï¼‰ä¸­è¡¨ç°æ›´ä¼˜ï¼Œ2025å¹´ç»Ÿè®¡æ˜¾ç¤º65%çš„æ–°é¡¹ç›®é€‰æ‹©Gradleã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„å»ºæ€§èƒ½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gradle&lt;/strong&gt;çš„å¢é‡ç¼–è¯‘ã€å¹¶è¡Œä»»åŠ¡æ‰§è¡Œå’Œæ„å»ºç¼“å­˜æŠ€æœ¯ä½¿å…¶åœ¨å¤§å‹é¡¹ç›®ä¸­çš„é€Ÿåº¦å¯è¾¾&lt;strong&gt;Mavençš„2-5å€&lt;/strong&gt;ï¼Œå°¤å…¶é€‚åˆé¢‘ç¹æ„å»ºçš„æ•æ·å¼€å‘æˆ–æŒç»­é›†æˆç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Maven&lt;/strong&gt;æŒ‰é¡ºåºæ‰§è¡Œå…¨é‡æ„å»ºï¼Œé€‚åˆæ„å»ºé¢‘ç‡ä½çš„ä¸­å°å‹é¡¹ç›®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å…³é”®èƒ½åŠ›å¯¹æ¯”"&gt;å…³é”®èƒ½åŠ›å¯¹æ¯”
&lt;/h3&gt;&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gradle&lt;/strong&gt;æ”¯æŒGroovy/Kotlin DSLè„šæœ¬ï¼Œå…è®¸ç¼–å†™&lt;strong&gt;æ¡ä»¶åŒ–æ„å»ºé€»è¾‘&lt;/strong&gt;ï¼ˆå¦‚æŒ‰ç¯å¢ƒåŠ¨æ€åŠ è½½ä¾èµ–ï¼‰ï¼Œé€‚åˆéœ€è¦å®šåˆ¶åŒ–æµç¨‹çš„å¤æ‚é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Maven&lt;/strong&gt;çš„XMLé…ç½®ç»“æ„åŒ–ä½†æ‰©å±•æ€§å—é™ï¼Œä¾èµ–æ’ä»¶å®ç°å¤æ‚é€»è¾‘æ—¶é…ç½®åˆ†æ•£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gradle&lt;/strong&gt;æ”¯æŒåŠ¨æ€ç‰ˆæœ¬å£°æ˜ï¼ˆå¦‚&lt;code&gt;5.3.+&lt;/code&gt;ï¼‰å’Œä¾èµ–çº¦æŸï¼Œèƒ½æ›´çµæ´»è§£å†³å†²çªï¼›è€Œ&lt;strong&gt;Maven&lt;/strong&gt;ä¸¥æ ¼é”å®šç‰ˆæœ¬ï¼Œé€‚åˆä¾èµ–å…³ç³»ç¨³å®šçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤è€…å‡æ”¯æŒMavenä¸­å¤®ä»“åº“ï¼Œä½†Gradleé¢å¤–å…¼å®¹Ivyå’Œè‡ªå®šä¹‰ä»“åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å›¢é˜Ÿä¸ç»´æŠ¤è€ƒé‡"&gt;å›¢é˜Ÿä¸ç»´æŠ¤è€ƒé‡
&lt;/h3&gt;&lt;ol start="5"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­¦ä¹ æ›²çº¿&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Maven&lt;/strong&gt;ï¼šXMLé…ç½®æ˜“è¯»æ€§å¼ºï¼Œé€‚åˆ&lt;strong&gt;æ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹&lt;/strong&gt;ï¼Œæ–‡æ¡£å’Œç¤¾åŒºèµ„æºä¸°å¯Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gradle&lt;/strong&gt;ï¼šéœ€æŒæ¡Groovy/Kotlin DSLï¼Œå­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼Œä½†2025å¹´å…¶å®˜æ–¹æ–‡æ¡£å®Œå–„åº¦å·²æå‡è‡³90%ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿæ€å…¼å®¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Maven&lt;/strong&gt;æ‹¥æœ‰&lt;strong&gt;è¶…1500ä¸ªå®˜æ–¹æ’ä»¶&lt;/strong&gt;ï¼Œè¦†ç›–å…¨ç”Ÿå‘½å‘¨æœŸï¼›&lt;strong&gt;Gradle&lt;/strong&gt;æ’ä»¶æ•°é‡è™½å°‘ä½†è´¨é‡æ›´é«˜ï¼ˆå¦‚Android Gradle Pluginï¼‰ï¼Œä¸”æ”¯æŒå¤ç”¨Mavenæ’ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;IDEæ”¯æŒæ–¹é¢ï¼ŒIntelliJå¯¹Gradleçš„å¢é‡å¯¼å…¥ä¼˜åŒ–æ˜¾è‘—ï¼ŒEclipseéœ€é¢å¤–æ’ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="æ¨èå†³ç­–æ ‘"&gt;æ¨èå†³ç­–æ ‘
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-text" data-lang="text"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;2025å¹´æŠ€æœ¯é€‰å‹å»ºè®®ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;â”‚ æ–°é¡¹ç›®ï¼Ÿ â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”œâ”€ æ˜¯ â†’ é€‰æ‹©Gradleï¼ˆç°ä»£é¡¹ç›®/å¤šè¯­è¨€/é«˜æ€§èƒ½éœ€æ±‚ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â””â”€ å¦ â†’ è¯„ä¼°ç°æœ‰ç³»ç»Ÿï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”œâ”€ ä¼ ç»ŸJava + ä½æ„å»ºé¢‘ç‡ â†’ æ²¿ç”¨Maven
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”œâ”€ éœ€æ€§èƒ½ä¼˜åŒ–/æ‰©å±•æ€§ â†’ é€æ­¥è¿ç§»è‡³Gradle
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â””â”€ Androidé¡¹ç›® â†’ å¼ºåˆ¶ä½¿ç”¨Gradleï¼ˆå®˜æ–¹æ”¯æŒï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="è¡¥å……å»ºè®®"&gt;è¡¥å……å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆä½¿ç”¨&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;maven-publish&lt;/code&gt;æ’ä»¶ï¼ŒGradleé¡¹ç›®å¯å‘å¸ƒåˆ°Mavenä»“åº“ï¼Œå®ç°ç”Ÿæ€äº’é€šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿ç§»æˆæœ¬&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;gradle init&lt;/code&gt;å‘½ä»¤å¯è‡ªåŠ¨è½¬æ¢Mavené¡¹ç›®ï¼Œä½†å¤æ‚æ„å»ºé€»è¾‘éœ€æ‰‹åŠ¨è°ƒæ•´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœªæ¥è¶‹åŠ¿&lt;/strong&gt;ï¼šGradleæ­£é€šè¿‡&lt;strong&gt;é…ç½®ç¼“å­˜&lt;/strong&gt;å’Œ&lt;strong&gt;åˆ†å¸ƒå¼æ„å»º&lt;/strong&gt;æŠ€æœ¯è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Œè€ŒMavenèšç„¦å®‰å…¨åˆè§„ï¼ˆå¦‚ä¾èµ–æ¼æ´æ ‡è®°ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œ2025å¹´çš„æŠ€æœ¯ç¯å¢ƒä¸‹ï¼Œ&lt;strong&gt;ä¼˜å…ˆæ¨èGradle&lt;/strong&gt;ï¼ˆå°¤å…¶æ–°é¡¹ç›®ï¼‰ï¼Œä½†Mavenåœ¨ç‰¹å®šåœºæ™¯ä»ä¸å¯æ›¿ä»£ã€‚å»ºè®®ç»“åˆå›¢é˜ŸæŠ€æœ¯å‚¨å¤‡å’Œé¡¹ç›®ç‰¹å¾é€‰æ‹©ï¼Œä¸¤è€…å¹¶éäº’æ–¥å…³ç³»ã€‚&lt;/p&gt;
&lt;h2 id="å¾®æœåŠ¡é…ç½®ç®¡ç†"&gt;å¾®æœåŠ¡é…ç½®ç®¡ç†
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé…ç½®ç®¡ç†æ˜¯ç¡®ä¿ç³»ç»Ÿçµæ´»æ€§ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§çš„æ ¸å¿ƒç¯èŠ‚ï¼Œè€ŒSpring Cloud Configæˆ–Nacosç­‰é…ç½®ä¸­å¿ƒå·¥å…·çš„åº”ç”¨ï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š&lt;/p&gt;
&lt;h3 id="å¾®æœåŠ¡æ¶æ„çš„é…ç½®æŒ‘æˆ˜"&gt;å¾®æœåŠ¡æ¶æ„çš„é…ç½®æŒ‘æˆ˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®åˆ†æ•£ä¸ç»´æŠ¤å›°éš¾&lt;/strong&gt;&lt;br&gt;
å¾®æœåŠ¡æ¶æ„å°†å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡å¯èƒ½æœ‰ç‹¬ç«‹çš„é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€APIå¯†é’¥ç­‰ï¼‰ã€‚è‹¥é‡‡ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œä¼šå¯¼è‡´é…ç½®åˆ†æ•£åœ¨å¤šä¸ªæœåŠ¡ä¸­ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ2æåˆ°ï¼Œä¼ ç»Ÿæ–¹å¼ä¸‹ä¸åŒç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰çš„é…ç½®æ–‡ä»¶éœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼Œæ˜“å¼•å‘é…ç½®é”™è¯¯æˆ–ç”Ÿäº§äº‹æ•…ï¼ˆå¦‚æµ‹è¯•é…ç½®è¯¯å¸¦å…¥ç”Ÿäº§ç¯å¢ƒå¯¼è‡´èµ„æŸï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°éœ€æ±‚&lt;/strong&gt;&lt;br&gt;
å¾®æœåŠ¡éœ€å¿«é€Ÿè¿­ä»£ï¼Œè‹¥æ¯æ¬¡é…ç½®å˜æ›´éƒ½éœ€é‡å¯æœåŠ¡ï¼Œä¼šä¸¥é‡å½±å“ç³»ç»Ÿå¯ç”¨æ€§ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ1æŒ‡å‡ºåŠ¨æ€é…ç½®çš„ç›®æ ‡æ˜¯â€œæ— éœ€é‡å¯æœåŠ¡å³å¯åº”ç”¨æ–°é…ç½®â€ï¼Œè€Œç½‘é¡µ6å’Œç½‘é¡µ7ä¸­çš„Spring Cloud Configé€šè¿‡&lt;code&gt;@RefreshScope&lt;/code&gt;å®ç°äº†é…ç½®çš„å®æ—¶åˆ·æ–°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šç¯å¢ƒä¸å¤šç§Ÿæˆ·éš”ç¦»&lt;/strong&gt;&lt;br&gt;
ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰æˆ–ä¸åŒå®¢æˆ·ï¼ˆå¤šç§Ÿæˆ·ï¼‰éœ€ç‹¬ç«‹é…ç½®ã€‚ç½‘é¡µ9å’Œç½‘é¡µ10æåˆ°ï¼ŒNacosé€šè¿‡&lt;strong&gt;Namespace&lt;/strong&gt;å®ç°å¤šç¯å¢ƒéš”ç¦»ï¼ŒSpring Cloud Configåˆ™é€šè¿‡Gitåˆ†æ”¯æˆ–é…ç½®æ–‡ä»¶å‘½ååŒºåˆ†ç¯å¢ƒï¼Œé¿å…é…ç½®å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨ä¸åˆè§„æ€§&lt;/strong&gt;&lt;br&gt;
æ•æ„Ÿé…ç½®ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰è‹¥æ˜æ–‡å­˜å‚¨ï¼Œå­˜åœ¨æ³„éœ²é£é™©ã€‚ç½‘é¡µ3å’Œç½‘é¡µ5å¼ºè°ƒé…ç½®ä¸­å¿ƒéœ€æ”¯æŒåŠ å¯†å­˜å‚¨å’Œè®¿é—®æ§åˆ¶ï¼Œå¦‚Nacosæä¾›æ•æ„Ÿæ•°æ®åŠ å¯†åŠŸèƒ½ï¼ŒSpring Cloud Configç»“åˆVaultå®ç°å¯†é’¥ç®¡ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ç®¡ç†å·¥å…·çš„æ ¸å¿ƒä»·å€¼"&gt;é…ç½®ç®¡ç†å·¥å…·çš„æ ¸å¿ƒä»·å€¼
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é›†ä¸­åŒ–ç®¡ç†ä¸ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
é…ç½®ä¸­å¿ƒï¼ˆå¦‚Nacosæˆ–Spring Cloud Configï¼‰å°†é…ç½®ç»Ÿä¸€å­˜å‚¨åœ¨ä¸­å¿ƒåŒ–ä»“åº“ï¼ˆå¦‚Gitæˆ–æ•°æ®åº“ï¼‰ï¼ŒæœåŠ¡å¯åŠ¨æ—¶æ‹‰å–é…ç½®ï¼Œç¡®ä¿æ‰€æœ‰å®ä¾‹ä½¿ç”¨ç›¸åŒé…ç½®ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ6æåˆ°Spring Cloud Configé€šè¿‡&lt;code&gt;Config Server&lt;/code&gt;é›†ä¸­ç®¡ç†é…ç½®ï¼Œç½‘é¡µ9æŒ‡å‡ºNacosæ”¯æŒé…ç½®çš„é›†ä¸­åŒ–å­˜å‚¨ä¸åŠ¨æ€æ¨é€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€é…ç½®ä¸å®æ—¶ç”Ÿæ•ˆ&lt;/strong&gt;&lt;br&gt;
é€šè¿‡é•¿è½®è¯¢æˆ–æ¶ˆæ¯æ€»çº¿ï¼ˆå¦‚Spring Cloud Busï¼‰ï¼Œé…ç½®å˜æ›´å¯å®æ—¶é€šçŸ¥æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ7ä¸­Spring Cloud Configç»“åˆRabbitMQå®ç°é…ç½®åˆ·æ–°ï¼ŒNacosé€šè¿‡é•¿è¿æ¥ä¸»åŠ¨æ¨é€å˜æ›´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶ä¸å›æ»š&lt;/strong&gt;&lt;br&gt;
é…ç½®ä¸­å¿ƒæ”¯æŒé…ç½®ç‰ˆæœ¬å†å²è®°å½•ï¼Œä¾¿äºè¿½è¸ªå˜æ›´å’Œå¿«é€Ÿå›æ»šã€‚ç½‘é¡µ1å’Œç½‘é¡µ5å‡æåˆ°ç‰ˆæœ¬æ§åˆ¶æ˜¯é…ç½®ç®¡ç†çš„åŸºç¡€åŠŸèƒ½ï¼Œå¯é¿å…é”™è¯¯é…ç½®å¯¼è‡´çš„æœåŠ¡ä¸­æ–­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜å¯ç”¨ä¸å®¹ç¾&lt;/strong&gt;&lt;br&gt;
é…ç½®ä¸­å¿ƒéœ€å…·å¤‡é›†ç¾¤éƒ¨ç½²èƒ½åŠ›ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚ä¾‹å¦‚ï¼Œç½‘é¡µ9æè¿°Nacosæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œé€šè¿‡Raftåè®®ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼›Spring Cloud Configå¯ç»“åˆEurekaå®ç°é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ”¯æŒæŒç»­äº¤ä»˜ä¸DevOps&lt;/strong&gt;&lt;br&gt;
é…ç½®ä¸­å¿ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼ˆå¦‚Kubernetesã€Jenkinsï¼‰ç»“åˆï¼Œå®ç°â€œä¸€æ¬¡æ„å»ºï¼Œå¤šç¯å¢ƒéƒ¨ç½²â€ã€‚ç½‘é¡µ4å’Œç½‘é¡µ5æŒ‡å‡ºï¼Œé…ç½®ä¸ä»£ç åˆ†ç¦»åï¼Œé•œåƒåªéœ€æ„å»ºä¸€æ¬¡ï¼Œä¸åŒç¯å¢ƒé€šè¿‡é…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½å‚æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="spring-cloud-configä¸nacosçš„å¯¹æ¯”"&gt;Spring Cloud Configä¸Nacosçš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Spring Cloud Config&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Nacos&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é…ç½®å­˜å‚¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–Git/SVNç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œé€‚åˆä¸ä»£ç ä»“åº“é›†æˆ&lt;/td&gt;
&lt;td&gt;æ”¯æŒMySQLã€æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç­‰ï¼Œæ›´çµæ´»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ç»“åˆSpring Cloud Buså®ç°æ¨é€&lt;/td&gt;
&lt;td&gt;å†…ç½®é•¿è½®è¯¢å’Œé•¿è¿æ¥æœºåˆ¶ï¼Œå®æ—¶æ€§æ›´é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœåŠ¡å‘ç°é›†æˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é…åˆEurekaç­‰ç»„ä»¶&lt;/td&gt;
&lt;td&gt;å†…ç½®æœåŠ¡å‘ç°ä¸é…ç½®ç®¡ç†ï¼Œä¸€ä½“åŒ–è®¾è®¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šç¯å¢ƒæ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€šè¿‡Gitåˆ†æ”¯æˆ–é…ç½®æ–‡ä»¶å‘½ååŒºåˆ†ç¯å¢ƒ&lt;/td&gt;
&lt;td&gt;é€šè¿‡Namespaceå’ŒGroupå®ç°å¤šç¯å¢ƒéš”ç¦»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€ç»“åˆVaultç­‰å·¥å…·å®ç°åŠ å¯†&lt;/td&gt;
&lt;td&gt;å†…ç½®æ•æ„Ÿæ•°æ®åŠ å¯†å’Œæƒé™æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è“ç»¿éƒ¨ç½²ä¸åŠŸèƒ½å¼€å…³&lt;/strong&gt;&lt;br&gt;
å¦‚ç½‘é¡µ2æ‰€è¿°ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒåŠ¨æ€åˆ‡æ¢åŠŸèƒ½å¼€å…³ï¼ˆå¦‚Feature Flagï¼‰ï¼Œå®ç°æ— éœ€è¿ç»´ä»‹å…¥çš„è“ç»¿å‘å¸ƒã€‚ä¾‹å¦‚ï¼Œæ–°åŠŸèƒ½éšè—åœ¨å¼€å…³åï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒé€æ­¥æ”¾é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™æµé™çº§ä¸å®¹ç¾&lt;/strong&gt;&lt;br&gt;
åŠ¨æ€è°ƒæ•´é™æµé˜ˆå€¼æˆ–ç†”æ–­è§„åˆ™ï¼Œå¦‚ä¿ƒé”€æœŸé—´é€šè¿‡Nacoså®æ—¶ä¿®æ”¹çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨æœåŠ¡å‚æ•°ç»Ÿä¸€ç®¡ç†&lt;/strong&gt;&lt;br&gt;
åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå…¨å±€å‚æ•°ï¼ˆå¦‚ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼‰é€šè¿‡é…ç½®ä¸­å¿ƒç»Ÿä¸€ä¿®æ”¹ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-4"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé…ç½®ç®¡ç†å·¥å…·ï¼ˆå¦‚Spring Cloud Configæˆ–Nacosï¼‰é€šè¿‡&lt;strong&gt;é›†ä¸­åŒ–å­˜å‚¨&lt;/strong&gt;ã€&lt;strong&gt;åŠ¨æ€æ›´æ–°&lt;/strong&gt;ã€&lt;strong&gt;å¤šç¯å¢ƒéš”ç¦»&lt;/strong&gt;å’Œ&lt;strong&gt;å®‰å…¨æ§åˆ¶&lt;/strong&gt;ï¼Œè§£å†³äº†ä¼ ç»Ÿé…ç½®æ–¹å¼çš„åˆ†æ•£æ€§ã€ä½æ•ˆæ€§å’Œé£é™©æ€§ã€‚ä¸¤è€…å„æœ‰ä¾§é‡ï¼šSpring Cloud Configæ›´é€‚åˆä¸Springç”Ÿæ€æ·±åº¦é›†æˆï¼Œè€ŒNacosä»¥ä¸€ä½“åŒ–çš„æœåŠ¡å‘ç°ä¸é…ç½®ç®¡ç†ã€æ›´é«˜çš„å®æ—¶æ€§è§é•¿ã€‚æ— è®ºé€‰æ‹©å“ªç§å·¥å…·ï¼Œæ ¸å¿ƒç›®æ ‡éƒ½æ˜¯æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€çµæ´»æ€§å’Œå¯é æ€§ï¼Œæ”¯æ’‘æ•æ·å¼€å‘å’Œè¿ç»´éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="gradle"&gt;Gradle
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒGradle çš„ &lt;code&gt;allprojects&lt;/code&gt; å’Œ &lt;code&gt;subprojects&lt;/code&gt; ä¸»è¦ç”¨äºç»Ÿä¸€é…ç½®å¤šä¸ªå­æ¨¡å—ï¼ˆå¾®æœåŠ¡ï¼‰ï¼Œä½†ä¸¤è€…åœ¨ä½œç”¨èŒƒå›´ã€é…ç½®é€»è¾‘å’Œä½¿ç”¨åœºæ™¯ä¸Šæœ‰æ˜¾è‘—åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½œç”¨èŒƒå›´"&gt;&lt;strong&gt;ä½œç”¨èŒƒå›´&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®å—&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½œç”¨å¯¹è±¡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¾®æœåŠ¡åœºæ™¯ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;allprojects&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ¹é¡¹ç›® &lt;strong&gt;å’Œ&lt;/strong&gt; æ‰€æœ‰å­é¡¹ç›®&lt;/td&gt;
&lt;td&gt;è‹¥æ ¹é¡¹ç›®æ˜¯ä¸€ä¸ªçº¯çˆ¶æ¨¡å—ï¼ˆæ— ä»£ç ï¼‰ï¼Œå¯èƒ½å¼•å…¥å†—ä½™é…ç½®ï¼ˆå¦‚åº”ç”¨ &lt;code&gt;java&lt;/code&gt; æ’ä»¶å¯¼è‡´æ„å»ºé”™è¯¯ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;subprojects&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»…æ‰€æœ‰å­é¡¹ç›®&lt;/strong&gt;ï¼ˆä¸åŒ…æ‹¬æ ¹é¡¹ç›®ï¼‰&lt;/td&gt;
&lt;td&gt;æ›´å®‰å…¨ï¼Œä»…ä½œç”¨äºå®é™…çš„å¾®æœåŠ¡æ¨¡å—ï¼ˆå¦‚ &lt;code&gt;order-service&lt;/code&gt;ã€&lt;code&gt;user-service&lt;/code&gt;ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨æ ¹é¡¹ç›®çš„ &lt;code&gt;build.gradle&lt;/code&gt; ä¸­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;allprojects&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;// æ‰€æœ‰é¡¹ç›®ï¼ˆå«æ ¹é¡¹ç›®ï¼‰å‡åº”ç”¨æ­¤é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="n"&gt;repositories&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;mavenCentral&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;subprojects&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c1"&gt;// ä»…å­é¡¹ç›®åº”ç”¨æ­¤é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="nl"&gt;plugin:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é…ç½®é€»è¾‘å·®å¼‚"&gt;&lt;strong&gt;é…ç½®é€»è¾‘å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ’ä»¶ä¸ä¾èµ–ç®¡ç†"&gt;&lt;strong&gt;1. æ’ä»¶ä¸ä¾èµ–ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;allprojects&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äºå…¨å±€æ’ä»¶å’Œä¾èµ–ï¼Œä½†éœ€æ³¨æ„æ ¹é¡¹ç›®çš„é€‚ç”¨æ€§ã€‚ä¾‹å¦‚ï¼Œè‹¥æ ¹é¡¹ç›®æ— éœ€æ‰“åŒ… JARï¼Œåˆ™åº”ç”¨ &lt;code&gt;java&lt;/code&gt; æ’ä»¶ä¼šæŠ¥é”™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;subprojects&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æ›´ç²¾å‡†ï¼Œå¯ä¸ºæ‰€æœ‰å¾®æœåŠ¡æ¨¡å—ç»Ÿä¸€é…ç½®å…¬å…±æ’ä»¶ï¼ˆå¦‚ Spring Bootã€ä¾èµ–ç®¡ç†æ’ä»¶ï¼‰å’Œä¾èµ–ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;subprojects&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="nl"&gt;plugin:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;java&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="nl"&gt;plugin:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;io.spring.dependency-management&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;implementation&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot:spring-boot-starter-web&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="2-ä»“åº“é…ç½®"&gt;&lt;strong&gt;2. ä»“åº“é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;buildscript&lt;/code&gt; å—&lt;/strong&gt;&lt;br&gt;
å®šä¹‰ Gradle &lt;strong&gt;è‡ªèº«&lt;/strong&gt;æ‰€éœ€çš„æ’ä»¶ä»“åº“ï¼ˆå¦‚ Spring Boot æ’ä»¶ï¼‰ï¼Œä¸å¾®æœåŠ¡ä»£ç æ— å…³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;allprojects&lt;/code&gt;/&lt;code&gt;subprojects&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å®šä¹‰å¾®æœåŠ¡ä»£ç æ‰€éœ€çš„ä¾èµ–ä»“åº“ï¼ˆå¦‚ Maven ç§æœ‰åº“ï¼‰ï¼Œç¡®ä¿æ‰€æœ‰æ¨¡å—èƒ½æ‹‰å–ä¾èµ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;buildscript&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;repositories&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gradlePluginPortal&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Gradle æ’ä»¶ä»“åº“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;classpath&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;com.android.tools.build:gradle:8.5.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;subprojects&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;repositories&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;maven&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;https://ç§æœ‰ä»“åº“åœ°å€&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="c1"&gt;// å¾®æœåŠ¡ä»£ç ä¾èµ–ä»“åº“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¸å‹åœºæ™¯ä¸æœ€ä½³å®è·µ"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯ä¸æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-ç»Ÿä¸€å·¥å…·é“¾é…ç½®"&gt;&lt;strong&gt;1. ç»Ÿä¸€å·¥å…·é“¾é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥æ‰€æœ‰å¾®æœåŠ¡éœ€ä½¿ç”¨ç›¸åŒ JDK ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;subprojects&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;java&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;toolchain&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;languageVersion&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;JavaLanguageVersion&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤é…ç½®ä»…ä½œç”¨äºå­é¡¹ç›®ï¼Œé¿å…æ ¹é¡¹ç›®å› æ— ä»£ç è€Œè§¦å‘ JDK æ ¡éªŒé”™è¯¯ã€‚&lt;/p&gt;
&lt;h4 id="2-ä¾èµ–ä½œç”¨åŸŸæ§åˆ¶"&gt;&lt;strong&gt;2. ä¾èµ–ä½œç”¨åŸŸæ§åˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;configurations&lt;/code&gt; ç»Ÿä¸€ç®¡ç†ç¼–è¯‘æ—¶ä¾èµ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;subprojects&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;configurations&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;compileOnly&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;extendsFrom&lt;/span&gt; &lt;span class="n"&gt;annotationProcessor&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;compileOnly&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.projectlombok:lombok&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;annotationProcessor&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.projectlombok:lombok&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="3-åŠ¨æ€æ¨¡å—è¿‡æ»¤"&gt;&lt;strong&gt;3. åŠ¨æ€æ¨¡å—è¿‡æ»¤&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€å¯¹éƒ¨åˆ†å¾®æœåŠ¡å¯ç”¨ç‰¹æ®Šé…ç½®ï¼ˆå¦‚ä»… Web æ¨¡å—æ·»åŠ  Actuatorï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-groovy" data-lang="groovy"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;subprojects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findAll&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;endsWith&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-web&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;})&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;implementation&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;org.springframework.boot:spring-boot-starter-actuator&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“å¯¹æ¯”"&gt;&lt;strong&gt;æ€»ç»“å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;allprojects&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;subprojects&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ ¹é¡¹ç›®éœ€ä¸å­é¡¹ç›®å…±äº«é…ç½®æ—¶ï¼ˆè¾ƒå°‘è§ï¼‰&lt;/td&gt;
&lt;td&gt;å¾®æœåŠ¡åœºæ™¯çš„æ¨èé€‰æ‹©ï¼Œç²¾å‡†æ§åˆ¶å­æ¨¡å—é…ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¯èƒ½æ±¡æŸ“æ ¹é¡¹ç›®é…ç½®&lt;/td&gt;
&lt;td&gt;é¿å…æ ¹é¡¹ç›®å†—ä½™é…ç½®ï¼Œæ›´å®‰å…¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒå…¨å±€è¦†ç›–ï¼Œä½†æ˜“å¼•å‘å†²çª&lt;/td&gt;
&lt;td&gt;æ”¯æŒæŒ‰éœ€è¿‡æ»¤å­æ¨¡å—ï¼ˆå¦‚ &lt;code&gt;configure&lt;/code&gt; å—ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;subprojects&lt;/code&gt;&lt;/strong&gt;ï¼Œä»…åœ¨æ ¹é¡¹ç›®éœ€è¦å‚ä¸æ„å»ºæ—¶ï¼ˆå¦‚èšåˆ POMï¼‰ä½¿ç”¨ &lt;code&gt;allprojects&lt;/code&gt;ã€‚é€šè¿‡åˆ†ç¦»æ’ä»¶ç®¡ç†ä¸ä»£ç ä¾èµ–ï¼Œå¯æ˜¾è‘—æå‡æ„å»ºç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;h2 id="docker-compose"&gt;Docker Compose
&lt;/h2&gt;&lt;p&gt;å¯¹åº”åšå®¢&lt;/p&gt;
&lt;h2 id="bootstrapyaml"&gt;Bootstrap.yaml
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;code&gt;bootstrap.yaml&lt;/code&gt; æ˜¯ Spring Cloud é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”¨äº&lt;strong&gt;åˆå§‹åŒ–é…ç½®ä¸­å¿ƒè¿æ¥&lt;/strong&gt;å’Œ&lt;strong&gt;å®šä¹‰æ—©æœŸåŠ è½½çš„å…¨å±€å±æ€§&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®é…ç½®è¦ç‚¹åŠç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºç¡€é…ç½®ç»“æ„"&gt;åŸºç¡€é…ç½®ç»“æ„
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;application&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;cart-service &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å¾®æœåŠ¡åç§°ï¼Œå†³å®šNacosé»˜è®¤åŠ è½½çš„Data ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;profiles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;active&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;dev &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# ç¯å¢ƒæ ‡è¯†ï¼ˆå¦‚dev/test/prodï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;nacos&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;server-addr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;127.0.0.1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="m"&gt;8848&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# NacosæœåŠ¡å™¨åœ°å€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;dev &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å‘½åç©ºé—´IDï¼ˆå¤šç¯å¢ƒéš”ç¦»ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;DEFAULT_GROUP &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# é…ç½®åˆ†ç»„&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;file-extension&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# é…ç½®æ–‡ä»¶åç¼€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;shared-configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…±äº«é…ç½®æ–‡ä»¶åˆ—è¡¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-jdbc.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ•°æ®åº“é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-log.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ—¥å¿—é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒé…ç½®é¡¹è§£æ"&gt;æ ¸å¿ƒé…ç½®é¡¹è§£æ
&lt;/h3&gt;&lt;h4 id="nacos-è¿æ¥é…ç½®"&gt;&lt;strong&gt;Nacos è¿æ¥é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;server-addr&lt;/code&gt;&lt;/strong&gt;: å¿…é¡»ä¸NacosæœåŠ¡å™¨åœ°å€ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•æ‹‰å–é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;namespace&lt;/code&gt;&lt;/strong&gt; å’Œ &lt;strong&gt;&lt;code&gt;group&lt;/code&gt;&lt;/strong&gt;: ç”¨äºå¤šç¯å¢ƒéš”ç¦»ã€‚ä¾‹å¦‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œå¼€å‘æµ‹è¯•ç¯å¢ƒé€šè¿‡åˆ†ç»„åŒºåˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å…±äº«é…ç½®ç®¡ç†"&gt;&lt;strong&gt;å…±äº«é…ç½®ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;shared-configs&lt;/code&gt; åŠ è½½é€šç”¨é…ç½®ï¼ˆå¦‚æ•°æ®åº“ã€æ—¥å¿—ï¼‰ï¼Œé¿å…é‡å¤å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;shared-configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-jdbc.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# JDBCé…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-swagger.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# APIæ–‡æ¡£é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼˜å…ˆçº§ï¼šå…±äº«é…ç½® &amp;lt; æ‰©å±•é…ç½® &amp;lt; åº”ç”¨ä¸“å±é…ç½®ã€‚&lt;/p&gt;
&lt;h4 id="åŠ¨æ€é…ç½®çƒ­æ›´æ–°"&gt;&lt;strong&gt;åŠ¨æ€é…ç½®çƒ­æ›´æ–°&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ä¸šåŠ¡ä»£ç ä¸­é€šè¿‡ &lt;code&gt;@ConfigurationProperties&lt;/code&gt; æ³¨è§£ç»‘å®šé…ç½®ç±»ï¼Œå®ç°é…ç½®å®æ—¶ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ConfigurationProperties&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;hm.cart&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CartProperties&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxItems&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çƒ­æ›´æ–°å­—æ®µï¼ˆæ— éœ€é‡å¯æœåŠ¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é«˜çº§é…ç½®åœºæ™¯"&gt;é«˜çº§é…ç½®åœºæ™¯
&lt;/h3&gt;&lt;h4 id="æœ¬åœ°é…ç½®ä¼˜å…ˆ"&gt;&lt;strong&gt;æœ¬åœ°é…ç½®ä¼˜å…ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;spring.cloud.config.override-none=true&lt;/code&gt; å¼ºåˆ¶æœ¬åœ°é…ç½®è¦†ç›–è¿œç¨‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;override-none&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æœ¬åœ°application.yamlä¼˜å…ˆçº§æœ€é«˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ‰©å±•é…ç½®æ–‡ä»¶"&gt;&lt;strong&gt;æ‰©å±•é…ç½®æ–‡ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;extension-configs&lt;/code&gt; åŠ è½½éå…±äº«çš„ç‹¬ç«‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;extension-configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;payment-service.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ”¯ä»˜æœåŠ¡ä¸“ç”¨é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;redis-cluster.yaml &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# Redisé›†ç¾¤é…ç½®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å¤šç¯å¢ƒéš”ç¦»"&gt;&lt;strong&gt;å¤šç¯å¢ƒéš”ç¦»&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;spring.profiles.active&lt;/code&gt; åŠ¨æ€åˆ‡æ¢ç¯å¢ƒé…ç½®ï¼Œç»“åˆNacosçš„å‘½åç©ºé—´å®ç°éš”ç¦»ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;profiles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;active&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;prod &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ¿€æ´»ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆåŠ è½½prodå‘½åç©ºé—´ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-2"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ è½½é¡ºåº&lt;/strong&gt;ï¼š&lt;code&gt;bootstrap.yaml&lt;/code&gt; &amp;gt; Nacosè¿œç¨‹é…ç½® &amp;gt; &lt;code&gt;application.yaml&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…é‡å¤&lt;/strong&gt;ï¼šä¸ &lt;code&gt;application.yaml&lt;/code&gt; çš„é…ç½®é¡¹éœ€äº’è¡¥ï¼Œé˜²æ­¢å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–æ³¨å…¥&lt;/strong&gt;ï¼šéœ€æ·»åŠ  &lt;code&gt;spring-cloud-starter-bootstrap&lt;/code&gt; ä¾èµ–ä»¥å¯ç”¨è¯¥æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œå¯å®ç°å¾®æœåŠ¡çš„åŠ¨æ€åŒ–ã€ç¯å¢ƒéš”ç¦»åŒ–é…ç½®ç®¡ç†ï¼Œæ˜¾è‘—æå‡è¿ç»´æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h3 id="ç¤ºä¾‹"&gt;ç¤ºä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;application&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;user-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;profiles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;active&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;dev&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;nacos&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;server-addr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192.168.1.100&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="m"&gt;8848&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;dev-env&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;DEV_GROUP&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;file-extension&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;shared-configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-datasource.yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;shared-feign.yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;extension-configs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;data-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;user-service-specific.yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯&lt;code&gt;bootstrap.yaml&lt;/code&gt;é…ç½®æ–‡ä»¶ä¸­æ¯ä¸€è¡Œçš„ä½œç”¨è§£æï¼Œç»“åˆNacosé…ç½®ä¸­å¿ƒåŠSpring Cloud Alibabaçš„å…¸å‹ç”¨æ³•ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;1. &lt;code&gt;spring.application.name: user-service&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå®šä¹‰å¾®æœåŠ¡åç§°ï¼Œè¯¥åç§°ä¼šä½œä¸ºæ³¨å†Œåˆ°Nacosçš„æœåŠ¡æ ‡è¯†ï¼Œå¹¶ç”¨äºç”Ÿæˆé»˜è®¤çš„é…ç½®æ–‡ä»¶åï¼ˆData IDï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»†èŠ‚&lt;/strong&gt;ï¼šåœ¨Nacosä¸­ï¼Œé»˜è®¤ä¼šåŠ è½½&lt;code&gt;${spring.application.name}.${file-extension}&lt;/code&gt;çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚&lt;code&gt;user-service.yaml&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;2. &lt;code&gt;spring.profiles.active: dev&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ¿€æ´»&lt;code&gt;dev&lt;/code&gt;ç¯å¢ƒé…ç½®ï¼Œå†³å®šåŠ è½½çš„é…ç½®æ–‡ä»¶åç¼€ï¼ˆå¦‚&lt;code&gt;user-service-dev.yaml&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•&lt;/strong&gt;ï¼šç»“åˆ&lt;code&gt;namespace&lt;/code&gt;å¯å®ç°å¤šç¯å¢ƒéš”ç¦»ï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;3. &lt;code&gt;spring.cloud.nacos.server-addr: 192.168.1.100:8848&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæŒ‡å®šNacosæœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œç”¨äºè¿æ¥é…ç½®ä¸­å¿ƒå’ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè‹¥æœªæ­£ç¡®é…ç½®ï¼Œåº”ç”¨å°†æ— æ³•ä»Nacosè·å–é…ç½®æˆ–æ³¨å†ŒæœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;4. &lt;code&gt;spring.cloud.nacos.config.namespace: dev-env&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå®šä¹‰Nacosçš„å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ï¼Œç”¨äºéš”ç¦»ä¸åŒç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ï¼‰çš„é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šåœ¨Nacosæ§åˆ¶å°ä¸­ï¼Œ&lt;code&gt;dev-env&lt;/code&gt;å‘½åç©ºé—´ä¸‹çš„é…ç½®ä»…å½“å‰ç¯å¢ƒå¯è§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;5. &lt;code&gt;spring.cloud.nacos.config.group: DEV_GROUP&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæŒ‡å®šé…ç½®åˆ†ç»„ï¼ˆGroupï¼‰ï¼Œç”¨äºé€»è¾‘ä¸ŠåŒºåˆ†åŒä¸€ç¯å¢ƒå†…çš„ä¸åŒæœåŠ¡æˆ–æ¨¡å—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šåŒä¸€å‘½åç©ºé—´ä¸‹ï¼Œé€šè¿‡ä¸åŒGroupåŒºåˆ†æ•°æ®åº“é…ç½®ã€æ—¥å¿—é…ç½®ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;6. &lt;code&gt;spring.cloud.nacos.config.file-extension: yaml&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå£°æ˜é…ç½®æ–‡ä»¶æ ¼å¼ä¸ºYAMLï¼ŒNacosä¼šæ ¹æ®æ­¤æ‰©å±•ååŠ è½½å¯¹åº”æ ¼å¼çš„é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹æ¯”&lt;/strong&gt;ï¼šé»˜è®¤å€¼ä¸º&lt;code&gt;properties&lt;/code&gt;ï¼Œéœ€æ˜¾å¼æŒ‡å®šä¸º&lt;code&gt;yaml&lt;/code&gt;ä»¥æ”¯æŒæ›´çµæ´»çš„é…ç½®ç»“æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;7. &lt;code&gt;shared-configs&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåŠ è½½å¤šä¸ªæœåŠ¡å…±äº«çš„å…¬å…±é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€å…¬å…±ç»„ä»¶é…ç½®ï¼‰ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;data-id: shared-datasource.yaml&lt;/code&gt;&lt;/strong&gt;ï¼šå…±äº«æ•°æ®åº“é…ç½®ï¼ˆå¦‚MySQLè¿æ¥æ± å‚æ•°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;data-id: shared-feign.yaml&lt;/code&gt;&lt;/strong&gt;ï¼šå…±äº«Feignå®¢æˆ·ç«¯é…ç½®ï¼ˆå¦‚è¶…æ—¶æ—¶é—´ã€é‡è¯•ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šå…±äº«é…ç½®çš„ä¼˜å…ˆçº§ä½äºåº”ç”¨ä¸“å±é…ç½®ï¼Œä½†é«˜äºNacosé»˜è®¤é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;8. &lt;code&gt;extension-configs&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šåŠ è½½å½“å‰æœåŠ¡çš„æ‰©å±•é…ç½®ï¼ˆéå…±äº«ï¼‰ï¼Œç”¨äºè¦†ç›–æˆ–è¡¥å……é»˜è®¤é…ç½®ã€‚
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;data-id: user-service-specific.yaml&lt;/code&gt;&lt;/strong&gt;ï¼šæœåŠ¡ç‰¹æœ‰çš„é…ç½®ï¼ˆå¦‚ä¸šåŠ¡å‚æ•°ã€ç¼“å­˜ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šæ‰©å±•é…ç½®ä¼˜å…ˆçº§é«˜äºå…±äº«é…ç½®ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°ï¼ˆéœ€é…ç½®&lt;code&gt;refresh: true&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®åŠ è½½é¡ºåºæ€»ç»“"&gt;&lt;strong&gt;é…ç½®åŠ è½½é¡ºåºæ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;user-service.yaml&lt;/code&gt;ï¼ˆåŸºäº&lt;code&gt;spring.application.name&lt;/code&gt;å’Œ&lt;code&gt;file-extension&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;user-service-specific.yaml&lt;/code&gt;ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…±äº«é…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;shared-datasource.yaml&lt;/code&gt;å’Œ&lt;code&gt;shared-feign.yaml&lt;/code&gt;ï¼ˆä¼˜å…ˆçº§æ¬¡ä¹‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¯å¢ƒé…ç½®&lt;/strong&gt;ï¼š&lt;code&gt;user-service-dev.yaml&lt;/code&gt;ï¼ˆåŸºäº&lt;code&gt;spring.profiles.active&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-3"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€åˆ·æ–°&lt;/strong&gt;ï¼šè‹¥éœ€å®æ—¶æ›´æ–°é…ç½®ï¼Œéœ€åœ¨ä»£ç ä¸­ä½¿ç”¨&lt;code&gt;@RefreshScope&lt;/code&gt;æ³¨è§£ï¼Œå¹¶åœ¨é…ç½®ä¸­å¯ç”¨&lt;code&gt;refresh: true&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘½åç©ºé—´ä¸åˆ†ç»„&lt;/strong&gt;ï¼šç¡®ä¿Nacosæ§åˆ¶å°ä¸­çš„é…ç½®ä¸&lt;code&gt;namespace&lt;/code&gt;ã€&lt;code&gt;group&lt;/code&gt;ä¸¥æ ¼åŒ¹é…ï¼Œå¦åˆ™ä¼šå¯¼è‡´åŠ è½½å¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ•°æ®åº“å®¹å™¨æ•°"&gt;æ•°æ®åº“å®¹å™¨æ•°
&lt;/h2&gt;&lt;p&gt;åœ¨ Kubernetes (K8S) çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;æ¨èä¸ºæ¯ä¸ªæ•°æ®åº“å•ç‹¬éƒ¨ç½²ä¸€ä¸ªå®¹å™¨&lt;/strong&gt;ï¼ˆå³å¤šä¸ªæ•°æ®åº“å®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨å«ä¸€ä¸ªæ•°æ®åº“ï¼‰ã€‚è¿™ä¸€é€‰æ‹©ä¸»è¦åŸºäºå¾®æœåŠ¡çš„è®¾è®¡åŸåˆ™å’Œ K8S çš„ç‰¹æ€§ï¼Œä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒåŸåˆ™"&gt;&lt;strong&gt;å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒåŸåˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¾®æœåŠ¡å¼ºè°ƒâ€œå•ä¸€èŒè´£â€å’Œâ€œæ¾è€¦åˆâ€ã€‚æ¯ä¸ªæœåŠ¡åº”ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„æ•°æ®ï¼ŒåŒ…æ‹¬ç‹¬ç«‹çš„æ•°æ®åº“ã€‚è¿™ç§è®¾è®¡å…è®¸ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬ç«‹æ‰©å±•&lt;/strong&gt;ï¼šä¸åŒæ•°æ®åº“å¯èƒ½å› ä¸šåŠ¡éœ€æ±‚éœ€è¦ä¸åŒçš„èµ„æºé…ç½®ï¼ˆå¦‚ CPUã€å†…å­˜ã€å­˜å‚¨ï¼‰ï¼Œå•ç‹¬éƒ¨ç½²å®¹å™¨å¯çµæ´»è°ƒæ•´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœéš”ç¦»&lt;/strong&gt;ï¼šå•ä¸ªæ•°æ®åº“å®¹å™¨çš„æ•…éšœä¸ä¼šå½±å“å…¶ä»–æ•°æ®åº“æˆ–æœåŠ¡ï¼Œæé«˜ç³»ç»Ÿæ•´ä½“ç¨³å®šæ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯é€‰å‹è‡ªç”±&lt;/strong&gt;ï¼šä¸åŒæœåŠ¡å¯èƒ½æ›´é€‚åˆä¸åŒæ•°æ®åº“ç±»å‹ï¼ˆå¦‚å…³ç³»å‹ã€NoSQLï¼‰ï¼Œç‹¬ç«‹å®¹å™¨å…è®¸æŒ‰éœ€é€‰æ‹©æŠ€æœ¯æ ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="k8s-èµ„æºç®¡ç†çš„é€‚é…æ€§"&gt;&lt;strong&gt;K8S èµ„æºç®¡ç†çš„é€‚é…æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;StatefulSet ä¸æŒä¹…åŒ–å­˜å‚¨&lt;/strong&gt;ï¼šæ•°æ®åº“æ˜¯æœ‰çŠ¶æ€åº”ç”¨ï¼Œéœ€é€šè¿‡ &lt;code&gt;StatefulSet&lt;/code&gt; éƒ¨ç½²ï¼Œå¹¶æ­é… &lt;code&gt;PersistentVolume (PV)&lt;/code&gt; å’Œ &lt;code&gt;PersistentVolumeClaim (PVC)&lt;/code&gt; å®ç°æ•°æ®æŒä¹…åŒ–ã€‚æ¯ä¸ªæ•°æ®åº“å•ç‹¬éƒ¨ç½²å¯ç¡®ä¿ç‹¬ç«‹çš„å­˜å‚¨å·å’Œç¨³å®šçš„ç½‘ç»œæ ‡è¯†ï¼ˆå¦‚å›ºå®š DNS åç§°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºéš”ç¦»ä¸è°ƒåº¦&lt;/strong&gt;ï¼šK8S å¯ä¸ºæ¯ä¸ªæ•°æ®åº“å®¹å™¨å•ç‹¬é…ç½®èµ„æºè¯·æ±‚ï¼ˆå¦‚ CPUã€å†…å­˜ï¼‰ï¼Œé¿å…å¤šæ•°æ®åº“å…±äº«å®¹å™¨æ—¶çš„èµ„æºç«äº‰é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å•å®¹å™¨å¤šæ•°æ®åº“çš„å¼Šç«¯"&gt;&lt;strong&gt;å•å®¹å™¨å¤šæ•°æ®åº“çš„å¼Šç«¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥å°†å¤šä¸ªæ•°æ®åº“æ”¾å…¥ä¸€ä¸ªå®¹å™¨ï¼Œå¯èƒ½å¼•å‘ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿ç»´å¤æ‚åº¦é«˜&lt;/strong&gt;ï¼šæ•°æ®åº“å‡çº§ã€å¤‡ä»½ã€æ¢å¤ç­‰æ“ä½œéœ€åŒæ—¶å¤„ç†å¤šä¸ªç»„ä»¶ï¼Œå®¹æ˜“å› ä¾èµ–å…³ç³»å¯¼è‡´é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§å—é™&lt;/strong&gt;ï¼šæ— æ³•é’ˆå¯¹å•ä¸ªæ•°æ®åº“æ¨ªå‘æ‰©å±•ï¼Œä¸”èµ„æºåˆ†é…éœ€æ•´ä½“è°ƒæ•´ï¼Œä¸å¤Ÿçµæ´»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨é£é™©&lt;/strong&gt;ï¼šå…±äº«å®¹å™¨å¯èƒ½å› æƒé™é…ç½®ä¸å½“å¯¼è‡´è·¨æ•°æ®åº“æ•°æ®æ³„éœ²æˆ–è¯¯æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µä¸­çš„æœ€ä½³æ–¹æ¡ˆ"&gt;&lt;strong&gt;å®è·µä¸­çš„æœ€ä½³æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¯ä¸ªå¾®æœåŠ¡å¯¹åº”ä¸€ä¸ªæ•°æ®åº“&lt;/strong&gt;ï¼šä¾‹å¦‚è®¢å•æœåŠ¡ä½¿ç”¨ MySQLã€å•†å“æœåŠ¡ä½¿ç”¨ PostgreSQLã€æ—¥å¿—æœåŠ¡ä½¿ç”¨ MongoDBï¼Œæ¯ä¸ªæ•°æ®åº“ç‹¬ç«‹éƒ¨ç½²ä¸ºå®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ©ç”¨ Service æš´éœ²æ•°æ®åº“&lt;/strong&gt;ï¼šé€šè¿‡ K8S &lt;code&gt;Service&lt;/code&gt; ä¸ºæ¯ä¸ªæ•°æ®åº“æä¾›å›ºå®šè®¿é—®ç«¯ç‚¹ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡ Service åç§°ï¼ˆå¦‚ &lt;code&gt;mysql-service&lt;/code&gt;ï¼‰è®¿é—®ï¼Œé¿å…ç¡¬ç¼–ç  IPã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤‡ä»½ä¸ç›‘æ§&lt;/strong&gt;ï¼šç»“åˆ K8S çš„ &lt;code&gt;Volume Snapshots&lt;/code&gt; å’Œç›‘æ§å·¥å…·ï¼ˆå¦‚ Prometheusï¼‰ï¼Œå®ç°æ¯ä¸ªæ•°æ®åº“çš„ç‹¬ç«‹å¤‡ä»½å’Œæ€§èƒ½ç›‘æ§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-5"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åœ¨ K8S ä¸­ï¼Œ&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©ä¸ºæ¯ä¸ªæ•°æ®åº“éƒ¨ç½²å•ç‹¬çš„å®¹å™¨&lt;/strong&gt;ï¼Œè¿™ç¬¦åˆå¾®æœåŠ¡çš„é«˜å†…èšã€ä½è€¦åˆåŸåˆ™ï¼ŒåŒæ—¶å……åˆ†åˆ©ç”¨ K8S çš„ç¼–æ’èƒ½åŠ›ä¿éšœæ•°æ®åº“çš„å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œè¿ç»´ä¾¿æ·æ€§ã€‚è‹¥å­˜åœ¨è½»é‡çº§è¾…åŠ©æ•°æ®åº“ï¼ˆå¦‚ç¼“å­˜åº“ Redisï¼‰ï¼Œå¯é…Œæƒ…ä¸å…¶ä»–ä½é¢‘è®¿é—®çš„æ•°æ®åº“å…±äº«å®¹å™¨ï¼Œä½†éœ€æƒè¡¡è¿ç»´é£é™©ã€‚&lt;/p&gt;
&lt;h2 id="spring-cloud-gateway"&gt;Spring Cloud Gateway
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯Spring Cloud Gatewayçš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£åŠæœ€ä½³å®è·µæ•´ç†è€Œæˆï¼š&lt;/p&gt;
&lt;h3 id="åŸºç¡€é…ç½®"&gt;åŸºç¡€é…ç½®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–å¼•å…¥&lt;/strong&gt;&lt;br&gt;
åœ¨&lt;code&gt;pom.xml&lt;/code&gt;ä¸­æ·»åŠ ç½‘å…³æ ¸å¿ƒä¾èµ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-gateway&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€æ’é™¤&lt;code&gt;spring-boot-starter-web&lt;/code&gt;ä¾èµ–ï¼Œé¿å…ä¸WebFluxå†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨ç±»é…ç½®&lt;/strong&gt;&lt;br&gt;
ä¸»ç±»æ·»åŠ &lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;å®ç°æœåŠ¡å‘ç°é›†æˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableDiscoveryClient&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;GatewayApplication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpringApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GatewayApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è·¯ç”±é…ç½®"&gt;è·¯ç”±é…ç½®
&lt;/h3&gt;&lt;h4 id="æ–¹å¼1yamlé…ç½®æ¨è"&gt;æ–¹å¼1ï¼šYAMLé…ç½®ï¼ˆæ¨èï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;user-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;lb://USER-SERVICE &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡å&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;predicates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;Path=/api/users/**&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;filters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;StripPrefix=2 &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å»é™¤å‰ç¼€/api/users&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;AddRequestHeader=X-Request-Color, Blue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ–¹å¼2java-dslé…ç½®"&gt;æ–¹å¼2ï¼šJava DSLé…ç½®
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RouteLocator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;customRouteLocator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RouteLocatorBuilder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;path_route&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/get&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filters&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addRequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;World&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;http://httpbin.org&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½å®ç°"&gt;æ ¸å¿ƒåŠŸèƒ½å®ç°
&lt;/h3&gt;&lt;h4 id="æ–­è¨€predicates"&gt;æ–­è¨€ï¼ˆPredicatesï¼‰
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯å¾„åŒ¹é…&lt;/strong&gt;ï¼š&lt;code&gt;Path=/api/**&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚æ–¹æ³•&lt;/strong&gt;ï¼š&lt;code&gt;Method=GET,POST&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Headeræ ¡éªŒ&lt;/strong&gt;ï¼š&lt;code&gt;Header=X-Request-Id, \d+&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé‡è·¯ç”±&lt;/strong&gt;ï¼š&lt;code&gt;Weight=group1, 80&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è¿‡æ»¤å™¨filters"&gt;è¿‡æ»¤å™¨ï¼ˆFiltersï¼‰
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¿‡æ»¤å™¨ç±»å‹&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹é…ç½®&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è¯·æ±‚å¤´æ“ä½œ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;AddRequestHeader=X-Request-Red, A&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ·»åŠ è¯·æ±‚å¤´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è·¯å¾„é‡å†™&lt;/td&gt;
&lt;td&gt;&lt;code&gt;RewritePath=/red/?, /?&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŠ¨æ€ä¿®æ”¹è¯·æ±‚è·¯å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç†”æ–­å™¨&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CircuitBreaker=myCircuitBreaker&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é›†æˆHystrix/Resilience4J&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é™æµ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;RequestRateLimiter=10rps&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºRedisçš„ä»¤ç‰Œæ¡¶ç®—æ³•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="ç†”æ–­é…ç½®"&gt;ç†”æ–­é…ç½®
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;filters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;CircuitBreaker&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;userFallback&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;fallbackUri&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;forward:/fallback/user&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é«˜çº§åŠŸèƒ½"&gt;é«˜çº§åŠŸèƒ½
&lt;/h3&gt;&lt;h4 id="å…¨å±€è¿‡æ»¤å™¨"&gt;å…¨å±€è¿‡æ»¤å™¨
&lt;/h4&gt;&lt;p&gt;å®ç°å…¨å±€æ—¥å¿—è®°å½•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;globalFilter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;è¯·æ±‚è·¯å¾„: {}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getPath&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="åŠ¨æ€è·¯ç”±"&gt;åŠ¨æ€è·¯ç”±
&lt;/h4&gt;&lt;p&gt;é€šè¿‡Nacosé…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€æ›´æ–°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;nacos&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;server-addr&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;localhost:8848&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;file-extension&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;yaml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å®‰å…¨é›†æˆ"&gt;å®‰å…¨é›†æˆ
&lt;/h4&gt;&lt;p&gt;JWTé‰´æƒç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;JwtFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getFirst&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Authorization&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// éªŒè¯tokené€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="è°ƒè¯•ä¸ç›‘æ§"&gt;è°ƒè¯•ä¸ç›‘æ§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼€å¯è°ƒè¯•æ—¥å¿—&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;logging&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;level&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;org.springframework.cloud.gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;TRACE&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;reactor.netty.http.client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;DEBUG&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Actuatorç«¯ç‚¹&lt;/strong&gt;&lt;br&gt;
å¯ç”¨ç«¯ç‚¹æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;management&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;endpoints&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;exposure&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;include&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;gateway&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—®&lt;code&gt;/actuator/gateway/routes&lt;/code&gt;è·å–æ‰€æœ‰è·¯ç”±é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜è§£å†³"&gt;å¸¸è§é—®é¢˜è§£å†³
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ä½“ä¸¢å¤±&lt;/strong&gt;&lt;br&gt;
é€šè¿‡&lt;code&gt;CachedBodyFilter&lt;/code&gt;ç¼“å­˜è¯·æ±‚ä½“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·å–çœŸå®IP&lt;/strong&gt;&lt;br&gt;
é…ç½®ä¿¡ä»»ä»£ç†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;httpclient&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;proxy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;HTTP&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;proxy-host&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¨åŸŸé…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;globalcors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;add-to-simple-url-handler-mapping&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;corsConfigurations&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;#39;[/**]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedOrigins&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedMethods&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="l"&gt;GET, POST]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®-1"&gt;æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒé…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;Resilience4J&lt;/code&gt;æ›¿ä»£Hystrixï¼ˆå®˜æ–¹æ¨èï¼‰&lt;/li&gt;
&lt;li&gt;å¯ç”¨&lt;code&gt;HTTPS&lt;/code&gt;ç»ˆç»“&lt;/li&gt;
&lt;li&gt;ç»“åˆPrometheuså®ç°ç›‘æ§æŒ‡æ ‡é‡‡é›†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç”¨&lt;code&gt;Netty&lt;/code&gt;åŸç”Ÿä¼ è¾“ï¼ˆéœ€æ·»åŠ &lt;code&gt;netty-transport-native-epoll&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;è°ƒæ•´&lt;code&gt;reactor-netty&lt;/code&gt;çº¿ç¨‹æ± é…ç½®&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜è¿‡æ»¤å™¨å‡å°‘é‡å¤è®¡ç®—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°é…ç½®ï¼Œå¯å¿«é€Ÿæ„å»ºæ”¯æŒåŠ¨æ€è·¯ç”±ã€ç†”æ–­é™çº§ã€å®‰å…¨è®¤è¯ç­‰åŠŸèƒ½çš„ä¼ä¸šçº§APIç½‘å…³ã€‚å»ºè®®ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„è¿‡æ»¤å™¨ç»„åˆï¼Œå¹¶é€šè¿‡Actuatorç«¯ç‚¹æŒç»­ç›‘æ§ç½‘å…³çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h2 id="enablediscoveryclient-å’Œ-enablefeignclients"&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt; å’Œ &lt;code&gt;@EnableFeignClients&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt; å’Œ &lt;code&gt;@EnableFeignClients&lt;/code&gt; æ˜¯ä¸¤ä¸ªæ ¸å¿ƒæ³¨è§£ï¼Œä½†å®ƒä»¬çš„èŒè´£å’Œä½¿ç”¨åœºæ™¯æœ‰æ˜¾è‘—åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„å¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½å·®å¼‚"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ç”¨äº&lt;strong&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/strong&gt;ã€‚å®ƒä½¿åº”ç”¨èƒ½å¤Ÿè¿æ¥åˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Eurekaã€Consulã€Nacosï¼‰ï¼Œå¹¶å®Œæˆä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡æ³¨å†Œ&lt;/strong&gt;ï¼šå°†å½“å‰åº”ç”¨å®ä¾‹çš„ä¿¡æ¯ï¼ˆIPã€ç«¯å£ã€æœåŠ¡åç­‰ï¼‰æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ï¼šä»æ³¨å†Œä¸­å¿ƒè·å–å…¶ä»–æœåŠ¡çš„å¯ç”¨å®ä¾‹åˆ—è¡¨ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥åº·æ£€æŸ¥&lt;/strong&gt;ï¼šå®šæœŸä¸æ³¨å†Œä¸­å¿ƒé€šä¿¡ï¼Œç»´æŠ¤æœåŠ¡å®ä¾‹çš„å¥åº·çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableFeignClients&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ç”¨äº&lt;strong&gt;å£°æ˜å¼ HTTP æœåŠ¡è°ƒç”¨&lt;/strong&gt;ã€‚å®ƒé€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œå°†æ¥å£å®šä¹‰ä¸ºè¿œç¨‹æœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œç®€åŒ–æœåŠ¡é—´é€šä¿¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¥å£ä»£ç†ç”Ÿæˆ&lt;/strong&gt;ï¼šæ‰«æ &lt;code&gt;@FeignClient&lt;/code&gt; æ³¨è§£çš„æ¥å£ï¼Œç”Ÿæˆ HTTP è¯·æ±‚çš„ä»£ç†å®ç°ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯·æ±‚å°è£…&lt;/strong&gt;ï¼šè‡ªåŠ¨å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º HTTP è¯·æ±‚ï¼Œå¤„ç†å‚æ•°ç»‘å®šã€åºåˆ—åŒ–ç­‰ç»†èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†æˆè´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šç»“åˆ Ribbon æˆ– Spring Cloud LoadBalancerï¼Œå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨åœºæ™¯"&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿…é¡»ç”¨äºæ‰€æœ‰éœ€è¦æ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„åº”ç”¨&lt;/strong&gt;ï¼ŒåŒ…æ‹¬æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•æœåŠ¡ï¼ˆæä¾›è€…ï¼‰éœ€è¦æ³¨å†Œè‡ªå·±ï¼Œä»¥ä¾¿å…¶ä»–æœåŠ¡å‘ç°å®ƒï¼›åŒæ—¶ï¼Œæ”¯ä»˜æœåŠ¡ï¼ˆæ¶ˆè´¹è€…ï¼‰éœ€è¦å‘ç°è®¢å•æœåŠ¡çš„åœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableFeignClients&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»…ç”¨äºéœ€è¦è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ¶ˆè´¹è€…&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼šæ”¯ä»˜æœåŠ¡éœ€è¦è°ƒç”¨è®¢å•æœåŠ¡çš„ API æ—¶ï¼Œéœ€åœ¨æ”¯ä»˜æœåŠ¡ä¸­å¯ç”¨æ­¤æ³¨è§£ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ¶ˆè´¹è€…ä½¿ç”¨ç¡¬ç¼–ç  URL è°ƒç”¨æœåŠ¡ï¼Œåˆ™æ— éœ€æ­¤æ³¨è§£ï¼Œä½†ä¼šå¤±å»åŠ¨æ€å‘ç°å’Œè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æœºåˆ¶"&gt;&lt;strong&gt;å®ç°æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;@Import(DiscoveryClientImportSelector.class)&lt;/code&gt; å¯¼å…¥é…ç½®ç±»ï¼Œæ ¹æ®æ³¨å†Œä¸­å¿ƒç±»å‹ï¼ˆå¦‚ Eurekaã€Consulï¼‰è‡ªåŠ¨åˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒä¾èµ–ï¼š&lt;code&gt;spring-cloud-starter-kubernetes&lt;/code&gt;ï¼ˆK8Sï¼‰æˆ– &lt;code&gt;spring-cloud-starter-netflix-eureka-client&lt;/code&gt;ï¼ˆEurekaï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableFeignClients&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;@Import(FeignClientsRegistrar.class)&lt;/code&gt; æ‰«æ &lt;code&gt;@FeignClient&lt;/code&gt; æ¥å£ï¼Œç”ŸæˆåŠ¨æ€ä»£ç†ç±»å¹¶æ³¨å…¥ Spring ä¸Šä¸‹æ–‡ã€‚&lt;/li&gt;
&lt;li&gt;åº•å±‚ä¾èµ– Feign åº“å’Œ HTTP å®¢æˆ·ç«¯ï¼ˆå¦‚ OpenFeignã€OkHttpï¼‰ï¼Œé»˜è®¤é›†æˆ Ribbon å®ç°è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹ä»£ç ç¤ºä¾‹"&gt;&lt;strong&gt;å…¸å‹ä»£ç ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æœåŠ¡æä¾›è€…ï¼ˆéœ€æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableDiscoveryClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ç”¨æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ProviderApplication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æœåŠ¡æ¶ˆè´¹è€…ï¼ˆéœ€è°ƒç”¨å…¶ä»–æœåŠ¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableDiscoveryClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ç”¨æœåŠ¡å‘ç°ï¼ˆå‘ç°å…¶ä»–æœåŠ¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableFeignClients&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ç”¨ Feign å®¢æˆ·ç«¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ConsumerApplication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Feign å®¢æˆ·ç«¯æ¥å£å®šä¹‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;provider-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;ProviderClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/api/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="ä¾èµ–ä¸é…ç½®"&gt;&lt;strong&gt;ä¾èµ–ä¸é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€å¼•å…¥æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ä¾èµ–ï¼Œå¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;&amp;lt;!-- Eureka --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-netflix-eureka-client&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®æ³¨å†Œä¸­å¿ƒåœ°å€ï¼ˆå¦‚ &lt;code&gt;eureka.client.service-url.defaultZone&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@EnableFeignClients&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€å¼•å…¥ Feign ä¾èµ–ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-openfeign&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;å¯é…ç½®è¶…æ—¶ã€é‡è¯•ã€æ‹¦æˆªå™¨ç­‰ï¼ˆé€šè¿‡ &lt;code&gt;@FeignClient&lt;/code&gt; çš„ &lt;code&gt;configuration&lt;/code&gt; å±æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="6-æ˜¯å¦éœ€è¦åŒæ—¶ä½¿ç”¨"&gt;&lt;strong&gt;6. æ˜¯å¦éœ€è¦åŒæ—¶ä½¿ç”¨ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦&lt;/strong&gt;ï¼šåœ¨æ¶ˆè´¹è€…æœåŠ¡ä¸­ï¼Œé€šå¸¸éœ€åŒæ—¶å¯ç”¨ä¸¤è€…ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt; ç”¨äºå‘ç°ç›®æ ‡æœåŠ¡å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@EnableFeignClients&lt;/code&gt; ç”¨äºç”Ÿæˆè°ƒç”¨ç›®æ ‡æœåŠ¡çš„å®¢æˆ·ç«¯æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾‹å¤–æƒ…å†µ&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨ç¡¬ç¼–ç  URLï¼ˆéæœåŠ¡åï¼‰è°ƒç”¨æœåŠ¡ï¼Œå¯çœç•¥ &lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;ï¼Œä½†ä¼šå¤±å»æœåŠ¡å‘ç°çš„çµæ´»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-6"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–ç»„ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@EnableDiscoveryClient&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰å¾®æœåŠ¡&lt;/td&gt;
&lt;td&gt;Eurekaã€Consulã€Nacos ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@EnableFeignClients&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜å¼ HTTP æœåŠ¡è°ƒç”¨&lt;/td&gt;
&lt;td&gt;æœåŠ¡æ¶ˆè´¹è€…&lt;/td&gt;
&lt;td&gt;Feignã€Ribbon/LoadBalancer&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸¤è€…åœ¨å¾®æœåŠ¡æ¶æ„ä¸­&lt;strong&gt;äº’è¡¥&lt;/strong&gt;ï¼šæœåŠ¡å‘ç°æ˜¯åŸºç¡€ï¼ŒFeign æ˜¯ä¸Šå±‚è°ƒç”¨å·¥å…·ã€‚åˆç†ä½¿ç”¨å¯æ˜¾è‘—ç®€åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;h2 id="openfeign"&gt;OpenFeign
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä½¿ç”¨ OpenFeign å®ç°æœåŠ¡é—´è°ƒç”¨æ—¶ï¼Œ&lt;strong&gt;@FeignClient åº”å®šä¹‰åœ¨è°ƒç”¨æ–¹ï¼ˆæ¶ˆè´¹è€…ï¼‰çš„ä»£ç ä¸­&lt;/strong&gt;ã€‚å…·ä½“åˆ°ä½ çš„åœºæ™¯ï¼Œè‹¥ &lt;code&gt;space-service&lt;/code&gt; éœ€è¦è°ƒç”¨ &lt;code&gt;user-service&lt;/code&gt;ï¼Œåˆ™ &lt;code&gt;@FeignClient(name = &amp;quot;user-service&amp;quot;)&lt;/code&gt; æ¥å£åº”å®šä¹‰åœ¨ &lt;code&gt;space-service&lt;/code&gt; é¡¹ç›®ä¸­ï¼Œè€Œé &lt;code&gt;user-service&lt;/code&gt; å†…éƒ¨ã€‚ä»¥ä¸‹æ˜¯å…·ä½“ç”¨æ³•å’ŒåŸå› åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å®šä¹‰ä½ç½®ä¸èŒè´£åˆ†ç¦»"&gt;&lt;strong&gt;å®šä¹‰ä½ç½®ä¸èŒè´£åˆ†ç¦»&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒç”¨æ–¹å®šä¹‰æ¥å£&lt;/strong&gt;ï¼š&lt;br&gt;
OpenFeign çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œå£°æ˜å¼è°ƒç”¨â€ï¼Œå³è°ƒç”¨æ–¹é€šè¿‡å®šä¹‰æ¥å£æè¿°ç›®æ ‡æœåŠ¡çš„ APIã€‚å› æ­¤ï¼Œ&lt;code&gt;space-service&lt;/code&gt; éœ€è¦æ ¹æ® &lt;code&gt;user-service&lt;/code&gt; çš„ REST API å®šä¹‰ä¸€ä¸ª Feign å®¢æˆ·ç«¯æ¥å£ï¼Œå¹¶æ ‡æ³¨ &lt;code&gt;@FeignClient(name = &amp;quot;user-service&amp;quot;)&lt;/code&gt;ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼Œåœ¨ &lt;code&gt;space-service&lt;/code&gt; ä¸­å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserServiceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/users/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸€æ¥å£éœ€ä¸ &lt;code&gt;user-service&lt;/code&gt; çš„ API è·¯å¾„ã€å‚æ•°ã€è¿”å›å€¼å®Œå…¨åŒ¹é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡æä¾›æ–¹æ— éœ€å¹²é¢„&lt;/strong&gt;ï¼š&lt;br&gt;
&lt;code&gt;user-service&lt;/code&gt; åªéœ€æ­£å¸¸æš´éœ² REST APIï¼Œæ— éœ€å®šä¹‰ Feign ç›¸å…³ä»£ç ã€‚Feign å®¢æˆ·ç«¯æ˜¯è°ƒç”¨æ–¹çš„èŒè´£ï¼Œä¸æœåŠ¡æä¾›æ–¹è§£è€¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æµç¨‹"&gt;&lt;strong&gt;å®ç°æµç¨‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ­¥éª¤-1åœ¨è°ƒç”¨æ–¹å¼•å…¥ä¾èµ–"&gt;æ­¥éª¤ 1ï¼šåœ¨è°ƒç”¨æ–¹å¼•å…¥ä¾èµ–
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;space-service&lt;/code&gt; çš„ &lt;code&gt;pom.xml&lt;/code&gt; ä¸­æ·»åŠ  OpenFeign ä¾èµ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-openfeign&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ­¥éª¤-2å¯ç”¨-feign-å®¢æˆ·ç«¯"&gt;æ­¥éª¤ 2ï¼šå¯ç”¨ Feign å®¢æˆ·ç«¯
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;space-service&lt;/code&gt; çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ  &lt;code&gt;@EnableFeignClients&lt;/code&gt; æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableFeignClients&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SpaceServiceApplication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpringApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SpaceServiceApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ­¥éª¤-3æ³¨å…¥å¹¶ä½¿ç”¨å®¢æˆ·ç«¯"&gt;æ­¥éª¤ 3ï¼šæ³¨å…¥å¹¶ä½¿ç”¨å®¢æˆ·ç«¯
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;space-service&lt;/code&gt; çš„ä¸šåŠ¡å±‚æˆ–æ§åˆ¶å™¨ä¸­æ³¨å…¥ &lt;code&gt;UserServiceClient&lt;/code&gt;ï¼Œç›´æ¥è°ƒç”¨å…¶æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SpaceController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserServiceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userServiceClient&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/space/{userId}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Space&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getSpaceByUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userServiceClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨ user-service è·å–ç”¨æˆ·ä¿¡æ¯åå¤„ç†ä¸šåŠ¡é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createSpace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒé…ç½®ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;æ ¸å¿ƒé…ç½®ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡ä¸è¶…æ—¶é…ç½®&lt;/strong&gt;ï¼š&lt;br&gt;
OpenFeign é»˜è®¤é›†æˆ Ribbon æˆ– Spring Cloud LoadBalancerï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚ &lt;code&gt;application.yml&lt;/code&gt;ï¼‰è®¾ç½®è¶…æ—¶å’Œé‡è¯•ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;feign&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;default&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;connectTimeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5000&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;readTimeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5000&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;ribbon&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;MaxAutoRetries&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—ä¸æ‹¦æˆªå™¨&lt;/strong&gt;ï¼š&lt;br&gt;
å¯é€šè¿‡è‡ªå®šä¹‰é…ç½®ç±»å¯ç”¨è¯¦ç»†æ—¥å¿—æˆ–æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆå¦‚ä¼ é€’è®¤è¯ä¿¡æ¯ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;FeignConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Logger&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;feignLoggerLevel&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Logger&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Level&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç†”æ–­ä¸é™çº§&lt;/strong&gt;ï¼š&lt;br&gt;
ç»“åˆ Hystrix æˆ– Sentinel å®šä¹‰é™çº§é€»è¾‘ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fallback&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserServiceFallback&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserServiceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* ... */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserServiceFallback&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserServiceClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;fallback-user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ºä½•ä¸åœ¨æœåŠ¡æä¾›æ–¹å®šä¹‰-feign-å®¢æˆ·ç«¯"&gt;&lt;strong&gt;ä¸ºä½•ä¸åœ¨æœåŠ¡æä¾›æ–¹å®šä¹‰ Feign å®¢æˆ·ç«¯ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èŒè´£æ··ä¹±&lt;/strong&gt;ï¼šè‹¥åœ¨ &lt;code&gt;user-service&lt;/code&gt; ä¸­å®šä¹‰ Feign å®¢æˆ·ç«¯ï¼Œä¼šå¯¼è‡´æœåŠ¡æä¾›æ–¹åŒæ—¶æ‰¿æ‹…â€œæš´éœ² APIâ€å’Œâ€œå®šä¹‰è°ƒç”¨æ–¹æ¥å£â€çš„åŒé‡èŒè´£ï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»´æŠ¤å›°éš¾&lt;/strong&gt;ï¼šæœåŠ¡æä¾›æ–¹çš„ API å˜æ›´å¯èƒ½ç›´æ¥å½±å“æ‰€æœ‰è°ƒç”¨æ–¹ï¼Œéœ€åŒæ­¥ä¿®æ”¹ Feign æ¥å£ï¼Œå¢åŠ è€¦åˆåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•å®šåˆ¶åŒ–&lt;/strong&gt;ï¼šè°ƒç”¨æ–¹å¯èƒ½éœ€è¦å¯¹ Feign å®¢æˆ·ç«¯è¿›è¡Œä¸ªæ€§åŒ–é…ç½®ï¼ˆå¦‚è¶…æ—¶ã€é‡è¯•ã€é™çº§ï¼‰ï¼Œè‹¥æ¥å£å®šä¹‰åœ¨æä¾›æ–¹ï¼Œè¿™äº›é…ç½®å°†éš¾ä»¥å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µæ€»ç»“"&gt;&lt;strong&gt;æœ€ä½³å®è·µæ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨æ–¹å®šä¹‰æ¥å£&lt;/strong&gt;ï¼šFeign å®¢æˆ·ç«¯å±äºè°ƒç”¨æ–¹çš„æŠ€æœ¯é€‰å‹ï¼Œåº”ç”±è°ƒç”¨æ–¹æ ¹æ®å®é™…éœ€æ±‚å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¥å£ä¸å®ç°è§£è€¦&lt;/strong&gt;ï¼šæœåŠ¡æä¾›æ–¹ä»…éœ€ç»´æŠ¤ REST APIï¼Œæ— éœ€å…³å¿ƒè°ƒç”¨æ–¹ä½¿ç”¨çš„ HTTP å®¢æˆ·ç«¯ç±»å‹ï¼ˆFeignã€RestTemplate ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€ä¾èµ–ç®¡ç†&lt;/strong&gt;ï¼šè‹¥å¤šä¸ªæœåŠ¡éœ€è°ƒç”¨åŒä¸€æä¾›æ–¹ï¼Œå¯å°† Feign æ¥å£æŠ½ç¦»ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œä¾›å„è°ƒç”¨æ–¹å¼•ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œ&lt;code&gt;space-service&lt;/code&gt; å¯ä»¥é«˜æ•ˆã€çµæ´»åœ°è°ƒç”¨ &lt;code&gt;user-service&lt;/code&gt;ï¼ŒåŒæ—¶ä¿æŒå¾®æœåŠ¡æ¶æ„çš„æ¸…æ™°è¾¹ç•Œã€‚&lt;/p&gt;
&lt;h2 id="provider"&gt;Provider
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡æä¾›æ–¹çš„æ ¸å¿ƒèŒè´£æ˜¯é€šè¿‡ &lt;strong&gt;&lt;code&gt;@RestController&lt;/code&gt;&lt;/strong&gt; æš´éœ² RESTful æ¥å£ä¾›æ¶ˆè´¹è€…è°ƒç”¨ï¼Œä½†ä»…é  &lt;strong&gt;&lt;code&gt;@RestController&lt;/code&gt;&lt;/strong&gt; å®šä¹‰æ¥å£å¹¶ä¸èƒ½è¦†ç›–æ‰€æœ‰åœºæ™¯ï¼Œè¿˜éœ€ç»“åˆå…¶ä»–è®¾è®¡åŸåˆ™å’Œå®ç°ç»†èŠ‚ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æœåŠ¡æä¾›æ–¹çš„åŸºæœ¬è¦æ±‚"&gt;&lt;strong&gt;æœåŠ¡æä¾›æ–¹çš„åŸºæœ¬è¦æ±‚&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒèŒè´£&lt;/strong&gt;ï¼š&lt;br&gt;
æœåŠ¡æä¾›æ–¹çš„ä¸»è¦ä»»åŠ¡æ˜¯&lt;strong&gt;é€šè¿‡ &lt;code&gt;@RestController&lt;/code&gt; å®šä¹‰å¹¶å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ¥å£&lt;/strong&gt;ï¼Œä¾‹å¦‚ç”¨æˆ·ç®¡ç†ã€è®¢å•å¤„ç†ç­‰ã€‚è¿™äº›æ¥å£éœ€ç¬¦åˆ RESTful è®¾è®¡è§„èŒƒï¼ˆå¦‚ HTTP æ–¹æ³•è¯­ä¹‰åŒ–ã€URI èµ„æºåŒ–ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼ˆç”¨æˆ·æœåŠ¡æ¥å£ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RequestMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/users&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ— éœ€å…³æ³¨è°ƒç”¨æ–¹æŠ€æœ¯é€‰å‹&lt;/strong&gt;ï¼š&lt;br&gt;
æœåŠ¡æä¾›æ–¹&lt;strong&gt;ä¸éœ€è¦å®šä¹‰ Feign å®¢æˆ·ç«¯&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@FeignClient&lt;/code&gt;ï¼‰ï¼Œè¿™æ˜¯æ¶ˆè´¹è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰çš„èŒè´£ã€‚æä¾›æ–¹åªéœ€ç¡®ä¿æ¥å£çš„å¯ç”¨æ€§å’Œæ­£ç¡®æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ¥å£è®¾è®¡çš„æ‰©å±•éœ€æ±‚"&gt;&lt;strong&gt;æ¥å£è®¾è®¡çš„æ‰©å±•éœ€æ±‚&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é™¤äº†åŸºæœ¬æ¥å£å®ç°ï¼ŒæœåŠ¡æä¾›æ–¹è¿˜éœ€å…³æ³¨ä»¥ä¸‹æ–¹é¢ä»¥æå‡æ¥å£çš„å¥å£®æ€§å’Œå…¼å®¹æ€§ï¼š&lt;/p&gt;
&lt;h4 id="1-ç‰ˆæœ¬æ§åˆ¶"&gt;(1) &lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“æ¥å£éœ€è¦å‡çº§æ—¶ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@ApiVersion&lt;/code&gt;ï¼‰å®ç°å¤šç‰ˆæœ¬ APIï¼Œé¿å…å½±å“æ—§å®¢æˆ·ç«¯ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@ApiVersion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;v1&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;User v1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@ApiVersion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;v2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;v2&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;User v2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="2-å¼‚å¸¸å¤„ç†"&gt;(2) &lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;@ExceptionHandler&lt;/code&gt; ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼Œè¿”å›æ ‡å‡†åŒ–çš„é”™è¯¯å“åº”ï¼ˆå¦‚ HTTP çŠ¶æ€ç ã€é”™è¯¯ä¿¡æ¯ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ExceptionHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UserNotFoundException&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleUserNotFound&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UserNotFoundException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;NOT_FOUND&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMessage&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="3-æ•°æ®æ ¡éªŒä¸å®‰å…¨"&gt;(3) &lt;strong&gt;æ•°æ®æ ¡éªŒä¸å®‰å…¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@Valid&lt;/code&gt; æ ¡éªŒè¯·æ±‚å‚æ•°åˆæ³•æ€§ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ Spring Security æˆ– OAuth2 å®ç°æ¥å£é‰´æƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸æ¶ˆè´¹è€…äº¤äº’çš„å…³é”®åŸåˆ™"&gt;&lt;strong&gt;ä¸æ¶ˆè´¹è€…äº¤äº’çš„å…³é”®åŸåˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¾è€¦åˆè®¾è®¡&lt;/strong&gt;ï¼š&lt;br&gt;
æä¾›æ–¹å’Œæ¶ˆè´¹è€…åº”é€šè¿‡&lt;strong&gt;æ˜ç¡®å®šä¹‰çš„ API å¥‘çº¦&lt;/strong&gt;ï¼ˆå¦‚ OpenAPI/Swagger æ–‡æ¡£ï¼‰äº¤äº’ï¼Œè€Œéä¾èµ–å†…éƒ¨å®ç°ç»†èŠ‚ã€‚æ¶ˆè´¹è€…åªéœ€å…³æ³¨æ¥å£çš„è¾“å…¥è¾“å‡ºï¼Œæ— éœ€çŸ¥æ™“æä¾›æ–¹çš„æŠ€æœ¯ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šä¿¡æ–¹å¼é€‰æ‹©&lt;/strong&gt;ï¼š&lt;br&gt;
æä¾›æ–¹éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ”¯æŒå¤šç§é€šä¿¡æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥è°ƒç”¨&lt;/strong&gt;ï¼šå¦‚ HTTP/RESTï¼ˆé»˜è®¤ï¼‰ã€gRPCã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥è°ƒç”¨&lt;/strong&gt;ï¼šå¦‚æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æœåŠ¡æä¾›æ–¹çš„è¾¹ç•Œä¸æ‰©å±•"&gt;&lt;strong&gt;æœåŠ¡æä¾›æ–¹çš„è¾¹ç•Œä¸æ‰©å±•&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•ä¸€èŒè´£åŸåˆ™&lt;/strong&gt;ï¼š&lt;br&gt;
æœåŠ¡æä¾›æ–¹åº”èšç„¦äºè‡ªèº«ä¸šåŠ¡é¢†åŸŸï¼ˆå¦‚ç”¨æˆ·ç®¡ç†ï¼‰ï¼Œé¿å…æ‰¿æ‹…æ¶ˆè´¹è€…é€»è¾‘ï¼ˆå¦‚è®¢å•å¤„ç†ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;ï¼š&lt;br&gt;
å½“ä¸šåŠ¡å¤æ‚æ—¶ï¼Œå¯é€šè¿‡&lt;strong&gt;æ‹†åˆ†å¾®æœåŠ¡&lt;/strong&gt;æˆ–&lt;strong&gt;å¼•å…¥ç½‘å…³&lt;/strong&gt;ï¼ˆå¦‚ Spring Cloud Gatewayï¼‰è¿›ä¸€æ­¥è§£è€¦æ¥å£æš´éœ²ä¸è·¯ç”±é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-7"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æœåŠ¡æä¾›æ–¹çš„æ ¸å¿ƒä»»åŠ¡æ˜¯é€šè¿‡ &lt;strong&gt;&lt;code&gt;@RestController&lt;/code&gt;&lt;/strong&gt; å®ç°è§„èŒƒçš„ RESTful æ¥å£ï¼Œä½†éœ€é¢å¤–å…³æ³¨&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶ã€å¼‚å¸¸å¤„ç†ã€æ•°æ®æ ¡éªŒå’Œå®‰å…¨æ€§&lt;/strong&gt;ç­‰è®¾è®¡ç»†èŠ‚ã€‚æ¶ˆè´¹è€…é€šè¿‡ Feign æˆ– RestTemplate è°ƒç”¨è¿™äº›æ¥å£æ—¶ï¼Œæä¾›æ–¹æ— éœ€å¹²é¢„è°ƒç”¨æ–¹çš„æŠ€æœ¯å®ç°ã€‚è¿™ç§èŒè´£åˆ†ç¦»ç¡®ä¿äº†å¾®æœåŠ¡æ¶æ„çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;h2 id="ç½‘å…³"&gt;ç½‘å…³
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç¡®ä¿å¤–ç•Œåªèƒ½é€šè¿‡ç½‘å…³è®¿é—®å¾®æœåŠ¡ï¼Œè€Œæ— æ³•ç›´æ¥è®¿é—®å…¶ä»–å¾®æœåŠ¡ï¼Œéœ€è¦ç»“åˆç½‘ç»œéš”ç¦»ã€å®‰å…¨ç­–ç•¥å’ŒæŠ€æœ¯å®ç°ç­‰å¤šæ–¹é¢æªæ–½ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç½‘ç»œå±‚éš”ç¦»"&gt;&lt;strong&gt;ç½‘ç»œå±‚éš”ç¦»&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…ç½‘éƒ¨ç½²å¾®æœåŠ¡&lt;/strong&gt;&lt;br&gt;
å°†å¾®æœåŠ¡éƒ¨ç½²åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä»…ç½‘å…³å¯¹å¤–æš´éœ²å…¬ç½‘IPæˆ–åŸŸåã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡äº‘å¹³å°VPCï¼ˆè™šæ‹Ÿç§æœ‰äº‘ï¼‰åˆ’åˆ†å†…ç½‘åŒºåŸŸï¼Œå¾®æœåŠ¡ä»…å¼€æ”¾å†…ç½‘ç«¯å£ï¼Œç½‘å…³éƒ¨ç½²åœ¨DMZï¼ˆéš”ç¦»åŒºï¼‰æˆ–è¾¹ç¼˜ç½‘ç»œå±‚ï¼Œé€šè¿‡å†…ç½‘ä¸å¾®æœåŠ¡é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é˜²ç«å¢™è§„åˆ™é™åˆ¶å¤–éƒ¨IPç›´æ¥è®¿é—®å¾®æœåŠ¡ç«¯å£ï¼Œä»…å…è®¸ç½‘å…³çš„IPæˆ–å†…ç½‘åœ°å€è®¿é—®å¾®æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨ç»„ä¸ç«¯å£æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨äº‘æœåŠ¡å™¨æˆ–å®¹å™¨ç¯å¢ƒä¸­ï¼Œé€šè¿‡å®‰å…¨ç»„é…ç½®ä»…å…è®¸ç½‘å…³æ‰€åœ¨æœåŠ¡å™¨çš„IPè®¿é—®å¾®æœåŠ¡çš„ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šå¾®æœåŠ¡ä»…ç›‘å¬å†…ç½‘IPï¼ˆå¦‚&lt;code&gt;192.168.0.2:8080&lt;/code&gt;ï¼‰ï¼Œè€Œç½‘å…³é€šè¿‡å…¬ç½‘IPï¼ˆå¦‚&lt;code&gt;192.168.0.1:8080&lt;/code&gt;ï¼‰æ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼Œå¹¶é€šè¿‡å†…ç½‘è½¬å‘åˆ°å¾®æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç½‘å…³ä½œä¸ºç»Ÿä¸€å…¥å£"&gt;&lt;strong&gt;ç½‘å…³ä½œä¸ºç»Ÿä¸€å…¥å£&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¯ç”±ä¸åè®®ä»£ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘å…³é€šè¿‡åŠ¨æ€è·¯ç”±è§„åˆ™ï¼ˆå¦‚åŸºäºURLè·¯å¾„ã€è¯·æ±‚å¤´ï¼‰å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„å¾®æœåŠ¡ï¼ŒåŒæ—¶éšè—å¾®æœåŠ¡çš„å®é™…åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šä½¿ç”¨Spring Cloud Gatewayæˆ–Kongç­‰å·¥å…·é…ç½®è·¯ç”±è§„åˆ™ï¼Œå¯¹å¤–æš´éœ²ç»Ÿä¸€APIè·¯å¾„ï¼ˆå¦‚&lt;code&gt;/api/order&lt;/code&gt;ï¼‰ï¼Œå†…éƒ¨æ˜ å°„åˆ°è®¢å•æœåŠ¡çš„&lt;code&gt;/order&lt;/code&gt;æ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¾®æœåŠ¡é€šè¿‡æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚Eurekaã€Consulï¼‰æ³¨å†Œå†…ç½‘åœ°å€ï¼Œç½‘å…³åŠ¨æ€è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨å¹¶è´Ÿè½½å‡è¡¡ï¼Œé¿å…å¤–éƒ¨ç›´æ¥è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è¯·æ±‚æ ¡éªŒä¸å®‰å…¨æœºåˆ¶"&gt;&lt;strong&gt;è¯·æ±‚æ ¡éªŒä¸å®‰å…¨æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚å¤´æ ‡è¯†æ ¡éªŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ç½‘å…³è½¬å‘è¯·æ±‚æ—¶æ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼ˆå¦‚&lt;code&gt;systemFrom: gateway&lt;/code&gt;ï¼‰ï¼Œå¾®æœåŠ¡é€šè¿‡æ‹¦æˆªå™¨æ ¡éªŒè¯¥å¤´ä¿¡æ¯ï¼Œéç½‘å…³æ¥æºçš„è¯·æ±‚ç›´æ¥æ‹’ç»ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç ç¤ºä¾‹ï¼ˆSpring Cloud Gatewayï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç½‘å…³æ·»åŠ è¯·æ±‚å¤´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;systemFrom&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;gateway&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// å¾®æœåŠ¡æ‹¦æˆªæ ¡éªŒ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;gateway&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;systemFrom&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ‹’ç»è®¿é—®&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èº«ä»½è®¤è¯ä¸æˆæƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘å…³ç»Ÿä¸€å¤„ç†è®¤è¯ï¼ˆå¦‚JWTã€OAuth2ï¼‰ï¼Œå¾®æœåŠ¡ä»…ä¿¡ä»»ç½‘å…³ä¼ é€’çš„ä»¤ç‰Œä¿¡æ¯ï¼Œé¿å…å¤–éƒ¨ç›´æ¥ç»•è¿‡è®¤è¯ã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆRBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰æˆ–ABACï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰ï¼Œåœ¨ç½‘å…³å±‚è¿‡æ»¤éæ³•è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŸºç¡€è®¾æ–½åŠ å›º"&gt;&lt;strong&gt;åŸºç¡€è®¾æ–½åŠ å›º&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;APIç½‘å…³é›†ç¾¤ä¸è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éƒ¨ç½²å¤šä¸ªç½‘å…³å®ä¾‹å¹¶é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚Nginxï¼‰å¯¹å¤–æš´éœ²ï¼Œé¿å…å•ç‚¹æ•…éšœï¼ŒåŒæ—¶é›†ä¸­ç®¡ç†æµé‡å…¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—ä¸ç›‘æ§å‘Šè­¦&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ç½‘å…³å±‚è®°å½•æ‰€æœ‰è¯·æ±‚æ—¥å¿—ï¼Œç›‘æ§å¼‚å¸¸IPæˆ–é«˜é¢‘è®¿é—®è¡Œä¸ºï¼ŒåŠæ—¶å°ç¦éæ³•æ¥æºã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Prometheusã€Grafanaç­‰å·¥å…·å®æ—¶ç›‘æ§å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œå‘ç°éç½‘å…³è·¯å¾„çš„è®¿é—®æ—¶è§¦å‘å‘Šè­¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="äº‘åŸç”Ÿæ–¹æ¡ˆ"&gt;&lt;strong&gt;äº‘åŸç”Ÿæ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡Istioç­‰å·¥å…·å®ç°æœåŠ¡é—´é€šä¿¡çš„è‡ªåŠ¨åŠ å¯†å’Œé‰´æƒï¼Œä»…å…è®¸ç½‘å…³é€šè¿‡Sidecarä»£ç†è®¿é—®å…¶ä»–æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Kubernetesç½‘ç»œç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨K8sçš„NetworkPolicyé™åˆ¶Podé—´é€šä¿¡ï¼Œä»…å…è®¸ç½‘å…³Podè®¿é—®å¾®æœåŠ¡Podï¼Œå…¶ä»–å¤–éƒ¨æµé‡é»˜è®¤æ‹’ç»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-8"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ä»¥ä¸Šæªæ–½ï¼Œå¯ä»¥å®ç°å¾®æœåŠ¡æ¶æ„çš„â€œç½‘å…³å”¯ä¸€å…¥å£â€ç›®æ ‡ã€‚æ ¸å¿ƒæ€è·¯åŒ…æ‹¬ï¼š&lt;strong&gt;ç½‘ç»œéš”ç¦»éšè—å¾®æœåŠ¡&lt;/strong&gt;ã€&lt;strong&gt;ç½‘å…³ç»Ÿä¸€ä»£ç†ä¸æ ¡éªŒ&lt;/strong&gt;ã€&lt;strong&gt;åŸºç¡€è®¾æ–½å®‰å…¨åŠ å›º&lt;/strong&gt;ã€‚å®é™…éƒ¨ç½²æ—¶ï¼Œéœ€æ ¹æ®å…·ä½“æŠ€æœ¯æ ˆï¼ˆå¦‚Spring Cloudã€Kubernetesï¼‰é€‰æ‹©é€‚é…æ–¹æ¡ˆï¼Œå¹¶ç»“åˆç›‘æ§æŒç»­ä¼˜åŒ–å®‰å…¨ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id="nacos-è‡ªåŠ¨é…ç½®"&gt;nacos è‡ªåŠ¨é…ç½®
&lt;/h2&gt;&lt;p&gt;åœ¨Nacosè‡ªåŠ¨é…ç½®ä¸­ï¼Œé™¤äº†ä½¿ç”¨&lt;code&gt;@Value&lt;/code&gt;æ³¨è§£è·å–é…ç½®å€¼å¤–ï¼Œè¿˜éœ€è¦ç»“åˆä»¥ä¸‹å…³é”®æ³¨è§£æ¥å®ç°å®Œæ•´çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼š&lt;/p&gt;
&lt;h3 id="refreshscopeåŠ¨æ€é…ç½®åˆ·æ–°"&gt;&lt;strong&gt;@RefreshScopeï¼ˆåŠ¨æ€é…ç½®åˆ·æ–°ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ ‡è®°éœ€è¦åŠ¨æ€åˆ·æ–°é…ç½®çš„Spring Beanï¼Œå½“Nacosä¸­çš„é…ç½®å˜æ›´æ—¶ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯ä½¿&lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥çš„å±æ€§å€¼æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåœ¨ç±»ä¸Šæ·»åŠ æ­¤æ³¨è§£åï¼Œè¯¥Beanä¸­æ‰€æœ‰é€šè¿‡&lt;code&gt;@Value&lt;/code&gt;æ³¨å…¥çš„é…ç½®é¡¹ä¼šè‡ªåŠ¨æ„ŸçŸ¥Nacosé…ç½®å˜æ›´ã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RefreshScope&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ConfigController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;${custom.property}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;customProperty&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šé…ç½®æ›´æ–°æ—¶ä¼šé”€æ¯å¹¶é‡å»ºBeanï¼Œéœ€æ³¨æ„çº¿ç¨‹å®‰å…¨å’Œèµ„æºé‡Šæ”¾é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="nacosconfigç²¾å‡†é…ç½®æ³¨å…¥"&gt;&lt;strong&gt;@NacosConfigï¼ˆç²¾å‡†é…ç½®æ³¨å…¥ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç›´æ¥æŒ‡å®šNacosé…ç½®æ–‡ä»¶çš„&lt;code&gt;dataId&lt;/code&gt;å’Œ&lt;code&gt;group&lt;/code&gt;ï¼Œå°†é…ç½®å†…å®¹æ³¨å…¥å­—æ®µæˆ–å¯¹è±¡ï¼Œæ”¯æŒåŸºç¡€ç±»å‹ã€é›†åˆã€è‡ªå®šä¹‰JavaBeanç­‰å¤šç§æ•°æ®ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ— éœ€ä¾èµ–&lt;code&gt;@RefreshScope&lt;/code&gt;å³å¯å®ç°åŠ¨æ€æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒé€šè¿‡&lt;code&gt;key&lt;/code&gt;å±æ€§ç²¾å‡†è·å–é…ç½®é¡¹ï¼ˆé€‚ç”¨äºYAML/Propertiesæ ¼å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@NacosConfig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SampleApp.properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;useCache&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;useCache&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="nacosconfiglisteneré…ç½®å˜æ›´ç›‘å¬"&gt;&lt;strong&gt;@NacosConfigListenerï¼ˆé…ç½®å˜æ›´ç›‘å¬ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç›‘å¬æŒ‡å®šNacosé…ç½®æ–‡ä»¶çš„å˜æ›´ï¼Œä»¥æ–¹æ³•å‚æ•°å½¢å¼æ¥æ”¶æœ€æ–°é…ç½®å†…å®¹ï¼Œæ”¯æŒè‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ConfigChangeHandler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@NacosConfigListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;application.yaml&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onConfigChange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newConfig&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†é…ç½®å˜æ›´é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="configurationpropertiesæ‰¹é‡ç»‘å®šé…ç½®"&gt;&lt;strong&gt;@ConfigurationPropertiesï¼ˆæ‰¹é‡ç»‘å®šé…ç½®ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå°†Nacosä¸­çš„é…ç½®æ‰¹é‡ç»‘å®šåˆ°Javaå¯¹è±¡çš„å­—æ®µï¼Œé€šå¸¸ä¸&lt;code&gt;@RefreshScope&lt;/code&gt;é…åˆä½¿ç”¨å®ç°åŠ¨æ€æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@ConfigurationProperties&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;database&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RefreshScope&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DatabaseConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Getter/Setterçœç•¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å¯¹æ¯”-1"&gt;&lt;strong&gt;æ€»ç»“å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ³¨è§£&lt;/th&gt;
&lt;th&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/th&gt;
&lt;th&gt;åŠ¨æ€åˆ·æ–°æ”¯æŒ&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@Value&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ³¨å…¥å•ä¸ªé…ç½®é¡¹&lt;/td&gt;
&lt;td&gt;éœ€é…åˆ&lt;code&gt;@RefreshScope&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç®€å•é…ç½®é¡¹æ³¨å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@RefreshScope&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¯ç”¨é…ç½®åŠ¨æ€åˆ·æ–°&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;éœ€é¢‘ç¹æ›´æ–°çš„é…ç½®é¡¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@NacosConfig&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç²¾å‡†æ³¨å…¥æŒ‡å®šé…ç½®&lt;/td&gt;
&lt;td&gt;åŸç”Ÿæ”¯æŒ&lt;/td&gt;
&lt;td&gt;éœ€è¦é¿å…å±æ€§æºå¹²æ‰°çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@NacosConfigListener&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç›‘å¬é…ç½®å˜æ›´å¹¶è‡ªå®šä¹‰é€»è¾‘&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;é…ç½®å˜æ›´åéœ€è§¦å‘ä¸šåŠ¡æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ConfigurationProperties&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ‰¹é‡ç»‘å®šé…ç½®åˆ°å¯¹è±¡&lt;/td&gt;
&lt;td&gt;éœ€é…åˆ&lt;code&gt;@RefreshScope&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç»“æ„åŒ–é…ç½®ç®¡ç†ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å‚æ•°ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®-2"&gt;&lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç®€å•åœºæ™¯ï¼šä¼˜å…ˆä½¿ç”¨&lt;code&gt;@Value + @RefreshScope&lt;/code&gt;ç»„åˆã€‚&lt;/li&gt;
&lt;li&gt;ç²¾å‡†æ§åˆ¶ï¼šéœ€è¦é¿å…å¤šé…ç½®æºå†²çªæ—¶ï¼Œæ”¹ç”¨&lt;code&gt;@NacosConfig&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¤æ‚ä¸šåŠ¡ï¼šç»“åˆ&lt;code&gt;@NacosConfigListener&lt;/code&gt;å®ç°é…ç½®å˜æ›´åçš„ä¸šåŠ¡è”åŠ¨ï¼ˆå¦‚ç†”æ–­ç­–ç•¥è°ƒæ•´ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ³¨è§£çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥æ›´çµæ´»ã€å®‰å…¨åœ°å®ç°Nacosé…ç½®çš„åŠ¨æ€ç®¡ç†å’Œä¸šåŠ¡é›†æˆã€‚&lt;/p&gt;
&lt;h2 id="ç½‘å…³æ˜¯å¦ä¾èµ–ç”¨æˆ·æœåŠ¡"&gt;ç½‘å…³æ˜¯å¦ä¾èµ–ç”¨æˆ·æœåŠ¡
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç½‘å…³æœåŠ¡æ˜¯å¦éœ€è¦ä¾èµ–ç”¨æˆ·æœåŠ¡ï¼ˆuser-serviceï¼‰éœ€æ ¹æ®å…·ä½“é‰´æƒé€»è¾‘çš„å¤æ‚åº¦æ¥å†³ç­–ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§å…¸å‹æ–¹æ¡ˆåŠé€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ— éœ€ä¾èµ–ç”¨æˆ·æœåŠ¡çš„åœºæ™¯æ¨èæ–¹æ¡ˆ"&gt;&lt;strong&gt;æ— éœ€ä¾èµ–ç”¨æˆ·æœåŠ¡çš„åœºæ™¯ï¼ˆæ¨èæ–¹æ¡ˆï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒé€»è¾‘&lt;/strong&gt;ï¼šç½‘å…³é€šè¿‡JWTè‡ªéªŒè¯å®Œæˆé‰´æƒï¼Œæ— éœ€è°ƒç”¨ç”¨æˆ·æœåŠ¡ã€‚&lt;br&gt;
&lt;strong&gt;æŠ€æœ¯å®ç°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;JWTè‡ªéªŒè¯&lt;/strong&gt;ï¼šç½‘å…³ç›´æ¥ä½¿ç”¨é¢„ç½®çš„å¯†é’¥è§£æTokenï¼Œæ ¡éªŒç­¾åã€æœ‰æ•ˆæœŸç­‰åŸºç¡€ä¿¡æ¯ï¼ˆå¦‚ç½‘é¡µ1å’Œç½‘é¡µ5çš„ç¤ºä¾‹ï¼‰ã€‚JWTçš„Payloadä¸­å·²åŒ…å«ç”¨æˆ·èº«ä»½ï¼ˆå¦‚&lt;code&gt;sub&lt;/code&gt;å­—æ®µï¼‰ã€è§’è‰²ç­‰å¿…è¦ä¿¡æ¯ï¼Œç½‘å…³å¯é€šè¿‡&lt;code&gt;Claims&lt;/code&gt;å¯¹è±¡ç›´æ¥æå–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒé™ä¼ é€’&lt;/strong&gt;ï¼šå°†ç”¨æˆ·è§’è‰²/æƒé™å†™å…¥Tokenï¼Œç½‘å…³é€šè¿‡è§£æåçš„Claimsåˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®å½“å‰è·¯ç”±ï¼ˆå¦‚ç½‘é¡µ4ä¸­é€šè¿‡Spring Securityçš„&lt;code&gt;ReactiveAuthorizationManager&lt;/code&gt;å®ç°ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™ä½è€¦åˆ&lt;/strong&gt;ï¼šç½‘å…³ä¸ç”¨æˆ·æœåŠ¡å®Œå…¨è§£è€¦ï¼Œç¬¦åˆå¾®æœåŠ¡è‡ªæ²»åŸåˆ™ï¼ˆç½‘é¡µ6æåˆ°çš„æƒé™è§£è€¦æ€æƒ³ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šé¿å…æ¯æ¬¡é‰´æƒéƒ½å‘èµ·RPCè°ƒç”¨ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼ˆç½‘é¡µ3ä¸­æ–¹æ³•ä¸€çš„é—®é¢˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="éœ€è¦ä¾èµ–ç”¨æˆ·æœåŠ¡çš„åœºæ™¯"&gt;&lt;strong&gt;éœ€è¦ä¾èµ–ç”¨æˆ·æœåŠ¡çš„åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒé€»è¾‘&lt;/strong&gt;ï¼šç½‘å…³éœ€æŸ¥è¯¢ç”¨æˆ·æœåŠ¡ä»¥è·å–åŠ¨æ€æƒé™æ•°æ®æˆ–ç”¨æˆ·çŠ¶æ€ã€‚&lt;br&gt;
&lt;strong&gt;æŠ€æœ¯å®ç°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æƒé™æ ¡éªŒ&lt;/strong&gt;ï¼šå½“æƒé™è§„åˆ™éœ€è¦å®æ—¶æ›´æ–°ä¸”æ— æ³•å®Œå…¨å†™å…¥Tokenæ—¶ï¼Œç½‘å…³éœ€è°ƒç”¨ç”¨æˆ·æœåŠ¡çš„APIæ¥å£éªŒè¯æƒé™ï¼ˆå¦‚ç½‘é¡µ3ä¸­æ–¹æ³•äºŒçš„æˆæƒè®¤è¯ä¸­å¿ƒæ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·çŠ¶æ€æ£€æŸ¥&lt;/strong&gt;ï¼šéªŒè¯Tokenæœ‰æ•ˆæ€§çš„åŒæ—¶ï¼Œéœ€æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨æˆ–é”å®šï¼ˆéœ€ç”¨æˆ·æœåŠ¡æä¾›çŠ¶æ€æŸ¥è¯¢æ¥å£ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ï¼šé«˜é¢‘è°ƒç”¨å¯èƒ½æˆä¸ºç³»ç»Ÿç“¶é¢ˆï¼Œéœ€é…åˆç¼“å­˜ï¼ˆå¦‚Redisï¼‰é™ä½æŸ¥è¯¢å‹åŠ›ï¼ˆç½‘é¡µ7æåˆ°çš„æµé‡æ§åˆ¶ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡é™çº§&lt;/strong&gt;ï¼šç”¨æˆ·æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œç½‘å…³éœ€æœ‰ç†”æ–­æœºåˆ¶ï¼ˆå¦‚è¿”å›é»˜è®¤æ‹’ç»æˆ–ç¼“å­˜æƒé™ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ¶æ„é€‰å‹å»ºè®®"&gt;&lt;strong&gt;æ¶æ„é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æƒé™è§„åˆ™é™æ€ã€åŸºäºè§’è‰²&lt;/td&gt;
&lt;td&gt;ç½‘å…³ç‹¬ç«‹é‰´æƒï¼ˆæ— éœ€ä¾èµ–ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­å°å‹ç³»ç»Ÿï¼Œæƒé™å˜æ›´é¢‘ç‡ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æƒé™åŠ¨æ€æ›´æ–°ã€éœ€ç»†ç²’åº¦æ§åˆ¶&lt;/td&gt;
&lt;td&gt;ä¾èµ–ç‹¬ç«‹é‰´æƒæœåŠ¡ï¼ˆéç”¨æˆ·æœåŠ¡ï¼‰&lt;/td&gt;
&lt;td&gt;å¤§å‹ç³»ç»Ÿï¼Œæƒé™ç­–ç•¥å¤æ‚ï¼ˆå‚è€ƒç½‘é¡µ3æ–¹æ³•äºŒï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éœ€å®æ—¶ç”¨æˆ·çŠ¶æ€æ ¡éªŒ&lt;/td&gt;
&lt;td&gt;ä¾èµ–ç”¨æˆ·æœåŠ¡æ¥å£&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çŠ¶æ€é¢‘ç¹å˜æ›´ï¼ˆå¦‚è´¦æˆ·å°ç¦ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ¨¡å¼&lt;/strong&gt;ï¼šåŸºç¡€æ ¡éªŒï¼ˆç­¾åã€æœ‰æ•ˆæœŸï¼‰ç”±ç½‘å…³å®Œæˆï¼ŒåŠ¨æ€æƒé™é€šè¿‡ç‹¬ç«‹é‰´æƒæœåŠ¡å®ç°ï¼ˆå¦‚ç½‘é¡µ4æ•´åˆSpring Securityä¸OAuth2çš„æ–¹æ¡ˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯†é’¥ç®¡ç†&lt;/strong&gt;ï¼šé€šè¿‡é…ç½®ä¸­å¿ƒåŠ¨æ€ä¸‹å‘JWTå¯†é’¥ï¼Œé¿å…ç¡¬ç¼–ç ï¼ˆç½‘é¡µ1ä¸­&lt;code&gt;@Value(&amp;quot;${jwt.secret}&amp;quot;)&lt;/code&gt;çš„ä¼˜åŒ–æ–¹å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡éš”ç¦»&lt;/strong&gt;ï¼šè‹¥å¿…é¡»è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼Œåº”é€šè¿‡Feignæˆ–OpenFeignå£°æ˜å¼æ¥å£å®ç°ï¼Œå¹¶è®¾ç½®è¶…æ—¶ä¸é‡è¯•ç­–ç•¥ï¼ˆç½‘é¡µ8ä¸­æœåŠ¡æ²»ç†å»ºè®®ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šåœ¨å¤§å¤šæ•°JWTé‰´æƒåœºæ™¯ä¸­ï¼Œç½‘å…³&lt;strong&gt;ä¸åº”ç›´æ¥ä¾èµ–ç”¨æˆ·æœåŠ¡&lt;/strong&gt;ï¼Œè€Œæ˜¯é€šè¿‡Tokenè‡ªéªŒè¯å®ç°æ— çŠ¶æ€é‰´æƒï¼Œä»…åœ¨éœ€è¦åŠ¨æ€æƒé™æˆ–å¤æ‚ä¸šåŠ¡è§„åˆ™æ—¶å¼•å…¥ç‹¬ç«‹çš„é‰´æƒæœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id="ç½‘å…³é›†æˆspring-security"&gt;ç½‘å…³é›†æˆSpring Security
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒSpring Cloud Gatewayæ˜¯å¦éœ€è¦é›†æˆSpring Securityï¼Œéœ€è¦æ ¹æ®&lt;strong&gt;å®‰å…¨éœ€æ±‚å¤æ‚åº¦&lt;/strong&gt;å’Œ&lt;strong&gt;ç³»ç»Ÿæ¶æ„è®¾è®¡&lt;/strong&gt;ç»¼åˆåˆ¤æ–­ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„å†³ç­–ä¾æ®åŠå®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="éœ€è¦é›†æˆspring-securityçš„åœºæ™¯"&gt;&lt;strong&gt;éœ€è¦é›†æˆSpring Securityçš„åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-ç»Ÿä¸€è®¤è¯ä¸æˆæƒéœ€æ±‚"&gt;&lt;strong&gt;1. ç»Ÿä¸€è®¤è¯ä¸æˆæƒéœ€æ±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“ç½‘å…³éœ€è¦é›†ä¸­å¤„ç†ä»¥ä¸‹å®‰å…¨é€»è¾‘æ—¶ï¼Œæ¨èé›†æˆSpring Securityï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€JWT/OAuth2è®¤è¯&lt;/strong&gt;ï¼šè§£æTokenå¹¶éªŒè¯ç­¾åã€æœ‰æ•ˆæœŸï¼ˆå¦‚ç½‘é¡µ1ä¸­é€šè¿‡&lt;code&gt;spring-security-oauth2-resource-server&lt;/code&gt;å®ç°ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æƒé™æ§åˆ¶&lt;/strong&gt;ï¼šåŸºäºè§’è‰²æˆ–æƒé™çš„è·¯ç”±æ‹¦æˆªï¼ˆå¦‚ç½‘é¡µ5ä¸­&lt;code&gt;hasRole(&amp;quot;ADMIN&amp;quot;)&lt;/code&gt;çš„é…ç½®ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨ä¸Šä¸‹æ–‡ä¼ é€’&lt;/strong&gt;ï¼šå°†ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚&lt;code&gt;sub&lt;/code&gt;ã€&lt;code&gt;roles&lt;/code&gt;ï¼‰é€šè¿‡è¯·æ±‚å¤´ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ä¸oauth2åè®®æ·±åº¦æ•´åˆ"&gt;&lt;strong&gt;2. ä¸OAuth2åè®®æ·±åº¦æ•´åˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥ç³»ç»Ÿé‡‡ç”¨OAuth2åè®®ï¼Œé›†æˆSpring Securityå¯å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»¤ç‰Œä¸­ç»§ï¼ˆToken Relayï¼‰&lt;/strong&gt;ï¼šè‡ªåŠ¨è½¬å‘JWTè‡³ä¸‹æ¸¸æœåŠ¡ï¼ˆé€šè¿‡&lt;code&gt;TokenRelay&lt;/code&gt;è¿‡æ»¤å™¨ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆæƒæœåŠ¡å™¨å¯¹æ¥&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;jwk-set-uri&lt;/code&gt;æˆ–&lt;code&gt;issuer-uri&lt;/code&gt;éªŒè¯Tokenåˆæ³•æ€§ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰&lt;/strong&gt;ï¼šç»“åˆ&lt;code&gt;spring-security-oauth2-client&lt;/code&gt;å®ç°è·¨æœåŠ¡èº«ä»½å…±äº«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-å¤æ‚å®‰å…¨ç­–ç•¥ç®¡ç†"&gt;&lt;strong&gt;3. å¤æ‚å®‰å…¨ç­–ç•¥ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“éœ€è¦ä»¥ä¸‹è¿›é˜¶å®‰å…¨æ§åˆ¶æ—¶ï¼Œå¿…é¡»ä¾èµ–Spring Securityï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IPç™½åå•&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;RemoteAddr&lt;/code&gt;è·¯ç”±æ–­è¨€é™åˆ¶è®¿é—®æ¥æºï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¡è®¡æ—¥å¿—&lt;/strong&gt;ï¼šè®°å½•ç”¨æˆ·è®¿é—®è¡Œä¸ºåˆ°SecurityContextï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CSRF/XSSé˜²æŠ¤&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;ServerHttpSecurity.csrf()&lt;/code&gt;ç­‰é…ç½®é˜²å¾¡æ”»å‡»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ— éœ€é›†æˆspring-securityçš„åœºæ™¯"&gt;&lt;strong&gt;æ— éœ€é›†æˆSpring Securityçš„åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-ç®€å•jwtéªŒè¯éœ€æ±‚"&gt;&lt;strong&gt;1. ç®€å•JWTéªŒè¯éœ€æ±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥ä»…éœ€åŸºç¡€Tokenæ ¡éªŒï¼Œå¯é€šè¿‡&lt;strong&gt;è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨&lt;/strong&gt;å®ç°ï¼ˆå¦‚ç½‘é¡µ1ä¸­çš„&lt;code&gt;JwtAuthFilter&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;JwtFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getFirst&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Authorization&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰‹åŠ¨è§£æJWTå¹¶éªŒè¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;invalid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setStatusCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UNAUTHORIZED&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setComplete&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="2-éé›†ä¸­å¼æƒé™ç®¡ç†"&gt;&lt;strong&gt;2. éé›†ä¸­å¼æƒé™ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“æƒé™æ ¡éªŒç”±ä¸‹æ¸¸æœåŠ¡è‡ªè¡Œå¤„ç†æ—¶ï¼Œç½‘å…³ä»…éœ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±è½¬å‘&lt;/strong&gt;ï¼šé…ç½®ç™½åå•è·¯å¾„ï¼ˆå¦‚ç½‘é¡µ3ä¸­é€šè¿‡&lt;code&gt;pathMatchers(&amp;quot;/actuator/**&amp;quot;).permitAll()&lt;/code&gt;å¼€æ”¾ç›‘æ§ç«¯ç‚¹ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;lb://service-name&lt;/code&gt;å®ç°æœåŠ¡å‘ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-æ€§èƒ½æ•æ„Ÿåœºæ™¯"&gt;&lt;strong&gt;3. æ€§èƒ½æ•æ„Ÿåœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Spring Securityçš„å®Œæ•´å®‰å…¨é“¾å¯èƒ½å¼•å…¥é¢å¤–å¼€é”€ã€‚è‹¥è¿½æ±‚æç®€æ€§èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§æ–¹æ¡ˆ&lt;/strong&gt;ï¼šä»…ä¾èµ–&lt;code&gt;spring-cloud-starter-gateway&lt;/code&gt;ï¼Œé€šè¿‡Redisç¼“å­˜ç”¨æˆ·æƒé™ï¼ˆå¦‚ç½‘é¡µ3ä¸­ä½¿ç”¨Rediså­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥éé˜»å¡éªŒè¯&lt;/strong&gt;ï¼šç»“åˆWebFluxçš„å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼ˆå¦‚ç½‘é¡µ4ä¸­åŸºäº&lt;code&gt;ProxyExchange&lt;/code&gt;çš„åŠ¨æ€è·¯ç”±ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å†³ç­–å»ºè®®"&gt;&lt;strong&gt;å†³ç­–å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é›†æˆSpring Security&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¸é›†æˆSpring Security&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤æ‚æƒé™ä½“ç³»ã€OAuth2åè®®&lt;/td&gt;
&lt;td&gt;ç®€å•Tokenæ ¡éªŒã€æ€§èƒ½æ•æ„Ÿåœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€å‘æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€é…ç½®å®‰å…¨é“¾ã€è§’è‰²æ˜ å°„ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»´æŠ¤å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­é«˜ï¼ˆä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆç‹¬ç«‹ç»´æŠ¤ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹é…ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç½‘é¡µ5çš„&lt;code&gt;SecurityWebFilterChain&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç½‘é¡µ1çš„å…¨å±€JWTè¿‡æ»¤å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="è¡¥å……è¯´æ˜"&gt;&lt;strong&gt;è¡¥å……è¯´æ˜&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜&lt;/strong&gt;&lt;br&gt;
Spring Cloud Gateway 2022.0.0+éœ€æ­é…Spring Security 6.xï¼Œéœ€æ³¨æ„ä¾èµ–å†²çªï¼ˆå¦‚ç½‘é¡µ1ä¸­&lt;code&gt;spring-cloud-dependencies&lt;/code&gt;ç‰ˆæœ¬ç®¡ç†ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆæ¶æ„å®è·µ&lt;/strong&gt;&lt;br&gt;
å¯éƒ¨åˆ†é›†æˆSpring Securityï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;ServerHttpSecurity&lt;/code&gt;ä»…å¼€å¯åŸºç¡€è®¤è¯ï¼›&lt;/li&gt;
&lt;li&gt;ç»“åˆè‡ªå®šä¹‰è¿‡æ»¤å™¨å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ç½‘é¡µ6ä¸­Ajaxç™»å½•ä¸ç½‘å…³è®¤è¯åˆ†ç¦»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€é…ç½®æ‰©å±•&lt;/strong&gt;&lt;br&gt;
é€šè¿‡Nacosæˆ–ConsulåŠ¨æ€åŠ è½½å®‰å…¨è§„åˆ™ï¼Œå®ç°é‰´æƒç­–ç•¥çš„çƒ­æ›´æ–°ï¼ˆå¦‚ç½‘é¡µ3ä¸­æ•´åˆé…ç½®ä¸­å¿ƒï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šæ˜¯å¦éœ€è¦é›†æˆSpring Securityå–å†³äº&lt;strong&gt;å®‰å…¨éœ€æ±‚å¤æ‚åº¦&lt;/strong&gt;å’Œ&lt;strong&gt;æ€§èƒ½è¦æ±‚&lt;/strong&gt;ã€‚å¯¹äºéœ€è¦ç»Ÿä¸€å®‰å…¨ç­–ç•¥ã€OAuth2åè®®æ”¯æŒæˆ–ç»†ç²’åº¦æƒé™æ§åˆ¶çš„ç³»ç»Ÿï¼Œé›†æˆæ˜¯ä¼˜é€‰æ–¹æ¡ˆï¼›å¯¹äºè½»é‡çº§ç½‘å…³æˆ–å·²æœ‰ç‹¬ç«‹é‰´æƒæœåŠ¡çš„åœºæ™¯ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰è¿‡æ»¤å™¨å®ç°æ›´çµæ´»çš„æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id="spring-cloud-gateway-è·¨åŸŸ"&gt;Spring Cloud Gateway è·¨åŸŸ
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Cloud Gatewayä¸­è§£å†³è·¨åŸŸé—®é¢˜ï¼ˆCORSï¼‰ä¸»è¦æœ‰ä»¥ä¸‹äº”ç§æ–¹å¼ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚å’Œç‰ˆæœ¬å·®å¼‚å¯çµæ´»é€‰æ‹©ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å…¨å±€é…ç½®æ–‡ä»¶é…ç½®æ¨èé«˜ç‰ˆæœ¬"&gt;&lt;strong&gt;å…¨å±€é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èé«˜ç‰ˆæœ¬ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨ç‰ˆæœ¬&lt;/strong&gt;ï¼šSpring Cloud Gateway 2.2.xåŠä»¥ä¸Š&lt;br&gt;
&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼šåœ¨&lt;code&gt;application.yml&lt;/code&gt;ä¸­é€šè¿‡&lt;code&gt;globalcors&lt;/code&gt;å‚æ•°å…¨å±€é…ç½®ï¼Œæ”¯æŒé€šé…ç¬¦å’Œç»†ç²’åº¦æ§åˆ¶ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;globalcors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;add-to-simple-url-handler-mapping&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# è§£å†³OPTIONSè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cors-configurations&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;#39;[/**]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedOrigins&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…è®¸æ‰€æœ‰æ¥æºï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®æŒ‡å®šå…·ä½“åŸŸå&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedMethods&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;GET,POST,PUT,DELETE,OPTIONS&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ”¯æŒçš„HTTPæ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedHeaders&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…è®¸æ‰€æœ‰è¯·æ±‚å¤´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowCredentials&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…è®¸æºå¸¦Cookie&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;maxAge&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;36000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šé…ç½®ç®€æ´ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°ï¼Œæ— éœ€ç¼–å†™ä»£ç ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="javaé…ç½®ç±»å®ç°"&gt;&lt;strong&gt;Javaé…ç½®ç±»å®ç°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦åŠ¨æ€é€»è¾‘æˆ–å…¼å®¹ä½ç‰ˆæœ¬ï¼ˆå¦‚Gateway 2.1.xï¼‰&lt;br&gt;
&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;CorsWebFilter&lt;/code&gt;å®šä¹‰è·¨åŸŸè§„åˆ™ï¼Œæ”¯æŒè·¯å¾„åŒ¹é…å’Œè‡ªå®šä¹‰é€»è¾‘ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CorsConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CorsWebFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;corsFilter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CorsConfiguration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CorsConfiguration&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setAllowCredentials&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAllowedOrigin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAllowedHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAllowedMethod&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setMaxAge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;36000L&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UrlBasedCorsConfigurationSource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UrlBasedCorsConfigurationSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PathPatternParser&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;registerCorsConfiguration&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/**&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CorsWebFilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€é¿å…ä¸é…ç½®æ–‡ä»¶ä¸­çš„è·¨åŸŸé…ç½®é‡å¤ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å…¨å±€è¿‡æ»¤å™¨åŠ¨æ€å¤„ç†"&gt;&lt;strong&gt;å…¨å±€è¿‡æ»¤å™¨åŠ¨æ€å¤„ç†&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€æ ¹æ®è¯·æ±‚åŠ¨æ€è®¾ç½®å“åº”å¤´ï¼ˆå¦‚å…è®¸ç‰¹å®šæ¥æºï¼‰&lt;br&gt;
&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼šè‡ªå®šä¹‰&lt;code&gt;GlobalFilter&lt;/code&gt;æ‹¦æˆªè¯·æ±‚å¹¶æ·»åŠ è·¨åŸŸå¤´ä¿¡æ¯ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CorsGlobalFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ordered&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Access-Control-Allow-Methods&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;GET,POST,PUT,DELETE,OPTIONS&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Access-Control-Allow-Headers&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Content-Type,Authorization&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Access-Control-Max-Age&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;3600&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getOrder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;200&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¡®ä¿è¿‡æ»¤å™¨ä¼˜å…ˆçº§é«˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šçµæ´»æ€§é«˜ï¼Œå¯ç»“åˆä¸šåŠ¡é€»è¾‘åŠ¨æ€å¤„ç†è¯·æ±‚æ¥æºã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è·¯ç”±çº§åˆ«é…ç½®"&gt;&lt;strong&gt;è·¯ç”±çº§åˆ«é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä¸åŒè·¯ç”±éœ€ä¸åŒè·¨åŸŸè§„åˆ™&lt;br&gt;
&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼šåœ¨è·¯ç”±é…ç½®ä¸­é€šè¿‡&lt;code&gt;cors()&lt;/code&gt;æ–¹æ³•å®šä¹‰è·¨åŸŸå‚æ•°ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;cloud&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;gateway&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;api_route&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;lb://user-service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;predicates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;Path=/api/**&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;filters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;Cors&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedOrigins&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;http://example.com&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedMethods&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;GET,POST&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;allowedHeaders&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;maxAge&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;18000&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€é…åˆ&lt;code&gt;cors()&lt;/code&gt;è¿‡æ»¤å™¨ä½¿ç”¨ï¼Œé€‚ç”¨äºç‰¹å®šè·¯å¾„çš„ç»†ç²’åº¦æ§åˆ¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å…¼å®¹æ€§ä¿®å¤ç‰¹æ®Šæµè§ˆå™¨"&gt;&lt;strong&gt;å…¼å®¹æ€§ä¿®å¤ï¼ˆç‰¹æ®Šæµè§ˆå™¨ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é—®é¢˜åœºæ™¯&lt;/strong&gt;ï¼šéƒ¨åˆ†æµè§ˆå™¨ï¼ˆå¦‚æœç‹—ï¼‰å› å“åº”å¤´é¡ºåºé—®é¢˜å¯¼è‡´è·¨åŸŸå¤±è´¥&lt;br&gt;
&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼šæ·»åŠ å…¨å±€è¿‡æ»¤å™¨ä¿®å¤å“åº”å¤´é¡ºåºã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;FixCorsResponseFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GlobalFilter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Ordered&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServerWebExchange&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GatewayFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromRunnable&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exchange&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResponse&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getHeaders&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;entrySet&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;removeIf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entry&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entry&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getKey&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;startsWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Access-Control-&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ¸…é™¤é‡å¤çš„è·¨åŸŸå¤´ä¿¡æ¯ï¼Œé¿å…æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-4"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Gateway 2.2.x+æ¨èé…ç½®æ–‡ä»¶æ–¹å¼ï¼›&lt;/li&gt;
&lt;li&gt;ä½ç‰ˆæœ¬ï¼ˆå¦‚2.1.xï¼‰éœ€é€šè¿‡Javaé…ç½®æˆ–è¿‡æ»¤å™¨å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…é‡å¤å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ç½‘å…³å·²å¤„ç†è·¨åŸŸï¼Œéœ€ç§»é™¤ä¸‹æ¸¸æœåŠ¡çš„&lt;code&gt;@CrossOrigin&lt;/code&gt;æ³¨è§£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒå®‰å…¨å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…ä½¿ç”¨&lt;code&gt;allowedOrigins: &amp;quot;*&amp;quot;&lt;/code&gt;ï¼Œåº”æŒ‡å®šå…·ä½“åŸŸåï¼›&lt;/li&gt;
&lt;li&gt;é™åˆ¶&lt;code&gt;allowedHeaders&lt;/code&gt;å’Œ&lt;code&gt;allowedMethods&lt;/code&gt;èŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;OPTIONSè¯·æ±‚å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿&lt;code&gt;add-to-simple-url-handler-mapping: true&lt;/code&gt;ï¼Œå¦åˆ™æµè§ˆå™¨é¢„æ£€è¯·æ±‚ä¼šè¢«æ‹¦æˆªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="autowired-è·¨æ¨¡å—"&gt;@Autowired è·¨æ¨¡å—
&lt;/h2&gt;&lt;p&gt;@AutoWired å¯ä»¥è·¨æ¨¡å—æ³¨å…¥ &lt;code&gt;@Service&lt;/code&gt;ï¼Œä½†éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œå…·ä½“å®ç°æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è·¨æ¨¡å—æ³¨å…¥çš„å‰ææ¡ä»¶"&gt;è·¨æ¨¡å—æ³¨å…¥çš„å‰ææ¡ä»¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„ä»¶æ‰«æèŒƒå›´è¦†ç›–ç›®æ ‡æ¨¡å—&lt;/strong&gt;&lt;br&gt;
Spring é»˜è®¤åªä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸­çš„ç»„ä»¶ã€‚è‹¥ç›®æ ‡æ¨¡å—çš„ &lt;code&gt;@Service&lt;/code&gt; ç±»ä½äºå…¶ä»–åŒ…è·¯å¾„ï¼Œéœ€é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰©å±•æ‰«æèŒƒå›´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–¹å¼ä¸€&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨ç±»æ·»åŠ  &lt;code&gt;@ComponentScan(basePackages = {&amp;quot;æ¨¡å—AåŒ…è·¯å¾„&amp;quot;, &amp;quot;æ¨¡å—BåŒ…è·¯å¾„&amp;quot;})&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹å¼äºŒ&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;@SpringBootApplication&lt;/code&gt; æ³¨è§£ä¸­æŒ‡å®š &lt;code&gt;scanBasePackages&lt;/code&gt;ï¼Œå¦‚ &lt;code&gt;@SpringBootApplication(scanBasePackages = &amp;quot;com.example&amp;quot;)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å—ä¾èµ–é…ç½®æ­£ç¡®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨æ–¹æ¨¡å—ï¼ˆå¦‚æ¨¡å—Cï¼‰éœ€åœ¨æ„å»ºé…ç½®ï¼ˆå¦‚ Maven çš„ &lt;code&gt;pom.xml&lt;/code&gt;ï¼‰ä¸­æ˜¾å¼ä¾èµ–è¢«è°ƒç”¨æ–¹æ¨¡å—ï¼ˆå¦‚æ¨¡å—Aã€Bï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ç¡®ä¿æ¥å£ä¸å®ç°ç±»åœ¨æ¨¡å—é—´çš„åŒ…è·¯å¾„ç¬¦åˆç»„ä»¶æ‰«æè§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è·¨æ¨¡å—æ³¨å…¥çš„å®ç°æ–¹å¼"&gt;è·¨æ¨¡å—æ³¨å…¥çš„å®ç°æ–¹å¼
&lt;/h3&gt;&lt;h4 id="å•æ¥å£å•å®ç°åœºæ™¯"&gt;å•æ¥å£å•å®ç°åœºæ™¯
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;@Autowired&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
è‹¥ç›®æ ‡æ¨¡å—ä¸­æ¥å£ä»…æœ‰ä¸€ä¸ªå®ç°ç±»ï¼Œç›´æ¥æ³¨å…¥æ¥å£å³å¯ï¼ŒSpring ä¼šè‡ªåŠ¨æŒ‰ç±»å‹åŒ¹é…ã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ¨¡å—Aï¼šæ¥å£å®šä¹‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡å—Bï¼šå®ç°ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DataServiceImpl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡å—Cï¼šè°ƒç”¨æ–¹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BusinessService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dataService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªåŠ¨æ³¨å…¥æ¨¡å—Bçš„å®ç°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤šå®ç°ç±»åœºæ™¯"&gt;å¤šå®ç°ç±»åœºæ™¯
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Qualifier&lt;/code&gt; æŒ‡å®š Bean åç§°&lt;/strong&gt;&lt;br&gt;
è‹¥åŒä¸€æ¥å£åœ¨å¤šä¸ªæ¨¡å—ä¸­å­˜åœ¨ä¸åŒå®ç°ï¼Œéœ€é€šè¿‡åç§°åŒºåˆ†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ¨¡å—Aï¼šå®ç°ç±»1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;moduleADataService&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ModuleADataServiceImpl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡å—Bï¼šå®ç°ç±»2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;moduleBDataService&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ModuleBDataServiceImpl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡å—Cï¼šæŒ‰éœ€æ³¨å…¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BusinessService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Qualifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;moduleBDataService&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‡å®šå…·ä½“å®ç°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dataService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Primary&lt;/code&gt; æ ‡è®°é»˜è®¤å®ç°&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€ä¼˜å…ˆæ³¨å…¥æŸä¸€å®ç°ï¼Œå¯åœ¨ç›®æ ‡ç±»æ·»åŠ  &lt;code&gt;@Primary&lt;/code&gt; æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Primary&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DefaultDataServiceImpl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DataService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"&gt;å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å…¥å¤±è´¥ï¼šNoSuchBeanDefinitionException&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šç›®æ ‡æ¨¡å—çš„ç»„ä»¶æœªè¢«æ‰«æåˆ°æˆ–ä¾èµ–æœªæ­£ç¡®é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šæ£€æŸ¥ &lt;code&gt;@ComponentScan&lt;/code&gt; èŒƒå›´åŠæ¨¡å—ä¾èµ–å…³ç³»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šå®ç°å†²çªï¼šNoUniqueBeanDefinitionException&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šåŒä¸€æ¥å£å­˜åœ¨å¤šä¸ªå®ç°ä¸”æœªæŒ‡å®šæ³¨å…¥æ¡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;@Qualifier&lt;/code&gt; æˆ– &lt;code&gt;@Primary&lt;/code&gt; æ˜ç¡®æ³¨å…¥ç›®æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-9"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@AutoWired&lt;/code&gt; æ”¯æŒè·¨æ¨¡å—æ³¨å…¥ &lt;code&gt;@Service&lt;/code&gt;ï¼Œä½†éœ€ç¡®ä¿ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›®æ ‡æ¨¡å—çš„åŒ…è·¯å¾„åœ¨ç»„ä»¶æ‰«æèŒƒå›´å†…ï¼›&lt;/li&gt;
&lt;li&gt;æ¨¡å—é—´ä¾èµ–å…³ç³»æ­£ç¡®é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;å¤šå®ç°æ—¶é€šè¿‡ &lt;code&gt;@Qualifier&lt;/code&gt; æˆ– &lt;code&gt;@Primary&lt;/code&gt; è§£å†³æ­§ä¹‰ã€‚&lt;br&gt;
é€šè¿‡åˆç†é…ç½® &lt;code&gt;@ComponentScan&lt;/code&gt; å’Œæ¨¡å—ç»“æ„ï¼Œå¯è½»æ¾å®ç°è·¨æ¨¡å—ä¾èµ–æ³¨å…¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="requestheader"&gt;@RequestHeader
&lt;/h2&gt;&lt;h3 id="æ¦‚è¿°"&gt;&lt;strong&gt;æ¦‚è¿°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RequestHeader&lt;/code&gt; æ˜¯ Spring MVC æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºå°† HTTP è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰çš„å€¼ç»‘å®šåˆ°æ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ä¸Šã€‚å®ƒå…è®¸å¼€å‘è€…ä»¥å£°æ˜å¼çš„æ–¹å¼è®¿é—®è¯·æ±‚å¤´ä¸­çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·ä»£ç†ï¼ˆUser-Agentï¼‰ã€è®¤è¯ä»¤ç‰Œï¼ˆAuthorizationï¼‰ã€è¯­è¨€åå¥½ï¼ˆAccept-Languageï¼‰ç­‰ï¼Œä»è€Œå¢å¼º Web åº”ç”¨çš„çµæ´»æ€§å’ŒåŠŸèƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŸºæœ¬ç”¨æ³•ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/user-agent&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUserAgent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;User-Agent&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userAgent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;User-Agent: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userAgent&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤ç¤ºä¾‹ä¸­ï¼Œ&lt;code&gt;User-Agent&lt;/code&gt; è¯·æ±‚å¤´çš„å€¼ä¼šè¢«è‡ªåŠ¨æ³¨å…¥åˆ° &lt;code&gt;userAgent&lt;/code&gt; å‚æ•°ä¸­ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå±æ€§"&gt;&lt;strong&gt;æ ¸å¿ƒå±æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RequestHeader&lt;/code&gt; æä¾›ä»¥ä¸‹å…³é”®å±æ€§ï¼Œç”¨äºæ§åˆ¶ç»‘å®šè¡Œä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;value&lt;/code&gt;/&lt;code&gt;name&lt;/code&gt;&lt;/strong&gt;ï¼šæŒ‡å®šè¯·æ±‚å¤´çš„åç§°ï¼ˆå¦‚ &lt;code&gt;&amp;quot;Authorization&amp;quot;&lt;/code&gt;ï¼‰ã€‚è‹¥å‚æ•°åä¸è¯·æ±‚å¤´åç§°åŒ¹é…ï¼ˆéœ€é©¼å³°å¼è½¬æ¢ï¼‰ï¼Œå¯çœç•¥æ­¤å±æ€§ï¼Œä½†å»ºè®®æ˜¾å¼æŒ‡å®šä»¥å¢å¼ºå¯è¯»æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;required&lt;/code&gt;&lt;/strong&gt;ï¼šæ ‡è®°è¯·æ±‚å¤´æ˜¯å¦å¿…é¡»å­˜åœ¨ï¼Œé»˜è®¤ &lt;code&gt;true&lt;/code&gt;ã€‚è‹¥è®¾ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œè¯·æ±‚å¤´ä¸å­˜åœ¨æ—¶å‚æ•°å€¼ä¸º &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;defaultValue&lt;/code&gt;&lt;/strong&gt;ï¼šå½“è¯·æ±‚å¤´ä¸å­˜åœ¨æ—¶ï¼Œæä¾›é»˜è®¤å€¼ï¼ˆå¦‚ &lt;code&gt;defaultValue = &amp;quot;en-US&amp;quot;&lt;/code&gt;ï¼‰ã€‚ä½¿ç”¨æ­¤å±æ€§åï¼Œ&lt;code&gt;required&lt;/code&gt; è‡ªåŠ¨å˜ä¸º &lt;code&gt;false&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/auth&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;authToken&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;X-Auth-Token&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;required&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;defaultValue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;guest&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èº«ä»½éªŒè¯&lt;/strong&gt;ï¼šè·å– &lt;code&gt;Authorization&lt;/code&gt; å¤´ä¸­çš„ä»¤ç‰Œè¿›è¡Œé‰´æƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè¯­è¨€æ”¯æŒ&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;Accept-Language&lt;/code&gt; å¤´è¿”å›é€‚é…ç”¨æˆ·è¯­è¨€çš„å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¢æˆ·ç«¯ä¿¡æ¯é‡‡é›†&lt;/strong&gt;ï¼šåˆ†æ &lt;code&gt;User-Agent&lt;/code&gt; å¤´ä»¥è¯†åˆ«ç”¨æˆ·è®¾å¤‡æˆ–æµè§ˆå™¨ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;ï¼šå¤„ç†è‡ªå®šä¹‰å¤´ï¼ˆå¦‚ &lt;code&gt;X-API-Key&lt;/code&gt;ï¼‰ä¼ é€’ä¸šåŠ¡å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¤„ç†å¤šä¸ªè¯·æ±‚å¤´"&gt;&lt;strong&gt;å¤„ç†å¤šä¸ªè¯·æ±‚å¤´&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€ä¸€æ¬¡æ€§è·å–æ‰€æœ‰è¯·æ±‚å¤´ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Map&amp;lt;String, String&amp;gt;&lt;/code&gt;&lt;/strong&gt;ï¼šæ¥æ”¶å•å€¼å¤´ï¼Œé‡å¤å¤´ä»…ä¿ç•™æœ€åä¸€ä¸ªå€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;MultiValueMap&amp;lt;String, String&amp;gt;&lt;/code&gt;&lt;/strong&gt;ï¼šæ”¯æŒå¤šå€¼å¤´ï¼ˆå¦‚ &lt;code&gt;Accept-Language: en, zh&lt;/code&gt;ï¼‰ï¼Œä»¥åˆ—è¡¨å½¢å¼å­˜å‚¨å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;HttpHeaders&lt;/code&gt; å¯¹è±¡&lt;/strong&gt;ï¼šSpring æä¾›çš„å·¥å…·ç±»ï¼Œæä¾›ç±»å‹å®‰å…¨çš„æ–¹æ³•è®¿é—®å¤´ä¿¡æ¯ï¼ˆæ¨èä½¿ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/headers&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getAllHeaders&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestHeader&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userAgent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirst&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;User-Agent&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Headers: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-5"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°åè½¬æ¢&lt;/strong&gt;ï¼šè‹¥è¯·æ±‚å¤´åç§°åŒ…å«è¿å­—ç¬¦ï¼ˆå¦‚ &lt;code&gt;X-Custom-Header&lt;/code&gt;ï¼‰ï¼Œéœ€åœ¨æ³¨è§£ä¸­æ˜¾å¼æŒ‡å®šåç§°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šè‹¥ &lt;code&gt;required = true&lt;/code&gt; ä½†è¯·æ±‚å¤´ç¼ºå¤±ï¼Œä¼šæŠ›å‡º &lt;code&gt;MissingRequestHeaderException&lt;/code&gt;ï¼Œéœ€å…¨å±€å¼‚å¸¸å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤å€¼é™åˆ¶&lt;/strong&gt;ï¼š&lt;code&gt;defaultValue&lt;/code&gt; ä¸å¯ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦åˆ™å¯èƒ½å¼•å‘é€»è¾‘é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜ç¼ºç‚¹åˆ†æ"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šæ”¯æŒè·å–ä»»æ„è¯·æ±‚å¤´ï¼Œé€‚åº”å¤šæ ·åŒ–éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç ç®€æ´&lt;/strong&gt;ï¼šé€šè¿‡æ³¨è§£ç›´æ¥ç»‘å®šï¼Œå‡å°‘æ‰‹åŠ¨è§£æä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºè€¦åˆæ€§&lt;/strong&gt;ï¼šè¿‡åº¦ä¾èµ–ç‰¹å®šè¯·æ±‚å¤´å¯èƒ½å¯¼è‡´æ¥å£å…¼å®¹æ€§é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸é£é™©&lt;/strong&gt;ï¼šè‹¥æœªå¤„ç† &lt;code&gt;required = true&lt;/code&gt; çš„ç¼ºå¤±æƒ…å†µï¼Œå¯èƒ½å¼•å‘æœåŠ¡ä¸­æ–­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-10"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RequestHeader&lt;/code&gt; æ˜¯ Spring ä¸­å¤„ç† HTTP è¯·æ±‚å¤´çš„æ ¸å¿ƒæ³¨è§£ï¼Œé€‚ç”¨äºèº«ä»½éªŒè¯ã€å¤šè¯­è¨€é€‚é…ç­‰åœºæ™¯ã€‚é€šè¿‡åˆç†ä½¿ç”¨å…¶å±æ€§å’Œé›†åˆç±»å‹å‚æ•°ï¼Œå¯æ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚å»ºè®®ç»“åˆ &lt;code&gt;HttpHeaders&lt;/code&gt; å¯¹è±¡å¤„ç†å¤æ‚éœ€æ±‚ï¼Œå¹¶æ³¨æ„å¼‚å¸¸å’Œé»˜è®¤å€¼çš„è®¾è®¡ã€‚&lt;/p&gt;
&lt;h2 id="å¾®æœåŠ¡è¯·æ±‚æ‹†åˆ†"&gt;å¾®æœåŠ¡è¯·æ±‚æ‹†åˆ†
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;PostæœåŠ¡éœ€è¦UseræœåŠ¡æä¾›ç”¨æˆ·ä¿¡æ¯æ—¶&lt;/strong&gt;ï¼Œé€‰æ‹©ç”±PostæœåŠ¡èšåˆæ•°æ®åè¿”å›ï¼Œè¿˜æ˜¯å‰ç«¯åˆ†åˆ«è°ƒç”¨ä¸¤ä¸ªæ¥å£ï¼Œéœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ã€æ€§èƒ½éœ€æ±‚å’ŒæŠ€æœ¯æ¶æ„ç»¼åˆè¯„ä¼°ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ–¹æ¡ˆçš„å¯¹æ¯”åŠé€‚ç”¨åœºæ™¯åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ¡ˆä¸€postæœåŠ¡è¯·æ±‚useræœåŠ¡å¹¶èšåˆè¿”å›"&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼šPostæœåŠ¡è¯·æ±‚UseræœåŠ¡å¹¶èšåˆè¿”å›&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;br&gt;
PostæœåŠ¡é€šè¿‡&lt;strong&gt;æœåŠ¡é—´è°ƒç”¨&lt;/strong&gt;ï¼ˆå¦‚Feignã€gRPCï¼‰è·å–UseræœåŠ¡æ•°æ®ï¼Œåˆå¹¶åç»Ÿä¸€è¿”å›ç»™å‰ç«¯ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// PostæœåŠ¡é€šè¿‡Feignè°ƒç”¨UseræœåŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user-service&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/users/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// PostæœåŠ¡åˆå¹¶é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PostDetail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getPostWithUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUserId&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PostDetail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é™ä½å‰ç«¯å¤æ‚åº¦&lt;/strong&gt;ï¼šå‰ç«¯åªéœ€è°ƒç”¨ä¸€ä¸ªæ¥å£ï¼Œé¿å…å¤šè¯·æ±‚ç®¡ç†å’Œæ•°æ®æ‹¼æ¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡èŒè´£æ¸…æ™°&lt;/strong&gt;ï¼šPostæœåŠ¡è´Ÿè´£ä¸šåŠ¡é€»è¾‘èšåˆï¼Œç¬¦åˆå¾®æœåŠ¡â€œå•ä¸€èŒè´£â€åŸåˆ™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§æ›´é«˜&lt;/strong&gt;ï¼šç”¨æˆ·ä¿¡æ¯é€šè¿‡æœåŠ¡é—´é€šä¿¡ä¼ é€’ï¼Œé¿å…æ•æ„Ÿæ•°æ®æš´éœ²ç»™å‰ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘ç½‘ç»œå¼€é”€&lt;/strong&gt;ï¼šåˆå¹¶åå•æ¬¡å“åº”å¯èƒ½æ¯”å¤šæ¬¡è¯·æ±‚æ›´é«˜æ•ˆï¼ˆå°¤å…¶åœ¨ç§»åŠ¨ç«¯åœºæ™¯ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡é—´è€¦åˆ&lt;/strong&gt;ï¼šUseræœåŠ¡æ¥å£å˜æ›´å¯èƒ½ç›´æ¥å½±å“PostæœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº§è”æ•…éšœé£é™©&lt;/strong&gt;ï¼šè‹¥UseræœåŠ¡å“åº”å»¶è¿Ÿæˆ–å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´PostæœåŠ¡æ•´ä½“ä¸å¯ç”¨ï¼ˆéœ€é€šè¿‡ç†”æ–­ã€é™çº§è§£å†³ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ï¼šæœåŠ¡é—´è°ƒç”¨å¢åŠ é“¾è·¯å»¶è¿Ÿï¼Œå°¤å…¶æ˜¯è·¨èŠ‚ç‚¹æˆ–é«˜å¹¶å‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·ä¿¡æ¯ä¸Postæ•°æ®å¼ºå…³è”ï¼ˆå¦‚å¿…é¡»åŒæ—¶å±•ç¤ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å‰ç«¯æ€§èƒ½æ•æ„Ÿï¼ˆå¦‚ç§»åŠ¨ç«¯å¼±ç½‘ç¯å¢ƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€éšè—ç”¨æˆ·ä¿¡æ¯è·å–ç»†èŠ‚ï¼ˆå¦‚æƒé™æ ¡éªŒã€æ•æ„Ÿå­—æ®µè¿‡æ»¤ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ¡ˆäºŒå‰ç«¯åˆ†åˆ«è°ƒç”¨postå’Œuseræ¥å£"&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼šå‰ç«¯åˆ†åˆ«è°ƒç”¨Postå’ŒUseræ¥å£&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;br&gt;
å‰ç«¯ç‹¬ç«‹è°ƒç”¨PostæœåŠ¡ï¼ˆè·å–å¸–å­æ•°æ®ï¼‰å’ŒUseræœåŠ¡ï¼ˆè·å–ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œè‡ªè¡Œåˆå¹¶æ•°æ®ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-javascript" data-lang="javascript"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å‰ç«¯å¹¶è¡Œè¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;post&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/api/posts/123&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sb"&gt;`/api/users/&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;userId&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æœåŠ¡è§£è€¦&lt;/strong&gt;ï¼šPostå’ŒUseræœåŠ¡ç‹¬ç«‹æ¼”è¿›ï¼Œäº’ä¸å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹¶è¡ŒåŠ è½½ä¼˜åŒ–&lt;/strong&gt;ï¼šå‰ç«¯å¯å¹¶å‘è¯·æ±‚ï¼Œç¼©çŸ­æ•´ä½“å“åº”æ—¶é—´ï¼ˆæµè§ˆå™¨æ”¯æŒå¤šè¯·æ±‚å¹¶å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§é«˜&lt;/strong&gt;ï¼šå‰ç«¯æŒ‰éœ€è·å–æ•°æ®ï¼ˆå¦‚ä»…éœ€ç”¨æˆ·éƒ¨åˆ†å­—æ®µæ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‰ç«¯å¤æ‚åº¦å¢åŠ &lt;/strong&gt;ï¼šéœ€å¤„ç†å¤šè¯·æ±‚åè°ƒã€é”™è¯¯é‡è¯•åŠæ•°æ®åˆå¹¶é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ½œåœ¨å†—ä½™è¯·æ±‚&lt;/strong&gt;ï¼šè‹¥å¤šä¸ªé¡µé¢éœ€ç”¨æˆ·ä¿¡æ¯ï¼Œå¯èƒ½é‡å¤è°ƒç”¨UseræœåŠ¡ï¼ˆå¯é€šè¿‡ç¼“å­˜ç¼“è§£ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨é£é™©&lt;/strong&gt;ï¼šè‹¥ç”¨æˆ·æ¥å£æš´éœ²æ•æ„Ÿä¿¡æ¯ï¼Œéœ€ä¸¥æ ¼é‰´æƒã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·ä¿¡æ¯ä¸Postæ•°æ®å¼±å…³è”ï¼ˆå¦‚ç‹¬ç«‹å±•ç¤ºæ¨¡å—ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å‰ç«¯éœ€çµæ´»æ§åˆ¶æ•°æ®ç²’åº¦ï¼ˆå¦‚æŒ‰éœ€åŠ è½½ç”¨æˆ·è¯¦æƒ…ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡é—´è°ƒç”¨å»¶è¿Ÿè¾ƒé«˜ï¼ˆå¦‚è·¨åœ°åŸŸéƒ¨ç½²ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç»¼åˆå†³ç­–å»ºè®®"&gt;&lt;strong&gt;ç»¼åˆå†³ç­–å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡è€¦åˆæ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ç”¨æˆ·ä¿¡æ¯æ˜¯Postçš„æ ¸å¿ƒå†…å®¹ï¼ˆå¦‚ä½œè€…ä¿¡æ¯åµŒå…¥å¸–å­è¯¦æƒ…ï¼‰ï¼Œä¼˜å…ˆæ–¹æ¡ˆä¸€ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ç”¨æˆ·ä¿¡æ¯ä¸ºè¾…åŠ©å†…å®¹ï¼ˆå¦‚è¯„è®ºåŒºç”¨æˆ·å¤´åƒï¼‰ï¼Œå¯è€ƒè™‘æ–¹æ¡ˆäºŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¸ä½“éªŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ–¹æ¡ˆä¸€å¯èƒ½å› æœåŠ¡é—´è°ƒç”¨æˆä¸ºç“¶é¢ˆï¼Œéœ€ç»“åˆç¼“å­˜ï¼ˆå¦‚Redisç¼“å­˜ç”¨æˆ·æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å‰ç«¯æ€§èƒ½æ•æ„Ÿæ—¶ï¼Œæ–¹æ¡ˆäºŒé€šè¿‡å¹¶è¡Œè¯·æ±‚å¯èƒ½æ›´å¿«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ€§è¦æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥éœ€éšè—ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘ï¼ˆå¦‚æƒé™æ ¡éªŒã€å­—æ®µè„±æ•ï¼‰ï¼Œæ–¹æ¡ˆä¸€æ›´ä¼˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›¢é˜Ÿåˆ†å·¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰åç«¯åˆ†ç¦»è¾ƒå½»åº•çš„é¡¹ç›®ï¼Œæ–¹æ¡ˆäºŒæ›´ç¬¦åˆâ€œå…³æ³¨ç‚¹åˆ†ç¦»â€åŸåˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è¡¥å……ä¼˜åŒ–ç­–ç•¥"&gt;&lt;strong&gt;è¡¥å……ä¼˜åŒ–ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ¨¡å¼&lt;/strong&gt;ï¼šéƒ¨åˆ†æ ¸å¿ƒæ•°æ®ç”±PostæœåŠ¡èšåˆï¼Œæ‰©å±•ä¿¡æ¯ç”±å‰ç«¯æŒ‰éœ€è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BFFå±‚ï¼ˆBackend for Frontendï¼‰&lt;/strong&gt;ï¼šå¼•å…¥ç½‘å…³å±‚æˆ–BFFæœåŠ¡ï¼Œä¸“é—¨å¤„ç†æ•°æ®èšåˆï¼Œå‡è½»PostæœåŠ¡å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥é€šä¿¡&lt;/strong&gt;ï¼šå¯¹å®æ—¶æ€§è¦æ±‚ä½çš„åœºæ™¯ï¼Œå¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaï¼‰å¼‚æ­¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šä¸¤ç§æ–¹æ¡ˆæ— ç»å¯¹ä¼˜åŠ£ï¼Œéœ€æ ¹æ®å…·ä½“åœºæ™¯æƒè¡¡ã€‚&lt;strong&gt;æ¨èä¼˜å…ˆé‡‡ç”¨æ–¹æ¡ˆä¸€&lt;/strong&gt;ï¼ˆæœåŠ¡ç«¯èšåˆï¼‰ï¼Œå°¤å…¶åœ¨æ•°æ®å¼ºå…³è”å’Œé«˜å®‰å…¨æ€§è¦æ±‚çš„åœºæ™¯ï¼›è‹¥éœ€çµæ´»è§£è€¦æˆ–ä¼˜åŒ–å‰ç«¯æ€§èƒ½ï¼Œå¯è€ƒè™‘æ–¹æ¡ˆäºŒï¼Œå¹¶è¾…ä»¥è¯·æ±‚åˆå¹¶ã€ç¼“å­˜ç­‰ä¼˜åŒ–æ‰‹æ®µã€‚&lt;/p&gt;
&lt;h2 id="openfeign-1"&gt;OpenFeign
&lt;/h2&gt;&lt;p&gt;è§åšå®¢&lt;/p&gt;
&lt;h2 id="å¾®æœåŠ¡-common-æ¨¡å—"&gt;å¾®æœåŠ¡ common æ¨¡å—
&lt;/h2&gt;&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ&lt;strong&gt;æ˜¯å¦é€šè¿‡ComponentScanè®¾ç½®èŒƒå›´æˆ–æ‹†åˆ†Commonæ¨¡å—&lt;/strong&gt;çš„é€‰æ‹©éœ€è¦ç»“åˆé¡¹ç›®è§„æ¨¡ã€å›¢é˜Ÿåä½œæ¨¡å¼åŠç»´æŠ¤æˆæœ¬æ¥ç»¼åˆæƒè¡¡ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ–¹æ¡ˆçš„å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨componentscanæ§åˆ¶æ‰«æèŒƒå›´"&gt;ä½¿ç”¨ComponentScanæ§åˆ¶æ‰«æèŒƒå›´
&lt;/h3&gt;&lt;h4 id="å®ç°æ–¹å¼"&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡Springçš„&lt;code&gt;@ComponentScan&lt;/code&gt;æ³¨è§£ï¼Œé™å®šæ‰«æçš„åŒ…è·¯å¾„æˆ–ç±»ï¼Œæ’é™¤ä¸éœ€è¦çš„ç»„ä»¶ï¼ˆå¦‚ç‰¹å®šè¿‡æ»¤å™¨ã€éé€šç”¨çš„DTOç±»ç­‰ï¼‰ï¼Œä»…åŠ è½½å¿…è¦çš„Commonæ¨¡å—åŠŸèƒ½åˆ°å­æœåŠ¡ä¸­ã€‚&lt;/p&gt;
&lt;h4 id="ä¼˜ç‚¹"&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§å¼º&lt;/strong&gt;ï¼šé€šè¿‡é…ç½®å³å¯åŠ¨æ€è°ƒæ•´ä¾èµ–èŒƒå›´ï¼Œæ— éœ€æ”¹åŠ¨ä»£ç ç»“æ„ï¼Œé€‚åˆå¿«é€Ÿè¿­ä»£çš„å°å‹é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘æ•ˆç‡é«˜&lt;/strong&gt;ï¼šé¿å…é¢‘ç¹æ‹†åˆ†æ¨¡å—å¸¦æ¥çš„å·¥ç¨‹ç®¡ç†è´Ÿæ‹…ï¼Œå‡å°‘æ¨¡å—æ•°é‡å’Œç‰ˆæœ¬ç»´æŠ¤æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯é—¨æ§›ä½&lt;/strong&gt;ï¼šå¯¹å›¢é˜Ÿåä½œè¦æ±‚è¾ƒä½ï¼Œé€‚åˆåˆæœŸæŠ€æœ¯å‚¨å¤‡ä¸è¶³æˆ–ä¸šåŠ¡å¤æ‚åº¦ä¸é«˜çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ç¼ºç‚¹"&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;éšæ€§è€¦åˆé£é™©&lt;/strong&gt;ï¼šè‹¥Commonæ¨¡å—æŒç»­è†¨èƒ€ï¼Œå­æœåŠ¡å¯èƒ½å› æ‰«æèŒƒå›´é…ç½®é”™è¯¯è€Œå¼•å…¥å†—ä½™ä¾èµ–ï¼Œå¯¼è‡´ç¼–è¯‘åŒ…ä½“ç§¯å¢å¤§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»´æŠ¤æˆæœ¬ä¸Šå‡&lt;/strong&gt;ï¼šéšç€ä¸šåŠ¡æ‰©å±•ï¼ŒCommonæ¨¡å—çš„è¾¹ç•Œæ˜“æ¨¡ç³Šï¼Œéœ€é€šè¿‡æ–‡æ¡£æˆ–è§„èŒƒçº¦æŸå¼€å‘è¡Œä¸ºï¼Œé•¿æœŸå¯èƒ½äº§ç”ŸæŠ€æœ¯å€ºåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€å½±å“&lt;/strong&gt;ï¼šCommonæ¨¡å—çš„å…¬å…±é…ç½®ï¼ˆå¦‚å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼‰å¯èƒ½å› æ‰«æèŒƒå›´ä¸å½“è¢«æ„å¤–è¦†ç›–ï¼Œå¼•å‘è¿è¡Œæ—¶é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‹†åˆ†commonæ¨¡å—ä¸ºç‹¬ç«‹å­æ¨¡å—"&gt;æ‹†åˆ†Commonæ¨¡å—ä¸ºç‹¬ç«‹å­æ¨¡å—
&lt;/h3&gt;&lt;h4 id="å®ç°æ–¹å¼-1"&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å°†Commonæ¨¡å—æŒ‰åŠŸèƒ½æ‹†åˆ†ä¸ºå¤šä¸ªå­æ¨¡å—ï¼ˆå¦‚&lt;code&gt;common-utils&lt;/code&gt;ã€&lt;code&gt;common-web&lt;/code&gt;ã€&lt;code&gt;service-sdk&lt;/code&gt;ç­‰ï¼‰ï¼Œå­æœåŠ¡æŒ‰éœ€ä¾èµ–ç‰¹å®šæ¨¡å—ã€‚&lt;/p&gt;
&lt;h4 id="ä¼˜ç‚¹-1"&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;èŒè´£æ¸…æ™°&lt;/strong&gt;ï¼šæ¯ä¸ªå­æ¨¡å—èšç„¦å•ä¸€åŠŸèƒ½ï¼ˆå¦‚å·¥å…·ç±»ã€APIæ¥å£å®šä¹‰ï¼‰ï¼Œéµå¾ªé«˜å†…èšåŸåˆ™ï¼Œé™ä½ç»´æŠ¤å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–ç²¾å‡†æ§åˆ¶&lt;/strong&gt;ï¼šå­æœåŠ¡ä»…å¼•å…¥æ‰€éœ€æ¨¡å—ï¼Œå‡å°‘å†—ä½™ä¾èµ–ï¼Œæå‡ç¼–è¯‘æ•ˆç‡å’Œè¿è¡Œæ—¶æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‹¬ç«‹æ¼”è¿›&lt;/strong&gt;ï¼šæ‹†åˆ†åæ¨¡å—å¯ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†ï¼Œé¿å…å› å…¬å…±ä»£ç å˜æ›´å½±å“æ‰€æœ‰ä¾èµ–æœåŠ¡ï¼Œæ”¯æŒå¤šç‰ˆæœ¬å¹¶è¡Œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ç¼ºç‚¹-1"&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆæœŸæˆæœ¬é«˜&lt;/strong&gt;ï¼šæ‹†åˆ†éœ€é‡æ„ä»£ç ç»“æ„ï¼Œå®šä¹‰æ¨¡å—æ¥å£ï¼Œå¯¹å›¢é˜Ÿè®¾è®¡èƒ½åŠ›å’Œå·¥ç¨‹åŒ–æ°´å¹³è¦æ±‚è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®¡ç†å¤æ‚åº¦å¢åŠ &lt;/strong&gt;ï¼šæ¨¡å—æ•°é‡å¢å¤šåï¼Œéœ€å€ŸåŠ©Maven/Gradleç­‰å·¥å…·ç®¡ç†ä¾èµ–å…³ç³»ï¼Œå¯èƒ½å¼•å…¥ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨å›¢é˜Ÿåä½œæŒ‘æˆ˜&lt;/strong&gt;ï¼šè‹¥å¤šä¸ªé¡¹ç›®ä¾èµ–æ‹†åˆ†åçš„æ¨¡å—ï¼Œéœ€å»ºç«‹ç»Ÿä¸€è§„èŒƒï¼Œé¿å…æ¨¡å—è¢«æ»¥ç”¨æˆ–é‡å¤å»ºè®¾ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å»ºè®®"&gt;é€‚ç”¨åœºæ™¯å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆæ‹†åˆ†Commonæ¨¡å—çš„æƒ…å†µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®è§„æ¨¡è¾ƒå¤§ï¼Œéœ€é•¿æœŸç»´æŠ¤ä¸”å›¢é˜Ÿå…·å¤‡å¾®æœåŠ¡æ²»ç†ç»éªŒã€‚&lt;/li&gt;
&lt;li&gt;Commonæ¨¡å—å·²å‡ºç°æ˜æ˜¾è‡ƒè‚¿ï¼ˆå¦‚æ··åˆå·¥å…·ç±»ã€ä¸šåŠ¡DTOã€ç¬¬ä¸‰æ–¹é…ç½®ï¼‰ï¼Œå½±å“å¼€å‘æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;å­˜åœ¨å¤šé¡¹ç›®å¤ç”¨éœ€æ±‚ï¼Œéœ€é€šè¿‡ç‹¬ç«‹æ¨¡å—å®ç°ç‰ˆæœ¬éš”ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ComponentScançš„æƒ…å†µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®å¤„äºå¿«é€ŸéªŒè¯æœŸï¼Œä¸šåŠ¡è¾¹ç•Œæœªç¨³å®šï¼Œéœ€å‡å°‘æ¶æ„è°ƒæ•´æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;å›¢é˜Ÿè§„æ¨¡è¾ƒå°ï¼Œæ‹†åˆ†åæ¨¡å—ç»´æŠ¤å¯èƒ½è¶…å‡ºå›¢é˜Ÿèƒ½åŠ›èŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;Commonæ¨¡å—åŠŸèƒ½ç®€å•ä¸”å˜æ›´é¢‘ç‡ä½ï¼Œæ‹†åˆ†æ”¶ç›Šä¸æ˜æ˜¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µä¼˜åŒ–æ–¹å‘"&gt;å®è·µä¼˜åŒ–æ–¹å‘
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¸è¿›å¼æ‹†åˆ†&lt;/strong&gt;ï¼šåˆæœŸä¿ç•™æ ¸å¿ƒCommonæ¨¡å—ï¼Œé€æ­¥å°†éé€šç”¨åŠŸèƒ½ï¼ˆå¦‚ä¸šåŠ¡DTOã€è¿‡æ»¤å™¨ï¼‰ä¸‹æ²‰ä¸ºæœåŠ¡ä¸“å±SDKæˆ–ç‹¬ç«‹æ¨¡å—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆç‰ˆæœ¬ç®¡ç†&lt;/strong&gt;ï¼šé‡‡ç”¨Mavenä»“åº“çš„å¿«ç…§ï¼ˆSNAPSHOTï¼‰ä¸æ­£å¼ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿æ‹†åˆ†åçš„æ¨¡å—å¯ç‹¬ç«‹æ›´æ–°å’Œå›æ»šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–æ²»ç†&lt;/strong&gt;ï¼šé€šè¿‡ä»£ç æ‰«æå·¥å…·ï¼ˆå¦‚Sonarï¼‰ç›‘æ§Commonæ¨¡å—çš„ä¾èµ–åˆç†æ€§ï¼Œé¿å…éšæ€§è€¦åˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œä¸¤ç§æ–¹æ¡ˆå„æœ‰ä¼˜åŠ£ï¼Œéœ€æ ¹æ®å›¢é˜Ÿèƒ½åŠ›å’Œé¡¹ç›®é˜¶æ®µçµæ´»é€‰æ‹©ã€‚é•¿æœŸæ¥çœ‹ï¼Œ&lt;strong&gt;æ‹†åˆ†Commonæ¨¡å—æ›´ç¬¦åˆå¾®æœåŠ¡çš„é«˜å†…èšã€ä½è€¦åˆåŸåˆ™&lt;/strong&gt;ï¼Œä½†éœ€å¹³è¡¡é‡æ„æˆæœ¬ä¸æ”¶ç›Šã€‚&lt;/p&gt;
&lt;h2 id="long-vs-string-ä½œä¸ºç´¢å¼•"&gt;Long vs. String ä½œä¸ºç´¢å¼•
&lt;/h2&gt;&lt;p&gt;åœ¨å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚PostgreSQLæˆ–MySQLï¼‰ä¸­ï¼Œä½¿ç”¨&lt;strong&gt;String&lt;/strong&gt;æˆ–&lt;strong&gt;Long&lt;/strong&gt;ä½œä¸ºç´¢å¼•çš„æ€§èƒ½å·®å¼‚ä¸»è¦ä½“ç°åœ¨å­˜å‚¨ç©ºé—´ã€æŸ¥è¯¢é€Ÿåº¦ã€ç´¢å¼•ç»´æŠ¤æˆæœ¬ä»¥åŠæ•°æ®åº“ä¼˜åŒ–ç­–ç•¥ç­‰æ–¹é¢ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å­˜å‚¨ç©ºé—´ä¸ç´¢å¼•æ•ˆç‡"&gt;å­˜å‚¨ç©ºé—´ä¸ç´¢å¼•æ•ˆç‡
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Longç±»å‹ï¼ˆæ•´æ•°ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨ç´§å‡‘&lt;/strong&gt;ï¼šLongç±»å‹ï¼ˆå¦‚BIGINTæˆ–INTï¼‰å ç”¨å›ºå®šå­—èŠ‚ï¼ˆé€šå¸¸4-8å­—èŠ‚ï¼‰ï¼Œå­˜å‚¨ç©ºé—´å°ï¼Œç´¢å¼•æ ‘å±‚çº§æ›´ä½ï¼ŒæŸ¥è¯¢æ—¶IOæ¬¡æ•°æ›´å°‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šé•¿ç‰¹æ€§&lt;/strong&gt;ï¼šå®šé•¿å­—æ®µåœ¨B-treeç´¢å¼•ä¸­å®šä½æ›´å¿«ï¼Œæ— éœ€å¤„ç†å˜é•¿å­—æ®µçš„åç§»è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šMySQLçš„BIGINTå 8å­—èŠ‚ï¼Œè€ŒåŒç­‰èŒƒå›´çš„å­—ç¬¦ä¸²ï¼ˆå¦‚UUIDï¼‰å¯èƒ½å ç”¨36å­—èŠ‚ï¼Œå¯¼è‡´ç´¢å¼•ä½“ç§¯è†¨èƒ€4-5å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stringç±»å‹ï¼ˆå¦‚VARCHAR/CHARï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å˜é•¿å­˜å‚¨&lt;/strong&gt;ï¼šVARCHARç­‰ç±»å‹å ç”¨ç©ºé—´å–å†³äºå®é™…æ•°æ®é•¿åº¦ï¼Œç´¢å¼•èŠ‚ç‚¹åˆ©ç”¨ç‡å¯èƒ½è¾ƒä½ï¼Œå¯¼è‡´ç´¢å¼•å±‚çº§å¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦é›†å½±å“&lt;/strong&gt;ï¼šä½¿ç”¨UTF-8ç­‰å¤šå­—èŠ‚å­—ç¬¦é›†æ—¶ï¼Œå­—ç¬¦ä¸²å®é™…å ç”¨çš„å­˜å‚¨ç©ºé—´å¯èƒ½è¿œè¶…æ•´æ•°ï¼ˆä¾‹å¦‚ä¸­æ–‡æ¯ä¸ªå­—ç¬¦å 3-4å­—èŠ‚ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æ•°æ®&lt;/strong&gt;ï¼šåœ¨åƒä¸‡çº§æ•°æ®æµ‹è¯•ä¸­ï¼ŒCHAR(10)çš„æŸ¥è¯¢é€Ÿåº¦æ¯”VARCHAR(10)å¿«çº¦30%ï¼Œä½†ç©ºé—´æµªè´¹ç‡è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŸ¥è¯¢ä¸æ¯”è¾ƒæ“ä½œ"&gt;æŸ¥è¯¢ä¸æ¯”è¾ƒæ“ä½œ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Longç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¯”è¾ƒé«˜æ•ˆ&lt;/strong&gt;ï¼šæ•´æ•°æ¯”è¾ƒæ˜¯CPUåŸç”ŸæŒ‡ä»¤æ“ä½œï¼Œé€Ÿåº¦æå¿«ï¼ˆçº³ç§’çº§ï¼‰ï¼Œä¸”æ— å­—ç¬¦é›†æˆ–æ’åºè§„åˆ™ï¼ˆCollationï¼‰çš„é¢å¤–å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼šB-treeç´¢å¼•å¯¹è¿ç»­æ•°å€¼çš„èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚&lt;code&gt;BETWEEN 1000 AND 2000&lt;/code&gt;ï¼‰æœ‰å¤©ç„¶ä¼˜åŠ¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stringç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦å¤„ç†å¼€é”€&lt;/strong&gt;ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒéœ€é€å­—ç¬¦åŒ¹é…ï¼Œæ¶‰åŠå¤§å°å†™æ•æ„Ÿ/ä¸æ•æ„Ÿè§„åˆ™ï¼ˆå¦‚PostgreSQLé»˜è®¤åŒºåˆ†å¤§å°å†™ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‰ç¼€ç´¢å¼•é™åˆ¶&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€ç´¢å¼•ï¼ˆå¦‚&lt;code&gt;VARCHAR(255)&lt;/code&gt;ï¼‰ï¼Œå¯èƒ½å› æ•°æ®åˆ†å¸ƒä¸å‡å¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ’åºå¤æ‚åº¦&lt;/strong&gt;ï¼šå­—ç¬¦ä¸²æ’åºè§„åˆ™ï¼ˆå¦‚æŒ‰å­—å…¸åºï¼‰æ¯”æ•´æ•°æ’åºæ›´å¤æ‚ï¼Œå½±å“&lt;code&gt;ORDER BY&lt;/code&gt;æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç´¢å¼•ç»´æŠ¤ä¸æ›´æ–°æˆæœ¬"&gt;ç´¢å¼•ç»´æŠ¤ä¸æ›´æ–°æˆæœ¬
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Longç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°é«˜æ•ˆ&lt;/strong&gt;ï¼šæ•°å€¼å‹å­—æ®µæ›´æ–°é€šå¸¸ä¸æ”¹å˜æ•°æ®é•¿åº¦ï¼Œç´¢å¼•èŠ‚ç‚¹å¯åŸåœ°ä¿®æ”¹ï¼Œå‡å°‘é¡µåˆ†è£‚å’Œç¢ç‰‡åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘ä¼˜åŠ¿&lt;/strong&gt;ï¼šåœ¨å†™å…¥å¯†é›†å‹åœºæ™¯ä¸­ï¼ˆå¦‚è®¡æ•°å™¨ï¼‰ï¼Œæ•´æ•°ç´¢å¼•çš„é”ç«äº‰æ›´ä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stringç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å˜é•¿å­—æ®µå¼€é”€&lt;/strong&gt;ï¼šå­—ç¬¦ä¸²é•¿åº¦å˜åŒ–å¯èƒ½è§¦å‘ç´¢å¼•é¡µåˆ†è£‚ï¼ˆå°¤å…¶æ˜¯VARCHARï¼‰ï¼Œå¯¼è‡´å†™æ“ä½œå»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°è¿é”ååº”&lt;/strong&gt;ï¼šä¿®æ”¹å­—ç¬¦ä¸²å€¼å¯èƒ½å½±å“ç´¢å¼•æ ‘ä¸­å¤šä¸ªèŠ‚ç‚¹ï¼ˆå¦‚Hashç´¢å¼•éœ€é‡æ–°è®¡ç®—åˆ†å¸ƒï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®åº“ç±»å‹å·®å¼‚"&gt;æ•°æ®åº“ç±»å‹å·®å¼‚
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ç±»å‹æ”¯æŒ&lt;/strong&gt;ï¼šæ”¯æŒGINï¼ˆå…¨æ–‡æœç´¢ï¼‰ã€GiSTï¼ˆåœ°ç†æ•°æ®ï¼‰ç­‰é«˜çº§ç´¢å¼•ï¼Œå¯ä¼˜åŒ–ç‰¹å®šå­—ç¬¦ä¸²åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JSONBç´¢å¼•&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨JSONBå­—æ®µä¸­çš„å­—ç¬¦ä¸²é”®ä½œä¸ºç´¢å¼•ï¼Œå»ºè®®ç»“åˆGINç´¢å¼•ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MySQL&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¦†ç›–ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;ï¼šæ•´æ•°è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰æ›´å®¹æ˜“å®ç°ï¼Œå‡å°‘å›è¡¨æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜è¡¨é™åˆ¶&lt;/strong&gt;ï¼šä¸´æ—¶è¡¨ä¸­VARCHARä¼šè¢«è½¬æ¢ä¸ºCHARï¼Œå¯èƒ½æµªè´¹å†…å­˜ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µå»ºè®®"&gt;å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨Long&lt;/strong&gt;ï¼šè‹¥å­—æ®µæœ¬èº«ä¸ºæ•°å€¼å‹ï¼ˆå¦‚IDã€æ—¶é—´æˆ³ï¼‰ï¼Œå¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¼šæ˜¾è‘—é™ä½æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦ä¸²ä¼˜åŒ–ç­–ç•¥&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å®šé•¿å­—æ®µ&lt;/strong&gt;ï¼šä¼˜å…ˆç”¨CHARä»£æ›¿VARCHARï¼ˆå¦‚å›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹ç¼©ä¸ç¼–ç &lt;/strong&gt;ï¼šå¯¹é•¿å­—ç¬¦ä¸²ä½¿ç”¨å‹ç¼©ç®—æ³•ï¼ˆå¦‚MySQLçš„COMPRESS()ï¼‰ï¼Œæˆ–è½¬æ¢ä¸ºæ•°å€¼ï¼ˆå¦‚CRC32å“ˆå¸Œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ä¸æµ‹è¯•&lt;/strong&gt;ï¼šé€šè¿‡æ‰§è¡Œè®¡åˆ’ï¼ˆEXPLAINï¼‰åˆ†æç´¢å¼•æ•ˆç‡ï¼Œç»“åˆå®é™…æ•°æ®é‡è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å·®å¼‚æ€»ç»“"&gt;æ€§èƒ½å·®å¼‚æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç»´åº¦&lt;/th&gt;
&lt;th&gt;Longç±»å‹ä¼˜åŠ¿&lt;/th&gt;
&lt;th&gt;Stringç±»å‹åŠ£åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´å ç”¨å°ï¼Œç´¢å¼•å±‚çº§ä½&lt;/td&gt;
&lt;td&gt;å˜é•¿å­—æ®µå¯èƒ½æµªè´¹ç©ºé—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥è¯¢é€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ¯”è¾ƒæ“ä½œå¿«ï¼ŒèŒƒå›´æŸ¥è¯¢é«˜æ•ˆ&lt;/td&gt;
&lt;td&gt;å­—ç¬¦å¤„ç†å¤æ‚ï¼Œå‰ç¼€åŒ¹é…æ•ˆç‡ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»´æŠ¤æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´æ–°å¼€é”€å°ï¼Œç¢ç‰‡åŒ–å°‘&lt;/td&gt;
&lt;td&gt;é¡µåˆ†è£‚é£é™©é«˜ï¼Œæ›´æ–°å»¶è¿Ÿå¤§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸»é”®ã€å¤–é”®ã€è®¡æ•°å™¨ã€èŒƒå›´æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;çŸ­æ–‡æœ¬ã€å“ˆå¸Œå€¼ã€å›ºå®šé•¿åº¦æ ‡è¯†ç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼ŒLongç±»å‹ä½œä¸ºç´¢å¼•çš„æ€§èƒ½ä¼˜äºStringç±»å‹ï¼Œå°¤å…¶åœ¨æ•°æ®é‡å¤§ã€æŸ¥è¯¢é¢‘ç¹æˆ–å†™å…¥å¯†é›†çš„ç¯å¢ƒä¸­ã€‚è‹¥å¿…é¡»ä½¿ç”¨å­—ç¬¦ä¸²ç´¢å¼•ï¼Œéœ€é€šè¿‡å®šé•¿è®¾è®¡ã€å­—ç¬¦é›†ä¼˜åŒ–å’Œé«˜çº§ç´¢å¼•ç±»å‹ï¼ˆå¦‚PostgreSQLçš„GINï¼‰å¼¥è¡¥æ€§èƒ½å·®è·ã€‚&lt;/p&gt;
&lt;h2 id="spring-cloud-gateway-æ— æ•°æ®æº"&gt;Spring Cloud Gateway æ— æ•°æ®æº
&lt;/h2&gt;&lt;p&gt;ä½ çš„Spring Cloud Gatewayç½‘å…³æœåŠ¡å¯åŠ¨æ—¶æŠ¥é”™ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯Spring Bootè‡ªåŠ¨é…ç½®æœºåˆ¶å°è¯•åˆå§‹åŒ–æ•°æ®æºï¼Œä½†ç½‘å…³æœ¬èº«å¹¶ä¸éœ€è¦æ•°æ®åº“è¿æ¥ã€‚ä»¥ä¸‹æ˜¯åˆ†æ­¥è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;h3 id="æ’é™¤æ•°æ®æºè‡ªåŠ¨é…ç½®æ¨èæ–¹æ¡ˆ"&gt;æ’é™¤æ•°æ®æºè‡ªåŠ¨é…ç½®ï¼ˆæ¨èæ–¹æ¡ˆï¼‰
&lt;/h3&gt;&lt;p&gt;åœ¨ç½‘å…³æœåŠ¡çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ &lt;code&gt;exclude = DataSourceAutoConfiguration.class&lt;/code&gt;å‚æ•°ï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exclude&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;DataSourceAutoConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;GatewayApplication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpringApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GatewayApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="æ£€æŸ¥ä¾èµ–å†²çª"&gt;æ£€æŸ¥ä¾èµ–å†²çª
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’æŸ¥æ˜¯å¦å­˜åœ¨æ•°æ®åº“ç›¸å…³ä¾èµ–&lt;/strong&gt;&lt;br&gt;
æ£€æŸ¥&lt;code&gt;pom.xml/gradle&lt;/code&gt;æ–‡ä»¶ä¸­æ˜¯å¦è¯¯å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;spring-boot-starter-jdbc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;spring-boot-starter-data-jpa&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚&lt;code&gt;mysql-connector-java&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‹¥å­˜åœ¨ï¼Œéœ€é€šè¿‡&lt;code&gt;&amp;lt;exclusions&amp;gt;&lt;/code&gt;æ’é™¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-web&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;exclusions&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;exclusion&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-jdbc&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;/exclusion&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;/exclusions&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¡®ä¿ç½‘å…³ä¾èµ–æ­£ç¡®&lt;/strong&gt;&lt;br&gt;
ç½‘å…³æœåŠ¡åªéœ€ä¿ç•™æ ¸å¿ƒä¾èµ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-gateway&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="éªŒè¯é…ç½®æ–‡ä»¶"&gt;éªŒè¯é…ç½®æ–‡ä»¶
&lt;/h3&gt;&lt;p&gt;è‹¥é¡¹ç›®ä¸­ç¡®å®éœ€è¦éƒ¨åˆ†æ•°æ®æºé…ç½®ï¼ˆéå¸¸è§„æƒ…å†µï¼‰ï¼Œéœ€å®Œæ•´é…ç½®æ•°æ®åº“è¿æ¥å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;datasource&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;jdbc:mysql://localhost:3306/mydb&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;username&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;root&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;123456&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;driver-class-name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;com.mysql.cj.jdbc.Driver&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥"&gt;ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
&lt;/h3&gt;&lt;p&gt;è‹¥ä¸Šè¿°æ–¹æ³•æ— æ•ˆï¼Œéœ€æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Spring Bootä¸Spring Cloudç‰ˆæœ¬éœ€åŒ¹é…ï¼ˆå¦‚Spring Cloud 2023.xéœ€æ­é…Spring Boot 3.xï¼‰&lt;/li&gt;
&lt;li&gt;ç¡®ä¿&lt;code&gt;reactor-netty&lt;/code&gt;ç‰ˆæœ¬å…¼å®¹ï¼ˆå‚è€ƒç½‘é¡µ2æ¡ˆä¾‹ï¼Œå¯å°è¯•å‡çº§åˆ°0.9.14.RELEASEï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="è¡¥å……éªŒè¯æ­¥éª¤"&gt;è¡¥å……éªŒè¯æ­¥éª¤
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;æ¸…ç†Mavenæœ¬åœ°ä»“åº“ï¼ˆ&lt;code&gt;~/.m2/repository&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥æ˜¯å¦è¯¯æ¿€æ´»äº†&lt;code&gt;dev&lt;/code&gt;ç­‰åŒ…å«æ•°æ®åº“é…ç½®çš„Profile&lt;/li&gt;
&lt;li&gt;åˆ é™¤&lt;code&gt;application.properties/yml&lt;/code&gt;ä¸­æ‰€æœ‰ä¸æ•°æ®åº“ç›¸å…³çš„é…ç½®é¡¹&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œ90%ä»¥ä¸Šçš„åŒç±»é—®é¢˜å¯å¾—åˆ°è§£å†³ã€‚è‹¥ä»å­˜åœ¨é—®é¢˜ï¼Œå»ºè®®åœ¨å¯åŠ¨æ—¶æ·»åŠ è°ƒè¯•å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;java -jar your-gateway.jar --debug
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§‚å¯Ÿæ—¥å¿—ä¸­æ•°æ®æºåˆå§‹åŒ–ç›¸å…³çš„å †æ ˆä¿¡æ¯ï¼Œè¿›ä¸€æ­¥å®šä½å…·ä½“å†²çªæºã€‚&lt;/p&gt;
&lt;h2 id="spring-data-jpa-å‘½åè§„èŒƒ"&gt;Spring Data JPA å‘½åè§„èŒƒ
&lt;/h2&gt;&lt;p&gt;Spring Data JPA çš„æ–¹æ³•å‘½åè§„èŒƒé€šè¿‡é¢„å®šä¹‰çš„å…³é”®è¯å’Œå±æ€§ç»„åˆè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢é€»è¾‘ï¼Œæå¤§ç®€åŒ–äº†æ•°æ®åº“æ“ä½œã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè§„åˆ™åŠå®è·µè¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•å‰ç¼€ä¸åŸºæœ¬æŸ¥è¯¢ç±»å‹"&gt;&lt;strong&gt;æ–¹æ³•å‰ç¼€ä¸åŸºæœ¬æŸ¥è¯¢ç±»å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ–¹æ³•åä»¥ç‰¹å®šå‰ç¼€å¼€å¤´ï¼Œç”¨äºå£°æ˜æ“ä½œç±»å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;findBy&lt;/code&gt;/&lt;code&gt;readBy&lt;/code&gt;/&lt;code&gt;getBy&lt;/code&gt;&lt;/strong&gt;ï¼šæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼ˆä¸‰è€…åŠŸèƒ½ç›¸ä¼¼ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;countBy&lt;/code&gt;&lt;/strong&gt;ï¼šç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°é‡ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;deleteBy&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ é™¤ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;existsBy&lt;/code&gt;&lt;/strong&gt;ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;distinctBy&lt;/code&gt;&lt;/strong&gt;ï¼šå»é‡æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByLastName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastName&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢å§“æ°åŒ¹é…çš„ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;countByAgeGreaterThan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»Ÿè®¡å¹´é¾„å¤§äºæŸå€¼çš„ç”¨æˆ·æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å±æ€§å‘½åä¸å¤šæ¡ä»¶ç»„åˆ"&gt;&lt;strong&gt;å±æ€§å‘½åä¸å¤šæ¡ä»¶ç»„åˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å±æ€§åŒ¹é…è§„åˆ™&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;By&lt;/code&gt;åçš„å­—æ®µåéœ€ä¸å®ä½“ç±»å±æ€§&lt;strong&gt;ä¸¥æ ¼ä¸€è‡´&lt;/strong&gt;ï¼ˆé©¼å³°å¼å‘½åï¼‰ï¼Œå¦‚å®ä½“æœ‰&lt;code&gt;firstName&lt;/code&gt;å­—æ®µï¼Œåˆ™æ–¹æ³•åä¸º&lt;code&gt;findByFirstName&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ¡ä»¶è¿æ¥&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦&lt;code&gt;And&lt;/code&gt;/&lt;code&gt;Or&lt;/code&gt;æ‹¼æ¥å¤šä¸ªå±æ€§ï¼Œå‚æ•°é¡ºåºéœ€ä¸æ–¹æ³•åä¸­çš„å­—æ®µé¡ºåºä¸€è‡´ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByFirstNameAndLastName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;firstName&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lastName&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ANDæ¡ä»¶æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByFirstNameOrEmail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;firstName&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ORæ¡ä»¶æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ¯”è¾ƒæ“ä½œç¬¦ä¸å¤æ‚æŸ¥è¯¢"&gt;&lt;strong&gt;æ¯”è¾ƒæ“ä½œç¬¦ä¸å¤æ‚æŸ¥è¯¢&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ–¹æ³•åæ”¯æŒé€šè¿‡å…³é”®è¯å®ç°æ¡ä»¶ç­›é€‰ï¼Œå¸¸ç”¨æ“ä½œç¬¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;GreaterThan&lt;/code&gt;/&lt;code&gt;LessThan&lt;/code&gt;&lt;/strong&gt;ï¼šæ•°å€¼æ¯”è¾ƒï¼ˆ&lt;code&gt;&amp;gt;&lt;/code&gt;/&lt;code&gt;&amp;lt;&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Between&lt;/code&gt;&lt;/strong&gt;ï¼šåŒºé—´æŸ¥è¯¢ï¼ˆ&lt;code&gt;BETWEEN ?1 AND ?2&lt;/code&gt;ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Like&lt;/code&gt;/&lt;code&gt;NotLike&lt;/code&gt;&lt;/strong&gt;ï¼šæ¨¡ç³ŠåŒ¹é…ï¼ˆéœ€æ‰‹åŠ¨æ·»åŠ &lt;code&gt;%&lt;/code&gt;é€šé…ç¬¦ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;IsNull&lt;/code&gt;/&lt;code&gt;IsNotNull&lt;/code&gt;&lt;/strong&gt;ï¼šç©ºå€¼åˆ¤æ–­ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;In&lt;/code&gt;/&lt;code&gt;NotIn&lt;/code&gt;&lt;/strong&gt;ï¼šé›†åˆå†…åŒ¹é…ï¼ˆå‚æ•°ä¸º&lt;code&gt;Collection&lt;/code&gt;ç±»å‹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByAgeBetween&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;min&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¹´é¾„åœ¨[min, max]ä¹‹é—´çš„ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByLastNameLike&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pattern&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡ç³ŠåŒ¹é…å§“æ°ï¼ˆå¦‚&amp;#34;%son%&amp;#34;ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByFirstNameIn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;names&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åå­—åœ¨æŒ‡å®šé›†åˆä¸­çš„ç”¨æˆ·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ’åºä¸åˆ†é¡µæ§åˆ¶"&gt;&lt;strong&gt;æ’åºä¸åˆ†é¡µæ§åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’åº&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨&lt;code&gt;OrderBy&lt;/code&gt;åæ¥å±æ€§åå’Œæ–¹å‘ï¼ˆ&lt;code&gt;Asc&lt;/code&gt;/&lt;code&gt;Desc&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByFirstNameOrderByLastNameDesc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‰å§“æ°é™åºæ’åˆ—&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†é¡µä¸é™åˆ¶ç»“æœæ•°&lt;/strong&gt;&lt;br&gt;
ç»“åˆ&lt;code&gt;Top&lt;/code&gt;/&lt;code&gt;First&lt;/code&gt;å’Œæ•°å­—é™åˆ¶è¿”å›æ¡æ•°ï¼Œå¦‚&lt;code&gt;findTop10ByAge&lt;/code&gt;ã€‚&lt;br&gt;
åˆ†é¡µæŸ¥è¯¢é€šå¸¸éœ€ç»“åˆ&lt;code&gt;Pageable&lt;/code&gt;å‚æ•°è¿”å›&lt;code&gt;Page&amp;lt;T&amp;gt;&lt;/code&gt;ç±»å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è¿”å›ç±»å‹ä¸èšåˆæŸ¥è¯¢"&gt;&lt;strong&gt;è¿”å›ç±»å‹ä¸èšåˆæŸ¥è¯¢&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›ç±»å‹&lt;/strong&gt;ï¼šæ”¯æŒ&lt;code&gt;List&amp;lt;T&amp;gt;&lt;/code&gt;ã€&lt;code&gt;Optional&amp;lt;T&amp;gt;&lt;/code&gt;ã€&lt;code&gt;Page&amp;lt;T&amp;gt;&lt;/code&gt;ã€&lt;code&gt;Long&lt;/code&gt;ï¼ˆç»Ÿè®¡ç»“æœï¼‰ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èšåˆæ“ä½œ&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;sumBy&lt;/code&gt;ã€&lt;code&gt;avgBy&lt;/code&gt;ã€&lt;code&gt;maxBy&lt;/code&gt;ç­‰å®ç°èšåˆè®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Optional&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findFirstByName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å›é¦–ä¸ªåŒ¹é…ç»“æœï¼ˆå¯èƒ½ä¸ºç©ºï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;countByStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»Ÿè®¡çŠ¶æ€åŒ¹é…çš„è®°å½•æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…¶ä»–é«˜çº§ç‰¹æ€§"&gt;&lt;strong&gt;å…¶ä»–é«˜çº§ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»é‡æŸ¥è¯¢&lt;/strong&gt;ï¼š&lt;code&gt;findDistinctByLastName&lt;/code&gt;å¯å»é™¤é‡å¤è®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶é—´èŒƒå›´æŸ¥è¯¢&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;After&lt;/code&gt;/&lt;code&gt;Before&lt;/code&gt;åŒ¹é…æ—¶é—´å­—æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-11"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Spring Data JPA çš„å‘½åè§„èŒƒé€šè¿‡&lt;strong&gt;è¯­ä¹‰åŒ–æ–¹æ³•å&lt;/strong&gt;è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢ï¼Œå¼€å‘è€…éœ€éµå¾ªå‰ç¼€å…³é”®è¯ã€å±æ€§åŒ¹é…ã€æ“ä½œç¬¦ç»„åˆç­‰è§„åˆ™ã€‚å¯¹äºå¤æ‚åœºæ™¯ï¼ˆå¦‚åŠ¨æ€æ¡ä»¶æˆ–è”è¡¨æŸ¥è¯¢ï¼‰ï¼Œå¯ç»“åˆ&lt;code&gt;@Query&lt;/code&gt;æ³¨è§£ç¼–å†™è‡ªå®šä¹‰ JPQLã€‚åˆç†åˆ©ç”¨å‘½åè§„èŒƒèƒ½æ˜¾è‘—å‡å°‘æ ·æ¿ä»£ç ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id="spring-cloud-gateway-1"&gt;Spring Cloud Gateway
&lt;/h2&gt;&lt;p&gt;è§åšå®¢&lt;/p&gt;
&lt;h2 id="userid-åŠ å¯†"&gt;UserId åŠ å¯†
&lt;/h2&gt;&lt;p&gt;è§åšå®¢&lt;/p&gt;
&lt;h2 id="å­è¡¨ç­–ç•¥"&gt;å­è¡¨ç­–ç•¥
&lt;/h2&gt;&lt;p&gt;åœ¨ JPA ä¸­ï¼Œé™¤äº† &lt;strong&gt;SINGLE_TABLEï¼ˆå•è¡¨ç»§æ‰¿ç­–ç•¥ï¼‰&lt;/strong&gt;ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸¤ç§ç»§æ‰¿ç­–ç•¥ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-joinedè¿æ¥è¡¨ç­–ç•¥"&gt;&lt;strong&gt;1. JOINEDï¼ˆè¿æ¥è¡¨ç­–ç•¥ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒå®ç°&lt;/strong&gt;&lt;br&gt;
çˆ¶ç±»å’Œå­ç±»åˆ†åˆ«æ˜ å°„åˆ°ä¸åŒçš„æ•°æ®åº“è¡¨ã€‚çˆ¶ç±»è¡¨å­˜å‚¨å…¬å…±å­—æ®µï¼Œå­ç±»è¡¨ä»…å­˜å‚¨æ‰©å±•å­—æ®µï¼Œå¹¶é€šè¿‡å¤–é”®å…³è”çˆ¶ç±»è¡¨çš„ä¸»é”®ï¼ˆå…±äº«ä¸»é”®ï¼‰ã€‚éœ€åœ¨çˆ¶ç±»ä¸Šæ ‡æ³¨ &lt;code&gt;@Inheritance(strategy = InheritanceType.JOINED)&lt;/code&gt;ï¼Œå¹¶é€šè¿‡ &lt;code&gt;@DiscriminatorColumn&lt;/code&gt; å’Œ &lt;code&gt;@DiscriminatorValue&lt;/code&gt; åŒºåˆ†ç±»å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;br&gt;
çˆ¶ç±» &lt;code&gt;Animal&lt;/code&gt; å’Œå­ç±» &lt;code&gt;Bird&lt;/code&gt; çš„æ˜ å°„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Inheritance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InheritanceType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;JOINED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DiscriminatorColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;AAA&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Animal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DiscriminatorValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Bird&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;t_bird&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bird&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Animal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;speed&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆçš„è¡¨ç»“æ„ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;T_ANIMAL&lt;/code&gt;ï¼ˆçˆ¶è¡¨ï¼‰ï¼š&lt;code&gt;ID, NAME, AAA&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T_BIRD&lt;/code&gt;ï¼ˆå­è¡¨ï¼‰ï¼š&lt;code&gt;IDï¼ˆå¤–é”®å…³è”çˆ¶è¡¨ï¼‰, SPEED&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šè¡¨ç»“æ„è§„èŒƒï¼Œé¿å…ç©ºå­—æ®µå†—ä½™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šæŸ¥è¯¢éœ€å¤šè¡¨è¿æ¥ï¼Œæ€§èƒ½è¾ƒä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-table_"&gt;&lt;strong&gt;2. TABLE_PER_CLASSï¼ˆæ¯ä¸ªç±»ç‹¬ç«‹è¡¨ç­–ç•¥ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒå®ç°&lt;/strong&gt;&lt;br&gt;
æ¯ä¸ªå…·ä½“å­ç±»ï¼ˆéæŠ½è±¡ç±»ï¼‰æ˜ å°„åˆ°ç‹¬ç«‹çš„è¡¨ï¼Œè¡¨ä¸­åŒ…å«çˆ¶ç±»çš„æ‰€æœ‰å­—æ®µå’Œè‡ªèº«æ‰©å±•å­—æ®µã€‚çˆ¶ç±»éœ€æ ‡æ³¨ &lt;code&gt;@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Inheritance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InheritanceType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TABLE_PER_CLASS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;abstract&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Vehicle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;speed&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;t_car&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Car&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vehicle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆçš„è¡¨ç»“æ„ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;T_VEHICLE&lt;/code&gt;ï¼ˆçˆ¶ç±»è¡¨ï¼‰ï¼š&lt;code&gt;ID, SPEED&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;T_CAR&lt;/code&gt;ï¼ˆå­ç±»è¡¨ï¼‰ï¼š&lt;code&gt;ID, SPEED, ENGINE&lt;/code&gt;ï¼ˆåŒ…å«çˆ¶ç±»å­—æ®µï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šè¡¨ç»“æ„ç®€å•ï¼ŒæŸ¥è¯¢æ—¶æ— éœ€è”è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šæ•°æ®å†—ä½™ï¼ˆçˆ¶ç±»å­—æ®µé‡å¤å­˜å‚¨ï¼‰ï¼Œä¸»é”®ç”Ÿæˆç­–ç•¥å—é™ï¼ˆä¸æ”¯æŒ &lt;code&gt;AUTO&lt;/code&gt; æˆ– &lt;code&gt;IDENTITY&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¶ä»–è¡¥å……mappedsuperclasséç»§æ‰¿ç­–ç•¥"&gt;&lt;strong&gt;å…¶ä»–è¡¥å……ï¼š@MappedSuperclassï¼ˆéç»§æ‰¿ç­–ç•¥ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸æ˜¯ç»§æ‰¿ç­–ç•¥ï¼Œè€Œæ˜¯ä¸€ç§ä»£ç å¤ç”¨æœºåˆ¶ã€‚çˆ¶ç±»æ ‡æ³¨ &lt;code&gt;@MappedSuperclass&lt;/code&gt; åï¼Œå…¶å­—æ®µä¼šè¢«å­ç±»æ˜ å°„åˆ°è¡¨ä¸­ï¼Œä½†çˆ¶ç±»æœ¬èº«ä¸æ˜ å°„ä¸ºç‹¬ç«‹è¡¨ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@MappedSuperclass&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;abstract&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseEntity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;t_user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BaseEntity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userName&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå¤šä¸ªå­ç±»éœ€å…±äº«å…¬å…±å­—æ®µï¼ˆå¦‚ &lt;code&gt;id&lt;/code&gt;ã€&lt;code&gt;createTime&lt;/code&gt;ï¼‰ï¼Œä½†æ— éœ€çˆ¶ç±»ç‹¬ç«‹å­˜å‚¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç­–ç•¥å¯¹æ¯”"&gt;&lt;strong&gt;ç­–ç•¥å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç­–ç•¥&lt;/th&gt;
&lt;th&gt;è¡¨æ•°é‡&lt;/th&gt;
&lt;th&gt;æ•°æ®å†—ä½™&lt;/th&gt;
&lt;th&gt;æŸ¥è¯¢æ€§èƒ½&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SINGLE_TABLE&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ç®€å•ç»§æ‰¿ã€å­—æ®µå·®å¼‚å°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;JOINED&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;N+1&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;ç»“æ„è§„èŒƒã€å­—æ®µå·®å¼‚å¤§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;TABLE_PER_CLASS&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;å­ç±»ç‹¬ç«‹æ€§é«˜ã€éœ€ç‹¬ç«‹æŸ¥è¯¢&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šé€‰æ‹©ç­–ç•¥æ—¶éœ€æƒè¡¡æ€§èƒ½ã€æ•°æ®å†—ä½™å’Œç»´æŠ¤æˆæœ¬ã€‚è‹¥éœ€å¤šæ€æŸ¥è¯¢ï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;SINGLE_TABLE&lt;/code&gt; æˆ– &lt;code&gt;JOINED&lt;/code&gt;ï¼›è‹¥å­ç±»ç‹¬ç«‹æ€§é«˜ï¼Œå¯é€‰ &lt;code&gt;TABLE_PER_CLASS&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="superbuilder"&gt;@SuperBuilder
&lt;/h2&gt;&lt;p&gt;é’ˆå¯¹å­ç±» Builder æ— æ³•è®¿é—®çˆ¶ç±»å­—æ®µçš„é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯è§£å†³æ–¹æ¡ˆåŠè¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é—®é¢˜æ ¹æº"&gt;é—®é¢˜æ ¹æº
&lt;/h3&gt;&lt;p&gt;Lombok çš„ &lt;code&gt;@Builder&lt;/code&gt; æ³¨è§£é»˜è®¤ä»…å¤„ç†å½“å‰ç±»çš„å±æ€§ï¼Œ&lt;strong&gt;ä¸ä¼šè‡ªåŠ¨åŒ…å«çˆ¶ç±»å­—æ®µ&lt;/strong&gt;ã€‚å½“å­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œå­ç±»ç”Ÿæˆçš„ Builder ç¼ºå°‘çˆ¶ç±»å­—æ®µçš„é“¾å¼æ–¹æ³•ï¼Œå¯¼è‡´æ— æ³•é€šè¿‡ Builder åˆå§‹åŒ–çˆ¶ç±»å±æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆ"&gt;è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="ä½¿ç”¨-æ¨è"&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@SuperBuilder&lt;/code&gt; æ³¨è§£&lt;/strong&gt;ï¼ˆæ¨èï¼‰
&lt;/h4&gt;&lt;p&gt;Lombok åœ¨ &lt;strong&gt;1.18.2+&lt;/strong&gt; ç‰ˆæœ¬ä¸­å¼•å…¥ &lt;code&gt;@SuperBuilder&lt;/code&gt;ï¼Œä¸“é—¨è§£å†³ç»§æ‰¿åœºæ™¯ä¸‹çš„ Builder é—®é¢˜ã€‚å®ƒä¼šä¸ºçˆ¶ç±»å’Œå­ç±»ç”Ÿæˆå…¼å®¹çš„ Builderï¼Œæ”¯æŒé“¾å¼è®¾ç½®çˆ¶ç±»å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ­¥éª¤ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çˆ¶ç±»å’Œå­ç±»å‡æ ‡æ³¨ &lt;code&gt;@SuperBuilder&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// çˆ¶ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SuperBuilder&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Vote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;startAt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// å­ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SuperBuilder&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SpaceVote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;second&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒç”¨ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;SpaceVote&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1L&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çˆ¶ç±»å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;startAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;now&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;first&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­ç±»å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨å¤„ç†ç»§æ‰¿å±‚çº§ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ„é€ å‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒé»˜è®¤å€¼ï¼ˆç»“åˆ &lt;code&gt;@Builder.Default&lt;/code&gt;ï¼‰å’Œæµ…æ‹·è´ï¼ˆ&lt;code&gt;toBuilder = true&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿ Lombok ç‰ˆæœ¬ â‰¥1.18.2ï¼Œå¹¶åœ¨ IDE ä¸­å¯ç”¨æ³¨è§£å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;çˆ¶ç±»å’Œå­ç±»å¿…é¡»åŒæ—¶ä½¿ç”¨ &lt;code&gt;@SuperBuilder&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ‰‹åŠ¨å®šä¹‰å…¨å‚æ„é€ å™¨--å…¼å®¹æ—§ç‰ˆæœ¬"&gt;&lt;strong&gt;æ‰‹åŠ¨å®šä¹‰å…¨å‚æ„é€ å™¨ + &lt;code&gt;@Builder&lt;/code&gt;&lt;/strong&gt;ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
&lt;/h4&gt;&lt;p&gt;è‹¥æ— æ³•å‡çº§ Lombokï¼Œå¯é€šè¿‡æ‰‹åŠ¨ç¼–å†™å…¨å‚æ„é€ å™¨å®ç°çˆ¶ç±»å­—æ®µçš„ä¼ é€’ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ­¥éª¤ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çˆ¶ç±»æ·»åŠ å…¨å‚æ„é€ å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@NoArgsConstructor&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@AllArgsConstructor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç”Ÿæˆå…¨å‚æ„é€ å™¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Vote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* å­—æ®µç•¥ */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­ç±»æ‰‹åŠ¨ç¼–å†™å…¨å‚æ„é€ å™¨å¹¶æ ‡æ³¨ &lt;code&gt;@Builder&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;builderMethodName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;childBuilder&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SpaceVote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;second&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰‹åŠ¨ç¼–å†™æ„é€ å™¨ï¼ˆåŒ…å«çˆ¶ç±»å­—æ®µï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SpaceVote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;startAt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;second&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;startAt&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;first&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;second&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;second&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒç”¨ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;SpaceVote&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;childBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1L&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çˆ¶ç±»å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;startAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;now&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;first&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­ç±»å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çˆ¶ç±»å­—æ®µå˜åŠ¨æ—¶éœ€åŒæ­¥ä¿®æ”¹å­ç±»æ„é€ å™¨ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç å†—ä½™ï¼Œä¸å¤Ÿç®€æ´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¶ä»–æ³¨æ„äº‹é¡¹"&gt;å…¶ä»–æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…æ··åˆä½¿ç”¨ &lt;code&gt;@Builder&lt;/code&gt; å’Œ &lt;code&gt;@SuperBuilder&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
è‹¥çˆ¶ç±»ä½¿ç”¨ &lt;code&gt;@Builder&lt;/code&gt;ï¼Œå­ç±»ä½¿ç”¨ &lt;code&gt;@SuperBuilder&lt;/code&gt; ä¼šå¯¼è‡´å†²çªï¼Œéœ€ç»Ÿä¸€ç­–ç•¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤„ç†é»˜è®¤å€¼&lt;/strong&gt;&lt;br&gt;
è‹¥çˆ¶ç±»å­—æ®µéœ€è¦é»˜è®¤å€¼ï¼Œå¯åœ¨çˆ¶ç±»æ„é€ å‡½æ•°æˆ–å­—æ®µä¸Šä½¿ç”¨ &lt;code&gt;@Builder.Default&lt;/code&gt;ï¼ˆä»…é™ &lt;code&gt;@SuperBuilder&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@SuperBuilder&lt;/code&gt; æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œéƒ¨åˆ†æ—§ç‰ˆæœ¬å¯èƒ½å­˜åœ¨ BUGï¼ˆå¦‚ç±»åå†²çªï¼‰ï¼Œå»ºè®®å‡çº§è‡³ &lt;strong&gt;1.18.12+&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-12"&gt;æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;@SuperBuilder&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Lombok â‰¥1.18.2ï¼Œç»§æ‰¿å±‚çº§å¤æ‚&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨å¤„ç†çˆ¶ç±»å­—æ®µï¼Œä»£ç ç®€æ´&lt;/td&gt;
&lt;td&gt;éœ€ç‰ˆæœ¬æ”¯æŒï¼Œé…ç½®ä¾èµ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰‹åŠ¨æ„é€ å™¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ—§ç‰ˆæœ¬å…¼å®¹ï¼Œç®€å•ç»§æ‰¿ç»“æ„&lt;/td&gt;
&lt;td&gt;æ— éœ€å‡çº§ Lombok&lt;/td&gt;
&lt;td&gt;ç»´æŠ¤æˆæœ¬é«˜ï¼Œä»£ç å†—ä½™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@SuperBuilder&lt;/code&gt;&lt;/strong&gt;ï¼Œè‹¥å—é™äºç‰ˆæœ¬æˆ–ç‰¹æ®Šéœ€æ±‚ï¼Œå†é€‰æ‹©æ‰‹åŠ¨æ„é€ å™¨æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="è¿æ¥å¤æ‚åº¦"&gt;è¿æ¥å¤æ‚åº¦
&lt;/h2&gt;&lt;p&gt;æ•°æ®åº“è¿æ¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¦è¾¾åˆ° O(mn) å–å†³äºå…·ä½“çš„è¿æ¥ç®—æ³•å’Œæ•°æ®ç‰¹å¾ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¼ ç»Ÿè¿æ¥ç®—æ³•çš„å¤æ‚åº¦åˆ†æ"&gt;ä¼ ç»Ÿè¿æ¥ç®—æ³•çš„å¤æ‚åº¦åˆ†æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆNested Loop Joinï¼‰&lt;/strong&gt;&lt;br&gt;
è¿™æ˜¯æœ€åŸºç¡€çš„è¿æ¥æ–¹å¼ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸º &lt;strong&gt;O(mÃ—n)&lt;/strong&gt;ï¼Œå…¶ä¸­ m å’Œ n æ˜¯å‚ä¸è¿æ¥çš„ä¸¤ä¸ªè¡¨çš„å¤§å°ã€‚ç®—æ³•é€šè¿‡éå†ä¸¤ä¸ªè¡¨çš„æ¯ä¸€è¡Œè¿›è¡ŒåŒ¹é…ï¼Œåœ¨æ— ç´¢å¼•çš„æƒ…å†µä¸‹æ•ˆç‡è¾ƒä½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“ˆå¸Œè¿æ¥ï¼ˆHash Joinï¼‰&lt;/strong&gt;&lt;br&gt;
å“ˆå¸Œè¿æ¥çš„&lt;strong&gt;å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(m + n)&lt;/strong&gt;ï¼Œå‰ææ˜¯è¾ƒå°çš„è¡¨èƒ½å®Œå…¨æ”¾å…¥å†…å­˜ã€‚ç®—æ³•åˆ†ä¸ºä¸¤æ­¥ï¼šå¯¹è¾ƒå°è¡¨å»ºç«‹å“ˆå¸Œè¡¨ï¼ˆO(m)ï¼‰ï¼Œç„¶åæ‰«æè¾ƒå¤§è¡¨è¿›è¡ŒåŒ¹é…ï¼ˆO(n)ï¼‰ã€‚ä½†åœ¨å“ˆå¸Œå†²çªä¸¥é‡æ—¶ï¼Œå¯èƒ½é€€åŒ–ä¸º O(mn)ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’åºåˆå¹¶è¿æ¥ï¼ˆSort-Merge Joinï¼‰&lt;/strong&gt;&lt;br&gt;
è‹¥è¡¨å·²é¢„å…ˆæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(m + n)ï¼›è‹¥æœªæ’åºï¼Œæ’åºé˜¶æ®µçš„å¤æ‚åº¦ä¸º O(m log m + n log n)ï¼Œæ•´ä½“å¤æ‚åº¦ä»‹äº O(m log m + n log n) åˆ° O(m + n) ä¹‹é—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç°ä»£ä¼˜åŒ–ç®—æ³•ä¸æœ€åæƒ…å†µåˆ†æ"&gt;ç°ä»£ä¼˜åŒ–ç®—æ³•ä¸æœ€åæƒ…å†µåˆ†æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ€åæƒ…å†µæœ€ä¼˜è¿æ¥ï¼ˆWCOJï¼‰&lt;/strong&gt;&lt;br&gt;
é’ˆå¯¹å¤šè¡¨è¿æ¥åœºæ™¯ï¼Œä¼ ç»ŸäºŒå…ƒè¿æ¥çš„ä¸­é—´ç»“æœå¯èƒ½çˆ†ç‚¸å¼å¢é•¿ï¼ˆä¾‹å¦‚ä¸‰è§’å½¢è¿æ¥å¯èƒ½äº§ç”Ÿ O(mÂ³) ä¸­é—´ç»“æœï¼‰ã€‚è€Œ &lt;strong&gt;WCOJ ç®—æ³•ï¼ˆå¦‚ Leapfrog Triejoinï¼‰çš„å¤æ‚åº¦ä¸æœ€ç»ˆç»“æœé›†å¤§å°çº¿æ€§ç›¸å…³&lt;/strong&gt;ï¼Œè€Œéè¾“å…¥æ•°æ®çš„ä¹˜ç§¯ï¼Œç†è®ºä¸Šå¯é¿å… O(mn) çš„å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Lookup &amp;amp; Expand ä¼˜åŒ–æ¡†æ¶&lt;/strong&gt;&lt;br&gt;
é€šè¿‡å°†è¿æ¥æ‹†åˆ†ä¸ºæŸ¥æ‰¾ï¼ˆLookupï¼‰å’Œæ‰©å±•ï¼ˆExpandï¼‰ä¸¤æ­¥ï¼Œæå‰ç»ˆæ­¢æ— æ•ˆåŒ¹é…ï¼Œå‡å°‘ä¸­é—´ç»“æœè§„æ¨¡ã€‚å®éªŒè¡¨æ˜ï¼Œè¯¥æ–¹æ³•åœ¨å¤æ‚æŸ¥è¯¢ä¸­æ€§èƒ½ä¼˜äºä¼ ç»Ÿç®—æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®é™…æ€§èƒ½å½±å“å› ç´ "&gt;å®é™…æ€§èƒ½å½±å“å› ç´ 
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•çš„ä½œç”¨&lt;/strong&gt;&lt;br&gt;
åœ¨è¿æ¥åˆ—ä¸Šåˆ›å»ºç´¢å¼•å¯å°†å¤æ‚åº¦ä» O(mn) é™è‡³ &lt;strong&gt;O(m log n)&lt;/strong&gt; æˆ–æ›´ä½ã€‚ä¾‹å¦‚ï¼ŒB+æ ‘ç´¢å¼•çš„æŸ¥æ‰¾å¤æ‚åº¦ä¸º O(log n)ï¼Œæ˜¾è‘—æå‡è¿æ¥æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åˆ†å¸ƒä¸æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å€¾æ–œæ•°æ®&lt;/strong&gt;ï¼šè‹¥è¿æ¥é”®åˆ†å¸ƒä¸å‡ï¼ˆå¦‚çƒ­ç‚¹å€¼ï¼‰ï¼Œå“ˆå¸Œè¿æ¥å¯èƒ½é€€åŒ–ä¸º O(mn)ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–å™¨å†³ç­–&lt;/strong&gt;ï¼šæ•°æ®åº“ä¼˜åŒ–å™¨ä¼šæ ¹æ®ç»Ÿè®¡ä¿¡æ¯è‡ªåŠ¨é€‰æ‹©è¿æ¥ç®—æ³•ï¼Œå¯èƒ½è§„é¿æœ€åå¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¡¬ä»¶ä¸ç½‘ç»œå»¶è¿Ÿ&lt;/strong&gt;&lt;br&gt;
è™½ç„¶ç®—æ³•å¤æ‚åº¦æ˜¯ç†è®ºæŒ‡æ ‡ï¼Œä½†å®é™…è€—æ—¶è¿˜å—ç½‘ç»œä¼ è¾“ï¼ˆå¦‚è¿œç¨‹æ•°æ®åº“è¿æ¥ï¼‰ã€å†…å­˜å¸¦å®½ç­‰å› ç´ å½±å“ã€‚ä¾‹å¦‚ï¼Œä¸€æ¬¡ MySQL è¿æ¥çš„å»ºç«‹è¿‡ç¨‹å¯èƒ½æ¶ˆè€— 150-225msï¼Œè¿œè¶…ç®—æ³•æœ¬èº«çš„è®¡ç®—æ—¶é—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¤æ‚åº¦æ€»ç»“"&gt;å¤æ‚åº¦æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç®—æ³•/åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ—¶é—´å¤æ‚åº¦&lt;/th&gt;
&lt;th&gt;é€‚ç”¨æ¡ä»¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆæ— ç´¢å¼•ï¼‰&lt;/td&gt;
&lt;td&gt;O(mÃ—n)&lt;/td&gt;
&lt;td&gt;å°è¡¨é©±åŠ¨å¤§è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å“ˆå¸Œè¿æ¥ï¼ˆç†æƒ³æƒ…å†µï¼‰&lt;/td&gt;
&lt;td&gt;O(m + n)&lt;/td&gt;
&lt;td&gt;å†…å­˜å……è¶³ã€å“ˆå¸Œå†²çªå°‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ’åºåˆå¹¶è¿æ¥ï¼ˆå·²æ’åºï¼‰&lt;/td&gt;
&lt;td&gt;O(m + n)&lt;/td&gt;
&lt;td&gt;æ•°æ®æœ‰åºæˆ–ç´¢å¼•æ”¯æŒæ’åº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WCOJ ç®—æ³•&lt;/td&gt;
&lt;td&gt;O(ç»“æœé›†å¤§å°)&lt;/td&gt;
&lt;td&gt;å¤šè¡¨è¿æ¥ã€é¿å…ä¸­é—´ç»“æœçˆ†ç‚¸&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–å»ºè®®"&gt;ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ä¼˜å…ˆ&lt;/strong&gt;ï¼šåœ¨è¿æ¥åˆ—å’Œç­›é€‰æ¡ä»¶åˆ—ä¸Šåˆ›å»ºå¤åˆç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©é«˜æ•ˆç®—æ³•&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;EXPLAIN&lt;/code&gt; åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œå¼ºåˆ¶ä½¿ç”¨å“ˆå¸Œæˆ–æ’åºåˆå¹¶è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶ç»“æœé›†&lt;/strong&gt;ï¼šæ·»åŠ  &lt;code&gt;WHERE&lt;/code&gt; æ¡ä»¶å‡å°‘å‚ä¸è¿æ¥çš„æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿æ¥æ± é…ç½®&lt;/strong&gt;ï¼šå¤ç”¨è¿æ¥å‡å°‘å»ºç«‹/å…³é—­çš„å¼€é”€ï¼ˆå¯é™ä½ 90% çš„è€—æ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œ&lt;strong&gt;æ•°æ®åº“è¿æ¥æ“ä½œçš„å¤æ‚åº¦å¹¶éå›ºå®šä¸º O(mn)&lt;/strong&gt;ï¼Œé€šè¿‡ç®—æ³•ä¼˜åŒ–ã€ç´¢å¼•è®¾è®¡ã€ç»Ÿè®¡ä¿¡æ¯å¼•å¯¼ç­‰æ‰‹æ®µï¼Œå¯æ˜¾è‘—é™ä½å®é™…æ‰§è¡Œä»£ä»·ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 13</title><link>https://dyhes.github.io/p/postopia-dev-logweek-13/</link><pubDate>Mon, 05 May 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-13/</guid><description>&lt;p&gt;todo for now&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;del&gt;æ™ºèƒ½æ€»ç»“&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ”¹é€ &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="http://mp.weixin.qq.com/s?__biz=MzA4MDc3MzE1NQ==&amp;amp;mid=2653999326&amp;amp;idx=3&amp;amp;sn=1bdd6fa1a24f8b21edc120309eee1bd5&amp;amp;chksm=85e9ad7e7cf0c40642f302b82e270295d3752e45cd74c8839503bf94b05f6a4a256978021edc#rd" target="_blank" rel="noopener"
&gt;Spring Boot + Vue3 Post SSE + WebFlux å®ç°æµå¼ AI å¯¹è¯&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="sseæµ"&gt;SSEæµ
&lt;/h2&gt;&lt;p&gt;åœ¨Spring BootæœåŠ¡ç«¯ä¸­ï¼Œé€šè¿‡CURLå‘é€è¯·æ±‚å¹¶å¤„ç†SSEï¼ˆServer-Sent Eventsï¼‰æµå¼è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦ç»“åˆ&lt;strong&gt;æœåŠ¡ç«¯SSEå®ç°&lt;/strong&gt;ä¸&lt;strong&gt;å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘æœºåˆ¶&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æœåŠ¡ç«¯å®ç°sseæ¨é€"&gt;æœåŠ¡ç«¯å®ç°SSEæ¨é€
&lt;/h3&gt;&lt;h4 id="ä½¿ç”¨sseemitteråˆ›å»ºsseæ¥å£"&gt;ä½¿ç”¨&lt;code&gt;SseEmitter&lt;/code&gt;åˆ›å»ºSSEæ¥å£
&lt;/h4&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;SseEmitter&lt;/code&gt;å®ç°æœåŠ¡ç«¯æ¨é€èƒ½åŠ›ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ä¼šåˆ›å»ºä¸€ä¸ªé•¿è¿æ¥ï¼Œæ”¯æŒæµå¼è¿”å›æ•°æ®ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SseController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitters&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentHashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/stream&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;produces&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TEXT_EVENT_STREAM_VALUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;streamData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1L&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è®¾ç½®æ— é™è¶…æ—¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;randomUUID&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›‘å¬è¿æ¥å…³é—­æˆ–è¶…æ—¶äº‹ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;onCompletion&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;onTimeout&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="è½¬å‘å¤–éƒ¨sseæµåˆ°å®¢æˆ·ç«¯"&gt;è½¬å‘å¤–éƒ¨SSEæµåˆ°å®¢æˆ·ç«¯
&lt;/h4&gt;&lt;p&gt;æœåŠ¡ç«¯ä½œä¸ºå®¢æˆ·ç«¯ï¼Œé€šè¿‡&lt;code&gt;OkHttp&lt;/code&gt;è¯·æ±‚å¤–éƒ¨SSEæœåŠ¡ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®è½¬å‘ç»™å‰ç«¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;forwardExternalSSE&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;externalUrl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;externalUrl&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EventSource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eventSource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EventSources&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createFactory&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newEventSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EventSourceListener&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EventSource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eventSource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;event&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è½¬å‘æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;completeWithError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onFailure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EventSource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eventSource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitters&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clientId&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;completeWithError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å®¢æˆ·ç«¯é€šè¿‡curlæµ‹è¯•"&gt;å®¢æˆ·ç«¯é€šè¿‡CURLæµ‹è¯•
&lt;/h3&gt;&lt;h4 id="å‘é€curlè¯·æ±‚"&gt;å‘é€CURLè¯·æ±‚
&lt;/h4&gt;&lt;p&gt;å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤è®¢é˜…æœåŠ¡ç«¯çš„SSEæµï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -v http://localhost:8080/stream
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯ä¼šè¿”å›&lt;code&gt;text/event-stream&lt;/code&gt;æ ¼å¼çš„å“åº”å¤´ï¼Œå¹¶æŒç»­æ¨é€æ•°æ®ã€‚&lt;/p&gt;
&lt;h4 id="å¤„ç†æµå¼å“åº”"&gt;å¤„ç†æµå¼å“åº”
&lt;/h4&gt;&lt;p&gt;å®¢æˆ·ç«¯ä¼šä»¥äº‹ä»¶æµå½¢å¼æ¥æ”¶æ•°æ®ï¼Œæ ¼å¼ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;data: {&amp;#34;message&amp;#34;: &amp;#34;Event 1&amp;#34;}
data: {&amp;#34;message&amp;#34;: &amp;#34;Event 2&amp;#34;}
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="å…³é”®é…ç½®ä¸æ³¨æ„äº‹é¡¹"&gt;å…³é”®é…ç½®ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–é…ç½®&lt;/strong&gt;&lt;br&gt;
éœ€æ·»åŠ &lt;code&gt;spring-boot-starter-web&lt;/code&gt;å’Œ&lt;code&gt;OkHttp&lt;/code&gt;ç›¸å…³ä¾èµ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.okhttp3&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;okhttp-sse&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;4.10.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¶…æ—¶ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å¤–éƒ¨SSEæœåŠ¡ä¸­æ–­ï¼Œéœ€é€šè¿‡&lt;code&gt;SseEmitter.onError()&lt;/code&gt;é€šçŸ¥å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;SseEmitter(-1L)&lt;/code&gt;ç¦ç”¨é»˜è®¤è¶…æ—¶ï¼Œé¿å…å› é•¿æ—¶é—´æ— æ•°æ®è§¦å‘&lt;code&gt;AsyncRequestTimeoutException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šå®¢æˆ·ç«¯æ”¯æŒ&lt;/strong&gt;&lt;br&gt;
é€šè¿‡&lt;code&gt;ConcurrentHashMap&lt;/code&gt;ç®¡ç†å¤šä¸ª&lt;code&gt;SseEmitter&lt;/code&gt;å®ä¾‹ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤–éƒ¨SSEè¿æ¥å¤±è´¥æ—¶ï¼Œè°ƒç”¨&lt;code&gt;emitter.completeWithError()&lt;/code&gt;ç»ˆæ­¢å®¢æˆ·ç«¯è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€æ—¶ï¼Œè§¦å‘&lt;code&gt;onCompletion()&lt;/code&gt;æ¸…ç†èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®Œæ•´æµç¨‹ç¤ºä¾‹"&gt;å®Œæ•´æµç¨‹ç¤ºä¾‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl http://localhost:8080/stream
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç«¯è¡Œä¸º&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º&lt;code&gt;SseEmitter&lt;/code&gt;å¹¶æ³¨å†Œåˆ°ç®¡ç†å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯åŠ¨&lt;code&gt;OkHttp&lt;/code&gt;è®¢é˜…å¤–éƒ¨SSEæœåŠ¡ï¼ˆå¦‚å¤§æ¨¡å‹APIï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å°†å¤–éƒ¨äº‹ä»¶å®æ—¶è½¬å‘è‡³å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®æµä¼ é€’&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;å¤–éƒ¨æœåŠ¡ -&amp;gt; Spring BootæœåŠ¡ç«¯ -&amp;gt; å®¢æˆ·ç«¯
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–å»ºè®®"&gt;ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥éé˜»å¡&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;WebFlux&lt;/code&gt;çš„&lt;code&gt;Flux&amp;lt;ServerSentEvent&amp;gt;&lt;/code&gt;æ›¿ä»£&lt;code&gt;SseEmitter&lt;/code&gt;ï¼Œå®ç°å“åº”å¼æµå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯å‹ç¼©&lt;/strong&gt;ï¼šå¯¹é«˜é¢‘æ•°æ®å¯ç”¨GZIPå‹ç¼©ï¼Œå‡å°‘ç½‘ç»œè´Ÿè½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿ƒè·³æœºåˆ¶&lt;/strong&gt;ï¼šå®šæœŸå‘é€ç©ºäº‹ä»¶ä¿æŒè¿æ¥æ´»è·ƒï¼Œé¿å…è¢«ä»£ç†æœåŠ¡å™¨ä¸­æ–­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯å®ç°åœ¨Spring Bootä¸­é€šè¿‡CURLè¯·æ±‚è§¦å‘æœåŠ¡ç«¯SSEæ¨é€ï¼Œå¹¶å®Œæˆæµå¼æ•°æ®çš„ä¸­è½¬ã€‚å…·ä½“å®ç°éœ€ç»“åˆä¸šåŠ¡åœºæ™¯è°ƒæ•´è¶…æ—¶å’Œé”™è¯¯å¤„ç†é€»è¾‘ã€‚&lt;/p&gt;
&lt;h2 id="webfluxä¸sseemitter"&gt;WebFluxä¸SseEmitter
&lt;/h2&gt;&lt;p&gt;åœ¨Springç”Ÿæ€ä¸­ï¼Œ&lt;strong&gt;WebFlux&lt;/strong&gt;å’Œ&lt;strong&gt;SseEmitter&lt;/strong&gt;å‡èƒ½å®ç°æœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼ˆSSEï¼‰ï¼Œä½†ä¸¤è€…åœ¨æŠ€æœ¯å®ç°ã€æ€§èƒ½è¡¨ç°åŠé€‚ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="åº•å±‚æŠ€æœ¯ä¸ç¼–ç¨‹æ¨¡å‹"&gt;&lt;strong&gt;åº•å±‚æŠ€æœ¯ä¸ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WebFlux&lt;/strong&gt;&lt;br&gt;
åŸºäºReactorå“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œé‡‡ç”¨&lt;strong&gt;éé˜»å¡I/O&lt;/strong&gt;ï¼ˆå¦‚Nettyæˆ–Reactor-Nettyï¼‰ï¼Œé€šè¿‡&lt;code&gt;Flux&amp;lt;ServerSentEvent&amp;gt;&lt;/code&gt;å¤„ç†æ•°æ®æµã€‚å¼€å‘è€…é€šè¿‡å£°æ˜å¼ä»£ç ç»„åˆæµæ“ä½œï¼ˆå¦‚&lt;code&gt;map&lt;/code&gt;ã€&lt;code&gt;filter&lt;/code&gt;ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ï¼Œå¤©ç„¶æ”¯æŒèƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶ï¼Œé¿å…æ•°æ®è¿‡è½½ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/sse-flux&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ServerSentEvent&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleSseFlux&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;interval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofMillis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sequence&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerSentEvent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SSE in WebFlux - &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sequence&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SseEmitter&lt;/strong&gt;&lt;br&gt;
å±äºSpring MVCæ¡†æ¶ï¼Œä¾èµ–&lt;strong&gt;Servletçš„å¼‚æ­¥å¤„ç†æœºåˆ¶&lt;/strong&gt;ï¼ˆé˜»å¡I/Oæ¨¡å‹ï¼‰ï¼Œéœ€æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± æˆ–å¼‚æ­¥ä»»åŠ¡æ¨é€æ•°æ®ã€‚ç¼–ç¨‹æ¨¡å‹ä¸ºåŒæ­¥æ¨¡å¼ï¼Œå¼€å‘è€…éœ€è‡ªè¡Œå¤„ç†çº¿ç¨‹è°ƒåº¦ä¸èµ„æºé‡Šæ”¾ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/sse-mvc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleSse&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SseEmitter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30_000L&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Event &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;complete&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* å¼‚å¸¸å¤„ç† */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="na"&gt;start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emitter&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="å¹¶å‘èƒ½åŠ›ä¸èµ„æºæ¶ˆè€—"&gt;&lt;strong&gt;å¹¶å‘èƒ½åŠ›ä¸èµ„æºæ¶ˆè€—&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WebFlux&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜å¹¶å‘&lt;/strong&gt;ï¼šåŸºäºEventLoopçº¿ç¨‹æ¨¡å‹ï¼Œå•çº¿ç¨‹å¯å¤„ç†æ•°ä¸‡è¿æ¥ï¼Œé€‚åˆIoTã€å®æ—¶èŠå¤©ç­‰é«˜å¹¶å‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½èµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼šå ç”¨å°‘é‡çº¿ç¨‹ï¼ˆå¦‚CPUæ ¸å¿ƒæ•°ï¼‰ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SseEmitter&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½å¹¶å‘&lt;/strong&gt;ï¼šæ¯ä¸ªè¿æ¥å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹æ± å®¹é‡é™åˆ¶å¯¼è‡´å¹¶å‘ä¸Šé™ä½ï¼ˆé€šå¸¸æ•°ç™¾è‡³æ•°åƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜èµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼šçº¿ç¨‹æ•°éšè¿æ¥æ•°çº¿æ€§å¢é•¿ï¼Œæ˜“å¼•å‘èµ„æºè€—å°½é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="åè®®æ”¯æŒä¸æ‰©å±•æ€§"&gt;&lt;strong&gt;åè®®æ”¯æŒä¸æ‰©å±•æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WebFlux&lt;/strong&gt;&lt;br&gt;
æ”¯æŒå¤šç§åè®®ï¼š&lt;strong&gt;SSE&lt;/strong&gt;ã€&lt;strong&gt;WebSocket&lt;/strong&gt;ã€HTTP/2ç­‰ï¼Œå¯çµæ´»é€‚é…ä¸åŒå®æ—¶é€šä¿¡éœ€æ±‚ã€‚æ­¤å¤–ï¼Œæ— ç¼é›†æˆå“åº”å¼ç”Ÿæ€ç»„ä»¶ï¼ˆå¦‚R2DBCã€WebClientï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SseEmitter&lt;/strong&gt;&lt;br&gt;
ä»…æ”¯æŒSSEåè®®ï¼ŒåŠŸèƒ½å•ä¸€ï¼Œæ‰©å±•æ€§å—é™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="é”™è¯¯å¤„ç†ä¸èƒŒå‹æœºåˆ¶"&gt;&lt;strong&gt;é”™è¯¯å¤„ç†ä¸èƒŒå‹æœºåˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WebFlux&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èƒŒå‹æ”¯æŒ&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;Flux&lt;/code&gt;è‡ªåŠ¨è°ƒèŠ‚æ•°æ®æµé€Ÿï¼Œé˜²æ­¢å®¢æˆ·ç«¯è¿‡è½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥å£®çš„é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼šæä¾›&lt;code&gt;onErrorResume&lt;/code&gt;ç­‰æ“ä½œç¬¦ï¼Œå¯é“¾å¼å®šä¹‰å¼‚å¸¸æ¢å¤é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SseEmitter&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— èƒŒå‹æ§åˆ¶&lt;/strong&gt;ï¼šéœ€å¼€å‘è€…è‡ªè¡Œå®ç°æµé‡é™åˆ¶é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼šä¾èµ–&lt;code&gt;try-catch&lt;/code&gt;æ•è·å¼‚å¸¸å¹¶é€šè¿‡&lt;code&gt;emitter.completeWithError()&lt;/code&gt;é€šçŸ¥å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;WebFlux&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜å¹¶å‘å®æ—¶åº”ç”¨ï¼ˆå¦‚è‚¡ç¥¨è¡Œæƒ…ã€AIå¯¹è¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ¶æ„ä¸‹çš„æµå¼æ•°æ®å¤„ç†ï¼ˆå¦‚æ—¥å¿—æ¨é€ã€å®æ—¶ç›‘æ§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SseEmitter&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ ç»ŸSpring MVCé¡¹ç›®ä¸­çš„ç®€å•æ¨é€éœ€æ±‚ï¼ˆå¦‚ä½é¢‘ç‡é€šçŸ¥ã€å°å‹åº”ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å¯¹æ¯”è¡¨"&gt;æ€»ç»“å¯¹æ¯”è¡¨
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;WebFlux (&lt;code&gt;Flux&lt;/code&gt;)&lt;/th&gt;
&lt;th&gt;SseEmitter&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº•å±‚æŠ€æœ¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éé˜»å¡I/Oï¼ˆReactor-Nettyï¼‰&lt;/td&gt;
&lt;td&gt;é˜»å¡I/Oï¼ˆServletå¼‚æ­¥ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¼–ç¨‹æ¨¡å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å£°æ˜å¼å“åº”å¼ç¼–ç¨‹&lt;/td&gt;
&lt;td&gt;åŒæ­¥ç¼–ç¨‹ï¼Œéœ€æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¹¶å‘èƒ½åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒ10K+è¿æ¥&lt;/td&gt;
&lt;td&gt;å—é™äºçº¿ç¨‹æ± å®¹é‡ï¼ˆé€šå¸¸&amp;lt;1Kï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆå°‘é‡EventLoopçº¿ç¨‹ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆæ¯ä¸ªè¿æ¥å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åè®®æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;SSEã€WebSocketã€HTTP/2ç­‰&lt;/td&gt;
&lt;td&gt;ä»…SSE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èƒŒå‹æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸç”Ÿæ”¯æŒ&lt;/td&gt;
&lt;td&gt;éœ€è‡ªè¡Œå®ç°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘å®æ—¶ç³»ç»Ÿã€å“åº”å¼å¾®æœåŠ¡&lt;/td&gt;
&lt;td&gt;ä¼ ç»ŸMVCåº”ç”¨ã€ä½é¢‘æ¨é€éœ€æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é€‰æ‹©å»ºè®®"&gt;é€‰æ‹©å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆWebFlux&lt;/strong&gt;ï¼šè‹¥é¡¹ç›®éœ€è¦é«˜å¹¶å‘ã€ä½å»¶è¿Ÿï¼Œæˆ–å·²é‡‡ç”¨å“åº”å¼æ¶æ„ï¼ˆå¦‚Spring Cloud Gatewayï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨SseEmitter&lt;/strong&gt;ï¼šä»…éœ€ç®€å•SSEåŠŸèƒ½ä¸”æ— æ³•è¿ç§»è‡³WebFluxçš„ä¼ ç»ŸSpring MVCé¡¹ç›®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸Šå¯¹æ¯”ï¼Œå¼€å‘è€…å¯æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚æŠ€æœ¯æ–¹æ¡ˆï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ä¸å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id="server-sent-eventssseç»“åˆ-spring-security"&gt;Server-Sent Eventsï¼ˆSSEï¼‰ç»“åˆ Spring Security
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Bootåº”ç”¨ä¸­ï¼Œå½“ä½¿ç”¨Server-Sent Eventsï¼ˆSSEï¼‰å¹¶ç»“åˆSpring Securityæ—¶ï¼Œé‡åˆ°&lt;code&gt;Unable to handle the Spring Security Exception because the response is already committed&lt;/code&gt;é”™è¯¯ï¼Œé€šå¸¸æ˜¯ç”±&lt;strong&gt;å“åº”æå‰æäº¤å¯¼è‡´å®‰å…¨å¼‚å¸¸å¤„ç†å†²çª&lt;/strong&gt;å¼•èµ·çš„ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é”™è¯¯åŸå› åˆ†æ"&gt;é”™è¯¯åŸå› åˆ†æ
&lt;/h3&gt;&lt;h4 id="å“åº”æå‰æäº¤"&gt;&lt;strong&gt;å“åº”æå‰æäº¤&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†&lt;code&gt;Flux.create&lt;/code&gt;å’Œ&lt;code&gt;CompletableFuture.runAsync&lt;/code&gt;å¼€å¯å¼‚æ­¥çº¿ç¨‹å¤„ç†SSEæµã€‚&lt;strong&gt;è‹¥å¼‚æ­¥çº¿ç¨‹ä¸­å·²ç»é€šè¿‡&lt;code&gt;sink&lt;/code&gt;å¼€å§‹å‘é€æ•°æ®ï¼ˆå³å“åº”ä½“å·²å¼€å§‹å†™å…¥ï¼‰ï¼Œè€ŒSpring Securityåœ¨è¿‡æ»¤å™¨é“¾ä¸­æ£€æµ‹åˆ°æœªè®¤è¯/æœªæˆæƒçš„è¯·æ±‚å¹¶å°è¯•æŠ›å‡ºå¼‚å¸¸&lt;/strong&gt;ï¼ˆå¦‚&lt;code&gt;AccessDeniedException&lt;/code&gt;ï¼‰ï¼Œæ­¤æ—¶å“åº”å¤´å¯èƒ½å·²éƒ¨åˆ†æäº¤ï¼Œå¯¼è‡´æ— æ³•ä¿®æ”¹çŠ¶æ€ç æˆ–é‡å®šå‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ‹¦æˆªå™¨ä¸å¼‚æ­¥çº¿ç¨‹çš„ç«äº‰æ¡ä»¶&lt;/strong&gt;ï¼šä¸»çº¿ç¨‹çš„Spring Securityè¿‡æ»¤å™¨ï¼ˆå¦‚&lt;code&gt;FilterSecurityInterceptor&lt;/code&gt;ï¼‰å¯èƒ½åœ¨å¼‚æ­¥çº¿ç¨‹å‘é€æ•°æ®åæ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶å“åº”å·²ä¸å¯ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="spring-securityé»˜è®¤è¡Œä¸ºå†²çª"&gt;&lt;strong&gt;Spring Securityé»˜è®¤è¡Œä¸ºå†²çª&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Securityå¯¹æœªè®¤è¯è¯·æ±‚ä¼šé‡å®šå‘åˆ°ç™»å½•é¡µï¼ˆçŠ¶æ€ç 302ï¼‰ï¼Œè€ŒSSEéœ€è¦ä¿æŒé•¿è¿æ¥ï¼ˆçŠ¶æ€ç 200ï¼‰ã€‚&lt;strong&gt;å“åº”å¤´çš„å†²çªä¼šå¯¼è‡´å¼‚å¸¸æ— æ³•æ­£ç¡®å¤„ç†&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆ"&gt;è§£å†³æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="é…ç½®spring-securityä»¥å…¼å®¹sse"&gt;&lt;strong&gt;é…ç½®Spring Securityä»¥å…¼å®¹SSE&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç¦ç”¨é»˜è®¤çš„é‡å®šå‘é€»è¾‘ï¼Œæ”¹ç”¨&lt;strong&gt;ç›´æ¥è¿”å›HTTPçŠ¶æ€ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableWebSecurity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SecurityConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SecurityFilterChain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;securityFilterChain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpSecurity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;authorizeHttpRequests&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;requestMatchers&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/summary&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;permitAll&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¹æ®éœ€æ±‚è°ƒæ•´æƒé™&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;anyRequest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;authenticated&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exceptionHandling&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¦ç”¨é‡å®šå‘ï¼Œç›´æ¥è¿”å›401/403çŠ¶æ€ç &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;authenticationEntryPoint&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;authException&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sendError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UNAUTHORIZED&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Unauthorized&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;accessDeniedHandler&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;accessDeniedException&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sendError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FORBIDDEN&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Forbidden&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;csrf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;csrf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;csrf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;disable&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¹æ®éœ€æ±‚å†³å®šæ˜¯å¦ç¦ç”¨CSRF&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="è°ƒæ•´å¼‚æ­¥å¤„ç†é€»è¾‘"&gt;&lt;strong&gt;è°ƒæ•´å¼‚æ­¥å¤„ç†é€»è¾‘&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç¡®ä¿&lt;strong&gt;å®‰å…¨éªŒè¯å®Œæˆåå†å¯åŠ¨å¼‚æ­¥ä»»åŠ¡&lt;/strong&gt;ï¼Œé¿å…å“åº”æå‰æäº¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;summary&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;produces&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TEXT_EVENT_STREAM_VALUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ServerSentEvent&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestParam&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åœ¨ä¸»çº¿ç¨‹å®Œæˆå®‰å…¨éªŒè¯åå†å¯åŠ¨å¼‚æ­¥ä»»åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SecurityContextHolder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContext&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthentication&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;SecurityContextHolder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContext&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthentication&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;isAuthenticated&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseStatusException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UNAUTHORIZED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æœªè®¤è¯&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;runAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;intelligenceService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¨¡å‹æ¨è"&gt;&lt;strong&gt;ä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é¿å…æ··åˆé˜»å¡å¼çº¿ç¨‹ï¼ˆå¦‚&lt;code&gt;CompletableFuture&lt;/code&gt;ï¼‰ä¸å“åº”å¼æµï¼ˆ&lt;code&gt;Flux&lt;/code&gt;ï¼‰ï¼Œæ”¹ç”¨&lt;code&gt;Schedulers&lt;/code&gt;æ§åˆ¶çº¿ç¨‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;summary&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;produces&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TEXT_EVENT_STREAM_VALUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ServerSentEvent&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@RequestParam&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;using&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;intelligenceService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;initSummary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆå§‹åŒ–èµ„æº&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Flux&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromIterable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getEvents&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;publishOn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Schedulers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;boundedElastic&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥å¤„ç†&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServerSentEvent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;doOnError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SSEæµå¼‚å¸¸&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å¤„ç†sseæµçš„å¼‚å¸¸"&gt;&lt;strong&gt;å¤„ç†SSEæµçš„å¼‚å¸¸&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;doOnError&lt;/code&gt;æ•è·å¹¶å¤„ç†å¼‚æ­¥æ“ä½œä¸­çš„å¼‚å¸¸ï¼Œé¿å…å“åº”æå‰å…³é—­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Sink&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isCancelled&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ£€æŸ¥sinkæ˜¯å¦å·²å…³é—­&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Event &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;complete&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sink&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseStatusException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;INTERNAL_SERVER_ERROR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å¤„ç†å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="éªŒè¯ä¸è°ƒè¯•"&gt;éªŒè¯ä¸è°ƒè¯•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•æœªè®¤è¯åœºæ™¯&lt;/strong&gt;ï¼šç›´æ¥è®¿é—®&lt;code&gt;/summary&lt;/code&gt;æ¥å£åº”è¿”å›401çŠ¶æ€ç ï¼Œè€Œéè§¦å‘SSEæµã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥çº¿ç¨‹æ¨¡å‹&lt;/strong&gt;ï¼šç¡®ä¿å¼‚æ­¥æ“ä½œåœ¨å®‰å…¨éªŒè¯é€šè¿‡åæ‰§è¡Œï¼ˆå¯é€šè¿‡æ—¥å¿—æˆ–æ–­ç‚¹éªŒè¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§å“åº”å¤´&lt;/strong&gt;ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚Postmanï¼‰ç¡®è®¤SSEå“åº”å¤´ä¸º&lt;code&gt;Content-Type: text/event-stream&lt;/code&gt;ä¸”çŠ¶æ€ç ä¸º200ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•å»ºè®®"&gt;æ‰©å±•å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šç»“åˆ&lt;code&gt;@ControllerAdvice&lt;/code&gt;å…¨å±€æ•è·SSEç›¸å…³å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å¼å®‰å…¨é…ç½®&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨WebFluxï¼Œéœ€é…ç½®&lt;code&gt;ReactiveSecurityWebFilterChain&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šä½¿ç”¨èƒŒå‹ï¼ˆBackpressureï¼‰æ§åˆ¶äº‹ä»¶æµé€Ÿï¼Œé¿å…èµ„æºè€—å°½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯è§£å†³SSEä¸Spring Securityçš„å“åº”æäº¤å†²çªé—®é¢˜ï¼ŒåŒæ—¶ä¿æŒæµå¼æ•°æ®çš„é«˜æ•ˆä¼ è¾“ã€‚&lt;/p&gt;
&lt;h2 id="spring-boot-è¯·æ±‚"&gt;Spring boot è¯·æ±‚
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Bootåº”ç”¨ä¸­å»ºç«‹ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å‡ ç§æ–¹æ³•åŠå…¶å®ç°æ­¥éª¤ï¼Œç»“åˆå®˜æ–¹æ¨èå’Œç¬¬ä¸‰æ–¹åº“è¿›è¡Œè¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨resttemplateåŒæ­¥è¯·æ±‚"&gt;&lt;strong&gt;ä½¿ç”¨RestTemplateï¼ˆåŒæ­¥è¯·æ±‚ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä¼ ç»ŸåŒæ­¥HTTPè¯·æ±‚ï¼Œé€‚åˆç®€å•æ¥å£è°ƒç”¨ã€‚&lt;br&gt;
&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;ï¼šç¡®ä¿&lt;code&gt;spring-boot-starter-web&lt;/code&gt;å·²å¼•å…¥ï¼ˆé»˜è®¤åŒ…å«ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®Bean&lt;/strong&gt;ï¼šåœ¨é…ç½®ç±»ä¸­å®šä¹‰&lt;code&gt;RestTemplate&lt;/code&gt;çš„Beanï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RestTemplateConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RestTemplate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;restTemplate&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RestTemplate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘é€è¯·æ±‚&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;GETè¯·æ±‚&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RestTemplate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;restTemplate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;https://api.example.com/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;restTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getForObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;POSTè¯·æ±‚&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;postData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;https://api.example.com/post&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;requestBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;requestBody&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;restTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;postForObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;requestBody&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šRestTemplateåœ¨Spring 5åè™½ä»å¯ç”¨ï¼Œä½†å®˜æ–¹æ¨èWebClientä½œä¸ºæ›¿ä»£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨webclientå¼‚æ­¥å“åº”å¼è¯·æ±‚"&gt;&lt;strong&gt;ä½¿ç”¨WebClientï¼ˆå¼‚æ­¥/å“åº”å¼è¯·æ±‚ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéé˜»å¡ã€å“åº”å¼ç¼–ç¨‹ï¼Œæ”¯æŒåŒæ­¥/å¼‚æ­¥è°ƒç”¨ã€‚&lt;br&gt;
&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;ï¼šå¼•å…¥&lt;code&gt;spring-boot-starter-webflux&lt;/code&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-webflux&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®Bean&lt;/strong&gt;ï¼šé€šè¿‡Builderè‡ªå®šä¹‰è¶…æ—¶ã€è¿æ¥æ± ç­‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WebClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;webClient&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WebClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;baseUrl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;https://api.example.com&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;defaultHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpHeaders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;CONTENT_TYPE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘é€è¯·æ±‚&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥è°ƒç”¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;syncGet&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;webClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;retrieve&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bodyToMono&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;block&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥è°ƒç”¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Mono&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;asyncGet&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;webClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;retrieve&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bodyToMono&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨feignå£°æ˜å¼httpå®¢æˆ·ç«¯"&gt;&lt;strong&gt;ä½¿ç”¨Feignï¼ˆå£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç®€åŒ–RESTfulæœåŠ¡è°ƒç”¨ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ã€‚&lt;br&gt;
&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ·»åŠ ä¾èµ–&lt;/strong&gt;ï¼šå¼•å…¥OpenFeignï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-cloud-starter-openfeign&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨Feign&lt;/strong&gt;ï¼šåœ¨å¯åŠ¨ç±»æ·»åŠ &lt;code&gt;@EnableFeignClients&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰æ¥å£&lt;/strong&gt;ï¼šå£°æ˜å¼è°ƒç”¨å¤–éƒ¨APIï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@FeignClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;externalApi&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;https://api.example.com&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;ExternalApiClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GetMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨å…¥ä½¿ç”¨&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExternalApiClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fetchData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¬¬ä¸‰æ–¹httpå®¢æˆ·ç«¯çµæ´»æ‰©å±•"&gt;&lt;strong&gt;ç¬¬ä¸‰æ–¹HTTPå®¢æˆ·ç«¯ï¼ˆçµæ´»æ‰©å±•ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="apache-httpclient"&gt;&lt;strong&gt;Apache HttpClient&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜åº¦å¯é…ç½®ï¼Œæ”¯æŒå¤æ‚è¯·æ±‚ï¼ˆå¦‚è¿æ¥æ± ã€é‡è¯•æœºåˆ¶ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CloseableHttpClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;httpClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpClients&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createDefault&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;HttpGet&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpGet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;https://api.example.com&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CloseableHttpResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;httpClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EntityUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getEntity&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="okhttp"&gt;&lt;strong&gt;OkHttp&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜æ€§èƒ½ï¼Œæ”¯æŒHTTP/2å’ŒWebSocketã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;https://api.example.com&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newCall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;enqueue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Callback&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;string&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é€‰æ‹©å»ºè®®-1"&gt;&lt;strong&gt;é€‰æ‹©å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥åœºæ™¯&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨WebClientæˆ–RestTemplateã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å“åº”å¼/é«˜å¹¶å‘&lt;/strong&gt;ï¼šWebClientï¼ˆæ”¯æŒéé˜»å¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¾®æœåŠ¡è°ƒç”¨&lt;/strong&gt;ï¼šFeignï¼ˆå£°æ˜å¼ç®€åŒ–ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚é…ç½®éœ€æ±‚&lt;/strong&gt;ï¼šApache HttpClientæˆ–OkHttpã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šé…ç½®ç»†èŠ‚ï¼ˆå¦‚è¶…æ—¶è®¾ç½®ã€æ‹¦æˆªå™¨ï¼‰å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–ç›¸å…³æœç´¢æ¥æºã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½ æ˜¯ä¸€ä¸ªè®ºå›å¸–å­å†…å®¹æ€»ç»“åŠ©æ‰‹ï¼Œç”¨æˆ·å°†ä¼šä»¥å½¢å¦‚{â€œpostTitleâ€:â€œå¸–å­åâ€,content:â€œå¸–å­å¼•è¨€â€,comments:[â€œè¯„è®ºå†…å®¹1â€,â€œè¯„è®ºå†…å®¹2â€]}çš„åºåˆ—åŒ–JSONå½¢å¼å‘é€å¸–å­ï¼Œè¯·ä½ å¸®åŠ©æ€»ç»“æ•´ä¸ªå¸–å­ï¼ˆåŒ…æ‹¬å†…å®¹å’Œè¯„è®ºï¼‰ï¼Œå¹¶æ€»ç»“å†…å®¹ä¸è¯„è®ºçš„æƒ…æ„Ÿæ€åº¦ï¼Œå¹¶ç»™å‡ºå„æ€åº¦çš„ç™¾åˆ†æ¯”ï¼Œè¯·ä»¥å½¢å¦‚{â€œaltitudesâ€:[{altitude: â€œå¼€å¿ƒâ€, percentage: â€œ50%â€}, {altitude: â€œæ„¤æ€’â€, percentage: â€œ20%â€},â€¦], â€œsummaryâ€: â€œè¿™ç¯‡å¸–å­è®¨è®ºäº†â€¦â€}çš„åºåˆ—åŒ–JSONæ ¼å¼è¿”å›å­—æ®µ&lt;/p&gt;
&lt;h2 id="applicationyamlæ›´æ–°é—®é¢˜"&gt;Application.yamlæ›´æ–°é—®é¢˜
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Bootåº”ç”¨éƒ¨ç½²åï¼Œä¿®æ”¹&lt;code&gt;application.yaml&lt;/code&gt;æ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘æˆ–é‡å¯ï¼Œå–å†³äºå…·ä½“çš„é…ç½®ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„è§£å†³æ–¹æ¡ˆå’Œå¯¹åº”æ“ä½œï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä»…ä¿®æ”¹å¤–éƒ¨é…ç½®æ–‡ä»¶å¹¶é‡å¯"&gt;&lt;strong&gt;ä»…ä¿®æ”¹å¤–éƒ¨é…ç½®æ–‡ä»¶å¹¶é‡å¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¦‚æœå°†é…ç½®æ–‡ä»¶æ”¾åœ¨&lt;strong&gt;å¤–éƒ¨ç›®å½•&lt;/strong&gt;ï¼ˆå¦‚ä¸JaråŒ…åŒçº§ç›®å½•çš„&lt;code&gt;config&lt;/code&gt;æ–‡ä»¶å¤¹æˆ–è‡ªå®šä¹‰è·¯å¾„ï¼‰ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶é€šè¿‡&lt;code&gt;--spring.config.location&lt;/code&gt;å‚æ•°æŒ‡å®šå…¶ä½ç½®ï¼Œåˆ™ä¿®æ”¹ååªéœ€&lt;strong&gt;é‡å¯åº”ç”¨&lt;/strong&gt;å³å¯ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°ç¼–è¯‘æ‰“åŒ…ã€‚&lt;br&gt;
&lt;strong&gt;æ“ä½œæ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†&lt;code&gt;application.yaml&lt;/code&gt;ç§»åŠ¨åˆ°JaråŒ…å¤–éƒ¨ï¼ˆå¦‚&lt;code&gt;/opt/app/config/&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ å‚æ•°ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;java -jar your-app.jar --spring.config.location&lt;span class="o"&gt;=&lt;/span&gt;file:/opt/app/config/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œé‡å¯åº”ç”¨å³å¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŠ¨æ€åˆ·æ–°é…ç½®æ— éœ€é‡å¯"&gt;&lt;strong&gt;åŠ¨æ€åˆ·æ–°é…ç½®ï¼ˆæ— éœ€é‡å¯ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡é›†æˆ&lt;strong&gt;Spring Cloud Config&lt;/strong&gt;æˆ–&lt;strong&gt;Spring Boot Actuator&lt;/strong&gt;ï¼Œå¯å®ç°é…ç½®çš„&lt;strong&gt;åŠ¨æ€åˆ·æ–°&lt;/strong&gt;ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚&lt;br&gt;
&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring Cloud Config&lt;/strong&gt;ï¼š&lt;br&gt;
å°†é…ç½®é›†ä¸­å­˜å‚¨åœ¨Gitç­‰ç‰ˆæœ¬åº“ä¸­ï¼Œé€šè¿‡&lt;code&gt;@RefreshScope&lt;/code&gt;æ³¨è§£åˆ·æ–°Beanï¼Œè°ƒç”¨&lt;code&gt;/actuator/refresh&lt;/code&gt;æ¥å£è§¦å‘æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨åˆ·æ–°&lt;/strong&gt;ï¼š&lt;br&gt;
ä½¿ç”¨&lt;code&gt;ContextRefresher&lt;/code&gt;ç±»ä¸»åŠ¨åˆ·æ–°é…ç½®ï¼ˆéœ€å¼•å…¥&lt;code&gt;spring-cloud-context&lt;/code&gt;ä¾èµ–ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ContextRefresher&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contextRefresher&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateConfig&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿®æ”¹å¤–éƒ¨é…ç½®æ–‡ä»¶å†…å®¹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contextRefresher&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;refresh&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§¦å‘é…ç½®åˆ·æ–°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¼€å‘ç¯å¢ƒçƒ­éƒ¨ç½²è‡ªåŠ¨é‡å¯"&gt;&lt;strong&gt;å¼€å‘ç¯å¢ƒçƒ­éƒ¨ç½²ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨&lt;code&gt;spring-boot-devtools&lt;/code&gt;å·¥å…·å¯å®ç°&lt;strong&gt;ä¿®æ”¹åè‡ªåŠ¨é‡å¯&lt;/strong&gt;ï¼ˆéç”Ÿäº§ç¯å¢ƒé€‚ç”¨ï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ·»åŠ ä¾èµ–ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-devtools&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;runtime&lt;span class="nt"&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼ŒIDEAä¼šè‡ªåŠ¨è§¦å‘åº”ç”¨é‡å¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘&lt;/strong&gt;ï¼š&lt;br&gt;
&lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;ã€‚æ— è®ºé‡‡ç”¨å¤–éƒ¨é…ç½®è¿˜æ˜¯åŠ¨æ€åˆ·æ–°ï¼Œå‡æ— éœ€é‡æ–°ç¼–è¯‘ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜¯å¦éœ€è¦é‡å¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥ä½¿ç”¨å¤–éƒ¨é…ç½®æ–‡ä»¶ä½†æœªé›†æˆåŠ¨æ€åˆ·æ–°ï¼Œéœ€&lt;strong&gt;æ‰‹åŠ¨é‡å¯åº”ç”¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥é€šè¿‡åŠ¨æ€åˆ·æ–°æˆ–çƒ­éƒ¨ç½²å·¥å…·ï¼Œåˆ™&lt;strong&gt;æ— éœ€é‡å¯&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å»ºè®®æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©æ–¹æ¡ˆï¼šç”Ÿäº§ç¯å¢ƒæ¨è&lt;strong&gt;å¤–éƒ¨é…ç½®+åŠ¨æ€åˆ·æ–°&lt;/strong&gt;ï¼Œå¼€å‘ç¯å¢ƒå¯ä½¿ç”¨çƒ­éƒ¨ç½²å·¥å…·ç®€åŒ–æµç¨‹ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopiaã€‘Recommendation</title><link>https://dyhes.github.io/p/postopiarecommendation/</link><pubDate>Tue, 29 Apr 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopiarecommendation/</guid><description>&lt;p&gt;åœ¨è®ºå›åº”ç”¨ä¸­å®ç°ä¸ªæ€§åŒ–æ¨èéœ€è¦ç»“åˆç”¨æˆ·è¡Œä¸ºåˆ†æã€å†…å®¹ç‰¹å¾æŒ–æ˜ä»¥åŠåŠ¨æ€åé¦ˆæœºåˆ¶ï¼Œä»¥ä¸‹æ˜¯å…·ä½“çš„å®ç°è·¯å¾„ä¸æŠ€æœ¯è¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®æ”¶é›†ä¸ç”¨æˆ·å»ºæ¨¡"&gt;&lt;strong&gt;æ•°æ®æ”¶é›†ä¸ç”¨æˆ·å»ºæ¨¡&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šç»´åº¦æ•°æ®é‡‡é›†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ˜¾æ€§æ•°æ®&lt;/strong&gt;ï¼šåŒ…æ‹¬ç”¨æˆ·æ³¨å†Œä¿¡æ¯ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€å…´è¶£æ ‡ç­¾ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éšæ€§æ•°æ®&lt;/strong&gt;ï¼šè®°å½•ç”¨æˆ·çš„æµè§ˆå†å²ã€å‘å¸–/å›å¸–å†…å®¹ã€ç‚¹èµ/æ”¶è—è¡Œä¸ºã€é¡µé¢åœç•™æ—¶é•¿ç­‰ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·é¢‘ç¹å‚ä¸æŸç±»è¯é¢˜è®¨è®ºï¼ˆå¦‚ç§‘æŠ€æˆ–ç¾é£Ÿï¼‰ï¼Œç³»ç»Ÿå¯æ ‡è®°å…¶å…´è¶£åå¥½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤¾äº¤å…³ç³»æ•°æ®&lt;/strong&gt;ï¼šåˆ†æç”¨æˆ·å…³æ³¨åˆ—è¡¨ã€äº’åŠ¨å¯¹è±¡åŠç¾¤ç»„å½’å±ï¼ŒæŒ–æ˜éšæ€§ç¤¾äº¤ç½‘ç»œç‰¹å¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æˆ·ç”»åƒæ„å»º&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡èšç±»ç®—æ³•å°†ç”¨æˆ·åˆ’åˆ†ä¸ºä¸åŒç¾¤ä½“ï¼ˆå¦‚â€œç§‘æŠ€çˆ±å¥½è€…â€â€œå½±è§†çˆ±å¥½è€…â€ï¼‰ï¼Œå¹¶æå–æ ‡ç­¾ï¼ˆåŸºç¡€å±æ€§ã€è¡Œä¸ºæ¨¡å¼ã€å…´è¶£å…³é”®è¯ï¼‰ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰è§£æç”¨æˆ·å‘å¸–å†…å®¹çš„å…³é”®è¯ï¼Œæ„å»ºå…´è¶£å›¾è°±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ¨èç®—æ³•é€‰æ‹©ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;æ¨èç®—æ³•é€‰æ‹©ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ååŒè¿‡æ»¤ç®—æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·ååŒè¿‡æ»¤&lt;/strong&gt;ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºç›¸ä¼¼åº¦æ¨èå†…å®¹ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·Aå’Œç”¨æˆ·Bå‡æ´»è·ƒäºâ€œç¼–ç¨‹è®¨è®ºåŒºâ€ï¼Œç³»ç»Ÿå¯å‘Aæ¨èBæµè§ˆè¿‡çš„çƒ­é—¨å¸–å­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¡¹ç›®ååŒè¿‡æ»¤&lt;/strong&gt;ï¼šåˆ†æå¸–å­ä¹‹é—´çš„å…³è”æ€§ã€‚è‹¥å¸–å­Xä¸Yå¸¸è¢«åŒä¸€ç”¨æˆ·æµè§ˆï¼Œåˆ™æ¨èç›¸å…³ä¸»é¢˜å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé€‚ç”¨äºç”¨æˆ·è¡Œä¸ºæ•°æ®ä¸°å¯Œçš„æƒ…å†µï¼Œä½†éœ€è§£å†³å†·å¯åŠ¨é—®é¢˜ï¼ˆæ–°ç”¨æˆ·æˆ–æ–°å¸–å­ç¼ºä¹æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºäºå†…å®¹çš„æ¨è&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¸–å­ç‰¹å¾æå–&lt;/strong&gt;ï¼šé€šè¿‡åˆ†è¯ã€ä¸»é¢˜æ¨¡å‹ï¼ˆå¦‚LDAï¼‰è§£æå¸–å­çš„ç±»åˆ«ï¼ˆå¦‚â€œæ¸¸æˆæ”»ç•¥â€â€œæ—¶äº‹çƒ­ç‚¹â€ï¼‰ã€å…³é”®è¯åŠæƒ…æ„Ÿå€¾å‘ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ›¾æµè§ˆâ€œPythonæ•™ç¨‹â€å¸–å­ï¼Œç³»ç»Ÿæ¨èå…¶ä»–å«â€œç¼–ç¨‹â€â€œä»£ç æ¡ˆä¾‹â€æ ‡ç­¾çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—&lt;/strong&gt;ï¼šåˆ©ç”¨TF-IDFæˆ–BERTæ¨¡å‹åŒ¹é…ç”¨æˆ·å…´è¶£æ ‡ç­¾ä¸å¸–å­å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆæ¨èç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ æƒèåˆ&lt;/strong&gt;ï¼šç»“åˆååŒè¿‡æ»¤ä¸å†…å®¹æ¨èçš„ç»“æœï¼ŒæŒ‰æƒé‡åˆ†é…ä¼˜å…ˆçº§ã€‚ä¾‹å¦‚ï¼Œ70%ååŒè¿‡æ»¤æ¨è+30%å†…å®¹æ¨èã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ·±åº¦å­¦ä¹ æ¨¡å‹&lt;/strong&gt;ï¼šä½¿ç”¨ç¥ç»ç½‘ç»œï¼ˆå¦‚Wide &amp;amp; Deepæ¨¡å‹ï¼‰æ•´åˆç”¨æˆ·ç”»åƒã€å¸–å­ç‰¹å¾åŠä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·ç™»å½•æ—¶æ®µã€è®¾å¤‡ç±»å‹ï¼‰ï¼Œæå‡æ¨èç²¾å‡†åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŠ¨æ€åé¦ˆä¸å®æ—¶ä¼˜åŒ–"&gt;&lt;strong&gt;åŠ¨æ€åé¦ˆä¸å®æ—¶ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®æ—¶è¡Œä¸ºè·Ÿè¸ª&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›‘æ§ç”¨æˆ·çš„å³æ—¶æ“ä½œï¼ˆå¦‚ç‚¹å‡»ã€æ”¶è—ã€é¡µé¢è·³è½¬ï¼‰ï¼ŒåŠ¨æ€è°ƒæ•´æ¨èåˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·çªç„¶æµè§ˆå¤šä¸ªâ€œæ—…æ¸¸æ”»ç•¥â€å¸–å­ï¼Œç³»ç»Ÿå¯ä¸´æ—¶å¢åŠ æ­¤ç±»å†…å®¹çš„æ›å…‰æƒé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;A/Bæµ‹è¯•ä¸ç®—æ³•è¿­ä»£&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡å¯¹æ¯”ä¸åŒæ¨èç­–ç•¥çš„ç‚¹å‡»ç‡ã€è½¬åŒ–ç‡ï¼ˆå¦‚å¸–å­æ‰“å¼€ç‡ã€å›å¸–ç‡ï¼‰ä¼˜åŒ–ç®—æ³•å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;å¼•å…¥å¼ºåŒ–å­¦ä¹ æ¨¡å‹ï¼Œæ ¹æ®ç”¨æˆ·åé¦ˆï¼ˆå¦‚å¿½ç•¥æ¨èé¡¹ï¼‰æŒç»­ä¼˜åŒ–æ¨èç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å†·å¯åŠ¨ä¸å¤šæ ·æ€§ä¿éšœ"&gt;&lt;strong&gt;å†·å¯åŠ¨ä¸å¤šæ ·æ€§ä¿éšœ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†·å¯åŠ¨è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–°ç”¨æˆ·&lt;/strong&gt;ï¼šåŸºäºæ³¨å†Œä¿¡æ¯æ¨èçƒ­é—¨è¯é¢˜æˆ–å¼•å¯¼å¡«å†™å…´è¶£é—®å·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–°å¸–å­&lt;/strong&gt;ï¼šé€šè¿‡å†…å®¹ç›¸ä¼¼åº¦åŒ¹é…ï¼ˆå¦‚ä¸å·²æœ‰é«˜çƒ­åº¦å¸–å­çš„ä¸»é¢˜é‡åˆåº¦ï¼‰è¿›è¡ŒåˆæœŸæ›å…‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ ·æ€§æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ¨èç»“æœä¸­å¼•å…¥éšæœºé¡¹æˆ–é•¿å°¾å†…å®¹ï¼Œé¿å…â€œä¿¡æ¯èŒ§æˆ¿â€ã€‚ä¾‹å¦‚ï¼Œæ··åˆ10%çš„è·¨é¢†åŸŸè¯é¢˜ï¼ˆå¦‚ç§‘æŠ€ç”¨æˆ·å¶å°”æ¨èç¾é£Ÿå†…å®¹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éšç§ä¸å®‰å…¨è€ƒé‡"&gt;&lt;strong&gt;éšç§ä¸å®‰å…¨è€ƒé‡&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ•°æ®åŒ¿ååŒ–å¤„ç†ï¼Œé¿å…æ”¶é›†æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚çœŸå®å§“åã€è”ç³»æ–¹å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éµå¾ªGDPRç­‰æ³•è§„ï¼Œæä¾›ç”¨æˆ·æ•°æ®æŸ¥çœ‹ä¸åˆ é™¤æƒé™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹åº”ç”¨åœºæ™¯"&gt;ç¤ºä¾‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯é¢˜æ¨è&lt;/strong&gt;ï¼šç”¨æˆ·è¿›å…¥è®ºå›é¦–é¡µæ—¶ï¼Œç³»ç»Ÿæ ¹æ®å†å²è¡Œä¸ºå±•ç¤ºâ€œæ¨èè¯é¢˜â€æ¨¡å—ï¼ˆå¦‚â€œæ‚¨å¯èƒ½æ„Ÿå…´è¶£çš„Pythonè¿›é˜¶è®¨è®ºâ€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸ªæ€§åŒ–æ¨é€&lt;/strong&gt;ï¼šé€šè¿‡ç«™å†…æ¶ˆæ¯æˆ–é‚®ä»¶æ¨é€ç”¨æˆ·æœªè¯»çš„é«˜ç›¸å…³åº¦å¸–å­ï¼ˆå¦‚â€œæ‚¨å…³æ³¨çš„ç”¨æˆ·å‘å¸ƒäº†æ–°æ”»ç•¥â€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æŠ€æœ¯ç»„åˆï¼Œè®ºå›åº”ç”¨å¯æ˜¾è‘—æå‡ç”¨æˆ·æ´»è·ƒåº¦ä¸ç²˜æ€§ï¼ŒåŒæ—¶éœ€å¹³è¡¡ç®—æ³•æ•ˆç‡ä¸è®¡ç®—æˆæœ¬ï¼Œä»¥å®ç°å¯æŒç»­è¿è¥ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 12</title><link>https://dyhes.github.io/p/postopia-dev-logweek-12/</link><pubDate>Mon, 28 Apr 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-12/</guid><description>&lt;p&gt;todo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;del&gt;æŠ•ç¥¨&lt;/del&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ”¹é€ &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;later:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªï¼Œæ—¥å¿—åˆ†æ&lt;/li&gt;
&lt;li&gt;è¯­ä¹‰æœç´¢&lt;/li&gt;
&lt;li&gt;æ¨é€
&lt;ul&gt;
&lt;li&gt;AI å–œå¥½åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ optimize
&lt;ul&gt;
&lt;li&gt;search after æ”¹é€ &lt;/li&gt;
&lt;li&gt;hgetall pipelineä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å®šæ—¶å›è°ƒ"&gt;å®šæ—¶å›è°ƒ
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Bootä¸­å®ç°å®šæ—¶æ‰§è¡Œå›è°ƒå‡½æ•°å¹¶ä¼ é€’å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼Œç»“åˆä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨"&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;@Scheduled&lt;/code&gt; æ³¨è§£ + æ–¹æ³•å‚æ•°ä¼ é€’&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€‚ç”¨äºç®€å•çš„é™æ€å®šæ—¶ä»»åŠ¡ï¼Œé€šè¿‡ &lt;code&gt;@Scheduled&lt;/code&gt; æ³¨è§£å®šä¹‰å»¶è¿Ÿæ—¶é—´ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­ç›´æ¥æ¥æ”¶å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ScheduledTask&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿ5ç§’åæ‰§è¡Œï¼Œå¹¶ä¼ é€’å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Scheduled&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initialDelay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fixedDelay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MAX_VALUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;delayedTask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ‰§è¡Œä»»åŠ¡ï¼Œå‚æ•°ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡å…¶ä»–æ–¹æ³•è§¦å‘å¸¦å‚æ•°çš„å®šæ—¶ä»»åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;triggerTaskWithParam&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delayedTask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´æ¥è°ƒç”¨ï¼ˆéœ€æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ­¤æ–¹å¼éœ€ç¡®ä¿å‚æ•°åœ¨è°ƒç”¨æ—¶å·²æ³¨å…¥ï¼Œä¸”éœ€æ‰‹åŠ¨è§¦å‘ä»»åŠ¡ï¼ˆå¦‚é€šè¿‡å…¶ä»–æ–¹æ³•è°ƒç”¨ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŠ¨æ€ä»»åŠ¡æ³¨å†Œ"&gt;&lt;strong&gt;åŠ¨æ€ä»»åŠ¡æ³¨å†Œï¼ˆ&lt;code&gt;SchedulingConfigurer&lt;/code&gt; æ¥å£ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€‚ç”¨äºéœ€è¦è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´å‚æ•°æˆ–å»¶è¿Ÿæ—¶é—´çš„åœºæ™¯ï¼Œé€šè¿‡ç¼–ç¨‹æ–¹å¼æ³¨å†Œä»»åŠ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableScheduling&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DynamicSchedulerConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SchedulingConfigurer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;configureTasks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ScheduledTaskRegistrar&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registrar&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ¨æ€æ·»åŠ ä»»åŠ¡ï¼šå»¶è¿Ÿ10ç§’æ‰§è¡Œï¼Œå¹¶ä¼ é€’å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registrar&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addTriggerTask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ‰§è¡Œä»»åŠ¡ï¼Œå‚æ•°ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;customParam&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;triggerContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nextExecutionTime&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTimeMillis&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nextExecutionTime&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç»“åˆæ•°æ®åº“æˆ–é…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒçµæ´»çš„æ—¶é—´æ§åˆ¶ï¼ˆå¦‚æ ¹æ®æ¡ä»¶è®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨-1"&gt;&lt;strong&gt;ä½¿ç”¨ &lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt; å¼‚æ­¥è°ƒåº¦&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€‚ç”¨äºéœ€è¦å¼‚æ­¥æ‰§è¡Œæˆ–ç®¡ç†çº¿ç¨‹æ± çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskScheduler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;taskScheduler&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskScheduler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scheduler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskScheduler&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scheduler&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setPoolSize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scheduler&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// åœ¨ä¸šåŠ¡ä»£ç ä¸­è°ƒåº¦ä»»åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadPoolTaskScheduler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;taskScheduler&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;scheduleTaskWithParam&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;taskScheduler&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;schedule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å¼‚æ­¥æ‰§è¡Œï¼Œå‚æ•°ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTimeMillis&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿ5ç§’&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¼‚æ­¥æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;å¯æ‰‹åŠ¨å–æ¶ˆä»»åŠ¡ï¼ˆé€šè¿‡è¿”å›çš„ &lt;code&gt;ScheduledFuture&lt;/code&gt; å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç»“åˆ"&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;@Async&lt;/code&gt; æ³¨è§£å®ç°å¼‚æ­¥å»¶è¿Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€åœ¨å¼‚æ­¥ç¯å¢ƒä¸‹æ‰§è¡Œä»»åŠ¡å¹¶ä¼ å‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AsyncTask&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Async&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;executeWithDelay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å¼‚æ­¥å»¶è¿Ÿæ‰§è¡Œï¼Œå‚æ•°ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printStackTrace&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AsyncTask&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asyncTask&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;triggerAsyncTask&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asyncTask&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executeWithDelay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿ5ç§’&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦ä¸å…¶ä»–å¼‚æ­¥ä»»åŠ¡ç»“åˆï¼Œæˆ–å¯¹çº¿ç¨‹æ§åˆ¶æœ‰æ›´é«˜è¦æ±‚æ—¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å‚æ•°ä¼ é€’çš„æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;å‚æ•°ä¼ é€’çš„æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨åŸŸé—®é¢˜&lt;/strong&gt;ï¼šè‹¥é€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ï¼Œéœ€ç¡®ä¿å‚æ•°åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶ä»æœ‰æ•ˆï¼ˆé¿å…ä½¿ç”¨å±€éƒ¨å˜é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼šåŠ¨æ€ä»»åŠ¡ä¸­è‹¥æ¶‰åŠå…±äº«å‚æ•°ï¼Œéœ€ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨åŒ–é…ç½®&lt;/strong&gt;ï¼šå¯é€šè¿‡ &lt;code&gt;@Value&lt;/code&gt; æ³¨è§£ä»é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ï¼Œæˆ–ç»“åˆæ•°æ®åº“åŠ¨æ€åŠ è½½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µé€‰æ‹©"&gt;&lt;strong&gt;æœ€ä½³å®è·µé€‰æ‹©&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•åœºæ™¯&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@Scheduled(initialDelay)&lt;/code&gt; + æ–¹æ³•å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€éœ€æ±‚&lt;/strong&gt;ï¼šé€‰æ‹© &lt;code&gt;SchedulingConfigurer&lt;/code&gt; æˆ– &lt;code&gt;ThreadPoolTaskScheduler&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥æ§åˆ¶&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;@Async&lt;/code&gt; å’Œçº¿ç¨‹æ± ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…·ä½“å®ç°éœ€æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦ã€å‚æ•°åŠ¨æ€æ€§åŠæ‰§è¡Œç¯å¢ƒçµæ´»è°ƒæ•´ã€‚&lt;/p&gt;
&lt;h2 id="voteç´¢å¼•è®¾è®¡"&gt;Voteç´¢å¼•è®¾è®¡
&lt;/h2&gt;&lt;h3 id="è§£å†³æ–¹æ¡ˆåˆ†æ"&gt;è§£å†³æ–¹æ¡ˆåˆ†æ
&lt;/h3&gt;&lt;h4 id="æ–¹æ¡ˆä¸€å°†"&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼šå°† &lt;code&gt;relatedId&lt;/code&gt; æ”¹ä¸º &lt;code&gt;String&lt;/code&gt; å¹¶æ·»åŠ å‰ç¼€&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å•å­—æ®µå­˜å‚¨æ‰€æœ‰å…³è”ç±»å‹&lt;/strong&gt;ï¼šé€šè¿‡å‰ç¼€ï¼ˆå¦‚ &lt;code&gt;post_123&lt;/code&gt;ã€&lt;code&gt;comment_456&lt;/code&gt;ï¼‰ç›´æ¥æ ‡è¯†å…³è”ç±»å‹å’ŒIDï¼Œç®€åŒ–è¡¨ç»“æ„ï¼Œæ— éœ€é¢å¤–å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢çµæ´»æ€§&lt;/strong&gt;ï¼šå‰ç¼€å¯ä»¥å¿«é€Ÿè¯†åˆ«å…³è”ç±»å‹ï¼Œé¿å…è”åˆå­—æ®µæŸ¥è¯¢æ—¶çš„å¤æ‚æ¡ä»¶åˆ¤æ–­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•æ€§èƒ½é—®é¢˜&lt;/strong&gt;ï¼šå­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚ &lt;code&gt;post_123&lt;/code&gt;ï¼‰çš„ç´¢å¼•é•¿åº¦å’Œæ¯”è¾ƒæ•ˆç‡ä½äºæ•°å€¼ç±»å‹ï¼ˆ&lt;code&gt;Long&lt;/code&gt;ï¼‰ï¼Œå¯èƒ½å½±å“æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å†—ä½™å’Œç»´æŠ¤æˆæœ¬&lt;/strong&gt;ï¼šå‰ç¼€é€»è¾‘éœ€è¦åº”ç”¨å±‚ç»´æŠ¤ï¼Œä¾‹å¦‚è§£æå­—ç¬¦ä¸²ã€ç”Ÿæˆå‰ç¼€ç­‰ï¼Œå¢åŠ ä»£ç å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§é—®é¢˜&lt;/strong&gt;ï¼šæ–°å¢ç±»å‹æ—¶éœ€è¦ä¿®æ”¹å‰ç¼€é€»è¾‘ï¼Œå¯èƒ½å½±å“å·²æœ‰æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ–¹æ¡ˆäºŒæ–°å¢å­—æ®µåŒºåˆ†ç±»å‹å¦‚"&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼šæ–°å¢å­—æ®µåŒºåˆ†ç±»å‹ï¼ˆå¦‚ &lt;code&gt;relatedType&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹ä¸IDåˆ†ç¦»&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;relatedType&lt;/code&gt;ï¼ˆæšä¸¾æˆ–å­—ç¬¦ä¸²ï¼‰å’Œ &lt;code&gt;relatedId&lt;/code&gt;ï¼ˆä¿æŒ &lt;code&gt;Long&lt;/code&gt;ï¼‰åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œé€»è¾‘æ›´æ¸…æ™°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;ï¼šå¯é’ˆå¯¹ &lt;code&gt;relatedType&lt;/code&gt; å’Œ &lt;code&gt;relatedId&lt;/code&gt; åˆ›å»ºå¤åˆç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§æ›´å¼º&lt;/strong&gt;ï¼šæ–°å¢ç±»å‹æ— éœ€ä¿®æ”¹å­—æ®µç»“æ„ï¼Œåªéœ€æ‰©å±•æšä¸¾å€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¡¨ç»“æ„ç•¥å¾®å¤æ‚&lt;/strong&gt;ï¼šéœ€è¦ç»´æŠ¤ä¸¤ä¸ªå­—æ®µï¼Œä½†å¯¹æ•°æ®åº“è®¾è®¡æ¥è¯´æ˜¯å¸¸è§„æ“ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="postgresql-å•ä¸€ç´¢å¼•ä¸å¤åˆç´¢å¼•çš„æ€§èƒ½å·®å¼‚"&gt;&lt;strong&gt;PostgreSQL å•ä¸€ç´¢å¼•ä¸å¤åˆç´¢å¼•çš„æ€§èƒ½å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•ä¸€ç´¢å¼•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä»…å¯¹å•ä¸ªå­—æ®µé¢‘ç¹æŸ¥è¯¢ï¼ˆå¦‚ä»…æŒ‰ &lt;code&gt;relatedId&lt;/code&gt; æˆ– &lt;code&gt;relatedType&lt;/code&gt; æŸ¥è¯¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ¡ä»¶æŸ¥è¯¢éœ€åˆå¹¶ç´¢å¼•&lt;/strong&gt;ï¼šä¾‹å¦‚åŒæ—¶æŒ‰ &lt;code&gt;relatedType&lt;/code&gt; å’Œ &lt;code&gt;relatedId&lt;/code&gt; æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æ‰«æå¤šä¸ªç´¢å¼•å¹¶é€šè¿‡ä½å›¾åˆå¹¶ç»“æœï¼Œå¢åŠ  CPU å’Œå†…å­˜å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•è¦†ç›–æ’åº&lt;/strong&gt;ï¼šè‹¥æŸ¥è¯¢éœ€è¦å¯¹å¤šåˆ—æ’åºï¼ˆå¦‚ &lt;code&gt;ORDER BY relatedType, relatedId&lt;/code&gt;ï¼‰ï¼Œå•ä¸€ç´¢å¼•æ— æ³•ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤åˆç´¢å¼•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé«˜é¢‘å¤šæ¡ä»¶æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;WHERE relatedType = 'post' AND relatedId = 123&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆè¿‡æ»¤å’Œæ’åº&lt;/strong&gt;ï¼šå¤åˆç´¢å¼•ç›´æ¥è¦†ç›–å¤šåˆ—æŸ¥è¯¢å’Œæ’åºï¼Œå‡å°‘éšæœº I/O å’Œå›è¡¨æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•è¦†ç›–æŸ¥è¯¢&lt;/strong&gt;ï¼šè‹¥ç´¢å¼•åŒ…å«æ‰€æœ‰æŸ¥è¯¢å­—æ®µï¼ˆå¦‚ &lt;code&gt;(relatedType, relatedId)&lt;/code&gt;ï¼‰ï¼Œå¯é¿å…è®¿é—®ä¸»è¡¨æ•°æ®ï¼ˆIndex-Only Scanï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡è¦ç‚¹&lt;/strong&gt;ï¼šåˆ—é¡ºåºéœ€ä¼˜å…ˆé€‰æ‹©é«˜åŒºåˆ†åº¦çš„å­—æ®µï¼ˆå¦‚ &lt;code&gt;relatedType&lt;/code&gt; åœ¨å‰ï¼Œ&lt;code&gt;relatedId&lt;/code&gt; åœ¨åï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ¨èæ–¹æ¡ˆ"&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åº“è®¾è®¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»ºè®®æ–°å¢ &lt;code&gt;relatedType&lt;/code&gt; å­—æ®µ&lt;/strong&gt;ï¼Œä¿æŒ &lt;code&gt;relatedId&lt;/code&gt; ä¸º &lt;code&gt;Long&lt;/code&gt; ç±»å‹ï¼Œé€»è¾‘æ¸…æ™°ä¸”ä¾¿äºæ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºå¤åˆç´¢å¼•&lt;/strong&gt;ï¼š&lt;code&gt;CREATE INDEX idx_vote_related ON votes (relatedType, relatedId)&lt;/code&gt;ï¼Œä»¥ä¼˜åŒ–é«˜é¢‘æŸ¥è¯¢æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥éœ€è¦å¿«é€ŸæŸ¥è¯¢ç‰¹å®šç±»å‹çš„æ‰€æœ‰å…³è”è®°å½•ï¼ˆå¦‚æ‰€æœ‰ &lt;code&gt;post&lt;/code&gt; ç±»å‹çš„æŠ•ç¥¨ï¼‰ï¼Œå¤åˆç´¢å¼•çš„è¿‡æ»¤æ•ˆç‡è¿œé«˜äºå­—ç¬¦ä¸²å‰ç¼€æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æŸ¥è¯¢ä»…æ¶‰åŠ &lt;code&gt;relatedId&lt;/code&gt;ï¼ˆæ— ç±»å‹è¿‡æ»¤ï¼‰ï¼Œå¯é¢å¤–ä¸º &lt;code&gt;relatedId&lt;/code&gt; åˆ›å»ºå•ä¸€ç´¢å¼•ï¼Œä½†éœ€æƒè¡¡å­˜å‚¨å’Œç»´æŠ¤æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦ä¸²å‰ç¼€æ–¹æ¡ˆ&lt;/strong&gt;é€‚åˆç®€å•åœºæ™¯ï¼Œä½†å­˜åœ¨æ€§èƒ½å’Œç»´æŠ¤éšæ‚£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µåˆ†ç¦»+å¤åˆç´¢å¼•&lt;/strong&gt;åœ¨ PostgreSQL ä¸­æ›´ä¼˜ï¼Œå…¼é¡¾æŸ¥è¯¢æ•ˆç‡ã€æ‰©å±•æ€§å’Œè§„èŒƒåŒ–è®¾è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="instant-è®¡ç®—"&gt;Instant è®¡ç®—
&lt;/h2&gt;&lt;p&gt;åœ¨Javaä¸­ä½¿ç”¨ &lt;code&gt;Instant&lt;/code&gt; ç±»è®¡ç®—ä»ç°åœ¨èµ·ç»è¿‡ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ ¸å¿ƒæ–¹æ³•å®ç°ï¼Œç»“åˆ &lt;code&gt;Duration&lt;/code&gt; ç±»æˆ– &lt;code&gt;ChronoUnit&lt;/code&gt; å•ä½è¿›è¡Œçµæ´»æ“ä½œï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•ä¸€é€šè¿‡"&gt;&lt;strong&gt;æ–¹æ³•ä¸€ï¼šé€šè¿‡ &lt;code&gt;plus&lt;/code&gt; æ–¹æ³•ç›´æ¥æ·»åŠ æ—¶é—´å•ä½&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åˆ©ç”¨ &lt;code&gt;Instant&lt;/code&gt; çš„ &lt;code&gt;plus(long, TemporalUnit)&lt;/code&gt; æ–¹æ³•ï¼ŒæŒ‡å®šæ—¶é—´å•ä½å’Œæ•°å€¼ï¼Œç›´æ¥è®¡ç®—æœªæ¥æ—¶é—´ç‚¹ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.Instant&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.temporal.ChronoUnit&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InstantDemo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;now&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ·»åŠ 10åˆ†é’Ÿ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ChronoUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MINUTES&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ·»åŠ 3å¤©&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ChronoUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;DAYS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å½“å‰æ—¶é—´ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;10åˆ†é’Ÿåï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;3å¤©åï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€æ´ç›´æ¥&lt;/strong&gt;ï¼Œé€‚åˆç®€å•æ—¶é—´å•ä½ï¼ˆå¦‚ç§’ã€åˆ†ã€å°æ—¶ã€å¤©ï¼‰çš„åŠ å‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ChronoUnit&lt;/code&gt; æ”¯æŒå¤šç§æ—¶é—´å•ä½ï¼Œå¦‚ &lt;code&gt;SECONDS&lt;/code&gt;ã€&lt;code&gt;HOURS&lt;/code&gt;ã€&lt;code&gt;DAYS&lt;/code&gt; ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•äºŒé€šè¿‡"&gt;&lt;strong&gt;æ–¹æ³•äºŒï¼šé€šè¿‡ &lt;code&gt;Duration&lt;/code&gt; ç±»å®šä¹‰æ—¶é—´é—´éš”&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åˆ›å»º &lt;code&gt;Duration&lt;/code&gt; å¯¹è±¡è¡¨ç¤ºå…·ä½“çš„æ—¶é—´é•¿åº¦ï¼Œå†é€šè¿‡ &lt;code&gt;plus()&lt;/code&gt; æ–¹æ³•æ·»åŠ åˆ°å½“å‰æ—¶é—´ç‚¹ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.Duration&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.Instant&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DurationExample&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;now&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å®šä¹‰2å°æ—¶çš„æ—¶é—´é—´éš”&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofHours&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ·»åŠ é—´éš”&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å½“å‰æ—¶é—´ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;2å°æ—¶åï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ›´çµæ´»&lt;/strong&gt;ï¼Œæ”¯æŒä»¥æ¯«ç§’ã€ç§’ã€åˆ†é’Ÿç­‰å•ä½å®šä¹‰å¤æ‚çš„æ—¶é—´é—´éš”ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨äºéœ€è¦åŠ¨æ€è®¡ç®—æ—¶é—´æ®µçš„åœºæ™¯ï¼ˆå¦‚ä»é…ç½®æˆ–è¾“å…¥ä¸­è·å–æ—¶é—´é•¿åº¦ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸¤ç§æ–¹æ³•çš„å¯¹æ¯”"&gt;&lt;strong&gt;ä¸¤ç§æ–¹æ³•çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç®€å•å•ä½ï¼ˆç§’ã€åˆ†ã€å¤©ç­‰ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;plus(long, TemporalUnit)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€æ´ï¼Œæ— éœ€é¢å¤–å¯¹è±¡åˆ›å»º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤æ‚æˆ–åŠ¨æ€æ—¶é—´é—´éš”&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Duration&lt;/code&gt; + &lt;code&gt;plus(Duration)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒæ›´çµæ´»çš„æ—¶é—´è®¡ç®—ï¼ˆå¦‚åˆ†é’Ÿ+ç§’çš„ç»„åˆï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜æ€§&lt;/strong&gt;ï¼š&lt;code&gt;Instant&lt;/code&gt; å¯¹è±¡ä¸å¯å˜ï¼Œæ‰€æœ‰åŠ å‡æ“ä½œå‡è¿”å›æ–°å®ä¾‹ï¼ŒåŸå¯¹è±¡ä¸å—å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç²¾åº¦é—®é¢˜&lt;/strong&gt;ï¼š&lt;code&gt;Duration&lt;/code&gt; å’Œ &lt;code&gt;ChronoUnit&lt;/code&gt; å‡æ”¯æŒçº³ç§’çº§ç²¾åº¦ï¼Œä½†å®é™…åº”ç”¨ä¸­éœ€æ³¨æ„ç³»ç»Ÿæ—¶é’Ÿçš„ç²¾åº¦é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶åŒºé—®é¢˜&lt;/strong&gt;ï¼š&lt;code&gt;Instant&lt;/code&gt; å§‹ç»ˆåŸºäº UTC æ—¶é—´ï¼Œè‹¥éœ€æœ¬åœ°æ—¶é—´è½¬æ¢ï¼Œéœ€ç»“åˆ &lt;code&gt;ZonedDateTime&lt;/code&gt; ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç»¼åˆåº”ç”¨ç¤ºä¾‹"&gt;&lt;strong&gt;ç»¼åˆåº”ç”¨ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.Instant&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.Duration&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.time.temporal.ChronoUnit&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CombinedExample&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;now&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ–¹æ³•1ï¼šç›´æ¥æ·»åŠ 2å°æ—¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ChronoUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;HOURS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ–¹æ³•2ï¼šé€šè¿‡Durationæ·»åŠ 30åˆ†é’Ÿ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofMinutes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Instant&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å½“å‰æ—¶é—´ï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;2å°æ—¶åï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;30åˆ†é’Ÿåï¼š&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚çµæ´»å¤„ç†æ—¶é—´è®¡ç®—é—®é¢˜ã€‚å¦‚éœ€æ›´å¤æ‚çš„æ—¥æœŸæ“ä½œï¼ˆå¦‚æœˆã€å¹´ï¼‰ï¼Œå»ºè®®ç»“åˆ &lt;code&gt;LocalDateTime&lt;/code&gt; æˆ– &lt;code&gt;ZonedDateTime&lt;/code&gt; ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id="å˜é•¿å‚æ•°"&gt;å˜é•¿å‚æ•°
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œæ„é€ å‡½æ•°å¯ä»¥å®Œå…¨æ”¯æŒå¯å˜é•¿å‚æ•°ï¼ˆ&lt;code&gt;...args&lt;/code&gt;ï¼‰çš„è¯­æ³•ï¼Œä½†éœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨è§„åˆ™"&gt;ä½¿ç”¨è§„åˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯­æ³•å½¢å¼&lt;/strong&gt;&lt;br&gt;
å¯å˜é•¿å‚æ•°çš„å£°æ˜æ–¹å¼ä¸æ™®é€šæ–¹æ³•ä¸€è‡´ï¼šåœ¨å‚æ•°ç±»å‹ååŠ ä¸‰ä¸ªç‚¹&lt;code&gt;...&lt;/code&gt;ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Example&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ„é€ å‡½æ•°ä½¿ç”¨å¯å˜é•¿å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å‚æ•° args ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸º String[]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½ç½®é™åˆ¶&lt;/strong&gt;&lt;br&gt;
å¯å˜é•¿å‚æ•°å¿…é¡»æ˜¯æ„é€ å‡½æ•°çš„&lt;strong&gt;æœ€åä¸€ä¸ªå‚æ•°&lt;/strong&gt;ï¼Œä¸”ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­&lt;strong&gt;åªèƒ½æœ‰ä¸€ä¸ª&lt;/strong&gt;å¯å˜é•¿å‚æ•°ã€‚ä»¥ä¸‹å†™æ³•ä¼šæŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nums&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯ï¼šå¯å˜å‚æ•°ä¸åœ¨æœ«å°¾&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯ï¼šå¤šä¸ªå¯å˜å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;br&gt;
å¯å˜é•¿å‚æ•°æœ¬è´¨ä¸Šæ˜¯è¯­æ³•ç³–ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºæ•°ç»„ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// ç¼–è¯‘åç­‰åŒäºï¼š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨ç¤ºä¾‹"&gt;ä½¿ç”¨ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="åŸºæœ¬ç”¨æ³•"&gt;åŸºæœ¬ç”¨æ³•
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Person&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hobbies&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ„é€ å‡½æ•°æ¥æ”¶å¯å˜é•¿å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Person&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hobbies&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hobbies&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hobbies&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨æ–¹å¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Person&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Person&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;é˜…è¯»&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ç¼–ç¨‹&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¼ å…¥å¤šä¸ªå‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Person&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Person&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸ä¼ å‚æ•°ï¼ˆç­‰æ•ˆäºç©ºæ•°ç»„ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ä¸å›ºå®šå‚æ•°é‡è½½æ—¶çš„ä¼˜å…ˆçº§"&gt;ä¸å›ºå®šå‚æ•°é‡è½½æ—¶çš„ä¼˜å…ˆçº§
&lt;/h4&gt;&lt;p&gt;å½“å­˜åœ¨å›ºå®šå‚æ•°å’Œå¯å˜é•¿å‚æ•°çš„é‡è½½æ„é€ å‡½æ•°æ—¶ï¼Œ&lt;strong&gt;å›ºå®šå‚æ•°çš„æ„é€ å‡½æ•°ä¼šä¼˜å…ˆè¢«è°ƒç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyClass&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;MyClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å›ºå®šå‚æ•°æ„é€ å‡½æ•°&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;MyClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å¯å˜é•¿å‚æ•°æ„é€ å‡½æ•°&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;MyClass&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MyClass&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¾“å‡ºï¼š&amp;#34;å›ºå®šå‚æ•°æ„é€ å‡½æ•°&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…é‡è½½æ­§ä¹‰&lt;/strong&gt;&lt;br&gt;
å¦‚æœå­˜åœ¨å¤šä¸ªå¯èƒ½åŒ¹é…çš„å¯å˜é•¿å‚æ•°æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯ï¼šè°ƒç”¨æ—¶å¯èƒ½äº§ç”Ÿæ­§ä¹‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸æ•°ç»„å‚æ•°çš„å†²çª&lt;/strong&gt;&lt;br&gt;
æ„é€ å‡½æ•°ä¸èƒ½åŒæ—¶å®šä¹‰å¯å˜é•¿å‚æ•°å’Œæ•°ç»„å‚æ•°ï¼Œå› ä¸ºä¸¤è€…ç¼–è¯‘åç­‰ä»·ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Conflict&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Conflict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¼–è¯‘æŠ¥é”™ï¼šé‡å¤å®šä¹‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Conflict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç©ºå€¼å¤„ç†&lt;/strong&gt;&lt;br&gt;
å¦‚æœä¼ é€’ &lt;code&gt;null&lt;/code&gt; ç»™å¯å˜é•¿å‚æ•°ï¼Œéœ€è¦æ˜¾å¼è½¬å‹ä»¥é¿å…æ­§ä¹‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Example&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ˜¾å¼å£°æ˜å‚æ•°ç±»å‹ä¸ºæ•°ç»„&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯"&gt;é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»åˆå§‹åŒ–&lt;/strong&gt;ï¼šé€‚ç”¨äºéœ€è¦æ”¯æŒä¸åŒæ•°é‡åˆå§‹åŒ–å‚æ•°çš„åœºæ™¯ï¼ˆå¦‚æ—¥å¿—è®°å½•å™¨ã€é…ç½®ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–ä»£ç &lt;/strong&gt;ï¼šæ›¿ä»£æ‰‹åŠ¨åˆ›å»ºæ•°ç»„çš„æ“ä½œï¼Œä¾‹å¦‚ &lt;code&gt;new Config(&amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;)&lt;/code&gt; æ¯” &lt;code&gt;new Config(new String[]{&amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;})&lt;/code&gt; æ›´ç®€æ´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;Java æ„é€ å‡½æ•°å®Œå…¨æ”¯æŒå¯å˜é•¿å‚æ•°ï¼Œä½†éœ€æ³¨æ„è¯­æ³•è§„åˆ™å’Œé‡è½½æ—¶çš„æ½œåœ¨é—®é¢˜ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡æ•°ç»„å®ç°ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ä»£ç çš„çµæ´»æ€§å’Œç®€æ´æ€§ã€‚&lt;/p&gt;
&lt;h2 id="spring-boot-å“åº”-string-vs-list"&gt;Spring boot å“åº” String[] vs. List&lt;String&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot çš„å“åº”ä¸­ï¼Œ&lt;code&gt;String[]&lt;/code&gt; å’Œ &lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; çš„ä¸»è¦åŒºåˆ«ä½“ç°åœ¨ &lt;strong&gt;æ•°æ®ç»“æ„ç‰¹æ€§&lt;/strong&gt; å’Œ &lt;strong&gt;æ¡†æ¶å¤„ç†æœºåˆ¶&lt;/strong&gt; ä¸Šï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®ç»“æ„ç‰¹æ€§å·®å¼‚"&gt;æ•°æ®ç»“æ„ç‰¹æ€§å·®å¼‚
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯å˜æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;String[]&lt;/code&gt;ï¼šæ•°ç»„æ˜¯å®šé•¿ç»“æ„ï¼Œåˆ›å»ºåé•¿åº¦ä¸å¯å˜ã€‚è‹¥éœ€ä¿®æ”¹å…ƒç´ ï¼Œéœ€é‡æ–°åˆ›å»ºæ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;ï¼šåŸºäºæ¥å£çš„é›†åˆç±»å‹ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼ˆå¦‚ &lt;code&gt;ArrayList&lt;/code&gt; å®ç°ç±»ï¼‰ï¼Œå¯çµæ´»å¢åˆ å…ƒç´ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç±»å‹å…¼å®¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;String[]&lt;/code&gt; æ˜¯å…·ä½“å®ç°ç±»ï¼Œè€¦åˆåº¦é«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; æ˜¯æ¥å£ï¼Œéµå¾ªé¢å‘æ¥å£ç¼–ç¨‹åŸåˆ™ï¼Œå¯æ›¿æ¢ä¸º &lt;code&gt;LinkedList&lt;/code&gt; ç­‰å®ç°ç±»ï¼Œæå‡ä»£ç é€šç”¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="spring-boot-çš„åºåˆ—åŒ–è¡Œä¸º"&gt;Spring Boot çš„åºåˆ—åŒ–è¡Œä¸º
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JSON è½¬æ¢è§„åˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤è€…å‡ä¼šè¢« Spring Boot é»˜è®¤åºåˆ—åŒ–ä¸º &lt;strong&gt;JSON æ•°ç»„&lt;/strong&gt;ï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// String[] è¿”å›ç»“æœ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;A&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;B&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;C&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// List&amp;lt;String&amp;gt; è¿”å›ç»“æœ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;A&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;B&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;C&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;åœ¨åºåˆ—åŒ–ç»“æœä¸Šæ— å·®å¼‚ï¼Œä½† &lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; æ›´ç¬¦åˆé›†åˆæ“ä½œçš„è¯­ä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€å“åº”æ ¼å¼å…¼å®¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ä½¿ç”¨ç»Ÿä¸€å“åº”å°è£…ç±»ï¼ˆå¦‚ &lt;code&gt;ResultData&amp;lt;T&amp;gt;&lt;/code&gt;ï¼‰ï¼Œä¸¤è€…å‡å¯ä½œä¸º &lt;code&gt;data&lt;/code&gt; å­—æ®µçš„å€¼ã€‚ä½† &lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; æ›´æ˜“äºæ‰©å±•å…¶ä»–é›†åˆæ“ä½œï¼ˆå¦‚åˆ†é¡µï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç»Ÿä¸€å“åº”ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultData&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getList&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultData&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getArray&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ¡†æ¶æ”¯æŒä¸å¼€å‘å®è·µ"&gt;æ¡†æ¶æ”¯æŒä¸å¼€å‘å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”ç±»å‹æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;ResponseEntity&amp;lt;List&amp;lt;String&amp;gt;&amp;gt;&lt;/code&gt; å¯æ˜¾å¼å£°æ˜å“åº”ç±»å‹ï¼Œå¸®åŠ© Spring è‡ªåŠ¨è®¾ç½® &lt;code&gt;Content-Type: application/json&lt;/code&gt;ï¼Œé¿å…å®¢æˆ·ç«¯è§£ææ­§ä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;String[]&lt;/code&gt; è™½èƒ½éšå¼è½¬æ¢ï¼Œä½†éœ€ç¡®ä¿å‰ç«¯èƒ½æ­£ç¡®å¤„ç†æ•°ç»„ç±»å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æ¥å£å¯èƒ½è¿”å›ç©ºé›†åˆï¼Œ&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; æ›´è‡ªç„¶åœ°è¡¨ç¤ºç©ºçŠ¶æ€ï¼ˆ&lt;code&gt;[]&lt;/code&gt;ï¼‰ï¼Œè€Œ &lt;code&gt;String[]&lt;/code&gt; çš„ç©ºæ•°ç»„å¯èƒ½éœ€è¦é¢å¤–åˆ¤æ–­ &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç å¯ç»´æŠ¤æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt; æ”¯æŒ Stream API å’Œé›†åˆå·¥å…·ç±»ï¼ˆå¦‚ &lt;code&gt;Collectors&lt;/code&gt;ï¼‰ï¼Œä¾¿äºæ•°æ®è½¬æ¢å’Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;String[]&lt;/code&gt; éœ€å€ŸåŠ© &lt;code&gt;Arrays&lt;/code&gt; å·¥å…·ç±»æ“ä½œï¼Œçµæ´»æ€§è¾ƒä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸å†…å­˜å½±å“"&gt;æ€§èƒ½ä¸å†…å­˜å½±å“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å ç”¨&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;String[]&lt;/code&gt; ä½œä¸ºè¿ç»­å†…å­˜å—ï¼Œéšæœºè®¿é—®æ•ˆç‡é«˜ï¼›&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;ArrayList&lt;/code&gt;ï¼‰åº•å±‚åŸºäºæ•°ç»„ï¼Œæ€§èƒ½æ¥è¿‘ï¼Œä½†å­˜åœ¨åŠ¨æ€æ‰©å®¹æ—¶çš„é¢å¤–å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®é‡å›ºå®šä¸”æ— éœ€ä¿®æ”¹æ—¶ï¼Œä¼˜å…ˆé€‰ &lt;code&gt;String[]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é«˜é¢‘å¢åˆ æˆ–ä¸ç¡®å®šæ•°æ®é‡æ—¶ï¼Œé€‰ &lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®"&gt;æœ€ä½³å®è·µå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© &lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¦åˆé¢å‘æ¥å£ç¼–ç¨‹åŸåˆ™ï¼Œé™ä½ä»£ç è€¦åˆã€‚&lt;/li&gt;
&lt;li&gt;ä¾¿äºæœªæ¥æ›¿æ¢é›†åˆå®ç°ï¼ˆå¦‚ä» &lt;code&gt;ArrayList&lt;/code&gt; æ”¹ä¸º &lt;code&gt;LinkedList&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éœ€æ˜¾å¼è¿”å›æ•°ç»„æ—¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨éœ€è¦å…¼å®¹æ—§ç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹ API æ—¶ï¼Œå¯ä½¿ç”¨ &lt;code&gt;String[]&lt;/code&gt;ï¼Œä½†å»ºè®®é€šè¿‡æ³¨é‡Šè¯´æ˜åŸå› ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å¯¹æ¯”è¡¨"&gt;æ€»ç»“å¯¹æ¯”è¡¨
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;&lt;code&gt;String[]&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;List&amp;lt;String&amp;gt;&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®ç»“æ„&lt;/td&gt;
&lt;td&gt;å®šé•¿æ•°ç»„&lt;/td&gt;
&lt;td&gt;åŠ¨æ€é›†åˆï¼ˆå¦‚ &lt;code&gt;ArrayList&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åºåˆ—åŒ–ç»“æœ&lt;/td&gt;
&lt;td&gt;JSON æ•°ç»„&lt;/td&gt;
&lt;td&gt;JSON æ•°ç»„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä»£ç æ‰©å±•æ€§&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆä¾èµ–å…·ä½“å®ç°ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆä¾èµ–æ¥å£ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç»Ÿä¸€å“åº”æ ¼å¼å…¼å®¹æ€§&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ›´çµæ´»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¨èåœºæ™¯&lt;/td&gt;
&lt;td&gt;å›ºå®šé•¿åº¦ã€æ— éœ€ä¿®æ”¹&lt;/td&gt;
&lt;td&gt;åŠ¨æ€æ•°æ®ã€é«˜é¢‘æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è‹¥éœ€è¿›ä¸€æ­¥ä¼˜åŒ–å“åº”æ ¼å¼ï¼Œå¯å‚è€ƒ Spring Boot ç»Ÿä¸€å°è£…æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="requestpartå’Œrequestbody"&gt;@RequestPartå’Œ@RequestBody
&lt;/h2&gt;&lt;p&gt;åœ¨Springæ¡†æ¶ä¸­ï¼Œ@RequestPartå’Œ@RequestBodyä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› åŠæ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;ä¸¤è€…ä¸èƒ½åŒæ—¶ä½¿ç”¨çš„åŸå› &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;HTTPè¯·æ±‚ä½“çš„å¤„ç†æœºåˆ¶å†²çª&lt;br&gt;
â€¢ @RequestBody ä¼šå°è¯•å°†æ•´ä¸ªè¯·æ±‚ä½“ï¼ˆBodyï¼‰ä½œä¸ºä¸€ä¸ªæ•´ä½“è§£æï¼Œé€‚ç”¨äºå¦‚ &lt;code&gt;application/json&lt;/code&gt; çš„å•ä½“æ•°æ®æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;â€¢ @RequestPart ç”¨äºå¤„ç† &lt;code&gt;multipart/form-data&lt;/code&gt; ç±»å‹çš„è¯·æ±‚ï¼Œå…è®¸å°†è¯·æ±‚ä½“æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹éƒ¨åˆ†ï¼ˆå¦‚æ–‡ä»¶ã€JSONå—ç­‰ï¼‰ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯ç‹¬ç«‹è§£æã€‚&lt;/p&gt;
&lt;p&gt;â€¢ å½“ä¸¤è€…åŒæ—¶ä½¿ç”¨æ—¶ï¼ŒSpringæ— æ³•åŒæ—¶å¤„ç†å•ä½“è¯·æ±‚ä½“å’Œå¤šéƒ¨åˆ†è¯·æ±‚ä½“ï¼Œå¯¼è‡´å‚æ•°ç»‘å®šå¤±è´¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Content-Typeçš„é™åˆ¶&lt;br&gt;
&lt;code&gt;@RequestBody&lt;/code&gt; è¦æ±‚è¯·æ±‚å¤´çš„ &lt;code&gt;Content-Type&lt;/code&gt; ä¸ºå•ä½“æ ¼å¼ï¼ˆå¦‚ &lt;code&gt;application/json&lt;/code&gt;ï¼‰ï¼Œè€Œ &lt;code&gt;@RequestPart&lt;/code&gt; éœ€è¦ &lt;code&gt;multipart/form-data&lt;/code&gt;ï¼ŒäºŒè€…åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­æ— æ³•å…±å­˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;æ›¿ä»£è§£å†³æ–¹æ¡ˆ
è‹¥éœ€è¦åŒæ—¶ä¼ é€’æ–‡ä»¶å’Œå¤æ‚æ•°æ®ï¼ˆå¦‚JSONå¯¹è±¡ï¼‰ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š&lt;/p&gt;
&lt;p&gt;æ–¹æ¡ˆ1ï¼šç»Ÿä¸€ä½¿ç”¨ @RequestPart
å°†JSONæ•°æ®ä½œä¸º &lt;code&gt;multipart/form-data&lt;/code&gt; ä¸­çš„ä¸€ä¸ªç‹¬ç«‹éƒ¨åˆ†ï¼Œé€šè¿‡ &lt;code&gt;@RequestPart&lt;/code&gt; æ¥æ”¶ã€‚&lt;br&gt;
ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PostMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/upload&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;upload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestPart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;file&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultipartFile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestPart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;YourDataObject&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Springä¼šæ ¹æ®Content-Typeè‡ªåŠ¨ååºåˆ—åŒ–JSON&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†æ–‡ä»¶å’Œå¯¹è±¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‰ç«¯éœ€é€šè¿‡FormDataåŒ…è£…æ•°æ®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-javascript" data-lang="javascript"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;formData&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;FormData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nx"&gt;formData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;file&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;file&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nx"&gt;formData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Blob&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)],&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ–¹æ³•é€šè¿‡ &lt;code&gt;multipart/form-data&lt;/code&gt; åŒæ—¶ä¼ é€’æ–‡ä»¶å’ŒJSONå—ï¼Œåç«¯é€šè¿‡ &lt;code&gt;@RequestPart&lt;/code&gt; åˆ†åˆ«æ¥æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;æ–¹æ¡ˆ2ï¼šç”¨Mapæ¥æ”¶å‚æ•°ï¼ˆçµæ´»æ€§æ›´é«˜ï¼‰
è‹¥å‚æ•°ç±»å‹ä¸å›ºå®šï¼Œå¯é€šè¿‡ &lt;code&gt;@RequestParam Map&amp;lt;String, Object&amp;gt;&lt;/code&gt; æ¥æ”¶æ™®é€šå‚æ•°ï¼Œç»“åˆ &lt;code&gt;@RequestPart&lt;/code&gt; æ¥æ”¶æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PostMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/upload&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;upload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestParam&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestPart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;file&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MultipartFile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jsonData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰‹åŠ¨ååºåˆ—åŒ–JSON&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;æ€»ç»“&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ¨èæ³¨è§£&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å•ä½“JSONè¯·æ±‚ä½“&lt;/td&gt;
&lt;td&gt;@RequestBody&lt;/td&gt;
&lt;td&gt;æ¥æ”¶æ•´ä¸ªJSONå¯¹è±¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤šéƒ¨åˆ†æ•°æ®ï¼ˆå«æ–‡ä»¶+JSONï¼‰&lt;/td&gt;
&lt;td&gt;@RequestPart&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªéƒ¨åˆ†ç‹¬ç«‹è§£æï¼Œæ”¯æŒè‡ªåŠ¨ååºåˆ—åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ··åˆå‚æ•°ï¼ˆéæ ‡å‡†æ ¼å¼ï¼‰&lt;/td&gt;
&lt;td&gt;@RequestParam&lt;/td&gt;
&lt;td&gt;æ‰‹åŠ¨å¤„ç†å‚æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;æç¤ºï¼šåœ¨ &lt;code&gt;multipart/form-data&lt;/code&gt; è¯·æ±‚ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@RequestPart&lt;/code&gt;ï¼Œå› å…¶æ”¯æŒæ›´çµæ´»çš„æ•°æ®ç±»å‹ï¼ˆå¦‚JSONã€XMLï¼‰å’Œæ–‡ä»¶æ··åˆä¸Šä¼ ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="postgres-å‰ç¼€æœç´¢"&gt;Postgres å‰ç¼€æœç´¢
&lt;/h2&gt;&lt;p&gt;åœ¨ PostgreSQL ä¸­å®ç°å­—æ®µå‰ç¼€æœç´¢ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½å’Œå‡†ç¡®æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹å¼åŠä¼˜åŒ–ç­–ç•¥ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨-like"&gt;ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;LIKE&lt;/code&gt; æ“ä½œç¬¦ç»“åˆ B-tree ç´¢å¼•&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºç¡€è¯­æ³•&lt;/strong&gt;&lt;br&gt;
ç›´æ¥ä½¿ç”¨ &lt;code&gt;LIKE 'prefix%'&lt;/code&gt; è¿›è¡Œå‰ç¼€åŒ¹é…ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;abc%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤è¯­æ³•ä¼šåŒ¹é…æ‰€æœ‰ä»¥ &lt;code&gt;abc&lt;/code&gt; å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å­—æ®µç±»å‹ä¸º &lt;code&gt;text&lt;/code&gt; æˆ– &lt;code&gt;varchar&lt;/code&gt;ï¼Œå¯åˆ›å»º &lt;strong&gt;B-tree ç´¢å¼•&lt;/strong&gt;å¹¶æŒ‡å®š &lt;code&gt;varchar_pattern_ops&lt;/code&gt; è¿ç®—ç¬¦ç±»ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_column_prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;varchar_pattern_ops&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;è¯¥ç´¢å¼•ä¼šå¿½ç•¥é»˜è®¤çš„æ’åºè§„åˆ™ï¼Œç›´æ¥æŒ‰å­—èŠ‚é¡ºåºæ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œæå‡å‰ç¼€åŒ¹é…çš„æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è¡¨è¾¾å¼ç´¢å¼•å‡½æ•°ç´¢å¼•"&gt;è¡¨è¾¾å¼ç´¢å¼•ï¼ˆå‡½æ•°ç´¢å¼•ï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€è¦åŠ¨æ€æˆªå–å­—æ®µå‰ç¼€æˆ–å¤„ç†å¤æ‚æ¡ä»¶ï¼Œå¯é€šè¿‡è¡¨è¾¾å¼ç´¢å¼•å®ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›ºå®šé•¿åº¦å‰ç¼€ç´¢å¼•&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;LEFT&lt;/code&gt; æˆ– &lt;code&gt;SUBSTRING&lt;/code&gt; å‡½æ•°åˆ›å»ºç´¢å¼•ï¼Œä¾‹å¦‚æˆªå–å‰ 3 ä¸ªå­—ç¬¦ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_left_prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;LEFT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢æ—¶éœ€ä½¿ç”¨ç›¸åŒè¡¨è¾¾å¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LEFT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;abc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€å‰ç¼€ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;SUBSTRING&lt;/code&gt; å’Œ &lt;code&gt;LIKE&lt;/code&gt;ï¼Œé€šè¿‡ä¸¤æ­¥ç­›é€‰å‡å°‘æ‰«æèŒƒå›´ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SUBSTRING&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;prefix_part&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;prefix%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨-pg_trgm"&gt;ä½¿ç”¨ &lt;strong&gt;&lt;code&gt;pg_trgm&lt;/code&gt; æ‰©å±•åŠ é€Ÿæ¨¡ç³ŠæŸ¥è¯¢&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¯¹äºæ›´å¤æ‚çš„å‰ç¼€åŒ¹é…ï¼ˆå¦‚å¤§å°å†™ä¸æ•æ„Ÿæˆ–éƒ¨åˆ†æ¨¡ç³Šåœºæ™¯ï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£…æ‰©å±•&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EXTENSION&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pg_trgm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»º GIN/GiST ç´¢å¼•&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_gin_prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gin_trgm_ops&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤ç´¢å¼•æ”¯æŒ &lt;code&gt;LIKE 'abc%'&lt;/code&gt;ã€&lt;code&gt;ILIKE&lt;/code&gt;ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–æ³¨æ„äº‹é¡¹"&gt;æ€§èƒ½ä¼˜åŒ–æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…å…¨è¡¨æ‰«æ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥ &lt;code&gt;LIKE&lt;/code&gt; ä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆå¦‚ &lt;code&gt;%abc&lt;/code&gt;ï¼‰ï¼Œç´¢å¼•å°†å¤±æ•ˆï¼Œéœ€è°ƒæ•´æŸ¥è¯¢æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨å›ºå®šå‰ç¼€ï¼ˆå¦‚ &lt;code&gt;abc%&lt;/code&gt;ï¼‰ä»¥åˆ©ç”¨ç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤§å°å†™æ•æ„Ÿé—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤ &lt;code&gt;LIKE&lt;/code&gt; åŒºåˆ†å¤§å°å†™ï¼Œè‹¥éœ€ä¸æ•æ„Ÿï¼Œæ”¹ç”¨ &lt;code&gt;ILIKE&lt;/code&gt; æˆ–è½¬æ¢ä¸ºå°å†™ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_lower_prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;LOWER&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LOWER&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;column_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;abc%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åˆ†å¸ƒåˆ†æ&lt;/strong&gt;&lt;br&gt;
é€‰æ‹©åˆé€‚çš„å‰ç¼€é•¿åº¦ï¼ˆå¦‚æˆªå–å‰ 5 æˆ– 10 å­—ç¬¦ï¼‰ï¼Œç¡®ä¿ç´¢å¼•çš„é€‰æ‹©æ€§ï¼ˆå³å”¯ä¸€æ€§è¶³å¤Ÿé«˜ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹åœºæ™¯"&gt;ç¤ºä¾‹åœºæ™¯
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæœç´¢ &lt;code&gt;url&lt;/code&gt; è¡¨ä¸­ä»¥ &lt;code&gt;https://example.com/blog&lt;/code&gt; å¼€å¤´çš„è®°å½•ã€‚&lt;br&gt;
&lt;strong&gt;ä¼˜åŒ–æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºè¡¨è¾¾å¼ç´¢å¼•ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_url_prefix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;SUBSTRING&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FOR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;æ‰§è¡ŒæŸ¥è¯¢ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SUBSTRING&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://example.com/b&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://example.com/blog%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;PostgreSQL å®ç°å‰ç¼€æœç´¢çš„æ ¸å¿ƒåœ¨äºåˆç†åˆ©ç”¨ç´¢å¼•å’Œè¡¨è¾¾å¼ä¼˜åŒ–ã€‚å¯¹äºç®€å•å‰ç¼€åŒ¹é…ï¼Œ&lt;code&gt;LIKE 'prefix%'&lt;/code&gt; ç»“åˆ B-tree ç´¢å¼•æ˜¯é¦–é€‰ï¼›å¤æ‚åœºæ™¯å¯å€ŸåŠ©è¡¨è¾¾å¼ç´¢å¼•æˆ– &lt;code&gt;pg_trgm&lt;/code&gt; æ‰©å±•ã€‚æ³¨æ„é¿å…å…¨è¡¨æ‰«æå¹¶åˆ†ææ•°æ®åˆ†å¸ƒï¼Œä»¥å¹³è¡¡å­˜å‚¨å¼€é”€ä¸æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id="entity-long-å­—æ®µ"&gt;@Entity Long å­—æ®µ
&lt;/h2&gt;&lt;p&gt;åœ¨JPAä¸­å®ç°&lt;code&gt;@Entity&lt;/code&gt;çš„Longç±»å‹å­—æ®µè‡ªåŠ¨è®¾ç½®ä¸º0ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°ï¼Œç»“åˆæ•°æ®åº“é»˜è®¤å€¼å’ŒJavaå®ä½“ç±»åˆå§‹åŒ–ä¸¤ç§ç­–ç•¥ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="javaå®ä½“ç±»åˆå§‹åŒ–"&gt;&lt;strong&gt;Javaå®ä½“ç±»åˆå§‹åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ç›´æ¥åˆå§‹åŒ–å­—æ®µ"&gt;&lt;strong&gt;ç›´æ¥åˆå§‹åŒ–å­—æ®µ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨å­—æ®µå®šä¹‰æ—¶ç›´æ¥èµ‹åˆå§‹å€¼&lt;code&gt;0L&lt;/code&gt;ï¼Œé€‚ç”¨äºæ‰€æœ‰æœªæ˜¾å¼èµ‹å€¼çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;stock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´æ¥åˆå§‹åŒ–ä¸º0&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼šæ­¤æ–¹å¼åœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶è‡ªåŠ¨è®¾ç½®&lt;code&gt;stock&lt;/code&gt;ä¸º0ã€‚è‹¥æœªæ˜¾å¼èµ‹å€¼ï¼ŒæŒä¹…åŒ–æ—¶å­—æ®µå€¼å§‹ç»ˆä¸º0ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–"&gt;&lt;strong&gt;é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨å®ä½“ç±»çš„æ„é€ å‡½æ•°ä¸­æ˜¾å¼è®¾ç½®é»˜è®¤å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;stock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;Product&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ— å‚æ„é€ å‡½æ•°åˆå§‹åŒ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼šç¡®ä¿æ‰€æœ‰æ–°å»ºå¯¹è±¡å‡åŒ…å«é»˜è®¤å€¼ã€‚éœ€æ³¨æ„ï¼šè‹¥å­˜åœ¨å…¶ä»–æ„é€ å‡½æ•°ï¼Œéœ€åŒæ­¥æ·»åŠ åˆå§‹åŒ–é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®åº“é»˜è®¤å€¼é…ç½®"&gt;&lt;strong&gt;æ•°æ®åº“é»˜è®¤å€¼é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä½¿ç”¨-2"&gt;&lt;strong&gt;ä½¿ç”¨&lt;code&gt;@Column&lt;/code&gt;çš„&lt;code&gt;columnDefinition&lt;/code&gt;å±æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡æ•°æ®åº“DDLå®šä¹‰é»˜è®¤å€¼ï¼Œå¹¶å¼ºåˆ¶JPAä½¿ç”¨è¯¥é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;stock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bigint default 0&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šæ’å…¥è®°å½•æ—¶è‹¥æœªæä¾›&lt;code&gt;stock&lt;/code&gt;å€¼ï¼Œæ•°æ®åº“è‡ªåŠ¨å¡«å……0ã€‚æ­¤æ–¹æ³•ç‹¬ç«‹äºJavaå¯¹è±¡çŠ¶æ€ï¼Œé€‚ç”¨äºæ•°æ®åº“å±‚é¢çº¦æŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç»“åˆ-1"&gt;&lt;strong&gt;ç»“åˆ&lt;code&gt;@DynamicInsert&lt;/code&gt;é¿å…NULLè¦†ç›–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“å­—æ®µå…è®¸Javaå¯¹è±¡ä¸º&lt;code&gt;null&lt;/code&gt;ä½†éœ€æ•°æ®åº“å¡«å……é»˜è®¤å€¼æ—¶ï¼Œéœ€æ·»åŠ &lt;code&gt;@DynamicInsert&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DynamicInsert&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»…æ’å…¥éç©ºå­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;stock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bigint default 0&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ä¸ºnullï¼Œä½†æ•°æ®åº“ä¼šå¡«å……é»˜è®¤å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå½“ä¸šåŠ¡å…è®¸å­—æ®µåœ¨Javaå±‚ä¸º&lt;code&gt;null&lt;/code&gt;ï¼Œä½†éœ€æ•°æ®åº“è‡ªåŠ¨è¡¥0æ—¶ä½¿ç”¨ã€‚æ³¨æ„ï¼šè‹¥Javaå¯¹è±¡æœªåˆå§‹åŒ–ä¸”å­—æ®µä¸º&lt;code&gt;null&lt;/code&gt;ï¼Œéœ€ç¡®ä¿æ•°æ®åº“é»˜è®¤å€¼ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ··åˆç­–ç•¥æ¨è"&gt;&lt;strong&gt;æ··åˆç­–ç•¥ï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="javaåˆå§‹åŒ–--æ•°æ®åº“é»˜è®¤å€¼"&gt;&lt;strong&gt;Javaåˆå§‹åŒ– + æ•°æ®åº“é»˜è®¤å€¼&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åŒæ—¶åˆå§‹åŒ–å­—æ®µå’Œé…ç½®æ•°æ®åº“é»˜è®¤å€¼ï¼Œé¿å…å±‚é—´å·®å¼‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;stock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bigint default 0&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0L&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒé‡ä¿éšœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šJavaå¯¹è±¡å§‹ç»ˆæœ‰åˆç†é»˜è®¤å€¼ï¼Œæ•°æ®åº“å±‚è¿›ä¸€æ­¥çº¦æŸæ•°æ®å®Œæ•´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-2"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒ…è£…ç±»å‹ä¸åŸºæœ¬ç±»å‹&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨åŸºæœ¬ç±»å‹&lt;code&gt;long&lt;/code&gt;ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œä½†JPAä¸­é€šå¸¸å»ºè®®ç”¨åŒ…è£…ç±»å‹&lt;code&gt;Long&lt;/code&gt;ä»¥æ”¯æŒ&lt;code&gt;null&lt;/code&gt;ã€‚éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Hibernateé…ç½®&lt;/strong&gt;ï¼šç¡®ä¿&lt;code&gt;hibernate.ddl-auto&lt;/code&gt;è®¾ç½®ä¸º&lt;code&gt;update&lt;/code&gt;æˆ–&lt;code&gt;validate&lt;/code&gt;ï¼Œä½¿&lt;code&gt;columnDefinition&lt;/code&gt;ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸€è‡´æ€§&lt;/strong&gt;ï¼šè‹¥é€šè¿‡Javaåˆå§‹åŒ–ï¼Œéœ€ç¡®ä¿æ‰€æœ‰æ–°å»ºå¯¹è±¡å‡é€šè¿‡æ­£ç¡®é€”å¾„ï¼ˆå¦‚å·¥å‚æ–¹æ³•ï¼‰åˆ›å»ºï¼Œé¿å…é—æ¼åˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ¨èä¼˜å…ˆä½¿ç”¨&lt;strong&gt;Javaç›´æ¥åˆå§‹åŒ–&lt;/strong&gt;æˆ–&lt;strong&gt;æ··åˆç­–ç•¥&lt;/strong&gt;ï¼Œæ—¢èƒ½ä¿è¯ä»£ç å¯è¯»æ€§ï¼Œåˆèƒ½åˆ©ç”¨æ•°æ®åº“çº¦æŸå¢å¼ºæ•°æ®å¥å£®æ€§ã€‚è‹¥éœ€åŠ¨æ€æ§åˆ¶é»˜è®¤å€¼ï¼ˆå¦‚ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼‰ï¼Œå¯ç»“åˆ&lt;code&gt;@PrePersist&lt;/code&gt;æ³¨è§£åœ¨æŒä¹…åŒ–å‰èµ‹å€¼ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 11</title><link>https://dyhes.github.io/p/postopia-dev-logweek-11/</link><pubDate>Mon, 21 Apr 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-11/</guid><description>&lt;p&gt;todo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;del&gt;æœç´¢&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;&lt;del&gt;æ¶ˆæ¯&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ”¹é€ &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;later:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªï¼Œæ—¥å¿—åˆ†æ&lt;/li&gt;
&lt;li&gt;è¯­ä¹‰æœç´¢&lt;/li&gt;
&lt;li&gt;æ¨é€
&lt;ul&gt;
&lt;li&gt;AI å–œå¥½åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ optimize
&lt;ul&gt;
&lt;li&gt;search after æ”¹é€ &lt;/li&gt;
&lt;li&gt;hgetall pipelineä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="record-éç©º"&gt;Record éç©º
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­æ£€æŸ¥ä»»æ„ç±»å‹ &lt;code&gt;Record&lt;/code&gt; çš„æ‰€æœ‰å­—æ®µæ˜¯å¦éç©ºï¼Œéœ€ç»“åˆ &lt;strong&gt;Java 17 çš„ &lt;code&gt;Record&lt;/code&gt; ç‰¹æ€§å’Œåå°„æœºåˆ¶&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•åŠæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå®ç°ä»£ç "&gt;æ ¸å¿ƒå®ç°ä»£ç 
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.lang.reflect.RecordComponent&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.Arrays&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.Objects&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RecordFieldChecker&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;areAllFieldsNonNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1. éªŒè¯å¯¹è±¡æ˜¯å¦ä¸º Record ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getClass&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;isRecord&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Object is not a Record&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 2. è·å– Record çš„æ‰€æœ‰å­—æ®µç»„ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RecordComponent&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;components&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getClass&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getRecordComponents&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;components&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 3. è°ƒç”¨è®¿é—®å™¨æ–¹æ³•è·å–å­—æ®µå€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getAccessor&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;invoke&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Objects&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nonNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Failed to access field: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…³é”®ç‚¹è§£æ"&gt;å…³é”®ç‚¹è§£æ
&lt;/h3&gt;&lt;h4 id="record-çš„ç‰¹æ®Šæ€§"&gt;&lt;strong&gt;Record çš„ç‰¹æ®Šæ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µè®¿é—®æ–¹å¼&lt;/strong&gt;ï¼šä¸æ™®é€šç±»é€šè¿‡ &lt;code&gt;getDeclaredFields()&lt;/code&gt; ä¸åŒï¼Œ&lt;code&gt;Record&lt;/code&gt; ä½¿ç”¨ &lt;code&gt;getRecordComponents()&lt;/code&gt; è·å–å­—æ®µå…ƒæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯å˜æ€§&lt;/strong&gt;ï¼š&lt;code&gt;Record&lt;/code&gt; çš„å­—æ®µé»˜è®¤æ˜¯ &lt;code&gt;final&lt;/code&gt; çš„ï¼Œæ„é€ æ—¶å¿…é¡»åˆå§‹åŒ–ï¼Œä½†è¿è¡Œæ—¶ä»å¯é€šè¿‡åå°„æ£€æŸ¥å…¶å€¼æ˜¯å¦éç©ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åå°„é€»è¾‘"&gt;&lt;strong&gt;åå°„é€»è¾‘&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·å–å­—æ®µç»„ä»¶&lt;/strong&gt;ï¼š&lt;code&gt;RecordComponent&lt;/code&gt; åŒ…å«å­—æ®µåã€ç±»å‹å’Œè®¿é—®å™¨æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;getAccessor()&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒç”¨è®¿é—®å™¨&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;component.getAccessor().invoke(record)&lt;/code&gt; å®‰å…¨è·å–å­—æ®µå€¼ï¼Œé¿å…ç›´æ¥è®¿é—®ç§æœ‰å­—æ®µçš„æƒé™é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç©ºå€¼æ£€æŸ¥"&gt;&lt;strong&gt;ç©ºå€¼æ£€æŸ¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Objects.nonNull()&lt;/code&gt;&lt;/strong&gt;ï¼šæ›¿ä»£ &lt;code&gt;field.get(obj) != null&lt;/code&gt; çš„ç®€æ´æ–¹å¼ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šå°è£…åå°„è°ƒç”¨å¼‚å¸¸ï¼Œå¢å¼ºå¥å£®æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨ç¤ºä¾‹"&gt;ä½¿ç”¨ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="å®šä¹‰-record-ç±»å‹"&gt;å®šä¹‰ Record ç±»å‹
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="è°ƒç”¨æ£€æŸ¥æ–¹æ³•"&gt;è°ƒç”¨æ£€æŸ¥æ–¹æ³•
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;alice@example.com&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;bob@example.com&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RecordFieldChecker&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;areAllFieldsNonNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RecordFieldChecker&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;areAllFieldsNonNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user2&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// false&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ‰©å±•åœºæ™¯"&gt;æ‰©å±•åœºæ™¯
&lt;/h3&gt;&lt;h4 id="åµŒå¥—å¯¹è±¡æ£€æŸ¥"&gt;&lt;strong&gt;åµŒå¥—å¯¹è±¡æ£€æŸ¥&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥ &lt;code&gt;Record&lt;/code&gt; åŒ…å«åµŒå¥—å¯¹è±¡å­—æ®µï¼ˆå¦‚ &lt;code&gt;Address&lt;/code&gt;ï¼‰ï¼Œéœ€é€’å½’æ£€æŸ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;components&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allMatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getAccessor&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;invoke&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Objects&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;nonNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getClass&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;isPrimitive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;areAllFieldsNonNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="è¿‡æ»¤ç‰¹å®šå­—æ®µ"&gt;&lt;strong&gt;è¿‡æ»¤ç‰¹å®šå­—æ®µ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡æ³¨è§£å¿½ç•¥æŸäº›å­—æ®µï¼ˆå¦‚ &lt;code&gt;@Nullable&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰æ³¨è§£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Retention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RetentionPolicy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;RUNTIME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@interface&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// ä¿®æ”¹æ£€æŸ¥é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;components&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isAnnotationPresent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Nullable&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allMatch&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
åå°„æ“ä½œæœ‰æ€§èƒ½å¼€é”€ï¼Œé«˜é¢‘åœºæ™¯å»ºè®®ç¼“å­˜ &lt;code&gt;RecordComponent&lt;/code&gt; æˆ–ä½¿ç”¨å­—èŠ‚ç å¢å¼ºå·¥å…·ï¼ˆå¦‚ ByteBuddyï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æƒé™&lt;/strong&gt;&lt;br&gt;
è‹¥è¿è¡Œåœ¨å®‰å…¨ç®¡ç†å™¨ä¸‹ï¼Œéœ€æˆäºˆ &lt;code&gt;suppressAccessChecks&lt;/code&gt; æƒé™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;accessor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getAccessor&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;accessor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;canAccess&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;accessor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setAccessible&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºæœ¬æ•°æ®ç±»å‹&lt;/strong&gt;&lt;br&gt;
åŸºæœ¬ç±»å‹ï¼ˆå¦‚ &lt;code&gt;int&lt;/code&gt;ï¼‰å­—æ®µçš„åŒ…è£…ç±»ï¼ˆå¦‚ &lt;code&gt;Integer&lt;/code&gt;ï¼‰å¯èƒ½ä¸º &lt;code&gt;null&lt;/code&gt;ï¼Œéœ€æ ¹æ®å®é™…ä¸šåŠ¡å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ä¼˜åŠ¿&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;getRecordComponents&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Java 17+ çš„ Record ç±»å‹&lt;/td&gt;
&lt;td&gt;å®˜æ–¹æ¨èï¼Œæ”¯æŒå­—æ®µå…ƒæ•°æ®è®¿é—®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é€’å½’æ£€æŸ¥&lt;/td&gt;
&lt;td&gt;åµŒå¥—å¯¹è±¡ç»“æ„&lt;/td&gt;
&lt;td&gt;ç¡®ä¿æ·±å±‚å­—æ®µéç©º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ³¨è§£è¿‡æ»¤&lt;/td&gt;
&lt;td&gt;éœ€è¦å¿½ç•¥ç‰¹å®šå­—æ®µ&lt;/td&gt;
&lt;td&gt;çµæ´»æ€§é«˜ï¼Œå¯å®šåˆ¶æ£€æŸ¥é€»è¾‘&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯é«˜æ•ˆæ£€æŸ¥ &lt;code&gt;Record&lt;/code&gt; ç±»å‹çš„æ‰€æœ‰å­—æ®µéç©ºæ€§ï¼Œé€‚ç”¨äºæ•°æ®éªŒè¯ã€DTO è½¬æ¢ç­‰åœºæ™¯ã€‚å¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ç»“åˆ Lombok æˆ– MapStruct ç­‰å·¥å…·ç®€åŒ–åå°„æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id="updatequery-è·¯ç”±"&gt;UpdateQuery è·¯ç”±
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Elasticsearch ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;UpdateQuery&lt;/code&gt; è¿›è¡Œå¢é‡æ›´æ–°æ—¶æŒ‡å®šè·¯ç”±ï¼ˆRoutingï¼‰çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§å®ç°é€”å¾„ï¼Œå…·ä½“å¯ç»“åˆå®˜æ–¹å®è·µå’Œæ–‡æ¡£è§„èŒƒè¿›è¡Œé…ç½®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡"&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;UpdateQuery&lt;/code&gt; å¯¹è±¡ç›´æ¥è®¾ç½®è·¯ç”±&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨æ„å»º &lt;code&gt;UpdateQuery&lt;/code&gt; å®ä¾‹æ—¶ï¼Œå¯ä»¥é€šè¿‡å…¶ &lt;code&gt;setRouting()&lt;/code&gt; æ–¹æ³•ç›´æ¥æŒ‡å®šè·¯ç”±å€¼ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºåŠ¨æ€è·¯ç”±åœºæ™¯ï¼Œä¾‹å¦‚æ ¹æ®æ–‡æ¡£çš„æŸä¸ªå­—æ®µåŠ¨æ€åˆ†é…è·¯ç”±ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;UpdateRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateRequest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;partialUpdateContent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¢é‡æ›´æ–°çš„å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;upsert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initialDocument&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯é€‰ï¼šä¸å­˜åœ¨æ—¶åˆå§‹åŒ–æ–‡æ¡£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;documentId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withUpdateRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateRequest&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withRouting&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;custom_routing_value&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‡å®šè·¯ç”±å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexCoordinates&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;your_index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;withRouting()&lt;/code&gt; æ–¹æ³•&lt;/strong&gt;ï¼šæ˜¾å¼è®¾ç½®è·¯ç”±å‚æ•°ï¼Œç¡®ä¿æ›´æ–°æ“ä½œè·¯ç”±åˆ°æ­£ç¡®çš„åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è·¯ç”±å€¼&lt;/strong&gt;ï¼šå¯é€šè¿‡ä¸šåŠ¡é€»è¾‘åŠ¨æ€ç”Ÿæˆè·¯ç”±å€¼ï¼ˆå¦‚ç”¨æˆ·IDã€åŒºåŸŸç¼–ç ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡å®ä½“ç±»çš„"&gt;&lt;strong&gt;é€šè¿‡å®ä½“ç±»çš„ &lt;code&gt;@Routing&lt;/code&gt; æ³¨è§£å®šä¹‰é™æ€è·¯ç”±&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥è·¯ç”±ç­–ç•¥æ˜¯å›ºå®šçš„ï¼ˆå¦‚åŸºäºæ–‡æ¡£çš„æŸä¸ªå›ºå®šå­—æ®µï¼‰ï¼Œå¯åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨ &lt;code&gt;@Routing&lt;/code&gt; æ³¨è§£å£°æ˜è·¯ç”±è§„åˆ™ã€‚æ­¤æ–¹å¼é€‚ç”¨äºå…¨å±€è·¯ç”±ç­–ç•¥ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹å®ä½“ç±»é…ç½®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indexName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Routing&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;category&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‡å®šè·¯ç”±å­—æ®µä¸º category&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·¯ç”±å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µåŠGetter/Setter&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ“ä½œæ—¶è‡ªåŠ¨åº”ç”¨è·¯ç”±ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;productId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withPartialUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;productUpdate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ— éœ€æ‰‹åŠ¨è®¾ç½®è·¯ç”±ï¼ŒSpring Data ä¼šæ ¹æ®å®ä½“ç±»çš„ @Routing æ³¨è§£è‡ªåŠ¨å¤„ç†&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexCoordinates&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨è§£ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šè‹¥åŒæ—¶ä½¿ç”¨ &lt;code&gt;@Routing&lt;/code&gt; æ³¨è§£å’Œ &lt;code&gt;UpdateQuery.setRouting()&lt;/code&gt;ï¼Œåè€…ä¼šè¦†ç›–å‰è€…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µè¦æ±‚&lt;/strong&gt;ï¼šè·¯ç”±å­—æ®µéœ€åœ¨æ–‡æ¡£ä¸­å­˜åœ¨ä¸”ä¸ºå¯ç´¢å¼•ç±»å‹ï¼ˆå¦‚ &lt;code&gt;Keyword&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç»“åˆ"&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;ElasticsearchOperations&lt;/code&gt; çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥è·¯ç”±&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨å¤æ‚åœºæ™¯ä¸­ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰ &lt;code&gt;RoutingResolver&lt;/code&gt; å®ç°åŠ¨æ€è·¯ç”±é€»è¾‘ï¼Œä¾‹å¦‚æ ¹æ®è¯·æ±‚ä¸Šä¸‹æ–‡æˆ–çº¿ç¨‹å±€éƒ¨å˜é‡åŠ¨æ€è®¡ç®—è·¯ç”±å€¼ã€‚æ­¤æ–¹æ³•éœ€é€šè¿‡ Spring çš„ä¾èµ–æ³¨å…¥æœºåˆ¶æ‰©å±•é»˜è®¤è¡Œä¸ºï¼Œå…·ä½“å®ç°å¯å‚è€ƒ Spring Data Elasticsearch çš„æ‹¦æˆªå™¨æœºåˆ¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;ï¼šç¡®ä¿ Spring Data Elasticsearch ç‰ˆæœ¬ä¸ Elasticsearch æœåŠ¡ç«¯ç‰ˆæœ¬åŒ¹é…ï¼ˆå¦‚ Spring Boot 2.5.x å¯¹åº” Elasticsearch 7.10.xï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡åˆ†é…&lt;/strong&gt;ï¼šè·¯ç”±å€¼ç›´æ¥å½±å“æ–‡æ¡£çš„åˆ†ç‰‡ä½ç½®ï¼Œé”™è¯¯çš„è·¯ç”±å¯èƒ½å¯¼è‡´æ›´æ–°æ“ä½œå¤±æ•ˆæˆ–æ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šåˆç†ä½¿ç”¨è·¯ç”±å¯æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä½†è¿‡åº¦è‡ªå®šä¹‰è·¯ç”±å¯èƒ½å¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å‡ï¼Œéœ€ç»“åˆé›†ç¾¤åˆ†ç‰‡ç­–ç•¥è¯„ä¼°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥çµæ´»æ§åˆ¶å¢é‡æ›´æ–°çš„è·¯ç”±ç­–ç•¥ï¼Œæ—¢æ”¯æŒé™æ€è§„åˆ™ä¹Ÿé€‚åº”åŠ¨æ€éœ€æ±‚ã€‚å»ºè®®ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@Routing&lt;/code&gt; æ³¨è§£ç®€åŒ–å…¨å±€é…ç½®ï¼ŒåŠ¨æ€åœºæ™¯å†ç»“åˆ &lt;code&gt;UpdateQuery.setRouting()&lt;/code&gt; æ˜¾å¼æŒ‡å®šã€‚&lt;/p&gt;
&lt;h2 id="record-åºåˆ—åŒ–"&gt;record åºåˆ—åŒ–
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œ&lt;code&gt;record&lt;/code&gt; ç±»å‹ä¸ä¼ ç»Ÿçš„ &lt;code&gt;class&lt;/code&gt; åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ€§èƒ½ä¸Šå­˜åœ¨ä¸€å®šå·®å¼‚ï¼Œå…·ä½“è¡¨ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å·®å¼‚çš„æ ¸å¿ƒåŸå› "&gt;&lt;strong&gt;æ€§èƒ½å·®å¼‚çš„æ ¸å¿ƒåŸå› &lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸å¯å˜æ€§ä¸å­—æ®µç»“æ„æ˜ç¡®æ€§&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;record&lt;/code&gt; çš„ä¸å¯å˜æ€§ï¼ˆæ‰€æœ‰å­—æ®µå‡ä¸º &lt;code&gt;final&lt;/code&gt;ï¼‰å’Œé¢„å®šä¹‰çš„ç»“æ„ï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆå­—æ®µé¡ºåºå’Œè®¿é—®æ–¹æ³•ï¼‰ä½¿å¾—åºåˆ—åŒ–æ—¶æ— éœ€é¢å¤–å¤„ç†å¯¹è±¡çŠ¶æ€å˜åŒ–ï¼Œé™ä½äº†è¿è¡Œæ—¶æ£€æŸ¥çš„å¤æ‚åº¦ã€‚è€Œæ™®é€š &lt;code&gt;class&lt;/code&gt; è‹¥æœªæ˜¾å¼å®ç°ä¸å¯å˜æ€§ï¼Œåºåˆ—åŒ–æ—¶éœ€è¦é¢å¤–å¤„ç†æ½œåœ¨çš„çŠ¶æ€å˜æ›´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åå°„ä¼˜åŒ–ä¸ä»£ç ç”Ÿæˆ&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;record&lt;/code&gt; çš„å­—æ®µåœ¨ç¼–è¯‘æ—¶å·²ç¡®å®šï¼Œåºåˆ—åŒ–æ¡†æ¶ï¼ˆå¦‚ Jacksonã€Furyï¼‰å¯é€šè¿‡é¢„ç”Ÿæˆçš„å­—èŠ‚ç ç›´æ¥è®¿é—®å­—æ®µï¼Œå‡å°‘åå°„å¼€é”€ã€‚ä¾‹å¦‚ï¼ŒFury æ¡†æ¶é’ˆå¯¹ &lt;code&gt;record&lt;/code&gt; ç±»å‹åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç è°ƒç”¨ &lt;code&gt;getter&lt;/code&gt; æ–¹æ³•ï¼Œæ¯”ä¼ ç»Ÿçš„åå°„æ–¹å¼å¿« 10 å€ä»¥ä¸Šã€‚è€Œæ™®é€š &lt;code&gt;class&lt;/code&gt; è‹¥æœªè‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘ï¼Œé€šå¸¸ä¾èµ–åå°„éå†å­—æ®µï¼Œæ€§èƒ½è¾ƒä½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜å¸ƒå±€ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;record&lt;/code&gt; çš„å­—æ®µåœ¨å†…å­˜ä¸­æŒ‰å£°æ˜é¡ºåºè¿ç»­æ’åˆ—ï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰ï¼Œåºåˆ—åŒ–æ—¶å¯ç›´æ¥æŒ‰é¡ºåºè¯»å†™ï¼Œå‡å°‘å¯»å€å¼€é”€ã€‚è€Œæ™®é€š &lt;code&gt;class&lt;/code&gt; çš„å­—æ®µå¸ƒå±€å¯èƒ½å› ç»§æ‰¿ã€åŠ¨æ€æ‰©å±•ç­‰å› ç´ åˆ†æ•£ï¼Œå¢åŠ å¤„ç†æˆæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”åœºæ™¯"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-é»˜è®¤åºåˆ—åŒ–jdk-åŸç”Ÿ"&gt;&lt;strong&gt;1. é»˜è®¤åºåˆ—åŒ–ï¼ˆJDK åŸç”Ÿï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;record&lt;/code&gt;&lt;/strong&gt;ï¼šJDK åŸç”Ÿåºåˆ—åŒ–ä¼šå¿½ç•¥è‡ªå®šä¹‰çš„ &lt;code&gt;writeObject&lt;/code&gt;/&lt;code&gt;readObject&lt;/code&gt; æ–¹æ³•ï¼Œç›´æ¥åŸºäºå­—æ®µé¡ºåºå¤„ç†ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚ä½†éœ€æ³¨æ„ï¼Œ&lt;code&gt;record&lt;/code&gt; å¿…é¡»æ˜¾å¼å®ç° &lt;code&gt;Serializable&lt;/code&gt; æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;class&lt;/code&gt;&lt;/strong&gt;ï¼šé»˜è®¤åºåˆ—åŒ–ä¾èµ–åå°„è·å–å­—æ®µï¼Œåå°„æ“ä½œæ¯”ç›´æ¥å†…å­˜è®¿é—®æ…¢çº¦ 10 å€ã€‚ä¾‹å¦‚ï¼Œåºåˆ—åŒ–ä¸€ä¸ªåŒ…å«å¤šä¸ª &lt;code&gt;double&lt;/code&gt; å­—æ®µçš„ &lt;code&gt;class&lt;/code&gt;ï¼Œè€—æ—¶å¯èƒ½æ¯” &lt;code&gt;record&lt;/code&gt; å¤š 30%ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-é«˜æ€§èƒ½æ¡†æ¶ä¼˜åŒ–"&gt;&lt;strong&gt;2. é«˜æ€§èƒ½æ¡†æ¶ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Fury æ¡†æ¶&lt;/strong&gt;&lt;br&gt;
Fury å¯¹ &lt;code&gt;record&lt;/code&gt; çš„åºåˆ—åŒ–è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥è°ƒç”¨ &lt;code&gt;record&lt;/code&gt; çš„ &lt;code&gt;getter&lt;/code&gt; æ–¹æ³•ï¼ˆè‹¥ä¸º &lt;code&gt;public&lt;/code&gt;ï¼‰æˆ–é€šè¿‡ &lt;code&gt;MethodHandle&lt;/code&gt; é›¶æˆæœ¬è®¿é—®å­—æ®µï¼Œé¿å…åå°„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒæŒ‰ &lt;code&gt;record&lt;/code&gt; æ„é€ å™¨çš„å­—æ®µé¡ºåºé‡æ’è¾“å…¥å‚æ•°ï¼Œç¡®ä¿é«˜æ•ˆæ„é€ å¯¹è±¡ã€‚&lt;br&gt;
å®æµ‹æ˜¾ç¤ºï¼ŒFury å¤„ç† &lt;code&gt;record&lt;/code&gt; çš„ååºåˆ—åŒ–é€Ÿåº¦æ¯” Kryo å¿« 10 å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Jackson&lt;/strong&gt;&lt;br&gt;
å¯¹ &lt;code&gt;record&lt;/code&gt; çš„åºåˆ—åŒ–æ”¯æŒä¸æ™®é€š &lt;code&gt;class&lt;/code&gt; ç±»ä¼¼ï¼Œä½† &lt;code&gt;record&lt;/code&gt; çš„ä¸å¯å˜æ€§å¯å‡å°‘ç±»å‹æ¨å¯¼å’Œå­—æ®µæ£€æŸ¥æ­¥éª¤ï¼Œæ€§èƒ½ç•¥ä¼˜ã€‚ä¾‹å¦‚ï¼Œåºåˆ—åŒ–ä¸€ä¸ªåŒ…å« 10 ä¸ªå­—æ®µçš„ &lt;code&gt;record&lt;/code&gt; æ¯”ç­‰æ•ˆçš„ &lt;code&gt;class&lt;/code&gt; å¿«çº¦ 15%ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ç“¶é¢ˆä¸æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µå˜æ›´çš„å…¼å®¹æ€§&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;record&lt;/code&gt; çš„å­—æ®µé¡ºåºåœ¨åºåˆ—åŒ–åè‹¥å‘ç”Ÿå˜æ›´ï¼ˆå¦‚æ–°å¢å­—æ®µï¼‰ï¼Œååºåˆ—åŒ–å¯èƒ½å› æ„é€ å™¨å‚æ•°é¡ºåºä¸åŒ¹é…è€Œå¤±è´¥ï¼Œéœ€é€šè¿‡è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;@JsonCreator&lt;/code&gt;ï¼‰è§£å†³ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤§å¯¹è±¡å¤„ç†&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;record&lt;/code&gt; çš„ä¸å¯å˜æ€§è™½æå‡æ€§èƒ½ï¼Œä½†å¤„ç†åŒ…å«å¤§é›†åˆï¼ˆå¦‚ &lt;code&gt;List&amp;lt;Map&amp;gt;&lt;/code&gt;ï¼‰çš„ &lt;code&gt;record&lt;/code&gt; æ—¶ï¼Œä»éœ€æ³¨æ„å†…å­˜åˆ†é…å’Œæµå¼å¤„ç†ï¼ˆå¦‚ä½¿ç”¨ &lt;code&gt;JsonParser&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¡†æ¶é€‚é…æ€§&lt;/strong&gt;&lt;br&gt;
éƒ¨åˆ†æ¡†æ¶ï¼ˆå¦‚æ—©æœŸç‰ˆæœ¬çš„ Hibernateï¼‰å¯èƒ½ä¸å®Œå…¨æ”¯æŒ &lt;code&gt;record&lt;/code&gt; ç±»å‹ï¼Œéœ€ç»“åˆæ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@JdbcTypeCode&lt;/code&gt;ï¼‰æˆ–è½¬æ¢å™¨é€‚é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨èä½¿ç”¨ &lt;code&gt;record&lt;/code&gt; çš„åœºæ™¯&lt;/strong&gt;&lt;br&gt;
æ•°æ®è½½ä½“ç±»ï¼ˆDTOï¼‰ã€é…ç½®ç±»ã€ä¸å¯å˜å®ä½“ç­‰åœºæ™¯ï¼Œä¼˜å…ˆé€‰æ‹© &lt;code&gt;record&lt;/code&gt;ã€‚å…¶åºåˆ—åŒ–æ€§èƒ½åœ¨ä¸»æµæ¡†æ¶ï¼ˆFuryã€Jacksonï¼‰ä¸­è¡¨ç°æ›´ä¼˜ï¼Œå°¤å…¶åœ¨å­—æ®µç»“æ„ç¨³å®šæ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»å»ºè®®ä½¿ç”¨ &lt;code&gt;class&lt;/code&gt; çš„åœºæ™¯&lt;/strong&gt;&lt;br&gt;
éœ€è¦åŠ¨æ€ä¿®æ”¹å­—æ®µã€å¤æ‚ç»§æ‰¿å…³ç³»æˆ–ä¾èµ– JPA/Hibernate æŒä¹…åŒ–çš„åœºæ™¯ï¼Œæ™®é€š &lt;code&gt;class&lt;/code&gt; æ›´çµæ´»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©ç±»å‹å’Œæ¡†æ¶ï¼Œ&lt;code&gt;record&lt;/code&gt; çš„åºåˆ—åŒ–æ€§èƒ½å¯æ˜¾è‘—ä¼˜äºä¼ ç»Ÿ &lt;code&gt;class&lt;/code&gt;ï¼Œå°¤å…¶åœ¨æ•°æ®å¯†é›†å‹åº”ç”¨ä¸­ã€‚&lt;/p&gt;
&lt;h2 id="document"&gt;Document
&lt;/h2&gt;&lt;p&gt;interface Document extends StringObjectMap&lt;Document&gt;
&lt;code&gt;public interface Document extends StringObjectMap&amp;lt;Document&amp;gt;&lt;/code&gt; æ˜¯ä¸€ä¸ªå…¸å‹çš„è‡ªå¼•ç”¨æ³›å‹æ¥å£å®šä¹‰ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯ä¸ºé”®å€¼å¯¹ç»“æ„æä¾›ç±»å‹åŒ–çš„æ“ä½œæ”¯æŒã€‚ä»¥ä¸‹åˆ†ç‚¹è§£æå…¶è®¾è®¡é€»è¾‘å’Œå…¸å‹åº”ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ¥å£å®šä¹‰è§£æ"&gt;&lt;strong&gt;æ¥å£å®šä¹‰è§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»§æ‰¿å…³ç³»&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;StringObjectMap&amp;lt;Document&amp;gt;&lt;/code&gt; è¡¨ç¤ºä¸€ä¸ªä»¥ &lt;code&gt;String&lt;/code&gt; ç±»å‹ä¸ºé”®ã€&lt;code&gt;Object&lt;/code&gt; ç±»å‹ä¸ºå€¼çš„æ³›å‹æ˜ å°„ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;&amp;lt;Document&amp;gt;&lt;/code&gt; çš„æ³›å‹å‚æ•°ï¼Œè¯¥æ¥å£å°†å€¼ç±»å‹çº¦æŸä¸º &lt;code&gt;Document&lt;/code&gt; è‡ªèº«ï¼Œå½¢æˆ&lt;strong&gt;åµŒå¥—ç»“æ„&lt;/strong&gt;ï¼Œå…è®¸å€¼æœ¬èº«ä¹Ÿæ˜¯ &lt;code&gt;Document&lt;/code&gt; å®ä¾‹ï¼ˆå¦‚ JSON å¯¹è±¡åµŒå¥—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå¼•ç”¨è®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Document&lt;/code&gt; æ¥å£ç»§æ‰¿ &lt;code&gt;StringObjectMap&amp;lt;Document&amp;gt;&lt;/code&gt;ï¼Œæ„å‘³ç€æ¯ä¸ªé”®å€¼å¯¹ä¸­çš„å€¼å¯ä»¥æ˜¯å¦ä¸€ä¸ª &lt;code&gt;Document&lt;/code&gt; å¯¹è±¡ã€‚è¿™ç§è®¾è®¡æ”¯æŒ&lt;strong&gt;æ ‘å½¢æˆ–åˆ†å±‚æ•°æ®ç»“æ„&lt;/strong&gt;ï¼ˆä¾‹å¦‚ JSONã€XML æˆ–æ–‡æ¡£å‹æ•°æ®åº“ä¸­çš„æ–‡æ¡£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•èƒ½åŠ›&lt;/strong&gt;&lt;br&gt;
æ¥å£å¯èƒ½åŒ…å«ä»¥ä¸‹å…¸å‹æ–¹æ³•ï¼ˆç±»ä¼¼ &lt;code&gt;Map&lt;/code&gt; æ¥å£ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ·»åŠ é”®å€¼å¯¹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–åµŒå¥—å­æ–‡æ¡£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;containsKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™äº›æ–¹æ³•å…è®¸é€šè¿‡é”®æ“ä½œåµŒå¥—çš„æ–‡æ¡£ç»“æ„ï¼ˆå‚è€ƒç½‘é¡µ[8]ä¸­ &lt;code&gt;Map&lt;/code&gt; æ¥å£çš„å®šä¹‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–‡æ¡£å‹æ•°æ®æ¨¡å‹&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äº MongoDBã€Elasticsearch ç­‰æ–‡æ¡£æ•°æ®åº“çš„æ–‡æ¡£è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·æ–‡æ¡£å¯èƒ½åŒ…å«åµŒå¥—çš„åœ°å€æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;èœ¡ç¬”å°æ–°&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;address&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;city&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ä¸œäº¬&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;street&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;æ˜¥æ—¥éƒ¨&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤åœºæ™¯ä¸­ï¼Œ&lt;code&gt;address&lt;/code&gt; å­—æ®µçš„å€¼æ˜¯å¦ä¸€ä¸ª &lt;code&gt;Document&lt;/code&gt; å¯¹è±¡ï¼ˆç½‘é¡µ[7]ä¸­ &lt;code&gt;EnumMap&lt;/code&gt; çš„é”®å€¼ç»“æ„ç±»ä¼¼ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€é…ç½®æˆ–å…ƒæ•°æ®&lt;/strong&gt;&lt;br&gt;
ç”¨äºè¡¨ç¤ºåŠ¨æ€é…ç½®é¡¹ï¼Œå…¶ä¸­é…ç½®å€¼å¯èƒ½æ˜¯å¦ä¸€ä¸ªé…ç½®å—ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BasicDocument&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;database&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BasicDocument&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;jdbc:mysql://localhost:3306/test&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;username&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;root&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JSON/XML å¤„ç†&lt;/strong&gt;&lt;br&gt;
åœ¨åºåˆ—åŒ–æ¡†æ¶ä¸­ï¼Œ&lt;code&gt;Document&lt;/code&gt; æ¥å£å¯è¡¨ç¤º JSON å¯¹è±¡æˆ– XML èŠ‚ç‚¹ï¼Œæ”¯æŒåµŒå¥—è§£æï¼ˆç±»ä¼¼ç½‘é¡µ[6]ä¸­ UniHttp æ¡†æ¶çš„ &lt;code&gt;@BodyJsonPar&lt;/code&gt; å‚æ•°ç»‘å®šé€»è¾‘ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°ç±»ç¤ºä¾‹"&gt;&lt;strong&gt;å®ç°ç±»ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å‡è®¾å­˜åœ¨ä¸€ä¸ªåŸºç¡€å®ç°ç±» &lt;code&gt;BasicDocument&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BasicDocument&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤ç±»é€šè¿‡ &lt;code&gt;HashMap&lt;/code&gt; å­˜å‚¨é”®å€¼å¯¹ï¼Œå¹¶å…è®¸å€¼çš„åµŒå¥—ï¼ˆç±»ä¼¼ç½‘é¡µ[8]ä¸­ &lt;code&gt;HashMap&lt;/code&gt; çš„å®ç°é€»è¾‘ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŠ¿ä¸é™åˆ¶"&gt;&lt;strong&gt;ä¼˜åŠ¿ä¸é™åˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹å®‰å…¨&lt;/strong&gt;ï¼šé€šè¿‡æ³›å‹çº¦æŸå€¼çš„ç±»å‹ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;ï¼šæ”¯æŒåŠ¨æ€åµŒå¥—ç»“æ„ï¼Œé€‚ç”¨äºéå›ºå®šæ¨¡å¼æ•°æ®ï¼ˆå¦‚ NoSQL æ–‡æ¡£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;ï¼šåµŒå¥—å±‚çº§è¿‡æ·±å¯èƒ½å¯¼è‡´é€’å½’æ“ä½œæ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åº¦&lt;/strong&gt;ï¼šéœ€å¤„ç†å¾ªç¯å¼•ç”¨ç­‰è¾¹ç•Œæ¡ä»¶ï¼ˆå‚è€ƒç½‘é¡µ[4]ä¸­æ³›å‹ç­–ç•¥æ¨¡å¼çš„ç±»å‹å®‰å…¨è®¾è®¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Document&lt;/code&gt; æ¥å£é€šè¿‡è‡ªå¼•ç”¨æ³›å‹è®¾è®¡ï¼Œæä¾›äº†ä¸€ç§ç±»å‹åŒ–çš„é”®å€¼å¯¹åµŒå¥—ç»“æ„ï¼Œé€‚ç”¨äºæ–‡æ¡£å‹æ•°æ®åº“ã€åŠ¨æ€é…ç½®å’Œ JSON/XML æ•°æ®å¤„ç†ç­‰åœºæ™¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ¥å£ç»§æ‰¿å’Œæ³›å‹çº¦æŸï¼Œå®ç°çµæ´»ä¸”ç±»å‹å®‰å…¨çš„æ•°æ®å»ºæ¨¡ï¼ˆç±»ä¼¼ç½‘é¡µ[6]ä¸­å£°æ˜å¼æ¥å£çš„è®¾è®¡ç†å¿µï¼‰ã€‚&lt;/p&gt;
&lt;h2 id="updatequery-withdocument"&gt;UpdateQuery withDocument
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Elasticsearch ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;UpdateQuery&lt;/code&gt; çš„ &lt;code&gt;Document&lt;/code&gt; å­—æ®µå®ç°æ–‡æ¡£éƒ¨åˆ†å­—æ®µæ›´æ–°ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤å’Œç­–ç•¥å®ç°ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ–¹æ³•"&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•ï¼š&lt;code&gt;UpdateQuery.withDocument()&lt;/code&gt;&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;withDocument()&lt;/code&gt; æ–¹æ³•ç›´æ¥æŒ‡å®šéœ€æ›´æ–°çš„å­—æ®µé”®å€¼å¯¹ï¼Œ&lt;strong&gt;ä»…ä¿®æ”¹ç›®æ ‡å­—æ®µ&lt;/strong&gt;ï¼Œè€Œéå…¨é‡æ›¿æ¢æ–‡æ¡£ã€‚æ­¤æ–¹æ³•é€‚ç”¨äºç®€å•çš„å­—æ®µèµ‹å€¼åœºæ™¯ã€‚&lt;/p&gt;
&lt;h4 id="å®ç°æ­¥éª¤"&gt;&lt;strong&gt;å®ç°æ­¥éª¤&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„å»º &lt;code&gt;Document&lt;/code&gt; å¯¹è±¡&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;Document.create()&lt;/code&gt; åˆ›å»ºåŒ…å«æ›´æ–°å­—æ®µçš„é”®å€¼å¯¹ï¼Œ&lt;strong&gt;ä»…åŒ…å«éœ€è¦ä¿®æ”¹çš„å­—æ®µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateDoc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;price&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;999&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;99&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ›´æ–°ä»·æ ¼å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;active&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ–°å¢çŠ¶æ€å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„é€  &lt;code&gt;UpdateQuery&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æŒ‡å®šæ–‡æ¡£ ID å¹¶ç»‘å®š &lt;code&gt;Document&lt;/code&gt; å¯¹è±¡ï¼Œé€šè¿‡ &lt;code&gt;withDocument()&lt;/code&gt; æ–¹æ³•å®ç°éƒ¨åˆ†æ›´æ–°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;document_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withDocument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateDoc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰§è¡Œæ›´æ–°&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;ElasticsearchRestTemplate&lt;/code&gt; æˆ– &lt;code&gt;ElasticsearchOperations&lt;/code&gt; æäº¤æ›´æ–°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;elasticsearchRestTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexCoordinates&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;product_index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ç‰¹æ€§è¯´æ˜"&gt;&lt;strong&gt;ç‰¹æ€§è¯´æ˜&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå­æ€§&lt;/strong&gt;ï¼šä»…ä¿®æ”¹æŒ‡å®šå­—æ®µï¼Œä¸å½±å“å…¶ä»–å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§&lt;/strong&gt;ï¼šæ”¯æŒæ–°å¢å­—æ®µï¼ˆéœ€ç´¢å¼•æ˜ å°„å…è®¸åŠ¨æ€å­—æ®µï¼Œå¦åˆ™éœ€æå‰å®šä¹‰æ˜ å°„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼šç›¸æ¯”å…¨é‡æ›´æ–°ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’Œ ES è®¡ç®—å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é«˜çº§åœºæ™¯ç»“åˆè„šæœ¬æ›´æ–°"&gt;&lt;strong&gt;é«˜çº§åœºæ™¯ï¼šç»“åˆè„šæœ¬æ›´æ–°&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€å¤æ‚é€»è¾‘ï¼ˆå¦‚æ•°å€¼ç´¯åŠ ã€æ¡ä»¶åˆ¤æ–­ï¼‰ï¼Œéœ€ç»“åˆ &lt;strong&gt;Painless è„šæœ¬&lt;/strong&gt; å®ç°æ›´çµæ´»çš„å­—æ®µæ“ä½œã€‚&lt;/p&gt;
&lt;h4 id="ç¤ºä¾‹ä»·æ ¼é€’å¢ä¸çŠ¶æ€è”åŠ¨"&gt;&lt;strong&gt;ç¤ºä¾‹ï¼šä»·æ ¼é€’å¢ä¸çŠ¶æ€è”åŠ¨&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;increment&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;threshold&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Script&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Script&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ScriptType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;INLINE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;painless&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;if (ctx._source.price &amp;lt; params.threshold) { &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; ctx._source.price += params.increment; &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; ctx._source.status = &amp;#39;promoted&amp;#39;; &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;document_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withScript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å­—æ®µé—´å­˜åœ¨è®¡ç®—é€»è¾‘ï¼ˆå¦‚åº“å­˜æ‰£å‡ã€è¯„åˆ†æ›´æ–°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦æ ¹æ®ç°æœ‰å­—æ®µå€¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­çš„æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç‰ˆæœ¬å…¼å®¹æ€§ä¸é…ç½®"&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§ä¸é…ç½®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç‰ˆæœ¬è¦æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring Data Elasticsearch &lt;strong&gt;4.0+&lt;/strong&gt; æ¨èä½¿ç”¨ &lt;code&gt;UpdateQuery&lt;/code&gt; æ›¿ä»£æ—§ç‰ˆ &lt;code&gt;UpdateRequest&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;éœ€ç¡®ä¿ Elasticsearch æœåŠ¡ç«¯ç‰ˆæœ¬ä¸å®¢æˆ·ç«¯å…¼å®¹ï¼ˆå¦‚ Spring Boot 2.7.x å¯¹åº” ES 7.17.xï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•æ˜ å°„é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ¨æ€æ˜ å°„å¼€å¯ï¼šç¡®ä¿ &lt;code&gt;&amp;quot;dynamic&amp;quot;: true&lt;/code&gt;ï¼ˆé»˜è®¤ï¼‰ï¼Œå¦åˆ™æ–°å¢å­—æ®µä¼šæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;å­—æ®µç±»å‹åŒ¹é…ï¼šæ›´æ–°å€¼éœ€ä¸æ˜ å°„ç±»å‹ä¸€è‡´ï¼ˆå¦‚ &lt;code&gt;Text&lt;/code&gt; ç±»å‹å­—æ®µä¸å¯èµ‹å€¼ä¸ºæ•°å­—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡æ›´æ–°&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;BulkProcessor&lt;/code&gt; æˆ– &lt;code&gt;BulkOperations&lt;/code&gt; æ‰¹é‡æäº¤å¤šä¸ª &lt;code&gt;UpdateQuery&lt;/code&gt;ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;queries&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ„é€ æ‰¹é‡æ›´æ–°åˆ—è¡¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;elasticsearchRestTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bulkUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queries&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexCoordinates&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;product_index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ·æ–°ç­–ç•¥&lt;/strong&gt;&lt;br&gt;
é»˜è®¤æ›´æ–°æ“ä½œä¸ç«‹å³åˆ·æ–°ç´¢å¼•ï¼ˆè¿‘å®æ—¶æœç´¢ï¼‰ï¼Œè‹¥éœ€å¼ºåˆ¶åˆ·æ–°å¯è®¾ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;document_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withDocument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateDoc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withRefreshPolicy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RefreshPolicy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IMMEDIATE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç«‹å³åˆ·æ–°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šé«˜é¢‘ç‡å¼ºåˆ¶åˆ·æ–°å¯èƒ½å½±å“é›†ç¾¤æ€§èƒ½ï¼Œå»ºè®®ä»…åœ¨å¿…è¦æ—¶å¯ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†²çªå¤„ç†&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;withVersion()&lt;/code&gt; æŒ‡å®šæ–‡æ¡£ç‰ˆæœ¬å·ï¼Œé¿å…å¹¶å‘æ›´æ–°å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UpdateQuery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;document_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withDocument&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updateDoc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withVersion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;previousVersion&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¯¹æ¯”"&gt;&lt;strong&gt;å¯¹æ¯”ï¼š&lt;code&gt;withDocument&lt;/code&gt; vs å…¨é‡æ›´æ–°&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;withDocument&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è½»é‡ã€é«˜æ•ˆï¼Œä»…ä¼ è¾“ä¿®æ”¹å­—æ®µ&lt;/td&gt;
&lt;td&gt;ç®€å•å­—æ®µèµ‹å€¼ã€æ–°å¢å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¨é‡æ›¿æ¢&lt;/td&gt;
&lt;td&gt;æ•°æ®å®Œæ•´æ€§é«˜ï¼Œè¦†ç›–å…¨éƒ¨å­—æ®µ&lt;/td&gt;
&lt;td&gt;æ–‡æ¡£ç»“æ„é‡æ„æˆ–å…¨å­—æ®µæ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è„šæœ¬æ›´æ–°&lt;/td&gt;
&lt;td&gt;æ”¯æŒå¤æ‚é€»è¾‘ï¼ˆè®¡ç®—ã€æ¡ä»¶åˆ¤æ–­ï¼‰&lt;/td&gt;
&lt;td&gt;æ•°å€¼ç´¯åŠ ã€çŠ¶æ€è”åŠ¨ã€åµŒå¥—å­—æ®µæ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•æ›´æ–°&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;code&gt;withDocument()&lt;/code&gt; ç›´æ¥æ“ä½œå­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚é€»è¾‘&lt;/strong&gt;ï¼šé€šè¿‡ Painless è„šæœ¬å®ç°æ¡ä»¶åˆ¤æ–­æˆ–è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è°ƒä¼˜&lt;/strong&gt;ï¼šç»“åˆæ‰¹é‡æäº¤ã€å†²çªç‰ˆæœ¬æ§åˆ¶å’Œåˆç†çš„åˆ·æ–°ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…·ä½“å®ç°æ—¶ï¼Œéœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚æ–¹æ³•ï¼Œå¹¶æ³¨æ„ç‰ˆæœ¬å…¼å®¹æ€§ä¸ç´¢å¼•æ˜ å°„é…ç½®ã€‚&lt;/p&gt;
&lt;h2 id="map-json-åºåˆ—åŒ–"&gt;Map JSON åºåˆ—åŒ–
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼ŒMap çš„ JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ€§èƒ½æ¶ˆè€—å—å¤šç§å› ç´ å½±å“ï¼ŒåŒ…æ‹¬æ•°æ®è§„æ¨¡ã€JSON åº“é€‰æ‹©ã€åºåˆ—åŒ–ç­–ç•¥ç­‰ã€‚ä»¥ä¸‹æ˜¯åŸºäºå®é™…æµ‹è¯•å’Œä¼˜åŒ–ç­–ç•¥çš„ç»¼åˆåˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½æ¶ˆè€—çš„æ ¸å¿ƒå› ç´ "&gt;&lt;strong&gt;æ€§èƒ½æ¶ˆè€—çš„æ ¸å¿ƒå› ç´ &lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®è§„æ¨¡ä¸å¤æ‚åº¦&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°è§„æ¨¡ Mapï¼ˆ10-100 é”®å€¼å¯¹ï¼‰&lt;/strong&gt;ï¼šJSON åºåˆ—åŒ–/ååºåˆ—åŒ–æ€»è€—æ—¶é€šå¸¸æ¯” Java åŸç”Ÿåºåˆ—åŒ–å¿« 30%-50%ã€‚ä¾‹å¦‚ï¼Œååºåˆ—åŒ– 100 ä¸ªé”®å€¼å¯¹çš„ Mapï¼ŒJackson çš„è€—æ—¶ä»…ä¸º Java åŸç”Ÿåºåˆ—åŒ–çš„ 60%ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§è§„æ¨¡ Mapï¼ˆ100-1000 é”®å€¼å¯¹ï¼‰&lt;/strong&gt;ï¼šJSON åºåˆ—åŒ–ï¼ˆå¦‚ json-smartï¼‰ä»è¡¨ç°ä¼˜å¼‚ï¼Œä½†éƒ¨åˆ†åº“ï¼ˆå¦‚ Gsonï¼‰åœ¨ååºåˆ—åŒ–æ—¶æ€§èƒ½å¯èƒ½ä¸‹é™ï¼Œè€Œ Java åŸç”Ÿåºåˆ—åŒ–çš„è€—æ—¶ç›¸å¯¹ç¨³å®šä½†æ€»ä½“æ›´é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JSON åº“çš„é€‰æ‹©&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Jackson&lt;/strong&gt;ï¼šåºåˆ—åŒ–é€Ÿåº¦æœ€å¿«ï¼Œå°¤å…¶é€‚åˆå¤æ‚å¯¹è±¡å’Œæµå¼å¤„ç†ã€‚ä¾‹å¦‚ï¼Œåºåˆ—åŒ– 100,000 ä¸ªå¯¹è±¡æ—¶ï¼ŒJackson æ¯” Gson å¿«çº¦ 50%ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;json-smart&lt;/strong&gt;ï¼šååºåˆ—åŒ–æ€§èƒ½æœ€ä¼˜ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gson&lt;/strong&gt;ï¼šç®€å•åœºæ™¯ä¸‹æ˜“ç”¨æ€§é«˜ï¼Œä½†æ€§èƒ½ç•¥é€Šäº Jackson å’Œ json-smartã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åºåˆ—åŒ–æ•°æ®ä½“ç§¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Java åŸç”Ÿåºåˆ—åŒ–&lt;/strong&gt;ï¼šä½“ç§¯è¾ƒå¤§ï¼ˆå› æºå¸¦ç±»å…ƒæ•°æ®ï¼‰ï¼Œä¾‹å¦‚ç›¸åŒ Map çš„åºåˆ—åŒ–ç»“æœä½“ç§¯å¯èƒ½æ˜¯ JSON çš„ 2-5 å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JSON&lt;/strong&gt;ï¼šä»…ä¿ç•™é”®å€¼å¯¹ä¿¡æ¯ï¼Œä½“ç§¯æ›´å°ï¼Œé€‚åˆç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜ä¸ CPU æ¶ˆè€—&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JSON ååºåˆ—åŒ–&lt;/strong&gt;ï¼šéœ€åŠ¨æ€åˆ›å»ºå¯¹è±¡å’Œè§£ææ–‡æœ¬ï¼Œå†…å­˜æ¶ˆè€—è¾ƒé«˜ï¼Œå°¤å…¶æ˜¯å¤„ç†åµŒå¥—ç»“æ„æ—¶å¯èƒ½è§¦å‘å¤šæ¬¡ GCã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Java åŸç”Ÿåºåˆ—åŒ–&lt;/strong&gt;ï¼šä¾èµ–åå°„æœºåˆ¶ï¼ŒCPU å¼€é”€è¾ƒå¤§ï¼Œä¸”å¯èƒ½å› ç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–ç­–ç•¥"&gt;&lt;strong&gt;ä¼˜åŒ–ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-é€‰æ‹©åˆé€‚çš„-json-åº“"&gt;&lt;strong&gt;1. é€‰æ‹©åˆé€‚çš„ JSON åº“&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½åœºæ™¯&lt;/strong&gt;ï¼šä¼˜å…ˆé€‰æ‹© Jackson æˆ– json-smartã€‚Jackson é€šè¿‡æµå¼ APIï¼ˆå¦‚ &lt;code&gt;JsonGenerator&lt;/code&gt;ï¼‰å’Œé¢„ç¼–è¯‘æ¨¡å¼å‡å°‘å†…å­˜å ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§éœ€æ±‚&lt;/strong&gt;ï¼šGson æ”¯æŒæ›´çµæ´»çš„æ³¨è§£é…ç½®ï¼Œé€‚åˆéœ€è¦å¤æ‚å­—æ®µæ˜ å°„çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å‡å°‘ä¸å¿…è¦çš„æ•°æ®å¤„ç†"&gt;&lt;strong&gt;2. å‡å°‘ä¸å¿…è¦çš„æ•°æ®å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µè¿‡æ»¤&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@JsonIgnore&lt;/code&gt; æˆ– &lt;code&gt;@JsonProperty&lt;/code&gt; æ³¨è§£æ’é™¤æ— å…³å­—æ®µï¼Œå‡å°‘åºåˆ—åŒ–æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‡’åŠ è½½æœºåˆ¶&lt;/strong&gt;ï¼šä»…ååºåˆ—åŒ–å½“å‰éœ€è¦çš„å­—æ®µï¼Œä¾‹å¦‚ä½¿ç”¨ Jackson çš„ &lt;code&gt;JsonNode&lt;/code&gt; æŒ‰éœ€è§£æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-æå‡å¤„ç†æ•ˆç‡"&gt;&lt;strong&gt;3. æå‡å¤„ç†æ•ˆç‡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµå¼å¤„ç†&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;JsonParser&lt;/code&gt; å’Œ &lt;code&gt;JsonGenerator&lt;/code&gt; é€å—å¤„ç†æ•°æ®ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§ JSON åˆ°å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜ä¸å¯¹è±¡æ± &lt;/strong&gt;ï¼šå¤ç”¨ &lt;code&gt;ObjectMapper&lt;/code&gt; å®ä¾‹å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå‡å°‘ GC å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-é¢„ç¼–è¯‘ä¸æ¨¡å¼ä¼˜åŒ–"&gt;&lt;strong&gt;4. é¢„ç¼–è¯‘ä¸æ¨¡å¼ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢„å®šä¹‰ Schema&lt;/strong&gt;ï¼šå¯¹å›ºå®šç»“æ„çš„ Map ä½¿ç”¨ Protobuf æˆ– Avroï¼ˆéœ€æƒè¡¡è·¨è¯­è¨€éœ€æ±‚ï¼‰ï¼Œåºåˆ—åŒ–é€Ÿåº¦å’Œä½“ç§¯ä¼˜äº JSONã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Jackson æ³¨è§£ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;@JsonFormat&lt;/code&gt; æ§åˆ¶æ—¥æœŸæ ¼å¼ã€&lt;code&gt;@JsonInclude&lt;/code&gt; è¿‡æ»¤ç©ºå€¼ç­‰ï¼Œå‡å°‘è¿è¡Œæ—¶è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”æ€»ç»“"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æŒ‡æ ‡&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Java åŸç”Ÿåºåˆ—åŒ–&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;JSON åºåˆ—åŒ–ï¼ˆJackson/json-smartï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åºåˆ—åŒ–é€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ…¢ï¼ˆåå°„å¼€é”€å¤§ï¼‰&lt;/td&gt;
&lt;td&gt;å¿«ï¼ˆJackson æœ€å¿«ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ååºåˆ—åŒ–é€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ææ…¢ï¼ˆç±»å‹è§£æå¤æ‚ï¼‰&lt;/td&gt;
&lt;td&gt;å¿«ï¼ˆjson-smart æœ€ä¼˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ä½“ç§¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤§ï¼ˆå«ç±»å…ƒæ•°æ®ï¼‰&lt;/td&gt;
&lt;td&gt;å°ï¼ˆä»…é”®å€¼å¯¹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜æ¶ˆè€—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆåå°„å ç”¨å †å†…å­˜ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆåŠ¨æ€å¯¹è±¡åˆ›å»ºï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è·¨è¯­è¨€å…¼å®¹æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…é™ Java&lt;/td&gt;
&lt;td&gt;æ”¯æŒæ‰€æœ‰è¯­è¨€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µå»ºè®®"&gt;&lt;strong&gt;å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å°è§„æ¨¡æ•°æ®&lt;/strong&gt;ï¼šç›´æ¥ä½¿ç”¨ Jackson æˆ– Gsonï¼Œå…¼é¡¾å¼€å‘æ•ˆç‡å’Œæ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘å¤§æ•°æ®åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€‰æ‹© json-smart æˆ– Jackson æµå¼ APIã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨ç¼“å­˜ï¼ˆå¦‚ &lt;code&gt;ConcurrentHashMap&lt;/code&gt; å­˜å‚¨ååºåˆ—åŒ–ç»“æœï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•æ„Ÿæ•°æ®&lt;/strong&gt;ï¼šé¿å…ä½¿ç”¨ Java åŸç”Ÿåºåˆ—åŒ–ï¼ˆæ˜“å—ååºåˆ—åŒ–æ”»å‡»ï¼‰ï¼Œæ”¹ç”¨ JSON å¹¶å¯ç”¨åŠ å¯†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©å·¥å…·å’Œä¼˜åŒ–ç­–ç•¥ï¼Œå¯æ˜¾è‘—é™ä½ Map çš„ JSON å¤„ç†æ¶ˆè€—ï¼Œå¹³è¡¡æ€§èƒ½ä¸å¼€å‘æˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id="indexcoordinates"&gt;IndexCoordinates
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Elasticsearch çš„ &lt;code&gt;ElasticsearchOperations&lt;/code&gt; æ¥å£ä¸­ï¼Œä¸¤ä¸ª &lt;code&gt;delete&lt;/code&gt; æ–¹æ³•çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨&lt;strong&gt;ç´¢å¼•çš„æ˜¾å¼æ§åˆ¶&lt;/strong&gt;ä¸Šï¼Œå…·ä½“å·®å¼‚å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å‚æ•°å·®å¼‚"&gt;&lt;strong&gt;å‚æ•°å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•1&lt;/strong&gt;ï¼š&lt;code&gt;ByQueryResponse delete(DeleteQuery query, Class&amp;lt;?&amp;gt; clazz, IndexCoordinates index)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šå‡ºå‚æ•°&lt;/strong&gt;ï¼š&lt;code&gt;IndexCoordinates index&lt;/code&gt;ï¼Œéœ€æ˜¾å¼æŒ‡å®šæ“ä½œçš„ç›®æ ‡ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€è¦è·¨å¤šä¸ªç´¢å¼•æˆ–åŠ¨æ€æŒ‡å®šç´¢å¼•æ—¶ä½¿ç”¨ï¼ˆä¾‹å¦‚åŸºäºåˆ«åæˆ–é€šé…ç¬¦ç´¢å¼•åï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•2&lt;/strong&gt;ï¼š&lt;code&gt;ByQueryResponse delete(DeleteQuery query, Class&amp;lt;?&amp;gt; clazz)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çœç•¥å‚æ•°&lt;/strong&gt;ï¼š&lt;code&gt;IndexCoordinates index&lt;/code&gt;ï¼Œé»˜è®¤ä»å®ä½“ç±»çš„ &lt;code&gt;@Document&lt;/code&gt; æ³¨è§£ä¸­æå–ç´¢å¼•åã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæ“ä½œå®ä½“ç±»ç»‘å®šçš„å•ä¸€å›ºå®šç´¢å¼•ï¼ˆé€šè¿‡ &lt;code&gt;@Document(indexName = &amp;quot;your_index&amp;quot;)&lt;/code&gt; å®šä¹‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="åº•å±‚å®ç°ä¸çµæ´»æ€§"&gt;&lt;strong&gt;åº•å±‚å®ç°ä¸çµæ´»æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾å¼ç´¢å¼•æ§åˆ¶ï¼ˆæ–¹æ³•1ï¼‰&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;IndexCoordinates&lt;/code&gt; å‚æ•°ï¼Œå¯ç›´æ¥æŒ‡å®šç´¢å¼•åã€åˆ«åæˆ–ç´¢å¼•æ¨¡å¼ï¼ˆå¦‚ &lt;code&gt;log-*&lt;/code&gt;ï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;IndexCoordinates&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexCoordinates&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;logs_2025&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;logs_2024&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†åŒæ—¶åœ¨ &lt;code&gt;logs_2025&lt;/code&gt; å’Œ &lt;code&gt;logs_2024&lt;/code&gt; ç´¢å¼•ä¸­æ‰§è¡Œåˆ é™¤æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éšå¼ç´¢å¼•ç»‘å®šï¼ˆæ–¹æ³•2ï¼‰&lt;/strong&gt;&lt;br&gt;
ä¾èµ–å®ä½“ç±» &lt;code&gt;clazz&lt;/code&gt; çš„ &lt;code&gt;@Document&lt;/code&gt; æ³¨è§£é…ç½®çš„ç´¢å¼•åã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indexName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;products&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Product&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/*...*/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ƒç”¨ &lt;code&gt;delete(query, Product.class)&lt;/code&gt; æ—¶ï¼Œè‡ªåŠ¨æ“ä½œ &lt;code&gt;products&lt;/code&gt; ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•1ï¼ˆå¸¦ IndexCoordinatesï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•2ï¼ˆä¸å¸¦ IndexCoordinatesï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç´¢å¼•æ¥æº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ˜¾å¼æŒ‡å®šç´¢å¼•æˆ–åˆ«å&lt;/td&gt;
&lt;td&gt;éšå¼ä»å®ä½“ç±»æ³¨è§£è·å–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤šç´¢å¼•æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;âœ… æ”¯æŒè·¨ç´¢å¼•æˆ–é€šé…ç¬¦æ“ä½œï¼ˆå¦‚ &lt;code&gt;logs-*&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;âŒ ä»…é™å•ä¸€ç´¢å¼•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŠ¨æ€ç´¢å¼•åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆæ—¥å¿—åˆ†ç‰‡ã€æ—¶é—´åºåˆ—ç´¢å¼•ç­‰åŠ¨æ€ç»“æ„&lt;/td&gt;
&lt;td&gt;é€‚åˆå›ºå®šç»“æ„çš„ä¸šåŠ¡æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è®¢å•ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ä¾µå…¥æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨ç®¡ç†ç´¢å¼•å&lt;/td&gt;
&lt;td&gt;ä¾èµ–å®ä½“ç±»é…ç½®ï¼Œä¸ä¸šåŠ¡å¼ºè€¦åˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸é£é™©"&gt;&lt;strong&gt;æ€§èƒ½ä¸é£é™©&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾å¼ç´¢å¼•çš„é£é™©&lt;/strong&gt;&lt;br&gt;
è‹¥è¯¯ç”¨é€šé…ç¬¦ï¼ˆå¦‚ &lt;code&gt;*&lt;/code&gt;ï¼‰ï¼Œå¯èƒ½æ„å¤–åˆ é™¤å¤šä¸ªç´¢å¼•çš„æ•°æ®ã€‚éœ€ç»“åˆ &lt;code&gt;allow_no_indices&lt;/code&gt; ç­‰å‚æ•°æ§åˆ¶å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;éšå¼ç´¢å¼•çš„ä¾¿æ·æ€§&lt;/strong&gt;&lt;br&gt;
ç®€åŒ–ä»£ç ï¼Œä½†ç¼ºä¹çµæ´»æ€§ã€‚ä¾‹å¦‚æ— æ³•ç›´æ¥æ“ä½œåˆ«åæˆ–ä¸´æ—¶ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-4"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©æ–¹æ³•2&lt;/strong&gt;ï¼šå½“æ“ä½œç›®æ ‡ç´¢å¼•ä¸å®ä½“ç±»ç»‘å®šä¸”æ— éœ€åŠ¨æ€åˆ‡æ¢æ—¶ï¼Œä»£ç æ›´ç®€æ´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©æ–¹æ³•1&lt;/strong&gt;ï¼šåœ¨éœ€è¦åŠ¨æ€ç´¢å¼•ï¼ˆå¦‚å¤šç§Ÿæˆ·ã€åˆ†ç‰‡åœºæ™¯ï¼‰æˆ–è·¨ç´¢å¼•æ“ä½œæ—¶ï¼Œæä¾›æ›´é«˜çš„çµæ´»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…·ä½“é€‰æ‹©éœ€ç»“åˆä¸šåŠ¡éœ€æ±‚ï¼Œè‹¥æ¶‰åŠå¤æ‚ç´¢å¼•ç­–ç•¥ï¼ˆå¦‚åŸºäºæ—¶é—´çš„æ»šåŠ¨åˆ é™¤ï¼‰ï¼Œæ˜¾å¼æŒ‡å®š &lt;code&gt;IndexCoordinates&lt;/code&gt; æ˜¯æ›´ä¼˜æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="string"&gt;String&amp;hellip;
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œ&lt;code&gt;String...&lt;/code&gt; è¡¨ç¤º&lt;strong&gt;å¯å˜å‚æ•°ï¼ˆVarargsï¼‰&lt;/strong&gt;ï¼Œæ˜¯ä¸€ç§å…è®¸æ–¹æ³•æ¥å—é›¶ä¸ªæˆ–å¤šä¸ª &lt;code&gt;String&lt;/code&gt; ç±»å‹å‚æ•°çš„è¯­æ³•ç‰¹æ€§ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œåº•å±‚ä¼šå°†å…¶è½¬æ¢ä¸º &lt;code&gt;String[]&lt;/code&gt; æ•°ç»„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹æ€§ä¸è¯­æ³•"&gt;æ ¸å¿ƒç‰¹æ€§ä¸è¯­æ³•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯­æ³•å½¢å¼&lt;/strong&gt;&lt;br&gt;
åœ¨æ–¹æ³•å‚æ•°å£°æ˜ä¸­ï¼Œç”¨ &lt;code&gt;ç±»å‹... å‚æ•°å&lt;/code&gt; çš„æ ¼å¼è¡¨ç¤ºå¯å˜å‚æ•°ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;printStrings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;strings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;strings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ &lt;code&gt;strings&lt;/code&gt; æ˜¯ä¸€ä¸ª &lt;code&gt;String[]&lt;/code&gt; æ•°ç»„ï¼Œå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„ &lt;code&gt;String&lt;/code&gt; å‚æ•°ï¼ŒåŒ…æ‹¬é›¶ä¸ªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;br&gt;
ç¼–è¯‘å™¨ä¼šå°† &lt;code&gt;String...&lt;/code&gt; è‡ªåŠ¨è½¬æ¢ä¸º &lt;code&gt;String[]&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ &lt;code&gt;printStrings(&amp;quot;a&amp;quot;, &amp;quot;b&amp;quot;)&lt;/code&gt; æ—¶ï¼Œå®é™…ä¼šç”Ÿæˆä¸€ä¸ªæ•°ç»„ &lt;code&gt;new String[] {&amp;quot;a&amp;quot;, &amp;quot;b&amp;quot;}&lt;/code&gt; ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨åœºæ™¯ä¸é™åˆ¶"&gt;ä½¿ç”¨åœºæ™¯ä¸é™åˆ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°æ•°é‡ä¸ç¡®å®š&lt;/strong&gt;ï¼šå¦‚æ—¥å¿—æ–¹æ³•éœ€è¦æ‹¼æ¥å¤šä¸ªå­—ç¬¦ä¸²ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–é‡è½½&lt;/strong&gt;ï¼šé¿å…ä¸ºä¸åŒå‚æ•°æ•°é‡çš„æ–¹æ³•ç¼–å†™å¤šä¸ªé‡è½½ç‰ˆæœ¬ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€å¤„ç†è¾“å…¥&lt;/strong&gt;ï¼šä¾‹å¦‚æ‰¹é‡å¤„ç†æ–‡ä»¶åæˆ– SQL å‚æ•°åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨é™åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°ä½ç½®&lt;/strong&gt;ï¼šå¯å˜å‚æ•°å¿…é¡»æ˜¯æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ­£ç¡®ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;prefix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// é”™è¯¯ç¤ºä¾‹ï¼ˆå¯å˜å‚æ•°ä¸åœ¨æœ€åï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;errorExample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;suffix&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å”¯ä¸€æ€§&lt;/strong&gt;ï¼šä¸€ä¸ªæ–¹æ³•åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹ç¤ºä¾‹"&gt;å…¸å‹ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="åŸºç¡€è°ƒç”¨"&gt;åŸºç¡€è°ƒç”¨
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å¯ä¼ å…¥ä»»æ„æ•°é‡å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;printStrings&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é›¶å‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;printStrings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸€ä¸ªå‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;printStrings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;A&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;B&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;C&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤šä¸ªå‚æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ç»“åˆå…¶ä»–å‚æ•°"&gt;ç»“åˆå…¶ä»–å‚æ•°
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Name: %s, Age: %s&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;30&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ä¸æ•°ç»„çš„äº’æ“ä½œæ€§"&gt;ä¸æ•°ç»„çš„äº’æ“ä½œæ€§
&lt;/h4&gt;&lt;p&gt;å¯å˜å‚æ•°å¯ä»¥ä¸æ•°ç»„äº’ç›¸è½¬æ¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;b&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;printStrings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´æ¥ä¼ å…¥æ•°ç»„&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;printStrings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;x&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;y&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒ¿åæ•°ç»„&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-2"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;br&gt;
é¢‘ç¹è°ƒç”¨å¯å˜å‚æ•°æ–¹æ³•å¯èƒ½äº§ç”Ÿä¸´æ—¶æ•°ç»„ï¼Œéœ€æ³¨æ„åœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯ä¸‹çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸é‡è½½æ–¹æ³•çš„å†²çª&lt;/strong&gt;&lt;br&gt;
å¦‚æœåŒæ—¶å­˜åœ¨ &lt;code&gt;method(String...)&lt;/code&gt; å’Œ &lt;code&gt;method(String[])&lt;/code&gt;ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸¤è€…åº•å±‚å®ç°ç›¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç©ºå€¼å¤„ç†&lt;/strong&gt;&lt;br&gt;
å¯å˜å‚æ•°å…è®¸ä¼ å…¥ &lt;code&gt;null&lt;/code&gt;ï¼Œéœ€åœ¨æ–¹æ³•å†…éƒ¨åšç©ºæŒ‡é’ˆæ£€æŸ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleInput&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inputs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;inputs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;å‚æ•°ä¸èƒ½ä¸ºnull&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸šåŠ¡é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–è¯­è¨€å¯¹æ¯”"&gt;ä¸å…¶ä»–è¯­è¨€å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;Java çš„ &lt;code&gt;String...&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;Python çš„ &lt;code&gt;*args&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°ç»„ï¼ˆ&lt;code&gt;String[]&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;å…ƒç»„ï¼ˆ&lt;code&gt;tuple&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç±»å‹é™åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»ä¸ºåŒä¸€ç±»å‹ï¼ˆå¦‚ &lt;code&gt;String&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;å¯æ··åˆç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å‚æ•°ä½ç½®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿…é¡»ä¸ºæœ€åä¸€ä¸ªå‚æ•°&lt;/td&gt;
&lt;td&gt;å¯ä¸å…¶ä»–å‚æ•°çµæ´»ç»„åˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡å¯å˜å‚æ•°ï¼ŒJava æä¾›äº†æ›´çµæ´»çš„æ–¹æ³•è®¾è®¡æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦åŠ¨æ€å¤„ç†è¾“å…¥çš„åœºæ™¯ã€‚å®é™…å¼€å‘ä¸­éœ€ç»“åˆå…·ä½“éœ€æ±‚æƒè¡¡å…¶ä¾¿åˆ©æ€§ä¸æ½œåœ¨æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;h2 id="cascadetype"&gt;CascadeType
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯å¯¹ JPA ä¸­ &lt;code&gt;CascadeType&lt;/code&gt; çš„è¯¦ç»†ä»‹ç»ï¼Œç»“åˆå…¶æ ¸å¿ƒä½œç”¨ä¸ä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="cascadetype-çš„ä½œç”¨"&gt;CascadeType çš„ä½œç”¨
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;CascadeType&lt;/code&gt; æ˜¯ JPA ä¸­ç”¨äºå®šä¹‰å®ä½“å…³è”æ“ä½œçš„çº§è”è¡Œä¸ºçš„æšä¸¾ç±»å‹ã€‚å®ƒå…è®¸åœ¨æ“ä½œä¸€ä¸ªå®ä½“æ—¶ï¼Œè‡ªåŠ¨å¯¹å…¶å…³è”çš„å®ä½“æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç®€åŒ–äº†æ•°æ®åŒæ­¥é€»è¾‘ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="cascadetype-çš„æˆå‘˜ä¸åŠŸèƒ½"&gt;CascadeType çš„æˆå‘˜ä¸åŠŸèƒ½
&lt;/h3&gt;&lt;h4 id="persist"&gt;&lt;strong&gt;PERSIST&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šçº§è”ä¿å­˜æ“ä½œã€‚å½“çˆ¶å®ä½“é€šè¿‡ &lt;code&gt;persist()&lt;/code&gt; æ–¹æ³•ä¿å­˜æ—¶ï¼Œå…³è”çš„å­å®ä½“ï¼ˆæœªæŒä¹…åŒ–çš„ï¼‰ä¹Ÿä¼šè¢«è‡ªåŠ¨ä¿å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@OneToMany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cascade&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CascadeType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;PERSIST&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Item&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;ä¿å­˜ &lt;code&gt;Order&lt;/code&gt; å¯¹è±¡æ—¶ï¼Œå…¶å…³è”çš„ &lt;code&gt;Item&lt;/code&gt; åˆ—è¡¨ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="remove"&gt;&lt;strong&gt;REMOVE&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šçº§è”åˆ é™¤æ“ä½œã€‚åˆ é™¤çˆ¶å®ä½“æ—¶ï¼Œæ‰€æœ‰å…³è”çš„å­å®ä½“ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šåˆ é™¤è®¢å•æ—¶è¿å¸¦åˆ é™¤æ‰€æœ‰è®¢å•é¡¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€é…åˆæ•°æ®åº“å¤–é”®çš„ &lt;code&gt;ON DELETE CASCADE&lt;/code&gt; çº¦æŸä»¥å®ç°é€’å½’åˆ é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="merge"&gt;&lt;strong&gt;MERGE&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šçº§è”åˆå¹¶æ›´æ–°ã€‚å½“çˆ¶å®ä½“çŠ¶æ€åˆå¹¶åˆ°æ•°æ®åº“æ—¶ï¼ˆé€šè¿‡ &lt;code&gt;merge()&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œå…³è”çš„å­å®ä½“ä¼šåŒæ­¥æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹ç”¨é€”&lt;/strong&gt;ï¼šä¿®æ”¹çˆ¶å­å…³ç³»æ—¶ä¿æŒæ•°æ®ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="refresh"&gt;&lt;strong&gt;REFRESH&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šçº§è”åˆ·æ–°ã€‚åˆ·æ–°çˆ¶å®ä½“ï¼ˆé€šè¿‡ &lt;code&gt;refresh()&lt;/code&gt; æ–¹æ³•ï¼‰æ—¶ï¼Œå…³è”çš„å­å®ä½“ä¼šé‡æ–°ä»æ•°æ®åº“åŠ è½½æœ€æ–°çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šè§£å†³å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="detach"&gt;&lt;strong&gt;DETACH&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šçº§è”è„±ç®¡ã€‚å°†çˆ¶å®ä½“ä»æŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­åˆ†ç¦»æ—¶ï¼Œå…³è”çš„å­å®ä½“ä¹Ÿä¼šè¢«åˆ†ç¦»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé¿å…æ¸¸ç¦»å¯¹è±¡å¯¼è‡´çš„å¤–é”®çº¦æŸå†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="all"&gt;&lt;strong&gt;ALL&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼šåŒ…å«ä»¥ä¸Šæ‰€æœ‰çº§è”æ“ä½œï¼ˆPERSISTã€REMOVEã€MERGEã€REFRESHã€DETACHï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£é™©æç¤º&lt;/strong&gt;ï¼šè¿‡åº¦ä½¿ç”¨å¯èƒ½å¯¼è‡´æ„å¤–æ•°æ®åˆ é™¤æˆ–æ€§èƒ½é—®é¢˜ï¼Œéœ€è°¨æ…é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•hibernate-ç‰¹æœ‰çº§è”ç±»å‹"&gt;æ‰©å±•ï¼šHibernate ç‰¹æœ‰çº§è”ç±»å‹
&lt;/h3&gt;&lt;p&gt;é™¤æ ‡å‡† JPA çš„ &lt;code&gt;CascadeType&lt;/code&gt; å¤–ï¼ŒHibernate è¿˜æä¾›äº†æ‰©å±•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SAVE_UPDATE&lt;/strong&gt;ï¼šçº§è”ä¿å­˜ä¸æ›´æ–°ï¼ˆåŒ…æ‹¬ &lt;code&gt;save()&lt;/code&gt;ã€&lt;code&gt;update()&lt;/code&gt; å’Œ &lt;code&gt;saveOrUpdate()&lt;/code&gt; æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LOCK&lt;/strong&gt;ï¼šçº§è”é”å®šæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;REPLICATE&lt;/strong&gt;ï¼šçº§è”å¤åˆ¶æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨å»ºè®®"&gt;ä½¿ç”¨å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŒ‰éœ€é€‰æ‹©çº§è”ç±»å‹&lt;/strong&gt;ï¼šé¿å…æ»¥ç”¨ &lt;code&gt;CascadeType.ALL&lt;/code&gt;ï¼Œä¼˜å…ˆæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ç‰¹å®šæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆæ•°æ®åº“çº¦æŸ&lt;/strong&gt;ï¼šä¾‹å¦‚å¤–é”®çš„ &lt;code&gt;ON DELETE CASCADE&lt;/code&gt; å¯å¢å¼ºçº§è”åˆ é™¤çš„å¯é æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹åŠ¡è¾¹ç•Œ&lt;/strong&gt;ï¼šçº§è”æ“ä½œéœ€åœ¨äº‹åŠ¡å†…æ‰§è¡Œï¼Œé¿å…éƒ¨åˆ†å¤±è´¥å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è€ƒé‡&lt;/strong&gt;ï¼šçº§è”æ“ä½œå¯èƒ½å¼•å‘æ‰¹é‡ SQL è¯­å¥ï¼Œéœ€è¯„ä¼°å¯¹æ€§èƒ½çš„å½±å“ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é”™è¯¯ä¸è§£å†³"&gt;å¸¸è§é”™è¯¯ä¸è§£å†³
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;detached entity passed to persist&lt;/strong&gt;ï¼šé€šå¸¸å› çº§è”é…ç½®ä¸å½“å¯¼è‡´ï¼Œéœ€æ£€æŸ¥å…³è”å®ä½“çš„ &lt;code&gt;CascadeType.PERSIST&lt;/code&gt; æ˜¯å¦é—æ¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–é”®çº¦æŸå†²çª&lt;/strong&gt;ï¼šç¡®ä¿æ•°æ®åº“å¤–é”®çº¦æŸä¸ JPA çº§è”é…ç½®ä¸€è‡´ï¼ˆå¦‚åŒæ—¶å¯ç”¨ &lt;code&gt;ON DELETE CASCADE&lt;/code&gt; å’Œ &lt;code&gt;CascadeType.REMOVE&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½® &lt;code&gt;CascadeType&lt;/code&gt;ï¼Œå¯ä»¥æ˜¾è‘—ç®€åŒ–å®ä½“å…³è”æ“ä½œï¼Œä½†éœ€ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯å’Œæ•°æ®åº“è®¾è®¡ç»¼åˆæƒè¡¡ã€‚æ›´å¤šç»†èŠ‚å¯å‚è€ƒ JPA å®˜æ–¹æ–‡æ¡£æˆ– Hibernate æ‰©å±•åŠŸèƒ½è¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id="manytoone-å’Œ-onetomany-çš„-cascadetype"&gt;&lt;code&gt;@ManyToOne&lt;/code&gt; å’Œ &lt;code&gt;OneToMany&lt;/code&gt; çš„ &lt;code&gt;CascadeType&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ JPA å®ä½“å…³è”ä¸­ï¼Œ&lt;code&gt;@ManyToOne&lt;/code&gt; å’Œ &lt;code&gt;OneToMany&lt;/code&gt; çš„ &lt;code&gt;CascadeType&lt;/code&gt; çº§è”æ“ä½œå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œä¸»è¦ä½“ç°åœ¨ &lt;strong&gt;çº§è”æ–¹å‘&lt;/strong&gt;ã€&lt;strong&gt;ä¸šåŠ¡é€»è¾‘åˆç†æ€§&lt;/strong&gt; å’Œ &lt;strong&gt;æ•°æ®åº“æ“ä½œèŒƒå›´&lt;/strong&gt; ä¸Šã€‚ä»¥ä¸‹æ˜¯å…·ä½“å¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="çº§è”æ–¹å‘ä¸ä½œç”¨ä¸»ä½“"&gt;çº§è”æ–¹å‘ä¸ä½œç”¨ä¸»ä½“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ³¨è§£&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº§è”æ–¹å‘&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@OneToMany&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä¸€å¯¹å¤š â†’ çº§è”æ“ä½œç”±â€œä¸€â€ç«¯è§¦å‘&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;çˆ¶å®ä½“ï¼ˆå¦‚ &lt;code&gt;School&lt;/code&gt;ï¼‰çš„å¢åˆ æ”¹æ“ä½œå¯è‡ªåŠ¨ä¼ æ’­åˆ°å­å®ä½“ï¼ˆå¦‚ &lt;code&gt;Student&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@ManyToOne&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å¤šå¯¹ä¸€ â†’ çº§è”æ“ä½œç”±â€œå¤šâ€ç«¯è§¦å‘&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å­å®ä½“ï¼ˆå¦‚ &lt;code&gt;Student&lt;/code&gt;ï¼‰çš„å¢åˆ æ”¹æ“ä½œå¯è‡ªåŠ¨ä¼ æ’­åˆ°çˆ¶å®ä½“ï¼ˆå¦‚ &lt;code&gt;School&lt;/code&gt;ï¼‰ï¼Œä½†éœ€è°¨æ…ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="ç¤ºä¾‹"&gt;ç¤ºä¾‹ï¼š
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@OneToMany&lt;/code&gt; çº§è”åˆ é™¤&lt;/strong&gt;ï¼šåˆ é™¤å­¦æ ¡æ—¶è‡ªåŠ¨åˆ é™¤æ‰€æœ‰å…³è”çš„å­¦ç”Ÿï¼ˆåˆç†ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@ManyToOne&lt;/code&gt; çº§è”åˆ é™¤&lt;/strong&gt;ï¼šåˆ é™¤å­¦ç”Ÿæ—¶è‡ªåŠ¨åˆ é™¤æ‰€å±å­¦æ ¡ï¼ˆä¸åˆç†ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="çº§è”ç±»å‹ä¸ä¸šåŠ¡é€»è¾‘é€‚é…"&gt;çº§è”ç±»å‹ä¸ä¸šåŠ¡é€»è¾‘é€‚é…
&lt;/h3&gt;&lt;h4 id="onetomany-å¸¸ç”¨çº§è”é…ç½®"&gt;&lt;code&gt;@OneToMany&lt;/code&gt; å¸¸ç”¨çº§è”é…ç½®
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CascadeType.PERSIST&lt;/code&gt;&lt;/strong&gt;ï¼šä¿å­˜çˆ¶å®ä½“æ—¶è‡ªåŠ¨ä¿å­˜æ‰€æœ‰å­å®ä½“ï¼ˆå¦‚ä¿å­˜å­¦æ ¡æ—¶è‡ªåŠ¨ä¿å­˜å­¦ç”Ÿï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CascadeType.REMOVE&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ é™¤çˆ¶å®ä½“æ—¶è‡ªåŠ¨åˆ é™¤æ‰€æœ‰å­å®ä½“ï¼ˆéœ€é…åˆ &lt;code&gt;orphanRemoval=true&lt;/code&gt; æ¸…ç†æ¸¸ç¦»å¯¹è±¡ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CascadeType.ALL&lt;/code&gt;&lt;/strong&gt;ï¼šè¦†ç›–æ‰€æœ‰æ“ä½œï¼ˆéœ€è°¨æ…ï¼Œå¯èƒ½è¯¯åˆ æ•°æ®ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="manytoone-è°¨æ…ä½¿ç”¨çš„çº§è”ç±»å‹"&gt;&lt;code&gt;@ManyToOne&lt;/code&gt; è°¨æ…ä½¿ç”¨çš„çº§è”ç±»å‹
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CascadeType.MERGE&lt;/code&gt;&lt;/strong&gt;ï¼šå­å®ä½“æ›´æ–°æ—¶åŒæ­¥çˆ¶å®ä½“ï¼ˆå¦‚æ›´æ–°å­¦ç”Ÿä¿¡æ¯æ—¶åŒæ­¥å­¦æ ¡ä¿¡æ¯ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CascadeType.PERSIST&lt;/code&gt;&lt;/strong&gt;ï¼šä¿å­˜å­å®ä½“æ—¶è‡ªåŠ¨åˆ›å»ºçˆ¶å®ä½“ï¼ˆéœ€çˆ¶å®ä½“ä¸å­˜åœ¨æ—¶ä½¿ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å… &lt;code&gt;CascadeType.REMOVE&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ é™¤å­å®ä½“ä¸åº”çº§è”åˆ é™¤çˆ¶å®ä½“ï¼ˆè¿åä¸šåŠ¡é€»è¾‘ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®åº“æ“ä½œå·®å¼‚"&gt;æ•°æ®åº“æ“ä½œå·®å¼‚
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ“ä½œç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@OneToMany&lt;/code&gt; æ•ˆæœ&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@ManyToOne&lt;/code&gt; æ•ˆæœ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä¿å­˜ï¼ˆPERSISTï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿæˆ &lt;code&gt;INSERT&lt;/code&gt; è¯­å¥æ’å…¥çˆ¶è¡¨å’Œæ‰€æœ‰å­è¡¨è®°å½•&lt;/td&gt;
&lt;td&gt;è‹¥çˆ¶å®ä½“æœªæŒä¹…åŒ–ï¼Œç”Ÿæˆ &lt;code&gt;INSERT&lt;/code&gt; è¯­å¥æ’å…¥çˆ¶è¡¨ï¼ˆéœ€é…ç½® &lt;code&gt;CascadeType.PERSIST&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ é™¤ï¼ˆREMOVEï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿæˆ &lt;code&gt;DELETE&lt;/code&gt; è¯­å¥æŒ‰å¤–é”®é€æ¡åˆ é™¤å­è¡¨è®°å½•ï¼ˆæˆ–é€šè¿‡æ•°æ®åº“å¤–é”® &lt;code&gt;ON DELETE CASCADE&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;è‹¥é…ç½®é”™è¯¯ï¼Œå¯èƒ½åˆ é™¤çˆ¶è¡¨è®°å½•ï¼ˆç ´åæ•°æ®å®Œæ•´æ€§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ›´æ–°ï¼ˆMERGEï¼‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ›´æ–°çˆ¶è¡¨åï¼Œé€šè¿‡å¤–é”®æ›´æ–°å­è¡¨å…³è”å­—æ®µ&lt;/td&gt;
&lt;td&gt;æ›´æ–°å­è¡¨æ—¶åŒæ­¥æ›´æ–°çˆ¶è¡¨å­—æ®µï¼ˆéœ€æ˜ç¡®ä¸šåŠ¡éœ€æ±‚ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µ"&gt;æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@OneToMany&lt;/code&gt; ä¸»å¯¼çº§è”&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº§è”æ“ä½œåº”ä¼˜å…ˆåœ¨â€œä¸€å¯¹å¤šâ€ç«¯é…ç½®ï¼ˆå¦‚ &lt;code&gt;School&lt;/code&gt; â†’ &lt;code&gt;Student&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æ¨èç»„åˆï¼š&lt;code&gt;cascade = {CascadeType.PERSIST, CascadeType.MERGE}&lt;/code&gt; + &lt;code&gt;orphanRemoval=true&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@ManyToOne&lt;/code&gt; é™åˆ¶çº§è”èŒƒå›´&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…çº§è”åˆ é™¤ï¼ˆ&lt;code&gt;CascadeType.REMOVE&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ä»…é…ç½®å¿…è¦çš„çº§è”ç±»å‹ï¼ˆå¦‚ &lt;code&gt;CascadeType.MERGE&lt;/code&gt; ç”¨äºåŒæ­¥å­—æ®µæ›´æ–°ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åº“çº§è”è¡¥å……&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ•°æ®åº“å¤–é”®çº¦æŸä¸­æ·»åŠ  &lt;code&gt;ON DELETE CASCADE&lt;/code&gt;ï¼Œå®ç°åŒä¿é™©çº§è”åˆ é™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹é”™è¯¯åœºæ™¯"&gt;å…¸å‹é”™è¯¯åœºæ™¯
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åå‘çº§è”åˆ é™¤&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;@ManyToOne&lt;/code&gt; ä¸­è¯¯ç”¨ &lt;code&gt;CascadeType.REMOVE&lt;/code&gt;ï¼Œå¯¼è‡´åˆ é™¤å­å®ä½“æ—¶çˆ¶å®ä½“è¿å¸¦åˆ é™¤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¸¸ç¦»å¯¹è±¡æœªæ¸…ç†&lt;/strong&gt;ï¼š&lt;code&gt;@OneToMany&lt;/code&gt; æœªé…ç½® &lt;code&gt;orphanRemoval=true&lt;/code&gt;ï¼Œå¯¼è‡´å­å®ä½“è„±ç¦»å…³è”åæ®‹ç•™æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡åº¦çº§è”&lt;/strong&gt;ï¼šæ»¥ç”¨ &lt;code&gt;CascadeType.ALL&lt;/code&gt; å¼•å‘æ€§èƒ½é—®é¢˜æˆ–æ•°æ®è¯¯åˆ &lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†åŒºåˆ† &lt;code&gt;@ManyToOne&lt;/code&gt; å’Œ &lt;code&gt;@OneToMany&lt;/code&gt; çš„çº§è”é…ç½®ï¼Œå¯å®ç°é«˜æ•ˆä¸”å®‰å…¨çš„å®ä½“å…³è”æ“ä½œã€‚å…³é”®åŸåˆ™æ˜¯ï¼š&lt;strong&gt;çº§è”æ“ä½œåº”åæ˜ ä¸šåŠ¡é€»è¾‘çš„è‡ªç„¶æµå‘&lt;/strong&gt;ï¼Œé¿å…åå‘ä¼ æ’­å¯¼è‡´æ•°æ®å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id="jpa-çº§è”åˆ é™¤"&gt;JPA çº§è”åˆ é™¤
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;parent_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreignKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;FK_CHILD_PARENT&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreignKeyDefinition&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="cron-è¡¨è¾¾å¼"&gt;Cron è¡¨è¾¾å¼
&lt;/h2&gt;&lt;p&gt;Cron è¡¨è¾¾å¼æ˜¯ä¸€ç§ç”¨äºå®šä¹‰å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´çš„å­—ç¬¦ä¸²è§„åˆ™ï¼Œå¹¿æ³›åº”ç”¨äºä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ˆå¦‚ Linux çš„ crontabã€Quartz ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºæœ¬ç»“æ„"&gt;åŸºæœ¬ç»“æ„
&lt;/h3&gt;&lt;p&gt;Cron è¡¨è¾¾å¼ç”± &lt;strong&gt;6 æˆ– 7 ä¸ªå­—æ®µ&lt;/strong&gt;ç»„æˆï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼Œæ ¼å¼ä¸ºï¼š&lt;br&gt;
&lt;code&gt;ç§’ åˆ† å°æ—¶ æ—¥æœŸ æœˆä»½ æ˜ŸæœŸ [å¹´ä»½ï¼ˆå¯é€‰ï¼‰]&lt;/code&gt;&lt;br&gt;
ä¾‹å¦‚ï¼š&lt;code&gt;0 0 12 * * ?&lt;/code&gt; è¡¨ç¤ºæ¯å¤©ä¸­åˆ 12 ç‚¹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;å…è®¸å€¼&lt;/th&gt;
&lt;th&gt;ç‰¹æ®Šå­—ç¬¦&lt;/th&gt;
&lt;th&gt;å¤‡æ³¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç§’&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0-59&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - /&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ•´ç§’è§¦å‘ï¼Œå¦‚ &lt;code&gt;30&lt;/code&gt; è¡¨ç¤ºæ¯åˆ†é’Ÿçš„ç¬¬ 30 ç§’è§¦å‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ†&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0-59&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - /&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ•´åˆ†è§¦å‘ï¼Œå¦‚ &lt;code&gt;15&lt;/code&gt; è¡¨ç¤ºæ¯å°æ—¶çš„ 15 åˆ†è§¦å‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å°æ—¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0-23&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - /&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦‚ &lt;code&gt;9-17&lt;/code&gt; è¡¨ç¤ºä¸Šåˆ 9 ç‚¹åˆ°ä¸‹åˆ 5 ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ—¥æœŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1-31&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - / ? L W&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;éœ€è€ƒè™‘æœˆä»½å¤©æ•°ï¼Œå¦‚ &lt;code&gt;5W&lt;/code&gt; è¡¨ç¤ºæœ€è¿‘çš„å·¥ä½œæ—¥è§¦å‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æœˆä»½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1-12 æˆ– JAN-DEC&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - /&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JAN&lt;/code&gt; è¡¨ç¤º 1 æœˆï¼Œ&lt;code&gt;DEC&lt;/code&gt; è¡¨ç¤º 12 æœˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ˜ŸæœŸ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0-7 æˆ– SUN-SAT&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - / ? L #&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä¸åŒç³»ç»Ÿå¯èƒ½å·®å¼‚ï¼š&lt;code&gt;1&lt;/code&gt; ä»£è¡¨å‘¨æ—¥æˆ–å‘¨ä¸€ï¼ˆå¦‚ Quartz ä¸­ &lt;code&gt;1=MON&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¹´ä»½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1970-2099ï¼ˆå¯é€‰ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;* , - /&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;éƒ¨åˆ†ç³»ç»Ÿä¸æ”¯æŒï¼Œå¦‚ Linux crontab&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç‰¹æ®Šå­—ç¬¦è§£æ"&gt;ç‰¹æ®Šå­—ç¬¦è§£æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;*&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
åŒ¹é…ä»»æ„å€¼ã€‚ä¾‹å¦‚ &lt;code&gt;*&lt;/code&gt; åœ¨å°æ—¶å­—æ®µè¡¨ç¤ºæ¯å°æ—¶è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;?&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ä»…ç”¨äº &lt;strong&gt;æ—¥æœŸ&lt;/strong&gt; å’Œ &lt;strong&gt;æ˜ŸæœŸ&lt;/strong&gt; å­—æ®µï¼Œè¡¨ç¤ºâ€œä¸æŒ‡å®šå€¼â€ã€‚ä¾‹å¦‚åœ¨æ—¥æœŸå­—æ®µç”¨ &lt;code&gt;15&lt;/code&gt; æŒ‡å®šæ¯æœˆ 15 æ—¥æ—¶ï¼Œæ˜ŸæœŸå­—æ®µéœ€ç”¨ &lt;code&gt;?&lt;/code&gt; é¿å…å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;-&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å®šä¹‰èŒƒå›´ã€‚ä¾‹å¦‚ &lt;code&gt;10-12&lt;/code&gt; åœ¨å°æ—¶å­—æ®µè¡¨ç¤º 10ã€11ã€12 ç‚¹è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;/&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å®šä¹‰é—´éš”è§¦å‘ã€‚ä¾‹å¦‚ &lt;code&gt;0/5&lt;/code&gt; åœ¨ç§’å­—æ®µè¡¨ç¤ºä» 0 ç§’å¼€å§‹ï¼Œæ¯ 5 ç§’è§¦å‘ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;,&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æšä¸¾å¤šä¸ªå€¼ã€‚ä¾‹å¦‚ &lt;code&gt;2,4,6&lt;/code&gt; åœ¨æ˜ŸæœŸå­—æ®µè¡¨ç¤ºå‘¨å‘¨å‘¨å…­è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;L&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
è¡¨ç¤ºâ€œæœ€åâ€ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨æ—¥æœŸå­—æ®µï¼š&lt;code&gt;L&lt;/code&gt; è¡¨ç¤ºæœˆæœ«æœ€åä¸€å¤©ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ˜ŸæœŸå­—æ®µï¼š&lt;code&gt;5L&lt;/code&gt; è¡¨ç¤ºæœ€åä¸€ä¸ªæ˜ŸæœŸå››ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;W&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ä»…ç”¨äºæ—¥æœŸå­—æ®µï¼Œè¡¨ç¤ºæœ€è¿‘çš„å·¥ä½œæ—¥ã€‚ä¾‹å¦‚ &lt;code&gt;15W&lt;/code&gt; è¡¨ç¤ºç¦» 15 æ—¥æœ€è¿‘çš„å·¥ä½œæ—¥è§¦å‘ï¼ˆè‹¥ 15 æ—¥ä¸ºå‘¨å…­åˆ™ 14 æ—¥è§¦å‘ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æŒ‡å®šç¬¬å‡ ä¸ªå‘¨å‡ ã€‚ä¾‹å¦‚ &lt;code&gt;4#2&lt;/code&gt; è¡¨ç¤ºæ¯æœˆçš„ç¬¬äºŒä¸ªæ˜ŸæœŸä¸‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§ç¤ºä¾‹"&gt;å¸¸è§ç¤ºä¾‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å›ºå®šæ—¶é—´è§¦å‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0 0 12 * * ?&lt;/code&gt;ï¼šæ¯å¤©ä¸­åˆ 12 ç‚¹è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 15 10 ? * MON-FRI&lt;/code&gt;ï¼šå·¥ä½œæ—¥æ¯å¤©ä¸Šåˆ 10:15 è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘¨æœŸæ€§è§¦å‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0 */5 * * * ?&lt;/code&gt;ï¼šæ¯ 5 åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0/30 9-17 * * ?&lt;/code&gt;ï¼šå·¥ä½œæ—¥ 9:00-17:00 æ¯åŠå°æ—¶è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚è§„åˆ™&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0 0 12 L * ?&lt;/code&gt;ï¼šæ¯æœˆæœ€åä¸€å¤©ä¸­åˆ 12 ç‚¹è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 15 10 ? * 6L 2023-2025&lt;/code&gt;ï¼š2023-2025 å¹´æ¯æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº” 10:15 è§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-3"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µå†²çª&lt;/strong&gt;ï¼šæ—¥æœŸå’Œæ˜ŸæœŸå­—æ®µé€šå¸¸éœ€é…åˆ &lt;code&gt;?&lt;/code&gt; ä½¿ç”¨ä»¥é¿å…é€»è¾‘å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿå·®å¼‚&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Linux crontab&lt;/strong&gt;ï¼šä»…æ”¯æŒ 5 ä¸ªå­—æ®µï¼ˆåˆ† æ—¶ æ—¥ æœˆ å‘¨ï¼‰ï¼Œä¸å«ç§’å’Œå¹´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Quartz&lt;/strong&gt;ï¼šæ”¯æŒ 6-7 ä¸ªå­—æ®µï¼ˆå«ç§’å’Œå¹´ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹æ®Šå­—ç¬¦å…¼å®¹æ€§&lt;/strong&gt;ï¼š&lt;code&gt;L&lt;/code&gt;ã€&lt;code&gt;W&lt;/code&gt;ã€&lt;code&gt;#&lt;/code&gt; ç­‰å­—ç¬¦å¯èƒ½ä¸è¢«æ‰€æœ‰ç³»ç»Ÿæ”¯æŒï¼ˆå¦‚éƒ¨åˆ†æ—§ç‰ˆå·¥å…·ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†ç»„åˆå­—æ®µå’Œç‰¹æ®Šå­—ç¬¦ï¼ŒCron è¡¨è¾¾å¼å¯æ»¡è¶³ä»ç®€å•åˆ°å¤æ‚çš„è°ƒåº¦éœ€æ±‚ã€‚å®é™…ä½¿ç”¨æ—¶éœ€ç»“åˆå…·ä½“å·¥å…·æ–‡æ¡£è°ƒæ•´æ ¼å¼ã€‚&lt;/p&gt;
&lt;h2 id="spring-data-jpa-batch"&gt;Spring Data JPA Batch
&lt;/h2&gt;&lt;p&gt;Spring Data JPA çš„æ‰¹é‡æ’å…¥ä¼˜åŒ–éœ€è¦ç»“åˆäº‹åŠ¡ç®¡ç†ã€Hibernate æ‰¹å¤„ç†é…ç½®åŠä»£ç å®ç°æŠ€å·§ï¼Œä»¥ä¸‹ä¸ºç»¼åˆå¤šä¸ªå®è·µæ–¹æ¡ˆçš„æ€»ç»“ï¼š&lt;/p&gt;
&lt;h3 id="åŸºç¡€æ–¹æ³•saveall-çš„å±€é™æ€§"&gt;åŸºç¡€æ–¹æ³•ï¼š&lt;code&gt;saveAll()&lt;/code&gt; çš„å±€é™æ€§
&lt;/h3&gt;&lt;p&gt;Spring Data JPA é»˜è®¤æä¾›çš„ &lt;code&gt;saveAll()&lt;/code&gt; æ–¹æ³•è™½ç„¶ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†å®é™…æ˜¯&lt;strong&gt;é€æ¡æ’å…¥&lt;/strong&gt;è€ŒéçœŸæ­£æ‰¹é‡æ“ä½œã€‚å…¶æºç å®ç°ä¸­ï¼Œæ¯ä¸ªå®ä½“éƒ½ä¼šå•ç‹¬è§¦å‘ &lt;code&gt;persist()&lt;/code&gt; æˆ– &lt;code&gt;merge()&lt;/code&gt;ï¼Œå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡å¼€é”€å¤§&lt;/strong&gt;ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª &lt;code&gt;save()&lt;/code&gt; æ“ä½œå¯èƒ½è§¦å‘ä¸€æ¬¡æ•°æ®åº“äº¤äº’ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å ç”¨é«˜&lt;/strong&gt;ï¼šæœªåŠæ—¶æ¸…ç† Hibernate ä¸€çº§ç¼“å­˜ï¼ˆSession ç¼“å­˜ï¼‰ä¼šå¯¼è‡´å†…å­˜è†¨èƒ€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸»é”®æŸ¥è¯¢æµªè´¹&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼ˆ&lt;code&gt;GenerationType.IDENTITY&lt;/code&gt;ï¼‰ï¼Œæ¯æ¬¡æ’å…¥å‰éœ€æŸ¥è¯¢ IDï¼Œç ´åæ‰¹å¤„ç†èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€‚ç”¨åœºæ™¯ï¼šä»…æ¨èç”¨äº &lt;strong&gt;1,000 æ¡ä»¥ä¸‹çš„å°æ•°æ®é›†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="hibernate-æ‰¹å¤„ç†ä¼˜åŒ–æ–¹æ¡ˆ"&gt;Hibernate æ‰¹å¤„ç†ä¼˜åŒ–æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒé…ç½®"&gt;æ ¸å¿ƒé…ç½®
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;jpa&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;hibernate&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;jdbc.batch_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ‰¹å¤„ç†å¤§å°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;order_inserts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# åˆå¹¶åŒç±»å‹ INSERT è¯­å¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;batch_versioned_data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;datasource&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;jdbc:mysql://...?rewriteBatchedStatements=true &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# MySQL æ‰¹å¤„ç†ä¼˜åŒ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ä»£ç å®ç°"&gt;ä»£ç å®ç°
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchInsert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchSize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;persist&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchSize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨é€ SQL åˆ°æ•°æ®åº“&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¸…ç©ºä¸€çº§ç¼“å­˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†å‰©ä½™æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;flush()&lt;/code&gt; å°†ç¼“å­˜ SQL æ‰¹é‡å‘é€ï¼Œ&lt;code&gt;clear()&lt;/code&gt; é‡Šæ”¾å†…å­˜ï¼›&lt;/li&gt;
&lt;li&gt;éœ€ä¸ &lt;code&gt;batch_size&lt;/code&gt; é…ç½®å€¼ä¿æŒä¸€è‡´ï¼›&lt;/li&gt;
&lt;li&gt;å¿…é¡»ç¦ç”¨ &lt;code&gt;GenerationType.IDENTITY&lt;/code&gt; ä¸»é”®ç­–ç•¥ï¼ˆæ”¹ç”¨ &lt;code&gt;SEQUENCE&lt;/code&gt; æˆ– &lt;code&gt;TABLE&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="äº‹åŠ¡åˆ†å—ä¸æ€§èƒ½é£è·ƒ"&gt;äº‹åŠ¡åˆ†å—ä¸æ€§èƒ½é£è·ƒ
&lt;/h3&gt;&lt;h4 id="äº‹åŠ¡åˆ†å—ç­–ç•¥"&gt;äº‹åŠ¡åˆ†å—ç­–ç•¥
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;propagation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Propagation&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;REQUIRES_NEW&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchInsertInTransaction&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¯å¤„ç† 500 æ¡æäº¤ä¸€æ¬¡äº‹åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å…é•¿äº‹åŠ¡é”è¡¨ï¼›&lt;/li&gt;
&lt;li&gt;ç»“åˆæ‰¹å¤„ç†é…ç½®åï¼Œ10 ä¸‡æ¡æ•°æ®æ’å…¥æ—¶é—´å¯ä» 80+ ç§’é™è‡³ 4 ç§’çº§åˆ«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ€§èƒ½å¯¹æ¯”"&gt;æ€§èƒ½å¯¹æ¯”
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ•°æ®é‡&lt;/th&gt;
&lt;th&gt;åŸå§‹æ–¹æ¡ˆ (&lt;code&gt;saveAll()&lt;/code&gt;)&lt;/th&gt;
&lt;th&gt;ä¼˜åŒ–æ–¹æ¡ˆ (æ‰¹å¤„ç†+äº‹åŠ¡åˆ†å—)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1 ä¸‡&lt;/td&gt;
&lt;td&gt;45s&lt;/td&gt;
&lt;td&gt;0.9s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10 ä¸‡&lt;/td&gt;
&lt;td&gt;OOM&lt;/td&gt;
&lt;td&gt;4.7s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="åŸç”Ÿ-sql-æ‰¹å¤„ç†"&gt;åŸç”Ÿ SQL æ‰¹å¤„ç†
&lt;/h3&gt;&lt;p&gt;å¯¹äºè¶…å¤§æ•°æ®é‡ï¼ˆç™¾ä¸‡çº§ï¼‰ï¼Œå»ºè®®ä½¿ç”¨åŸç”Ÿ SQLï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nativeBatchInsert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;INSERT INTO table (col1, col2) VALUES (?, ?)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createNativeQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getValue1&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getValue2&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executeUpdate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»•è¿‡ Hibernate çš„å®ä½“çŠ¶æ€ç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;é…åˆ &lt;code&gt;rewriteBatchedStatements=true&lt;/code&gt;ï¼ŒMySQL å¯å°†å¤šæ¡ INSERT åˆå¹¶ä¸ºå•è¯­å¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é¿å‘æŒ‡å—"&gt;é¿å‘æŒ‡å—
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸»é”®ç­–ç•¥&lt;/strong&gt;ï¼šç¦æ­¢ä½¿ç”¨ &lt;code&gt;@GeneratedValue(strategy = GenerationType.IDENTITY)&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿æ¥æ± é…ç½®&lt;/strong&gt;ï¼šè®¾ç½® &lt;code&gt;maxLifetime&lt;/code&gt; å°äºæ•°æ®åº“çš„ &lt;code&gt;wait_timeout&lt;/code&gt;ï¼Œé¿å…è¿æ¥æ³„æ¼ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ SQL&lt;/strong&gt;ï¼šä¸´æ—¶å¼€å¯ &lt;code&gt;general_log=ON&lt;/code&gt; éªŒè¯æ‰¹å¤„ç†æ˜¯å¦ç”Ÿæ•ˆï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜æ§åˆ¶&lt;/strong&gt;ï¼šæ¯å¤„ç† 5,000 æ¡åç”¨ DTO æ›¿æ¢ Entity å¯¹è±¡ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—ä¼˜åŒ–&lt;/strong&gt;ï¼šå…³é—­ Hibernate çš„ &lt;code&gt;show_sql&lt;/code&gt;ï¼Œæ”¹ç”¨æ€§èƒ½ç›‘æ§å·¥å…·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å±•æ€è€ƒ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†åº“åˆ†è¡¨åœºæ™¯ä¸‹ï¼Œéœ€ç»“åˆ ShardingSphere ç­‰ä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼æ‰¹å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;å”¯ä¸€ç´¢å¼•å†²çªæ—¶ï¼Œå¯é€šè¿‡ &lt;code&gt;try-catch&lt;/code&gt; æ•è· &lt;code&gt;BatchUpdateException&lt;/code&gt; å¹¶è®°å½•å¤±è´¥æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="createnativequery"&gt;CreateNativeQuery
&lt;/h2&gt;&lt;p&gt;åœ¨ä½¿ç”¨ &lt;code&gt;createNativeQuery&lt;/code&gt; è¿›è¡Œæ‰¹é‡æ’å…¥ä¸”&lt;strong&gt;ä¸æŒ‡å®šä¸»é”® ID&lt;/strong&gt; æ—¶ï¼Œéœ€æ³¨æ„ä»¥ä¸‹å…³é”®ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®åº“è‡ªå¢ä¸»é”®çš„å…¼å®¹æ€§"&gt;æ•°æ®åº“è‡ªå¢ä¸»é”®çš„å…¼å®¹æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸»é”®ç”Ÿæˆæœºåˆ¶&lt;/strong&gt;&lt;br&gt;
å½“è¡¨ä¸­ä¸»é”®å­—æ®µé…ç½®ä¸ºæ•°æ®åº“è‡ªå¢ï¼ˆå¦‚ MySQL çš„ &lt;code&gt;AUTO_INCREMENT&lt;/code&gt; æˆ– PostgreSQL çš„ &lt;code&gt;SERIAL&lt;/code&gt;ï¼‰ï¼Œæ’å…¥æ—¶ä¸æŒ‡å®š ID æ˜¯å¯è¡Œçš„ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç”Ÿæˆä¸»é”®å€¼ã€‚ä½†éœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MySQL&lt;/strong&gt;ï¼šéœ€åœ¨ JDBC URL ä¸­å¯ç”¨ &lt;code&gt;rewriteBatchedStatements=true&lt;/code&gt;ï¼Œæ‰èƒ½å°†å¤šä¸ª &lt;code&gt;INSERT&lt;/code&gt; è¯­å¥åˆå¹¶ä¸ºæ‰¹é‡æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Oracle&lt;/strong&gt;ï¼šéœ€é€šè¿‡ &lt;code&gt;SEQUENCE&lt;/code&gt; å’Œè§¦å‘å™¨å®ç°è‡ªå¢ï¼ˆéåŸç”Ÿæ”¯æŒï¼‰ï¼Œæ­¤æ—¶éœ€æ˜¾å¼è°ƒç”¨åºåˆ—å€¼æˆ–ä¾èµ–æ•°æ®åº“è‡ªåŠ¨å¡«å……ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ JPA ä¸»é”®ç­–ç•¥çš„å†²çª&lt;/strong&gt;&lt;br&gt;
è‹¥å®ä½“ç±»ä¸­å®šä¹‰äº† &lt;code&gt;@GeneratedValue(strategy = GenerationType.IDENTITY)&lt;/code&gt;ï¼ŒHibernate ä¼šå¼ºåˆ¶é€æ¡è·å–ä¸»é”®å€¼ï¼Œå³ä½¿åŸç”Ÿ SQL æœªæŒ‡å®š IDï¼Œä¹Ÿå¯èƒ½å› å®ä½“çŠ¶æ€ç®¡ç†å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚æ­¤æ—¶å»ºè®®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Entity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// éœ€ä¸æ•°æ®åº“è‡ªå¢æœºåˆ¶åŒ¹é…&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŸç”Ÿ-sql-æ‰¹å¤„ç†çš„å®ç°æ–¹å¼"&gt;åŸç”Ÿ SQL æ‰¹å¤„ç†çš„å®ç°æ–¹å¼
&lt;/h3&gt;&lt;h4 id="ä»£ç ç¤ºä¾‹"&gt;ä»£ç ç¤ºä¾‹
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchInsert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;INSERT INTO table (col1, col2) VALUES (?, ?)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸åŒ…å« id å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entities&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createNativeQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCol1&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCol2&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executeUpdate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¡®ä¿æ‰¹é‡æäº¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ€§èƒ½ä¼˜åŒ–è¦ç‚¹"&gt;æ€§èƒ½ä¼˜åŒ–è¦ç‚¹
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹å¤„ç†é…ç½®&lt;/strong&gt;ï¼šåœ¨ &lt;code&gt;application.yml&lt;/code&gt; ä¸­å¯ç”¨ Hibernate æ‰¹å¤„ç†ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring.jpa.properties.hibernate.jdbc.batch_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spring.datasource.url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;jdbc:mysql://...?rewriteBatchedStatements=true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡åˆ†å—&lt;/strong&gt;ï¼šæ¯æ’å…¥ 500-1000 æ¡æäº¤ä¸€æ¬¡äº‹åŠ¡ï¼Œé¿å…é•¿äº‹åŠ¡é”è¡¨ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;propagation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Propagation&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;REQUIRES_NEW&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;insertChunk&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chunk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="è‡ªå¢ä¸»é”®çš„å±€é™æ€§åŠåº”å¯¹"&gt;è‡ªå¢ä¸»é”®çš„å±€é™æ€§åŠåº”å¯¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;&lt;br&gt;
è‡ªå¢ä¸»é”®ï¼ˆå¦‚ &lt;code&gt;IDENTITY&lt;/code&gt;ï¼‰è¦æ±‚æ•°æ®åº“é€æ¡ç”Ÿæˆ IDï¼Œå³ä½¿é€šè¿‡åŸç”Ÿ SQL ç»•è¿‡ Hibernateï¼Œä»å¯èƒ½å¯¼è‡´æ‰¹å¤„ç†æ•ˆç‡ä½äºé¢„æœŸï¼ˆå¦‚ MySQL çš„ &lt;code&gt;AUTO_INCREMENT&lt;/code&gt; é”ç«äº‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢„ç”Ÿæˆä¸»é”®&lt;/strong&gt;ï¼šæ”¹ç”¨ &lt;code&gt;SEQUENCE&lt;/code&gt;ï¼ˆOracle/PostgreSQLï¼‰æˆ–åˆ†å¸ƒå¼ IDï¼ˆå¦‚é›ªèŠ±ç®—æ³•ï¼‰ï¼Œåœ¨ä»£ç ä¸­æ˜¾å¼èµ‹å€¼ä¸»é”®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡åè·å– ID&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;INSERT ... RETURNING id&lt;/code&gt;ï¼ˆPostgreSQLï¼‰æˆ– &lt;code&gt;SELECT LAST_INSERT_ID()&lt;/code&gt;ï¼ˆMySQLï¼‰æ‰¹é‡è·å–ç”Ÿæˆçš„ä¸»é”®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éªŒè¯ä¸ç›‘æ§"&gt;éªŒè¯ä¸ç›‘æ§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SQL æ—¥å¿—åˆ†æ&lt;/strong&gt;&lt;br&gt;
å¼€å¯æ•°æ®åº“çš„ &lt;code&gt;general_log&lt;/code&gt; æŸ¥çœ‹å®é™…æ‰§è¡Œçš„ SQLï¼Œç¡®è®¤æ˜¯å¦åˆå¹¶ä¸ºæ‰¹é‡æ“ä½œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- MySQL ç¤ºä¾‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;global&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;general_log&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;general_log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ•°æ®é‡&lt;/th&gt;
&lt;th&gt;è‡ªå¢ä¸»é”®ï¼ˆé€æ¡ï¼‰&lt;/th&gt;
&lt;th&gt;é¢„ç”Ÿæˆä¸»é”®ï¼ˆæ‰¹å¤„ç†ï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1 ä¸‡&lt;/td&gt;
&lt;td&gt;12 ç§’&lt;/td&gt;
&lt;td&gt;0.8 ç§’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10 ä¸‡&lt;/td&gt;
&lt;td&gt;130 ç§’&lt;/td&gt;
&lt;td&gt;8 ç§’&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šåœ¨åŸç”Ÿ SQL æ‰¹å¤„ç†ä¸­ä¸æŒ‡å®š ID æ˜¯å¯è¡Œçš„ï¼Œä½†éœ€ç»“åˆæ•°æ®åº“ç‰¹æ€§ä¼˜åŒ–é…ç½®ã€‚è‹¥éœ€æ›´é«˜æ€§èƒ½ï¼Œå»ºè®®è„±ç¦» &lt;code&gt;IDENTITY&lt;/code&gt; ç­–ç•¥ï¼Œé‡‡ç”¨é¢„ç”Ÿæˆä¸»é”®æˆ–åˆ†å¸ƒå¼ ID æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="generationtypesequence"&gt;GenerationType.Sequence
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ä½¿ç”¨ &lt;code&gt;@GeneratedValue(strategy = GenerationType.SEQUENCE)&lt;/code&gt; æ—¶ï¼Œéœ€ç»“åˆ &lt;strong&gt;æ•°æ®åº“åºåˆ—é…ç½®&lt;/strong&gt; å’Œ &lt;strong&gt;Hibernate çš„æ³¨è§£å®šä¹‰&lt;/strong&gt; æ‰èƒ½ç”Ÿæ•ˆã€‚ä»¥ä¸‹æ˜¯å…·ä½“é…ç½®æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºç¡€é…ç½®è¦æ±‚"&gt;åŸºç¡€é…ç½®è¦æ±‚
&lt;/h3&gt;&lt;h4 id="æ˜¾å¼å®šä¹‰åºåˆ—ç”Ÿæˆå™¨"&gt;&lt;strong&gt;æ˜¾å¼å®šä¹‰åºåˆ—ç”Ÿæˆå™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;éœ€åœ¨å®ä½“ç±»ä¸­é€šè¿‡ &lt;code&gt;@SequenceGenerator&lt;/code&gt; æ³¨è§£æŒ‡å®šåºåˆ—åç§°åŠå‚æ•°ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SEQUENCE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;your_sequence_name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SequenceGenerator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;your_sequence_name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç”Ÿæˆå™¨åç§°ï¼Œéœ€ä¸ generator å‚æ•°ä¸€è‡´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sequenceName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;your_sequence_name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®åº“ä¸­çš„å®é™…åºåˆ—å&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;allocationSize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¯æ¬¡åˆ†é…çš„åºåˆ—å€¼æ•°é‡ï¼ˆéœ€ä¸æ•°æ®åº“åºåˆ—çš„ INCREMENT ä¸€è‡´ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šæ˜ç¡®å‘Šè¯‰ Hibernate ä½¿ç”¨å“ªä¸ªæ•°æ®åº“åºåˆ—ç”Ÿæˆä¸»é”®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ•°æ®åº“åºåˆ—åˆ›å»º"&gt;&lt;strong&gt;æ•°æ®åº“åºåˆ—åˆ›å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PostgreSQL ä¸­æ‰‹åŠ¨åˆ›å»ºåºåˆ—&lt;/strong&gt;ï¼ˆè‹¥æœªè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SEQUENCE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;your_sequence_name&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;START&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INCREMENT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;MINVALUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;MAXVALUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;9223372036854775807&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CACHE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼š&lt;code&gt;INCREMENT BY&lt;/code&gt; éœ€ä¸ &lt;code&gt;allocationSize&lt;/code&gt; ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="hibernate-ä¸æ•°æ®åº“æ–¹è¨€é…ç½®"&gt;Hibernate ä¸æ•°æ®åº“æ–¹è¨€é…ç½®
&lt;/h3&gt;&lt;h4 id="æ•°æ®åº“æ–¹è¨€è®¾ç½®"&gt;&lt;strong&gt;æ•°æ®åº“æ–¹è¨€è®¾ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;åœ¨ &lt;code&gt;application.yml&lt;/code&gt; ä¸­æŒ‡å®š PostgreSQL æ–¹è¨€ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;jpa&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;hibernate&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;dialect&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;org.hibernate.dialect.PostgreSQLDialect&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šä¸åŒæ•°æ®åº“çš„åºåˆ—ç”Ÿæˆé€»è¾‘ä¸åŒï¼Œéœ€æ˜ç¡®é€‚é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ddl-è‡ªåŠ¨ç”Ÿæˆé…ç½®"&gt;&lt;strong&gt;DDL è‡ªåŠ¨ç”Ÿæˆé…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¯ç”¨ Hibernate è‡ªåŠ¨åˆ›å»ºæˆ–æ›´æ–°è¡¨ç»“æ„ï¼ˆå¯é€‰ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring.jpa.hibernate.ddl-auto&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;update&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šè‹¥åºåˆ—ä¸å­˜åœ¨ï¼ŒHibernate ä¼šæ ¹æ® &lt;code&gt;@SequenceGenerator&lt;/code&gt; é…ç½®è‡ªåŠ¨åˆ›å»ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–"&gt;å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–
&lt;/h3&gt;&lt;h4 id="é¿å…åºåˆ—å†²çª"&gt;&lt;strong&gt;é¿å…åºåˆ—å†²çª&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šå¤šä¸ªå®ä½“å…±ç”¨é»˜è®¤åºåˆ—ï¼ˆå¦‚ &lt;code&gt;hibernate_sequence&lt;/code&gt;ï¼‰ä¼šå¯¼è‡´ä¸»é”®å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šä¸ºæ¯ä¸ªå®ä½“å®šä¹‰ç‹¬ç«‹çš„åºåˆ—åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ€§èƒ½ä¼˜åŒ–"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¢å¤§ &lt;code&gt;allocationSize&lt;/code&gt;&lt;/strong&gt;ï¼šè‹¥è®¾ç½®ä¸º 50ï¼Œåˆ™æ¯æ¬¡ä»æ•°æ®åº“é¢„å– 50 ä¸ª IDï¼Œå‡å°‘äº¤äº’æ¬¡æ•°ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@SequenceGenerator&lt;/span&gt;&lt;span class="p"&gt;(...,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;allocationSize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€åŒæ­¥ä¿®æ”¹æ•°æ®åº“åºåˆ—çš„ &lt;code&gt;INCREMENT BY 50&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="éªŒè¯åºåˆ—æ˜¯å¦ç”Ÿæ•ˆ"&gt;&lt;strong&gt;éªŒè¯åºåˆ—æ˜¯å¦ç”Ÿæ•ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—æ£€æŸ¥&lt;/strong&gt;ï¼šå¼€å¯ SQL æ—¥å¿—ï¼Œè§‚å¯Ÿ INSERT è¯­å¥æ˜¯å¦è°ƒç”¨ &lt;code&gt;nextval('your_sequence_name')&lt;/code&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring.jpa.show-sql&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–ä¸»é”®ç­–ç•¥å¯¹æ¯”"&gt;ä¸å…¶ä»–ä¸»é”®ç­–ç•¥å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;SEQUENCE&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;IDENTITY&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨æ•°æ®åº“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;PostgreSQLã€Oracle&lt;/td&gt;
&lt;td&gt;MySQLã€SQL Server&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é¢„ç”Ÿæˆä¸»é”®&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒï¼ˆåº”ç”¨å±‚ç¼“å­˜ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒï¼ˆé€æ¡æ’å…¥åè·å–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰¹é‡æ’å…¥æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆæ”¯æŒæ‰¹å¤„ç†ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆè‡ªå¢é”å¯¼è‡´ä¸²è¡ŒåŒ–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•åœºæ™¯-1"&gt;æ‰©å±•åœºæ™¯
&lt;/h3&gt;&lt;h4 id="åˆ†å¸ƒå¼ç³»ç»Ÿä¸»é”®ç”Ÿæˆ"&gt;&lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸»é”®ç”Ÿæˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰ç”Ÿæˆåˆ†å¸ƒå¼ IDï¼Œå®Œå…¨è„±ç¦»æ•°æ®åº“åºåˆ—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="jpa-20-çš„"&gt;&lt;strong&gt;JPA 2.0 çš„ &lt;code&gt;@GeneratedValue&lt;/code&gt; å¢å¼º&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–é…ç½®&lt;/strong&gt;ï¼šHibernate 5+ æ”¯æŒéšå¼åºåˆ—ç”Ÿæˆï¼Œä½†æ˜¾å¼å®šä¹‰ä»æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;GenerationType.SEQUENCE&lt;/code&gt; éœ€é€šè¿‡ &lt;code&gt;@SequenceGenerator&lt;/code&gt; æ³¨è§£ç»‘å®šæ•°æ®åº“åºåˆ—ï¼Œå¹¶ç¡®ä¿æ•°æ®åº“æ–¹è¨€ã€åºåˆ—æ­¥é•¿ç­‰é…ç½®ä¸€è‡´ã€‚è‹¥éœ€é«˜æ€§èƒ½æ‰¹é‡æ’å…¥ï¼Œå»ºè®®å¢å¤§ &lt;code&gt;allocationSize&lt;/code&gt; å¹¶ä¼˜åŒ–åºåˆ—å‚æ•°ã€‚&lt;/p&gt;
&lt;h2 id="æœªè¯»æ¶ˆæ¯ä¼˜å…ˆ"&gt;æœªè¯»æ¶ˆæ¯ä¼˜å…ˆ
&lt;/h2&gt;&lt;p&gt;åœ¨ JPA çš„ JPQL æŸ¥è¯¢ä¸­å®ç°æœªè¯»æ¶ˆæ¯ä¼˜å…ˆæ’åºï¼Œå¯ä»¥é€šè¿‡ &lt;strong&gt;æ¡ä»¶æ’åºè¡¨è¾¾å¼&lt;/strong&gt; å®ç°ã€‚æ ¹æ®ä½ çš„æŸ¥è¯¢è¯­å¥ï¼Œéœ€è¦è°ƒæ•´ &lt;code&gt;ORDER BY&lt;/code&gt; å­å¥çš„æ’åºé€»è¾‘ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆä½¿ç”¨-case-æ¡ä»¶è¡¨è¾¾å¼"&gt;è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ &lt;code&gt;CASE&lt;/code&gt; æ¡ä»¶è¡¨è¾¾å¼
&lt;/h3&gt;&lt;p&gt;ä¿®æ”¹åçš„ JPQL è¯­å¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;heslin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;postopia&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;UserMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isRead&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;createdAt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isRead&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;false&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ELSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- æœªè¯»æ¶ˆæ¯ä¼˜å…ˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;createdAt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DESC&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å…³é”®ç‚¹è¯´æ˜"&gt;å…³é”®ç‚¹è¯´æ˜ï¼š
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶æ’åºé€»è¾‘&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CASE WHEN m.isRead = false THEN 0 ELSE 1 END&lt;/code&gt;ï¼šå°†æœªè¯»æ¶ˆæ¯ï¼ˆ&lt;code&gt;isRead=false&lt;/code&gt;ï¼‰æ ‡è®°ä¸º &lt;code&gt;0&lt;/code&gt;ï¼Œå·²è¯»æ¶ˆæ¯æ ‡è®°ä¸º &lt;code&gt;1&lt;/code&gt;ï¼Œé€šè¿‡å‡åºæ’åˆ—ä½¿æœªè¯»æ¶ˆæ¯æ’åœ¨å·²è¯»æ¶ˆæ¯ä¹‹å‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;m.createdAt DESC&lt;/code&gt;ï¼šåœ¨æœªè¯»ä¼˜å…ˆçš„åŸºç¡€ä¸Šï¼ŒæŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åˆ—ï¼Œç¡®ä¿æœ€æ–°æ¶ˆæ¯åœ¨å‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸ƒå°”å­—æ®µçš„ç‰¹æ®Šå¤„ç†&lt;/strong&gt;&lt;br&gt;
å¦‚æœ &lt;code&gt;isRead&lt;/code&gt; æ˜¯å¸ƒå°”ç±»å‹å­—æ®µï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å¸ƒå°”å€¼çš„æ’åºç‰¹æ€§ï¼ˆ&lt;code&gt;false&lt;/code&gt; &amp;lt; &lt;code&gt;true&lt;/code&gt;ï¼‰ç®€åŒ–è¯­å¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isRead&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ASC&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;createdAt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DESC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- æœªè¯»ï¼ˆfalseï¼‰åœ¨å‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•å®ç°æ–¹å¼åŠ¨æ€æ¡ä»¶"&gt;æ‰©å±•å®ç°æ–¹å¼ï¼ˆåŠ¨æ€æ¡ä»¶ï¼‰
&lt;/h3&gt;&lt;p&gt;å¦‚æœéœ€è¦åœ¨ä»£ç ä¸­åŠ¨æ€æ§åˆ¶æ’åºè§„åˆ™ï¼Œå¯é€šè¿‡ &lt;code&gt;Sort&lt;/code&gt; å¯¹è±¡å®ç°çµæ´»æ’åºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰æ’åºè§„åˆ™ï¼šæœªè¯»ä¼˜å…ˆ + æ—¶é—´å€’åº&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Direction&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ASC&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;isRead&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æœªè¯»åœ¨å‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Direction&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;DESC&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;createdAt&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// åœ¨ Repository æˆ– Service ä¸­åº”ç”¨æ’åº&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;UserMessage&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;messages&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;messageRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findByUserId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
åœ¨æ•°æ®åº“è¡¨ä¸­ä¸º &lt;code&gt;user_id&lt;/code&gt;ã€&lt;code&gt;is_read&lt;/code&gt;ã€&lt;code&gt;created_at&lt;/code&gt; å­—æ®µå»ºç«‹å¤åˆç´¢å¼•ï¼ŒåŠ é€ŸæŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_message_user_read_time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;is_read&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created_at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DESC&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†é¡µæŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;Pageable&lt;/code&gt; åˆ†é¡µå‚æ•°é¿å…å…¨è¡¨æ‰«æï¼Œæå‡å¤§æ•°æ®é‡ä¸‹çš„æ€§èƒ½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;UserMessage&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;messageRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findByUserId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-4"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µå‘½åä¸€è‡´æ€§&lt;/strong&gt;ï¼šç¡®ä¿ JPQL ä¸­çš„å­—æ®µåï¼ˆå¦‚ &lt;code&gt;isRead&lt;/code&gt;ï¼‰ä¸å®ä½“ç±»å±æ€§åå®Œå…¨ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºå€¼å¤„ç†&lt;/strong&gt;ï¼šå¦‚æœ &lt;code&gt;isRead&lt;/code&gt; å¯èƒ½ä¸º &lt;code&gt;null&lt;/code&gt;ï¼Œéœ€å¢åŠ ç©ºå€¼åˆ¤æ–­é€»è¾‘ï¼ˆå¦‚ &lt;code&gt;CASE WHEN m.isRead IS NULL OR m.isRead = false THEN 0 ELSE 1 END&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯ä»¥å®ç°æœªè¯»æ¶ˆæ¯ä¼˜å…ˆå±•ç¤ºçš„éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒä»£ç ç®€æ´æ€§å’ŒæŸ¥è¯¢æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id="redis-è¿‡æœŸå›è°ƒ"&gt;Redis è¿‡æœŸå›è°ƒ
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼ŒSpring Data Redis å¯ä»¥é€šè¿‡è®¾ç½®å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰å¹¶ç»“åˆäº‹ä»¶ç›‘å¬æœºåˆ¶å®ç°è¿‡æœŸå›è°ƒåŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹å¼åŠæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è®¾ç½®å­˜æ´»æ—¶é—´ttlçš„ä¸¤ç§æ–¹å¼"&gt;è®¾ç½®å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰çš„ä¸¤ç§æ–¹å¼
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;@TimeToLive&lt;/code&gt; æ³¨è§£ï¼ˆå®ä½“çº§åˆ«ï¼‰&lt;/strong&gt;&lt;br&gt;
åœ¨å®ä½“ç±»ä¸­ï¼Œé€šè¿‡ &lt;code&gt;@TimeToLive&lt;/code&gt; æ³¨è§£æ ‡è®°å±æ€§æˆ–æ–¹æ³•ï¼Œå®ç°çµæ´»çš„åŠ¨æ€è¿‡æœŸæ—¶é—´è®¾ç½®ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;myEntity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyEntity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@TimeToLive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expiration&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»¥ç§’ä¸ºå•ä½&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–é€šè¿‡æ–¹æ³•åŠ¨æ€ç”Ÿæˆ TTLï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@TimeToLive&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;calculateTTL&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ofMinutes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;toSeconds&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ–¹å¼ä¼šå°† TTL ä¸ Redis Hash å¯¹è±¡å…³è”ï¼Œé€‚åˆéœ€è¦æŒä¹…åŒ–å®ä½“å¹¶è‡ªåŠ¨ç®¡ç†è¿‡æœŸçš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ &lt;code&gt;RedisTemplate&lt;/code&gt;ï¼ˆé”®å€¼å¯¹æ“ä½œï¼‰&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;opsForValue().set()&lt;/code&gt; æ–¹æ³•æ—¶ç›´æ¥æŒ‡å®š TTLï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‹¥éœ€æ›´æ–°å€¼ä½†ä¿ç•™åŸæœ‰ TTLï¼Œå¯å…ˆè·å–å½“å‰å‰©ä½™æ—¶é—´å†é‡æ–°è®¾ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getExpire&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;newValue&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ–¹å¼é€‚ç”¨äºç®€å•çš„é”®å€¼å¯¹æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°è¿‡æœŸå›è°ƒå‡½æ•°"&gt;å®ç°è¿‡æœŸå›è°ƒå‡½æ•°
&lt;/h3&gt;&lt;p&gt;é€šè¿‡è®¢é˜… Redis çš„ &lt;strong&gt;é”®ç©ºé—´é€šçŸ¥&lt;/strong&gt;ï¼ŒSpring Data Redis æä¾› &lt;code&gt;RedisKeyExpiredEvent&lt;/code&gt; äº‹ä»¶ç›‘å¬æœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯å®ç°æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨ Redis é”®ç©ºé—´é€šçŸ¥&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿ Redis æœåŠ¡å™¨é…ç½®ä¸­å¼€å¯é”®è¿‡æœŸäº‹ä»¶é€šçŸ¥ï¼ˆä¿®æ”¹ &lt;code&gt;redis.conf&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;notify-keyspace-events Ex
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–åœ¨è¿è¡Œæ—¶é€šè¿‡å‘½ä»¤è®¾ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;CONFIG SET notify-keyspace-events Ex
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½® Spring äº‹ä»¶ç›‘å¬å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»§æ‰¿ &lt;code&gt;KeyExpirationEventMessageListener&lt;/code&gt; å¹¶è¦†å†™å¤„ç†é€»è¾‘ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;KeyExpireListener&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KeyExpirationEventMessageListener&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;KeyExpireListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisMessageListenerContainer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;listenerContainer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;listenerContainer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pattern&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expiredKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œè‡ªå®šä¹‰å›è°ƒé€»è¾‘ï¼ˆå¦‚å–æ¶ˆè®¢å•ã€é‡Šæ”¾èµ„æºç­‰ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;@EventListener&lt;/code&gt; æ³¨è§£ç›´æ¥ç›‘å¬äº‹ä»¶ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@EventListener&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleKeyExpire&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisKeyExpiredEvent&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expiredKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œå›è°ƒé€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;æ­¤æ–¹å¼ä¼šæ•è·æ‰€æœ‰é”®è¿‡æœŸäº‹ä»¶ï¼Œéœ€ç»“åˆä¸šåŠ¡é€»è¾‘è¿‡æ»¤ç›®æ ‡é”®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-5"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶å¯é æ€§&lt;/strong&gt;&lt;br&gt;
Redis çš„é”®è¿‡æœŸé€šçŸ¥åŸºäº Pub/Sub æœºåˆ¶ï¼Œ&lt;strong&gt;ä¸ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–&lt;/strong&gt;ã€‚è‹¥åº”ç”¨åœ¨è¿‡æœŸæœŸé—´å®•æœºï¼Œäº‹ä»¶å¯èƒ½ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘å¬å™¨åˆå§‹åŒ–&lt;/strong&gt;&lt;br&gt;
é»˜è®¤æƒ…å†µä¸‹ï¼Œé”®è¿‡æœŸç›‘å¬å™¨æ˜¯ç¦ç”¨çš„ã€‚éœ€åœ¨ &lt;code&gt;@EnableRedisRepositories&lt;/code&gt; æˆ– &lt;code&gt;RedisKeyValueAdapter&lt;/code&gt; ä¸­æ˜¾å¼å¯ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@EnableRedisRepositories&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;enableKeyspaceEvents&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EnableKeyspaceEvents&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ON_STARTUP&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;AWS ElastiCache é™åˆ¶&lt;/strong&gt;&lt;br&gt;
è‹¥ä½¿ç”¨ AWS ElastiCacheï¼Œéœ€æ³¨æ„å…¶ç¦ç”¨äº† &lt;code&gt;CONFIG&lt;/code&gt; å‘½ä»¤ï¼Œéœ€æå‰é€šè¿‡æ§åˆ¶å°é…ç½®é”®ç©ºé—´é€šçŸ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯ç¤ºä¾‹"&gt;é€‚ç”¨åœºæ™¯ç¤ºä¾‹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¢å•è¶…æ—¶å–æ¶ˆ&lt;/strong&gt;ï¼šä¸‹å•æ—¶å°†è®¢å• ID å­˜å…¥ Redis å¹¶è®¾ç½® TTLï¼Œé€šè¿‡ç›‘å¬äº‹ä»¶è§¦å‘å–æ¶ˆé€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜è‡ªåŠ¨åˆ·æ–°&lt;/strong&gt;ï¼šç¼“å­˜è¿‡æœŸæ—¶é‡æ–°åŠ è½½æ•°æ®ï¼Œé¿å…æ‰‹åŠ¨ç»´æŠ¤ TTLã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼šè¯ç®¡ç†&lt;/strong&gt;ï¼šç”¨æˆ·ä¼šè¯è¿‡æœŸåè‡ªåŠ¨æ¸…ç†å…³è”èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼ŒSpring Data Redis å¯çµæ´»å®ç° TTL è®¾ç½®ä¸è¿‡æœŸå›è°ƒï¼Œæ»¡è¶³ä¸šåŠ¡ä¸­å¯¹æ—¶æ•ˆæ€§æ•æ„Ÿçš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id="redistemplate"&gt;RedisTemplate
&lt;/h2&gt;&lt;p&gt;RedisTemplate æ˜¯ Spring Data Redis æä¾›çš„æ ¸å¿ƒå·¥å…·ç±»ï¼Œå°è£…äº† Redis çš„è¿æ¥ç®¡ç†ã€åºåˆ—åŒ–ã€äº‹åŠ¡åŠå„ç±»æ•°æ®ç»“æ„æ“ä½œã€‚ä»¥ä¸‹ä» &lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;ã€&lt;strong&gt;é…ç½®ä¸åºåˆ—åŒ–&lt;/strong&gt;ã€&lt;strong&gt;å¸¸ç”¨æ“ä½œ&lt;/strong&gt;ã€&lt;strong&gt;é«˜çº§ç‰¹æ€§&lt;/strong&gt; å’Œ &lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt; äº”å¤§ç»´åº¦è¿›è¡Œæ·±å…¥è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„"&gt;æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€æ“ä½œå…¥å£&lt;/strong&gt;&lt;br&gt;
RedisTemplate æä¾›å¯¹ Redis çš„æŠ½è±¡è®¿é—®ï¼Œæ”¯æŒ Lettuce å’Œ Jedis ä¸¤ç§å®¢æˆ·ç«¯ï¼Œè‡ªåŠ¨ç®¡ç†è¿æ¥æ± ï¼ˆå¦‚ Lettuce çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå•æœºã€å“¨å…µï¼ˆSentinelï¼‰å’Œé›†ç¾¤ï¼ˆClusterï¼‰æ¨¡å¼ï¼Œé€šè¿‡ &lt;code&gt;RedisConnectionFactory&lt;/code&gt; åŠ¨æ€åˆ‡æ¢è¿æ¥æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;å°è£…å¤šç§æ•°æ®ç»“æ„æ“ä½œæ¥å£ï¼š&lt;code&gt;ValueOperations&lt;/code&gt;ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€&lt;code&gt;HashOperations&lt;/code&gt;ï¼ˆå“ˆå¸Œï¼‰ã€&lt;code&gt;ListOperations&lt;/code&gt;ï¼ˆåˆ—è¡¨ï¼‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡ä¸è„šæœ¬æ”¯æŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;multi()&lt;/code&gt; å’Œ &lt;code&gt;exec()&lt;/code&gt; å®ç°äº‹åŠ¡åŸå­æ€§æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;æ”¯æŒ Lua è„šæœ¬æ‰§è¡Œï¼Œä¾‹å¦‚å®ç°åˆ†å¸ƒå¼é”ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;if redis.call(&amp;#39;setnx&amp;#39;, KEYS[1], ARGV[1]) == 1 then ...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisCallback&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Boolean&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ä¸åºåˆ—åŒ–"&gt;é…ç½®ä¸åºåˆ—åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿æ¥æ± é…ç½®&lt;/strong&gt;&lt;br&gt;
åœ¨ &lt;code&gt;application.yml&lt;/code&gt; ä¸­å®šä¹‰è¿æ¥å‚æ•°ï¼Œä¼˜åŒ–æ€§èƒ½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;redis&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;lettuce&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;pool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-active&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æœ€å¤§è¿æ¥æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;min-idle&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æœ€å°ç©ºé—²è¿æ¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-wait&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;100ms&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# ç­‰å¾…è¶…æ—¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šJedis éœ€æ˜¾å¼é…ç½®è¿æ¥æ± ä¾èµ–ï¼ˆå¦‚ &lt;code&gt;commons-pool2&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åºåˆ—åŒ–ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤åºåˆ—åŒ–é—®é¢˜&lt;/strong&gt;ï¼šJDK åºåˆ—åŒ–ï¼ˆ&lt;code&gt;JdkSerializationRedisSerializer&lt;/code&gt;ï¼‰ç”ŸæˆäºŒè¿›åˆ¶æ•°æ®ï¼Œå¯è¯»æ€§å·®ä¸”å†…å­˜å ç”¨é«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setKeySerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringRedisSerializer&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Key ç”¨å­—ç¬¦ä¸²åºåˆ—åŒ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setValueSerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Jackson2JsonRedisSerializer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Value ç”¨ JSON&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setConnectionFactory&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;é€šè¿‡ &lt;code&gt;StringRedisSerializer&lt;/code&gt; å’Œ &lt;code&gt;Jackson2JsonRedisSerializer&lt;/code&gt; æå‡å¯è¯»æ€§ä¸æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¸¸ç”¨æ“ä½œç¤ºä¾‹"&gt;å¸¸ç”¨æ“ä½œç¤ºä¾‹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—ç¬¦ä¸²æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è®¾ç½®å€¼å¹¶æŒ‡å®š TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“ˆå¸Œæ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForHash&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å†™å…¥å“ˆå¸Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForHash&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;entries&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–å…¨éƒ¨å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ‰åºé›†åˆï¼ˆZSetï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForZSet&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;leaderboard&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;player1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ·»åŠ æˆå‘˜åŠåˆ†æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;topPlayers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForZSet&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;reverseRange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;leaderboard&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;4&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–å‰äº”å&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é«˜çº§ç‰¹æ€§"&gt;é«˜çº§ç‰¹æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿‡æœŸæ—¶é—´ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;expire&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;MINUTES&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ¨æ€è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ttl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getExpire&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢å‰©ä½™å­˜æ´»æ—¶é—´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;batchData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;batchData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForValue&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;multiSet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchData&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰¹é‡å†™å…¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘å¸ƒè®¢é˜…æ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;convertAndSend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;channel&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å‘å¸ƒæ¶ˆæ¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è®¢é˜…éœ€é…ç½® RedisMessageListenerContainer&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ"&gt;æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lettuce æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒJedis éœ€ä¾èµ–è¿æ¥æ± ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œé˜²æ­¢é˜»å¡å…¶ä»–è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Pipeline å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executePipelined&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;RedisCallback&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é¿å…é¢‘ç¹è°ƒç”¨ &lt;code&gt;keys *&lt;/code&gt;ï¼Œæ”¹ç”¨ &lt;code&gt;scan&lt;/code&gt; å‘½ä»¤åˆ†é¡µæŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
æ•è· &lt;code&gt;RedisConnectionFailureException&lt;/code&gt; ç­‰å¼‚å¸¸ï¼Œå®ç°é‡è¯•æœºåˆ¶æˆ–é™çº§ç­–ç•¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-5"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;RedisTemplate é€šè¿‡ç»Ÿä¸€çš„ API ç®€åŒ–äº† Redis æ“ä½œï¼Œä½†å…¶æ€§èƒ½ä¸ç¨³å®šæ€§é«˜åº¦ä¾èµ–é…ç½®ä¼˜åŒ–ï¼ˆå¦‚åºåˆ—åŒ–ã€è¿æ¥æ± ï¼‰ã€‚å¼€å‘ä¸­éœ€æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å’Œåºåˆ—åŒ–ç­–ç•¥ï¼Œå¹¶ç»“åˆç›‘æ§å·¥å…·ï¼ˆå¦‚ RedisInsightï¼‰è¿›è¡Œè°ƒä¼˜ã€‚&lt;/p&gt;
&lt;h2 id="spring-data-redis-ç»“åˆ-repository"&gt;Spring Data Redis ç»“åˆ @Repository
&lt;/h2&gt;&lt;p&gt;Spring Data Redis ä¸­çš„ &lt;code&gt;@Repository&lt;/code&gt; æ³¨è§£ä¸»è¦ç”¨äºæ ‡è¯†æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰ç»„ä»¶ï¼Œå¹¶ç»“åˆ Spring Data çš„ä»“åº“ï¼ˆRepositoryï¼‰æ¨¡å¼ç®€åŒ–ä¸ Redis çš„äº¤äº’ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨æ–¹æ³•çš„ä»‹ç»ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨"&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ä¸ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®è®¿é—®æŠ½è±¡&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@Repository&lt;/code&gt; åœ¨ Spring Data Redis ä¸­å¹¶éç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿ &lt;code&gt;CrudRepository&lt;/code&gt; ç­‰æ¥å£å®ç°ã€‚Spring Data Redis çš„ä»“åº“æ¥å£ä¼šè‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»ï¼Œæä¾›åŸºç¡€çš„ CRUD æ“ä½œï¼ˆå¦‚ &lt;code&gt;save()&lt;/code&gt;, &lt;code&gt;findById()&lt;/code&gt;, &lt;code&gt;delete()&lt;/code&gt; ç­‰ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™å®ç°ä»£ç ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸è½¬æ¢&lt;/strong&gt;&lt;br&gt;
Spring ä¼šè‡ªåŠ¨å°† Redis æ“ä½œä¸­çš„åº•å±‚å¼‚å¸¸ï¼ˆå¦‚è¿æ¥å¤±è´¥ã€å‘½ä»¤é”™è¯¯ï¼‰è½¬æ¢ä¸º Spring çš„ &lt;code&gt;DataAccessException&lt;/code&gt; å¼‚å¸¸å±‚æ¬¡ç»“æ„ï¼Œä¾¿äºç»Ÿä¸€å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å£°æ˜å¼æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
æ”¯æŒé€šè¿‡æ–¹æ³•åæˆ– &lt;code&gt;@Query&lt;/code&gt; æ³¨è§£å®šä¹‰è‡ªå®šä¹‰æŸ¥è¯¢ï¼Œä¾‹å¦‚ &lt;code&gt;findByUsername(String username)&lt;/code&gt;ï¼ŒSpring Data Redis ä¼šè‡ªåŠ¨è§£æå¹¶ç”Ÿæˆå¯¹åº”çš„ Redis å‘½ä»¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨æ­¥éª¤"&gt;&lt;strong&gt;ä½¿ç”¨æ­¥éª¤&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ­¥éª¤-1å®šä¹‰å®ä½“ç±»"&gt;&lt;strong&gt;æ­¥éª¤ 1ï¼šå®šä¹‰å®ä½“ç±»&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;@RedisHash&lt;/code&gt; æ³¨è§£æ ‡è®°å®ä½“ç±»ï¼Œå¹¶æŒ‡å®š Redis å­˜å‚¨çš„é”®åå‰ç¼€ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// getters/setters...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Id&lt;/code&gt; æ³¨è§£æ ‡è¯†ä¸»é”®å­—æ®µï¼Œå¯¹åº”çš„ Redis Key æ ¼å¼ä¸º &lt;code&gt;user:{id}&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ­¥éª¤-2å®šä¹‰-repository-æ¥å£"&gt;&lt;strong&gt;æ­¥éª¤ 2ï¼šå®šä¹‰ Repository æ¥å£&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç»§æ‰¿ &lt;code&gt;CrudRepository&lt;/code&gt; å¹¶æŒ‡å®šå®ä½“ç±»å‹å’Œä¸»é”®ç±»å‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CrudRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByUsername&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ— éœ€æ˜¾å¼æ·»åŠ  &lt;code&gt;@Repository&lt;/code&gt; æ³¨è§£ï¼ŒSpring Data ä¼šè‡ªåŠ¨ç”Ÿæˆå®ç°ç±»ã€‚&lt;/p&gt;
&lt;h4 id="æ­¥éª¤-3å¯ç”¨ä»“åº“æ‰«æ"&gt;&lt;strong&gt;æ­¥éª¤ 3ï¼šå¯ç”¨ä»“åº“æ‰«æ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨é…ç½®ç±»ä¸­æ·»åŠ  &lt;code&gt;@EnableRedisRepositories&lt;/code&gt;ï¼ŒæŒ‡å®šæ‰«æçš„åŒ…è·¯å¾„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableRedisRepositories&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;basePackages&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;com.example.repository&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RedisConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯é…ç½® RedisTemplate æˆ– Lettuce/Jedis è¿æ¥æ± &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ³¨è§£ä¼šæ¿€æ´» Spring Data Redis çš„ä»“åº“æ”¯æŒã€‚&lt;/p&gt;
&lt;h4 id="æ­¥éª¤-4æ³¨å…¥å¹¶ä½¿ç”¨-repository"&gt;&lt;strong&gt;æ­¥éª¤ 4ï¼šæ³¨å…¥å¹¶ä½¿ç”¨ Repository&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨æœåŠ¡ç±»ä¸­é€šè¿‡ &lt;code&gt;@Autowired&lt;/code&gt; æ³¨å…¥ä»“åº“å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;orElse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é«˜çº§ç‰¹æ€§-1"&gt;&lt;strong&gt;é«˜çº§ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;@Query&lt;/code&gt; æ³¨è§£å¯ç›´æ¥ç¼–å†™ Redis å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;HGETALL user:{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findUserWithHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡æ”¯æŒ&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£å®ç°åŸå­æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ‰¹é‡ä¿å­˜ç”¨æˆ·æ—¶ï¼Œè‹¥ä¸­é—´æ­¥éª¤å¤±è´¥ï¼Œæ‰€æœ‰æ“ä½œä¼šè‡ªåŠ¨å›æ»šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘å¸ƒ/è®¢é˜…æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
å¯é€šè¿‡ &lt;code&gt;RedisTemplate&lt;/code&gt; æˆ– &lt;code&gt;@RedisListener&lt;/code&gt; å®ç°æ¶ˆæ¯çš„å‘å¸ƒä¸è®¢é˜…ï¼Œé€‚ç”¨äºå®æ—¶é€šçŸ¥åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;é…ç½®ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åºåˆ—åŒ–é…ç½®&lt;/strong&gt;&lt;br&gt;
é»˜è®¤ä½¿ç”¨ JDK åºåˆ—åŒ–ï¼Œä½†æ¨èæ”¹ç”¨ JSON åºåˆ—åŒ–ï¼ˆå¦‚ &lt;code&gt;GenericJackson2JsonRedisSerializer&lt;/code&gt;ï¼‰ä»¥æé«˜å¯è¯»æ€§å’Œå…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setKeySerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringRedisSerializer&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setValueSerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenericJackson2JsonRedisSerializer&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setConnectionFactory&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿æ¥æ± ç®¡ç†&lt;/strong&gt;&lt;br&gt;
åœ¨ &lt;code&gt;application.properties&lt;/code&gt; ä¸­é…ç½® Lettuce æˆ– Jedis è¿æ¥æ± å‚æ•°ï¼Œä¼˜åŒ–æ€§èƒ½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.redis.lettuce.pool.max-active&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.redis.lettuce.pool.max-idle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜é«˜é¢‘è®¿é—®æ•°æ®&lt;/strong&gt;ï¼šå¦‚ç”¨æˆ·ä¼šè¯ã€å•†å“ä¿¡æ¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ’è¡Œæ¦œ&lt;/strong&gt;ï¼šåˆ©ç”¨ Redis çš„æœ‰åºé›†åˆï¼ˆSorted Setï¼‰å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;SETNX&lt;/code&gt; å‘½ä»¤å®ç°ç®€å•çš„åˆ†å¸ƒå¼é”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-6"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åœ¨ Spring Data Redis ä¸­ï¼Œ&lt;code&gt;@Repository&lt;/code&gt; çš„è§’è‰²é€šè¿‡ç»§æ‰¿ &lt;code&gt;CrudRepository&lt;/code&gt; éšå¼å®ç°ï¼Œç»“åˆ &lt;code&gt;@EnableRedisRepositories&lt;/code&gt; å¯å¿«é€Ÿæ„å»ºé«˜æ•ˆçš„æ•°æ®è®¿é—®å±‚ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºç®€åŒ– Redis æ“ä½œã€æä¾›å£°æ˜å¼æŸ¥è¯¢å’Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†ï¼Œé€‚åˆéœ€è¦é«˜æ€§èƒ½ç¼“å­˜æˆ–å¤æ‚æ•°æ®ç»“æ„çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id="redishash"&gt;@RedisHash
&lt;/h2&gt;&lt;h3 id="åŸºæœ¬å®šä¹‰ä¸æ ¸å¿ƒåŠŸèƒ½"&gt;åŸºæœ¬å®šä¹‰ä¸æ ¸å¿ƒåŠŸèƒ½
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RedisHash&lt;/code&gt; æ˜¯ Spring Data Redis æä¾›çš„å…³é”®æ³¨è§£ï¼Œç”¨äºå°† Java å¯¹è±¡æ˜ å°„ä¸º Redis çš„ &lt;strong&gt;Hash æ•°æ®ç»“æ„&lt;/strong&gt;ï¼Œé€‚ç”¨äºç»“æ„åŒ–å¯¹è±¡çš„å­˜å‚¨ä¸ç®¡ç†ã€‚é€šè¿‡è¯¥æ³¨è§£ï¼Œå¼€å‘è€…èƒ½ä»¥é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œ Redisï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†å­—æ®µåºåˆ—åŒ–å’Œé”®å€¼æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨é”®ç”Ÿæˆ&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;@RedisHash(&amp;quot;å‰ç¼€&amp;quot;)&lt;/code&gt; å®šä¹‰é”®å‰ç¼€ï¼Œç»“åˆ &lt;code&gt;@Id&lt;/code&gt; æ³¨è§£çš„å­—æ®µå€¼ç”Ÿæˆå®Œæ•´ Redis é”®ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;@RedisHash(&amp;quot;user&amp;quot;)&lt;/code&gt; çš„ç±»è‹¥ &lt;code&gt;id=1001&lt;/code&gt;ï¼Œåˆ™é”®ä¸º &lt;code&gt;user:1001&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µè‡ªåŠ¨æ˜ å°„&lt;/strong&gt;&lt;br&gt;
ç±»çš„å±æ€§é»˜è®¤æ˜ å°„ä¸º Hash çš„å­—æ®µï¼ˆFieldï¼‰ï¼Œæ”¯æŒè‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥ï¼ˆå¦‚ JSONï¼‰ï¼Œé¿å… JDK åºåˆ—åŒ–çš„äºŒè¿›åˆ¶å†—ä½™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/strong&gt;&lt;br&gt;
æ”¯æŒé€šè¿‡ &lt;code&gt;timeToLive&lt;/code&gt; å±æ€§æˆ– &lt;code&gt;@TimeToLive&lt;/code&gt; æ³¨è§£è®¾ç½®å¯¹è±¡è¿‡æœŸæ—¶é—´ï¼Œé€‚ç”¨äºç¼“å­˜åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ä½¿ç”¨æ–¹å¼ä¸ä»£ç ç¤ºä¾‹"&gt;ä½¿ç”¨æ–¹å¼ä¸ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;1. å®ä½“ç±»å®šä¹‰&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;timeToLive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3600&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”®å‰ç¼€ä¸º&amp;#34;user&amp;#34;ï¼Œé»˜è®¤å­˜æ´»1å°æ—¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;username&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰å­—æ®µå&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Getter/Setter&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2. æ•°æ®è®¿é—®æ¥å£&lt;/strong&gt;&lt;br&gt;
ç»§æ‰¿ &lt;code&gt;CrudRepository&lt;/code&gt; å®ç°å¿«é€Ÿ CRUD æ“ä½œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CrudRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3. æ“ä½œç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ä¿å­˜å¯¹è±¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;1001&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢å¯¹è±¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Optional&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;1001&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ifPresent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¾“å‡º &amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="åº”ç”¨åœºæ™¯"&gt;åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·é…ç½®ç®¡ç†&lt;/strong&gt;&lt;br&gt;
å­˜å‚¨ç”¨æˆ·å±æ€§ï¼ˆå¦‚å§“åã€é‚®ç®±ã€ç™»å½•æ¬¡æ•°ï¼‰ï¼Œé¿å…ä¸ºæ¯ä¸ªå­—æ®µåˆ›å»ºç‹¬ç«‹é”®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç¼“å­˜å¯¹è±¡&lt;/strong&gt;&lt;br&gt;
ç¼“å­˜å•†å“è¯¦æƒ…ã€è®¢å•ä¿¡æ¯ç­‰ç»“æ„åŒ–æ•°æ®ï¼Œæ”¯æŒéƒ¨åˆ†å­—æ®µæ›´æ–°ï¼ˆå¦‚åº“å­˜å¢å‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘é”®æ•°é‡&lt;/strong&gt;&lt;br&gt;
å°†å¤šä¸ªç›¸å…³å­—æ®µèšåˆåˆ°å•ä¸€ Hash é”®ä¸‹ï¼Œç®€åŒ– Redis å‘½åç©ºé—´ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="åº•å±‚å®ç°ä¸ä¼˜åŒ–"&gt;åº•å±‚å®ç°ä¸ä¼˜åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç»“æ„é€‰æ‹©&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;å°è§„æ¨¡æ•°æ®é»˜è®¤ä½¿ç”¨ &lt;strong&gt;listpack&lt;/strong&gt;ï¼ˆåŸ ziplistï¼‰å‹ç¼©å­˜å‚¨ï¼ŒèŠ‚çœå†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®é‡å¢å¤§æ—¶è‡ªåŠ¨è½¬ä¸º &lt;strong&gt;å“ˆå¸Œè¡¨&lt;/strong&gt;ï¼ˆhashtableï¼‰ï¼Œä¿è¯ O(1) æ“ä½œæ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¤§ Hash&lt;/strong&gt;ï¼šå• Hash å­—æ®µè¿‡å¤šæ—¶ï¼Œ&lt;code&gt;HGETALL&lt;/code&gt; å¯èƒ½å¼•å‘æ€§èƒ½é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ &lt;code&gt;HSCAN&lt;/code&gt; åˆ†é¡µéå†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆç†åºåˆ—åŒ–&lt;/strong&gt;ï¼šä¼˜å…ˆé€‰æ‹© &lt;code&gt;Jackson2JsonRedisSerializer&lt;/code&gt; æ›¿ä»£é»˜è®¤åºåˆ—åŒ–ï¼Œæå‡å¯è¯»æ€§å’Œå…¼å®¹æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ä¸å…¶ä»–æ•°æ®ç»“æ„çš„å¯¹æ¯”"&gt;ä¸å…¶ä»–æ•°æ®ç»“æ„çš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Hash ä¼˜åŠ¿&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;String/List å±€é™æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¤šå­—æ®µå¯¹è±¡å­˜å‚¨&lt;/td&gt;
&lt;td&gt;å•é”®ç®¡ç†æ‰€æœ‰å±æ€§ï¼Œå‡å°‘é”®æ•°é‡&lt;/td&gt;
&lt;td&gt;éœ€ä¸ºæ¯ä¸ªå±æ€§å•ç‹¬è®¾é”®ï¼Œç®¡ç†å¤æ‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éƒ¨åˆ†å­—æ®µæ›´æ–°&lt;/td&gt;
&lt;td&gt;æ”¯æŒåŸå­çº§å­—æ®µä¿®æ”¹ï¼ˆå¦‚ &lt;code&gt;HINCRBY&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;String éœ€ååºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ï¼Œæ•ˆç‡ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç»“æ„åŒ–æ•°æ®ç¼“å­˜&lt;/td&gt;
&lt;td&gt;ç›´æ¥æ˜ å°„å¯¹è±¡ï¼Œä»£ç ç®€æ´&lt;/td&gt;
&lt;td&gt;List éœ€æ‰‹åŠ¨ç»´æŠ¤å­—æ®µé¡ºåºï¼Œæ˜“å‡ºé”™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-6"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é”®è®¾è®¡è§„èŒƒ&lt;/strong&gt;&lt;br&gt;
é”®å‰ç¼€ï¼ˆå¦‚ &lt;code&gt;user&lt;/code&gt;ï¼‰ä¸ &lt;code&gt;@Id&lt;/code&gt; ç»„åˆéœ€å…¨å±€å”¯ä¸€ï¼Œé¿å…å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æœŸç­–ç•¥é™åˆ¶&lt;/strong&gt;&lt;br&gt;
Redis ä»…æ”¯æŒå¯¹ &lt;strong&gt;æ•´ä¸ª Hash é”®&lt;/strong&gt; è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ— æ³•å•ç‹¬æ§åˆ¶å­—æ®µçš„ TTLã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å…¼å®¹æ€§&lt;/strong&gt;&lt;br&gt;
å¤æ‚å¯¹è±¡éœ€å®šä¹‰æ˜ç¡®çš„åºåˆ—åŒ–è§„åˆ™ï¼Œé¿å…è·¨ç‰ˆæœ¬æˆ–è·¨è¯­è¨€è§£æå¤±è´¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="timetolive"&gt;@TimeToLive
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Redis ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@TimeToLive&lt;/code&gt;&lt;/strong&gt; æ˜¯ç”¨äºåŠ¨æ€è®¾ç½® Redis å®ä½“ï¼ˆEntityï¼‰ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰çš„æ ¸å¿ƒæ³¨è§£ï¼Œæ”¯æŒçµæ´»æ§åˆ¶é”®å€¼å¯¹çš„è‡ªåŠ¨è¿‡æœŸé€»è¾‘ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨æ–¹æ³•çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½"&gt;æ ¸å¿ƒåŠŸèƒ½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è®¾ç½® TTL&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@TimeToLive&lt;/code&gt; å¯æ ‡æ³¨åœ¨å®ä½“ç±»çš„ &lt;strong&gt;å±æ€§æˆ–æ–¹æ³•&lt;/strong&gt; ä¸Šï¼ŒæŒ‡å®šä¸€ä¸ªæ•°å€¼ï¼ˆç§’æˆ–æ¯«ç§’ï¼‰ä½œä¸º TTLã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ ‡æ³¨åœ¨å±æ€§ä¸Šï¼ˆè¿”å› Long ç±»å‹ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TimeToLiveOnProperty&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@TimeToLive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expiration&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// TTL å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼ˆè¿”å› long ç±»å‹ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TimeToLiveOnMethod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@TimeToLive&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getTimeToLive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Random&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;nextLong&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ¨æ€ç”Ÿæˆ TTL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ–¹æ³•è¿”å›å€¼å¯ä»¥æ˜¯å›ºå®šå€¼æˆ–åŠ¨æ€è®¡ç®—çš„æ•°å€¼ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯çš„è¿‡æœŸç­–ç•¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸ &lt;code&gt;@RedisHash&lt;/code&gt; ç»“åˆä½¿ç”¨&lt;/strong&gt;&lt;br&gt;
åœ¨ç±»çº§åˆ«é€šè¿‡ &lt;code&gt;@RedisHash(timeToLive = 60)&lt;/code&gt; å¯è®¾ç½®å…¨å±€é»˜è®¤ TTLï¼ˆå•ä½ç§’ï¼‰ï¼Œä½† &lt;code&gt;@TimeToLive&lt;/code&gt; çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œå…è®¸è¦†ç›–å…¨å±€è®¾ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿‡æœŸäº‹ä»¶ç›‘å¬&lt;/strong&gt;&lt;br&gt;
å½“é”®è¿‡æœŸæ—¶ï¼ŒSpring Data Redis ä¼šå‘å¸ƒ &lt;code&gt;RedisKeyExpiredEvent&lt;/code&gt; äº‹ä»¶ï¼Œéœ€é…åˆ &lt;code&gt;@EnableRedisRepositories(enableKeyspaceEvents = EnableKeyspaceEvents.ON_STARTUP)&lt;/code&gt; å¯ç”¨é”®ç©ºé—´é€šçŸ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹"&gt;ä½¿ç”¨æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨è§£å†²çª&lt;/strong&gt;&lt;br&gt;
åŒä¸€å®ä½“ç±»ä¸­ &lt;strong&gt;ä¸èƒ½åŒæ—¶åœ¨å±æ€§å’Œæ–¹æ³•ä¸Šä½¿ç”¨ &lt;code&gt;@TimeToLive&lt;/code&gt;&lt;/strong&gt;ï¼Œå¦åˆ™ä¼šå¯¼è‡´è¿è¡Œæ—¶å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”®ç©ºé—´é€šçŸ¥é…ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redis éœ€é…ç½® &lt;code&gt;notify-keyspace-events&lt;/code&gt; å‚æ•°ï¼ˆå¦‚ &lt;code&gt;Ex&lt;/code&gt;ï¼‰ä»¥æ”¯æŒè¿‡æœŸäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;äº‘æœåŠ¡ï¼ˆå¦‚ AWS ElastiCacheï¼‰å¯èƒ½ç¦ç”¨ &lt;code&gt;CONFIG&lt;/code&gt; å‘½ä»¤ï¼Œéœ€é¢„å…ˆé…ç½®è¯¥å‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;TTL è¯»å–ä¸æŒä¹…åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;@TimeToLive&lt;/code&gt; æ ‡æ³¨çš„å±æ€§ä¼šä» Redis å›è¯»å®é™…çš„ TTL å€¼ï¼Œ&lt;code&gt;-1&lt;/code&gt; è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@Reference&lt;/code&gt; å¼•ç”¨å…¶ä»–å¯¹è±¡æ—¶ï¼Œéœ€ç¡®ä¿å¼•ç”¨çš„é”®æœªè¢«æå‰åˆ é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼šè¯ç®¡ç†&lt;/strong&gt;&lt;br&gt;
ç”¨æˆ·ä¼šè¯æ•°æ®è®¾ç½®çŸ­ TTLï¼ˆå¦‚ 30 åˆ†é’Ÿï¼‰ï¼Œè‡ªåŠ¨æ¸…ç†æ— æ•ˆä¼šè¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸´æ—¶ç¼“å­˜&lt;/strong&gt;&lt;br&gt;
é«˜é¢‘è®¿é—®çš„ä¸´æ—¶æ•°æ®ï¼ˆå¦‚éªŒè¯ç ï¼‰è®¾ç½®åŠ¨æ€ TTLï¼Œé¿å…å†…å­˜å ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;@TimeToLive&lt;/code&gt; å®ç°é”çš„è‡ªåŠ¨é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ç¤ºä¾‹"&gt;é…ç½®ç¤ºä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EnableRedisRepositories&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;basePackages&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;com.example.repository&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enableKeyspaceEvents&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EnableKeyspaceEvents&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ON_STARTUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯åŠ¨æ—¶ç›‘å¬äº‹ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RedisConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisConnectionFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisTemplate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setKeySerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringRedisSerializer&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setValueSerializer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenericJackson2JsonRedisSerializer&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setConnectionFactory&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–-ttl-è®¾ç½®çš„å¯¹æ¯”"&gt;ä¸å…¶ä»– TTL è®¾ç½®çš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜å…ˆçº§&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@RedisHash(timeToLive)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;å…¨å±€ç»Ÿä¸€è¿‡æœŸç­–ç•¥&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;@TimeToLive&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;åŠ¨æ€æˆ–ç»†ç²’åº¦æ§åˆ¶è¿‡æœŸ&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Redis åŸç”Ÿå‘½ä»¤ï¼ˆEXPIREï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é Spring é›†æˆçš„ä¸´æ—¶æ“ä½œ&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;@TimeToLive&lt;/code&gt;ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»ç®¡ç† Redis æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œç»“åˆäº‹ä»¶ç›‘å¬å’ŒåŠ¨æ€è®¡ç®—èƒ½åŠ›ï¼Œé€‚ç”¨äºå¤æ‚ç¼“å­˜ç­–ç•¥å’Œå®æ—¶æ•°æ®å¤„ç†åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id="reference-and-indexed"&gt;@Reference and @Indexed
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Redis ä¸­ï¼Œ&lt;code&gt;@Reference&lt;/code&gt; å’Œ &lt;code&gt;Indexed&lt;/code&gt; æ˜¯ç”¨äºä¼˜åŒ–æ•°æ®å­˜å‚¨ä¸æŸ¥è¯¢çš„æ ¸å¿ƒæ³¨è§£ï¼Œä½†å…¶è®¾è®¡ç›®çš„å’Œå®ç°æœºåˆ¶å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»åŠŸèƒ½ã€å®ç°åŸç†ã€ä½¿ç”¨åœºæ™¯åŠæ³¨æ„äº‹é¡¹è¿›è¡Œæ·±å…¥åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="indexed"&gt;&lt;strong&gt;&lt;code&gt;@Indexed&lt;/code&gt; æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ ¸å¿ƒåŠŸèƒ½"&gt;&lt;strong&gt;1. æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äºŒçº§ç´¢å¼•æ”¯æŒ&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@Indexed&lt;/code&gt; ç”¨äºåœ¨ Redis ä¸­ä¸ºå®ä½“ç±»çš„ &lt;strong&gt;æ™®é€šå±æ€§&lt;/strong&gt;ï¼ˆéä¸»é”®ï¼‰åˆ›å»ºè¾…åŠ©ç´¢å¼•ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡è¿™äº›å±æ€§è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œå¯¹ç”¨æˆ·å®ä½“çš„ &lt;code&gt;name&lt;/code&gt; å­—æ®µæ·»åŠ  &lt;code&gt;@Indexed&lt;/code&gt; åï¼Œå¯é€šè¿‡ &lt;code&gt;findByName(String name)&lt;/code&gt; æ–¹æ³•æŸ¥è¯¢æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•å­˜å‚¨æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
æ¯ä¸ªè¢«ç´¢å¼•çš„å±æ€§ä¼šç”Ÿæˆç‹¬ç«‹çš„ &lt;strong&gt;ç´¢å¼•é”®&lt;/strong&gt;ï¼Œæ ¼å¼ä¸º &lt;code&gt;{å®ä½“ç±»å}:{å±æ€§å}:{å±æ€§å€¼}&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å®ä½“çš„ &lt;code&gt;name&lt;/code&gt; å­—æ®µå€¼ä¸º &amp;ldquo;å¼ ä¸‰&amp;rdquo; æ—¶ï¼Œä¼šç”Ÿæˆç´¢å¼•é”® &lt;code&gt;users:name:å¼ ä¸‰&lt;/code&gt;ï¼Œå…¶å€¼ä¸ºå¯¹åº”çš„å®ä½“ä¸»é”®é›†åˆï¼ˆå¦‚ &lt;code&gt;[1, 2]&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å…¸å‹åº”ç”¨åœºæ™¯"&gt;&lt;strong&gt;2. å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æŸ¥è¯¢å­—æ®µ&lt;/strong&gt;&lt;br&gt;
å¦‚ç”¨æˆ·åç§°ã€å•†å“åˆ†ç±»ç­‰éœ€è¦é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µï¼Œé€šè¿‡ç´¢å¼•åŠ é€ŸæŸ¥è¯¢è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»„åˆæŸ¥è¯¢æ”¯æŒ&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;And&lt;/code&gt;/&lt;code&gt;Or&lt;/code&gt; å…³é”®å­—å®ç°ç®€å•ç»„åˆæŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;findByNameAndAge&lt;/code&gt;ï¼‰ï¼Œä½†æ— æ³•æ”¯æŒ &lt;code&gt;Like&lt;/code&gt; æˆ–èŒƒå›´æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-é…ç½®ä¸ä½¿ç”¨"&gt;&lt;strong&gt;3. é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Indexed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ›å»º name çš„äºŒçº§ç´¢å¼•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ç¤ºä¾‹&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CrudRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡ç´¢å¼•æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;4. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä»…æ”¯æŒç®€å•æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
Redis åº•å±‚ä¸æ”¯æŒå¤æ‚æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;GreaterThan&lt;/code&gt;ã€&lt;code&gt;Between&lt;/code&gt;ï¼‰ï¼Œå› æ­¤ &lt;code&gt;@Indexed&lt;/code&gt; åªèƒ½ç”¨äºç­‰å€¼æˆ–é€»è¾‘ç»„åˆæŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ç»´æŠ¤æˆæœ¬&lt;/strong&gt;&lt;br&gt;
ç´¢å¼•é”®ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ï¼Œä¸”æ’å…¥/æ›´æ–°æ•°æ®æ—¶éœ€åŒæ­¥æ›´æ–°ç´¢å¼•ï¼Œå¯èƒ½å½±å“å†™å…¥æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="reference"&gt;&lt;strong&gt;&lt;code&gt;@Reference&lt;/code&gt; æ³¨è§£&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-æ ¸å¿ƒåŠŸèƒ½-1"&gt;&lt;strong&gt;1. æ ¸å¿ƒåŠŸèƒ½&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯¹è±¡å…³è”å­˜å‚¨&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@Reference&lt;/code&gt; ç”¨äºåœ¨å®ä½“ä¹‹é—´å»ºç«‹ &lt;strong&gt;å…³è”å…³ç³»&lt;/strong&gt;ï¼Œå°†å…¶ä»–å®ä½“ä»¥ &lt;strong&gt;é”®å¼•ç”¨&lt;/strong&gt;ï¼ˆè€Œéå®Œæ•´å¯¹è±¡ï¼‰çš„å½¢å¼å­˜å‚¨ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å®ä½“ä¸­å…³è”çš„åœ°å€å¯¹è±¡ä¼šè¢«å­˜å‚¨ä¸º &lt;code&gt;address:{id}&lt;/code&gt; çš„é”®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‡’åŠ è½½æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;@Repository&lt;/code&gt; è·å–å®ä½“æ—¶ï¼Œè¢« &lt;code&gt;@Reference&lt;/code&gt; æ ‡æ³¨çš„å…³è”å¯¹è±¡ä¼š &lt;strong&gt;è‡ªåŠ¨è§£æ&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼ŒåŠ è½½ç”¨æˆ·æ—¶ä¼šè‡ªåŠ¨ä» Redis ä¸­æ£€ç´¢å…³è”çš„åœ°å€æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å…¸å‹åº”ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;2. å…¸å‹åº”ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è§£è€¦ä¸å…±äº«&lt;/strong&gt;&lt;br&gt;
å¤šä¸ªå®ä½“å¼•ç”¨åŒä¸€æ•°æ®ï¼ˆå¦‚å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€åœ°å€ï¼‰ï¼Œé¿å…é‡å¤å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§å¯¹è±¡æ‹†åˆ†&lt;/strong&gt;&lt;br&gt;
å°†å¤æ‚å¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªå­å¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·è¯¦æƒ…ä¸åœ°å€ï¼‰ï¼Œå‡å°‘å•æ¬¡æŸ¥è¯¢çš„æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-é…ç½®ä¸ä½¿ç”¨-1"&gt;&lt;strong&gt;3. é…ç½®ä¸ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Reference&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Address&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­˜å‚¨ä¸º address:{id} çš„é”®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¶ä»–å­—æ®µ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çº§è”æ“ä½œ&lt;/strong&gt;&lt;br&gt;
éœ€æ‰‹åŠ¨ä¿å­˜æˆ–åˆ é™¤å…³è”å¯¹è±¡ï¼ŒSpring Data Redis &lt;strong&gt;ä¸æ”¯æŒè‡ªåŠ¨çº§è”æ“ä½œ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4-æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;4. æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼•ç”¨å¯¹è±¡å¿…é¡»å­˜åœ¨&lt;/strong&gt;&lt;br&gt;
è‹¥å…³è”å¯¹è±¡æœªæŒä¹…åŒ–åˆ° Redisï¼Œè§£ææ—¶ä¼šå¯¼è‡´ &lt;code&gt;KeyNotFoundException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯å¼•ç”¨&lt;/strong&gt;&lt;br&gt;
åŒå‘å¼•ç”¨ï¼ˆå¦‚ç”¨æˆ·å¼•ç”¨è®¢å•ï¼Œè®¢å•åˆå¼•ç”¨ç”¨æˆ·ï¼‰å¯èƒ½å¯¼è‡´åºåˆ—åŒ–é—®é¢˜ï¼Œéœ€é€šè¿‡å†—ä½™å­—æ®µæˆ–æ‰‹åŠ¨å¤„ç†è§£å†³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="indexed-1"&gt;&lt;strong&gt;&lt;code&gt;@Indexed&lt;/code&gt; vs &lt;code&gt;@Reference&lt;/code&gt; å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;@Indexed&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;&lt;code&gt;@Reference&lt;/code&gt;&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŠ é€ŸæŸ¥è¯¢ï¼Œæ”¯æŒæŒ‰éä¸»é”®å­—æ®µæ£€ç´¢æ•°æ®&lt;/td&gt;
&lt;td&gt;å»ºç«‹å®ä½“å…³è”ï¼Œæ”¯æŒå¯¹è±¡å¼•ç”¨ä¸æ‡’åŠ è½½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åˆ›å»ºè¾…åŠ©ç´¢å¼•é”®ï¼Œå­˜å‚¨ä¸»é”®é›†åˆ&lt;/td&gt;
&lt;td&gt;å­˜å‚¨å…³è”å¯¹è±¡çš„é”®ï¼ˆå¦‚ &lt;code&gt;address:{id}&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥è¯¢èƒ½åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒç®€å•ç­‰å€¼æŸ¥è¯¢ï¼ˆ&lt;code&gt;And&lt;/code&gt;/&lt;code&gt;Or&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒç›´æ¥æŸ¥è¯¢ï¼Œä¾èµ–ä¸»é”®è§£æå…³è”å¯¹è±¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å†™å…¥æ—¶éœ€ç»´æŠ¤ç´¢å¼•ï¼Œå¯èƒ½é™ä½å†™å…¥æ€§èƒ½&lt;/td&gt;
&lt;td&gt;è¯»å–æ—¶éœ€é¢å¤–æŸ¥è¯¢å…³è”å¯¹è±¡ï¼Œå¯èƒ½å¢åŠ å»¶è¿Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜é¢‘æŸ¥è¯¢å­—æ®µã€ç®€å•ç»„åˆæŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;æ•°æ®è§£è€¦ã€å…±äº«å¯¹è±¡ã€å¤æ‚å¯¹è±¡æ‹†åˆ†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®"&gt;&lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆç†ä½¿ç”¨ç´¢å¼•&lt;/strong&gt;&lt;br&gt;
ä»…å¯¹é«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ  &lt;code&gt;@Indexed&lt;/code&gt;ï¼Œé¿å…è¿‡åº¦ç´¢å¼•å¯¼è‡´å­˜å‚¨è†¨èƒ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰‹åŠ¨ç®¡ç†å…³è”ç”Ÿå‘½å‘¨æœŸ&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;@Reference&lt;/code&gt; æ—¶ï¼Œç¡®ä¿å…³è”å¯¹è±¡å·²æŒä¹…åŒ–ï¼Œå¹¶åœ¨åˆ é™¤ä¸»å¯¹è±¡æ—¶åŒæ­¥æ¸…ç†å¼•ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;@Query&lt;/code&gt; æ‰©å±•åŠŸèƒ½&lt;/strong&gt;&lt;br&gt;
å¯¹äºå¤æ‚æŸ¥è¯¢ï¼ˆå¦‚åµŒå¥—å­—æ®µè¿‡æ»¤ï¼‰ï¼Œå¯é€šè¿‡ &lt;code&gt;@Query&lt;/code&gt; æ³¨è§£ç¼–å†™è‡ªå®šä¹‰ Redis å‘½ä»¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘æ§æ€§èƒ½å½±å“&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ Redis çš„ &lt;code&gt;INFO&lt;/code&gt; å‘½ä»¤ç›‘æ§å†…å­˜å ç”¨å’Œç´¢å¼•é”®æ•°é‡ï¼Œä¼˜åŒ–å­˜å‚¨ç»“æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;@Indexed&lt;/code&gt; å’Œ &lt;code&gt;@Reference&lt;/code&gt;ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ Redis ä¸­å®ç°æ¥è¿‘å…³ç³»å‹æ•°æ®åº“çš„æŸ¥è¯¢ä¸å…³è”åŠŸèƒ½ï¼Œä½†éœ€æ ¹æ®åœºæ™¯æƒè¡¡å…¶ä¼˜ç¼ºç‚¹ï¼Œé¿å…æ»¥ç”¨å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id="é”®è¿‡æœŸ"&gt;é”®è¿‡æœŸ
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Redis ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;@RedisHash&lt;/code&gt; æ³¨è§£æ—¶è‹¥ä¸è®¾ç½® &lt;code&gt;expiration&lt;/code&gt;ï¼Œå…¶é»˜è®¤è¡Œä¸ºä¸ Redis æœ¬èº«çš„è¿‡æœŸæœºåˆ¶ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆåˆ†æçš„ç»“è®ºï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é»˜è®¤æƒ…å†µä¸‹"&gt;&lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;@RedisHash&lt;/code&gt; çš„é”®ä¸ä¼šè‡ªåŠ¨è¿‡æœŸ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Redis é»˜è®¤è¡Œä¸º&lt;/strong&gt;&lt;br&gt;
å¦‚æœæœªé€šè¿‡ &lt;code&gt;@RedisHash(expiration = ...)&lt;/code&gt; æ˜¾å¼è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯¹åº”çš„ Redis Hash é”®ï¼ˆå¦‚ &lt;code&gt;myEntity:123&lt;/code&gt;ï¼‰&lt;strong&gt;é»˜è®¤æ°¸ä¸è¿‡æœŸ&lt;/strong&gt;ã€‚è¿™ä¸ Redis çš„é€šç”¨è§„åˆ™ä¸€è‡´ï¼šæœªè®¾ç½® &lt;code&gt;EXPIRE&lt;/code&gt; çš„é”®ä¼šä¿ç•™åˆ°æ‰‹åŠ¨åˆ é™¤æˆ–è§¦å‘å†…å­˜æ·˜æ±°ç­–ç•¥ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç ç¤ºä¾‹éªŒè¯&lt;/strong&gt;&lt;br&gt;
åœ¨ Spring Data Redis ä¸­ï¼Œè‹¥å®ä½“ç±»æœªæŒ‡å®š &lt;code&gt;expiration&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;myEntity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyEntity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”Ÿæˆçš„ Redis é”® &lt;code&gt;myEntity:id&lt;/code&gt; å°†æ— è¿‡æœŸæ—¶é—´ï¼Œé€šè¿‡ &lt;code&gt;TTL myEntity:id&lt;/code&gt; å‘½ä»¤æŸ¥è¯¢è¿”å› &lt;code&gt;-1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å†…å­˜æ·˜æ±°ç­–ç•¥å¯èƒ½å½±å“æœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®"&gt;&lt;strong&gt;å†…å­˜æ·˜æ±°ç­–ç•¥å¯èƒ½å½±å“æœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å³ä½¿æœªè®¾ç½® &lt;code&gt;expiration&lt;/code&gt;ï¼Œä»¥ä¸‹åœºæ™¯å¯èƒ½å¯¼è‡´é”®è¢«åˆ é™¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜ä¸è¶³æ—¶çš„è‡ªåŠ¨æ·˜æ±°&lt;/strong&gt;&lt;br&gt;
Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆ&lt;code&gt;maxmemory-policy&lt;/code&gt;ï¼‰å†³å®šäº†å†…å­˜æ»¡è½½æ—¶çš„å¤„ç†æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤ç­–ç•¥ &lt;code&gt;volatile-lru&lt;/code&gt;&lt;/strong&gt;ï¼šä»…æ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼Œæœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®ä¸å—å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥ &lt;code&gt;allkeys-lru&lt;/code&gt; æˆ– &lt;code&gt;allkeys-random&lt;/code&gt;&lt;/strong&gt;ï¼šå³ä½¿æœªè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé”®ä¹Ÿå¯èƒ½è¢«åˆ é™¤ä»¥é‡Šæ”¾å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®å»ºè®®&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€ç¡®ä¿æœªè¿‡æœŸé”®ç»å¯¹ä¿ç•™ï¼Œå¯å°† &lt;code&gt;maxmemory-policy&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;noeviction&lt;/code&gt;ï¼ˆç¦æ­¢æ·˜æ±°æ•°æ®ï¼Œå†…å­˜ä¸è¶³æ—¶æ‹’ç»å†™å…¥ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸"&gt;&lt;strong&gt;ä¸ &lt;code&gt;@RedisHash&lt;/code&gt; é…å¥—çš„è¿‡æœŸç®¡ç†æ–¹å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾å¼è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/strong&gt;&lt;br&gt;
åœ¨å®ä½“ç±»ä¸­ç›´æ¥æŒ‡å®š &lt;code&gt;expiration&lt;/code&gt;ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;myEntity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expiration&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3600&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1å°æ—¶åè¿‡æœŸ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è°ƒæ•´è¿‡æœŸæ—¶é—´&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;RedisTemplate&lt;/code&gt; æ‰‹åŠ¨è®¾ç½®æˆ–æ›´æ–°è¿‡æœŸæ—¶é—´ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;expire&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;myEntity:123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ›´æ–°ä¸º60ç§’åè¿‡æœŸ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¨å±€æˆ–åˆ†ç¼“å­˜ç©ºé—´é…ç½®&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;RedisCacheManager&lt;/code&gt; æ‰¹é‡ç®¡ç†ä¸åŒç¼“å­˜ç©ºé—´çš„è¿‡æœŸç­–ç•¥ï¼ˆå¦‚ç”¨æˆ·ç¼“å­˜30åˆ†é’Ÿã€äº§å“ç¼“å­˜2å°æ—¶ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨å»ºè®®-1"&gt;&lt;strong&gt;ä½¿ç”¨å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜ç¡®ä¸šåŠ¡éœ€æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥éœ€è‡ªåŠ¨æ¸…ç†æ•°æ®ï¼ˆå¦‚ä¸´æ—¶ä¼šè¯ï¼‰ï¼Œå¿…é¡»æ˜¾å¼è®¾ç½® &lt;code&gt;expiration&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æ•°æ®éœ€é•¿æœŸä¿ç•™ï¼Œå¯ä¸è®¾ &lt;code&gt;expiration&lt;/code&gt;ï¼Œä½†éœ€ç¡®ä¿ Redis å†…å­˜å……è¶³æˆ–é…ç½®åˆé€‚çš„æ·˜æ±°ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘æ§ä¸ç»´æŠ¤&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šæœŸæ£€æŸ¥æœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®æ•°é‡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;redis-cli --bigkeys&lt;/code&gt; æˆ–ç›‘æ§å·¥å…·åˆ†æå†…å­˜å ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-7"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RedisHash&lt;/code&gt; ä¸è®¾ç½® &lt;code&gt;expiration&lt;/code&gt; æ—¶ï¼Œå¯¹åº”çš„ Redis é”®é»˜è®¤æ°¸ä¸è¿‡æœŸï¼Œä½†å¯èƒ½å› å†…å­˜æ·˜æ±°ç­–ç•¥è¢«åˆ é™¤ã€‚å»ºè®®æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çŸ­æœŸæ•°æ®ï¼šæ˜¾å¼è®¾ç½® &lt;code&gt;expiration&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é•¿æœŸæ•°æ®ï¼šç»“åˆ &lt;code&gt;maxmemory-policy&lt;/code&gt; é…ç½®ï¼Œå¹¶é€šè¿‡ &lt;code&gt;RedisTemplate&lt;/code&gt; æˆ–ç¼“å­˜ç®¡ç†å™¨åŠ¨æ€ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="redis-åˆ†é¡µ"&gt;Redis åˆ†é¡µ
&lt;/h2&gt;&lt;p&gt;Spring Data Redis é»˜è®¤æä¾›çš„ &lt;strong&gt;RedisRepository&lt;/strong&gt; æ¥å£ç»§æ‰¿è‡ª &lt;strong&gt;CrudRepository&lt;/strong&gt;ï¼Œè€Œ &lt;strong&gt;PagingAndSortingRepository&lt;/strong&gt; æ˜¯ Spring Data ä¸­ç”¨äºå…³ç³»å‹æ•°æ®åº“çš„åˆ†é¡µå’Œæ’åºçš„æ‰©å±•æ¥å£ã€‚æ ¹æ®ç°æœ‰çš„ Spring Data Redis è®¾è®¡ï¼Œä»¥ä¸‹æ˜¯å…³é”®ç»“è®ºï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="spring-data-redis-ä¸ç›´æ¥æ”¯æŒ-pagingandsortingrepository"&gt;&lt;strong&gt;Spring Data Redis ä¸ç›´æ¥æ”¯æŒ PagingAndSortingRepository&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼š&lt;br&gt;
Redis æ˜¯é”®å€¼ï¼ˆKey-Valueï¼‰å­˜å‚¨æ•°æ®åº“ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ä¸æ”¯æŒç±»ä¼¼å…³ç³»å‹æ•°æ®åº“çš„ SQL åˆ†é¡µæŸ¥è¯¢è¯­æ³•ï¼ˆå¦‚ &lt;code&gt;LIMIT&lt;/code&gt; å’Œ &lt;code&gt;OFFSET&lt;/code&gt;ï¼‰ã€‚å› æ­¤ï¼ŒSpring Data Redis çš„ &lt;code&gt;RedisRepository&lt;/code&gt; æœªç›´æ¥å®ç° &lt;code&gt;PagingAndSortingRepository&lt;/code&gt; æ¥å£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®˜æ–¹è®¾è®¡&lt;/strong&gt;ï¼š&lt;br&gt;
Redis çš„ &lt;code&gt;Repository&lt;/code&gt; æ¥å£ä¸»è¦é¢å‘å“ˆå¸Œï¼ˆHashï¼‰ç»“æ„æ“ä½œï¼Œæä¾›åŸºäº &lt;code&gt;@Indexed&lt;/code&gt; å­—æ®µçš„ç®€å•æŸ¥è¯¢èƒ½åŠ›ï¼Œä½†æ— æ³•é€šè¿‡åŸç”Ÿ API å®ç°åˆ†é¡µæˆ–æ’åºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ›¿ä»£æ–¹æ¡ˆå®ç°åˆ†é¡µä¸æ’åº"&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆå®ç°åˆ†é¡µä¸æ’åº&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è™½ç„¶æ— æ³•ç›´æ¥ç»§æ‰¿ &lt;code&gt;PagingAndSortingRepository&lt;/code&gt;ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ç±»ä¼¼åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;h4 id="æ–¹æ¡ˆ-1æ‰‹åŠ¨åˆ†é¡µ"&gt;&lt;strong&gt;æ–¹æ¡ˆ 1ï¼šæ‰‹åŠ¨åˆ†é¡µ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åˆ©ç”¨ &lt;code&gt;CrudRepository&lt;/code&gt; çš„æŸ¥è¯¢ç»“æœç»“åˆ Java é›†åˆæ“ä½œå®ç°åˆ†é¡µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Repository&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CrudRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼ˆéœ€ç»“åˆ @Indexed æ³¨è§£ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Iterable&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨ç¤ºä¾‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Iterable&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findByStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;active&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StreamSupport&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;spliterator&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ‰‹åŠ¨åˆ†é¡µï¼ˆå¦‚æ¯é¡µ 10 æ¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageSize&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pages&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Lists&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userList&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageSize&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ–¹æ¡ˆ-2redis-æœ‰åºé›†åˆzset"&gt;&lt;strong&gt;æ–¹æ¡ˆ 2ï¼šRedis æœ‰åºé›†åˆï¼ˆZSETï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ Redis çš„ &lt;code&gt;ZSET&lt;/code&gt; æ•°æ®ç»“æ„å®ç°æ’åºå’Œåˆ†é¡µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å­˜å‚¨æ—¶æ·»åŠ æ’åºå­—æ®µï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Indexed&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Order&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ’åºå­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// ä½¿ç”¨ RedisTemplate æ“ä½œ ZSET&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForZSet&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users:sorted&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForZSet&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;users:sorted&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;startIndex&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;endIndex&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findAllById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ–¹æ¡ˆ-3æ¸¸æ ‡å¼åˆ†é¡µscan-å‘½ä»¤"&gt;&lt;strong&gt;æ–¹æ¡ˆ 3ï¼šæ¸¸æ ‡å¼åˆ†é¡µï¼ˆSCAN å‘½ä»¤ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¯¹ Redis çš„é”®è¿›è¡Œéå†åˆ†é¡µï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;ScanOptions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ScanOptions&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;scanOptions&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¯æ‰¹æ‰«æ 1000 ä¸ªé”®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Cursor&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;scan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hasNext&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;next&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForHash&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageSize&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processBatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†å½“å‰é¡µæ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å¯¹æ¯”-1"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰‹åŠ¨åˆ†é¡µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ç°ç®€å•ï¼Œæ— éœ€é¢å¤–å­˜å‚¨&lt;/td&gt;
&lt;td&gt;æ•°æ®é‡å¤§æ—¶å†…å­˜å‹åŠ›å¤§&lt;/td&gt;
&lt;td&gt;ä¸­å°æ•°æ®é‡æŸ¥è¯¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ZSET æ’åº&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒåŠ¨æ€æ’åºå’Œé«˜æ•ˆèŒƒå›´æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;éœ€ç»´æŠ¤é¢å¤–çš„æœ‰åºé›†åˆ&lt;/td&gt;
&lt;td&gt;éœ€è¦æ’åºçš„åˆ†é¡µåœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¸¸æ ‡åˆ†é¡µ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆè¶…å¤§æ•°æ®é‡&lt;/td&gt;
&lt;td&gt;æ— æ³•ç›´æ¥è·³é¡µï¼Œéœ€é¡ºåºéå†&lt;/td&gt;
&lt;td&gt;æ•°æ®å¯¼å‡ºæˆ–æµå¼å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-8"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Data Redis çš„ &lt;code&gt;Repository&lt;/code&gt; &lt;strong&gt;ä¸æ”¯æŒç›´æ¥ç»§æ‰¿ &lt;code&gt;PagingAndSortingRepository&lt;/code&gt;&lt;/strong&gt;ï¼Œä½†å¯é€šè¿‡æ‰‹åŠ¨åˆ†é¡µã€æœ‰åºé›†åˆæˆ–æ¸¸æ ‡æ‰«æå®ç°ç±»ä¼¼åŠŸèƒ½ã€‚è‹¥éœ€å®Œæ•´çš„åˆ†é¡µå’Œæ’åºæ”¯æŒï¼Œå»ºè®®ç»“åˆå…³ç³»å‹æ•°æ®åº“æˆ– Elasticsearch ç­‰æ”¯æŒå¤æ‚æŸ¥è¯¢çš„å­˜å‚¨æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="æŸ¥è¯¢ååˆ é™¤"&gt;æŸ¥è¯¢ååˆ é™¤
&lt;/h2&gt;&lt;p&gt;åœ¨éœ€è¦å®ç°**â€œæŸ¥è¯¢ååˆ é™¤æ•°æ®â€**çš„åœºæ™¯ä¸­ï¼Œé€‰æ‹© &lt;strong&gt;ZSET&lt;/strong&gt; è¿˜æ˜¯ &lt;strong&gt;æ¸¸æ ‡åˆ†é¡µ&lt;/strong&gt; éœ€æ ¹æ®å…·ä½“éœ€æ±‚æƒè¡¡ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„æ ¸å¿ƒå·®å¼‚åŠé€‚ç”¨åœºæ™¯åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="zsetæœ‰åºé›†åˆçš„é€‚ç”¨åœºæ™¯ä¸ä¼˜ç¼ºç‚¹"&gt;&lt;strong&gt;ZSETï¼ˆæœ‰åºé›†åˆï¼‰çš„é€‚ç”¨åœºæ™¯ä¸ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€‚ç”¨åœºæ™¯-2"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦æ’åºä¸å®æ—¶åˆ†é¡µ&lt;/strong&gt;&lt;br&gt;
ZSET é€šè¿‡ &lt;code&gt;score&lt;/code&gt; æ’åºï¼ˆå¦‚æ—¶é—´æˆ³ã€çƒ­åº¦å€¼ï¼‰ï¼Œæ”¯æŒ &lt;code&gt;ZRANGE&lt;/code&gt;ã€&lt;code&gt;ZREVRANGE&lt;/code&gt; ç­‰å‘½ä»¤é«˜æ•ˆè·å–åˆ†é¡µæ•°æ®ã€‚é€‚åˆæ’è¡Œæ¦œã€æŒ‰æ—¶é—´çº¿å±•ç¤ºçš„åŠ¨æ€åˆ—è¡¨ï¼ˆå¦‚å¾®åšçƒ­æ¦œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æŸ¥è¯¢ä¸åˆ é™¤&lt;/strong&gt;&lt;br&gt;
ZSET çš„ &lt;code&gt;ZREM&lt;/code&gt; å‘½ä»¤æ—¶é—´å¤æ‚åº¦ä¸º O(logN)ï¼Œé€‚åˆé¢‘ç¹åˆ é™¤å•ä¸ªå…ƒç´ çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·é¢†å–å¥–åŠ±ååˆ é™¤è®°å½•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å‹æ•°æ®ç®¡ç†&lt;/strong&gt;&lt;br&gt;
æ•°æ®å®Œå…¨å­˜å‚¨åœ¨ Redis å†…å­˜ä¸­ï¼Œé¿å…é¢‘ç¹è®¿é—®æ•°æ®åº“ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ä¼˜ç‚¹"&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½é«˜æ•ˆ&lt;/strong&gt;ï¼šæŸ¥è¯¢å’Œåˆ é™¤æ“ä½œå‡åŸºäºè·³è¡¨ç»“æ„ï¼Œæ€§èƒ½ç¨³å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå­æ€§æ“ä½œ&lt;/strong&gt;ï¼šé€šè¿‡ Lua è„šæœ¬æˆ–äº‹åŠ¡å¯ç¡®ä¿æŸ¥è¯¢ä¸åˆ é™¤çš„åŸå­æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ’åº&lt;/strong&gt;ï¼šæ”¯æŒæŒ‰ &lt;code&gt;score&lt;/code&gt; èŒƒå›´åˆ†é¡µï¼Œé€‚åˆåŠ¨æ€æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç¼ºç‚¹"&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å‹åŠ›&lt;/strong&gt;ï¼šæ•°æ®å…¨é‡å­˜å‚¨åœ¨å†…å­˜ï¼Œè¶…å¤§æ•°æ®é›†å¯èƒ½å¯¼è‡´ OOMã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ é™¤åå†…å­˜å›æ”¶å»¶è¿Ÿ&lt;/strong&gt;ï¼šZSET åˆ é™¤å…ƒç´ åå†…å­˜ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œéœ€ç»“åˆ &lt;code&gt;EXPIRE&lt;/code&gt; æˆ–å®šæœŸæ¸…ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•è·³é¡µ&lt;/strong&gt;ï¼šä»…æ”¯æŒé¡ºåºåˆ†é¡µï¼Œæ— æ³•ç›´æ¥è·³è½¬è‡³æŒ‡å®šé¡µç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ¸¸æ ‡åˆ†é¡µçš„é€‚ç”¨åœºæ™¯ä¸ä¼˜ç¼ºç‚¹"&gt;&lt;strong&gt;æ¸¸æ ‡åˆ†é¡µçš„é€‚ç”¨åœºæ™¯ä¸ä¼˜ç¼ºç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€‚ç”¨åœºæ™¯-3"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¤§æ•°æ®é›†ä¸ç¨³å®šæ€§éœ€æ±‚&lt;/strong&gt;&lt;br&gt;
æ¸¸æ ‡åˆ†é¡µé€šè¿‡è®°å½•å½“å‰æ•°æ®ä½ç½®ï¼ˆå¦‚æœ€åä¸€æ¡è®°å½•çš„ ID æˆ–æ—¶é—´æˆ³ï¼‰å®ç°åˆ†é¡µï¼Œé€‚åˆå¤„ç†ç™¾ä¸‡çº§ä»¥ä¸Šçš„æ•°æ®é›†ï¼ˆå¦‚æ—¥å¿—å¯¼å‡ºã€å†å²è®¢å•æ¸…ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ•°æ®ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
æ•°æ®å¯èƒ½å®æ—¶å˜åŠ¨ï¼ˆå¦‚æ’å…¥æˆ–åˆ é™¤ï¼‰ï¼Œæ¸¸æ ‡åˆ†é¡µé¿å…ä¼ ç»Ÿåˆ†é¡µå› åç§»é‡å˜åŒ–å¯¼è‡´çš„æ•°æ®é‡å¤æˆ–é—æ¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“åŸç”Ÿæ”¯æŒ&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äºå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰æˆ– MongoDBï¼Œé€šè¿‡æ¸¸æ ‡é€è¡Œéå†å¹¶åˆ é™¤æ•°æ®ï¼Œå‡å°‘äº‹åŠ¡å†²çªã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ä¼˜ç‚¹-1"&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½å†…å­˜æ¶ˆè€—&lt;/strong&gt;ï¼šä»…åŠ è½½å½“å‰é¡µæ•°æ®ï¼Œé€‚åˆå¤„ç†æµ·é‡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ•°æ®å…¼å®¹æ€§&lt;/strong&gt;ï¼šæ•°æ®å¢åˆ ä¸å½±å“åˆ†é¡µç»“æœä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ”¯æŒ&lt;/strong&gt;ï¼šç»“åˆæ•°æ®åº“äº‹åŠ¡ï¼Œç¡®ä¿æŸ¥è¯¢ä¸åˆ é™¤çš„åŸå­æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç¼ºç‚¹-1"&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åº¦é«˜&lt;/strong&gt;ï¼šéœ€ç»´æŠ¤æ¸¸æ ‡çŠ¶æ€ï¼ˆå¦‚ &lt;code&gt;next_cursor&lt;/code&gt;ã€&lt;code&gt;prev_cursor&lt;/code&gt;ï¼‰ï¼Œå‰åç«¯åä½œæˆæœ¬è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¾èµ–ç´¢å¼•&lt;/strong&gt;ï¼šè‹¥æœªå¯¹æ¸¸æ ‡å­—æ®µï¼ˆå¦‚ IDã€æ—¶é—´æˆ³ï¼‰å»ºç«‹ç´¢å¼•ï¼Œåˆ†é¡µæ•ˆç‡å¯èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•åå‘éå†&lt;/strong&gt;ï¼šéƒ¨åˆ†å®ç°ä»…æ”¯æŒå•å‘åˆ†é¡µï¼ˆå¦‚ä»…â€œä¸‹ä¸€é¡µâ€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å†³ç­–å»ºè®®"&gt;&lt;strong&gt;å†³ç­–å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é€‰æ‹©-zset-çš„æƒ…å†µ"&gt;&lt;strong&gt;é€‰æ‹© ZSET çš„æƒ…å†µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ•°æ®é‡é€‚ä¸­ï¼ˆå¦‚ 10 ä¸‡çº§ä»¥å†…ï¼‰ã€éœ€å®æ—¶æ’åºã€é«˜é¢‘åˆ é™¤å•ä¸ªå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·ä»»åŠ¡é˜Ÿåˆ—ï¼šæŸ¥è¯¢æœªå®Œæˆä»»åŠ¡å¹¶åˆ é™¤å·²å®Œæˆé¡¹ï¼›&lt;/li&gt;
&lt;li&gt;é™æ—¶æ´»åŠ¨èµ„æ ¼æ± ï¼šæŒ‰æ—¶é—´æ’åºå‘æ”¾èµ„æ ¼ååˆ é™¤è®°å½•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‰æ‹©æ¸¸æ ‡åˆ†é¡µçš„æƒ…å†µ"&gt;&lt;strong&gt;é€‰æ‹©æ¸¸æ ‡åˆ†é¡µçš„æƒ…å†µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šæ•°æ®é‡æå¤§ï¼ˆç™¾ä¸‡çº§ä»¥ä¸Šï¼‰ã€éœ€äº‹åŠ¡æ”¯æŒã€æ•°æ®åŠ¨æ€æ€§å¼ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;æ¸…ç†å†å²æ—¥å¿—ï¼šåˆ†é¡µæŸ¥è¯¢è¿‡æœŸæ—¥å¿—å¹¶æ‰¹é‡åˆ é™¤ï¼›&lt;/li&gt;
&lt;li&gt;è¿ç§»æ•°æ®åº“ï¼šåˆ†é¡µè¯»å–æ•°æ®å¹¶å†™å…¥æ–°åº“ååˆ é™¤åŸæ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ··åˆæ–¹æ¡ˆ"&gt;&lt;strong&gt;æ··åˆæ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ZSET + æ¸¸æ ‡&lt;/strong&gt;ï¼šç”¨ ZSET ç»´æŠ¤æ’åºå’Œåˆ†é¡µï¼Œç”¨æ•°æ®åº“æ¸¸æ ‡å¤„ç†æ‰¹é‡åˆ é™¤ï¼ˆå¦‚æ¯æ—¥å‡Œæ™¨æ¸…ç† ZSET ä¸­è¿‡æœŸæ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–æŠ€å·§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸º ZSET è®¾ç½® TTLï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Redis Cluster åˆ†ç‰‡å­˜å‚¨è¶…å¤§æ•°æ®é›†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”-1"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç»´åº¦&lt;/th&gt;
&lt;th&gt;ZSET&lt;/th&gt;
&lt;th&gt;æ¸¸æ ‡åˆ†é¡µ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥è¯¢é€Ÿåº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¿«ï¼ˆO(logN)ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆä¾èµ–ç´¢å¼•ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åˆ é™¤æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå•æ¡ O(logN)ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆæ‰¹é‡æ›´ä¼˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†…å­˜å ç”¨&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå…¨é‡å­˜å‚¨ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€é¢å¤–äº‹åŠ¡/Lua è„šæœ¬&lt;/td&gt;
&lt;td&gt;åŸç”Ÿæ”¯æŒäº‹åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨æ•°æ®è§„æ¨¡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­å°è§„æ¨¡ï¼ˆå†…å­˜å¯æ§ï¼‰&lt;/td&gt;
&lt;td&gt;è¶…å¤§è§„æ¨¡ï¼ˆç£ç›˜+å†…å­˜ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-9"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆ ZSET&lt;/strong&gt;ï¼šè‹¥åœºæ™¯å¼ºè°ƒæ’åºã€å®æ—¶æ€§ï¼Œä¸”æ•°æ®é‡å¯æ§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆæ¸¸æ ‡åˆ†é¡µ&lt;/strong&gt;ï¼šè‹¥æ•°æ®é‡æå¤§ã€éœ€äº‹åŠ¡æ”¯æŒï¼Œæˆ–åˆ é™¤æ“ä½œéœ€æ‰¹é‡å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ–¹æ¡ˆ&lt;/strong&gt;ï¼šç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼Œå¦‚ç”¨ ZSET åšå®æ—¶åˆ†é¡µï¼Œç”¨æ¸¸æ ‡åˆ†é¡µåšå¼‚æ­¥æ¸…ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ‰¹é‡åˆ é™¤"&gt;æ‰¹é‡åˆ é™¤
&lt;/h2&gt;&lt;h3 id="æ¸¸æ ‡éå†ä¸­æ‰¹é‡åˆ é™¤æ˜¯å¦å¹²æ‰°æ¸¸æ ‡çš„è¿ä½œ"&gt;æ¸¸æ ‡éå†ä¸­æ‰¹é‡åˆ é™¤æ˜¯å¦å¹²æ‰°æ¸¸æ ‡çš„è¿ä½œ
&lt;/h3&gt;&lt;p&gt;åœ¨ Redis çš„ &lt;code&gt;SCAN&lt;/code&gt; æ¸¸æ ‡æœºåˆ¶ä¸­ï¼Œ&lt;strong&gt;åˆ é™¤å·²éå†çš„é”®ä¸ä¼šå¹²æ‰°å½“å‰æ¸¸æ ‡çš„è¿ä½œ&lt;/strong&gt;ã€‚Redis çš„ &lt;code&gt;SCAN&lt;/code&gt; å‘½ä»¤åŸºäºå“ˆå¸Œæ§½ï¼ˆhash slotï¼‰çš„è¿­ä»£ç®—æ³•ï¼Œæ¯æ¬¡è¿”å›çš„æ¸¸æ ‡æ˜¯ä¸€ä¸ªå“ˆå¸Œæ§½çš„ç´¢å¼•ä½ç½®ï¼Œè€Œä¸æ˜¯æ•°æ®å¿«ç…§ã€‚å› æ­¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å·²éå†çš„é”®è¢«åˆ é™¤ä¸å½±å“åç»­è¿­ä»£&lt;/strong&gt;ï¼šæ¸¸æ ‡è®°å½•çš„æ˜¯å½“å‰éå†çš„å“ˆå¸Œæ§½ä½ç½®ï¼Œå³ä½¿å·²éå†çš„é”®è¢«åˆ é™¤ï¼Œæ¸¸æ ‡ä»ä¼šç»§ç»­å‘åç§»åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœªéå†çš„é”®è¢«åˆ é™¤å¯èƒ½å¯¼è‡´æ•°æ®é—æ¼&lt;/strong&gt;ï¼šå¦‚æœåˆ é™¤çš„é”®ä½äºæ¸¸æ ‡å°šæœªåˆ°è¾¾çš„å“ˆå¸Œæ§½ï¼Œå¯èƒ½å¯¼è‡´åç»­éå†ä¸­æ— æ³•è¯»å–åˆ°è¿™äº›é”®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨ä»£ç ä¸­é€šè¿‡ &lt;code&gt;cursor.next()&lt;/code&gt; è·å–é”®åç«‹å³åˆ é™¤æ˜¯å®‰å…¨çš„ï¼Œä½†éœ€æ³¨æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ”¹è¿›å»ºè®®ï¼šç›´æ¥æ”¶é›†é”®åè€Œéç”¨æˆ·å¯¹è±¡ï¼Œæ‰¹é‡åˆ é™¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keysToDelete&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hasNext&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;next&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†ç”¨æˆ·æ•°æ®...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keysToDelete&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keysToDelete&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageSize&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processBatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keysToDelete&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰¹é‡åˆ é™¤é”®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keysToDelete&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="spring-data-redis-çš„æ‰¹é‡åˆ é™¤å®ç°"&gt;Spring Data Redis çš„æ‰¹é‡åˆ é™¤å®ç°
&lt;/h3&gt;&lt;p&gt;Spring Data Redis æä¾›äº†å¤šç§æ‰¹é‡åˆ é™¤æ–¹å¼ï¼Œå…·ä½“é€‰æ‹©éœ€ç»“åˆæ•°æ®é‡å’Œæ€§èƒ½è¦æ±‚ï¼š&lt;/p&gt;
&lt;h4 id="åŸºäº"&gt;&lt;strong&gt;åŸºäº &lt;code&gt;RedisTemplate&lt;/code&gt; çš„æ‰¹é‡åˆ é™¤&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç›´æ¥é€šè¿‡é”®é›†åˆæ‰¹é‡åˆ é™¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isEmpty&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šä»£ç ç®€å•ï¼Œé€‚åˆå°è§„æ¨¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;code&gt;keys&lt;/code&gt; å‘½ä»¤ä¼šé˜»å¡ Redis ä¸»çº¿ç¨‹ï¼Œå¤§æ•°æ®é‡æ—¶å¯èƒ½å¼•å‘æ€§èƒ½é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åŸºäº-1"&gt;&lt;strong&gt;åŸºäº &lt;code&gt;SCAN&lt;/code&gt; çš„åˆ†æ‰¹åˆ é™¤ï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;ScanOptions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ScanOptions&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;scanOptions&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:*&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Cursor&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;scan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchKeys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hasNext&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;next&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchKeys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchKeys&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchKeys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;batchKeys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isEmpty&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batchKeys&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šéé˜»å¡ï¼Œé€‚åˆå¤§æ•°æ®é‡åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šéœ€æ‰‹åŠ¨ç®¡ç†æ¸¸æ ‡å’Œå†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä½¿ç”¨-lua-è„šæœ¬åŸå­åŒ–åˆ é™¤"&gt;&lt;strong&gt;ä½¿ç”¨ Lua è„šæœ¬åŸå­åŒ–åˆ é™¤&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;local keys = redis.call(&amp;#39;KEYS&amp;#39;, ARGV[1]) &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;for _, key in ipairs(keys) do &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; redis.call(&amp;#39;DEL&amp;#39;, key) &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;end &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;return #keys&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RedisScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Collections&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;emptyList&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:*&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå‡å°‘ç½‘ç»œå¼€é”€ï¼ŒåŸå­æ€§æ“ä½œã€‚
ç¼ºç‚¹**ï¼š&lt;code&gt;KEYS&lt;/code&gt; å‘½ä»¤ä»ä¼šé˜»å¡ Redisã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="redis-æ˜¯å¦æ”¯æŒæŸ¥è¯¢åè‡ªåŠ¨åˆ é™¤"&gt;Redis æ˜¯å¦æ”¯æŒâ€œæŸ¥è¯¢åè‡ªåŠ¨åˆ é™¤â€ï¼Ÿ
&lt;/h3&gt;&lt;p&gt;Redis &lt;strong&gt;ä¸ç›´æ¥æ”¯æŒæŸ¥è¯¢åè‡ªåŠ¨åˆ é™¤&lt;/strong&gt;ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ç±»ä¼¼æ•ˆæœï¼š&lt;/p&gt;
&lt;h4 id="ç»“åˆ-1"&gt;&lt;strong&gt;ç»“åˆ &lt;code&gt;EXPIRE&lt;/code&gt; å’Œæƒ°æ€§åˆ é™¤&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼Œä¾èµ– Redis çš„å®šæœŸ/æƒ°æ€§åˆ é™¤æœºåˆ¶ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;expire&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TimeUnit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SECONDS&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 60ç§’åè‡ªåŠ¨è¿‡æœŸ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä¸´æ—¶ç¼“å­˜æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="äº‹åŠ¡æˆ–-pipeline-ç»„åˆæ“ä½œ"&gt;&lt;strong&gt;äº‹åŠ¡æˆ– Pipeline ç»„åˆæ“ä½œ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨æŸ¥è¯¢åæ˜¾å¼åˆ é™¤æ•°æ®java
redisTemplate.executePipelined((RedisCallback&lt;Object&gt;) connection -&amp;gt; {
for (String key : keysToDelete) {
connection.del(key.getBytes());
}
return null;
});&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;- **ä¼˜ç‚¹**ï¼šå‡å°‘ç½‘ç»œå¾€è¿”æ—¶é—´ï¼Œæå‡æ€§èƒ½ã€‚
#### **è‡ªå®šä¹‰ Lua è„šæœ¬**
é€šè¿‡è„šæœ¬å®ç°æŸ¥è¯¢+åˆ é™¤çš„åŸå­æ“ä½œï¼š
```lua
-- æŸ¥è¯¢å¹¶åˆ é™¤åŒ¹é…çš„é”®
local keys = redis.call(&amp;#39;KEYS&amp;#39;, &amp;#39;user:*&amp;#39;)
for _, key in ipairs(keys) do
redis.call(&amp;#39;DEL&amp;#39;, key)
end
return keys
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸å»ºè®®"&gt;æ€»ç»“ä¸å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ¨èæ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;æ³¨æ„äº‹é¡¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å°æ•°æ®é‡åˆ é™¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;RedisTemplate.delete(keys)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¿å…åœ¨é«˜å³°æ—¶æ®µä½¿ç”¨ &lt;code&gt;KEYS&lt;/code&gt; å‘½ä»¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¤§æ•°æ®é‡åˆ é™¤&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SCAN&lt;/code&gt; + åˆ†æ‰¹åˆ é™¤&lt;/td&gt;
&lt;td&gt;æ§åˆ¶æ¯æ‰¹åˆ é™¤çš„é”®æ•°é‡ï¼ˆå¦‚1000ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åŸå­æ€§è¦æ±‚é«˜&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Lua è„šæœ¬&lt;/td&gt;
&lt;td&gt;é¿å…åœ¨è„šæœ¬ä¸­ä½¿ç”¨é˜»å¡å‘½ä»¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è‡ªåŠ¨è¿‡æœŸéœ€æ±‚&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;EXPIRE&lt;/code&gt; + æƒ°æ€§åˆ é™¤&lt;/td&gt;
&lt;td&gt;å®šæœŸæ£€æŸ¥è¿‡æœŸç­–ç•¥æ˜¯å¦ç”Ÿæ•ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å»ºè®®ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;SCAN&lt;/code&gt; åˆ†æ‰¹åˆ é™¤ï¼Œå¹¶åœ¨éé«˜å³°æ—¶æ®µæ‰§è¡Œå¤§è§„æ¨¡æ¸…ç†æ“ä½œã€‚è‹¥éœ€æŸ¥è¯¢åç«‹å³åˆ é™¤ï¼Œéœ€æ˜¾å¼è°ƒç”¨åˆ é™¤é€»è¾‘ï¼Œè€Œéä¾èµ– Redis çš„è‡ªåŠ¨æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id="æ‰¹é‡æŸ¥è¯¢"&gt;æ‰¹é‡æŸ¥è¯¢
&lt;/h2&gt;&lt;p&gt;åœ¨ Redis ä¸­é€šè¿‡ &lt;code&gt;HGET&lt;/code&gt; æˆ– &lt;code&gt;opsForHash().get()&lt;/code&gt; é€ä¸ªæŸ¥è¯¢é”®å€¼å¯¹ä¼šå¯¹æ€§èƒ½äº§ç”Ÿæ˜¾è‘—å½±å“ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æåŠä¼˜åŒ–å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€ä¸ªæŸ¥è¯¢çš„æ€§èƒ½é—®é¢˜"&gt;é€ä¸ªæŸ¥è¯¢çš„æ€§èƒ½é—®é¢˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œå¼€é”€&lt;/strong&gt;&lt;br&gt;
æ¯ä¸ª &lt;code&gt;opsForHash().get()&lt;/code&gt; æ“ä½œéƒ½ä¼šè§¦å‘ä¸€æ¬¡ &lt;strong&gt;ç‹¬ç«‹çš„ TCP è¯·æ±‚-å“åº”&lt;/strong&gt;ï¼Œå½“å¤„ç†ä¸Šåƒä¸ªé”®æ—¶ï¼Œç½‘ç»œå»¶è¿Ÿï¼ˆRTTï¼‰ä¼šæˆä¸ºç“¶é¢ˆã€‚ä¾‹å¦‚ï¼Œå‡è®¾å•æ¬¡ RTT ä¸º 1msï¼Œ1000 æ¬¡æŸ¥è¯¢éœ€è¦çº¦ 1 ç§’çš„ç½‘ç»œè€—æ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Redis å•çº¿ç¨‹ç“¶é¢ˆ&lt;/strong&gt;&lt;br&gt;
Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚ä¼šå¯¼è‡´å‘½ä»¤æ’é˜Ÿï¼Œå¢åŠ æœåŠ¡ç«¯å¤„ç†æ—¶é—´ã€‚å³ä½¿å®¢æˆ·ç«¯å¼‚æ­¥å‘é€è¯·æ±‚ï¼Œä¹Ÿå¯èƒ½å› çº¿ç¨‹é˜»å¡å½±å“æ•´ä½“ååé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯èµ„æºæ¶ˆè€—&lt;/strong&gt;&lt;br&gt;
é¢‘ç¹çš„ I/O æ“ä½œä¼šå ç”¨å®¢æˆ·ç«¯ CPU å’Œå†…å­˜èµ„æºï¼Œé™ä½ç¨‹åºæ•ˆç‡ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯èƒ½å¯¼è‡´å®¢æˆ·ç«¯çº¿ç¨‹æ± æ»¡è½½æˆ– OOMã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–æ–¹æ¡ˆ"&gt;ä¼˜åŒ–æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢å‘½ä»¤"&gt;&lt;strong&gt;ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢å‘½ä»¤&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Redis æä¾› &lt;code&gt;HMGET&lt;/code&gt; å‘½ä»¤æ”¯æŒä¸€æ¬¡æ€§è·å–å¤šä¸ªå­—æ®µå€¼ï¼Œç»“åˆ &lt;code&gt;SCAN&lt;/code&gt; çš„åˆ†æ‰¹é”®åæ”¶é›†ï¼Œå¯æ˜¾è‘—å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hasNext&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;next&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RedisCallback&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hMGet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="o"&gt;][]&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processBatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå•æ¬¡ç½‘ç»œè¯·æ±‚è·å–å¤šä¸ªæ•°æ®ï¼Œé™ä½ RTT å½±å“ã€‚&lt;/p&gt;
&lt;h4 id="pipeline-ç®¡é“æŠ€æœ¯"&gt;&lt;strong&gt;Pipeline ç®¡é“æŠ€æœ¯&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…å‘é€ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchUsers&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executePipelined&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;RedisCallback&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Void&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hasNext&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;next&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hGet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†æ‰¹é‡ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé€‚åˆéœ€è¦åŸå­æ€§ä½†æ— éœ€äº‹åŠ¡çš„æ‰¹é‡æ“ä½œã€‚&lt;/p&gt;
&lt;h4 id="lua-è„šæœ¬æ‰¹é‡å¤„ç†"&gt;&lt;strong&gt;Lua è„šæœ¬æ‰¹é‡å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ Redis æœåŠ¡ç«¯æ‰§è¡Œè„šæœ¬ï¼Œé¿å…å¤šæ¬¡ç½‘ç»œé€šä¿¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-lua" data-lang="lua"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;redis.call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SCAN&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;MATCH&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user:*&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;COUNT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;for&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="kr"&gt;in&lt;/span&gt; &lt;span class="n"&gt;ipairs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;redis.call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;HGET&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šåŸå­æ€§æ‰§è¡Œï¼Œå‡å°‘å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯äº¤äº’ã€‚&lt;/p&gt;
&lt;h4 id="æ•°æ®ç»“æ„ä¼˜åŒ–"&gt;&lt;strong&gt;æ•°æ®ç»“æ„ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡å­˜å‚¨&lt;/strong&gt;ï¼šå°†å¤§ Hash æ‹†åˆ†ä¸ºå¤šä¸ªå° Hashï¼ˆå¦‚æŒ‰ç”¨æˆ· ID åˆ†ç‰‡ï¼‰ï¼Œå‡å°‘å•æ¬¡æ“ä½œçš„æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ Ziplist ç¼–ç &lt;/strong&gt;ï¼šé€šè¿‡è°ƒæ•´ &lt;code&gt;hash-max-ziplist-entries&lt;/code&gt; å’Œ &lt;code&gt;hash-max-ziplist-value&lt;/code&gt; å‚æ•°ï¼Œä½¿å°è§„æ¨¡ Hash ä»¥å‹ç¼©æ ¼å¼å­˜å‚¨ï¼Œé™ä½å†…å­˜å ç”¨å¹¶æå‡æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”-2"&gt;æ€§èƒ½å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;ç½‘ç»œè¯·æ±‚æ¬¡æ•°&lt;/th&gt;
&lt;th&gt;æœåŠ¡ç«¯è´Ÿè½½&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€ä¸ªæŸ¥è¯¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆO(N)ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;æä½é¢‘ç‡æŸ¥è¯¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰¹é‡ HMGET&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆO(N/B)ï¼‰&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;å›ºå®šæ‰¹æ¬¡å¤§å°æŸ¥è¯¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Pipeline&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;é«˜ååé‡å¼‚æ­¥å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Lua è„šæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;åŸå­æ€§æ‰¹é‡æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-10"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é€ä¸ªæŸ¥è¯¢ Hash æ•°æ®ä¼šå¯¼è‡´&lt;strong&gt;ç½‘ç»œå¼€é”€æ¿€å¢&lt;/strong&gt;å’Œ&lt;strong&gt;æœåŠ¡ç«¯æ€§èƒ½ä¸‹é™&lt;/strong&gt;ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶ã€‚æ¨èä»¥ä¸‹ä¼˜åŒ–ä¼˜å…ˆçº§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨æ‰¹é‡å‘½ä»¤ï¼ˆHMGETï¼‰æˆ– Pipeline&lt;/strong&gt; å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹è¶…å¤§æ•°æ®é›†é‡‡ç”¨åˆ†ç‰‡å­˜å‚¨&lt;/strong&gt;ï¼Œç»“åˆ Ziplist ç¼–ç ä¼˜åŒ–å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹åŸå­æ€§è¦æ±‚é«˜çš„åœºæ™¯ä½¿ç”¨ Lua è„šæœ¬&lt;/strong&gt;ï¼Œé¿å…ä¸­é—´çŠ¶æ€ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°ä¼˜åŒ–ï¼Œå¯æ˜¾è‘—é™ä½å»¶è¿Ÿå¹¶æå‡ç³»ç»Ÿååé‡ã€‚å®é™…åº”ç”¨ä¸­éœ€ç»“åˆä¸šåŠ¡åœºæ™¯å’Œæ•°æ®è§„æ¨¡é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="redishash-æ‰¹é‡æŸ¥è¯¢"&gt;@RedisHash æ‰¹é‡æŸ¥è¯¢
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Redis ä¸­ï¼Œæ‰¹é‡æŸ¥è¯¢ä½¿ç”¨ &lt;code&gt;@RedisHash&lt;/code&gt; æ³¨è§£çš„å®ä½“æ—¶ï¼Œéœ€ç»“åˆ Redis çš„ Hash æ•°æ®ç»“æ„å’Œ Spring æä¾›çš„å·¥å…·ç±»å®ç°é«˜æ•ˆæ“ä½œã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆåŠä¼˜åŒ–å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="redishash-å®ä½“å­˜å‚¨æœºåˆ¶"&gt;&lt;code&gt;@RedisHash&lt;/code&gt; å®ä½“å­˜å‚¨æœºåˆ¶
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@RedisHash&lt;/code&gt; æ³¨è§£ç”¨äºå°† Java å¯¹è±¡æ˜ å°„åˆ° Redis çš„ Hash ç»“æ„ä¸­ï¼Œé»˜è®¤é”®æ ¼å¼ä¸º &lt;code&gt;{prefix}:{id}&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;user:1&lt;/code&gt;ï¼‰ï¼Œå­—æ®µå¯¹åº”å®ä½“å±æ€§ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RedisHash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼ŒRedis ä¸­å­˜å‚¨çš„é”®ä¸º &lt;code&gt;user:{id}&lt;/code&gt;ï¼Œå­—æ®µä¸º &lt;code&gt;name&lt;/code&gt; å’Œ &lt;code&gt;age&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ‰¹é‡æŸ¥è¯¢å®ç°æ–¹æ¡ˆ"&gt;æ‰¹é‡æŸ¥è¯¢å®ç°æ–¹æ¡ˆ
&lt;/h3&gt;&lt;h4 id="åŸºäº-2"&gt;&lt;strong&gt;åŸºäº &lt;code&gt;RedisTemplate&lt;/code&gt; çš„æ‰¹é‡æŸ¥è¯¢&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;opsForHash().multiGet()&lt;/code&gt; æ–¹æ³•æ‰¹é‡è·å–å¤šä¸ªå®ä½“ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ”¶é›†æ‰€æœ‰å®ä½“ ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3L&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ˆå¯¹åº”å®ä½“å±æ€§ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForHash&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;multiGet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Collections&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;singletonList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€æ‰‹åŠ¨æ‹¼æ¥é”®åï¼ˆå¦‚ &lt;code&gt;user:1&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ–¹æ³•é€‚ç”¨äºå•ä¸ª Hash é”®å†…å¤šä¸ªå­—æ®µçš„æ‰¹é‡æŸ¥è¯¢ï¼Œä¸ç›´æ¥æ”¯æŒè·¨é”®æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä½¿ç”¨-pipeline-æ‰¹é‡æŸ¥è¯¢è·¨é”®å®ä½“"&gt;&lt;strong&gt;ä½¿ç”¨ Pipeline æ‰¹é‡æŸ¥è¯¢è·¨é”®å®ä½“&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ Pipeline å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ï¼Œé«˜æ•ˆè·å–å¤šä¸ªé”®çš„å®Œæ•´ Hash æ•°æ®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executePipelined&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;RedisCallback&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hGetAll&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•æ¬¡ç½‘ç»œè¯·æ±‚è·å–å¤šä¸ªå®ä½“çš„å…¨éƒ¨å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;ç»“æœè‡ªåŠ¨ååºåˆ—åŒ–ä¸º &lt;code&gt;User&lt;/code&gt; å¯¹è±¡ï¼ˆéœ€é…ç½®åºåˆ—åŒ–å™¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®-1"&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;æ€§èƒ½ç‰¹ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Pipeline&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è·¨é”®æŸ¥è¯¢å…¨éƒ¨å­—æ®µ&lt;/td&gt;
&lt;td&gt;ç½‘ç»œå¼€é”€ä½ï¼Œååé‡é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;multiGet&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•é”®å¤šå­—æ®µæŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;ä»£ç ç®€å•ï¼Œé€‚åˆå°è§„æ¨¡æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Lua è„šæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸå­æ€§æ‰¹é‡æ“ä½œ&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç«¯æ‰§è¡Œï¼Œé¿å…ç½‘ç»œå»¶è¿Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="ä¼˜åŒ–æ–¹å‘"&gt;ä¼˜åŒ–æ–¹å‘ï¼š
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é”®åé¢„ç”Ÿæˆ&lt;/strong&gt;&lt;br&gt;
æå‰æ”¶é›†æ‰€æœ‰å®ä½“é”®åï¼ˆå¦‚ &lt;code&gt;user:1&lt;/code&gt;ã€&lt;code&gt;user:2&lt;/code&gt;ï¼‰ï¼Œé¿å…åœ¨å¾ªç¯ä¸­æ‹¼æ¥å­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µæŠ•å½±&lt;/strong&gt;&lt;br&gt;
ä»…æŸ¥è¯¢å¿…è¦å­—æ®µï¼ˆå¦‚ &lt;code&gt;name&lt;/code&gt;ï¼‰ï¼Œå‡å°‘æ•°æ®ä¼ è¾“é‡ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForHash&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;multiGet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†é¡µå¤„ç†&lt;/strong&gt;&lt;br&gt;
å¯¹å¤§è§„æ¨¡æ•°æ®åˆ†æ‰¹æŸ¥è¯¢ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Lists&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;batches&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;processBatch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹ä»£ç "&gt;ç¤ºä¾‹ä»£ç 
&lt;/h3&gt;&lt;h4 id="æ‰¹é‡è·å–å¤šä¸ªå®ä½“çš„å…¨éƒ¨å±æ€§pipeline"&gt;æ‰¹é‡è·å–å¤šä¸ªå®ä½“çš„å…¨éƒ¨å±æ€§ï¼ˆPipelineï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executePipelined&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;RedisCallback&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hGetAll&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ‰¹é‡è·å–æŒ‡å®šå­—æ®µmultiget"&gt;æ‰¹é‡è·å–æŒ‡å®šå­—æ®µï¼ˆmultiGetï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;age&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;userIds&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;opsForHash&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;multiGet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user:&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-11"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© Pipeline&lt;/strong&gt;ï¼šé€‚ç”¨äºè·¨é”®æ‰¹é‡æŸ¥è¯¢ï¼Œæ€§èƒ½æœ€ä¼˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–æŸ¥è¯¢èŒƒå›´&lt;/strong&gt;ï¼šé€šè¿‡å­—æ®µæŠ•å½±å’Œåˆ†é¡µå‡å°‘æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆä¸šåŠ¡å°è£…&lt;/strong&gt;ï¼šé€šè¿‡è‡ªå®šä¹‰ Repository æˆ– Service å±‚ç»Ÿä¸€ç®¡ç†æŸ¥è¯¢é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©æ‰¹é‡æŸ¥è¯¢ç­–ç•¥ï¼Œå¯æ˜¾è‘—æå‡ &lt;code&gt;@RedisHash&lt;/code&gt; å®ä½“çš„æ“ä½œæ•ˆç‡ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘æˆ–å¤§æ•°æ®é‡åœºæ™¯ä¸‹è¡¨ç°æ›´ä¼˜ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 10</title><link>https://dyhes.github.io/p/postopia-dev-logweek-10/</link><pubDate>Mon, 14 Apr 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-10/</guid><description>&lt;p&gt;todo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœç´¢&lt;/li&gt;
&lt;li&gt;æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ”¹é€ &lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªï¼Œæ—¥å¿—åˆ†æ&lt;/li&gt;
&lt;li&gt;è¯­ä¹‰æœç´¢&lt;/li&gt;
&lt;li&gt;æ¨é€
&lt;ul&gt;
&lt;li&gt;AI å–œå¥½åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ optimize
&lt;ul&gt;
&lt;li&gt;search after æ”¹é€ &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°åŠŸèƒ½
&lt;ul&gt;
&lt;li&gt;Edit comment&lt;/li&gt;
&lt;li&gt;Pin comment&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="elasticsearch"&gt;ElasticSearch
&lt;/h2&gt;&lt;p&gt;docker-compose.yaml&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;elasticsearch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;bitnami/elasticsearch:latest&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;container_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;postopia-elasticsearch&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;discovery.type=single-node&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;xpack.security.enabled=false&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;9200:9200&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;9300:9300&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="spring-elastic-search"&gt;Spring Elastic Search
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Boot é¡¹ç›®ä¸­é€‰æ‹© &lt;strong&gt;Spring Data Elasticsearch&lt;/strong&gt; è¿˜æ˜¯ &lt;strong&gt;High Level REST Client&lt;/strong&gt;ï¼Œéœ€æ ¹æ®å…·ä½“éœ€æ±‚ã€å¼€å‘æ•ˆç‡å’Œç»´æŠ¤æˆæœ¬ç»¼åˆè€ƒé‡ã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„å¯¹æ¯”åˆ†æåŠæ¨èå»ºè®®ï¼š&lt;/p&gt;
&lt;h3 id="spring-data-elasticsearch-çš„ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;Spring Data Elasticsearch çš„ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒä¼˜åŠ¿"&gt;&lt;strong&gt;æ ¸å¿ƒä¼˜åŠ¿&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼€å‘æ•ˆç‡é«˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æä¾› &lt;code&gt;ElasticsearchRepository&lt;/code&gt; æ¥å£ï¼Œè‡ªåŠ¨å®ç°åŸºç¡€çš„ CRUD æ“ä½œï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™æŸ¥è¯¢é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;@Document&lt;/code&gt;ã€&lt;code&gt;@Field&lt;/code&gt;ï¼‰å®ç°å®ä½“ä¸ç´¢å¼•çš„æ˜ å°„ï¼Œç®€åŒ–æ•°æ®æ¨¡å‹å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒåˆ†é¡µã€æ’åºã€èšåˆç­‰å¸¸è§åŠŸèƒ½ï¼Œä¸ Spring ç”Ÿæ€æ— ç¼é›†æˆï¼ˆå¦‚äº‹åŠ¡ç®¡ç†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;ElasticsearchRestTemplate&lt;/code&gt; æˆ– &lt;code&gt;ReactiveElasticsearchTemplate&lt;/code&gt; å°è£…å¤æ‚æ“ä½œï¼Œå‡å°‘åº•å±‚ API è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šæ¨¡ç³ŠæŸ¥è¯¢åªéœ€å®šä¹‰æ–¹æ³•åï¼ˆå¦‚ &lt;code&gt;findByNameLike&lt;/code&gt;ï¼‰å³å¯è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¼å®¹æ€§é€‚é…&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šç‰ˆæœ¬ Elasticsearchï¼ˆéœ€ä¸¥æ ¼åŒ¹é… Spring Boot ä¸ ES çš„ç‰ˆæœ¬ï¼‰ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;Spring Boot 2.2.x å¯¹åº” ES 6.8.x&lt;/li&gt;
&lt;li&gt;Spring Boot 3.x å¯¹åº” ES 8.xï¼ˆéœ€é€šè¿‡ OpenSearch å…¼å®¹å±‚ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿå¼€å‘&lt;/strong&gt;ï¼šéœ€å¿«é€Ÿå®ç° CRUDã€ç®€å•æŸ¥è¯¢åŠåˆ†é¡µåŠŸèƒ½çš„é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spring ç”Ÿæ€æ•´åˆ&lt;/strong&gt;ï¼šå·²æ·±åº¦ä¾èµ– Springï¼ˆå¦‚ Spring Securityã€Spring Batchï¼‰çš„é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»´æŠ¤æ€§è¦æ±‚é«˜&lt;/strong&gt;ï¼šå›¢é˜Ÿç†Ÿæ‚‰ JPA é£æ ¼æ“ä½œï¼Œéœ€å‡å°‘ä»£ç é‡å¤ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-high-level-rest-client-çš„ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;2. High Level REST Client çš„ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒä¼˜åŠ¿-1"&gt;&lt;strong&gt;æ ¸å¿ƒä¼˜åŠ¿&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çµæ´»æ€§ä¸æ§åˆ¶åŠ›&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥æ“ä½œ Elasticsearch DSL æŸ¥è¯¢ï¼Œæ”¯æŒå¤æ‚èšåˆã€åµŒå¥—æŸ¥è¯¢ç­‰é«˜çº§åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;æ›´é€‚åˆéœ€è¦ç²¾ç¡®æ§åˆ¶æŸ¥è¯¢é€»è¾‘çš„åœºæ™¯ï¼ˆå¦‚è‡ªå®šä¹‰è¯„åˆ†ã€é«˜äº®æ˜¾ç¤ºï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒè·¨ç‰ˆæœ¬ ES é›†ç¾¤ï¼ˆå¦‚ 7.x å®¢æˆ·ç«¯å¯å…¼å®¹ 8.x é›†ç¾¤çš„å…¼å®¹æ¨¡å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…å›  Spring Data ç‰ˆæœ¬æ»åå¯¼è‡´çš„åŠŸèƒ½ç¼ºå¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç”Ÿ API è°ƒç”¨å‡å°‘åºåˆ—åŒ–/ååºåˆ—åŒ–å¼€é”€ï¼Œé€‚åˆé«˜åååœºæ™¯ï¼ˆå¦‚æ—¥å¿—åˆ†æã€å®æ—¶æ•°æ®å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-1"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚æŸ¥è¯¢éœ€æ±‚&lt;/strong&gt;ï¼šéœ€è¦ç›´æ¥ç¼–å†™ ES DSL çš„å…¨æ–‡æ£€ç´¢ã€åœ°ç†ä½ç½®æŸ¥è¯¢ç­‰åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ES ç‰ˆæœ¬å‡çº§é¢‘ç¹&lt;/strong&gt;ï¼šé¡¹ç›®éœ€ç´§è·Ÿ ES æ–°ç‰ˆæœ¬ç‰¹æ€§ï¼ˆå¦‚å¼‚æ­¥æœç´¢ã€å‘é‡æ£€ç´¢ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—ç•™ç³»ç»Ÿè¿ç§»&lt;/strong&gt;ï¼šä» Transport Client å‡çº§åˆ° REST å®¢æˆ·ç«¯çš„è¿‡æ¸¡æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-ç»¼åˆå¯¹æ¯”ä¸æ¨èå»ºè®®"&gt;&lt;strong&gt;3. ç»¼åˆå¯¹æ¯”ä¸æ¨èå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Spring Data Elasticsearch&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;High Level REST Client&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼€å‘æ•ˆç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆæ³¨è§£é©±åŠ¨ã€è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆéœ€æ‰‹åŠ¨ç¼–å†™æŸ¥è¯¢é€»è¾‘ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å—é™ï¼ˆéœ€é€‚é… Repository æ¥å£ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆç›´æ¥æ“ä½œ DSLï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸¥æ ¼ä¾èµ– Spring Boot ä¸ ES ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;æ”¯æŒè·¨ç‰ˆæœ¬ï¼ˆ7.x å®¢æˆ·ç«¯å…¼å®¹ 8.x é›†ç¾¤ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰ï¼ˆå°è£…å±‚å¸¦æ¥é¢å¤–å¼€é”€ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆæ¥è¿‘åŸç”Ÿæ€§èƒ½ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç»´æŠ¤æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆå‡å°‘é‡å¤ä»£ç ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€å¤„ç†åº•å±‚å¼‚å¸¸ã€è¿æ¥æ± ç­‰ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="æ¨èé€‰æ‹©"&gt;&lt;strong&gt;æ¨èé€‰æ‹©&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹© Spring Data Elasticsearch&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨äºå¤§å¤šæ•°ä¸šåŠ¡ç³»ç»Ÿï¼ˆå¦‚ç”µå•†ã€CMSï¼‰ï¼Œéœ€å¿«é€Ÿè¿­ä»£ä¸”æŸ¥è¯¢é€»è¾‘ä¸å¤æ‚çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šå•†å“æœç´¢ã€è®¢å•ç®¡ç†ã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€‰æ‹© High Level REST Client&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨äºå¤§æ•°æ®åˆ†æã€æ—¥å¿—å¤„ç†ç­‰éœ€è¦é«˜æ€§èƒ½å’Œå¤æ‚æŸ¥è¯¢çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼šES 8.x å·²å¼ƒç”¨ High Level REST Clientï¼Œæ¨èè¿ç§»è‡³å®˜æ–¹ Java API å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="4-æ›¿ä»£æ–¹æ¡ˆelasticsearch-java-api-å®¢æˆ·ç«¯"&gt;&lt;strong&gt;4. æ›¿ä»£æ–¹æ¡ˆï¼šElasticsearch Java API å®¢æˆ·ç«¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥é¡¹ç›®ä½¿ç”¨ &lt;strong&gt;Elasticsearch 8.x+&lt;/strong&gt;ï¼Œå»ºè®®ç›´æ¥é‡‡ç”¨å®˜æ–¹æ¨èçš„ &lt;strong&gt;Elasticsearch Java API å®¢æˆ·ç«¯&lt;/strong&gt;ï¼ˆæ›¿ä»£ High Level REST Clientï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè½»é‡çº§ã€æ— å†—ä½™ä¾èµ–ã€æ”¯æŒå¼‚æ­¥æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¾èµ–é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;co.elastic.clients&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;elasticsearch-java&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.14.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring é¡¹ç›®é¦–é€‰ Spring Data Elasticsearch&lt;/strong&gt;ï¼šå¼€å‘æ•ˆç‡é«˜ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œé€‚åˆæ ‡å‡†ä¸šåŠ¡åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ€§èƒ½æˆ–å¤æ‚æŸ¥è¯¢åœºæ™¯é€‰æ‹©åŸç”Ÿå®¢æˆ·ç«¯&lt;/strong&gt;ï¼šä¼˜å…ˆ Elasticsearch Java API å®¢æˆ·ç«¯ï¼ˆES 8.x+ï¼‰ï¼Œæ¬¡é€‰ High Level REST Clientï¼ˆES 7.xï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬å‡çº§æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼šå®šæœŸæ£€æŸ¥ Spring Data ä¸ Elasticsearch çš„ç‰ˆæœ¬å…¼å®¹æ€§è¡¨æ ¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å•ç´¢å¼•ä¸å¤šç´¢å¼•"&gt;å•ç´¢å¼•ä¸å¤šç´¢å¼•
&lt;/h2&gt;&lt;p&gt;åœ¨Elasticsearchä¸­è®¾è®¡è®ºå›å¸–å­çš„ç´¢å¼•ç»“æ„æ—¶ï¼Œå…¨å±€æœç´¢ä¸ç©ºé—´æœç´¢çš„æ€§èƒ½è¡¨ç°ä¼šå› ç´¢å¼•ç­–ç•¥çš„ä¸åŒè€Œäº§ç”Ÿæ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»ç´¢å¼•ç»“æ„ã€æŸ¥è¯¢æ€§èƒ½ã€ç»´æŠ¤æˆæœ¬ä¸‰ä¸ªç»´åº¦å¯¹æ¯”ä¸¤ç§æ–¹æ¡ˆï¼Œå¹¶ç»“åˆå®é™…åœºæ™¯ç»™å‡ºé€‰å‹å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç´¢å¼•ç»“æ„å¯¹æ¯”"&gt;&lt;strong&gt;ç´¢å¼•ç»“æ„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="æ–¹æ¡ˆaå•ä¸€å…¨å±€ç´¢å¼•posts"&gt;&lt;strong&gt;æ–¹æ¡ˆAï¼šå•ä¸€å…¨å±€ç´¢å¼•ï¼ˆpostsï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æœç´¢&lt;/strong&gt;ï¼šç›´æ¥é€šè¿‡&lt;code&gt;multi_match&lt;/code&gt;æˆ–&lt;code&gt;query_string&lt;/code&gt;åœ¨å…¨é‡æ•°æ®ä¸­æ£€ç´¢ï¼Œæ— éœ€è·¨ç´¢å¼•æ“ä½œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æœç´¢&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;term&lt;/code&gt;è¿‡æ»¤å™¨ç­›é€‰&lt;code&gt;space_id&lt;/code&gt;å­—æ®µï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;bool&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;must&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;å…³é”®è¯&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;filter&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;space_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;space_001&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šç´¢å¼•ç»´æŠ¤ç®€å•ï¼Œæ•°æ®æ›´æ–°ä»…éœ€å•ç‚¹æ“ä½œï¼›å¤©ç„¶æ”¯æŒè·¨ç©ºé—´è”åˆæŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ–¹æ¡ˆbåˆ†ç©ºé—´ç‹¬ç«‹ç´¢å¼•posts_"&gt;&lt;strong&gt;æ–¹æ¡ˆBï¼šåˆ†ç©ºé—´ç‹¬ç«‹ç´¢å¼•ï¼ˆposts_space_001ã€posts_space_002&amp;hellip;ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æœç´¢&lt;/strong&gt;ï¼šéœ€é€šè¿‡&lt;code&gt;_all&lt;/code&gt;åˆ«åæˆ–&lt;code&gt;index: posts_*&lt;/code&gt;æ¨¡å¼åŒ¹é…æ‰€æœ‰ç©ºé—´ç´¢å¼•ï¼Œäº§ç”Ÿè·¨ç´¢å¼•æŸ¥è¯¢å¼€é”€&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æœç´¢&lt;/strong&gt;ï¼šç›´æ¥æŸ¥è¯¢ç‰¹å®šç©ºé—´ç´¢å¼•ï¼ˆå¦‚&lt;code&gt;posts_space_001&lt;/code&gt;ï¼‰ï¼Œå¤©ç„¶éš”ç¦»æ•°æ®èŒƒå›´&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šç©ºé—´æ•°æ®ç‰©ç†éš”ç¦»ï¼ŒæŸ¥è¯¢æ—¶å‡å°‘æ‰«ææ•°æ®é‡ï¼›æ”¯æŒç‹¬ç«‹åˆ†ç‰‡ç­–ç•¥ï¼ˆå¦‚é«˜é¢‘è®¿é—®ç©ºé—´å¯é…ç½®æ›´å¤šåˆ†ç‰‡ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å½±å“åˆ†æ"&gt;&lt;strong&gt;æ€§èƒ½å½±å“åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆAï¼ˆå•ä¸€ç´¢å¼•ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆBï¼ˆåˆ†ç©ºé—´ç´¢å¼•ï¼‰&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¨å±€æœç´¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘æ—¶å¯èƒ½å› å…¨é‡æ‰«æå¯¼è‡´CPU/IOå‹åŠ›&lt;/td&gt;
&lt;td&gt;è·¨ç´¢å¼•èšåˆéœ€åè°ƒèŠ‚ç‚¹åˆå¹¶ç»“æœï¼Œç½‘ç»œå¼€é”€å¢åŠ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç©ºé—´æœç´¢&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¾èµ–å€’æ’ç´¢å¼•è¿‡æ»¤ï¼Œå†…å­˜æ¶ˆè€—è¾ƒé«˜&lt;/td&gt;
&lt;td&gt;ç›´æ¥å®šä½ç›®æ ‡ç´¢å¼•ï¼Œå‡å°‘æ•°æ®æ‰«æèŒƒå›´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å†™å…¥æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•ç´¢å¼•æ‰¹é‡å†™å…¥æ•ˆç‡æ›´é«˜&lt;/td&gt;
&lt;td&gt;å¤šç´¢å¼•å¹¶å‘å†™å…¥å¯èƒ½è§¦å‘çº¿ç¨‹ç«äº‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç´¢å¼•è¿‡å¤§æ—¶éœ€æ‰‹åŠ¨æ‹†åˆ†ï¼ˆå¦‚æŒ‰æ—¶é—´åˆ†ç‰‡ï¼‰&lt;/td&gt;
&lt;td&gt;å¤©ç„¶æ”¯æŒæ°´å¹³æ‰©å±•ï¼ˆæ–°ç©ºé—´è‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="å…¸å‹æ¡ˆä¾‹å¯¹æ¯”"&gt;&lt;strong&gt;å…¸å‹æ¡ˆä¾‹å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å‡è®¾æŸè®ºå›æœ‰100ä¸ªç©ºé—´ï¼Œæ¯ä¸ªç©ºé—´å«100ä¸‡å¸–å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æœç´¢å»¶è¿Ÿ&lt;/strong&gt;ï¼šæ–¹æ¡ˆBé€šè¿‡&lt;code&gt;posts_space_001&lt;/code&gt;ç´¢å¼•ç›´æ¥å®šä½ï¼Œå“åº”æ—¶é—´çº¦20msï¼›æ–¹æ¡ˆAéœ€è¿‡æ»¤100ä¸‡*100æ•°æ®ï¼Œå“åº”æ—¶é—´çº¦120ms&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æœç´¢ååé‡&lt;/strong&gt;ï¼šæ–¹æ¡ˆAå•ç´¢å¼•QPSå¯è¾¾5000ï¼›æ–¹æ¡ˆBè·¨100ç´¢å¼•æŸ¥è¯¢æ—¶QPSå¯èƒ½é™è‡³2000ï¼ˆåè°ƒèŠ‚ç‚¹æˆä¸ºç“¶é¢ˆï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å»ºè®®"&gt;&lt;strong&gt;é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä¼˜å…ˆé€‰æ‹©æ–¹æ¡ˆaçš„åœºæ™¯"&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©æ–¹æ¡ˆAçš„åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€æœç´¢å æ¯” &amp;gt; 70%&lt;/strong&gt;ï¼šé¿å…è·¨ç´¢å¼•æŸ¥è¯¢å¸¦æ¥çš„æ€§èƒ½æŸè€—&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æ•°é‡åŠ¨æ€å¢é•¿&lt;/strong&gt;ï¼šé¿å…ç´¢å¼•çˆ†ç‚¸ï¼ˆå¦‚ç”¨æˆ·å¯è‡ªå»ºæ— é™ç©ºé—´ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬ä»¶èµ„æºæœ‰é™&lt;/strong&gt;ï¼šå•ç´¢å¼•æ›´æ˜“ä¼˜åŒ–åˆ†ç‰‡ç­–ç•¥ï¼ˆå»ºè®®åˆ†ç‰‡æ•°=èŠ‚ç‚¹æ•°*1.5ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ä¼˜å…ˆé€‰æ‹©æ–¹æ¡ˆbçš„åœºæ™¯"&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©æ–¹æ¡ˆBçš„åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æ•°æ®éš”ç¦»éœ€æ±‚å¼º&lt;/strong&gt;ï¼šå¦‚ä¸åŒç©ºé—´å±äºç‹¬ç«‹ç§Ÿæˆ·ï¼Œéœ€ç‰©ç†éš”ç¦»æ•°æ®&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´å†…æŸ¥è¯¢å æ¯” &amp;gt; 80%&lt;/strong&gt;ï¼šå¦‚ä¼ä¸šå†…éƒ¨è®ºå›æŒ‰éƒ¨é—¨åˆ’åˆ†ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·çƒ­æ•°æ®åˆ†ç¦»&lt;/strong&gt;ï¼šå†å²ç©ºé—´å¯è¿ç§»è‡³å†·å­˜å‚¨é™ä½æˆæœ¬&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æŠ˜ä¸­æ–¹æ¡ˆroutingfilter"&gt;&lt;strong&gt;æŠ˜ä¸­æ–¹æ¡ˆï¼šRouting+Filter&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•è®¾è®¡&lt;/strong&gt;ï¼šä»ä½¿ç”¨å•ä¸€ç´¢å¼•ï¼Œä½†é€šè¿‡&lt;code&gt;routing=space_id&lt;/code&gt;å°†åŒä¸€ç©ºé—´æ•°æ®å†™å…¥ç›¸åŒåˆ†ç‰‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼šç©ºé—´æœç´¢æ—¶æŒ‡å®š&lt;code&gt;routing&lt;/code&gt;å‚æ•°ï¼Œä»…æœç´¢ç›®æ ‡åˆ†ç‰‡ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;SearchRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;searchRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SearchRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;posts&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;routing&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;space_001&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´è¿ç›®æ ‡åˆ†ç‰‡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šå…¼å…·æ–¹æ¡ˆAçš„å…¨å±€æŸ¥è¯¢èƒ½åŠ›å’Œæ–¹æ¡ˆBçš„ç©ºé—´æŸ¥è¯¢æ€§èƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µéªŒè¯æ–¹æ³•"&gt;&lt;strong&gt;å®è·µéªŒè¯æ–¹æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å»ºæ¨¡&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;esrally&lt;/code&gt;å·¥å…·ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼ˆå¦‚1000ä¸‡å¸–å­ï¼Œ100ä¸ªç©ºé—´ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹åŠ›æµ‹è¯•&lt;/strong&gt;ï¼šå¯¹æ¯”ä¸¤ç§æ–¹æ¡ˆçš„90th percentileå»¶è¿Ÿå’Œååé‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºç›‘æ§&lt;/strong&gt;ï¼šè§‚å¯Ÿåè°ƒèŠ‚ç‚¹CPUã€å †å†…å­˜ã€IOPSæŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç°åº¦å‘å¸ƒ&lt;/strong&gt;ï¼šå¯¹10%æµé‡å®æ–½ABæµ‹è¯•ï¼Œæ”¶é›†çœŸå®ä¸šåŠ¡æŒ‡æ ‡&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šå¯¹å¤§å¤šæ•°è®ºå›åœºæ™¯ï¼Œ&lt;strong&gt;æ–¹æ¡ˆAï¼ˆå•ä¸€ç´¢å¼•ï¼‰+ Routingä¼˜åŒ–&lt;/strong&gt;æ˜¯æ›´ä¼˜é€‰æ‹©ï¼Œåœ¨ä¿è¯å…¨å±€æœç´¢æ€§èƒ½çš„åŒæ—¶ï¼Œé€šè¿‡è·¯ç”±æœºåˆ¶å®ç°ç©ºé—´æŸ¥è¯¢åŠ é€Ÿã€‚ä»…åœ¨éœ€è¦å¼ºæ•°æ®éš”ç¦»æˆ–ç©ºé—´æŸ¥è¯¢æåº¦é«˜é¢‘æ—¶æ¨èæ–¹æ¡ˆB&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="å®ä¾‹"&gt;å®ä¾‹
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Data Elasticsearchä¸­å»ºç«‹ç´¢å¼•å¹¶è¿›è¡ŒæŸ¥è¯¢æ¶‰åŠå®ä½“æ˜ å°„ã€ç´¢å¼•ç®¡ç†ã€æŸ¥è¯¢æ„å»ºç­‰å…³é”®æ­¥éª¤ã€‚ä»¥ä¸‹ä»¥è®ºå›å¸–å­ï¼ˆPostï¼‰ä¸ºä¾‹è¯¦ç»†è¯´æ˜æ“ä½œæµç¨‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç´¢å¼•çš„åˆ›å»ºä¸æ˜ å°„å®šä¹‰"&gt;&lt;strong&gt;ç´¢å¼•çš„åˆ›å»ºä¸æ˜ å°„å®šä¹‰&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å®ä½“ç±»æ³¨è§£é…ç½®"&gt;&lt;strong&gt;1. å®ä½“ç±»æ³¨è§£é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;@Document&lt;/code&gt;å’Œå­—æ®µæ³¨è§£å®šä¹‰Elasticsearchç´¢å¼•ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indexName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;posts&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å®šä¹‰ç´¢å¼•åç§°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;analyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;searchAnalyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ‡é¢˜å­—æ®µï¼Œä½¿ç”¨IKåˆ†è¯å™¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;analyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å†…å®¹å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰€å±ç©ºé—´IDï¼ˆç²¾ç¡®åŒ¹é…ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LocalDateTime&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;createTime&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ›å»ºæ—¶é—´&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é”®æ³¨è§£&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Document&lt;/code&gt;ï¼šæŒ‡å®šç´¢å¼•åç§°å’Œç±»å‹ï¼ˆElasticsearch 7.x+é»˜è®¤å¿½ç•¥&lt;code&gt;type&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Field&lt;/code&gt;ï¼šå®šä¹‰å­—æ®µç±»å‹ï¼ˆå¦‚&lt;code&gt;Text&lt;/code&gt;æ”¯æŒåˆ†è¯ï¼Œ&lt;code&gt;Keyword&lt;/code&gt;ç”¨äºç²¾ç¡®åŒ¹é…ï¼‰åŠåˆ†è¯å™¨ï¼ˆå¦‚&lt;code&gt;ik_max_word&lt;/code&gt;ç”¨äºç´¢å¼•é˜¶æ®µç»†ç²’åº¦åˆ†è¯ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-ç´¢å¼•è‡ªåŠ¨åˆ›å»º"&gt;&lt;strong&gt;2. ç´¢å¼•è‡ªåŠ¨åˆ›å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Spring Data Elasticsearchä¼šæ ¹æ®å®ä½“ç±»æ³¨è§£åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;# application.ymlé…ç½®ï¼ˆéœ€ç¡®ä¿ESç‰ˆæœ¬ä¸ä¾èµ–å…¼å®¹ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;elasticsearch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;uris&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;http://localhost:9200&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éªŒè¯ç´¢å¼•&lt;/strong&gt;ï¼šå¯åŠ¨åº”ç”¨åæ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤è¾“å‡ºç±»ä¼¼&lt;code&gt;Congratulations auto process index by Easy-Es is done!&lt;/code&gt;çš„æç¤ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-æ‰‹åŠ¨ç®¡ç†ç´¢å¼•"&gt;&lt;strong&gt;3. æ‰‹åŠ¨ç®¡ç†ç´¢å¼•&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;ElasticsearchOperations&lt;/code&gt;å®ç°æ‰‹åŠ¨æ“ä½œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ElasticsearchOperations&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// åˆ›å»ºç´¢å¼•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;indexOps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// åˆ é™¤ç´¢å¼•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deleted&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;indexOps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;é€‚ç”¨åœºæ™¯ï¼šéœ€è¦è‡ªå®šä¹‰åˆ†ç‰‡æ•°ã€å‰¯æœ¬æ•°æˆ–åŠ¨æ€è°ƒæ•´ç´¢å¼•é…ç½®æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ•°æ®æŸ¥è¯¢çš„å®ç°"&gt;&lt;strong&gt;æ•°æ®æŸ¥è¯¢çš„å®ç°&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-åŸºç¡€crudæ“ä½œ"&gt;&lt;strong&gt;1. åŸºç¡€CRUDæ“ä½œ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç»§æ‰¿&lt;code&gt;ElasticsearchRepository&lt;/code&gt;å®ç°åŸºç¡€æ“ä½œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;PostRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ElasticsearchRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¹æ®æ ‡é¢˜æ¨¡ç³ŠåŒ¹é…ï¼ˆè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByTitle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¹æ®ç©ºé—´IDåˆ†é¡µæŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findBySpaceId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨æŸ¥è¯¢æ–¹æ³•&lt;/strong&gt;ï¼šéµå¾ªSpring Dataå‘½åè§„åˆ™ï¼ˆå¦‚&lt;code&gt;findByXxxAndYyy&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-å¤æ‚æŸ¥è¯¢æ„å»º"&gt;&lt;strong&gt;2. å¤æ‚æŸ¥è¯¢æ„å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;NativeSearchQueryBuilder&lt;/code&gt;è‡ªå®šä¹‰DSLæŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç¤ºä¾‹ï¼šæŸ¥è¯¢æŸç©ºé—´ä¸‹åŒ…å«å…³é”®è¯çš„å¸–å­ï¼ˆåˆ†é¡µ+é«˜äº®ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;NativeSearchQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NativeSearchQueryBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QueryBuilders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;boolQuery&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;must&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QueryBuilders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;matchQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æŠ€æœ¯&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¨æ–‡åŒ¹é…&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QueryBuilders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;termQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;spaceId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;space_001&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç²¾ç¡®è¿‡æ»¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withHighlightFields&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HighlightBuilder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é«˜äº®æ˜¾ç¤º&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withPageable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;createTime&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;descending&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ†é¡µæ’åº&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;SearchHits&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒç»„ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;QueryBuilders&lt;/code&gt;ï¼šæ„å»ºå¸ƒå°”æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ç­‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HighlightBuilder&lt;/code&gt;ï¼šå®ç°æœç´¢ç»“æœé«˜äº®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Pageable&lt;/code&gt;ï¼šæ”¯æŒåˆ†é¡µå’Œæ’åº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-èšåˆæŸ¥è¯¢"&gt;&lt;strong&gt;3. èšåˆæŸ¥è¯¢&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å®ç°ç»Ÿè®¡ç±»éœ€æ±‚ï¼ˆå¦‚æŒ‰ç©ºé—´ç»Ÿè®¡å‘å¸–é‡ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;TermsAggregationBuilder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;aggregation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AggregationBuilders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;terms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;space_stats&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;spaceId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;SearchQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NativeSearchQueryBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addAggregation&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;aggregation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;SearchResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchOperations&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SearchResponse&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Terms&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;terms&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getAggregations&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;space_stats&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šæ•°æ®åˆ†æã€ç»Ÿè®¡æŠ¥è¡¨åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®è·µå»ºè®®ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;å®è·µå»ºè®®ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring Boot 3.xéœ€æ­é…Elasticsearch 8.xï¼ˆå¦‚8.14.0ï¼‰&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥&lt;code&gt;spring-data-elasticsearch&lt;/code&gt;ä¸ESæœåŠ¡ç«¯ç‰ˆæœ¬åŒ¹é…ï¼ˆä¾‹å¦‚5.3.xå¯¹åº”ES 8.13.xï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;routing = spaceId&lt;/code&gt;å°†åŒä¸€ç©ºé—´æ•°æ®åˆ†é…åˆ°ç›¸åŒåˆ†ç‰‡ï¼ŒåŠ é€Ÿè¿‡æ»¤æŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•è®¾ç½®&lt;/strong&gt;ï¼šæ‰‹åŠ¨é…ç½®åˆ†ç‰‡æ•°ï¼ˆé»˜è®¤1åˆ†ç‰‡ï¼‰å’Œå‰¯æœ¬æ•°ï¼ˆæ ¹æ®é›†ç¾¤è§„æ¨¡è°ƒæ•´ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åŒæ­¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒå†™æ¨¡å¼&lt;/strong&gt;ï¼šä¸šåŠ¡ä»£ç ä¸­åŒæ—¶å†™å…¥æ•°æ®åº“å’ŒESï¼ˆéœ€äº‹åŠ¡ç®¡ç†ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥ç›‘å¬&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;ApplicationEventPublisher&lt;/code&gt;å®ç°å¼‚æ­¥ç´¢å¼•æ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®Œæ•´ç¤ºä¾‹å¸–å­æ“ä½œ"&gt;&lt;strong&gt;å®Œæ•´ç¤ºä¾‹ï¼ˆå¸–å­æ“ä½œï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æ’å…¥æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setTitle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Spring Data ESå®æˆ˜æŒ‡å—&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setContent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ·±åº¦è§£æç´¢å¼•åˆ›å»ºä¸å¤æ‚æŸ¥è¯¢...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setSpaceId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;dev_space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;postRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œå¤æ‚æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;searchByCustomQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;dev_space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æŒ‡å—&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ä»¥ä¸Šè®¾è®¡ï¼Œå¯å®ç°çµæ´»çš„å¸–å­æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒå…¨å±€æœç´¢ã€ç©ºé—´å†…æœç´¢ã€ç”¨æˆ·ç»´åº¦è¿‡æ»¤ç­‰åœºæ™¯ã€‚å…·ä½“å®ç°æ—¶éœ€ç»“åˆå®é™…ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æŸ¥è¯¢é€»è¾‘å’Œç´¢å¼•ç»“æ„ã€‚&lt;/p&gt;
&lt;h2 id="ä¸­æ–‡åˆ†è¯å™¨"&gt;ä¸­æ–‡åˆ†è¯å™¨
&lt;/h2&gt;&lt;p&gt;æ˜¯çš„ï¼Œåœ¨ Elasticsearch ä¸­å¤„ç†ä¸­æ–‡å†…å®¹æ—¶ï¼Œå¿…é¡»ç‰¹åˆ«æŒ‡å®šä¸­æ–‡åˆ†è¯å™¨ã€‚ç”±äºä¸­æ–‡è¯­è¨€ç»“æ„çš„ç‰¹æ®Šæ€§ï¼ˆæ— ç©ºæ ¼åˆ†éš”ã€å­˜åœ¨å¤åˆè¯å’Œæ­§ä¹‰ï¼‰ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤çš„è‹±æ–‡åˆ†è¯å™¨ä¼šå¯¼è‡´æœç´¢æ•ˆæœæå·®ï¼ˆä¾‹å¦‚å°†æ•´å¥æ‹†åˆ†ä¸ºå•ä¸ªæ±‰å­—ï¼‰ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› å’Œè§£å†³æ–¹æ¡ˆçš„ç»¼åˆåˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ºä½•å¿…é¡»ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨"&gt;&lt;strong&gt;ä¸ºä½•å¿…é¡»ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤åˆ†è¯å™¨å¯¹ä¸­æ–‡æ— æ•ˆ&lt;/strong&gt;&lt;br&gt;
Elasticsearch é»˜è®¤çš„ &lt;code&gt;standard&lt;/code&gt; åˆ†è¯å™¨ä¼šå°†ä¸­æ–‡æ–‡æœ¬æŒ‰å•ä¸ªæ±‰å­—åˆ‡åˆ†ã€‚ä¾‹å¦‚â€œè‡ªç„¶è¯­è¨€å¤„ç†â€ä¼šè¢«æ‹†åˆ†ä¸ºâ€œè‡ªâ€â€œç„¶â€â€œè¯­â€â€œè¨€â€â€œå¤„â€â€œç†â€ã€‚è¿™ç§åˆ†è¯æ–¹å¼æ— æ³•æ»¡è¶³è¯­ä¹‰æ£€ç´¢éœ€æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸­æ–‡åˆ†è¯çš„ç‰¹æ®Šæ€§&lt;/strong&gt;&lt;br&gt;
ä¸­æ–‡å­˜åœ¨å¤åˆè¯ï¼ˆå¦‚â€œæ¸…åå¤§å­¦â€ï¼‰ã€æ­§ä¹‰è¯ï¼ˆå¦‚â€œå—äº¬å¸‚é•¿æ±Ÿå¤§æ¡¥â€ï¼‰ã€æ–°è¯ï¼ˆå¦‚â€œå…ƒå®‡å®™â€ï¼‰ç­‰é—®é¢˜ï¼Œéœ€è¦åŸºäºè¯å…¸å’Œç®—æ³•çš„æ™ºèƒ½åˆ‡åˆ†ã€‚ä¸­æ–‡åˆ†è¯å™¨ï¼ˆå¦‚ IKï¼‰èƒ½é€šè¿‡è¯­ä¹‰åˆ†æå®ç°ç²¾å‡†åˆ‡åˆ†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœç´¢æ€§èƒ½ä¸å¬å›ç‡&lt;/strong&gt;&lt;br&gt;
æ­£ç¡®çš„ä¸­æ–‡åˆ†è¯å¯æå‡ç´¢å¼•æ•ˆç‡å’Œæœç´¢å¬å›ç‡ã€‚ä¾‹å¦‚æœç´¢â€œè‹¹æœæ‰‹æœºâ€æ—¶ï¼Œè‹¥ç´¢å¼•ä¸­å­˜å‚¨çš„æ˜¯â€œè‹¹æœâ€å’Œâ€œæ‰‹æœºâ€ä¸¤ä¸ªè¯æ¡ï¼Œåˆ™èƒ½å‘½ä¸­ç›¸å…³æ–‡æ¡£ï¼›è‹¥æŒ‰å•å­—åˆ‡åˆ†åˆ™æ— æ³•åŒ¹é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¦‚ä½•é…ç½®ä¸­æ–‡åˆ†è¯å™¨"&gt;&lt;strong&gt;å¦‚ä½•é…ç½®ä¸­æ–‡åˆ†è¯å™¨ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å®‰è£…-ik-åˆ†è¯æ’ä»¶"&gt;&lt;strong&gt;1. å®‰è£… IK åˆ†è¯æ’ä»¶&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;IK æ˜¯ Elasticsearch æœ€å¸¸ç”¨çš„ä¸­æ–‡åˆ†è¯æ’ä»¶ï¼Œæ”¯æŒç»†ç²’åº¦ï¼ˆ&lt;code&gt;ik_max_word&lt;/code&gt;ï¼‰å’Œæ™ºèƒ½æ¨¡å¼ï¼ˆ&lt;code&gt;ik_smart&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ä¸‹è½½å¹¶å®‰è£…æ’ä»¶ï¼ˆç‰ˆæœ¬éœ€ä¸ ES å¯¹åº”ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.14.0/elasticsearch-analysis-ik-8.14.0.zip
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£…åéœ€é‡å¯ Elasticsearch æœåŠ¡ã€‚&lt;/p&gt;
&lt;h4 id="2-åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šåˆ†è¯å™¨"&gt;&lt;strong&gt;2. åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šåˆ†è¯å™¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ç´¢å¼•æ˜ å°„ä¸­å®šä¹‰å­—æ®µä½¿ç”¨ IK åˆ†è¯å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT&lt;/span&gt; &lt;span class="err"&gt;/posts&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;mappings&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;// ç´¢å¼•æ—¶æœ€ç»†ç²’åº¦åˆ†è¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;search_analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// æœç´¢æ—¶æ™ºèƒ½åˆ†è¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ik_max_word&lt;/code&gt;&lt;/strong&gt;ï¼šå°½å¯èƒ½å¤šåœ°åˆ‡åˆ†è¯æ±‡ï¼ˆå¦‚â€œè‡ªç„¶è¯­è¨€å¤„ç†â€ â†’ â€œè‡ªç„¶â€â€œè¯­è¨€â€â€œå¤„ç†â€â€œè‡ªç„¶è¯­è¨€â€ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/strong&gt;ï¼šæŒ‰æœ€å¯èƒ½è¯­ä¹‰åˆ‡åˆ†ï¼ˆå¦‚â€œè‡ªç„¶è¯­è¨€å¤„ç†â€ â†’ â€œè‡ªç„¶è¯­è¨€â€â€œå¤„ç†â€ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3-æµ‹è¯•åˆ†è¯æ•ˆæœ"&gt;&lt;strong&gt;3. æµ‹è¯•åˆ†è¯æ•ˆæœ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;_analyze&lt;/code&gt; API éªŒè¯åˆ†è¯ç»“æœï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/posts/_analyze&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;field&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;æˆ‘çˆ±è‡ªç„¶è¯­è¨€å¤„ç†&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¢„æœŸè¾“å‡ºä¸ºï¼š&lt;code&gt;[&amp;quot;æˆ‘&amp;quot;, &amp;quot;çˆ±&amp;quot;, &amp;quot;è‡ªç„¶è¯­è¨€&amp;quot;, &amp;quot;å¤„ç†&amp;quot;]&lt;/code&gt;ï¼ˆä½¿ç”¨ &lt;code&gt;ik_smart&lt;/code&gt; æ¨¡å¼æ—¶ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è¿›é˜¶ä¼˜åŒ–ç­–ç•¥"&gt;&lt;strong&gt;è¿›é˜¶ä¼˜åŒ–ç­–ç•¥&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰è¯å…¸æ‰©å±•&lt;/strong&gt;&lt;br&gt;
é’ˆå¯¹ä¸“ä¸šæœ¯è¯­ï¼ˆå¦‚â€œåŒºå—é“¾â€â€œæœºå™¨å­¦ä¹ â€ï¼‰ï¼Œå¯åœ¨ &lt;code&gt;config/analysis-ik/custom.dic&lt;/code&gt; ä¸­æ·»åŠ è¯æ±‡ï¼Œé¿å…é”™è¯¯åˆ‡åˆ†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆä¸­è‹±æ–‡åˆ†è¯&lt;/strong&gt;&lt;br&gt;
è‹¥æ–‡æœ¬åŒ…å«ä¸­è‹±æ–‡æ··åˆå†…å®¹ï¼Œå¯é…ç½®å¤šè¯­è¨€åˆ†è¯ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;analyzer&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;mixed_analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;tokenizer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;filter&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;lowercase&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;// è‹±æ–‡è½¬å°å†™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°è¯å…¸&lt;/strong&gt;&lt;br&gt;
IK æ”¯æŒçƒ­æ›´æ–°è¯å…¸æ–‡ä»¶ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯åŠ è½½æ–°è¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–åˆ†è¯æ–¹æ¡ˆå¯¹æ¯”"&gt;&lt;strong&gt;ä¸å…¶ä»–åˆ†è¯æ–¹æ¡ˆå¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åˆ†è¯å™¨&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;IK&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¤¾åŒºæ”¯æŒå¹¿ã€é…ç½®ç®€å•&lt;/td&gt;
&lt;td&gt;å¯¹æ–°è¯è¯†åˆ«ä¾èµ–æ‰‹åŠ¨æ‰©å±•è¯å…¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Jieba&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é€‚åˆ Python ç”Ÿæ€ã€æ”¯æŒè¯æ€§æ ‡æ³¨&lt;/td&gt;
&lt;td&gt;éœ€é€šè¿‡æ’ä»¶é›†æˆåˆ° ES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HanLP&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒå¤šä»»åŠ¡ï¼ˆåˆ†è¯ã€NERï¼‰&lt;/td&gt;
&lt;td&gt;èµ„æºæ¶ˆè€—è¾ƒé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸­æ–‡å†…å®¹å¿…é¡»ä½¿ç”¨ä¸“é—¨çš„åˆ†è¯å™¨ï¼ˆå¦‚ IKï¼‰ä»¥å®ç°è¯­ä¹‰çº§æœç´¢ã€‚é€šè¿‡åˆç†é…ç½®åˆ†è¯ç­–ç•¥ï¼Œå¯æ˜¾è‘—æå‡æœç´¢å‡†ç¡®æ€§å’Œæ€§èƒ½ã€‚å¯¹äºé«˜é¢‘ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚ç”µå•†ã€è®ºå›ï¼‰ï¼Œå»ºè®®ç»“åˆè‡ªå®šä¹‰è¯å…¸å’Œæ··åˆåˆ†è¯ç­–ç•¥è¿›ä¸€æ­¥ä¼˜åŒ–&lt;/p&gt;
&lt;h2 id="æ’å…¥ä¸æ›´æ–°"&gt;æ’å…¥ä¸æ›´æ–°
&lt;/h2&gt;&lt;h3 id="æ’å…¥ä¸æ›´æ–°çš„åº•å±‚æœºåˆ¶"&gt;æ’å…¥ä¸æ›´æ–°çš„åº•å±‚æœºåˆ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’å…¥æ“ä½œ&lt;/strong&gt;&lt;br&gt;
Elasticsearch çš„æ’å…¥åŸºäºå€’æ’ç´¢å¼•ç»“æ„ï¼Œæ–°æ–‡æ¡£ä¼šè¢«è¿½åŠ åˆ°å†…å­˜ç¼“å†²åŒºï¼ˆIn-memory bufferï¼‰ï¼Œéšåé€šè¿‡å®šæœŸåˆ·æ–°ï¼ˆé»˜è®¤æ¯ç§’ä¸€æ¬¡ï¼‰ç”Ÿæˆä¸å¯å˜çš„æ®µï¼ˆSegmentï¼‰ã€‚æ’å…¥æ€§èƒ½ä¼˜åŒ–ä¸»è¦ä½“ç°åœ¨æ‰¹é‡å†™å…¥ï¼ˆBulk APIï¼‰å’Œç¡¬ä»¶èµ„æºï¼ˆå¦‚ SSDï¼‰çš„æ”¯æŒä¸Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°æ“ä½œ&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;æ›´æ–°æœ¬è´¨æ˜¯åˆ é™¤+æ’å…¥&lt;/strong&gt;ï¼šæ—§æ–‡æ¡£è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰ï¼Œæ–°æ–‡æ¡£ç”Ÿæˆæ–°ç‰ˆæœ¬å¹¶å†™å…¥æ–°æ®µï¼Œæ—§æ–‡æ¡£åœ¨æ®µåˆå¹¶æ—¶ç‰©ç†åˆ é™¤ã€‚æ­¤è¿‡ç¨‹æ¶‰åŠå¤šæ¬¡ I/O æ“ä½œï¼ˆè¯»å–åŸæ–‡æ¡£ã€å†™å…¥æ–°æ–‡æ¡£ã€æ›´æ–°ç‰ˆæœ¬å·ï¼‰å’Œç‰ˆæœ¬æ§åˆ¶å¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é¢‘ç¹æ’å…¥æ›´æ–°çš„æ€§èƒ½å½±å“"&gt;é¢‘ç¹æ’å…¥/æ›´æ–°çš„æ€§èƒ½å½±å“
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•å±‚é¢çš„ä»£ä»·&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ®µçˆ†ç‚¸ä¸åˆå¹¶å‹åŠ›&lt;/strong&gt;ï¼šé¢‘ç¹æ“ä½œå¯¼è‡´æ®µæ•°é‡æ¿€å¢ï¼Œè§¦å‘åå°æ®µåˆå¹¶ï¼ˆMergeï¼‰ã€‚åˆå¹¶è¿‡ç¨‹æ¶ˆè€—å¤§é‡ CPUã€I/O èµ„æºï¼Œå¹¶å¯èƒ½é˜»å¡æŸ¥è¯¢çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶å¼€é”€&lt;/strong&gt;ï¼šæ¯æ¬¡æ›´æ–°éœ€ç»´æŠ¤ç‰ˆæœ¬å·æ˜ å°„è¡¨ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹æ˜“å¼•å‘ç‰ˆæœ¬å†²çªï¼Œå¢åŠ é”ç«äº‰å’Œå†…å­˜å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥æ”¾å¤§æ•ˆåº”&lt;/strong&gt;ï¼šå•æ¬¡æ›´æ–°å®é™…äº§ç”Ÿ 3-5 å€ç£ç›˜ I/Oï¼ˆåˆ é™¤æ ‡è®°ã€æ–°æ–‡æ¡£å†™å…¥ã€æ®µåˆå¹¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­˜å‚¨ä¸èµ„æºæ¶ˆè€—&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç£ç›˜ç©ºé—´è†¨èƒ€&lt;/strong&gt;ï¼šæ—§æ–‡æ¡£åœ¨åˆå¹¶å‰ä»å ç”¨å­˜å‚¨ç©ºé—´ï¼Œé¢‘ç¹æ›´æ–°å¯èƒ½å¯¼è‡´ç£ç›˜ä½¿ç”¨ç‡çŸ­æœŸæš´å¢ï¼ˆå¦‚æ¡ˆä¾‹ä¸­ç£ç›˜ IOPS è¾¾ 98%ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å‹åŠ›&lt;/strong&gt;ï¼šç‰ˆæœ¬æ˜ å°„è¡¨å’Œå­—æ®µæ•°æ®ç¼“å­˜ï¼ˆFielddataï¼‰å ç”¨å †å†…å­˜ï¼Œå½±å“ JVM åƒåœ¾å›æ”¶æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½è¡°å‡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿå¢åŠ &lt;/strong&gt;ï¼šæ®µåˆå¹¶å’Œèµ„æºç«äº‰å¯¼è‡´æŸ¥è¯¢çº¿ç¨‹é˜»å¡ï¼ŒP99 å»¶è¿Ÿå¯èƒ½ä» 180ms ä¸Šå‡è‡³ 2100msã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å¯è§æ€§å»¶è¿Ÿ&lt;/strong&gt;ï¼šé»˜è®¤ 1 ç§’åˆ·æ–°é—´éš”å¯¼è‡´æ›´æ–°åæ•°æ®çŸ­æš‚ä¸å¯è§ï¼Œå®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚ç‰©æµçŠ¶æ€è·Ÿè¸ªï¼‰å¯èƒ½å—é™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–ç­–ç•¥ä¸æœ€ä½³å®è·µ"&gt;ä¼˜åŒ–ç­–ç•¥ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™å…¥æ¨¡å¼ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡å¤„ç†&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;_bulk API&lt;/code&gt; å‡å°‘ç½‘ç»œå¼€é”€ï¼Œå»ºè®®å•æ‰¹æ¬¡æ–‡æ¡£æ•°æ§åˆ¶åœ¨ 100-1000ï¼ˆéœ€é€šè¿‡åŸºå‡†æµ‹è¯•ç¡®å®šï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥åŒ–ä¸åˆå¹¶é€»è¾‘&lt;/strong&gt;ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ”¶é›†å¤šæ¬¡æ›´æ–°è¯·æ±‚ï¼Œåˆå¹¶ä¸ºå•æ¬¡æ‰¹é‡æ“ä½œï¼ˆå¦‚ç”¨æˆ·è¡Œä¸ºè®¡æ•°åˆå¹¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•é…ç½®è°ƒä¼˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è°ƒæ•´åˆ·æ–°é—´éš”&lt;/strong&gt;ï¼šå¯¹å®æ—¶æ€§è¦æ±‚ä½çš„åœºæ™¯ï¼ˆå¦‚æ—¥å¿—ï¼‰ï¼Œè®¾ç½® &lt;code&gt;refresh_interval=30s&lt;/code&gt; æˆ–ä¸´æ—¶ç¦ç”¨åˆ·æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡ä¸è·¯ç”±ç­–ç•¥&lt;/strong&gt;ï¼šåˆç†è®¾ç½®åˆ†ç‰‡æ•°ï¼ˆæ¨èå•èŠ‚ç‚¹ä¸è¶…è¿‡ 20 åˆ†ç‰‡ï¼‰ï¼Œå¹¶é€šè¿‡ &lt;code&gt;routing=space_id&lt;/code&gt; å°†åŒç©ºé—´æ•°æ®å®šä½åˆ°ç›¸åŒåˆ†ç‰‡ï¼Œå‡å°‘æ®µæ‰«æèŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®ç»“æ„è®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…é¢‘ç¹æ›´æ–°å­—æ®µ&lt;/strong&gt;ï¼šå°†åŠ¨æ€å­—æ®µï¼ˆå¦‚æµè§ˆæ¬¡æ•°ï¼‰ä¸é™æ€å…ƒæ•°æ®åˆ†ç¦»ï¼Œå‡å°‘å…¨æ–‡æ¡£æ›´æ–°é¢‘ç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨éå¿…è¦åˆ†æ&lt;/strong&gt;ï¼šå¯¹æ— éœ€å…¨æ–‡æ£€ç´¢çš„å­—æ®µï¼ˆå¦‚ IDã€çŠ¶æ€ç ï¼‰è®¾ä¸º &lt;code&gt;&amp;quot;index&amp;quot;: false&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºä¸ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬ä»¶ä¼˜åŒ–&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ NVMe SSD æå‡ I/O æ€§èƒ½ï¼ŒJVM å †å†…å­˜å»ºè®®ä¸è¶…è¿‡ç‰©ç†å†…å­˜ 50%ï¼ˆä¸è¶…è¿‡ 30GBï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ®µåˆå¹¶æ§åˆ¶&lt;/strong&gt;ï¼šå®šæœŸæ‰§è¡Œ &lt;code&gt;_forcemerge?max_num_segments=1&lt;/code&gt; åˆå¹¶å°æ®µï¼Œé™ä½æŸ¥è¯¢å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åœºæ™¯æ¡ˆä¾‹"&gt;å…¸å‹åœºæ™¯æ¡ˆä¾‹
&lt;/h3&gt;&lt;p&gt;æŸç‰©æµå¹³å°å› é«˜é¢‘æ›´æ–°ï¼ˆæ—¥æ›´ 5 äº¿æ¡ï¼‰å¯¼è‡´æ€§èƒ½æ–­å´–å¼ä¸‹é™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜æ ¹æº&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;_update_by_query&lt;/code&gt; å…¨é‡æ›´æ–°è¿å•çŠ¶æ€ï¼Œè§¦å‘æ®µåˆå¹¶é£æš´å’Œç‰ˆæœ¬å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;ç´§æ€¥æ­¢è¡€ï¼šä¸´æ—¶æ‰©å®¹èŠ‚ç‚¹å¹¶ç¦ç”¨å‰¯æœ¬å†™å…¥ã€‚&lt;/li&gt;
&lt;li&gt;é•¿æœŸä¼˜åŒ–ï¼šæ”¹é€ ä¸ºå¢é‡æ›´æ–°æ¨¡å‹ï¼Œé€šè¿‡ &lt;code&gt;script&lt;/code&gt; æ›´æ–°å±€éƒ¨å­—æ®µï¼Œå‡å°‘å…¨æ–‡æ¡£æ›¿æ¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;é¢‘ç¹æ’å…¥æˆ–æ›´æ–°ä¼šæ˜¾è‘—å½±å“ Elasticsearch çš„å†™å…¥ååé‡ã€æŸ¥è¯¢å»¶è¿Ÿå’Œå­˜å‚¨æ•ˆç‡ã€‚ä¼˜åŒ–éœ€ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œé€šè¿‡æ‰¹é‡å¤„ç†ã€ç´¢å¼•è®¾è®¡ã€èµ„æºè°ƒä¼˜ç­‰å¤šç»´åº¦ç­–ç•¥å¹³è¡¡å®æ—¶æ€§ä¸æ€§èƒ½ã€‚å¯¹äºé«˜é¢‘æ›´æ–°åœºæ™¯ï¼Œ&lt;strong&gt;ä¼˜å…ˆè€ƒè™‘å¢é‡æ›´æ–°æ›¿ä»£å…¨é‡æ›¿æ¢&lt;/strong&gt;ï¼Œå¹¶å€ŸåŠ©ç›‘æ§å·¥å…·ï¼ˆå¦‚ Kibanaï¼‰å®æ—¶è·Ÿè¸ªæ®µåˆå¹¶ã€å †å†…å­˜ç­‰å…³é”®æŒ‡æ ‡&lt;/p&gt;
&lt;h2 id="å¢é‡æ›´æ–°ä¸å…¨é‡æ›¿æ¢"&gt;å¢é‡æ›´æ–°ä¸å…¨é‡æ›¿æ¢
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;strong&gt;å¢é‡æ›´æ–°&lt;/strong&gt;ä¸&lt;strong&gt;å…¨é‡æ›¿æ¢&lt;/strong&gt;æ˜¯ä¸¤ç§ä¸åŒçš„æ•°æ®æ›´æ–°æœºåˆ¶ï¼Œå…¶åº•å±‚å®ç°ã€é€‚ç”¨åœºæ™¯å’Œæ€§èƒ½å½±å“å·®å¼‚æ˜¾è‘—ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¢é‡æ›´æ–°partial-update"&gt;å¢é‡æ›´æ–°ï¼ˆPartial Updateï¼‰
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåŸç†"&gt;æ ¸å¿ƒåŸç†
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å±€éƒ¨å­—æ®µä¿®æ”¹&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;_update&lt;/code&gt; API ä»…ä¿®æ”¹æ–‡æ¡£çš„æŒ‡å®šå­—æ®µï¼Œè€Œéæ›¿æ¢æ•´ä¸ªæ–‡æ¡£ã€‚ä¾‹å¦‚æ›´æ–°ç‚¹èµæ•°æˆ–åº“å­˜é‡ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/music/children/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="err"&gt;/_update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;script&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ctx._source.likes++&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº•å±‚æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
æœ¬è´¨ä»æ˜¯â€œåˆ é™¤æ—§æ–‡æ¡£ + åˆ›å»ºæ–°æ–‡æ¡£â€ï¼Œä½†æ“ä½œåœ¨åŒä¸€åˆ†ç‰‡å†…å®Œæˆï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ï¼ˆä»…éœ€ä¼ è¾“å·®å¼‚å­—æ®µï¼‰ã€‚æ—§æ–‡æ¡£è¢«æ ‡è®°ä¸º &lt;code&gt;deleted&lt;/code&gt;ï¼Œæ–°æ–‡æ¡£ç”Ÿæˆåå¼‚æ­¥åŒæ­¥åˆ°å‰¯æœ¬åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ä¼˜åŠ¿"&gt;ä¼˜åŠ¿
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½é«˜æ•ˆ&lt;/strong&gt;ï¼šå‡å°‘æ•°æ®ä¼ è¾“é‡ï¼ˆä»…éœ€ä¼ é€’å·®å¼‚å­—æ®µï¼‰ï¼Œé€‚åˆé«˜é¢‘å°æ•°æ®é‡æ›´æ–°ï¼ˆå¦‚è®¡æ•°å™¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†²çªå¤„ç†&lt;/strong&gt;ï¼šæ”¯æŒ &lt;code&gt;retry_on_conflict&lt;/code&gt; å‚æ•°è‡ªåŠ¨é‡è¯•ï¼Œé€‚åˆé¡ºåºæ— å…³çš„å¹¶å‘æ“ä½œï¼ˆå¦‚è®¡æ•°ã€åº“å­˜å¢å‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ€§&lt;/strong&gt;ï¼šæ¯«ç§’çº§å®Œæˆæ“ä½œï¼Œé™ä½ç‰ˆæœ¬å†²çªæ¦‚ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-2"&gt;é€‚ç”¨åœºæ™¯
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç‚¹èµæ•°ã€è¯„è®ºæ•°ç­‰ç»Ÿè®¡å­—æ®µæ›´æ–°&lt;/li&gt;
&lt;li&gt;è®¢å•çŠ¶æ€ã€åº“å­˜æ‰£å‡ç­‰é«˜é¢‘å±€éƒ¨ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;éœ€è¦é¿å…å…¨æ–‡æ¡£æ›¿æ¢çš„åœºæ™¯ï¼ˆå¦‚æ–‡æ¡£ä½“ç§¯è¾ƒå¤§ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…¨é‡æ›¿æ¢full-replacement"&gt;å…¨é‡æ›¿æ¢ï¼ˆFull Replacementï¼‰
&lt;/h3&gt;&lt;h4 id="æ ¸å¿ƒåŸç†-1"&gt;æ ¸å¿ƒåŸç†
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•´ä½“æ–‡æ¡£è¦†ç›–&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;PUT&lt;/code&gt; æˆ– &lt;code&gt;POST&lt;/code&gt; API å®Œå…¨æ›¿æ¢æ–‡æ¡£å†…å®¹ã€‚ä¾‹å¦‚æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT&lt;/span&gt; &lt;span class="err"&gt;/es_db/_doc/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;å¼ ä¸‰&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;age&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;28&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº•å±‚æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
æ—§æ–‡æ¡£è¢«æ ‡è®°ä¸º &lt;code&gt;deleted&lt;/code&gt;ï¼Œæ–°æ–‡æ¡£ç‹¬ç«‹ç”Ÿæˆå¹¶åŒæ­¥åˆ°å‰¯æœ¬åˆ†ç‰‡ã€‚è‹¥æœªæŒ‡å®šæ‰€æœ‰å­—æ®µï¼Œæœªä¼ é€’çš„å­—æ®µä¼šè¢«ç½®ç©ºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="åŠ£åŠ¿"&gt;åŠ£åŠ¿
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—å¤§&lt;/strong&gt;ï¼šéœ€ä¼ è¾“å®Œæ•´æ–‡æ¡£ï¼Œç½‘ç»œå’Œå­˜å‚¨å¼€é”€å¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥æ”¾å¤§&lt;/strong&gt;ï¼šæ—§æ–‡æ¡£åœ¨æ®µåˆå¹¶å‰ä»å ç”¨ç£ç›˜ç©ºé—´ï¼Œé«˜é¢‘ç‡æ›¿æ¢æ˜“å¼•å‘æ®µçˆ†ç‚¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†²çªé£é™©&lt;/strong&gt;ï¼šå…¨é‡æ›¿æ¢éœ€ä¸¥æ ¼ç‰ˆæœ¬æ§åˆ¶ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®è¦†ç›–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯-3"&gt;é€‚ç”¨åœºæ™¯
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ–‡æ¡£ç»“æ„å‘ç”Ÿé‡å¤§å˜æ›´ï¼ˆå¦‚æ–°å¢/åˆ é™¤å­—æ®µï¼‰&lt;/li&gt;
&lt;li&gt;æ•°æ®è¿ç§»æˆ–ç´¢å¼•é‡å»ºï¼ˆé€šè¿‡ &lt;code&gt;_reindex&lt;/code&gt; APIï¼‰&lt;/li&gt;
&lt;li&gt;å†·æ•°æ®æ‰¹é‡æ›´æ–°ï¼ˆä½é¢‘æ“ä½œï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®å·®å¼‚å¯¹æ¯”"&gt;å…³é”®å·®å¼‚å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;å¢é‡æ›´æ–°&lt;/th&gt;
&lt;th&gt;å…¨é‡æ›¿æ¢&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç½‘ç»œå¼€é”€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…ä¼ è¾“ä¿®æ”¹å­—æ®µï¼ˆKBçº§ï¼‰&lt;/td&gt;
&lt;td&gt;ä¼ è¾“å®Œæ•´æ–‡æ¡£ï¼ˆMBçº§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨å‹åŠ›&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ—§æ–‡æ¡£é€»è¾‘åˆ é™¤ï¼Œåˆå¹¶åé‡Šæ”¾&lt;/td&gt;
&lt;td&gt;çŸ­æœŸå ç”¨åŒå€å­˜å‚¨ï¼ˆæ—§+æ–°æ–‡æ¡£ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç‰ˆæœ¬æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨ç‰ˆæœ¬é€’å¢ï¼Œæ”¯æŒé‡è¯•ç­–ç•¥&lt;/td&gt;
&lt;td&gt;ç‰ˆæœ¬é€’å¢ï¼Œæ— è‡ªåŠ¨å†²çªè§£å†³æœºåˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨é¢‘ç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜é¢‘ï¼ˆç§’/åˆ†é’Ÿçº§ï¼‰&lt;/td&gt;
&lt;td&gt;ä½é¢‘ï¼ˆå°æ—¶/å¤©çº§ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹å·¥å…·&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;_update&lt;/code&gt; APIã€Painlessè„šæœ¬&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PUT&lt;/code&gt; APIã€&lt;code&gt;_bulk&lt;/code&gt;æ‰¹é‡æ¥å£&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å»ºè®®-1"&gt;é€‰å‹å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆå¢é‡æ›´æ–°&lt;/strong&gt;&lt;br&gt;
å½“ä»…éœ€ä¿®æ”¹éƒ¨åˆ†å­—æ®µæ—¶ï¼ˆå¦‚çŠ¶æ€ã€è®¡æ•°å™¨ï¼‰ï¼Œä½¿ç”¨ &lt;code&gt;_update&lt;/code&gt; æˆ–è„šæœ¬æ›´æ–°ï¼Œç»“åˆè·¯ç”±ï¼ˆ&lt;code&gt;routing&lt;/code&gt;ï¼‰ä¼˜åŒ–åˆ†ç‰‡å®šä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ…ç”¨å…¨é‡æ›¿æ¢&lt;/strong&gt;&lt;br&gt;
è‹¥å¿…é¡»å…¨é‡æ›¿æ¢ï¼Œå»ºè®®ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;_bulk&lt;/code&gt; API æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œå¼€é”€&lt;/li&gt;
&lt;li&gt;è°ƒæ•´ &lt;code&gt;refresh_interval&lt;/code&gt; é™ä½å®æ—¶åˆ·æ–°é¢‘ç‡ï¼ˆå¦‚è®¾ä¸º &lt;code&gt;30s&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†ç‰‡çº§éš”ç¦»é«˜é¢‘æ›´æ–°å­—æ®µï¼ˆå¦‚é€šè¿‡ &lt;code&gt;routing&lt;/code&gt; åˆ†æ•£å‹åŠ›ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆç­–ç•¥&lt;/strong&gt;&lt;br&gt;
å¯¹æ—¢æœ‰å…¨é‡åˆæœ‰å¢é‡éœ€æ±‚çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·ç”»åƒæ›´æ–°ï¼‰ï¼Œå¯å°†é™æ€å­—æ®µï¼ˆå¦‚å§“åï¼‰ä¸åŠ¨æ€å­—æ®µï¼ˆå¦‚æµè§ˆè®°å½•ï¼‰æ‹†åˆ†åˆ°ä¸åŒç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹"&gt;æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ¡ˆä¾‹èƒŒæ™¯&lt;/strong&gt;ï¼šæŸç”µå•†å¹³å°æ¯æ—¥éœ€æ›´æ–° 5 äº¿æ¡å•†å“åº“å­˜æ•°æ®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—®é¢˜&lt;/strong&gt;ï¼šåˆæœŸä½¿ç”¨å…¨é‡æ›¿æ¢ï¼Œå¯¼è‡´æ®µåˆå¹¶é£æš´ï¼ŒæŸ¥è¯¢å»¶è¿Ÿé£™å‡è‡³ 2 ç§’ä»¥ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;æ”¹é€ ä¸ºå¢é‡æ›´æ–°ï¼Œä»…ä¼ é€’ &lt;code&gt;stock&lt;/code&gt; å­—æ®µå’Œç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Painless è„šæœ¬å®ç°åŸå­åŒ–åº“å­˜å¢å‡ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/products/_update/&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;script&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ctx._source.stock -= params.quantity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;params&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="3"&gt;
&lt;li&gt;ç»“æœï¼šå†™å…¥ååé‡æå‡ 4 å€ï¼Œç£ç›˜ç©ºé—´å ç”¨å‡å°‘ 60%ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©æ›´æ–°ç­–ç•¥ï¼Œå¯æ˜¾è‘—å¹³è¡¡ Elasticsearch çš„å®æ—¶æ€§ä¸èµ„æºæ•ˆç‡ã€‚å¯¹äºå¤æ‚åœºæ™¯ï¼Œå»ºè®®ç»“åˆç›‘æ§å·¥å…·ï¼ˆå¦‚ Kibanaï¼‰è·Ÿè¸ªæ®µåˆå¹¶ã€å †å†…å­˜ç­‰æŒ‡æ ‡åŠ¨æ€è°ƒä¼˜&lt;/p&gt;
&lt;h2 id="åŠ¨é™åˆ†ç¦»ä¸å¢é‡æ›´æ–°"&gt;åŠ¨é™åˆ†ç¦»ä¸å¢é‡æ›´æ–°
&lt;/h2&gt;&lt;p&gt;åœ¨æ•°æ®å­˜å‚¨æ¶æ„è®¾è®¡ä¸­ï¼Œå¢é‡æ›´æ–°ä¸åŠ¨é™æ€å­—æ®µåˆ†ç¦»æ˜¯ä¸¤ç§ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ï¼Œå…¶æ ¸å¿ƒç›®æ ‡éƒ½æ˜¯æå‡ç³»ç»Ÿæ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹ä»æŠ€æœ¯åŸç†ã€é€‚ç”¨åœºæ™¯å’Œé€‰å‹å»ºè®®ä¸‰ä¸ªç»´åº¦è¿›è¡Œå¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯åŸç†å¯¹æ¯”"&gt;æŠ€æœ¯åŸç†å¯¹æ¯”
&lt;/h3&gt;&lt;h4 id="å¢é‡æ›´æ–°partial-update-1"&gt;&lt;strong&gt;å¢é‡æ›´æ–°ï¼ˆPartial Updateï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å·¥ä½œæœºåˆ¶&lt;/strong&gt;ï¼šé€šè¿‡Elasticsearchçš„&lt;code&gt;_update&lt;/code&gt; APIä»…ä¿®æ”¹æ–‡æ¡£ä¸­å˜åŒ–çš„å­—æ®µï¼ˆå¦‚è®¡æ•°å™¨ã€çŠ¶æ€å­—æ®µï¼‰ï¼Œé¿å…å…¨æ–‡æ¡£æ›¿æ¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼šæ”¯æŒPainlessè„šæœ¬æ›´æ–°æˆ–ä¼ é€’éƒ¨åˆ†å­—æ®µï¼Œåº•å±‚æ‰§è¡Œé€»è¾‘åˆ é™¤+æ–°å»ºæ–‡æ¡£æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;ï¼šå•æ¬¡æ›´æ–°ä»…ä¼ è¾“å·®å¼‚æ•°æ®ï¼ˆKBçº§ï¼‰ï¼Œä½†é«˜é¢‘æ›´æ–°å¯èƒ½å¯¼è‡´æ®µåˆå¹¶å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åŠ¨é™æ€å­—æ®µåˆ†ç¦»"&gt;&lt;strong&gt;åŠ¨é™æ€å­—æ®µåˆ†ç¦»&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç¦»ç­–ç•¥&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨é™åˆ†ç¦»&lt;/strong&gt;ï¼šå°†é«˜é¢‘å˜åŒ–çš„åŠ¨æ€å­—æ®µï¼ˆå¦‚è®¢å•çŠ¶æ€ï¼‰ä¸ä½é¢‘å˜åŒ–çš„é™æ€å­—æ®µï¼ˆå¦‚å•†å“æè¿°ï¼‰æ‹†åˆ†ä¸ºä¸åŒç´¢å¼•æˆ–å­˜å‚¨ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰©ç†éš”ç¦»&lt;/strong&gt;ï¼šåŠ¨æ€å­—æ®µå¯å­˜å‚¨åœ¨å†…å­˜æ•°æ®åº“ï¼ˆå¦‚Redisï¼‰ï¼Œé™æ€å­—æ®µä¿ç•™åœ¨Elasticsearchä¸»ç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡è·¨ç´¢å¼•æŸ¥è¯¢ï¼ˆå¦‚&lt;code&gt;_msearch&lt;/code&gt;ï¼‰æˆ–ç¼“å­˜æœºåˆ¶åˆå¹¶ç»“æœï¼Œå‡å°‘å…¨é‡æ•°æ®æ‰«æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å¯¹æ¯”"&gt;é€‚ç”¨åœºæ™¯å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¢é‡æ›´æ–°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŠ¨é™æ€å­—æ®µåˆ†ç¦»&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®æ›´æ–°é¢‘ç‡&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜é¢‘ï¼ˆç§’çº§/åˆ†é’Ÿçº§ï¼‰&lt;/td&gt;
&lt;td&gt;åŠ¨æ€å­—æ®µé«˜é¢‘ã€é™æ€å­—æ®µä½é¢‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­—æ®µå˜æ›´èŒƒå›´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å•æ–‡æ¡£å°‘é‡å­—æ®µå˜æ›´ï¼ˆå¦‚ç‚¹èµæ•°+1ï¼‰&lt;/td&gt;
&lt;td&gt;æ–‡æ¡£å†…éƒ¨åˆ†å­—æ®µé¢‘ç¹å˜æ›´ï¼ˆå¦‚å®æ—¶ä½ç½®æ›´æ–°ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥è¯¢å¤æ‚åº¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å…¨æ–‡æ¡£æŸ¥è¯¢æ— å½±å“&lt;/td&gt;
&lt;td&gt;éœ€å¤„ç†è·¨å­—æ®µ/è·¨ç´¢å¼•æŸ¥è¯¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å…¸å‹ä¸šåŠ¡åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç¤¾äº¤äº’åŠ¨ï¼ˆè¯„è®ºæ•°ï¼‰ã€åº“å­˜æ‰£å‡&lt;/td&gt;
&lt;td&gt;ç”µå•†ï¼ˆå•†å“åŸºç¡€ä¿¡æ¯+åº“å­˜ï¼‰ã€ç‰©æµè½¨è¿¹è¿½è¸ª&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;èµ„æºæˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä½ç½‘ç»œå¼€é”€ï¼Œé«˜æ®µåˆå¹¶å‹åŠ›&lt;/td&gt;
&lt;td&gt;éœ€é¢å¤–å­˜å‚¨èµ„æºï¼Œä½†æŸ¥è¯¢æ€§èƒ½æå‡æ˜¾è‘—&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å»ºè®®ä¸æ··åˆç­–ç•¥"&gt;é€‰å‹å»ºè®®ä¸æ··åˆç­–ç•¥
&lt;/h3&gt;&lt;h4 id="ä¼˜å…ˆé€‰æ‹©å¢é‡æ›´æ–°çš„åœºæ™¯"&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©å¢é‡æ›´æ–°çš„åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘å±€éƒ¨ä¿®æ”¹&lt;/strong&gt;ï¼šå½“ä¸šåŠ¡éœ€è¦é¢‘ç¹ä¿®æ”¹å°‘é‡å­—æ®µï¼ˆå¦‚è®¢å•çŠ¶æ€ã€é˜…è¯»é‡ï¼‰æ—¶ï¼Œå¢é‡æ›´æ–°çš„ç½‘ç»œå’Œå­˜å‚¨æˆæœ¬æ›´ä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŸå­æ€§æ“ä½œéœ€æ±‚&lt;/strong&gt;ï¼šä½¿ç”¨Painlessè„šæœ¬å®ç°åŸå­æ“ä½œï¼ˆå¦‚&lt;code&gt;ctx._source.stock -= params.quantity&lt;/code&gt;ï¼‰ï¼Œé¿å…å¹¶å‘å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ€§è¦æ±‚é«˜&lt;/strong&gt;ï¼šå¢é‡æ›´æ–°å¯é€šè¿‡&lt;code&gt;refresh=wait_for&lt;/code&gt;å‚æ•°ç¡®ä¿æ•°æ®ç«‹å³å¯è§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜å…ˆé€‰æ‹©åŠ¨é™æ€åˆ†ç¦»çš„åœºæ™¯"&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©åŠ¨é™æ€åˆ†ç¦»çš„åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µæ›´æ–°æ¨¡å¼å·®å¼‚å¤§&lt;/strong&gt;ï¼šé™æ€å­—æ®µï¼ˆå¦‚ç”¨æˆ·ç”»åƒï¼‰æ¯æœˆæ›´æ–°1æ¬¡ï¼ŒåŠ¨æ€å­—æ®µï¼ˆå¦‚åœ¨çº¿çŠ¶æ€ï¼‰æ¯ç§’æ›´æ–°å¤šæ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆæ˜æ˜¾&lt;/strong&gt;ï¼šé€šè¿‡åˆ†ç¦»é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼ˆå¦‚å•†å“æ ‡é¢˜ï¼‰ä¸ä½é¢‘å­—æ®µï¼ˆå¦‚å†å²è¯„è®ºï¼‰ï¼Œå‡å°‘ç´¢å¼•ä½“ç§¯æå‡æ£€ç´¢é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·çƒ­æ•°æ®åˆ†å±‚&lt;/strong&gt;ï¼šå°†å†å²é™æ€æ•°æ®å½’æ¡£è‡³å†·èŠ‚ç‚¹ï¼ŒåŠ¨æ€æ•°æ®ä¿ç•™åœ¨çƒ­èŠ‚ç‚¹ï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ··åˆç­–ç•¥å®è·µæ¡ˆä¾‹"&gt;&lt;strong&gt;æ··åˆç­–ç•¥å®è·µæ¡ˆä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”µå•†å¹³å°æ··åˆæ–¹æ¡ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™æ€æ•°æ®&lt;/strong&gt;ï¼šå•†å“åŸºç¡€ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ï¼‰å­˜å‚¨åœ¨Elasticsearchä¸»ç´¢å¼•ï¼Œå¯ç”¨&lt;code&gt;&amp;quot;index&amp;quot;: false&lt;/code&gt;ç¦ç”¨éæ£€ç´¢å­—æ®µåˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ•°æ®&lt;/strong&gt;ï¼šåº“å­˜ã€é”€é‡é€šè¿‡&lt;code&gt;_update_by_query&lt;/code&gt;å¢é‡æ›´æ–°ï¼Œå¹¶åŒæ­¥è‡³Redisä¾›ç§’æ€ä¸šåŠ¡ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;multi-search&lt;/code&gt;åˆå¹¶é™æ€å•†å“ä¿¡æ¯ä¸åŠ¨æ€åº“å­˜æ•°æ®ï¼Œå“åº”æ—¶é—´ä»120msé™è‡³45msã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å†³ç­–æ ‘ä¸é£é™©è§„é¿"&gt;å†³ç­–æ ‘ä¸é£é™©è§„é¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†³ç­–è·¯å¾„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;æ˜¯å¦éœ€è¦é¢‘ç¹ä¿®æ”¹å°‘é‡å­—æ®µï¼Ÿ
â†’ æ˜¯ â†’ é€‰æ‹©å¢é‡æ›´æ–°
â†’ å¦ â†’ æ˜¯å¦éœ€è¦ä¼˜åŒ–å¤§æ–‡æ¡£æŸ¥è¯¢æ€§èƒ½ï¼Ÿ
â†’ æ˜¯ â†’ é€‰æ‹©åŠ¨é™æ€åˆ†ç¦»
â†’ å¦ â†’ ç»´æŒç°æœ‰ç»“æ„
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é£é™©æ§åˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¢é‡æ›´æ–°&lt;/strong&gt;ï¼šç›‘æ§æ®µåˆå¹¶é¢‘ç‡ï¼Œé€šè¿‡&lt;code&gt;_forcemerge&lt;/code&gt;å®šæœŸåˆå¹¶ç¢ç‰‡åŒ–æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µåˆ†ç¦»&lt;/strong&gt;ï¼šä½¿ç”¨ç‰ˆæœ¬å·æˆ–äº‹åŠ¡æ—¥å¿—ä¿è¯è·¨å­—æ®µæ•°æ®ä¸€è‡´æ€§ï¼ˆå¦‚è®¢å•çŠ¶æ€ä¸ç‰©æµä¿¡æ¯ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¢é‡æ›´æ–°æ›´é€‚åˆ&lt;strong&gt;é«˜é¢‘å±€éƒ¨ä¿®æ”¹&lt;/strong&gt;åœºæ™¯ï¼Œè€ŒåŠ¨é™æ€åˆ†ç¦»åœ¨&lt;strong&gt;å¤æ‚æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;å’Œ&lt;strong&gt;èµ„æºåˆ†å±‚ç®¡ç†&lt;/strong&gt;ä¸Šè¡¨ç°æ›´ä¼˜ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œå¯ç»“åˆä¸šåŠ¡ç‰¹å¾é‡‡ç”¨æ··åˆç­–ç•¥ï¼Œå¹¶é€šè¿‡æ€§èƒ½å‹æµ‹éªŒè¯æ–¹æ¡ˆæœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ç‰©æµç³»ç»Ÿä¸­ï¼Œè½¨è¿¹åæ ‡ï¼ˆåŠ¨æ€ï¼‰ä½¿ç”¨å¢é‡æ›´æ–°ï¼Œè¿å•è¯¦æƒ…ï¼ˆé™æ€ï¼‰ç‹¬ç«‹å­˜å‚¨ï¼Œå®ç°TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰æå‡3å€&lt;/p&gt;
&lt;h2 id="å­—æ®µå†—ä½™ä¸è·¨ç´¢å¼•æŸ¥è¯¢"&gt;å­—æ®µå†—ä½™ä¸è·¨ç´¢å¼•æŸ¥è¯¢
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;strong&gt;å­—æ®µå†—ä½™&lt;/strong&gt;ä¸&lt;strong&gt;è·¨ç´¢å¼•æŸ¥è¯¢&lt;/strong&gt;æ˜¯ä¸¤ç§å¸¸è§çš„æ•°æ®ç®¡ç†ç­–ç•¥ï¼Œå…¶æ ¸å¿ƒç›®æ ‡å‡æ˜¯ä¸ºäº†ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼Œä½†å®ç°æ–¹å¼å’Œé€‚ç”¨åœºæ™¯å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯ç»“åˆå¤šç¯‡æŠ€æœ¯æ–‡æ¡£çš„ç»¼åˆå¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”"&gt;æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç»´åº¦&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µå†—ä½™&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è·¨ç´¢å¼•æŸ¥è¯¢&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨å¤šä¸ªç´¢å¼•æˆ–æ–‡æ¡£ä¸­å¤åˆ¶ç›¸åŒå­—æ®µæ•°æ®&lt;/td&gt;
&lt;td&gt;é€šè¿‡è”åˆæŸ¥è¯¢å¤šä¸ªç´¢å¼•è·å–å…³è”æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å­˜å‚¨æˆæœ¬&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆé‡å¤å­˜å‚¨ç›¸åŒå­—æ®µï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆä»…å­˜å‚¨ä¸€ä»½æ•°æ®ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå‡å°‘ç½‘ç»œä¼ è¾“å’Œåˆ†ç‰‡æ‰«æï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆéœ€è·¨åˆ†ç‰‡åˆå¹¶ç»“æœï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ•°æ®ä¸€è‡´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»´æŠ¤æˆæœ¬é«˜ï¼ˆéœ€åŒæ­¥æ›´æ–°å†—ä½™å­—æ®µï¼‰&lt;/td&gt;
&lt;td&gt;å¤©ç„¶ä¸€è‡´æ€§ï¼ˆå•ç‚¹å­˜å‚¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é«˜é¢‘æŸ¥è¯¢å­—æ®µã€å®æ—¶æ€§è¦æ±‚é«˜&lt;/td&gt;
&lt;td&gt;ä½é¢‘å…³è”æŸ¥è¯¢ã€å†·çƒ­æ•°æ®åˆ†å±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯å®ç°ä¸æ€§èƒ½å½±å“"&gt;æŠ€æœ¯å®ç°ä¸æ€§èƒ½å½±å“
&lt;/h3&gt;&lt;h4 id="å­—æ®µå†—ä½™çš„å®ç°ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;å­—æ®µå†—ä½™çš„å®ç°ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯åŸç†&lt;/strong&gt;ï¼š&lt;br&gt;
å°†é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼ˆå¦‚ç”¨æˆ·åç§°ã€å•†å“æ ‡é¢˜ï¼‰ç›´æ¥åµŒå…¥åˆ°å…³è”æ–‡æ¡£ä¸­ã€‚ä¾‹å¦‚åœ¨åšå®¢ç´¢å¼•ä¸­å†—ä½™ç”¨æˆ·ä¿¡æ¯ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT&lt;/span&gt; &lt;span class="err"&gt;/website/blogs/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;å°é±¼å„¿çš„ç¬¬ä¸€ç¯‡åšå®¢&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;userInfo&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;username&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;å°é±¼å„¿&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="c1"&gt;// å†—ä½™ç”¨æˆ·ä¿¡æ¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘è·¨ç´¢å¼•æŸ¥è¯¢æ¬¡æ•°&lt;/strong&gt;ï¼šé€šè¿‡ä¸€æ¬¡æŸ¥è¯¢å³å¯è·å–å®Œæ•´æ•°æ®ï¼Œå»¶è¿Ÿé™ä½ 3-5 å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ©ç”¨ç¼“å­˜æœºåˆ¶&lt;/strong&gt;ï¼šå†—ä½™å­—æ®µå¯è¢«å­—æ®µç¼“å­˜ï¼ˆFielddata Cacheï¼‰åŠ é€Ÿèšåˆæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£é™©ä¸é™åˆ¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨è†¨èƒ€&lt;/strong&gt;ï¼šå†—ä½™å¤§å­—æ®µï¼ˆå¦‚é•¿æ–‡æœ¬ï¼‰å¯èƒ½å¯¼è‡´ç´¢å¼•ä½“ç§¯ç¿»å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥å¤æ‚åº¦&lt;/strong&gt;ï¼šéœ€é€šè¿‡åº”ç”¨å±‚é€»è¾‘æˆ– ETL å·¥å…·ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="è·¨ç´¢å¼•æŸ¥è¯¢çš„å®ç°ä¸ä¼˜åŒ–"&gt;&lt;strong&gt;è·¨ç´¢å¼•æŸ¥è¯¢çš„å®ç°ä¸ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŠ€æœ¯åŸç†&lt;/strong&gt;ï¼š&lt;br&gt;
é€šè¿‡ &lt;code&gt;_msearch&lt;/code&gt; æˆ–åˆ«åï¼ˆAliasï¼‰è”åˆæŸ¥è¯¢å¤šä¸ªç´¢å¼•ã€‚ä¾‹å¦‚ç”µå•†å¹³å°è”åˆæŸ¥è¯¢å•†å“ä¸åº“å­˜ç´¢å¼•ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/products_zh,inventory_&lt;/span&gt;&lt;span class="mi"&gt;2023&lt;/span&gt;&lt;span class="err"&gt;q&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="err"&gt;/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;sku&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;P12345&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡è·¯ç”±ä¼˜åŒ–&lt;/strong&gt;ï¼šä½¿ç”¨ç›¸åŒè·¯ç”±é”®ï¼ˆ&lt;code&gt;routing=user_id&lt;/code&gt;ï¼‰ç¡®ä¿å…³è”æ•°æ®è½äºåŒä¸€åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·çƒ­æ•°æ®åˆ†å±‚&lt;/strong&gt;ï¼šå°†å†å²æ•°æ®å½’æ¡£è‡³ä½æ€§èƒ½å­˜å‚¨ï¼Œé€šè¿‡è·¨é›†ç¾¤æœç´¢ï¼ˆCCSï¼‰å®ç°ç»Ÿä¸€æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œå¼€é”€&lt;/strong&gt;ï¼šåè°ƒèŠ‚ç‚¹éœ€åˆå¹¶å¤šä¸ªåˆ†ç‰‡ç»“æœï¼ŒP99 å»¶è¿Ÿå¯èƒ½å¢åŠ  50-200msã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡çˆ†ç‚¸&lt;/strong&gt;ï¼šè·¨ 7 å¤©æ—¥å¿—ç´¢å¼•æŸ¥è¯¢å¯èƒ½æ¶‰åŠ 70+ åˆ†ç‰‡ï¼ŒCPU è´Ÿè½½æå‡ 40%ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å†³ç­–æ ‘ä¸åœºæ™¯é€‚é…"&gt;é€‰å‹å†³ç­–æ ‘ä¸åœºæ™¯é€‚é…
&lt;/h3&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;æ˜¯å¦éœ€è¦æ¯«ç§’çº§å“åº”ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ é€‰æ‹©å­—æ®µå†—ä½™ï¼ˆä¼˜å…ˆé«˜é¢‘æŸ¥è¯¢å­—æ®µï¼‰
â””â”€â”€ å¦ â†’ æ˜¯å¦éœ€è¦é•¿æœŸæ•°æ®å…³è”æ€§ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ è·¨ç´¢å¼•æŸ¥è¯¢ + å†·çƒ­åˆ†å±‚ï¼ˆä½¿ç”¨ CCS æˆ–ç´¢å¼•åˆ«åï¼‰
â””â”€â”€ å¦ â†’ åº”ç”¨å±‚ Joinï¼ˆé€‚åˆä½é¢‘å°æ•°æ®é›†ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="å…¸å‹åœºæ™¯ç¤ºä¾‹"&gt;&lt;strong&gt;å…¸å‹åœºæ™¯ç¤ºä¾‹&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”µå•†å•†å“æœç´¢&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†—ä½™å­—æ®µ&lt;/strong&gt;ï¼šå•†å“æ ‡é¢˜ã€ä»·æ ¼ï¼ˆé«˜é¢‘æŸ¥è¯¢å­—æ®µï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨ç´¢å¼•æŸ¥è¯¢&lt;/strong&gt;ï¼šåº“å­˜çŠ¶æ€ï¼ˆä½é¢‘æ›´æ–°ï¼Œè·¨ &lt;code&gt;products&lt;/code&gt; å’Œ &lt;code&gt;inventory&lt;/code&gt; ç´¢å¼•ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—åˆ†æç³»ç»Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†—ä½™å­—æ®µ&lt;/strong&gt;ï¼šé”™è¯¯ä»£ç ã€æœåŠ¡åç§°ï¼ˆå®æ—¶èšåˆï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨ç´¢å¼•æŸ¥è¯¢&lt;/strong&gt;ï¼šè”åˆåˆ†æ Nginxã€Appã€DB æ—¥å¿—ï¼ˆä½é¢‘ä½†éœ€å…¨å±€è§†å›¾ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ··åˆç­–ç•¥ä¸è¿›é˜¶ä¼˜åŒ–"&gt;æ··åˆç­–ç•¥ä¸è¿›é˜¶ä¼˜åŒ–
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€å†—ä½™å­—æ®µ&lt;/strong&gt;&lt;br&gt;
å¯¹é«˜é¢‘æ›´æ–°çš„å­—æ®µï¼ˆå¦‚åº“å­˜é‡ï¼‰ï¼Œä½¿ç”¨ &lt;code&gt;_update&lt;/code&gt; è„šæœ¬å±€éƒ¨æ›´æ–°ï¼Œé¿å…å…¨æ–‡æ¡£æ›¿æ¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/products/_update/&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;script&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ctx._source.stock -= params.quantity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;params&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰&lt;/strong&gt;&lt;br&gt;
ç»“åˆå†·çƒ­åˆ†å±‚ç­–ç•¥ï¼ŒåŠ¨æ€æ§åˆ¶å†—ä½™å­—æ®µçš„ç”Ÿå‘½å‘¨æœŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çƒ­æ•°æ®é˜¶æ®µ&lt;/strong&gt;ï¼šå…¨å­—æ®µå†—ä½™ï¼ˆ7 å¤©ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¸©æ•°æ®é˜¶æ®µ&lt;/strong&gt;ï¼šä»…ä¿ç•™å…³é”®å­—æ®µï¼ˆ30 å¤©ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·æ•°æ®é˜¶æ®µ&lt;/strong&gt;ï¼šåˆ é™¤å†—ä½™å­—æ®µï¼ˆå½’æ¡£è‡³å¯¹è±¡å­˜å‚¨ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½è°ƒä¼˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨éå¿…è¦åˆ†æ&lt;/strong&gt;ï¼šå¯¹å†—ä½™çš„ ID ç±»å­—æ®µè®¾ä¸º &lt;code&gt;&amp;quot;index&amp;quot;: false&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–åˆ†ç‰‡é…ç½®&lt;/strong&gt;ï¼šå•èŠ‚ç‚¹åˆ†ç‰‡æ•°æ§åˆ¶åœ¨ 20 ä»¥å†…ï¼Œé¿å…è·¨ç´¢å¼•æŸ¥è¯¢åˆ†ç‰‡çˆ†ç‚¸&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-4"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆå­—æ®µå†—ä½™&lt;/strong&gt;ï¼šé€‚ç”¨äºå®æ—¶æ€§è¦æ±‚é«˜ã€å­—æ®µæ›´æ–°é¢‘ç‡ä½çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ…ç”¨è·¨ç´¢å¼•æŸ¥è¯¢&lt;/strong&gt;ï¼šåœ¨æ•°æ®å…³è”æ€§å¼ºã€å­˜å‚¨æˆæœ¬æ•æ„Ÿçš„åœºæ™¯ä¸‹æ›´å…·ä¼˜åŠ¿ï¼ˆå¦‚æ—¥å¿—åˆ†æï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆç­–ç•¥&lt;/strong&gt;ï¼šé€šè¿‡åŠ¨æ€å†—ä½™å’Œå†·çƒ­åˆ†å±‚å¹³è¡¡æ€§èƒ½ä¸æˆæœ¬ï¼Œä¾‹å¦‚å°†çƒ­æ•°æ®å†—ä½™ã€å†·æ•°æ®è·¨ç´¢å¼•æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†é€‰æ‹©ç­–ç•¥ï¼Œå¯æ˜¾è‘—æå‡ Elasticsearch çš„æŸ¥è¯¢æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ç‡ã€‚å»ºè®®ç»“åˆ Kibana ç›‘æ§å·¥å…·ï¼Œå®šæœŸåˆ†ææ®µåˆå¹¶ã€å †å†…å­˜ç­‰æŒ‡æ ‡åŠ¨æ€è°ƒä¼˜&lt;/p&gt;
&lt;h2 id="çˆ¶å­å…³è”"&gt;çˆ¶å­å…³è”
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data Elasticsearch ä¸­ï¼Œè‹¥è¦é€šè¿‡ &lt;code&gt;postId&lt;/code&gt; å­—æ®µå…³è” &lt;code&gt;comment&lt;/code&gt; æ–‡æ¡£ä¸ &lt;code&gt;post&lt;/code&gt; æ–‡æ¡£ï¼Œéœ€æ ¹æ®å…³è”åœºæ™¯é€‰æ‹©ä¸åŒçš„ &lt;code&gt;@Field&lt;/code&gt; é…ç½®æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹å¼åŠé€‚ç”¨åœºæ™¯åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åœºæ™¯ä¸€åº”ç”¨å±‚å…³è”æ¨è"&gt;åœºæ™¯ä¸€ï¼šåº”ç”¨å±‚å…³è”ï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥ &lt;code&gt;post&lt;/code&gt; å’Œ &lt;code&gt;comment&lt;/code&gt; æ˜¯ç‹¬ç«‹ç´¢å¼•ä¸”æ— å¤æ‚æŸ¥è¯¢éœ€æ±‚ï¼Œ&lt;strong&gt;ç›´æ¥é€šè¿‡ &lt;code&gt;postId&lt;/code&gt; å»ºç«‹é€»è¾‘å…³è”&lt;/strong&gt;å³å¯ã€‚æ­¤æ—¶ &lt;code&gt;@Field&lt;/code&gt; é…ç½®ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­˜å‚¨çˆ¶æ–‡æ¡£ post çš„ ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨è½»é‡&lt;/strong&gt;ï¼šä»…éœ€å­˜å‚¨çˆ¶æ–‡æ¡£ IDï¼Œæ— é¢å¤–å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢çµæ´»&lt;/strong&gt;ï¼šé€šè¿‡ä¸¤æ¬¡æŸ¥è¯¢å®ç°å…³è”ï¼ˆå…ˆæŸ¥ &lt;code&gt;post&lt;/code&gt; æ–‡æ¡£ï¼Œå†ç”¨å…¶ ID æŸ¥ &lt;code&gt;comment&lt;/code&gt; æ–‡æ¡£ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šç®€å•çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œå¦‚è¯„è®ºé‡è¾ƒå°‘æˆ–æŸ¥è¯¢é¢‘ç‡ä½çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="åœºæ™¯äºŒçˆ¶å­æ–‡æ¡£join-ç±»å‹"&gt;åœºæ™¯äºŒï¼šçˆ¶å­æ–‡æ¡£ï¼ˆJoin ç±»å‹ï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€åœ¨ &lt;strong&gt;åŒä¸€ç´¢å¼•&lt;/strong&gt; ä¸­å»ºç«‹çˆ¶å­å…³ç³»å¹¶æ”¯æŒé«˜æ•ˆå…³è”æŸ¥è¯¢ï¼Œéœ€ä½¿ç”¨ Elasticsearch çš„ &lt;code&gt;join&lt;/code&gt; æ•°æ®ç±»å‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Join&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;post_comment_relation&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;relations&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;post&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JoinField&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;relation&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é…ç½®è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰å…³è”å…³ç³»&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;post&lt;/code&gt; è¡¨ç¤ºçˆ¶æ–‡æ¡£ç±»å‹ï¼Œ&lt;code&gt;comment&lt;/code&gt; è¡¨ç¤ºå­æ–‡æ¡£ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;çˆ¶æ–‡æ¡£ä¸­ &lt;code&gt;relation&lt;/code&gt; å­—æ®µå€¼ä¸º &lt;code&gt;&amp;quot;post&amp;quot;&lt;/code&gt;ï¼Œå­æ–‡æ¡£ä¸­ä¸º &lt;code&gt;&amp;quot;comment&amp;quot;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­æ–‡æ¡£å®ä½“éœ€é¢å¤–é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Parent&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­˜å‚¨çˆ¶æ–‡æ¡£ ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æŸ post çš„æ‰€æœ‰è¯„è®º&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;NativeSearchQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NativeSearchQueryBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hasChildQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;matchAllQuery&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ScoreMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;None&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆå…³è”æŸ¥è¯¢&lt;/strong&gt;ï¼šæ”¯æŒ &lt;code&gt;has_child&lt;/code&gt; å’Œ &lt;code&gt;has_parent&lt;/code&gt; æŸ¥è¯¢ï¼Œå‡å°‘å¤šæ¬¡æŸ¥è¯¢å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡è·¯ç”±ä¼˜åŒ–&lt;/strong&gt;ï¼šçˆ¶å­æ–‡æ¡£éœ€é€šè¿‡ &lt;code&gt;routing&lt;/code&gt; å‚æ•°ç¡®ä¿å­˜å‚¨åœ¨åŒä¸€åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¯„è®ºæ›´æ–°é¢‘ç¹ã€éœ€è¦å®æ—¶çˆ¶å­å…³è”åˆ†æçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="åœºæ™¯ä¸‰åµŒå¥—å¯¹è±¡nested-ç±»å‹"&gt;åœºæ™¯ä¸‰ï¼šåµŒå¥—å¯¹è±¡ï¼ˆNested ç±»å‹ï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥ &lt;code&gt;comment&lt;/code&gt; æ–‡æ¡£ç›´æ¥å†…åµŒåœ¨ &lt;code&gt;post&lt;/code&gt; æ–‡æ¡£ä¸­ï¼ˆéç‹¬ç«‹æ–‡æ¡£ï¼‰ï¼Œéœ€ä½¿ç”¨ &lt;code&gt;nested&lt;/code&gt; ç±»å‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Nested&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Comment&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå­æ€§å­˜å‚¨&lt;/strong&gt;ï¼šè¯„è®ºä¸å¸–å­ä½œä¸ºæ•´ä½“å­˜å‚¨ï¼Œæ›´æ–°éœ€é‡å†™æ•´ä¸ªæ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç²¾å‡†æŸ¥è¯¢&lt;/strong&gt;ï¼šé¿å…å¯¹è±¡æ•°ç»„æ‰å¹³åŒ–å¯¼è‡´é”™è¯¯åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šè¯„è®ºé‡å°‘ã€æ›´æ–°é¢‘ç‡ä½çš„åœºæ™¯ï¼ˆå¦‚åšå®¢æ–‡ç« ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å»ºè®®-2"&gt;é€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ›´æ–°çµæ´»æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¼•ç”¨ä¾æ®&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åº”ç”¨å±‚å…³è”&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ç®€å•æŸ¥è¯¢ã€è·¨ç´¢å¼•å…³è”&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;çˆ¶å­æ–‡æ¡£&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é¢‘ç¹å…³è”æŸ¥è¯¢ã€åŒä¸€ç´¢å¼•&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åµŒå¥—å¯¹è±¡&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;å°‘é‡è¯„è®ºã€æ— éœ€ç‹¬ç«‹æ›´æ–°&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé€‰æ‹© &lt;strong&gt;åº”ç”¨å±‚å…³è”&lt;/strong&gt;ï¼ˆç®€å•æ˜“ç»´æŠ¤ï¼‰ï¼Œé™¤éæ˜ç¡®éœ€è¦ Elasticsearch åŸç”Ÿå…³è”æŸ¥è¯¢åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥éœ€é«˜æ€§èƒ½å…³è”æŸ¥è¯¢ä¸”æ¥å—ç»´æŠ¤æˆæœ¬ï¼Œé€‰æ‹© &lt;strong&gt;çˆ¶å­æ–‡æ¡£&lt;/strong&gt;ï¼ˆéœ€æ³¨æ„åˆ†ç‰‡è·¯ç”±å’Œå†…å­˜å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…æ»¥ç”¨ &lt;code&gt;nested&lt;/code&gt; ç±»å‹ï¼Œå…¶æ›´æ–°æˆæœ¬è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="çˆ¶å­æ–‡æ¡£"&gt;çˆ¶å­æ–‡æ¡£
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ä½¿ç”¨ &lt;strong&gt;Join ç±»å‹&lt;/strong&gt;çš„çˆ¶å­æ–‡æ¡£æ—¶ï¼ŒæŸ¥è¯¢å­æ–‡æ¡£ï¼ˆå¦‚ &lt;code&gt;comment&lt;/code&gt;ï¼‰æ— æ³•ç›´æ¥é€šè¿‡å…³è”è·å–çˆ¶æ–‡æ¡£ï¼ˆå¦‚ &lt;code&gt;post&lt;/code&gt;ï¼‰çš„å­—æ®µå†…å®¹ï¼ˆå¦‚ &lt;code&gt;postSubject&lt;/code&gt;ï¼‰ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆå®ç°éœ€æ±‚ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ¡ˆå¯¹æ¯”ä¸å®ç°æ–¹å¼"&gt;æ–¹æ¡ˆå¯¹æ¯”ä¸å®ç°æ–¹å¼
&lt;/h3&gt;&lt;h4 id="å†—ä½™å­—æ®µå­˜å‚¨æ¨è"&gt;&lt;strong&gt;å†—ä½™å­—æ®µå­˜å‚¨ï¼ˆæ¨èï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šåœ¨å­æ–‡æ¡£ä¸­ç›´æ¥å­˜å‚¨çˆ¶æ–‡æ¡£çš„å…³é”®å­—æ®µï¼ˆå¦‚ &lt;code&gt;postSubject&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Comment æ–‡æ¡£å®ä½“ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indexName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;posts_comments&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Comment&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çˆ¶æ–‡æ¡£ ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postSubject&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å†—ä½™å­˜å‚¨çˆ¶æ–‡æ¡£çš„æ ‡é¢˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½é«˜&lt;/strong&gt;ï¼šå•æ¬¡æŸ¥è¯¢å³å¯è·å–æ‰€æœ‰å…³è”æ•°æ®ï¼Œæ— éœ€äºŒæ¬¡æ£€ç´¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€å•æ˜“ç»´æŠ¤&lt;/strong&gt;ï¼šé¿å…å¤æ‚æŸ¥è¯¢é€»è¾‘ï¼Œé€‚åˆé«˜é¢‘è®¿é—®åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ£åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å†—ä½™&lt;/strong&gt;ï¼šéœ€åŒæ­¥æ›´æ–°çˆ¶å­æ–‡æ¡£çš„å…¬å…±å­—æ®µï¼ˆå¦‚ &lt;code&gt;postSubject&lt;/code&gt; ä¿®æ”¹æ—¶éœ€è§¦å‘å­æ–‡æ¡£æ›´æ–°ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="çˆ¶å­æ–‡æ¡£äºŒæ¬¡æŸ¥è¯¢"&gt;&lt;strong&gt;çˆ¶å­æ–‡æ¡£äºŒæ¬¡æŸ¥è¯¢&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;has_parent&lt;/code&gt; æŸ¥è¯¢å…ˆå®šä½çˆ¶æ–‡æ¡£ï¼Œå†é€šè¿‡è„šæœ¬æˆ–åº”ç”¨å±‚é€»è¾‘å…³è”å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æ‰€æœ‰è¯„è®ºï¼Œå¹¶å…³è”çˆ¶æ–‡æ¡£æ ‡é¢˜ï¼ˆéœ€äºŒæ¬¡æŸ¥è¯¢ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/posts_comments/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;has_parent&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;parent_type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;post&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;subject&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Elasticsearch&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨å±‚å¤„ç†&lt;/strong&gt;ï¼šæ ¹æ®è¿”å›çš„ &lt;code&gt;postId&lt;/code&gt; å†æŸ¥è¯¢çˆ¶æ–‡æ¡£è·å– &lt;code&gt;postSubject&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æ— å†—ä½™&lt;/strong&gt;ï¼šä¿æŒçˆ¶å­æ–‡æ¡£ç‹¬ç«‹æ€§ï¼Œæ›´æ–°çˆ¶æ–‡æ¡£ä¸å½±å“å­æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ£åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½æŸè€—&lt;/strong&gt;ï¼šå¤šæ¬¡æŸ¥è¯¢å¢åŠ å»¶è¿Ÿï¼Œä¸é€‚åˆé«˜é¢‘åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚åº¦é«˜&lt;/strong&gt;ï¼šéœ€ç»´æŠ¤æŸ¥è¯¢é€»è¾‘å’Œçˆ¶å­æ–‡æ¡£è·¯ç”±ä¸€è‡´æ€§ï¼ˆå¦‚ &lt;code&gt;routing=postId&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å»ºè®®-3"&gt;é€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç†ç”±&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜é¢‘æŸ¥è¯¢ï¼ˆå¦‚å®æ—¶å±•ç¤ºï¼‰&lt;/td&gt;
&lt;td&gt;å†—ä½™å­—æ®µ&lt;/td&gt;
&lt;td&gt;å•æ¬¡æŸ¥è¯¢å³å¯è¿”å›å®Œæ•´æ•°æ®ï¼Œå‡å°‘å»¶è¿Ÿã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä½é¢‘åˆ†æï¼ˆå¦‚å†å²ç»Ÿè®¡ï¼‰&lt;/td&gt;
&lt;td&gt;çˆ¶å­æ–‡æ¡£äºŒæ¬¡æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;é¿å…å†—ä½™å­˜å‚¨ï¼Œé€‚åˆæ•°æ®æ›´æ–°é¢‘ç¹ä½†æŸ¥è¯¢è¾ƒå°‘çš„åœºæ™¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—æ®µæ›´æ–°é¢‘ç¹&lt;/td&gt;
&lt;td&gt;çˆ¶å­æ–‡æ¡£äºŒæ¬¡æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;é¿å…å› çˆ¶æ–‡æ¡£å­—æ®µå˜æ›´è§¦å‘å¤§è§„æ¨¡å­æ–‡æ¡£æ›´æ–°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­˜å‚¨æˆæœ¬æ•æ„Ÿ&lt;/td&gt;
&lt;td&gt;çˆ¶å­æ–‡æ¡£äºŒæ¬¡æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;èŠ‚çœç£ç›˜ç©ºé—´ï¼Œé€‚åˆæµ·é‡å­æ–‡æ¡£åœºæ™¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é«˜çº§ä¼˜åŒ–æŠ€å·§"&gt;é«˜çº§ä¼˜åŒ–æŠ€å·§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆå­˜å‚¨ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å­æ–‡æ¡£ä¸­å†—ä½™éƒ¨åˆ†é«˜é¢‘è®¿é—®çš„çˆ¶å­—æ®µï¼ˆå¦‚ &lt;code&gt;postSubject&lt;/code&gt;ï¼‰ï¼Œå…¶ä»–ä½é¢‘å­—æ®µé€šè¿‡äºŒæ¬¡æŸ¥è¯¢è·å–ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postSubject&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é«˜é¢‘å­—æ®µå†—ä½™&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postAuthor&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä½é¢‘å­—æ®µä¸å†—ä½™ï¼Œéœ€äºŒæ¬¡æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Inner Hits æ‰©å±•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;inner_hits&lt;/code&gt; åœ¨å•æ¬¡æŸ¥è¯¢ä¸­è¿”å›çˆ¶å­æ–‡æ¡£å…³è”å†…å®¹ï¼ˆéœ€ Elasticsearch 7.3+ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/posts_comments/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;has_parent&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;parent_type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;post&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;inner_hits&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;match_all&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šå“åº”ä¸­åŒ…å«çˆ¶æ–‡æ¡£çš„ &lt;code&gt;_source&lt;/code&gt; æ•°æ®ï¼Œä½†æ€§èƒ½ä½äºå†—ä½™å­—æ®µæ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-5"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Join ç±»å‹é™åˆ¶&lt;/strong&gt;ï¼šçˆ¶å­æ–‡æ¡£çš„å…³è”æŸ¥è¯¢æœ¬è´¨ä¸Šæ˜¯é€»è¾‘å…³è”ï¼Œæ— æ³•ç›´æ¥è·¨æ–‡æ¡£è¯»å–å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©å†—ä½™å­—æ®µæˆ–äºŒæ¬¡æŸ¥è¯¢ï¼Œä¼˜å…ˆè€ƒè™‘æŸ¥è¯¢æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•å»ºè®®&lt;/strong&gt;ï¼šå¯¹æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼Œå¯é€šè¿‡ç›‘å¬çˆ¶æ–‡æ¡£å˜æ›´äº‹ä»¶ï¼ˆå¦‚ Elasticsearch çš„ &lt;code&gt;Update By Query&lt;/code&gt;ï¼‰è‡ªåŠ¨åŒæ­¥å­æ–‡æ¡£å†—ä½™å­—æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="è·¯ç”±é”®"&gt;è·¯ç”±é”®
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;strong&gt;è·¯ç”±é”®ï¼ˆRouting Keyï¼‰åªèƒ½æŒ‡å®šä¸€ä¸ªå€¼&lt;/strong&gt;ï¼Œä½†è¿™ä¸€å€¼çš„æ¥æºå¯ä»¥æ˜¯åŠ¨æ€é€‰æ‹©çš„å­—æ®µæˆ–è‡ªå®šä¹‰ç»„åˆã€‚å…¶æ ¸å¿ƒé€»è¾‘æ˜¯é€šè¿‡å•ä¸€çš„è·¯ç”±é”®å€¼å†³å®šæ–‡æ¡£å­˜å‚¨çš„åˆ†ç‰‡ä½ç½®ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è·¯ç”±é”®çš„é»˜è®¤ä¸è‡ªå®šä¹‰è§„åˆ™"&gt;è·¯ç”±é”®çš„é»˜è®¤ä¸è‡ªå®šä¹‰è§„åˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤è·¯ç”±é”®&lt;/strong&gt;&lt;br&gt;
é»˜è®¤ä½¿ç”¨æ–‡æ¡£çš„ &lt;code&gt;_id&lt;/code&gt; å­—æ®µä½œä¸ºè·¯ç”±é”®ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š&lt;br&gt;
&lt;code&gt;shard_num = hash(_id) % number_of_primary_shards&lt;/code&gt;ã€‚&lt;br&gt;
è¿™æ„å‘³ç€æœªæ˜¾å¼æŒ‡å®šè·¯ç”±é”®æ—¶ï¼Œæ–‡æ¡£ä¼šæ ¹æ® &lt;code&gt;_id&lt;/code&gt; çš„å“ˆå¸Œå€¼åˆ†é…åˆ°æŸä¸ªä¸»åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰è·¯ç”±é”®&lt;/strong&gt;&lt;br&gt;
ç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æŒ‡å®šä»»æ„å­—æ®µæˆ–å€¼ä½œä¸ºè·¯ç”±é”®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT&lt;/span&gt; &lt;span class="err"&gt;/index/_doc/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="err"&gt;?routing=user_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;test&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶ï¼Œè·¯ç”±é”®ä¸º &lt;code&gt;user_123&lt;/code&gt;ï¼Œè€Œé &lt;code&gt;_id&lt;/code&gt;ã€‚è™½ç„¶è·¯ç”±é”®å€¼å¯è‡ªç”±å®šä¹‰ï¼Œä½†&lt;strong&gt;æ¯ä¸ªæ–‡æ¡£åªèƒ½æœ‰ä¸€ä¸ªè·¯ç”±é”®å€¼&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è·¯ç”±é”®çš„çµæ´»æ€§ä¸åº”ç”¨åœºæ™¯"&gt;è·¯ç”±é”®çš„çµæ´»æ€§ä¸åº”ç”¨åœºæ™¯
&lt;/h3&gt;&lt;p&gt;å°½ç®¡åªèƒ½æŒ‡å®šä¸€ä¸ªè·¯ç”±é”®å€¼ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°çµæ´»çš„è·¯ç”±ç­–ç•¥ï¼š&lt;/p&gt;
&lt;h4 id="åŠ¨æ€å­—æ®µç»„åˆ"&gt;&lt;strong&gt;åŠ¨æ€å­—æ®µç»„åˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å°†å¤šä¸ªå­—æ®µæ‹¼æ¥åä½œä¸ºè·¯ç”±é”®ã€‚ä¾‹å¦‚ï¼Œå°†ç”¨æˆ· ID å’Œåœ°åŸŸ ID åˆå¹¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT&lt;/span&gt; &lt;span class="err"&gt;/orders/_doc/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="err"&gt;?routing=user_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="err"&gt;_region_east&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;region&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;east&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶è·¯ç”±é”® &lt;code&gt;user_123_region_east&lt;/code&gt; æ˜¯ç»„åˆåçš„å•ä¸€å€¼ï¼Œä½†å®ç°äº†å¤šå­—æ®µé€»è¾‘ç»‘å®šã€‚&lt;/p&gt;
&lt;h4 id="åˆ«åä¸­çš„å¤šè·¯ç”±å‚æ•°"&gt;&lt;strong&gt;åˆ«åä¸­çš„å¤šè·¯ç”±å‚æ•°&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ç´¢å¼•åˆ«åï¼ˆAliasï¼‰ä¸ºè¯»å†™æ“ä½œæŒ‡å®šä¸åŒçš„è·¯ç”±é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/_aliases&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;actions&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;add&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;orders&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;alias&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;orders_alias&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;index_routing&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;// å†™å…¥æ—¶æŒ‰ç”¨æˆ· ID è·¯ç”±
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;search_routing&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;region&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// æŸ¥è¯¢æ—¶æŒ‰åœ°åŸŸè·¯ç”±
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§æ–¹å¼å…è®¸å†™å…¥å’ŒæŸ¥è¯¢é˜¶æ®µä½¿ç”¨ä¸åŒè·¯ç”±é”®ï¼Œä½†æ¯ä¸ªæ“ä½œå†…éƒ¨ä»ä»…ä½¿ç”¨å•ä¸€å€¼ã€‚&lt;/p&gt;
&lt;h4 id="ä¸šåŠ¡åœºæ™¯é€‚é…"&gt;&lt;strong&gt;ä¸šåŠ¡åœºæ™¯é€‚é…&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼šå°†åŒä¸€ç”¨æˆ·çš„æ•°æ®è·¯ç”±åˆ°åŒä¸€åˆ†ç‰‡ï¼ˆå¦‚ &lt;code&gt;routing=user_id&lt;/code&gt;ï¼‰ï¼Œæå‡æ‰¹é‡æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·çƒ­æ•°æ®éš”ç¦»&lt;/strong&gt;ï¼šæŒ‰æ—¶é—´èŒƒå›´è·¯ç”±ï¼ˆå¦‚ &lt;code&gt;routing=2025Q1&lt;/code&gt;ï¼‰ï¼Œç»“åˆ ILM ç­–ç•¥å®ç°å†·çƒ­åˆ†å±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é™åˆ¶ä¸æ³¨æ„äº‹é¡¹"&gt;é™åˆ¶ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†ç‰‡æ•°é‡ä¸å¯å˜&lt;/strong&gt;&lt;br&gt;
è·¯ç”±ç®—æ³•ä¾èµ–ä¸»åˆ†ç‰‡æ•°é‡ï¼ˆ&lt;code&gt;number_of_primary_shards&lt;/code&gt;ï¼‰ï¼Œåˆ›å»ºç´¢å¼•åä¸å¯ä¿®æ”¹ï¼Œå¦åˆ™ä¼šå¯¼è‡´è·¯ç”±å¤±æ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†²çªé£é™©&lt;/strong&gt;&lt;br&gt;
ä¸åŒè·¯ç”±é”®å¯èƒ½å“ˆå¸Œåˆ°åŒä¸€åˆ†ç‰‡ï¼Œéœ€é€šè¿‡ä¸šåŠ¡è®¾è®¡é¿å…çƒ­ç‚¹åˆ†ç‰‡è´Ÿè½½ä¸å‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
è·¨åˆ†ç‰‡æŸ¥è¯¢æ—¶éœ€æ˜¾å¼æŒ‡å®šè·¯ç”±é”®ï¼Œå¦åˆ™å¯èƒ½é—æ¼éƒ¨åˆ†æ•°æ®ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/orders/_search?routing=user_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_123&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-6"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•ä¸€æ€§é™åˆ¶&lt;/strong&gt;ï¼šæ¯ä¸ªæ–‡æ¡£çš„è·¯ç”±é”®åªèƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä½†å¯é€šè¿‡ç»„åˆå­—æ®µæˆ–åŠ¨æ€ç­–ç•¥å®ç°å¤šç»´åº¦é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»åº”ç”¨&lt;/strong&gt;ï¼šç»“åˆåˆ«åã€è„šæœ¬å’Œä¸šåŠ¡è®¾è®¡ï¼Œå¯çªç ´å•ä¸€å€¼çš„å±€é™ï¼Œæ»¡è¶³å¤æ‚åœºæ™¯éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜å…ˆ&lt;/strong&gt;ï¼šåˆç†é€‰æ‹©è·¯ç”±é”®ï¼ˆå¦‚é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼‰èƒ½æ˜¾è‘—æå‡é›†ç¾¤ååé‡ä¸å“åº”é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå»ºè®®é€šè¿‡ &lt;code&gt;_cat/shards&lt;/code&gt; ç›‘æ§åˆ†ç‰‡è´Ÿè½½ï¼Œå¹¶åˆ©ç”¨ Painless è„šæœ¬åŠ¨æ€ç”Ÿæˆè·¯ç”±é”®å€¼&lt;/p&gt;
&lt;h2 id="å¤šå­—æ®µæŸ¥è¯¢"&gt;å¤šå­—æ®µæŸ¥è¯¢
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­è®¾è®¡åŒæ—¶æ”¯æŒæŒ‰ &lt;code&gt;space&lt;/code&gt; å’Œ &lt;code&gt;user&lt;/code&gt; æŸ¥è¯¢çš„è·¯ç”±é”®æ—¶ï¼Œéœ€ç»“åˆä¸šåŠ¡åœºæ™¯ã€æŸ¥è¯¢é¢‘ç‡å’Œæ•°æ®åˆ†å¸ƒè¿›è¡Œæƒè¡¡ã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šç§æ–¹æ¡ˆçš„ä¼˜åŒ–ç­–ç•¥åŠå®ç°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒçŸ›ç›¾ä¸è®¾è®¡åŸåˆ™"&gt;æ ¸å¿ƒçŸ›ç›¾ä¸è®¾è®¡åŸåˆ™
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±é”®çš„å•å€¼æ€§&lt;/strong&gt;ï¼šæ¯ä¸ªæ–‡æ¡£åªèƒ½æŒ‡å®šä¸€ä¸ªè·¯ç”±é”®ï¼Œä½†éœ€æ»¡è¶³è·¨å­—æ®µæŸ¥è¯¢éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜å…ˆ&lt;/strong&gt;ï¼šé«˜é¢‘æŸ¥è¯¢å­—æ®µåº”ä¼˜å…ˆä½œä¸ºè·¯ç”±é”®ï¼Œå‡å°‘åˆ†ç‰‡æ‰«æèŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å‡è¡¡&lt;/strong&gt;ï¼šé¿å…å› è·¯ç”±é”®é€‰æ‹©å¯¼è‡´åˆ†ç‰‡æ•°æ®å€¾æ–œï¼ˆå¦‚æŸåˆ†ç‰‡æ•°æ®é‡è¿‡å¤§ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å…·ä½“æ–¹æ¡ˆä¸å®ç°"&gt;å…·ä½“æ–¹æ¡ˆä¸å®ç°
&lt;/h3&gt;&lt;h4 id="ä¸»è·¯ç”±é”®--è¾…åŠ©æŸ¥è¯¢å­—æ®µ"&gt;&lt;strong&gt;ä¸»è·¯ç”±é”® + è¾…åŠ©æŸ¥è¯¢å­—æ®µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯é€‚é…&lt;/strong&gt;ï¼šè‹¥æŸä¸€å­—æ®µï¼ˆå¦‚ &lt;code&gt;space&lt;/code&gt;ï¼‰æŸ¥è¯¢é¢‘ç‡æ˜¾è‘—é«˜äº &lt;code&gt;user&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€‰æ‹© &lt;code&gt;space&lt;/code&gt; ä½œä¸ºä¸»è·¯ç”±é”®ï¼Œç¡®ä¿åŒä¸€ &lt;code&gt;space&lt;/code&gt; çš„æ–‡æ¡£é›†ä¸­å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢ &lt;code&gt;user&lt;/code&gt; æ—¶é€šè¿‡ &lt;code&gt;terms&lt;/code&gt; æŸ¥è¯¢è¿‡æ»¤ï¼Œä½†éœ€æ¥å—è·¨åˆ†ç‰‡æ‰«æçš„å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å†™å…¥æ—¶æŒ‡å®šè·¯ç”±é”®ä¸º space
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/logs/_doc/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="err"&gt;?routing=space_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;space_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_456&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;example&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢ user æ—¶éœ€éå†æ‰€æœ‰åˆ†ç‰‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/logs/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;bool&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;must&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_456&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç»„åˆå­—æ®µè·¯ç”±é”®"&gt;&lt;strong&gt;ç»„åˆå­—æ®µè·¯ç”±é”®&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯é€‚é…&lt;/strong&gt;ï¼š&lt;code&gt;space&lt;/code&gt; å’Œ &lt;code&gt;user&lt;/code&gt; çš„æŸ¥è¯¢é¢‘ç‡ç›¸è¿‘ï¼Œä¸”ç»„åˆå€¼åˆ†å¸ƒå‡åŒ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å°† &lt;code&gt;space&lt;/code&gt; å’Œ &lt;code&gt;user&lt;/code&gt; æ‹¼æ¥ä¸ºå¤åˆè·¯ç”±é”®ï¼ˆå¦‚ &lt;code&gt;space_123_user_456&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®ä¿åŒä¸€æ–‡æ¡£åœ¨ä¸¤ç§æŸ¥è¯¢åœºæ™¯ä¸‹å‡èƒ½å¿«é€Ÿå®šä½åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å†™å…¥æ—¶ä½¿ç”¨ç»„åˆè·¯ç”±é”®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/logs/_doc/&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="err"&gt;?routing=space_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="err"&gt;_user_&lt;/span&gt;&lt;span class="mi"&gt;456&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;space_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_456&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;example&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// æŸ¥è¯¢æ—¶éœ€æ˜¾å¼æŒ‡å®šè·¯ç”±é”®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/logs/_search?routing=space_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="err"&gt;_user_&lt;/span&gt;&lt;span class="mi"&gt;456&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_456&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ç´¢å¼•åˆ«åä¸åŠ¨æ€è·¯ç”±"&gt;&lt;strong&gt;ç´¢å¼•åˆ«åä¸åŠ¨æ€è·¯ç”±&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯é€‚é…&lt;/strong&gt;ï¼šéœ€æ ¹æ®æŸ¥è¯¢ç±»å‹åŠ¨æ€åˆ‡æ¢è·¯ç”±ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºåˆ«åå¹¶ç»‘å®šä¸åŒè·¯ç”±è§„åˆ™ï¼šå†™å…¥æ—¶æŒ‰ &lt;code&gt;space&lt;/code&gt; è·¯ç”±ï¼ŒæŸ¥è¯¢æ—¶æŒ‰ &lt;code&gt;user&lt;/code&gt; è·¯ç”±ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;index_routing&lt;/code&gt; å’Œ &lt;code&gt;search_routing&lt;/code&gt; å‚æ•°åˆ†ç¦»è¯»å†™è·¯ç”±é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹é…ç½®&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/_aliases&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;actions&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;add&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;logs&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;alias&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;logs_alias&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;index_routing&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;// å†™å…¥æ—¶æŒ‰ space è·¯ç”±
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;search_routing&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// æŸ¥è¯¢æ—¶æŒ‰ user è·¯ç”±
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ•°æ®å†—ä½™ä¸å†·çƒ­åˆ†å±‚"&gt;&lt;strong&gt;æ•°æ®å†—ä½™ä¸å†·çƒ­åˆ†å±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœºæ™¯é€‚é…&lt;/strong&gt;ï¼šå¯¹æ€§èƒ½è¦æ±‚æé«˜ï¼Œå…è®¸ç‰ºç‰²å­˜å‚¨æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å°†æ•°æ®å†—ä½™å­˜å‚¨è‡³ä¸¤ä¸ªç´¢å¼•ï¼š&lt;code&gt;logs_by_space&lt;/code&gt;ï¼ˆè·¯ç”±é”®ä¸º &lt;code&gt;space&lt;/code&gt;ï¼‰å’Œ &lt;code&gt;logs_by_user&lt;/code&gt;ï¼ˆè·¯ç”±é”®ä¸º &lt;code&gt;user&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;_reindex&lt;/code&gt; API æˆ–åº”ç”¨å±‚åŒå†™åŒæ­¥æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å¤šç´¢å¼•æŸ¥è¯¢ï¼ˆæ€§èƒ½è¾ƒä½ï¼Œéœ€æƒè¡¡ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/logs_by_space,logs_by_user/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;bool&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;should&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;space_123&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_456&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‰å‹å»ºè®®ä¸æ€§èƒ½å¯¹æ¯”"&gt;é€‰å‹å»ºè®®ä¸æ€§èƒ½å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å†™å…¥æ€§èƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å­˜å‚¨æˆæœ¬&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸»è·¯ç”±é”® + è¾…åŠ©æŸ¥è¯¢å­—æ®µ&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½é¢‘å­—æ®µæŸ¥è¯¢è¾ƒå·®&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢å­—æ®µé¢‘ç‡å·®å¼‚æ˜¾è‘—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç»„åˆå­—æ®µè·¯ç”±é”®&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€æ˜¾å¼è·¯ç”±ï¼‰&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;åŒå­—æ®µæŸ¥è¯¢é¢‘ç‡ç›¸è¿‘ä¸”åˆ†å¸ƒå‡åŒ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç´¢å¼•åˆ«ååŠ¨æ€è·¯ç”±&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆéœ€è·¯ç”±åˆ‡æ¢ï¼‰&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;éœ€è¦è¯»å†™åˆ†ç¦»çš„åŠ¨æ€åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®å†—ä½™&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;æé«˜ï¼ˆå•ç´¢å¼•æŸ¥è¯¢ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;æç«¯æ€§èƒ½éœ€æ±‚ï¼Œå®¹å¿å†—ä½™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="é£é™©è§„é¿ä¸ç›‘æ§"&gt;é£é™©è§„é¿ä¸ç›‘æ§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡çƒ­ç‚¹ç›‘æ§&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;_cat/shards?v&lt;/code&gt; è§‚å¯Ÿåˆ†ç‰‡æ–‡æ¡£æ•°ï¼Œè‹¥æŸåˆ†ç‰‡æ•°æ®é‡è¶…è¿‡å¹³å‡å€¼ 20%ï¼Œéœ€è°ƒæ•´è·¯ç”±ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰ˆæœ¬ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;version_type=external&lt;/code&gt; æ§åˆ¶å†—ä½™ç´¢å¼•çš„ç‰ˆæœ¬åŒæ­¥ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢å…œåº•&lt;/strong&gt;&lt;br&gt;
å¯¹æœªæŒ‡å®šè·¯ç”±é”®çš„æŸ¥è¯¢æ·»åŠ è¶…æ—¶ç†”æ–­æœºåˆ¶ï¼Œé˜²æ­¢å…¨åˆ†ç‰‡æ‰«æå¼•å‘é›†ç¾¤è¿‡è½½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ··åˆç­–ç•¥æ¡ˆä¾‹"&gt;æ··åˆç­–ç•¥æ¡ˆä¾‹
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ¡ˆä¾‹èƒŒæ™¯&lt;/strong&gt;ï¼šæŸè®ºå›ç³»ç»Ÿéœ€åŒæ—¶æŒ‰ç‰ˆå—ï¼ˆ&lt;code&gt;space&lt;/code&gt;ï¼‰å’Œç”¨æˆ·ï¼ˆ&lt;code&gt;user&lt;/code&gt;ï¼‰æŸ¥è¯¢å¸–å­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ¡ˆè®¾è®¡&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥é˜¶æ®µ&lt;/strong&gt;ï¼šä»¥ &lt;code&gt;space&lt;/code&gt; ä½œä¸ºä¸»è·¯ç”±é”®ï¼Œç¡®ä¿åŒä¸€ç‰ˆå—å¸–å­é›†ä¸­å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢é˜¶æ®µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç‰ˆå—å†…æŸ¥è¯¢ï¼šç›´æ¥ä½¿ç”¨ &lt;code&gt;routing=space_123&lt;/code&gt;ï¼Œå“åº”æ—¶é—´ &amp;lt;10msã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·å†å²å¸–æŸ¥è¯¢ï¼šé€šè¿‡ &lt;code&gt;terms&lt;/code&gt; æŸ¥è¯¢éå†ï¼Œä½†é™åˆ¶æ—¶é—´èŒƒå›´ï¼ˆå¦‚æœ€è¿‘ 7 å¤©ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·æ•°æ®å½’æ¡£&lt;/strong&gt;ï¼šè¶…è¿‡ 30 å¤©çš„å¸–å­å½’æ¡£è‡³ &lt;code&gt;logs_history&lt;/code&gt; ç´¢å¼•ï¼Œå…³é—­å‰¯æœ¬å‡å°‘èµ„æºå ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°ç­–ç•¥ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚åœ¨æŸ¥è¯¢æ€§èƒ½ã€å­˜å‚¨æˆæœ¬å’Œä¸€è‡´æ€§ä¹‹é—´æ‰¾åˆ°æœ€ä¼˜å¹³è¡¡ç‚¹ã€‚å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒé€šè¿‡ &lt;code&gt;_profile&lt;/code&gt; API åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼ŒéªŒè¯è·¯ç”±è®¾è®¡åˆç†æ€§&lt;/p&gt;
&lt;h2 id="åŠ¨æ€è·¯ç”±"&gt;åŠ¨æ€è·¯ç”±
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;code&gt;index_routing&lt;/code&gt; å’Œ &lt;code&gt;search_routing&lt;/code&gt; å…è®¸è¯»å†™æ“ä½œé‡‡ç”¨ä¸åŒçš„è·¯ç”±ç­–ç•¥ï¼Œè¿™ä¸€è®¾è®¡å¹¶éçŸ›ç›¾ï¼Œè€Œæ˜¯åŸºäºä¸šåŠ¡åœºæ™¯çš„æƒè¡¡ã€‚ä»¥ä¸‹ä»¥â€œå†™å…¥æŒ‰ &lt;code&gt;space&lt;/code&gt; è·¯ç”±ï¼ŒæŸ¥è¯¢æŒ‰ &lt;code&gt;user&lt;/code&gt; è·¯ç”±â€ä¸ºä¾‹ï¼Œåˆ†æå…¶åˆç†æ€§åŠæ½œåœ¨å½±å“ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="è®¾è®¡åŸç†ä¸ä¸šåŠ¡éœ€æ±‚"&gt;è®¾è®¡åŸç†ä¸ä¸šåŠ¡éœ€æ±‚
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™å…¥å±€éƒ¨æ€§ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;index_routing=space&lt;/code&gt;ï¼ŒåŒä¸€ç©ºé—´ï¼ˆ&lt;code&gt;space&lt;/code&gt;ï¼‰çš„æ–‡æ¡£ä¼šé›†ä¸­å­˜å‚¨åˆ°ç‰¹å®šåˆ†ç‰‡ã€‚è¿™ç¬¦åˆä»¥ä¸‹åœºæ™¯éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘å†™å…¥åœºæ™¯&lt;/strong&gt;ï¼šå¦‚è®ºå›æŒ‰ç‰ˆå—ï¼ˆ&lt;code&gt;space&lt;/code&gt;ï¼‰åˆ†åŒºï¼ŒåŒä¸€ç‰ˆå—çš„æ–‡æ¡£æ‰¹é‡å†™å…¥æ—¶å¯å‡å°‘åˆ†ç‰‡åˆ‡æ¢å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸€è‡´æ€§&lt;/strong&gt;ï¼šåŒä¸€ç©ºé—´çš„æ“ä½œï¼ˆå¦‚åº“å­˜æ‰£å‡ï¼‰éœ€åŸå­æ€§ï¼Œé›†ä¸­å­˜å‚¨å¯é¿å…è·¨åˆ†ç‰‡äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢ç»´åº¦åˆ‡æ¢&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;search_routing=user&lt;/code&gt; æ—¶ï¼Œéœ€æŒ‰ç”¨æˆ·ï¼ˆ&lt;code&gt;user&lt;/code&gt;ï¼‰æ£€ç´¢æ•°æ®ã€‚å…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·è¡Œä¸ºåˆ†æ&lt;/strong&gt;ï¼šæŸ¥è¯¢æŸç”¨æˆ·åœ¨æ‰€æœ‰ç©ºé—´çš„å†å²è¡Œä¸ºï¼ˆå¦‚è¯„è®ºã€ç‚¹èµï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¨ç©ºé—´èšåˆ&lt;/strong&gt;ï¼šç»Ÿè®¡ç”¨æˆ·å…¨å±€æ´»è·ƒåº¦ï¼Œéœ€éå†å¤šä¸ªç©ºé—´åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å½±å“ä¸è§„é¿ç­–ç•¥"&gt;æ€§èƒ½å½±å“ä¸è§„é¿ç­–ç•¥
&lt;/h3&gt;&lt;h4 id="è·¨åˆ†ç‰‡æŸ¥è¯¢çš„å¿…ç„¶æ€§"&gt;&lt;strong&gt;è·¨åˆ†ç‰‡æŸ¥è¯¢çš„å¿…ç„¶æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡åˆ†å¸ƒå†²çª&lt;/strong&gt;&lt;br&gt;
è‹¥æ–‡æ¡£æŒ‰ &lt;code&gt;space&lt;/code&gt; è·¯ç”±å†™å…¥ï¼Œä½†æŒ‰ &lt;code&gt;user&lt;/code&gt; è·¯ç”±æŸ¥è¯¢ï¼Œç†è®ºä¸Šéœ€æ‰«ææ‰€æœ‰åˆ†ç‰‡ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ· &lt;code&gt;user_123&lt;/code&gt; çš„æ–‡æ¡£å¯èƒ½åˆ†å¸ƒåœ¨ &lt;code&gt;space_A&lt;/code&gt; å’Œ &lt;code&gt;space_B&lt;/code&gt; å¯¹åº”çš„ä¸åŒåˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ—¶éœ€å‘æ‰€æœ‰åˆ†ç‰‡å‘é€è¯·æ±‚ï¼Œåè°ƒèŠ‚ç‚¹åˆå¹¶ç»“æœï¼Œå¯¼è‡´å»¶è¿Ÿå¢åŠ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¼˜åŒ–æ‰‹æ®µ"&gt;&lt;strong&gt;ä¼˜åŒ–æ‰‹æ®µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è·¯ç”±é”®å…³è”è®¾è®¡&lt;/strong&gt;&lt;br&gt;
è‹¥ &lt;code&gt;user&lt;/code&gt; ä¸ &lt;code&gt;space&lt;/code&gt; å­˜åœ¨å¼ºå…³è”ï¼ˆå¦‚ç”¨æˆ·ä»…å±äºç‰¹å®šç©ºé—´ï¼‰ï¼Œå¯é€šè¿‡ä¸šåŠ¡é€»è¾‘éšå¼ç»‘å®šè·¯ç”±ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ç¤ºä¾‹ï¼šå†™å…¥æ—¶è‡ªåŠ¨å…³è” user å’Œ space
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/posts/_doc?routing=space_&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;user_456&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;space_123&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢æ—¶é€šè¿‡ &lt;code&gt;user_id&lt;/code&gt; è¿‡æ»¤ &lt;code&gt;space_123&lt;/code&gt; åˆ†ç‰‡ï¼Œé¿å…å…¨åˆ†ç‰‡æ‰«æã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†·çƒ­æ•°æ®åˆ†å±‚&lt;/strong&gt;&lt;br&gt;
ç»“åˆç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çƒ­æ•°æ®&lt;/strong&gt;ï¼šè¿‘æœŸæ•°æ®ä¿ç•™å®Œæ•´è·¯ç”±ï¼ˆ&lt;code&gt;space&lt;/code&gt;ï¼‰ï¼Œæ”¯æŒé«˜é¢‘å†™å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·æ•°æ®&lt;/strong&gt;ï¼šå½’æ¡£è‡³ç»Ÿä¸€ç´¢å¼•ï¼ˆå¦‚ &lt;code&gt;history_posts&lt;/code&gt;ï¼‰ï¼ŒæŸ¥è¯¢æ—¶æŒ‰ &lt;code&gt;user&lt;/code&gt; è·¯ç”±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¹¶è¡ŒæŸ¥è¯¢ä¸ç¼“å­˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç”¨ &lt;code&gt;preference=_shards:1,2&lt;/code&gt; æŒ‡å®šåˆ†ç‰‡èŒƒå›´ï¼Œå‡å°‘æ‰«æåˆ†ç‰‡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ï¼ˆ&lt;code&gt;request_cache=true&lt;/code&gt;ï¼‰ï¼Œå¯¹é‡å¤æŸ¥è¯¢åŠ é€Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹"&gt;é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;h4 id="æ¨èåœºæ™¯"&gt;&lt;strong&gt;æ¨èåœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†™å…¥å¯†é›†å‹ä¸šåŠ¡&lt;/strong&gt;ï¼šå¦‚æ—¥å¿—ç³»ç»ŸæŒ‰æ¥æºï¼ˆ&lt;code&gt;space&lt;/code&gt;ï¼‰åˆ†åŒºï¼ŒæŸ¥è¯¢æ—¶æŒ‰ç”¨æˆ·ï¼ˆ&lt;code&gt;user&lt;/code&gt;ï¼‰åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»æ¶æ„&lt;/strong&gt;ï¼šå†™å…¥ä¾§é‡æ•°æ®å±€éƒ¨æ€§ï¼ŒæŸ¥è¯¢ä¾§é‡å…¨å±€è§†è§’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="é£é™©æ§åˆ¶"&gt;&lt;strong&gt;é£é™©æ§åˆ¶&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡çƒ­ç‚¹ç›‘æ§&lt;/strong&gt;&lt;br&gt;
å®šæœŸé€šè¿‡ &lt;code&gt;_cat/shards&lt;/code&gt; æ£€æŸ¥åˆ†ç‰‡è´Ÿè½½ï¼Œé¿å…æŸåˆ†ç‰‡å›  &lt;code&gt;space&lt;/code&gt; æ•°æ®é‡è¿‡å¤§æˆç“¶é¢ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢ç†”æ–­æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
å¯¹æœªæŒ‡å®šè·¯ç”±çš„æŸ¥è¯¢æ·»åŠ è¶…æ—¶é™åˆ¶ï¼ˆå¦‚ &lt;code&gt;timeout=10s&lt;/code&gt;ï¼‰ï¼Œé˜²æ­¢å…¨åˆ†ç‰‡æ‰«ææ‹–å®é›†ç¾¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-7"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;index_routing&lt;/code&gt; ä¸ &lt;code&gt;search_routing&lt;/code&gt; çš„åˆ†ç¦»ï¼Œæœ¬è´¨æ˜¯&lt;strong&gt;å†™å…¥æ•ˆç‡ä¸æŸ¥è¯¢çµæ´»æ€§&lt;/strong&gt;çš„æƒè¡¡ã€‚è™½ç„¶å¯èƒ½å¼•å‘è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼Œä½†é€šè¿‡è·¯ç”±å…³è”è®¾è®¡ã€å†·çƒ­åˆ†å±‚å’Œç¼“å­˜ä¼˜åŒ–ï¼Œå¯æœ‰æ•ˆæ§åˆ¶æ€§èƒ½æŸè€—ã€‚è¯¥æ¨¡å¼é€‚ç”¨äºéœ€è¦åŒæ—¶ä¼˜åŒ–å†™å…¥ååé‡å’Œå¤šç»´æŸ¥è¯¢çš„åœºæ™¯ï¼Œä½†éœ€é…åˆç›‘æ§ä¸ç†”æ–­æœºåˆ¶ä¿éšœç¨³å®šæ€§&lt;/p&gt;
&lt;h2 id="å¤åˆè·¯ç”±é”®"&gt;å¤åˆè·¯ç”±é”®
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œå°† &lt;code&gt;space&lt;/code&gt; å’Œ &lt;code&gt;user&lt;/code&gt; æ‹¼æ¥ä¸ºå¤åˆè·¯ç”±é”®çš„è®¾è®¡çœ‹ä¼¼ä¼šå¯¼è‡´åˆ†ç‰‡åˆ†æ•£ï¼Œä½†å®é™…èƒ½å¦ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½éœ€ç»“åˆ&lt;strong&gt;ä¸šåŠ¡åœºæ™¯çš„æŸ¥è¯¢æ¨¡å¼&lt;/strong&gt;å’Œ&lt;strong&gt;åˆ†ç‰‡åˆ†å¸ƒç­–ç•¥&lt;/strong&gt;ç»¼åˆåˆ¤æ–­ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¤åˆè·¯ç”±é”®çš„æ ¸å¿ƒé€»è¾‘"&gt;å¤åˆè·¯ç”±é”®çš„æ ¸å¿ƒé€»è¾‘
&lt;/h3&gt;&lt;h4 id="å“ˆå¸Œåˆ†ç‰‡ç®—æ³•çš„æœ¬è´¨"&gt;&lt;strong&gt;å“ˆå¸Œåˆ†ç‰‡ç®—æ³•çš„æœ¬è´¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Elasticsearch é€šè¿‡ &lt;code&gt;hash(routing_value) % number_of_primary_shards&lt;/code&gt; å…¬å¼è®¡ç®—åˆ†ç‰‡ä½ç½®ã€‚è‹¥å¤åˆè·¯ç”±é”®çš„å“ˆå¸Œå€¼ä¸åŒï¼Œæ–‡æ¡£ä¼šè¢«åˆ†é…åˆ°ä¸åŒåˆ†ç‰‡ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;_space_1_user_1&lt;/code&gt; â†’ å“ˆå¸Œå€¼ A â†’ åˆ†ç‰‡ 1&lt;/li&gt;
&lt;li&gt;&lt;code&gt;_space_1_user_2&lt;/code&gt; â†’ å“ˆå¸Œå€¼ B â†’ åˆ†ç‰‡ 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;_space_2_user_1&lt;/code&gt; â†’ å“ˆå¸Œå€¼ C â†’ åˆ†ç‰‡ 3&lt;/li&gt;
&lt;li&gt;&lt;code&gt;_space_2_user_2&lt;/code&gt; â†’ å“ˆå¸Œå€¼ D â†’ åˆ†ç‰‡ 4&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤æ—¶ï¼ŒæŒ‰ &lt;code&gt;space&lt;/code&gt; æˆ– &lt;code&gt;user&lt;/code&gt; å•ç‹¬æŸ¥è¯¢æ—¶ï¼Œæ–‡æ¡£åˆ†å¸ƒåœ¨å¤šä¸ªåˆ†ç‰‡ä¸Šï¼Œ&lt;strong&gt;å¿…é¡»è·¨åˆ†ç‰‡æŸ¥è¯¢&lt;/strong&gt;ã€‚ä½†è¿™ä¸€è®¾è®¡å¹¶éæ— æ„ä¹‰ï¼Œå…¶ä»·å€¼å–å†³äºä¸šåŠ¡åœºæ™¯ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯ä¸ä¼˜åŒ–æ‰‹æ®µ"&gt;é€‚ç”¨åœºæ™¯ä¸ä¼˜åŒ–æ‰‹æ®µ
&lt;/h3&gt;&lt;h4 id="åœºæ™¯é€‚é…"&gt;&lt;strong&gt;åœºæ™¯é€‚é…&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¤åˆè·¯ç”±é”®çš„ä¼˜åŠ¿åœ¨äº&lt;strong&gt;é«˜é¢‘è”åˆæŸ¥è¯¢åœºæ™¯&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦åŒæ—¶æŒ‰ &lt;code&gt;space&lt;/code&gt; å’Œ &lt;code&gt;user&lt;/code&gt; è¿‡æ»¤ï¼ˆå¦‚æŸ¥è¯¢ç”¨æˆ·åœ¨æŸä¸ªç©ºé—´çš„è¡Œä¸ºè®°å½•ï¼‰ï¼Œæ­¤æ—¶è·¯ç”±é”®å¯ç›´æ¥å®šä½åˆ°åˆ†ç‰‡ï¼Œæ— éœ€è·¨åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ä¸šåŠ¡ä¸­ &lt;code&gt;space&lt;/code&gt; å’Œ &lt;code&gt;user&lt;/code&gt; çš„æŸ¥è¯¢æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œå¤åˆè·¯ç”±é”®èƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å•ç‹¬æŸ¥è¯¢çš„ä¼˜åŒ–"&gt;&lt;strong&gt;å•ç‹¬æŸ¥è¯¢çš„ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€å•ç‹¬æŒ‰ &lt;code&gt;space&lt;/code&gt; æˆ– &lt;code&gt;user&lt;/code&gt; æŸ¥è¯¢ï¼Œéœ€ç»“åˆä»¥ä¸‹ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç‰‡é¢„åˆ†é…ä¸è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;br&gt;
é€šè¿‡è®¾ç½®è¾ƒå¤§çš„åˆ†ç‰‡æ•°ï¼ˆå¦‚ &lt;code&gt;number_of_shards=100&lt;/code&gt;ï¼‰ï¼Œä½¿åŒä¸€ &lt;code&gt;space&lt;/code&gt; æˆ– &lt;code&gt;user&lt;/code&gt; çš„å“ˆå¸Œå€¼åˆ†æ•£åˆ°å¤šä¸ªåˆ†ç‰‡ï¼Œä½†é€šè¿‡åˆ†ç‰‡è´Ÿè½½å‡è¡¡é¿å…çƒ­ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢è·¯ç”±è¿‡æ»¤&lt;/strong&gt;&lt;br&gt;
æ˜¾å¼æŒ‡å®šè·¯ç”±é”®èŒƒå›´ã€‚ä¾‹å¦‚ï¼ŒæŒ‰ &lt;code&gt;space=1&lt;/code&gt; æŸ¥è¯¢æ—¶ï¼Œéå†æ‰€æœ‰å¯èƒ½çš„ &lt;code&gt;user&lt;/code&gt; ç»„åˆå¹¶æ‹¼æ¥è·¯ç”±é”®ï¼Œé€šè¿‡ &lt;code&gt;_msearch&lt;/code&gt; æ‰¹é‡æŸ¥è¯¢ç›®æ ‡åˆ†ç‰‡ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/_msearch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;logs&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;routing&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;_space_1_user_1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;logs&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;routing&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;_space_1_user_2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;space&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å•è·¯ç”±é”®æ–¹æ¡ˆçš„å¯¹æ¯”"&gt;ä¸å•è·¯ç”±é”®æ–¹æ¡ˆçš„å¯¹æ¯”
&lt;/h3&gt;&lt;h4 id="å•è·¯ç”±é”®æ–¹æ¡ˆ"&gt;&lt;strong&gt;å•è·¯ç”±é”®æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŒ‰ &lt;code&gt;space&lt;/code&gt; è·¯ç”±&lt;/strong&gt;ï¼šåŒä¸€ç©ºé—´çš„æ–‡æ¡£é›†ä¸­å­˜å‚¨ï¼ŒæŒ‰ &lt;code&gt;space&lt;/code&gt; æŸ¥è¯¢æ— éœ€è·¨åˆ†ç‰‡ï¼Œä½†æŒ‰ &lt;code&gt;user&lt;/code&gt; æŸ¥è¯¢éœ€å…¨åˆ†ç‰‡æ‰«æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‰ &lt;code&gt;user&lt;/code&gt; è·¯ç”±&lt;/strong&gt;ï¼šåŒä¸€ç”¨æˆ·çš„æ–‡æ¡£é›†ä¸­å­˜å‚¨ï¼ŒæŒ‰ &lt;code&gt;user&lt;/code&gt; æŸ¥è¯¢é«˜æ•ˆï¼Œä½†æŒ‰ &lt;code&gt;space&lt;/code&gt; æŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¤åˆè·¯ç”±é”®æ–¹æ¡ˆ"&gt;&lt;strong&gt;å¤åˆè·¯ç”±é”®æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè”åˆæŸ¥è¯¢æ€§èƒ½é«˜ï¼Œæ•°æ®åˆ†å¸ƒæ›´å‡åŒ€ï¼ˆé¿å…å•è·¯ç”±é”®å¯¼è‡´çš„åˆ†ç‰‡çƒ­ç‚¹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ£åŠ¿&lt;/strong&gt;ï¼šå•ç‹¬å­—æ®µæŸ¥è¯¢éœ€è·¨åˆ†ç‰‡ï¼Œéœ€é¢å¤–ä¼˜åŒ–æ‰‹æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸å»ºè®®"&gt;æ€»ç»“ä¸å»ºè®®
&lt;/h3&gt;&lt;h4 id="è®¾è®¡åŸåˆ™"&gt;&lt;strong&gt;è®¾è®¡åŸåˆ™&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;è‹¥ä¸šåŠ¡ä»¥&lt;strong&gt;è”åˆæŸ¥è¯¢ä¸ºä¸»&lt;/strong&gt;ï¼Œå¤åˆè·¯ç”±é”®æ˜¯ç†æƒ³é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥éœ€&lt;strong&gt;é«˜é¢‘å•ç‹¬æŸ¥è¯¢&lt;/strong&gt;ï¼Œå»ºè®®é€‰æ‹©ä¸»è·¯ç”±é”®ï¼ˆå¦‚ &lt;code&gt;space&lt;/code&gt;ï¼‰ + è¾…åŠ©è¿‡æ»¤ï¼ˆå¦‚ &lt;code&gt;user&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ€§èƒ½æµ‹è¯•"&gt;&lt;strong&gt;æ€§èƒ½æµ‹è¯•&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;_search_shards&lt;/code&gt; API éªŒè¯è·¯ç”±åˆ†ç‰‡åˆ†å¸ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/logs/_search_shards?routing=_space_&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="err"&gt;_user_&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“åˆ Kibana ç›‘æ§åˆ†ç‰‡è´Ÿè½½ï¼ŒåŠ¨æ€è°ƒæ•´è·¯ç”±ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h4 id="æ··åˆç­–ç•¥"&gt;&lt;strong&gt;æ··åˆç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å†™å…¥æ—¶æŒ‰ &lt;code&gt;space&lt;/code&gt; è·¯ç”±ï¼ŒæŸ¥è¯¢æ—¶é€šè¿‡åˆ«ååŠ¨æ€åˆ‡æ¢è·¯ç”±é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;å†—ä½™æ•°æ®åˆ°ä¸¤ä¸ªç´¢å¼•ï¼ˆå¦‚ &lt;code&gt;logs_by_space&lt;/code&gt; å’Œ &lt;code&gt;logs_by_user&lt;/code&gt;ï¼‰ï¼Œç‰ºç‰²å­˜å‚¨æ¢æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†è®¾è®¡ï¼Œå¯åœ¨æ•°æ®åˆ†å¸ƒä¸æŸ¥è¯¢æ€§èƒ½é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id="term-æŸ¥è¯¢"&gt;Term æŸ¥è¯¢
&lt;/h2&gt;&lt;p&gt;Elasticsearch ä¸­çš„ &lt;strong&gt;term æŸ¥è¯¢&lt;/strong&gt;æ˜¯ä¸€ç§ç²¾ç¡®åŒ¹é…çš„æŸ¥è¯¢æ–¹å¼ï¼Œä¸“ä¸º&lt;strong&gt;éæ–‡æœ¬å­—æ®µ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;keyword&lt;/code&gt;ã€&lt;code&gt;numeric&lt;/code&gt;ã€&lt;code&gt;date&lt;/code&gt;ï¼‰è®¾è®¡ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒç‰¹æ€§ã€ä½¿ç”¨åœºæ™¯ã€è¯­æ³•ç¤ºä¾‹åŠæ³¨æ„äº‹é¡¹å››ä¸ªç»´åº¦è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹æ€§"&gt;æ ¸å¿ƒç‰¹æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç²¾ç¡®åŒ¹é…&lt;/strong&gt;&lt;br&gt;
term æŸ¥è¯¢ç›´æ¥åŒ¹é…&lt;strong&gt;å­—æ®µ&lt;/strong&gt;çš„&lt;strong&gt;åŸå§‹å­˜å‚¨å€¼&lt;/strong&gt;ï¼Œä¸ä¼šå¯¹æŸ¥è¯¢å€¼è¿›è¡Œåˆ†è¯æˆ–æ ‡å‡†åŒ–å¤„ç†ï¼ˆå¦‚å¤§å°å†™è½¬æ¢ã€å»é™¤åœç”¨è¯ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­—æ®µ &lt;code&gt;status&lt;/code&gt; å­˜å‚¨ä¸º &lt;code&gt;&amp;quot;Active&amp;quot;&lt;/code&gt;ï¼ŒæŸ¥è¯¢ &lt;code&gt;&amp;quot;active&amp;quot;&lt;/code&gt; å°†æ— æ³•åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;æ•°å€¼å­—æ®µ &lt;code&gt;price=100&lt;/code&gt;ï¼ŒæŸ¥è¯¢ &lt;code&gt;&amp;quot;100&amp;quot;&lt;/code&gt;ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰ä¹Ÿæ— æ³•åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸åˆ†ææŸ¥è¯¢å€¼&lt;/strong&gt;&lt;br&gt;
ä¸ &lt;code&gt;match&lt;/code&gt; æŸ¥è¯¢ä¸åŒï¼Œterm æŸ¥è¯¢çš„è¾“å…¥å€¼&lt;strong&gt;å®Œå…¨ä¿ç•™åŸæ ·&lt;/strong&gt;ï¼Œç›´æ¥ä¸å€’æ’ç´¢å¼•ä¸­çš„è¯é¡¹å¯¹æ¯”ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/products/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;category.keyword&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Electronics&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// ç›´æ¥åŒ¹é… &amp;#34;Electronics&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜æ€§èƒ½&lt;/strong&gt;&lt;br&gt;
ç”±äºè·³è¿‡åˆ†è¯å’Œè¯„åˆ†è®¡ç®—ï¼Œterm æŸ¥è¯¢åœ¨&lt;strong&gt;è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼ˆ&lt;code&gt;filter&lt;/code&gt;ï¼‰ä¸­æ•ˆç‡æé«˜ï¼Œä¸”ç»“æœå¯ç¼“å­˜ä»¥åŠ é€Ÿé‡å¤æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯-4"&gt;é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;çŠ¶æ€ç è¿‡æ»¤&lt;/td&gt;
&lt;td&gt;ç­›é€‰è®¢å•çŠ¶æ€ä¸º &lt;code&gt;&amp;quot;PAID&amp;quot;&lt;/code&gt; çš„æ–‡æ¡£ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ID æˆ–ç¼–ç æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;é€šè¿‡ç”¨æˆ· ID &lt;code&gt;&amp;quot;user_123&amp;quot;&lt;/code&gt; ç²¾å‡†å®šä½æ–‡æ¡£ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æšä¸¾å€¼åŒ¹é…&lt;/td&gt;
&lt;td&gt;æ—¥å¿—çº§åˆ«ä¸º &lt;code&gt;&amp;quot;ERROR&amp;quot;&lt;/code&gt; æˆ– &lt;code&gt;&amp;quot;WARN&amp;quot;&lt;/code&gt; çš„æ—¥å¿—è®°å½•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ—¶é—´æˆ³èŒƒå›´å¤–çš„ç²¾ç¡®å€¼&lt;/td&gt;
&lt;td&gt;æŸ¥æ‰¾åˆ›å»ºæ—¶é—´ä¸º &lt;code&gt;&amp;quot;2023-10-01T00:00:00Z&amp;quot;&lt;/code&gt; çš„æ–‡æ¡£ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="è¯­æ³•ç¤ºä¾‹"&gt;è¯­æ³•ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="åŸºç¡€ç”¨æ³•"&gt;åŸºç¡€ç”¨æ³•
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/employees/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;active&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// ç®€å†™å½¢å¼ï¼Œç›´æ¥æŒ‡å®šå­—æ®µå’Œå€¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å®Œæ•´è¯­æ³•æ”¯æŒå‚æ•°æ‰©å±•"&gt;å®Œæ•´è¯­æ³•ï¼ˆæ”¯æŒå‚æ•°æ‰©å±•ï¼‰
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/employees/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;active&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;boost&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;2.0&lt;/span&gt; &lt;span class="c1"&gt;// æå‡ç›¸å…³æ€§æƒé‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="ç»“åˆè¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¼˜åŒ–æ€§èƒ½"&gt;ç»“åˆè¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¼˜åŒ–æ€§èƒ½
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/logs/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;bool&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;filter&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="c1"&gt;// ä¸è®¡ç®—è¯„åˆ†ï¼Œç»“æœå¯ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;term&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;level&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;error&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹ä¸å¸¸è§è¯¯åŒº"&gt;æ³¨æ„äº‹é¡¹ä¸å¸¸è§è¯¯åŒº
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…åœ¨ &lt;code&gt;text&lt;/code&gt; å­—æ®µä½¿ç”¨ term æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;text&lt;/code&gt; å­—æ®µä¼šç»è¿‡åˆ†è¯å¤„ç†ï¼Œå­˜å‚¨ä¸ºå¤šä¸ªè¯é¡¹ï¼ˆå¦‚ &lt;code&gt;&amp;quot;Elasticsearch&amp;quot;&lt;/code&gt; â†’ &lt;code&gt;[&amp;quot;elastic&amp;quot;, &amp;quot;search&amp;quot;]&lt;/code&gt;ï¼‰ã€‚ç›´æ¥ä½¿ç”¨ term æŸ¥è¯¢ &lt;code&gt;&amp;quot;Elasticsearch&amp;quot;&lt;/code&gt; å°†æ— æ³•åŒ¹é…ï¼Œéœ€æ”¹ç”¨ &lt;code&gt;match&lt;/code&gt; æŸ¥è¯¢æˆ–æŸ¥è¯¢å…¶ &lt;code&gt;.keyword&lt;/code&gt; å­å­—æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤§å°å†™æ•æ„Ÿ&lt;/strong&gt;&lt;br&gt;
è‹¥å­—æ®µä¸º &lt;code&gt;keyword&lt;/code&gt; ç±»å‹ä¸”å­˜å‚¨å€¼ä¸º &lt;code&gt;&amp;quot;Active&amp;quot;&lt;/code&gt;ï¼ŒæŸ¥è¯¢ &lt;code&gt;&amp;quot;active&amp;quot;&lt;/code&gt; ä¼šå¤±è´¥ã€‚å»ºè®®ç»Ÿä¸€å­˜å‚¨æ ¼å¼æˆ–ä½¿ç”¨è§„èŒƒåŒ–å¤„ç†å™¨ï¼ˆå¦‚ &lt;code&gt;lowercase&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šå€¼åŒ¹é…ä½¿ç”¨ &lt;code&gt;terms&lt;/code&gt; æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€åŒ¹é…å¤šä¸ªç²¾ç¡®å€¼ï¼ˆç±»ä¼¼ SQL çš„ &lt;code&gt;IN&lt;/code&gt; æ“ä½œï¼‰ï¼Œä½¿ç”¨ &lt;code&gt;terms&lt;/code&gt; æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;terms&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;active&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;pending&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"&gt;æ€§èƒ½ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;filter&lt;/code&gt; ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼šé¿å…è¯„åˆ†è®¡ç®—ï¼Œåˆ©ç”¨ç¼“å­˜æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆç†è®¾è®¡å­—æ®µç±»å‹&lt;/strong&gt;ï¼šå¯¹éœ€è¦ç²¾ç¡®åŒ¹é…çš„å­—æ®µï¼ˆå¦‚ IDã€çŠ¶æ€ç ï¼‰è®¾ä¸º &lt;code&gt;keyword&lt;/code&gt; ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶æŸ¥è¯¢èŒƒå›´&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;range&lt;/code&gt; æŸ¥è¯¢æˆ–ç´¢å¼•åˆ†åŒºï¼ˆå¦‚æ—¶é—´èŒƒå›´ï¼‰å‡å°‘æ‰«ææ•°æ®é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡ term æŸ¥è¯¢ï¼ŒElasticsearch èƒ½å¤Ÿé«˜æ•ˆå¤„ç†ç»“æ„åŒ–æ•°æ®çš„ç²¾ç¡®åŒ¹é…éœ€æ±‚ï¼Œå°¤å…¶é€‚åˆçŠ¶æ€è¿‡æ»¤ã€ID æ£€ç´¢ç­‰åœºæ™¯ã€‚æ­£ç¡®ä½¿ç”¨éœ€æ³¨æ„å­—æ®µç±»å‹ä¸æŸ¥è¯¢ä¸Šä¸‹æ–‡çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h2 id="_id"&gt;_id
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;code&gt;id&lt;/code&gt; å­—æ®µï¼ˆå³æ–‡æ¡£çš„ &lt;code&gt;_id&lt;/code&gt;ï¼‰çš„ç±»å‹åœ¨ Java å®ä½“ç±»ä¸­&lt;strong&gt;ä¸ä¸€å®šå¿…é¡»æ˜¯ &lt;code&gt;String&lt;/code&gt;&lt;/strong&gt;ï¼Œä½†éœ€è¦æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯å’Œ Spring Data Elasticsearch çš„æ˜ å°„è§„åˆ™è¿›è¡Œè®¾è®¡ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="id-å­—æ®µçš„ç±»å‹çµæ´»æ€§"&gt;&lt;code&gt;@Id&lt;/code&gt; å­—æ®µçš„ç±»å‹çµæ´»æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ”¯æŒéå­—ç¬¦ä¸²ç±»å‹&lt;/strong&gt;&lt;br&gt;
è™½ç„¶ Elasticsearch æœ€ç»ˆä¼šå°† &lt;code&gt;_id&lt;/code&gt; å­˜å‚¨ä¸ºå­—ç¬¦ä¸²ï¼Œä½† Spring Data Elasticsearch çš„ &lt;code&gt;@Id&lt;/code&gt; æ³¨è§£æ”¯æŒå¤šç§ Java ç±»å‹ï¼ˆå¦‚ &lt;code&gt;Long&lt;/code&gt;ã€&lt;code&gt;Integer&lt;/code&gt;ã€&lt;code&gt;UUID&lt;/code&gt; ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…è®¸ä½¿ç”¨ Long ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†™å…¥æ—¶ï¼ŒSpring Data ä¼šè‡ªåŠ¨å°† &lt;code&gt;Long&lt;/code&gt; è½¬æ¢ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ï¼›è¯»å–æ—¶å†è½¬æ¢å› &lt;code&gt;Long&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåŠ¨ç±»å‹è½¬æ¢æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°å€¼ç±»å‹&lt;/strong&gt;ï¼š&lt;code&gt;Long&lt;/code&gt;ã€&lt;code&gt;Integer&lt;/code&gt; ç­‰æ•°å€¼ç±»å‹ä¼šè¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼ˆå¦‚ &lt;code&gt;123&lt;/code&gt; â†’ &lt;code&gt;&amp;quot;123&amp;quot;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;UUID&lt;/strong&gt;ï¼šè‹¥ä½¿ç”¨ &lt;code&gt;UUID&lt;/code&gt; ç±»å‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆç±»ä¼¼ &lt;code&gt;&amp;quot;550e8400-e29b-41d4-a716-446655440000&amp;quot;&lt;/code&gt; çš„å­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰å¯¹è±¡&lt;/strong&gt;ï¼šéœ€å®ç° &lt;code&gt;toString()&lt;/code&gt; æ–¹æ³•å®šä¹‰åºåˆ—åŒ–é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¼ºåˆ¶ä½¿ç”¨-string-çš„åœºæ™¯"&gt;å¼ºåˆ¶ä½¿ç”¨ &lt;code&gt;String&lt;/code&gt; çš„åœºæ™¯
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æƒ…å†µå»ºè®®å°† &lt;code&gt;id&lt;/code&gt; å£°æ˜ä¸º &lt;code&gt;String&lt;/code&gt; ç±»å‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜¾å¼æ§åˆ¶ ID æ ¼å¼&lt;/strong&gt;&lt;br&gt;
å½“éœ€è¦è‡ªå®šä¹‰ ID æ ¼å¼ï¼ˆå¦‚ç»„åˆå­—æ®µ &lt;code&gt;&amp;quot;user_123_space_456&amp;quot;&lt;/code&gt;ï¼‰æ—¶ï¼Œç›´æ¥æ“ä½œå­—ç¬¦ä¸²æ›´çµæ´»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¤–éƒ¨ç³»ç»Ÿå…¼å®¹&lt;/strong&gt;&lt;br&gt;
è‹¥ ID æ¥æºäºå…¶ä»–ç³»ç»Ÿï¼ˆå¦‚ MongoDB çš„ &lt;code&gt;ObjectId&lt;/code&gt;ï¼‰ï¼Œé€šå¸¸éœ€ä¿æŒå­—ç¬¦ä¸²å½¢å¼ä»¥é¿å…è½¬æ¢æ­§ä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æ›´æ–°åœºæ™¯&lt;/strong&gt;&lt;br&gt;
å­—ç¬¦ä¸²ç±»å‹åœ¨è¦†ç›–å†™å…¥æ—¶æ€§èƒ½æ›´ç¨³å®šï¼ˆæ•°å€¼ç±»å‹è½¬æ¢å¯èƒ½å¼•å…¥é¢å¤–å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹"&gt;æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¨èä½¿ç”¨ String&lt;/strong&gt;&lt;br&gt;
Elasticsearch å®˜æ–¹æ–‡æ¡£ä¸­ &lt;code&gt;_id&lt;/code&gt; é»˜è®¤ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä¸å¤šæ•°ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚ UUIDã€å“ˆå¸Œå€¼ï¼‰å¤©ç„¶é€‚é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…æ··åˆç±»å‹&lt;/strong&gt;&lt;br&gt;
è‹¥åŒä¸€ç´¢å¼•ä¸­æ··ç”¨æ•°å€¼å‹å’Œå­—ç¬¦ä¸²å‹ IDï¼Œå¯èƒ½å¯¼è‡´æŸ¥è¯¢å¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;term&lt;/code&gt; æŸ¥è¯¢éœ€ç²¾ç¡®åŒ¹é…ç±»å‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å½±å“&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°å€¼å‹ ID&lt;/strong&gt;ï¼šåœ¨èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;range&lt;/code&gt;ï¼‰ä¸­ç•¥æœ‰ä¼˜åŠ¿ï¼Œä½† &lt;code&gt;_id&lt;/code&gt; æœ¬èº«ä¸æ”¯æŒæ­¤ç±»æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦ä¸²å‹ ID&lt;/strong&gt;ï¼šæ›´é€‚åˆç²¾ç¡®åŒ¹é…å’Œè·¯ç”±ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹ä¿®æ­£ä¸éªŒè¯"&gt;ç¤ºä¾‹ä¿®æ­£ä¸éªŒè¯
&lt;/h3&gt;&lt;p&gt;ä¿®æ”¹ä½ çš„ &lt;code&gt;Post&lt;/code&gt; ç±»ä¸º &lt;code&gt;Long&lt;/code&gt; ç±»å‹æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ”¹ä¸º Long ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†™å…¥ Elasticsearch åï¼Œé€šè¿‡ä»¥ä¸‹è¯·æ±‚éªŒè¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/posts/_doc/&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt; &lt;span class="c1"&gt;// å®é™…å­˜å‚¨çš„ _id ä¸ºå­—ç¬¦ä¸² &amp;#34;123&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‹¥è¿”å›ç»“æœåŒ…å« &lt;code&gt;&amp;quot;_id&amp;quot;: &amp;quot;123&amp;quot;&lt;/code&gt;ï¼Œåˆ™è¯æ˜è½¬æ¢æˆåŠŸã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-8"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éå¿…é¡»ä¸º String&lt;/strong&gt;ï¼šJava å®ä½“ç±»çš„ &lt;code&gt;id&lt;/code&gt; å¯ä»¥æ˜¯ &lt;code&gt;Long&lt;/code&gt;ã€&lt;code&gt;UUID&lt;/code&gt; ç­‰ç±»å‹ï¼Œä½†å­˜å‚¨åˆ° Elasticsearch æ—¶ä¼šéšå¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡é©±åŠ¨é€‰æ‹©&lt;/strong&gt;ï¼šæ ¹æ® ID ç”Ÿæˆè§„åˆ™ã€æŸ¥è¯¢æ¨¡å¼å†³å®šç±»å‹ã€‚è‹¥æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;String&lt;/code&gt; ä»¥é¿å…æ½œåœ¨é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§éªŒè¯&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;GET /ç´¢å¼•å/_mapping&lt;/code&gt; æ£€æŸ¥å®é™…å­˜å‚¨ç±»å‹ï¼Œç¡®ä¿ä¸ä¸šåŠ¡é€»è¾‘ä¸€è‡´ã€‚
æ˜¯çš„ï¼Œåœ¨ Elasticsearch ä¸­ï¼Œé€šè¿‡ &lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢æ–‡æ¡£é€šå¸¸ä¼šæ¯”é€šè¿‡å…¶ä»–å­—æ®µæŸ¥è¯¢æ›´å¿«ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› å’Œå¯¹æ¯”åˆ†æï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="_id-æŸ¥è¯¢çš„åº•å±‚ä¼˜åŠ¿"&gt;&lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢çš„åº•å±‚ä¼˜åŠ¿
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›´æ¥å®šä½æ–‡æ¡£&lt;/strong&gt;&lt;br&gt;
Elasticsearch é€šè¿‡ &lt;code&gt;_id&lt;/code&gt; å¯ç›´æ¥å®šä½æ–‡æ¡£çš„ç‰©ç†å­˜å‚¨ä½ç½®ï¼Œæ— éœ€æ‰«æç´¢å¼•ç»“æ„ã€‚è¿™ç§æœºåˆ¶ç±»ä¼¼äº MySQL çš„ä¸»é”®æŸ¥è¯¢ï¼ˆB+æ ‘ç›´æ¥å®šä½æ•°æ®é¡µï¼‰ï¼Œè€Œæ™®é€šå­—æ®µæŸ¥è¯¢éœ€è¦ç»è¿‡å€’æ’ç´¢å¼•æ£€ç´¢ã€åˆå¹¶æ–‡æ¡£åˆ—è¡¨ç­‰æ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/posts/_doc/&lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt; &lt;span class="c1"&gt;// ç›´æ¥é€šè¿‡ _id å®šä½ï¼Œç±»ä¼¼ MySQL ä¸»é”®æŸ¥è¯¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­˜å‚¨ç»“æ„ä¼˜åŒ–&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;_id&lt;/code&gt; æ˜¯ Elasticsearch çš„å…ƒæ•°æ®å­—æ®µï¼Œå…¶å­˜å‚¨æ–¹å¼ç»è¿‡ç‰¹æ®Šä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è™šæ‹Ÿå­—æ®µ&lt;/strong&gt;ï¼š&lt;code&gt;_id&lt;/code&gt; å®é™…å­˜å‚¨ä¸º &lt;code&gt;_uid&lt;/code&gt;ï¼ˆç”± &lt;code&gt;type#_id&lt;/code&gt; ç»„æˆï¼‰ï¼Œåœ¨ Lucene çš„å€’æ’ç´¢å¼•ä¸­ç›´æ¥æ˜ å°„åˆ°æ–‡æ¡£åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— åˆ†è¯ä¸åˆ†æ&lt;/strong&gt;ï¼š&lt;code&gt;_id&lt;/code&gt; ä¸ä¼šç»è¿‡åˆ†è¯å™¨å¤„ç†ï¼Œé¿å…äº†æ™®é€š &lt;code&gt;text&lt;/code&gt; å­—æ®µçš„åˆ†è¯å¼€é”€ï¼ˆå¦‚ IK åˆ†è¯å™¨çš„è¯é¡¹æ‹†åˆ†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œä¸ I/O æ¶ˆè€—ä½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢æ—¶ï¼ŒElasticsearch å¯ç›´æ¥ä» Translogï¼ˆé¢„å†™æ—¥å¿—ï¼‰æˆ–åˆ†ç‰‡çš„ Segment ä¸­å¿«é€Ÿè¯»å–ï¼Œå‡å°‘ç£ç›˜éšæœº I/Oã€‚&lt;/li&gt;
&lt;li&gt;æ™®é€šå­—æ®µæŸ¥è¯¢å¯èƒ½éœ€è¦åˆå¹¶å¤šä¸ªå€’æ’ç´¢å¼•çš„ Posting Listï¼ˆå¦‚å¤šæ¡ä»¶æŸ¥è¯¢ï¼‰ï¼Œå¯¼è‡´æ›´å¤šçš„ç£ç›˜å’Œå†…å­˜æ¶ˆè€—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ™®é€šå­—æ®µæŸ¥è¯¢çš„ç“¶é¢ˆ"&gt;æ™®é€šå­—æ®µæŸ¥è¯¢çš„ç“¶é¢ˆ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å€’æ’ç´¢å¼•æ£€ç´¢å¼€é”€&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€šå­—æ®µï¼ˆå¦‚ &lt;code&gt;text&lt;/code&gt; ç±»å‹ï¼‰éœ€é€šè¿‡ Term Dictionary å’Œ Term Index é€å±‚æ£€ç´¢è¯é¡¹ï¼Œå†åˆå¹¶ Posting List ä¸­çš„æ–‡æ¡£ IDã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼šæœç´¢ &lt;code&gt;name='å¼ ä¸‰1'&lt;/code&gt; éœ€è¦éå†å€’æ’ç´¢å¼•ä¸­çš„è¯é¡¹ï¼Œè€Œ &lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢ç›´æ¥è·³è¿‡æ­¤æ­¥éª¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜åŸºæ•°é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å­—æ®µå€¼å”¯ä¸€æ€§é«˜ï¼ˆå¦‚ &lt;code&gt;name&lt;/code&gt; å­—æ®µï¼‰ï¼Œèšåˆæˆ–æ’åºæ—¶éœ€æ„å»º Global Ordinalsï¼ˆå…¨å±€åºæ•°æ˜ å°„ï¼‰ï¼Œè€—æ—¶å¯å¯¼è‡´æŸ¥è¯¢å»¶è¿Ÿã€‚è€Œ &lt;code&gt;_id&lt;/code&gt; ä½œä¸ºå”¯ä¸€å€¼ï¼Œå¤©ç„¶é¿å…æ­¤é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µç±»å‹ä¸åˆ†è¯å½±å“&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœªç´¢å¼•çš„ &lt;code&gt;text&lt;/code&gt; å­—æ®µï¼ˆå¦‚æ—  &lt;code&gt;.keyword&lt;/code&gt; å­å­—æ®µï¼‰æ— æ³•ç›´æ¥ç²¾ç¡®åŒ¹é…ï¼Œéœ€å…¨è¡¨æ‰«æã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒMySQL ä¸­æœªç´¢å¼•çš„ &lt;code&gt;name&lt;/code&gt; å­—æ®µæŸ¥è¯¢è€—æ—¶ 6 ç§’ï¼Œè€Œ Elasticsearch æœªä¼˜åŒ–çš„ &lt;code&gt;text&lt;/code&gt; å­—æ®µä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”æ•°æ®"&gt;æ€§èƒ½å¯¹æ¯”æ•°æ®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MySQL å¯¹æ¯”å®éªŒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»é”® &lt;code&gt;id&lt;/code&gt; æŸ¥è¯¢è€—æ—¶ &lt;strong&gt;0.000000s&lt;/strong&gt;ï¼Œéä¸»é”® &lt;code&gt;name&lt;/code&gt; æŸ¥è¯¢è€—æ—¶ &lt;strong&gt;6s&lt;/strong&gt;ï¼ˆ1 åƒä¸‡æ•°æ®é‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Elasticsearch ä¸­ &lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢æ€§èƒ½æ¥è¿‘ MySQL ä¸»é”®æ•ˆç‡ï¼Œæ™®é€šå­—æ®µæ€§èƒ½å–å†³äºç´¢å¼•è®¾è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Elasticsearch ä¼˜åŒ–æ¡ˆä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;MultiGet&lt;/code&gt; æ‰¹é‡è·å– &lt;code&gt;_id&lt;/code&gt; æ–‡æ¡£ï¼Œæ¯”æ™®é€š &lt;code&gt;query&lt;/code&gt; æ›´å¿«ã€‚&lt;/li&gt;
&lt;li&gt;å…³é—­ &lt;code&gt;_source&lt;/code&gt; è·å–å¹¶æŒ‡å®š &lt;code&gt;docvalue_fields&lt;/code&gt; å¯è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼ˆå‡å°‘åºåˆ—åŒ–å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯å»ºè®®"&gt;é€‚ç”¨åœºæ™¯å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæŸ¥è¯¢æ–¹å¼&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç²¾ç¡®åŒ¹é…å”¯ä¸€æ–‡æ¡£&lt;/td&gt;
&lt;td&gt;&lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;ç›´æ¥å®šä½æ–‡æ¡£ï¼Œæ€§èƒ½æœ€ä¼˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é«˜é¢‘è¿‡æ»¤æ¡ä»¶&lt;/td&gt;
&lt;td&gt;æ™®é€šå­—æ®µ + ç´¢å¼•ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;å¯¹å¸¸ç”¨å­—æ®µå»ºç«‹ &lt;code&gt;keyword&lt;/code&gt; ç±»å‹ç´¢å¼•ï¼Œæ€§èƒ½æ¥è¿‘ &lt;code&gt;_id&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;èšåˆåˆ†æ&lt;/td&gt;
&lt;td&gt;é¿å…ä½¿ç”¨ &lt;code&gt;_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;_id&lt;/code&gt; ä¸æ”¯æŒèšåˆå’Œæ’åºï¼Œéœ€å¤åˆ¶åˆ°å…¶ä»–å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰¹é‡æ“ä½œ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;MultiGet&lt;/code&gt; æˆ– &lt;code&gt;Bulk&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼Œæå‡ååé‡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–æŠ€å·§"&gt;æ€§èƒ½ä¼˜åŒ–æŠ€å·§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯¹æ™®é€šå­—æ®µçš„ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†é«˜é¢‘æŸ¥è¯¢å­—æ®µè®¾ä¸º &lt;code&gt;keyword&lt;/code&gt; ç±»å‹å¹¶å»ºç«‹ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;filter&lt;/code&gt; ä¸Šä¸‹æ–‡åŠ é€Ÿç²¾ç¡®åŒ¹é…ï¼ˆç»“æœå¯ç¼“å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯¹ &lt;code&gt;_id&lt;/code&gt; çš„ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå®šä¹‰æœ‰ä¸šåŠ¡æ„ä¹‰çš„ &lt;code&gt;_id&lt;/code&gt;ï¼ˆå¦‚ç»„åˆé”®ï¼‰ï¼Œé¿å…è‡ªåŠ¨ç”Ÿæˆ UUID å¯¼è‡´å­˜å‚¨ç¢ç‰‡åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆè·¯ç”±ï¼ˆ&lt;code&gt;routing&lt;/code&gt;ï¼‰å‚æ•°ï¼Œå‡å°‘è·¨åˆ†ç‰‡æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-9"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;code&gt;_id&lt;/code&gt; æŸ¥è¯¢å› åº•å±‚å­˜å‚¨ä¼˜åŒ–å’Œå…åˆ†è¯ç‰¹æ€§ï¼Œæ€§èƒ½æ˜¾è‘—ä¼˜äºæ™®é€šå­—æ®µæŸ¥è¯¢ã€‚ä½†åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œéœ€ç»“åˆå­—æ®µç´¢å¼•è®¾è®¡ã€æŸ¥è¯¢æ¨¡å¼å’Œæ•°æ®è§„æ¨¡ç»¼åˆä¼˜åŒ–ã€‚å¯¹äºå¤æ‚æŸ¥è¯¢ï¼Œå»ºè®®é€šè¿‡ Profile API åˆ†æè€—æ—¶ï¼Œé’ˆå¯¹æ€§è°ƒæ•´ç´¢å¼•ç»“æ„å’ŒæŸ¥è¯¢é€»è¾‘ã€‚&lt;/p&gt;
&lt;h2 id="doc_values"&gt;doc_values
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œè‹¥å­˜åœ¨æ ¹æ® &lt;code&gt;memberCount&lt;/code&gt;ï¼ˆæ•°å€¼ç±»å‹å­—æ®µï¼‰è¿›è¡Œæ’åºçš„éœ€æ±‚ï¼Œ&lt;strong&gt;å¿…é¡»å°†è¯¥å­—æ®µçš„ &lt;code&gt;doc_values&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;true&lt;/code&gt;&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› å’Œé…ç½®å»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒé…ç½®åŸåˆ™"&gt;æ ¸å¿ƒé…ç½®åŸåˆ™
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;doc_values=true&lt;/code&gt; çš„ä½œç”¨&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;doc_values&lt;/code&gt; æ˜¯ Elasticsearch ç”¨äºæ”¯æŒæ’åºã€èšåˆå’Œè„šæœ¬æ“ä½œçš„åˆ—å¼å­˜å‚¨ç»“æ„ã€‚å½“è¯¥å­—æ®µéœ€è¦æ’åºæ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ’åºä¾èµ–æ­£æ’ç´¢å¼•&lt;/strong&gt;ï¼šæ’åºæ“ä½œéœ€è¦æŒ‰æ–‡æ¡£é¡ºåºå¿«é€Ÿè®¿é—®å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œ &lt;code&gt;doc_values&lt;/code&gt; æä¾›äº†é«˜æ•ˆçš„åˆ—å¼å­˜å‚¨ï¼Œé¿å…ä»å€’æ’ç´¢å¼•æˆ– &lt;code&gt;_source&lt;/code&gt; ä¸­è§£ææ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é»˜è®¤å¼€å¯&lt;/strong&gt;ï¼šæ•°å€¼ç±»å‹ï¼ˆå¦‚ &lt;code&gt;long&lt;/code&gt;ã€&lt;code&gt;integer&lt;/code&gt;ï¼‰é»˜è®¤å¼€å¯ &lt;code&gt;doc_values&lt;/code&gt;ï¼Œä½†éœ€ç¡®è®¤æ˜¯å¦è¢«æ‰‹åŠ¨å…³é—­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¦ç”¨ &lt;code&gt;doc_values&lt;/code&gt; çš„åæœ&lt;/strong&gt;&lt;br&gt;
è‹¥è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œæ’åºæ“ä½œå°†æ— æ³•æ‰§è¡Œï¼Œå¹¶è¿”å›ä»¥ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;reason&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Cannot sort on field [memberCount] because it is not indexed.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ç¤ºä¾‹ä¸éªŒè¯"&gt;é…ç½®ç¤ºä¾‹ä¸éªŒè¯
&lt;/h3&gt;&lt;h4 id="æ˜ å°„è®¾ç½®"&gt;æ˜ å°„è®¾ç½®
&lt;/h4&gt;&lt;p&gt;ç¡®ä¿ &lt;code&gt;memberCount&lt;/code&gt; çš„æ˜ å°„ä¸­ &lt;code&gt;doc_values&lt;/code&gt; æ˜¾å¼å¼€å¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT&lt;/span&gt; &lt;span class="err"&gt;/your_index/_mapping&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;memberCount&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;long&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;doc_values&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt; &lt;span class="c1"&gt;// æ˜ç¡®å¯ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æŸ¥è¯¢æ’åºç¤ºä¾‹"&gt;æŸ¥è¯¢æ’åºç¤ºä¾‹
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/your_index/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;match_all&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;memberCount&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;order&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;desc&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸å­˜å‚¨ä¼˜åŒ–å»ºè®®"&gt;æ€§èƒ½ä¸å­˜å‚¨ä¼˜åŒ–å»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æƒè¡¡å­˜å‚¨ä¸æ€§èƒ½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç£ç›˜å ç”¨&lt;/strong&gt;ï¼š&lt;code&gt;doc_values&lt;/code&gt; ä¼šå¢åŠ çº¦ 20%-30% çš„å­˜å‚¨ç©ºé—´ï¼Œä½†å¯¹æ’åºæ€§èƒ½æå‡æ˜¾è‘—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•é€Ÿåº¦&lt;/strong&gt;ï¼šå¼€å¯ &lt;code&gt;doc_values&lt;/code&gt; ä¼šç•¥å¾®é™ä½ç´¢å¼•å†™å…¥é€Ÿåº¦ï¼Œä½†å¯¹è¯»å¯†é›†å‹åœºæ™¯å½±å“å¯å¿½ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…å†—ä½™æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­ä¸å¿…è¦çš„ &lt;code&gt;doc_values&lt;/code&gt;&lt;/strong&gt;ï¼šè‹¥å…¶ä»–å­—æ®µæ— éœ€æ’åº/èšåˆï¼Œå¯å…³é—­å…¶ &lt;code&gt;doc_values&lt;/code&gt; ä»¥èŠ‚çœèµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆè·¯ç”±ä¸åˆ†ç‰‡&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;routing&lt;/code&gt; å‚æ•°å°†åŒç±»æ•°æ®é›†ä¸­åœ¨åŒä¸€åˆ†ç‰‡ï¼Œå‡å°‘è·¨åˆ†ç‰‡æ’åºå¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é‡å»ºç´¢å¼•&lt;/strong&gt;&lt;br&gt;
è‹¥ä¹‹å‰ &lt;code&gt;doc_values&lt;/code&gt; ä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œä¿®æ”¹åéœ€é€šè¿‡ &lt;code&gt;Reindex API&lt;/code&gt; é‡å»ºç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µç±»å‹ä¸€è‡´æ€§&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿ &lt;code&gt;memberCount&lt;/code&gt; ç±»å‹ä¸ºæ•°å€¼ï¼ˆå¦‚ &lt;code&gt;long&lt;/code&gt;ï¼‰ï¼Œè€Œé &lt;code&gt;text&lt;/code&gt; æˆ–å…¶ä»–ç±»å‹ï¼Œå¦åˆ™æ— æ³•å¯ç”¨ &lt;code&gt;doc_values&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘æ§èµ„æºä½¿ç”¨&lt;/strong&gt;&lt;br&gt;
åœ¨é«˜å¹¶å‘æ’åºåœºæ™¯ä¸‹ï¼Œå…³æ³¨ &lt;code&gt;JVM Heap&lt;/code&gt; å’Œç£ç›˜ I/Oï¼Œé¿å…å› å¤§è§„æ¨¡ &lt;code&gt;doc_values&lt;/code&gt; åŠ è½½å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-10"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;å¯¹äºéœ€è¦æ ¹æ® &lt;code&gt;memberCount&lt;/code&gt; æ’åºçš„åœºæ™¯ï¼Œ&lt;strong&gt;å¿…é¡»è®¾ç½® &lt;code&gt;doc_values: true&lt;/code&gt;&lt;/strong&gt;ã€‚æ­¤é…ç½®é€šè¿‡åˆ—å¼å­˜å‚¨ä¼˜åŒ–æ’åºæ•ˆç‡ï¼Œæ˜¯ Elasticsearch å¤„ç†ç»“æ„åŒ–æ•°æ®åˆ†æçš„æ ¸å¿ƒæœºåˆ¶ã€‚åŒæ—¶éœ€ç»“åˆä¸šåŠ¡éœ€æ±‚å¹³è¡¡å­˜å‚¨ä¸æ€§èƒ½ï¼Œé¿å…è¿‡åº¦å ç”¨èµ„æºã€‚&lt;/p&gt;
&lt;h2 id="docvalues"&gt;DocValues
&lt;/h2&gt;&lt;h2 id="analyzer"&gt;analyzer
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œ&lt;code&gt;analyzer&lt;/code&gt;ï¼ˆç´¢å¼•åˆ†è¯å™¨ï¼‰å’Œ &lt;code&gt;search_analyzer&lt;/code&gt;ï¼ˆæœç´¢åˆ†è¯å™¨ï¼‰çš„è®¾ç½®ç›´æ¥å½±å“æœç´¢ç»“æœçš„å‡†ç¡®æ€§å’Œæ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯é’ˆå¯¹ &lt;strong&gt;ik_max_word&lt;/strong&gt; å’Œ &lt;strong&gt;ik_smart&lt;/strong&gt; çš„å¯¹æ¯”åˆ†æåŠæœ€ä½³å®è·µå»ºè®®ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŒºåˆ«ä¸é€‚ç”¨åœºæ™¯"&gt;æ ¸å¿ƒåŒºåˆ«ä¸é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;h4 id="ik_"&gt;&lt;strong&gt;ik_max_word&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†è¯ç²’åº¦&lt;/strong&gt;ï¼šæœ€ç»†ç²’åº¦åˆ‡åˆ†ï¼Œå°½å¯èƒ½ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„è¯é¡¹ç»„åˆã€‚
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šâ€œä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œâ€ â†’ æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½ã€ä¸­åäººæ°‘ã€ä¸­åã€åäººã€äººæ°‘å…±å’Œå›½â€¦â€¦â€ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•é˜¶æ®µ&lt;/strong&gt;ï¼ˆ&lt;code&gt;analyzer&lt;/code&gt;ï¼‰ï¼šé€‚åˆéœ€è¦è¦†ç›–æ‰€æœ‰æ½œåœ¨æœç´¢å…³é”®è¯çš„åœºæ™¯ï¼Œå¦‚å…¨æ–‡æœç´¢å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Term Query&lt;/strong&gt;ï¼šç²¾ç¡®åŒ¹é…è¯é¡¹æ—¶ï¼Œèƒ½åŒ¹é…æ›´å¤šå¯èƒ½æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ik_-1"&gt;&lt;strong&gt;ik_smart&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†è¯ç²’åº¦&lt;/strong&gt;ï¼šæœ€ç²—ç²’åº¦åˆ‡åˆ†ï¼Œä»…ä¿ç•™æ ¸å¿ƒè¯é¡¹ã€‚
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šâ€œä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œâ€ â†’ æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½ã€å›½æ­Œâ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœç´¢é˜¶æ®µ&lt;/strong&gt;ï¼ˆ&lt;code&gt;search_analyzer&lt;/code&gt;ï¼‰ï¼šé€‚åˆæå‡æœç´¢ç²¾å‡†åº¦ï¼Œå‡å°‘æ— å…³ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Phrase Query&lt;/strong&gt;ï¼šçŸ­è¯­åŒ¹é…æ—¶é¿å…å†—ä½™è¯é¡¹å¹²æ‰°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="è®¾ç½®å»ºè®®ä¸æœ€ä½³å®è·µ"&gt;è®¾ç½®å»ºè®®ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;h4 id="å¸¸è§„é…ç½®æ–¹æ¡ˆ"&gt;&lt;strong&gt;å¸¸è§„é…ç½®æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•æ—¶ç”¨ &lt;code&gt;ik_max_word&lt;/code&gt;ï¼Œæœç´¢æ—¶ç”¨ &lt;code&gt;ik_smart&lt;/code&gt;&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;mappings&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;// ç´¢å¼•åˆ†è¯å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;search_analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt; &lt;span class="c1"&gt;// æœç´¢åˆ†è¯å™¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•é˜¶æ®µ&lt;/strong&gt;ï¼šæœ€å¤§åŒ–åˆ†è¯è¦†ç›–ï¼Œç¡®ä¿æ‰€æœ‰æ½œåœ¨å…³é”®è¯è¢«ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœç´¢é˜¶æ®µ&lt;/strong&gt;ï¼šç²—ç²’åº¦åŒ¹é…ï¼Œæå‡ç›¸å…³æ€§ï¼ˆå¦‚æœç´¢â€œåä¸ºæ‰‹æœºâ€ä¸ä¼šæ‹†åˆ†ä¸ºâ€œåä¸º+æ‰‹æœºâ€ï¼Œè€Œæ˜¯ä½œä¸ºæ•´ä½“åŒ¹é…ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ä¾‹å¤–åœºæ™¯è°ƒæ•´"&gt;&lt;strong&gt;ä¾‹å¤–åœºæ™¯è°ƒæ•´&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜ç²¾åº¦å­—æ®µ&lt;/strong&gt;ï¼ˆå¦‚æ ‡ç­¾ã€åˆ†ç±»ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å­—æ®µå€¼æœ¬èº«æ˜¯è§„èŒƒè¯ï¼ˆå¦‚â€œJavaScriptâ€ï¼‰ï¼Œå¯ç»Ÿä¸€ä½¿ç”¨ &lt;code&gt;ik_smart&lt;/code&gt;ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;tags&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;search_analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é¿å…å› è¿‡åº¦æ‹†åˆ†å¯¼è‡´è¯¯åŒ¹é…ï¼ˆå¦‚â€œJSâ€åº”ç›´æ¥æ˜ å°„åˆ°â€œJavaScriptâ€ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰è¯å…¸ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ ä¸“ä¸šæœ¯è¯­åˆ°è¯å…¸ï¼ˆå¦‚â€œ00åâ€â€œ5Gâ€ï¼‰ï¼Œç¡®ä¿ &lt;code&gt;ik_max_word&lt;/code&gt; å’Œ &lt;code&gt;ik_smart&lt;/code&gt; å‡èƒ½æ­£ç¡®åˆ‡åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¸æ•ˆæœéªŒè¯"&gt;æ€§èƒ½ä¸æ•ˆæœéªŒè¯
&lt;/h3&gt;&lt;h4 id="ç´¢å¼•æ€§èƒ½"&gt;&lt;strong&gt;ç´¢å¼•æ€§èƒ½&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ik_max_word&lt;/code&gt;&lt;/strong&gt;ï¼šç”Ÿæˆæ›´å¤šè¯é¡¹ï¼Œç´¢å¼•ä½“ç§¯è¾ƒå¤§ï¼Œå†™å…¥é€Ÿåº¦ç•¥ä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–å»ºè®®&lt;/strong&gt;ï¼šå¯¹ä½é¢‘æ›´æ–°å­—æ®µä½¿ç”¨ &lt;code&gt;ik_max_word&lt;/code&gt;ï¼Œé«˜é¢‘æ›´æ–°å­—æ®µå¯æƒè¡¡åæ”¹ç”¨ &lt;code&gt;ik_smart&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æœç´¢æ•ˆæœ"&gt;&lt;strong&gt;æœç´¢æ•ˆæœ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•æ–¹æ³•&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;_analyze&lt;/code&gt; API éªŒè¯åˆ†è¯ç»“æœï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/_analyze&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;åä¸ºæ‰‹æœº&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è¾“å‡ºï¼š[&amp;#34;åä¸º&amp;#34;, &amp;#34;æ‰‹æœº&amp;#34;, &amp;#34;åä¸ºæ‰‹æœº&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/_analyze&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;åä¸ºæ‰‹æœº&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;analyzer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è¾“å‡ºï¼š[&amp;#34;åä¸ºæ‰‹æœº&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;ç»“åˆ &lt;code&gt;explain&lt;/code&gt; å‚æ•°åˆ†ææœç´¢åŒ¹é…é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸æ¨è"&gt;æ€»ç»“ä¸æ¨è
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;analyzer&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;search_analyzer&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç†ç”±&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å…¨æ–‡æ£€ç´¢å­—æ®µï¼ˆå¦‚æ­£æ–‡ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ik_max_word&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç´¢å¼•è¦†ç›–å…¨ï¼Œæœç´¢æ›´ç²¾å‡†ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ ‡ç­¾/åˆ†ç±»å­—æ®µ&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é¿å…å†—ä½™æ‹†åˆ†ï¼Œç›´æ¥åŒ¹é…è§„èŒƒè¯ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°å€¼+é‡è¯ç»„åˆï¼ˆå¦‚â€œ7å¤©â€ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åˆå¹¶ä¸ºæ•´ä½“ï¼ˆ&lt;code&gt;TYPE_CQUAN&lt;/code&gt;ï¼‰ï¼Œé¿å…æ‹†åˆ†ä¸ºâ€œ7â€å’Œâ€œå¤©â€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆå»ºè®®&lt;/strong&gt;ï¼šä¼˜å…ˆé‡‡ç”¨ &lt;strong&gt;ç´¢å¼• &lt;code&gt;ik_max_word&lt;/code&gt; + æœç´¢ &lt;code&gt;ik_smart&lt;/code&gt;&lt;/strong&gt; çš„é»˜è®¤ç»„åˆï¼Œå†æ ¹æ®å­—æ®µç‰¹æ€§å¾®è°ƒã€‚å®šæœŸé€šè¿‡ &lt;code&gt;_analyze&lt;/code&gt; å’Œæœç´¢æ—¥å¿—éªŒè¯æ•ˆæœï¼Œå¿…è¦æ—¶æ›´æ–°è‡ªå®šä¹‰è¯å…¸ã€‚&lt;/p&gt;
&lt;h2 id="fieldtypetext-and-docvalues"&gt;&lt;code&gt;FieldType.Text&lt;/code&gt; and &lt;code&gt;docValues&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch çš„ &lt;code&gt;@Field&lt;/code&gt; æ³¨è§£ä¸­ï¼Œ&lt;code&gt;FieldType.Text&lt;/code&gt; ç±»å‹å­—æ®µçš„ &lt;code&gt;docValues&lt;/code&gt; è®¾ç½®éœ€æ ¹æ®å…·ä½“åœºæ™¯å†³ç­–ã€‚ä»¥ä¸‹æ˜¯å…³é”®åˆ†æåŠæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="fieldtypetext-æ˜¯å¦åº”è®¾ç½®-docvalues--false"&gt;&lt;code&gt;FieldType.Text&lt;/code&gt; æ˜¯å¦åº”è®¾ç½® &lt;code&gt;docValues = false&lt;/code&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å»ºè®®è®¾ç½®ä¸º &lt;code&gt;false&lt;/code&gt;&lt;/strong&gt;ï¼ŒåŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Text ç±»å‹çš„é»˜è®¤è¡Œä¸º&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;FieldType.Text&lt;/code&gt; å­—æ®µé»˜è®¤å¼€å¯å€’æ’ç´¢å¼•ï¼ˆç”¨äºå…¨æ–‡æœç´¢ï¼‰ï¼Œä½† &lt;strong&gt;é»˜è®¤å…³é—­ &lt;code&gt;doc_values&lt;/code&gt;&lt;/strong&gt;ã€‚è¿™æ˜¯å› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Text å­—æ®µé€šå¸¸ç”¨äºå…¨æ–‡æ£€ç´¢ï¼Œå…¶åˆ†è¯åçš„è¯é¡¹ä¸é€‚åˆç›´æ¥ç”¨äºæ’åºæˆ–èšåˆã€‚&lt;/li&gt;
&lt;li&gt;å¼€å¯ &lt;code&gt;doc_values&lt;/code&gt; éœ€è¦å°†åˆ†è¯åçš„è¯é¡¹æŒ‰åˆ—å­˜å‚¨ï¼Œè¿™ä¼šæ˜¾è‘—å¢åŠ å­˜å‚¨å¼€é”€ä¸”æ€§èƒ½ä½ä¸‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¸å­˜å‚¨ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Text å­—æ®µè‹¥æ— éœ€æ’åº/èšåˆï¼Œè®¾ç½® &lt;code&gt;doc_values = false&lt;/code&gt; å¯å‡å°‘ç£ç›˜å ç”¨å’Œå†™å…¥å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹é…ç½®ï¼ˆç¬¦åˆå¸¸è§„éœ€æ±‚ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docValues&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;analyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;searchAnalyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_smart&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="text-å­—æ®µçš„æ’åºèšåˆéœ€æ±‚åœºæ™¯"&gt;Text å­—æ®µçš„æ’åº/èšåˆéœ€æ±‚åœºæ™¯
&lt;/h3&gt;&lt;p&gt;å°½ç®¡ Text ç±»å‹ä¸æ¨èç”¨äºæ’åºå’Œèšåˆï¼Œä½†åœ¨ä»¥ä¸‹ç‰¹æ®Šåœºæ™¯å¯èƒ½éœ€è¦å¯ç”¨ &lt;code&gt;fielddata&lt;/code&gt;ï¼ˆè€Œé &lt;code&gt;doc_values&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯é¢‘ç»Ÿè®¡æˆ–åˆ†è¯ç»“æœåˆ†æ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ï¼šç»Ÿè®¡æŸç¯‡æ–‡ç« ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„è¯æ±‡ã€‚éœ€ä¸´æ—¶å¯ç”¨ &lt;code&gt;fielddata&lt;/code&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fielddata&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;analyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼š&lt;code&gt;fielddata&lt;/code&gt; ä¼šå°†è¯é¡¹åŠ è½½åˆ° JVM å †å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€è„šæœ¬è®¡ç®—&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥è„šæœ¬ä¸­éœ€è®¿é—® Text å­—æ®µçš„åˆ†è¯ç»“æœï¼ˆå¦‚è®¡ç®—è¯é¡¹æƒé‡ï¼‰ï¼Œéœ€å¯ç”¨ &lt;code&gt;fielddata&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ›¿ä»£æ–¹æ¡ˆå¤šå­—æ®µmulti-fieldç­–ç•¥"&gt;æ›¿ä»£æ–¹æ¡ˆï¼šå¤šå­—æ®µï¼ˆMulti-Fieldï¼‰ç­–ç•¥
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;æ›´æ¨èé€šè¿‡å¤šå­—æ®µè®¾è®¡æ»¡è¶³æ··åˆéœ€æ±‚&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„åˆ &lt;code&gt;Text&lt;/code&gt; å’Œ &lt;code&gt;Keyword&lt;/code&gt; å­—æ®µ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;Text&lt;/code&gt; ç±»å‹æ”¯æŒå…¨æ–‡æ£€ç´¢ï¼ŒåŒæ—¶é€šè¿‡ &lt;code&gt;Keyword&lt;/code&gt; å­å­—æ®µæ”¯æŒæ’åº/èšåˆï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;analyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;searchAnalyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ik_smart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;keyword&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Keyword&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ—¶ä½¿ç”¨ &lt;code&gt;å­—æ®µå.keyword&lt;/code&gt; è¿›è¡Œç²¾ç¡®åŒ¹é…æˆ–èšåˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¸åŠŸèƒ½å¹³è¡¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Keyword&lt;/code&gt; å­—æ®µé»˜è®¤å¯ç”¨ &lt;code&gt;doc_values&lt;/code&gt;ï¼Œæ”¯æŒé«˜æ•ˆæ’åºã€èšåˆå’Œè„šæœ¬æ“ä½œï¼Œä¸”ä¸æ¶‰åŠåˆ†è¯å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸å»ºè®®-1"&gt;æ€»ç»“ä¸å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é…ç½®ç­–ç•¥&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¼•ç”¨ä¾æ®&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;çº¯å…¨æ–‡æ£€ç´¢&lt;/td&gt;
&lt;td&gt;&lt;code&gt;docValues = false&lt;/code&gt;ï¼Œç¦ç”¨ &lt;code&gt;fielddata&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯é¢‘ç»Ÿè®¡/è„šæœ¬æ“ä½œ&lt;/td&gt;
&lt;td&gt;å¯ç”¨ &lt;code&gt;fielddata = true&lt;/code&gt;ï¼Œä½†éœ€ç›‘æ§ JVM å†…å­˜&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éœ€è¦æ’åºæˆ–èšåˆ&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨å¤šå­—æ®µè®¾è®¡ï¼Œé€šè¿‡ &lt;code&gt;Keyword&lt;/code&gt; å­å­—æ®µå®ç°&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é«˜å¹¶å‘å†™å…¥åœºæ™¯&lt;/td&gt;
&lt;td&gt;å…³é—­æ— å…³å­—æ®µçš„ &lt;code&gt;doc_values&lt;/code&gt; å’Œç´¢å¼•ï¼Œä¼˜åŒ–å†™å…¥æ€§èƒ½&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé€šè¿‡å¤šå­—æ®µè®¾è®¡åˆ†ç¦»æ£€ç´¢ä¸åˆ†æéœ€æ±‚ï¼Œé¿å…ç›´æ¥å¯¹ &lt;code&gt;Text&lt;/code&gt; å­—æ®µå¯ç”¨ &lt;code&gt;doc_values&lt;/code&gt; æˆ– &lt;code&gt;fielddata&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä»…åœ¨æ˜ç¡®éœ€è¦åˆ†è¯çº§åˆ†ææ—¶å¯ç”¨ &lt;code&gt;fielddata&lt;/code&gt;ï¼Œå¹¶ä¸¥æ ¼é™åˆ¶å…¶ä½¿ç”¨èŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="postgres-ä¸­ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•"&gt;Postgres ä¸­ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•
&lt;/h2&gt;&lt;p&gt;åœ¨ PostgreSQL ä¸­ï¼Œ&lt;strong&gt;ä¸»é”®ï¼ˆé€šå¸¸ä¸º &lt;code&gt;id&lt;/code&gt;ï¼‰çš„æŸ¥è¯¢&lt;/strong&gt;ä¸&lt;strong&gt;å»ºç«‹äº†å”¯ä¸€éç©ºç´¢å¼•çš„å­—æ®µæŸ¥è¯¢&lt;/strong&gt;åœ¨æ€§èƒ½ä¸Šçš„å·®å¼‚ä¸»è¦å–å†³äºç´¢å¼•ç»“æ„ã€æ•°æ®åˆ†å¸ƒå’ŒæŸ¥è¯¢ä¼˜åŒ–å™¨çš„é€‰æ‹©ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç´¢å¼•ç»“æ„ä¸æ€§èƒ½åŸºç¡€"&gt;&lt;strong&gt;ç´¢å¼•ç»“æ„ä¸æ€§èƒ½åŸºç¡€&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸»é”®ç´¢å¼•&lt;/strong&gt;ï¼šPostgreSQL çš„ä¸»é”®é»˜è®¤ä½¿ç”¨ B-tree ç´¢å¼•ï¼Œä¸”éšå¼åŒ…å«éç©ºçº¦æŸå’Œå”¯ä¸€æ€§çº¦æŸã€‚ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ç›´æ¥æŒ‡å‘å †è¡¨ï¼ˆHeapï¼‰ä¸­çš„è¡Œæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å”¯ä¸€éç©ºç´¢å¼•&lt;/strong&gt;ï¼šæ‰‹åŠ¨åˆ›å»ºçš„å”¯ä¸€éç©ºç´¢å¼•ï¼ˆå¦‚ &lt;code&gt;CREATE UNIQUE INDEX&lt;/code&gt;ï¼‰ä¹Ÿä½¿ç”¨ B-tree ç»“æ„ï¼ŒåŠŸèƒ½ä¸Šä¸ä¸»é”®ç´¢å¼•ç±»ä¼¼ï¼Œä½†éœ€è¦æ˜¾å¼å®šä¹‰éç©ºçº¦æŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šä¸¤è€…çš„åº•å±‚ç´¢å¼•ç»“æ„å’ŒæŸ¥è¯¢å¤æ‚åº¦ï¼ˆO(log n)ï¼‰å‡ ä¹ç›¸åŒï¼Œå› æ­¤åœ¨ç­‰å€¼æŸ¥è¯¢ï¼ˆå¦‚ &lt;code&gt;WHERE id = 1&lt;/code&gt;ï¼‰åœºæ™¯ä¸‹ï¼Œæ€§èƒ½å·®å¼‚é€šå¸¸å¯ä»¥å¿½ç•¥ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¼˜åŒ–å™¨è¡Œä¸ºçš„æ½œåœ¨å·®å¼‚"&gt;&lt;strong&gt;ä¼˜åŒ–å™¨è¡Œä¸ºçš„æ½œåœ¨å·®å¼‚&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡ä¿¡æ¯ä¼˜å…ˆçº§&lt;/strong&gt;ï¼šä¼˜åŒ–å™¨å¯èƒ½ä¼˜å…ˆé€‰æ‹©ä¸»é”®ç´¢å¼•ï¼Œå› ä¸ºä¸»é”®é€šå¸¸ä½œä¸ºè¡¨çš„é»˜è®¤è®¿é—®è·¯å¾„ï¼Œä¸”ç»Ÿè®¡ä¿¡æ¯æ›´æ–°é¢‘ç‡è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¦†ç›–ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;ï¼šå¦‚æœå”¯ä¸€éç©ºç´¢å¼•é€šè¿‡ &lt;code&gt;INCLUDE&lt;/code&gt; å­å¥åŒ…å«é¢å¤–çš„åˆ—ï¼ˆä¾‹å¦‚ &lt;code&gt;CREATE UNIQUE INDEX idx_email ON users(email) INCLUDE (name)&lt;/code&gt;ï¼‰ï¼Œå¯èƒ½å®Œå…¨é¿å…å †è¡¨è®¿é—®ï¼Œæ­¤æ—¶æ€§èƒ½å¯èƒ½ä¼˜äºä¸»é”®ç´¢å¼•ã€‚
&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ &lt;code&gt;SELECT name FROM users WHERE email = 'test@example.com'&lt;/code&gt; è‹¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¯ç›´æ¥ä»ç´¢å¼•ä¸­è·å–æ•°æ®ï¼Œæ— éœ€å›è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šå”¯ä¸€éç©ºç´¢å¼•é€šè¿‡è¦†ç›–ç´¢å¼•ä¼˜åŒ–å¯èƒ½æ›´å¿«ï¼Œè€Œä¸»é”®ç´¢å¼•åœ¨å¸¸è§„æŸ¥è¯¢ä¸­æ›´ç¨³å®šã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å†™å…¥æ€§èƒ½çš„å½±å“"&gt;&lt;strong&gt;å†™å…¥æ€§èƒ½çš„å½±å“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸»é”®çº¦æŸçš„å¼€é”€&lt;/strong&gt;ï¼šä¸»é”®çš„æ›´æ–°å¯èƒ½è§¦å‘å¤–é”®çº§è”æ“ä½œæˆ–è§¦å‘å™¨çš„é¢å¤–æˆæœ¬ï¼Œè€Œå”¯ä¸€ç´¢å¼•é€šå¸¸ä»…ç»´æŠ¤ç´¢å¼•ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MVCC ä¸ç‰ˆæœ¬é“¾&lt;/strong&gt;ï¼šPostgreSQL çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰å¯èƒ½å¯¼è‡´ç´¢å¼•æŒ‡å‘ä¸åŒç‰ˆæœ¬çš„è¡Œæ•°æ®ã€‚ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•åœ¨ç»´æŠ¤ç‰ˆæœ¬é“¾æ—¶æ€§èƒ½æŸè€—ç›¸ä¼¼ï¼Œä½†é«˜é¢‘æ›´æ–°åœºæ™¯ä¸‹å¯èƒ½ç•¥æœ‰å·®å¼‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šå†™å…¥æ€§èƒ½å·®å¼‚æ›´å¤šå–å†³äºä¸šåŠ¡åœºæ™¯ï¼Œè€Œéç´¢å¼•ç±»å‹æœ¬èº«ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å®é™…åœºæ™¯éªŒè¯"&gt;&lt;strong&gt;å®é™…åœºæ™¯éªŒè¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨è¡¨æ‰«æä¸ç´¢å¼•æ‰«æ&lt;/strong&gt;ï¼šå¯¹äºå°è¡¨ï¼ˆå¦‚ &amp;lt;1000 è¡Œï¼‰ï¼Œä¼˜åŒ–å™¨å¯èƒ½é€‰æ‹©å…¨è¡¨æ‰«æè€Œéç´¢å¼•æ‰«æï¼Œæ­¤æ—¶ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„æ€§èƒ½å·®å¼‚æ— æ„ä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤åˆæŸ¥è¯¢ä¼˜åŒ–&lt;/strong&gt;ï¼šåœ¨æ¶‰åŠæ’åºï¼ˆ&lt;code&gt;ORDER BY&lt;/code&gt;ï¼‰æˆ–è¿æ¥ï¼ˆ&lt;code&gt;JOIN&lt;/code&gt;ï¼‰çš„å¤æ‚æŸ¥è¯¢ä¸­ï¼Œä¸»é”®å¯èƒ½å› ç»Ÿè®¡ä¿¡æ¯æ›´å®Œæ•´è€Œè¢«ä¼˜å…ˆé€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- ä¸»é”®æŸ¥è¯¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;EXPLAIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ANALYZE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- å”¯ä¸€éç©ºå­—æ®µæŸ¥è¯¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;EXPLAIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ANALYZE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test@example.com&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸¤è€…çš„æ‰§è¡Œè®¡åˆ’è‹¥å‡ä½¿ç”¨ &lt;code&gt;Index Scan&lt;/code&gt;ï¼Œåˆ™æ€§èƒ½æ¥è¿‘ï¼›è‹¥å”¯ä¸€ç´¢å¼•è§¦å‘è¦†ç›–ç´¢å¼•ï¼Œåˆ™å¯èƒ½æ›´å¿«ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µå»ºè®®"&gt;&lt;strong&gt;æœ€ä½³å®è·µå»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ä¸»é”®&lt;/strong&gt;ï¼šä¸»é”®æ˜¯è¡¨çš„é»˜è®¤è®¿é—®è·¯å¾„ï¼Œä¼˜åŒ–å™¨å¯¹å…¶æ›´å‹å¥½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‰éœ€æ·»åŠ è¦†ç›–ç´¢å¼•&lt;/strong&gt;ï¼šè‹¥å”¯ä¸€å­—æ®µæŸ¥è¯¢é¢‘ç¹ä¸”éœ€è¿”å›å¤šåˆ—ï¼Œä½¿ç”¨ &lt;code&gt;INCLUDE&lt;/code&gt; å­å¥ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§ç»Ÿè®¡ä¿¡æ¯&lt;/strong&gt;ï¼šå®šæœŸè¿è¡Œ &lt;code&gt;ANALYZE&lt;/code&gt; æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œç¡®ä¿ä¼˜åŒ–å™¨é€‰æ‹©æœ€ä½³ç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-11"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åœ¨ PostgreSQL ä¸­ï¼Œä¸»é”®æŸ¥è¯¢ä¸å”¯ä¸€éç©ºç´¢å¼•æŸ¥è¯¢çš„&lt;strong&gt;æ€§èƒ½å·®å¼‚é€šå¸¸è¾ƒå°&lt;/strong&gt;ï¼Œä½†å¯é€šè¿‡è¦†ç›–ç´¢å¼•ã€ç»Ÿè®¡ä¿¡æ¯ä¼˜åŒ–ç­‰åœºæ™¯è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®é€šè¿‡ &lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt; åˆ†æå…·ä½“æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚&lt;/p&gt;
&lt;h2 id="elasticsearch-search-after"&gt;Elasticsearch &amp;ldquo;Search After&amp;rdquo;
&lt;/h2&gt;&lt;h3 id="æ ¸å¿ƒåŸç†-2"&gt;&lt;strong&gt;æ ¸å¿ƒåŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Search After æ˜¯ä¸€ç§åŸºäºæ¸¸æ ‡çš„æ·±åº¦åˆ†é¡µæŠ€æœ¯ï¼Œé€šè¿‡**è®°å½•ä¸Šä¸€é¡µæœ€åä¸€æ¡æ–‡æ¡£çš„æ’åºå€¼ï¼ˆSort Valueï¼‰**ä½œä¸ºèµ·ç‚¹è¿›è¡Œåˆ†é¡µï¼Œé¿å…äº†ä¼ ç»Ÿ &lt;code&gt;from + size&lt;/code&gt; åˆ†é¡µä¸­å…¨å±€éå†çš„æ€§èƒ½ç“¶é¢ˆã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå®šç‚¹ç»­æŸ¥â€ï¼Œæ¯æ¬¡æŸ¥è¯¢ä»…å¤„ç†æ’åºå€¼ä¹‹åçš„æ–‡æ¡£ï¼Œä»è€Œç»•è¿‡æ·±åº¦åˆ†é¡µçš„é«˜å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®æœºåˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ’åºå”¯ä¸€æ€§&lt;/strong&gt;ï¼šéœ€æŒ‡å®šè‡³å°‘ä¸€ä¸ªå”¯ä¸€æ’åºå­—æ®µï¼ˆå¦‚ç»“åˆ &lt;code&gt;_id&lt;/code&gt; æˆ–æ—¶é—´æˆ³ï¼‰ï¼Œç¡®ä¿åˆ†é¡µé¡ºåºç¨³å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— çŠ¶æ€æ€§&lt;/strong&gt;ï¼šä¸ä¾èµ–ä¸Šä¸‹æ–‡ï¼ˆå¦‚ Scroll IDï¼‰ï¼Œæ¯æ¬¡è¯·æ±‚åŸºäºæœ€æ–°æ•°æ®ï¼Œé€‚ç”¨äºå®æ—¶åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ä½¿ç”¨æ­¥éª¤"&gt;&lt;strong&gt;ä½¿ç”¨æ­¥éª¤&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¦–æ¬¡æŸ¥è¯¢&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æŒ‡å®šæ’åºè§„åˆ™ï¼Œè·å–åˆå§‹ç»“æœé›†åŠæœ€åä¸€æ¡æ–‡æ¡£çš„æ’åºå€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/index/_search&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;size&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;desc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;asc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;elasticsearch&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åç»­åˆ†é¡µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å‰é¡µæœ«å°¾çš„æ’åºå€¼ä½œä¸º &lt;code&gt;search_after&lt;/code&gt; å‚æ•°ï¼Œç»§ç»­æŸ¥è¯¢ä¸‹ä¸€é¡µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/index/_search&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;size&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;desc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;asc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;search_after&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1690000000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;doc_id_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;match&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;elasticsearch&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ä¼˜ç¼ºç‚¹å¯¹æ¯”"&gt;&lt;strong&gt;ä¼˜ç¼ºç‚¹å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;âœ… æ— çŠ¶æ€ï¼Œæ— éœ€ç»´æŠ¤ Scroll ä¸Šä¸‹æ–‡&lt;/td&gt;
&lt;td&gt;âŒ éœ€å”¯ä¸€æ’åºå­—æ®µä¿è¯åˆ†é¡µç¨³å®šæ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;âœ… å®æ—¶æ€§å¼ºï¼Œé€‚åˆåŠ¨æ€æ•°æ®åœºæ™¯&lt;/td&gt;
&lt;td&gt;âŒ æŸ¥è¯¢æœŸé—´æ•°æ®å˜æ›´å¯èƒ½å¯¼è‡´ç»“æœæ³¢åŠ¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;âœ… æ€§èƒ½ä¼˜äº &lt;code&gt;from + size&lt;/code&gt;ï¼ˆæ·±åº¦åˆ†é¡µï¼‰&lt;/td&gt;
&lt;td&gt;âŒ éœ€å®¢æˆ·ç«¯ç®¡ç†æ’åºå€¼ï¼Œé€»è¾‘å¤æ‚åº¦ç¨é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯-5"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ·±åº¦åˆ†é¡µ&lt;/strong&gt;ï¼šå¤„ç†ä¸‡çº§ä»¥ä¸Šçš„æ•°æ®åˆ†é¡µï¼Œé¿å… &lt;code&gt;from + size&lt;/code&gt; çš„å†…å­˜ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ•°æ®æµ&lt;/strong&gt;ï¼šå¦‚ç”¨æˆ·ç•Œé¢ç¿»é¡µã€å®æ—¶æ—¥å¿—æŸ¥è¯¢ï¼Œéœ€åæ˜ æœ€æ–°æ•°æ®çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“åˆ PITï¼ˆPoint in Timeï¼‰&lt;/strong&gt;ï¼šé€šè¿‡å¿«ç…§ä¿è¯æŸ¥è¯¢æœŸé—´æ•°æ®ä¸€è‡´æ€§ï¼Œè§£å†³æ•°æ®å˜æ›´å¯¼è‡´çš„æ³¢åŠ¨é—®é¢˜ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/index/_pit?keep_alive=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="err"&gt;m&lt;/span&gt; &lt;span class="c1"&gt;// åˆ›å»º PIT å¿«ç…§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/_search&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;pit&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;snapshot_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;keep_alive&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;1m&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;search_after&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="err"&gt;last_sort_values&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;desc&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ’åºè®¾è®¡&lt;/strong&gt;ï¼šè‡³å°‘åŒ…å«ä¸€ä¸ªå”¯ä¸€å­—æ®µï¼ˆå¦‚ &lt;code&gt;_id&lt;/code&gt; æˆ–ä¸šåŠ¡ä¸»é”®ï¼‰ï¼Œç¡®ä¿åˆ†é¡µé¡ºåºå”¯ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½è°ƒä¼˜&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å‡å°‘è¿”å›å­—æ®µï¼ˆä½¿ç”¨ &lt;code&gt;_source&lt;/code&gt; è¿‡æ»¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆ &lt;code&gt;runtime_mappings&lt;/code&gt; åŠ¨æ€ç”Ÿæˆæ’åºå­—æ®µï¼Œé™ä½å­˜å‚¨å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼šæ•è·åˆ†é¡µè¿‡ç¨‹ä¸­çš„æ•°æ®å˜æ›´å¼‚å¸¸ï¼ˆå¦‚æ–‡æ¡£åˆ é™¤å¯¼è‡´æ’åºå€¼å¤±æ•ˆï¼‰ï¼Œå®ç°è‡ªåŠ¨é‡è¯•æˆ–æ–­ç‚¹ç»­æŸ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–åˆ†é¡µæŠ€æœ¯çš„å¯¹æ¯”"&gt;&lt;strong&gt;ä¸å…¶ä»–åˆ†é¡µæŠ€æœ¯çš„å¯¹æ¯”&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æŠ€æœ¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®æ—¶æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;èµ„æºæ¶ˆè€—&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;from + size&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æµ…å±‚åˆ†é¡µï¼ˆ&amp;lt;10K æ•°æ®ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆæ·±åº¦åˆ†é¡µåŠ£åŒ–ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆå†…å­˜/CPUï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Search After&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ·±åº¦åˆ†é¡µã€å®æ—¶æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Scroll API&lt;/td&gt;
&lt;td&gt;å¤§æ•°æ®å¯¼å‡ºã€ç¦»çº¿åˆ†æ&lt;/td&gt;
&lt;td&gt;ä¸­ï¼ˆå¿«ç…§å¼€é”€ï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆæ•°æ®å¿«ç…§ï¼‰&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆç»´æŠ¤ä¸Šä¸‹æ–‡ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-12"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Search After æ˜¯ Elasticsearch æ¨èçš„æ·±åº¦åˆ†é¡µè§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶é€‚åˆé«˜å®æ—¶æ€§ã€å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚é€šè¿‡åˆç†è®¾è®¡æ’åºè§„åˆ™å¹¶ç»“åˆ PIT å¿«ç…§ï¼Œå¯å¹³è¡¡æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§ã€‚ç›¸è¾ƒäº Scroll APIï¼Œå…¶æ— çŠ¶æ€ç‰¹æ€§æ˜¾è‘—é™ä½äº†èµ„æºæ¶ˆè€—ï¼Œæ˜¯å®æ—¶åˆ†é¡µçš„é¦–é€‰æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="elasticsearchrepository"&gt;ElasticsearchRepository
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;ElasticsearchRepository&lt;/code&gt; æ˜¯ Spring Data Elasticsearch çš„æ ¸å¿ƒæ¥å£ä¹‹ä¸€ï¼Œå®ƒç»§æ‰¿è‡ª &lt;code&gt;CrudRepository&lt;/code&gt;ï¼Œæä¾›äº†åŸºç¡€çš„ CRUD æ“ä½œå’Œçµæ´»çš„æŸ¥è¯¢èƒ½åŠ›ã€‚å…¶æŸ¥è¯¢åŠŸèƒ½ä¸»è¦é€šè¿‡ &lt;strong&gt;æ–¹æ³•å‘½åè§„åˆ™&lt;/strong&gt;ã€&lt;strong&gt;æ³¨è§£æ‰©å±•&lt;/strong&gt; å’Œ &lt;strong&gt;åˆ†é¡µ/æ’åºæ”¯æŒ&lt;/strong&gt; å®ç°ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ–¹æ³•å‘½åè§„åˆ™è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢"&gt;&lt;strong&gt;æ–¹æ³•å‘½åè§„åˆ™è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;strong&gt;æ–¹æ³•åçº¦å®š&lt;/strong&gt;ï¼Œå¼€å‘è€…æ— éœ€ç¼–å†™å…·ä½“æŸ¥è¯¢é€»è¾‘ï¼ŒSpring Data Elasticsearch ä¼šæ ¹æ®æ–¹æ³•åè‡ªåŠ¨ç”Ÿæˆ Elasticsearch æŸ¥è¯¢è¯­å¥ã€‚è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºæœ¬å­—æ®µåŒ¹é…&lt;/strong&gt;&lt;br&gt;
æ–¹æ³•åä»¥ &lt;code&gt;findBy&lt;/code&gt; å¼€å¤´ï¼Œåæ¥å®ä½“ç±»å­—æ®µåï¼Œæ”¯æŒå¤šæ¡ä»¶ç»„åˆï¼ˆ&lt;code&gt;And&lt;/code&gt;/&lt;code&gt;Or&lt;/code&gt;ï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByTitle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç²¾ç¡®åŒ¹é… title å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByAuthorAndPrice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Double&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»„åˆæ¡ä»¶æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶ç±»å‹æ‰©å±•&lt;/strong&gt;&lt;br&gt;
æ”¯æŒå¤šç§æ¡ä»¶æ“ä½œç¬¦ï¼Œå¦‚ &lt;code&gt;Between&lt;/code&gt;ã€&lt;code&gt;LessThan&lt;/code&gt;ã€&lt;code&gt;GreaterThan&lt;/code&gt;ã€&lt;code&gt;Like&lt;/code&gt; ç­‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByPriceBetween&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Double&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;minPrice&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Double&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxPrice&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä»·æ ¼åŒºé—´æŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByTitleContaining&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡ç³ŠåŒ¹é…ï¼ˆåˆ†è¯æŸ¥è¯¢ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’åºä¸åˆ†é¡µ&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;Sort&lt;/code&gt; å’Œ &lt;code&gt;Pageable&lt;/code&gt; å‚æ•°å®ç°ç»“æœæ’åºä¸åˆ†é¡µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByAuthor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ†é¡µæŸ¥è¯¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByCategoryOrderByPriceDesc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;category&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‰ä»·æ ¼é™åºæ’åº&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è‡ªå®šä¹‰æŸ¥è¯¢æ³¨è§£"&gt;&lt;strong&gt;è‡ªå®šä¹‰æŸ¥è¯¢æ³¨è§£ï¼ˆ&lt;code&gt;@Query&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å¯¹äºå¤æ‚æŸ¥è¯¢ï¼Œå¯é€šè¿‡ &lt;code&gt;@Query&lt;/code&gt; æ³¨è§£ç›´æ¥ç¼–å†™ &lt;strong&gt;Elasticsearch åŸç”ŸæŸ¥è¯¢è¯­å¥&lt;/strong&gt;ï¼Œæ”¯æŒ JSON æ ¼å¼çš„ DSL æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é™æ€æŸ¥è¯¢å®šä¹‰&lt;/strong&gt;&lt;br&gt;
ç›´æ¥åœ¨æ³¨è§£ä¸­ç¼–å†™æŸ¥è¯¢é€»è¾‘ï¼Œæ”¯æŒå‚æ•°å ä½ç¬¦ï¼ˆ&lt;code&gt;?0&lt;/code&gt; è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;match\&amp;#34;: {\&amp;#34;title\&amp;#34;: \&amp;#34;?0\&amp;#34;}}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;searchByTitle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒ¹é… title å­—æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€å‚æ•°ç»‘å®š&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;NativeSearchQueryBuilder&lt;/code&gt; åŠ¨æ€æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;searchByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NativeSearchQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NativeSearchQueryBuilder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QueryBuilders&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;matchQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä½¿ç”¨ ElasticsearchTemplate&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èšåˆæŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
æ”¯æŒ &lt;code&gt;terms&lt;/code&gt;ã€&lt;code&gt;avg&lt;/code&gt; ç­‰èšåˆæ“ä½œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;aggs\&amp;#34;: {\&amp;#34;avg_price\&amp;#34;: {\&amp;#34;avg\&amp;#34;: {\&amp;#34;field\&amp;#34;: \&amp;#34;price\&amp;#34;}}}}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;AggregatedPage&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;calculateAveragePrice&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åˆ†é¡µä¸æ’åºæ”¯æŒ"&gt;&lt;strong&gt;åˆ†é¡µä¸æ’åºæ”¯æŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;Pageable&lt;/code&gt; æ¥å£å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œè¿”å› &lt;code&gt;Page&lt;/code&gt; å¯¹è±¡ï¼ˆåŒ…å«åˆ†é¡µå…ƒæ•°æ®ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// åˆ†é¡µå‚æ•°æ„å»ºï¼ˆé¡µç ä» 0 å¼€å§‹ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Sort&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;price&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;descending&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageResult&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bookRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findByCategory&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;fiction&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// è·å–åˆ†é¡µæ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageResult&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContent&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;totalElements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageResult&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTotalElements&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ€»æ•°æ®é‡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="é«˜äº®ä¸ç»“æœæ˜ å°„"&gt;&lt;strong&gt;é«˜äº®ä¸ç»“æœæ˜ å°„ï¼ˆ&lt;code&gt;@Highlight&lt;/code&gt;ï¼‰&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;@Highlight&lt;/code&gt; æ³¨è§£å®ç°æœç´¢ç»“æœä¸­å…³é”®è¯çš„é«˜äº®æ˜¾ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;match\&amp;#34;: {\&amp;#34;content\&amp;#34;: \&amp;#34;?0\&amp;#34;}}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Highlight&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@HighlightField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;SearchHits&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Article&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findArticlesWithHighlight&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å›é«˜äº®ç‰‡æ®µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿”å›çš„ &lt;code&gt;SearchHit&lt;/code&gt; å¯¹è±¡å¯é€šè¿‡ &lt;code&gt;getHighlightFields()&lt;/code&gt; è·å–é«˜äº®å†…å®¹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å¤æ‚æŸ¥è¯¢åœºæ™¯"&gt;&lt;strong&gt;å¤æ‚æŸ¥è¯¢åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¸ƒå°”æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
ç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼ˆ&lt;code&gt;must&lt;/code&gt;/&lt;code&gt;should&lt;/code&gt;/&lt;code&gt;must_not&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;bool\&amp;#34;: {\&amp;#34;must\&amp;#34;: [{\&amp;#34;match\&amp;#34;: {\&amp;#34;title\&amp;#34;: \&amp;#34;?0\&amp;#34;}}, {\&amp;#34;range\&amp;#34;: {\&amp;#34;price\&amp;#34;: {\&amp;#34;gte\&amp;#34;: ?1}}}]}}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByTitleAndMinPrice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Double&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;minPrice&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åµŒå¥—å¯¹è±¡æŸ¥è¯¢&lt;/strong&gt;&lt;br&gt;
æ”¯æŒåµŒå¥—å­—æ®µï¼ˆNested Fieldsï¼‰çš„æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{\&amp;#34;nested\&amp;#34;: {\&amp;#34;path\&amp;#34;: \&amp;#34;author\&amp;#34;, \&amp;#34;query\&amp;#34;: {\&amp;#34;match\&amp;#34;: {\&amp;#34;author.name\&amp;#34;: \&amp;#34;?0\&amp;#34;}}}}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByAuthorName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ä¸ç‰ˆæœ¬å…¼å®¹æ€§"&gt;&lt;strong&gt;é…ç½®ä¸ç‰ˆæœ¬å…¼å®¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–ç®¡ç†&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿ &lt;code&gt;spring-boot-starter-data-elasticsearch&lt;/code&gt; ç‰ˆæœ¬ä¸ Elasticsearch æœåŠ¡ç«¯å…¼å®¹ï¼ˆå¦‚ Spring Boot 2.7+ å¯¹åº” Elasticsearch 7.17+ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®ä½“ç±»æ˜ å°„&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨ &lt;code&gt;@Document&lt;/code&gt; æ³¨è§£å®šä¹‰ç´¢å¼•ï¼Œ&lt;code&gt;@Field&lt;/code&gt; æŒ‡å®šå­—æ®µç±»å‹å’Œåˆ†è¯å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indexName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;books&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Book&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Field&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FieldType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;analyzer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ik_max_word&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-13"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ElasticsearchRepository&lt;/code&gt; æä¾›äº†ä»ç®€å•åˆ°å¤æ‚çš„å…¨åœºæ™¯æŸ¥è¯¢æ”¯æŒï¼Œé€šè¿‡æ–¹æ³•å‘½åè§„åˆ™ç®€åŒ–åŸºç¡€æŸ¥è¯¢ï¼Œç»“åˆ &lt;code&gt;@Query&lt;/code&gt; å’Œ &lt;code&gt;@Highlight&lt;/code&gt; å®ç°é«˜çº§åŠŸèƒ½ï¼ŒåŒæ—¶é€šè¿‡åˆ†é¡µå’Œæ’åºä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚å¼€å‘è€…åº”æ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»é€‰æ‹©æŸ¥è¯¢æ–¹å¼ï¼Œå¹¶æ³¨æ„ç‰ˆæœ¬å…¼å®¹æ€§å’Œç´¢å¼•æ˜ å°„é…ç½®ã€‚&lt;/p&gt;
&lt;h2 id="multi-match-type"&gt;multi-match type
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch çš„ &lt;code&gt;multi_match&lt;/code&gt; æŸ¥è¯¢ä¸­ï¼Œ&lt;code&gt;&amp;quot;type&amp;quot;: &amp;quot;best_fields&amp;quot;&lt;/code&gt; æ˜¯ä¸€ç§ç”¨äºå¤šå­—æ®µæœç´¢çš„ç­–ç•¥ï¼Œå…¶æ ¸å¿ƒé€»è¾‘æ˜¯&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©ä¸æŸ¥è¯¢è¯åŒ¹é…åº¦æœ€é«˜çš„å•ä¸ªå­—æ®µçš„è¯„åˆ†ä½œä¸ºæ–‡æ¡£çš„æœ€ç»ˆç›¸å…³æ€§è¯„åˆ†&lt;/strong&gt;ï¼Œè€Œéç®€å•ç´¯åŠ å¤šä¸ªå­—æ®µçš„è¯„åˆ†ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®ç‰¹æ€§ä¸å·¥ä½œåŸç†è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒæ¦‚å¿µ"&gt;æ ¸å¿ƒæ¦‚å¿µ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯„åˆ†æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;best_fields&lt;/code&gt; ä¼šéå†æ‰€æœ‰æŒ‡å®šå­—æ®µï¼ˆå¦‚ &lt;code&gt;fields: [&amp;quot;title&amp;quot;, &amp;quot;description&amp;quot;]&lt;/code&gt;ï¼‰ï¼Œåˆ†åˆ«è®¡ç®—æ¯ä¸ªå­—æ®µä¸æŸ¥è¯¢è¯çš„åŒ¹é…è¯„åˆ†ï¼Œ&lt;strong&gt;ä»…å–æœ€é«˜åˆ†ä½œä¸ºæ–‡æ¡£çš„æœ€ç»ˆè¯„åˆ†&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œè‹¥ &lt;code&gt;title&lt;/code&gt; å­—æ®µè¯„åˆ†ä¸º 1.5ï¼Œ&lt;code&gt;description&lt;/code&gt; ä¸º 1.2ï¼Œåˆ™æ–‡æ¡£æ€»è¯„åˆ†ä¸º 1.5ã€‚&lt;/li&gt;
&lt;li&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¶ä»–å­—æ®µçš„è¯„åˆ†ä¼šè¢«å¿½ç•¥ï¼Œä½†å¯é€šè¿‡ &lt;code&gt;tie_breaker&lt;/code&gt; å‚æ•°éƒ¨åˆ†çº³å…¥æ¬¡è¦å­—æ®µçš„è¯„åˆ†ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åº•å±‚å®ç°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯¥ç±»å‹æœ¬è´¨æ˜¯å¯¹ &lt;code&gt;dis_max&lt;/code&gt;ï¼ˆåˆ†ç¦»æœ€å¤§åŒ–æŸ¥è¯¢ï¼‰çš„å°è£…ã€‚&lt;code&gt;dis_max&lt;/code&gt; ä¼šå°†å¤šä¸ªå­æŸ¥è¯¢ï¼ˆæ¯ä¸ªå­—æ®µå¯¹åº”ä¸€ä¸ªæŸ¥è¯¢ï¼‰çš„æ‰§è¡Œç»“æœåˆå¹¶ï¼Œä»…ä¿ç•™æœ€ä½³åŒ¹é…å­—æ®µçš„è¯„åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å‚æ•°è°ƒä¼˜"&gt;å‚æ•°è°ƒä¼˜
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;tie_breaker&lt;/code&gt; å‚æ•°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å–å€¼èŒƒå›´ä¸º &lt;code&gt;[0, 1]&lt;/code&gt;ï¼Œç”¨äºæ§åˆ¶æ¬¡è¦å­—æ®µå¯¹æœ€ç»ˆè¯„åˆ†çš„è´¡çŒ®ã€‚ä¾‹å¦‚ï¼Œè®¾ &lt;code&gt;tie_breaker=0.3&lt;/code&gt;ï¼Œåˆ™æœ€ç»ˆè¯„åˆ†ä¸ºï¼š&lt;br&gt;
&lt;strong&gt;æœ€ç»ˆè¯„åˆ† = æœ€ä½³å­—æ®µè¯„åˆ† + å…¶ä»–å­—æ®µè¯„åˆ†ä¹‹å’Œ Ã— 0.3&lt;/strong&gt;&lt;br&gt;
æ­¤å‚æ•°å¯å¹³è¡¡â€œç²¾å‡†åŒ¹é…â€ä¸â€œå¤šå­—æ®µè¦†ç›–â€çš„éœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µæƒé‡ï¼ˆBoostï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä¸ºä¸åŒå­—æ®µè®¾ç½®æƒé‡ï¼ˆå¦‚ &lt;code&gt;fields: [&amp;quot;title^3&amp;quot;, &amp;quot;description&amp;quot;]&lt;/code&gt;ï¼‰ï¼Œä½¿æŸäº›å­—æ®µçš„åŒ¹é…è¯„åˆ†æ›´å…·å½±å“åŠ›ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;title&lt;/code&gt; å­—æ®µçš„è¯„åˆ†ä¼šä¹˜ä»¥ 3ï¼Œæé«˜å…¶åœ¨æœ€ä½³å­—æ®µç«äº‰ä¸­çš„ä¼˜å…ˆçº§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯-6"&gt;é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—æ®µé—´ç«äº‰å…³ç³»&lt;/strong&gt;&lt;br&gt;
å½“å­—æ®µå†…å®¹å­˜åœ¨é‡å æˆ–äº’æ–¥æ—¶ï¼ˆå¦‚åšå®¢çš„ &lt;code&gt;title&lt;/code&gt; å’Œ &lt;code&gt;content&lt;/code&gt;ï¼‰ï¼Œ&lt;code&gt;best_fields&lt;/code&gt; èƒ½é¿å…ä½ç›¸å…³å­—æ®µç¨€é‡Šé«˜ç›¸å…³å­—æ®µçš„è¯„åˆ†ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æœç´¢â€œæ£•è‰²çš„ç‹ç‹¸â€æ—¶ï¼Œè‹¥æŸæ–‡æ¡£çš„ &lt;code&gt;content&lt;/code&gt; å­—æ®µåŒæ—¶åŒ…å«è¿™ä¸¤ä¸ªè¯ï¼Œè€Œ &lt;code&gt;title&lt;/code&gt; ä»…å«â€œæ£•è‰²â€ï¼Œåˆ™ &lt;code&gt;content&lt;/code&gt; çš„è¯„åˆ†ä¼šè¢«ä¼˜å…ˆé‡‡çº³ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç²¾ç¡®åŒ¹é…ä¼˜å…ˆ&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äºéœ€è¦çªå‡ºâ€œæœ€ä½³åŒ¹é…â€çš„åœºæ™¯ï¼Œå¦‚ç”µå•†ä¸­å•†å“åç§°çš„åŒ¹é…ä¼˜å…ˆçº§é«˜äºæè¿°å­—æ®µã€‚ä¾‹å¦‚ï¼Œæœç´¢â€œæ— çº¿é¼ æ ‡â€æ—¶ï¼Œåç§°ä¸­å®Œæ•´åŒ¹é…çš„æ–‡æ¡£åº”æ’åœ¨æè¿°éƒ¨åˆ†åŒ¹é…çš„æ–‡æ¡£ä¹‹å‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸å…¶ä»–ç±»å‹çš„å¯¹æ¯”"&gt;ä¸å…¶ä»–ç±»å‹çš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è¯„åˆ†é€»è¾‘&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;best_fields&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å–æœ€é«˜åˆ†å­—æ®µï¼Œå¯é™„åŠ æ¬¡è¦å­—æ®µè¯„åˆ†&lt;/td&gt;
&lt;td&gt;å­—æ®µé—´ç«äº‰ï¼Œéœ€çªå‡ºæœ€ä½³åŒ¹é…ï¼ˆå¦‚æ ‡é¢˜ä¼˜å…ˆï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;most_fields&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç´¯åŠ æ‰€æœ‰å­—æ®µçš„è¯„åˆ†&lt;/td&gt;
&lt;td&gt;å¤šå­—æ®µäº’è¡¥ï¼Œéœ€å¹¿æ³›è¦†ç›–ï¼ˆå¦‚å¤šè¯­è¨€å†…å®¹æœç´¢ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;cross_fields&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†å¤šä¸ªå­—æ®µè§†ä¸ºæ•´ä½“åŒ¹é…&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢è¯åˆ†æ•£åœ¨ä¸åŒå­—æ®µï¼ˆå¦‚åœ°å€ï¼šè¡—é“+åŸå¸‚+é‚®ç¼–ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç¤ºä¾‹é…ç½®"&gt;ç¤ºä¾‹é…ç½®
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="err"&gt;/products/_search&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;multi_match&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;wireless mouse&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;best_fields&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;fields&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;title^3&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="c1"&gt;// æ ‡é¢˜æƒé‡æ›´é«˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;tie_breaker&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;0.3&lt;/span&gt; &lt;span class="c1"&gt;// æ¬¡è¦å­—æ®µè´¡çŒ®30%è¯„åˆ†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤é…ç½®ä¼šä¼˜å…ˆåŒ¹é… &lt;code&gt;title&lt;/code&gt; å­—æ®µï¼ŒåŒæ—¶é€šè¿‡ &lt;code&gt;tie_breaker&lt;/code&gt; é€‚åº¦çº³å…¥ &lt;code&gt;description&lt;/code&gt; çš„åŒ¹é…ç»“æœï¼Œå…¼é¡¾ç²¾å‡†æ€§ä¸è¦†ç›–æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-14"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;&amp;quot;type&amp;quot;: &amp;quot;best_fields&amp;quot;&lt;/code&gt; æ˜¯ä¸€ç§ä»¥&lt;strong&gt;å­—æ®µä¸ºä¸­å¿ƒ&lt;/strong&gt;çš„æœç´¢ç­–ç•¥ï¼Œé€‚åˆéœ€è¦ä¼˜å…ˆä¿è¯å•ä¸ªå­—æ®µåŒ¹é…è´¨é‡çš„åœºæ™¯ã€‚é€šè¿‡åˆç†è°ƒæ•´ &lt;code&gt;tie_breaker&lt;/code&gt; å’Œå­—æ®µæƒé‡ï¼Œå¯åœ¨ç²¾å‡†åŒ¹é…ä¸ç»“æœå¤šæ ·æ€§ä¹‹é—´å–å¾—å¹³è¡¡ã€‚è‹¥éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯ç»“åˆåˆ†è¯å™¨é…ç½®ï¼ˆå¦‚ä¸­æ–‡ä½¿ç”¨ &lt;code&gt;ik_max_word&lt;/code&gt;ï¼‰å’Œç´¢å¼•æ˜ å°„è®¾è®¡ã€‚&lt;/p&gt;
&lt;h2 id="transactional"&gt;@Transactional
&lt;/h2&gt;&lt;p&gt;åœ¨åˆ†æ&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„è¡Œä¸ºæ—¶ï¼Œéœ€è¦ç»“åˆäº‹åŠ¡ä¼ æ’­æœºåˆ¶å’Œä»£ç é€»è¾‘æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;h3 id="äº‹åŠ¡çš„é»˜è®¤è¡Œä¸º"&gt;äº‹åŠ¡çš„é»˜è®¤è¡Œä¸º
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡çš„åŸå­æ€§ä¿è¯&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£é»˜è®¤ä¼šå°†æ•´ä¸ªæ–¹æ³•åŒ…è£¹åœ¨äº‹åŠ¡ä¸­ï¼Œè‹¥æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­**æœªæ•è·çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰æˆ–é”™è¯¯ï¼ˆErrorï¼‰**è¢«æŠ›å‡ºï¼Œåˆ™äº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»šã€‚&lt;br&gt;
&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼šä»£ç ä¸­çš„&lt;code&gt;joinSpace&lt;/code&gt;æ–¹æ³•å¹¶æœªæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼&lt;code&gt;message.success()&lt;/code&gt;åˆ¤æ–­å¤±è´¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¸ä¼šæ„ŸçŸ¥åˆ°å¼‚å¸¸ï¼Œå› æ­¤é»˜è®¤ä¸ä¼šè§¦å‘å›æ»šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡æäº¤çš„è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;br&gt;
åœ¨&lt;code&gt;createSpace&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œ&lt;code&gt;spaceRepository.save(space)&lt;/code&gt;ä¼šå°†&lt;code&gt;space&lt;/code&gt;å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä½†æ­¤æ—¶äº‹åŠ¡å°šæœªæäº¤ã€‚çœŸæ­£çš„æäº¤å‘ç”Ÿåœ¨æ–¹æ³•&lt;strong&gt;æ­£å¸¸æ‰§è¡Œå®Œæ¯•ä¸”æœªå‘ç”Ÿå¼‚å¸¸æ—¶&lt;/strong&gt;ã€‚è‹¥&lt;code&gt;joinSpace&lt;/code&gt;å¤±è´¥ä½†æœªæŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡ä»ä¼šæ­£å¸¸æäº¤ï¼Œå¯¼è‡´ç©ºé—´è¢«åˆ›å»ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å½“å‰ä»£ç çš„é—®é¢˜åˆ†æ"&gt;å½“å‰ä»£ç çš„é—®é¢˜åˆ†æ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡æœªå›æ»šçš„åŸå› &lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;joinSpace&lt;/code&gt;æ–¹æ³•è¿”å›&lt;code&gt;message.success() == false&lt;/code&gt;æ—¶ï¼Œä»£ç ä»…è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œ&lt;strong&gt;æœªæŠ›å‡ºå¼‚å¸¸&lt;/strong&gt;ï¼Œå› æ­¤äº‹åŠ¡ç®¡ç†å™¨è®¤ä¸ºæ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œä¼šæ­£å¸¸æäº¤äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å³ä½¿&lt;code&gt;joinSpace&lt;/code&gt;å†…éƒ¨æ“ä½œï¼ˆå¦‚æ•°æ®åº“æ’å…¥ï¼‰å¤±è´¥ï¼Œè‹¥æœªé€šè¿‡å¼‚å¸¸å‘ä¸Šä¼ æ’­ï¼Œå¤–å±‚äº‹åŠ¡ä»æ— æ³•æ„ŸçŸ¥é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ½œåœ¨é£é™©åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡è®¾&lt;code&gt;spaceRepository.save(space)&lt;/code&gt;å·²æˆåŠŸæ’å…¥ç©ºé—´æ•°æ®ï¼Œä½†&lt;code&gt;joinSpace&lt;/code&gt;å› éå¼‚å¸¸åŸå› å¤±è´¥ï¼ˆå¦‚ä¸šåŠ¡è§„åˆ™æ ¡éªŒä¸é€šè¿‡ï¼‰ï¼Œåˆ™ç©ºé—´æ•°æ®ä¼šè¢«ä¿ç•™ï¼Œä½†ç”¨æˆ·æœªåŠ å…¥è¯¥ç©ºé—´ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆå»ºè®®"&gt;è§£å†³æ–¹æ¡ˆå»ºè®®
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼ºåˆ¶è§¦å‘äº‹åŠ¡å›æ»š&lt;/strong&gt;&lt;br&gt;
ä¿®æ”¹&lt;code&gt;joinSpace&lt;/code&gt;æ–¹æ³•çš„é€»è¾‘ï¼Œåœ¨å¤±è´¥æ—¶æŠ›å‡º&lt;strong&gt;éæ£€æŸ¥å‹å¼‚å¸¸&lt;/strong&gt;ï¼ˆå¦‚&lt;code&gt;RuntimeException&lt;/code&gt;ï¼‰ï¼Œä½¿å¤–å±‚äº‹åŠ¡èƒ½æ•è·å¹¶å›æ»šã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;success&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;åŠ å…¥ç©ºé—´å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è§¦å‘äº‹åŠ¡å›æ»š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒæ•´äº‹åŠ¡ä¼ æ’­è¡Œä¸º&lt;/strong&gt;&lt;br&gt;
è‹¥&lt;code&gt;joinSpace&lt;/code&gt;éœ€è¦ç‹¬ç«‹äº‹åŠ¡ï¼Œå¯ä¸ºå…¶æ·»åŠ &lt;code&gt;@Transactional(propagation = Propagation.REQUIRES_NEW)&lt;/code&gt;æ³¨è§£ï¼Œä½¿å…¶ä¸&lt;code&gt;createSpace&lt;/code&gt;æ–¹æ³•çš„äº‹åŠ¡åˆ†ç¦»ã€‚æ­¤æ—¶å³ä½¿&lt;code&gt;joinSpace&lt;/code&gt;å¤±è´¥ï¼Œå¤–å±‚äº‹åŠ¡ä»å¯èƒ½æäº¤ï¼ˆéœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚æƒè¡¡ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-15"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;åœ¨ç°æœ‰ä»£ç ä¸­ï¼Œ&lt;strong&gt;è‹¥&lt;code&gt;joinSpace&lt;/code&gt;å¤±è´¥ä½†æœªæŠ›å‡ºå¼‚å¸¸ï¼Œç©ºé—´ä»ä¼šè¢«åˆ›å»º&lt;/strong&gt;ã€‚è¦é¿å…æ­¤é—®é¢˜ï¼Œéœ€é€šè¿‡å¼‚å¸¸æœºåˆ¶æˆ–æ˜¾å¼çš„äº‹åŠ¡æ§åˆ¶ï¼ˆå¦‚&lt;code&gt;TransactionAspectSupport.currentTransactionStatus().setRollbackOnly()&lt;/code&gt;ï¼‰å¼ºåˆ¶å›æ»šã€‚&lt;/p&gt;
&lt;h2 id="å¼‚å¸¸"&gt;å¼‚å¸¸
&lt;/h2&gt;&lt;p&gt;Javaä¸­çš„å¼‚å¸¸ç»§æ‰¿ä½“ç³»æ˜¯é”™è¯¯å¤„ç†æœºåˆ¶çš„æ ¸å¿ƒè®¾è®¡ï¼Œå…¶å±‚æ¬¡ç»“æ„ä½“ç°äº†å¼‚å¸¸ç±»å‹çš„åˆ†ç±»é€»è¾‘å’Œä¸åŒåœºæ™¯çš„å¤„ç†åŸåˆ™ã€‚ä»¥ä¸‹ç»“åˆè§„èŒƒä¸å®ä¾‹è¯¦ç»†è§£æï¼š&lt;/p&gt;
&lt;h3 id="å¼‚å¸¸ç»§æ‰¿å…³ç³»æ€»è§ˆ"&gt;å¼‚å¸¸ç»§æ‰¿å…³ç³»æ€»è§ˆ
&lt;/h3&gt;&lt;p&gt;Javaå¼‚å¸¸ä½“ç³»çš„é¡¶å±‚æ˜¯ &lt;strong&gt;&lt;code&gt;Throwable&lt;/code&gt;&lt;/strong&gt;ï¼Œå…¶ä¸‹åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Error&lt;/code&gt;&lt;/strong&gt;ï¼šè¡¨ç¤º&lt;strong&gt;ä¸¥é‡ç³»ç»Ÿé”™è¯¯&lt;/strong&gt;ï¼ˆå¦‚å†…å­˜æº¢å‡ºã€è™šæ‹Ÿæœºå´©æºƒï¼‰ï¼Œç”±JVMæŠ›å‡ºä¸”ä¸å¯æ¢å¤ï¼Œå¼€å‘è€…ä¸åº”å°è¯•æ•è·ã€‚
&lt;ul&gt;
&lt;li&gt;å¸¸è§å­ç±»ï¼š&lt;code&gt;OutOfMemoryError&lt;/code&gt;ï¼ˆå†…å­˜è€—å°½ï¼‰ã€&lt;code&gt;StackOverflowError&lt;/code&gt;ï¼ˆæ ˆæº¢å‡ºï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Exception&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;strong&gt;ç¨‹åºå¯å¤„ç†çš„å¼‚å¸¸&lt;/strong&gt;ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;RuntimeException&lt;/code&gt;&lt;/strong&gt;ï¼ˆæœªæ£€æŸ¥å¼‚å¸¸ï¼‰ï¼šç”±ä»£ç é€»è¾‘é”™è¯¯å¼•å‘ï¼Œç¼–è¯‘å™¨ä¸å¼ºåˆ¶å¤„ç†
&lt;ul&gt;
&lt;li&gt;å…¸å‹å­ç±»ï¼š&lt;code&gt;NullPointerException&lt;/code&gt;ï¼ˆç©ºæŒ‡é’ˆï¼‰ã€&lt;code&gt;IndexOutOfBoundsException&lt;/code&gt;ï¼ˆä¸‹æ ‡è¶Šç•Œï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€æŸ¥å‹å¼‚å¸¸&lt;/strong&gt;ï¼ˆChecked Exceptionï¼‰ï¼šå¿…é¡»æ˜¾å¼å¤„ç†ï¼ˆæ•è·æˆ–å£°æ˜æŠ›å‡ºï¼‰
&lt;ul&gt;
&lt;li&gt;å…¸å‹å­ç±»ï¼š&lt;code&gt;IOException&lt;/code&gt;ï¼ˆIOé”™è¯¯ï¼‰ã€&lt;code&gt;SQLException&lt;/code&gt;ï¼ˆæ•°æ®åº“å¼‚å¸¸ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å…³é”®å¼‚å¸¸ç±»å‹è§£æ"&gt;å…³é”®å¼‚å¸¸ç±»å‹è§£æ
&lt;/h3&gt;&lt;h4 id="runtimeexceptionæœªæ£€æŸ¥å¼‚å¸¸"&gt;RuntimeExceptionï¼ˆæœªæ£€æŸ¥å¼‚å¸¸ï¼‰
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹å¾&lt;/strong&gt;ï¼šç»§æ‰¿è‡ª&lt;code&gt;Exception&lt;/code&gt;ï¼Œä½†ç¼–è¯‘å™¨&lt;strong&gt;ä¸å¼ºåˆ¶å¤„ç†&lt;/strong&gt;ï¼Œé€šå¸¸ç”±ä»£ç é€»è¾‘ç¼ºé™·å¯¼è‡´&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§å­ç±»&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;IllegalArgumentException&lt;/code&gt;ï¼šéæ³•å‚æ•°ä¼ é€’&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ArithmeticException&lt;/code&gt;ï¼šæ•°å­¦è¿ç®—é”™è¯¯ï¼ˆå¦‚é™¤é›¶ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ConcurrentModificationException&lt;/code&gt;ï¼šé›†åˆè¿­ä»£æ—¶è¢«ä¿®æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†åŸåˆ™&lt;/strong&gt;ï¼šä¼˜å…ˆé€šè¿‡ä»£ç å¥å£®æ€§é¿å…ï¼Œè€Œéä¾èµ–å¼‚å¸¸æ•è·&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ£€æŸ¥å‹å¼‚å¸¸checked-exception"&gt;æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹å¾&lt;/strong&gt;ï¼šç»§æ‰¿è‡ª&lt;code&gt;Exception&lt;/code&gt;ä½†&lt;strong&gt;éRuntimeException&lt;/strong&gt;ï¼Œç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚å¤„ç†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§å­ç±»&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;IOException&lt;/code&gt;ï¼šæ–‡ä»¶è¯»å†™å¤±è´¥ï¼ˆå¦‚&lt;code&gt;FileNotFoundException&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ClassNotFoundException&lt;/code&gt;ï¼šç±»æœªæ‰¾åˆ°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;InterruptedException&lt;/code&gt;ï¼šçº¿ç¨‹è¢«ä¸­æ–­&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†æ–¹å¼&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;try-catch&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨ä»£ç å—å†…æ•è·å¤„ç†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;throws&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨æ–¹æ³•ç­¾åå£°æ˜æŠ›å‡ºï¼Œç”±è°ƒç”¨æ–¹å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å¼‚å¸¸å¤„ç†è§„èŒƒ"&gt;å¼‚å¸¸å¤„ç†è§„èŒƒ
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å±‚æ•è·åŸåˆ™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆæ•è·å…·ä½“å¼‚å¸¸ï¼ˆå¦‚&lt;code&gt;FileNotFoundException&lt;/code&gt;ï¼‰ï¼Œæœ€åæ•è·é€šç”¨&lt;code&gt;Exception&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// IOæ“ä½œä»£ç &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;FileNotFoundException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†æ–‡ä»¶æœªæ‰¾åˆ°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†å…¶ä»–IOé”™è¯¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºé‡Šæ”¾è§„èŒƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨**&lt;code&gt;finally&lt;/code&gt;å—**ç¡®ä¿èµ„æºå…³é—­ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ï¼‰&lt;/li&gt;
&lt;li&gt;JDK7+æ¨è**&lt;code&gt;try-with-resources&lt;/code&gt;**è¯­æ³•è‡ªåŠ¨é‡Šæ”¾èµ„æºï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BufferedReader&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BufferedReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FileReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;file.txt&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¯»å–æ–‡ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚å¸¸å¤„ç†&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡ä¸å¼‚å¸¸è”åŠ¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨äº‹åŠ¡æ“ä½œä¸­ï¼Œè‹¥å‘ç”Ÿå¼‚å¸¸éœ€&lt;strong&gt;æ˜¾å¼å›æ»šäº‹åŠ¡&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Springä¸­é»˜è®¤ä»…å¯¹&lt;code&gt;RuntimeException&lt;/code&gt;å’Œ&lt;code&gt;Error&lt;/code&gt;è§¦å‘å›æ»šï¼Œæ£€æŸ¥å‹å¼‚å¸¸éœ€é€šè¿‡&lt;code&gt;@Transactional(rollbackFor=Exception.class)&lt;/code&gt;é…ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="è®¾è®¡å®è·µå»ºè®®"&gt;è®¾è®¡å®è·µå»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…æ»¥ç”¨å¼‚å¸¸æ§åˆ¶æµç¨‹&lt;/strong&gt;&lt;br&gt;
å¦‚ç”¨å¼‚å¸¸æ›¿ä»£æ¡ä»¶åˆ¤æ–­ï¼ˆåä¾‹ï¼šé€šè¿‡æ•è·&lt;code&gt;ArithmeticException&lt;/code&gt;å¤„ç†é™¤é›¶ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰å¼‚å¸¸è®¾è®¡&lt;/strong&gt;&lt;br&gt;
ç»§æ‰¿&lt;code&gt;RuntimeException&lt;/code&gt;åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ï¼ˆå¦‚&lt;code&gt;OrderNotFoundException&lt;/code&gt;ï¼‰ï¼Œä¿æŒå¼‚å¸¸è¯­ä¹‰æ¸…æ™°ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OrderNotFoundException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;OrderNotFoundException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;è®¢å•ä¸å­˜åœ¨: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orderId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—è®°å½•è§„èŒƒ&lt;/strong&gt;&lt;br&gt;
åœ¨æ•è·å¼‚å¸¸æ—¶è®°å½•å®Œæ•´å †æ ˆä¿¡æ¯ï¼ˆ&lt;code&gt;e.printStackTrace()&lt;/code&gt;ä»…é™è°ƒè¯•ï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æ—¥å¿—æ¡†æ¶ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šJavaå¼‚å¸¸ä½“ç³»é€šè¿‡ç»§æ‰¿å…³ç³»åŒºåˆ†äº†ç³»ç»Ÿé”™è¯¯ä¸ç¨‹åºå¼‚å¸¸ï¼Œå¼€å‘è€…éœ€æ ¹æ®å¼‚å¸¸ç±»å‹é€‰æ‹©å¤„ç†ç­–ç•¥ã€‚è¿è¡Œæ—¶å¼‚å¸¸é€šè¿‡ä»£ç ä¼˜åŒ–è§„é¿ï¼Œæ£€æŸ¥å‹å¼‚å¸¸éœ€å¼ºåˆ¶å¤„ç†ï¼Œé”™è¯¯åˆ™åº”ç”±JVMè‡ªè¡Œç»ˆæ­¢ç¨‹åºã€‚è§„èŒƒåŒ–çš„å¼‚å¸¸å¤„ç†èƒ½æ˜¾è‘—æå‡ä»£ç å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;h2 id="entity-å”¯ä¸€ç´¢å¼•"&gt;@Entity å”¯ä¸€ç´¢å¼•
&lt;/h2&gt;&lt;p&gt;åœ¨JPAä¸­é€šè¿‡&lt;code&gt;@Entity&lt;/code&gt;å®ä½“ç±»åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡-table-æ³¨è§£çš„-uniqueconstraints-å±æ€§"&gt;é€šè¿‡ &lt;code&gt;@Table&lt;/code&gt; æ³¨è§£çš„ &lt;code&gt;uniqueConstraints&lt;/code&gt; å±æ€§
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯JPAæ ‡å‡†è§„èŒƒä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œé€‚ç”¨äºå•åˆ—æˆ–ç»„åˆåˆ—çš„å”¯ä¸€çº¦æŸï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ä¸ºæ­¤ç”Ÿæˆå”¯ä¸€ç´¢å¼•ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•åˆ—å”¯ä¸€ç´¢å¼•&lt;/strong&gt;&lt;br&gt;
åœ¨å®ä½“ç±»ä¸Šæ·»åŠ &lt;code&gt;@Table(uniqueConstraints = @UniqueConstraint(columnNames = {&amp;quot;å­—æ®µå&amp;quot;}))&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uniqueConstraints&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@UniqueConstraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnNames&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;email&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„åˆåˆ—å”¯ä¸€ç´¢å¼•&lt;/strong&gt;&lt;br&gt;
æŒ‡å®šå¤šä¸ªå­—æ®µåï¼Œç”Ÿæˆè”åˆå”¯ä¸€ç´¢å¼•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uniqueConstraints&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@UniqueConstraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnNames&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;username&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;phone&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­—æ®µå®šä¹‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€šè¿‡-index-æ³¨è§£éœ€ç»“åˆhibernateæ‰©å±•"&gt;é€šè¿‡ &lt;code&gt;@Index&lt;/code&gt; æ³¨è§£ï¼ˆéœ€ç»“åˆHibernateæ‰©å±•ï¼‰
&lt;/h3&gt;&lt;p&gt;æ­¤æ–¹æ³•ä¾èµ–Hibernateçš„æ‰©å±•å®ç°ï¼Œéœ€åœ¨&lt;code&gt;@Table&lt;/code&gt;æ³¨è§£çš„&lt;code&gt;indexes&lt;/code&gt;å±æ€§ä¸­å£°æ˜ç´¢å¼•ï¼Œå¹¶é€šè¿‡&lt;code&gt;unique = true&lt;/code&gt;æ ‡è®°å”¯ä¸€æ€§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;indexes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;idx_email&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;email&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å‚æ•°è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt;ï¼šè‡ªå®šä¹‰ç´¢å¼•åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ç”±æ•°æ®åº“ç”Ÿæˆï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;columnList&lt;/code&gt;ï¼šç´¢å¼•å­—æ®µåï¼ˆå¤šåˆ—ç”¨é€—å·åˆ†éš”ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unique&lt;/code&gt;ï¼šè®¾ä¸º&lt;code&gt;true&lt;/code&gt;è¡¨ç¤ºå”¯ä¸€ç´¢å¼•&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç»„åˆå”¯ä¸€ç´¢å¼•çš„çµæ´»é…ç½®"&gt;ç»„åˆå”¯ä¸€ç´¢å¼•çš„çµæ´»é…ç½®
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€ä¸ºåŒä¸€è¡¨å®šä¹‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œå¯æ‰©å±•&lt;code&gt;@Table&lt;/code&gt;æ³¨è§£çš„&lt;code&gt;uniqueConstraints&lt;/code&gt;æˆ–&lt;code&gt;indexes&lt;/code&gt;å±æ€§ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;uniqueConstraints&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@UniqueConstraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnNames&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;email&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@UniqueConstraint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnNames&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;department&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;indexes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;idx_phone&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;phone&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­—æ®µå®šä¹‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒ…è·¯å¾„å·®å¼‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Table&lt;/code&gt;æ³¨è§£éœ€ä½¿ç”¨&lt;code&gt;javax.persistence&lt;/code&gt;åŒ…ä¸‹çš„æ ‡å‡†JPAæ³¨è§£ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ä½¿ç”¨Hibernateçš„&lt;code&gt;@Index&lt;/code&gt;æ³¨è§£ï¼Œéœ€ç¡®ä¿å¼•å…¥&lt;code&gt;org.hibernate.annotations&lt;/code&gt;åŒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åº“æ–¹è¨€é…ç½®&lt;/strong&gt;&lt;br&gt;
åœ¨&lt;code&gt;application.properties&lt;/code&gt;ä¸­è®¾ç½®æ”¯æŒç´¢å¼•ç”Ÿæˆçš„æ–¹è¨€ï¼ˆå¦‚MySQLçš„&lt;code&gt;MySQL5InnoDBDialect&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.jpa.database-platform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;org.hibernate.dialect.MySQL5InnoDBDialect&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ä¸çº¦æŸçš„å…³ç³»&lt;/strong&gt;&lt;br&gt;
å”¯ä¸€ç´¢å¼•å’Œå”¯ä¸€çº¦æŸåœ¨åŠŸèƒ½ä¸Šç­‰ä»·ï¼Œä½†å®ç°æœºåˆ¶ä¸åŒã€‚JPAé€šè¿‡å”¯ä¸€çº¦æŸéšå¼åˆ›å»ºç´¢å¼•ï¼Œè€Œ&lt;code&gt;@Index&lt;/code&gt;æ˜¯æ˜¾å¼å®šä¹‰ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="éªŒè¯ç´¢å¼•ç”Ÿæˆ"&gt;éªŒè¯ç´¢å¼•ç”Ÿæˆ
&lt;/h3&gt;&lt;p&gt;å¯é€šè¿‡æ•°æ®åº“å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚MySQLçš„&lt;code&gt;SHOW INDEX FROM table_name&lt;/code&gt;ï¼‰æˆ–IDEçš„æ•°æ®åº“è¿æ¥å·¥å…·æŸ¥çœ‹ç”Ÿæˆçš„å”¯ä¸€ç´¢å¼•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä»¥ä¸Šæ–¹æ³•é€‚ç”¨äºå¤§å¤šæ•°JPAå®ç°ï¼ˆå¦‚Hibernateï¼‰ã€‚è‹¥éœ€æ›´å¤æ‚çš„ç´¢å¼•é…ç½®ï¼ˆå¦‚é™åºç´¢å¼•ï¼‰ï¼Œå¯ç»“åˆæ•°æ®åº“åŸç”ŸSQLè„šæœ¬æˆ–å·¥å…·ï¼ˆå¦‚Flywayï¼‰è¿›è¡Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;h2 id="nestedruntimeexception"&gt;NestedRuntimeException
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;NestedRuntimeException&lt;/code&gt; æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®çš„æ˜¯&lt;strong&gt;å°è£…åµŒå¥—çš„åº•å±‚å¼‚å¸¸&lt;/strong&gt;ï¼Œä½¿å¾—å¼‚å¸¸é“¾ä¿¡æ¯èƒ½å¤Ÿå®Œæ•´ä¼ é€’å’Œè®°å½•ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å®šä¹‰ä¸æ ¸å¿ƒåŠŸèƒ½"&gt;å®šä¹‰ä¸æ ¸å¿ƒåŠŸèƒ½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å°è£…æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;NestedRuntimeException&lt;/code&gt; é€šè¿‡åŒ…è£¹å…¶ä»–å¼‚å¸¸ï¼ˆThrowableï¼‰å®ç°&lt;strong&gt;å¼‚å¸¸é“¾çš„ä¼ é€’&lt;/strong&gt;ã€‚å½“æ•è·åˆ°ä¸€ä¸ªåº•å±‚å¼‚å¸¸ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å¤±è´¥ã€æ–‡ä»¶è¯»å–é”™è¯¯ç­‰ï¼‰æ—¶ï¼Œå¯ä»¥å°†å…¶å°è£…åˆ° &lt;code&gt;NestedRuntimeException&lt;/code&gt; ä¸­æŠ›å‡ºï¼ŒåŒæ—¶ä¿ç•™åŸå§‹å¼‚å¸¸çš„å †æ ˆä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»§æ‰¿å…³ç³»&lt;/strong&gt;&lt;br&gt;
è¯¥ç±»ç›´æ¥ç»§æ‰¿è‡ª &lt;code&gt;RuntimeException&lt;/code&gt;ï¼Œå±äº&lt;strong&gt;éå—æ£€å¼‚å¸¸&lt;/strong&gt;ï¼ˆUnchecked Exceptionï¼‰ï¼Œå› æ­¤ä¸éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­æ˜¾å¼å£°æ˜æŠ›å‡ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹ä½¿ç”¨åœºæ™¯"&gt;å…¸å‹ä½¿ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¡†æ¶æˆ–ä¸­é—´ä»¶å¼€å‘&lt;/strong&gt;&lt;br&gt;
åœ¨å¤šå±‚æ¶æ„ï¼ˆå¦‚WebLogic Portalï¼‰ä¸­ï¼Œåº•å±‚æ¨¡å—çš„å¼‚å¸¸å¯èƒ½éœ€è¦é€šè¿‡ä¸åŒå±‚çº§ä¼ é€’åˆ°ä¸Šå±‚ã€‚é€šè¿‡ &lt;code&gt;NestedRuntimeException&lt;/code&gt; å°è£…åŸå§‹å¼‚å¸¸ï¼Œæ—¢èƒ½ç®€åŒ–å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œåˆèƒ½ä¿ç•™å®Œæ•´çš„é”™è¯¯ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚ï¼Œåœ¨ä¸šåŠ¡é€»è¾‘å±‚æ•è·åˆ°æ•°æ®è®¿é—®å±‚çš„ &lt;code&gt;SQLException&lt;/code&gt; åï¼Œå¯å°†å…¶åŒ…è£…ä¸º &lt;code&gt;NestedRuntimeException&lt;/code&gt; å¹¶é™„åŠ ä¸šåŠ¡è¯­ä¹‰æ¶ˆæ¯ï¼ˆå¦‚â€œç”¨æˆ·æ•°æ®æŸ¥è¯¢å¤±è´¥â€ï¼‰ï¼Œä¾¿äºåç»­æ—¥å¿—åˆ†ææˆ–å‰ç«¯å±•ç¤ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…³é”®æ–¹æ³•ä¸æ„é€ å™¨"&gt;å…³é”®æ–¹æ³•ä¸æ„é€ å™¨
&lt;/h3&gt;&lt;p&gt;é€šè¿‡ç½‘é¡µ6çš„æ–‡æ¡£å¯çŸ¥ï¼Œ&lt;code&gt;NestedRuntimeException&lt;/code&gt; æä¾›ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„é€ å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NestedRuntimeException(String message)&lt;/code&gt;ï¼šä»…åŒ…å«è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯çš„å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NestedRuntimeException(Throwable cause)&lt;/code&gt;ï¼šåŒ…è£…åº•å±‚å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NestedRuntimeException(String message, Throwable cause)&lt;/code&gt;ï¼šåŒæ—¶åŒ…å«æ¶ˆæ¯å’Œåº•å±‚å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getNestedException()&lt;/code&gt;ï¼šè·å–è¢«åµŒå¥—çš„åŸå§‹å¼‚å¸¸å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;getStackTraceString()&lt;/code&gt;ï¼šç”ŸæˆåŒ…å«åµŒå¥—å¼‚å¸¸å †æ ˆçš„å­—ç¬¦ä¸²ï¼Œä¾¿äºæ—¥å¿—è®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸æ ‡å‡†å¼‚å¸¸çš„åŒºåˆ«"&gt;ä¸æ ‡å‡†å¼‚å¸¸çš„åŒºåˆ«
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;NestedRuntimeException&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ ‡å‡†RuntimeException&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¼‚å¸¸é“¾æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒåµŒå¥—å…¶ä»–å¼‚å¸¸ï¼ˆé€šè¿‡æ„é€ å™¨å‚æ•°ï¼‰&lt;/td&gt;
&lt;td&gt;é€šå¸¸ä¸åŒ…å«åµŒå¥—å¼‚å¸¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è®¾è®¡ç›®çš„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºå°è£…åº•å±‚å¼‚å¸¸ï¼Œä¼ é€’å®Œæ•´é”™è¯¯é“¾&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºç¨‹åºé€»è¾‘é”™è¯¯æˆ–è¿è¡Œæ—¶ç¯å¢ƒé—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å¸¸è§åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸­é—´ä»¶ã€æ¡†æ¶æˆ–åˆ†å±‚æ¶æ„çš„å¼‚å¸¸å¤„ç†&lt;/td&gt;
&lt;td&gt;å¸¸è§„ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚ç©ºæŒ‡é’ˆï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="å®é™…åº”ç”¨ç¤ºä¾‹"&gt;å®é™…åº”ç”¨ç¤ºä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è°ƒç”¨å¯èƒ½æŠ›å‡ºåº•å±‚å¼‚å¸¸çš„æ–¹æ³•ï¼ˆå¦‚æ•°æ®åº“æ“ä½œï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;databaseService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;queryUserData&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SQLException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å°è£…åŸå§‹å¼‚å¸¸ï¼Œå¹¶é™„åŠ ä¸šåŠ¡è¯­ä¹‰æ¶ˆæ¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NestedRuntimeException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ç”¨æˆ·æ•°æ®æŸ¥è¯¢å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒåŸå§‹ &lt;code&gt;SQLException&lt;/code&gt; è¢«åŒ…è£…åæŠ›å‡ºï¼Œè°ƒç”¨æ–¹å¯é€šè¿‡ &lt;code&gt;getNestedException()&lt;/code&gt; è·å–å…·ä½“åŸå› ï¼Œä»è€Œå®ç°ç²¾å‡†çš„é”™è¯¯è¯Šæ–­ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-16"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;NestedRuntimeException&lt;/code&gt; æ˜¯ä¸€ç§å¢å¼ºå‹çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œé€šè¿‡åµŒå¥—æœºåˆ¶è§£å†³äº†ä¼ ç»Ÿå¼‚å¸¸é“¾ä¿¡æ¯ä¸¢å¤±çš„é—®é¢˜ã€‚å®ƒåœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼ˆå°¤å…¶æ˜¯éœ€è¦åˆ†å±‚å¼‚å¸¸å¤„ç†çš„åœºæ™¯ï¼‰å…·æœ‰é‡è¦ä»·å€¼ï¼Œä½†éœ€æ³¨æ„å…¶å±äºç‰¹å®šæ¡†æ¶ï¼ˆå¦‚WebLogic Portalï¼‰çš„æ‰©å±•å®ç°ï¼Œè€ŒéJavaæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚åœ¨Springç­‰ç°ä»£æ¡†æ¶ä¸­ï¼Œç±»ä¼¼åŠŸèƒ½å¯é€šè¿‡ &lt;code&gt;NestedRuntimeException&lt;/code&gt; çš„å­ç±»ï¼ˆå¦‚&lt;code&gt;DataAccessException&lt;/code&gt;ï¼‰å®ç°ã€‚&lt;/p&gt;
&lt;h2 id="nontransientdataaccessexception"&gt;NonTransientDataAccessException
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;NonTransientDataAccessException&lt;/code&gt; æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºè¡¨ç¤º&lt;strong&gt;éç¬æ—¶æ€§æ•°æ®è®¿é—®å¼‚å¸¸&lt;/strong&gt;çš„åŸºç±»ï¼Œç»§æ‰¿è‡ª &lt;code&gt;DataAccessException&lt;/code&gt;ã€‚å®ƒç”¨äºå°è£…é‚£äº›æ— æ³•é€šè¿‡ç®€å•é‡è¯•æ“ä½œè§£å†³çš„æ•°æ®åº“è®¿é—®é”™è¯¯ï¼Œä¾‹å¦‚ SQL è¯­æ³•é”™è¯¯ã€è¿åæ•°æ®å®Œæ•´æ€§çº¦æŸï¼ˆå¦‚ä¸»é”®é‡å¤ï¼‰ç­‰åœºæ™¯ã€‚&lt;/p&gt;
&lt;h3 id="å…„å¼Ÿç±»åŒå±-dataaccessexception-çš„å­ç±»"&gt;å…„å¼Ÿç±»ï¼ˆåŒå± &lt;code&gt;DataAccessException&lt;/code&gt; çš„å­ç±»ï¼‰
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯å…¶ç›´æ¥å…„å¼Ÿç±»åŠå…¶æ ¸å¿ƒä½œç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;TransientDataAccessException&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
è¡¨ç¤º&lt;strong&gt;ç¬æ—¶æ€§å¼‚å¸¸&lt;/strong&gt;ï¼Œé€šå¸¸ç”±ä¸´æ—¶æ€§æ•…éšœå¼•å‘ï¼ˆå¦‚ç½‘ç»œé—ªæ–­ã€æ•°æ®åº“è¿æ¥è¶…æ—¶ï¼‰ï¼Œå¯é€šè¿‡é‡è¯•æ“ä½œè§£å†³ã€‚å…¸å‹å­ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;QueryTimeoutException&lt;/code&gt;ï¼šæŸ¥è¯¢è¶…æ—¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DeadlockLoserDataAccessException&lt;/code&gt;ï¼šæ•°æ®åº“æ­»é”å¯¼è‡´æ“ä½œå¤±è´¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RecoverableDataAccessException&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
è¡¨ç¤º&lt;strong&gt;å¯æ¢å¤çš„å¼‚å¸¸&lt;/strong&gt;ï¼Œéœ€åº”ç”¨å±‚ä»‹å…¥å¤„ç†ï¼ˆå¦‚äº‹åŠ¡å›æ»šåé‡æ–°æ‰§è¡Œï¼‰ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CannotAcquireLockException&lt;/code&gt;ï¼šæ— æ³•è·å–æ•°æ®åº“é”&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CannotSerializeTransactionException&lt;/code&gt;ï¼šäº‹åŠ¡åºåˆ—åŒ–å†²çª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;UncategorizedDataAccessException&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æœªåˆ†ç±»çš„é€šç”¨å¼‚å¸¸ï¼Œç”¨äºå°è£…æ— æ³•å½’å…¥ä¸Šè¿°å…·ä½“ç±»å‹çš„åº•å±‚é”™è¯¯ï¼ˆå¦‚ JDBC é©±åŠ¨æŠ›å‡ºçš„éæ ‡å‡†å¼‚å¸¸ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å…¸å‹åº”ç”¨åœºæ™¯å¯¹æ¯”"&gt;å…¸å‹åº”ç”¨åœºæ™¯å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å¼‚å¸¸ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§¦å‘åŸå› &lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¤„ç†å»ºè®®&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;NonTransientDataAccessException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;SQL è¯­æ³•é”™è¯¯ã€å”¯ä¸€é”®å†²çª&lt;/td&gt;
&lt;td&gt;ä¿®å¤ä»£ç é€»è¾‘ï¼Œé¿å…é‡å¤æäº¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;TransientDataAccessException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç½‘ç»œæŠ–åŠ¨ã€è¿æ¥æ± è€—å°½&lt;/td&gt;
&lt;td&gt;é‡è¯•æœºåˆ¶ã€ä¼˜åŒ–èµ„æºåˆ†é…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RecoverableDataAccessException&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“æ­»é”ã€äº‹åŠ¡éš”ç¦»çº§åˆ«å†²çª&lt;/td&gt;
&lt;td&gt;é‡è¯•æˆ–è°ƒæ•´äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ç»§æ‰¿å…³ç³»ä¸è®¾è®¡æ„ä¹‰"&gt;ç»§æ‰¿å…³ç³»ä¸è®¾è®¡æ„ä¹‰
&lt;/h3&gt;&lt;p&gt;Spring é€šè¿‡åˆ†å±‚å¼‚å¸¸ä½“ç³»ï¼ˆå¦‚ &lt;code&gt;DataAccessException&lt;/code&gt; åŠå…¶å­ç±»ï¼‰å®ç°äº†&lt;strong&gt;æ•°æ®åº“æ— å…³æ€§&lt;/strong&gt;ï¼Œå°†ä¸åŒæ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰çš„åŸç”Ÿå¼‚å¸¸ç»Ÿä¸€å°è£…ï¼Œä½¿å¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚å·®å¼‚ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MySQL çš„å”¯ä¸€é”®å†²çªå¼‚å¸¸ä¼šè¢«å°è£…ä¸º &lt;code&gt;DataIntegrityViolationException&lt;/code&gt;ï¼ˆ&lt;code&gt;NonTransientDataAccessException&lt;/code&gt; çš„å­ç±»ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;PostgreSQL çš„æ­»é”é”™è¯¯ä¼šè¢«è½¬æ¢ä¸º &lt;code&gt;DeadlockLoserDataAccessException&lt;/code&gt;ï¼ˆ&lt;code&gt;TransientDataAccessException&lt;/code&gt; çš„å­ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç§è®¾è®¡æå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶é€šè¿‡å¼‚å¸¸é“¾ï¼ˆ&lt;code&gt;NestedRuntimeException&lt;/code&gt; ç‰¹æ€§ï¼‰ä¿ç•™äº†åŸå§‹é”™è¯¯å †æ ˆï¼Œä¾¿äºè°ƒè¯•ã€‚&lt;/p&gt;
&lt;h2 id="æ‰¹é‡æ’å…¥"&gt;æ‰¹é‡æ’å…¥
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Data Elasticsearchä¸­ï¼Œä½¿ç”¨&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;çš„&lt;code&gt;bulkIndex&lt;/code&gt;æ–¹æ³•ä¸ç›´æ¥æ“ä½œ&lt;code&gt;BulkRequest&lt;/code&gt;çš„åº•å±‚APIåœ¨å®ç°æ‰¹é‡å†™å…¥æ—¶æœ‰æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹ä»æ€§èƒ½ã€çµæ´»æ€§ã€ä»£ç ç»´æŠ¤æ€§ç­‰è§’åº¦å¯¹æ¯”åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æŠ½è±¡å±‚çº§ä¸ä»£ç ç®€æ´æ€§"&gt;&lt;strong&gt;æŠ½è±¡å±‚çº§ä¸ä»£ç ç®€æ´æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;æ–¹å¼&lt;/strong&gt;&lt;br&gt;
é€šè¿‡Spring Dataçš„å°è£…ï¼Œä»£ç æ›´ç®€æ´ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨å¤„ç†JSONåºåˆ—åŒ–æˆ–è¯·æ±‚æ„å»ºã€‚ä¾‹å¦‚ï¼Œé€šè¿‡&lt;code&gt;IndexQueryBuilder&lt;/code&gt;è‡ªåŠ¨å°†Javaå¯¹è±¡è½¬æ¢ä¸ºESæ–‡æ¡£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;IndexQuery&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;queries&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexQueryBuilder&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;withObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;elasticsearchTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bulkIndex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queries&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šé€‚åˆç®€å•åœºæ™¯ï¼Œå¿«é€Ÿå®ç°æ‰¹é‡æ’å…¥ï¼Œæ— éœ€å…³æ³¨åº•å±‚APIç»†èŠ‚ã€‚&lt;br&gt;
&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šçµæ´»æ€§å—é™ï¼Œä¾‹å¦‚æ— æ³•ç›´æ¥æ§åˆ¶æ‰¹é‡è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€é‡è¯•ç­–ç•¥æˆ–è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;BulkRequest&lt;/code&gt;æ–¹å¼&lt;/strong&gt;&lt;br&gt;
ç›´æ¥æ“ä½œElasticsearchçš„&lt;code&gt;RestHighLevelClient&lt;/code&gt;ï¼Œéœ€æ‰‹åŠ¨æ„å»ºæ¯ä¸ªæ–‡æ¡£çš„&lt;code&gt;IndexRequest&lt;/code&gt;å¹¶å¤„ç†åºåˆ—åŒ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;BulkRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulkRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BulkRequest&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IndexRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;index_name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;source&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;JSONUtil&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toJsonStr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XContentType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;bulkRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;BulkResponse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;elasticsearchClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bulk&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bulkRequest&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RequestOptions&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;DEFAULT&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå®Œå…¨æ§åˆ¶è¯·æ±‚å‚æ•°ï¼ˆå¦‚è¶…æ—¶ã€é‡è¯•æ¬¡æ•°ï¼‰ï¼Œæ”¯æŒè‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘ï¼ˆä¾‹å¦‚æ’é™¤æŸäº›å­—æ®µï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šä»£ç å†—ä½™ï¼Œéœ€æ‰‹åŠ¨å¤„ç†æ–‡æ¡£è½¬æ¢å’Œé”™è¯¯å“åº”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–æ½œåŠ›"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–æ½œåŠ›&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡å¤§å°æ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;é»˜è®¤å¯èƒ½å•æ¬¡æäº¤å…¨éƒ¨æ•°æ®ï¼Œè‹¥æ•°æ®é‡è¿‡å¤§ï¼ˆå¦‚10ä¸‡æ¡ï¼‰ï¼Œæ˜“å¼•å‘å†…å­˜å‹åŠ›æˆ–è¶…æ—¶ã€‚éœ€æ‰‹åŠ¨åˆ†æ‰¹æ¬¡æäº¤ï¼ˆå¦‚ç½‘é¡µ1ä¸­æ¯1000æ¡æäº¤ä¸€æ¬¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BulkRequest&lt;/code&gt;å…è®¸çµæ´»è°ƒæ•´æ¯æ‰¹æ¬¡çš„å¤§å°ï¼Œå¹¶é€šè¿‡å‹æµ‹ç¡®å®šæœ€ä¼˜å€¼ï¼ˆé€šå¸¸500-2000æ¡/æ‰¹ï¼‰ï¼Œå‡å°‘ç½‘ç»œå¼€é”€å’Œæ®µåˆå¹¶é¢‘ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•é…ç½®ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;BulkRequest&lt;/code&gt;æ›´æ˜“é›†æˆç´¢å¼•ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚åœ¨æ‰¹é‡å†™å…¥æœŸé—´ä¸´æ—¶å…³é—­åˆ·æ–°ï¼ˆ&lt;code&gt;refresh_interval=-1&lt;/code&gt;ï¼‰å’Œå‰¯æœ¬ï¼ˆ&lt;code&gt;number_of_replicas=0&lt;/code&gt;ï¼‰ï¼Œå†™å…¥å®Œæˆåå†æ¢å¤ï¼Œå‡å°‘I/Oå‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;éœ€é€šè¿‡é¢å¤–é…ç½®æˆ–è°ƒç”¨&lt;code&gt;indexOps()&lt;/code&gt;æ¥å£è°ƒæ•´ç´¢å¼•å‚æ•°ï¼Œçµæ´»æ€§è¾ƒä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;BulkRequest&lt;/code&gt;è¿”å›çš„&lt;code&gt;BulkResponse&lt;/code&gt;å¯éå†æ£€æŸ¥æ¯ä¸ªæ–‡æ¡£çš„æ’å…¥çŠ¶æ€ï¼Œç²¾ç¡®å¤„ç†å¤±è´¥è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;çš„&lt;code&gt;bulkIndex&lt;/code&gt;æ–¹æ³•å¯èƒ½å°è£…é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä½†å¼€å‘è€…éš¾ä»¥ç›´æ¥è·å–å¤±è´¥è¯¦æƒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯-7"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å‹æ‰¹é‡æ“ä½œï¼ˆå¦‚åƒçº§æ•°æ®é‡ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¿«é€ŸåŸå‹å¼€å‘ï¼Œéœ€å‡å°‘ä»£ç é‡ï¼›&lt;/li&gt;
&lt;li&gt;é¡¹ç›®å·²æ·±åº¦ä¾èµ–Spring Dataç”Ÿæ€ï¼ˆå¦‚åŒæ—¶ä½¿ç”¨JPAå’ŒES Repositoryï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;BulkRequest&lt;/code&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§è§„æ¨¡æ•°æ®å¯¼å…¥ï¼ˆå¦‚ç™¾ä¸‡çº§ï¼‰ï¼Œéœ€ç²¾ç»†æ§åˆ¶æ€§èƒ½å’Œèµ„æºï¼›&lt;/li&gt;
&lt;li&gt;éœ€è¦è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘æˆ–ç´¢å¼•å‚æ•°ï¼ˆå¦‚å…³é—­å®æ—¶åˆ·æ–°ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹é”™è¯¯å¤„ç†æœ‰ä¸¥æ ¼è¦æ±‚ï¼ˆå¦‚é‡‘èåœºæ™¯éœ€é›¶ä¸¢å¤±ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”å‚è€ƒ"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”å‚è€ƒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ ¹æ®ç½‘é¡µ1çš„æµ‹è¯•ï¼Œä¸¤ç§æ–¹å¼åœ¨ä¸‡çº§æ•°æ®é‡ä¸‹è€—æ—¶ç›¸è¿‘ï¼ˆçº¦1.2ä¸‡æ¡/ç§’ï¼‰ï¼Œä½†åœ¨ä»¥ä¸‹åœºæ™¯å·®å¼‚æ˜¾è‘—ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åœºæ™¯&lt;/th&gt;
&lt;th&gt;&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;BulkRequest&lt;/code&gt;ï¼ˆä¼˜åŒ–åï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç™¾ä¸‡çº§æ•°æ®ï¼ˆå…³é—­åˆ·æ–°ï¼‰&lt;/td&gt;
&lt;td&gt;çº¦98ms/æ¡&lt;/td&gt;
&lt;td&gt;çº¦50ms/æ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå®šä¹‰åºåˆ—åŒ–&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é”™è¯¯å¤„ç†ç²’åº¦&lt;/td&gt;
&lt;td&gt;ç²—ç²’åº¦&lt;/td&gt;
&lt;td&gt;ç»†ç²’åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸å»ºè®®-2"&gt;&lt;strong&gt;æ€»ç»“ä¸å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‰æ‹©ä¾æ®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è‹¥è¿½æ±‚å¼€å‘æ•ˆç‡ä¸”æ•°æ®é‡è¾ƒå°ï¼Œä¼˜å…ˆä½¿ç”¨&lt;code&gt;ElasticsearchTemplate&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥éœ€é«˜æ€§èƒ½ã€çµæ´»æ§åˆ¶æˆ–å¤„ç†æµ·é‡æ•°æ®ï¼Œé€‰æ‹©&lt;code&gt;BulkRequest&lt;/code&gt;+&lt;code&gt;RestHighLevelClient&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šç”¨ä¼˜åŒ–ç­–ç•¥&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è°ƒæ•´æ‰¹é‡å¤§å°&lt;/strong&gt;ï¼šé€šè¿‡å‹æµ‹ç¡®å®šæ¯æ‰¹æ¬¡æ¡æ•°ï¼ˆå‚è€ƒå€¼500-2000ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­åˆ·æ–°ä¸å‰¯æœ¬&lt;/strong&gt;ï¼šå†™å…¥å‰è®¾ç½®&lt;code&gt;refresh_interval=-1&lt;/code&gt;å’Œ&lt;code&gt;number_of_replicas=0&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥æäº¤&lt;/strong&gt;ï¼šç»“åˆçº¿ç¨‹æ± éš”ç¦»å†™å…¥æ“ä½œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§èµ„æº&lt;/strong&gt;ï¼šå…³æ³¨ESèŠ‚ç‚¹çš„å †å†…å­˜å’Œç£ç›˜I/Oï¼Œé¿å…OOMã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="elasticsearch-bulk-api"&gt;ElasticSearch Bulk API
&lt;/h2&gt;&lt;p&gt;Bulk API æ˜¯ Elasticsearch æä¾›çš„é«˜æ•ˆæ‰¹é‡æ“ä½œæ¥å£ï¼Œæ”¯æŒåœ¨å•ä¸ªè¯·æ±‚ä¸­æ‰§è¡Œå¤šä¸ªç´¢å¼•ï¼ˆIndexï¼‰ã€åˆ›å»ºï¼ˆCreateï¼‰ã€æ›´æ–°ï¼ˆUpdateï¼‰å’Œåˆ é™¤ï¼ˆDeleteï¼‰æ“ä½œï¼Œæ˜¾è‘—å‡å°‘ç½‘ç»œå¼€é”€å’Œæå‡æ•°æ®å¤„ç†æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§åŠä½¿ç”¨è¦ç‚¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½ä¸è¯­æ³•"&gt;æ ¸å¿ƒåŠŸèƒ½ä¸è¯­æ³•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ”¯æŒçš„æ“ä½œç±»å‹&lt;/strong&gt;&lt;br&gt;
Bulk API æ”¯æŒä»¥ä¸‹å››ç§æ“ä½œç±»å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;index&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ›å»ºæˆ–æ›¿æ¢æ–‡æ¡£ï¼ˆè‹¥æ–‡æ¡£å·²å­˜åœ¨åˆ™è¦†ç›–ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;create&lt;/code&gt;&lt;/strong&gt;ï¼šä»…å½“æ–‡æ¡£ä¸å­˜åœ¨æ—¶åˆ›å»ºï¼Œå¦åˆ™è¿”å›é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;update&lt;/code&gt;&lt;/strong&gt;ï¼šåŸºäºè„šæœ¬æˆ–éƒ¨åˆ†å­—æ®µæ›´æ–°æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;delete&lt;/code&gt;&lt;/strong&gt;ï¼šåˆ é™¤æŒ‡å®šæ–‡æ¡£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚æ ¼å¼&lt;/strong&gt;&lt;br&gt;
æ¯ä¸ªæ“ä½œéœ€éµå¾ªä¸¥æ ¼çš„ JSON æ ¼å¼ï¼Œç”±ä¸¤è¡Œç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œå…ƒæ•°æ®&lt;/strong&gt;ï¼šå®šä¹‰æ“ä½œç±»å‹ã€ç›®æ ‡ç´¢å¼•å’Œæ–‡æ¡£ IDã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œæ•°æ®&lt;/strong&gt;ï¼ˆä»… &lt;code&gt;index&lt;/code&gt;ã€&lt;code&gt;create&lt;/code&gt;ã€&lt;code&gt;update&lt;/code&gt; éœ€è¦ï¼‰ï¼šJSON æ ¼å¼çš„æ–‡æ¡£å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST&lt;/span&gt; &lt;span class="err"&gt;/_bulk&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;_index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;field1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;value1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;_index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šæ¯è¡Œå¿…é¡»ä»¥æ¢è¡Œç¬¦ &lt;code&gt;\n&lt;/code&gt; åˆ†éš”ï¼Œä¸”æœ€åä¸€è¡Œä¹Ÿéœ€æ¢è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"&gt;æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡å¤§å°è°ƒæ•´&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•æ¬¡æ‰¹é‡è¯·æ±‚çš„æ–‡æ¡£æ•°å»ºè®®åœ¨ &lt;strong&gt;500â€“5000 æ¡&lt;/strong&gt; ä¹‹é—´ï¼Œå…·ä½“éœ€é€šè¿‡å‹æµ‹ç¡®å®šæœ€ä½³å€¼ã€‚ä¾‹å¦‚ï¼Œä» 1000 æ¡å¼€å§‹é€æ­¥å¢åŠ ï¼Œè§‚å¯Ÿæ€§èƒ½æ‹ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ä½“å¤§å°æ§åˆ¶åœ¨ &lt;strong&gt;5â€“15 MB&lt;/strong&gt; ä»¥å†…ï¼Œé¿å…å†…å­˜å‹åŠ›è¿‡å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•é…ç½®ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­å®æ—¶åˆ·æ–°&lt;/strong&gt;ï¼šæ‰¹é‡å†™å…¥å‰è®¾ç½® &lt;code&gt;refresh_interval=-1&lt;/code&gt;ï¼Œå®Œæˆåæ¢å¤é»˜è®¤å€¼ä»¥å‡å°‘æ®µåˆå¹¶å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¦ç”¨å‰¯æœ¬&lt;/strong&gt;ï¼šä¸´æ—¶è®¾ç½® &lt;code&gt;number_of_replicas=0&lt;/code&gt;ï¼Œå†™å…¥å®Œæˆåå†æ¢å¤å‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥ä¸å¹¶å‘&lt;/strong&gt;&lt;br&gt;
ç»“åˆçº¿ç¨‹æ± å¼‚æ­¥æäº¤æ‰¹é‡è¯·æ±‚ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚ä¾‹å¦‚ï¼ŒJava ä¸­é€šè¿‡ &lt;code&gt;BulkProcessor&lt;/code&gt; è‡ªåŠ¨åˆ†æ‰¹æ¬¡æäº¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é”™è¯¯å¤„ç†ä¸å“åº”"&gt;é”™è¯¯å¤„ç†ä¸å“åº”
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”ç»“æ„&lt;/strong&gt;&lt;br&gt;
è¿”å›ç»“æœæŒ‰æ“ä½œæäº¤é¡ºåºæ’åˆ—ï¼Œæ¯ä¸ªæ“ä½œçš„çŠ¶æ€ç‹¬ç«‹ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;took&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;errors&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;items&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;201&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;error&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;æ–‡æ¡£ä¸å­˜åœ¨&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;errors&lt;/code&gt; å­—æ®µæ ‡è®°æ•´ä½“æ˜¯å¦å¤±è´¥ï¼Œéœ€éå† &lt;code&gt;items&lt;/code&gt; å¤„ç†å…·ä½“é”™è¯¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®¹é”™æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æŸæ¡æ“ä½œå¤±è´¥ï¼ˆå¦‚åˆ é™¤ä¸å­˜åœ¨çš„æ–‡æ¡£ï¼‰ï¼Œä¸å½±å“å…¶ä»–æ“ä½œæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¯é€šè¿‡ &lt;code&gt;retry_on_conflict&lt;/code&gt; å‚æ•°è®¾ç½®æ›´æ–°æ“ä½œçš„é‡è¯•æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯-8"&gt;é€‚ç”¨åœºæ™¯
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åˆå§‹åŒ–ä¸è¿ç§»&lt;/strong&gt;&lt;br&gt;
é€‚ç”¨äºç™¾ä¸‡çº§æ•°æ®çš„æ‰¹é‡å¯¼å…¥ï¼Œä¾‹å¦‚ä»å…³ç³»å‹æ•°æ®åº“åŒæ­¥è‡³ Elasticsearchã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ—¥å¿—å¤„ç†&lt;/strong&gt;&lt;br&gt;
é«˜é¢‘æ—¥å¿—æµå¯é€šè¿‡ Bulk API æ‰¹é‡å†™å…¥ï¼Œæå‡ååé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ“ä½œåœºæ™¯&lt;/strong&gt;&lt;br&gt;
å•æ¬¡è¯·æ±‚å¯æ··åˆå¤šç§æ“ä½œç±»å‹ï¼Œä¾‹å¦‚åŒæ—¶åˆ é™¤æ—§æ•°æ®å¹¶æ’å…¥æ–°æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-2"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ ¼å¼ä¸¥æ ¼æ€§&lt;/strong&gt;&lt;br&gt;
é”™è¯¯çš„æ¢è¡Œæˆ– JSON æ ¼å¼ä¼šå¯¼è‡´è¯·æ±‚è§£æå¤±è´¥ï¼ˆå¦‚ &lt;code&gt;Malformed action/metadata line&lt;/code&gt; é”™è¯¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¡ºåºä¸ä¿è¯æ€§&lt;/strong&gt;&lt;br&gt;
è™½ç„¶å“åº”é¡ºåºä¸æäº¤é¡ºåºä¸€è‡´ï¼Œä½†å®é™…æ‰§è¡Œé¡ºåºå¯èƒ½å› åˆ†ç‰‡è·¯ç”±å’ŒèŠ‚ç‚¹è´Ÿè½½ä¸åŒè€Œä¹±åºï¼ˆåŒä¸€æ–‡æ¡£çš„æ“ä½œé™¤å¤–ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;&lt;br&gt;
éœ€ç›‘æ§å †å†…å­˜å’Œç£ç›˜ I/Oï¼Œé¿å…æ‰¹é‡è¿‡å¤§å¼•å‘ OOM æˆ–èŠ‚ç‚¹å‹åŠ›è¿‡é«˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†ä½¿ç”¨ Bulk API å’Œä¼˜åŒ–ç­–ç•¥ï¼Œå¯å®ç°æ¯ç§’æ•°ä¸‡çº§æ–‡æ¡£æ“ä½œï¼Œå°¤å…¶åœ¨å¤§æ•°æ®åœºæ™¯ä¸‹æ€§èƒ½æå‡æ˜¾è‘—ã€‚å…·ä½“å‚æ•°éœ€ç»“åˆç¡¬ä»¶é…ç½®å’Œæ•°æ®ç‰¹æ€§è°ƒæ•´ã€‚&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 9</title><link>https://dyhes.github.io/p/postopia-dev-logweek-9/</link><pubDate>Mon, 07 Apr 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-9/</guid><description>&lt;p&gt;todo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;del&gt;æ¶ˆæ¯ä»£ç†æ›´æ–°è®¡æ•°&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;æœç´¢&lt;/li&gt;
&lt;li&gt;æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;&lt;del&gt;å›¾åƒç¼–è¾‘&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ”¹é€ &lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªï¼Œæ—¥å¿—åˆ†æ&lt;/li&gt;
&lt;li&gt;è¯­ä¹‰æœç´¢&lt;/li&gt;
&lt;li&gt;æ¨é€
&lt;ul&gt;
&lt;li&gt;AI å–œå¥½åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ optimize&lt;/li&gt;
&lt;li&gt;å°åŠŸèƒ½
&lt;ul&gt;
&lt;li&gt;Edit comment&lt;/li&gt;
&lt;li&gt;pin comment&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="spring-kafka"&gt;Spring Kafka
&lt;/h2&gt;&lt;h3 id="æ·»åŠ ä¾èµ–"&gt;æ·»åŠ ä¾èµ–
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;springframework&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;kafka&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;artifactId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;spring&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;kafka&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;artifactId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;8&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;6&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;å»ºè®®ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="é…ç½®å‚æ•°"&gt;é…ç½®å‚æ•°
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;kafka&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;bootstrap-servers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;localhost:9092 &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# Kafka æœåŠ¡åœ°å€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;consumer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;group-id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;my-group &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ¶ˆè´¹è€…ç»„ ID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;auto-offset-reset&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;earliest &lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# ä»æœ€æ—©åç§»é‡å¼€å§‹æ¶ˆè´¹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;enable-auto-commit&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å…³é—­è‡ªåŠ¨æäº¤åç§»é‡ï¼ˆæ¨èæ‰‹åŠ¨æ§åˆ¶ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;key-deserializer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;org.apache.kafka.common.serialization.StringDeserializer&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value-deserializer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;org.apache.kafka.common.serialization.StringDeserializer&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;producer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;key-serializer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;org.apache.kafka.common.serialization.StringSerializer&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;value-serializer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;org.apache.kafka.common.serialization.StringSerializer&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="kafka-listener"&gt;@Kafka Listener
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;@KafkaListener&lt;/code&gt; æ˜¯ Spring Kafka æ¡†æ¶ä¸­ç”¨äºå£°æ˜ Kafka æ¶ˆæ¯ç›‘å¬å™¨çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶åŠŸèƒ½å¼ºå¤§ä¸”é…ç½®çµæ´»ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨åœºæ™¯çš„å…¨é¢è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒåŠŸèƒ½"&gt;æ ¸å¿ƒåŠŸèƒ½
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯è®¢é˜…ä¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;@KafkaListener&lt;/code&gt; é€šè¿‡ç›‘å¬æŒ‡å®š Kafka Topic çš„æ¶ˆæ¯ï¼Œå®ç°äº‹ä»¶é©±åŠ¨å¼æ¶ˆè´¹ã€‚å½“æ¶ˆæ¯åˆ°è¾¾ Topic æ—¶ï¼Œæ³¨è§£æ ‡è®°çš„æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è§¦å‘ä»¥å¤„ç†æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;order-events&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;order-group&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleOrder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OrderEvent&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†è®¢å•äº‹ä»¶&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç»„ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;groupId&lt;/code&gt; å‚æ•°æŒ‡å®šæ¶ˆè´¹è€…ç»„ï¼ŒåŒä¸€ç»„å†…çš„æ¶ˆè´¹è€…å…±äº« Topic çš„åˆ†åŒºè´Ÿè½½ï¼Œå®ç°åˆ†å¸ƒå¼æ¶ˆè´¹ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æœªæ˜¾å¼é…ç½® &lt;code&gt;groupId&lt;/code&gt;ï¼Œé»˜è®¤ä½¿ç”¨ &lt;code&gt;id&lt;/code&gt; å±æ€§å€¼ä½œä¸ºæ¶ˆè´¹è€…ç»„åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å‚æ•°è¯¦è§£"&gt;å‚æ•°è¯¦è§£
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŸºç¡€é…ç½®å‚æ•°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;topics&lt;/code&gt;&lt;/strong&gt;ï¼šæŒ‡å®šç›‘å¬çš„ Topic åç§°ï¼ˆæ”¯æŒå¤šä¸ªï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;id&lt;/code&gt;&lt;/strong&gt;ï¼šç›‘å¬å™¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚è‹¥æœªé…ç½® &lt;code&gt;groupId&lt;/code&gt;ï¼Œ&lt;code&gt;id&lt;/code&gt; ä¼šä½œä¸ºæ¶ˆè´¹è€…ç»„åã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;containerFactory&lt;/code&gt;&lt;/strong&gt;ï¼šæŒ‡å®šè‡ªå®šä¹‰çš„ç›‘å¬å™¨å®¹å™¨å·¥å‚ï¼Œç”¨äºé…ç½®æ‰¹é‡æ¶ˆè´¹ã€ååºåˆ—åŒ–å™¨ç­‰é«˜çº§ç‰¹æ€§ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;logs&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;containerFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;batchFactory&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€æ§åˆ¶å‚æ•°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;autoStartup&lt;/code&gt;&lt;/strong&gt;ï¼šæ§åˆ¶ç›‘å¬å™¨æ˜¯å¦éšåº”ç”¨å¯åŠ¨ï¼ˆé»˜è®¤ &lt;code&gt;true&lt;/code&gt;ï¼‰ã€‚è®¾ä¸º &lt;code&gt;false&lt;/code&gt; åå¯é€šè¿‡ API æ‰‹åŠ¨å¯åœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;concurrency&lt;/code&gt;&lt;/strong&gt;ï¼šè®¾ç½®å¹¶å‘æ¶ˆè´¹è€…çº¿ç¨‹æ•°ï¼Œæå‡ååé‡ï¼ˆéœ€å°äºç­‰äº Topic åˆ†åŒºæ•°ï¼‰ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;high-throughput&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;concurrency&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;5&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é«˜çº§è·¯ç”±å‚æ•°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;topicPattern&lt;/code&gt;&lt;/strong&gt;ï¼šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¤šä¸ª Topicã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;topicPartitions&lt;/code&gt;&lt;/strong&gt;ï¼šç²¾ç¡®æŒ‡å®šåˆ†åŒºåŠåˆå§‹åç§»é‡ï¼ˆå¦‚ä»ç‰¹å®š offset å¼€å§‹æ¶ˆè´¹ï¼‰ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topicPartitions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@TopicPartition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;partitions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;0-2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åŠ¨æ€æ§åˆ¶ä¸æ‰©å±•"&gt;åŠ¨æ€æ§åˆ¶ä¸æ‰©å±•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰‹åŠ¨å¯åœç›‘å¬å™¨&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;KafkaListenerEndpointRegistry&lt;/code&gt; å¯åŠ¨æ€æ§åˆ¶ç›‘å¬å™¨çš„è¿è¡ŒçŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KafkaListenerEndpointRegistry&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;startListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;listenerId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getListenerContainer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;listenerId&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿è¡Œæ—¶é…ç½®æ³¨å…¥&lt;/strong&gt;&lt;br&gt;
ç»“åˆ &lt;code&gt;KafkaConfig&lt;/code&gt; å’Œ &lt;code&gt;KafkaProperties&lt;/code&gt;ï¼Œå¯å®ç°å¤–éƒ¨åŒ–é…ç½®ï¼ˆå¦‚ä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½ Topic åç§°ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;${kafka.topic.order}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¹¶å‘ä¸æ‰¹é‡å¤„ç†"&gt;å¹¶å‘ä¸æ‰¹é‡å¤„ç†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¹¶å‘æ¶ˆè´¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;concurrency&lt;/code&gt; å‚æ•°å¯åŠ¨å¤šçº¿ç¨‹æ¶ˆè´¹è€…ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª &lt;code&gt;KafkaMessageListenerContainer&lt;/code&gt; å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹å‘½åè§„åˆ™&lt;/strong&gt;ï¼š&lt;code&gt;[æ¶ˆè´¹è€…ID]-[çº¿ç¨‹åºå·]-C-[åºå·]&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;consumer-order-1-C-1&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡æ¶ˆè´¹&lt;/strong&gt;&lt;br&gt;
é…ç½® &lt;code&gt;BatchListener&lt;/code&gt; å·¥å‚ï¼Œä¸€æ¬¡æ€§å¤„ç†å¤šæ¡æ¶ˆæ¯ä»¥æå‡æ€§èƒ½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KafkaListenerContainerFactory&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchFactory&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentKafkaListenerContainerFactory&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentKafkaListenerContainerFactory&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setBatchListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¯ç”¨æ‰¹é‡æ¨¡å¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å¼‚å¸¸å¤„ç†ä¸è°ƒè¯•"&gt;å¼‚å¸¸å¤„ç†ä¸è°ƒè¯•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”™è¯¯å¤„ç†æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;errorHandler&lt;/code&gt;&lt;/strong&gt;ï¼šæŒ‡å®šè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨ï¼ˆéœ€å®ç° &lt;code&gt;KafkaListenerErrorHandler&lt;/code&gt;ï¼‰ï¼Œç”¨äºæ•è·æ¶ˆè´¹è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;errors&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;errorHandler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;customErrorHandler&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒè¯•ä¸æ—¥å¿—&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;ConsumerRecord&lt;/code&gt; å¯¹è±¡å¯è·å–æ¶ˆæ¯å…ƒæ•°æ®ï¼ˆå¦‚åˆ†åŒºã€offsetã€æ—¶é—´æˆ³ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ—¥å¿—ç¤ºä¾‹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;debug-topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;logRecord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ConsumerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Received message from partition {}: {}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="åº•å±‚æœºåˆ¶"&gt;åº•å±‚æœºåˆ¶
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨è§£è§£ææµç¨‹&lt;/strong&gt;&lt;br&gt;
Spring å®¹å™¨åœ¨å¯åŠ¨æ—¶é€šè¿‡ &lt;code&gt;KafkaListenerAnnotationBeanPostProcessor&lt;/code&gt; æ‰«æ &lt;code&gt;@KafkaListener&lt;/code&gt; æ³¨è§£ï¼Œæ³¨å†Œç›‘å¬å™¨ç«¯ç‚¹å¹¶åˆ›å»º &lt;code&gt;KafkaMessageListenerContainer&lt;/code&gt; å®ä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›‘å¬å™¨å®¹å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ConcurrentMessageListenerContainer&lt;/code&gt;&lt;/strong&gt;ï¼šç®¡ç†å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆæ¯æ‹‰å–å¾ªç¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;KafkaMessageListenerContainer&lt;/code&gt;&lt;/strong&gt;ï¼šæ ¸å¿ƒå®ç°ç±»ï¼Œè´Ÿè´£ä¸ Kafka Broker äº¤äº’åŠæ¶ˆæ¯åˆ†å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“ä¸æœ€ä½³å®è·µ"&gt;æ€»ç»“ä¸æœ€ä½³å®è·µ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šå®æ—¶äº‹ä»¶å¤„ç†ã€æ—¥å¿—æ”¶é›†ã€æµå¼æ•°æ®å¤„ç†ç­‰éœ€è¦é«˜ååã€ä½å»¶è¿Ÿçš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®å»ºè®®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒéœ€è®¾ç½® &lt;code&gt;autoStartup=&amp;quot;false&amp;quot;&lt;/code&gt; å¹¶ç»“åˆç›‘æ§ç³»ç»ŸåŠ¨æ€å¯åœç›‘å¬å™¨ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;concurrency&lt;/code&gt; æå‡æ¶ˆè´¹èƒ½åŠ›æ—¶ï¼Œç¡®ä¿å…¶å€¼ä¸è¶…è¿‡ Topic åˆ†åŒºæ•°ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆé€šè¿‡ &lt;code&gt;KafkaProperties&lt;/code&gt; å®ç°é…ç½®å¤–éƒ¨åŒ–ï¼Œå¢å¼ºå¯ç»´æŠ¤æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡çµæ´»é…ç½® &lt;code&gt;@KafkaListener&lt;/code&gt;ï¼Œå¼€å‘è€…å¯é«˜æ•ˆæ„å»ºé€‚åº”ä¸åŒä¸šåŠ¡éœ€æ±‚çš„ Kafka æ¶ˆè´¹è€…ç³»ç»Ÿï¼ŒåŒæ—¶ä¿éšœæ¶ˆæ¯å¤„ç†çš„å¯é æ€§ä¸æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id="ä½ç½®"&gt;ä½ç½®
&lt;/h3&gt;&lt;p&gt;åœ¨ Spring åº”ç”¨ä¸­ï¼Œ&lt;strong&gt;&lt;code&gt;@KafkaListener&lt;/code&gt; æ³¨è§£åº”æ”¾ç½®åœ¨ &lt;code&gt;@Component&lt;/code&gt;ã€&lt;code&gt;@Service&lt;/code&gt; æˆ– &lt;code&gt;@Controller&lt;/code&gt; ç­‰è¢« Spring ç®¡ç†çš„ Bean ä¸­&lt;/strong&gt;ï¼Œè€Œé &lt;code&gt;@Configuration&lt;/code&gt; ç±»ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æåŠæœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="kafkalistener"&gt;&lt;strong&gt;&lt;code&gt;@KafkaListener&lt;/code&gt; çš„é€‚ç”¨åœºæ™¯ä¸ä½ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;@KafkaListener&lt;/code&gt; æ˜¯ç”¨äºå®šä¹‰ Kafka æ¶ˆæ¯ç›‘å¬å™¨çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ–¹æ³•æ ‡è®°ä¸º Kafka æ¶ˆè´¹è€…çš„æ¶ˆæ¯å¤„ç†é€»è¾‘ã€‚æ ¹æ® Spring çš„è®¾è®¡è§„èŒƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Service&lt;/code&gt;/&lt;code&gt;@Component&lt;/code&gt;/&lt;code&gt;@Controller&lt;/code&gt; ç±»&lt;/strong&gt;ï¼š&lt;br&gt;
è¿™äº›æ³¨è§£æ˜¯ &lt;code&gt;@Component&lt;/code&gt; çš„æ´¾ç”Ÿæ³¨è§£ï¼Œç”¨äºæ ‡è¯† Spring ç®¡ç†çš„ Beanã€‚&lt;code&gt;@KafkaListener&lt;/code&gt; é€šå¸¸æ”¾åœ¨è¿™äº›ç±»çš„æˆå‘˜æ–¹æ³•ä¸Šï¼Œä»¥è¡¨ç¤ºä¸šåŠ¡é€»è¾‘çš„å…¥å£ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼ˆæ¥è‡ªç½‘é¡µ1ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;KafkaConsumerService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;my-topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;my-group&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ConsumerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†æ¶ˆæ¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;@Configuration&lt;/code&gt; ç±»&lt;/strong&gt;ï¼š&lt;br&gt;
&lt;code&gt;@Configuration&lt;/code&gt; ç”¨äºå®šä¹‰ Spring é…ç½®ç±»ï¼Œé€šå¸¸ç”¨äºæ³¨å†Œ Beanï¼ˆå¦‚æ¶ˆè´¹è€…å·¥å‚ã€çº¿ç¨‹æ± ç­‰ï¼‰ã€‚&lt;strong&gt;&lt;code&gt;@KafkaListener&lt;/code&gt; ä¸åº”ç›´æ¥æ”¾åœ¨ &lt;code&gt;@Configuration&lt;/code&gt; ç±»çš„æ–¹æ³•ä¸­&lt;/strong&gt;ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ç›‘å¬å™¨é€»è¾‘ä¸é…ç½®ä»£ç æ··æ‚ï¼Œé™ä½å¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ³¨è§£é€‰æ‹©çš„æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æ³¨è§£é€‰æ‹©çš„æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;@Service&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;br&gt;
å¦‚æœç›‘å¬å™¨é€»è¾‘å±äºä¸šåŠ¡æœåŠ¡å±‚ï¼ˆå¦‚æ¶ˆæ¯å¤„ç†ã€æ•°æ®è½¬æ¢ã€ä¸šåŠ¡è§„åˆ™æ‰§è¡Œï¼‰ï¼Œæ¨èä½¿ç”¨ &lt;code&gt;@Service&lt;/code&gt; æ³¨è§£ç±»ï¼Œä»¥æ˜ç¡®ä»£ç åˆ†å±‚ï¼ˆç½‘é¡µ4 å’Œ ç½‘é¡µ5 çš„ç¤ºä¾‹å‡é‡‡ç”¨æ­¤æ–¹å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šç”¨åœºæ™¯ä½¿ç”¨ &lt;code&gt;@Component&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥ç›‘å¬å™¨é€»è¾‘ä¸ä¸¥æ ¼å±äºæœåŠ¡å±‚ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€ç›‘æ§ç­‰ï¼‰ï¼Œå¯ä½¿ç”¨ &lt;code&gt;@Component&lt;/code&gt; ä½œä¸ºé€šç”¨æ ‡è®°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å… &lt;code&gt;@Configuration&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;br&gt;
é…ç½®ç±»åº”ä¸“æ³¨äº Bean å®šä¹‰å’Œå…¨å±€è®¾ç½®ï¼Œè€Œéå…·ä½“ä¸šåŠ¡é€»è¾‘ï¼ˆç½‘é¡µ6 ä¸­çš„ &lt;code&gt;@Configuration&lt;/code&gt; ç±»ä»…ç”¨äºé…ç½®æ¶ˆè´¹è€…å·¥å‚ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="åº•å±‚å®ç°ä¸å®¹å™¨ç®¡ç†"&gt;&lt;strong&gt;åº•å±‚å®ç°ä¸å®¹å™¨ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Spring å®¹å™¨ç®¡ç†&lt;/strong&gt;ï¼š&lt;br&gt;
&lt;code&gt;@KafkaListener&lt;/code&gt; çš„ç”Ÿæ•ˆä¾èµ–äº Spring å®¹å™¨å¯¹ Bean çš„åˆå§‹åŒ–ã€‚æ— è®ºä½¿ç”¨ &lt;code&gt;@Component&lt;/code&gt; è¿˜æ˜¯ &lt;code&gt;@Service&lt;/code&gt;ï¼ŒSpring éƒ½ä¼šåœ¨å¯åŠ¨æ—¶æ‰«æè¿™äº› Beanï¼Œå¹¶ä¸ºæ¯ä¸ª &lt;code&gt;@KafkaListener&lt;/code&gt; æ–¹æ³•åˆ›å»ºç‹¬ç«‹çš„ç›‘å¬å™¨å®¹å™¨ï¼ˆç½‘é¡µ2 æåˆ°ï¼Œé€šè¿‡ &lt;code&gt;KafkaListenerAnnotationBeanPostProcessor&lt;/code&gt; å®ç°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹ä¸å¹¶å‘æ§åˆ¶&lt;/strong&gt;ï¼š&lt;br&gt;
é€šè¿‡ &lt;code&gt;concurrency&lt;/code&gt; å‚æ•°ï¼ˆå¦‚ &lt;code&gt;@KafkaListener(concurrency = &amp;quot;3&amp;quot;)&lt;/code&gt;ï¼‰å¯æŒ‡å®šå¹¶å‘æ¶ˆè´¹è€…çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹ç”± Spring ç®¡ç†çš„å®¹å™¨å·¥å‚ï¼ˆå¦‚ &lt;code&gt;ConcurrentKafkaListenerContainerFactory&lt;/code&gt;ï¼‰è‡ªåŠ¨åˆ›å»ºï¼ˆç½‘é¡µ6ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;å¸¸è§è¯¯åŒºä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Configuration&lt;/code&gt; ç±»çš„è¯¯ç”¨&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥å°† &lt;code&gt;@KafkaListener&lt;/code&gt; æ”¾åœ¨ &lt;code&gt;@Configuration&lt;/code&gt; ç±»ä¸­ï¼Œè™½ç„¶åŠŸèƒ½ä¸Šå¯èƒ½æ­£å¸¸ï¼Œä½†ä¼šå¯¼è‡´é…ç½®ç±»èŒè´£ä¸å•ä¸€ï¼Œè¿ååˆ†å±‚è®¾è®¡åŸåˆ™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™æ€æ–¹æ³•çš„é™åˆ¶&lt;/strong&gt;ï¼š&lt;br&gt;
&lt;code&gt;@KafkaListener&lt;/code&gt; éœ€ä½œç”¨äº Bean çš„å®ä¾‹æ–¹æ³•ï¼Œ&lt;strong&gt;ä¸èƒ½ç”¨äºé™æ€æ–¹æ³•&lt;/strong&gt;ï¼ˆé™æ€æ–¹æ³•æ— æ³•è¢« Spring ä»£ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šç›‘å¬å™¨çš„ç»„ç»‡&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥éœ€å®šä¹‰å¤šä¸ªç›‘å¬å™¨ï¼Œå»ºè®®æŒ‰ä¸šåŠ¡æ¨¡å—æ‹†åˆ†åˆ°ä¸åŒçš„ &lt;code&gt;@Service&lt;/code&gt; ç±»ä¸­ï¼Œè€Œéé›†ä¸­åœ¨ä¸€ä¸ªç±»ä¸­ï¼ˆå‚è€ƒç½‘é¡µ3 åŠ¨æ€è®¢é˜… Topic çš„æ‰©å±•æ€è·¯ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€»ç»“"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¨èä½ç½®&lt;/strong&gt;ï¼š&lt;code&gt;@KafkaListener&lt;/code&gt; åº”æ”¾åœ¨ &lt;code&gt;@Service&lt;/code&gt; æˆ– &lt;code&gt;@Component&lt;/code&gt; æ³¨è§£çš„ç±»æ–¹æ³•ä¸­ï¼Œä»¥æ˜ç¡®ä¸šåŠ¡é€»è¾‘åˆ†å±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ä½ç½®&lt;/strong&gt;ï¼šä¸è¦æ”¾åœ¨ &lt;code&gt;@Configuration&lt;/code&gt; ç±»ä¸­ï¼Œå› å…¶èŒè´£æ˜¯é…ç½®è€Œéä¸šåŠ¡å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;containerFactory&lt;/code&gt; å‚æ•°å¯è‡ªå®šä¹‰ç›‘å¬å™¨å®¹å™¨é…ç½®ï¼ˆå¦‚æ‰¹é‡æ¶ˆè´¹ã€å¼‚å¸¸å¤„ç†ï¼‰ï¼Œä½†å·¥å‚é…ç½®æœ¬èº«åº”å®šä¹‰åœ¨ &lt;code&gt;@Configuration&lt;/code&gt; ç±»ä¸­ï¼ˆç½‘é¡µ6ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="kafka-æ‰¹å¤„ç†"&gt;Kafka æ‰¹å¤„ç†
&lt;/h2&gt;&lt;h3 id="producer"&gt;Producer
&lt;/h3&gt;&lt;p&gt;Kafka Producer ç«¯çš„æ‰¹å¤„ç†æœºåˆ¶å¹¶éç›´æ¥ç”± &lt;code&gt;kafkaTemplate.send()&lt;/code&gt; æ–¹æ³•è§¦å‘ï¼Œè€Œæ˜¯é€šè¿‡ &lt;strong&gt;Kafka å®¢æˆ·ç«¯åº•å±‚çš„å†…å­˜æ± å’Œå¼‚æ­¥å‘é€æœºåˆ¶&lt;/strong&gt; å®ç°ã€‚ä»¥ä¸‹æ˜¯å…³é”®åŸç†å’Œå®ç°ç»†èŠ‚ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="kafkatemplatesend-çš„ä½œç”¨"&gt;&lt;code&gt;kafkaTemplate.send()&lt;/code&gt; çš„ä½œç”¨
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;kafkaTemplate.send()&lt;/code&gt; æ˜¯ Spring Kafka å¯¹åŸç”Ÿ Kafka Producer çš„å°è£…æ–¹æ³•ï¼Œç”¨äº&lt;strong&gt;å•æ¡æ¶ˆæ¯çš„å¼‚æ­¥å‘é€&lt;/strong&gt;ã€‚å…¶åº•å±‚é€»è¾‘æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯æš‚å­˜&lt;/strong&gt;ï¼šè°ƒç”¨ &lt;code&gt;send()&lt;/code&gt; æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«å†™å…¥ Producer çš„æœ¬åœ°ç¼“å†²åŒºï¼ˆRecordAccumulatorï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹æ¬¡åˆå¹¶&lt;/strong&gt;ï¼šç¼“å†²åŒºæ ¹æ® &lt;code&gt;batch.size&lt;/code&gt; å’Œ &lt;code&gt;linger.ms&lt;/code&gt; å‚æ•°ï¼Œå°†å¤šä¸ªæ¶ˆæ¯åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œå‘é€&lt;/strong&gt;ï¼šåå°çš„ Sender çº¿ç¨‹è´Ÿè´£å°†æ‰¹æ¬¡æ¶ˆæ¯é€šè¿‡ç½‘ç»œå‘é€åˆ° Kafka Brokerã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="æ‰¹å¤„ç†çš„æ ¸å¿ƒè§¦å‘æ¡ä»¶"&gt;æ‰¹å¤„ç†çš„æ ¸å¿ƒè§¦å‘æ¡ä»¶
&lt;/h4&gt;&lt;p&gt;æ‰¹å¤„ç†çš„è§¦å‘ç”±ä»¥ä¸‹é…ç½®å‚æ•°æ§åˆ¶ï¼Œè€Œé &lt;code&gt;send()&lt;/code&gt; æ–¹æ³•æœ¬èº«ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;batch.size&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰å•ä¸ªæ‰¹æ¬¡çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆé»˜è®¤ 16KBï¼‰ã€‚å½“ç¼“å†²åŒºä¸­åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯è¾¾åˆ°æ­¤é˜ˆå€¼æ—¶ï¼Œç«‹å³å‘é€æ‰¹æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹é…ç½®ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;BATCH_SIZE_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;16384&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 16KB&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;linger.ms&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¹æ¬¡ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ 0msï¼‰ã€‚è‹¥æœªè¾¾åˆ° &lt;code&gt;batch.size&lt;/code&gt;ï¼Œç­‰å¾…æ­¤æ—¶é—´åå¼ºåˆ¶å‘é€æ‰¹æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹é…ç½®ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LINGER_MS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç­‰å¾…5ms&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="å®é™…æ‰¹å¤„ç†æµç¨‹"&gt;å®é™…æ‰¹å¤„ç†æµç¨‹
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯å†™å…¥ç¼“å†²åŒº&lt;/strong&gt;&lt;br&gt;
æ¯æ¬¡è°ƒç”¨ &lt;code&gt;kafkaTemplate.send()&lt;/code&gt; ä¼šå°†æ¶ˆæ¯å†™å…¥å¯¹åº”åˆ†åŒºçš„å†…å­˜ç¼“å†²åŒºï¼ˆRecordAccumulatorï¼‰ï¼Œæ­¤æ—¶æ¶ˆæ¯å°šæœªå‘é€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹æ¬¡åˆå¹¶é€»è¾‘&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯åœ¨ç¼“å†²åŒºä¸­æŒ‰é¡ºåºåˆå¹¶ä¸ºæ‰¹æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;å½“æ»¡è¶³ &lt;code&gt;batch.size&lt;/code&gt; æˆ– &lt;code&gt;linger.ms&lt;/code&gt; ä»»ä¸€æ¡ä»¶æ—¶ï¼Œè§¦å‘æ‰¹æ¬¡å‘é€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sender çº¿ç¨‹å¼‚æ­¥å‘é€&lt;/strong&gt;&lt;br&gt;
åå°å•çº¿ç¨‹ï¼ˆSenderï¼‰è´Ÿè´£ä»ç¼“å†²åŒºæ‹‰å–æ‰¹æ¬¡æ¶ˆæ¯ï¼Œé€šè¿‡ç½‘ç»œå‘é€åˆ° Brokerã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="spring-kafka-ä¸­çš„æ‰¹å¤„ç†éªŒè¯"&gt;Spring Kafka ä¸­çš„æ‰¹å¤„ç†éªŒè¯
&lt;/h4&gt;&lt;p&gt;åœ¨ Spring Boot ä¸­ï¼Œå³ä½¿è°ƒç”¨å¤šæ¬¡ &lt;code&gt;kafkaTemplate.send()&lt;/code&gt;ï¼Œåº•å±‚ä»ä¼šé€šè¿‡é…ç½®å‚æ•°å®ç°æ‰¹å¤„ç†ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è¿ç»­å‘é€3æ¡æ¶ˆæ¯ï¼ˆå¯èƒ½åˆå¹¶ä¸º1ä¸ªæ‰¹æ¬¡ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;kafkaTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;kafkaTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value2&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;kafkaTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key3&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value3&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‹¥ &lt;code&gt;linger.ms=5&lt;/code&gt; ä¸”æ¶ˆæ¯é‡æœªè¾¾ &lt;code&gt;batch.size&lt;/code&gt;ï¼Œåˆ™ 5ms åæ‰€æœ‰æ¶ˆæ¯ä»¥å•ä¸ªæ‰¹æ¬¡å‘é€ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="æ³¨æ„äº‹é¡¹"&gt;æ³¨æ„äº‹é¡¹
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥å‘é€åœºæ™¯&lt;/strong&gt;&lt;br&gt;
è‹¥åœ¨ &lt;code&gt;send()&lt;/code&gt; åç«‹å³è°ƒç”¨ &lt;code&gt;.get()&lt;/code&gt;ï¼ˆåŒæ­¥ç­‰å¾…å“åº”ï¼‰ï¼Œä¼šå¼ºåˆ¶åˆ·æ–°ç¼“å†²åŒºï¼Œç ´åæ‰¹å¤„ç†æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜ç®¡ç†&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ &lt;code&gt;buffer.memory&lt;/code&gt; æ§åˆ¶æ€»ç¼“å†²åŒºå¤§å°ï¼ˆé»˜è®¤ 32MBï¼‰ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†åŒºè´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;br&gt;
åŒä¸€æ‰¹æ¬¡ä»…åŒ…å«åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯ï¼Œéœ€åˆç†è®¾è®¡åˆ†åŒºç­–ç•¥ï¼ˆå¦‚ Key å“ˆå¸Œï¼‰ä»¥å‡åŒ€åˆ†é…è´Ÿè½½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="æ€»ç»“-1"&gt;æ€»ç»“
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;kafkaTemplate.send()&lt;/code&gt; æ˜¯æ¶ˆæ¯å‘é€çš„å…¥å£æ–¹æ³•ï¼Œä½†æ‰¹å¤„ç†çš„å®é™…è§¦å‘ç”± &lt;code&gt;batch.size&lt;/code&gt; å’Œ &lt;code&gt;linger.ms&lt;/code&gt; å‚æ•°æ§åˆ¶ã€‚å¼€å‘è€…é€šè¿‡è°ƒæ•´è¿™äº›å‚æ•°ï¼Œå¯åœ¨ååé‡å’Œå»¶è¿Ÿä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ã€‚&lt;/p&gt;
&lt;h4 id="ç”Ÿäº§è€…æ‰¹é‡å¤„ç†"&gt;ç”Ÿäº§è€…æ‰¹é‡å¤„ç†
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡å‘é€æœºåˆ¶&lt;/strong&gt;&lt;br&gt;
Kafka ç”Ÿäº§è€…é»˜è®¤é‡‡ç”¨æ‰¹é‡å‘é€ç­–ç•¥ã€‚æ¶ˆæ¯ä¸ä¼šç«‹å³å‘é€ï¼Œè€Œæ˜¯å…ˆç¼“å­˜åœ¨æœ¬åœ°ç¼“å†²åŒºï¼Œå½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶è§¦å‘æ‰¹é‡å‘é€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;batch.size&lt;/code&gt;&lt;/strong&gt;ï¼šå•æ‰¹æ¬¡æœ€å¤§å­—èŠ‚æ•°ï¼ˆé»˜è®¤ 16KBï¼‰ï¼Œå½“ç¼“å†²åŒºæ•°æ®è¾¾åˆ°é˜ˆå€¼æ—¶å‘é€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;linger.ms&lt;/code&gt;&lt;/strong&gt;ï¼šç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ 0msï¼‰ï¼Œè‹¥æœªè¾¾åˆ° &lt;code&gt;batch.size&lt;/code&gt;ï¼Œç­‰å¾…è¯¥æ—¶é—´åå¼ºåˆ¶å‘é€ã€‚&lt;br&gt;
ç¤ºä¾‹é…ç½®ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;batch.size&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;16384&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 16KB&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;linger.ms&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç­‰å¾…5ms&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å†²åŒºå¤§å°&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;buffer.memory&lt;/code&gt;ï¼ˆé»˜è®¤ 32MBï¼‰æ§åˆ¶ç”Ÿäº§è€…å†…å­˜ç¼“å†²åŒºä¸Šé™ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹ç¼©ä¼˜åŒ–&lt;/strong&gt;ï¼šå¯ç”¨ &lt;code&gt;compression.type&lt;/code&gt;ï¼ˆå¦‚ gzipã€snappyï¼‰å¯¹æ‰¹æ¬¡æ¶ˆæ¯å‹ç¼©ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;compression.type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;gzip&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼€å¯å‹ç¼©&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="receiver"&gt;Receiver
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰¹é‡æ‹‰å–é…ç½®&lt;/strong&gt;&lt;br&gt;
æ¶ˆè´¹è€…é€šè¿‡ä»¥ä¸‹å‚æ•°æ§åˆ¶æ‰¹é‡æ‹‰å–è¡Œä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;max.poll.records&lt;/code&gt;&lt;/strong&gt;ï¼šå•æ¬¡æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼ˆé»˜è®¤ 500ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;fetch.min.bytes&lt;/code&gt;&lt;/strong&gt;ï¼šå•æ¬¡æ‹‰å–çš„æœ€å°å­—èŠ‚æ•°ï¼ˆé»˜è®¤ 1ï¼‰ï¼ŒBroker ç­‰å¾…æ•°æ®è¾¾åˆ°é˜ˆå€¼åå†å“åº”ã€‚&lt;br&gt;
ç¤ºä¾‹é…ç½®ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;max.poll.records&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å•æ¬¡æ‹‰å–1000æ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;fetch.min.bytes&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10240&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡³å°‘10KBæ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Spring é›†æˆæ‰¹é‡æ¶ˆè´¹&lt;/strong&gt;&lt;br&gt;
åœ¨ Spring Boot ä¸­ï¼Œé€šè¿‡ &lt;code&gt;@KafkaListener&lt;/code&gt; å®ç°æ‰¹é‡å¤„ç†éœ€ä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨æ‰¹é‡ç›‘å¬å™¨å·¥å‚&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Bean&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentKafkaListenerContainerFactory&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchFactory&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentKafkaListenerContainerFactory&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConcurrentKafkaListenerContainerFactory&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setBatchListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼€å¯æ‰¹é‡æ¨¡å¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;factory&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ¶ˆè´¹æ–¹æ³•&lt;/strong&gt;ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;big_data_topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;containerFactory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;batchFactory&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchProcess&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ConsumerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="æ‰¹é‡å¤„ç†çš„æ€§èƒ½ä¼˜åŒ–å®è·µ"&gt;æ‰¹é‡å¤„ç†çš„æ€§èƒ½ä¼˜åŒ–å®è·µ
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•°è°ƒä¼˜å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§è€…&lt;/strong&gt;ï¼šæ ¹æ®ç½‘ç»œå¸¦å®½å’Œæ¶ˆæ¯å¤§å°è°ƒæ•´ &lt;code&gt;batch.size&lt;/code&gt;ï¼ˆå¦‚ 64KB&lt;del&gt;1MBï¼‰ï¼Œ&lt;code&gt;linger.ms&lt;/code&gt; è®¾ä¸º 10&lt;/del&gt;100ms å¹³è¡¡å»¶è¿Ÿä¸ååã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…&lt;/strong&gt;ï¼šå¢å¤§ &lt;code&gt;max.poll.records&lt;/code&gt;ï¼ˆå¦‚ 1000~5000ï¼‰å’Œ &lt;code&gt;fetch.min.bytes&lt;/code&gt;ï¼ˆå¦‚ 1MBï¼‰ä»¥æå‡å•æ¬¡å¤„ç†é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¹¶å‘ä¸åˆ†åŒºè®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†åŒºæ•°&lt;/strong&gt;ï¼šTopic åˆ†åŒºæ•°å†³å®šæ¶ˆè´¹è€…æœ€å¤§å¹¶å‘åº¦ã€‚ä¾‹å¦‚ï¼Œåˆ†åŒºæ•°ä¸º 10 æ—¶æœ€å¤šå¯åŠ¨ 10 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•&lt;/strong&gt;ï¼šé¢„å…ˆè®¾ç½®è¶…é¢åˆ†åŒºï¼ˆå¦‚éœ€æ±‚ 20 åˆ†åŒºæ—¶é…ç½® 30ï¼‰ï¼Œä¸ºæµé‡çªå¢é¢„ç•™æ‰©å±•ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é‡è¯•æœºåˆ¶&lt;/strong&gt;ï¼šç”Ÿäº§è€…é…ç½® &lt;code&gt;retries&lt;/code&gt;ï¼ˆå¦‚ 3ï¼‰å’Œ &lt;code&gt;retry.backoff.ms&lt;/code&gt; åº”å¯¹ç¬æ—¶æ•…éšœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ï¼šå¯ç”¨ &lt;code&gt;enable.idempotence=true&lt;/code&gt; é¿å…é‡å¤æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="å…¸å‹åº”ç”¨åœºæ™¯"&gt;å…¸å‹åº”ç”¨åœºæ™¯
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—é‡‡é›†&lt;/strong&gt;&lt;br&gt;
æ—¥å¿—æ•°æ®é€šè¿‡æ‰¹é‡å‹ç¼©å‘é€ï¼Œé™ä½ç½‘ç»œè´Ÿè½½ï¼Œæ¶ˆè´¹è€…æ‰¹é‡å†™å…¥ HDFS æˆ– Elasticsearchã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®æ—¶æ•°ä»“&lt;/strong&gt;&lt;br&gt;
åƒä¸‡çº§è®¢å•æ•°æ®é€šè¿‡ Spring Batch åˆ†åŒºåæ‰¹é‡æ¨é€è‡³ Kafkaï¼Œæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†å¹¶è½åº“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æµå¼è®¡ç®—&lt;/strong&gt;&lt;br&gt;
Flink/Kafka Streams ä» Kafka æ‰¹é‡æ‹‰å–æ•°æ®ï¼Œçª—å£èšåˆåè¾“å‡ºç»“æœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Kafka çš„æ‰¹é‡å¤„ç†é€šè¿‡ç”Ÿäº§è€…ç¼“å­˜ã€Broker æ‰¹æŒä¹…åŒ–ã€æ¶ˆè´¹è€…æ‰¹é‡æ‹‰å–ä¸‰å±‚æœºåˆ¶å®ç°é«˜ååã€‚åœ¨ Spring ç”Ÿæ€ä¸­ï¼Œéœ€ç»“åˆ &lt;code&gt;@KafkaListener&lt;/code&gt; çš„æ‰¹é‡ç›‘å¬å™¨å·¥å‚å’Œå‚æ•°è°ƒä¼˜ï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚å®é™…åº”ç”¨ä¸­éœ€æ ¹æ®æ•°æ®é‡ã€å»¶è¿Ÿè¦æ±‚åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°ä¸å¹¶å‘åº¦ï¼Œå¹³è¡¡æ€§èƒ½ä¸ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;h2 id="kafka-enum"&gt;Kafka Enum
&lt;/h2&gt;&lt;h3 id="key-ä¸º-longvalue-ä¸º-enumbyte-çš„é«˜æ•ˆåºåˆ—åŒ–æ–¹æ¡ˆ"&gt;Key ä¸º Longã€Value ä¸º Enum/Byte çš„é«˜æ•ˆåºåˆ—åŒ–æ–¹æ¡ˆ
&lt;/h3&gt;&lt;p&gt;åœ¨ Kafka ä¸­ï¼Œé’ˆå¯¹ &lt;strong&gt;Key ä¸º Long ç±»å‹&lt;/strong&gt;ã€&lt;strong&gt;Value ä¸º Enum æˆ– Byte ç±»å‹&lt;/strong&gt;çš„åœºæ™¯ï¼Œéœ€æ ¹æ®æ•°æ®ç±»å‹ç‰¹æ€§é€‰æ‹©åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ï¼Œä»¥å…¼é¡¾æ•ˆç‡ä¸èµ„æºå ç”¨ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å»ºè®®åŠä¼˜åŒ–ç­–ç•¥ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="keylong-ç±»å‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"&gt;&lt;strong&gt;Keyï¼ˆLong ç±»å‹ï¼‰çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†…ç½®åºåˆ—åŒ–å™¨&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å™¨&lt;/strong&gt;ï¼š&lt;code&gt;LongSerializer&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥å¯¹ Long ç±»å‹è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ï¼Œæ— éœ€é¢å¤–è½¬æ¢ï¼Œæ€§èƒ½æœ€ä¼˜ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹é…ç½®ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;KEY_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.apache.kafka.common.serialization.LongSerializer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååºåˆ—åŒ–å™¨&lt;/strong&gt;ï¼š&lt;code&gt;LongDeserializer&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ &lt;code&gt;LongSerializer&lt;/code&gt; ä¸¥æ ¼å¯¹åº”ï¼Œä¿è¯äºŒè¿›åˆ¶æ•°æ®è¿˜åŸä¸ºåŸå§‹ Long å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="valueenum-ç±»å‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"&gt;&lt;strong&gt;Valueï¼ˆEnum ç±»å‹ï¼‰çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Enum ç±»å‹éœ€æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å†…ç½®åºåˆ—åŒ–å™¨ï¼ˆæ¨èï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;ï¼šå°† Enum è½¬æ¢ä¸ºæ•´æ•°æˆ–å­—ç¬¦ä¸²ï¼Œå†åˆ©ç”¨ç°æœ‰åºåˆ—åŒ–å™¨å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å™¨é€‰æ‹©&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•´æ•°æ˜ å°„&lt;/strong&gt;ï¼š&lt;code&gt;IntegerSerializer&lt;/code&gt; æˆ– &lt;code&gt;ShortSerializer&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;Enum.ordinal()&lt;/code&gt; æ–¹æ³•å°†æšä¸¾å€¼æ˜ å°„ä¸ºæ•´æ•°ï¼ˆå¦‚ &lt;code&gt;0,1,2,...&lt;/code&gt;ï¼‰ï¼Œé€‚åˆæšä¸¾å€¼æ•°é‡è¾ƒå°‘ï¼ˆå¦‚ â‰¤ 256ï¼‰çš„åœºæ™¯ï¼ŒèŠ‚çœç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦ä¸²æ˜ å°„&lt;/strong&gt;ï¼š&lt;code&gt;StringSerializer&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;Enum.name()&lt;/code&gt; æ–¹æ³•è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå¯è¯»æ€§å¼ºä½†å ç”¨æ›´å¤šå­—èŠ‚ï¼ˆå¦‚ &lt;code&gt;&amp;quot;RED&amp;quot;&lt;/code&gt; æ¯” &lt;code&gt;0&lt;/code&gt; å¤š 2 å­—èŠ‚ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼ˆæ•´æ•°æ˜ å°„ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GREEN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BLUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// ç”Ÿäº§è€…åºåˆ—åŒ–ï¼ˆå‡è®¾ä½¿ç”¨ Integerï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;VALUE_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.apache.kafka.common.serialization.IntegerSerializer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ordinal&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// æ¶ˆè´¹è€…ååºåˆ—åŒ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ConsumerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;values&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼šè‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼ˆé«˜æ•ˆä½†å¤æ‚ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šéœ€ç›´æ¥å­˜å‚¨ Enum çš„äºŒè¿›åˆ¶å€¼ï¼ˆå¦‚å•å­—èŠ‚ï¼‰ï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ç°æ­¥éª¤&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å™¨&lt;/strong&gt;ï¼šå°† Enum è½¬æ¢ä¸ºå•å­—èŠ‚ï¼ˆéœ€ç¡®ä¿æšä¸¾æ•°é‡ â‰¤ 256ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;EnumSerializer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Serializer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;serialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ordinal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååºåˆ—åŒ–å™¨&lt;/strong&gt;ï¼šå°†å­—èŠ‚è¿˜åŸä¸º Enumï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;EnumDeserializer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Deserializer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;deserialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;values&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šå•å­—èŠ‚å­˜å‚¨ï¼Œç©ºé—´åˆ©ç”¨ç‡æœ€é«˜ï¼›ç›´æ¥æ“ä½œå­—èŠ‚æ•°ç»„ï¼Œæ—  JSON/å­—ç¬¦ä¸²è§£æå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šéœ€ç»´æŠ¤è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘ï¼Œæ‰©å±•æ€§è¾ƒå·®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="valuebyte-ç±»å‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"&gt;&lt;strong&gt;Valueï¼ˆByte ç±»å‹ï¼‰çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…ç½®åºåˆ—åŒ–å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å™¨&lt;/strong&gt;ï¼š&lt;code&gt;ByteArraySerializer&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥å­˜å‚¨åŸå§‹å­—èŠ‚æ•°ç»„ï¼Œæ— éœ€è½¬æ¢ï¼Œé€‚ç”¨äºäºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€æ–‡ä»¶ç‰‡æ®µï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç¤ºä¾‹é…ç½®ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;VALUE_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.apache.kafka.common.serialization.ByteArraySerializer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byteValue&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååºåˆ—åŒ–å™¨&lt;/strong&gt;ï¼š&lt;code&gt;ByteArrayDeserializer&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥è¿”å›æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ç»„ï¼Œç”±ä¸šåŠ¡ä»£ç è¿›ä¸€æ­¥å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŒ–å»ºè®®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•å­—èŠ‚ä¼˜åŒ–&lt;/strong&gt;ï¼šè‹¥ä»…éœ€ä¼ è¾“å•ä¸ªå­—èŠ‚ï¼Œå¯å¤ç”¨ &lt;code&gt;ByteArraySerializer&lt;/code&gt;ï¼Œä½†éœ€ç¡®ä¿æ•°æ®é•¿åº¦ä¸º 1ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byteValue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0xFF&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®"&gt;æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ•°æ®ç±»å‹&lt;/th&gt;
&lt;th&gt;åºåˆ—åŒ–æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;ç©ºé—´å ç”¨&lt;/th&gt;
&lt;th&gt;åºåˆ—åŒ–é€Ÿåº¦&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Long&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;LongSerializer&lt;/td&gt;
&lt;td&gt;8 å­—èŠ‚&lt;/td&gt;
&lt;td&gt;æœ€å¿«&lt;/td&gt;
&lt;td&gt;é»˜è®¤æ–¹æ¡ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Enum&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;IntegerSerializer + æ˜ å°„&lt;/td&gt;
&lt;td&gt;4 å­—èŠ‚&lt;/td&gt;
&lt;td&gt;å¿«&lt;/td&gt;
&lt;td&gt;æšä¸¾å€¼æ•°é‡å°‘ï¼ˆâ‰¤ 256ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Enum&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰å•å­—èŠ‚åºåˆ—åŒ–å™¨&lt;/td&gt;
&lt;td&gt;1 å­—èŠ‚&lt;/td&gt;
&lt;td&gt;æœ€å¿«&lt;/td&gt;
&lt;td&gt;é«˜é¢‘ä¼ è¾“ã€æä½å»¶è¿Ÿéœ€æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Enum&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;StringSerializer&lt;/td&gt;
&lt;td&gt;å˜é•¿&lt;/td&gt;
&lt;td&gt;è¾ƒæ…¢&lt;/td&gt;
&lt;td&gt;éœ€å¯è¯»æ€§ã€è°ƒè¯•å‹å¥½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Byte&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ByteArraySerializer&lt;/td&gt;
&lt;td&gt;å˜é•¿&lt;/td&gt;
&lt;td&gt;æœ€å¿«&lt;/td&gt;
&lt;td&gt;äºŒè¿›åˆ¶æ•°æ®æˆ–å•å­—èŠ‚ä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èä¼˜å…ˆçº§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Keyï¼ˆLongï¼‰&lt;/strong&gt;ï¼šå¿…é€‰ &lt;code&gt;LongSerializer&lt;/code&gt; + &lt;code&gt;LongDeserializer&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Valueï¼ˆEnumï¼‰&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;æ•´æ•°æ˜ å°„æ–¹æ¡ˆ&lt;/strong&gt;ï¼ˆ&lt;code&gt;IntegerSerializer&lt;/code&gt;ï¼‰ï¼Œé«˜é¢‘åœºæ™¯é€‰æ‹© &lt;strong&gt;è‡ªå®šä¹‰å•å­—èŠ‚åºåˆ—åŒ–å™¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Valueï¼ˆByteï¼‰&lt;/strong&gt;ï¼šå¿…é€‰ &lt;code&gt;ByteArraySerializer&lt;/code&gt; + &lt;code&gt;ByteArrayDeserializer&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="é…ç½®ç¤ºä¾‹"&gt;é…ç½®ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç”Ÿäº§è€…é…ç½®ï¼ˆKey=Long, Value=Enumï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ä½¿ç”¨ Integer æ˜ å°„ Enum&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Properties&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Properties&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;kafka:9092&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;KEY_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.apache.kafka.common.serialization.LongSerializer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ProducerConfig&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;VALUE_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.apache.kafka.common.serialization.IntegerSerializer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Producer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;producer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;KafkaProducer&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;props&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;producer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProducerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;12345L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;RED&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ordinal&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹è€…é…ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@KafkaListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;group&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ConsumerRecord&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;key&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;values&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Key ä¸º Long&lt;/strong&gt;ï¼šç›´æ¥ä½¿ç”¨å†…ç½® &lt;code&gt;LongSerializer&lt;/code&gt;ï¼Œæ— æ€§èƒ½æŸè€—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Value ä¸º Enum&lt;/strong&gt;ï¼šæ ¹æ®æ€§èƒ½ä¸å¯è¯»æ€§éœ€æ±‚é€‰æ‹©æ•´æ•°æ˜ å°„æˆ–è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œå•å­—èŠ‚æ–¹æ¡ˆæœ€ä¼˜ä½†éœ€ç»´æŠ¤é¢å¤–ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Value ä¸º Byte&lt;/strong&gt;ï¼šä¼˜å…ˆä½¿ç”¨ &lt;code&gt;ByteArraySerializer&lt;/code&gt;ï¼Œå¤©ç„¶æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ã€‚&lt;br&gt;
é€šè¿‡åˆç†é€‰å‹ï¼Œå¯åœ¨ä¿è¯é«˜æ•ˆä¼ è¾“çš„åŒæ—¶ï¼Œé™ä½åºåˆ—åŒ–å¼€é”€ä¸å­˜å‚¨æˆæœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="enum--ordinal"&gt;Enum &amp;amp; Ordinal
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œ&lt;strong&gt;é€šè¿‡ &lt;code&gt;ordinal&lt;/code&gt; æ„é€ æšä¸¾ï¼ˆEnumï¼‰&lt;/strong&gt; çš„æ ¸å¿ƒæ€è·¯æ˜¯å€ŸåŠ©æšä¸¾ç±»è‡ªåŠ¨ç”Ÿæˆçš„ &lt;code&gt;values()&lt;/code&gt; æ–¹æ³•è·å–æ‰€æœ‰æšä¸¾å¸¸é‡çš„æ•°ç»„ï¼Œå†é€šè¿‡ &lt;code&gt;ordinal&lt;/code&gt; çš„ç´¢å¼•å€¼å®šä½åˆ°å…·ä½“çš„æšä¸¾å®ä¾‹ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æ–¹æ³•"&gt;å®ç°æ–¹æ³•
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;values()&lt;/code&gt; æ–¹æ³•&lt;/strong&gt;&lt;br&gt;
Java ç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªæšä¸¾ç±»è‡ªåŠ¨ç”Ÿæˆ &lt;code&gt;values()&lt;/code&gt; æ–¹æ³•ï¼Œè¿”å›æ‰€æœ‰æšä¸¾å¸¸é‡çš„æ•°ç»„ã€‚é€šè¿‡ &lt;code&gt;ordinal&lt;/code&gt; å€¼ï¼ˆå³æ•°ç»„ä¸‹æ ‡ï¼‰å¯ä»¥ç›´æ¥è·å–å¯¹åº”çš„æšä¸¾å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Season&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SPRING&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SUMMER&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AUTUMN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WINTER&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Season&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fromOrdinal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Invalid ordinal: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ƒç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Season&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spring&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Season&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromOrdinal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å› Season.SPRING&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰å·¥å…·æ–¹æ³•&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€å¤ç”¨é€»è¾‘ï¼Œå¯å°è£…ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼ˆéœ€æ³¨æ„æšä¸¾ç±»å‹çš„æ³›å‹ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Enum&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getEnumByOrdinal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Class&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enumClass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enumClass&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getEnumConstants&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Invalid ordinal for &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enumClass&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSimpleName&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ƒç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Season&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;autumn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;getEnumByOrdinal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Season&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å› Season.AUTUMN&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ordinal&lt;/code&gt; çš„ä¸å¯é æ€§&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ordinal&lt;/code&gt; çš„å€¼åŸºäºæšä¸¾å¸¸é‡çš„å£°æ˜é¡ºåºï¼ˆä» 0 å¼€å§‹ï¼‰ï¼Œè‹¥æšä¸¾å£°æ˜é¡ºåºå‘ç”Ÿå˜åŠ¨ï¼ˆå¦‚æ–°å¢æˆ–è°ƒæ•´å¸¸é‡ä½ç½®ï¼‰ï¼Œ&lt;code&gt;ordinal&lt;/code&gt; å€¼ä¼šæ”¹å˜ï¼Œå¯¼è‡´åŸæœ‰é€»è¾‘å‡ºé”™ã€‚å› æ­¤ï¼Œ&lt;strong&gt;å®˜æ–¹å»ºè®®é¿å…ä¾èµ– &lt;code&gt;ordinal&lt;/code&gt;&lt;/strong&gt;ï¼Œä¼˜å…ˆä½¿ç”¨ &lt;code&gt;name()&lt;/code&gt; æˆ–è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚ &lt;code&gt;code&lt;/code&gt;ï¼‰æ ‡è¯†æšä¸¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåŠ¨ç”Ÿæˆçš„ &lt;code&gt;values()&lt;/code&gt; æ–¹æ³•&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;values()&lt;/code&gt; æ˜¯ç¼–è¯‘å™¨ä¸ºæšä¸¾ç”Ÿæˆçš„é™æ€æ–¹æ³•ï¼Œè¿”å›æ‰€æœ‰æšä¸¾å®ä¾‹çš„æ•°ç»„ã€‚å®ƒä¸ç»§æ‰¿è‡ª &lt;code&gt;Enum&lt;/code&gt; ç±»ï¼Œè€Œæ˜¯æ¯ä¸ªæšä¸¾ç±»çš„ç‰¹æœ‰æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;br&gt;
éœ€æ ¡éªŒ &lt;code&gt;ordinal&lt;/code&gt; çš„åˆæ³•æ€§ï¼Œé˜²æ­¢æ•°ç»„è¶Šç•Œå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;||&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ordinal&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ›¿ä»£æ–¹æ¡ˆæ¨è"&gt;æ›¿ä»£æ–¹æ¡ˆï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;è‹¥éœ€ç¨³å®šæ ‡è¯†æšä¸¾ï¼Œå»ºè®®ä½¿ç”¨&lt;strong&gt;è‡ªå®šä¹‰å­—æ®µ&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;int code&lt;/code&gt;ï¼‰è€Œé &lt;code&gt;ordinal&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;200&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NOT_FOUND&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;404&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SERVER_ERROR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fromCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Invalid code: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è°ƒç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ok&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HttpStatus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;fromCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;200&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é€šè¿‡è‡ªå®šä¹‰å­—æ®µè·å–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä»…åœ¨æšä¸¾é¡ºåºå›ºå®šä¸”æ— éœ€ç»´æŠ¤æ—¶ï¼Œæ‰æ¨èé€šè¿‡ &lt;code&gt;ordinal&lt;/code&gt; æ„é€ æšä¸¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šä¼˜å…ˆé€šè¿‡è‡ªå®šä¹‰å­—æ®µæˆ– &lt;code&gt;name()&lt;/code&gt; æ–¹æ³•æ ‡è¯†æšä¸¾ï¼Œé¿å…ç›´æ¥ä¾èµ– &lt;code&gt;ordinal&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å¿ƒæ–¹æ³•&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;values()[ordinal]&lt;/code&gt; æˆ–å·¥å…·ç±»å°è£…å®ç°æŒ‰ &lt;code&gt;ordinal&lt;/code&gt; è·å–æšä¸¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Java ä¸­ï¼Œ&lt;strong&gt;æ–°å¢æšä¸¾å¸¸é‡ä¼šå¯¼è‡´åŸæœ‰æšä¸¾å¸¸é‡çš„ &lt;code&gt;ordinal&lt;/code&gt; å€¼å‘ç”Ÿå˜åŒ–&lt;/strong&gt;ï¼Œå…·ä½“å–å†³äºæ–°å¢å¸¸é‡çš„ä½ç½®ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜å’Œæ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ordinal-çš„ç‰¹æ€§"&gt;&lt;code&gt;ordinal&lt;/code&gt; çš„ç‰¹æ€§
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ordinal&lt;/code&gt; çš„ç”Ÿæˆè§„åˆ™&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ordinal&lt;/code&gt; è¡¨ç¤ºæšä¸¾å¸¸é‡åœ¨å£°æ˜æ—¶çš„é¡ºåºç´¢å¼•ï¼Œä» 0 å¼€å§‹é€’å¢ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FAILED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SUCCESS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// FAILED.ordinal()=0ï¼ŒSUCCESS.ordinal()=1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–°å¢æšä¸¾å¸¸é‡å¯¹ &lt;code&gt;ordinal&lt;/code&gt; çš„å½±å“&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‹¥åœ¨ç°æœ‰å¸¸é‡ä¹‹é—´æ’å…¥æ–°å¸¸é‡&lt;/strong&gt;ï¼šåŸæœ‰å¸¸é‡çš„ &lt;code&gt;ordinal&lt;/code&gt; ä¼šé‡æ–°æ’åˆ—ã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FAILED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DOING&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SUCCESS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// SUCCESS.ordinal() ä» 1 å˜ä¸º 2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‹¥åœ¨æœ«å°¾è¿½åŠ æ–°å¸¸é‡&lt;/strong&gt;ï¼šåŸæœ‰å¸¸é‡çš„ &lt;code&gt;ordinal&lt;/code&gt; ä¸å˜ï¼Œä½†æ–°å¢å¸¸é‡çš„ &lt;code&gt;ordinal&lt;/code&gt; æŒ‰é¡ºåºé€’å¢ã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FAILED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SUCCESS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PENDING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// PENDING.ordinal()=2ï¼ŒåŸæœ‰å€¼ä¸å˜&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ é™¤æˆ–è°ƒæ•´é¡ºåºçš„å½±å“&lt;/strong&gt;&lt;br&gt;
åˆ é™¤æˆ–è°ƒæ•´æšä¸¾å¸¸é‡çš„å£°æ˜é¡ºåºï¼ŒåŒæ ·ä¼šå¯¼è‡´ &lt;code&gt;ordinal&lt;/code&gt; çš„å…¨å±€å˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ºä½•åº”é¿å…ä¾èµ–-ordinal"&gt;ä¸ºä½•åº”é¿å…ä¾èµ– &lt;code&gt;ordinal&lt;/code&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡é€»è¾‘çš„éšè”½é£é™©&lt;/strong&gt;&lt;br&gt;
å¦‚æœä»£ç ä¸­ç›´æ¥ä¾èµ– &lt;code&gt;ordinal&lt;/code&gt;ï¼Œå½“æšä¸¾å£°æ˜é¡ºåºè°ƒæ•´æ—¶ï¼Œå¯èƒ½å¯¼è‡´åŸæœ‰é€»è¾‘é”™è¯¯ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸæœ¬ &lt;code&gt;of(1)&lt;/code&gt; è¿”å› &lt;code&gt;SUCCESS&lt;/code&gt;ï¼Œä½†æ’å…¥æ–°å¸¸é‡åå¯èƒ½è¿”å› &lt;code&gt;DOING&lt;/code&gt;ï¼Œå¼•å‘ä¸šåŠ¡å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®˜æ–¹å»ºè®®&lt;/strong&gt;&lt;br&gt;
ã€ŠEffective Javaã€‹æ˜ç¡®å»ºè®®ï¼š&lt;strong&gt;ä¸è¦ä½¿ç”¨ &lt;code&gt;ordinal()&lt;/code&gt; ç»´æŠ¤ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;ï¼Œè€Œæ˜¯é€šè¿‡è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚ &lt;code&gt;code&lt;/code&gt;ï¼‰æ›¿ä»£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ›¿ä»£æ–¹æ¡ˆæ¨è-1"&gt;æ›¿ä»£æ–¹æ¡ˆï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨è‡ªå®šä¹‰å­—æ®µæ ‡è¯†æšä¸¾ï¼Œé¿å…ä¾èµ– &lt;code&gt;ordinal&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FAILED&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SUCCESS&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DOING&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å³ä½¿è°ƒæ•´é¡ºåºï¼Œcode ä»ç¨³å®š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ResultType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResultType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fromCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ResultType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;code&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Invalid code: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°å¢å¸¸é‡å¯æ’å…¥ä»»æ„ä½ç½®ï¼Œä¸å½±å“åŸæœ‰ &lt;code&gt;code&lt;/code&gt; çš„æ˜ å°„å…³ç³»ã€‚&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡é€»è¾‘ä¸å—æšä¸¾å£°æ˜é¡ºåºçš„çº¦æŸï¼Œç¨³å®šæ€§æ›´é«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-4"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ordinal&lt;/code&gt; çš„å˜åŠ¨æ€§&lt;/strong&gt;ï¼šæ–°å¢ã€åˆ é™¤æˆ–è°ƒæ•´æšä¸¾å¸¸é‡çš„ä½ç½®å‡ä¼šå¯¼è‡´ &lt;code&gt;ordinal&lt;/code&gt; å˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼šä¼˜å…ˆé€šè¿‡è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚ &lt;code&gt;code&lt;/code&gt;ï¼‰æ ‡è¯†æšä¸¾ï¼Œè€Œéä¾èµ– &lt;code&gt;ordinal&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä»…å½“æšä¸¾é¡ºåºç»å¯¹å›ºå®šä¸”æ— éœ€ç»´æŠ¤æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨ &lt;code&gt;ordinal&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="switch"&gt;switch
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PostOperation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LIKED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DISLIKED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SWITCH_TO_LIKE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SWITCH_TO_DISLIKE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COMMENT_CREATED&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COMMENT_DELETED&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Example&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleOperation&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PostOperation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postOperation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;postOperation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ“ä½œç±»å‹ä¸èƒ½ä¸ºç©º&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;positiveDiff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;negativeDiff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentDiff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;switch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;postOperation&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LIKED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;positiveDiff&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DISLIKED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;negativeDiff&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SWITCH_TO_LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;positiveDiff&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;negativeDiff&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SWITCH_TO_DISLIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;positiveDiff&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;negativeDiff&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COMMENT_CREATED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentDiff&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COMMENT_DELETED&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentDiff&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalStateException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æœªæ”¯æŒçš„æ“ä½œç±»å‹: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postOperation&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åç»­é€»è¾‘...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="java-hashmap"&gt;Java HashMap
&lt;/h2&gt;&lt;p&gt;åœ¨ Java ä¸­ï¼Œ&lt;code&gt;HashMap&lt;/code&gt; æ²¡æœ‰ç›´æ¥çš„ &lt;code&gt;getOrInsert&lt;/code&gt; æ–¹æ³•ï¼Œä½†å¯ä»¥é€šè¿‡ç»„åˆç°æœ‰æ–¹æ³•å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§å®ç°æ–¹å¼åŠå…¶é€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="computeifabsent-æ–¹æ³•æ¨è"&gt;&lt;code&gt;computeIfAbsent&lt;/code&gt; æ–¹æ³•ï¼ˆæ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨æ’å…¥ä¸€ä¸ªé»˜è®¤å€¼å¹¶è¿”å›ï¼›è‹¥é”®å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›å½“å‰å€¼ã€‚&lt;br&gt;
&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šé€‚ç”¨äºéœ€è¦æ ¹æ®é”®åŠ¨æ€ç”Ÿæˆé»˜è®¤å€¼çš„åœºæ™¯ï¼ˆå¦‚åˆå§‹åŒ–é›†åˆã€ç¼“å­˜æ•°æ®ç­‰ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;computeIfAbsent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;value1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªåŠ¨æ’å…¥å¹¶æ“ä½œé»˜è®¤çš„ç©ºåˆ—è¡¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å‡½æ•°å¼æ¥å£åŠ¨æ€ç”Ÿæˆé»˜è®¤å€¼ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€é…åˆ &lt;code&gt;ConcurrentHashMap&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="get--put-ç»„åˆ"&gt;&lt;code&gt;get&lt;/code&gt; + &lt;code&gt;put&lt;/code&gt; ç»„åˆ
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šæ‰‹åŠ¨æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨æ—¶æ’å…¥é»˜è®¤å€¼ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;containsKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ’å…¥é»˜è®¤å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦å¤šæ¬¡å“ˆå¸Œè®¡ç®—ï¼ˆ&lt;code&gt;containsKey&lt;/code&gt; å’Œ &lt;code&gt;put&lt;/code&gt; å„ä¸€æ¬¡ï¼‰ï¼Œæ€§èƒ½è¾ƒå·®ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç å†—ä½™ï¼Œå¯è¯»æ€§ä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="putifabsent-æ–¹æ³•"&gt;&lt;code&gt;putIfAbsent&lt;/code&gt; æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šä»…åœ¨é”®ä¸å­˜åœ¨æ—¶æ’å…¥æŒ‡å®šå€¼ï¼Œè¿”å›å½“å‰å€¼ï¼ˆå¯èƒ½æ˜¯æ—§å€¼æˆ–æ–°å€¼ï¼‰ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;putIfAbsent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é”®ä¸å­˜åœ¨æ—¶æ’å…¥0&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚åˆéœ€è¦æ˜¾å¼æ§åˆ¶é»˜è®¤å€¼æ’å…¥çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ &lt;code&gt;computeIfAbsent&lt;/code&gt; çš„åŒºåˆ«ï¼š&lt;code&gt;putIfAbsent&lt;/code&gt; ç›´æ¥æ¥å—å›ºå®šå€¼ï¼Œè€Œéç”Ÿæˆå‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="java-8-çš„-getordefaultä»…æŸ¥è¯¢ä¸æ’å…¥"&gt;Java 8+ çš„ &lt;code&gt;getOrDefault&lt;/code&gt;ï¼ˆä»…æŸ¥è¯¢ä¸æ’å…¥ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šé”®ä¸å­˜åœ¨æ—¶è¿”å›é»˜è®¤å€¼ï¼Œä½†ä¸æ’å…¥åˆ° &lt;code&gt;HashMap&lt;/code&gt;ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getOrDefault&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;key1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸ä¿®æ”¹åŸMap&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;ï¼šä»…éœ€ä¸´æ—¶è·å–é»˜è®¤å€¼ï¼Œæ— éœ€æŒä¹…åŒ–å­˜å‚¨æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-2"&gt;æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹å®‰å…¨&lt;/strong&gt;ï¼š&lt;br&gt;
&lt;code&gt;HashMap&lt;/code&gt; æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹åº”ä½¿ç”¨ &lt;code&gt;ConcurrentHashMap&lt;/code&gt; æˆ–åŒæ­¥åŒ…è£…ç±»ï¼ˆå¦‚ &lt;code&gt;Collections.synchronizedMap&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥å·²çŸ¥æ•°æ®è§„æ¨¡ï¼Œå¯æŒ‡å®šåˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ä»¥å‡å°‘æ‰©å®¹å¼€é”€ï¼ˆå¦‚ &lt;code&gt;new HashMap&amp;lt;&amp;gt;(32, 0.75f)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;computeIfAbsent&lt;/code&gt; è€Œé &lt;code&gt;get&lt;/code&gt;+&lt;code&gt;put&lt;/code&gt; ç»„åˆï¼Œä»¥å‡å°‘å“ˆå¸Œè®¡ç®—æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”®çš„é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ï¼ˆå¦‚ &lt;code&gt;String&lt;/code&gt;ã€&lt;code&gt;Integer&lt;/code&gt;ï¼‰ä½œä¸ºé”®ï¼Œé¿å…å“ˆå¸Œç å˜åŒ–å¯¼è‡´æŸ¥æ‰¾å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰é”®ç±»éœ€æ­£ç¡®é‡å†™ &lt;code&gt;hashCode()&lt;/code&gt; å’Œ &lt;code&gt;equals()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-5"&gt;æ€»ç»“
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;æ˜¯å¦æ’å…¥é”®&lt;/th&gt;
&lt;th&gt;è¿”å›å€¼ç±»å‹&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;computeIfAbsent&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;æ–°å€¼æˆ–ç°æœ‰å€¼&lt;/td&gt;
&lt;td&gt;åŠ¨æ€ç”Ÿæˆé»˜è®¤å€¼ï¼ˆæ¨èï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;putIfAbsent&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;æ—§å€¼æˆ– &lt;code&gt;null&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ’å…¥å›ºå®šé»˜è®¤å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;getOrDefault&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼æˆ–ç°æœ‰å€¼&lt;/td&gt;
&lt;td&gt;ä»…æŸ¥è¯¢ä¸æ’å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;get&lt;/code&gt;+&lt;code&gt;put&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨å¤„ç†&lt;/td&gt;
&lt;td&gt;å…¼å®¹æ—§ç‰ˆæœ¬ï¼ˆJava 7-ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¼˜å…ˆä½¿ç”¨ &lt;code&gt;computeIfAbsent&lt;/code&gt; å®ç°ç±»ä¼¼ &lt;code&gt;getOrInsert&lt;/code&gt; çš„é€»è¾‘ï¼Œå…¼é¡¾ç®€æ´æ€§å’Œæ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id="æ‰¹é‡æ›´æ–°"&gt;æ‰¹é‡æ›´æ–°
&lt;/h2&gt;&lt;h3 id="jpqlåŸºç¡€æ–¹æ³•"&gt;JPQLåŸºç¡€æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;åœ¨Spring Data JPAä¸­ï¼Œä½¿ç”¨JPQLï¼ˆJava Persistence Query Languageï¼‰å®ç°æ‰¹é‡æ›´æ–°å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œæˆï¼Œå¹¶ç»“åˆäº‹åŠ¡ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–ç­‰å…³é”®ç‚¹ç¡®ä¿é«˜æ•ˆæ€§å’Œæ•°æ®ä¸€è‡´æ€§ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h5 id="ä½¿ç”¨queryæ³¨è§£å®šä¹‰æ‰¹é‡æ›´æ–°è¯­å¥"&gt;&lt;strong&gt;ä½¿ç”¨@Queryæ³¨è§£å®šä¹‰æ‰¹é‡æ›´æ–°è¯­å¥&lt;/strong&gt;
&lt;/h5&gt;&lt;p&gt;é€šè¿‡è‡ªå®šä¹‰Repositoryæ–¹æ³•å¹¶ç¼–å†™JPQLçš„UPDATEè¯­å¥ï¼Œç›´æ¥æ“ä½œæ•°æ®åº“è®°å½•ï¼Œé¿å…é€æ¡æŸ¥è¯¢å®ä½“å¯¹è±¡ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Repository&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JpaRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Modifying&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE User u SET u.status = :newStatus WHERE u.id IN :ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateUsersStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;newStatus&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newStatus&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@Modifying&lt;/code&gt;æ³¨è§£&lt;/strong&gt;ï¼šæ ‡è®°è¯¥æ–¹æ³•ä¸ºä¿®æ”¹æ“ä½œï¼ˆæ›´æ–°/åˆ é™¤ï¼‰ï¼Œå¿…é¡»ä¸&lt;code&gt;@Query&lt;/code&gt;é…åˆä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°ç»‘å®š&lt;/strong&gt;ï¼šé€šè¿‡&lt;code&gt;@Param&lt;/code&gt;ç»‘å®šå‚æ•°ï¼Œæ”¯æŒé›†åˆç±»å‹ï¼ˆå¦‚&lt;code&gt;List&amp;lt;Long&amp;gt;&lt;/code&gt;ï¼‰ä½œä¸ºINå­å¥çš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼&lt;/strong&gt;ï¼šè¿”å›å—å½±å“çš„è¡Œæ•°ï¼ˆå¯é€‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="äº‹åŠ¡ç®¡ç†"&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æ‰¹é‡æ›´æ–°å¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ›å‡º&lt;code&gt;TransactionRequiredException&lt;/code&gt;ã€‚æ¨èåœ¨æœåŠ¡å±‚æ·»åŠ &lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchUpdateStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newStatus&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;updateUsersStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newStatus&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¿å…N+1æŸ¥è¯¢&lt;/strong&gt;ï¼šç›´æ¥ä½¿ç”¨JPQLæ‰¹é‡æ›´æ–°è¯­å¥ï¼Œè€Œéé€šè¿‡&lt;code&gt;save()&lt;/code&gt;æ–¹æ³•é€æ¡æ›´æ–°ï¼Œåè€…ä¼šè§¦å‘SELECTæŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†æ‰¹å¤„ç†&lt;/strong&gt;ï¼šè‹¥æ•°æ®é‡è¿‡å¤§ï¼ˆå¦‚è¶…è¿‡1000æ¡ï¼‰ï¼Œå»ºè®®åˆ†æ‰¹æ¬¡æ‰§è¡Œï¼Œé˜²æ­¢&lt;strong&gt;æ•°æ®åº“é”è¡¨&lt;/strong&gt;æˆ–å†…å­˜æº¢å‡ºã€‚
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;ListUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;updateUsersStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newStatus&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;ï¼šç¡®ä¿WHEREæ¡ä»¶ä¸­çš„å­—æ®µï¼ˆå¦‚&lt;code&gt;id&lt;/code&gt;ï¼‰æœ‰ç´¢å¼•ï¼Œä»¥æé«˜æ›´æ–°æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¸…é™¤ä¸€çº§ç¼“å­˜&lt;/strong&gt;ï¼šæ›´æ–°åè‹¥éœ€ç«‹å³è¯»å–æœ€æ–°æ•°æ®ï¼Œå¯è°ƒç”¨&lt;code&gt;entityManager.flush()&lt;/code&gt;å’Œ&lt;code&gt;entityManager.clear()&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="åŠ¨æ€æ›´æ–°çš„æ›¿ä»£æ–¹æ¡ˆ"&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°çš„æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€è¦æ ¹æ®æ¡ä»¶åŠ¨æ€ç”Ÿæˆæ›´æ–°è¯­å¥ï¼ˆå¦‚éƒ¨åˆ†å­—æ®µæ›´æ–°ï¼‰ï¼Œå¯ç»“åˆ&lt;code&gt;Criteria API&lt;/code&gt;æˆ–&lt;code&gt;EntityManager&lt;/code&gt;å®ç°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@PersistenceContext&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EntityManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;dynamicUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updates&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CriteriaBuilder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCriteriaBuilder&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CriteriaUpdate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createCriteriaUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Root&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;from&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updates&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;in&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;executeUpdate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="åŸç”Ÿsqlçš„æ‰©å±•ä½¿ç”¨"&gt;&lt;strong&gt;åŸç”ŸSQLçš„æ‰©å±•ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¯¹äºå¤æ‚æ›´æ–°é€»è¾‘ï¼ˆå¦‚æ¶‰åŠJOINæ“ä½œï¼‰ï¼Œå¯ä½¿ç”¨åŸç”ŸSQLï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE users u JOIN departments d ON u.department_id = d.id &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SET u.status = :status WHERE d.name = :deptName&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nativeQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Modifying&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateByDepartmentName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;deptName&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;deptName&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-6"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©JPQL&lt;/strong&gt;ï¼šé€‚ç”¨äºç®€å•æ‰¹é‡æ›´æ–°ï¼Œè¯­æ³•æ¸…æ™°ä¸”ä¸JPAé›†æˆåº¦é«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ›´æ–°åœºæ™¯&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;Criteria API&lt;/code&gt;æˆ–åŸç”ŸSQLï¼Œé¿å…ç¡¬ç¼–ç å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸æ€§èƒ½&lt;/strong&gt;ï¼šå§‹ç»ˆåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¹¶é€šè¿‡åˆ†æ‰¹æ¬¡ã€ç´¢å¼•ä¼˜åŒ–æå‡æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥é«˜æ•ˆå®ç°æ‰¹é‡æ›´æ–°ï¼ŒåŒæ—¶é¿å…N+1æŸ¥è¯¢é—®é¢˜ï¼Œé€‚ç”¨äºé«˜å¹¶å‘å’Œå¤§æ•°æ®é‡çš„ç”Ÿäº§ç¯å¢ƒã€‚&lt;/p&gt;
&lt;h3 id="ä¸‰ä¸ªè¿›é˜¶æ–¹æ³•"&gt;ä¸‰ä¸ªè¿›é˜¶æ–¹æ³•
&lt;/h3&gt;&lt;p&gt;åœ¨Spring Data JPAä¸­ï¼Œå½“éœ€è¦æ‰¹é‡æ›´æ–°å¤šæ¡è®°å½•ä¸”æ¯æ¡è®°å½•çš„æ›´æ–°å€¼ä¸åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ¡ˆå®ç°é«˜æ•ˆå¤„ç†ã€‚è¯¥æ–¹æ³•ç»“åˆåŠ¨æ€SQLç”Ÿæˆã€Hibernateæ‰¹å¤„ç†é…ç½®åŠäº‹åŠ¡ç®¡ç†ï¼Œæ—¢èƒ½å‡å°‘ç½‘ç»œå¼€é”€ï¼Œåˆèƒ½é¿å…å†…å­˜æº¢å‡ºé—®é¢˜ï¼š&lt;/p&gt;
&lt;h4 id="åŠ¨æ€æ„å»ºæ‰¹é‡æ›´æ–°sqlæ¨èé«˜å¹¶å‘åœºæ™¯"&gt;&lt;strong&gt;åŠ¨æ€æ„å»ºæ‰¹é‡æ›´æ–°SQLï¼ˆæ¨èé«˜å¹¶å‘åœºæ™¯ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡åŸç”ŸSQLæˆ–JPQLçš„&lt;code&gt;CASE&lt;/code&gt;è¡¨è¾¾å¼ï¼Œå°†ä¸åŒå€¼çš„æ›´æ–°åˆå¹¶ä¸ºå•æ¡è¯­å¥ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;status1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;status2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(:&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨Javaä¸­åŠ¨æ€æ„å»ºå‚æ•°æ˜ å°„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nativeQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE users SET status = CASE id ... END WHERE id IN :ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Modifying&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchUpdateWithCase&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;statusMap&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;statusMap&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šå•æ¬¡æ•°æ®åº“äº¤äº’å®Œæˆæ‰€æœ‰æ›´æ–°ï¼Œé€‚åˆ1000æ¡ä»¥ä¸‹æ•°æ®ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="ä½¿ç”¨entitymanageråˆ†æ‰¹å¤„ç†æ¨èå¤§æ•°æ®é‡åœºæ™¯"&gt;&lt;strong&gt;ä½¿ç”¨EntityManageråˆ†æ‰¹å¤„ç†ï¼ˆæ¨èå¤§æ•°æ®é‡åœºæ™¯ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç»“åˆHibernateçš„æ‰¹é‡é…ç½®å’Œæ‰‹åŠ¨åˆ·æ–°æœºåˆ¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ›´æ–°æ“ä½œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æŒ‰æ‰¹æ¬¡åˆ·æ–°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é…ç½®ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;jpa&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;hibernate&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;jdbc.batch_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;500&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ‰¹å¤„ç†å¤§å°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;order_updates&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æŒ‰ä¸»é”®æ’åºæå‡æ€§èƒ½&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ä½“ä¸»é”®éœ€ä½¿ç”¨**éè‡ªå¢ç±»å‹ï¼ˆå¦‚UUIDï¼‰**ä»¥é¿å…é”ç«äº‰&lt;/li&gt;
&lt;li&gt;åˆ†æ‰¹æ¬¡å¤§å°å»ºè®®500-1000ï¼Œæ ¹æ®å†…å­˜è°ƒæ•´&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="åŠ¨æ€criteria-apiæ›´æ–°å¤æ‚æ¡ä»¶åœºæ™¯"&gt;&lt;strong&gt;åŠ¨æ€Criteria APIæ›´æ–°ï¼ˆå¤æ‚æ¡ä»¶åœºæ™¯ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡CriteriaUpdateå®ç°å­—æ®µçº§åŠ¨æ€æ›´æ–°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;CriteriaBuilder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCriteriaBuilder&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;CriteriaUpdate&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createCriteriaUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Root&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;from&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getStatus&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;executeUpdate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šæ— éœ€ç¡¬ç¼–ç å­—æ®µåï¼Œé€‚åˆå­—æ®µåŠ¨æ€å˜åŒ–çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®-1"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;æ•°æ®é‡å»ºè®®&lt;/th&gt;
&lt;th&gt;ç½‘ç»œè¯·æ±‚æ¬¡æ•°&lt;/th&gt;
&lt;th&gt;å†…å­˜æ¶ˆè€—&lt;/th&gt;
&lt;th&gt;å®ç°å¤æ‚åº¦&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŠ¨æ€CASE SQL&lt;/td&gt;
&lt;td&gt;&amp;lt;1000æ¡&lt;/td&gt;
&lt;td&gt;1æ¬¡&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EntityManageråˆ†æ‰¹&lt;/td&gt;
&lt;td&gt;1ä¸‡~100ä¸‡æ¡&lt;/td&gt;
&lt;td&gt;N/500æ¬¡&lt;/td&gt;
&lt;td&gt;å¯æ§&lt;/td&gt;
&lt;td&gt;ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Criteria APIé€æ¡&lt;/td&gt;
&lt;td&gt;&amp;lt;100æ¡&lt;/td&gt;
&lt;td&gt;Næ¬¡&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸­å°æ‰¹é‡æ•°æ®&lt;/strong&gt;ï¼šä¼˜å…ˆé‡‡ç”¨&lt;code&gt;CASE&lt;/code&gt;è¯­å¥æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶…å¤§è§„æ¨¡æ•°æ®&lt;/strong&gt;ï¼šä½¿ç”¨EntityManageråˆ†æ‰¹å¤„ç†+è¿æ¥æ± ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ä¸€è‡´æ€§è¦æ±‚é«˜&lt;/strong&gt;ï¼šç»“åˆ&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£æ§åˆ¶äº‹åŠ¡è¾¹ç•Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ‰©å±•ä¼˜åŒ–æŠ€å·§"&gt;&lt;strong&gt;æ‰©å±•ä¼˜åŒ–æŠ€å·§&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¿æ¥æ± é…ç½®&lt;/strong&gt;ï¼šå¢åŠ HikariCPçš„&lt;code&gt;maximumPoolSize&lt;/code&gt;ä»¥æ”¯æŒé«˜å¹¶å‘æ‰¹é‡æ“ä½œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ä¼˜åŒ–&lt;/strong&gt;ï¼šä¸ºWHEREæ¡ä»¶å­—æ®µï¼ˆå¦‚&lt;code&gt;id&lt;/code&gt;ï¼‰å»ºç«‹ç´¢å¼•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥å¤„ç†&lt;/strong&gt;ï¼šå¯¹100ä¸‡+æ•°æ®é‡é‡‡ç”¨Spring Batchåˆ†ç‰‡å¤„ç†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§æ‰‹æ®µ&lt;/strong&gt;ï¼šå¯ç”¨&lt;code&gt;hibernate.generate_statistics&lt;/code&gt;åˆ†æSQLæ€§èƒ½&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯åœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œå°†æ‰¹é‡æ›´æ–°æ€§èƒ½æå‡10å€ä»¥ä¸Šï¼ˆå®æµ‹10ä¸‡æ¡æ•°æ®æ›´æ–°ä»120ç§’é™è‡³8ç§’ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="åŠ¨æ€æ„å»ºæ‰¹é‡æ›´æ–°sqlç»†èŠ‚"&gt;åŠ¨æ€æ„å»ºæ‰¹é‡æ›´æ–°SQLç»†èŠ‚
&lt;/h3&gt;&lt;p&gt;åœ¨Spring Data JPAä¸­ï¼Œ&lt;strong&gt;åŠ¨æ€æ„å»ºæ‰¹é‡æ›´æ–°SQL&lt;/strong&gt;æ˜¯ä¸€ç§é«˜æ•ˆå¤„ç†æ¯æ¡è®°å½•æ›´æ–°å€¼ä¸åŒçš„åœºæ™¯çš„è§£å†³æ–¹æ¡ˆã€‚å…¶æ ¸å¿ƒåœ¨äºé€šè¿‡æ¡ä»¶è¡¨è¾¾å¼ï¼ˆå¦‚CASE WHENï¼‰å°†ä¸åŒè®°å½•çš„æ›´æ–°é€»è¾‘åˆå¹¶åˆ°å•æ¡SQLè¯­å¥ä¸­ï¼Œå‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°ç­–ç•¥åŠä¼˜åŒ–æŠ€å·§ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="åŠ¨æ€case-whenè¡¨è¾¾å¼æ„å»º"&gt;&lt;strong&gt;åŠ¨æ€CASE WHENè¡¨è¾¾å¼æ„å»º&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡åŸç”ŸSQLåŠ¨æ€ç”ŸæˆåŒ…å«å¤šæ¡ä»¶åˆ†æ”¯çš„æ›´æ–°è¯­å¥ï¼Œé€‚ç”¨äº&lt;strong&gt;å•å­—æ®µä¸åŒå€¼æ›´æ–°&lt;/strong&gt;åœºæ™¯ã€‚&lt;br&gt;
&lt;strong&gt;ç¤ºä¾‹SQLç»“æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;status1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;status2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(:&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="query-å•å­—æ®µ"&gt;@Query å•å­—æ®µ
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Repository&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JpaRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nativeQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE user SET status = CASE id &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;WHEN :#{#map.keySet().toArray()[0]} THEN :#{#map[#root.args[0].keySet().toArray()[0]]} &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;... &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;END WHERE id IN :ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Modifying&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchUpdateStatus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idToStatusMap&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;å…³é”®ç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨SpELè¡¨è¾¾å¼åŠ¨æ€è§£æMapå‚æ•°ä¸­çš„é”®å€¼å¯¹&lt;/li&gt;
&lt;li&gt;å‚æ•°åŒ–å ä½ç¬¦é¿å…SQLæ³¨å…¥é£é™©&lt;/li&gt;
&lt;li&gt;é™åˆ¶æ¡ä»¶æ•°é‡ï¼ˆå»ºè®®å•æ¬¡å¤„ç†ä¸è¶…è¿‡1000æ¡ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="å¤šå­—æ®µåŠ¨æ€æ›´æ–°ç­–ç•¥"&gt;&lt;strong&gt;å¤šå­—æ®µåŠ¨æ€æ›´æ–°ç­–ç•¥&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€åŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µä¸”å€¼ä¸åŒï¼Œå¯é€šè¿‡&lt;strong&gt;åŠ¨æ€æ‹¼æ¥SQLå­—ç¬¦ä¸²&lt;/strong&gt;å®ç°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;buildDynamicUpdateSQL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringBuilder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringBuilder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE user SET &amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ¨æ€ç”ŸæˆCASEè¯­å¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name = CASE id WHEN :id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34; THEN :name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;()).&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34; END, &amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç§»é™¤æœ«å°¾é€—å·&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34; WHERE id IN (:ids)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ids&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;()));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡ŒåŸç”ŸSQL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createNativeQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameters&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;executeUpdate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éœ€æ‰‹åŠ¨ç®¡ç†å‚æ•°ç»‘å®šï¼Œé¿å…ç´¢å¼•è¶Šç•Œ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;EntityManager&lt;/code&gt;ç›´æ¥æ“ä½œæ›´çµæ´»&lt;/li&gt;
&lt;li&gt;å»ºè®®é…åˆåˆ†é¡µå¤„ç†ï¼ˆå¦‚æ¯500æ¡ç”Ÿæˆä¸€ä¸ªSQLï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="äº‹åŠ¡ä¸å¼‚å¸¸å¤„ç†"&gt;&lt;strong&gt;äº‹åŠ¡ä¸å¼‚å¸¸å¤„ç†&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;executeBatchUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Lists&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batches&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ¨æ€æ„å»ºå¹¶æ‰§è¡ŒSQL&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buildDynamicUpdateSQL&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¸…é™¤ä¸€çº§ç¼“å­˜é˜²æ­¢OOM&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DataAccessException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TransactionAspectSupport&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentTransactionStatus&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setRollbackOnly&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BatchUpdateException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;æ‰¹é‡æ›´æ–°å¤±è´¥&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†æ‰¹æ¬¡æäº¤äº‹åŠ¡ï¼Œé™ä½é”è¡¨é£é™©&lt;/li&gt;
&lt;li&gt;å¼ºåˆ¶äº‹åŠ¡å›æ»šä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;ç»“åˆ&lt;code&gt;@Retryable&lt;/code&gt;å®ç°å¤±è´¥é‡è¯•æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®-2"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;th&gt;ä¼˜åŠ¿&lt;/th&gt;
&lt;th&gt;å±€é™æ€§&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;CASEåŠ¨æ€SQL&lt;/td&gt;
&lt;td&gt;å•å­—æ®µå°‘é‡æ•°æ®&lt;/td&gt;
&lt;td&gt;å•æ¬¡è¯·æ±‚å®Œæˆæ›´æ–°&lt;/td&gt;
&lt;td&gt;SQLé•¿åº¦å—é™ï¼Œç»´æŠ¤å¤æ‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤šå­—æ®µåŠ¨æ€æ‹¼æ¥&lt;/td&gt;
&lt;td&gt;å¤šå­—æ®µçµæ´»æ›´æ–°&lt;/td&gt;
&lt;td&gt;å­—æ®µçº§åŠ¨æ€æ§åˆ¶&lt;/td&gt;
&lt;td&gt;å­˜åœ¨SQLæ³¨å…¥é£é™©éœ€ä¸¥æ ¼æ ¡éªŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Hibernateæ‰¹å¤„ç†&lt;/td&gt;
&lt;td&gt;å¤§æ•°æ®é‡æ›´æ–°&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨ç®¡ç†ç¼“å­˜ï¼Œæ”¯æŒå®ä½“çŠ¶æ€è¿½è¸ª&lt;/td&gt;
&lt;td&gt;éœ€è¦é…ç½®ä¼˜åŒ–å‚æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JDBCæ‰¹é‡åè®®&lt;/td&gt;
&lt;td&gt;æé«˜æ€§èƒ½è¦æ±‚&lt;/td&gt;
&lt;td&gt;ç›´æ¥æ“ä½œåº•å±‚åè®®ï¼Œæ•ˆç‡æœ€é«˜&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨å¤„ç†å¯¹è±¡å…³ç³»æ˜ å°„&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ¨èç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;1000æ¡ä»¥å†…&lt;/strong&gt;ï¼šä¼˜å…ˆé‡‡ç”¨åŠ¨æ€CASEè¯­å¥&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;1ä¸‡~100ä¸‡æ¡&lt;/strong&gt;ï¼šHibernateæ‰¹å¤„ç†+åˆ†é¡µæäº¤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µåŠ¨æ€å˜åŒ–é¢‘ç¹&lt;/strong&gt;ï¼šç»“åˆQueryDSLåŠ¨æ€ç”Ÿæˆæ¡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ‰©å±•ç´¢å¼•ä¼˜åŒ–å»ºè®®"&gt;&lt;strong&gt;æ‰©å±•ï¼šç´¢å¼•ä¼˜åŒ–å»ºè®®&lt;/strong&gt;
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;ä¸ºWHEREæ¡ä»¶å­—æ®µï¼ˆå¦‚&lt;code&gt;id&lt;/code&gt;ï¼‰å»ºç«‹èšç°‡ç´¢å¼•&lt;/li&gt;
&lt;li&gt;å¤åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼ˆè‹¥æ¶‰åŠå¤šæ¡ä»¶ç­›é€‰ï¼‰&lt;/li&gt;
&lt;li&gt;å®šæœŸæ‰§è¡Œ&lt;code&gt;ANALYZE TABLE&lt;/code&gt;æ›´æ–°ç»Ÿè®¡ä¿¡æ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆï¼Œå¯å°†10ä¸‡æ¡è®°å½•çš„å·®å¼‚æ›´æ–°è€—æ—¶ä»ä¼ ç»Ÿé€æ¡æ›´æ–°çš„120ç§’ç¼©çŸ­è‡³5ç§’å†…ã€‚å®é™…åº”ç”¨ä¸­éœ€æ ¹æ®æ•°æ®ç‰¹å¾çµæ´»é€‰æ‹©ç­–ç•¥ï¼Œå¹¶é€šè¿‡æ€§èƒ½å‹æµ‹ç¡®å®šæœ€ä½³æ‰¹æ¬¡å¤§å°ã€‚&lt;/p&gt;
&lt;h3 id="entitymanageråˆ†æ‰¹å¤„ç†ç»†èŠ‚"&gt;EntityManageråˆ†æ‰¹å¤„ç†ç»†èŠ‚
&lt;/h3&gt;&lt;p&gt;åœ¨ä½¿ç”¨ &lt;code&gt;EntityManager&lt;/code&gt;ï¼ˆæˆ– Hibernate/JPAï¼‰è¿›è¡Œå¤§æ‰¹é‡æ•°æ®æ’å…¥ï¼ˆå¦‚æ‰¹å¤„ç†ï¼‰æ—¶ï¼Œ&lt;strong&gt;å®ä½“ä¸»é”®ä½¿ç”¨éè‡ªå¢ç±»å‹ï¼ˆå¦‚UUIDï¼‰&lt;/strong&gt; çš„æ ¸å¿ƒåŸå› æ˜¯ &lt;strong&gt;æ•°æ®åº“ä¸»é”®ç”Ÿæˆç­–ç•¥å¯¹æ‰¹å¤„ç†æ€§èƒ½çš„å½±å“&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="è‡ªå¢ä¸»é”®identityçš„å±€é™æ€§"&gt;&lt;strong&gt;è‡ªå¢ä¸»é”®ï¼ˆIDENTITYï¼‰çš„å±€é™æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å¦‚æœä¸»é”®ä½¿ç”¨æ•°æ®åº“è‡ªå¢ç­–ç•¥ï¼ˆå¦‚ MySQL çš„ &lt;code&gt;AUTO_INCREMENT&lt;/code&gt; æˆ– PostgreSQL çš„ &lt;code&gt;SERIAL&lt;/code&gt;ï¼‰ï¼ŒHibernate/JPA åœ¨æ’å…¥å®ä½“æ—¶ä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•æ‰¹é‡æ’å…¥&lt;/strong&gt;ï¼šè‡ªå¢ä¸»é”®çš„å€¼ç”±æ•°æ®åº“ç”Ÿæˆï¼ŒHibernate å¿…é¡» &lt;strong&gt;ç«‹å³æ‰§è¡Œæ¯æ¡ INSERT è¯­å¥&lt;/strong&gt; æ‰èƒ½è·å–ç”Ÿæˆçš„ä¸»é”®å€¼ã€‚è¿™ä¼šå¼ºåˆ¶å°†æ¯ä¸ªæ’å…¥æ“ä½œå•ç‹¬æäº¤åˆ°æ•°æ®åº“ï¼Œæ— æ³•åˆå¹¶ä¸ºæ‰¹é‡æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹å¤„ç†å¤±æ•ˆ&lt;/strong&gt;ï¼šå³ä½¿é…ç½®äº† Hibernate çš„æ‰¹å¤„ç†å‚æ•°ï¼ˆå¦‚ &lt;code&gt;hibernate.jdbc.batch_size&lt;/code&gt;ï¼‰ï¼Œè‡ªå¢ä¸»é”®ä¹Ÿä¼šå¯¼è‡´ Hibernate é€€åŒ–ä¸ºé€æ¡æ’å…¥ï¼Œå› ä¸ºéœ€è¦ç«‹å³è·å–ç”Ÿæˆçš„ä¸»é”®å€¼æ¥ç»´æŠ¤å®ä½“çš„ä¸€çº§ç¼“å­˜ï¼ˆ&lt;code&gt;Persistence Context&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id="ç¤ºä¾‹ä»£ç å¯¹æ¯”"&gt;ç¤ºä¾‹ä»£ç å¯¹æ¯”
&lt;/h5&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼ˆIDENTITYï¼‰æ—¶ï¼ŒHibernate ç”Ÿæˆçš„ SQLï¼š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Alice&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ç«‹å³æ‰§è¡Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Bob&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ç«‹å³æ‰§è¡Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="uuidæˆ–åº”ç”¨å±‚ç”Ÿæˆä¸»é”®çš„ä¼˜åŠ¿"&gt;&lt;strong&gt;UUIDï¼ˆæˆ–åº”ç”¨å±‚ç”Ÿæˆä¸»é”®ï¼‰çš„ä¼˜åŠ¿&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ UUID æˆ–åº”ç”¨å±‚ç”Ÿæˆçš„ä¸»é”®ï¼ˆå¦‚ Snowflake IDï¼‰æ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸»é”®ç”±åº”ç”¨ç”Ÿæˆ&lt;/strong&gt;ï¼šæ— éœ€ä¾èµ–æ•°æ®åº“ç”Ÿæˆä¸»é”®ï¼ŒHibernate å¯ä»¥é¢„å…ˆä¸ºå®ä½“åˆ†é…ä¸»é”®å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¯æŒçœŸæ­£çš„æ‰¹å¤„ç†&lt;/strong&gt;ï¼šHibernate å¯ä»¥å°†å¤šä¸ª INSERT è¯­å¥åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹æ¬¡ï¼ˆbatchï¼‰ï¼Œé€šè¿‡ä¸€æ¬¡æ•°æ®åº“äº¤äº’å®Œæˆå¤šæ¡è®°å½•çš„æ’å…¥ï¼Œå¤§å¹…å‡å°‘ç½‘ç»œå¼€é”€å’Œæ•°æ®åº“è´Ÿè½½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id="ç¤ºä¾‹ä»£ç "&gt;ç¤ºä¾‹ä»£ç 
&lt;/h5&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ä½¿ç”¨ UUID ä¸»é”®æ—¶ï¼ŒHibernate ç”Ÿæˆçš„ SQLï¼ˆåˆå¹¶ä¸ºæ‰¹å¤„ç†ï¼‰ï¼š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;uuid1&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Alice&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;uuid2&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Bob&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;é€šè¿‡&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JDBC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;çš„æ‰¹é‡æ“ä½œä¸€æ¬¡æ€§æäº¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h5 id="æ€§èƒ½å¯¹æ¯”"&gt;&lt;strong&gt;æ€§èƒ½å¯¹æ¯”&lt;/strong&gt;
&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå¢ä¸»é”®&lt;/strong&gt;ï¼šæ¯æ¡ INSERT éƒ½éœ€è¦ç­‰å¾…æ•°æ®åº“è¿”å›ç”Ÿæˆçš„ä¸»é”®ï¼Œå¯¼è‡´é¢‘ç¹çš„æ•°æ®åº“äº¤äº’ï¼Œæ€§èƒ½éšæ•°æ®é‡çº¿æ€§ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;UUID ä¸»é”®&lt;/strong&gt;ï¼šæ‰¹å¤„ç†å°†å¤šä¸ª INSERT åˆå¹¶ä¸ºä¸€æ¬¡æ•°æ®åº“äº¤äº’ï¼Œæ€§èƒ½æå‡å¯è¾¾æ•°åå€ï¼ˆå°¤å…¶æ˜¯åœ¨ç½‘ç»œå»¶è¿Ÿè¾ƒé«˜çš„åœºæ™¯ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id="å…¶ä»–ä¼˜åŒ–å› ç´ "&gt;&lt;strong&gt;å…¶ä»–ä¼˜åŒ–å› ç´ &lt;/strong&gt;
&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ—¥å¿—å‹åŠ›&lt;/strong&gt;ï¼šè‡ªå¢ä¸»é”®å¯èƒ½å¯¼è‡´æ•°æ®åº“äº‹åŠ¡æ—¥å¿—é¢‘ç¹å†™å…¥ï¼Œè€Œæ‰¹å¤„ç†é€šè¿‡å‡å°‘æäº¤æ¬¡æ•°é™ä½æ—¥å¿—å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”ç«äº‰&lt;/strong&gt;ï¼šè‡ªå¢ä¸»é”®åœ¨é«˜å¹¶å‘æ’å…¥æ—¶å¯èƒ½å¼•å‘æ•°æ®åº“è‡ªå¢é”ç«äº‰ï¼ˆå¦‚ MySQL çš„ &lt;code&gt;AUTO_INCREMENT&lt;/code&gt; é”ï¼‰ï¼Œè€Œ UUID å¤©ç„¶é¿å…è¿™ä¸€é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h5 id="ä¾‹å¤–æƒ…å†µ"&gt;&lt;strong&gt;ä¾‹å¤–æƒ…å†µ&lt;/strong&gt;
&lt;/h5&gt;&lt;p&gt;å¦‚æœå¿…é¡»ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œå¯å°è¯•ä»¥ä¸‹ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨åˆ†æ‰¹æäº¤&lt;/strong&gt;ï¼šåœ¨ä»£ç ä¸­æ¯æ’å…¥ N æ¡åæ˜¾å¼è°ƒç”¨ &lt;code&gt;flush()&lt;/code&gt; å’Œ &lt;code&gt;clear()&lt;/code&gt;ï¼Œé¿å…ä¸€çº§ç¼“å­˜å†…å­˜æº¢å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“ç‰¹å®šä¼˜åŒ–&lt;/strong&gt;ï¼šæŸäº›æ•°æ®åº“ï¼ˆå¦‚ PostgreSQLï¼‰æ”¯æŒ &lt;code&gt;RETURNING&lt;/code&gt; è¯­æ³•æˆ–æ‰¹é‡è‡ªå¢ä¼˜åŒ–ï¼Œä½†é€šç”¨æ€§è¾ƒå·®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€»ç»“-7"&gt;æ€»ç»“
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¸»é”®ç±»å‹&lt;/th&gt;
&lt;th&gt;èƒ½å¦æ‰¹å¤„ç†&lt;/th&gt;
&lt;th&gt;æ€§èƒ½&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå¢ä¸»é”®&lt;/td&gt;
&lt;td&gt;âŒ&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;å°æ•°æ®é‡ã€éé«˜é¢‘æ’å…¥åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;UUID/åº”ç”¨ç”Ÿæˆ&lt;/td&gt;
&lt;td&gt;âœ…&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;å¤§æ•°æ®é‡ã€æ‰¹å¤„ç†åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨æ‰¹å¤„ç†åœºæ™¯ä¸‹ï¼Œ&lt;strong&gt;ä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼ˆå¦‚UUIDï¼‰æ˜¯ä¸ºäº†ç»•è¿‡æ•°æ®åº“ç”Ÿæˆä¸»é”®çš„é˜»å¡æ“ä½œï¼Œä»è€Œå¯ç”¨ Hibernate/JPA çš„æ‰¹å¤„ç†æœºåˆ¶ï¼Œæ˜¾è‘—æå‡æ’å…¥æ€§èƒ½&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰ä¸»é”®æ’åºèƒ½å‡å°‘é”ç«äº‰çš„æ ¸å¿ƒåŸå› ä¸&lt;strong&gt;æ•°æ®å­˜å‚¨çš„ç‰©ç†é¡ºåº&lt;/strong&gt;å’Œ&lt;strong&gt;é”çš„æŒæœ‰æ–¹å¼&lt;/strong&gt;å¯†åˆ‡ç›¸å…³ï¼Œå…·ä½“å¯é€šè¿‡ä»¥ä¸‹å››ä¸ªç»´åº¦è§£æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="é¡ºåºå†™å…¥å‡å°‘é¡µåˆ†è£‚ä¸é”èŒƒå›´æ‰©å±•"&gt;&lt;strong&gt;é¡ºåºå†™å…¥å‡å°‘é¡µåˆ†è£‚ä¸é”èŒƒå›´æ‰©å±•&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;å½“ä¸»é”®ä¸ºè‡ªå¢ç±»å‹ï¼ˆå¦‚AUTO_INCREMENTï¼‰æ—¶ï¼Œæ–°æ•°æ®ä¼šæŒ‰ä¸»é”®é¡ºåºè¿½åŠ åˆ°ç´¢å¼•æœ«å°¾çš„ç‰©ç†é¡µä¸­ã€‚è¿™ç§é¡ºåºå†™å…¥ç‰¹æ€§é¿å…äº†ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¡µåˆ†è£‚æ¦‚ç‡é™ä½&lt;/strong&gt;ï¼šæ— éœ€ä¸ºæ’å…¥æ–°è¡Œè€Œåœ¨ç´¢å¼•ä¸­é—´å¯»æ‰¾ç©ºä½ï¼Œå‡å°‘äº†é¡µåˆ†è£‚æ“ä½œï¼ˆéœ€è¦é‡æ–°åˆ†é…é¡µç©ºé—´å¹¶è°ƒæ•´B+æ ‘ç»“æ„ï¼‰ã€‚é¡µåˆ†è£‚ä¼šå¯¼è‡´å¤šä¸ªé¡µçš„é”ç«äº‰ï¼Œç”šè‡³å¯èƒ½å‡çº§ä¸ºè¡¨é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é”èŒƒå›´å›ºå®š&lt;/strong&gt;ï¼šè‡ªå¢ä¸»é”®æ¯æ¬¡æ’å…¥çš„ç‰©ç†ä½ç½®æ˜ç¡®ï¼ŒInnoDBåªéœ€å¯¹æœ€åä¸€ä¸ªé¡µåŠ è¡Œé”æˆ–é—´éš™é”ï¼Œé¿å…äº†éšæœºæ’å…¥æ—¶å¯èƒ½è§¦å‘çš„å¤šé¡µé”ç«äº‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="ç¼©çŸ­é”æŒæœ‰æ—¶é—´"&gt;&lt;strong&gt;ç¼©çŸ­é”æŒæœ‰æ—¶é—´&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æŒ‰ä¸»é”®æ’åºçš„äº‹åŠ¡æ“ä½œå…·æœ‰å¤©ç„¶çš„åŸå­æ€§ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çƒ­ç‚¹çš„åç½®å¤„ç†&lt;/strong&gt;ï¼šä¾‹å¦‚åœ¨äº‹åŠ¡ä¸­å°†å¯¹ä¸»é”®çš„æ›´æ–°æ“ä½œæ”¾åœ¨æœ€åæ‰§è¡Œï¼ˆå¦‚ç½‘é¡µ[3]çš„å½±é™¢è´¦æˆ·ä¼˜åŒ–æ¡ˆä¾‹ï¼‰ï¼Œèƒ½æ˜¾è‘—ç¼©çŸ­è¡Œé”çš„æŒæœ‰æ—¶é—´ï¼Œå‡å°‘ä¸å…¶ä»–äº‹åŠ¡çš„é”é‡å çª—å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘é”ç­‰å¾…&lt;/strong&gt;ï¼šé¡ºåºæ’å…¥æ—¶ï¼Œäº‹åŠ¡åªéœ€ç­‰å¾…å½“å‰é¡µçš„é”é‡Šæ”¾ï¼Œè€Œæ— éœ€å› æ•°æ®åˆ†æ•£åœ¨å¤šé¡µè€Œé¢‘ç¹è§¦å‘å¤šä½ç½®é”ç«äº‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="é™ä½é”çš„è¯·æ±‚é¢‘ç‡"&gt;&lt;strong&gt;é™ä½é”çš„è¯·æ±‚é¢‘ç‡&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‡ªå¢ä¸»é”®é€šè¿‡ä»¥ä¸‹æœºåˆ¶å‡å°‘é”è¯·æ±‚æ¬¡æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ’å…¥ä¼˜åŒ–&lt;/strong&gt;ï¼šé¡ºåºä¸»é”®å…è®¸Hibernate/JPAç­‰æ¡†æ¶åˆå¹¶æ‰¹é‡æ’å…¥è¯·æ±‚ï¼ˆå¦‚ä½¿ç”¨&lt;code&gt;rewriteBatchedStatements&lt;/code&gt;å‚æ•°ï¼‰ï¼Œå•æ¬¡ç½‘ç»œäº¤äº’å®Œæˆå¤šè¡Œæ’å…¥ï¼Œé™ä½é”è¯·æ±‚é¢‘ç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç´¢å¼•ç»´æŠ¤æˆæœ¬ä½&lt;/strong&gt;ï¼šä¸»é”®ç´¢å¼•æ— éœ€é¢‘ç¹è°ƒæ•´B+æ ‘ç»“æ„ï¼Œå‡å°‘äº†ç»´æŠ¤ç´¢å¼•æ—¶å¯¹ç›¸é‚»é¡µçš„é”å ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="é¿å…æ­»é”ä¸é—´éš™é”å†²çª"&gt;&lt;strong&gt;é¿å…æ­»é”ä¸é—´éš™é”å†²çª&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;éé¡ºåºä¸»é”®ï¼ˆå¦‚UUIDï¼‰ä¼šå¼•å…¥ä»¥ä¸‹é£é™©ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é—´éš™é”æ‰©æ•£&lt;/strong&gt;ï¼šéšæœºä¸»é”®å¯èƒ½å¯¼è‡´äº‹åŠ¡åœ¨ä¸åŒä½ç½®æ’å…¥æ•°æ®ï¼Œè§¦å‘å¤šä¸ªé—´éš™é”ï¼ˆGap Lockï¼‰çš„ç”³è¯·ï¼Œå¢åŠ æ­»é”æ¦‚ç‡ã€‚ä¾‹å¦‚ï¼Œäº‹åŠ¡Aé”å®šé—´éš™(5,10)ï¼Œäº‹åŠ¡Bé”å®šé—´éš™(8,15)ï¼Œä¸¤è€…å¯èƒ½å› æ’å…¥ä½ç½®é‡å è€Œäº’ç›¸ç­‰å¾…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­»é”æ£€æµ‹å¼€é”€&lt;/strong&gt;ï¼šMySQLæ£€æµ‹æ­»é”éœ€è¦éå†é”ç­‰å¾…å›¾ï¼Œé¡ºåºä¸»é”®å‡å°‘äº†é”ç­‰å¾…çš„å¤æ‚åº¦ï¼Œä»è€Œé™ä½æ­»é”æ£€æµ‹çš„è®¡ç®—é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€§èƒ½å¯¹æ¯”ä»¥mysqlä¸ºä¾‹"&gt;æ€§èƒ½å¯¹æ¯”ï¼ˆä»¥MySQLä¸ºä¾‹ï¼‰
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¸»é”®ç±»å‹&lt;/th&gt;
&lt;th&gt;é¡µåˆ†è£‚é¢‘ç‡&lt;/th&gt;
&lt;th&gt;é”æŒæœ‰æ—¶é—´&lt;/th&gt;
&lt;th&gt;æ­»é”æ¦‚ç‡&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªå¢ä¸»é”®&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;çŸ­&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;é«˜å¹¶å‘å†™å…¥ã€æ‰¹å¤„ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;UUID&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;é•¿&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;åˆ†å¸ƒå¼IDç”Ÿæˆåœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h4 id="ç»“è®º"&gt;ç»“è®º
&lt;/h4&gt;&lt;p&gt;æŒ‰ä¸»é”®æ’åºï¼ˆå¦‚ä½¿ç”¨è‡ªå¢IDï¼‰é€šè¿‡&lt;strong&gt;ç‰©ç†å­˜å‚¨é¡ºåºæ€§&lt;/strong&gt;å’Œ&lt;strong&gt;é”æ“ä½œåŸå­æ€§&lt;/strong&gt;åŒé‡ä¼˜åŒ–ï¼Œå‡å°‘äº†é¡µåˆ†è£‚ã€é”èŒƒå›´æ‰©å±•åŠé”ç­‰å¾…æ—¶é—´ï¼Œä»è€Œæ˜¾è‘—é™ä½é”ç«äº‰ã€‚åœ¨éœ€è¦é«˜å¹¶å‘å†™å…¥çš„åœºæ™¯ä¸­ï¼Œå»ºè®®ä¼˜å…ˆé€‰æ‹©é¡ºåºä¸»é”®ï¼Œå¹¶åœ¨äº‹åŠ¡è®¾è®¡ä¸­å°†çƒ­ç‚¹æ“ä½œåç½®ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–é”æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h4 id="order_updates-true"&gt;&lt;code&gt;order_updates: true&lt;/code&gt;
&lt;/h4&gt;&lt;p&gt;å½“ Hibernate é…ç½® &lt;code&gt;order_updates: true&lt;/code&gt; æ—¶ï¼Œ&lt;strong&gt;åŒä¸€æ‰¹æ¬¡å†…çš„ UPDATE è¯­å¥ä¼šæ ¹æ®å®ä½“ä¸»é”®ï¼ˆIDï¼‰è‡ªåŠ¨æ’åº&lt;/strong&gt;ã€‚è¿™ä¸€æœºåˆ¶çš„æ ¸å¿ƒç›®çš„æ˜¯ä¼˜åŒ–æ‰¹å¤„ç†æ€§èƒ½ï¼Œå…·ä½“åŸç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="æ’åºçš„ä½œç”¨"&gt;&lt;strong&gt;æ’åºçš„ä½œç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;order_updates: true&lt;/code&gt; ä¼šå¼ºåˆ¶ Hibernate å¯¹åŒä¸€æ‰¹æ¬¡å†…çš„æ‰€æœ‰ UPDATE è¯­å¥&lt;strong&gt;æŒ‰ä¸»é”®å€¼å‡åºæ’åˆ—&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- æœªå¼€å¯æ’åºæ—¶ï¼Œå¯èƒ½ä¹±åºæ‰§è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- å¼€å¯æ’åºåï¼ŒæŒ‰ä¸»é”®é¡ºåºæ‰§è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§æ’åºèƒ½å‡å°‘æ•°æ®åº“çš„ &lt;strong&gt;é”ç«äº‰&lt;/strong&gt; å’Œ &lt;strong&gt;é¡µåˆ†è£‚æ¦‚ç‡&lt;/strong&gt;ï¼ˆå°¤å…¶æ˜¯åœ¨ä¸»é”®ä¸ºè‡ªå¢ç±»å‹æ—¶ï¼‰ï¼Œæå‡æ‰¹å¤„ç†æ•ˆç‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="ä¸æ‰¹å¤„ç†æœºåˆ¶çš„ååŒ"&gt;&lt;strong&gt;ä¸æ‰¹å¤„ç†æœºåˆ¶çš„ååŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹å¤„ç†åˆå¹¶ä¼˜åŒ–&lt;/strong&gt;ï¼šæ’åºåï¼ŒHibernate å¯ä»¥å°†åŒä¸€å®ä½“çš„å¤šæ¬¡æ›´æ–°åˆå¹¶ä¸ºå•æ¡ SQLï¼ˆä¾‹å¦‚å¤šæ¬¡ &lt;code&gt;setName&lt;/code&gt; åˆå¹¶ä¸ºæœ€ç»ˆå€¼ï¼‰ï¼Œå‡å°‘é‡å¤æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘é”èŒƒå›´&lt;/strong&gt;ï¼šæŒ‰ä¸»é”®é¡ºåºæ›´æ–°æ—¶ï¼Œæ•°æ®åº“çš„é”èŒƒå›´æ›´é›†ä¸­ï¼ˆå¦‚é”å®šç›¸é‚»çš„é¡µï¼‰ï¼Œé¿å…å› ä¹±åºæ›´æ–°å¯¼è‡´çš„é”æ‰©æ•£å’Œæ­»é”é£é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="ä¸å…¶ä»–é…ç½®çš„å…³è”"&gt;&lt;strong&gt;ä¸å…¶ä»–é…ç½®çš„å…³è”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;éœ€é…åˆä»¥ä¸‹å‚æ•°æ‰èƒ½æœ€å¤§åŒ–æ•ˆæœï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;hibernate.jdbc.batch_size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;50 # å®šä¹‰æ‰¹å¤„ç†å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;hibernate.batch_versioned_data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;true # å…è®¸ç‰ˆæœ¬åŒ–æ•°æ®çš„æ‰¹å¤„ç†ï¼ˆå¦‚å¸¦ @Version å­—æ®µï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœªå¯ç”¨ &lt;code&gt;batch_versioned_data&lt;/code&gt;ï¼Œå³ä½¿å¼€å¯æ’åºï¼Œå¸¦ç‰ˆæœ¬æ§åˆ¶çš„æ›´æ–°ä»å¯èƒ½é€€åŒ–ä¸ºé€æ¡æ‰§è¡Œã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="é€‚ç”¨åœºæ™¯"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘æ›´æ–°æ“ä½œ&lt;/strong&gt;ï¼šä¾‹å¦‚æ‰¹é‡ä¿®æ”¹ç”¨æˆ·çŠ¶æ€ã€ä»·æ ¼è°ƒæ•´ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡å¯†é›†å‹ç³»ç»Ÿ&lt;/strong&gt;ï¼šé€šè¿‡æ’åºå‡å°‘é”ç«äº‰ï¼Œæå‡å¹¶å‘æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€»ç»“-8"&gt;æ€»ç»“
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;order_updates: true&lt;/code&gt; çš„æœ¬è´¨æ˜¯é€šè¿‡ &lt;strong&gt;ä¸»é”®æ’åº&lt;/strong&gt; å°†åŒä¸€æ‰¹æ¬¡å†…çš„æ›´æ–°æ“ä½œç‰©ç†ç›¸é‚»åŒ–ï¼Œä»è€Œé™ä½æ•°æ®åº“çš„é”å†²çªå’Œ I/O å‹åŠ›ã€‚è¿™ä¸€æœºåˆ¶ä¸ &lt;code&gt;order_inserts&lt;/code&gt; ç±»ä¼¼ï¼Œä½†éœ€æ³¨æ„å…¶ç”Ÿæ•ˆå‰ææ˜¯ &lt;strong&gt;åŒä¸€æ‰¹æ¬¡å†…ä»…æ“ä½œå•ä¸€è¡¨&lt;/strong&gt;ï¼Œè‹¥æ··åˆå¤šè¡¨æ›´æ–°ä»å¯èƒ½å¯¼è‡´æ‰¹å¤„ç†ä¸­æ–­ã€‚&lt;/p&gt;
&lt;h4 id="save-æˆ–-saveall"&gt;&lt;code&gt;save()&lt;/code&gt; æˆ– &lt;code&gt;saveAll()&lt;/code&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œé…ç½® &lt;code&gt;hibernate.jdbc.batch_size&lt;/code&gt; å’Œ &lt;code&gt;order_updates&lt;/code&gt; åï¼Œ&lt;strong&gt;è°ƒç”¨ &lt;code&gt;save()&lt;/code&gt; æˆ– &lt;code&gt;saveAll()&lt;/code&gt; æ–¹æ³•ä¸ä¼šè‡ªåŠ¨è§¦å‘ EntityManager çš„åˆ†æ‰¹å¤„ç†&lt;/strong&gt;ï¼Œä½† Hibernate åº•å±‚ä¼šæ ¹æ®é…ç½®å‚æ•°åœ¨äº‹åŠ¡æäº¤æ—¶è‡ªåŠ¨åˆå¹¶æ“ä½œå¹¶åˆ†æ‰¹æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="é…ç½®çš„ä½œç”¨ä¸é™åˆ¶"&gt;é…ç½®çš„ä½œç”¨ä¸é™åˆ¶
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;hibernate.jdbc.batch_size&lt;/code&gt; çš„åŠŸèƒ½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯¥å‚æ•°å®šä¹‰äº†å•ä¸ªæ‰¹å¤„ç†ä¸­ SQL è¯­å¥çš„æ•°é‡ä¸Šé™ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®ä¸º 500 æ—¶ï¼ŒHibernate ä¼šåœ¨å†…å­˜ä¸­ç´¯ç§¯æœ€å¤š 500 æ¡ SQL æ“ä½œï¼ˆå¦‚ INSERT/UPDATEï¼‰ï¼Œç„¶åä¸€æ¬¡æ€§æäº¤åˆ°æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼šä»…å¯¹ &lt;strong&gt;ç›¸åŒç±»å‹çš„ SQL æ“ä½œ&lt;/strong&gt;ï¼ˆå¦‚æ‰¹é‡æ’å…¥æˆ–æ‰¹é‡æ›´æ–°ï¼‰ç”Ÿæ•ˆï¼Œä¸”è¦æ±‚ä¸»é”®ç”Ÿæˆç­–ç•¥ &lt;strong&gt;ä¸èƒ½ä½¿ç”¨æ•°æ®åº“è‡ªå¢ ID&lt;/strong&gt;ï¼ˆå¦‚ MySQL çš„ &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;order_updates: true&lt;/code&gt; çš„ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºåˆ¶æŒ‰ä¸»é”®æ’åºæ›´æ–°æ“ä½œï¼Œå‡å°‘æ•°æ®åº“é”ç«äº‰å’Œé¡µåˆ†è£‚ï¼Œæå‡æ‰¹å¤„ç†æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="save-å’Œ-saveall-çš„æ‰¹å¤„ç†è¡Œä¸º"&gt;&lt;code&gt;save()&lt;/code&gt; å’Œ &lt;code&gt;saveAll()&lt;/code&gt; çš„æ‰¹å¤„ç†è¡Œä¸º
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;saveAll()&lt;/code&gt; çš„åº•å±‚å®ç°&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;saveAll()&lt;/code&gt; æœ¬è´¨ä¸Šæ˜¯å¾ªç¯è°ƒç”¨ &lt;code&gt;save()&lt;/code&gt; æ–¹æ³•ï¼Œé€æ¡å°†å®ä½“åŠ å…¥ Hibernate çš„æŒä¹…åŒ–ä¸Šä¸‹æ–‡ï¼ˆå³ä¸€çº§ç¼“å­˜ï¼‰ï¼Œè€Œéç›´æ¥ç”Ÿæˆæ‰¹å¤„ç† SQLã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åˆ†æ‰¹çš„è§¦å‘æ¡ä»¶&lt;/strong&gt;ï¼šå½“äº‹åŠ¡æäº¤æˆ–æ˜¾å¼è°ƒç”¨ &lt;code&gt;flush()&lt;/code&gt; æ—¶ï¼ŒHibernate ä¼šå°†ç¼“å­˜ä¸­çš„ SQL æŒ‰ &lt;code&gt;batch_size&lt;/code&gt; åˆ†æ‰¹å‘é€åˆ°æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥è°ƒç”¨ &lt;code&gt;saveAll()&lt;/code&gt; æ’å…¥ 1000 æ¡è®°å½•ï¼Œä¸” &lt;code&gt;batch_size=500&lt;/code&gt;ï¼ŒHibernate ä¼šç”Ÿæˆ &lt;strong&gt;2 æ¡æ‰¹å¤„ç† INSERT è¯­å¥&lt;/strong&gt;ï¼ˆæ¯ 500 æ¡ä¸ºä¸€ä¸ªæ‰¹æ¬¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="éœ€é…åˆçš„ä»£ç ä¼˜åŒ–"&gt;éœ€é…åˆçš„ä»£ç ä¼˜åŒ–
&lt;/h4&gt;&lt;p&gt;å³ä½¿é…ç½®æ­£ç¡®ï¼Œä»éœ€é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®ä¿æ‰¹å¤„ç†ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡è¾¹ç•Œæ§åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ‰¹é‡æ“ä½œæ–¹æ³•ä¸Šæ·»åŠ  &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchInsert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;saveAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰‹åŠ¨æ¸…ç†æŒä¹…åŒ–ä¸Šä¸‹æ–‡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºè¶…å¤§æ•°æ®é›†ï¼ˆå¦‚ 10 ä¸‡æ¡ï¼‰ï¼Œéœ€å‘¨æœŸæ€§è°ƒç”¨ &lt;code&gt;flush()&lt;/code&gt; å’Œ &lt;code&gt;clear()&lt;/code&gt;ï¼Œé¿å…å†…å­˜æº¢å‡ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;persist&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;500&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸»é”®ç”Ÿæˆç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ &lt;strong&gt;UUID æˆ–ç¨‹åºç”Ÿæˆä¸»é”®&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@GeneratedValue(generator = &amp;quot;uuid2&amp;quot;)&lt;/code&gt;ï¼‰ï¼Œç¦ç”¨æ•°æ®åº“è‡ªå¢ IDï¼Œå¦åˆ™ Hibernate ä¼šé€€åŒ–ä¸ºé€æ¡æ’å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h4 id="æ€§èƒ½å¯¹æ¯”ä¸éªŒè¯"&gt;æ€§èƒ½å¯¹æ¯”ä¸éªŒè¯
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœªå¯ç”¨æ‰¹å¤„ç†&lt;/strong&gt;ï¼š1000 æ¡æ’å…¥éœ€çº¦ 10 ç§’ï¼ˆé€æ¡æäº¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç”¨æ‰¹å¤„ç†&lt;/strong&gt;ï¼šç›¸åŒæ•°æ®é‡è€—æ—¶çº¦ 0.5 ç§’ï¼ˆåˆ† 2 æ‰¹æ‰§è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–å&lt;/strong&gt;ï¼šç»“åˆ &lt;code&gt;order_updates: true&lt;/code&gt; å’Œ &lt;code&gt;rewriteBatchedStatements=true&lt;/code&gt;ï¼ˆMySQL å‚æ•°ï¼‰ï¼Œæ€§èƒ½å¯å†æå‡ 20%ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€»ç»“-9"&gt;æ€»ç»“
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ˜¯å¦è‡ªåŠ¨åˆ†æ‰¹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ä¾èµ–æ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;save()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;éœ€äº‹åŠ¡æäº¤æˆ–æ‰‹åŠ¨ &lt;code&gt;flush()&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;saveAll()&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯ï¼ˆäº‹åŠ¡æäº¤æ—¶ï¼‰&lt;/td&gt;
&lt;td&gt;é…ç½® &lt;code&gt;batch_size&lt;/code&gt; + éè‡ªå¢ä¸»é”® + äº‹åŠ¡ç®¡ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ€§èƒ½å…³é”®ç‚¹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ä¸»é”®ç­–ç•¥ã€å†…å­˜æ¸…ç†ã€æ•°æ®åº“å‚æ•°ä¼˜åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šä¼˜å…ˆé€šè¿‡ &lt;code&gt;EntityManager&lt;/code&gt; æ‰‹åŠ¨æ§åˆ¶æ‰¹å¤„ç†æµç¨‹ï¼Œè€Œéä¾èµ– &lt;code&gt;saveAll()&lt;/code&gt; çš„é»˜è®¤è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h4 id="æ‹¼æ¥å€¼-vs-ç»“æ„åŒ–ç»‘å®š"&gt;æ‹¼æ¥å€¼ vs. ç»“æ„åŒ–ç»‘å®š
&lt;/h4&gt;&lt;p&gt;åœ¨åŠ¨æ€ç”Ÿæˆ SQL çš„ &lt;code&gt;CASE&lt;/code&gt; è¯­å¥æ—¶ï¼Œ&lt;strong&gt;ä¸ç›´æ¥å°†å€¼æ‹¼æ¥åˆ° SQL å­—ç¬¦ä¸²ä¸­&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;&amp;quot;id WHEN &amp;quot; + user.getId()&lt;/code&gt;ï¼‰ï¼Œè€Œæ˜¯é€šè¿‡å‚æ•°å ä½ç¬¦ï¼ˆå¦‚ &lt;code&gt;:id&lt;/code&gt;ï¼‰å’Œå‚æ•°ç»‘å®šçš„æ–¹å¼ï¼Œæ ¸å¿ƒåŸå› ä¸ &lt;strong&gt;SQL æ³¨å…¥é£é™©&lt;/strong&gt;ã€&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt; å’Œ &lt;strong&gt;æ•°æ®ç±»å‹å…¼å®¹æ€§&lt;/strong&gt; å¯†åˆ‡ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="sql-æ³¨å…¥é£é™©"&gt;&lt;strong&gt;SQL æ³¨å…¥é£é™©&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç›´æ¥æ‹¼æ¥å€¼åˆ° SQL è¯­å¥ä¸­ä¼šå¼•å…¥ä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ”»å‡»ç¤ºä¾‹&lt;/strong&gt;ï¼šå‡è®¾ &lt;code&gt;user.getId()&lt;/code&gt; çš„å€¼æ¥è‡ªç”¨æˆ·è¾“å…¥ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„å€¼ï¼ˆå¦‚ &lt;code&gt;1; DROP TABLE users;--&lt;/code&gt;ï¼‰ï¼Œå¯¼è‡´ SQL ç»“æ„è¢«ç¯¡æ”¹ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- æ¶æ„æ‹¼æ¥åçš„ SQL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DROP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="c1"&gt;-- THEN ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;è¿™ä¼šæ‰§è¡Œéé¢„æœŸçš„ &lt;code&gt;DROP TABLE&lt;/code&gt; æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°åŒ–é˜²å¾¡&lt;/strong&gt;ï¼šé€šè¿‡å ä½ç¬¦ï¼ˆå¦‚ &lt;code&gt;:id&lt;/code&gt;ï¼‰ç»‘å®šå€¼æ—¶ï¼Œæ•°æ®åº“é©±åŠ¨ä¼šè‡ªåŠ¨å¯¹å€¼è¿›è¡Œè½¬ä¹‰å’Œç±»å‹æ ¡éªŒï¼Œç¡®ä¿è¾“å…¥å€¼ä»…ä½œä¸ºæ•°æ®ï¼ˆè€Œéä»£ç ï¼‰å¤„ç†ï¼Œå½»åº•é¿å… SQL æ³¨å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€§èƒ½ä¼˜åŒ–"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢å¯æå‡æ•°æ®åº“æ‰§è¡Œæ•ˆç‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œè®¡åˆ’å¤ç”¨&lt;/strong&gt;ï¼šæ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰ä¼šç¼“å­˜ç›¸åŒ SQL æ¨¡æ¿çš„æ‰§è¡Œè®¡åˆ’ã€‚å¦‚æœç›´æ¥æ‹¼æ¥å€¼ï¼Œæ¯ä¸ªä¸åŒçš„ &lt;code&gt;id&lt;/code&gt; ä¼šç”Ÿæˆå”¯ä¸€çš„ SQLï¼ˆå¦‚ &lt;code&gt;WHEN 1&lt;/code&gt;ã€&lt;code&gt;WHEN 2&lt;/code&gt;ï¼‰ï¼Œå¯¼è‡´æ‰§è¡Œè®¡åˆ’æ— æ³•å¤ç”¨ï¼Œå¢åŠ æ•°æ®åº“è§£æå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æ“ä½œä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡å‚æ•°ç»‘å®šï¼ˆå¦‚ &lt;code&gt;params.put(&amp;quot;id&amp;quot; + user.getId(), ...)&lt;/code&gt;ï¼‰ï¼Œå¯å°†å¤šä¸ªæ“ä½œåˆå¹¶ä¸ºå•æ¬¡é¢„ç¼–è¯‘ SQL æ‰§è¡Œï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ•°æ®ç±»å‹å…¼å®¹æ€§"&gt;&lt;strong&gt;æ•°æ®ç±»å‹å…¼å®¹æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;ç›´æ¥æ‹¼æ¥å€¼å¯èƒ½å¯¼è‡´éšå¼ç±»å‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦ä¸²æœªè½¬ä¹‰&lt;/strong&gt;ï¼šè‹¥ &lt;code&gt;user.getId()&lt;/code&gt; æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚ UUIDï¼‰ï¼Œç›´æ¥æ‹¼æ¥ä¼šç¼ºå¤±å¿…è¦çš„å¼•å·ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- é”™è¯¯ç¤ºä¾‹ï¼ˆUUID æœªåŠ å¼•å·ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;d61d5a1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1234&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5678&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="n"&gt;ab&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;cdef12345678&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- æ­£ç¡®å†™æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;6d61d5a1-1234-5678-90ab-cdef12345678&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;å¯¼è‡´è¯­æ³•é”™è¯¯æˆ–é€»è¾‘é”™è¯¯ï¼ˆå¦‚å°† UUID è¯¯åˆ¤ä¸ºæ•°å€¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°åŒ–è‡ªåŠ¨å¤„ç†&lt;/strong&gt;ï¼šé€šè¿‡å ä½ç¬¦ç»‘å®šå€¼æ—¶ï¼Œæ•°æ®åº“é©±åŠ¨ä¼šæ ¹æ®å‚æ•°ç±»å‹è‡ªåŠ¨æ·»åŠ å¼•å·æˆ–è½¬æ¢æ ¼å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="ä»£ç å¯ç»´æŠ¤æ€§å¯¹æ¯”"&gt;&lt;strong&gt;ä»£ç å¯ç»´æŠ¤æ€§å¯¹æ¯”&lt;/strong&gt;
&lt;/h4&gt;&lt;h5 id="é”™è¯¯å†™æ³•ç›´æ¥æ‹¼æ¥å€¼"&gt;é”™è¯¯å†™æ³•ï¼ˆç›´æ¥æ‹¼æ¥å€¼ï¼‰
&lt;/h5&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç›´æ¥æ‹¼æ¥å€¼ï¼šå­˜åœ¨ SQL æ³¨å…¥å’Œç±»å‹é”™è¯¯é£é™©&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;WHEN &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; THEN &amp;#39;&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;&amp;#39; &amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”Ÿæˆçš„ SQLï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Alice&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;456&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Robert&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DROP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="c1"&gt;--&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”»å‡»è€…å¯é€šè¿‡ &lt;code&gt;user.setName(&amp;quot;Robert'; DROP TABLE users;--&amp;quot;)&lt;/code&gt; æ³¨å…¥æ¶æ„ä»£ç ã€‚&lt;/p&gt;
&lt;h5 id="æ­£ç¡®å†™æ³•å‚æ•°ç»‘å®š"&gt;æ­£ç¡®å†™æ³•ï¼ˆå‚æ•°ç»‘å®šï¼‰
&lt;/h5&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä½¿ç”¨å‚æ•°å ä½ç¬¦ï¼ˆå¦‚ :id_1, :name_1ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;paramId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id_&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;paramName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name_&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;WHEN :&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;paramId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; THEN :&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;paramName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;paramId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;paramName&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”Ÿæˆçš„ SQL å’Œå‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id_123&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;name_123&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id_456&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;name_456&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;123&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name_123&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id_456&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;456&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name_456&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Robert&amp;#39;; DROP TABLE users;--&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å³ä½¿ &lt;code&gt;user.getName()&lt;/code&gt; åŒ…å«æ¶æ„å­—ç¬¦ï¼Œæ•°æ®åº“ä¹Ÿä¼šå°†å…¶è§†ä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼Œè€Œéå¯æ‰§è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id="ç‰¹æ®Šåœºæ™¯çš„æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;ç‰¹æ®Šåœºæ™¯çš„æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€å­—æ®µå&lt;/strong&gt;ï¼šå¦‚æœå­—æ®µåï¼ˆå¦‚ &lt;code&gt;id&lt;/code&gt;ï¼‰ä¹Ÿéœ€è¦åŠ¨æ€ç”Ÿæˆï¼Œå¿…é¡»é€šè¿‡ç™½åå•æ ¡éªŒï¼Œè€Œéç›´æ¥æ‹¼æ¥ï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// å®‰å…¨åšæ³•ï¼šä»…å…è®¸é¢„å®šä¹‰çš„å­—æ®µå&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;allowedColumns&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;allowedColumns&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;contains&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;column&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Invalid column&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;CASE &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;column&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; ...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°å€¼ç±»å‹å¤„ç†&lt;/strong&gt;ï¼šå³ä½¿ &lt;code&gt;user.getId()&lt;/code&gt; æ˜¯æ•°å€¼ç±»å‹ï¼Œç›´æ¥æ‹¼æ¥ä»å¯èƒ½å› éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼ˆå¦‚ &lt;code&gt;WHERE id = '123'&lt;/code&gt; å°†æ•°å€¼å­—æ®µè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="æ€»ç»“-10"&gt;æ€»ç»“
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å¯ç»´æŠ¤æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç›´æ¥æ‹¼æ¥å€¼&lt;/td&gt;
&lt;td&gt;âŒ é«˜é£é™©&lt;/td&gt;
&lt;td&gt;âŒ å·®&lt;/td&gt;
&lt;td&gt;âŒ ä½&lt;/td&gt;
&lt;td&gt;æ— ï¼ˆæ°¸è¿œä¸è¦ä½¿ç”¨ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å‚æ•°åŒ–ç»‘å®š&lt;/td&gt;
&lt;td&gt;âœ… å®‰å…¨&lt;/td&gt;
&lt;td&gt;âœ… é«˜&lt;/td&gt;
&lt;td&gt;âœ… é«˜&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰åŠ¨æ€ SQL åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;å§‹ç»ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢&lt;/strong&gt;ï¼Œæ—¢èƒ½é˜²å¾¡ SQL æ³¨å…¥ï¼Œåˆèƒ½æå‡æ€§èƒ½å’Œä»£ç å¥å£®æ€§ã€‚&lt;/p&gt;
&lt;h2 id="kafka-ç»“åˆ-saveall"&gt;Kafka ç»“åˆ saveAll
&lt;/h2&gt;&lt;p&gt;ç»“åˆ Kafka æ¶ˆæ¯é˜Ÿåˆ—å’Œ JPA çš„ &lt;code&gt;saveAll&lt;/code&gt;ï¼ˆæˆ– &lt;code&gt;EntityManager&lt;/code&gt; æ‰¹é‡å¤„ç†ï¼‰&lt;strong&gt;åœ¨ç‰¹å®šåœºæ™¯ä¸‹æ˜¯å¿…è¦ä¸”æœ‰ä»·å€¼çš„&lt;/strong&gt;ï¼Œä½†éœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚ã€æ•°æ®è§„æ¨¡ã€æ€§èƒ½ç›®æ ‡ç­‰å› ç´ ç»¼åˆåˆ¤æ–­ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯ä¸å¿…è¦æ€§åˆ†æ"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯ä¸å¿…è¦æ€§åˆ†æ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é«˜å¹¶å‘å†™å…¥ä¸å¼‚æ­¥å‰Šå³°"&gt;&lt;strong&gt;é«˜å¹¶å‘å†™å…¥ä¸å¼‚æ­¥å‰Šå³°&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka çš„ä½œç”¨&lt;/strong&gt;ï¼šä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒKafka å¯ä»¥é€šè¿‡ &lt;strong&gt;å¼‚æ­¥ç¼“å†²æœºåˆ¶&lt;/strong&gt; ç¼“è§£ç¬æ—¶é«˜å¹¶å‘å†™å…¥å‹åŠ›ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¯·æ±‚ç›´æ¥å‘é€åˆ° Kafka é˜Ÿåˆ—ï¼Œé¿å…æ•°æ®åº“å› çªå‘æµé‡è¿‡è½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;saveAll&lt;/code&gt; çš„ä½œç”¨&lt;/strong&gt;ï¼šæ¶ˆè´¹è€…ä» Kafka æ‹‰å–æ¶ˆæ¯åï¼Œé€šè¿‡æ‰¹é‡å¤„ç†ï¼ˆå¦‚ &lt;code&gt;saveAll&lt;/code&gt;ï¼‰å°†æ•°æ®ä¸€æ¬¡æ€§å†™å…¥æ•°æ®åº“ï¼Œå‡å°‘äº‹åŠ¡æäº¤æ¬¡æ•°å’Œç½‘ç»œå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¸å‹åœºæ™¯&lt;/strong&gt;ï¼šç”µå•†ç§’æ€ã€ç‰©è”ç½‘è®¾å¤‡æ•°æ®ä¸ŠæŠ¥ç­‰éœ€è¦ &lt;strong&gt;å‰Šå³°å¡«è°·&lt;/strong&gt; çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ•°æ®è§£è€¦ä¸å¯é æ€§"&gt;&lt;strong&gt;æ•°æ®è§£è€¦ä¸å¯é æ€§&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka çš„æŒä¹…åŒ–&lt;/strong&gt;ï¼šæ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶æ”¯æŒå‰¯æœ¬æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®åœ¨ç³»ç»Ÿå´©æºƒæˆ–æ¶ˆè´¹è€…æ•…éšœæ—¶ä¸ä¼šä¸¢å¤±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡æäº¤çš„åŸå­æ€§&lt;/strong&gt;ï¼šé€šè¿‡ &lt;code&gt;saveAll&lt;/code&gt; çš„æ‰¹é‡æ“ä½œï¼Œç»“åˆæ•°æ®åº“äº‹åŠ¡ï¼Œå¯ä¿è¯ä¸€æ‰¹æ•°æ®çš„åŸå­æ€§å†™å…¥ï¼Œé¿å…éƒ¨åˆ†å¤±è´¥å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å®æ—¶æ€§ä¸å»¶è¿Ÿå®¹å¿"&gt;&lt;strong&gt;å®æ—¶æ€§ä¸å»¶è¿Ÿå®¹å¿&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€å®æ—¶å¤„ç†çš„åœºæ™¯&lt;/strong&gt;ï¼šè‹¥ä¸šåŠ¡è¦æ±‚æ•°æ®å†™å…¥åç«‹å³æŸ¥è¯¢ï¼ˆå¦‚é‡‘èäº¤æ˜“ï¼‰ï¼Œç›´æ¥ä½¿ç”¨ &lt;code&gt;saveAll&lt;/code&gt; æ›´åˆé€‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯å®¹å¿å»¶è¿Ÿçš„åœºæ™¯&lt;/strong&gt;ï¼šè‹¥æ•°æ®å…è®¸å¼‚æ­¥å¤„ç†ï¼ˆå¦‚æ—¥å¿—åˆ†æã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼‰ï¼Œé€šè¿‡ Kafka ç¼“å†² + æ‰¹é‡æ¶ˆè´¹å†™å…¥æ•°æ®åº“ï¼Œå¯æå‡ç³»ç»Ÿæ•´ä½“ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹"&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="kafka-é…ç½®ä¼˜åŒ–"&gt;&lt;strong&gt;Kafka é…ç½®ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹é‡å‘é€&lt;/strong&gt;ï¼šç”Ÿäº§è€…é…ç½® &lt;code&gt;batch.size&lt;/code&gt;ï¼ˆå¦‚ 16KBï¼‰å’Œ &lt;code&gt;linger.ms&lt;/code&gt;ï¼ˆå¦‚ 20msï¼‰ï¼Œç§¯ç´¯è¶³å¤Ÿæ¶ˆæ¯åæ‰¹é‡å‘é€ï¼Œå‡å°‘ç½‘ç»œ I/Oã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›¶æ‹·è´æŠ€æœ¯&lt;/strong&gt;ï¼šå¯ç”¨ &lt;code&gt;sendfile&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨ï¼Œé¿å…å†…æ ¸æ€ä¸ç”¨æˆ·æ€ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œé™ä½ CPU è´Ÿè½½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‹ç¼©ç®—æ³•&lt;/strong&gt;ï¼šä½¿ç”¨ LZ4 æˆ– Zstd å‹ç¼©æ¶ˆæ¯ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼ˆå¯¹æ–‡æœ¬ç±»æ•°æ®æ•ˆæœæ˜¾è‘—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="jpa-æ‰¹é‡å¤„ç†ä¼˜åŒ–"&gt;&lt;strong&gt;JPA æ‰¹é‡å¤„ç†ä¼˜åŒ–&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰¹å¤„ç†å‚æ•°&lt;/strong&gt;ï¼šé…ç½® &lt;code&gt;hibernate.jdbc.batch_size=500&lt;/code&gt; å’Œ &lt;code&gt;order_updates=true&lt;/code&gt;ï¼Œåˆå¹¶ SQL æ“ä½œå¹¶æŒ‰ä¸»é”®æ’åºï¼Œå‡å°‘é”ç«äº‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æ§åˆ¶&lt;/strong&gt;ï¼šåœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­å¼€å¯äº‹åŠ¡ï¼Œç¡®ä¿ä¸€æ‰¹æ¶ˆæ¯å¤„ç†å®Œæˆåç»Ÿä¸€æäº¤ï¼Œé¿å…é€æ¡æäº¤çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜ç®¡ç†&lt;/strong&gt;ï¼šå®šæœŸè°ƒç”¨ &lt;code&gt;EntityManager.flush()&lt;/code&gt; å’Œ &lt;code&gt;clear()&lt;/code&gt;ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆå°¤å…¶æ˜¯å¤„ç†ç™¾ä¸‡çº§æ•°æ®æ—¶ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="æ¶ˆè´¹è€…å¹¶è¡Œåº¦"&gt;&lt;strong&gt;æ¶ˆè´¹è€…å¹¶è¡Œåº¦&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†åŒºä¸çº¿ç¨‹æ•°åŒ¹é…&lt;/strong&gt;ï¼šKafka Topic çš„åˆ†åŒºæ•°ï¼ˆPartitionï¼‰åº”ä¸æ¶ˆè´¹è€…çº¿ç¨‹æ•°ä¸€è‡´ï¼Œæœ€å¤§åŒ–å¹¶è¡Œæ¶ˆè´¹èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç»„è´Ÿè½½å‡è¡¡&lt;/strong&gt;ï¼šé€šè¿‡å¤šæ¶ˆè´¹è€…å®ä¾‹åˆ†æ‘Šå¤„ç†å‹åŠ›ï¼Œç»“åˆ &lt;code&gt;saveAll&lt;/code&gt; æ‰¹é‡å†™å…¥æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸é€‚ç”¨åœºæ™¯ä¸æ›¿ä»£æ–¹æ¡ˆ"&gt;&lt;strong&gt;ä¸é€‚ç”¨åœºæ™¯ä¸æ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="ä½å¹¶å‘æˆ–å°æ•°æ®é‡"&gt;&lt;strong&gt;ä½å¹¶å‘æˆ–å°æ•°æ®é‡&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;saveAll&lt;/code&gt;&lt;/strong&gt;ï¼šè‹¥æ•°æ®é‡å°ï¼ˆå¦‚å•æ¬¡æ“ä½œ &amp;lt;1000 æ¡ï¼‰ï¼Œå¼•å…¥ Kafka ä¼šå¢åŠ æ¶æ„å¤æ‚åº¦ï¼Œå¾—ä¸å¿å¤±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥å¤„ç†æ›´ç®€å•&lt;/strong&gt;ï¼šä¾‹å¦‚ç®¡ç†åå°çš„æ‰¹é‡å¯¼å…¥åŠŸèƒ½ï¼Œæ— éœ€å¼‚æ­¥ç¼“å†²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="å¼ºäº‹åŠ¡ä¸€è‡´æ€§éœ€æ±‚"&gt;&lt;strong&gt;å¼ºäº‹åŠ¡ä¸€è‡´æ€§éœ€æ±‚&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ¬åœ°äº‹åŠ¡ä¼˜å…ˆ&lt;/strong&gt;ï¼šè‹¥ä¸šåŠ¡è¦æ±‚æ•°æ®åº“å†™å…¥ä¸åç»­æ“ä½œï¼ˆå¦‚å‘é€çŸ­ä¿¡ï¼‰ä¿æŒåŸå­æ€§ï¼Œåº”ä½¿ç”¨æœ¬åœ°äº‹åŠ¡è€Œéæ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¡¥å¿æœºåˆ¶æ›¿ä»£&lt;/strong&gt;ï¼šå¯é€šè¿‡ Saga æ¨¡å¼æˆ–äº‹åŠ¡æ€§å‘ä»¶ç®±ï¼ˆTransactional Outboxï¼‰å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ¶æ„å†³ç­–æµç¨‹å›¾"&gt;&lt;strong&gt;æ¶æ„å†³ç­–æµç¨‹å›¾&lt;/strong&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-plaintext" data-lang="plaintext"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;æ˜¯å¦éœ€è¦åº”å¯¹ç¬æ—¶é«˜å¹¶å‘ï¼Ÿ â€”â€”æ˜¯â€”â€”â†’ å¼•å…¥ Kafka ç¼“å†²
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; å¦
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â†“
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;æ˜¯å¦éœ€è·¨ç³»ç»Ÿè§£è€¦ï¼Ÿ â€”â€”æ˜¯â€”â€”â†’ å¼•å…¥ Kafka å¼‚æ­¥é€šä¿¡
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; å¦
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; â†“
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ç›´æ¥ä½¿ç”¨ JPA æ‰¹é‡å¤„ç†ï¼ˆsaveAllï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“å»ºè®®"&gt;&lt;strong&gt;æ€»ç»“å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ€§èƒ½æ”¶ç›Š&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;é«˜å¹¶å‘å†™å…¥ + å¼‚æ­¥å¤„ç†&lt;/td&gt;
&lt;td&gt;Kafka + &lt;code&gt;saveAll&lt;/code&gt; æ‰¹é‡æ¶ˆè´¹&lt;/td&gt;
&lt;td&gt;ååé‡æå‡ 5-10 å€ï¼ˆå®æµ‹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®è§£è€¦ + é«˜å¯é æ€§&lt;/td&gt;
&lt;td&gt;Kafka æŒä¹…åŒ– + æ¶ˆè´¹è€…é‡è¯•æœºåˆ¶&lt;/td&gt;
&lt;td&gt;æ•°æ®ä¸¢å¤±ç‡è¶‹è¿‘äº 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä½å»¶è¿Ÿ + å¼ºä¸€è‡´æ€§&lt;/td&gt;
&lt;td&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;saveAll&lt;/code&gt; + æœ¬åœ°äº‹åŠ¡&lt;/td&gt;
&lt;td&gt;å»¶è¿Ÿ &amp;lt;100msï¼Œæ•°æ®ç«‹å³å¯æŸ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒåŸåˆ™&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜å…ˆé€šè¿‡ &lt;strong&gt;å‹æµ‹&lt;/strong&gt; éªŒè¯æ–¹æ¡ˆå¯è¡Œæ€§ï¼Œç›‘æ§ Kafka å †ç§¯é‡ï¼ˆLagï¼‰å’Œæ•°æ®åº“å†™å…¥å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;è‹¥é€‰æ‹©ç»“åˆæ–¹æ¡ˆï¼Œéœ€è®¾è®¡å®Œå–„çš„ &lt;strong&gt;é”™è¯¯å¤„ç†&lt;/strong&gt;ï¼ˆå¦‚æ­»ä¿¡é˜Ÿåˆ—ï¼‰å’Œ &lt;strong&gt;ç›‘æ§æŠ¥è­¦&lt;/strong&gt; æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="save"&gt;&lt;code&gt;save()&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œ&lt;code&gt;save()&lt;/code&gt; æ–¹æ³•åœ¨ä¿å­˜å¤±è´¥æ—¶&lt;strong&gt;ä¸ä¼šè¿”å› &lt;code&gt;null&lt;/code&gt;&lt;/strong&gt;ï¼Œè€Œæ˜¯ä¼š&lt;strong&gt;æŠ›å‡ºå¼‚å¸¸&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="save-1"&gt;&lt;strong&gt;&lt;code&gt;save()&lt;/code&gt; æ–¹æ³•çš„è¡Œä¸º&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­£å¸¸æƒ…å†µ&lt;/strong&gt;ï¼šå½“è°ƒç”¨ &lt;code&gt;save()&lt;/code&gt; æ–¹æ³•æ—¶ï¼Œè‹¥å®ä½“å¯¹è±¡çš„ä¸»é”®ï¼ˆ&lt;code&gt;@Id&lt;/code&gt;ï¼‰ä¸å­˜åœ¨æˆ–éœ€è¦æ’å…¥æ–°è®°å½•ï¼ŒJPA ä¼šæ‰§è¡Œ &lt;code&gt;INSERT&lt;/code&gt; æ“ä½œï¼›è‹¥ä¸»é”®å·²å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ &lt;code&gt;UPDATE&lt;/code&gt; æ“ä½œã€‚æ— è®ºå“ªç§æƒ…å†µï¼ŒæˆåŠŸæ—¶å‡è¿”å›ä¿å­˜åçš„å®ä½“å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤±è´¥æƒ…å†µ&lt;/strong&gt;ï¼šå¦‚æœä¿å­˜è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ˆä¾‹å¦‚è¿åæ•°æ®åº“çº¦æŸã€å­—æ®µé•¿åº¦è¶…é™ã€äº‹åŠ¡å›æ»šç­‰ï¼‰ï¼ŒJPA ä¼šæŠ›å‡ºå…·ä½“çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆå¦‚ &lt;code&gt;DataIntegrityViolationException&lt;/code&gt;ã€&lt;code&gt;ConstraintViolationException&lt;/code&gt; ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¼‚å¸¸å¤„ç†æœºåˆ¶"&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Data JPA çš„å¼‚å¸¸å¤„ç†åŸºäº Spring çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æ–¹æ³•æ ‡æ³¨äº† &lt;code&gt;@Transactional&lt;/code&gt;ï¼Œäº‹åŠ¡ä¼šåœ¨å¼‚å¸¸æ—¶å›æ»šï¼Œä¸”å¼‚å¸¸ä¼šå‘ä¸Šä¼ æ’­ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æœªæ•è·å¼‚å¸¸ï¼Œç¨‹åºä¼šç›´æ¥ç»ˆæ­¢ï¼›è‹¥é€šè¿‡ &lt;code&gt;try-catch&lt;/code&gt; æ•è·å¼‚å¸¸ï¼Œåˆ™å¯ä»¥åœ¨ä»£ç ä¸­å¤„ç†é”™è¯¯é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä¼šå› äº‹åŠ¡å›æ»šè€ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œéè¿”å› &lt;code&gt;null&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;saveEntity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Entity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entity&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entity&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¦‚æœå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸è€Œéè¿”å› null&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="ä¸ºä»€ä¹ˆä¸ä¼šè¿”å›"&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸ä¼šè¿”å› &lt;code&gt;null&lt;/code&gt;ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡åŸåˆ™&lt;/strong&gt;ï¼šJPA çš„ &lt;code&gt;save()&lt;/code&gt; æ–¹æ³•è¿”å›çš„æ˜¯æŒä¹…åŒ–åçš„å®ä½“å¯¹è±¡ï¼ˆå¯èƒ½åŒ…å«è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®ï¼‰ã€‚è‹¥è¿”å› &lt;code&gt;null&lt;/code&gt;ï¼Œå¼€å‘è€…æ— æ³•åŒºåˆ†â€œä¿å­˜æˆåŠŸä½†è¿”å›ç©ºå¯¹è±¡â€å’Œâ€œä¿å­˜å¤±è´¥â€ä¸¤ç§åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿«ç…§æœºåˆ¶&lt;/strong&gt;ï¼šJPA æ‰˜ç®¡çŠ¶æ€ï¼ˆPersistentï¼‰çš„å®ä½“ä¼šåœ¨äº‹åŠ¡æäº¤æ—¶è‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®åº“ã€‚è‹¥ä¿å­˜è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œäº‹åŠ¡ä¼šå›æ»šï¼Œå®ä½“çŠ¶æ€ä¸ä¼šè¢«ä¿®æ”¹ï¼Œå› æ­¤æ— éœ€é€šè¿‡è¿”å›å€¼è¡¨ç¤ºå¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å®é™…åœºæ™¯éªŒè¯"&gt;&lt;strong&gt;å®é™…åœºæ™¯éªŒè¯&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å‚è€ƒæœç´¢ç»“æœä¸­çš„æ¡ˆä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ç”¨æˆ·é€šè¿‡ &lt;code&gt;findById()&lt;/code&gt; è·å–æ‰˜ç®¡çŠ¶æ€çš„å®ä½“å¹¶è¿›è¡Œä¿®æ”¹ï¼ˆå¦‚ &lt;code&gt;setDatasetPath()&lt;/code&gt;ï¼‰æ—¶ï¼Œå³ä½¿æœªæ˜¾å¼è°ƒç”¨ &lt;code&gt;save()&lt;/code&gt;ï¼Œäº‹åŠ¡æäº¤æ—¶ä»ä¼šè‡ªåŠ¨è§¦å‘æ›´æ–°ã€‚è‹¥æ›´æ–°å¤±è´¥ï¼ˆå¦‚å­—æ®µè¶…é•¿ï¼‰ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œéé™é»˜è¿”å› &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-11"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æˆåŠŸ&lt;/strong&gt;ï¼šè¿”å›æ›´æ–°åçš„å®ä½“å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤±è´¥&lt;/strong&gt;ï¼šæŠ›å‡ºå…·ä½“çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œéœ€é€šè¿‡å¼‚å¸¸å¤„ç†æœºåˆ¶æ•è·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»ºè®®&lt;/strong&gt;ï¼šåœ¨è°ƒç”¨ &lt;code&gt;save()&lt;/code&gt; æ—¶ç»“åˆäº‹åŠ¡ç®¡ç†å’Œå¼‚å¸¸æ•è·ï¼Œä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entity&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DataIntegrityViolationException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†æ•°æ®åº“çº¦æŸé”™è¯¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è‹¥æœ‰å…¶ä»–ç‰¹å®šåœºæ™¯ï¼ˆå¦‚æ‰‹åŠ¨è¿”å› &lt;code&gt;null&lt;/code&gt;ï¼‰ï¼Œéœ€è¦è‡ªå®šä¹‰å®ç°é€»è¾‘ï¼Œä½†æ ‡å‡† &lt;code&gt;save()&lt;/code&gt; æ–¹æ³•ä¸ä¼šè¿”å› &lt;code&gt;null&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="è‡ªå®šä¹‰deleteæ–¹æ³•"&gt;è‡ªå®šä¹‰deleteæ–¹æ³•
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œä½ æä¾›çš„ä»£ç &lt;strong&gt;ä¸ä¼šå› ä¸º &lt;code&gt;pid&lt;/code&gt; æˆ– &lt;code&gt;uid&lt;/code&gt; ä¸åŒ¹é…è€ŒæŠ›å‡ºå¼‚å¸¸&lt;/strong&gt;ï¼Œä½†ä¼šæ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³è¿”å›ä¸åŒçš„è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä»£ç è¡Œä¸ºè§£æ"&gt;&lt;strong&gt;ä»£ç è¡Œä¸ºè§£æ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä½ çš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Modifying&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;update Comment c set c.negativeCount = c.negativeCount + 1 where c.id = :id and c.post.id = :pid and c.user.id = :uid&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;deleteComment&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;pid&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;uid&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ‰§è¡Œé€»è¾‘&lt;/strong&gt;ï¼šæ­¤æ–¹æ³•æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ &lt;code&gt;UPDATE&lt;/code&gt; æ“ä½œï¼Œä»…å½“ &lt;code&gt;id&lt;/code&gt;ã€&lt;code&gt;post.id&lt;/code&gt;ï¼ˆpidï¼‰ã€&lt;code&gt;user.id&lt;/code&gt;ï¼ˆuidï¼‰&lt;strong&gt;ä¸‰è€…åŒæ—¶åŒ¹é…&lt;/strong&gt;æ—¶ï¼Œæ‰ä¼šæ›´æ–° &lt;code&gt;negativeCount&lt;/code&gt; å­—æ®µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸åŒ¹é…åœºæ™¯&lt;/strong&gt;ï¼šè‹¥ &lt;code&gt;id&lt;/code&gt; æ­£ç¡®ä½† &lt;code&gt;pid&lt;/code&gt; æˆ– &lt;code&gt;uid&lt;/code&gt; ä¸åŒ¹é…ï¼Œ&lt;strong&gt;ä¸ä¼šè§¦å‘ä»»ä½•æ›´æ–°æ“ä½œ&lt;/strong&gt;ï¼Œä¸”&lt;strong&gt;ä¸ä¼šæŠ›å‡ºå¼‚å¸¸&lt;/strong&gt;ï¼Œè€Œæ˜¯è¿”å› &lt;code&gt;0&lt;/code&gt;ï¼ˆè¡¨ç¤ºæœªæ›´æ–°ä»»ä½•è®°å½•ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ä¸ºä½•ä¸æŠ›å‡ºå¼‚å¸¸"&gt;&lt;strong&gt;ä¸ºä½•ä¸æŠ›å‡ºå¼‚å¸¸ï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JPA çš„è®¾è®¡åŸåˆ™&lt;/strong&gt;ï¼šSpring Data JPA çš„ &lt;code&gt;@Modifying&lt;/code&gt; æ–¹æ³•é»˜è®¤å°†&lt;strong&gt;æœªåŒ¹é…åˆ°è®°å½•&lt;/strong&gt;è§†ä¸ºæ­£å¸¸åœºæ™¯ï¼Œè€Œéé”™è¯¯ã€‚è¿™ä¸ &lt;code&gt;deleteById()&lt;/code&gt; çš„è¡Œä¸ºä¸åŒï¼ˆåè€…ä¼šæŠ›å‡º &lt;code&gt;EmptyResultDataAccessException&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿”å›å€¼ç±»å‹&lt;/strong&gt;ï¼šä½ å®šä¹‰çš„æ–¹æ³•è¿”å›ç±»å‹ä¸º &lt;code&gt;void&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;@Modifying&lt;/code&gt; çš„ &lt;code&gt;UPDATE&lt;/code&gt;/&lt;code&gt;DELETE&lt;/code&gt; æ“ä½œå®é™…è¿”å›çš„æ˜¯&lt;strong&gt;å—å½±å“çš„è¡Œæ•°&lt;/strong&gt;ã€‚è‹¥éœ€æ•è·æœªæ›´æ–°çš„æƒ…å†µï¼Œå¯æ”¹ä¸º &lt;code&gt;int&lt;/code&gt; ç±»å‹å¹¶æ£€æŸ¥è¿”å›å€¼ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;affectedRows&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;deleteComment&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;affectedRows&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†æœªåŒ¹é…åˆ°è®°å½•çš„æƒ…å†µ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å¯èƒ½æŠ›å‡ºçš„å…¶ä»–å¼‚å¸¸"&gt;&lt;strong&gt;å¯èƒ½æŠ›å‡ºçš„å…¶ä»–å¼‚å¸¸&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æƒ…å†µä¼šè§¦å‘å¼‚å¸¸ï¼Œä½†ä¸ä½ æè¿°çš„ &lt;code&gt;pid&lt;/code&gt;/&lt;code&gt;uid&lt;/code&gt; ä¸åŒ¹é…æ— å…³ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡æœªå¯ç”¨&lt;/strong&gt;ï¼šè‹¥æœªæ·»åŠ  &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£ï¼Œä¼šæŠ›å‡º &lt;code&gt;TransactionRequiredException&lt;/code&gt;ï¼ˆä½†ä½ çš„ä»£ç å·²æ­£ç¡®æ·»åŠ ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SQL è¯­æ³•é”™è¯¯&lt;/strong&gt;ï¼šè‹¥ &lt;code&gt;@Query&lt;/code&gt; ä¸­çš„ JPQL è¯­å¥å­˜åœ¨è¯­æ³•é”™è¯¯ï¼ˆå¦‚å­—æ®µåæ‹¼å†™é”™è¯¯ï¼‰ï¼Œä¼šæŠ›å‡º &lt;code&gt;QuerySyntaxException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“çº¦æŸå†²çª&lt;/strong&gt;ï¼šä¾‹å¦‚å­—æ®µé•¿åº¦è¶…é™ã€å¤–é”®çº¦æŸç­‰ï¼Œä¼šæŠ›å‡º &lt;code&gt;DataIntegrityViolationException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="4å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ›´æ–°æˆåŠŸ"&gt;4&lt;strong&gt;å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ›´æ–°æˆåŠŸï¼Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;å»ºè®®é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†æœªåŒ¹é…åˆ°è®°å½•çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€&lt;/strong&gt;ï¼šä¿®æ”¹æ–¹æ³•è¿”å›å€¼ä¸º &lt;code&gt;int&lt;/code&gt;ï¼Œç›´æ¥æ£€æŸ¥å—å½±å“è¡Œæ•°ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Modifying&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;update Comment c ...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;deleteComment&lt;/span&gt;&lt;span class="p"&gt;(...);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å›å—å½±å“è¡Œæ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒ&lt;/strong&gt;ï¼šåœ¨è°ƒç”¨æ–¹æ³•åï¼Œé€šè¿‡ &lt;code&gt;existsById(id)&lt;/code&gt; éªŒè¯è®°å½•æ˜¯å¦ä»å­˜åœ¨ï¼ˆè‹¥ä¸ºåˆ é™¤æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-12"&gt;æ€»ç»“
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;pid&lt;/code&gt;/&lt;code&gt;uid&lt;/code&gt; ä¸åŒ¹é…&lt;/strong&gt;ï¼šä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä»…é™é»˜è¿”å› &lt;code&gt;0&lt;/code&gt; å—å½±å“è¡Œæ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦ä¸»åŠ¨å¤„ç†&lt;/strong&gt;ï¼šè‹¥ä¸šåŠ¡é€»è¾‘è¦æ±‚ä¸¥æ ¼åŒ¹é…æ¡ä»¶ï¼Œéœ€é€šè¿‡è¿”å›å€¼æˆ–é¢å¤–æŸ¥è¯¢éªŒè¯æ“ä½œç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡å®Œæ•´æ€§&lt;/strong&gt;ï¼šå½“å‰ä»£ç çš„ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£å·²ä¿è¯äº‹åŠ¡æ­£ç¡®æ€§ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spring Data JPA çš„ &lt;code&gt;.save()&lt;/code&gt; æ–¹æ³•æœªåœ¨å‡½æ•°ç­¾åä¸­å£°æ˜ &lt;code&gt;throws ...Exception&lt;/code&gt;ï¼Œä¸»è¦ä¸å…¶è®¾è®¡å“²å­¦ã€å¼‚å¸¸å¤„ç†æœºåˆ¶åŠäº‹åŠ¡ç®¡ç†ç­–ç•¥ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºäºéå—æ£€å¼‚å¸¸unchecked-exceptionçš„è®¾è®¡åŸåˆ™"&gt;&lt;strong&gt;åŸºäºéå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰çš„è®¾è®¡åŸåˆ™&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Data JPA éµå¾ª Spring æ¡†æ¶çš„å¼‚å¸¸å¤„ç†è§„èŒƒï¼Œå°†&lt;strong&gt;æ•°æ®åº“æ“ä½œå¼‚å¸¸ç»Ÿä¸€å°è£…ä¸ºè¿è¡Œæ—¶å¼‚å¸¸&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;DataAccessException&lt;/code&gt; åŠå…¶å­ç±»ï¼‰ã€‚è¿™ç±»å¼‚å¸¸å±äº &lt;code&gt;RuntimeException&lt;/code&gt; çš„å­ç±»ï¼Œä¸éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­æ˜¾å¼å£°æ˜ &lt;code&gt;throws&lt;/code&gt;ï¼Œå¼€å‘è€…å¯æ ¹æ®éœ€è¦è‡ªè¡Œå†³å®šæ˜¯å¦æ•è·ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¤ºä¾‹åœºæ™¯&lt;/strong&gt;ï¼š&lt;br&gt;
å½“æ‰§è¡Œ &lt;code&gt;.save()&lt;/code&gt; æ–¹æ³•æ—¶ï¼Œè‹¥ä¸»é”®é‡å¤ï¼ˆå¦‚ SQL é”™è¯¯ 1062ï¼‰ï¼Œä¼šæŠ›å‡º &lt;code&gt;DataIntegrityViolationException&lt;/code&gt;ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œè€Œéå¼ºåˆ¶è¦æ±‚åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜ &lt;code&gt;throws SQLException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾è®¡ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;br&gt;
é¿å…ä»£ç å†—ä½™ï¼Œå‡å°‘å¼ºåˆ¶æ•è·å¼‚å¸¸å¸¦æ¥çš„ä¾µå…¥æ€§ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="å»¶è¿Ÿæ‰§è¡Œä¸äº‹åŠ¡è¾¹ç•Œçš„å½±å“"&gt;&lt;strong&gt;å»¶è¿Ÿæ‰§è¡Œä¸äº‹åŠ¡è¾¹ç•Œçš„å½±å“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;JPA çš„ &lt;code&gt;.save()&lt;/code&gt; æ–¹æ³•é»˜è®¤&lt;strong&gt;ä¸ä¼šç«‹å³æ‰§è¡Œ SQL&lt;/strong&gt;ï¼Œè€Œæ˜¯å°†å®ä½“æ ‡è®°ä¸ºâ€œå¾…æŒä¹…åŒ–â€çŠ¶æ€ï¼Œå®é™… SQL å¯èƒ½å»¶è¿Ÿåˆ°äº‹åŠ¡æäº¤æ—¶æ‰ä¼šæ‰§è¡Œã€‚æ­¤æ—¶ï¼Œå¼‚å¸¸å¯èƒ½åœ¨äº‹åŠ¡æäº¤é˜¶æ®µï¼ˆè€Œé &lt;code&gt;.save()&lt;/code&gt; è°ƒç”¨æ—¶ï¼‰æŠ›å‡ºï¼Œå¯¼è‡´ä»¥ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— æ³•åœ¨ &lt;code&gt;.save()&lt;/code&gt; è°ƒç”¨å¤„ç›´æ¥æ•è·å¼‚å¸¸&lt;/strong&gt;ï¼š&lt;br&gt;
ä¾‹å¦‚ï¼Œè‹¥åœ¨äº‹åŠ¡æ–¹æ³•ä¸­è¿ç»­è°ƒç”¨å¤šä¸ª &lt;code&gt;.save()&lt;/code&gt;ï¼Œå¼‚å¸¸å¯èƒ½åœ¨æ•´ä¸ªäº‹åŠ¡æäº¤æ—¶ç»Ÿä¸€æŠ›å‡ºï¼Œè€Œéå•ä¸ªæ“ä½œä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;br&gt;
å¦‚éœ€ç«‹å³æ•è·å¼‚å¸¸ï¼Œå¯ä½¿ç”¨ &lt;code&gt;.saveAndFlush()&lt;/code&gt; å¼ºåˆ¶åŒæ­¥æ‰§è¡Œ SQLï¼Œä½¿å¼‚å¸¸åœ¨æ–¹æ³•è°ƒç”¨æ—¶æŠ›å‡ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶"&gt;&lt;strong&gt;ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring é¼“åŠ±é€šè¿‡&lt;strong&gt;å…¨å±€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;@ControllerAdvice&lt;/code&gt; + &lt;code&gt;@ExceptionHandler&lt;/code&gt;ï¼‰æˆ–&lt;strong&gt;äº‹åŠ¡å›æ»šç­–ç•¥&lt;/strong&gt;ç®¡ç†å¼‚å¸¸ï¼Œè€Œéä¾èµ–æ–¹æ³•ç­¾åå£°æ˜ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ControllerAdvice&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;GlobalExceptionHandler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ExceptionHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DataAccessException&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ErrorResponse&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;handleJpaExceptions&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DataAccessException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»Ÿä¸€å¤„ç†æ•°æ®åº“å¼‚å¸¸&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§æ–¹å¼å°†å¼‚å¸¸å¤„ç†é€»è¾‘ä¸ä¸šåŠ¡ä»£ç è§£è€¦ï¼Œæå‡å¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä¸äº‹åŠ¡æ³¨è§£çš„ååŒ"&gt;&lt;strong&gt;ä¸äº‹åŠ¡æ³¨è§£çš„ååŒ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;JPA æ“ä½œé€šå¸¸ç»“åˆ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£ä½¿ç”¨ã€‚è‹¥äº‹åŠ¡é…ç½®ä¸ºé»˜è®¤å›æ»šç­–ç•¥ï¼ˆé‡åˆ°è¿è¡Œæ—¶å¼‚å¸¸è‡ªåŠ¨å›æ»šï¼‰ï¼Œåˆ™æ— éœ€åœ¨ &lt;code&gt;.save()&lt;/code&gt; ä¸­å£°æ˜å¼‚å¸¸ï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šè‡ªåŠ¨æ•è·å¹¶å¤„ç†å¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¼‚å¸¸ç”±äº‹åŠ¡ç®¡ç†å™¨æ•è·å¹¶å›æ»š&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æ€»ç»“-13"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Data JPA çš„ &lt;code&gt;.save()&lt;/code&gt; æ–¹æ³•ä¸å£°æ˜ &lt;code&gt;throws&lt;/code&gt; çš„ä¸»è¦åŸå› åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;éå—æ£€å¼‚å¸¸æœºåˆ¶&lt;/strong&gt;ï¼šé¿å…ä¾µå…¥æ€§ä»£ç ï¼Œä¾èµ–è¿è¡Œæ—¶å¼‚å¸¸ä¼ é€’é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§&lt;/strong&gt;ï¼šå¼‚å¸¸å¯èƒ½å»¶è¿Ÿåˆ°äº‹åŠ¡æäº¤æ—¶æŠ›å‡ºï¼Œä¸è°ƒç”¨ç‚¹åˆ†ç¦»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å±€å¼‚å¸¸å¤„ç†&lt;/strong&gt;ï¼šé€šè¿‡ç»Ÿä¸€æœºåˆ¶æ›¿ä»£åˆ†æ•£çš„ &lt;code&gt;try-catch&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†æ•´åˆ&lt;/strong&gt;ï¼šä¾èµ–äº‹åŠ¡æ³¨è§£è‡ªåŠ¨å›æ»šï¼Œè€Œéæ˜¾å¼å¼‚å¸¸å£°æ˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è‹¥éœ€åœ¨ä¸šåŠ¡ä»£ç ä¸­å³æ—¶å¤„ç†å¼‚å¸¸ï¼Œå¯ç»“åˆ &lt;code&gt;.saveAndFlush()&lt;/code&gt; å’Œå…¨å±€å¼‚å¸¸å¤„ç†å™¨å®ç°ç²¾å‡†æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id="entitymanager--åŸç”Ÿsql"&gt;EntityManager + åŸç”Ÿsql
&lt;/h2&gt;&lt;p&gt;åœ¨ Spring Data JPA ä¸­ï¼Œé€šè¿‡ &lt;code&gt;EntityManager&lt;/code&gt; ç›´æ¥è°ƒç”¨åŒ…å« &lt;code&gt;RETURNING&lt;/code&gt; çš„ PostgreSQL åŸç”Ÿ SQL æŸ¥è¯¢ï¼Œå¯ä»¥ç»•è¿‡ &lt;code&gt;@Modifying&lt;/code&gt; æ³¨è§£çš„é™åˆ¶ï¼ŒåŒæ—¶å®ç°å¯¹ä¿®æ”¹åæ•°æ®çš„ç›´æ¥è¿”å›ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨-entitymanager-çš„åŸç”ŸæŸ¥è¯¢ä¼˜åŠ¿"&gt;ä½¿ç”¨ EntityManager çš„åŸç”ŸæŸ¥è¯¢ä¼˜åŠ¿
&lt;/h3&gt;&lt;p&gt;ç›¸æ¯” &lt;code&gt;@Modifying&lt;/code&gt; æ³¨è§£çš„ Repository æ–¹æ³•ï¼Œç›´æ¥æ“ä½œ &lt;code&gt;EntityManager&lt;/code&gt; çš„ä¼˜åŠ¿åœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»æ§åˆ¶è¿”å›ç±»å‹&lt;/strong&gt;ï¼š&lt;code&gt;@Modifying&lt;/code&gt; æ–¹æ³•é»˜è®¤è¿”å› &lt;code&gt;void&lt;/code&gt; æˆ– &lt;code&gt;int&lt;/code&gt;ï¼ˆå½±å“è¡Œæ•°ï¼‰ï¼Œè€Œ &lt;code&gt;EntityManager&lt;/code&gt; å¯ç›´æ¥è¿”å›å®ä½“å¯¹è±¡æˆ–åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚ SQL æ”¯æŒ&lt;/strong&gt;ï¼šæ”¯æŒå¤šè¡¨è”æŸ¥ã€åŠ¨æ€æ¡ä»¶æ‹¼æ¥ç­‰å¤æ‚åœºæ™¯ï¼Œé¿å… &lt;code&gt;@Query&lt;/code&gt; æ³¨è§£çš„é™æ€ SQL é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»•è¿‡ JPA ç¼“å­˜é—®é¢˜&lt;/strong&gt;ï¼šé€šè¿‡æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…å› ä¸€çº§ç¼“å­˜å¯¼è‡´è¿”å›æ—§æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="å®ç°æ­¥éª¤ä¸ä»£ç ç¤ºä¾‹"&gt;å®ç°æ­¥éª¤ä¸ä»£ç ç¤ºä¾‹
&lt;/h3&gt;&lt;h4 id="æ­¥éª¤-1æ³¨å…¥-entitymanager"&gt;æ­¥éª¤ 1ï¼šæ³¨å…¥ EntityManager
&lt;/h4&gt;&lt;p&gt;åœ¨ Service å±‚æ³¨å…¥ &lt;code&gt;EntityManager&lt;/code&gt;ï¼Œå¹¶å¼€å¯äº‹åŠ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.EntityManager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.PersistenceContext&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.springframework.transaction.annotation.Transactional&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BookService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@PersistenceContext&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EntityManager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateWithReturning&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newTitle&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åç»­æ“ä½œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ­¥éª¤-2æ„å»ºåŒ…å«-returning-çš„-sql"&gt;æ­¥éª¤ 2ï¼šæ„å»ºåŒ…å« RETURNING çš„ SQL
&lt;/h4&gt;&lt;p&gt;é€šè¿‡åŸç”Ÿ SQL ç¼–å†™åŒ…å« &lt;code&gt;RETURNING&lt;/code&gt; å­å¥çš„ DML è¯­å¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;book&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;newTitle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RETURNING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ­¥éª¤-3åˆ›å»ºå¹¶æ‰§è¡Œ-nativequery"&gt;æ­¥éª¤ 3ï¼šåˆ›å»ºå¹¶æ‰§è¡Œ NativeQuery
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;EntityManager&lt;/code&gt; åˆ›å»º &lt;code&gt;NativeQuery&lt;/code&gt;ï¼Œå¹¶ç»‘å®šå‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;updateWithReturning&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newTitle&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE book SET title = :newTitle WHERE id = :id RETURNING *&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ›å»ºæŸ¥è¯¢å¹¶æ˜ å°„åˆ°å®ä½“ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createNativeQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;newTitle&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newTitle&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰§è¡Œæ›´æ–°å¹¶è·å–ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSingleResult&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="æ­¥éª¤-4å¤„ç†æ‰¹é‡æ“ä½œ"&gt;æ­¥éª¤ 4ï¼šå¤„ç†æ‰¹é‡æ“ä½œ
&lt;/h4&gt;&lt;p&gt;å¯¹äºæ‰¹é‡æ’å…¥/æ›´æ–°ï¼Œè¿”å› &lt;code&gt;List&amp;lt;Book&amp;gt;&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchInsertBooks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;books&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;INSERT INTO book (title) VALUES (:title) RETURNING *&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;book&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;books&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createNativeQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;book&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTitle&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSingleResult&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å…³é”®æ³¨æ„äº‹é¡¹"&gt;å…³é”®æ³¨æ„äº‹é¡¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ç®¡ç†&lt;/strong&gt;ï¼šå¿…é¡»ä½¿ç”¨ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£ç¡®ä¿æ“ä½œåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ›å‡º &lt;code&gt;TransactionRequiredException&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœæ˜ å°„&lt;/strong&gt;ï¼š&lt;code&gt;createNativeQuery(sql, Book.class)&lt;/code&gt; ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¿”å›çš„å®ä½“ç±»å‹ï¼Œé¿å…æ‰‹åŠ¨è§£æ &lt;code&gt;Object[]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½ä¼˜åŒ–&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å¯¹äºæ‰¹é‡æ“ä½œï¼Œå»ºè®®ä½¿ç”¨ JDBC æ‰¹å¤„ç†ï¼ˆå¦‚ &lt;code&gt;addBatch()&lt;/code&gt;ï¼‰è€Œéå¾ªç¯å•æ¬¡æ’å…¥ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥è¿”å›å­—æ®µä¸å®ä½“å±æ€§ä¸å®Œå…¨åŒ¹é…ï¼Œéœ€é€šè¿‡ &lt;code&gt;@SqlResultSetMapping&lt;/code&gt; è‡ªå®šä¹‰æ˜ å°„è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜åˆ·æ–°&lt;/strong&gt;ï¼šæ‰§è¡Œæ›´æ–°åè°ƒç”¨ &lt;code&gt;entityManager.flush()&lt;/code&gt; å¼ºåˆ¶åŒæ­¥æ•°æ®åº“çŠ¶æ€ï¼Œæˆ– &lt;code&gt;entityManager.refresh(book)&lt;/code&gt; åˆ·æ–°å•ä¸ªå®ä½“ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ä¸-modifying-æ–¹æ¡ˆçš„å¯¹æ¯”"&gt;ä¸ @Modifying æ–¹æ¡ˆçš„å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;EntityManager æ–¹æ¡ˆ&lt;/th&gt;
&lt;th&gt;@Modifying + @Query æ–¹æ¡ˆ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è¿”å›ç±»å‹&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒå®ä½“å¯¹è±¡ç›´æ¥è¿”å›&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒ &lt;code&gt;void&lt;/code&gt; æˆ– &lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SQL çµæ´»æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ”¯æŒåŠ¨æ€ SQL æ‹¼æ¥&lt;/td&gt;
&lt;td&gt;ä»…æ”¯æŒé™æ€ SQL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;äº‹åŠ¡æ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éœ€æ‰‹åŠ¨å£°æ˜ &lt;code&gt;@Transactional&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨ç»§æ‰¿ Repository äº‹åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ä»£ç ç®€æ´æ€§&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;è¾ƒä½ï¼ˆéœ€æ‰‹åŠ¨ç®¡ç†æŸ¥è¯¢ï¼‰&lt;/td&gt;
&lt;td&gt;è¾ƒé«˜ï¼ˆå£°æ˜å¼æ¥å£ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å¤æ‚æ“ä½œã€éœ€ç²¾ç¡®æ§åˆ¶è¿”å›å€¼&lt;/td&gt;
&lt;td&gt;ç®€å• DML æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•åœºæ™¯åŠ¨æ€æ¡ä»¶æŸ¥è¯¢"&gt;æ‰©å±•åœºæ™¯ï¼šåŠ¨æ€æ¡ä»¶æŸ¥è¯¢
&lt;/h3&gt;&lt;p&gt;è‹¥ SQL éœ€è¦åŠ¨æ€æ‹¼æ¥ WHERE æ¡ä»¶ï¼Œå¯ä½¿ç”¨ &lt;code&gt;CriteriaBuilder&lt;/code&gt; æˆ–å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆéœ€æ³¨æ„ SQL æ³¨å…¥é£é™©ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;dynamicUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;titleFilter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newTitle&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringBuilder&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringBuilder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UPDATE book SET title = :newTitle WHERE 1=1&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;titleFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34; AND title LIKE :titleFilter&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34; RETURNING *&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;entityManager&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createNativeQuery&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Book&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;newTitle&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;newTitle&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;titleFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;titleFilter&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;%&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;titleFilter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;%&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getResultList&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;EntityManager&lt;/code&gt; ç›´æ¥æ“ä½œåŸç”Ÿ SQLï¼Œæ—¢èƒ½åˆ©ç”¨ PostgreSQL çš„ &lt;code&gt;RETURNING&lt;/code&gt; ç‰¹æ€§é«˜æ•ˆè¿”å›æ•°æ®ï¼Œåˆçªç ´äº† Spring Data JPA æ¥å£æ–¹æ³•çš„é™åˆ¶ï¼Œé€‚åˆéœ€è¦çµæ´»æ€§å’Œç²¾ç»†æ§åˆ¶çš„åœºæ™¯ã€‚å®é™…å¼€å‘ä¸­å¯æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ¡ˆã€‚&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 8</title><link>https://dyhes.github.io/p/postopia-dev-logweek-8/</link><pubDate>Mon, 31 Mar 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-8/</guid><description>&lt;p&gt;todo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;del&gt;ä¿®æ­£å‰è¿°Opinioné€»è¾‘é—®é¢˜&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;del&gt;å®ç°å›å¤æŸ¥è¯¢é€»è¾‘&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯ä»£ç†æ›´æ–°è®¡æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;del&gt;æŸ¥è¯¢opinion&lt;/del&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;del&gt;opinionåŠŸèƒ½&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;æœç´¢&lt;/li&gt;
&lt;li&gt;æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;å›¾åƒç¼–è¾‘&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡æ”¹é€ &lt;/li&gt;
&lt;li&gt;æ¨é€&lt;/li&gt;
&lt;li&gt;&lt;del&gt;UserId&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;del&gt;å…¶ä»–ç”¨æˆ·å¸–å­æŸ¥è¯¢&lt;/del&gt;
å¾…æµ‹ï¼š&lt;/li&gt;
&lt;li&gt;&lt;del&gt;Opinionå›å½’æµ‹è¯•&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;del&gt;å›å¤æµ‹è¯•&lt;/del&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥è¿‘äº”ä¸ªæœˆçš„åœæ»ä¹‹åå†å‡ºå‘ï¼ŒåŠŸä¸å”æï¼&lt;/p&gt;
&lt;p&gt;æ–°è®¾å¤‡ä¸Šidea è¿è¡ŒæŠ¥é”™ â€œ Failed to load driver class org.postgresql.Driver in either of HikariConfig class loader or Thread context classloader â€&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ‰§è¡Œ ./gradlew bootRun
ä¹‹åä¾¿å¯ç”¨ idea è¿è¡Œ&lt;/p&gt;
&lt;p&gt;åˆå‘ç°ä¸€äº›Opinionç›¸å…³çš„é—®é¢˜ï¼Œä½¿ç”¨ Postgres çš„ upsert è¯­æ³•ä¿®å¤&lt;/p&gt;
&lt;p&gt;å›å¤æœ€ç»ˆé‡‡ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€æ¬¡é¡¶å±‚å›å¤æŸ¥è¯¢å†³å®šåˆ†é¡µ&lt;/li&gt;
&lt;li&gt;ä¸€æ¬¡ cte + ç»„æŸ¥è¯¢ å¾—åˆ°æ‰€æœ‰å­å­™å›å¤&lt;/li&gt;
&lt;li&gt;å€ŸåŠ© hash_map é‡å»ºæ ‘ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éœ€è¦æ›´æ–°æ•°æ®åº“é‡Œçš„æŸäº›çŠ¶æ€ï¼Œä½†ä¸éœ€è¦é©¬ä¸Šæ›´æ–°ï¼Œå› æ­¤å…ˆè¿”å›è¿™ä¸ªè¯·æ±‚çš„å“åº”ï¼Œå¹¶é€šè¿‡æ¶ˆæ¯ä»£ç†è®©å…¶ä»–è®¢é˜…è€…è¿›è¡ŒçŠ¶æ€çš„æ›´æ–°&lt;/p&gt;
&lt;p&gt;å‘ç°å¯¹äºOpinionæ²¡æœ‰å¿…è¦æŠŠä¸‰ç§ç±»å‹æ”¾ä¸€å¼ è¡¨é‡Œï¼Œåæ­£éƒ½è¦åˆ†å¼€æŸ¥è¯¢ï¼ˆæ— å¤šæ€æŸ¥è¯¢éœ€æ±‚ï¼‰
å› æ­¤å°†@Inheritance(InheritanceType.SINGLE_TABLE) æ”¹é€ ä¸º @MappedSuperclass&lt;/p&gt;
&lt;h2 id="åµŒå¥—ç»“æ„"&gt;åµŒå¥—ç»“æ„
&lt;/h2&gt;&lt;p&gt;åœ¨Spring Data JPAä¸­é«˜æ•ˆæŸ¥è¯¢åµŒå¥—çš„å¸–å­å›å¤ç»“æ„ï¼ˆå¦‚å›å¤ä¸‹åŒ…å«å¤šå±‚å­å›å¤ï¼‰ï¼Œéœ€è¦ç»“åˆå®ä½“å…³ç³»è®¾è®¡ã€æŸ¥è¯¢ç­–ç•¥ä¼˜åŒ–ä»¥åŠæ€§èƒ½è°ƒä¼˜æ‰‹æ®µã€‚ä»¥ä¸‹æ˜¯ç»¼åˆå¤šç¯‡æœç´¢ç»“æœçš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;h3 id="å®ä½“è®¾è®¡ä¸å…³ç³»æ˜ å°„"&gt;å®ä½“è®¾è®¡ä¸å…³ç³»æ˜ å°„
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€’å½’å®ä½“ç»“æ„è®¾è®¡&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨è‡ªå…³è”çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œå»ºç«‹å›å¤çš„æ ‘å½¢ç»“æ„ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Reply&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;parent_reply_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Reply&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parentReply&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// çˆ¶çº§å›å¤&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@OneToMany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mappedBy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;parentReply&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FetchType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LAZY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Reply&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;childReplies&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­å›å¤åˆ—è¡¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;FetchType.LAZY&lt;/code&gt;å»¶è¿ŸåŠ è½½å­å›å¤ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åµŒå¥—æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å±‚çº§æ·±åº¦æ ‡è®°&lt;/strong&gt;&lt;br&gt;
å¯æ·»åŠ &lt;code&gt;depth&lt;/code&gt;å­—æ®µè®°å½•å½“å‰å›å¤çš„å±‚çº§ï¼Œä¾¿äºåç»­æŸ¥è¯¢æ—¶é™åˆ¶é€’å½’æ·±åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æŸ¥è¯¢ç­–ç•¥ä¼˜åŒ–"&gt;æŸ¥è¯¢ç­–ç•¥ä¼˜åŒ–
&lt;/h3&gt;&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é€’å½’æŸ¥è¯¢æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JPQLé€’å½’æŸ¥è¯¢&lt;/strong&gt;ï¼ˆéœ€æ•°æ®åº“æ”¯æŒå¦‚PostgreSQLçš„&lt;code&gt;WITH RECURSIVE&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;WITH RECURSIVE cte AS (&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT r FROM Reply r WHERE r.parentReply IS NULL &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;UNION ALL &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT r FROM Reply r INNER JOIN cte ON r.parentReply.id = cte.id)&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT * FROM cte&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nativeQuery&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Reply&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findNestedReplies&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡åŸç”ŸSQLå®ç°é«˜æ•ˆé€’å½’æŸ¥è¯¢ï¼Œä½†éœ€æ³¨æ„æ•°æ®åº“å…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ¬¡åˆ†æ­¥æŸ¥è¯¢&lt;/strong&gt;ï¼š&lt;br&gt;
å…ˆæŸ¥è¯¢é¡¶å±‚å›å¤ï¼Œå†æŒ‰éœ€åˆ†æ‰¹åŠ è½½å­å›å¤ï¼Œç»“åˆåˆ†é¡µï¼ˆ&lt;code&gt;Pageable&lt;/code&gt;ï¼‰é¿å…å†…å­˜æº¢å‡ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¿å…N+1é—®é¢˜&lt;/strong&gt;&lt;br&gt;
ä½¿ç”¨&lt;code&gt;JOIN FETCH&lt;/code&gt;æˆ–&lt;code&gt;@EntityGraph&lt;/code&gt;ä¸€æ¬¡æ€§åŠ è½½å…³è”æ•°æ®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@EntityGraph&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;attributePaths&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;childReplies&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Reply&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByPostId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ–¹å¼ä¼šé€’å½’åŠ è½½æ‰€æœ‰å±‚çº§çš„å­å›å¤ï¼Œéœ€æ³¨æ„æ•°æ®é‡è¿‡å¤§æ—¶çš„æ€§èƒ½é£é™©ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€§èƒ½è°ƒä¼˜æ‰‹æ®µ"&gt;æ€§èƒ½è°ƒä¼˜æ‰‹æ®µ
&lt;/h3&gt;&lt;ol start="5"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜ç­–ç•¥&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç”¨äºŒçº§ç¼“å­˜ï¼ˆå¦‚Hibernateçš„&lt;code&gt;@Cacheable&lt;/code&gt;ï¼‰ï¼Œå¯¹é¢‘ç¹è®¿é—®çš„é™æ€å›å¤æ•°æ®ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ç»“åˆ&lt;code&gt;@QueryHints&lt;/code&gt;ä¼˜åŒ–ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@QueryHints&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@QueryHint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.hibernate.cacheable&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@QueryHint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;org.hibernate.fetchSize&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;100&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Reply&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findTopLevelReplies&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;é€šè¿‡&lt;code&gt;fetchSize&lt;/code&gt;åˆ†æ‰¹æ¬¡è·å–æ•°æ®ï¼Œå‡å°‘å†…å­˜å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†é¡µä¸æ‡’åŠ è½½ç»“åˆ&lt;/strong&gt;&lt;br&gt;
å¯¹é¡¶å±‚å›å¤åˆ†é¡µæŸ¥è¯¢ï¼Œå­å›å¤æŒ‰éœ€æ‡’åŠ è½½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Reply&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findByParentReplyIsNull&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”¨æˆ·å±•å¼€æŸæ¡å›å¤æ—¶å†æŸ¥è¯¢å…¶å­å›å¤ï¼Œé€‚ç”¨äºæ·±åº¦åµŒå¥—åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="ç´¢å¼•ä¸æ•°æ®åº“ä¼˜åŒ–"&gt;ç´¢å¼•ä¸æ•°æ®åº“ä¼˜åŒ–
&lt;/h3&gt;&lt;ol start="7"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•è®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨&lt;code&gt;parent_reply_id&lt;/code&gt;å’Œ&lt;code&gt;post_id&lt;/code&gt;å­—æ®µæ·»åŠ å¤åˆç´¢å¼•ï¼ŒåŠ é€Ÿå…³è”æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹&lt;code&gt;created_at&lt;/code&gt;ï¼ˆæ—¶é—´æ’åºå­—æ®µï¼‰å»ºç«‹ç´¢å¼•ï¼Œä¼˜åŒ–æ’åºæ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DTOæŠ•å½±&lt;/strong&gt;&lt;br&gt;
è‹¥æ— éœ€å®Œæ•´å®ä½“ï¼Œå¯é€šè¿‡æ¥å£æˆ–ç±»æŠ•å½±ä»…è¿”å›å¿…è¦å­—æ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT new com.example.ReplyDTO(r.id, r.content) FROM Reply r WHERE r.parentReply IS NULL&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ReplyDTO&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findTopLevelRepliesProjection&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‡å°‘æ•°æ®ä¼ è¾“é‡ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ‰©å±•æ–¹æ¡ˆ"&gt;æ‰©å±•æ–¹æ¡ˆ
&lt;/h3&gt;&lt;ol start="9"&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥åŠ è½½ä¸å‰ç«¯åä½œ&lt;/strong&gt;&lt;br&gt;
ç»“åˆREST APIçš„åˆ†é¡µå’ŒåµŒå¥—èµ„æºè¿”å›ï¼ˆå¦‚HATEOASï¼‰ï¼Œå®ç°æŒ‰éœ€åŠ è½½ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;GET /replies/{id}/children?page=0&amp;amp;size=10
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‰ç«¯é€å±‚è¯·æ±‚å­å›å¤ï¼Œé¿å…åç«¯ä¸€æ¬¡æ€§å¤„ç†è¿‡æ·±åµŒå¥—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰©åŒ–è·¯å¾„æ¨¡å¼&lt;/strong&gt;&lt;br&gt;
å­˜å‚¨è·¯å¾„å­—ç¬¦ä¸²ï¼ˆå¦‚&lt;code&gt;1/3/5/&lt;/code&gt;è¡¨ç¤ºå±‚çº§å…³ç³»ï¼‰ï¼Œé€šè¿‡&lt;code&gt;LIKE&lt;/code&gt;æŸ¥è¯¢å¿«é€Ÿè·å–å­æ ‘ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;reply&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1/3/%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ–¹æ¡ˆéœ€åœ¨å†™å…¥æ—¶ç»´æŠ¤è·¯å¾„å­—æ®µï¼Œé€‚åˆè¯»å¤šå†™å°‘åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“å»ºè®®"&gt;æ€»ç»“å»ºè®®
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜å…ˆé€‰æ‹©åˆ†æ­¥æŸ¥è¯¢+æ‡’åŠ è½½&lt;/strong&gt;ï¼Œå¹³è¡¡æ€§èƒ½ä¸èµ„æºæ¶ˆè€—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ·±åº¦åµŒå¥—åœºæ™¯&lt;/strong&gt;ï¼ˆå¦‚è¶…è¿‡3å±‚ï¼‰å»ºè®®ç»“åˆæ•°æ®åº“ç‰¹æ€§ï¼ˆå¦‚PostgreSQLçš„é€’å½’æŸ¥è¯¢ï¼‰ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§æŸ¥è¯¢æ€§èƒ½&lt;/strong&gt;ï¼Œä½¿ç”¨&lt;code&gt;spring.jpa.show-sql=true&lt;/code&gt;åˆ†æç”Ÿæˆçš„SQLï¼Œé’ˆå¯¹æ€§ä¼˜åŒ–ç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ¶ˆæ¯ä»£ç†"&gt;æ¶ˆæ¯ä»£ç†
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;æ¶ˆæ¯ä»£ç†æ˜¯ä¸æ˜¯ç”¨æ¥åšä¸€äº›ä¸ç”¨é©¬ä¸Šå®Œæˆçš„äº‹æƒ…ï¼Ÿæ¯”å¦‚åœ¨ä¸€ä¸ªRestfulè¯·æ±‚ä¸­æˆ‘éœ€è¦æ›´æ–°æ•°æ®åº“é‡Œçš„æŸäº›çŠ¶æ€ï¼Œä½†ä¸éœ€è¦é©¬ä¸Šæ›´æ–°ï¼Œå› æ­¤å…ˆè¿”å›è¿™ä¸ªè¯·æ±‚çš„å“åº”ï¼Œå¹¶é€šè¿‡æ¶ˆæ¯ä»£ç†è®©å…¶ä»–è®¢é˜…è€…è¿›è¡ŒçŠ¶æ€çš„æ›´æ–°ï¼Ÿ
æ˜¯çš„ï¼Œæ¶ˆæ¯ä»£ç†çš„æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ç±»â€œæ— éœ€ç«‹å³å®Œæˆâ€çš„å¼‚æ­¥ä»»åŠ¡åœºæ™¯ã€‚æ‚¨æè¿°çš„åœºæ™¯éå¸¸å…¸å‹ï¼Œæ¶ˆæ¯ä»£ç†åœ¨å…¶ä¸­èµ·åˆ°äº†å…³é”®ä½œç”¨ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="å¼‚æ­¥å¤„ç†ä¸è§£è€¦çš„å…¸å‹æ¨¡å¼"&gt;&lt;strong&gt;å¼‚æ­¥å¤„ç†ä¸è§£è€¦çš„å…¸å‹æ¨¡å¼&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;åœ¨æ‚¨çš„RESTfulè¯·æ±‚åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯ä»£ç†å¯ä»¥å°†&lt;strong&gt;æ•°æ®åº“çŠ¶æ€æ›´æ–°&lt;/strong&gt;è¿™ç±»éå³æ—¶æ€§æ“ä½œä»ä¸»æµç¨‹ä¸­å‰¥ç¦»ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»æœåŠ¡æ¥æ”¶è¯·æ±‚åï¼Œ&lt;strong&gt;ä»…å®Œæˆæ ¸å¿ƒé€»è¾‘ï¼ˆå¦‚éªŒè¯è¯·æ±‚åˆæ³•æ€§ï¼‰&lt;/strong&gt;ï¼Œå°†éœ€è¦åç»­å¤„ç†çš„æ›´æ–°ä»»åŠ¡ï¼ˆå¦‚çŠ¶æ€å˜æ›´ï¼‰å°è£…ä¸ºæ¶ˆæ¯å‘é€è‡³æ¶ˆæ¯ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;ç«‹å³è¿”å›HTTP 200å“åº”ï¼Œ&lt;strong&gt;é¿å…ç”¨æˆ·ç«¯å› ç­‰å¾…è€—æ—¶æ“ä½œï¼ˆå¦‚å¤šä¸ªå­ç³»ç»Ÿè”åŠ¨æ›´æ–°ï¼‰è€Œé˜»å¡&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;è®¢é˜…è¯¥æ¶ˆæ¯çš„å…¶ä»–æœåŠ¡ï¼ˆå¦‚åº“å­˜ç³»ç»Ÿã€æ—¥å¿—æœåŠ¡ã€é€šçŸ¥æœåŠ¡ï¼‰&lt;strong&gt;åœ¨åå°å¼‚æ­¥æ¶ˆè´¹æ¶ˆæ¯&lt;/strong&gt;ï¼Œå®Œæˆå®é™…çš„çŠ¶æ€æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç§æ¨¡å¼ä½¿ç³»ç»Ÿå®ç°äº†&lt;strong&gt;ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…çš„è§£è€¦&lt;/strong&gt;ï¼ŒæœåŠ¡é—´ä»…é€šè¿‡æ¶ˆæ¯æ ¼å¼çº¦å®šäº¤äº’ï¼Œæ— éœ€æ„ŸçŸ¥å¯¹æ–¹çš„å­˜åœ¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ¶ˆæ¯ä»£ç†çš„å¯é æ€§ä¿éšœ"&gt;&lt;strong&gt;æ¶ˆæ¯ä»£ç†çš„å¯é æ€§ä¿éšœ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ‚¨å¯èƒ½æ‹…å¿ƒçš„â€œæ¶ˆæ¯ä¸¢å¤±â€é—®é¢˜ï¼Œæ¶ˆæ¯ä»£ç†é€šè¿‡ä»¥ä¸‹æœºåˆ¶è§£å†³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯æŒä¹…åŒ–&lt;/strong&gt;ï¼šä»£ç†å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ï¼Œå³ä½¿æœåŠ¡å´©æºƒæˆ–ç½‘ç»œä¸­æ–­ï¼Œé‡å¯åä»å¯ç»§ç»­å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡®è®¤æœºåˆ¶ï¼ˆACKï¼‰&lt;/strong&gt;ï¼šæ¶ˆè´¹è€…å¤„ç†æˆåŠŸåå‘ä»£ç†å‘é€ç¡®è®¤ï¼Œå¦åˆ™æ¶ˆæ¯ä¼šè¢«é‡æ–°æŠ•é€’ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡è¯•ç­–ç•¥&lt;/strong&gt;ï¼šå¯é…ç½®æœ€å¤§é‡è¯•æ¬¡æ•°æˆ–é€€é¿æ—¶é—´ï¼Œé¿å…å› ä¸´æ—¶æ•…éšœå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨äºšé©¬é€Šäº‘ç§‘æŠ€çš„æ¡ˆä¾‹ä¸­ï¼Œé‡‘èäº¤æ˜“ç³»ç»Ÿæ­£æ˜¯é€šè¿‡æ¶ˆæ¯ä»£ç†ç¡®ä¿æ”¯ä»˜ä¿¡æ¯â€œä»…ä¼ é€’ä¸€æ¬¡â€ï¼Œé¿å…é‡å¤æ‰£æ¬¾æˆ–é—æ¼ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="é€‚ç”¨åœºæ™¯æ‰©å±•"&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯æ‰©å±•&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;é™¤äº†æ‚¨æåˆ°çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°ï¼Œæ¶ˆæ¯ä»£ç†è¿˜å¸¸ç”¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜ååä»»åŠ¡&lt;/strong&gt;ï¼šå¦‚æ—¥å¿—é‡‡é›†ï¼ˆæ¯ç§’ä¸‡çº§æ—¥å¿—å†™å…¥ï¼‰ã€ç”µå•†ç§’æ€è®¢å•ç¼“å†²ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒ&lt;/strong&gt;ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ›¿ä»£ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰çš„å¤æ‚åè®®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµé‡å‰Šå³°&lt;/strong&gt;ï¼šçªå‘è¯·æ±‚å…ˆè¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±æ¶ˆè´¹è€…æŒ‰å¤„ç†èƒ½åŠ›åŒ€é€Ÿæ¶ˆè´¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚å¾®è½¯Azureæ–‡æ¡£ä¸­æåˆ°çš„â€œä¸´æ—¶åˆ†ç¦»â€æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·ç•Œé¢å¿«é€Ÿå“åº”ï¼Œåå°å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æŠ€æœ¯é€‰å‹å»ºè®®"&gt;&lt;strong&gt;æŠ€æœ¯é€‰å‹å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è‹¥æ‚¨éœ€è¦å®ç°è¯¥æ¨¡å¼ï¼Œå¯æ ¹æ®åœºæ™¯é€‰æ‹©å·¥å…·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½»é‡çº§åœºæ™¯&lt;/strong&gt;ï¼šRabbitMQï¼ˆæ”¯æŒå¤æ‚è·¯ç”±ï¼‰ã€Redis Streamsï¼ˆä½å»¶è¿Ÿï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜åå/å¤§æ•°æ®&lt;/strong&gt;ï¼šApache Kafkaï¼ˆæŒä¹…åŒ–æ—¥å¿—ã€æ”¯æŒæµå¤„ç†ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘åŸç”Ÿç¯å¢ƒ&lt;/strong&gt;ï¼šAWS SQSï¼ˆå…¨æ‰˜ç®¡ï¼‰ã€Azure Service Busï¼ˆé›†æˆèº«ä»½è®¤è¯ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“"&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æ¶ˆæ¯ä»£ç†çš„æœ¬è´¨æ˜¯&lt;strong&gt;å°†â€œè¯·æ±‚-å“åº”â€çš„åŒæ­¥æ¨¡å¼è½¬åŒ–ä¸ºâ€œå‘å¸ƒ-è®¢é˜…â€çš„å¼‚æ­¥æµç¨‹&lt;/strong&gt;ï¼Œæ—¢èƒ½æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦ï¼Œåˆèƒ½é€šè¿‡è§£è€¦å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚æ‚¨çš„æ¡ˆä¾‹æ­£æ˜¯è¿™ä¸€æ¨¡å¼çš„ç»å…¸åº”ç”¨ï¼Œç¬¦åˆæ¶ˆæ¯ä»£ç†çš„æ ¸å¿ƒè®¾è®¡ç›®æ ‡ã€‚&lt;/p&gt;
&lt;h2 id="joincolumn"&gt;@JoinColumn
&lt;/h2&gt;&lt;p&gt;åœ¨ JPAï¼ˆJava Persistence APIï¼‰ä¸­ï¼Œ&lt;code&gt;@JoinColumn&lt;/code&gt; æ³¨è§£ç”¨äºå®šä¹‰å®ä½“ç±»ä¹‹é—´å…³è”å…³ç³»çš„å¤–é”®åˆ—é…ç½®ï¼Œå°¤å…¶æ˜¯åœ¨ &lt;code&gt;@OneToOne&lt;/code&gt;ã€&lt;code&gt;@OneToMany&lt;/code&gt; æˆ– &lt;code&gt;@ManyToOne&lt;/code&gt; å…³è”ä¸­ã€‚å®ƒå…è®¸å¼€å‘è€…æ˜¾å¼æŒ‡å®šå¤–é”®åˆ—çš„åç§°ã€å…³è”çš„ç›®æ ‡åˆ—ä»¥åŠå…¶ä»–çº¦æŸæ¡ä»¶ã€‚ä»¥ä¸‹æ˜¯ &lt;code&gt;@JoinColumn&lt;/code&gt; çš„è¯¦ç»†è§£æå’Œç”¨æ³•ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="åŸºæœ¬ä½œç”¨"&gt;&lt;strong&gt;åŸºæœ¬ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@JoinColumn&lt;/code&gt; çš„ä¸»è¦åŠŸèƒ½æ˜¯é…ç½®å…³è”å…³ç³»çš„å¤–é”®åˆ—å±æ€§ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–é”®åˆ—çš„åç§°&lt;/strong&gt;ï¼ˆé»˜è®¤ç”± JPA è‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³è”çš„ç›®æ ‡å®ä½“åˆ—&lt;/strong&gt;ï¼ˆé»˜è®¤ä¸ºç›®æ ‡å®ä½“çš„ä¸»é”®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜¯å¦å…è®¸ç©ºå€¼&lt;/strong&gt;ï¼ˆ&lt;code&gt;nullable&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–é”®çº¦æŸåç§°&lt;/strong&gt;ï¼ˆ&lt;code&gt;foreignKey&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ ¸å¿ƒå±æ€§"&gt;&lt;strong&gt;æ ¸å¿ƒå±æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯ &lt;code&gt;@JoinColumn&lt;/code&gt; çš„å…³é”®å±æ€§ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å±æ€§&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;th&gt;é»˜è®¤å€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;name&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;String&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤–é”®åˆ—çš„åç§°&lt;/td&gt;
&lt;td&gt;æ ¹æ®å…³è”å…³ç³»è‡ªåŠ¨ç”Ÿæˆï¼ˆå¦‚ &lt;code&gt;å…³è”å±æ€§å_ç›®æ ‡ä¸»é”®å&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;referencedColumnName&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;String&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç›®æ ‡å®ä½“åˆ—åï¼ˆé€šå¸¸æ˜¯ç›®æ ‡è¡¨çš„ä¸»é”®åˆ—ï¼‰&lt;/td&gt;
&lt;td&gt;ç›®æ ‡å®ä½“çš„ä¸»é”®åˆ—å&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;nullable&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;boolean&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å…è®¸å¤–é”®å€¼ä¸º &lt;code&gt;NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;foreignKey&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;@ForeignKey&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¤–é”®çº¦æŸé…ç½®ï¼ˆå¦‚çº¦æŸåç§°ã€æ˜¯å¦ç¦ç”¨çº¦æŸï¼‰&lt;/td&gt;
&lt;td&gt;è‡ªåŠ¨ç”Ÿæˆçº¦æŸåç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;columnDefinition&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;String&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è‡ªå®šä¹‰åˆ—å®šä¹‰ï¼ˆå¦‚æ•°æ®åº“ç±»å‹ã€é»˜è®¤å€¼ï¼‰&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3 id="ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹"&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="åœºæ™¯ä¸€"&gt;&lt;strong&gt;åœºæ™¯ä¸€ï¼š&lt;code&gt;@ManyToOne&lt;/code&gt; å•å‘å…³è”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;@ManyToOne&lt;/code&gt; å…³è”ä¸­ï¼Œ&lt;code&gt;@JoinColumn&lt;/code&gt; å®šä¹‰å¤–é”®åˆ—æŒ‡å‘ç›®æ ‡å®ä½“çš„ä¸»é”®ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å®šä¹‰å¤–é”®åˆ—åä¸º &amp;#34;user_id&amp;#34;ï¼Œå…³è”åˆ° User è¡¨çš„ &amp;#34;id&amp;#34; åˆ—&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;referencedColumnName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreignKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;fk_order_user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç”Ÿæˆçš„ DDL&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FOREIGN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;REFERENCES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;User&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- çº¦æŸåä¸º fk_order_user
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="åœºæ™¯äºŒ"&gt;&lt;strong&gt;åœºæ™¯äºŒï¼š&lt;code&gt;@OneToMany&lt;/code&gt; åŒå‘å…³è”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨åŒå‘å…³è”ä¸­ï¼Œ&lt;code&gt;@JoinColumn&lt;/code&gt; é€šå¸¸ç”¨äº &lt;code&gt;@OneToMany&lt;/code&gt; çš„ä¸€æ–¹ï¼ˆçˆ¶å®ä½“ï¼‰å®šä¹‰å¤–é”®ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸€çš„ä¸€æ–¹é€šè¿‡ mappedBy æŒ‡å®šå…³è”å­—æ®µï¼Œæ— éœ€ @JoinColumn&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@OneToMany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mappedBy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Order&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Order&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤šçš„ä¸€æ–¹å®šä¹‰å¤–é”®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="åœºæ™¯ä¸‰"&gt;&lt;strong&gt;åœºæ™¯ä¸‰ï¼š&lt;code&gt;@OneToOne&lt;/code&gt; å…³è”&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;@OneToOne&lt;/code&gt; å…³è”ä¸­ï¼Œ&lt;code&gt;@JoinColumn&lt;/code&gt; å®šä¹‰å¤–é”®åˆ—çš„ä½ç½®ï¼ˆä¸»æ§æ–¹ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¸»æ§æ–¹å®šä¹‰å¤–é”®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@OneToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;profile_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å”¯ä¸€çº¦æŸ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Profile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;profile&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Profile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="ç‰¹æ®Šç”¨æ³•"&gt;&lt;strong&gt;ç‰¹æ®Šç”¨æ³•&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="è‡ªå®šä¹‰å¤–é”®çº¦æŸåç§°"&gt;&lt;strong&gt;è‡ªå®šä¹‰å¤–é”®çº¦æŸåç§°&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;foreignKey&lt;/code&gt; å±æ€§æŒ‡å®šå¤–é”®åç§°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreignKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;custom_fk_name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="ç¦ç”¨å¤–é”®çº¦æŸ"&gt;&lt;strong&gt;ç¦ç”¨å¤–é”®çº¦æŸ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;æŸäº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦ç¦ç”¨å¤–é”®çº¦æŸï¼ˆå¦‚æµ‹è¯•ç¯å¢ƒï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreignKey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ConstraintMode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;NO_CONSTRAINT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h4 id="å¤åˆå¤–é”®å¤šåˆ—å…³è”"&gt;&lt;strong&gt;å¤åˆå¤–é”®ï¼ˆå¤šåˆ—å…³è”ï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥éœ€è¦å¤šåˆ—ç»„åˆå¤–é”®ï¼Œéœ€ç»“åˆ &lt;code&gt;@JoinColumns&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@JoinColumns&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;referencedColumnName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_code&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;referencedColumnName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;code&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å¸¸è§é—®é¢˜"&gt;&lt;strong&gt;å¸¸è§é—®é¢˜&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="é—®é¢˜ä¸€å¤–é”®åˆ—åé»˜è®¤ç”Ÿæˆè§„åˆ™"&gt;&lt;strong&gt;é—®é¢˜ä¸€ï¼šå¤–é”®åˆ—åé»˜è®¤ç”Ÿæˆè§„åˆ™&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;è‹¥æœªæ˜¾å¼æŒ‡å®š &lt;code&gt;name&lt;/code&gt;ï¼ŒJPA ä¼šæ ¹æ®å…³è”å±æ€§åå’Œç›®æ ‡ä¸»é”®åˆ—åç”Ÿæˆå¤–é”®åˆ—åã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å±æ€§åï¼š&lt;code&gt;user&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç›®æ ‡ä¸»é”®åˆ—åï¼š&lt;code&gt;id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é»˜è®¤å¤–é”®åˆ—åï¼š&lt;code&gt;user_id&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="é—®é¢˜äºŒ"&gt;&lt;strong&gt;é—®é¢˜äºŒï¼š&lt;code&gt;@JoinColumn&lt;/code&gt; vs &lt;code&gt;@PrimaryKeyJoinColumn&lt;/code&gt;&lt;/strong&gt;
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@JoinColumn&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äºæ™®é€šå¤–é”®å…³è”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;@PrimaryKeyJoinColumn&lt;/code&gt;&lt;/strong&gt;ï¼šç”¨äºå…±äº«ä¸»é”®çš„ä¸€å¯¹ä¸€å…³è”ï¼ˆå­è¡¨ä¸»é”®åŒæ—¶æ˜¯å¤–é”®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="é—®é¢˜ä¸‰å¤šå¯¹å¤šå…³è”ä¸­çš„ä½¿ç”¨"&gt;&lt;strong&gt;é—®é¢˜ä¸‰ï¼šå¤šå¯¹å¤šå…³è”ä¸­çš„ä½¿ç”¨&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;@ManyToMany&lt;/code&gt; å…³è”ä¸­ï¼Œå¤–é”®ç”±ä¸­é—´è¡¨ç®¡ç†ï¼Œæ­¤æ—¶åº”ä½¿ç”¨ &lt;code&gt;@JoinTable&lt;/code&gt; è€Œé &lt;code&gt;@JoinColumn&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@ManyToMany&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@JoinTable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_role&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;joinColumns&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;inverseJoinColumns&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;role_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Role&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;roles&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="æœ€ä½³å®è·µ"&gt;&lt;strong&gt;æœ€ä½³å®è·µ&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ˜¾å¼æŒ‡å®š &lt;code&gt;name&lt;/code&gt;&lt;/strong&gt;ï¼šé¿å…ä¾èµ–é»˜è®¤å‘½åè§„åˆ™ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤–é”®çº¦æŸåç§°&lt;/strong&gt;ï¼šç»Ÿä¸€å‘½åè§„åˆ™ï¼ˆå¦‚ &lt;code&gt;fk_å½“å‰è¡¨_ç›®æ ‡è¡¨&lt;/code&gt;ï¼‰ï¼Œä¾¿äºæ•°æ®åº“ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éç©ºçº¦æŸ&lt;/strong&gt;ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½® &lt;code&gt;nullable = false&lt;/code&gt;ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å¾ªç¯ä¾èµ–&lt;/strong&gt;ï¼šåœ¨åŒå‘å…³è”ä¸­æ˜ç¡® &lt;code&gt;mappedBy&lt;/code&gt; å’Œ &lt;code&gt;@JoinColumn&lt;/code&gt; çš„åˆ†å·¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;é€šè¿‡åˆç†ä½¿ç”¨ &lt;code&gt;@JoinColumn&lt;/code&gt;ï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶æ•°æ®åº“å¤–é”®çš„ç”Ÿæˆé€»è¾‘ï¼Œæå‡å®ä½“å…³è”çš„æ¸…æ™°åº¦å’Œæ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;h2 id="jpahibernateddl-auto"&gt;jpa.hibernate.ddl-auto
&lt;/h2&gt;&lt;p&gt;JPAçš„&lt;code&gt;hibernate.ddl-auto&lt;/code&gt;å±æ€§æ˜¯ç”¨äºæ§åˆ¶Hibernateå¦‚ä½•è‡ªåŠ¨ç®¡ç†æ•°æ®åº“è¡¨ç»“æ„çš„æ ¸å¿ƒé…ç½®é¡¹ï¼Œå…¶å¸¸è§å±æ€§å€¼åŠä½œç”¨å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;h3 id="å±æ€§ä½œç”¨"&gt;&lt;strong&gt;å±æ€§ä½œç”¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;hibernate.ddl-auto&lt;/code&gt;å…è®¸å¼€å‘è€…é€šè¿‡é…ç½®å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åˆ›å»ºè¡¨&lt;/strong&gt;ï¼šæ ¹æ®å®ä½“ç±»å®šä¹‰ç”Ÿæˆæ•°æ®åº“è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°è¡¨ç»“æ„&lt;/strong&gt;ï¼šå½“å®ä½“ç±»å­—æ®µå˜åŒ–æ—¶ï¼ŒåŒæ­¥æ›´æ–°æ•°æ®åº“è¡¨ç»“æ„ï¼ˆä»…æ”¯æŒéƒ¨åˆ†æ“ä½œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¡éªŒä¸€è‡´æ€§&lt;/strong&gt;ï¼šéªŒè¯å®ä½“ç±»ä¸æ•°æ®åº“è¡¨ç»“æ„çš„å­—æ®µç±»å‹æ˜¯å¦åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å…·ä½“å±æ€§å€¼åŠè¡Œä¸º"&gt;&lt;strong&gt;å…·ä½“å±æ€§å€¼åŠè¡Œä¸º&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯å„å±æ€§å€¼çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;create&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æ¯æ¬¡å¯åŠ¨åº”ç”¨æ—¶åˆ é™¤æ‰€æœ‰æ—§è¡¨å¹¶é‡æ–°åˆ›å»ºæ–°è¡¨ï¼Œ&lt;strong&gt;åŸæœ‰æ•°æ®ä¼šè¢«æ¸…ç©º&lt;/strong&gt;ã€‚é€‚ç”¨äºå¼€å‘åˆæœŸæˆ–éœ€è¦å®Œå…¨é‡å»ºè¡¨çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;create-drop&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
åœ¨&lt;code&gt;create&lt;/code&gt;åŸºç¡€ä¸Šï¼Œç¨‹åºå…³é—­æ—¶è‡ªåŠ¨åˆ é™¤æ‰€æœ‰è¡¨ã€‚å¸¸ç”¨äºä¸´æ—¶æµ‹è¯•ç¯å¢ƒï¼ˆå¦‚å•å…ƒæµ‹è¯•ï¼‰ï¼Œé¿å…æ®‹ç•™æµ‹è¯•æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;update&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å¯åŠ¨æ—¶æ£€æŸ¥å®ä½“ç±»ä¸è¡¨ç»“æ„çš„å·®å¼‚ï¼Œ&lt;strong&gt;è‡ªåŠ¨æ·»åŠ æ–°å­—æ®µ&lt;/strong&gt;ï¼Œä½†ä¸ä¼šåˆ é™¤æˆ–ä¿®æ”¹å·²æœ‰å­—æ®µã€‚ä¾‹å¦‚ï¼Œæ–°å¢å®ä½“ç±»å±æ€§æ—¶ä¼šè‡ªåŠ¨æ·»åŠ åˆ—ï¼Œä½†ä¿®æ”¹å­—æ®µåæˆ–ç±»å‹åˆ™ä¸ä¼šè¢«è¯†åˆ«ã€‚&lt;br&gt;
&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼Œå› éƒ¨åˆ†ç»“æ„å˜æ›´éœ€æ‰‹åŠ¨å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;validate&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
æ ¡éªŒå®ä½“ç±»ä¸æ•°æ®åº“è¡¨çš„å­—æ®µç±»å‹æ˜¯å¦ä¸€è‡´ã€‚è‹¥æ£€æµ‹åˆ°ä¸åŒ¹é…ï¼ˆå¦‚å­—æ®µç±»å‹ä»&lt;code&gt;VARCHAR&lt;/code&gt;æ”¹ä¸º&lt;code&gt;INT&lt;/code&gt;ï¼‰ï¼Œå¯åŠ¨æ—¶ä¼šç›´æ¥æŠ¥é”™ï¼Œ&lt;strong&gt;ä¸æ‰§è¡Œä»»ä½•ç»“æ„å˜æ›´&lt;/strong&gt;ã€‚é€‚åˆç”Ÿäº§ç¯å¢ƒç¡®ä¿ç»“æ„å®‰å…¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;none&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
ç¦ç”¨è‡ªåŠ¨DDLæ“ä½œï¼Œéœ€å®Œå…¨æ‰‹åŠ¨ç®¡ç†è¡¨ç»“æ„ã€‚è¿™æ˜¯éå†…åµŒæ•°æ®åº“ï¼ˆå¦‚MySQLï¼‰çš„é»˜è®¤é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="é»˜è®¤å€¼ä¸æ•°æ®åº“ç±»å‹"&gt;&lt;strong&gt;é»˜è®¤å€¼ä¸æ•°æ®åº“ç±»å‹&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Spring Bootæ ¹æ®æ•°æ®åº“ç±»å‹è®¾ç½®é»˜è®¤å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å†…åµŒæ•°æ®åº“&lt;/strong&gt;ï¼ˆå¦‚H2ã€HSQLDBï¼‰ï¼šé»˜è®¤&lt;code&gt;create-drop&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éå†…åµŒæ•°æ®åº“&lt;/strong&gt;ï¼ˆå¦‚MySQLã€PostgreSQLï¼‰ï¼šé»˜è®¤&lt;code&gt;none&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ä½¿ç”¨å»ºè®®"&gt;&lt;strong&gt;ä½¿ç”¨å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼€å‘ç¯å¢ƒ&lt;/strong&gt;ï¼šæ¨è&lt;code&gt;update&lt;/code&gt;ï¼Œä¾¿äºå¿«é€Ÿè¿­ä»£è¡¨ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ‹è¯•ç¯å¢ƒ&lt;/strong&gt;ï¼šä½¿ç”¨&lt;code&gt;create-drop&lt;/code&gt;æˆ–&lt;code&gt;create&lt;/code&gt;ï¼Œç¡®ä¿æ¯æ¬¡æµ‹è¯•æ•°æ®ç‹¬ç«‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒ&lt;/strong&gt;ï¼šå¿…é¡»è®¾ä¸º&lt;code&gt;validate&lt;/code&gt;æˆ–&lt;code&gt;none&lt;/code&gt;ï¼Œé¿å…æ„å¤–æ•°æ®ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;update&lt;/code&gt;çš„å±€é™æ€§&lt;/strong&gt;ï¼šæ— æ³•å¤„ç†å­—æ®µåˆ é™¤ã€é‡å‘½åæˆ–ç±»å‹ä¿®æ”¹ï¼Œéœ€é€šè¿‡æ•°æ®åº“è¿ç§»å·¥å…·ï¼ˆå¦‚Flywayï¼‰å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å®‰å…¨&lt;/strong&gt;ï¼šé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨&lt;code&gt;create&lt;/code&gt;æˆ–&lt;code&gt;create-drop&lt;/code&gt;ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®å…¨é‡ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆç†é…ç½®&lt;code&gt;hibernate.ddl-auto&lt;/code&gt;ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ä¸åŒé˜¶æ®µé«˜æ•ˆç®¡ç†æ•°æ®åº“ç»“æ„ï¼Œä½†éœ€ç»“åˆå…·ä½“åœºæ™¯æƒè¡¡è‡ªåŠ¨åŒ–ä¸å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id="uniuqe-constraint"&gt;Uniuqe Constraint
&lt;/h2&gt;&lt;p&gt;åœ¨ PostgreSQL ä¸­ï¼Œ&lt;strong&gt;ç»„åˆå”¯ä¸€çº¦æŸï¼ˆå¤šåˆ—è”åˆå”¯ä¸€çº¦æŸï¼‰å¹¶ä¸è¦æ±‚å­—æ®µå¿…é¡»éç©º&lt;/strong&gt;ã€‚ä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å…³é”®ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å”¯ä¸€çº¦æŸçš„ NULL å¤„ç†é€»è¾‘&lt;/strong&gt;&lt;br&gt;
å½“ç»„åˆå”¯ä¸€çº¦æŸçš„å­—æ®µä¸­åŒ…å« NULL å€¼æ—¶ï¼ŒPostgreSQL è®¤ä¸º NULL ä¸å…¶ä»–å€¼ï¼ˆåŒ…æ‹¬å…¶ä»– NULLï¼‰ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼Œè‹¥ä¸¤è¡Œæ•°æ®çš„ç»„åˆå­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªå­—æ®µä¸º NULLï¼Œåˆ™å®ƒä»¬çš„ç»„åˆå€¼ä»å¯èƒ½è¢«è§†ä¸ºå”¯ä¸€ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- å…è®¸
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- ä»å…è®¸ï¼ˆå›  NULL è¢«è§†ä¸ºä¸åŒï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦éœ€æ˜¾å¼éç©ºçº¦æŸ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸šåŠ¡è¦æ±‚ç»„åˆå­—æ®µå¿…é¡»å…¨éƒ¨éç©ºæ‰èƒ½ä¿è¯å”¯ä¸€æ€§ï¼Œéœ€é¢å¤–æ·»åŠ  &lt;code&gt;NOT NULL&lt;/code&gt; çº¦æŸã€‚ä¾‹å¦‚ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;orders&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;product_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;product_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;è‹¥æœªåŠ  &lt;code&gt;NOT NULL&lt;/code&gt;ï¼Œå³ä½¿ç»„åˆå­—æ®µä¸­æœ‰ NULLï¼Œä»å¯èƒ½å› å”¯ä¸€çº¦æŸå¤±æ•ˆå¯¼è‡´é‡å¤æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ¡ˆï¼šå”¯ä¸€ç´¢å¼•å¤„ç† NULL&lt;/strong&gt;&lt;br&gt;
è‹¥éœ€ä¸¥æ ¼é™åˆ¶åŒ…å« NULL çš„ç»„åˆå”¯ä¸€æ€§ï¼Œå¯æ”¹ç”¨å”¯ä¸€ç´¢å¼•å¹¶é…åˆ &lt;code&gt;WHERE&lt;/code&gt; æ¡ä»¶è¿‡æ»¤ NULLã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_unique_non_null&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;IS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤æ–¹å¼ä»…å¯¹é NULL å€¼ç”Ÿæ•ˆï¼Œå¯é¿å… NULL å¯¼è‡´çš„é‡å¤é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šç»„åˆå”¯ä¸€çº¦æŸæœ¬èº«ä¸å¼ºåˆ¶å­—æ®µéç©ºï¼Œä½†éœ€æ ¹æ®ä¸šåŠ¡é€»è¾‘å†³å®šæ˜¯å¦ç»“åˆ &lt;code&gt;NOT NULL&lt;/code&gt; æˆ–ä½¿ç”¨å”¯ä¸€ç´¢å¼•æ¥å®Œå–„çº¦æŸæ¡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id="ç»„åˆå”¯ä¸€"&gt;ç»„åˆå”¯ä¸€
&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;code&gt;@Inheritance(strategy = InheritanceType.SINGLE_TABLE)&lt;/code&gt; ç­–ç•¥ä¸‹ï¼Œè‹¥éœ€è¦ä¸ºå­ç±»å‹ &lt;code&gt;PostOpinion&lt;/code&gt; å’Œ &lt;code&gt;CommentOpinion&lt;/code&gt; åˆ†åˆ«å®šä¹‰ &lt;code&gt;(user, post)&lt;/code&gt; å’Œ &lt;code&gt;(user, comment)&lt;/code&gt; çš„ç»„åˆå”¯ä¸€çº¦æŸï¼Œéœ€ç»“åˆ &lt;strong&gt;ç»§æ‰¿ç­–ç•¥ç‰¹æ€§&lt;/strong&gt; å’Œ &lt;strong&gt;æ•°æ®åº“çº¦æŸ&lt;/strong&gt; å®ç°ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å¤„ç†æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="ç†è§£-single_"&gt;&lt;strong&gt;ç†è§£ SINGLE_TABLE ç»§æ‰¿ç­–ç•¥çš„ç‰¹æ€§&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¡¨ç»“æ„&lt;/strong&gt;ï¼šæ‰€æœ‰å­ç±»ï¼ˆ&lt;code&gt;PostOpinion&lt;/code&gt;ã€&lt;code&gt;CommentOpinion&lt;/code&gt;ï¼‰å…±äº«åŒä¸€ä¸ªè¡¨ &lt;code&gt;opinion&lt;/code&gt;ï¼Œé€šè¿‡ &lt;code&gt;dtype&lt;/code&gt; å­—æ®µï¼ˆæˆ–è‡ªå®šä¹‰çš„é‰´åˆ«å™¨åˆ—ï¼‰åŒºåˆ†ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µç‰¹ç‚¹&lt;/strong&gt;ï¼š&lt;code&gt;PostOpinion&lt;/code&gt; çš„ &lt;code&gt;comment&lt;/code&gt; å­—æ®µä¸º &lt;code&gt;NULL&lt;/code&gt;ï¼Œ&lt;code&gt;CommentOpinion&lt;/code&gt; çš„ &lt;code&gt;post&lt;/code&gt; å­—æ®µä¸º &lt;code&gt;NULL&lt;/code&gt;ã€‚éœ€é€šè¿‡ &lt;strong&gt;æ¡ä»¶å”¯ä¸€ç´¢å¼•&lt;/strong&gt; è§£å†³ &lt;code&gt;NULL&lt;/code&gt; å€¼å¯¹å”¯ä¸€æ€§çº¦æŸçš„å¹²æ‰°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å®šä¹‰å®ä½“ç»“æ„ä¸å”¯ä¸€çº¦æŸ"&gt;** å®šä¹‰å®ä½“ç»“æ„ä¸å”¯ä¸€çº¦æŸ**
&lt;/h3&gt;&lt;h4 id="çˆ¶ç±»"&gt;&lt;strong&gt;çˆ¶ç±» &lt;code&gt;Opinion&lt;/code&gt; çš„é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Inheritance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InheritanceType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;SINGLE_TABLE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DiscriminatorColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;dtype&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é‰´åˆ«å™¨åˆ—ï¼Œé»˜è®¤å€¼ä¸ºå­ç±»åç§°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;opinion&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;abstract&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Opinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¬å…±å­—æ®µ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å­ç±»"&gt;&lt;strong&gt;å­ç±» &lt;code&gt;PostOpinion&lt;/code&gt; çš„é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DiscriminatorValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;POST_OPINION&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é‰´åˆ«å™¨å€¼ï¼Œå¯¹åº” dtype å­—æ®µå€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Opinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;post_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å­ç±»-1"&gt;&lt;strong&gt;å­ç±» &lt;code&gt;CommentOpinion&lt;/code&gt; çš„é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@DiscriminatorValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;COMMENT_OPINION&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CommentOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Opinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@ManyToOne&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@JoinColumn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;comment_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Comment&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comment&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="å®ç°ç»„åˆå”¯ä¸€æ€§çº¦æŸ"&gt;&lt;strong&gt;å®ç°ç»„åˆå”¯ä¸€æ€§çº¦æŸ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç”±äº &lt;code&gt;SINGLE_TABLE&lt;/code&gt; ç­–ç•¥ä¸‹æ‰€æœ‰å­—æ®µå…±å­˜äºåŒä¸€è¡¨ï¼Œç›´æ¥ä½¿ç”¨ &lt;code&gt;@Table(uniqueConstraints)&lt;/code&gt; å®šä¹‰å…¨å±€å”¯ä¸€çº¦æŸä¼šå¯¼è‡´ &lt;code&gt;NULL&lt;/code&gt; å€¼ç ´åå”¯ä¸€æ€§ï¼ˆå¦‚ &lt;code&gt;PostOpinion&lt;/code&gt; çš„ &lt;code&gt;comment_id&lt;/code&gt; ä¸º &lt;code&gt;NULL&lt;/code&gt;ï¼Œ&lt;code&gt;CommentOpinion&lt;/code&gt; çš„ &lt;code&gt;post_id&lt;/code&gt; ä¸º &lt;code&gt;NULL&lt;/code&gt;ï¼‰ã€‚éœ€é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š&lt;/p&gt;
&lt;h4 id="æ–¹æ¡ˆä¸€æ•°æ®åº“éƒ¨åˆ†å”¯ä¸€ç´¢å¼•partial-unique-index"&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼šæ•°æ®åº“éƒ¨åˆ†å”¯ä¸€ç´¢å¼•ï¼ˆPartial Unique Indexï¼‰&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;é€šè¿‡ &lt;strong&gt;æ¡ä»¶ç´¢å¼•&lt;/strong&gt; å¯¹ç‰¹å®šå­ç±»å‹çš„å­—æ®µç»„åˆæ·»åŠ å”¯ä¸€çº¦æŸã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ &lt;code&gt;PostOpinion&lt;/code&gt;ï¼Œè¦æ±‚ &lt;code&gt;(user_id, post_id)&lt;/code&gt; å”¯ä¸€ï¼Œä¸” &lt;code&gt;dtype = 'POST_OPINION'&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ &lt;code&gt;CommentOpinion&lt;/code&gt;ï¼Œè¦æ±‚ &lt;code&gt;(user_id, comment_id)&lt;/code&gt; å”¯ä¸€ï¼Œä¸” &lt;code&gt;dtype = 'COMMENT_OPINION'&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å®ç°æ­¥éª¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ‰‹åŠ¨æ‰§è¡Œ SQL åˆ›å»ºç´¢å¼•&lt;/strong&gt;ï¼ˆæ¨èï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- é’ˆå¯¹ PostOpinion
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_post_opinion_unique&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dtype&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;POST_OPINION&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- é’ˆå¯¹ CommentOpinion
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_comment_opinion_unique&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comment_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dtype&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;COMMENT_OPINION&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šè¿‡ Hibernate æ³¨è§£ç”Ÿæˆç´¢å¼•&lt;/strong&gt;ï¼ˆéœ€ç»“åˆæ•°æ®åº“æ–¹è¨€ï¼‰ï¼š
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;opinion&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@org.hibernate.annotations.Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;appliesTo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;opinion&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;indexes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;idx_post_opinion_unique&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id, post_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;dtype = &amp;#39;POST_OPINION&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;idx_comment_opinion_unique&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id, comment_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;dtype = &amp;#39;COMMENT_OPINION&amp;#39;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;abstract&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Opinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="æ–¹æ¡ˆäºŒåº”ç”¨å±‚æ ¡éªŒ"&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼šåº”ç”¨å±‚æ ¡éªŒ&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ä¸šåŠ¡é€»è¾‘ä¸­æ‰‹åŠ¨æ£€æŸ¥å”¯ä¸€æ€§ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createPostOpinion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;boolean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinionRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;existsByUserAndPostAndDtype&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;POST_OPINION&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ConflictException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;ç”¨æˆ·å·²å¯¹è¯¥å¸–å­å‘è¡¨è§‚ç‚¹&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿å­˜æ“ä½œ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½å› ç«æ€æ¡ä»¶å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œéœ€ç»“åˆæ•°æ®åº“çº¦æŸå…œåº•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="æ³¨æ„äº‹é¡¹-1"&gt;&lt;strong&gt;æ³¨æ„äº‹é¡¹&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®åº“å…¼å®¹æ€§&lt;/strong&gt;&lt;br&gt;
éƒ¨åˆ†å”¯ä¸€ç´¢å¼•è¯­æ³•å› æ•°æ®åº“è€Œå¼‚ï¼ˆå¦‚ PostgreSQL æ”¯æŒ &lt;code&gt;WHERE&lt;/code&gt;ï¼ŒMySQL éœ€é€šè¿‡è™šæ‹Ÿåˆ—å®ç°ï¼‰ï¼Œéœ€æ ¹æ®å®é™…æ•°æ®åº“è°ƒæ•´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JPA è‡ªåŠ¨ç”Ÿæˆ DDL çš„é™åˆ¶&lt;/strong&gt;&lt;br&gt;
JPA æ— æ³•ç›´æ¥ç”Ÿæˆæ¡ä»¶ç´¢å¼•ï¼Œéœ€æ‰‹åŠ¨ç»´æŠ¤ DDL æˆ–é€šè¿‡å·¥å…·ï¼ˆå¦‚ Flywayï¼‰ç®¡ç†æ•°æ®åº“å˜æ›´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NULL å€¼çš„å¤„ç†&lt;/strong&gt;&lt;br&gt;
ç¡®ä¿å”¯ä¸€ç´¢å¼•ä¸­æ¶‰åŠçš„å­—æ®µä¸º &lt;code&gt;NOT NULL&lt;/code&gt;ï¼ˆå¦‚ &lt;code&gt;post_id&lt;/code&gt; åœ¨ &lt;code&gt;PostOpinion&lt;/code&gt; ä¸­ä¸å¯ä¸º &lt;code&gt;NULL&lt;/code&gt;ï¼‰ï¼Œå¯é€šè¿‡ &lt;code&gt;@Column(nullable = false)&lt;/code&gt; çº¦æŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-1"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æ¨èä½¿ç”¨ &lt;strong&gt;æ–¹æ¡ˆä¸€&lt;/strong&gt; çš„æ•°æ®åº“éƒ¨åˆ†å”¯ä¸€ç´¢å¼•ï¼Œé€šè¿‡æ‰‹åŠ¨æ‰§è¡Œ SQL æˆ– Hibernate æ‰©å±•æ³¨è§£å®ç°æ¡ä»¶çº¦æŸã€‚æ­¤æ–¹æ³•åœ¨æ•°æ®åº“å±‚é¢ä¿è¯å”¯ä¸€æ€§ï¼Œä¸”ä¸ JPA çš„ &lt;code&gt;SINGLE_TABLE&lt;/code&gt; ç­–ç•¥å…¼å®¹ã€‚è‹¥éœ€è‡ªåŠ¨åŒ–ç®¡ç† DDLï¼Œå¯ç»“åˆæ•°æ®åº“è¿ç§»å·¥å…·ï¼ˆå¦‚ Flywayï¼‰æ‰§è¡Œæ¡ä»¶ç´¢å¼•åˆ›å»ºè„šæœ¬ã€‚&lt;/p&gt;
&lt;h2 id="lastmodifieddate"&gt;@LastModifiedDate
&lt;/h2&gt;&lt;p&gt;Spring æ¡†æ¶ä¸­çš„ &lt;code&gt;@LastModifiedDate&lt;/code&gt; æ˜¯ &lt;strong&gt;Spring Data JPA&lt;/strong&gt; æä¾›çš„å®¡è®¡æ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨è®°å½•å®ä½“ç±»å­—æ®µçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒæœºåˆ¶å’Œåº”ç”¨åœºæ™¯çš„è¯¦ç»†è¯´æ˜ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="1-ä½œç”¨ä¸åŸç†"&gt;&lt;strong&gt;1. ä½œç”¨ä¸åŸç†&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨å®ä½“ç±»å­—æ®µä¸Šæ·»åŠ  &lt;code&gt;@LastModifiedDate&lt;/code&gt; åï¼Œå½“å®ä½“æ•°æ®è¢«ä¿®æ”¹å¹¶ä¿å­˜åˆ°æ•°æ®åº“æ—¶ï¼Œè¯¥å­—æ®µä¼šè‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´æˆ³ï¼Œæ— éœ€æ‰‹åŠ¨èµ‹å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº•å±‚ä¾èµ–&lt;/strong&gt;ï¼š&lt;br&gt;
è¯¥æ³¨è§£éœ€é…åˆ &lt;code&gt;@EntityListeners(AuditingEntityListener.class)&lt;/code&gt; ä½¿ç”¨ï¼Œç”± &lt;code&gt;AuditingEntityListener&lt;/code&gt; ç›‘å¬å®ä½“çš„æŒä¹…åŒ–æ“ä½œï¼ˆå¦‚ &lt;code&gt;save()&lt;/code&gt; æˆ– &lt;code&gt;update()&lt;/code&gt;ï¼‰ï¼Œè‡ªåŠ¨è§¦å‘æ—¶é—´æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="2-ä½¿ç”¨æ­¥éª¤"&gt;&lt;strong&gt;2. ä½¿ç”¨æ­¥éª¤&lt;/strong&gt;
&lt;/h3&gt;&lt;h4 id="1-å¯ç”¨-jpa-å®¡è®¡åŠŸèƒ½"&gt;(1) &lt;strong&gt;å¯ç”¨ JPA å®¡è®¡åŠŸèƒ½&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨ Spring Boot å¯åŠ¨ç±»ä¸­æ·»åŠ  &lt;code&gt;@EnableJpaAuditing&lt;/code&gt; æ³¨è§£ä»¥æ¿€æ´»å®¡è®¡åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@EnableJpaAuditing&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Application&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpringApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Application&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="2-å®ä½“ç±»é…ç½®"&gt;(2) &lt;strong&gt;å®ä½“ç±»é…ç½®&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;åœ¨å®ä½“ç±»ä¸­æ·»åŠ  &lt;code&gt;@EntityListeners&lt;/code&gt; åŠ &lt;code&gt;@LastModifiedDate&lt;/code&gt; æ³¨è§£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@EntityListeners&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AuditingEntityListener&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@LastModifiedDate&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updateTime&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­—æ®µç±»å‹å¯ä»¥æ˜¯ Date æˆ– Long&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@CreatedDate&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;updatable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nullable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;createTime&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆ›å»ºæ—¶é—´ï¼ˆä»…åœ¨é¦–æ¬¡æ’å…¥æ—¶èµ‹å€¼ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µç±»å‹&lt;/strong&gt;ï¼šæ”¯æŒ &lt;code&gt;Date&lt;/code&gt; æˆ– &lt;code&gt;Long&lt;/code&gt;ï¼ˆæ—¶é—´æˆ³æ ¼å¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³è”æ³¨è§£&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@CreatedDate&lt;/code&gt;ï¼šè®°å½•åˆ›å»ºæ—¶é—´ï¼Œä»…åœ¨é¦–æ¬¡æ’å…¥æ—¶èµ‹å€¼ï¼Œä¸”é€šè¿‡ &lt;code&gt;updatable = false&lt;/code&gt; ç¦æ­¢åç»­æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@LastModifiedBy&lt;/code&gt; / &lt;code&gt;@CreatedBy&lt;/code&gt;ï¼šå¯é€‰å­—æ®µï¼Œç”¨äºè®°å½•æ“ä½œç”¨æˆ·ï¼ˆéœ€é¢å¤–å®ç° &lt;code&gt;AuditorAware&lt;/code&gt; æ¥å£ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="3-ä¸å…¶ä»–ç¼“å­˜æœºåˆ¶çš„åŒºåˆ«"&gt;&lt;strong&gt;3. ä¸å…¶ä»–ç¼“å­˜æœºåˆ¶çš„åŒºåˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;éœ€æ³¨æ„ &lt;code&gt;@LastModifiedDate&lt;/code&gt; ä¸ &lt;strong&gt;HTTP ç¼“å­˜æœºåˆ¶&lt;/strong&gt;ï¼ˆå¦‚ &lt;code&gt;Last-Modified&lt;/code&gt; å¤´ï¼‰çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;code&gt;@LastModifiedDate&lt;/code&gt;ï¼ˆJPA å®¡è®¡ï¼‰&lt;/th&gt;
&lt;th&gt;HTTP &lt;code&gt;Last-Modified&lt;/code&gt; å¤´&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ•°æ®åº“å®ä½“æ›´æ–°æ—¶é—´è®°å½•&lt;/td&gt;
&lt;td&gt;æµè§ˆå™¨/æœåŠ¡å™¨èµ„æºç¼“å­˜éªŒè¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;è§¦å‘æ¡ä»¶&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å®ä½“ä¿å­˜æ“ä½œ&lt;/td&gt;
&lt;td&gt;HTTP è¯·æ±‚å¤´ &lt;code&gt;If-Modified-Since&lt;/code&gt; çš„å¯¹æ¯”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;å®ç°æ–¹å¼&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ³¨è§£ + å®¡è®¡ç›‘å¬å™¨&lt;/td&gt;
&lt;td&gt;å®ç° &lt;code&gt;LastModified&lt;/code&gt; æ¥å£æˆ– ETag è¿‡æ»¤å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ç¤ºä¾‹åœºæ™¯&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ä¿¡æ¯è¡¨è®°å½•æœ€åä¿®æ”¹æ—¶é—´&lt;/td&gt;
&lt;td&gt;é™æ€èµ„æºï¼ˆå¦‚ CSS æ–‡ä»¶ï¼‰çš„ç¼“å­˜æ§åˆ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HTTP ç¼“å­˜ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;br&gt;
è‹¥éœ€å®ç°ç±»ä¼¼æµè§ˆå™¨çš„èµ„æºç¼“å­˜æœºåˆ¶ï¼Œå¯é€šè¿‡ Spring MVC çš„ &lt;code&gt;LastModified&lt;/code&gt; æ¥å£æˆ–é…ç½® &lt;code&gt;ShallowEtagHeaderFilter&lt;/code&gt; è¿‡æ»¤å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="4-å®é™…åº”ç”¨å»ºè®®"&gt;&lt;strong&gt;4. å®é™…åº”ç”¨å»ºè®®&lt;/strong&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®¡è®¡å­—æ®µæ ‡å‡†åŒ–&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨è¡¨è®¾è®¡ä¸­ç»Ÿä¸€åŒ…å« &lt;code&gt;create_time&lt;/code&gt; å’Œ &lt;code&gt;update_time&lt;/code&gt; å­—æ®µï¼Œä¾¿äºæ•°æ®è¿½æº¯å’Œåˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…å­—æ®µè¦†ç›–&lt;/strong&gt;ï¼š&lt;br&gt;
ç¡®ä¿ &lt;code&gt;@CreatedDate&lt;/code&gt; å­—æ®µçš„ &lt;code&gt;updatable = false&lt;/code&gt; å±æ€§ï¼Œé˜²æ­¢ä¸šåŠ¡ä»£ç è¯¯ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•ç”¨æˆ·è¿½è¸ª&lt;/strong&gt;ï¼š&lt;br&gt;
ç»“åˆ &lt;code&gt;@CreatedBy&lt;/code&gt; å’Œ &lt;code&gt;@LastModifiedBy&lt;/code&gt;ï¼Œè®°å½•æ“ä½œäººä¿¡æ¯ï¼ˆéœ€è‡ªå®šä¹‰ &lt;code&gt;AuditorAware&lt;/code&gt; å®ç°ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-2"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@LastModifiedDate&lt;/code&gt; æ˜¯ Spring Data JPA ä¸­ç®€åŒ–æ•°æ®å®¡è®¡çš„æ ¸å¿ƒæ³¨è§£ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æ—¶é—´æˆ³ç®¡ç†æå‡äº†å¼€å‘æ•ˆç‡ã€‚å¯¹äºéœ€è¦åŒæ—¶è®°å½•åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´çš„åœºæ™¯ï¼Œå»ºè®®ä¸ &lt;code&gt;@CreatedDate&lt;/code&gt; é…åˆä½¿ç”¨ï¼Œå½¢æˆå®Œæ•´çš„å®¡è®¡æ—¥å¿—ä½“ç³»ã€‚è‹¥éœ€è¿›ä¸€æ­¥äº†è§£ HTTP ç¼“å­˜ç›¸å…³æœºåˆ¶ï¼Œå¯å‚è€ƒ Spring çš„ &lt;code&gt;LastModified&lt;/code&gt; æ¥å£æˆ– ETag å®ç°ã€‚&lt;/p&gt;
&lt;h2 id="mappedsuperclass"&gt;@MappedSuperclass
&lt;/h2&gt;&lt;p&gt;æ ¹æ® JPA è§„èŒƒçš„è®¾è®¡æ„å›¾å’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œ&lt;strong&gt;å¦‚æœä»…éœ€é€šè¿‡ç»§æ‰¿è¡¨ç¤º &lt;code&gt;CommentOpinion&lt;/code&gt; å’Œ &lt;code&gt;PostOpinion&lt;/code&gt; å…±äº«æŸäº›è¡Œä¸ºï¼ˆå¦‚å…¬å…±å­—æ®µæˆ–æ–¹æ³•ï¼‰ï¼Œä¸”æ²¡æœ‰å¤šæ€æŸ¥è¯¢éœ€æ±‚ï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨ &lt;code&gt;@Inheritance&lt;/code&gt; æ³¨è§£&lt;/strong&gt;ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-inheritance-çš„æ ¸å¿ƒä½œç”¨"&gt;** &lt;code&gt;@Inheritance&lt;/code&gt; çš„æ ¸å¿ƒä½œç”¨**
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;@Inheritance&lt;/code&gt; æ³¨è§£æ˜¯ JPA ä¸­ç”¨äºå®šä¹‰å®ä½“ç»§æ‰¿æ˜ å°„ç­–ç•¥çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶ç›®çš„æ˜¯è§£å†³ä»¥ä¸‹ä¸¤ç±»é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ€æŸ¥è¯¢&lt;/strong&gt;ï¼šé€šè¿‡çˆ¶ç±»æŸ¥è¯¢æ‰€æœ‰å­ç±»å®ä¾‹ï¼ˆå¦‚ &lt;code&gt;SELECT o FROM Opinion o&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“è¡¨ç»“æ„çš„ç»§æ‰¿å…³ç³»æ˜ å°„&lt;/strong&gt;ï¼šå°†ç»§æ‰¿å…³ç³»æ˜ å°„ä¸ºå•è¡¨ï¼ˆ&lt;code&gt;SINGLE_TABLE&lt;/code&gt;ï¼‰ã€è¿æ¥è¡¨ï¼ˆ&lt;code&gt;JOINED&lt;/code&gt;ï¼‰æˆ–ç‹¬ç«‹è¡¨ï¼ˆ&lt;code&gt;TABLE_PER_CLASS&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šè‹¥æ— å¤šæ€æŸ¥è¯¢éœ€æ±‚ï¼Œä¸”ä»…éœ€å…±äº«è¡Œä¸ºï¼ˆå¦‚å…¬å…±å­—æ®µæˆ–æ–¹æ³•ï¼‰ï¼Œåˆ™ &lt;code&gt;@Inheritance&lt;/code&gt; å¹¶éå¿…è¦ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-æ›¿ä»£æ–¹æ¡ˆmappedsuperclass"&gt;** æ›¿ä»£æ–¹æ¡ˆï¼š&lt;code&gt;@MappedSuperclass&lt;/code&gt;**
&lt;/h3&gt;&lt;p&gt;å½“ç›®æ ‡æ˜¯ä»£ç å¤ç”¨è€Œéå¤šæ€æŸ¥è¯¢æ—¶ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ &lt;strong&gt;&lt;code&gt;@MappedSuperclass&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šå°†å…¬å…±å­—æ®µå’Œæ–¹æ³•å®šä¹‰åœ¨çˆ¶ç±»ä¸­ï¼Œå­ç±»é€šè¿‡ç»§æ‰¿å¤ç”¨ä»£ç ï¼Œä½†çˆ¶ç±»ä¸æ˜ å°„ä¸ºç‹¬ç«‹å®ä½“è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— å†—ä½™è¡¨ç»“æ„&lt;/strong&gt;ï¼šçˆ¶ç±»ä¸ä¼šè¢«æ˜ å°„ä¸ºæ•°æ®åº“è¡¨ï¼Œå­ç±»å„è‡ªç‹¬ç«‹ç”Ÿæˆå®Œæ•´è¡¨ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç®€åŒ–ç»´æŠ¤&lt;/strong&gt;ï¼šé¿å…å› ç»§æ‰¿ç­–ç•¥ï¼ˆå¦‚ &lt;code&gt;SINGLE_TABLE&lt;/code&gt; çš„è¾¨åˆ«åˆ—æˆ– &lt;code&gt;JOINED&lt;/code&gt; çš„å¤–é”®å…³è”ï¼‰å¼•å…¥çš„å¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@MappedSuperclass&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;abstract&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å…¬å…±æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;logActivity&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/* ... */&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;comment_opinions&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CommentOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BaseOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;comment_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commentId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Entity&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;post_opinions&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BaseOpinion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;post_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postId&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="-ä½¿ç”¨-inheritance-çš„æ½œåœ¨é—®é¢˜"&gt;** ä½¿ç”¨ &lt;code&gt;@Inheritance&lt;/code&gt; çš„æ½œåœ¨é—®é¢˜**
&lt;/h3&gt;&lt;p&gt;è‹¥å¼ºåˆ¶ä½¿ç”¨ &lt;code&gt;@Inheritance&lt;/code&gt; æ³¨è§£ï¼ˆå¦‚ &lt;code&gt;TABLE_PER_CLASS&lt;/code&gt;ï¼‰ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†—ä½™è¡¨ç»“æ„&lt;/strong&gt;ï¼šæ¯ä¸ªå­ç±»è¡¨ä¼šåŒ…å«çˆ¶ç±»æ‰€æœ‰å­—æ®µï¼ˆå¦‚ &lt;code&gt;user_id&lt;/code&gt;ï¼‰ï¼Œå³ä½¿ä»…éœ€å…±äº«è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ID ç”Ÿæˆç­–ç•¥é™åˆ¶&lt;/strong&gt;ï¼šéœ€é¿å…ä½¿ç”¨ &lt;code&gt;GenerationType.IDENTITY&lt;/code&gt;ï¼Œå¦åˆ™å­ç±»è¡¨å¯èƒ½å› ç‹¬ç«‹è‡ªå¢åºåˆ—å¯¼è‡´ ID å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥è¯¢æ€§èƒ½æŸè€—&lt;/strong&gt;ï¼šå³ä½¿æ— å¤šæ€æŸ¥è¯¢ï¼ŒæŸäº› ORM æ¡†æ¶ä»å¯èƒ½ç”Ÿæˆä¸å¿…è¦çš„ &lt;code&gt;UNION&lt;/code&gt; æ“ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 id="-ä½•æ—¶å¿…é¡»ä½¿ç”¨-inheritance"&gt;** ä½•æ—¶å¿…é¡»ä½¿ç”¨ &lt;code&gt;@Inheritance&lt;/code&gt;ï¼Ÿ**
&lt;/h3&gt;&lt;p&gt;ä»…å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€æ—¶éœ€ä½¿ç”¨ &lt;code&gt;@Inheritance&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦å¤šæ€æŸ¥è¯¢&lt;/strong&gt;ï¼šä¾‹å¦‚é€šè¿‡çˆ¶ç±» &lt;code&gt;Opinion&lt;/code&gt; æŸ¥è¯¢æ‰€æœ‰å­ç±»å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦æ•°æ®åº“è¡¨ç»“æ„çš„ç»§æ‰¿æ˜ å°„&lt;/strong&gt;ï¼šä¾‹å¦‚è¦æ±‚å­ç±»è¡¨ä¸çˆ¶ç±»è¡¨é€šè¿‡å¤–é”®å…³è”ï¼ˆ&lt;code&gt;JOINED&lt;/code&gt; ç­–ç•¥ï¼‰æˆ–å…±äº«å•è¡¨ï¼ˆ&lt;code&gt;SINGLE_TABLE&lt;/code&gt; ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="æ€»ç»“-3"&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ— éœ€ &lt;code&gt;@Inheritance&lt;/code&gt; çš„åœºæ™¯&lt;/strong&gt;ï¼šä»…å…±äº«ä»£ç é€»è¾‘ï¼Œæ— å¤šæ€æŸ¥è¯¢éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èæ–¹æ¡ˆ&lt;/strong&gt;ï¼šä½¿ç”¨ &lt;code&gt;@MappedSuperclass&lt;/code&gt; å®ç°ä»£ç å¤ç”¨ï¼Œå­ç±»ç‹¬ç«‹æ˜ å°„ä¸ºè¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…è¿‡åº¦è®¾è®¡&lt;/strong&gt;ï¼šJPA ç»§æ‰¿ç­–ç•¥æ˜¯ä¸ºå¤šæ€å’Œè¡¨ç»“æ„æ˜ å°„è®¾è®¡çš„ï¼Œè‹¥ä»…éœ€ä»£ç å¤ç”¨ï¼Œåº”é€‰æ‹©æ›´è½»é‡çš„æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>ã€Postopiaã€‘æµ‹è¯•æ–‡æ¡£</title><link>https://dyhes.github.io/p/postopia%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/</link><pubDate>Thu, 21 Nov 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/</guid><description>&lt;h2 id="åŠŸèƒ½æµ‹è¯•"&gt;åŠŸèƒ½æµ‹è¯•
&lt;/h2&gt;&lt;h3 id="auth-æ¨¡å—"&gt;Auth æ¨¡å—
&lt;/h3&gt;&lt;h4 id="æ³¨å†Œ"&gt;æ³¨å†Œ
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/auth/signup&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/GQYGz10b/image-20241116151800761.png"
loading="lazy"
alt="image-20241116151800761"
&gt;&lt;/p&gt;
&lt;h4 id="ç™»å½•"&gt;ç™»å½•
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/auth/login&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/SwwHfFN4/image-20241116152536622.png"
loading="lazy"
alt="image-20241116152536622"
&gt;&lt;/p&gt;
&lt;h4 id="åˆ·æ–°accesstoken"&gt;åˆ·æ–°AccessToken
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/auth/refresh&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/WWKMcTJx/image-20241116152658318.png"
loading="lazy"
alt="image-20241116152658318"
&gt;&lt;/p&gt;
&lt;h3 id="user-æ¨¡å—"&gt;User æ¨¡å—
&lt;/h3&gt;&lt;h4 id="ç»‘å®šé‚®ç®±è¯·æ±‚"&gt;ç»‘å®šé‚®ç®±è¯·æ±‚
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/email/request/{email}&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/Z6gD70yh/image-20241116152918598.png"
loading="lazy"
alt="image-20241116152918598"
&gt;&lt;/p&gt;
&lt;h4 id="ç»‘å®šé‚®ç®±"&gt;ç»‘å®šé‚®ç®±
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/email/verify/{email}/{code}&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/Rpxz5Lh3/image-20241116153135404.png"
loading="lazy"
alt="image-20241116153135404"
&gt;&lt;/p&gt;
&lt;h4 id="æ›´æ–°å¤´åƒ"&gt;æ›´æ–°å¤´åƒ
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/avatar&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/ynBLY4mq/image-20241116153656292.png"
loading="lazy"
alt="image-20241116153656292"
&gt;&lt;/p&gt;
&lt;h4 id="æ›´æ”¹æ˜µç§°"&gt;æ›´æ”¹æ˜µç§°
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/nickname&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/hxBFZxJY/image-20241116153800408.png"
loading="lazy"
alt="image-20241116153800408"
&gt;&lt;/p&gt;
&lt;h4 id="è·å–åŠ å…¥çš„ç©ºé—´"&gt;è·å–åŠ å…¥çš„ç©ºé—´
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/spaces&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/0yCMmSs0/image-20241116155949107.png"
loading="lazy"
alt="image-20241116155949107"
&gt;&lt;/p&gt;
&lt;h4 id="è·å–å‘å¸ƒçš„å¸–å­"&gt;è·å–å‘å¸ƒçš„å¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/posts&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/Zw6LSYY/image-20241116165235571.png"
loading="lazy"
alt="image-20241116165235571"
&gt;&lt;/p&gt;
&lt;h4 id="è·å–å‘è¡¨çš„è¯„è®º"&gt;è·å–å‘è¡¨çš„è¯„è®º
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/user/comments&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/tTfK1Pkp/image-20241117134701670.png"
loading="lazy"
alt="image-20241117134701670"
&gt;&lt;/p&gt;
&lt;h3 id="space-æ¨¡å—"&gt;Space æ¨¡å—
&lt;/h3&gt;&lt;h4 id="åˆ›å»ºç©ºé—´"&gt;åˆ›å»ºç©ºé—´
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/space/create&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/B2w1XsLj/image-20241116154137610.png"
loading="lazy"
alt="image-20241116154137610"
&gt;&lt;/p&gt;
&lt;h4 id="åŠ å…¥ç©ºé—´"&gt;åŠ å…¥ç©ºé—´
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/auth/refresh&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/WWG4x9P9/image-20241116162519817.png"
loading="lazy"
alt="image-20241116162519817"
&gt;&lt;/p&gt;
&lt;h4 id="ç¦»å¼€ç©ºé—´"&gt;ç¦»å¼€ç©ºé—´
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/space/leave&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/m5N0PxWJ/image-20241116162042609.png"
loading="lazy"
alt="image-20241116162042609"
&gt;&lt;/p&gt;
&lt;h4 id="è·å–æµè¡Œç©ºé—´"&gt;è·å–æµè¡Œç©ºé—´
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/space/list&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/hJ3Dfn8Z/image-20241116155726767.png"
loading="lazy"
alt="image-20241116155726767"
&gt;&lt;/p&gt;
&lt;h3 id="post-æ¨¡å—"&gt;Post æ¨¡å—
&lt;/h3&gt;&lt;h4 id="åˆ›å»ºå¸–å­"&gt;åˆ›å»ºå¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/create&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/hjKDymb/image-20241116162348614.png"
loading="lazy"
alt="image-20241116162348614"
&gt;&lt;/p&gt;
&lt;h4 id="å›å¤å¸–å­"&gt;å›å¤å¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/reply&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/Rp96jR0Z/image-20241116165358137.png"
loading="lazy"
alt="image-20241116165358137"
&gt;&lt;/p&gt;
&lt;h4 id="åˆ é™¤å¸–å­"&gt;åˆ é™¤å¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/delete&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/s9MNC3XY/image-20241116171343819.png"
loading="lazy"
alt="image-20241116171343819"
&gt;&lt;/p&gt;
&lt;h4 id="æŸ¥è¯¢ç©ºé—´å¸–å­"&gt;æŸ¥è¯¢ç©ºé—´å¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/list&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/KctyNVby/image-20241116172454216.png"
loading="lazy"
alt="image-20241116172454216"
&gt;&lt;/p&gt;
&lt;h4 id="æŸ¥è¯¢å¸–å­ä¿¡æ¯"&gt;æŸ¥è¯¢å¸–å­ä¿¡æ¯
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/info&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/nNMbLQfs/image-20241116174043569.png"
loading="lazy"
alt="image-20241116174043569"
&gt;&lt;/p&gt;
&lt;h4 id="åå¯¹å¸–å­"&gt;åå¯¹å¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/dislike&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/HL9MRR96/image-20241117145951266.png"
loading="lazy"
alt="image-20241117145951266"
&gt;&lt;/p&gt;
&lt;h4 id="èµåŒå¸–å­"&gt;èµåŒå¸–å­
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/post/like&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/MmnHtY6/image-20241117150053257.png"
loading="lazy"
alt="image-20241117150053257"
&gt;&lt;/p&gt;
&lt;h3 id="comment-æ¨¡å—"&gt;Comment æ¨¡å—
&lt;/h3&gt;&lt;h4 id="å›å¤è¯„è®º"&gt;å›å¤è¯„è®º
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/comment/reply&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/fdZMQxF4/image-20241117135748382.png"
loading="lazy"
alt="image-20241117135748382"
&gt;&lt;/p&gt;
&lt;h4 id="åˆ é™¤è¯„è®º"&gt;åˆ é™¤è¯„è®º
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/comment/delete&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/fV698sYJ/image-20241117135855575.png"
loading="lazy"
alt="image-20241117135855575"
&gt;&lt;/p&gt;
&lt;h4 id="æŸ¥è¯¢å¸–å­è¯„è®º"&gt;æŸ¥è¯¢å¸–å­è¯„è®º
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/comment/like&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/LXtf6y0z/image-20241117145610531.png"
loading="lazy"
alt="image-20241117145610531"
&gt;&lt;/p&gt;
&lt;h4 id="èµåŒè¯„è®º"&gt;èµåŒè¯„è®º
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/comment/like&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/XPMfNdY/image-20241117145759705.png"
loading="lazy"
alt="image-20241117145759705"
&gt;&lt;/p&gt;
&lt;h4 id="èµåŒè¯„è®º-1"&gt;èµåŒè¯„è®º
&lt;/h4&gt;&lt;p&gt;æ¥å£ï¼š/comment/dislike&lt;/p&gt;
&lt;p&gt;ç»“æœï¼šæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/HL92mkFC/image-20241117145716339.png"
loading="lazy"
alt="image-20241117145716339"
&gt;&lt;/p&gt;</description></item><item><title>ã€Postopiaã€‘è®¾è®¡æ–‡æ¡£</title><link>https://dyhes.github.io/p/postopia%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/</link><pubDate>Tue, 19 Nov 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/</guid><description>&lt;h2 id="1-æ¦‚å¿µè®¾è®¡"&gt;1. æ¦‚å¿µè®¾è®¡
&lt;/h2&gt;&lt;h3 id="11-erå›¾"&gt;1.1 ERå›¾
&lt;/h3&gt;&lt;p&gt;ä¸‹å›¾ä¸ºè®ºå›ç³»ç»Ÿæ•°æ®åº“è®¾è®¡çš„ERå›¾ï¼Œä¸ºäº†ç®€æ´æœŸé—´æˆ‘ä»¬ä»ERå›¾ä¸­ç§»é™¤äº†å®ä½“å…±æœ‰çš„å±æ€§ï¼ˆidï¼Œåˆ›å»ºæ—¥æœŸç­‰ï¼‰ï¼Œä»…åœ¨åç»­çš„æ•°æ®å­—å…¸ä¸­ä½“ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://i.ibb.co/rG9dCHRq/image-20241114213022716.png"
loading="lazy"
alt="image-20241114213022716"
&gt;&lt;/p&gt;
&lt;h3 id="12-æ•°æ®å­—å…¸"&gt;1.2 æ•°æ®å­—å…¸
&lt;/h3&gt;&lt;h4 id="121-ç”¨æˆ·"&gt;1.2.1 ç”¨æˆ·
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å±æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;username&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;UNIQUE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€ç”¨æˆ·åã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;nickname&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å¯é€‰æ˜µç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;password&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„åŠ å¯†å¯†ç ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;email&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;showEmail&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å‘å…¶ä»–äººæ˜¾ç¤ºç”µå­é‚®ä»¶åœ°å€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¤´åƒå›¾ç‰‡çš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bindedWeChat&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ç»‘å®šçš„å¾®ä¿¡è´¦å·ï¼ˆå¯é€‰å­—æ®µï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bindedAliPay&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ç»‘å®šçš„æ”¯ä»˜å®è´¦å·ï¼ˆå¯é€‰å­—æ®µï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="122-ç©ºé—´"&gt;1.2.2 ç©ºé—´
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å±æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;name&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;UNIQUE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€åç§°ï¼Œç”¨äºæ ‡è¯†æ¯ä¸ªç©ºé—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;description&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„æè¿°ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºä»‹ç»ç©ºé—´çš„ç›®çš„å’Œå†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isArchived&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è¯†ç©ºé—´æ˜¯å¦è¢«å½’æ¡£ï¼ˆå½’æ¡£åå¯èƒ½ä¸å†æ´»è·ƒï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´å¤´åƒçš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="123-å¸–å­"&gt;1.2.3 å¸–å­
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å±æ€§&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;subject&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„ä¸»é¢˜ï¼Œç”¨äºæ ‡é¢˜æˆ–æ¦‚è¿°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å†…å®¹ï¼Œé€šå¸¸ä¸ºæ­£æ–‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;status&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TINYINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ENUM(ORDINAL)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„çŠ¶æ€ï¼ˆä¾‹å¦‚è‰ç¨¿ã€å·²å‘å¸ƒã€è¢«åˆ é™¤ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;commentCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è¯„è®ºæ€»æ•°é‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="124-è¯„è®º"&gt;1.2.4 è¯„è®º
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£æ–‡å†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºåˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="125-è§‚ç‚¹"&gt;1.2.5 è§‚ç‚¹
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ„è§çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ„è§åˆ›å»ºçš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isPositive&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è¯†è¯¥æ„è§æ˜¯å¦ä¸ºæ­£å‘æ„è§ï¼ˆä¾‹å¦‚ç‚¹èµï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;opinion_type&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(31)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºåŒºåˆ†æ„è§çš„ç±»å‹ï¼ˆä¾‹å¦‚è¯„è®ºæ„è§æˆ–å¸–å­æ„è§ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="126-é€šçŸ¥"&gt;1.2.6 é€šçŸ¥
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•ç”¨æˆ·åŠ å…¥ç©ºé—´çš„æ—¶é—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šçŸ¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="127-å…³ç³»"&gt;1.2.7 å…³ç³»
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å…³è”å®ä½“1&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;å…³è”å®ä½“2&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;è§£é‡Š&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·&lt;/td&gt;
&lt;td&gt;ç©ºé—´&lt;/td&gt;
&lt;td&gt;å¤šå¯¹å¤š&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¯ä»¥åŠ å…¥å¤šä¸ªç©ºé—´ï¼Œç©ºé—´å¯ä»¥æ‹¥æœ‰å¤šä¸ªç”¨æˆ·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·&lt;/td&gt;
&lt;td&gt;å¸–å­&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šä¸ªå¸–å­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·&lt;/td&gt;
&lt;td&gt;è¯„è®º&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¯ä»¥å‘è¡¨å¤šä¸ªè¯„è®º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·&lt;/td&gt;
&lt;td&gt;è§‚ç‚¹&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¯ä»¥å‘è¡¨å¤šä¸ªè§‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·&lt;/td&gt;
&lt;td&gt;é€šçŸ¥&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¯ä»¥æ”¶åˆ°å¤šä¸ªé€šçŸ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç©ºé—´&lt;/td&gt;
&lt;td&gt;å¸–å­&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;ç©ºé—´ä¸­å¯ä»¥æœ‰å¤šä¸ªå¸–å­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¸–å­&lt;/td&gt;
&lt;td&gt;è¯„è®º&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;å¸–å­å¯ä»¥æœ‰å¤šä¸ªè¯„è®º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¸–å­&lt;/td&gt;
&lt;td&gt;è§‚ç‚¹&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;å¸–å­å¯ä»¥æ”¶åˆ°å¤šä¸ªèµåŒæˆ–åå¯¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯„è®º&lt;/td&gt;
&lt;td&gt;è¯„è®º&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;è¯„è®ºå¯ä»¥æœ‰å¤šä¸ªå­è¯„è®º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯„è®º&lt;/td&gt;
&lt;td&gt;è§‚ç‚¹&lt;/td&gt;
&lt;td&gt;ä¸€å¯¹å¤š&lt;/td&gt;
&lt;td&gt;è¯„è®ºå¯ä»¥æ”¶åˆ°å¤šä¸ªèµåŒæˆ–åå¯¹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="13-ç”¨ä¾‹å›¾"&gt;1.3 ç”¨ä¾‹å›¾
&lt;/h3&gt;&lt;p&gt;&lt;img src="https://i.ibb.co/60pL0ZJv/image-20241115193639427.png"
loading="lazy"
alt="image-20241115193639427"
&gt;&lt;/p&gt;
&lt;h2 id="2-é€»è¾‘è®¾è®¡"&gt;2. é€»è¾‘è®¾è®¡
&lt;/h2&gt;&lt;h3 id="21-å…¨å±€é€»è¾‘è®¾è®¡"&gt;2.1 å…¨å±€é€»è¾‘è®¾è®¡
&lt;/h3&gt;&lt;h4 id="211-è¡¨ç»“æ„è®¾è®¡"&gt;2.1.1 è¡¨ç»“æ„è®¾è®¡
&lt;/h4&gt;&lt;h5 id="2111-users"&gt;2.1.1.1 users
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;username&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;UNIQUE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€ç”¨æˆ·åã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;nickname&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å¯é€‰æ˜µç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;password&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„åŠ å¯†å¯†ç ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;email&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;showEmail&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å‘å…¶ä»–äººæ˜¾ç¤ºç”µå­é‚®ä»¶åœ°å€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¤´åƒå›¾ç‰‡çš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bindedWeChat&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ç»‘å®šçš„å¾®ä¿¡è´¦å·ï¼ˆå¯é€‰å­—æ®µï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bindedAliPay&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ç»‘å®šçš„æ”¯ä»˜å®è´¦å·ï¼ˆå¯é€‰å­—æ®µï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2112-spaces"&gt;2.1.1.2 spaces
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;name&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;UNIQUE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€åç§°ï¼Œç”¨äºæ ‡è¯†æ¯ä¸ªç©ºé—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;description&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„æè¿°ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºä»‹ç»ç©ºé—´çš„ç›®çš„å’Œå†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isArchived&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è¯†ç©ºé—´æ˜¯å¦è¢«å½’æ¡£ï¼ˆå½’æ¡£åå¯èƒ½ä¸å†æ´»è·ƒï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´å¤´åƒçš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2113-posts"&gt;2.1.1.3 posts
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;subject&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„ä¸»é¢˜ï¼Œç”¨äºæ ‡é¢˜æˆ–æ¦‚è¿°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å†…å®¹ï¼Œé€šå¸¸ä¸ºæ­£æ–‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;, &lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å‘å¸ƒå¸–å­çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;, &lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­æ‰€å±ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;status&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TINYINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ENUM(ORDINAL)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„çŠ¶æ€ï¼ˆä¾‹å¦‚è‰ç¨¿ã€å·²å‘å¸ƒã€è¢«åˆ é™¤ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;commentCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è¯„è®ºæ€»æ•°é‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2114-comments"&gt;2.1.1.4 comments
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£æ–‡å†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å‘å¸ƒè¯„è®ºçš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;post_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºæ‰€å±å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;posts&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;, &lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºæ‰€å±ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;parent_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;çˆ¶çº§è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºæ”¯æŒè¯„è®ºçš„åµŒå¥—ç»“æ„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºåˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2115-opinions"&gt;2.1.1.5 opinions
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ„è§çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ„è§åˆ›å»ºçš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isPositive&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è¯†è¯¥æ„è§æ˜¯å¦ä¸ºæ­£å‘æ„è§ï¼ˆä¾‹å¦‚ç‚¹èµï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æäº¤è¯¥æ„è§çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;opinion_type&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(31)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºåŒºåˆ†æ„è§çš„ç±»å‹ï¼ˆä¾‹å¦‚è¯„è®ºæ„è§æˆ–å¸–å­æ„è§ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;post_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯¥æ„è§ç›¸å…³çš„å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;posts&lt;/code&gt; è¡¨ï¼Œä»…åœ¨æ„è§ä¸ºå¸–å­æ„è§æ—¶æœ‰æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;comment_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯¥æ„è§ç›¸å…³çš„è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;comments&lt;/code&gt; è¡¨ï¼Œä»…åœ¨æ„è§ä¸ºè¯„è®ºæ„è§æ—¶æœ‰æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2116-notifications"&gt;2.1.1.6 notifications
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;, &lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•ç”¨æˆ·åŠ å…¥ç©ºé—´çš„æ—¶é—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šçŸ¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2117-space_user_infos"&gt;2.1.1.7 space_user_infos
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;, &lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;, &lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•ç”¨æˆ·åŠ å…¥ç©ºé—´çš„æ—¶é—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;lastActiveAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DATE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·åœ¨ç©ºé—´ä¸­æœ€è¿‘æ´»è·ƒçš„æ—¥æœŸã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="212-ç´¢å¼•è®¾è®¡"&gt;2.1.2 ç´¢å¼•è®¾è®¡
&lt;/h4&gt;&lt;p&gt;OceanBase æ•°æ®åº“ä¸­ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šæœ¬åœ°ç´¢å¼•å’Œå…¨å±€ç´¢å¼•ã€‚ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼šæœ¬åœ°ç´¢å¼•ä¸åˆ†åŒºæ•°æ®å…±ç”¨åˆ†åŒºï¼Œå…¨å±€ç´¢å¼•ä¸ºå•ç‹¬åˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;OceanBaseæ¨èæŒ‰ç…§æœ¬åœ°ç´¢å¼•-&amp;gt;å…¨å±€åˆ†åŒºç´¢å¼•-&amp;gt;å…¨å±€ç´¢å¼•çš„é¡ºåºè¿›è¡Œé€‰æ‹©ï¼Œéå¿…è¦æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨å…¨å±€ç´¢å¼•ã€‚å…¨å±€ç´¢å¼•ç»´æŠ¤ä»£ä»·å¾ˆé«˜ï¼Œæ•°æ®çš„å¢åˆ æ”¹éƒ½éœ€è¦ç»´æŠ¤å…¨å±€ç´¢å¼•ï¼Œ ä¸é€‚å®œå¤§é‡ä½¿ç”¨ã€‚æ•°æ®çš„æŸ¥è¯¢è¦å°½é‡ä½¿ç”¨ä¸»é”®æˆ–åªè¦æ•°æ®èƒ½åœ¨åˆ†åŒºå†…ä¿è¯å”¯ä¸€ï¼Œåˆ™æ²¡å¿…è¦ä½¿ç”¨å…¨å±€ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤é™¤äº†å…¨å±€çš„ä¸»é”®ç´¢å¼•ï¼ˆOceanBaseè‡ªåŠ¨å»ºç«‹ï¼‰å¤–ï¼Œä»…å»ºç«‹æœ¬åœ°ç´¢å¼•ï¼Œå…¶ç»†èŠ‚å°†åœ¨ 2.3 å±€éƒ¨é€»è¾‘è®¾è®¡ä¸­è¯¦ç»†è®¨è®ºã€‚&lt;/p&gt;
&lt;h4 id="213-è§†å›¾è®¾è®¡"&gt;2.1.3 è§†å›¾è®¾è®¡
&lt;/h4&gt;&lt;p&gt;è€ƒè™‘åˆ°åœ¨å±•ç¤ºå¸–å­åˆ—è¡¨ã€å¸–å­è¯„è®ºæ—¶éœ€è¦åŒæ—¶å±•ç¤ºå‘å¸–è€…ã€è¯„è®ºè€…ä¿¡æ¯ï¼Œå»ºç«‹è§†å›¾ user_posts å’Œ user_commentsã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;user_postsï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;subject&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„ä¸»é¢˜ï¼Œç”¨äºæ ‡é¢˜æˆ–æ¦‚è¿°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å†…å®¹ï¼Œé€šå¸¸ä¸ºæ­£æ–‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­æ‰€å±ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;status&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TINYINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„çŠ¶æ€ï¼ˆä¾‹å¦‚è‰ç¨¿ã€å·²å‘å¸ƒã€è¢«åˆ é™¤ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;commentCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è¯„è®ºæ€»æ•°é‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ· idã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;nickname&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å¯é€‰æ˜µç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¤´åƒå›¾ç‰‡çš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;user_commentsï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£æ–‡å†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;post_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºæ‰€å±å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;posts&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºåˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ· idã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;nickname&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å¯é€‰æ˜µç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¤´åƒå›¾ç‰‡çš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è€ƒè™‘åˆ°è¯·æ±‚ç©ºé—´åˆ—è¡¨æ—¶éœ€è¦æ ¹æ®åŠ å…¥ç©ºé—´çš„äººæ•°å¯¹ç©ºé—´è¿›è¡Œæ’åºï¼Œå› æ­¤å»ºç«‹æŒä¹…åŒ–è§†å›¾ space_member_countså¹¶å®šæœŸåˆ·æ–°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;space_member_countsï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;count&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŠ å…¥ç©ºé—´çš„ç”¨æˆ·æ•°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id="214-è§„èŒƒåŒ–"&gt;2.1.4 è§„èŒƒåŒ–
&lt;/h4&gt;&lt;p&gt;ä¸Šè¿°è¡¨ç¬¦åˆBCNFèŒƒå¼ï¼Œæ›´é«˜çš„èŒƒå¼è™½ç„¶å¯ä»¥å‡å°‘æ•°æ®å†—ä½™ï¼Œä½†å¯èƒ½ä¼šå¢åŠ æŸ¥è¯¢çš„å¤æ‚æ€§å’Œç»´æŠ¤çš„éš¾åº¦ï¼Œå› æ­¤ä¸å†ç»§ç»­è¿›è¡Œè§„èŒƒåŒ–ã€‚&lt;/p&gt;
&lt;h3 id="22-åˆ†å¸ƒè®¾è®¡"&gt;2.2 åˆ†å¸ƒè®¾è®¡
&lt;/h3&gt;&lt;h4 id="221-åˆ†ç‰‡è®¾è®¡"&gt;2.2.1 åˆ†ç‰‡è®¾è®¡
&lt;/h4&gt;&lt;h5 id="2211-å‚ç›´åˆ†ç‰‡è®¾è®¡"&gt;2.2.1.1 å‚ç›´åˆ†ç‰‡è®¾è®¡
&lt;/h5&gt;&lt;p&gt;OceanBaseä¸æ”¯æŒå‚ç›´åˆ†ç‰‡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨å»ºè¡¨æ—¶å°±æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¯¹ 2.1.1ä¸­å„è¡¨è¿›è¡Œå‚ç›´åˆ†ç‰‡è®¾è®¡ï¼Œç›´æ¥æ ¹æ®éœ€è¦å¯¹è¡¨è¿›è¡Œæ‹†åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºusersè¡¨ï¼Œæ ¹æ®æŸ¥è¯¢é¢‘ç‡æ‹†åˆ†ä¸ºæ›´ç»å¸¸æŸ¥è¯¢çš„huserså’ŒæŸ¥è¯¢é¢‘ç‡è¾ƒä½çš„cusersï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;husersï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;username&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;UNIQUE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€ç”¨æˆ·åã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;nickname&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å¯é€‰æ˜µç§°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;email&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;showEmail&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å‘å…¶ä»–äººæ˜¾ç¤ºç”µå­é‚®ä»¶åœ°å€ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å¤´åƒå›¾ç‰‡çš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;cusersï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;password&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·çš„åŠ å¯†å¯†ç ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bindedWeChat&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ç»‘å®šçš„å¾®ä¿¡è´¦å·ï¼ˆå¯é€‰å­—æ®µï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;bindedAliPay&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ç»‘å®šçš„æ”¯ä»˜å®è´¦å·ï¼ˆå¯é€‰å­—æ®µï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id="2212-æ°´å¹³åˆ†ç‰‡è®¾è®¡"&gt;2.2.1.2 æ°´å¹³åˆ†ç‰‡è®¾è®¡
&lt;/h5&gt;&lt;p&gt;OceanBaseä¸­çš„æ°´å¹³åˆ†ç‰‡é€šè¿‡åˆ†åŒºï¼ˆPartitionï¼‰å®ç°ã€‚OceanBaseå¯ä»¥å°†æ™®é€šè¡¨çš„æ•°æ®æŒ‰ç…§è§„åˆ™åˆ’åˆ†åˆ°ä¸åŒçš„åŒºå—å†…ï¼ŒåŒºå—å†…æ•°æ®ç‰©ç†ä¸Šå­˜å‚¨åœ¨ä¸€èµ·ï¼Œç§°ä¸ºåˆ†åŒºè¡¨ï¼Œæ¯ä¸ªåŒºå—ç§°ä¸ºä¸€ä¸ªåˆ†åŒºã€‚OceanBaseæ”¯æŒå¤šç§åˆ†åŒºç±»å‹ï¼ŒåŒ…æ‹¬Rangeåˆ†åŒºã€Range Columnsåˆ†åŒºã€Liståˆ†åŒºã€List Columnsåˆ†åŒºã€Hashåˆ†åŒºã€Keyåˆ†åŒºä»¥åŠäºŒçº§åˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®è¡¨ä¸­æ¯ä¸€è¡Œä¸­ç”¨äºè®¡ç®—åˆ†åŒºå½’å±çš„åˆ—çš„é›†åˆå«åšåˆ†åŒºé”®ã€‚ç”±åˆ†åŒºé”®æ„æˆçš„ç”¨äºè®¡ç®—åˆ†åŒºå½’å±çš„è¡¨è¾¾å¼å«åšåˆ†åŒºè¡¨è¾¾å¼ã€‚å…¶ä¸­Rangeåˆ†åŒºæ ¹æ®åˆ†åŒºè¡¨è¾¾å¼çš„å€¼èŒƒå›´è¿›è¡Œåˆ†åŒºï¼ŒListåˆ†åŒºæ ¹æ®åˆ†åŒºè¡¨è¾¾å¼çš„å€¼è¿›è¡Œåˆ†åŒºï¼ŒColumnsåç¼€åˆ™ä»£è¡¨å…è®¸ä½¿ç”¨å¤šåˆ—ä½œä¸ºåˆ†åŒºé”®ï¼ŒHashåˆ†åŒºé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—çš„åˆ†åŒºé”®å“ˆå¸Œå€¼è¿›è¡Œåˆ†åŒºï¼ŒKeyåˆ†åŒºåˆ™é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—çš„åˆ†åŒºé”®å“ˆå¸Œå€¼å–æ¨¡ç»“æœè¿›è¡Œåˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¯¹å„è¡¨è¿›è¡Œäº†åˆ†åŒºè®¾è®¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äº huserså’Œcusers è¡¨ï¼Œä»¥ &lt;code&gt;id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒKeyåˆ†åŒºï¼Œä½¿å¾—ç”¨æˆ·ä¿¡æ¯åœ¨å„èŠ‚ç‚¹é—´å‡åŒ€åˆ†å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº spaces è¡¨ï¼Œåœ¨æŸ¥è¯¢æ—¶å¾€å¾€éœ€è¦ç­›é™¤å·²å½’æ¡£çš„ç©ºé—´ï¼Œå› æ­¤é¦–å…ˆä»¥ &lt;code&gt;isArchived&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒListåˆ†åŒºï¼Œå†ä»¥ &lt;code&gt;id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒKeyäºŒçº§åˆ†åŒºï¼Œä½¿å¾—ç©ºé—´ä¿¡æ¯åœ¨å„èŠ‚ç‚¹é—´å‡åŒ€åˆ†å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº posts è¡¨ï¼Œç”±äºå¸–å­æŸ¥è¯¢å¾€å¾€ä»¥ç©ºé—´ä¸ºå•ä½ï¼Œå› æ­¤é¦–å…ˆ &lt;code&gt;space_id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒListåˆ†åŒºï¼Œå†ä»¥ &lt;code&gt;status&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒListäºŒçº§åˆ†åŒºï¼Œä¾¿äºåœ¨å±•ç¤ºå¸–å­åˆ—è¡¨æ—¶ä»…å±•ç¤ºå‘å¸ƒçŠ¶æ€çš„å¸–å­ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº comments è¡¨ï¼Œç”±äºè¯„è®ºæŸ¥è¯¢å¾€å¾€ä»¥ç©ºé—´ä¸­çš„å¸–å­ä¸ºå•ä½è¿›è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤é¦–å…ˆ &lt;code&gt;space_id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒListåˆ†åŒºï¼Œå†ä»¥ &lt;code&gt;post_id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒRangeäºŒçº§åˆ†åŒºã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº opinions è¡¨ï¼Œç”±äº postsï¼Œcommentsä¸­æœ‰è§‚ç‚¹æ•°è®°å½•ï¼Œå¯¹äºè§‚ç‚¹çš„æŸ¥è¯¢å¾€å¾€ä»¥ç”¨æˆ·ä¸ºå•ä½ï¼ˆç”¨æˆ·ç®¡ç†æˆ–å±•ç¤ºç”¨æˆ·å¯¹å¸–å­ã€è¯„è®ºçš„è§‚ç‚¹ï¼‰ï¼Œå› æ­¤ä»¥ &lt;code&gt;opinion_type&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒListåˆ†åŒºï¼ŒåŒºåˆ†å¯¹äºè¯„è®ºæˆ–å¸–å­çš„è§‚ç‚¹ï¼Œå†ä»¥ &lt;code&gt;user_id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒRangeäºŒçº§åˆ†åŒºã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº notifications è¡¨ï¼Œç”±äºé€šçŸ¥æŸ¥è¯¢å¾€å¾€ä»¥ç”¨æˆ·ä¸ºå•ä½ï¼Œå› æ­¤ä»¥ &lt;code&gt;user_id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒRangeåˆ†åŒºã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº space_user_infos è¡¨ï¼Œç”±äºå…¶ä¸»è¦ç”¨äºæŸ¥è¯¢ç”¨æˆ·åŠ å…¥çš„ç©ºé—´ï¼Œå› æ­¤ä»¥ &lt;code&gt;user_id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒRangeåˆ†åŒºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="222-éå†—ä½™åˆ†é…"&gt;2.2.2 éå†—ä½™åˆ†é…
&lt;/h4&gt;&lt;p&gt;ã€OceanBase åŠ¨æ€åˆ†åŒºåˆ†é…ã€‘&lt;/p&gt;
&lt;h4 id="223-å†—ä½™åˆ†é…"&gt;2.2.3 å†—ä½™åˆ†é…
&lt;/h4&gt;&lt;p&gt;ã€OceanBase å‰¯æœ¬æœºåˆ¶ã€‘&lt;/p&gt;
&lt;h3 id="23-å±€éƒ¨é€»è¾‘è®¾è®¡"&gt;2.3 å±€éƒ¨é€»è¾‘è®¾è®¡
&lt;/h3&gt;&lt;h4 id="231-è¡¨ç»“æ„è®¾è®¡"&gt;2.3.1 è¡¨ç»“æ„è®¾è®¡
&lt;/h4&gt;&lt;p&gt;åœ¨OceanBaseä¸­ç”±äºä¸»é”®çš„å”¯ä¸€æ€§æ£€æŸ¥æ˜¯åœ¨å„ä¸ªåˆ†åŒºå†…éƒ¨è¿›è¡Œçš„ï¼Œå¦‚æœä¸»é”®ä¸åŒ…å«å…¨éƒ¨åˆ†åŒºé”®ï¼Œè¿™ä¸ªæ£€æŸ¥å°±ä¼šå¤±æ•ˆï¼ŒåŒæ—¶éœ€è¦ä¿è¯æŒ‡å®šä¸»é”®çš„æŸ¥è¯¢èƒ½å¾ˆå¿«å®šä½åˆ°è¡¨æ‰€åœ¨çš„åˆ†åŒºï¼Œåˆ†åŒºé”®å¿…é¡»æ˜¯ä¸»é”®çš„å­é›†ï¼Œå› æ­¤é™¤äº† 2.2.1.1 ä¸­çš„husersä¸cuserså¤–ï¼Œè¡¨ç»“æ„ä¸ 2.1.1 ç›¸æ¯”å‘ç”Ÿäº†å¦‚ä¸‹å˜åŒ–ï¼š&lt;/p&gt;
&lt;h5 id="2311-spaces"&gt;2.3.1.1 spaces
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isArchived&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è¯†ç©ºé—´æ˜¯å¦è¢«å½’æ¡£ï¼ˆå½’æ¡£åå¯èƒ½ä¸å†æ´»è·ƒï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;name&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;UNIQUE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„å”¯ä¸€åç§°ï¼Œç”¨äºæ ‡è¯†æ¯ä¸ªç©ºé—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;description&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´çš„æè¿°ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºä»‹ç»ç©ºé—´çš„ç›®çš„å’Œå†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;avatar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´å¤´åƒçš„ URL æˆ–è·¯å¾„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;isArchived&lt;/code&gt; æˆä¸ºä¸»é”®ä¸­çš„å­—æ®µã€‚&lt;/p&gt;
&lt;h5 id="2312-posts"&gt;2.3.1.2 posts
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;, &lt;code&gt;FOREIGN KEY&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­æ‰€å±ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;status&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TINYINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ENUM(ORDINAL)&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„çŠ¶æ€ï¼ˆä¾‹å¦‚è‰ç¨¿ã€å·²å‘å¸ƒã€è¢«åˆ é™¤ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;subject&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„ä¸»é¢˜ï¼Œç”¨äºæ ‡é¢˜æˆ–æ¦‚è¿°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„å†…å®¹ï¼Œé€šå¸¸ä¸ºæ­£æ–‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;, &lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å‘å¸ƒå¸–å­çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;commentCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å¸–å­çš„è¯„è®ºæ€»æ•°é‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;space_id&lt;/code&gt; å’Œ&lt;code&gt;status&lt;/code&gt;æˆä¸ºä¸»é”®ä¸­çš„å­—æ®µã€‚&lt;/p&gt;
&lt;h5 id="2313-comments"&gt;2.3.1.3 comments
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;post_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºæ‰€å±å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;posts&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;ä¸å¯æ›´æ–°&lt;/code&gt;, &lt;code&gt;FOREIGN KEY&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºæ‰€å±ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£æ–‡å†…å®¹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å‘å¸ƒè¯„è®ºçš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;parent_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;çˆ¶çº§è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºæ”¯æŒè¯„è®ºçš„åµŒå¥—ç»“æ„ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºåˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;positiveCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„æ­£å‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹èµæ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;negativeCount&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯„è®ºçš„è´Ÿå‘åé¦ˆæ•°é‡ï¼ˆå¦‚ç‚¹è¸©æ•°ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;space_id&lt;/code&gt; å’Œ&lt;code&gt;post_id&lt;/code&gt;æˆä¸ºä¸»é”®ä¸­çš„å­—æ®µã€‚&lt;/p&gt;
&lt;h5 id="2314-opinions"&gt;2.3.1.4 opinions
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ„è§çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æäº¤è¯¥æ„è§çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;opinion_type&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(31)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºåŒºåˆ†æ„è§çš„ç±»å‹ï¼ˆä¾‹å¦‚è¯„è®ºæ„è§æˆ–å¸–å­æ„è§ç­‰ï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ„è§åˆ›å»ºçš„æ—¶é—´æˆ³ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;isPositive&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;æ ‡è¯†è¯¥æ„è§æ˜¯å¦ä¸ºæ­£å‘æ„è§ï¼ˆä¾‹å¦‚ç‚¹èµï¼‰ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;post_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯¥æ„è§ç›¸å…³çš„å¸–å­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;posts&lt;/code&gt; è¡¨ï¼Œä»…åœ¨æ„è§ä¸ºå¸–å­æ„è§æ—¶æœ‰æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;comment_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯¥æ„è§ç›¸å…³çš„è¯„è®ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;comments&lt;/code&gt; è¡¨ï¼Œä»…åœ¨æ„è§ä¸ºè¯„è®ºæ„è§æ—¶æœ‰æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;opinion_type&lt;/code&gt; å’Œ &lt;code&gt;user_id&lt;/code&gt; æˆä¸ºä¸»é”®ä¸­çš„å­—æ®µã€‚&lt;/p&gt;
&lt;h5 id="2315-notifications"&gt;2.3.1.5 notifications
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;, &lt;code&gt;NOT NULL&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•ç”¨æˆ·åŠ å…¥ç©ºé—´çš„æ—¶é—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;content&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é€šçŸ¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;user_id&lt;/code&gt; æˆä¸ºä¸»é”®ä¸­çš„å­—æ®µã€‚&lt;/p&gt;
&lt;h5 id="2316-space_user_infos"&gt;2.3.1.6 space_user_infos
&lt;/h5&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;å­—æ®µåç§°&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æ•°æ®ç±»å‹&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;çº¦æŸ&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;æè¿°&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;PRIMARY KEY&lt;/code&gt;, &lt;code&gt;AUTO_INCREMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ç©ºé—´ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;user_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;, &lt;code&gt;NOT NULL&lt;/code&gt;,&lt;code&gt;PRIMARY KEY&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;users&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;space_id&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;FOREIGN KEY&lt;/code&gt;, &lt;code&gt;NOT NULL&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å…³è”çš„ç©ºé—´çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…³è”åˆ° &lt;code&gt;spaces&lt;/code&gt; è¡¨ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;createdAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NOT NULL&lt;/code&gt;, &lt;code&gt;AUDIT-CREATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è®°å½•ç”¨æˆ·åŠ å…¥ç©ºé—´çš„æ—¶é—´ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;lastActiveAt&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DATE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·åœ¨ç©ºé—´ä¸­æœ€è¿‘æ´»è·ƒçš„æ—¥æœŸã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;user_id&lt;/code&gt; æˆä¸ºä¸»é”®ä¸­çš„å­—æ®µã€‚&lt;/p&gt;
&lt;h4 id="233-ç´¢å¼•è®¾è®¡"&gt;2.3.3 ç´¢å¼•è®¾è®¡
&lt;/h4&gt;&lt;p&gt;å¯¹äºåˆ†åŒºåçš„åˆ†åŒºè¡¨ï¼Œæˆ‘ä»¬æ ¹æ®ä¸šåŠ¡æŸ¥è¯¢çš„éœ€æ±‚åœ¨å¦‚ä¸‹è¡¨ä¸Šè®¾è®¡äº†ç´¢å¼•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºäºŒçº§åˆ†åŒºï¼ˆList Partition By &lt;code&gt;space_id&lt;/code&gt; + List Partition By &lt;code&gt;status&lt;/code&gt; ï¼‰åçš„ posts è¡¨åˆ†åŒºï¼Œåœ¨ &lt;code&gt;createdAt&lt;/code&gt; åˆ—ä¸Šå»ºç«‹æœ¬åœ°ç´¢å¼•ï¼Œä¾¿äºæŒ‰ç…§åˆ›å»ºæ—¶é—´æŸ¥è¯¢å¸–å­ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºäºŒçº§åˆ†åŒºï¼ˆList Partition By &lt;code&gt;space_id&lt;/code&gt; + Range Partition By &lt;code&gt;post_id&lt;/code&gt; ï¼‰åçš„ comments è¡¨åˆ†åŒºï¼Œåœ¨ &lt;code&gt;post_id&lt;/code&gt; å’Œ&lt;code&gt;createdAt&lt;/code&gt; åˆ—ä¸Šå»ºç«‹æœ¬åœ°ç´¢å¼•ï¼Œä¾¿äºæŒ‰ç…§å¸–å­åŠè¯„è®ºæ—¶é—´æŸ¥è¯¢è¯„è®ºã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºäºŒçº§åˆ†åŒºï¼ˆList Partition By &lt;code&gt;opinion_type&lt;/code&gt; + Range Partition By &lt;code&gt;user_id&lt;/code&gt; ï¼‰åçš„ opinions è¡¨åˆ†åŒºï¼Œåœ¨ &lt;code&gt;user_id&lt;/code&gt; åˆ—ä¸Šå»ºç«‹æœ¬åœ°ç´¢å¼•ï¼Œä¾¿äºæŒ‰ç…§ç”¨æˆ·æŸ¥è¯¢è§‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåˆ†åŒºï¼ˆRange Partition By &lt;code&gt;user_id&lt;/code&gt; ï¼‰åçš„ notifications è¡¨ï¼Œåœ¨ &lt;code&gt;user_id&lt;/code&gt; å’Œ &lt;code&gt;created_at&lt;/code&gt; åˆ—ä¸Šå»ºç«‹å¤åˆæœ¬åœ°ç´¢å¼•ï¼Œä¾¿äºæŒ‰ç…§ç”¨æˆ·æŸ¥è¯¢æŒ‰æ—¶é—´æ’åºçš„é€šçŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåˆ†åŒºï¼ˆRange Partition By &lt;code&gt;user_id&lt;/code&gt; ï¼‰åçš„ space_user_infos è¡¨ï¼Œåœ¨ &lt;code&gt;user_id&lt;/code&gt; å’Œ &lt;code&gt;created_at&lt;/code&gt; åˆ—ä¸Šå»ºç«‹å¤åˆæœ¬åœ°ç´¢å¼•ï¼Œä¾¿äºæŒ‰ç…§ç”¨æˆ·æŸ¥è¯¢æŒ‰åŠ å…¥æ—¶é—´æ’åºçš„ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="234-è§†å›¾è®¾è®¡"&gt;2.3.4 è§†å›¾è®¾è®¡
&lt;/h4&gt;&lt;p&gt;å¯¹äºæŒä¹…åŒ–è§†å›¾ space_member_countsï¼Œä½¿ç”¨ä¸ spaces è¡¨ç›¸åŒçš„åˆ†åŒºæ–¹å¼ï¼Œå³é¦–å…ˆä»¥ &lt;code&gt;isArchived&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒListåˆ†åŒºï¼Œå†ä»¥ &lt;code&gt;id&lt;/code&gt; ä¸ºåˆ†åŒºé”®è¿›è¡ŒKeyäºŒçº§åˆ†åŒºã€‚&lt;/p&gt;
&lt;h4 id="235-è§„èŒƒåŒ–"&gt;2.3.5 è§„èŒƒåŒ–
&lt;/h4&gt;&lt;p&gt;users è¡¨æ‹†åˆ†è€Œæˆçš„ husers ä¸ cusers è¡¨åŒæ ·æ»¡è¶³BCNFèŒƒå¼&lt;/p&gt;
&lt;h3 id="24-å±€éƒ¨ç‰©ç†è®¾è®¡"&gt;2.4 å±€éƒ¨ç‰©ç†è®¾è®¡
&lt;/h3&gt;&lt;p&gt;ã€OceanBase èŠ‚ç‚¹ç‰©ç†è®¾è®¡ã€‘&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 7</title><link>https://dyhes.github.io/p/postopia-dev-logweek-7/</link><pubDate>Sun, 17 Nov 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-7/</guid><description>&lt;p&gt;è¿‡å»ä¸€ä¸ªæœˆä¸€ç›´åœ¨å¿™å„ç§è¯¾ç¨‹ä½œä¸šï¼Œç›´åˆ°åˆ†å¸ƒå¼æ•°æ®åº“çš„è¯¾ç”¨åˆ°äº†Postopia&lt;/p&gt;
&lt;p&gt;éœ€è¦å®ç°è¯„è®ºè·å–ï¼Œå…ˆä½¿ç”¨ç®€å•æ–¹å¼å®ç°ä¸¤å±‚è¯„è®ºçš„è·å–ï¼Œåç»­éœ€è¦ä¼˜åŒ–&lt;/p&gt;
&lt;p&gt;å–œæ¬¢ï¼Œåå¯¹çš„é€»è¾‘æœ‰é—®é¢˜ï¼Œéœ€è¦ä¿®æ­£&lt;/p&gt;
&lt;h2 id="default-fetch-types"&gt;Default Fetch Types
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;@OneToMany&lt;/strong&gt;: &lt;strong&gt;Lazy&lt;/strong&gt; by default.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;@ManyToOne&lt;/strong&gt;: &lt;strong&gt;Eager&lt;/strong&gt; by default.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;@OneToOne&lt;/strong&gt;: &lt;strong&gt;Eager&lt;/strong&gt; by default.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;@ManyToMany&lt;/strong&gt;: &lt;strong&gt;Lazy&lt;/strong&gt; by default.&lt;/p&gt;
&lt;h2 id="sortdirection"&gt;Sort.Direction
&lt;/h2&gt;&lt;p&gt;è€Œä¸æ˜¯Stringï¼Œå¦åˆ™ä¼šå‡ºé”™&lt;/p&gt;
&lt;h2 id="arams"&gt;@arams
&lt;/h2&gt;&lt;p&gt;&amp;lsquo;Name for argument of type [java.lang.Long] not specified, and parameter name information not available via reflection. Ensure that the compiler uses the &amp;lsquo;-parameters&amp;rsquo; flag.&amp;rsquo;&lt;/p&gt;
&lt;p&gt;This error in a Spring Boot application indicates that &lt;strong&gt;Spring Data JPA is unable to map the parameters in your repository method to the query&lt;/strong&gt; because it cannot retrieve parameter names through reflection.&lt;/p&gt;
&lt;p&gt;By default, Java does not retain method parameter names in the compiled bytecode unless you explicitly instruct the compiler to do so using the &lt;code&gt;-parameters&lt;/code&gt; flag.&lt;/p&gt;
&lt;p&gt;Spring relies on parameter names to match method parameters to query parameters (e.g., &lt;code&gt;@Param(&amp;quot;id&amp;quot;)&lt;/code&gt; in a query). If it cannot retrieve the parameter names, it throws this error.&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 6</title><link>https://dyhes.github.io/p/postopia-dev-logweek-6/</link><pubDate>Fri, 11 Oct 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-6/</guid><description>&lt;p&gt;ä½¿ç”¨çš„å¯¹è±¡å­˜å‚¨ä½¿ç”¨çš„æ˜¯ &lt;a class="link" href="https://cloudinary.com/" target="_blank" rel="noopener"
&gt;Cloudinary&lt;/a&gt; ä¸Šä¼ å›¾ç‰‡æ—¶æ–‡æ¡£ä¸å®Œå–„,é€šè¿‡å°†å›¾åƒè½¬ä¸ºdata urlè§£å†³&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰çªç„¶åƒæ˜¯å¡ä½äº†ä¸€æ ·ï¼Œè¿›å…¥äº†å€¦æ€ æœŸï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºæŸä¸ªé—®é¢˜é‡åˆ°äº†ä¸¤ä¸‰æ¬¡è¿˜æ˜¯æ²¡è®°ä½ï¼Œè®©æˆ‘æœ‰äº›ç°å¿ƒäº†ï¼ˆ10.21ï¼‰&lt;/p&gt;
&lt;p&gt;è¿›åº¦ï¼š&lt;/p&gt;
&lt;p&gt;update avatar&lt;/p&gt;
&lt;p&gt;get user info&lt;/p&gt;
&lt;p&gt;show email&lt;/p&gt;
&lt;p&gt;get user&amp;rsquo;s posts and comments&lt;/p&gt;
&lt;h2 id="dependency-injection"&gt;Dependency Injection
&lt;/h2&gt;&lt;p&gt;The recommended way of dependency injection in Spring Boot is constructor injection. Here&amp;rsquo;s why it&amp;rsquo;s preferred and how to implement it:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Constructor Injection:
This is the most recommended approach. Here&amp;rsquo;s how it works:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EmailService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emailService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Optional in newer Spring versions&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;UserService&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EmailService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emailService&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;userRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;emailService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;emailService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Service methods...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Promotes immutability (dependencies can be final)&lt;/li&gt;
&lt;li&gt;Makes dependencies explicit&lt;/li&gt;
&lt;li&gt;Ensures the bean is fully initialized after construction&lt;/li&gt;
&lt;li&gt;Easier to test (you can easily provide mock dependencies)&lt;/li&gt;
&lt;li&gt;Prevents circular dependencies at compile-time&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Setter Injection:
While not as favored as constructor injection, setter injection can be useful in certain scenarios, particularly when dealing with optional dependencies:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setUserRepository&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;userRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Service methods...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Setter injection is less common but can be useful for optional dependencies or when you need to change dependencies at runtime.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Field Injection (Not Recommended):
As discussed earlier, this method is generally discouraged:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Service methods...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Best Practices:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use constructor injection for required dependencies.&lt;/li&gt;
&lt;li&gt;Consider setter injection for optional dependencies.&lt;/li&gt;
&lt;li&gt;Avoid field injection in most cases.&lt;/li&gt;
&lt;li&gt;Use the &lt;code&gt;@Autowired&lt;/code&gt; annotation on constructors (optional in newer Spring versions).&lt;/li&gt;
&lt;li&gt;Keep your classes focused and try to limit the number of dependencies.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Would you like me to elaborate on any specific aspect of dependency injection or provide a more complex example?&lt;/p&gt;
&lt;h3 id="field-injection-not-recommended"&gt;Field Injection (not recommended)
&lt;/h3&gt;&lt;p&gt;Field injection in Spring Boot is generally not recommended for several reasons:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Immutability: Field injection makes it difficult to create immutable objects, as the fields need to be non-final to allow injection.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Testability: Classes using field injection are harder to unit test, as you can&amp;rsquo;t easily inject mock dependencies without using a Spring container or reflection.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dependency hiding: Field injection can hide dependencies, making it less obvious what a class requires to function properly.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Circular dependencies: Field injection can more easily lead to circular dependency issues, which are harder to detect and resolve.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Inversion of Control (IoC) principle: Field injection violates the IoC principle to some extent, as the class is directly asking for its dependencies rather than having them provided.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reflection use: Spring uses reflection to inject dependencies into private fields, which can have a minor performance impact and bypasses encapsulation.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Instead of field injection, constructor injection is typically recommended as it addresses these issues. It allows for immutable objects, makes dependencies explicit, and facilitates easier testing and better design.&lt;/p&gt;
&lt;p&gt;Would you like me to elaborate on any of these points or provide an example of constructor injection?&lt;/p&gt;
&lt;h2 id="user-id-exposure"&gt;User Id Exposure
&lt;/h2&gt;&lt;p&gt;Exposing a backend user ID in frontend code or APIs is generally &lt;strong&gt;not a good practice&lt;/strong&gt; for several reasons, especially in public-facing applications. Here&amp;rsquo;s why:&lt;/p&gt;
&lt;h3 id="security-risks"&gt;&lt;strong&gt;Security Risks&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Enumeration Attacks&lt;/strong&gt;: If user IDs are predictable (like auto-incrementing integers), attackers can guess and try to access other users&amp;rsquo; data, leading to potential data breaches.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;User Impersonation&lt;/strong&gt;: Exposing a backend ID might allow an attacker to impersonate another user if your application doesn&amp;rsquo;t properly authenticate requests.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="privacy-concerns"&gt;&lt;strong&gt;Privacy Concerns&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sensitive Information&lt;/strong&gt;: In some cases, a user ID may be linked to personal data. Exposing these identifiers could lead to privacy violations, depending on the nature of the application.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="business-logic-exposure"&gt;&lt;strong&gt;Business Logic Exposure&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Insights into Structure&lt;/strong&gt;: If your backend user IDs reveal too much about your data structure, an attacker could gain insights into how your system is designed, which may make it easier to exploit vulnerabilities.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="alternatives-and-best-practices"&gt;Alternatives and Best Practices
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Use UUIDs or Random Identifiers&lt;/strong&gt;: Instead of exposing sequential user IDs, consider using universally unique identifiers (UUIDs) or other random tokens that are harder to predict and manipulate.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tokenization&lt;/strong&gt;: Use session tokens or API tokens that map to a user ID on the backend but don&amp;rsquo;t directly expose the ID itself.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Limit Information&lt;/strong&gt;: Only expose what is absolutely necessary for the frontend or API consumer. If there&amp;rsquo;s no need to show the user ID, don&amp;rsquo;t include it.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Access Control&lt;/strong&gt;: Ensure proper access control and authentication mechanisms so that even if a user ID is exposed, unauthorized users cannot exploit it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In summary, itâ€™s a best practice to avoid exposing backend user IDs unless necessary and only if adequate security measures are in place to mitigate risks.&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 5</title><link>https://dyhes.github.io/p/postopia-dev-logweek-5/</link><pubDate>Mon, 30 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-5/</guid><description>&lt;p&gt;å¦‚ä½•å¤„ç†ä»¥å‰æ²¡æœ‰é‡åˆ°è¿‡çš„æ–°éœ€æ±‚ï¼ˆå¦‚ç»™ç”¨æˆ·å‘é€é‚®ä»¶ï¼‰ï¼Œéœ€è¦ç§¯ç´¯è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼ˆå®ä¹ çš„æ—¶å€™å¯ä»¥è¾¹é—®è¾¹æŸ¥ï¼Œåšè‡ªå·±çš„é¡¹ç›®åªèƒ½è‡ªå·±å»æŸ¥ï¼Œé‚£ä¹ˆå¦‚ä½•é«˜æ•ˆæ£€ç´¢å¹¶å–„ç”¨AIï¼‰,å¹¶å½¢æˆæ–¹æ³•è®ºï¼Œä»¥ä¾¿æé«˜èƒ½åŠ›&lt;/p&gt;
&lt;p&gt;å‘ç° Claude ä¹‹å‰æ•™çš„åœ¨Service Layer ä¸­ä½¿ç”¨ @AuthenticatedPrincipal çš„æ–¹æ³•ä¸æ­£ç¡®ï¼Œå½“æ—¶æ²¡æœ‰åŠæ—¶æµ‹è¯•å¯¼è‡´ç°åœ¨æœ‰è‹¥å¹²åœ°æ–¹éœ€è¦ä¿®æ”¹ï¼ï¼ï¼ä½¿ç”¨ä½†ä¸è¦ç›²ç›®ç›¸ä¿¡&lt;/p&gt;
&lt;p&gt;ideaæ— æ³•çƒ­åŠ è½½ï¼Œ æ ¹æ®&lt;/p&gt;
&lt;p&gt;Perperlexity&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In IntelliJ IDEA, ensure that the project is set to build automatically. Go to &lt;code&gt;File&lt;/code&gt; -&amp;gt; &lt;code&gt;Settings&lt;/code&gt; -&amp;gt; &lt;code&gt;Build, Execution, Deployment&lt;/code&gt; -&amp;gt; &lt;code&gt;Compiler&lt;/code&gt;, and check the option &lt;strong&gt;Build project automatically&lt;/strong&gt;. This setting allows the IDE to compile changes without needing to manually trigger a build each time&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»¥åŠ&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/4404522882450-Spring-Boot-DevTools-Live-Reload-Not-Working" target="_blank" rel="noopener"
&gt;Spring Boot DevTools Live Reload Not Working&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://intellij-support.jetbrains.com/hc/user_images/6k1gpJeEDLK9V5JSVaUOFQ.png"
loading="lazy"
alt="img"
&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤è€…ç»“åˆè§£å†³&lt;/p&gt;
&lt;p&gt;è¿›åº¦ï¼š&lt;/p&gt;
&lt;p&gt;change user nickname&lt;/p&gt;
&lt;p&gt;bind email&lt;/p&gt;
&lt;p&gt;æœ¬å‘¨å†™è®ºæ–‡(å®éªŒå®¤æ¨ªå‘)ï¼Œæ— å…¶ä»–è¿›å±•&lt;/p&gt;
&lt;p&gt;to do:&lt;/p&gt;
&lt;p&gt;query comment (recursive query, complex)&lt;/p&gt;
&lt;h2 id="space-in-applicationproperties-value"&gt;Space in application.properties value
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Leading and trailing spaces: By default, leading and trailing spaces in property values are trimmed. If you need to preserve them, you can use quotation marks.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Spaces within the value: Spaces within the value are preserved normally.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Escaping: If you want to be explicit about including spaces, you can escape them with a backslash.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here are some examples:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# Space in the middle (works fine)
app.name=My Application
# Preserving leading/trailing spaces with quotes
app.description=&amp;#34; This is a description with spaces &amp;#34;
# Escaping spaces (not necessary, but valid)
app.path=C:\Program\ Files\My\ App
# Multiline values
app.multiline=This is a long \
property value that \
spans multiple lines
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you&amp;rsquo;re having issues with spaces in your application.properties file, you might want to double-check how you&amp;rsquo;re reading the properties in your application. Some methods of reading properties may handle spaces differently.&lt;/p&gt;
&lt;h2 id="store-credentials-in-spring-boot"&gt;Store Credentials in spring boot
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Basic approach (not recommended for production):&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;database.username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;myuser&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;database.password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;mypassword&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="2"&gt;
&lt;li&gt;Using environment variables:
Instead of hardcoding credentials, you can reference environment variables:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;database.username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;${DB_USERNAME}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;database.password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;${DB_PASSWORD}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then set these environment variables on your system or in your deployment environment.&lt;/p&gt;
&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;Using Spring Boot&amp;rsquo;s config server:
For more secure credential management, especially in production, consider using Spring Cloud Config Server.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Encryption:
Spring Boot supports property encryption. You can use tools like Jasypt to encrypt sensitive properties:&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;database.username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;ENC(encrypted_username)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;database.password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;ENC(encrypted_password)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start="5"&gt;
&lt;li&gt;Externalized configuration:
Store sensitive data in external files and reference them:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.config.import&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;file:/path/to/secure/credentials.properties&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For production environments, I recommend using a secrets management system like HashiCorp Vault, AWS Secrets Manager, or Azure Key Vault. These provide more secure ways to manage and access sensitive information.&lt;/p&gt;
&lt;p&gt;Would you like me to elaborate on any of these approaches or provide a more detailed example of implementing one of them in a Spring Boot application?&lt;/p&gt;
&lt;h2 id="env-in-spring-boot"&gt;.env in spring boot
&lt;/h2&gt;&lt;p&gt;Using environment variables in a Spring Boot application is a good practice for managing sensitive information like credentials. There are a few ways to work with environment variables, and creating a .env file is one approach, though it requires some additional setup. Let&amp;rsquo;s go through the process:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Using system environment variables:&lt;/p&gt;
&lt;p&gt;This is the most straightforward method. You set the variables in your operating system or deployment environment, and Spring Boot can access them directly.&lt;/p&gt;
&lt;p&gt;For example, you might set variables like this:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;export DB_USERNAME=myuser
export DB_PASSWORD=mypassword
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then in your application.properties:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-properties" data-lang="properties"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.datasource.username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;${DB_USERNAME}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="na"&gt;spring.datasource.password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;${DB_PASSWORD}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Using a .env file:&lt;/p&gt;
&lt;p&gt;While Spring Boot doesn&amp;rsquo;t natively support .env files, you can use a library like &lt;code&gt;dotenv-java&lt;/code&gt; to load variables from a .env file. Here&amp;rsquo;s how:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Add this dependency to your pom.xml&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;io&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;github&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cdimascio&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;groupId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;artifactId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;dotenv&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;java&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;artifactId&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;3&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;1&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="n"&gt;dependency&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// In your main application class&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;io.github.cdimascio.dotenv.Dotenv&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@SpringBootApplication&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyApplication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dotenv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dotenv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Dotenv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;load&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;DB_USERNAME&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dotenv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;DB_USERNAME&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;DB_PASSWORD&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dotenv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;DB_PASSWORD&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpringApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MyApplication&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Create a .env file in your project root&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;DB_USERNAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;myuser&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;DB_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;mypassword&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// In your application.properties&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;datasource&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;username&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;DB_USERNAME&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;spring&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;datasource&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;password&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;DB_PASSWORD&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€‹ Remember to add .env to your .gitignore file to prevent committing sensitive information to version control.&lt;/p&gt;
&lt;ol start="3"&gt;
&lt;li&gt;Command-line arguments:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;You can also pass environment variables as command-line arguments when running your application:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;java -jar myapp.jar --spring.datasource.username=myuser --spring.datasource.password=mypassword
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Remember, while using a .env file can be convenient for development, it&amp;rsquo;s &lt;strong&gt;generally not recommended for production environments&lt;/strong&gt;. In production, it&amp;rsquo;s better to use system environment variables, secret management systems, or cloud provider-specific solutions.&lt;/p&gt;
&lt;h2 id="one-time-password"&gt;One Time Password
&lt;/h2&gt;&lt;h2 id="pathvariable"&gt;@PathVariable
&lt;/h2&gt;&lt;p&gt;To use path parameters with a POST mapping in Spring Boot, you can use the &lt;code&gt;@PathVariable&lt;/code&gt; annotation along with &lt;code&gt;@PostMapping&lt;/code&gt;. Here&amp;rsquo;s a brief example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@RestController&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RequestMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/api&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyController&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@PostMapping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;/users/{id}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createUser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@PathVariable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@RequestBody&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Process the user creation with the given id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ResponseEntity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ok&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;User created with ID: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this example:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The &lt;code&gt;@PostMapping&lt;/code&gt; annotation defines the endpoint for POST requests.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;{id}&lt;/code&gt; in the path is a path variable.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;@PathVariable Long id&lt;/code&gt; parameter in the method signature captures the value of the &lt;code&gt;{id}&lt;/code&gt; path variable.&lt;/li&gt;
&lt;li&gt;You can also include a request body using &lt;code&gt;@RequestBody&lt;/code&gt; if needed.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To call this endpoint, you would send a POST request to a URL like &lt;code&gt;/api/users/123&lt;/code&gt;, where &lt;code&gt;123&lt;/code&gt; is the ID.&lt;/p&gt;
&lt;p&gt;Would you like me to explain any part of this in more detail or show you how to handle multiple path variables?&lt;/p&gt;
&lt;h2 id="references"&gt;References
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.baeldung.com/spring-email" target="_blank" rel="noopener"
&gt;Guide to Spring Email&lt;/a&gt;&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 4</title><link>https://dyhes.github.io/p/postopia-dev-logweek-4/</link><pubDate>Fri, 20 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-4/</guid><description>&lt;p&gt;ä¹‹å‰éƒ½æ˜¯åœ¨macä¸Šè¿›è¡Œå¼€å‘ï¼Œç°åœ¨æ¢åˆ°Windowsä¸Šï¼Œè·‘ä¸èµ·æ¥&lt;/p&gt;
&lt;p&gt;åŸæ¥æ˜¯å› ä¸ºè‡ªå®šä¹‰queryæ–¹æ³•é‡Œçš„å­—æ®µè®¾ç½®ä¸å¯¹ï¼ˆåº”ä¸entityä¸­å­—æ®µè€Œéè¡¨å­—æ®µä¿æŒä¸€è‡´ ï¼‰&lt;/p&gt;
&lt;p&gt;ä¹‹å‰åœ¨macä¸Šç”¨codeè·‘é¡¹ç›®ï¼Œè¿è¡Œæ—¶å¹¶æ²¡æœ‰æŸ¥å‡ºè¿™ä¸ªé”™è¯¯ï¼Œç°åœ¨åœ¨winä¸Šç”¨ideaè·‘æ£€æŸ¥å‡ºæ¥äº†&lt;/p&gt;
&lt;p&gt;ç»è¿‡æ¥è¿‘ä¸€ä¸ªæœˆï¼ˆç”Ÿæ´»çäº‹ä¸å¼€å­¦å‰çš„ä¼‘æ¯ï¼‰å†é‡æ–°æ‰“å¼€é¡¹ç›®ï¼Œå¿˜äº†è¯¥ä»å“ªé‡Œç»§ç»­é¡¹ç›®ï¼Œä»¥åè¦æ³¨æ„è®°å½•å¼€å‘è¿›åº¦&lt;/p&gt;
&lt;p&gt;è¿›åº¦ï¼š&lt;/p&gt;
&lt;p&gt;like, dislike post, comment&lt;/p&gt;
&lt;p&gt;query like status in post&lt;/p&gt;
&lt;p&gt;update user nickname&lt;/p&gt;
&lt;p&gt;to do:&lt;/p&gt;
&lt;p&gt;query comment (recursive query, complex)&lt;/p&gt;
&lt;h2 id="spring-boot-application-configure-port"&gt;spring boot application configure port
&lt;/h2&gt;&lt;p&gt;resource/application.properties&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;8081&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="authorizedprincipal-related"&gt;@AuthorizedPrincipal related
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;i defined &amp;ldquo;void likePost(Long id, @AuthenticationPrincipal User user);&amp;rdquo; in an interface, should its implementation method signature be &amp;ldquo;void likePost(Long id, @AuthenticationPrincipal User user)&amp;rdquo; or &amp;ldquo;void likePost(Long id, User user);&amp;rdquo; is enough?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The implementation method signature should match the interface declaration exactly, &lt;strong&gt;including any annotations&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;@AuthenticationPrincipal&lt;/code&gt; annotation is significant and should be retained in the implementation for the following reasons:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Consistency: The implementation should match the interface definition to maintain consistency and avoid confusion.&lt;/li&gt;
&lt;li&gt;Functionality: The &lt;code&gt;@AuthenticationPrincipal&lt;/code&gt; annotation is typically used in Spring Security to automatically resolve the currently authenticated user. Removing it might affect how the user object is populated or handled by the framework.&lt;/li&gt;
&lt;li&gt;Clarity: Keeping the annotation in the implementation makes it clear to other developers that this method expects the authenticated user to be injected.&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;idea auto implemenation doesn&amp;rsquo;t retain the @AuthenticationPrincipal annotation&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You&amp;rsquo;re right to notice that discrepancy. IDEs like IntelliJ IDEA sometimes don&amp;rsquo;t automatically retain certain annotations when generating method implementations. This is a known limitation in some IDE auto-implementation features.&lt;/p&gt;
&lt;p&gt;Understand the issue: The IDE&amp;rsquo;s auto-implementation feature is dropping the &lt;code&gt;@AuthenticationPrincipal&lt;/code&gt; annotation, which is not the desired behavior.&lt;/p&gt;
&lt;p&gt;Correct approach: You should manually add the annotation back to the implementation method.&lt;/p&gt;
&lt;h2 id="case-in-sql"&gt;CASE in sql
&lt;/h2&gt;&lt;p&gt;Case statements in SQL allow you to &lt;strong&gt;add conditional logic&lt;/strong&gt; to your queries. They&amp;rsquo;re useful for categorizing data or performing different calculations based on specific conditions.&lt;/p&gt;
&lt;p&gt;The general syntax is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;condition1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;condition2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ELSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;default_result&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Key points:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You can have multiple WHEN-THEN pairs.&lt;/li&gt;
&lt;li&gt;The ELSE clause is optional. If omitted and no conditions are met, it returns NULL.&lt;/li&gt;
&lt;li&gt;CASE statements can be used in SELECT, WHERE, and ORDER BY clauses.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here&amp;rsquo;s a simple example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;product_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CASE&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Low&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AND&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;THEN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Medium&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ELSE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;High&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;END&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;price_category&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;products&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This query categorizes products based on their price.&lt;/p&gt;
&lt;h2 id="join-and-left-join"&gt;JOIN and LEFT JOIN
&lt;/h2&gt;&lt;p&gt;JOIN and LEFT JOIN are not the same. They are different types of SQL join operations that produce different results. Let me explain the key differences:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;JOIN (or INNER JOIN):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Returns only the rows that have matching values in both tables.&lt;/li&gt;
&lt;li&gt;If a row doesn&amp;rsquo;t have a match in the other table, it&amp;rsquo;s &lt;strong&gt;excluded&lt;/strong&gt; from the result set.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LEFT JOIN (or LEFT OUTER JOIN):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Returns all rows from the left table, and the matched rows from the right table.&lt;/li&gt;
&lt;li&gt;If there&amp;rsquo;s no match in the right table, the result still contains the row from the left table, with &lt;strong&gt;NULL values&lt;/strong&gt; for the right table&amp;rsquo;s columns.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here&amp;rsquo;s an example to illustrate:&lt;/p&gt;
&lt;p&gt;Suppose we have two tables:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Employees&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Projects&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ProjectName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EmployeeID&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- ---- -- ----------- ----------
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Alice&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Alpha&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Bob&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Beta&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Charlie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Gamma&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Delta&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Using INNER JOIN:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ProjectName&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Employees&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Projects&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EmployeeID&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Result:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Name ProjectName
---- -----------
Alice Alpha
Alice Beta
Bob Gamma
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Using LEFT JOIN:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ProjectName&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Employees&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;LEFT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Projects&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EmployeeID&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Result:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;Name ProjectName
---- -----------
Alice Alpha
Alice Beta
Bob Gamma
Charlie NULL
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Key differences in the results:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;INNER JOIN doesn&amp;rsquo;t include Charlie because he has no matching project.&lt;/li&gt;
&lt;li&gt;LEFT JOIN includes Charlie with a NULL project.&lt;/li&gt;
&lt;li&gt;Neither join includes the Delta project because it has no matching employee.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In summary, use JOIN when you only want results with matches in both tables, and use LEFT JOIN when you want all rows from the left table, regardless of whether there&amp;rsquo;s a match in the right table.&lt;/p&gt;
&lt;p&gt;Would you like me to elaborate on any part of this explanation or provide more examples?&lt;/p&gt;
&lt;h2 id="extra-query-for-user-opinions"&gt;extra query for user opinions
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;will using an extra query to get user opinion information rather than querying it by above method be more efficient?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That&amp;rsquo;s an excellent question. The efficiency of using a single query versus multiple queries depends on several factors. Let&amp;rsquo;s analyze both approaches:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Single Query Approach (current method):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pros:
&lt;ul&gt;
&lt;li&gt;Reduces the number of database round trips&lt;/li&gt;
&lt;li&gt;Can be more efficient for &lt;strong&gt;smaller result sets&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons:
&lt;ul&gt;
&lt;li&gt;More complex query&lt;/li&gt;
&lt;li&gt;Potential for larger result set due to the LEFT JOIN&lt;/li&gt;
&lt;li&gt;May be slower for large datasets &lt;strong&gt;due to the join operation&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Separate Queries Approach:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pros:
&lt;ul&gt;
&lt;li&gt;Simpler, more focused queries&lt;/li&gt;
&lt;li&gt;Can be more efficient for large datasets&lt;/li&gt;
&lt;li&gt;Allows for more granular caching strategies&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons:
&lt;ul&gt;
&lt;li&gt;Multiple database round trips&lt;/li&gt;
&lt;li&gt;Potential for N+1 query problem if not implemented carefully&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To determine which approach is more efficient, consider the following factors:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Dataset size:&lt;/strong&gt; For smaller datasets, the single query approach might be faster. For larger datasets, separate queries could perform better.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Query complexity:&lt;/strong&gt; If the join operation significantly complicates the query or slows down execution, separate queries might be preferable.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Caching strategies:&lt;/strong&gt; Separate queries allow for more granular caching of post information and user opinions.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Network latency:&lt;/strong&gt; If network latency between your application and database is high, fewer round trips (single query) might be beneficial.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Database indexes:&lt;/strong&gt; Proper indexing can significantly impact the performance of both approaches.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Given these considerations, here&amp;rsquo;s a potential implementation using separate queries:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PostRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OpinionRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinionRepository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Constructor injection...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;PostInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getPostsInSpace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PageRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;PostInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findPostsInSpace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postIds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContent&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PostInfo&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserOpinion&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinions&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;opinionRepository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findUserOpinionsByPostIds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postIds&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContent&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setUserOpinion&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;opinions&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getOrDefault&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserOpinion&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;NO_OPINION&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Repository&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;PostRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JpaRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT NEW com.heslin.postopia.dto.post.PostInfo(p.id, p.subject, p.content, p.positiveCount, p.negativeCount, p.commentCount, u.username, u.nickname, u.avatar) FROM Post p JOIN p.user u JOIN p.space s WHERE s.id = :spaceId ORDER BY p.createdAt DESC&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;PostInfo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findPostsInSpace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;spaceId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;spaceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pageable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pageable&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Repository&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;OpinionRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;extends&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JpaRepository&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Opinion&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;SELECT o.post.id as postId, CASE WHEN o.isPositive = true THEN &amp;#39;LIKE&amp;#39; WHEN o.isPositive = false THEN &amp;#39;DISLIKE&amp;#39; ELSE &amp;#39;NO_OPINION&amp;#39; END as opinion FROM Opinion o WHERE o.user.id = :userId AND o.post.id IN :postIds&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;[]&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findUserOpinionsByPostIds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;postIds&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postIds&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserOpinion&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findUserOpinionsByPostIds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postIds&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;findUserOpinionsByPostIds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postIds&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserOpinion&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;valueOf&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This approach allows you to:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Fetch posts without the complexity of joining with the opinions table.&lt;/li&gt;
&lt;li&gt;Retrieve user opinions for only the fetched posts in a separate query.&lt;/li&gt;
&lt;li&gt;Combine the results in memory.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To determine which method is more efficient for your specific use case, I recommend:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Implement both approaches.&lt;/li&gt;
&lt;li&gt;Create performance tests with various dataset sizes and query patterns.&lt;/li&gt;
&lt;li&gt;Profile the application to measure actual performance differences.&lt;/li&gt;
&lt;li&gt;Consider the maintainability and readability of each approach in your codebase.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Remember, premature optimization can lead to unnecessary complexity. Start with the approach that&amp;rsquo;s most straightforward for your team to implement and maintain, then optimize if and when performance becomes an issue based on real-world usage patterns.&lt;/p&gt;
&lt;h2 id="common-table-expressions"&gt;Common Table Expressions
&lt;/h2&gt;&lt;p&gt;Common Table Expressions (CTEs) in SQL are temporary named result sets that you can reference within a SELECT, INSERT, UPDATE, DELETE, or MERGE statement. They are defined using a WITH clause at the beginning of a query. Here&amp;rsquo;s a brief explanation of CTEs:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Syntax:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cte_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cte_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Key features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Improve readability by breaking complex queries into simpler, named parts&lt;/li&gt;
&lt;li&gt;Can be referenced multiple times within the main query&lt;/li&gt;
&lt;li&gt;Useful for recursive queries&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sales_summary&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;product_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SUM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;quantity&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;total_quantity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SUM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;quantity&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;total_revenue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sales&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;product_id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;product_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;total_quantity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;total_revenue&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;products&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sales_summary&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;product_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;product_id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;CTEs are particularly useful for complex queries, hierarchical data, and when you need to reference the same subquery multiple times.&lt;/p&gt;
&lt;p&gt;Would you like me to elaborate on any specific aspect of Common Table Expressions?&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 3</title><link>https://dyhes.github.io/p/postopia-dev-logweek-3/</link><pubDate>Fri, 16 Aug 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-3/</guid><description>&lt;h1 id="week3"&gt;Week3
&lt;/h1&gt;&lt;p&gt;å†™è¯„è®ºæŸ¥è¯¢çš„æ—¶å€™é‡åˆ°äº†é€’å½’æŸ¥è¯¢å’Œé€’å½’ç»“æ„æ„å»ºçš„é—®é¢˜ï¼Œè¿™æ ·çš„é—®é¢˜æ˜¯è¡¨å±‚å­¦ä¹ è€Œä¸çœŸæ­£æ·±å…¥ä½¿ç”¨çŸ¥è¯†ã€æ¡†æ¶æ—¶éš¾ä»¥é‡åˆ°å¹¶å­¦ä¹ å¦‚ä½•è§£å†³çš„ã€‚&lt;/p&gt;
&lt;h2 id="enum-in-query"&gt;enum in @Query
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;select new com.heslin.postopia.dto.post.PostSummary(p.subject, p.positive_count, p.negative_count, p.comment_count, u.username, u.nickname, u.avatar) from Post p JOIN p.user u where p.space_id = :id and p.status != com.heslin.postopia.enums.PostStatus.DRAFT&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="record"&gt;record
&lt;/h2&gt;&lt;h3 id="generics"&gt;Generics
&lt;/h3&gt;&lt;p&gt;Records in Java can be combined with generics. Records, introduced in Java 14 as a preview feature and made stable in Java 16, provide a concise way to model immutable data. Generics allow types (classes and interfaces) to be parameters when defining classes, interfaces, and methods. Combining these two can lead to more flexible and reusable code.&lt;/p&gt;
&lt;p&gt;Here is an example of how you can define and use a generic record in Java:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Define a generic record&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;Pair&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;K&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;V&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Usage example&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pair&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pair&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Pair&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;age&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Key: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pair&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;key&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Value: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pair&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this example:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Pair&amp;lt;K, V&amp;gt;&lt;/code&gt; is a generic record with two type parameters, &lt;code&gt;K&lt;/code&gt; and &lt;code&gt;V&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;Pair&lt;/code&gt; record has two components, &lt;code&gt;key&lt;/code&gt; and &lt;code&gt;value&lt;/code&gt;, of types &lt;code&gt;K&lt;/code&gt; and &lt;code&gt;V&lt;/code&gt; respectively.&lt;/li&gt;
&lt;li&gt;When creating an instance of &lt;code&gt;Pair&lt;/code&gt;, you specify the actual types to use, such as &lt;code&gt;String&lt;/code&gt; and &lt;code&gt;Integer&lt;/code&gt; in this case.&lt;/li&gt;
&lt;li&gt;You can then use the &lt;code&gt;key()&lt;/code&gt; and &lt;code&gt;value()&lt;/code&gt; methods to access the components of the record.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This example illustrates how generics can be seamlessly integrated with records to create versatile and type-safe data structures.&lt;/p&gt;
&lt;h3 id="extension"&gt;Extension
&lt;/h3&gt;&lt;p&gt;No, records in Java cannot be extended. Records are implicitly &lt;code&gt;final&lt;/code&gt;, meaning they cannot be subclassed. This design choice aligns with the primary purpose of records, which is to provide a simple and concise way to create immutable data carriers. Allowing inheritance would complicate this model and could undermine the immutability guarantees that records provide.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a brief overview of some key characteristics of records:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Immutability&lt;/strong&gt;: Records are designed to be immutable. All fields in a record are implicitly &lt;code&gt;private&lt;/code&gt; and &lt;code&gt;final&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Compact Syntax&lt;/strong&gt;: Records provide a compact syntax for declaring classes that are primarily used to hold data.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Final and Non-Extendable&lt;/strong&gt;: Records are implicitly &lt;code&gt;final&lt;/code&gt;, meaning you cannot extend a record class.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you need to share common functionality or data among multiple types, consider using composition or interfaces instead of inheritance. Here is an example using composition:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Common functionality encapsulated in a class&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CommonData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonField&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;CommonData&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonField&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commonField&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonField&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getCommonField&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonField&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Record using composition&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;SpecializedRecord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;specificField&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CommonData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonData&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CommonData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonData&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CommonData&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Shared Data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpecializedRecord&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SpecializedRecord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Specific Data&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonData&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Specific Field: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;specificField&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Common Field: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commonData&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getCommonField&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this example, the &lt;code&gt;CommonData&lt;/code&gt; class encapsulates the shared functionality, and the &lt;code&gt;SpecializedRecord&lt;/code&gt; record uses composition to include this common data. This approach maintains the benefits of immutability and concise syntax while avoiding the pitfalls of inheritance.&lt;/p&gt;
&lt;h2 id="break-circular-dependencies"&gt;Break circular dependencies
&lt;/h2&gt;&lt;p&gt;In Spring Boot, it&amp;rsquo;s generally not advisable to have two services autowire each other as fields because it can create a circular dependency. Circular dependencies can make your application context fail to start and are generally considered a bad design practice.&lt;/p&gt;
&lt;p&gt;However, if you still need to achieve this, there are some workaround strategies. Here are a few approaches:&lt;/p&gt;
&lt;h3 id="setter-injection"&gt;&lt;strong&gt;Setter Injection&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;This method uses setter methods instead of field injection to avoid circular dependencies.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setServiceB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serviceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setServiceA&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serviceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="lazy"&gt;&lt;strong&gt;&lt;code&gt;@Lazy&lt;/code&gt; Annotation&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;You can use the &lt;code&gt;@Lazy&lt;/code&gt; annotation to delay the initialization of one of the services, breaking the circular dependency.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ServiceA&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Lazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serviceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ServiceB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Lazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serviceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="redesign-your-services"&gt;&lt;strong&gt;Redesign Your Services&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;Often, circular dependencies are a sign that your service design needs to be refactored. Consider whether you can split responsibilities differently to avoid the circular dependency. For example, you could introduce a third service or a common interface.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CommonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ServiceA&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CommonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commonMethod&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CommonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ServiceB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CommonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;commonService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;commonMethod&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CommonService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;commonMethod&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Common logic here&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="application-context"&gt;&lt;strong&gt;Application Context&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;You can also manually fetch the beans from the application context, but this is generally not recommended and should be used as a last resort.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ApplicationContextAware&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ApplicationContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;applicationContext&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setApplicationContext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ApplicationContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;applicationContext&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BeansException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;applicationContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;applicationContext&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@PostConstruct&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;init&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serviceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;applicationContext&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServiceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceB&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ServiceB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;ServiceB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ServiceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;serviceA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serviceA&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="conclusion"&gt;Conclusion
&lt;/h3&gt;&lt;p&gt;While you can technically create circular dependencies using these methods, it&amp;rsquo;s usually better to refactor your code to avoid such designs. Circular dependencies can make your code harder to understand, test, and maintain. Consider whether there are better ways to structure your services to keep them decoupled.&lt;/p&gt;
&lt;h2 id="recursive-model-query"&gt;Recursive Model Query
&lt;/h2&gt;&lt;p&gt;Check post with the same name for details&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Week 2</title><link>https://dyhes.github.io/p/postopia-dev-logweek-2/</link><pubDate>Fri, 19 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-2/</guid><description>&lt;p&gt;æŒ‰éƒ¨å°±ç­è¿›è¡Œå¼€å‘ï¼Œå‘ç°è‡ªå·±å¯èƒ½ä¼šåœ¨ä¸€äº›è‡ªå·±è®¤çŸ¥èŒƒå›´å†…çš„æ€§èƒ½ä¼˜åŒ–ç‚¹ç‰¹åˆ«åœ¨æ„ï¼Œåˆä¼šè§‰å¾—ä¼˜åŒ–éœ€è¦å¯¹è¯­è¨€åº•å±‚æœ‰æ·±åˆ»çš„è®¤çŸ¥ï¼Œæ¥è¿‘äºä¸€ä¸ªæ— ç©·æ— å°½çš„è¿‡ç¨‹ï¼Œç„¶åå¯¹è‡ªå·±çš„è¯­è¨€åŠŸåº•æ„Ÿåˆ°ç„¦è™‘ã€‚&lt;/p&gt;
&lt;h2 id="delete-method"&gt;Delete method
&lt;/h2&gt;&lt;p&gt;Yes, derived delete methods in Spring Data JPA repositories can return a boolean value. When you define a derived delete method to return a boolean, it will indicate whether any records were actually deleted.&lt;/p&gt;
&lt;h2 id="entitylistenersauditingentitylistenerclass"&gt;@EntityListeners(AuditingEntityListener.class)
&lt;/h2&gt;&lt;p&gt;é™¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;@EnableJpaAuditting&lt;/li&gt;
&lt;li&gt;@CreateDate
è¿˜éœ€è¦åŠ ä¸Šï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@EntityListeners(AuditingEntityListener.class)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="data-transfer-objects"&gt;Data Transfer ObjectsÂ 
&lt;/h2&gt;&lt;p&gt;query only the needed fields in Spring Data JPA for several reasons:&lt;/p&gt;
&lt;h3 id="performance-optimization"&gt;Performance optimization:
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;By querying only the required fields, you reduce the amount of data transferred between the database and your application, which can improve performance, especially for large datasets.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="reduced-network-traffic"&gt;Reduced network traffic:
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Transferring only the necessary data minimizes network usage, which is particularly beneficial in distributed systems or when dealing with remote clients.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="separation-of-concerns"&gt;Separation of concerns:
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;DTOs help separate the data representation used in your applicationâ€™s business logic from the underlying database entities, providing a clear boundary between layers.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="flexibility-and-maintainability"&gt;Flexibility and maintainability:
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;DTOs allow you to shape the data according to specific use cases, making it easier to evolve your API without affecting the underlying data model.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="security"&gt;Security:
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;By using DTOs, you can control which data is exposed to the client, reducing the risk of accidentally exposing sensitive information.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="avoid-lazy-loading-issues"&gt;Avoid lazy loading issues:
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;When working with JPA entities, lazy-loaded associations can cause performance problems or errors if accessed outside of a transaction. DTOs help avoid these issues by containing only the required data.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="var-keyword"&gt;&lt;code&gt;Var&lt;/code&gt; keyword
&lt;/h2&gt;&lt;p&gt;In Java, theÂ varÂ keyword was introduced in &lt;strong&gt;Java 10&lt;/strong&gt; as part of the &lt;strong&gt;Local Variable Type Inference feature&lt;/strong&gt;. It allows you to declare local variables without explicitly specifying their type. The compiler infers the type &lt;strong&gt;based on the initialization expression&lt;/strong&gt;.
Here are some key points aboutÂ varÂ in Java:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;usage&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;variableName&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initialValue&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Scope:Â 
varÂ can only be used for &lt;strong&gt;local variables&lt;/strong&gt; inside methods or loops. It cannot be used for fields, method parameters, or return types.&lt;/li&gt;
&lt;li&gt;Initialization:
Variables declared withÂ varÂ must be &lt;strong&gt;initialized in the same statement&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Type Inference:
The compiler infers the type based on the right-hand side of the assignment.&lt;/li&gt;
&lt;li&gt;Limitations:
&lt;ul&gt;
&lt;li&gt;Cannot be used with null literals&lt;/li&gt;
&lt;li&gt;Cannot be used with array initializers&lt;/li&gt;
&lt;li&gt;Cannot be used in a compound declaration (declaring multiple variables in one statement)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Examples&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Basic usage&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;John&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// inferred as String&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// inferred as int&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// inferred as ArrayList&amp;lt;String&amp;gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// In a for loop&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// With lambda expressions&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;comparator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;compareTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// With try-with-resources&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BufferedReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FileReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;file.txt&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Use reader&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Benefits of usingÂ var:
&lt;ul&gt;
&lt;li&gt;Reduces boilerplate code, especially with long type names.&lt;/li&gt;
&lt;li&gt;Improves &lt;strong&gt;readability&lt;/strong&gt; in some cases, particularly with generic types.&lt;/li&gt;
&lt;li&gt;Allows the type to change without changing the variable declaration.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Considerations:
&lt;ul&gt;
&lt;li&gt;UseÂ varÂ judiciously. Sometimes explicit type declarations can improve code clarity.&lt;/li&gt;
&lt;li&gt;varÂ doesnâ€™t make Java a dynamically-typed language. The type is still &lt;strong&gt;determined at compile-time&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;IDEs can usually show you the inferred type, which helps with code understanding.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="other-local-variable-type-inference-feature"&gt;Other Local Variable Type Inference feature
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Diamond Operator (&amp;lt;&amp;gt;):
Introduced in Java 7, it allows type inference for generic class instantiation.
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Instead of new ArrayList&amp;lt;String&amp;gt;() &lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Method References:
Introduced in Java 8, method references work with type inference.
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Charlie&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;names&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Try-with-resources
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;input&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FileInputStream&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;file.txt&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Use input&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="repository-layer-referencing"&gt;Repository Layer Referencing
&lt;/h2&gt;&lt;h3 id="one-repository-and-multiple-services"&gt;One @Repository and Multiple @Services
&lt;/h3&gt;&lt;h4 id="pros"&gt;Pros
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Promotes &lt;strong&gt;separation of concerns&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Follows the &lt;strong&gt;Single Responsibility Principle&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Can lead to better code organization and maintainability&lt;/li&gt;
&lt;li&gt;Easier to manage &lt;strong&gt;transactions&lt;/strong&gt; across multiple services&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cons"&gt;Cons
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;May require more classes and interfaces&lt;/li&gt;
&lt;li&gt;Can potentially lead to more complex dependency injection&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="multiple-repositories"&gt;Multiple @Repositories
&lt;/h3&gt;&lt;h4 id="pros-1"&gt;Pros
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Can &lt;strong&gt;simplify&lt;/strong&gt; the service layer if operations frequently require data from multiple repositories&lt;/li&gt;
&lt;li&gt;Reduces the number of classes and interfaces&lt;/li&gt;
&lt;li&gt;May be more straightforward for simpler applications&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cons-1"&gt;â €Cons
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Can lead to a â€œfatâ€ service class with too many responsibilities&lt;/li&gt;
&lt;li&gt;May make it &lt;strong&gt;harder to maintain&lt;/strong&gt; and test the service class&lt;/li&gt;
&lt;li&gt;Could potentially &lt;strong&gt;violate&lt;/strong&gt; the Single Responsibility Principle&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="considerations"&gt;Considerations
&lt;/h3&gt;&lt;p&gt;Generally speaking, itâ€™s often considered a good practice to follow &lt;strong&gt;the first approach&lt;/strong&gt; (one @Repository and multiple @Services) for the following reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Better separation of concerns: Each service class can focus on a specific domain or set of related operations.&lt;/li&gt;
&lt;li&gt;Improved maintainability: Smaller, more focused classes are usually easier to understand and maintain.&lt;/li&gt;
&lt;li&gt;Easier testing: With more granular services, itâ€™s easier to write unit tests and mock dependencies.&lt;/li&gt;
&lt;li&gt;Flexibility: Itâ€™s easier to reuse and combine services in different ways.&lt;/li&gt;
&lt;li&gt;Scalability: As your application grows, itâ€™s easier to add new features or modify existing ones without affecting other parts of the system.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, the best approach &lt;strong&gt;depends on your specific use case&lt;/strong&gt;. If your application is small and simple, or if a particular service genuinely needs to work with multiple repositories directly, then referencing multiple repositories in a service class might be appropriate.&lt;/p&gt;
&lt;p&gt;In conclusion, while referencing one @Repository and multiple @Services in a @Service class is often a good practice, the most important thing is to choose an approach that makes sense for your applicationâ€™s architecture and maintainability goals.&lt;/p&gt;
&lt;h2 id="long-or-long"&gt;Â Long or long
&lt;/h2&gt;&lt;p&gt;In Java, itâ€™s &lt;strong&gt;generally recommended&lt;/strong&gt; to use the primitive typeÂ longÂ instead of the wrapper classÂ LongÂ in method signatures, unless you have a &lt;strong&gt;specific reason&lt;/strong&gt; to use the object wrapper. Hereâ€™s why:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Performance&lt;/strong&gt;: Primitive types are more efficient in terms of memory usage and performance. They donâ€™t require object creation or autoboxing/unboxing.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Simplicity&lt;/strong&gt;: Using primitives makes the code simpler and more straightforward.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Null safety&lt;/strong&gt;: Primitive types canâ€™t be null, which can prevent null pointer exceptions.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, there are cases where usingÂ LongÂ might be preferable:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;When &lt;strong&gt;null values are meaningful&lt;/strong&gt;: If you need to represent the absence of a value,Â LongÂ can be null whileÂ longÂ cannot.&lt;/li&gt;
&lt;li&gt;In &lt;strong&gt;collections&lt;/strong&gt;: Java collections (like ArrayList or HashMap) require object types, so youâ€™d useÂ LongÂ in these cases.&lt;/li&gt;
&lt;li&gt;When working with &lt;strong&gt;generics&lt;/strong&gt;: Generics in Java donâ€™t work with primitive types, so youâ€™d need to useÂ LongÂ in these situations.&lt;/li&gt;
&lt;li&gt;In certain APIs or frameworks: Some APIs or frameworks might require the use of wrapper classes.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// Preferred for most cases&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodWithLong&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Use when null is a meaningful value&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodWithLongObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Handle null case&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Handle non-null case&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In summary, useÂ longÂ by default for better performance and simplicity, but donâ€™t hesitate to useÂ LongÂ when the situation calls for it, such as when dealing with nullable values or working with Java collections and generics.&lt;/p&gt;
&lt;h2 id="check-or-not"&gt;Check Or Not
&lt;/h2&gt;&lt;h3 id="checking-existence-before-update"&gt;Checking existence before update
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;existsById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entity&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EntityNotFoundException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Entity not found&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="pros-2"&gt;Pros
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Provides &lt;strong&gt;more control&lt;/strong&gt; over the flow of your application.&lt;/li&gt;
&lt;li&gt;Allows you to give &lt;strong&gt;more specific feedback&lt;/strong&gt; to the user (e.g., â€œUser not foundâ€ instead of a generic error).&lt;/li&gt;
&lt;li&gt;Can be more efficient if you have &lt;strong&gt;additional logic&lt;/strong&gt; that depends on the entityâ€™s existence.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cons-2"&gt;â €Cons
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Requires an additional database query, which can &lt;strong&gt;impact performance&lt;/strong&gt;, especially in high-traffic scenarios.&lt;/li&gt;
&lt;li&gt;Thereâ€™s a small chance of a &lt;strong&gt;race condition&lt;/strong&gt; between the check and the update (though this is rare in most applications).&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="handling-the-update-exception-directly"&gt;Handling the update exception directly
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entity&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EntityNotFoundException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Handle the case where the entity doesn&amp;#39;t exist&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="pros-3"&gt;Pros
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;More &lt;strong&gt;straightforward&lt;/strong&gt; code, following the â€œitâ€™s easier to ask forgiveness than permissionâ€ principle.&lt;/li&gt;
&lt;li&gt;Potentially more &lt;strong&gt;efficient&lt;/strong&gt; as it avoids an extra database query.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Eliminates&lt;/strong&gt; the possibility of race conditions between checking and updating.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cons-3"&gt;â €Cons
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Less control&lt;/strong&gt; over the specific error message or handling.&lt;/li&gt;
&lt;li&gt;May &lt;strong&gt;catch other unexpected exceptions&lt;/strong&gt; that you didnâ€™t intend to handle in the same way.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="recommendation"&gt;Recommendation
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;For most simple CRUD operations, handling the exception directly is often sufficient and more efficient.&lt;/li&gt;
&lt;li&gt;Consider checking existence first if:
&lt;ul&gt;
&lt;li&gt;You need to provide very specific feedback to the user.&lt;/li&gt;
&lt;li&gt;You have complex logic that depends on whether the entity exists or not.&lt;/li&gt;
&lt;li&gt;Youâ€™re in a scenario where the extra database query doesnâ€™t significantly impact performance.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;In &lt;strong&gt;high-performance&lt;/strong&gt; systems with many updates, handling the exception might be preferable to avoid the extra query.&lt;/li&gt;
&lt;li&gt;If youâ€™re using optimistic locking (e.g., with @Version), you might want to handle OptimisticLockingFailureException separately, as this indicates a concurrent modification rather than a non-existent entity.&lt;/li&gt;
&lt;li&gt;Consider your specific use case: if updates to non-existent entities are rare, handling the exception might be cleaner. If theyâ€™re common, checking first could provide a better user experience.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="transactional-on-repository-layer"&gt;Transactional on Repository Layer
&lt;/h2&gt;&lt;p&gt;By default, Spring Data JPA repository methods are transactional, but &lt;strong&gt;only for read-only operations&lt;/strong&gt;. For modifying operations (like updates), you need to explicitly mark the method or the surrounding service method withÂ @Transactional.&lt;/p&gt;
&lt;h2 id="derived-query-method"&gt;Derived Query Method
&lt;/h2&gt;&lt;p&gt;In Spring Data JPA, derived query methods &lt;strong&gt;are primarily used for retrieving data&lt;/strong&gt; rather than updating it. While derived query methods are very convenient for simple read operations, they do not support update operations directly.&lt;/p&gt;
&lt;h2 id="malicious-use"&gt;Malicious Use
&lt;/h2&gt;&lt;p&gt;When developing and deploying a REST API, itâ€™s essential to consider both valid scenarios and potential malicious use cases.Â &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Security&lt;/strong&gt;: Ignoring potential malicious use can leave your API vulnerable to attacks such as SQL injection, Cross-Site Scripting (XSS), Distributed Denial of Service (DDoS), and others.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Stability&lt;/strong&gt;: Malicious uses can lead to unexpected behavior, crashes, or resource exhaustion, affecting the availability and reliability of your service.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Compliance&lt;/strong&gt;: Many industries have regulations requiring secure handling of data, which includes protecting against malicious use.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;User Trust&lt;/strong&gt;: Users expect their data to be secure. Failing to protect against malicious use can damage your reputation and erode user trust.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="authenticatedprincipal-usage"&gt;@AuthenticatedPrincipal Usage
&lt;/h2&gt;&lt;h3 id="passing-the-principal-from-the-controller"&gt;Passing the principal from the controller
&lt;/h3&gt;&lt;h4 id="pros-4"&gt;Pros
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Makes the flow of data more explicit.&lt;/li&gt;
&lt;li&gt;Easier to &lt;strong&gt;unit test&lt;/strong&gt; the service layer, as you can pass any principal object directly.&lt;/li&gt;
&lt;li&gt;Keeps the service layer completely &lt;strong&gt;decoupled&lt;/strong&gt; from Spring Security.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cons-4"&gt;Cons
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Requires passing the principal through &lt;strong&gt;potentially many layers&lt;/strong&gt; if you have a deep call hierarchy.&lt;/li&gt;
&lt;li&gt;May lead to repetitive code in controllers if many endpoints need to pass the principal.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="usingauthenticatedprincipalin-the-service-layer"&gt;Using@AuthenticatedPrincipalÂ in the service layer
&lt;/h3&gt;&lt;h4 id="pros-5"&gt;Pros
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Keeps the service method signature clean and focused on business logic parameters.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reduces coupling&lt;/strong&gt; between the controller and service layer.&lt;/li&gt;
&lt;li&gt;Allows the service to be used in different contexts (e.g., scheduled tasks, message listeners) where a controller might not be involved.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="cons-5"&gt;Cons
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;May make unit testing the service layer slightly &lt;strong&gt;more complex&lt;/strong&gt;, as you need to mock the security context.&lt;/li&gt;
&lt;li&gt;Could be seen as &lt;strong&gt;mixing concerns&lt;/strong&gt; if you consider authentication a cross-cutting concern.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="recommendation-1"&gt;Recommendation
&lt;/h3&gt;&lt;p&gt;In general, usingÂ @AuthenticatedPrincipalÂ in the service layer is often preferred because:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It adheres to the Donâ€™t Repeat Yourself (DRY) principle, avoiding the need to pass the principal in every controller method.&lt;/li&gt;
&lt;li&gt;It makes the service methods self-contained and more reusable in different contexts.&lt;/li&gt;
&lt;li&gt;It leverages Spring Securityâ€™s built-in capabilities, which are well-tested and maintained.&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Day 5</title><link>https://dyhes.github.io/p/postopia-dev-logday-5/</link><pubDate>Fri, 12 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-5/</guid><description>&lt;p&gt;æ·±å…¥äº†è§£äº†@ManyToMany, @ManyToOne, @OneToMany, @OneToOne è¿™å‡ ä¸ªæ³¨è§£ä»¥åŠjavaä¸­çš„æ—¥æœŸæ—¶é—´åŠå…¶åœ¨æ•°æ®åº“é‡Œçš„ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;å®šä¹‰äº†Comment, Space ç­‰ model&lt;/p&gt;
&lt;h2 id="id"&gt;@Id
&lt;/h2&gt;&lt;p&gt;TheÂ @IdÂ annotation in JPA (Java Persistence API) is used to mark a field as the primary key of an entity.&lt;/p&gt;
&lt;p&gt;By default:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nullable:
&lt;ul&gt;
&lt;li&gt;@IdÂ fields are generally not nullable. Primary keys are used to uniquely identify each record in a database table, so they must have a value.&lt;/li&gt;
&lt;li&gt;However, the exact behavior can depend on the underlying database and the specific JPA implementation.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Updatable:
&lt;ul&gt;
&lt;li&gt;@IdÂ fields are typically not updatable after they are set.&lt;/li&gt;
&lt;li&gt;Once an entity is persisted with a primary key value, that value should not change for the lifetime of the entity.&lt;/li&gt;
&lt;li&gt;Changing the ID of an existing entity can lead to data integrity issues and is generally discouraged.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Itâ€™s important to note:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;While theÂ @IdÂ itself doesnâ€™t have properties for nullable or updatable, you can use additional annotations or configurations to modify the behavior:
&lt;ul&gt;
&lt;li&gt;You can useÂ @Column(nullable = false)Â to explicitly specify that the field cannot be null (though this is usually the default for ID fields).&lt;/li&gt;
&lt;li&gt;You can useÂ @Column(updatable = false)Â to explicitly specify that the field cannot be updated after initial persistence.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;The exact behavior can also depend on how the ID is generated. For example, if youâ€™re usingÂ @GeneratedValueÂ for automatic ID generation, the field will initially be null until the entity is persisted, at which point the database or JPA provider will generate and set the ID value.&lt;/li&gt;
&lt;li&gt;Some JPA implementations might allow updates to ID fields in certain circumstances, but this is not standard behavior and should be avoided in most cases.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="set-or-list"&gt;Set or List
&lt;/h2&gt;&lt;p&gt;When deciding whether to use aÂ SetÂ or aÂ ListÂ forÂ @ManyToManyÂ andÂ @OneToManyÂ relationships in JPA, there are several factors to consider, including the uniqueness requirement, ordering, and performance. Here is a breakdown of when to use each:&lt;/p&gt;
&lt;h3 id="when-to-use-set"&gt;When to Use Set
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Uniqueness&lt;/strong&gt;
SetÂ does not allow duplicate elements. If you want to ensure that the collection of related entities is unique, aÂ SetÂ is appropriate.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;No Ordering&lt;/strong&gt;
SetÂ does not maintain the order of elements. If the order of the related entities does not matter, you can use aÂ Set.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Performance&lt;/strong&gt;
In general,Â SetÂ operations like add, remove, and contains are faster thanÂ ListÂ operations becauseÂ SetÂ uses hashing or other mechanisms to enforce uniqueness.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="when-to-uselist"&gt;&lt;strong&gt;When to Use&lt;/strong&gt;Â &lt;strong&gt;List&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ordering&lt;/strong&gt;
ListÂ maintains the order of elements. If the order of the related entities matters, or you need to preserve the order in which elements are inserted, you should use aÂ List.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Duplicates&lt;/strong&gt;
ListÂ allows duplicate elements. If there is a scenario where duplicates are meaningful or required, thenÂ ListÂ is the appropriate choice.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Indexed Access&lt;/strong&gt;
ListÂ allows indexed access to elements. If you need to frequently access elements by their index, aÂ ListÂ would be more suitable.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="join-table-entity"&gt;Join Table Entity
&lt;/h2&gt;&lt;p&gt;Check the corresponding Independent post&lt;/p&gt;
&lt;h2 id="dates-in-java"&gt;Dates in Java
&lt;/h2&gt;&lt;p&gt;Check the corresponding Independent post&lt;/p&gt;
&lt;h2 id="confusion-about-fetchtypelazy"&gt;Confusion about FetchType.LAZY
&lt;/h2&gt;&lt;p&gt;Is the primary key of the referenced entity can be easily accessed even when the fetch is LAZY in @ManyToOne and @OneToOne of spring data jpa?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Yes, the primary key of the referenced entity can still be easily accessed even when the fetch type is set toÂ FetchType.LAZYÂ inÂ @ManyToOneÂ andÂ @OneToOneÂ relationships in Spring Data JPA.&lt;/p&gt;
&lt;p&gt;When you configure a relationship withÂ FetchType.LAZY, it means that the related entity is not immediately loaded from the database when the parent entity is fetched. Instead, it is loaded on demand when you actually try to access the relationship.&lt;/p&gt;
&lt;p&gt;However, accessing the primary key of the referenced entity does not require fetching the entire entity. The primary key value is typically stored as a foreign key in the parent entity, and &lt;strong&gt;you can access this foreign key directly without triggering a lazy load of the related entity&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Is it the same for @ManyToMany and @OneToMany?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GPT-4o:&lt;/p&gt;
&lt;p&gt;No.&lt;/p&gt;
&lt;p&gt;In aÂ @ManyToManyÂ relationship, a &lt;strong&gt;join table&lt;/strong&gt; is typically used to maintain the associations between the entities. When the fetch type isÂ LAZY, the list of related entities is not loaded until you explicitly access it.&lt;/p&gt;
&lt;p&gt;In aÂ @ManyToManyÂ relationship, The foreign keyÂ parent_idÂ is stored in theÂ ChildÂ entity and &lt;strong&gt;not directly accessible from theÂ ParentÂ entity without loading the children&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;In both cases, there isnâ€™t a straightforward way to access the primary keys of the related entities without triggering a lazy load.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="entity-objectextension"&gt;Entity ObjectÂ Extension
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.MappedSuperclass&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.Id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.GenerationType&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;javax.persistence.Column&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@MappedSuperclass&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;abstract&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BaseEntity&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Id&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@GeneratedValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strategy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GenerationType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IDENTITY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;created_at&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LocalDateTime&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;createdAt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Column&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;updated_at&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;LocalDateTime&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;updatedAt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Getters and Setters&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="confusions-about-database"&gt;Confusions about database
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;In most cases, a simple COUNT() will be more efficient than retrieving detailed columns.&lt;/li&gt;
&lt;li&gt;the columns queried can have a significant impact on query time.
&lt;ul&gt;
&lt;li&gt;SELECT * is often slower than selecting specific columns, especially in large tables.&lt;/li&gt;
&lt;li&gt;Smaller data types (e.g., INT) are typically faster to retrieve than larger ones (e.g., TEXT or BLOB).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Day 6</title><link>https://dyhes.github.io/p/postopia-dev-logday-6/</link><pubDate>Fri, 12 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-6/</guid><description>&lt;p&gt;å®ç°äº†åˆ›å»ºç©ºé—´å’ŒåŠ å…¥ç©ºé—´&lt;/p&gt;
&lt;p&gt;è°ƒè¯•æ¥å£çš„æ—¶å€™æŠ¥ï¼š&lt;/p&gt;
&lt;p&gt;failed to lazily initialize a collection of role: com.heslin.postopia.model.User.spaces: could not initialize proxy - no Session&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥ä¹‹åå‘ç° UsernamePasswordAuthenticationToken åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨principal çš„ toStringæ–¹æ³•ï¼Œå¯¼è‡´äº†è¿™ä¸ªé”™è¯¯ï¼Œè‡ªå·±é‡è½½User.toString ä¹‹åæ¢å¤æ­£å¸¸ã€‚&lt;/p&gt;
&lt;h2 id="polymorphic-query"&gt;Polymorphic Query
&lt;/h2&gt;&lt;p&gt;Check the corresponding post&lt;/p&gt;
&lt;h2 id="java-enum"&gt;Java Enum
&lt;/h2&gt;&lt;p&gt;Check the corresponding post&lt;/p&gt;
&lt;h2 id="pageable-and-sort"&gt;Pageable and Sort
&lt;/h2&gt;&lt;p&gt;Check the corresponding post&lt;/p&gt;
&lt;h2 id="query-and-jpql"&gt;@Query and JPQL
&lt;/h2&gt;&lt;p&gt;Check the corresponding post&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Day 4</title><link>https://dyhes.github.io/p/postopia-dev-logday-4/</link><pubDate>Wed, 10 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-4/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover6.png" alt="Featured image of post ã€Postopia Dev Logã€‘Day 4" /&gt;&lt;p&gt;å¿™äºæ„å»ºä¸ªäººåšå®¢ï¼Œæ²¡æœ‰ä»€ä¹ˆè¿›å±•&lt;/p&gt;
&lt;h2 id="knowledge"&gt;Knowledge
&lt;/h2&gt;&lt;h3 id="java-record"&gt;Java Record
&lt;/h3&gt;&lt;p&gt;Java records were &lt;strong&gt;introduced in Java 14&lt;/strong&gt; as a preview feature and became a s&lt;strong&gt;tandard feature in Java 16&lt;/strong&gt;. They provide a compact syntax for declaring classes that are used primarily to store data. Records are designed to reduce boilerplate code and make it easier to create &lt;strong&gt;simple, immutable&lt;/strong&gt; data carriers.
Syntax:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;Person&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Automatic generation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A constructor with parameters for all components&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Accessor methods for each component (e.g.,Â name()Â andÂ age())&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;equals()Â andÂ hashCode()Â methods&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;toString()Â method
Immutability:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Records are implicitly final and cannot be extended.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The fields (components) of a record are final by default.
Constructors:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;You can define custom constructors, including compact constructors.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A compact constructor doesnâ€™t need to explicitly list all fields:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;record&lt;/span&gt; &lt;span class="nc"&gt;Person&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Person&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Age cannot be negative&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Additional methods:You can add other methods to a record, just like in a regular class.
Limitations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Records cannot extend other classes (they implicitly extend java.lang.Record).&lt;/li&gt;
&lt;li&gt;They cannot declare instance fields other than the private final fields for the components of the state description.&lt;/li&gt;
&lt;li&gt;They cannot be abstract.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="internationalization"&gt;Internationalization
&lt;/h3&gt;&lt;p&gt;Internationalization (i18n) is typically handled on both the front end and the back end, but the approach and responsibilities can vary depending on the specific requirements of your application.&lt;/p&gt;
&lt;p&gt;In many modern web applications, the front end handles a significant portion of i18n, especially for single-page applications (SPAs) and client-heavy architectures. This approach allows for more responsive user experiences and reduces server load.&lt;/p&gt;
&lt;p&gt;However, some aspects of i18n are better suited for the back end, particularly when dealing with sensitive data, complex business logic, or when you need to generate localized content server-side.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Best practices&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Best practices often involve a combination of both:&lt;/p&gt;
&lt;p&gt;Use front-end i18n libraries for UI elements and client-side formatting.
Implement back-end i18n for database content, emails, and API responses.
Use content delivery networks (CDNs) or static file hosting for language resource files.
Consider using a translation management system (TMS) to streamline the translation process.&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Day 3</title><link>https://dyhes.github.io/p/postopia-dev-logday-3/</link><pubDate>Tue, 09 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-3/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover14.png" alt="Featured image of post ã€Postopia Dev Logã€‘Day 3" /&gt;&lt;p&gt;é‡åˆ°ä¸€ä¸ªå¥½åƒå¾ˆæœ‰ç”¨çš„ç½‘ç«™ &lt;a class="link" href="https://dzone.com/" target="_blank" rel="noopener"
&gt;Programming &amp;amp; DevOps news, tutorials &amp;amp; tools&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®ç°äº†ä¸€ä¸ªBadRequestExceptionHandler&lt;/p&gt;
&lt;p&gt;Spring Security æœ‰ç‚¹å¤æ‚ï¼Œæ²¡æ‰¾åˆ°å¥½çš„å‚è€ƒèµ„æ–™&lt;/p&gt;
&lt;p&gt;åœ¨claude 3.5çš„å¸®åŠ©ä¸‹åˆæ­¥å®ç°äº†åŸºäºç®€å•jwtçš„Authentication&lt;/p&gt;
&lt;p&gt;æµ‹è¯•filterçš„æ—¶å€™ä¸å°å¿ƒè°ƒç”¨äº†ä¸¤æ¬¡chain.doFilterå¯¼è‡´è¿”å›çš„jsonæ•°æ®æ˜¯é‡å¤çš„ä¸¤ä»½
&lt;a class="link" href="https://stackoverflow.com/questions/73892445/duplicate-json-in-spring-boot-response" target="_blank" rel="noopener"
&gt;Duplicate Json in Spring Boot Response&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="knowledge"&gt;Knowledge
&lt;/h2&gt;&lt;h3 id="keycloak"&gt;Keycloak
&lt;/h3&gt;&lt;p&gt;Keycloak is an open-source Identity and Access Management (IAM) solution developed by Red Hat. It provides a comprehensive set of features for managing authentication and authorization in modern applications.&lt;/p&gt;
&lt;h4 id="key-features"&gt;Key Features
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;1&lt;/strong&gt; &lt;strong&gt;Single Sign-On (SSO)&lt;/strong&gt;: Keycloak allows users to authenticate once and access multiple applications without re-entering credentials.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt; &lt;strong&gt;Identity Brokering&lt;/strong&gt;: It can integrate with external identity providers like Google, Facebook, or other SAML 2.0 or OpenID Connect providers.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3&lt;/strong&gt; &lt;strong&gt;User Federation&lt;/strong&gt;: Keycloak can sync with existing LDAP or Active Directory servers.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4&lt;/strong&gt; &lt;strong&gt;Customizable Authentication&lt;/strong&gt;: Supports various authentication mechanisms including password, OTP, and custom authenticators.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5&lt;/strong&gt; &lt;strong&gt;Fine-grained Authorization&lt;/strong&gt;: Provides role-based access control (RBAC) and attribute-based access control (ABAC).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6&lt;/strong&gt; &lt;strong&gt;Admin Console&lt;/strong&gt;: Offers a user-friendly interface for managing users, roles, clients, and realm settings.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;7&lt;/strong&gt; &lt;strong&gt;Standard Protocols&lt;/strong&gt;: Supports OAuth 2.0, OpenID Connect, and SAML 2.0.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;8&lt;/strong&gt; &lt;strong&gt;Client Adapters&lt;/strong&gt;: Provides adapters for easy integration with various application stacks.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;9&lt;/strong&gt; &lt;strong&gt;Themes and Internationalization&lt;/strong&gt;: Allows customization of login pages and supports multiple languages.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;10&lt;/strong&gt; &lt;strong&gt;Social Login&lt;/strong&gt;: Enables users to log in using their social media accounts.&lt;/p&gt;
&lt;h3 id="oauth2"&gt;Oauth2
&lt;/h3&gt;&lt;h4 id="involved-actors"&gt;Involved Actors
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;i) Resource Server&lt;/strong&gt;: The server hosting user-owned resources that are protected by OAuth2. The resource server validates the access-token and serves the protected resources.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ii) Resource Owner&lt;/strong&gt;: Typically, the user of the application is the resource owner. The resource owner has the ability to grant or deny access to their own data hosted on the resource server.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;iii) Authorization Server&lt;/strong&gt;: The authorization server gets consent from the resource owner and issues access tokens to clients for accessing protected resources hosted by a resource server.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;iv) Client&lt;/strong&gt;: An application making API requests to perform actions on protected resources on behalf of the resource owner. Before it may do so, it must be authorized by the resource owner, and the authorization must be validated by resource server/authorization server. OAuth2 defines two client types, based on their ability to authenticate securely with the authorization server (i.e., ability to &lt;strong&gt;maintain the confidentiality&lt;/strong&gt; of their client credentials):&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;a)Confidential&lt;/strong&gt;: Clients capable of maintaining the confidentiality of their credentials. Confidential clients are implemented on a secure server with restricted access to the client credentials (e.g., a web application running on a &lt;strong&gt;web server&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;b) Public&lt;/strong&gt;: Clients incapable of maintaining the confidentiality of their credentials (e.g. an installed native application or a &lt;strong&gt;web browser-based application&lt;/strong&gt;), and incapable of secure client authentication via any other means.&lt;/p&gt;
&lt;h4 id="authorization-grant-types"&gt;&lt;strong&gt;Authorization Grant Types&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;To get the access token, the client obtains authorization from the resource owner. The authorization is expressed in the form of an &lt;strong&gt;authorization grant, which the client uses to request the access token.&lt;/strong&gt; OAuth2 defines four standard grant types: authorization code, implicit, resource owner password credentials, and client credentials. It also provides an extension mechanism for defining additional grant types.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;i) Authorization Code Grant&lt;/strong&gt;: this grant type is optimized for confidential clients (web application server). The authorization code flow &lt;strong&gt;does not expose the access token to the resource ownerâ€™s browser&lt;/strong&gt;. Instead, authorization is accomplished using an intermediary â€œauthorization codeâ€ that is passed through the browser. This code must be exchanged for an access token before calls can be made to protected APIs.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ii) Implicit Grant&lt;/strong&gt;: this grant type is suitable &lt;strong&gt;for public clients&lt;/strong&gt;. The implicit grant flow &lt;strong&gt;does not accommodate refresh tokens&lt;/strong&gt;. If the authorization server expires access tokens regularly, your application will need to run through the authorization flow whenever it needs access. In this flow, an access token is immediately returned to the client after a user grants the requested authorization. An &lt;strong&gt;intermediate authorization code is not required&lt;/strong&gt; as it is in the authorization code grant.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;iii) Resource Owner Password Credentials&lt;/strong&gt;: the resource owner password credentials grant type is suitable in cases where &lt;strong&gt;the resource owner has a trust relationship with the client&lt;/strong&gt;, and the resource owner agrees to share hise/her credentials (username, password) with the client. Then the client canÂ use resources from the owner&amp;rsquo;s credentials to get the access token from the authorization server.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;iv) Client Credentials&lt;/strong&gt;: this grant type is suitable when &lt;strong&gt;the client itself owns the data and does not need delegated access from a resource owner&lt;/strong&gt;, or delegated access has already been granted to the application outside of a typical OAuth flow. In this flow, user consent is not involved. The client exchanges his client credentials to get an access token.&lt;/p&gt;
&lt;h3 id="transactions"&gt;Transactions
&lt;/h3&gt;&lt;p&gt;A database transaction is a sequence of one or more database operations that are treated as a single unit of work. Transactions adhere to the ACID properties:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1&lt;/strong&gt; &lt;strong&gt;Atomicity&lt;/strong&gt;: All operations in a transaction either complete successfully or fail altogether. There&amp;rsquo;s no partial completion.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt; &lt;strong&gt;Consistency&lt;/strong&gt;: A transaction brings the database from one valid state to another. All rules and constraints must be satisfied.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3&lt;/strong&gt; &lt;strong&gt;Isolation&lt;/strong&gt;: Concurrent execution of transactions results in a state that would be obtained if transactions were executed sequentially.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4&lt;/strong&gt; &lt;strong&gt;Durability&lt;/strong&gt;: Once a transaction has been committed, it will remain so, even in the event of power loss, crashes, or errors.&lt;/p&gt;
&lt;h4 id="isolation-level"&gt;Isolation level
&lt;/h4&gt;&lt;p&gt;Isolation levels define how transaction integrity is visible to other users and systems. They provide a trade-off between consistency and performance.&lt;/p&gt;
&lt;h4 id="read-uncommitted"&gt;READ UNCOMMITTED
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Lowest isolation level&lt;/li&gt;
&lt;li&gt;One transaction may read not-yet-committed changes made by other transactions (&amp;ldquo;dirty reads&amp;rdquo;)&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- May read the updated (uncommitted) balance
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ROLLBACK&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="read-committed"&gt;READ COMMITTED
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;A transaction only sees data committed before the transaction began&lt;/li&gt;
&lt;li&gt;Prevents dirty reads, but &amp;ldquo;non-repeatable reads&amp;rdquo; can occur&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- Reads original balance
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UPDATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;COMMIT&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- Reads new balance
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="repeatable-read"&gt;REPEATABLE READ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Ensures that if a transaction reads a row, it will consistently see the same data for that row until the transaction completes&lt;/li&gt;
&lt;li&gt;Prevents non-repeatable reads, but &amp;ldquo;phantom reads&amp;rdquo; can occur&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;COMMIT&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- May see the new account (phantom read)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="serializable"&gt;SERIALIZABLE
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Highest isolation level&lt;/li&gt;
&lt;li&gt;Transactions are completely isolated from one another&lt;/li&gt;
&lt;li&gt;Prevents dirty reads, non-repeatable reads, and phantom reads&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;account_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- This will be blocked until Transaction 1 completes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- Will not see any changes made by other transactions
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id="concurrency-issues"&gt;Concurrency Issues
&lt;/h5&gt;&lt;p&gt;&lt;strong&gt;1&lt;/strong&gt; &lt;strong&gt;Dirty Read&lt;/strong&gt;: Reading uncommitted data from another transaction.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt; &lt;strong&gt;Non-Repeatable Read&lt;/strong&gt;: Getting different results when reading the same row twice in the same transaction.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3&lt;/strong&gt; &lt;strong&gt;Phantom Read&lt;/strong&gt;: Getting different results when querying for a range of rows twice in the same transaction.&lt;/p&gt;
&lt;p&gt;â €Isolation Level Comparison&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;Isolation Level&lt;/th&gt;
&lt;th style="text-align: center"&gt;Dirty Read&lt;/th&gt;
&lt;th style="text-align: center"&gt;Non-Repeatable Read&lt;/th&gt;
&lt;th style="text-align: center"&gt;Phantom Read&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;READ UNCOMMITTED&lt;/td&gt;
&lt;td style="text-align: center"&gt;Possible&lt;/td&gt;
&lt;td style="text-align: center"&gt;Possible&lt;/td&gt;
&lt;td style="text-align: center"&gt;Possible&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;READ COMMITTED&lt;/td&gt;
&lt;td style="text-align: center"&gt;Prevented&lt;/td&gt;
&lt;td style="text-align: center"&gt;Possible&lt;/td&gt;
&lt;td style="text-align: center"&gt;Possible&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;REPEATABLE READ&lt;/td&gt;
&lt;td style="text-align: center"&gt;Prevented&lt;/td&gt;
&lt;td style="text-align: center"&gt;Prevented&lt;/td&gt;
&lt;td style="text-align: center"&gt;Possible&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;SERIALIZABLE&lt;/td&gt;
&lt;td style="text-align: center"&gt;Prevented&lt;/td&gt;
&lt;td style="text-align: center"&gt;Prevented&lt;/td&gt;
&lt;td style="text-align: center"&gt;Prevented&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Higher isolation levels provide more consistency but may reduce concurrency and impact performance.&lt;/p&gt;
&lt;p&gt;Many applications use READ COMMITTED as a default, as it provides a good balance between consistency and performance.&lt;/p&gt;
&lt;h3 id="transactional"&gt;@Transactional
&lt;/h3&gt;&lt;p&gt;When you annotate a method with @Transactional, Spring will start a transaction before the method executes and commit it after the method completes. If &lt;strong&gt;an exception is thrown&lt;/strong&gt;, the transaction will be rolled back.&lt;/p&gt;
&lt;p&gt;You can place @Transactional on a method or a class. If placed on a class, &lt;strong&gt;all public methods&lt;/strong&gt; of the class become transactional.(@Transactional only works on &lt;strong&gt;public&lt;/strong&gt; methods)
By default, transactions roll back on &lt;strong&gt;runtime exceptions&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;You can customize&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rollbackFor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;CustomException&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In Spring Boot applications, transaction management is automatically enabled. In other Spring applications, you need to explicitly enable it with @EnableTransactionManagement.
scenarios:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Multiple Database Operations&lt;/li&gt;
&lt;li&gt;Read Operations Requiring Consistency&lt;/li&gt;
&lt;li&gt;â€¦
&lt;strong&gt;Service Layer Methods&lt;/strong&gt; It&amp;rsquo;s often a good practice to put @Transactional on service-layer methods rather than repository methods or controllers.
Don&amp;rsquo;t use @Transactional for &lt;strong&gt;single, simple database operations&lt;/strong&gt; - the underlying repository methods are often already transactional.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="articles"&gt;Articles
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://www.baeldung.com/rest-api-spring-oauth2-angular" target="_blank" rel="noopener"
&gt;Spring REST API + OAuth2 + Angular&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://www.baeldung.com/keycloak-embedded-in-spring-boot-app" target="_blank" rel="noopener"
&gt;Keycloak Embedded in a Spring Boot Application&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2" target="_blank" rel="noopener"
&gt;Secure Spring REST With Spring Security and OAuth2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://dzone.com/articles/oauth-20-beginners-guide" target="_blank" rel="noopener"
&gt;OAuth 2.0 Beginner&amp;rsquo;s Guide&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://dzone.com/refcardz/oauth-patterns-and-anti-patterns" target="_blank" rel="noopener"
&gt;OAuth Patterns and Anti-Patterns&lt;/a&gt;&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Day 2</title><link>https://dyhes.github.io/p/postopia-dev-logday-2/</link><pubDate>Sun, 07 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-2/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover11.png" alt="Featured image of post ã€Postopia Dev Logã€‘Day 2" /&gt;&lt;p&gt;è€ƒè™‘åˆ°ä¸ç¡®å®šèƒ½æŠŠç³»ç»Ÿåšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œæš‚æ—¶ä¸è€ƒè™‘åˆ†å¸ƒå¼ç›¸å…³äº‹å®œ&lt;/p&gt;
&lt;p&gt;è¿è¡Œ./gradlew bootRun çƒ­åŠ è½½ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰ç”Ÿæ•ˆï¼Œæ‰¾æ¥æ‰¾å»æ²¡æ‰¾åˆ°åŸå› &lt;/p&gt;
&lt;p&gt;æƒ³ç›´æ¥ç”¨dokcerå®ç°ï¼Œä¸ç†Ÿæ‚‰dockerå’Œdocker composeå›°éš¾é‡é‡&lt;/p&gt;
&lt;p&gt;æ ¹æ® &lt;a class="link" href="https://digitalsanctuary.com/java/springboot-devtools-auto-restart-and-live-reload.html" target="_blank" rel="noopener"
&gt;SpringBoot DevTools Auto Restart and Live Reload&lt;/a&gt; ä¸€é¡¿æ“ä½œä¹‹åæ§åˆ¶å°æœ‰ååº”äº†ï¼Œä½†æ˜¯æ²¡æœ‰æ•ˆæœ&lt;/p&gt;
&lt;p&gt;æ ¹æ® &lt;a class="link" href="https://github.com/spring-projects/spring-boot/issues/38538" target="_blank" rel="noopener"
&gt;LiveReload does not detect changes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;â€For a change to be noticeable &lt;strong&gt;it has to be compiled&lt;/strong&gt;. You can learn more about thisÂ &lt;a class="link" href="https://docs.spring.io/spring-boot/docs/3.2.x/reference/html/using.html#using.devtools.restart" target="_blank" rel="noopener"
&gt;in the reference documentation&lt;/a&gt;. We generally recommend using an IDE to both to run the application and to make changes. It will then compile the changes so that they can be noticed by DevTools.â€œ&lt;/p&gt;
&lt;p&gt;æˆåŠŸè§£å†³é—®é¢˜&lt;/p&gt;
&lt;p&gt;è¿›åº¦ï¼š
å®Œæˆæ³¨å†Œï¼Œçƒ­åŠ è½½&lt;/p&gt;
&lt;h2 id="knowledge"&gt;knowledge
&lt;/h2&gt;&lt;h3 id="uuid-long-id-comparison"&gt;UUID, Long ID comparison
&lt;/h3&gt;&lt;p&gt;UUID:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Globally unique&lt;/li&gt;
&lt;li&gt;128-bit value&lt;/li&gt;
&lt;li&gt;String representation&lt;/li&gt;
&lt;li&gt;No sequential ordering&lt;/li&gt;
&lt;li&gt;Suitable for distributed systems&lt;/li&gt;
&lt;li&gt;Can be generated without DB interaction&lt;/li&gt;
&lt;li&gt;Larger storage size (typically 36 characters)
â €Long ID:&lt;/li&gt;
&lt;li&gt;Locally unique (per table)&lt;/li&gt;
&lt;li&gt;64-bit integer&lt;/li&gt;
&lt;li&gt;Numeric representation&lt;/li&gt;
&lt;li&gt;Sequential (if auto-incremented)&lt;/li&gt;
&lt;li&gt;Simpler and more human-readable&lt;/li&gt;
&lt;li&gt;Smaller storage size (8 bytes)&lt;/li&gt;
&lt;li&gt;Typically faster for indexing and joining&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="generatedvalue"&gt;@GeneratedValue
&lt;/h3&gt;&lt;p&gt;The @GeneratedValue annotation in Spring Boot is used to specify &lt;strong&gt;how the primary key should be generated for an entity&lt;/strong&gt;. Here&amp;rsquo;s a breakdown of its key aspects:
Common strategies:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GenerationType.AUTO (default)&lt;/li&gt;
&lt;li&gt;GenerationType.IDENTITY
&lt;ul&gt;
&lt;li&gt;Pros: Simple, efficient for single-node systems&lt;/li&gt;
&lt;li&gt;Cons: Can cause issues in distributed systems or data migrations&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GenerationType.SEQUENCE
&lt;ul&gt;
&lt;li&gt;Pros: Efficient, works well in high-concurrency environments&lt;/li&gt;
&lt;li&gt;Cons: Not supported by all databases (e.g., MySQL before 8.0)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;GenerationType.TABLE
&lt;ul&gt;
&lt;li&gt;Pros: Database-independent, works everywhere&lt;/li&gt;
&lt;li&gt;Cons: Potentially slower, requires extra table management&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="lombok-constructor-related-annotation"&gt;Lombok Constructor related annotation
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;@NoArgsConstructor&lt;/li&gt;
&lt;li&gt;@AllArgsConstructor&lt;/li&gt;
&lt;li&gt;@RequiredArgsConstructor
all final and @NonNull fields&lt;/li&gt;
&lt;li&gt;@Builder
used to generate a builder pattern for your class&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;MyClass&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;myClass&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MyClass&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;John Doe&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;age&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;30&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;address&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;123 Main St&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="gradlew"&gt;./gradlew
&lt;/h3&gt;&lt;p&gt;This part of the command is invoking the &lt;strong&gt;Gradle Wrapper&lt;/strong&gt; (gradlewÂ orÂ gradlew.bat), which is a script that comes bundled with the Gradle build tool. The Gradle Wrapper ensures that the correct version of Gradle is used for the project, regardless of whether or not the user has Gradle installed on their system.&lt;/p&gt;
&lt;h3 id="dockerfile"&gt;Dockerfile
&lt;/h3&gt;&lt;p&gt;A Dockerfile is a script that contains a series of instructions on how to build a Docker image. Each &lt;strong&gt;instruction&lt;/strong&gt; in a Dockerfile creates a &lt;strong&gt;layer&lt;/strong&gt; in the image, and when you build the image, Docker executes these instructions step by step to produce the final image.
&lt;strong&gt;FROM&lt;/strong&gt;
Specifies the &lt;strong&gt;base image&lt;/strong&gt; to use for the Docker image youâ€™re building. Every Dockerfile &lt;strong&gt;must start with&lt;/strong&gt; aÂ FROMÂ instruction.
&lt;strong&gt;FROM&lt;/strong&gt; ubuntu:20.04&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;LABEL&lt;/strong&gt;
Adds &lt;strong&gt;metadata&lt;/strong&gt; to the image, such as a maintainer name or a version.
&lt;strong&gt;LABEL&lt;/strong&gt; maintainer=&amp;ldquo;&lt;a class="link" href="mailto:example@example.com" &gt;example@example.com&lt;/a&gt;&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RUN&lt;/strong&gt;
&lt;strong&gt;Executes a command&lt;/strong&gt; in the shell. Itâ€™s often used for installing software packages.
&lt;strong&gt;RUN&lt;/strong&gt; apt-get update &amp;amp;&amp;amp; apt-get install -y nginx&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;COPY&lt;/strong&gt;
Copies files or directories from your local filesystem into the Docker image.
&lt;strong&gt;COPY&lt;/strong&gt; ./localfile /containerfile&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ADD&lt;/strong&gt;
Similar toÂ COPY, but also &lt;strong&gt;supports URL sources and automatic unpacking&lt;/strong&gt; of compressed files.
&lt;strong&gt;ADD&lt;/strong&gt; &lt;a class="link" href="https://example.com/file.tar.gz" target="_blank" rel="noopener"
&gt;https://example.com/file.tar.gz&lt;/a&gt; /tmp/&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;WORKDIR&lt;/strong&gt;
Sets the &lt;strong&gt;working directory&lt;/strong&gt; for any subsequentÂ RUN,Â CMD,Â ENTRYPOINT,Â COPY, andÂ ADDÂ instructions.
&lt;strong&gt;WORKDIR&lt;/strong&gt; /app&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CMD&lt;/strong&gt;
Provides a command that will be executed &lt;strong&gt;when a container is started from the image&lt;/strong&gt;. Only oneÂ CMDÂ instruction is allowed per Dockerfile; if multipleÂ CMDÂ instructions are specified, &lt;strong&gt;only the last one takes effect&lt;/strong&gt;.
&lt;strong&gt;CMD&lt;/strong&gt; [&amp;ldquo;nginx&amp;rdquo;, &amp;ldquo;-g&amp;rdquo;, &amp;ldquo;daemon off;&amp;rdquo;]&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ENTRYPOINT&lt;/strong&gt;
Sets the default application to be used every time a container is created from the image. UnlikeÂ CMD,Â ENTRYPOINTÂ &lt;strong&gt;wonâ€™t be overridden by command-line arguments&lt;/strong&gt;.
&lt;strong&gt;ENTRYPOINT&lt;/strong&gt; [&amp;ldquo;nginx&amp;rdquo;, &amp;ldquo;-g&amp;rdquo;, &amp;ldquo;daemon off;&amp;rdquo;]&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ENV&lt;/strong&gt;
Sets environment variables.
&lt;strong&gt;ENV&lt;/strong&gt; MY_ENV_VAR=my_value&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EXPOSE&lt;/strong&gt;
Informs Docker that the container listens on the specified network ports at runtime. This doesnâ€™t actually publish the port; itâ€™s a form of &lt;strong&gt;documentation&lt;/strong&gt;.
&lt;strong&gt;EXPOSE&lt;/strong&gt; 80&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VOLUME&lt;/strong&gt;
Creates a mount point with the specified path and marks it as holding externally mounted volumes from the native host or other containers.
&lt;strong&gt;VOLUME&lt;/strong&gt; [&amp;quot;/data&amp;quot;]&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;USER&lt;/strong&gt;
Sets the user name or UID to use when running the image and for anyÂ RUN,Â CMD, andÂ ENTRYPOINTÂ instructions that follow it.
&lt;strong&gt;USER&lt;/strong&gt; nginx&lt;/p&gt;
&lt;p&gt;a project can have multiple Dockerfiles.
e.g.
â”œâ”€â”€ Dockerfile ## Default Dockerfile for production
â”œâ”€â”€ Dockerfile.dev ## Dockerfile for development
â”œâ”€â”€ Dockerfile.test ## Dockerfile for testing&lt;/p&gt;
&lt;h2 id="articles"&gt;Articles
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://medium.com/@saygiligozde/using-docker-compose-with-spring-boot-and-postgresql-235031106f9f" target="_blank" rel="noopener"
&gt;Using Docker Compose with Spring Boot and PostgreSQL&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://digitalsanctuary.com/java/springboot-devtools-auto-restart-and-live-reload.html" target="_blank" rel="noopener"
&gt;SpringBoot DevTools Auto Restart and Live Reload&lt;/a&gt;&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Day 1</title><link>https://dyhes.github.io/p/postopia-dev-logday-1/</link><pubDate>Fri, 05 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-1/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover8.png" alt="Featured image of post ã€Postopia Dev Logã€‘Day 1" /&gt;&lt;p&gt;ä¸ºäº†æé«˜è‡ªå·±çš„å…¨æ ˆå¼€å‘èƒ½åŠ›ï¼Œæ ¹æ®Redditä¸ŠæŸå¸–å­(æ‰¾ä¸åˆ°åŸè´´äº†)é‡Œå…³äºæé«˜ä»£ç èƒ½åŠ›çš„å»ºè®®ï¼š&lt;strong&gt;Reinvent The Wheel&lt;/strong&gt;, å†³å®šè‡ªå·±å¼€å‘ä¸€ä¸ªç±»ä¼¼Redditçš„è®ºå›ç³»ç»Ÿï¼Œåœ¨ Claude3.5çš„å»ºè®®ä¸‹å–å Postopiaã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ç”¨umi maxè¿˜æ˜¯umiï¼Œæ„Ÿè§‰umi maxè™½ç„¶åŠŸèƒ½é½å…¨ï¼Œä½†æ˜¯æœ‰ç‚¹è‡ƒè‚¿ã€‚æœ€åè€ƒè™‘åˆ°é…ç½®å„ç§ä¾èµ–çš„å¤æ‚ç¨‹åº¦ï¼Œè¿˜æ˜¯é€‰æ‹©umi maxã€‚&lt;/p&gt;
&lt;p&gt;ç”¨claude 3.5ç”Ÿæˆäº†ä¸€äº›ä»£ç ï¼Œä½†æ„Ÿè§‰è´¨é‡ä¸æ˜¯å¾ˆé«˜ï¼ŒåŒæ—¶åªèƒ½æä¾›æœ€åŸºç¡€çš„html,css,jsä¸‰ä»¶å¥—ï¼Œåˆ©ç”¨ä¸äº†æ›´é«˜å±‚çš„æ¡†æ¶èƒ½åŠ›ï¼Œè¿˜æ˜¯ä»…ä¾›å‚è€ƒ&lt;/p&gt;
&lt;h2 id="postopia"&gt;Postopia
&lt;/h2&gt;&lt;p&gt;Claude 3.5:&lt;/p&gt;
&lt;p&gt;Here are some name suggestions for a Reddit alternative:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Readit&lt;/li&gt;
&lt;li&gt;Threaddit&lt;/li&gt;
&lt;li&gt;Postopia&lt;/li&gt;
&lt;li&gt;Forumly&lt;/li&gt;
&lt;li&gt;Discussr&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Postopia is indeed an interesting name choice. Let me break it down for you:&lt;/p&gt;
&lt;p&gt;Etymology:&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Post&amp;rdquo; refers to the act of submitting content or messages, which is a core feature of Reddit-like platforms.
&amp;ldquo;topia&amp;rdquo; comes from the Greek word &amp;ldquo;topos&amp;rdquo; meaning place, and is often used to describe an ideal or imaginary place.&lt;/p&gt;
&lt;p&gt;Meaning:&lt;/p&gt;
&lt;p&gt;Together, Postopia suggests a &amp;ldquo;world of posts&amp;rdquo; or an &amp;ldquo;ideal place for posting.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Connotations:&lt;/p&gt;
&lt;p&gt;It evokes a sense of a utopian community built around sharing and discussing content.
The name implies a space where posting and engaging with posts is the primary focus.&lt;/p&gt;
&lt;p&gt;Relevance to Reddit alternative:&lt;/p&gt;
&lt;p&gt;Like Reddit, it emphasizes the user-generated content aspect.
It suggests a potentially improved or idealized version of a posting platform.&lt;/p&gt;
&lt;p&gt;Memorability:&lt;/p&gt;
&lt;p&gt;The combination of familiar elements (&amp;ldquo;post&amp;rdquo; and &amp;ldquo;topia&amp;rdquo;) creates a unique and catchy name.
It&amp;rsquo;s relatively easy to spell and pronounce.&lt;/p&gt;
&lt;p&gt;Domain availability:&lt;/p&gt;
&lt;p&gt;As of my last update, postopia.com was likely taken, but variations like getpostopia.com or postopia.io might be available.&lt;/p&gt;
&lt;p&gt;Branding potential:&lt;/p&gt;
&lt;p&gt;The name lends itself well to visual branding, perhaps incorporating elements that suggest an ideal digital community.&lt;/p&gt;
&lt;h2 id="æŠ€æœ¯æ ˆ"&gt;æŠ€æœ¯æ ˆ
&lt;/h2&gt;&lt;h3 id="å‰ç«¯"&gt;å‰ç«¯
&lt;/h3&gt;&lt;p&gt;Umi maxï¼Œnode 18.20.3&lt;/p&gt;
&lt;h3 id="åç«¯"&gt;åç«¯
&lt;/h3&gt;&lt;p&gt;Spring Boot 3.3ï¼ŒJava 17&lt;/p&gt;</description></item><item><title>ã€Postopia Dev Logã€‘Summary</title><link>https://dyhes.github.io/p/postopia-dev-logsummary/</link><pubDate>Fri, 05 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logsummary/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover18.png" alt="Featured image of post ã€Postopia Dev Logã€‘Summary" /&gt;&lt;p&gt;è€ƒè™‘éš”ç¦»çº§åˆ«&lt;/p&gt;
&lt;h2 id="hard-core"&gt;Hard Core
&lt;/h2&gt;&lt;h3 id="spring-security"&gt;Spring Security
&lt;/h3&gt;&lt;p&gt;æ²¡æœ‰ç»éªŒæ—¶çš„ç™»å½•å®ç°ï¼Œæ–‡æ¡£æ‚ä¹±ï¼Œä¸çŸ¥é“å¦‚ä½•å¯»æ‰¾æ­£ç¡®çš„å®ç°æ–¹æ³•&lt;/p&gt;
&lt;h2 id="inspiration"&gt;Inspiration
&lt;/h2&gt;&lt;h3 id="w5"&gt;w5
&lt;/h3&gt;&lt;p&gt;å¦‚ä½•å¤„ç†ä»¥å‰æ²¡æœ‰é‡åˆ°è¿‡çš„æ–°éœ€æ±‚ï¼ˆå¦‚ç»™ç”¨æˆ·å‘é€é‚®ä»¶ï¼‰ï¼Œéœ€è¦ç§¯ç´¯è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼ˆå®ä¹ çš„æ—¶å€™å¯ä»¥è¾¹é—®è¾¹æŸ¥ï¼Œåšè‡ªå·±çš„é¡¹ç›®åªèƒ½è‡ªå·±å»æŸ¥ï¼Œé‚£ä¹ˆå¦‚ä½•é«˜æ•ˆæ£€ç´¢å¹¶å–„ç”¨AIï¼‰,å¹¶å½¢æˆæ–¹æ³•è®ºï¼Œä»¥ä¾¿æé«˜èƒ½åŠ›&lt;/p&gt;
&lt;h3 id="w8"&gt;w8
&lt;/h3&gt;&lt;p&gt;opinionCountï¼ŒmemberCountç­‰é¢‘ç¹æ›´æ–°çš„å­—æ®µåœ¨ç”¨ElasticSearchæœç´¢æ—¶ä¹Ÿæœ‰æŸ¥è¯¢çš„éœ€æ±‚å¦‚ä½•å¤„ç†&lt;/p&gt;
&lt;p&gt;è‹¥è¦å­˜å‚¨ï¼ˆç”¨kafkaå­˜è¿‡å»xåˆ†é’Ÿæ›´æ–°è¿‡çš„idï¼Œæ¯éš”xåˆ†é’ŸåŒæ­¥ï¼‰&lt;/p&gt;
&lt;p&gt;å°†å…¶åˆ†ç¦»å‡ºæ¥ä¸å­˜å‚¨ï¼Œåœ¨æœç´¢æ—¶ç”¨ä¸€ä¸ªé¢å¤–è¯·æ±‚æ‰¹é‡æŸ¥è¯¢&lt;/p&gt;
&lt;h3 id="w14"&gt;w14
&lt;/h3&gt;&lt;p&gt;docker å®¹å™¨ä½¿ç”¨volumeæŒä¹…åŒ–æ•°æ®ä¸”å‰åç¯å¢ƒå˜é‡ä¸ä¸€è‡´å¯¼è‡´è¿æ¥å¤±è´¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenFeign ä¸­å®ç° &lt;strong&gt;UserInfo åˆ° SpaceUserInfo çš„ DTO è‡ªåŠ¨æ˜ å°„&lt;/strong&gt;æ˜¯å¦ä¼šäº§ç”Ÿæ€§èƒ½å¼€é”€ï¼Œä»¥åŠæ˜¯å¦é€‰æ‹©é¢å¤–æ¥å£ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡å¤§éƒ¨åˆ†å­æœåŠ¡ä¾èµ–commonæ¨¡å—ï¼Œä½†å¹¶ä¸ä¸€å®šéœ€è¦commonæ¨¡å—é›†æˆçš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ˜¯é€šè¿‡componentscanè®¾ç½®èŒƒå›´å¥½è¿˜æ˜¯å°†commonæ¨¡å—æ‹†åˆ†å¥½ï¼Œå„æœ‰ä»€ä¹ˆå¥½å¤„
è¿™äº›é—®é¢˜åªæœ‰åœ¨å®è·µä¸­æ‰æœ‰çœŸåˆ‡ä½“ä¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="best-practices"&gt;Best Practices
&lt;/h2&gt;&lt;p&gt;å¾ˆå¤šé—®é¢˜åªæœ‰äº²èº«ç»å†æ‰èƒ½ä½“ä¼šï¼Œå¹¶å¯»æ±‚ best practices æ¯”å¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥æ›´æ–°å¥½ï¼Œå¤„ç†å¯èƒ½çš„å¼‚å¸¸å¥½è¿˜æ˜¯å…ˆæŸ¥è¯¢å­˜åœ¨å†æ›´æ–°å¥½&lt;/li&gt;
&lt;li&gt;æ˜¯å¦åœ¨Service Layer ä½¿ç”¨@AuthenticatedPrincipal&lt;/li&gt;
&lt;li&gt;serviceå¼•ç”¨å¤šä¸ªrepositoryæˆ–å¼•ç”¨å¯¹åº”repositoryå’Œå…¶ä»–service&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="performance-considerations"&gt;Performance Considerations
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·å¯¹äºå¸–å­æˆ–è¯„è®ºçš„æ€åº¦ï¼ˆèµåŒï¼Œåå¯¹ï¼‰æ˜¯å¦ç”¨é¢å¤–çš„queryæŸ¥è¯¢æ›´å¥½ï¼ˆw4ï¼‰&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>